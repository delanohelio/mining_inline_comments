{"pr_number": 2802, "pr_title": "ENT-1848: Port OwnerResource to spec-first", "pr_createdAt": "2020-09-10T14:19:39Z", "pr_url": "https://github.com/candlepin/candlepin/pull/2802", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzY5NDA3Nw==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r487694077", "bodyText": "Can we use exepect { } here to test exceptions. Something like -\nexpect {\n      consumer.list_owner_consumers(owner['key'])\n}.to raise_error(RestClient::Forbidden)", "author": "wolfdale", "createdAt": "2020-09-14T07:07:33Z", "path": "server/spec/owner_resource_spec.rb", "diffHunk": "@@ -30,6 +30,18 @@\n     user1.list_owner_consumers(owner1['key']).length.should == 1\n   end\n \n+  it 'consumer cannot list other consumers for an owner' do\n+    owner = create_owner random_string('test_owner')\n+    username = random_string(\"test-user\")\n+    consumer_name = random_string(\"test-consumer\")\n+    user = user_client(owner, username)\n+    consumer = consumer_client(user, consumer_name)\n+\n+    lambda do", "originalCommit": "124481e63a503a414f4f563dbc2821e11a8a4498", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzc4ODY3Ng==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r487788676", "bodyText": "Agreed. Updated the code.", "author": "sonalidhome", "createdAt": "2020-09-14T09:51:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzY5NDA3Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzY5NDExNg==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r487694116", "bodyText": "Moved some of the access related tests from Junit to Rspec.\nJunits did not invoke the VerifyAuthorizationFilter\nwhen the endpoint is ported into OpenAPI.\n\nHaving some doubts about these changes of converting Junits to functional Spec tests. Since we are making changes with Principle which is necessary to port resource class to OpenAPI, not sure if we are tampering with older functionality unknowingly.\nAny thoughts ? @Ceiu @nikosmoum @Januson", "author": "wolfdale", "createdAt": "2020-09-14T07:07:38Z", "path": "server/spec/owner_resource_spec.rb", "diffHunk": "@@ -690,6 +702,59 @@\n     # and only include one instance of each unique value.\n     res[\"systemPurposeAttributes\"][\"roles\"].length.should == 1\n   end\n+", "originalCommit": "124481e63a503a414f4f563dbc2821e11a8a4498", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODQyOTYwMw==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r488429603", "bodyText": "I agree. Rather than moving tests to RSpec we should have proper integration tests for our filters and other RestEasy stuff.\nI would propose to create a card to create said tests and instead of deleting the broken tests to disable them with a card tag. We can keep the created spec tests until we fix it.", "author": "Januson", "createdAt": "2020-09-15T06:56:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzY5NDExNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjAyNjM5Mw==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r492026393", "bodyText": "I'm a bit late to respond here, but yeah... let's not move JUnit tests to rspec if we can avoid it. Last time we discussed it, the long-term plan is to get rid of rspec (which is a large part of why we're doing the switch to OpenAPI stuff to begin with), so it'll just create more work for us down the line.", "author": "Ceiu", "createdAt": "2020-09-21T13:01:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzY5NDExNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjgxNjAzMQ==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r492816031", "bodyText": "I agree that whenever possible, we should have unit tests instead of spec tests. Spec tests take much longer to run, so if a functionality can be tested at the unit test level, we should keep it at that, and the effort of keeping these tests working as unit tests is worth it.", "author": "nikosmoum", "createdAt": "2020-09-22T15:11:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzY5NDExNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDEzNjA4Mw==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r494136083", "bodyText": "Agreed. After more digging into this, it came down to be a Guice AOP issue.\nCurrently, we override the methods in resource classes from the interface. So few of the annotation in the resource class method is @Override. And other HTTP Annotations are in API interface methods. So in TestingModules, we bind authorization interceptor, we use HttpMethodMatcher. But It does not find the superclass HTTP annotations and fails to invoke the authorization filter for each method.\nTo overcome this particular scenario, I have added a code to explicitly add interceptor for OwnerResource :\n bindInterceptor(Matchers.subclassesOf(OwnerResource.class), Matchers.any(), authMethodInterceptor);\nThis will simply work for any method present in OwnerResource. And it serves the current purpose. Also, we need to look again when we port ConsumerResource.", "author": "sonalidhome", "createdAt": "2020-09-24T08:33:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzY5NDExNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzcwODY2Nw==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r487708667", "bodyText": "You might consider changing the description to Conflict occurred while deleting an owner", "author": "wolfdale", "createdAt": "2020-09-14T07:36:26Z", "path": "api/candlepin-api-spec.yaml", "diffHunk": "@@ -2192,6 +2192,309 @@ paths:\n         default:\n           $ref: '#/components/responses/default'\n \n+  /owners:\n+    get:\n+      description: Retrieves a list of owners\n+      tags:\n+        - Owner\n+      operationId: listOwners\n+      x-java-response:\n+        type: Iterable\n+        isContainer: true\n+      parameters:\n+        - name: key\n+          in: query\n+          description: The owner keys\n+          required: false\n+          schema:\n+            type: string\n+      security: []\n+      responses:\n+        200:\n+          description: A list of owners\n+          content:\n+            application/json:\n+              schema:\n+                type: array\n+                items:\n+                  $ref: '#/components/schemas/OwnerDTO'\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+    post:\n+      description: Creates an owner\n+      tags:\n+        - Owner\n+      operationId: createOwner\n+      security: []\n+      requestBody:\n+        description: Owner to be created\n+        required: true\n+        content:\n+          application/json:\n+            schema:\n+              $ref: '#/components/schemas/OwnerDTO'\n+      responses:\n+        200:\n+          description: Owner successfully created\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/OwnerDTO'\n+        400:\n+          description: |\n+            Invalid inputs, Owner cannot be created.\n+            Reasons could be, invalid key\n+            or the default service level is specified\n+            or the owner content access mode and content access mode list cannot be set directly in standalone mode\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: |\n+                  Invalid inputs, Owner cannot be created.\n+                  Reasons could be, invalid key\n+                  or the default service level is specified\n+                  or the owner content access mode and content access mode list cannot be set directly in standalone mode\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}:\n+    get:\n+      description: Retrieves a single owner\n+      tags:\n+        - Owner\n+      operationId: getOwner\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+      security: []\n+      responses:\n+        200:\n+          description: Owner successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/OwnerDTO'\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+    put:\n+      description: |\n+        Updates an owner.\n+        Note: To un-set the defaultServiceLevel for an owner, submit an empty string.\n+      tags:\n+        - Owner\n+      operationId: updateOwner\n+      security: []\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+      requestBody:\n+        description: Owner to be updated\n+        required: true\n+        content:\n+          application/json:\n+            schema:\n+              $ref: '#/components/schemas/OwnerDTO'\n+      responses:\n+        200:\n+          description: Owner successfully updated\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/OwnerDTO'\n+        400:\n+          description: |\n+            Invalid inputs, Owner cannot be updated.\n+            Reasons could be, invalid key\n+            or the default service level is specified\n+            or the owner content access mode and content access mode list cannot be set directly in standalone mode\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: |\n+                  Invalid inputs, Owner cannot be updated.\n+                  Reasons could be, invalid key\n+                  or the default service level is specified\n+                  or the owner content access mode and content access mode list cannot be set directly in standalone mode\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+    delete:\n+      description: Removes an owner\n+      tags:\n+        - Owner\n+      operationId: deleteOwner\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The owner key\n+          required: true\n+          schema:\n+            type: string\n+        - name: revoke\n+          in: query\n+          description: Boolean value to revoke an owner\n+          schema:\n+            type: boolean\n+            default: true\n+        - name: force\n+          in: query\n+          description: Boolean value to forcefully delete an owner. This is not in use.\n+          schema:\n+            type: boolean\n+            default: false\n+      security: []\n+      responses:\n+        200:\n+          description: Owner successfully deleted\n+        409:\n+          description: Occured conflict while owner deletion", "originalCommit": "124481e63a503a414f4f563dbc2821e11a8a4498", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzc4ODc4OQ==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r487788789", "bodyText": "Updated.", "author": "sonalidhome", "createdAt": "2020-09-14T09:51:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzcwODY2Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzcwOTY2OQ==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r487709669", "bodyText": "Parameters descriptions are incorrect at multiple places in this endpoint.", "author": "wolfdale", "createdAt": "2020-09-14T07:38:22Z", "path": "api/candlepin-api-spec.yaml", "diffHunk": "@@ -2432,55 +2735,1142 @@ paths:\n         default:\n           $ref: '#/components/responses/default'\n \n-  /owners/{owner_key}/products:\n+  /owners/{owner_key}/consumers:\n     get:\n-      description: Retrieves a list of products by owner\n+      description: Retrieves a list of Consumers for the Owner\n       tags:\n-        - Owner Product\n-      operationId: getProductsByOwner\n-      security: []\n+        - Owner\n+        - Consumer\n+      operationId: listConsumers\n       x-java-response:\n         type: Iterable\n         isContainer: true\n       parameters:\n         - name: owner_key\n           in: path\n-          description: Owner key\n+          description: The key of the owner\n           required: true\n           schema:\n             type: string\n-        - name: product\n+        - name: username\n           in: query\n-          description: List of product ID's\n-          required: true\n+          description: The username of the consumer\n+          schema:\n+            type: string\n+        - name: type\n+          in: query\n+          description: The consumer type\n           schema:\n             type: array\n+            uniqueItems: true\n             items:\n               type: string\n-      responses:\n-        200:\n-          description: Retrieves a list of products by owner\n-          content:\n-            application/json:\n-              schema:\n-                type: array\n-                items:\n-                  $ref: '#/components/schemas/ProductDTO'\n-        404:\n-          description: Owner key could not be found\n-          content:\n-            application/json:\n-              schema:\n-                $ref: '#/components/schemas/ExceptionMessage'\n-              example:\n-                displayMessage: Owner key could not be found\n-                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n-        default:\n-          $ref: '#/components/responses/default'\n-\n-    post:\n-      description: Creates a product for an owner\n-      tags:\n+        - name: uuid\n+          in: query\n+          description: The UUID of consumers\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: hypervisor_id\n+          in: query\n+          description: The hypervisor IDs\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: fact\n+          in: query\n+          description: The consumer facts\n+          schema:\n+            type: array\n+            items:\n+              $ref: '#/components/schemas/KeyValueParamDTO'\n+        - name: sku\n+          in: query\n+          description: The list of skus\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: subscription_id\n+          in: query\n+          description: The list of subscription IDs\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: contract\n+          in: query\n+          description: The list of contract numbers\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+      security: []\n+      responses:\n+        200:\n+          description: Consumers successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                type: array\n+                items:\n+                  $ref: '#/components/schemas/ConsumerDTOArrayElement'\n+        400:\n+          description: Owner key is null or empty\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Owner key is null or empty\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/consumers/count:\n+    get:\n+      description: Retrieves a count of consumers for the owner\n+      tags:\n+        - Owner\n+        - Consumer\n+      operationId: countConsumers\n+      parameters:", "originalCommit": "124481e63a503a414f4f563dbc2821e11a8a4498", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzc4ODkxNg==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r487788916", "bodyText": "Added descriptions.", "author": "sonalidhome", "createdAt": "2020-09-14T09:51:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzcwOTY2OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzcxMTkwNg==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r487711906", "bodyText": "Please add parameter description here.", "author": "wolfdale", "createdAt": "2020-09-14T07:41:03Z", "path": "api/candlepin-api-spec.yaml", "diffHunk": "@@ -2432,55 +2735,1142 @@ paths:\n         default:\n           $ref: '#/components/responses/default'\n \n-  /owners/{owner_key}/products:\n+  /owners/{owner_key}/consumers:\n     get:\n-      description: Retrieves a list of products by owner\n+      description: Retrieves a list of Consumers for the Owner\n       tags:\n-        - Owner Product\n-      operationId: getProductsByOwner\n-      security: []\n+        - Owner\n+        - Consumer\n+      operationId: listConsumers\n       x-java-response:\n         type: Iterable\n         isContainer: true\n       parameters:\n         - name: owner_key\n           in: path\n-          description: Owner key\n+          description: The key of the owner\n           required: true\n           schema:\n             type: string\n-        - name: product\n+        - name: username\n           in: query\n-          description: List of product ID's\n-          required: true\n+          description: The username of the consumer\n+          schema:\n+            type: string\n+        - name: type\n+          in: query\n+          description: The consumer type\n           schema:\n             type: array\n+            uniqueItems: true\n             items:\n               type: string\n-      responses:\n-        200:\n-          description: Retrieves a list of products by owner\n-          content:\n-            application/json:\n-              schema:\n-                type: array\n-                items:\n-                  $ref: '#/components/schemas/ProductDTO'\n-        404:\n-          description: Owner key could not be found\n-          content:\n-            application/json:\n-              schema:\n-                $ref: '#/components/schemas/ExceptionMessage'\n-              example:\n-                displayMessage: Owner key could not be found\n-                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n-        default:\n-          $ref: '#/components/responses/default'\n-\n-    post:\n-      description: Creates a product for an owner\n-      tags:\n+        - name: uuid\n+          in: query\n+          description: The UUID of consumers\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: hypervisor_id\n+          in: query\n+          description: The hypervisor IDs\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: fact\n+          in: query\n+          description: The consumer facts\n+          schema:\n+            type: array\n+            items:\n+              $ref: '#/components/schemas/KeyValueParamDTO'\n+        - name: sku\n+          in: query\n+          description: The list of skus\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: subscription_id\n+          in: query\n+          description: The list of subscription IDs\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: contract\n+          in: query\n+          description: The list of contract numbers\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+      security: []\n+      responses:\n+        200:\n+          description: Consumers successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                type: array\n+                items:\n+                  $ref: '#/components/schemas/ConsumerDTOArrayElement'\n+        400:\n+          description: Owner key is null or empty\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Owner key is null or empty\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/consumers/count:\n+    get:\n+      description: Retrieves a count of consumers for the owner\n+      tags:\n+        - Owner\n+        - Consumer\n+      operationId: countConsumers\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+        - name: type\n+          in: query\n+          description: type\n+          schema:\n+            type: array\n+            uniqueItems: true\n+            items:\n+              type: string\n+        - name: sku\n+          in: query\n+          description: sku\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: subscription_id\n+          in: query\n+          description: subscription_id\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: contract\n+          in: query\n+          description: contract\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+      security: []\n+      responses:\n+        200:\n+          description: Consumer counts successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                type: integer\n+        400:\n+          description: Owner key is null or empty\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Owner key is null or empty\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/consumers_system_purpose:\n+    get:\n+      description: Retrieves an aggregate of the system purpose settings of the owner's consumers\n+      tags:\n+        - Owner\n+        - Consumer\n+      operationId: getConsumersSyspurpose\n+      security: []\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+      responses:\n+        200:\n+          description:  The system purpose settings sucessfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/SystemPurposeAttributesDTO'\n+        400:\n+          description: Owner key is null or empty\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Owner key is null or empty\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: Owner key could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Owner key could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/entitlements:\n+    get:\n+      description: |\n+        Retrieves the list of entitlements for an owner.\n+        This endpoint supports paging with query parameters. For more details please visit\n+        https://www.candlepinproject.org/docs/candlepin/pagination.html#paginating-results-from-candlepin\n+      tags:\n+        - Owner\n+        - Entitlements\n+      operationId: ownerEntitlements\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+        - name: product\n+          in: query\n+          description: The product id\n+          schema:\n+            type: string\n+        - name: matches\n+          in: query\n+          description: Matches", "originalCommit": "124481e63a503a414f4f563dbc2821e11a8a4498", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzc4OTA0Nw==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r487789047", "bodyText": "Added description.", "author": "sonalidhome", "createdAt": "2020-09-14T09:51:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzcxMTkwNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzcxNDM2Mw==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r487714363", "bodyText": "Please change the response code to 204 instead of 200.", "author": "wolfdale", "createdAt": "2020-09-14T07:45:42Z", "path": "api/candlepin-api-spec.yaml", "diffHunk": "@@ -2432,55 +2735,1142 @@ paths:\n         default:\n           $ref: '#/components/responses/default'\n \n-  /owners/{owner_key}/products:\n+  /owners/{owner_key}/consumers:\n     get:\n-      description: Retrieves a list of products by owner\n+      description: Retrieves a list of Consumers for the Owner\n       tags:\n-        - Owner Product\n-      operationId: getProductsByOwner\n-      security: []\n+        - Owner\n+        - Consumer\n+      operationId: listConsumers\n       x-java-response:\n         type: Iterable\n         isContainer: true\n       parameters:\n         - name: owner_key\n           in: path\n-          description: Owner key\n+          description: The key of the owner\n           required: true\n           schema:\n             type: string\n-        - name: product\n+        - name: username\n           in: query\n-          description: List of product ID's\n-          required: true\n+          description: The username of the consumer\n+          schema:\n+            type: string\n+        - name: type\n+          in: query\n+          description: The consumer type\n           schema:\n             type: array\n+            uniqueItems: true\n             items:\n               type: string\n-      responses:\n-        200:\n-          description: Retrieves a list of products by owner\n-          content:\n-            application/json:\n-              schema:\n-                type: array\n-                items:\n-                  $ref: '#/components/schemas/ProductDTO'\n-        404:\n-          description: Owner key could not be found\n-          content:\n-            application/json:\n-              schema:\n-                $ref: '#/components/schemas/ExceptionMessage'\n-              example:\n-                displayMessage: Owner key could not be found\n-                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n-        default:\n-          $ref: '#/components/responses/default'\n-\n-    post:\n-      description: Creates a product for an owner\n-      tags:\n+        - name: uuid\n+          in: query\n+          description: The UUID of consumers\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: hypervisor_id\n+          in: query\n+          description: The hypervisor IDs\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: fact\n+          in: query\n+          description: The consumer facts\n+          schema:\n+            type: array\n+            items:\n+              $ref: '#/components/schemas/KeyValueParamDTO'\n+        - name: sku\n+          in: query\n+          description: The list of skus\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: subscription_id\n+          in: query\n+          description: The list of subscription IDs\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: contract\n+          in: query\n+          description: The list of contract numbers\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+      security: []\n+      responses:\n+        200:\n+          description: Consumers successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                type: array\n+                items:\n+                  $ref: '#/components/schemas/ConsumerDTOArrayElement'\n+        400:\n+          description: Owner key is null or empty\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Owner key is null or empty\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/consumers/count:\n+    get:\n+      description: Retrieves a count of consumers for the owner\n+      tags:\n+        - Owner\n+        - Consumer\n+      operationId: countConsumers\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+        - name: type\n+          in: query\n+          description: type\n+          schema:\n+            type: array\n+            uniqueItems: true\n+            items:\n+              type: string\n+        - name: sku\n+          in: query\n+          description: sku\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: subscription_id\n+          in: query\n+          description: subscription_id\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: contract\n+          in: query\n+          description: contract\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+      security: []\n+      responses:\n+        200:\n+          description: Consumer counts successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                type: integer\n+        400:\n+          description: Owner key is null or empty\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Owner key is null or empty\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/consumers_system_purpose:\n+    get:\n+      description: Retrieves an aggregate of the system purpose settings of the owner's consumers\n+      tags:\n+        - Owner\n+        - Consumer\n+      operationId: getConsumersSyspurpose\n+      security: []\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+      responses:\n+        200:\n+          description:  The system purpose settings sucessfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/SystemPurposeAttributesDTO'\n+        400:\n+          description: Owner key is null or empty\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Owner key is null or empty\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: Owner key could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Owner key could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/entitlements:\n+    get:\n+      description: |\n+        Retrieves the list of entitlements for an owner.\n+        This endpoint supports paging with query parameters. For more details please visit\n+        https://www.candlepinproject.org/docs/candlepin/pagination.html#paginating-results-from-candlepin\n+      tags:\n+        - Owner\n+        - Entitlements\n+      operationId: ownerEntitlements\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+        - name: product\n+          in: query\n+          description: The product id\n+          schema:\n+            type: string\n+        - name: matches\n+          in: query\n+          description: Matches\n+          schema:\n+            type: string\n+        - name: attribute\n+          in: query\n+          description: The pair of attribute values\n+          schema:\n+            type: array\n+            items:\n+              $ref: '#/components/schemas/KeyValueParamDTO'\n+      security: []\n+      responses:\n+        200:\n+          description: Entitlement details successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                type: array\n+                items:\n+                  $ref: '#/components/schemas/EntitlementDTO'\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+    post:\n+      description: |\n+        Starts an asynchronous healing for the given Owner.\n+        At the end of the process the idea is that all of the consumers\n+        in the owned by the owner will be up to date.\n+      tags:\n+        - Owner\n+        - Entitlements\n+      operationId: healEntire\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+      security: []\n+      responses:\n+        200:\n+          description: Successfully operation\n+          content:\n+            application/json:\n+              schema:\n+               $ref: '#/components/schemas/AsyncJobStatusDTO'\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/environments:\n+    get:\n+      description: Retrieves a list of environment for an owner\n+      tags:\n+        - Owner Environment\n+      operationId: listEnvironments\n+      x-java-response:\n+        type: Iterable\n+        isContainer: true\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+        - name: name\n+          in: query\n+          description: The name of the environment\n+          schema:\n+            type: string\n+      security: []\n+      responses:\n+        200:\n+          description: Activation keys successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                type: array\n+                items:\n+                  $ref: '#/components/schemas/EnvironmentDTO'\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+    post:\n+      description: Creates an environment for the owner\n+      tags:\n+        - Owner Environment\n+      operationId: createEnv\n+      security: []\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+      requestBody:\n+        description: Environment to be created\n+        required: true\n+        content:\n+          application/json:\n+            schema:\n+              $ref: '#/components/schemas/EnvironmentDTO'\n+      responses:\n+        200:\n+          description: Environment for the owner successfully created\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/EnvironmentDTO'\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/hypervisors:\n+    get:\n+      description: Retrieves a list of hypervisors for an owner\n+      tags:\n+        - Owner\n+        - Hypervisors\n+      operationId: getHypervisors\n+      security: []\n+      x-java-response:\n+        type: Iterable\n+        isContainer: true\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+        - name: hypervisor_id\n+          in: query\n+          description: The list of hypervisor Ids\n+          required: true\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+      responses:\n+        200:\n+          description: A list of hypervisors successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ConsumerDTOArrayElement'\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/imports:\n+    get:\n+      description: Retrieves a list of import records for an owner\n+      tags:\n+        - Owner Import\n+      operationId: getImports\n+      security: []\n+      x-java-response:\n+        type: Iterable\n+        isContainer: true\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+      responses:\n+        200:\n+          description: Import records successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ImportRecordDTO'\n+        400:\n+          description: Owner key is null or empty\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Owner key is null or empty\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: An import owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An import owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+    post:\n+      description: |\n+        Imports a manifest zip file for the given organization.\n+        This will bring in any products, content, and subscriptions that were\n+        assigned to the distributor who generated the manifest.\n+      tags:\n+        - Owner Import\n+      operationId: importManifest\n+      security: []\n+      requestBody:\n+        description: A manifest file to be imported\n+        required: true\n+        content:\n+          multipart/form-data:\n+            schema:\n+              properties:\n+                input:\n+                  type: string\n+                  format: binary\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+        - name: force\n+          in: query\n+          description: This is used to override the conflicts\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+      responses:\n+        200:\n+          description: Manifest successfully imported\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ImportRecordDTO'\n+        400:\n+          description: |\n+            Bad request error. Reasons could be,\n+            Owner key is null\n+            or empty or Unknown conflict to force\n+            or format error of the data in a manifest\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: |\n+                  Bad request error. Reasons could be,\n+                  Owner key is null\n+                  or empty or Unknown conflict to force\n+                  or format error of the data in a manifest\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: An import owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An import owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        500:\n+          description: |\n+            Internal server error. Reasons could be,\n+            Reading error during importing\n+            or problem with archive\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: |\n+                  Internal server error. Reasons could be,\n+                  Reading error during importing\n+                  or problem with archive\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+    delete:\n+      description: |\n+        Removes Imports for an Owner. Cleans out all imported subscriptions\n+        and triggers a background refresh pools. Link to an upstream distributor is\n+        removed for the owner, so they can import from another distributor. Other\n+        owners can also now import the manifests originally used in this owner. This\n+        call does not differentiate between any specific import, it just destroys all\n+        subscriptions with an upstream pool ID, essentially anything from an import.\n+        Custom subscriptions will be left alone. Imports do carry rules and product\n+        information which is global to the candlepin server. This import data is *not*\n+        undone, we assume that updates to this data can be safely kept.\n+      tags:\n+        - Owner Import\n+      operationId: undoImports\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+      security: [ ]\n+      responses:\n+        200:\n+          description: Imports for an Owner successfully removed\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/AsyncJobStatusDTO'\n+        404:\n+          description: An import owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An import owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/imports/async:\n+    post:\n+      description: |\n+        Initiates an asynchronous manifest import for the given organization.\n+        This will bring in any products, content, and subscriptions that were\n+        assigned to the distributor who generated the manifest.\n+      tags:\n+        - Owner Import\n+        - Async\n+      operationId: importManifestAsync\n+      security: []\n+      requestBody:\n+        description: A manifest file to be imported\n+        required: true\n+        content:\n+          multipart/form-data:\n+            schema:\n+              properties:\n+                input:\n+                  type: string\n+                  format: binary\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+        - name: force\n+          in: query\n+          description: This is used to override the conflicts\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+      responses:\n+        200:\n+          description: Manifest successfully imported\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/AsyncJobStatusDTO'\n+        400:\n+          description: Owner key is null or empty\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Owner key is null or empty\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: An import owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An import owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        500:\n+          description: |\n+            Internal server error. Reasons could be,\n+            An unexpected exception occurred while scheduling job\n+            or error reading export archive\n+            or error storing uploaded archive for asynchronous processing\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: |\n+                  Internal server error. Reasons could be,\n+                  An unexpected exception occurred while scheduling job\n+                  or error reading export archive\n+                  or error storing uploaded archive for asynchronous processing\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/info:\n+    get:\n+      description: Retrieves the Owner Info for an Owner\n+      tags:\n+        - Owner\n+      operationId: getOwnerInfo\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+      security: []\n+      responses:\n+        200:\n+          description: Owner info successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/OwnerInfoDTO'\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/log:\n+    put:\n+      description: Sets the log level for an owner\n+      tags:\n+        - Owner log\n+      operationId: setLogLevel\n+      security: []\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+        - name: level\n+          in: query\n+          description: The log level\n+          required: true\n+          schema:\n+            type: string\n+            default: DEBUG\n+            enum:\n+              - ALL\n+              - TRACE\n+              - DEBUG\n+              - INFO\n+              - WARN\n+              - ERROR\n+              - OFF\n+      responses:\n+        200:\n+          description: Log level successfully set\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/OwnerDTO'\n+        400:\n+          description: |\n+            Provided level is not a valid log level\n+            or owner key is not provided\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: |\n+                  Provided level is not a valid log level\n+                  or owner key is not provided\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+    delete:\n+      description: Remove the log level of an owner\n+      tags:\n+        - Owner log\n+      operationId: deleteLogLevel\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The owner key\n+          required: true\n+          schema:\n+            type: string\n+      security: []\n+      responses:\n+        200:", "originalCommit": "124481e63a503a414f4f563dbc2821e11a8a4498", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzc4OTIyOA==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r487789228", "bodyText": "Changed the response code to 204.", "author": "sonalidhome", "createdAt": "2020-09-14T09:52:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzcxNDM2Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzcxNjcwMw==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r487716703", "bodyText": "Please remove ? special character from description here & add meaningful description.", "author": "wolfdale", "createdAt": "2020-09-14T07:50:00Z", "path": "api/candlepin-api-spec.yaml", "diffHunk": "@@ -2691,347 +4315,435 @@ paths:\n           required: true\n           schema:\n             type: string\n-        - name: lazy_regen\n-          in: query\n-          description: Lazy regeneration\n-          required: true\n-          schema:\n-            type: boolean\n-            default: true\n+      requestBody:\n+        description: Content map\n+        required: true\n+        content:\n+          application/json:\n+            schema:\n+              type: object\n+              additionalProperties:\n+                type: boolean\n       responses:\n         200:\n-          description: A successful operation\n+          description: Content added to a product\n           content:\n             application/json:\n               schema:\n-                $ref: '#/components/schemas/AsyncJobStatusDTO'\n+                $ref: '#/components/schemas/ProductDTO'\n         400:\n-          description: Unable to fulfill refresh pools request\n+          description: Invalid inputs, unable to add content\n           content:\n             application/json:\n               schema:\n                 $ref: '#/components/schemas/ExceptionMessage'\n               example:\n-                displayMessage: Unable to fulfill refresh pools request\n+                displayMessage: Invalid inputs, unable to add content\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        403:\n+          description: Product is locked. Unable to add content\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Product is locked. Unable to add content\n                 requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n         404:\n-          description: Owner key or product ID could not be found\n+          description: Owner key could not be found\n           content:\n             application/json:\n               schema:\n                 $ref: '#/components/schemas/ExceptionMessage'\n               example:\n-                displayMessage: Owner key or product ID could not be found\n+                displayMessage: Owner key could not be found\n                 requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n         default:\n           $ref: '#/components/responses/default'\n \n-  /owners/{owner_key}/products/{product_id}/certificate:\n-    get:\n-      description: Retrieves a product certificate for an owner\n+    delete:\n+      description: Removes content from a product in batch\n       tags:\n         - Owner Product\n-      operationId: getProductCertificateByOwner\n+      operationId: removeBatchContent\n       security: []\n       parameters:\n-        - name: owner_key\n-          in: path\n+        - in: path\n+          name: owner_key\n           description: Owner key\n           required: true\n           schema:\n             type: string\n-        - name: product_id\n-          in: path\n+        - in: path\n+          name: product_id\n           description: Product ID\n           required: true\n           schema:\n             type: string\n+      requestBody:\n+        description: Content IDs\n+        required: true\n+        content:\n+          application/json:\n+            schema:\n+              type: array\n+              items:\n+                type: string\n       responses:\n         200:\n-          description: Retrieves a product certificate for an owner\n+          description: Content removed from a product\n           content:\n             application/json:\n               schema:\n-                $ref: '#/components/schemas/ProductCertificateDTO'\n+                $ref: '#/components/schemas/ProductDTO'\n         400:\n-          description: Only numeric product IDs are allowed\n+          description: Invalid inputs, unable to remove content\n           content:\n             application/json:\n               schema:\n                 $ref: '#/components/schemas/ExceptionMessage'\n               example:\n-                displayMessage: Only numeric product IDs are allowed\n+                displayMessage: Invalid inputs, unable to remove content\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        403:\n+          description: Product is locked. Unable to remove content\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Product is locked. Unable to remove content\n                 requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n         404:\n-          description: Owner key or product ID could not be found\n+          description: Owner key could not be found\n           content:\n             application/json:\n               schema:\n                 $ref: '#/components/schemas/ExceptionMessage'\n               example:\n-                displayMessage: Owner key or product ID could not be found\n+                displayMessage: Owner key could not be found\n                 requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n         default:\n           $ref: '#/components/responses/default'\n \n-  /owners/{owner_key}/products/{product_id}/content/{content_id}:\n-    post:\n-      description: Adds content to a product\n+  /owners/{owner_key}/servicelevels:\n+    get:\n+      description: Retrieves a list of support levels for an owner\n       tags:\n-        - Owner Product\n-      operationId: addContent\n+        - Owner\n+      operationId: ownerServiceLevels\n       security: []\n+      x-java-response:\n+        type: Iterable\n+        isContainer: true\n       parameters:\n         - name: owner_key\n           in: path\n-          description: Owner key\n+          description: The key of the owner\n           required: true\n           schema:\n             type: string\n-        - name: product_id\n-          in: path\n-          description: Product ID\n-          required: true\n+        - name: exempt\n+          in: query\n+          description: exempt\n           schema:\n             type: string\n-        - name: content_id\n+            default: false\n+      responses:\n+        200:\n+          description:  A list of support levels for an owner\n+          content:\n+            application/json:\n+              schema:\n+                type: array\n+                items:\n+                  type: string\n+        400:\n+          description: Owner key is null or empty\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Owner key is null or empty\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: Owner key could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Owner key could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/subscriptions:\n+    get:\n+      description: Retrieves a list of subscriptions for an owner\n+      tags:\n+        - Owner Subscription\n+      operationId: getOwnerSubscriptions\n+      security: []\n+      x-java-response:\n+        type: Iterable\n+        isContainer: true\n+      parameters:\n+        - name: owner_key\n           in: path\n-          description: Content ID\n+          description: The key of the owner\n           required: true\n           schema:\n             type: string\n-        - name: enabled\n-          in: path\n-          description: Content enabled flag\n-          required: true\n-          schema:\n-            type: boolean\n       responses:\n         200:\n-          description: Content added to a product\n+          description:  A list of subscriptions for an owner\n           content:\n             application/json:\n               schema:\n-                $ref: '#/components/schemas/ProductDTO'\n+                type: array\n+                items:\n+                  $ref: '#/components/schemas/SubscriptionDTO'\n         400:\n-          description: Invalid inputs, unable to add content\n+          description: Owner key is null or empty\n           content:\n             application/json:\n               schema:\n                 $ref: '#/components/schemas/ExceptionMessage'\n               example:\n-                displayMessage: Invalid inputs, unable to add content\n+                displayMessage: Owner key is null or empty\n                 requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n-        403:\n-          description: Product is locked. Unable to add content\n+        404:\n+          description: Owner key could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Owner key could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+    put:\n+      description: |\n+        Tickle an owner to have all of their entitlement pools synced with their\n+        subscriptions. This method (and the one below may not be entirely RESTful,\n+        as the updated data is not supplied as an argument.\n+        This API call is only relevant in a top level hosted deployment where\n+        subscriptions and products are sourced from adapters. Calling this in\n+        an on-site deployment is just a no-op.\n+      tags:\n+        - Owner Subscription\n+      operationId: refreshPools\n+      security: []\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+        - name: auto_create_owner\n+          in: query\n+          description: Auto create owner?", "originalCommit": "124481e63a503a414f4f563dbc2821e11a8a4498", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzc4OTM2NA==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r487789364", "bodyText": "Updated the description.", "author": "sonalidhome", "createdAt": "2020-09-14T09:52:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzcxNjcwMw=="}], "type": "inlineReview"}, {"oid": "2291bcef60feb15433dc118fe8e428f99b507bac", "url": "https://github.com/candlepin/candlepin/commit/2291bcef60feb15433dc118fe8e428f99b507bac", "message": "ENT-1848: Port OwnerResource to spec-first\n - Added endpoints definitions\n - Added specifications for following DTOs\n   1. AbstractCertificateDTO\n   2. ConsumptionTypeCountsDTO\n   3. ImportRecordDTO\n   4. ImportUpstreamConsumerDTO\n   5. OwnerInfoDTO\n   6. SystemPurposeAttributesDTO\n   7. UeberCertificateDTO\n   8. UpstreamConsumerArrayElement\n - Created/updated translators for DTOs\n - Moved some of the access related tests from Junit to Rspec.\n   Junits did not invoke the VerifyAuthorizationFilter\n   when endpoint is ported into OpenAPI.", "committedDate": "2020-09-14T09:49:08Z", "type": "forcePushed"}, {"oid": "f41bd9062eac655526cd4d7a45db7f7c7fd4188e", "url": "https://github.com/candlepin/candlepin/commit/f41bd9062eac655526cd4d7a45db7f7c7fd4188e", "message": "ENT-1848: Port OwnerResource to spec-first\n - Added endpoints definitions\n - Added specifications for following DTOs\n   1. AbstractCertificateDTO\n   2. ConsumptionTypeCountsDTO\n   3. ImportRecordDTO\n   4. ImportUpstreamConsumerDTO\n   5. OwnerInfoDTO\n   6. SystemPurposeAttributesDTO\n   7. UeberCertificateDTO\n   8. UpstreamConsumerArrayElement\n - Created/updated translators for DTOs", "committedDate": "2020-09-24T08:05:48Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDMzODA3NQ==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r494338075", "bodyText": "Let's use this as an opportunity to rename OwnerInfo to not that. OwnerStatistics would be a better fit here", "author": "Ceiu", "createdAt": "2020-09-24T13:53:23Z", "path": "server/src/main/java/org/candlepin/dto/api/v1/OwnerInfoDTOTranslator.java", "diffHunk": "@@ -0,0 +1,91 @@\n+/**\n+ * Copyright (c) 2009 - 2020 Red Hat, Inc.\n+ *\n+ * This software is licensed to you under the GNU General Public License,\n+ * version 2 (GPLv2). There is NO WARRANTY for this software, express or\n+ * implied, including the implied warranties of MERCHANTABILITY or FITNESS\n+ * FOR A PARTICULAR PURPOSE. You should have received a copy of GPLv2\n+ * along with this software; if not, see\n+ * http://www.gnu.org/licenses/old-licenses/gpl-2.0.txt.\n+ *\n+ * Red Hat trademarks are not licensed under GPLv2. No permission is\n+ * granted to use or replicate Red Hat trademarks that are incorporated\n+ * in this software or its documentation.\n+ */\n+\n+package org.candlepin.dto.api.v1;\n+\n+import org.candlepin.dto.ModelTranslator;\n+import org.candlepin.dto.ObjectTranslator;\n+import org.candlepin.model.OwnerInfo;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+/**\n+ * The OwnerInfoDTOTranslator provides translation from\n+ * OwnerInfo model objects to OwnerInfoDTO\n+ */\n+public class OwnerInfoDTOTranslator implements ObjectTranslator<OwnerInfo, OwnerInfoDTO> {", "originalCommit": "f41bd9062eac655526cd4d7a45db7f7c7fd4188e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDMzOTM0OA==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r494339348", "bodyText": "Also, so it's clear: OwnerInfo as it exists today, is not a model object. It's a DTO that happens to live in the model package. I'm not sure if there is a need to have a separate DTO layer for what is already a DTO; so we may be able to eliminate the translator entirely. Perhaps this could be something discussed with the whole team.", "author": "Ceiu", "createdAt": "2020-09-24T13:55:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDMzODA3NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDkyNDQyNQ==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r494924425", "bodyText": "It looks like there's only 1 endpoint that uses OwnerInfo as output, and ideally we wouldn't need a translator (we'd just change OwnerInfoCurator.getByOwner to populate the OwnerInfoDTO that is defined in yaml), but the problem is that OwnerInfo is not just a DTO, and has a lot of add*() methods that contain logic (and yaml-defined DTOs can't be easily altered to contain additional methods with extra logic).\nOne solution about eliminating the translator entirely would be to use the builder pattern here, by creating an OwnerInfoBuilder that will own all these add*() methods and accumulate the data, and when we're done we'd call .build() which would return an OwnerInfoDTO.", "author": "nikosmoum", "createdAt": "2020-09-25T11:27:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDMzODA3NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQ1OTE4NA==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r496459184", "bodyText": "Updated the code to build OwnerInfo from OwnerInfoBuilder.", "author": "sonalidhome", "createdAt": "2020-09-29T06:56:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDMzODA3NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjYwOTY2OA==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r496609668", "bodyText": "ack from me", "author": "nikosmoum", "createdAt": "2020-09-29T10:27:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDMzODA3NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDM0MDI5Mw==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r494340293", "bodyText": "You'll probably need to add updated/created here as well, if we're going to be not using the certificate translator hierarchy.", "author": "Ceiu", "createdAt": "2020-09-24T13:56:10Z", "path": "server/src/main/java/org/candlepin/dto/api/v1/UeberCertificateTranslator.java", "diffHunk": "@@ -58,14 +59,26 @@ public UeberCertificateDTO populate(UeberCertificate source, UeberCertificateDTO\n     public UeberCertificateDTO populate(ModelTranslator translator, UeberCertificate source,\n         UeberCertificateDTO dest) {\n \n-        dest = super.populate(translator, source, dest);\n+        if (source == null) {\n+            throw new IllegalArgumentException(\"source is null\");\n+        }\n+\n+        if (dest == null) {\n+            throw new IllegalArgumentException(\"dest is null\");\n+        }\n+\n+        dest.id(source.getId())", "originalCommit": "f41bd9062eac655526cd4d7a45db7f7c7fd4188e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDg4MDc0Mw==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r494880743", "bodyText": "Added these fields.", "author": "sonalidhome", "createdAt": "2020-09-25T09:56:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDM0MDI5Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDM0MzUxMQ==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r494343511", "bodyText": "We might not need this anymore with the removal of so many of the inline annotations.", "author": "Ceiu", "createdAt": "2020-09-24T13:59:40Z", "path": "server/src/main/java/org/candlepin/resource/OwnerResource.java", "diffHunk": "@@ -1498,86 +1248,48 @@ public void deleteLogLevel(@PathParam(\"owner_key\") String ownerKey) {\n         return translator.translateQuery(query, ConsumerDTOArrayElement.class);\n     }\n \n-    @GET\n-    @Produces(MediaType.APPLICATION_JSON)\n-    @Path(\"{owner_key}/consumers/count\")\n     @SuppressWarnings(\"checkstyle:indentation\")\n-    @ApiOperation(notes = \"Retrieve a count of Consumers for the Owner\", value = \"consumers count\")\n-    @ApiResponses({\n-        @ApiResponse(code = 404, message = \"Owner not found\"),\n-        @ApiResponse(code = 400, message = \"Invalid request\")\n-    })\n-    public int countConsumers(\n-        @PathParam(\"owner_key\")\n+    @Override\n+    public Integer countConsumers(\n         @Verify(value = Owner.class, subResource = SubResource.CONSUMERS) String ownerKey,\n-        @QueryParam(\"type\") Set<String> typeLabels,\n-        @QueryParam(\"sku\") List<String> skus,\n-        @QueryParam(\"subscription_id\") List<String> subscriptionIds,\n-        @QueryParam(\"contract\") List<String> contracts) {\n+        Set<String> typeLabels,\n+        List<String> skus,\n+        List<String> subscriptionIds,\n+        List<String> contracts) {\n \n         this.findOwnerByKey(ownerKey);\n         consumerTypeValidator.findAndValidateTypeLabels(typeLabels);\n \n         return consumerCurator.countConsumers(ownerKey, typeLabels, skus, subscriptionIds, contracts);\n     }\n \n-    /**\n-     * Retrieves a list of Pools for an Owner\n-     *\n-     * @param ownerKey id of the owner whose entitlement pools are sought.\n-     * @param matches Find pools matching the given pattern in a variety of fields.\n-     * * and ? wildcards are supported.\n-     * @return a list of Pool objects\n-     * @httpcode 400\n-     * @httpcode 404\n-     * @httpcode 200\n-     */\n+    @Override\n     @Transactional\n-    @GET\n-    @Produces(MediaType.APPLICATION_JSON)\n-    @Path(\"{owner_key}/pools\")\n     @SuppressWarnings(\"checkstyle:indentation\")", "originalCommit": "f41bd9062eac655526cd4d7a45db7f7c7fd4188e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDg4MDcyNQ==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r494880725", "bodyText": "Removed.", "author": "sonalidhome", "createdAt": "2020-09-25T09:56:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDM0MzUxMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDM0NTg1OQ==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r494345859", "bodyText": "I'd have to go back and look, but did we add a DTO for Subscription? Subscription is already a DTO.\nAdditionally, rather than converting twice, since we only use fabricateSubscriptionFromPool in the resources to convert a pool to a subscription, we could/should just write a translator that explicitly handles the translation from Pool to Subscription[DTO] and use that instead.", "author": "Ceiu", "createdAt": "2020-09-24T14:02:35Z", "path": "server/src/main/java/org/candlepin/resource/OwnerResource.java", "diffHunk": "@@ -1655,125 +1367,28 @@ public int countConsumers(\n         return poolDTOs;\n     }\n \n-    /**\n-     * Retrieves a list of Subscriptions for an Owner\n-     *\n-     * @return a list of Subscription objects\n-     * @httpcode 404\n-     * @httpcode 200\n-     */\n-    @GET\n-    @Consumes(MediaType.APPLICATION_JSON)\n-    @Produces(MediaType.APPLICATION_JSON)\n-    @Path(\"{owner_key}/subscriptions\")\n-    @ApiOperation(notes = \"Retrieves a list of Subscriptions for an Owner\", value = \"List Subscriptions\")\n-    @ApiResponses({ @ApiResponse(code = 404, message = \"Owner not found\") })\n-    public List<Subscription> getSubscriptions(@PathParam(\"owner_key\") String ownerKey) {\n+    @Override\n+    public List<SubscriptionDTO> getOwnerSubscriptions(String ownerKey) {\n         Owner owner = this.findOwnerByKey(ownerKey);\n \n-        List<Subscription> subscriptions = new LinkedList<>();\n+        List<SubscriptionDTO> subscriptions = new LinkedList<>();\n \n         for (Pool pool : this.poolManager.listPoolsByOwner(owner).list()) {\n-            SourceSubscription srcsub = pool.getSourceSubscription();\n \n+            SourceSubscription srcsub = pool.getSourceSubscription();\n             if (srcsub != null && \"master\".equalsIgnoreCase(srcsub.getSubscriptionSubKey())) {\n-                subscriptions.add(this.poolManager.fabricateSubscriptionFromPool(pool));\n+                subscriptions.add(this.translator.translate(\n+                    this.poolManager.fabricateSubscriptionFromPool(pool),", "originalCommit": "f41bd9062eac655526cd4d7a45db7f7c7fd4188e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDg3NTUyNg==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r494875526", "bodyText": "We added a SubscriptionDTO when porting the SubscriptionResource to OpenApi (and it looks like we also do the double conversion there). We can't help not redefining it since everything that is part of the API has to be defined in the yaml file. I agree with creating a Pool to SubscriptionDTO translator, and getting rid of the SubscriptionTranslator and the fabricateSubscriptionFromPool method.", "author": "nikosmoum", "createdAt": "2020-09-25T09:46:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDM0NTg1OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDg4MDY5NA==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r494880694", "bodyText": "This was updated as per the previous changes done in PR: #2674.", "author": "sonalidhome", "createdAt": "2020-09-25T09:56:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDM0NTg1OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQ1ODc1OQ==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r496458759", "bodyText": "Updated the code to translate from Pool to SubscriptionDTO.", "author": "sonalidhome", "createdAt": "2020-09-29T06:56:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDM0NTg1OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDM0ODgwMg==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r494348802", "bodyText": "Our mappers already handle converting exceptions to the generic \"internal server error\" if they're not caught. If we don't have explicit error handling to perform, or some other behavior to improve the output for clients. Additionally, the declaration and translation of the job can only happen if the queuing of the job succeeds, so there is no reason to declare the job or perform translation outside the try/catch block.\nIs there some behavior change with OpenAPI that I'm not aware of? What's the intent here?", "author": "Ceiu", "createdAt": "2020-09-24T14:06:23Z", "path": "server/src/main/java/org/candlepin/resource/OwnerResource.java", "diffHunk": "@@ -1794,30 +1409,23 @@ public AsyncJobStatusDTO refreshPools(\n             .setOwner(owner)\n             .setLazyRegeneration(lazyRegen);\n \n-        AsyncJobStatus job = this.jobManager.queueJob(config);\n+        AsyncJobStatus job;\n+\n+        try {\n+            job = this.jobManager.queueJob(config);\n+        }\n+        catch (JobException e) {\n+            String errmsg = this.i18n.tr(\"An unexpected exception occurred while scheduling job \\\"{0}\\\"\",\n+                config.getJobKey());\n+            log.error(errmsg, e);\n+            throw new IseException(errmsg, e);", "originalCommit": "f41bd9062eac655526cd4d7a45db7f7c7fd4188e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDg4MDY3MA==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r494880670", "bodyText": "As already discussed in PR: #2692 (comment). We need to explicitly throw an exception because the auto-generated method does not throws an exception.", "author": "sonalidhome", "createdAt": "2020-09-25T09:56:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDM0ODgwMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDM0OTYyMQ==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r494349621", "bodyText": "Same questions here", "author": "Ceiu", "createdAt": "2020-09-24T14:07:36Z", "path": "server/src/main/java/org/candlepin/resource/OwnerResource.java", "diffHunk": "@@ -2002,42 +1559,28 @@ public AsyncJobStatusDTO undoImports(\n         JobConfig config = UndoImportsJob.createJobConfig()\n             .setOwner(owner);\n \n-        AsyncJobStatus job = this.jobManager.queueJob(config);\n+        AsyncJobStatus job;", "originalCommit": "f41bd9062eac655526cd4d7a45db7f7c7fd4188e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDg4MDY0Mg==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r494880642", "bodyText": "The auto-generated method does not throws an exception.", "author": "sonalidhome", "createdAt": "2020-09-25T09:55:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDM0OTYyMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDM0OTg3MA==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r494349870", "bodyText": "Same questions here", "author": "Ceiu", "createdAt": "2020-09-24T14:07:58Z", "path": "server/src/main/java/org/candlepin/resource/OwnerResource.java", "diffHunk": "@@ -2121,7 +1637,17 @@ public AsyncJobStatusDTO importManifestAsync(\n             JobConfig config =  manifestManager.importManifestAsync(owner, fileData.getData(),\n                 fileData.getUploadedFilename(), overrides);\n \n-            AsyncJobStatus job = this.jobManager.queueJob(config);\n+            AsyncJobStatus job;", "originalCommit": "f41bd9062eac655526cd4d7a45db7f7c7fd4188e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDg4MDYyMw==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r494880623", "bodyText": "The auto-generated method does not throws an exception.", "author": "sonalidhome", "createdAt": "2020-09-25T09:55:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDM0OTg3MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzY4MzY3MA==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r493683670", "bodyText": "created/updated fields also need to be translated here", "author": "nikosmoum", "createdAt": "2020-09-23T15:24:37Z", "path": "server/src/main/java/org/candlepin/dto/api/v1/UeberCertificateTranslator.java", "diffHunk": "@@ -58,14 +59,26 @@ public UeberCertificateDTO populate(UeberCertificate source, UeberCertificateDTO\n     public UeberCertificateDTO populate(ModelTranslator translator, UeberCertificate source,\n         UeberCertificateDTO dest) {\n \n-        dest = super.populate(translator, source, dest);\n+        if (source == null) {\n+            throw new IllegalArgumentException(\"source is null\");\n+        }\n+\n+        if (dest == null) {\n+            throw new IllegalArgumentException(\"dest is null\");\n+        }\n+\n+        dest.id(source.getId())\n+            .key(source.getKey())\n+            .cert(source.getCert());", "originalCommit": "2291bcef60feb15433dc118fe8e428f99b507bac", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDI2NjUzNg==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r494266536", "bodyText": "It's just one key, so we can remove the s in the end", "author": "nikosmoum", "createdAt": "2020-09-24T12:16:51Z", "path": "api/candlepin-api-spec.yaml", "diffHunk": "@@ -2524,6 +2524,309 @@ paths:\n         default:\n           $ref: '#/components/responses/default'\n \n+  /owners:\n+    get:\n+      description: Retrieves a list of owners\n+      tags:\n+        - Owner\n+      operationId: listOwners\n+      x-java-response:\n+        type: Iterable\n+        isContainer: true\n+      parameters:\n+        - name: key\n+          in: query\n+          description: The owner keys", "originalCommit": "f41bd9062eac655526cd4d7a45db7f7c7fd4188e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDg4MDU4Nw==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r494880587", "bodyText": "Done.", "author": "sonalidhome", "createdAt": "2020-09-25T09:55:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDI2NjUzNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDI2NzI2Ng==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r494267266", "bodyText": "Let's improve this one by adding ..that match the key provided, or all owners if no key was provided", "author": "nikosmoum", "createdAt": "2020-09-24T12:17:58Z", "path": "api/candlepin-api-spec.yaml", "diffHunk": "@@ -2524,6 +2524,309 @@ paths:\n         default:\n           $ref: '#/components/responses/default'\n \n+  /owners:\n+    get:\n+      description: Retrieves a list of owners", "originalCommit": "f41bd9062eac655526cd4d7a45db7f7c7fd4188e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDg4MDU3Mw==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r494880573", "bodyText": "Done.", "author": "sonalidhome", "createdAt": "2020-09-25T09:55:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDI2NzI2Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDI5MzU2OA==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r494293568", "bodyText": "We should also add a 404 response here, in case the owner is not found based on the given key", "author": "nikosmoum", "createdAt": "2020-09-24T12:55:28Z", "path": "api/candlepin-api-spec.yaml", "diffHunk": "@@ -2524,6 +2524,309 @@ paths:\n         default:\n           $ref: '#/components/responses/default'\n \n+  /owners:\n+    get:\n+      description: Retrieves a list of owners\n+      tags:\n+        - Owner\n+      operationId: listOwners\n+      x-java-response:\n+        type: Iterable\n+        isContainer: true\n+      parameters:\n+        - name: key\n+          in: query\n+          description: The owner keys\n+          required: false\n+          schema:\n+            type: string\n+      security: []\n+      responses:\n+        200:\n+          description: A list of owners\n+          content:\n+            application/json:\n+              schema:\n+                type: array\n+                items:\n+                  $ref: '#/components/schemas/OwnerDTO'\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+    post:\n+      description: Creates an owner\n+      tags:\n+        - Owner\n+      operationId: createOwner\n+      security: []\n+      requestBody:\n+        description: Owner to be created\n+        required: true\n+        content:\n+          application/json:\n+            schema:\n+              $ref: '#/components/schemas/OwnerDTO'\n+      responses:\n+        200:\n+          description: Owner successfully created\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/OwnerDTO'\n+        400:\n+          description: |\n+            Invalid inputs, Owner cannot be created.\n+            Reasons could be, invalid key\n+            or the default service level is specified\n+            or the owner content access mode and content access mode list cannot be set directly in standalone mode\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: |\n+                  Invalid inputs, Owner cannot be created.\n+                  Reasons could be, invalid key\n+                  or the default service level is specified\n+                  or the owner content access mode and content access mode list cannot be set directly in standalone mode\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}:\n+    get:\n+      description: Retrieves a single owner\n+      tags:\n+        - Owner\n+      operationId: getOwner\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+      security: []\n+      responses:\n+        200:\n+          description: Owner successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/OwnerDTO'\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+    put:\n+      description: |\n+        Updates an owner.\n+        Note: To un-set the defaultServiceLevel for an owner, submit an empty string.\n+      tags:\n+        - Owner\n+      operationId: updateOwner\n+      security: []\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+      requestBody:\n+        description: Owner to be updated\n+        required: true\n+        content:\n+          application/json:\n+            schema:\n+              $ref: '#/components/schemas/OwnerDTO'\n+      responses:\n+        200:\n+          description: Owner successfully updated\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/OwnerDTO'\n+        400:", "originalCommit": "f41bd9062eac655526cd4d7a45db7f7c7fd4188e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDg4MDU2MQ==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r494880561", "bodyText": "Added.", "author": "sonalidhome", "createdAt": "2020-09-25T09:55:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDI5MzU2OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDI5NDg2NQ==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r494294865", "bodyText": "This line should be removed. The default service level can be specified when updating an owner (it can't only during owner creation)", "author": "nikosmoum", "createdAt": "2020-09-24T12:57:20Z", "path": "api/candlepin-api-spec.yaml", "diffHunk": "@@ -2524,6 +2524,309 @@ paths:\n         default:\n           $ref: '#/components/responses/default'\n \n+  /owners:\n+    get:\n+      description: Retrieves a list of owners\n+      tags:\n+        - Owner\n+      operationId: listOwners\n+      x-java-response:\n+        type: Iterable\n+        isContainer: true\n+      parameters:\n+        - name: key\n+          in: query\n+          description: The owner keys\n+          required: false\n+          schema:\n+            type: string\n+      security: []\n+      responses:\n+        200:\n+          description: A list of owners\n+          content:\n+            application/json:\n+              schema:\n+                type: array\n+                items:\n+                  $ref: '#/components/schemas/OwnerDTO'\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+    post:\n+      description: Creates an owner\n+      tags:\n+        - Owner\n+      operationId: createOwner\n+      security: []\n+      requestBody:\n+        description: Owner to be created\n+        required: true\n+        content:\n+          application/json:\n+            schema:\n+              $ref: '#/components/schemas/OwnerDTO'\n+      responses:\n+        200:\n+          description: Owner successfully created\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/OwnerDTO'\n+        400:\n+          description: |\n+            Invalid inputs, Owner cannot be created.\n+            Reasons could be, invalid key\n+            or the default service level is specified\n+            or the owner content access mode and content access mode list cannot be set directly in standalone mode\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: |\n+                  Invalid inputs, Owner cannot be created.\n+                  Reasons could be, invalid key\n+                  or the default service level is specified\n+                  or the owner content access mode and content access mode list cannot be set directly in standalone mode\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}:\n+    get:\n+      description: Retrieves a single owner\n+      tags:\n+        - Owner\n+      operationId: getOwner\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+      security: []\n+      responses:\n+        200:\n+          description: Owner successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/OwnerDTO'\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+    put:\n+      description: |\n+        Updates an owner.\n+        Note: To un-set the defaultServiceLevel for an owner, submit an empty string.\n+      tags:\n+        - Owner\n+      operationId: updateOwner\n+      security: []\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+      requestBody:\n+        description: Owner to be updated\n+        required: true\n+        content:\n+          application/json:\n+            schema:\n+              $ref: '#/components/schemas/OwnerDTO'\n+      responses:\n+        200:\n+          description: Owner successfully updated\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/OwnerDTO'\n+        400:\n+          description: |\n+            Invalid inputs, Owner cannot be updated.\n+            Reasons could be, invalid key\n+            or the default service level is specified\n+            or the owner content access mode and content access mode list cannot be set directly in standalone mode\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: |\n+                  Invalid inputs, Owner cannot be updated.\n+                  Reasons could be, invalid key\n+                  or the default service level is specified", "originalCommit": "f41bd9062eac655526cd4d7a45db7f7c7fd4188e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDg4MDU1MQ==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r494880551", "bodyText": "Done.", "author": "sonalidhome", "createdAt": "2020-09-25T09:55:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDI5NDg2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDI5NDk5NA==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r494294994", "bodyText": "Same here, remove the line", "author": "nikosmoum", "createdAt": "2020-09-24T12:57:33Z", "path": "api/candlepin-api-spec.yaml", "diffHunk": "@@ -2524,6 +2524,309 @@ paths:\n         default:\n           $ref: '#/components/responses/default'\n \n+  /owners:\n+    get:\n+      description: Retrieves a list of owners\n+      tags:\n+        - Owner\n+      operationId: listOwners\n+      x-java-response:\n+        type: Iterable\n+        isContainer: true\n+      parameters:\n+        - name: key\n+          in: query\n+          description: The owner keys\n+          required: false\n+          schema:\n+            type: string\n+      security: []\n+      responses:\n+        200:\n+          description: A list of owners\n+          content:\n+            application/json:\n+              schema:\n+                type: array\n+                items:\n+                  $ref: '#/components/schemas/OwnerDTO'\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+    post:\n+      description: Creates an owner\n+      tags:\n+        - Owner\n+      operationId: createOwner\n+      security: []\n+      requestBody:\n+        description: Owner to be created\n+        required: true\n+        content:\n+          application/json:\n+            schema:\n+              $ref: '#/components/schemas/OwnerDTO'\n+      responses:\n+        200:\n+          description: Owner successfully created\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/OwnerDTO'\n+        400:\n+          description: |\n+            Invalid inputs, Owner cannot be created.\n+            Reasons could be, invalid key\n+            or the default service level is specified\n+            or the owner content access mode and content access mode list cannot be set directly in standalone mode\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: |\n+                  Invalid inputs, Owner cannot be created.\n+                  Reasons could be, invalid key\n+                  or the default service level is specified\n+                  or the owner content access mode and content access mode list cannot be set directly in standalone mode\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}:\n+    get:\n+      description: Retrieves a single owner\n+      tags:\n+        - Owner\n+      operationId: getOwner\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+      security: []\n+      responses:\n+        200:\n+          description: Owner successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/OwnerDTO'\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+    put:\n+      description: |\n+        Updates an owner.\n+        Note: To un-set the defaultServiceLevel for an owner, submit an empty string.\n+      tags:\n+        - Owner\n+      operationId: updateOwner\n+      security: []\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+      requestBody:\n+        description: Owner to be updated\n+        required: true\n+        content:\n+          application/json:\n+            schema:\n+              $ref: '#/components/schemas/OwnerDTO'\n+      responses:\n+        200:\n+          description: Owner successfully updated\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/OwnerDTO'\n+        400:\n+          description: |\n+            Invalid inputs, Owner cannot be updated.\n+            Reasons could be, invalid key\n+            or the default service level is specified", "originalCommit": "f41bd9062eac655526cd4d7a45db7f7c7fd4188e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDg4MDU0Mw==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r494880543", "bodyText": "Done.", "author": "sonalidhome", "createdAt": "2020-09-25T09:55:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDI5NDk5NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDI5Nzg4Ng==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r494297886", "bodyText": "let's add a 404 response here in case no owner was found for the provided key", "author": "nikosmoum", "createdAt": "2020-09-24T13:02:01Z", "path": "api/candlepin-api-spec.yaml", "diffHunk": "@@ -2524,6 +2524,309 @@ paths:\n         default:\n           $ref: '#/components/responses/default'\n \n+  /owners:\n+    get:\n+      description: Retrieves a list of owners\n+      tags:\n+        - Owner\n+      operationId: listOwners\n+      x-java-response:\n+        type: Iterable\n+        isContainer: true\n+      parameters:\n+        - name: key\n+          in: query\n+          description: The owner keys\n+          required: false\n+          schema:\n+            type: string\n+      security: []\n+      responses:\n+        200:\n+          description: A list of owners\n+          content:\n+            application/json:\n+              schema:\n+                type: array\n+                items:\n+                  $ref: '#/components/schemas/OwnerDTO'\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+    post:\n+      description: Creates an owner\n+      tags:\n+        - Owner\n+      operationId: createOwner\n+      security: []\n+      requestBody:\n+        description: Owner to be created\n+        required: true\n+        content:\n+          application/json:\n+            schema:\n+              $ref: '#/components/schemas/OwnerDTO'\n+      responses:\n+        200:\n+          description: Owner successfully created\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/OwnerDTO'\n+        400:\n+          description: |\n+            Invalid inputs, Owner cannot be created.\n+            Reasons could be, invalid key\n+            or the default service level is specified\n+            or the owner content access mode and content access mode list cannot be set directly in standalone mode\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: |\n+                  Invalid inputs, Owner cannot be created.\n+                  Reasons could be, invalid key\n+                  or the default service level is specified\n+                  or the owner content access mode and content access mode list cannot be set directly in standalone mode\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}:\n+    get:\n+      description: Retrieves a single owner\n+      tags:\n+        - Owner\n+      operationId: getOwner\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+      security: []\n+      responses:\n+        200:\n+          description: Owner successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/OwnerDTO'\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+    put:\n+      description: |\n+        Updates an owner.\n+        Note: To un-set the defaultServiceLevel for an owner, submit an empty string.\n+      tags:\n+        - Owner\n+      operationId: updateOwner\n+      security: []\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+      requestBody:\n+        description: Owner to be updated\n+        required: true\n+        content:\n+          application/json:\n+            schema:\n+              $ref: '#/components/schemas/OwnerDTO'\n+      responses:\n+        200:\n+          description: Owner successfully updated\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/OwnerDTO'\n+        400:\n+          description: |\n+            Invalid inputs, Owner cannot be updated.\n+            Reasons could be, invalid key\n+            or the default service level is specified\n+            or the owner content access mode and content access mode list cannot be set directly in standalone mode\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: |\n+                  Invalid inputs, Owner cannot be updated.\n+                  Reasons could be, invalid key\n+                  or the default service level is specified\n+                  or the owner content access mode and content access mode list cannot be set directly in standalone mode\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+    delete:\n+      description: Removes an owner\n+      tags:\n+        - Owner\n+      operationId: deleteOwner\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The owner key\n+          required: true\n+          schema:\n+            type: string\n+        - name: revoke\n+          in: query\n+          description: Boolean value to revoke an owner\n+          schema:\n+            type: boolean\n+            default: true\n+        - name: force\n+          in: query\n+          description: Boolean value to forcefully delete an owner. This is not in use.\n+          schema:\n+            type: boolean\n+            default: false\n+      security: []\n+      responses:\n+        200:\n+          description: Owner successfully deleted\n+        409:", "originalCommit": "f41bd9062eac655526cd4d7a45db7f7c7fd4188e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDg4MDUzMQ==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r494880531", "bodyText": "Done.", "author": "sonalidhome", "createdAt": "2020-09-25T09:55:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDI5Nzg4Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDMyNTgyNg==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r494325826", "bodyText": "This is an async operation, so we're returning a job status. Let's describe this as The Owner is being healed", "author": "nikosmoum", "createdAt": "2020-09-24T13:41:02Z", "path": "api/candlepin-api-spec.yaml", "diffHunk": "@@ -2764,55 +3067,1142 @@ paths:\n         default:\n           $ref: '#/components/responses/default'\n \n-  /owners/{owner_key}/products:\n+  /owners/{owner_key}/consumers:\n     get:\n-      description: Retrieves a list of products by owner\n+      description: Retrieves a list of Consumers for the Owner\n       tags:\n-        - Owner Product\n-      operationId: getProductsByOwner\n-      security: []\n+        - Owner\n+        - Consumer\n+      operationId: listConsumers\n       x-java-response:\n         type: Iterable\n         isContainer: true\n       parameters:\n         - name: owner_key\n           in: path\n-          description: Owner key\n+          description: The key of the owner\n           required: true\n           schema:\n             type: string\n-        - name: product\n+        - name: username\n           in: query\n-          description: List of product ID's\n-          required: true\n+          description: The username of the consumer\n+          schema:\n+            type: string\n+        - name: type\n+          in: query\n+          description: The consumer type\n           schema:\n             type: array\n+            uniqueItems: true\n             items:\n               type: string\n-      responses:\n-        200:\n-          description: Retrieves a list of products by owner\n-          content:\n-            application/json:\n-              schema:\n-                type: array\n-                items:\n-                  $ref: '#/components/schemas/ProductDTO'\n-        404:\n-          description: Owner key could not be found\n-          content:\n-            application/json:\n-              schema:\n-                $ref: '#/components/schemas/ExceptionMessage'\n-              example:\n-                displayMessage: Owner key could not be found\n-                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n-        default:\n-          $ref: '#/components/responses/default'\n-\n-    post:\n-      description: Creates a product for an owner\n-      tags:\n+        - name: uuid\n+          in: query\n+          description: The UUID of consumers\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: hypervisor_id\n+          in: query\n+          description: The hypervisor IDs\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: fact\n+          in: query\n+          description: The consumer facts\n+          schema:\n+            type: array\n+            items:\n+              $ref: '#/components/schemas/KeyValueParamDTO'\n+        - name: sku\n+          in: query\n+          description: The list of skus\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: subscription_id\n+          in: query\n+          description: The list of subscription IDs\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: contract\n+          in: query\n+          description: The list of contract numbers\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+      security: []\n+      responses:\n+        200:\n+          description: Consumers successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                type: array\n+                items:\n+                  $ref: '#/components/schemas/ConsumerDTOArrayElement'\n+        400:\n+          description: Owner key is null or empty\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Owner key is null or empty\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/consumers/count:\n+    get:\n+      description: Retrieves a count of consumers for the owner\n+      tags:\n+        - Owner\n+        - Consumer\n+      operationId: countConsumers\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+        - name: type\n+          in: query\n+          description: The type of the consumer\n+          schema:\n+            type: array\n+            uniqueItems: true\n+            items:\n+              type: string\n+        - name: sku\n+          in: query\n+          description: The list product ids\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: subscription_id\n+          in: query\n+          description: The list of subscription ids\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: contract\n+          in: query\n+          description: The list of contract numbers\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+      security: []\n+      responses:\n+        200:\n+          description: Consumer counts successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                type: integer\n+        400:\n+          description: Owner key is null or empty\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Owner key is null or empty\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/consumers_system_purpose:\n+    get:\n+      description: Retrieves an aggregate of the system purpose settings of the owner's consumers\n+      tags:\n+        - Owner\n+        - Consumer\n+      operationId: getConsumersSyspurpose\n+      security: []\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+      responses:\n+        200:\n+          description:  The system purpose settings sucessfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/SystemPurposeAttributesDTO'\n+        400:\n+          description: Owner key is null or empty\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Owner key is null or empty\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: Owner key could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Owner key could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/entitlements:\n+    get:\n+      description: |\n+        Retrieves the list of entitlements for an owner.\n+        This endpoint supports paging with query parameters. For more details please visit\n+        https://www.candlepinproject.org/docs/candlepin/pagination.html#paginating-results-from-candlepin\n+      tags:\n+        - Owner\n+        - Entitlements\n+      operationId: ownerEntitlements\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+        - name: product\n+          in: query\n+          description: The product id\n+          schema:\n+            type: string\n+        - name: matches\n+          in: query\n+          description: A text to search for in various fields on the entitlements\n+          schema:\n+            type: string\n+        - name: attribute\n+          in: query\n+          description: The pair of attribute values\n+          schema:\n+            type: array\n+            items:\n+              $ref: '#/components/schemas/KeyValueParamDTO'\n+      security: []\n+      responses:\n+        200:\n+          description: Entitlement details successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                type: array\n+                items:\n+                  $ref: '#/components/schemas/EntitlementDTO'\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+    post:\n+      description: |\n+        Starts an asynchronous healing for the given Owner.\n+        At the end of the process the idea is that all of the consumers\n+        in the owned by the owner will be up to date.\n+      tags:\n+        - Owner\n+        - Entitlements\n+      operationId: healEntire\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+      security: []\n+      responses:\n+        200:\n+          description: Successfully operation", "originalCommit": "f41bd9062eac655526cd4d7a45db7f7c7fd4188e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDMyODk2NQ==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r494328965", "bodyText": "This endpoint returns Environments, not Activation keys", "author": "nikosmoum", "createdAt": "2020-09-24T13:44:27Z", "path": "api/candlepin-api-spec.yaml", "diffHunk": "@@ -2764,55 +3067,1142 @@ paths:\n         default:\n           $ref: '#/components/responses/default'\n \n-  /owners/{owner_key}/products:\n+  /owners/{owner_key}/consumers:\n     get:\n-      description: Retrieves a list of products by owner\n+      description: Retrieves a list of Consumers for the Owner\n       tags:\n-        - Owner Product\n-      operationId: getProductsByOwner\n-      security: []\n+        - Owner\n+        - Consumer\n+      operationId: listConsumers\n       x-java-response:\n         type: Iterable\n         isContainer: true\n       parameters:\n         - name: owner_key\n           in: path\n-          description: Owner key\n+          description: The key of the owner\n           required: true\n           schema:\n             type: string\n-        - name: product\n+        - name: username\n           in: query\n-          description: List of product ID's\n-          required: true\n+          description: The username of the consumer\n+          schema:\n+            type: string\n+        - name: type\n+          in: query\n+          description: The consumer type\n           schema:\n             type: array\n+            uniqueItems: true\n             items:\n               type: string\n-      responses:\n-        200:\n-          description: Retrieves a list of products by owner\n-          content:\n-            application/json:\n-              schema:\n-                type: array\n-                items:\n-                  $ref: '#/components/schemas/ProductDTO'\n-        404:\n-          description: Owner key could not be found\n-          content:\n-            application/json:\n-              schema:\n-                $ref: '#/components/schemas/ExceptionMessage'\n-              example:\n-                displayMessage: Owner key could not be found\n-                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n-        default:\n-          $ref: '#/components/responses/default'\n-\n-    post:\n-      description: Creates a product for an owner\n-      tags:\n+        - name: uuid\n+          in: query\n+          description: The UUID of consumers\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: hypervisor_id\n+          in: query\n+          description: The hypervisor IDs\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: fact\n+          in: query\n+          description: The consumer facts\n+          schema:\n+            type: array\n+            items:\n+              $ref: '#/components/schemas/KeyValueParamDTO'\n+        - name: sku\n+          in: query\n+          description: The list of skus\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: subscription_id\n+          in: query\n+          description: The list of subscription IDs\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: contract\n+          in: query\n+          description: The list of contract numbers\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+      security: []\n+      responses:\n+        200:\n+          description: Consumers successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                type: array\n+                items:\n+                  $ref: '#/components/schemas/ConsumerDTOArrayElement'\n+        400:\n+          description: Owner key is null or empty\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Owner key is null or empty\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/consumers/count:\n+    get:\n+      description: Retrieves a count of consumers for the owner\n+      tags:\n+        - Owner\n+        - Consumer\n+      operationId: countConsumers\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+        - name: type\n+          in: query\n+          description: The type of the consumer\n+          schema:\n+            type: array\n+            uniqueItems: true\n+            items:\n+              type: string\n+        - name: sku\n+          in: query\n+          description: The list product ids\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: subscription_id\n+          in: query\n+          description: The list of subscription ids\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: contract\n+          in: query\n+          description: The list of contract numbers\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+      security: []\n+      responses:\n+        200:\n+          description: Consumer counts successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                type: integer\n+        400:\n+          description: Owner key is null or empty\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Owner key is null or empty\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/consumers_system_purpose:\n+    get:\n+      description: Retrieves an aggregate of the system purpose settings of the owner's consumers\n+      tags:\n+        - Owner\n+        - Consumer\n+      operationId: getConsumersSyspurpose\n+      security: []\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+      responses:\n+        200:\n+          description:  The system purpose settings sucessfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/SystemPurposeAttributesDTO'\n+        400:\n+          description: Owner key is null or empty\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Owner key is null or empty\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: Owner key could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Owner key could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/entitlements:\n+    get:\n+      description: |\n+        Retrieves the list of entitlements for an owner.\n+        This endpoint supports paging with query parameters. For more details please visit\n+        https://www.candlepinproject.org/docs/candlepin/pagination.html#paginating-results-from-candlepin\n+      tags:\n+        - Owner\n+        - Entitlements\n+      operationId: ownerEntitlements\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+        - name: product\n+          in: query\n+          description: The product id\n+          schema:\n+            type: string\n+        - name: matches\n+          in: query\n+          description: A text to search for in various fields on the entitlements\n+          schema:\n+            type: string\n+        - name: attribute\n+          in: query\n+          description: The pair of attribute values\n+          schema:\n+            type: array\n+            items:\n+              $ref: '#/components/schemas/KeyValueParamDTO'\n+      security: []\n+      responses:\n+        200:\n+          description: Entitlement details successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                type: array\n+                items:\n+                  $ref: '#/components/schemas/EntitlementDTO'\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+    post:\n+      description: |\n+        Starts an asynchronous healing for the given Owner.\n+        At the end of the process the idea is that all of the consumers\n+        in the owned by the owner will be up to date.\n+      tags:\n+        - Owner\n+        - Entitlements\n+      operationId: healEntire\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+      security: []\n+      responses:\n+        200:\n+          description: Successfully operation\n+          content:\n+            application/json:\n+              schema:\n+               $ref: '#/components/schemas/AsyncJobStatusDTO'\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/environments:\n+    get:\n+      description: Retrieves a list of environment for an owner\n+      tags:\n+        - Owner Environment\n+      operationId: listEnvironments\n+      x-java-response:\n+        type: Iterable\n+        isContainer: true\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+        - name: name\n+          in: query\n+          description: The name of the environment\n+          schema:\n+            type: string\n+      security: []\n+      responses:\n+        200:\n+          description: Activation keys successfully retrieved", "originalCommit": "f41bd9062eac655526cd4d7a45db7f7c7fd4188e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDg4MDUwMQ==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r494880501", "bodyText": "Done.", "author": "sonalidhome", "createdAt": "2020-09-25T09:55:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDMyODk2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDMzMjUxOQ==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r494332519", "bodyText": "this param isn't required. if absent it will just return all hypervisors for that owner", "author": "nikosmoum", "createdAt": "2020-09-24T13:47:16Z", "path": "api/candlepin-api-spec.yaml", "diffHunk": "@@ -2764,55 +3067,1142 @@ paths:\n         default:\n           $ref: '#/components/responses/default'\n \n-  /owners/{owner_key}/products:\n+  /owners/{owner_key}/consumers:\n     get:\n-      description: Retrieves a list of products by owner\n+      description: Retrieves a list of Consumers for the Owner\n       tags:\n-        - Owner Product\n-      operationId: getProductsByOwner\n-      security: []\n+        - Owner\n+        - Consumer\n+      operationId: listConsumers\n       x-java-response:\n         type: Iterable\n         isContainer: true\n       parameters:\n         - name: owner_key\n           in: path\n-          description: Owner key\n+          description: The key of the owner\n           required: true\n           schema:\n             type: string\n-        - name: product\n+        - name: username\n           in: query\n-          description: List of product ID's\n-          required: true\n+          description: The username of the consumer\n+          schema:\n+            type: string\n+        - name: type\n+          in: query\n+          description: The consumer type\n           schema:\n             type: array\n+            uniqueItems: true\n             items:\n               type: string\n-      responses:\n-        200:\n-          description: Retrieves a list of products by owner\n-          content:\n-            application/json:\n-              schema:\n-                type: array\n-                items:\n-                  $ref: '#/components/schemas/ProductDTO'\n-        404:\n-          description: Owner key could not be found\n-          content:\n-            application/json:\n-              schema:\n-                $ref: '#/components/schemas/ExceptionMessage'\n-              example:\n-                displayMessage: Owner key could not be found\n-                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n-        default:\n-          $ref: '#/components/responses/default'\n-\n-    post:\n-      description: Creates a product for an owner\n-      tags:\n+        - name: uuid\n+          in: query\n+          description: The UUID of consumers\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: hypervisor_id\n+          in: query\n+          description: The hypervisor IDs\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: fact\n+          in: query\n+          description: The consumer facts\n+          schema:\n+            type: array\n+            items:\n+              $ref: '#/components/schemas/KeyValueParamDTO'\n+        - name: sku\n+          in: query\n+          description: The list of skus\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: subscription_id\n+          in: query\n+          description: The list of subscription IDs\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: contract\n+          in: query\n+          description: The list of contract numbers\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+      security: []\n+      responses:\n+        200:\n+          description: Consumers successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                type: array\n+                items:\n+                  $ref: '#/components/schemas/ConsumerDTOArrayElement'\n+        400:\n+          description: Owner key is null or empty\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Owner key is null or empty\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/consumers/count:\n+    get:\n+      description: Retrieves a count of consumers for the owner\n+      tags:\n+        - Owner\n+        - Consumer\n+      operationId: countConsumers\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+        - name: type\n+          in: query\n+          description: The type of the consumer\n+          schema:\n+            type: array\n+            uniqueItems: true\n+            items:\n+              type: string\n+        - name: sku\n+          in: query\n+          description: The list product ids\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: subscription_id\n+          in: query\n+          description: The list of subscription ids\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: contract\n+          in: query\n+          description: The list of contract numbers\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+      security: []\n+      responses:\n+        200:\n+          description: Consumer counts successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                type: integer\n+        400:\n+          description: Owner key is null or empty\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Owner key is null or empty\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/consumers_system_purpose:\n+    get:\n+      description: Retrieves an aggregate of the system purpose settings of the owner's consumers\n+      tags:\n+        - Owner\n+        - Consumer\n+      operationId: getConsumersSyspurpose\n+      security: []\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+      responses:\n+        200:\n+          description:  The system purpose settings sucessfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/SystemPurposeAttributesDTO'\n+        400:\n+          description: Owner key is null or empty\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Owner key is null or empty\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: Owner key could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Owner key could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/entitlements:\n+    get:\n+      description: |\n+        Retrieves the list of entitlements for an owner.\n+        This endpoint supports paging with query parameters. For more details please visit\n+        https://www.candlepinproject.org/docs/candlepin/pagination.html#paginating-results-from-candlepin\n+      tags:\n+        - Owner\n+        - Entitlements\n+      operationId: ownerEntitlements\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+        - name: product\n+          in: query\n+          description: The product id\n+          schema:\n+            type: string\n+        - name: matches\n+          in: query\n+          description: A text to search for in various fields on the entitlements\n+          schema:\n+            type: string\n+        - name: attribute\n+          in: query\n+          description: The pair of attribute values\n+          schema:\n+            type: array\n+            items:\n+              $ref: '#/components/schemas/KeyValueParamDTO'\n+      security: []\n+      responses:\n+        200:\n+          description: Entitlement details successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                type: array\n+                items:\n+                  $ref: '#/components/schemas/EntitlementDTO'\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+    post:\n+      description: |\n+        Starts an asynchronous healing for the given Owner.\n+        At the end of the process the idea is that all of the consumers\n+        in the owned by the owner will be up to date.\n+      tags:\n+        - Owner\n+        - Entitlements\n+      operationId: healEntire\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+      security: []\n+      responses:\n+        200:\n+          description: Successfully operation\n+          content:\n+            application/json:\n+              schema:\n+               $ref: '#/components/schemas/AsyncJobStatusDTO'\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/environments:\n+    get:\n+      description: Retrieves a list of environment for an owner\n+      tags:\n+        - Owner Environment\n+      operationId: listEnvironments\n+      x-java-response:\n+        type: Iterable\n+        isContainer: true\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+        - name: name\n+          in: query\n+          description: The name of the environment\n+          schema:\n+            type: string\n+      security: []\n+      responses:\n+        200:\n+          description: Activation keys successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                type: array\n+                items:\n+                  $ref: '#/components/schemas/EnvironmentDTO'\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+    post:\n+      description: Creates an environment for the owner\n+      tags:\n+        - Owner Environment\n+      operationId: createEnv\n+      security: []\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+      requestBody:\n+        description: Environment to be created\n+        required: true\n+        content:\n+          application/json:\n+            schema:\n+              $ref: '#/components/schemas/EnvironmentDTO'\n+      responses:\n+        200:\n+          description: Environment for the owner successfully created\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/EnvironmentDTO'\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/hypervisors:\n+    get:\n+      description: Retrieves a list of hypervisors for an owner\n+      tags:\n+        - Owner\n+        - Hypervisors\n+      operationId: getHypervisors\n+      security: []\n+      x-java-response:\n+        type: Iterable\n+        isContainer: true\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+        - name: hypervisor_id\n+          in: query\n+          description: The list of hypervisor Ids\n+          required: true", "originalCommit": "f41bd9062eac655526cd4d7a45db7f7c7fd4188e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDg4MDQ4Mg==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r494880482", "bodyText": "Done.", "author": "sonalidhome", "createdAt": "2020-09-25T09:55:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDMzMjUxOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDM0ODg3Nw==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r494348877", "bodyText": "Let's add a deprecated: true here, since this endpoint is marked as deprecated, and add the following note to the description: \"Note: This endpoint is deprecated. Please use /owners/{owner_key}/imports/async\"", "author": "nikosmoum", "createdAt": "2020-09-24T14:06:32Z", "path": "api/candlepin-api-spec.yaml", "diffHunk": "@@ -2764,55 +3067,1142 @@ paths:\n         default:\n           $ref: '#/components/responses/default'\n \n-  /owners/{owner_key}/products:\n+  /owners/{owner_key}/consumers:\n     get:\n-      description: Retrieves a list of products by owner\n+      description: Retrieves a list of Consumers for the Owner\n       tags:\n-        - Owner Product\n-      operationId: getProductsByOwner\n-      security: []\n+        - Owner\n+        - Consumer\n+      operationId: listConsumers\n       x-java-response:\n         type: Iterable\n         isContainer: true\n       parameters:\n         - name: owner_key\n           in: path\n-          description: Owner key\n+          description: The key of the owner\n           required: true\n           schema:\n             type: string\n-        - name: product\n+        - name: username\n           in: query\n-          description: List of product ID's\n-          required: true\n+          description: The username of the consumer\n+          schema:\n+            type: string\n+        - name: type\n+          in: query\n+          description: The consumer type\n           schema:\n             type: array\n+            uniqueItems: true\n             items:\n               type: string\n-      responses:\n-        200:\n-          description: Retrieves a list of products by owner\n-          content:\n-            application/json:\n-              schema:\n-                type: array\n-                items:\n-                  $ref: '#/components/schemas/ProductDTO'\n-        404:\n-          description: Owner key could not be found\n-          content:\n-            application/json:\n-              schema:\n-                $ref: '#/components/schemas/ExceptionMessage'\n-              example:\n-                displayMessage: Owner key could not be found\n-                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n-        default:\n-          $ref: '#/components/responses/default'\n-\n-    post:\n-      description: Creates a product for an owner\n-      tags:\n+        - name: uuid\n+          in: query\n+          description: The UUID of consumers\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: hypervisor_id\n+          in: query\n+          description: The hypervisor IDs\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: fact\n+          in: query\n+          description: The consumer facts\n+          schema:\n+            type: array\n+            items:\n+              $ref: '#/components/schemas/KeyValueParamDTO'\n+        - name: sku\n+          in: query\n+          description: The list of skus\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: subscription_id\n+          in: query\n+          description: The list of subscription IDs\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: contract\n+          in: query\n+          description: The list of contract numbers\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+      security: []\n+      responses:\n+        200:\n+          description: Consumers successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                type: array\n+                items:\n+                  $ref: '#/components/schemas/ConsumerDTOArrayElement'\n+        400:\n+          description: Owner key is null or empty\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Owner key is null or empty\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/consumers/count:\n+    get:\n+      description: Retrieves a count of consumers for the owner\n+      tags:\n+        - Owner\n+        - Consumer\n+      operationId: countConsumers\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+        - name: type\n+          in: query\n+          description: The type of the consumer\n+          schema:\n+            type: array\n+            uniqueItems: true\n+            items:\n+              type: string\n+        - name: sku\n+          in: query\n+          description: The list product ids\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: subscription_id\n+          in: query\n+          description: The list of subscription ids\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: contract\n+          in: query\n+          description: The list of contract numbers\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+      security: []\n+      responses:\n+        200:\n+          description: Consumer counts successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                type: integer\n+        400:\n+          description: Owner key is null or empty\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Owner key is null or empty\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/consumers_system_purpose:\n+    get:\n+      description: Retrieves an aggregate of the system purpose settings of the owner's consumers\n+      tags:\n+        - Owner\n+        - Consumer\n+      operationId: getConsumersSyspurpose\n+      security: []\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+      responses:\n+        200:\n+          description:  The system purpose settings sucessfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/SystemPurposeAttributesDTO'\n+        400:\n+          description: Owner key is null or empty\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Owner key is null or empty\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: Owner key could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Owner key could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/entitlements:\n+    get:\n+      description: |\n+        Retrieves the list of entitlements for an owner.\n+        This endpoint supports paging with query parameters. For more details please visit\n+        https://www.candlepinproject.org/docs/candlepin/pagination.html#paginating-results-from-candlepin\n+      tags:\n+        - Owner\n+        - Entitlements\n+      operationId: ownerEntitlements\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+        - name: product\n+          in: query\n+          description: The product id\n+          schema:\n+            type: string\n+        - name: matches\n+          in: query\n+          description: A text to search for in various fields on the entitlements\n+          schema:\n+            type: string\n+        - name: attribute\n+          in: query\n+          description: The pair of attribute values\n+          schema:\n+            type: array\n+            items:\n+              $ref: '#/components/schemas/KeyValueParamDTO'\n+      security: []\n+      responses:\n+        200:\n+          description: Entitlement details successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                type: array\n+                items:\n+                  $ref: '#/components/schemas/EntitlementDTO'\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+    post:\n+      description: |\n+        Starts an asynchronous healing for the given Owner.\n+        At the end of the process the idea is that all of the consumers\n+        in the owned by the owner will be up to date.\n+      tags:\n+        - Owner\n+        - Entitlements\n+      operationId: healEntire\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+      security: []\n+      responses:\n+        200:\n+          description: Successfully operation\n+          content:\n+            application/json:\n+              schema:\n+               $ref: '#/components/schemas/AsyncJobStatusDTO'\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/environments:\n+    get:\n+      description: Retrieves a list of environment for an owner\n+      tags:\n+        - Owner Environment\n+      operationId: listEnvironments\n+      x-java-response:\n+        type: Iterable\n+        isContainer: true\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+        - name: name\n+          in: query\n+          description: The name of the environment\n+          schema:\n+            type: string\n+      security: []\n+      responses:\n+        200:\n+          description: Activation keys successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                type: array\n+                items:\n+                  $ref: '#/components/schemas/EnvironmentDTO'\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+    post:\n+      description: Creates an environment for the owner\n+      tags:\n+        - Owner Environment\n+      operationId: createEnv\n+      security: []\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+      requestBody:\n+        description: Environment to be created\n+        required: true\n+        content:\n+          application/json:\n+            schema:\n+              $ref: '#/components/schemas/EnvironmentDTO'\n+      responses:\n+        200:\n+          description: Environment for the owner successfully created\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/EnvironmentDTO'\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/hypervisors:\n+    get:\n+      description: Retrieves a list of hypervisors for an owner\n+      tags:\n+        - Owner\n+        - Hypervisors\n+      operationId: getHypervisors\n+      security: []\n+      x-java-response:\n+        type: Iterable\n+        isContainer: true\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+        - name: hypervisor_id\n+          in: query\n+          description: The list of hypervisor Ids\n+          required: true\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+      responses:\n+        200:\n+          description: A list of hypervisors successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ConsumerDTOArrayElement'\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/imports:\n+    get:\n+      description: Retrieves a list of import records for an owner\n+      tags:\n+        - Owner Import\n+      operationId: getImports\n+      security: []\n+      x-java-response:\n+        type: Iterable\n+        isContainer: true\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+      responses:\n+        200:\n+          description: Import records successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ImportRecordDTO'\n+        400:\n+          description: Owner key is null or empty\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Owner key is null or empty\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: An import owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An import owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+    post:\n+      description: |\n+        Imports a manifest zip file for the given organization.\n+        This will bring in any products, content, and subscriptions that were\n+        assigned to the distributor who generated the manifest.\n+      tags:\n+        - Owner Import\n+      operationId: importManifest", "originalCommit": "f41bd9062eac655526cd4d7a45db7f7c7fd4188e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDg4MDQ2OQ==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r494880469", "bodyText": "Done.", "author": "sonalidhome", "createdAt": "2020-09-25T09:55:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDM0ODg3Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDM1NzQyNg==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r494357426", "bodyText": "This param isn't required (since it has a default value)", "author": "nikosmoum", "createdAt": "2020-09-24T14:18:06Z", "path": "api/candlepin-api-spec.yaml", "diffHunk": "@@ -2764,55 +3067,1142 @@ paths:\n         default:\n           $ref: '#/components/responses/default'\n \n-  /owners/{owner_key}/products:\n+  /owners/{owner_key}/consumers:\n     get:\n-      description: Retrieves a list of products by owner\n+      description: Retrieves a list of Consumers for the Owner\n       tags:\n-        - Owner Product\n-      operationId: getProductsByOwner\n-      security: []\n+        - Owner\n+        - Consumer\n+      operationId: listConsumers\n       x-java-response:\n         type: Iterable\n         isContainer: true\n       parameters:\n         - name: owner_key\n           in: path\n-          description: Owner key\n+          description: The key of the owner\n           required: true\n           schema:\n             type: string\n-        - name: product\n+        - name: username\n           in: query\n-          description: List of product ID's\n-          required: true\n+          description: The username of the consumer\n+          schema:\n+            type: string\n+        - name: type\n+          in: query\n+          description: The consumer type\n           schema:\n             type: array\n+            uniqueItems: true\n             items:\n               type: string\n-      responses:\n-        200:\n-          description: Retrieves a list of products by owner\n-          content:\n-            application/json:\n-              schema:\n-                type: array\n-                items:\n-                  $ref: '#/components/schemas/ProductDTO'\n-        404:\n-          description: Owner key could not be found\n-          content:\n-            application/json:\n-              schema:\n-                $ref: '#/components/schemas/ExceptionMessage'\n-              example:\n-                displayMessage: Owner key could not be found\n-                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n-        default:\n-          $ref: '#/components/responses/default'\n-\n-    post:\n-      description: Creates a product for an owner\n-      tags:\n+        - name: uuid\n+          in: query\n+          description: The UUID of consumers\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: hypervisor_id\n+          in: query\n+          description: The hypervisor IDs\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: fact\n+          in: query\n+          description: The consumer facts\n+          schema:\n+            type: array\n+            items:\n+              $ref: '#/components/schemas/KeyValueParamDTO'\n+        - name: sku\n+          in: query\n+          description: The list of skus\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: subscription_id\n+          in: query\n+          description: The list of subscription IDs\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: contract\n+          in: query\n+          description: The list of contract numbers\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+      security: []\n+      responses:\n+        200:\n+          description: Consumers successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                type: array\n+                items:\n+                  $ref: '#/components/schemas/ConsumerDTOArrayElement'\n+        400:\n+          description: Owner key is null or empty\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Owner key is null or empty\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/consumers/count:\n+    get:\n+      description: Retrieves a count of consumers for the owner\n+      tags:\n+        - Owner\n+        - Consumer\n+      operationId: countConsumers\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+        - name: type\n+          in: query\n+          description: The type of the consumer\n+          schema:\n+            type: array\n+            uniqueItems: true\n+            items:\n+              type: string\n+        - name: sku\n+          in: query\n+          description: The list product ids\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: subscription_id\n+          in: query\n+          description: The list of subscription ids\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: contract\n+          in: query\n+          description: The list of contract numbers\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+      security: []\n+      responses:\n+        200:\n+          description: Consumer counts successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                type: integer\n+        400:\n+          description: Owner key is null or empty\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Owner key is null or empty\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/consumers_system_purpose:\n+    get:\n+      description: Retrieves an aggregate of the system purpose settings of the owner's consumers\n+      tags:\n+        - Owner\n+        - Consumer\n+      operationId: getConsumersSyspurpose\n+      security: []\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+      responses:\n+        200:\n+          description:  The system purpose settings sucessfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/SystemPurposeAttributesDTO'\n+        400:\n+          description: Owner key is null or empty\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Owner key is null or empty\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: Owner key could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Owner key could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/entitlements:\n+    get:\n+      description: |\n+        Retrieves the list of entitlements for an owner.\n+        This endpoint supports paging with query parameters. For more details please visit\n+        https://www.candlepinproject.org/docs/candlepin/pagination.html#paginating-results-from-candlepin\n+      tags:\n+        - Owner\n+        - Entitlements\n+      operationId: ownerEntitlements\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+        - name: product\n+          in: query\n+          description: The product id\n+          schema:\n+            type: string\n+        - name: matches\n+          in: query\n+          description: A text to search for in various fields on the entitlements\n+          schema:\n+            type: string\n+        - name: attribute\n+          in: query\n+          description: The pair of attribute values\n+          schema:\n+            type: array\n+            items:\n+              $ref: '#/components/schemas/KeyValueParamDTO'\n+      security: []\n+      responses:\n+        200:\n+          description: Entitlement details successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                type: array\n+                items:\n+                  $ref: '#/components/schemas/EntitlementDTO'\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+    post:\n+      description: |\n+        Starts an asynchronous healing for the given Owner.\n+        At the end of the process the idea is that all of the consumers\n+        in the owned by the owner will be up to date.\n+      tags:\n+        - Owner\n+        - Entitlements\n+      operationId: healEntire\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+      security: []\n+      responses:\n+        200:\n+          description: Successfully operation\n+          content:\n+            application/json:\n+              schema:\n+               $ref: '#/components/schemas/AsyncJobStatusDTO'\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/environments:\n+    get:\n+      description: Retrieves a list of environment for an owner\n+      tags:\n+        - Owner Environment\n+      operationId: listEnvironments\n+      x-java-response:\n+        type: Iterable\n+        isContainer: true\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+        - name: name\n+          in: query\n+          description: The name of the environment\n+          schema:\n+            type: string\n+      security: []\n+      responses:\n+        200:\n+          description: Activation keys successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                type: array\n+                items:\n+                  $ref: '#/components/schemas/EnvironmentDTO'\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+    post:\n+      description: Creates an environment for the owner\n+      tags:\n+        - Owner Environment\n+      operationId: createEnv\n+      security: []\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+      requestBody:\n+        description: Environment to be created\n+        required: true\n+        content:\n+          application/json:\n+            schema:\n+              $ref: '#/components/schemas/EnvironmentDTO'\n+      responses:\n+        200:\n+          description: Environment for the owner successfully created\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/EnvironmentDTO'\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/hypervisors:\n+    get:\n+      description: Retrieves a list of hypervisors for an owner\n+      tags:\n+        - Owner\n+        - Hypervisors\n+      operationId: getHypervisors\n+      security: []\n+      x-java-response:\n+        type: Iterable\n+        isContainer: true\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+        - name: hypervisor_id\n+          in: query\n+          description: The list of hypervisor Ids\n+          required: true\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+      responses:\n+        200:\n+          description: A list of hypervisors successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ConsumerDTOArrayElement'\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/imports:\n+    get:\n+      description: Retrieves a list of import records for an owner\n+      tags:\n+        - Owner Import\n+      operationId: getImports\n+      security: []\n+      x-java-response:\n+        type: Iterable\n+        isContainer: true\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+      responses:\n+        200:\n+          description: Import records successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ImportRecordDTO'\n+        400:\n+          description: Owner key is null or empty\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Owner key is null or empty\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: An import owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An import owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+    post:\n+      description: |\n+        Imports a manifest zip file for the given organization.\n+        This will bring in any products, content, and subscriptions that were\n+        assigned to the distributor who generated the manifest.\n+      tags:\n+        - Owner Import\n+      operationId: importManifest\n+      security: []\n+      requestBody:\n+        description: A manifest file to be imported\n+        required: true\n+        content:\n+          multipart/form-data:\n+            schema:\n+              properties:\n+                input:\n+                  type: string\n+                  format: binary\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+        - name: force\n+          in: query\n+          description: This is used to override the conflicts\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+      responses:\n+        200:\n+          description: Manifest successfully imported\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ImportRecordDTO'\n+        400:\n+          description: |\n+            Bad request error. Reasons could be,\n+            Owner key is null\n+            or empty or Unknown conflict to force\n+            or format error of the data in a manifest\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: |\n+                  Bad request error. Reasons could be,\n+                  Owner key is null\n+                  or empty or Unknown conflict to force\n+                  or format error of the data in a manifest\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: An import owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An import owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        500:\n+          description: |\n+            Internal server error. Reasons could be,\n+            Reading error during importing\n+            or problem with archive\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: |\n+                  Internal server error. Reasons could be,\n+                  Reading error during importing\n+                  or problem with archive\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+    delete:\n+      description: |\n+        Removes Imports for an Owner. Cleans out all imported subscriptions\n+        and triggers a background refresh pools. Link to an upstream distributor is\n+        removed for the owner, so they can import from another distributor. Other\n+        owners can also now import the manifests originally used in this owner. This\n+        call does not differentiate between any specific import, it just destroys all\n+        subscriptions with an upstream pool ID, essentially anything from an import.\n+        Custom subscriptions will be left alone. Imports do carry rules and product\n+        information which is global to the candlepin server. This import data is *not*\n+        undone, we assume that updates to this data can be safely kept.\n+      tags:\n+        - Owner Import\n+      operationId: undoImports\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+      security: [ ]\n+      responses:\n+        200:\n+          description: Imports for an Owner successfully removed\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/AsyncJobStatusDTO'\n+        404:\n+          description: An import owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An import owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/imports/async:\n+    post:\n+      description: |\n+        Initiates an asynchronous manifest import for the given organization.\n+        This will bring in any products, content, and subscriptions that were\n+        assigned to the distributor who generated the manifest.\n+      tags:\n+        - Owner Import\n+        - Async\n+      operationId: importManifestAsync\n+      security: []\n+      requestBody:\n+        description: A manifest file to be imported\n+        required: true\n+        content:\n+          multipart/form-data:\n+            schema:\n+              properties:\n+                input:\n+                  type: string\n+                  format: binary\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+        - name: force\n+          in: query\n+          description: This is used to override the conflicts\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+      responses:\n+        200:\n+          description: Manifest successfully imported\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/AsyncJobStatusDTO'\n+        400:\n+          description: Owner key is null or empty\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Owner key is null or empty\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: An import owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An import owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        500:\n+          description: |\n+            Internal server error. Reasons could be,\n+            An unexpected exception occurred while scheduling job\n+            or error reading export archive\n+            or error storing uploaded archive for asynchronous processing\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: |\n+                  Internal server error. Reasons could be,\n+                  An unexpected exception occurred while scheduling job\n+                  or error reading export archive\n+                  or error storing uploaded archive for asynchronous processing\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/info:\n+    get:\n+      description: Retrieves the Owner Info for an Owner\n+      tags:\n+        - Owner\n+      operationId: getOwnerInfo\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+      security: []\n+      responses:\n+        200:\n+          description: Owner info successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/OwnerInfoDTO'\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/log:\n+    put:\n+      description: Sets the log level for an owner\n+      tags:\n+        - Owner log\n+      operationId: setLogLevel\n+      security: []\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+        - name: level\n+          in: query\n+          description: The log level\n+          required: true", "originalCommit": "f41bd9062eac655526cd4d7a45db7f7c7fd4188e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDg4MDQ1OQ==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r494880459", "bodyText": "Done.", "author": "sonalidhome", "createdAt": "2020-09-25T09:55:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDM1NzQyNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDM1OTU1OA==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r494359558", "bodyText": "This should be Owner log level successfully removed", "author": "nikosmoum", "createdAt": "2020-09-24T14:20:43Z", "path": "api/candlepin-api-spec.yaml", "diffHunk": "@@ -2764,55 +3067,1142 @@ paths:\n         default:\n           $ref: '#/components/responses/default'\n \n-  /owners/{owner_key}/products:\n+  /owners/{owner_key}/consumers:\n     get:\n-      description: Retrieves a list of products by owner\n+      description: Retrieves a list of Consumers for the Owner\n       tags:\n-        - Owner Product\n-      operationId: getProductsByOwner\n-      security: []\n+        - Owner\n+        - Consumer\n+      operationId: listConsumers\n       x-java-response:\n         type: Iterable\n         isContainer: true\n       parameters:\n         - name: owner_key\n           in: path\n-          description: Owner key\n+          description: The key of the owner\n           required: true\n           schema:\n             type: string\n-        - name: product\n+        - name: username\n           in: query\n-          description: List of product ID's\n-          required: true\n+          description: The username of the consumer\n+          schema:\n+            type: string\n+        - name: type\n+          in: query\n+          description: The consumer type\n           schema:\n             type: array\n+            uniqueItems: true\n             items:\n               type: string\n-      responses:\n-        200:\n-          description: Retrieves a list of products by owner\n-          content:\n-            application/json:\n-              schema:\n-                type: array\n-                items:\n-                  $ref: '#/components/schemas/ProductDTO'\n-        404:\n-          description: Owner key could not be found\n-          content:\n-            application/json:\n-              schema:\n-                $ref: '#/components/schemas/ExceptionMessage'\n-              example:\n-                displayMessage: Owner key could not be found\n-                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n-        default:\n-          $ref: '#/components/responses/default'\n-\n-    post:\n-      description: Creates a product for an owner\n-      tags:\n+        - name: uuid\n+          in: query\n+          description: The UUID of consumers\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: hypervisor_id\n+          in: query\n+          description: The hypervisor IDs\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: fact\n+          in: query\n+          description: The consumer facts\n+          schema:\n+            type: array\n+            items:\n+              $ref: '#/components/schemas/KeyValueParamDTO'\n+        - name: sku\n+          in: query\n+          description: The list of skus\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: subscription_id\n+          in: query\n+          description: The list of subscription IDs\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: contract\n+          in: query\n+          description: The list of contract numbers\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+      security: []\n+      responses:\n+        200:\n+          description: Consumers successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                type: array\n+                items:\n+                  $ref: '#/components/schemas/ConsumerDTOArrayElement'\n+        400:\n+          description: Owner key is null or empty\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Owner key is null or empty\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/consumers/count:\n+    get:\n+      description: Retrieves a count of consumers for the owner\n+      tags:\n+        - Owner\n+        - Consumer\n+      operationId: countConsumers\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+        - name: type\n+          in: query\n+          description: The type of the consumer\n+          schema:\n+            type: array\n+            uniqueItems: true\n+            items:\n+              type: string\n+        - name: sku\n+          in: query\n+          description: The list product ids\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: subscription_id\n+          in: query\n+          description: The list of subscription ids\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: contract\n+          in: query\n+          description: The list of contract numbers\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+      security: []\n+      responses:\n+        200:\n+          description: Consumer counts successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                type: integer\n+        400:\n+          description: Owner key is null or empty\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Owner key is null or empty\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/consumers_system_purpose:\n+    get:\n+      description: Retrieves an aggregate of the system purpose settings of the owner's consumers\n+      tags:\n+        - Owner\n+        - Consumer\n+      operationId: getConsumersSyspurpose\n+      security: []\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+      responses:\n+        200:\n+          description:  The system purpose settings sucessfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/SystemPurposeAttributesDTO'\n+        400:\n+          description: Owner key is null or empty\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Owner key is null or empty\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: Owner key could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Owner key could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/entitlements:\n+    get:\n+      description: |\n+        Retrieves the list of entitlements for an owner.\n+        This endpoint supports paging with query parameters. For more details please visit\n+        https://www.candlepinproject.org/docs/candlepin/pagination.html#paginating-results-from-candlepin\n+      tags:\n+        - Owner\n+        - Entitlements\n+      operationId: ownerEntitlements\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+        - name: product\n+          in: query\n+          description: The product id\n+          schema:\n+            type: string\n+        - name: matches\n+          in: query\n+          description: A text to search for in various fields on the entitlements\n+          schema:\n+            type: string\n+        - name: attribute\n+          in: query\n+          description: The pair of attribute values\n+          schema:\n+            type: array\n+            items:\n+              $ref: '#/components/schemas/KeyValueParamDTO'\n+      security: []\n+      responses:\n+        200:\n+          description: Entitlement details successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                type: array\n+                items:\n+                  $ref: '#/components/schemas/EntitlementDTO'\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+    post:\n+      description: |\n+        Starts an asynchronous healing for the given Owner.\n+        At the end of the process the idea is that all of the consumers\n+        in the owned by the owner will be up to date.\n+      tags:\n+        - Owner\n+        - Entitlements\n+      operationId: healEntire\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+      security: []\n+      responses:\n+        200:\n+          description: Successfully operation\n+          content:\n+            application/json:\n+              schema:\n+               $ref: '#/components/schemas/AsyncJobStatusDTO'\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/environments:\n+    get:\n+      description: Retrieves a list of environment for an owner\n+      tags:\n+        - Owner Environment\n+      operationId: listEnvironments\n+      x-java-response:\n+        type: Iterable\n+        isContainer: true\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+        - name: name\n+          in: query\n+          description: The name of the environment\n+          schema:\n+            type: string\n+      security: []\n+      responses:\n+        200:\n+          description: Activation keys successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                type: array\n+                items:\n+                  $ref: '#/components/schemas/EnvironmentDTO'\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+    post:\n+      description: Creates an environment for the owner\n+      tags:\n+        - Owner Environment\n+      operationId: createEnv\n+      security: []\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+      requestBody:\n+        description: Environment to be created\n+        required: true\n+        content:\n+          application/json:\n+            schema:\n+              $ref: '#/components/schemas/EnvironmentDTO'\n+      responses:\n+        200:\n+          description: Environment for the owner successfully created\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/EnvironmentDTO'\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/hypervisors:\n+    get:\n+      description: Retrieves a list of hypervisors for an owner\n+      tags:\n+        - Owner\n+        - Hypervisors\n+      operationId: getHypervisors\n+      security: []\n+      x-java-response:\n+        type: Iterable\n+        isContainer: true\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+        - name: hypervisor_id\n+          in: query\n+          description: The list of hypervisor Ids\n+          required: true\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+      responses:\n+        200:\n+          description: A list of hypervisors successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ConsumerDTOArrayElement'\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/imports:\n+    get:\n+      description: Retrieves a list of import records for an owner\n+      tags:\n+        - Owner Import\n+      operationId: getImports\n+      security: []\n+      x-java-response:\n+        type: Iterable\n+        isContainer: true\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+      responses:\n+        200:\n+          description: Import records successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ImportRecordDTO'\n+        400:\n+          description: Owner key is null or empty\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Owner key is null or empty\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: An import owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An import owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+    post:\n+      description: |\n+        Imports a manifest zip file for the given organization.\n+        This will bring in any products, content, and subscriptions that were\n+        assigned to the distributor who generated the manifest.\n+      tags:\n+        - Owner Import\n+      operationId: importManifest\n+      security: []\n+      requestBody:\n+        description: A manifest file to be imported\n+        required: true\n+        content:\n+          multipart/form-data:\n+            schema:\n+              properties:\n+                input:\n+                  type: string\n+                  format: binary\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+        - name: force\n+          in: query\n+          description: This is used to override the conflicts\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+      responses:\n+        200:\n+          description: Manifest successfully imported\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ImportRecordDTO'\n+        400:\n+          description: |\n+            Bad request error. Reasons could be,\n+            Owner key is null\n+            or empty or Unknown conflict to force\n+            or format error of the data in a manifest\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: |\n+                  Bad request error. Reasons could be,\n+                  Owner key is null\n+                  or empty or Unknown conflict to force\n+                  or format error of the data in a manifest\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: An import owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An import owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        500:\n+          description: |\n+            Internal server error. Reasons could be,\n+            Reading error during importing\n+            or problem with archive\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: |\n+                  Internal server error. Reasons could be,\n+                  Reading error during importing\n+                  or problem with archive\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+    delete:\n+      description: |\n+        Removes Imports for an Owner. Cleans out all imported subscriptions\n+        and triggers a background refresh pools. Link to an upstream distributor is\n+        removed for the owner, so they can import from another distributor. Other\n+        owners can also now import the manifests originally used in this owner. This\n+        call does not differentiate between any specific import, it just destroys all\n+        subscriptions with an upstream pool ID, essentially anything from an import.\n+        Custom subscriptions will be left alone. Imports do carry rules and product\n+        information which is global to the candlepin server. This import data is *not*\n+        undone, we assume that updates to this data can be safely kept.\n+      tags:\n+        - Owner Import\n+      operationId: undoImports\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+      security: [ ]\n+      responses:\n+        200:\n+          description: Imports for an Owner successfully removed\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/AsyncJobStatusDTO'\n+        404:\n+          description: An import owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An import owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/imports/async:\n+    post:\n+      description: |\n+        Initiates an asynchronous manifest import for the given organization.\n+        This will bring in any products, content, and subscriptions that were\n+        assigned to the distributor who generated the manifest.\n+      tags:\n+        - Owner Import\n+        - Async\n+      operationId: importManifestAsync\n+      security: []\n+      requestBody:\n+        description: A manifest file to be imported\n+        required: true\n+        content:\n+          multipart/form-data:\n+            schema:\n+              properties:\n+                input:\n+                  type: string\n+                  format: binary\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+        - name: force\n+          in: query\n+          description: This is used to override the conflicts\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+      responses:\n+        200:\n+          description: Manifest successfully imported\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/AsyncJobStatusDTO'\n+        400:\n+          description: Owner key is null or empty\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Owner key is null or empty\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: An import owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An import owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        500:\n+          description: |\n+            Internal server error. Reasons could be,\n+            An unexpected exception occurred while scheduling job\n+            or error reading export archive\n+            or error storing uploaded archive for asynchronous processing\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: |\n+                  Internal server error. Reasons could be,\n+                  An unexpected exception occurred while scheduling job\n+                  or error reading export archive\n+                  or error storing uploaded archive for asynchronous processing\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/info:\n+    get:\n+      description: Retrieves the Owner Info for an Owner\n+      tags:\n+        - Owner\n+      operationId: getOwnerInfo\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+      security: []\n+      responses:\n+        200:\n+          description: Owner info successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/OwnerInfoDTO'\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/log:\n+    put:\n+      description: Sets the log level for an owner\n+      tags:\n+        - Owner log\n+      operationId: setLogLevel\n+      security: []\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+        - name: level\n+          in: query\n+          description: The log level\n+          required: true\n+          schema:\n+            type: string\n+            default: DEBUG\n+            enum:\n+              - ALL\n+              - TRACE\n+              - DEBUG\n+              - INFO\n+              - WARN\n+              - ERROR\n+              - OFF\n+      responses:\n+        200:\n+          description: Log level successfully set\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/OwnerDTO'\n+        400:\n+          description: |\n+            Provided level is not a valid log level\n+            or owner key is not provided\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: |\n+                  Provided level is not a valid log level\n+                  or owner key is not provided\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+    delete:\n+      description: Remove the log level of an owner\n+      tags:\n+        - Owner log\n+      operationId: deleteLogLevel\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The owner key\n+          required: true\n+          schema:\n+            type: string\n+      security: []\n+      responses:\n+        204:\n+          description: Owner successfully deleted", "originalCommit": "f41bd9062eac655526cd4d7a45db7f7c7fd4188e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDg4MDQ0Ng==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r494880446", "bodyText": "Done.", "author": "sonalidhome", "createdAt": "2020-09-25T09:55:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDM1OTU1OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDM2MjE1NA==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r494362154", "bodyText": "this should be 204", "author": "nikosmoum", "createdAt": "2020-09-24T14:24:10Z", "path": "api/candlepin-api-spec.yaml", "diffHunk": "@@ -2524,6 +2524,309 @@ paths:\n         default:\n           $ref: '#/components/responses/default'\n \n+  /owners:\n+    get:\n+      description: Retrieves a list of owners\n+      tags:\n+        - Owner\n+      operationId: listOwners\n+      x-java-response:\n+        type: Iterable\n+        isContainer: true\n+      parameters:\n+        - name: key\n+          in: query\n+          description: The owner keys\n+          required: false\n+          schema:\n+            type: string\n+      security: []\n+      responses:\n+        200:\n+          description: A list of owners\n+          content:\n+            application/json:\n+              schema:\n+                type: array\n+                items:\n+                  $ref: '#/components/schemas/OwnerDTO'\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+    post:\n+      description: Creates an owner\n+      tags:\n+        - Owner\n+      operationId: createOwner\n+      security: []\n+      requestBody:\n+        description: Owner to be created\n+        required: true\n+        content:\n+          application/json:\n+            schema:\n+              $ref: '#/components/schemas/OwnerDTO'\n+      responses:\n+        200:\n+          description: Owner successfully created\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/OwnerDTO'\n+        400:\n+          description: |\n+            Invalid inputs, Owner cannot be created.\n+            Reasons could be, invalid key\n+            or the default service level is specified\n+            or the owner content access mode and content access mode list cannot be set directly in standalone mode\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: |\n+                  Invalid inputs, Owner cannot be created.\n+                  Reasons could be, invalid key\n+                  or the default service level is specified\n+                  or the owner content access mode and content access mode list cannot be set directly in standalone mode\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}:\n+    get:\n+      description: Retrieves a single owner\n+      tags:\n+        - Owner\n+      operationId: getOwner\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+      security: []\n+      responses:\n+        200:\n+          description: Owner successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/OwnerDTO'\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+    put:\n+      description: |\n+        Updates an owner.\n+        Note: To un-set the defaultServiceLevel for an owner, submit an empty string.\n+      tags:\n+        - Owner\n+      operationId: updateOwner\n+      security: []\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+      requestBody:\n+        description: Owner to be updated\n+        required: true\n+        content:\n+          application/json:\n+            schema:\n+              $ref: '#/components/schemas/OwnerDTO'\n+      responses:\n+        200:\n+          description: Owner successfully updated\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/OwnerDTO'\n+        400:\n+          description: |\n+            Invalid inputs, Owner cannot be updated.\n+            Reasons could be, invalid key\n+            or the default service level is specified\n+            or the owner content access mode and content access mode list cannot be set directly in standalone mode\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: |\n+                  Invalid inputs, Owner cannot be updated.\n+                  Reasons could be, invalid key\n+                  or the default service level is specified\n+                  or the owner content access mode and content access mode list cannot be set directly in standalone mode\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+    delete:\n+      description: Removes an owner\n+      tags:\n+        - Owner\n+      operationId: deleteOwner\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The owner key\n+          required: true\n+          schema:\n+            type: string\n+        - name: revoke\n+          in: query\n+          description: Boolean value to revoke an owner\n+          schema:\n+            type: boolean\n+            default: true\n+        - name: force\n+          in: query\n+          description: Boolean value to forcefully delete an owner. This is not in use.\n+          schema:\n+            type: boolean\n+            default: false\n+      security: []\n+      responses:\n+        200:", "originalCommit": "f41bd9062eac655526cd4d7a45db7f7c7fd4188e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDg4MDQzNQ==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r494880435", "bodyText": "Done.", "author": "sonalidhome", "createdAt": "2020-09-25T09:55:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDM2MjE1NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDM3ODYyNA==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r494378624", "bodyText": "This is returning Pools, not consumers", "author": "nikosmoum", "createdAt": "2020-09-24T14:45:07Z", "path": "api/candlepin-api-spec.yaml", "diffHunk": "@@ -2764,55 +3067,1142 @@ paths:\n         default:\n           $ref: '#/components/responses/default'\n \n-  /owners/{owner_key}/products:\n+  /owners/{owner_key}/consumers:\n     get:\n-      description: Retrieves a list of products by owner\n+      description: Retrieves a list of Consumers for the Owner\n       tags:\n-        - Owner Product\n-      operationId: getProductsByOwner\n-      security: []\n+        - Owner\n+        - Consumer\n+      operationId: listConsumers\n       x-java-response:\n         type: Iterable\n         isContainer: true\n       parameters:\n         - name: owner_key\n           in: path\n-          description: Owner key\n+          description: The key of the owner\n           required: true\n           schema:\n             type: string\n-        - name: product\n+        - name: username\n           in: query\n-          description: List of product ID's\n-          required: true\n+          description: The username of the consumer\n+          schema:\n+            type: string\n+        - name: type\n+          in: query\n+          description: The consumer type\n           schema:\n             type: array\n+            uniqueItems: true\n             items:\n               type: string\n-      responses:\n-        200:\n-          description: Retrieves a list of products by owner\n-          content:\n-            application/json:\n-              schema:\n-                type: array\n-                items:\n-                  $ref: '#/components/schemas/ProductDTO'\n-        404:\n-          description: Owner key could not be found\n-          content:\n-            application/json:\n-              schema:\n-                $ref: '#/components/schemas/ExceptionMessage'\n-              example:\n-                displayMessage: Owner key could not be found\n-                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n-        default:\n-          $ref: '#/components/responses/default'\n-\n-    post:\n-      description: Creates a product for an owner\n-      tags:\n+        - name: uuid\n+          in: query\n+          description: The UUID of consumers\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: hypervisor_id\n+          in: query\n+          description: The hypervisor IDs\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: fact\n+          in: query\n+          description: The consumer facts\n+          schema:\n+            type: array\n+            items:\n+              $ref: '#/components/schemas/KeyValueParamDTO'\n+        - name: sku\n+          in: query\n+          description: The list of skus\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: subscription_id\n+          in: query\n+          description: The list of subscription IDs\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: contract\n+          in: query\n+          description: The list of contract numbers\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+      security: []\n+      responses:\n+        200:\n+          description: Consumers successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                type: array\n+                items:\n+                  $ref: '#/components/schemas/ConsumerDTOArrayElement'\n+        400:\n+          description: Owner key is null or empty\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Owner key is null or empty\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/consumers/count:\n+    get:\n+      description: Retrieves a count of consumers for the owner\n+      tags:\n+        - Owner\n+        - Consumer\n+      operationId: countConsumers\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+        - name: type\n+          in: query\n+          description: The type of the consumer\n+          schema:\n+            type: array\n+            uniqueItems: true\n+            items:\n+              type: string\n+        - name: sku\n+          in: query\n+          description: The list product ids\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: subscription_id\n+          in: query\n+          description: The list of subscription ids\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: contract\n+          in: query\n+          description: The list of contract numbers\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+      security: []\n+      responses:\n+        200:\n+          description: Consumer counts successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                type: integer\n+        400:\n+          description: Owner key is null or empty\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Owner key is null or empty\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/consumers_system_purpose:\n+    get:\n+      description: Retrieves an aggregate of the system purpose settings of the owner's consumers\n+      tags:\n+        - Owner\n+        - Consumer\n+      operationId: getConsumersSyspurpose\n+      security: []\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+      responses:\n+        200:\n+          description:  The system purpose settings sucessfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/SystemPurposeAttributesDTO'\n+        400:\n+          description: Owner key is null or empty\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Owner key is null or empty\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: Owner key could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Owner key could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/entitlements:\n+    get:\n+      description: |\n+        Retrieves the list of entitlements for an owner.\n+        This endpoint supports paging with query parameters. For more details please visit\n+        https://www.candlepinproject.org/docs/candlepin/pagination.html#paginating-results-from-candlepin\n+      tags:\n+        - Owner\n+        - Entitlements\n+      operationId: ownerEntitlements\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+        - name: product\n+          in: query\n+          description: The product id\n+          schema:\n+            type: string\n+        - name: matches\n+          in: query\n+          description: A text to search for in various fields on the entitlements\n+          schema:\n+            type: string\n+        - name: attribute\n+          in: query\n+          description: The pair of attribute values\n+          schema:\n+            type: array\n+            items:\n+              $ref: '#/components/schemas/KeyValueParamDTO'\n+      security: []\n+      responses:\n+        200:\n+          description: Entitlement details successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                type: array\n+                items:\n+                  $ref: '#/components/schemas/EntitlementDTO'\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+    post:\n+      description: |\n+        Starts an asynchronous healing for the given Owner.\n+        At the end of the process the idea is that all of the consumers\n+        in the owned by the owner will be up to date.\n+      tags:\n+        - Owner\n+        - Entitlements\n+      operationId: healEntire\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+      security: []\n+      responses:\n+        200:\n+          description: Successfully operation\n+          content:\n+            application/json:\n+              schema:\n+               $ref: '#/components/schemas/AsyncJobStatusDTO'\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/environments:\n+    get:\n+      description: Retrieves a list of environment for an owner\n+      tags:\n+        - Owner Environment\n+      operationId: listEnvironments\n+      x-java-response:\n+        type: Iterable\n+        isContainer: true\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+        - name: name\n+          in: query\n+          description: The name of the environment\n+          schema:\n+            type: string\n+      security: []\n+      responses:\n+        200:\n+          description: Activation keys successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                type: array\n+                items:\n+                  $ref: '#/components/schemas/EnvironmentDTO'\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+    post:\n+      description: Creates an environment for the owner\n+      tags:\n+        - Owner Environment\n+      operationId: createEnv\n+      security: []\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+      requestBody:\n+        description: Environment to be created\n+        required: true\n+        content:\n+          application/json:\n+            schema:\n+              $ref: '#/components/schemas/EnvironmentDTO'\n+      responses:\n+        200:\n+          description: Environment for the owner successfully created\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/EnvironmentDTO'\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/hypervisors:\n+    get:\n+      description: Retrieves a list of hypervisors for an owner\n+      tags:\n+        - Owner\n+        - Hypervisors\n+      operationId: getHypervisors\n+      security: []\n+      x-java-response:\n+        type: Iterable\n+        isContainer: true\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+        - name: hypervisor_id\n+          in: query\n+          description: The list of hypervisor Ids\n+          required: true\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+      responses:\n+        200:\n+          description: A list of hypervisors successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ConsumerDTOArrayElement'\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/imports:\n+    get:\n+      description: Retrieves a list of import records for an owner\n+      tags:\n+        - Owner Import\n+      operationId: getImports\n+      security: []\n+      x-java-response:\n+        type: Iterable\n+        isContainer: true\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+      responses:\n+        200:\n+          description: Import records successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ImportRecordDTO'\n+        400:\n+          description: Owner key is null or empty\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Owner key is null or empty\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: An import owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An import owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+    post:\n+      description: |\n+        Imports a manifest zip file for the given organization.\n+        This will bring in any products, content, and subscriptions that were\n+        assigned to the distributor who generated the manifest.\n+      tags:\n+        - Owner Import\n+      operationId: importManifest\n+      security: []\n+      requestBody:\n+        description: A manifest file to be imported\n+        required: true\n+        content:\n+          multipart/form-data:\n+            schema:\n+              properties:\n+                input:\n+                  type: string\n+                  format: binary\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+        - name: force\n+          in: query\n+          description: This is used to override the conflicts\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+      responses:\n+        200:\n+          description: Manifest successfully imported\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ImportRecordDTO'\n+        400:\n+          description: |\n+            Bad request error. Reasons could be,\n+            Owner key is null\n+            or empty or Unknown conflict to force\n+            or format error of the data in a manifest\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: |\n+                  Bad request error. Reasons could be,\n+                  Owner key is null\n+                  or empty or Unknown conflict to force\n+                  or format error of the data in a manifest\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: An import owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An import owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        500:\n+          description: |\n+            Internal server error. Reasons could be,\n+            Reading error during importing\n+            or problem with archive\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: |\n+                  Internal server error. Reasons could be,\n+                  Reading error during importing\n+                  or problem with archive\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+    delete:\n+      description: |\n+        Removes Imports for an Owner. Cleans out all imported subscriptions\n+        and triggers a background refresh pools. Link to an upstream distributor is\n+        removed for the owner, so they can import from another distributor. Other\n+        owners can also now import the manifests originally used in this owner. This\n+        call does not differentiate between any specific import, it just destroys all\n+        subscriptions with an upstream pool ID, essentially anything from an import.\n+        Custom subscriptions will be left alone. Imports do carry rules and product\n+        information which is global to the candlepin server. This import data is *not*\n+        undone, we assume that updates to this data can be safely kept.\n+      tags:\n+        - Owner Import\n+      operationId: undoImports\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+      security: [ ]\n+      responses:\n+        200:\n+          description: Imports for an Owner successfully removed\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/AsyncJobStatusDTO'\n+        404:\n+          description: An import owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An import owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/imports/async:\n+    post:\n+      description: |\n+        Initiates an asynchronous manifest import for the given organization.\n+        This will bring in any products, content, and subscriptions that were\n+        assigned to the distributor who generated the manifest.\n+      tags:\n+        - Owner Import\n+        - Async\n+      operationId: importManifestAsync\n+      security: []\n+      requestBody:\n+        description: A manifest file to be imported\n+        required: true\n+        content:\n+          multipart/form-data:\n+            schema:\n+              properties:\n+                input:\n+                  type: string\n+                  format: binary\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+        - name: force\n+          in: query\n+          description: This is used to override the conflicts\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+      responses:\n+        200:\n+          description: Manifest successfully imported\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/AsyncJobStatusDTO'\n+        400:\n+          description: Owner key is null or empty\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Owner key is null or empty\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: An import owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An import owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        500:\n+          description: |\n+            Internal server error. Reasons could be,\n+            An unexpected exception occurred while scheduling job\n+            or error reading export archive\n+            or error storing uploaded archive for asynchronous processing\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: |\n+                  Internal server error. Reasons could be,\n+                  An unexpected exception occurred while scheduling job\n+                  or error reading export archive\n+                  or error storing uploaded archive for asynchronous processing\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/info:\n+    get:\n+      description: Retrieves the Owner Info for an Owner\n+      tags:\n+        - Owner\n+      operationId: getOwnerInfo\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+      security: []\n+      responses:\n+        200:\n+          description: Owner info successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/OwnerInfoDTO'\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/log:\n+    put:\n+      description: Sets the log level for an owner\n+      tags:\n+        - Owner log\n+      operationId: setLogLevel\n+      security: []\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+        - name: level\n+          in: query\n+          description: The log level\n+          required: true\n+          schema:\n+            type: string\n+            default: DEBUG\n+            enum:\n+              - ALL\n+              - TRACE\n+              - DEBUG\n+              - INFO\n+              - WARN\n+              - ERROR\n+              - OFF\n+      responses:\n+        200:\n+          description: Log level successfully set\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/OwnerDTO'\n+        400:\n+          description: |\n+            Provided level is not a valid log level\n+            or owner key is not provided\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: |\n+                  Provided level is not a valid log level\n+                  or owner key is not provided\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+    delete:\n+      description: Remove the log level of an owner\n+      tags:\n+        - Owner log\n+      operationId: deleteLogLevel\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The owner key\n+          required: true\n+          schema:\n+            type: string\n+      security: []\n+      responses:\n+        204:\n+          description: Owner successfully deleted\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/pools:\n+    get:\n+      description: |\n+        Retrieves a list of Pools for an Owner. This endpoint\n+        supports paging with query parameters. For more details please visit\n+        https://www.candlepinproject.org/docs/candlepin/pagination.html#paginating-results-from-candlepin\n+      tags:\n+        - Owner Pool\n+      operationId: listPools\n+      x-java-response:\n+        type: Iterable\n+        isContainer: true\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+        - name: consumer\n+          in: query\n+          description: The consumer UUID\n+          schema:\n+            type: string\n+        - name: activation_key\n+          in: query\n+          description: The activation key name\n+          schema:\n+            type: string\n+        - name: product\n+          in: query\n+          description: The product id\n+          schema:\n+            type: string\n+        - name: subscription\n+          in: query\n+          description: The subscription id\n+          schema:\n+            type: string\n+        - name: listall\n+          in: query\n+          description: Include pools that are not suited to the unit's facts\n+          schema:\n+            type: boolean\n+            default: false\n+        - name: activeon\n+          in: query\n+          description: Active on date\n+          schema:\n+            type: string\n+            format: date-time\n+        - name: matches\n+          in: query\n+          description: |\n+            Find pools matching the given pattern in a variety of fields\n+            * and ? wildcards are supported; may be specified multiple times\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: attribute\n+          in: query\n+          description: The attributes to return based on the specified types\n+          schema:\n+            type: array\n+            items:\n+              $ref: '#/components/schemas/KeyValueParamDTO'\n+        - name: add_future\n+          in: query\n+          description: |\n+            When set to true, it will add future dated pools to the result,\n+            based on the activeon date\n+          schema:\n+            type: boolean\n+            default: false\n+        - name: only_future\n+          in: query\n+          description: |\n+            When set to true, it will return only future dated pools to the result,\n+            based on the activeon date\n+          schema:\n+            type: boolean\n+            default: false\n+        - name: after\n+          in: query\n+          description: |\n+            Will only return pools with a start date after the supplied date.\n+            Overrides the activeOn date\n+          schema:\n+            type: string\n+            format: date-time\n+        - name: poolid\n+          in: query\n+          description: |\n+            One or more pool IDs to use to filter the output; only pools with IDs matching\n+            those provided will be returned; may be specified multiple times\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+      security: []\n+      responses:\n+        200:\n+          description: Consumers successfully retrieved", "originalCommit": "f41bd9062eac655526cd4d7a45db7f7c7fd4188e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDg4MDQyMg==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r494880422", "bodyText": "Done.", "author": "sonalidhome", "createdAt": "2020-09-25T09:55:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDM3ODYyNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDM4MDQyNw==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r494380427", "bodyText": "All of these (except the An owner could not be found using the provided key) should be moved to the 400 response. Instead this should list an additional error about the consumer not found using the provided uuid", "author": "nikosmoum", "createdAt": "2020-09-24T14:47:24Z", "path": "api/candlepin-api-spec.yaml", "diffHunk": "@@ -2764,55 +3067,1142 @@ paths:\n         default:\n           $ref: '#/components/responses/default'\n \n-  /owners/{owner_key}/products:\n+  /owners/{owner_key}/consumers:\n     get:\n-      description: Retrieves a list of products by owner\n+      description: Retrieves a list of Consumers for the Owner\n       tags:\n-        - Owner Product\n-      operationId: getProductsByOwner\n-      security: []\n+        - Owner\n+        - Consumer\n+      operationId: listConsumers\n       x-java-response:\n         type: Iterable\n         isContainer: true\n       parameters:\n         - name: owner_key\n           in: path\n-          description: Owner key\n+          description: The key of the owner\n           required: true\n           schema:\n             type: string\n-        - name: product\n+        - name: username\n           in: query\n-          description: List of product ID's\n-          required: true\n+          description: The username of the consumer\n+          schema:\n+            type: string\n+        - name: type\n+          in: query\n+          description: The consumer type\n           schema:\n             type: array\n+            uniqueItems: true\n             items:\n               type: string\n-      responses:\n-        200:\n-          description: Retrieves a list of products by owner\n-          content:\n-            application/json:\n-              schema:\n-                type: array\n-                items:\n-                  $ref: '#/components/schemas/ProductDTO'\n-        404:\n-          description: Owner key could not be found\n-          content:\n-            application/json:\n-              schema:\n-                $ref: '#/components/schemas/ExceptionMessage'\n-              example:\n-                displayMessage: Owner key could not be found\n-                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n-        default:\n-          $ref: '#/components/responses/default'\n-\n-    post:\n-      description: Creates a product for an owner\n-      tags:\n+        - name: uuid\n+          in: query\n+          description: The UUID of consumers\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: hypervisor_id\n+          in: query\n+          description: The hypervisor IDs\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: fact\n+          in: query\n+          description: The consumer facts\n+          schema:\n+            type: array\n+            items:\n+              $ref: '#/components/schemas/KeyValueParamDTO'\n+        - name: sku\n+          in: query\n+          description: The list of skus\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: subscription_id\n+          in: query\n+          description: The list of subscription IDs\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: contract\n+          in: query\n+          description: The list of contract numbers\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+      security: []\n+      responses:\n+        200:\n+          description: Consumers successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                type: array\n+                items:\n+                  $ref: '#/components/schemas/ConsumerDTOArrayElement'\n+        400:\n+          description: Owner key is null or empty\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Owner key is null or empty\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/consumers/count:\n+    get:\n+      description: Retrieves a count of consumers for the owner\n+      tags:\n+        - Owner\n+        - Consumer\n+      operationId: countConsumers\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+        - name: type\n+          in: query\n+          description: The type of the consumer\n+          schema:\n+            type: array\n+            uniqueItems: true\n+            items:\n+              type: string\n+        - name: sku\n+          in: query\n+          description: The list product ids\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: subscription_id\n+          in: query\n+          description: The list of subscription ids\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: contract\n+          in: query\n+          description: The list of contract numbers\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+      security: []\n+      responses:\n+        200:\n+          description: Consumer counts successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                type: integer\n+        400:\n+          description: Owner key is null or empty\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Owner key is null or empty\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/consumers_system_purpose:\n+    get:\n+      description: Retrieves an aggregate of the system purpose settings of the owner's consumers\n+      tags:\n+        - Owner\n+        - Consumer\n+      operationId: getConsumersSyspurpose\n+      security: []\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+      responses:\n+        200:\n+          description:  The system purpose settings sucessfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/SystemPurposeAttributesDTO'\n+        400:\n+          description: Owner key is null or empty\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Owner key is null or empty\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: Owner key could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Owner key could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/entitlements:\n+    get:\n+      description: |\n+        Retrieves the list of entitlements for an owner.\n+        This endpoint supports paging with query parameters. For more details please visit\n+        https://www.candlepinproject.org/docs/candlepin/pagination.html#paginating-results-from-candlepin\n+      tags:\n+        - Owner\n+        - Entitlements\n+      operationId: ownerEntitlements\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+        - name: product\n+          in: query\n+          description: The product id\n+          schema:\n+            type: string\n+        - name: matches\n+          in: query\n+          description: A text to search for in various fields on the entitlements\n+          schema:\n+            type: string\n+        - name: attribute\n+          in: query\n+          description: The pair of attribute values\n+          schema:\n+            type: array\n+            items:\n+              $ref: '#/components/schemas/KeyValueParamDTO'\n+      security: []\n+      responses:\n+        200:\n+          description: Entitlement details successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                type: array\n+                items:\n+                  $ref: '#/components/schemas/EntitlementDTO'\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+    post:\n+      description: |\n+        Starts an asynchronous healing for the given Owner.\n+        At the end of the process the idea is that all of the consumers\n+        in the owned by the owner will be up to date.\n+      tags:\n+        - Owner\n+        - Entitlements\n+      operationId: healEntire\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+      security: []\n+      responses:\n+        200:\n+          description: Successfully operation\n+          content:\n+            application/json:\n+              schema:\n+               $ref: '#/components/schemas/AsyncJobStatusDTO'\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/environments:\n+    get:\n+      description: Retrieves a list of environment for an owner\n+      tags:\n+        - Owner Environment\n+      operationId: listEnvironments\n+      x-java-response:\n+        type: Iterable\n+        isContainer: true\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+        - name: name\n+          in: query\n+          description: The name of the environment\n+          schema:\n+            type: string\n+      security: []\n+      responses:\n+        200:\n+          description: Activation keys successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                type: array\n+                items:\n+                  $ref: '#/components/schemas/EnvironmentDTO'\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+    post:\n+      description: Creates an environment for the owner\n+      tags:\n+        - Owner Environment\n+      operationId: createEnv\n+      security: []\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+      requestBody:\n+        description: Environment to be created\n+        required: true\n+        content:\n+          application/json:\n+            schema:\n+              $ref: '#/components/schemas/EnvironmentDTO'\n+      responses:\n+        200:\n+          description: Environment for the owner successfully created\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/EnvironmentDTO'\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/hypervisors:\n+    get:\n+      description: Retrieves a list of hypervisors for an owner\n+      tags:\n+        - Owner\n+        - Hypervisors\n+      operationId: getHypervisors\n+      security: []\n+      x-java-response:\n+        type: Iterable\n+        isContainer: true\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+        - name: hypervisor_id\n+          in: query\n+          description: The list of hypervisor Ids\n+          required: true\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+      responses:\n+        200:\n+          description: A list of hypervisors successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ConsumerDTOArrayElement'\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/imports:\n+    get:\n+      description: Retrieves a list of import records for an owner\n+      tags:\n+        - Owner Import\n+      operationId: getImports\n+      security: []\n+      x-java-response:\n+        type: Iterable\n+        isContainer: true\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+      responses:\n+        200:\n+          description: Import records successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ImportRecordDTO'\n+        400:\n+          description: Owner key is null or empty\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Owner key is null or empty\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: An import owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An import owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+    post:\n+      description: |\n+        Imports a manifest zip file for the given organization.\n+        This will bring in any products, content, and subscriptions that were\n+        assigned to the distributor who generated the manifest.\n+      tags:\n+        - Owner Import\n+      operationId: importManifest\n+      security: []\n+      requestBody:\n+        description: A manifest file to be imported\n+        required: true\n+        content:\n+          multipart/form-data:\n+            schema:\n+              properties:\n+                input:\n+                  type: string\n+                  format: binary\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+        - name: force\n+          in: query\n+          description: This is used to override the conflicts\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+      responses:\n+        200:\n+          description: Manifest successfully imported\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ImportRecordDTO'\n+        400:\n+          description: |\n+            Bad request error. Reasons could be,\n+            Owner key is null\n+            or empty or Unknown conflict to force\n+            or format error of the data in a manifest\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: |\n+                  Bad request error. Reasons could be,\n+                  Owner key is null\n+                  or empty or Unknown conflict to force\n+                  or format error of the data in a manifest\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: An import owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An import owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        500:\n+          description: |\n+            Internal server error. Reasons could be,\n+            Reading error during importing\n+            or problem with archive\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: |\n+                  Internal server error. Reasons could be,\n+                  Reading error during importing\n+                  or problem with archive\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+    delete:\n+      description: |\n+        Removes Imports for an Owner. Cleans out all imported subscriptions\n+        and triggers a background refresh pools. Link to an upstream distributor is\n+        removed for the owner, so they can import from another distributor. Other\n+        owners can also now import the manifests originally used in this owner. This\n+        call does not differentiate between any specific import, it just destroys all\n+        subscriptions with an upstream pool ID, essentially anything from an import.\n+        Custom subscriptions will be left alone. Imports do carry rules and product\n+        information which is global to the candlepin server. This import data is *not*\n+        undone, we assume that updates to this data can be safely kept.\n+      tags:\n+        - Owner Import\n+      operationId: undoImports\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+      security: [ ]\n+      responses:\n+        200:\n+          description: Imports for an Owner successfully removed\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/AsyncJobStatusDTO'\n+        404:\n+          description: An import owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An import owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/imports/async:\n+    post:\n+      description: |\n+        Initiates an asynchronous manifest import for the given organization.\n+        This will bring in any products, content, and subscriptions that were\n+        assigned to the distributor who generated the manifest.\n+      tags:\n+        - Owner Import\n+        - Async\n+      operationId: importManifestAsync\n+      security: []\n+      requestBody:\n+        description: A manifest file to be imported\n+        required: true\n+        content:\n+          multipart/form-data:\n+            schema:\n+              properties:\n+                input:\n+                  type: string\n+                  format: binary\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+        - name: force\n+          in: query\n+          description: This is used to override the conflicts\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+      responses:\n+        200:\n+          description: Manifest successfully imported\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/AsyncJobStatusDTO'\n+        400:\n+          description: Owner key is null or empty\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Owner key is null or empty\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: An import owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An import owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        500:\n+          description: |\n+            Internal server error. Reasons could be,\n+            An unexpected exception occurred while scheduling job\n+            or error reading export archive\n+            or error storing uploaded archive for asynchronous processing\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: |\n+                  Internal server error. Reasons could be,\n+                  An unexpected exception occurred while scheduling job\n+                  or error reading export archive\n+                  or error storing uploaded archive for asynchronous processing\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/info:\n+    get:\n+      description: Retrieves the Owner Info for an Owner\n+      tags:\n+        - Owner\n+      operationId: getOwnerInfo\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+      security: []\n+      responses:\n+        200:\n+          description: Owner info successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/OwnerInfoDTO'\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/log:\n+    put:\n+      description: Sets the log level for an owner\n+      tags:\n+        - Owner log\n+      operationId: setLogLevel\n+      security: []\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+        - name: level\n+          in: query\n+          description: The log level\n+          required: true\n+          schema:\n+            type: string\n+            default: DEBUG\n+            enum:\n+              - ALL\n+              - TRACE\n+              - DEBUG\n+              - INFO\n+              - WARN\n+              - ERROR\n+              - OFF\n+      responses:\n+        200:\n+          description: Log level successfully set\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/OwnerDTO'\n+        400:\n+          description: |\n+            Provided level is not a valid log level\n+            or owner key is not provided\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: |\n+                  Provided level is not a valid log level\n+                  or owner key is not provided\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+    delete:\n+      description: Remove the log level of an owner\n+      tags:\n+        - Owner log\n+      operationId: deleteLogLevel\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The owner key\n+          required: true\n+          schema:\n+            type: string\n+      security: []\n+      responses:\n+        204:\n+          description: Owner successfully deleted\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/pools:\n+    get:\n+      description: |\n+        Retrieves a list of Pools for an Owner. This endpoint\n+        supports paging with query parameters. For more details please visit\n+        https://www.candlepinproject.org/docs/candlepin/pagination.html#paginating-results-from-candlepin\n+      tags:\n+        - Owner Pool\n+      operationId: listPools\n+      x-java-response:\n+        type: Iterable\n+        isContainer: true\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+        - name: consumer\n+          in: query\n+          description: The consumer UUID\n+          schema:\n+            type: string\n+        - name: activation_key\n+          in: query\n+          description: The activation key name\n+          schema:\n+            type: string\n+        - name: product\n+          in: query\n+          description: The product id\n+          schema:\n+            type: string\n+        - name: subscription\n+          in: query\n+          description: The subscription id\n+          schema:\n+            type: string\n+        - name: listall\n+          in: query\n+          description: Include pools that are not suited to the unit's facts\n+          schema:\n+            type: boolean\n+            default: false\n+        - name: activeon\n+          in: query\n+          description: Active on date\n+          schema:\n+            type: string\n+            format: date-time\n+        - name: matches\n+          in: query\n+          description: |\n+            Find pools matching the given pattern in a variety of fields\n+            * and ? wildcards are supported; may be specified multiple times\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: attribute\n+          in: query\n+          description: The attributes to return based on the specified types\n+          schema:\n+            type: array\n+            items:\n+              $ref: '#/components/schemas/KeyValueParamDTO'\n+        - name: add_future\n+          in: query\n+          description: |\n+            When set to true, it will add future dated pools to the result,\n+            based on the activeon date\n+          schema:\n+            type: boolean\n+            default: false\n+        - name: only_future\n+          in: query\n+          description: |\n+            When set to true, it will return only future dated pools to the result,\n+            based on the activeon date\n+          schema:\n+            type: boolean\n+            default: false\n+        - name: after\n+          in: query\n+          description: |\n+            Will only return pools with a start date after the supplied date.\n+            Overrides the activeOn date\n+          schema:\n+            type: string\n+            format: date-time\n+        - name: poolid\n+          in: query\n+          description: |\n+            One or more pool IDs to use to filter the output; only pools with IDs matching\n+            those provided will be returned; may be specified multiple times\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+      security: []\n+      responses:\n+        200:\n+          description: Consumers successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                type: array\n+                items:\n+                  $ref: '#/components/schemas/PoolDTO'\n+        400:\n+          description: Owner key is null or empty\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Owner key is null or empty\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        403:\n+          description: User cannot access the consumer\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: User cannot access the consumer\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: |\n+            Invalid inputs, pools cannot be listed.\n+            Reasons could be,\n+            An owner could not be found using the provided key\n+            or the consumer specified does not belong to owner on path\n+            or activationKey could not be found with provided key\n+            or the flags add_future and only_future cannot be used at the same time\n+            or the flags add_future and only_future cannot be used with the parameter after", "originalCommit": "f41bd9062eac655526cd4d7a45db7f7c7fd4188e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDg4MDQwOQ==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r494880409", "bodyText": "Corrected.", "author": "sonalidhome", "createdAt": "2020-09-25T09:55:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDM4MDQyNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDM4MTg1MQ==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r494381851", "bodyText": "this is not the actual description of the response where listing all possible messages is needed, but an example, so we should only be showing one of all those errors. Also, as with the description on this response, most of these do not belong on the 404, but on the 400", "author": "nikosmoum", "createdAt": "2020-09-24T14:49:11Z", "path": "api/candlepin-api-spec.yaml", "diffHunk": "@@ -2764,55 +3067,1142 @@ paths:\n         default:\n           $ref: '#/components/responses/default'\n \n-  /owners/{owner_key}/products:\n+  /owners/{owner_key}/consumers:\n     get:\n-      description: Retrieves a list of products by owner\n+      description: Retrieves a list of Consumers for the Owner\n       tags:\n-        - Owner Product\n-      operationId: getProductsByOwner\n-      security: []\n+        - Owner\n+        - Consumer\n+      operationId: listConsumers\n       x-java-response:\n         type: Iterable\n         isContainer: true\n       parameters:\n         - name: owner_key\n           in: path\n-          description: Owner key\n+          description: The key of the owner\n           required: true\n           schema:\n             type: string\n-        - name: product\n+        - name: username\n           in: query\n-          description: List of product ID's\n-          required: true\n+          description: The username of the consumer\n+          schema:\n+            type: string\n+        - name: type\n+          in: query\n+          description: The consumer type\n           schema:\n             type: array\n+            uniqueItems: true\n             items:\n               type: string\n-      responses:\n-        200:\n-          description: Retrieves a list of products by owner\n-          content:\n-            application/json:\n-              schema:\n-                type: array\n-                items:\n-                  $ref: '#/components/schemas/ProductDTO'\n-        404:\n-          description: Owner key could not be found\n-          content:\n-            application/json:\n-              schema:\n-                $ref: '#/components/schemas/ExceptionMessage'\n-              example:\n-                displayMessage: Owner key could not be found\n-                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n-        default:\n-          $ref: '#/components/responses/default'\n-\n-    post:\n-      description: Creates a product for an owner\n-      tags:\n+        - name: uuid\n+          in: query\n+          description: The UUID of consumers\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: hypervisor_id\n+          in: query\n+          description: The hypervisor IDs\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: fact\n+          in: query\n+          description: The consumer facts\n+          schema:\n+            type: array\n+            items:\n+              $ref: '#/components/schemas/KeyValueParamDTO'\n+        - name: sku\n+          in: query\n+          description: The list of skus\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: subscription_id\n+          in: query\n+          description: The list of subscription IDs\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: contract\n+          in: query\n+          description: The list of contract numbers\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+      security: []\n+      responses:\n+        200:\n+          description: Consumers successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                type: array\n+                items:\n+                  $ref: '#/components/schemas/ConsumerDTOArrayElement'\n+        400:\n+          description: Owner key is null or empty\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Owner key is null or empty\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/consumers/count:\n+    get:\n+      description: Retrieves a count of consumers for the owner\n+      tags:\n+        - Owner\n+        - Consumer\n+      operationId: countConsumers\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+        - name: type\n+          in: query\n+          description: The type of the consumer\n+          schema:\n+            type: array\n+            uniqueItems: true\n+            items:\n+              type: string\n+        - name: sku\n+          in: query\n+          description: The list product ids\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: subscription_id\n+          in: query\n+          description: The list of subscription ids\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: contract\n+          in: query\n+          description: The list of contract numbers\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+      security: []\n+      responses:\n+        200:\n+          description: Consumer counts successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                type: integer\n+        400:\n+          description: Owner key is null or empty\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Owner key is null or empty\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/consumers_system_purpose:\n+    get:\n+      description: Retrieves an aggregate of the system purpose settings of the owner's consumers\n+      tags:\n+        - Owner\n+        - Consumer\n+      operationId: getConsumersSyspurpose\n+      security: []\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+      responses:\n+        200:\n+          description:  The system purpose settings sucessfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/SystemPurposeAttributesDTO'\n+        400:\n+          description: Owner key is null or empty\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Owner key is null or empty\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: Owner key could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Owner key could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/entitlements:\n+    get:\n+      description: |\n+        Retrieves the list of entitlements for an owner.\n+        This endpoint supports paging with query parameters. For more details please visit\n+        https://www.candlepinproject.org/docs/candlepin/pagination.html#paginating-results-from-candlepin\n+      tags:\n+        - Owner\n+        - Entitlements\n+      operationId: ownerEntitlements\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+        - name: product\n+          in: query\n+          description: The product id\n+          schema:\n+            type: string\n+        - name: matches\n+          in: query\n+          description: A text to search for in various fields on the entitlements\n+          schema:\n+            type: string\n+        - name: attribute\n+          in: query\n+          description: The pair of attribute values\n+          schema:\n+            type: array\n+            items:\n+              $ref: '#/components/schemas/KeyValueParamDTO'\n+      security: []\n+      responses:\n+        200:\n+          description: Entitlement details successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                type: array\n+                items:\n+                  $ref: '#/components/schemas/EntitlementDTO'\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+    post:\n+      description: |\n+        Starts an asynchronous healing for the given Owner.\n+        At the end of the process the idea is that all of the consumers\n+        in the owned by the owner will be up to date.\n+      tags:\n+        - Owner\n+        - Entitlements\n+      operationId: healEntire\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+      security: []\n+      responses:\n+        200:\n+          description: Successfully operation\n+          content:\n+            application/json:\n+              schema:\n+               $ref: '#/components/schemas/AsyncJobStatusDTO'\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/environments:\n+    get:\n+      description: Retrieves a list of environment for an owner\n+      tags:\n+        - Owner Environment\n+      operationId: listEnvironments\n+      x-java-response:\n+        type: Iterable\n+        isContainer: true\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+        - name: name\n+          in: query\n+          description: The name of the environment\n+          schema:\n+            type: string\n+      security: []\n+      responses:\n+        200:\n+          description: Activation keys successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                type: array\n+                items:\n+                  $ref: '#/components/schemas/EnvironmentDTO'\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+    post:\n+      description: Creates an environment for the owner\n+      tags:\n+        - Owner Environment\n+      operationId: createEnv\n+      security: []\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+      requestBody:\n+        description: Environment to be created\n+        required: true\n+        content:\n+          application/json:\n+            schema:\n+              $ref: '#/components/schemas/EnvironmentDTO'\n+      responses:\n+        200:\n+          description: Environment for the owner successfully created\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/EnvironmentDTO'\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/hypervisors:\n+    get:\n+      description: Retrieves a list of hypervisors for an owner\n+      tags:\n+        - Owner\n+        - Hypervisors\n+      operationId: getHypervisors\n+      security: []\n+      x-java-response:\n+        type: Iterable\n+        isContainer: true\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+        - name: hypervisor_id\n+          in: query\n+          description: The list of hypervisor Ids\n+          required: true\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+      responses:\n+        200:\n+          description: A list of hypervisors successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ConsumerDTOArrayElement'\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/imports:\n+    get:\n+      description: Retrieves a list of import records for an owner\n+      tags:\n+        - Owner Import\n+      operationId: getImports\n+      security: []\n+      x-java-response:\n+        type: Iterable\n+        isContainer: true\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+      responses:\n+        200:\n+          description: Import records successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ImportRecordDTO'\n+        400:\n+          description: Owner key is null or empty\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Owner key is null or empty\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: An import owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An import owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+    post:\n+      description: |\n+        Imports a manifest zip file for the given organization.\n+        This will bring in any products, content, and subscriptions that were\n+        assigned to the distributor who generated the manifest.\n+      tags:\n+        - Owner Import\n+      operationId: importManifest\n+      security: []\n+      requestBody:\n+        description: A manifest file to be imported\n+        required: true\n+        content:\n+          multipart/form-data:\n+            schema:\n+              properties:\n+                input:\n+                  type: string\n+                  format: binary\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+        - name: force\n+          in: query\n+          description: This is used to override the conflicts\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+      responses:\n+        200:\n+          description: Manifest successfully imported\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ImportRecordDTO'\n+        400:\n+          description: |\n+            Bad request error. Reasons could be,\n+            Owner key is null\n+            or empty or Unknown conflict to force\n+            or format error of the data in a manifest\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: |\n+                  Bad request error. Reasons could be,\n+                  Owner key is null\n+                  or empty or Unknown conflict to force\n+                  or format error of the data in a manifest\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: An import owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An import owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        500:\n+          description: |\n+            Internal server error. Reasons could be,\n+            Reading error during importing\n+            or problem with archive\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: |\n+                  Internal server error. Reasons could be,\n+                  Reading error during importing\n+                  or problem with archive\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+    delete:\n+      description: |\n+        Removes Imports for an Owner. Cleans out all imported subscriptions\n+        and triggers a background refresh pools. Link to an upstream distributor is\n+        removed for the owner, so they can import from another distributor. Other\n+        owners can also now import the manifests originally used in this owner. This\n+        call does not differentiate between any specific import, it just destroys all\n+        subscriptions with an upstream pool ID, essentially anything from an import.\n+        Custom subscriptions will be left alone. Imports do carry rules and product\n+        information which is global to the candlepin server. This import data is *not*\n+        undone, we assume that updates to this data can be safely kept.\n+      tags:\n+        - Owner Import\n+      operationId: undoImports\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+      security: [ ]\n+      responses:\n+        200:\n+          description: Imports for an Owner successfully removed\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/AsyncJobStatusDTO'\n+        404:\n+          description: An import owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An import owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/imports/async:\n+    post:\n+      description: |\n+        Initiates an asynchronous manifest import for the given organization.\n+        This will bring in any products, content, and subscriptions that were\n+        assigned to the distributor who generated the manifest.\n+      tags:\n+        - Owner Import\n+        - Async\n+      operationId: importManifestAsync\n+      security: []\n+      requestBody:\n+        description: A manifest file to be imported\n+        required: true\n+        content:\n+          multipart/form-data:\n+            schema:\n+              properties:\n+                input:\n+                  type: string\n+                  format: binary\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+        - name: force\n+          in: query\n+          description: This is used to override the conflicts\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+      responses:\n+        200:\n+          description: Manifest successfully imported\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/AsyncJobStatusDTO'\n+        400:\n+          description: Owner key is null or empty\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Owner key is null or empty\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: An import owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An import owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        500:\n+          description: |\n+            Internal server error. Reasons could be,\n+            An unexpected exception occurred while scheduling job\n+            or error reading export archive\n+            or error storing uploaded archive for asynchronous processing\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: |\n+                  Internal server error. Reasons could be,\n+                  An unexpected exception occurred while scheduling job\n+                  or error reading export archive\n+                  or error storing uploaded archive for asynchronous processing\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/info:\n+    get:\n+      description: Retrieves the Owner Info for an Owner\n+      tags:\n+        - Owner\n+      operationId: getOwnerInfo\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+      security: []\n+      responses:\n+        200:\n+          description: Owner info successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/OwnerInfoDTO'\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/log:\n+    put:\n+      description: Sets the log level for an owner\n+      tags:\n+        - Owner log\n+      operationId: setLogLevel\n+      security: []\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+        - name: level\n+          in: query\n+          description: The log level\n+          required: true\n+          schema:\n+            type: string\n+            default: DEBUG\n+            enum:\n+              - ALL\n+              - TRACE\n+              - DEBUG\n+              - INFO\n+              - WARN\n+              - ERROR\n+              - OFF\n+      responses:\n+        200:\n+          description: Log level successfully set\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/OwnerDTO'\n+        400:\n+          description: |\n+            Provided level is not a valid log level\n+            or owner key is not provided\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: |\n+                  Provided level is not a valid log level\n+                  or owner key is not provided\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+    delete:\n+      description: Remove the log level of an owner\n+      tags:\n+        - Owner log\n+      operationId: deleteLogLevel\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The owner key\n+          required: true\n+          schema:\n+            type: string\n+      security: []\n+      responses:\n+        204:\n+          description: Owner successfully deleted\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/pools:\n+    get:\n+      description: |\n+        Retrieves a list of Pools for an Owner. This endpoint\n+        supports paging with query parameters. For more details please visit\n+        https://www.candlepinproject.org/docs/candlepin/pagination.html#paginating-results-from-candlepin\n+      tags:\n+        - Owner Pool\n+      operationId: listPools\n+      x-java-response:\n+        type: Iterable\n+        isContainer: true\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+        - name: consumer\n+          in: query\n+          description: The consumer UUID\n+          schema:\n+            type: string\n+        - name: activation_key\n+          in: query\n+          description: The activation key name\n+          schema:\n+            type: string\n+        - name: product\n+          in: query\n+          description: The product id\n+          schema:\n+            type: string\n+        - name: subscription\n+          in: query\n+          description: The subscription id\n+          schema:\n+            type: string\n+        - name: listall\n+          in: query\n+          description: Include pools that are not suited to the unit's facts\n+          schema:\n+            type: boolean\n+            default: false\n+        - name: activeon\n+          in: query\n+          description: Active on date\n+          schema:\n+            type: string\n+            format: date-time\n+        - name: matches\n+          in: query\n+          description: |\n+            Find pools matching the given pattern in a variety of fields\n+            * and ? wildcards are supported; may be specified multiple times\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: attribute\n+          in: query\n+          description: The attributes to return based on the specified types\n+          schema:\n+            type: array\n+            items:\n+              $ref: '#/components/schemas/KeyValueParamDTO'\n+        - name: add_future\n+          in: query\n+          description: |\n+            When set to true, it will add future dated pools to the result,\n+            based on the activeon date\n+          schema:\n+            type: boolean\n+            default: false\n+        - name: only_future\n+          in: query\n+          description: |\n+            When set to true, it will return only future dated pools to the result,\n+            based on the activeon date\n+          schema:\n+            type: boolean\n+            default: false\n+        - name: after\n+          in: query\n+          description: |\n+            Will only return pools with a start date after the supplied date.\n+            Overrides the activeOn date\n+          schema:\n+            type: string\n+            format: date-time\n+        - name: poolid\n+          in: query\n+          description: |\n+            One or more pool IDs to use to filter the output; only pools with IDs matching\n+            those provided will be returned; may be specified multiple times\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+      security: []\n+      responses:\n+        200:\n+          description: Consumers successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                type: array\n+                items:\n+                  $ref: '#/components/schemas/PoolDTO'\n+        400:\n+          description: Owner key is null or empty\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Owner key is null or empty\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        403:\n+          description: User cannot access the consumer\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: User cannot access the consumer\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: |\n+            Invalid inputs, pools cannot be listed.\n+            Reasons could be,\n+            An owner could not be found using the provided key\n+            or the consumer specified does not belong to owner on path\n+            or activationKey could not be found with provided key\n+            or the flags add_future and only_future cannot be used at the same time\n+            or the flags add_future and only_future cannot be used with the parameter after\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: |\n+                  Invalid inputs, pools cannot be listed.\n+                  Reasons could be,\n+                  An owner could not be found using the provided key\n+                  or the consumer specified does not belong to owner on path\n+                  or activationKey could not be found with provided key\n+                  or the flags add_future and only_future cannot be used at the same time\n+                  or the flags add_future and only_future cannot be used with the parameter after", "originalCommit": "f41bd9062eac655526cd4d7a45db7f7c7fd4188e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDg4MDM5Mw==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r494880393", "bodyText": "Corrected.", "author": "sonalidhome", "createdAt": "2020-09-25T09:55:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDM4MTg1MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDM5MjU3OQ==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r494392579", "bodyText": "updated instead of created", "author": "nikosmoum", "createdAt": "2020-09-24T15:02:56Z", "path": "api/candlepin-api-spec.yaml", "diffHunk": "@@ -2764,55 +3067,1142 @@ paths:\n         default:\n           $ref: '#/components/responses/default'\n \n-  /owners/{owner_key}/products:\n+  /owners/{owner_key}/consumers:\n     get:\n-      description: Retrieves a list of products by owner\n+      description: Retrieves a list of Consumers for the Owner\n       tags:\n-        - Owner Product\n-      operationId: getProductsByOwner\n-      security: []\n+        - Owner\n+        - Consumer\n+      operationId: listConsumers\n       x-java-response:\n         type: Iterable\n         isContainer: true\n       parameters:\n         - name: owner_key\n           in: path\n-          description: Owner key\n+          description: The key of the owner\n           required: true\n           schema:\n             type: string\n-        - name: product\n+        - name: username\n           in: query\n-          description: List of product ID's\n-          required: true\n+          description: The username of the consumer\n+          schema:\n+            type: string\n+        - name: type\n+          in: query\n+          description: The consumer type\n           schema:\n             type: array\n+            uniqueItems: true\n             items:\n               type: string\n-      responses:\n-        200:\n-          description: Retrieves a list of products by owner\n-          content:\n-            application/json:\n-              schema:\n-                type: array\n-                items:\n-                  $ref: '#/components/schemas/ProductDTO'\n-        404:\n-          description: Owner key could not be found\n-          content:\n-            application/json:\n-              schema:\n-                $ref: '#/components/schemas/ExceptionMessage'\n-              example:\n-                displayMessage: Owner key could not be found\n-                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n-        default:\n-          $ref: '#/components/responses/default'\n-\n-    post:\n-      description: Creates a product for an owner\n-      tags:\n+        - name: uuid\n+          in: query\n+          description: The UUID of consumers\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: hypervisor_id\n+          in: query\n+          description: The hypervisor IDs\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: fact\n+          in: query\n+          description: The consumer facts\n+          schema:\n+            type: array\n+            items:\n+              $ref: '#/components/schemas/KeyValueParamDTO'\n+        - name: sku\n+          in: query\n+          description: The list of skus\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: subscription_id\n+          in: query\n+          description: The list of subscription IDs\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: contract\n+          in: query\n+          description: The list of contract numbers\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+      security: []\n+      responses:\n+        200:\n+          description: Consumers successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                type: array\n+                items:\n+                  $ref: '#/components/schemas/ConsumerDTOArrayElement'\n+        400:\n+          description: Owner key is null or empty\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Owner key is null or empty\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/consumers/count:\n+    get:\n+      description: Retrieves a count of consumers for the owner\n+      tags:\n+        - Owner\n+        - Consumer\n+      operationId: countConsumers\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+        - name: type\n+          in: query\n+          description: The type of the consumer\n+          schema:\n+            type: array\n+            uniqueItems: true\n+            items:\n+              type: string\n+        - name: sku\n+          in: query\n+          description: The list product ids\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: subscription_id\n+          in: query\n+          description: The list of subscription ids\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: contract\n+          in: query\n+          description: The list of contract numbers\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+      security: []\n+      responses:\n+        200:\n+          description: Consumer counts successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                type: integer\n+        400:\n+          description: Owner key is null or empty\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Owner key is null or empty\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/consumers_system_purpose:\n+    get:\n+      description: Retrieves an aggregate of the system purpose settings of the owner's consumers\n+      tags:\n+        - Owner\n+        - Consumer\n+      operationId: getConsumersSyspurpose\n+      security: []\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+      responses:\n+        200:\n+          description:  The system purpose settings sucessfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/SystemPurposeAttributesDTO'\n+        400:\n+          description: Owner key is null or empty\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Owner key is null or empty\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: Owner key could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Owner key could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/entitlements:\n+    get:\n+      description: |\n+        Retrieves the list of entitlements for an owner.\n+        This endpoint supports paging with query parameters. For more details please visit\n+        https://www.candlepinproject.org/docs/candlepin/pagination.html#paginating-results-from-candlepin\n+      tags:\n+        - Owner\n+        - Entitlements\n+      operationId: ownerEntitlements\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+        - name: product\n+          in: query\n+          description: The product id\n+          schema:\n+            type: string\n+        - name: matches\n+          in: query\n+          description: A text to search for in various fields on the entitlements\n+          schema:\n+            type: string\n+        - name: attribute\n+          in: query\n+          description: The pair of attribute values\n+          schema:\n+            type: array\n+            items:\n+              $ref: '#/components/schemas/KeyValueParamDTO'\n+      security: []\n+      responses:\n+        200:\n+          description: Entitlement details successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                type: array\n+                items:\n+                  $ref: '#/components/schemas/EntitlementDTO'\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+    post:\n+      description: |\n+        Starts an asynchronous healing for the given Owner.\n+        At the end of the process the idea is that all of the consumers\n+        in the owned by the owner will be up to date.\n+      tags:\n+        - Owner\n+        - Entitlements\n+      operationId: healEntire\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+      security: []\n+      responses:\n+        200:\n+          description: Successfully operation\n+          content:\n+            application/json:\n+              schema:\n+               $ref: '#/components/schemas/AsyncJobStatusDTO'\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/environments:\n+    get:\n+      description: Retrieves a list of environment for an owner\n+      tags:\n+        - Owner Environment\n+      operationId: listEnvironments\n+      x-java-response:\n+        type: Iterable\n+        isContainer: true\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+        - name: name\n+          in: query\n+          description: The name of the environment\n+          schema:\n+            type: string\n+      security: []\n+      responses:\n+        200:\n+          description: Activation keys successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                type: array\n+                items:\n+                  $ref: '#/components/schemas/EnvironmentDTO'\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+    post:\n+      description: Creates an environment for the owner\n+      tags:\n+        - Owner Environment\n+      operationId: createEnv\n+      security: []\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+      requestBody:\n+        description: Environment to be created\n+        required: true\n+        content:\n+          application/json:\n+            schema:\n+              $ref: '#/components/schemas/EnvironmentDTO'\n+      responses:\n+        200:\n+          description: Environment for the owner successfully created\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/EnvironmentDTO'\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/hypervisors:\n+    get:\n+      description: Retrieves a list of hypervisors for an owner\n+      tags:\n+        - Owner\n+        - Hypervisors\n+      operationId: getHypervisors\n+      security: []\n+      x-java-response:\n+        type: Iterable\n+        isContainer: true\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+        - name: hypervisor_id\n+          in: query\n+          description: The list of hypervisor Ids\n+          required: true\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+      responses:\n+        200:\n+          description: A list of hypervisors successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ConsumerDTOArrayElement'\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/imports:\n+    get:\n+      description: Retrieves a list of import records for an owner\n+      tags:\n+        - Owner Import\n+      operationId: getImports\n+      security: []\n+      x-java-response:\n+        type: Iterable\n+        isContainer: true\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+      responses:\n+        200:\n+          description: Import records successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ImportRecordDTO'\n+        400:\n+          description: Owner key is null or empty\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Owner key is null or empty\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: An import owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An import owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+    post:\n+      description: |\n+        Imports a manifest zip file for the given organization.\n+        This will bring in any products, content, and subscriptions that were\n+        assigned to the distributor who generated the manifest.\n+      tags:\n+        - Owner Import\n+      operationId: importManifest\n+      security: []\n+      requestBody:\n+        description: A manifest file to be imported\n+        required: true\n+        content:\n+          multipart/form-data:\n+            schema:\n+              properties:\n+                input:\n+                  type: string\n+                  format: binary\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+        - name: force\n+          in: query\n+          description: This is used to override the conflicts\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+      responses:\n+        200:\n+          description: Manifest successfully imported\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ImportRecordDTO'\n+        400:\n+          description: |\n+            Bad request error. Reasons could be,\n+            Owner key is null\n+            or empty or Unknown conflict to force\n+            or format error of the data in a manifest\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: |\n+                  Bad request error. Reasons could be,\n+                  Owner key is null\n+                  or empty or Unknown conflict to force\n+                  or format error of the data in a manifest\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: An import owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An import owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        500:\n+          description: |\n+            Internal server error. Reasons could be,\n+            Reading error during importing\n+            or problem with archive\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: |\n+                  Internal server error. Reasons could be,\n+                  Reading error during importing\n+                  or problem with archive\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+    delete:\n+      description: |\n+        Removes Imports for an Owner. Cleans out all imported subscriptions\n+        and triggers a background refresh pools. Link to an upstream distributor is\n+        removed for the owner, so they can import from another distributor. Other\n+        owners can also now import the manifests originally used in this owner. This\n+        call does not differentiate between any specific import, it just destroys all\n+        subscriptions with an upstream pool ID, essentially anything from an import.\n+        Custom subscriptions will be left alone. Imports do carry rules and product\n+        information which is global to the candlepin server. This import data is *not*\n+        undone, we assume that updates to this data can be safely kept.\n+      tags:\n+        - Owner Import\n+      operationId: undoImports\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+      security: [ ]\n+      responses:\n+        200:\n+          description: Imports for an Owner successfully removed\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/AsyncJobStatusDTO'\n+        404:\n+          description: An import owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An import owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/imports/async:\n+    post:\n+      description: |\n+        Initiates an asynchronous manifest import for the given organization.\n+        This will bring in any products, content, and subscriptions that were\n+        assigned to the distributor who generated the manifest.\n+      tags:\n+        - Owner Import\n+        - Async\n+      operationId: importManifestAsync\n+      security: []\n+      requestBody:\n+        description: A manifest file to be imported\n+        required: true\n+        content:\n+          multipart/form-data:\n+            schema:\n+              properties:\n+                input:\n+                  type: string\n+                  format: binary\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+        - name: force\n+          in: query\n+          description: This is used to override the conflicts\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+      responses:\n+        200:\n+          description: Manifest successfully imported\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/AsyncJobStatusDTO'\n+        400:\n+          description: Owner key is null or empty\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Owner key is null or empty\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: An import owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An import owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        500:\n+          description: |\n+            Internal server error. Reasons could be,\n+            An unexpected exception occurred while scheduling job\n+            or error reading export archive\n+            or error storing uploaded archive for asynchronous processing\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: |\n+                  Internal server error. Reasons could be,\n+                  An unexpected exception occurred while scheduling job\n+                  or error reading export archive\n+                  or error storing uploaded archive for asynchronous processing\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/info:\n+    get:\n+      description: Retrieves the Owner Info for an Owner\n+      tags:\n+        - Owner\n+      operationId: getOwnerInfo\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+      security: []\n+      responses:\n+        200:\n+          description: Owner info successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/OwnerInfoDTO'\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/log:\n+    put:\n+      description: Sets the log level for an owner\n+      tags:\n+        - Owner log\n+      operationId: setLogLevel\n+      security: []\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+        - name: level\n+          in: query\n+          description: The log level\n+          required: true\n+          schema:\n+            type: string\n+            default: DEBUG\n+            enum:\n+              - ALL\n+              - TRACE\n+              - DEBUG\n+              - INFO\n+              - WARN\n+              - ERROR\n+              - OFF\n+      responses:\n+        200:\n+          description: Log level successfully set\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/OwnerDTO'\n+        400:\n+          description: |\n+            Provided level is not a valid log level\n+            or owner key is not provided\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: |\n+                  Provided level is not a valid log level\n+                  or owner key is not provided\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+    delete:\n+      description: Remove the log level of an owner\n+      tags:\n+        - Owner log\n+      operationId: deleteLogLevel\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The owner key\n+          required: true\n+          schema:\n+            type: string\n+      security: []\n+      responses:\n+        204:\n+          description: Owner successfully deleted\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+  /owners/{owner_key}/pools:\n+    get:\n+      description: |\n+        Retrieves a list of Pools for an Owner. This endpoint\n+        supports paging with query parameters. For more details please visit\n+        https://www.candlepinproject.org/docs/candlepin/pagination.html#paginating-results-from-candlepin\n+      tags:\n+        - Owner Pool\n+      operationId: listPools\n+      x-java-response:\n+        type: Iterable\n+        isContainer: true\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+        - name: consumer\n+          in: query\n+          description: The consumer UUID\n+          schema:\n+            type: string\n+        - name: activation_key\n+          in: query\n+          description: The activation key name\n+          schema:\n+            type: string\n+        - name: product\n+          in: query\n+          description: The product id\n+          schema:\n+            type: string\n+        - name: subscription\n+          in: query\n+          description: The subscription id\n+          schema:\n+            type: string\n+        - name: listall\n+          in: query\n+          description: Include pools that are not suited to the unit's facts\n+          schema:\n+            type: boolean\n+            default: false\n+        - name: activeon\n+          in: query\n+          description: Active on date\n+          schema:\n+            type: string\n+            format: date-time\n+        - name: matches\n+          in: query\n+          description: |\n+            Find pools matching the given pattern in a variety of fields\n+            * and ? wildcards are supported; may be specified multiple times\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+        - name: attribute\n+          in: query\n+          description: The attributes to return based on the specified types\n+          schema:\n+            type: array\n+            items:\n+              $ref: '#/components/schemas/KeyValueParamDTO'\n+        - name: add_future\n+          in: query\n+          description: |\n+            When set to true, it will add future dated pools to the result,\n+            based on the activeon date\n+          schema:\n+            type: boolean\n+            default: false\n+        - name: only_future\n+          in: query\n+          description: |\n+            When set to true, it will return only future dated pools to the result,\n+            based on the activeon date\n+          schema:\n+            type: boolean\n+            default: false\n+        - name: after\n+          in: query\n+          description: |\n+            Will only return pools with a start date after the supplied date.\n+            Overrides the activeOn date\n+          schema:\n+            type: string\n+            format: date-time\n+        - name: poolid\n+          in: query\n+          description: |\n+            One or more pool IDs to use to filter the output; only pools with IDs matching\n+            those provided will be returned; may be specified multiple times\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+      security: []\n+      responses:\n+        200:\n+          description: Consumers successfully retrieved\n+          content:\n+            application/json:\n+              schema:\n+                type: array\n+                items:\n+                  $ref: '#/components/schemas/PoolDTO'\n+        400:\n+          description: Owner key is null or empty\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Owner key is null or empty\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        403:\n+          description: User cannot access the consumer\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: User cannot access the consumer\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: |\n+            Invalid inputs, pools cannot be listed.\n+            Reasons could be,\n+            An owner could not be found using the provided key\n+            or the consumer specified does not belong to owner on path\n+            or activationKey could not be found with provided key\n+            or the flags add_future and only_future cannot be used at the same time\n+            or the flags add_future and only_future cannot be used with the parameter after\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: |\n+                  Invalid inputs, pools cannot be listed.\n+                  Reasons could be,\n+                  An owner could not be found using the provided key\n+                  or the consumer specified does not belong to owner on path\n+                  or activationKey could not be found with provided key\n+                  or the flags add_future and only_future cannot be used at the same time\n+                  or the flags add_future and only_future cannot be used with the parameter after\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+    post:\n+      description: |\n+        Creates a custom pool for an Owner. Floating pools are not tied to any\n+        upstream subscription, and are most commonly used for custom content delivery\n+        in Satellite. Also helps in on-site deployment testing\n+      tags:\n+        - Owner Pool\n+      operationId: createPool\n+      security: []\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: The key of the owner\n+          required: true\n+          schema:\n+            type: string\n+      requestBody:\n+        description: A pool to be created\n+        required: true\n+        content:\n+          application/json:\n+            schema:\n+              $ref: '#/components/schemas/PoolDTO'\n+      responses:\n+        200:\n+          description: Pool successfully created\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/PoolDTO'\n+        400:\n+          description: |\n+            Invalid inputs, pool cannot be created.\n+            Reasons could be,\n+            Owner key is null or empty\n+            or Pool product ID not specified\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: Invalid inputs, pool cannot be created.\n+                  Reasons could be,\n+                  Owner key is null or empty\n+                  or Pool product ID not specified\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        404:\n+          description: An owner could not be found using the provided key\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+              example:\n+                displayMessage: An owner could not be found using the provided key\n+                requestUuid: c4347004-8792-41fe-a4d8-fccaa0d3898a\n+        default:\n+          $ref: '#/components/responses/default'\n+\n+    put:\n+      description: |\n+        Updates a pool for an Owner. assumes this is a normal pool, and\n+        errors out otherwise cause we cannot create master pools from bonus pools\n+      tags:\n+        - Owner Pool\n+      operationId: updatePool\n+      security: []\n+      parameters:\n+        - name: owner_key\n+          in: path\n+          description: Owner key\n+          required: true\n+          schema:\n+            type: string\n+      requestBody:\n+        description: A pool to be created", "originalCommit": "f41bd9062eac655526cd4d7a45db7f7c7fd4188e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDg4MDM3Ng==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r494880376", "bodyText": "Done.", "author": "sonalidhome", "createdAt": "2020-09-25T09:55:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDM5MjU3OQ=="}], "type": "inlineReview"}, {"oid": "9c9100393632dbac61ed2a3e09ca7a1b1266f590", "url": "https://github.com/candlepin/candlepin/commit/9c9100393632dbac61ed2a3e09ca7a1b1266f590", "message": "ENT-1848: Port OwnerResource to spec-first\n - Added endpoints definitions\n - Added specifications for following DTOs\n   1. AbstractCertificateDTO\n   2. ConsumptionTypeCountsDTO\n   3. ImportRecordDTO\n   4. ImportUpstreamConsumerDTO\n   5. OwnerInfoDTO\n   6. SystemPurposeAttributesDTO\n   7. UeberCertificateDTO\n   8. UpstreamConsumerArrayElement\n - Created/updated translators for DTOs", "committedDate": "2020-09-25T08:43:49Z", "type": "forcePushed"}, {"oid": "482111a75c24579277f968f9677f7c09b2141db4", "url": "https://github.com/candlepin/candlepin/commit/482111a75c24579277f968f9677f7c09b2141db4", "message": "ENT-1848: Port OwnerResource to spec-first\n - Added endpoints definitions\n - Added specifications for following DTOs\n   1. AbstractCertificateDTO\n   2. ConsumptionTypeCountsDTO\n   3. ImportRecordDTO\n   4. ImportUpstreamConsumerDTO\n   5. OwnerInfoDTO\n   6. SystemPurposeAttributesDTO\n   7. UeberCertificateDTO\n   8. UpstreamConsumerArrayElement\n - Created/updated translators for DTOs", "committedDate": "2020-09-25T09:50:39Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDkyOTU1NA==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r494929554", "bodyText": "For this line, you don't need to check for null. Util.toDate() will just return null of the arg is null", "author": "nikosmoum", "createdAt": "2020-09-25T11:39:04Z", "path": "server/src/main/java/org/candlepin/resource/OwnerResource.java", "diffHunk": "@@ -1498,86 +1248,46 @@ public void deleteLogLevel(@PathParam(\"owner_key\") String ownerKey) {\n         return translator.translateQuery(query, ConsumerDTOArrayElement.class);\n     }\n \n-    @GET\n-    @Produces(MediaType.APPLICATION_JSON)\n-    @Path(\"{owner_key}/consumers/count\")\n-    @SuppressWarnings(\"checkstyle:indentation\")\n-    @ApiOperation(notes = \"Retrieve a count of Consumers for the Owner\", value = \"consumers count\")\n-    @ApiResponses({\n-        @ApiResponse(code = 404, message = \"Owner not found\"),\n-        @ApiResponse(code = 400, message = \"Invalid request\")\n-    })\n-    public int countConsumers(\n-        @PathParam(\"owner_key\")\n+    @Override\n+    public Integer countConsumers(\n         @Verify(value = Owner.class, subResource = SubResource.CONSUMERS) String ownerKey,\n-        @QueryParam(\"type\") Set<String> typeLabels,\n-        @QueryParam(\"sku\") List<String> skus,\n-        @QueryParam(\"subscription_id\") List<String> subscriptionIds,\n-        @QueryParam(\"contract\") List<String> contracts) {\n+        Set<String> typeLabels,\n+        List<String> skus,\n+        List<String> subscriptionIds,\n+        List<String> contracts) {\n \n         this.findOwnerByKey(ownerKey);\n         consumerTypeValidator.findAndValidateTypeLabels(typeLabels);\n \n         return consumerCurator.countConsumers(ownerKey, typeLabels, skus, subscriptionIds, contracts);\n     }\n \n-    /**\n-     * Retrieves a list of Pools for an Owner\n-     *\n-     * @param ownerKey id of the owner whose entitlement pools are sought.\n-     * @param matches Find pools matching the given pattern in a variety of fields.\n-     * * and ? wildcards are supported.\n-     * @return a list of Pool objects\n-     * @httpcode 400\n-     * @httpcode 404\n-     * @httpcode 200\n-     */\n+    @Override\n     @Transactional\n-    @GET\n-    @Produces(MediaType.APPLICATION_JSON)\n-    @Path(\"{owner_key}/pools\")\n-    @SuppressWarnings(\"checkstyle:indentation\")\n-    @ApiOperation(notes = \"Retrieves a list of Pools for an Owner. This endpoint \" +\n-        \"supports paging with query parameters. For more details please visit \" +\n-        \"https://www.candlepinproject.org/docs/candlepin/pagination.html#paginating-results-from-candlepin\",\n-        value = \"List Pools\")\n-    @ApiResponses({\n-        @ApiResponse(code = 404, message = \"Owner not found\"),\n-        @ApiResponse(code = 400, message = \"Invalid request\")\n-    })\n     public List<PoolDTO> listPools(\n-        @PathParam(\"owner_key\") @Verify(value = Owner.class, subResource = SubResource.POOLS) String ownerKey,\n-        @QueryParam(\"consumer\") String consumerUuid,\n-        @QueryParam(\"activation_key\") String activationKeyName,\n-        @QueryParam(\"product\") String productId,\n-        @QueryParam(\"subscription\") String subscriptionId,\n-        @ApiParam(\"Include pools that are not suited to the unit's facts.\")\n-        @QueryParam(\"listall\") @DefaultValue(\"false\") boolean listAll,\n-        @ApiParam(\"Date to use as current time for lookup criteria. Defaults\" +\n-                \" to current date if not specified.\")\n-        @QueryParam(\"activeon\") @DefaultValue(DateFormat.NOW) @DateFormat Date activeOn,\n-        @ApiParam(\"Find pools matching the given pattern in a variety of fields;\" +\n-                \" * and ? wildcards are supported; may be specified multiple times\")\n-        @QueryParam(\"matches\") List<String> matches,\n-        @ApiParam(\"The attributes to return based on the specified types.\")\n-        @QueryParam(\"attribute\") List<KeyValueParamDTO> attrFilters,\n-        @ApiParam(\"When set to true, it will add future dated pools to the result, \" +\n-                \"based on the activeon date.\")\n-        @QueryParam(\"add_future\") @DefaultValue(\"false\") boolean addFuture,\n-        @ApiParam(\"When set to true, it will return only future dated pools to the result, \" +\n-                \"based on the activeon date.\")\n-        @QueryParam(\"only_future\") @DefaultValue(\"false\") boolean onlyFuture,\n-        @ApiParam(\"Will only return pools with a start date after the supplied date. \" +\n-                \"Overrides the activeOn date.\")\n-        @QueryParam(\"after\") @DateFormat Date after,\n-        @ApiParam(\"One or more pool IDs to use to filter the output; only pools with IDs matching \" +\n-                \"those provided will be returned; may be specified multiple times\")\n-        @QueryParam(\"poolid\") List<String> poolIds,\n-        @Context Principal principal,\n-        @Context PageRequest pageRequest) {\n+        @Verify(value = Owner.class, subResource = SubResource.POOLS) String ownerKey,\n+        String consumerUuid,\n+        String activationKeyName,\n+        String productId,\n+        String subscriptionId,\n+        Boolean listAll,\n+        OffsetDateTime activeOn,\n+        List<String> matches,\n+        List<KeyValueParamDTO> attrFilters,\n+        Boolean addFuture,\n+        Boolean onlyFuture,\n+        OffsetDateTime after,\n+        List<String> poolIds) {\n+\n+        Principal principal = this.principalProvider.get();\n+        PageRequest pageRequest = ResteasyContext.getContextData(PageRequest.class);\n \n         Owner owner = findOwnerByKey(ownerKey);\n \n+        // set default to current date\n+        Date activeOnDate = activeOn != null ? Util.toDate(activeOn) : new Date();\n+        Date afterDate = after != null ? Util.toDate(after) : null;", "originalCommit": "482111a75c24579277f968f9677f7c09b2141db4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQ1ODA0MQ==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r496458041", "bodyText": "Done.", "author": "sonalidhome", "createdAt": "2020-09-29T06:54:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDkyOTU1NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDkzMzMyNg==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r494933326", "bodyText": "We should be doing what other endpoints do here, and use proper logging (log.error()) and then throwing an IseException", "author": "nikosmoum", "createdAt": "2020-09-25T11:47:06Z", "path": "server/src/main/java/org/candlepin/resource/OwnerResource.java", "diffHunk": "@@ -1213,58 +1091,29 @@ public void deleteOwner(@PathParam(\"owner_key\") String ownerKey,\n         return entitlementDTOs;\n     }\n \n-    /**\n-     * Heals an Owner\n-     *\n-     * Starts an asynchronous healing for the given Owner. At the end of the\n-     * process the idea is that all of the consumers in the owned by the Owner\n-     * will be up to date.\n-     *\n-     * @param ownerKey id of the owner to be healed.\n-     * @return a JobDetail object\n-     * @httpcode 404\n-     * @httpcode 202\n-     */\n-    @POST\n-    @Produces(MediaType.APPLICATION_JSON)\n-    @Consumes(MediaType.WILDCARD)\n-    @Path(\"{owner_key}/entitlements\")\n-    @ApiOperation(notes = \"Starts an asynchronous healing for the given Owner.\" +\n-        \" At the end of the process the idea is that all of the consumers \" +\n-        \"in the owned by the Owner will be up to date.\", value = \"Heal owner\")\n-    @ApiResponses({ @ApiResponse(code = 404, message = \"Owner not found\") })\n+    @Override\n     public AsyncJobStatusDTO healEntire(\n-        @ApiParam(\"ownerKey id of the owner to be healed.\") @PathParam(\"owner_key\") @Verify(Owner.class)\n-        String ownerKey)\n-        throws JobException {\n+        @Verify(Owner.class) String ownerKey) {\n \n         Owner owner = findOwnerByKey(ownerKey);\n         JobConfig config = HealEntireOrgJob.createJobConfig().setOwner(owner).setEntitleDate(new Date());\n \n-        AsyncJobStatus job = this.jobManager.queueJob(config);\n+        AsyncJobStatus job = null;\n+        try {\n+            job = this.jobManager.queueJob(config);\n+        }\n+        catch (JobException e) {\n+            e.printStackTrace();", "originalCommit": "482111a75c24579277f968f9677f7c09b2141db4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDkzNDA5Ng==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r494934096", "bodyText": "Also, like the place that crog mentioned: we don't have to declare the job variable and do the translation outside the try block. It can just be:\n        try {\n            AsyncJobStatus job = this.jobManager.queueJob(config);\n             return this.translator.translate(job, AsyncJobStatusDTO.class);\n        }\n        catch (JobException e) {\n\nsince there's no other work being done after the catch anyway", "author": "nikosmoum", "createdAt": "2020-09-25T11:48:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDkzMzMyNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQ1Nzk2OA==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r496457968", "bodyText": "Updated.", "author": "sonalidhome", "createdAt": "2020-09-29T06:54:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDkzMzMyNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDk0MjE5NQ==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r494942195", "bodyText": "If we end up removing the OwnerInfoTranslator class, then this won't matter, but if we don't, we should either uncomment/update this block or remove it", "author": "nikosmoum", "createdAt": "2020-09-25T12:06:20Z", "path": "server/src/test/java/org/candlepin/dto/api/v1/OwnerInfoDTOTranslatorTest.java", "diffHunk": "@@ -0,0 +1,86 @@\n+/**\n+ * Copyright (c) 2009 - 2020 Red Hat, Inc.\n+ *\n+ * This software is licensed to you under the GNU General Public License,\n+ * version 2 (GPLv2). There is NO WARRANTY for this software, express or\n+ * implied, including the implied warranties of MERCHANTABILITY or FITNESS\n+ * FOR A PARTICULAR PURPOSE. You should have received a copy of GPLv2\n+ * along with this software; if not, see\n+ * http://www.gnu.org/licenses/old-licenses/gpl-2.0.txt.\n+ *\n+ * Red Hat trademarks are not licensed under GPLv2. No permission is\n+ * granted to use or replicate Red Hat trademarks that are incorporated\n+ * in this software or its documentation.\n+ */\n+\n+package org.candlepin.dto.api.v1;\n+\n+import static org.junit.Assert.*;\n+\n+import org.candlepin.dto.AbstractTranslatorTest;\n+import org.candlepin.dto.ModelTranslator;\n+import org.candlepin.model.ConsumerType;\n+import org.candlepin.model.OwnerInfo;\n+\n+public class OwnerInfoDTOTranslatorTest extends\n+    AbstractTranslatorTest<OwnerInfo, OwnerInfoDTO, OwnerInfoDTOTranslator> {\n+\n+    OwnerInfoDTOTranslator translator = new OwnerInfoDTOTranslator();\n+\n+    @Override\n+    protected void initModelTranslator(ModelTranslator modelTranslator) {\n+        modelTranslator.registerTranslator(this.translator,\n+            OwnerInfo.class, OwnerInfoDTO.class);\n+    }\n+\n+    @Override\n+    protected OwnerInfoDTOTranslator initObjectTranslator() {\n+        return this.translator;\n+    }\n+\n+    @Override\n+    protected OwnerInfo initSourceObject() {\n+        OwnerInfo ownerInfo = new OwnerInfo();\n+        ownerInfo.addTypeTotal(new ConsumerType(\"test\"), 1, 2);\n+        ownerInfo.setGuestCount(2);\n+        ownerInfo.setPhysicalCount(2);\n+        ownerInfo.addToConsumerTypeCountByPool(new ConsumerType(\"test-1\"), 5);\n+        ownerInfo.addToEnabledConsumerTypeCountByPool(new ConsumerType(\"test-2\"), 1);\n+        ownerInfo.setConsumerCountByComplianceStatus(\"test-status\", 4);\n+        ownerInfo.addToEntitlementsConsumedByFamily(\"test-family\", 1, 3);\n+        return ownerInfo;\n+    }\n+\n+    @Override\n+    protected OwnerInfoDTO initDestinationObject() {\n+        return new OwnerInfoDTO();\n+    }\n+\n+    @Override\n+    protected void verifyOutput(OwnerInfo source, OwnerInfoDTO dest, boolean childrenGenerated) {\n+        if (source != null) {\n+            assertEquals(source.getConsumerCounts(), dest.getConsumerCounts());\n+            assertEquals(source.getConsumerGuestCounts(), dest.getConsumerGuestCounts());\n+            assertEquals(source.getEntitlementsConsumedByType(), dest.getEntitlementsConsumedByType());\n+            assertEquals(source.getConsumerTypeCountByPool(), dest.getConsumerTypeCountByPool());\n+            assertEquals(source.getEnabledConsumerTypeCountByPool(),\n+                dest.getEnabledConsumerTypeCountByPool());\n+            assertEquals(source.getConsumerCountsByComplianceStatus(),\n+                dest.getConsumerCountsByComplianceStatus());\n+            assertEquals(source.getEntitlementsConsumedByFamily().size(),\n+                dest.getEntitlementsConsumedByFamily().size());\n+\n+            //TODO: Add family check here\n+            /*boolean isConsumed;\n+            if(!source.getEntitlementsConsumedByFamily().isEmpty()) {\n+                isConsumed = source.getEntitlementsConsumedByFamily().entrySet().stream()\n+                    .allMatch(e -> e.equals(dest.getEntitlementsConsumedByFamily().get(e.getKey())));\n+                assertTrue(isConsumed);\n+            }*/", "originalCommit": "482111a75c24579277f968f9677f7c09b2141db4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQ1NzgxOQ==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r496457819", "bodyText": "Removed OwnerInfoTranslator.", "author": "sonalidhome", "createdAt": "2020-09-29T06:54:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDk0MjE5NQ=="}], "type": "inlineReview"}, {"oid": "b300038ad20522b825951d0fe7c9af9e7b691279", "url": "https://github.com/candlepin/candlepin/commit/b300038ad20522b825951d0fe7c9af9e7b691279", "message": "ENT-1848: Port OwnerResource to spec-first\n - Added endpoints definitions\n - Added specifications for following DTOs\n   1. AbstractCertificateDTO\n   2. ConsumptionTypeCountsDTO\n   3. ImportRecordDTO\n   4. ImportUpstreamConsumerDTO\n   5. OwnerInfoDTO\n   6. SystemPurposeAttributesDTO\n   7. UeberCertificateDTO\n   8. UpstreamConsumerArrayElement\n - Created/updated translators for DTOs\n - Subscription Translator and OwnerInfoBuilder changes", "committedDate": "2020-09-29T06:52:26Z", "type": "forcePushed"}, {"oid": "12bc08f25c024968a349d475b218cd9410fe278c", "url": "https://github.com/candlepin/candlepin/commit/12bc08f25c024968a349d475b218cd9410fe278c", "message": "ENT-1848: Port OwnerResource to spec-first\n - Added endpoints definitions\n - Added specifications for following DTOs\n   1. AbstractCertificateDTO\n   2. ConsumptionTypeCountsDTO\n   3. ImportRecordDTO\n   4. ImportUpstreamConsumerDTO\n   5. OwnerInfoDTO\n   6. SystemPurposeAttributesDTO\n   7. UeberCertificateDTO\n   8. UpstreamConsumerArrayElement\n - Created/updated translators for DTOs\n - Subscription Translator and OwnerInfoBuilder changes", "committedDate": "2020-09-29T07:02:08Z", "type": "forcePushed"}, {"oid": "87268966528d5376b4e5bd2909f6eb333c1c2b1f", "url": "https://github.com/candlepin/candlepin/commit/87268966528d5376b4e5bd2909f6eb333c1c2b1f", "message": "ENT-1848: Port OwnerResource to spec-first\n - Added endpoints definitions\n - Added specifications for following DTOs\n   1. AbstractCertificateDTO\n   2. ConsumptionTypeCountsDTO\n   3. ImportRecordDTO\n   4. ImportUpstreamConsumerDTO\n   5. OwnerInfoDTO\n   6. SystemPurposeAttributesDTO\n   7. UeberCertificateDTO\n   8. UpstreamConsumerArrayElement\n - Created/updated translators for DTOs\n - Subscription Translator and OwnerInfoBuilder changes", "committedDate": "2020-09-29T07:26:52Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjYwMjUyMw==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r496602523", "bodyText": "This should be iterating over getConsumerTypeCountByPool", "author": "nikosmoum", "createdAt": "2020-09-29T10:14:53Z", "path": "server/src/main/java/org/candlepin/model/OwnerInfoBuilder.java", "diffHunk": "@@ -0,0 +1,119 @@\n+/**\n+ * Copyright (c) 2009 - 2012 Red Hat, Inc.\n+ *\n+ * This software is licensed to you under the GNU General Public License,\n+ * version 2 (GPLv2). There is NO WARRANTY for this software, express or\n+ * implied, including the implied warranties of MERCHANTABILITY or FITNESS\n+ * FOR A PARTICULAR PURPOSE. You should have received a copy of GPLv2\n+ * along with this software; if not, see\n+ * http://www.gnu.org/licenses/old-licenses/gpl-2.0.txt.\n+ *\n+ * Red Hat trademarks are not licensed under GPLv2. No permission is\n+ * granted to use or replicate Red Hat trademarks that are incorporated\n+ * in this software or its documentation.\n+ */\n+\n+package org.candlepin.model;\n+\n+import org.candlepin.dto.api.v1.ConsumptionTypeCountsDTO;\n+import org.candlepin.dto.api.v1.OwnerInfo;\n+\n+import java.util.List;\n+\n+/**\n+ * OwnerInfoBuilder is used to accumulate data to build OwnerInfo with dynamic values.\n+ */\n+\n+public class OwnerInfoBuilder {\n+\n+    private OwnerInfo ownerInfo;\n+\n+    public static final String PHYSICAL = \"physical\";\n+    public static final String GUEST = \"guest\";\n+\n+    public OwnerInfoBuilder() {\n+        ownerInfo = new OwnerInfo();\n+    }\n+\n+    public OwnerInfo build() {\n+        return this.ownerInfo;\n+    }\n+\n+    public void addTypeTotal(ConsumerType type, int consumers, int entitlements) {\n+        ownerInfo.putConsumerCounts(type.getLabel(), consumers);\n+        ownerInfo.putEntitlementsConsumedByType(type.getLabel(), entitlements);\n+    }\n+\n+    public void addToConsumerTypeCountByPool(ConsumerType type, int toAdd) {\n+        Integer count = ownerInfo.getConsumerTypeCountByPool().get(type.getLabel());\n+        if (count == null) {\n+            count = 0;\n+        }\n+        ownerInfo.putConsumerTypeCountByPool(type.getLabel(), count + toAdd);\n+    }\n+\n+    public void addToEnabledConsumerTypeCountByPool(ConsumerType type, int toAdd) {\n+        Integer count = ownerInfo.getEnabledConsumerTypeCountByPool().get(type.getLabel());\n+        if (count == null) {\n+            count = 0;\n+        }\n+        ownerInfo.putEnabledConsumerTypeCountByPool(type.getLabel(), count + toAdd);\n+    }\n+\n+    public void setConsumerTypesByPool(List<ConsumerType> consumerTypes) {\n+        for (ConsumerType c : consumerTypes) {\n+            ownerInfo.putConsumerTypeCountByPool(c.getLabel(), 0);\n+        }\n+    }\n+\n+    public void addToEntitlementsConsumedByFamily(String family, int physical,\n+        int virtual) {\n+        ConsumptionTypeCountsDTO typeCounts;\n+        if (!ownerInfo.getEntitlementsConsumedByFamily().containsKey(family)) {\n+            typeCounts = new ConsumptionTypeCountsDTO().physical(0).guest(0);\n+            ownerInfo.putEntitlementsConsumedByFamily(family, typeCounts);\n+        }\n+        else {\n+            typeCounts = ownerInfo.getEntitlementsConsumedByFamily().get(family);\n+        }\n+\n+        typeCounts.setPhysical(typeCounts.getPhysical() + physical);\n+        typeCounts.setGuest(typeCounts.getGuest() + virtual);\n+    }\n+\n+    public void addDefaultEntitlementsConsumedByFamily(int physical, int virtual) {\n+        for (String key : ownerInfo.getEntitlementsConsumedByFamily().keySet()) {\n+            ConsumptionTypeCountsDTO count = ownerInfo.getEntitlementsConsumedByFamily().get(key);\n+            physical -= count.getPhysical();\n+            virtual -= count.getGuest();\n+        }\n+\n+        // just ignore the default family if we have nothing to put in it.\n+        if (physical > 0 || virtual > 0) {\n+            addToEntitlementsConsumedByFamily(\"none\", physical, virtual);\n+        }\n+    }\n+\n+    public void addDefaultEnabledConsumerTypeCount(int activePools) {\n+        for (String key : ownerInfo.getEntitlementsConsumedByType().keySet()) {", "originalCommit": "87268966528d5376b4e5bd2909f6eb333c1c2b1f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjY1MDY4OQ==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r496650689", "bodyText": "Corrected.", "author": "sonalidhome", "createdAt": "2020-09-29T11:44:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjYwMjUyMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjYwODA0NQ==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r496608045", "bodyText": "The original OwnerInfo constructor was doing some data initialization:\n        consumerGuestCounts.put(GUEST, 0);\n        consumerGuestCounts.put(PHYSICAL, 0);\n\nWe should also add that here, and add a unit test for it if one does not already exist", "author": "nikosmoum", "createdAt": "2020-09-29T10:24:43Z", "path": "server/src/main/java/org/candlepin/model/OwnerInfoBuilder.java", "diffHunk": "@@ -0,0 +1,119 @@\n+/**\n+ * Copyright (c) 2009 - 2012 Red Hat, Inc.\n+ *\n+ * This software is licensed to you under the GNU General Public License,\n+ * version 2 (GPLv2). There is NO WARRANTY for this software, express or\n+ * implied, including the implied warranties of MERCHANTABILITY or FITNESS\n+ * FOR A PARTICULAR PURPOSE. You should have received a copy of GPLv2\n+ * along with this software; if not, see\n+ * http://www.gnu.org/licenses/old-licenses/gpl-2.0.txt.\n+ *\n+ * Red Hat trademarks are not licensed under GPLv2. No permission is\n+ * granted to use or replicate Red Hat trademarks that are incorporated\n+ * in this software or its documentation.\n+ */\n+\n+package org.candlepin.model;\n+\n+import org.candlepin.dto.api.v1.ConsumptionTypeCountsDTO;\n+import org.candlepin.dto.api.v1.OwnerInfo;\n+\n+import java.util.List;\n+\n+/**\n+ * OwnerInfoBuilder is used to accumulate data to build OwnerInfo with dynamic values.\n+ */\n+\n+public class OwnerInfoBuilder {\n+\n+    private OwnerInfo ownerInfo;\n+\n+    public static final String PHYSICAL = \"physical\";\n+    public static final String GUEST = \"guest\";\n+\n+    public OwnerInfoBuilder() {\n+        ownerInfo = new OwnerInfo();", "originalCommit": "87268966528d5376b4e5bd2909f6eb333c1c2b1f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjY1MzQzOQ==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r496653439", "bodyText": "Consumer count is set in setConsumerGuestCounts from OwnerInfoCurator. And this method is getting called before info.build(). Hence the Owner with no consumer is working as excepted. Still, I have added these into initialization as per the request.", "author": "sonalidhome", "createdAt": "2020-09-29T11:49:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjYwODA0NQ=="}], "type": "inlineReview"}, {"oid": "de72e6192899fc03b145bd49bb13aec8291ba159", "url": "https://github.com/candlepin/candlepin/commit/de72e6192899fc03b145bd49bb13aec8291ba159", "message": "ENT-1848: Port OwnerResource to spec-first\n - Added endpoints definitions\n - Added specifications for following DTOs\n   1. AbstractCertificateDTO\n   2. ConsumptionTypeCountsDTO\n   3. ImportRecordDTO\n   4. ImportUpstreamConsumerDTO\n   5. OwnerInfoDTO\n   6. SystemPurposeAttributesDTO\n   7. UeberCertificateDTO\n   8. UpstreamConsumerArrayElement\n - Created/updated translators for DTOs\n - Subscription Translator and OwnerInfoBuilder changes", "committedDate": "2020-09-29T11:43:01Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjY1MzQ3OA==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r496653478", "bodyText": "Unfortunately, it is not as simple as changing the source on the translator from Subscription to Pool.\nWhen the fabricate method creates a new Subscription object, it uses this constructor: public Subscription populate(Pool source, ProductCurator productCurator) which itself does A LOT of work that involves logic, and the ProductCurator. For example, we can't just assign the quantity, but calculate it first with Subscription.setQuantityFromPool.\nWe should move all that logic from the Subscription.populate(source, productCurator) method here because it is basically a translator method hidden within the Subscription class, and entirely remove the following methods, because they are will no longer be needed:\nSubscription.Subscription(Pool source, ProductCurator productCurator)\nSubscription.populate(Pool source, ProductCurator productCurator)\nSubscription.setQuantityFromPool(Pool pool)\nCandlepinPoolManager.fabricateSubscriptionFromPool(Pool pool)\nPoolManager.fabricateSubscriptionFromPool(Pool pool)", "author": "nikosmoum", "createdAt": "2020-09-29T11:49:46Z", "path": "server/src/main/java/org/candlepin/dto/api/v1/PoolToSubscriptionTranslator.java", "diffHunk": "@@ -74,13 +74,13 @@ public SubscriptionDTO populate(\n             throw new IllegalArgumentException(\"dest is null\");\n         }\n \n-        dest.id(source.getId())\n+        dest.id(source.getSubscriptionId())\n             .quantity(source.getQuantity())", "originalCommit": "de72e6192899fc03b145bd49bb13aec8291ba159", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTQxNDE2MQ==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r499414161", "bodyText": "Updated the changes as per the Subscription.populate method. Also removed the not required methods.", "author": "sonalidhome", "createdAt": "2020-10-05T08:06:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjY1MzQ3OA=="}], "type": "inlineReview"}, {"oid": "4e455c45e2b74a182c5fa1f13024c70f2d2219e0", "url": "https://github.com/candlepin/candlepin/commit/4e455c45e2b74a182c5fa1f13024c70f2d2219e0", "message": "ENT-1848: Port OwnerResource to spec-first\n - Added endpoints definitions\n - Added specifications for following DTOs\n   1. AbstractCertificateDTO\n   2. ConsumptionTypeCountsDTO\n   3. ImportRecordDTO\n   4. ImportUpstreamConsumerDTO\n   5. OwnerInfoDTO\n   6. SystemPurposeAttributesDTO\n   7. UeberCertificateDTO\n   8. UpstreamConsumerArrayElement\n - Created/updated translators for DTOs\n - Subscription Translator and OwnerInfoBuilder changes", "committedDate": "2020-10-05T08:03:15Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTUzNTE0NA==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r499535144", "bodyText": "One last thing to mention:\nI think we should preserve these 3 unit tests (this one, along with testFabricateSubWithZeroInstanceMultiplier and testFabricateSubWithMultiplierAndInstanceMultiplier) because they test the quantity translation logic. We can port them directly into PoolToSubscriptionTranslatorTest.java and change the fabricateSubscriptionFromPool call to translator.translate(pool, SubscriptionDTO)", "author": "nikosmoum", "createdAt": "2020-10-05T11:41:06Z", "path": "server/src/test/java/org/candlepin/controller/PoolManagerTest.java", "diffHunk": "@@ -1703,117 +1703,6 @@ public void createPoolsForPoolBonusExist() {\n         assertThrows(IllegalStateException.class, () -> pRules.createAndEnrichPools(p, existingPools));\n     }\n \n-    @Test\n-    public void testFabricateSubscriptionFromPool() {\n-        Product product = TestUtil.createProduct(\"product\", \"Product\");\n-        Product provided1 = TestUtil.createProduct(\"provided-1\", \"Provided 1\");\n-        Product provided2 = TestUtil.createProduct(\"provided-2\", \"Provided 2\");\n-        product.setLocked(true);\n-        provided1.setLocked(true);\n-        provided2.setLocked(true);\n-\n-        ProductData productDTO = product.toDTO();\n-        ProductData provided1DTO = provided1.toDTO();\n-        ProductData provided2DTO = provided2.toDTO();\n-\n-        Pool pool = mock(Pool.class);\n-\n-        HashSet<Product> provided = new HashSet<>();\n-        HashSet<ProductData> providedDTOs = new HashSet<>();\n-        provided.add(provided1);\n-        provided.add(provided2);\n-        providedDTOs.add(provided1DTO);\n-        providedDTOs.add(provided2DTO);\n-\n-        Long quantity = new Long(42);\n-\n-        Date startDate = new Date(System.currentTimeMillis() - 86400000);\n-        Date endDate = new Date(System.currentTimeMillis() + 86400000);\n-        Date updated = new Date();\n-\n-        String subscriptionId = \"test-subscription-1\";\n-\n-        when(pool.getOwner()).thenReturn(owner);\n-        when(pool.getProduct()).thenReturn(product);\n-        when(mockProductCurator.getPoolProvidedProductsCached(any(Pool.class))).thenReturn(provided);\n-        when(pool.getQuantity()).thenReturn(quantity);\n-        when(pool.getStartDate()).thenReturn(startDate);\n-        when(pool.getEndDate()).thenReturn(endDate);\n-        when(pool.getUpdated()).thenReturn(updated);\n-        when(pool.getSubscriptionId()).thenReturn(subscriptionId);\n-        // TODO: Add other attributes to check here.\n-\n-        Subscription fabricated = manager.fabricateSubscriptionFromPool(pool);\n-        pool.populateAllTransientProvidedProducts(mockProductCurator);\n-        assertEquals(owner, fabricated.getOwner());\n-        assertEquals(productDTO, fabricated.getProduct());\n-        assertEquals(providedDTOs, fabricated.getProvidedProducts());\n-        assertEquals(quantity, fabricated.getQuantity());\n-        assertEquals(startDate, fabricated.getStartDate());\n-        assertEquals(endDate, fabricated.getEndDate());\n-        assertEquals(updated, fabricated.getModified());\n-        assertEquals(subscriptionId, fabricated.getId());\n-    }\n-\n-\n-    /**\n-     * See BZ1292283\n-     */\n-    @Test\n-    public void testFabricateSubWithMultiplier() {", "originalCommit": "4e455c45e2b74a182c5fa1f13024c70f2d2219e0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTYzMzAyOA==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r499633028", "bodyText": "Added these tests under PoolToSubscriptionTranslatorTest.java", "author": "sonalidhome", "createdAt": "2020-10-05T14:18:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTUzNTE0NA=="}], "type": "inlineReview"}, {"oid": "c79c43f6e2a2db667d8ac9db4dead8e5fecf3593", "url": "https://github.com/candlepin/candlepin/commit/c79c43f6e2a2db667d8ac9db4dead8e5fecf3593", "message": "ENT-1848: Port OwnerResource to spec-first\n - Added endpoints definitions\n - Added specifications for following DTOs\n   1. AbstractCertificateDTO\n   2. ConsumptionTypeCountsDTO\n   3. ImportRecordDTO\n   4. ImportUpstreamConsumerDTO\n   5. OwnerInfoDTO\n   6. SystemPurposeAttributesDTO\n   7. UeberCertificateDTO\n   8. UpstreamConsumerArrayElement\n - Created/updated translators for DTOs\n - Subscription Translator and OwnerInfoBuilder changes", "committedDate": "2020-10-05T14:16:24Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTgxMjg5NQ==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r499812895", "bodyText": "Minor grammatical mistake here. Needs either a noun or to drop the \"an\":\n\"Represents owner information\", or \"Represents an owner-information container\"", "author": "Ceiu", "createdAt": "2020-10-05T19:09:53Z", "path": "api/candlepin-api-spec.yaml", "diffHunk": "@@ -5564,6 +7371,47 @@ components:\n             upstreamConsumer:\n               $ref: '#/components/schemas/UpstreamConsumerDTO'\n \n+    OwnerInfo:\n+      description: Represents an owner information", "originalCommit": "c79c43f6e2a2db667d8ac9db4dead8e5fecf3593", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDAxMDU2MA==", "url": "https://github.com/candlepin/candlepin/pull/2802#discussion_r500010560", "bodyText": "Done.", "author": "sonalidhome", "createdAt": "2020-10-06T05:16:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTgxMjg5NQ=="}], "type": "inlineReview"}, {"oid": "e7c71eba6de0a48569ef7fb6e7bc25f3264a7b6c", "url": "https://github.com/candlepin/candlepin/commit/e7c71eba6de0a48569ef7fb6e7bc25f3264a7b6c", "message": "ENT-1848: Port OwnerResource to spec-first\n - Added endpoints definitions\n - Added specifications for following DTOs\n   1. AbstractCertificateDTO\n   2. ConsumptionTypeCountsDTO\n   3. ImportRecordDTO\n   4. ImportUpstreamConsumerDTO\n   5. OwnerInfoDTO\n   6. SystemPurposeAttributesDTO\n   7. UeberCertificateDTO\n   8. UpstreamConsumerArrayElement\n - Created/updated translators for DTOs\n - Subscription Translator and OwnerInfoBuilder changes", "committedDate": "2020-10-06T05:15:11Z", "type": "forcePushed"}, {"oid": "975f3bfaf5e90b28b5d0e71abb77f4edcc8a7032", "url": "https://github.com/candlepin/candlepin/commit/975f3bfaf5e90b28b5d0e71abb77f4edcc8a7032", "message": "ENT-1848: Port OwnerResource to spec-first\n - Added endpoints definitions\n - Added specifications for following DTOs\n   1. AbstractCertificateDTO\n   2. ConsumptionTypeCountsDTO\n   3. ImportRecordDTO\n   4. ImportUpstreamConsumerDTO\n   5. OwnerInfoDTO\n   6. SystemPurposeAttributesDTO\n   7. UeberCertificateDTO\n   8. UpstreamConsumerArrayElement\n - Created/updated translators for DTOs\n - Subscription Translator and OwnerInfoBuilder changes", "committedDate": "2020-10-07T05:28:07Z", "type": "commit"}, {"oid": "975f3bfaf5e90b28b5d0e71abb77f4edcc8a7032", "url": "https://github.com/candlepin/candlepin/commit/975f3bfaf5e90b28b5d0e71abb77f4edcc8a7032", "message": "ENT-1848: Port OwnerResource to spec-first\n - Added endpoints definitions\n - Added specifications for following DTOs\n   1. AbstractCertificateDTO\n   2. ConsumptionTypeCountsDTO\n   3. ImportRecordDTO\n   4. ImportUpstreamConsumerDTO\n   5. OwnerInfoDTO\n   6. SystemPurposeAttributesDTO\n   7. UeberCertificateDTO\n   8. UpstreamConsumerArrayElement\n - Created/updated translators for DTOs\n - Subscription Translator and OwnerInfoBuilder changes", "committedDate": "2020-10-07T05:28:07Z", "type": "forcePushed"}]}