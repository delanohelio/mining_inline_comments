{"pr_number": 2590, "pr_title": "[M] 1469259: validate hypervisor update json (ENT-530)", "pr_createdAt": "2020-01-29T14:35:37Z", "pr_url": "https://github.com/candlepin/candlepin/pull/2590", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjkyNzUzNg==", "url": "https://github.com/candlepin/candlepin/pull/2590#discussion_r372927536", "bodyText": "Replacing the first assertion with this is ok, but we should probably not remove the other 2 assertions (with report {} and {hypervisors:[]}.", "author": "nikosmoum", "createdAt": "2020-01-30T12:47:06Z", "path": "server/spec/hypervisor_check_in_spec.rb", "diffHunk": "@@ -1201,18 +1208,10 @@ def create_virtwho_client(user)\n         ],\n         \"facts\" => {\"test_fact\" => \"fact_value\" }\n     }\n-    job_detail = send_host_guest_mapping(owner, user, report.to_json())\n-    job_detail[\"state\"].should == \"FAILED\"\n-\n-    # empty json\n-    report = {}\n-    job_detail = send_host_guest_mapping(owner, user, report.to_json())\n-    job_detail[\"state\"].should == \"FAILED\"\n-\n-    # this is the correct version of an empy list of hypervisors\n-    report = {hypervisors:[]}\n-    job_detail = send_host_guest_mapping(owner, user, report.to_json())\n-    job_detail[\"state\"].should == \"FINISHED\"\n+    virtwho = create_virtwho_client(@user)\n+    lambda do\n+      virtwho.hypervisor_update(@owner['key'], report.to_json())\n+    end.should raise_exception(RestClient::BadRequest)", "originalCommit": "6e83236c46720738cdbd4268422a3350fc9e224b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzAyNTY5Mg==", "url": "https://github.com/candlepin/candlepin/pull/2590#discussion_r373025692", "bodyText": "Done.", "author": "abhiskum", "createdAt": "2020-01-30T15:41:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjkyNzUzNg=="}], "type": "inlineReview"}, {"oid": "948b6153aa2cd245868c291fca1b5cd9a9a4138f", "url": "https://github.com/candlepin/candlepin/commit/948b6153aa2cd245868c291fca1b5cd9a9a4138f", "message": "1469259: validate hypervisor update json", "committedDate": "2020-01-30T15:40:40Z", "type": "commit"}, {"oid": "948b6153aa2cd245868c291fca1b5cd9a9a4138f", "url": "https://github.com/candlepin/candlepin/commit/948b6153aa2cd245868c291fca1b5cd9a9a4138f", "message": "1469259: validate hypervisor update json", "committedDate": "2020-01-30T15:40:40Z", "type": "forcePushed"}]}