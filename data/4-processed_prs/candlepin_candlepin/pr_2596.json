{"pr_number": 2596, "pr_title": "ENT-1872: Port DistributorVersionResource to spec-first", "pr_createdAt": "2020-01-30T15:16:59Z", "pr_url": "https://github.com/candlepin/candlepin/pull/2596", "timeline": [{"oid": "711e0f739e65dc3c55cae61bb131204840e0ce6a", "url": "https://github.com/candlepin/candlepin/commit/711e0f739e65dc3c55cae61bb131204840e0ce6a", "message": "ENT-1872: Port DistributorVersionResource to spec-first\n - Add yaml definitions of resource and DTOs\n - Update Translator\n - Fix broken tests", "committedDate": "2020-01-31T14:14:10Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzkxODE0OA==", "url": "https://github.com/candlepin/candlepin/pull/2596#discussion_r373918148", "bodyText": "@Januson\nmodelTranslator never used in this code. Any specific reason for this null check?", "author": "abhiskum", "createdAt": "2020-02-03T04:29:30Z", "path": "server/src/main/java/org/candlepin/dto/api/v1/DistributorVersionTranslator.java", "diffHunk": "@@ -60,28 +66,43 @@ public DistributorVersionDTO populate(DistributorVersion source, DistributorVers\n     public DistributorVersionDTO populate(ModelTranslator modelTranslator, DistributorVersion source,\n         DistributorVersionDTO dest) {\n \n-        dest = super.populate(modelTranslator, source, dest);\n+        if (source == null) {\n+            throw new IllegalArgumentException(\"source is null\");\n+        }\n \n-        dest.setId(source.getId());\n-        dest.setName(source.getName());\n-        dest.setDisplayName(source.getDisplayName());\n+        if (dest == null) {\n+            throw new IllegalArgumentException(\"dest is null\");\n+        }\n \n-        if (modelTranslator != null) {\n+        dest.id(source.getId())\n+            .name(source.getName())\n+            .displayName(source.getDisplayName())\n+            .created(toDateTime(source::getCreated))\n+            .updated(toDateTime(source::getUpdated));\n \n-            Set<DistributorVersionCapability> capabilities = source.getCapabilities();\n-            if (capabilities != null && !capabilities.isEmpty()) {\n-                for (DistributorVersionCapability capability : capabilities) {\n-                    if (capability != null) {\n-                        dest.addCapability(new DistributorVersionDTO.DistributorVersionCapabilityDTO(\n-                            capability.getId(), capability.getName()));\n-                    }\n-                }\n-            }\n-            else {\n-                dest.setCapabilities(Collections.emptySet());\n+        if (modelTranslator != null) {", "originalCommit": "711e0f739e65dc3c55cae61bb131204840e0ce6a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDAwNjA3OA==", "url": "https://github.com/candlepin/candlepin/pull/2596#discussion_r374006078", "bodyText": "No reason. Just forgot to remove it. Done.", "author": "Januson", "createdAt": "2020-02-03T09:48:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzkxODE0OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzkxODMwOQ==", "url": "https://github.com/candlepin/candlepin/pull/2596#discussion_r373918309", "bodyText": "@Januson What was to the purpose of @Context Principal principal in this API?", "author": "abhiskum", "createdAt": "2020-02-03T04:30:37Z", "path": "server/src/main/java/org/candlepin/resource/DistributorVersionResource.java", "diffHunk": "@@ -139,26 +111,16 @@ else if (!StringUtils.isBlank(capability)) {\n             this.translator.getStreamMapper(DistributorVersion.class, DistributorVersionDTO.class));\n     }\n \n-    @ApiOperation(notes = \"Deletes a Distributor Version\", value = \"delete\")\n-    @ApiResponses({ @ApiResponse(code = 400, message = \"\"), @ApiResponse(code = 404, message = \"\") })\n-    @DELETE\n-    @Produces(MediaType.WILDCARD)\n-    @Path(\"/{id}\")\n-    public void delete(@PathParam(\"id\") String id,\n-        @Context Principal principal) {", "originalCommit": "711e0f739e65dc3c55cae61bb131204840e0ce6a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDE2OTQ0Mw==", "url": "https://github.com/candlepin/candlepin/pull/2596#discussion_r374169443", "bodyText": "Principal is unused so it should be save to remove. Just including it shouldn't have any side effects.", "author": "Januson", "createdAt": "2020-02-03T15:31:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzkxODMwOQ=="}], "type": "inlineReview"}, {"oid": "e10ac949af90987730f70400c1855a570d2c5051", "url": "https://github.com/candlepin/candlepin/commit/e10ac949af90987730f70400c1855a570d2c5051", "message": "ENT-1872: Port DistributorVersionResource to spec-first\n - Add yaml definitions of resource and DTOs\n - Update Translator\n - Fix broken tests", "committedDate": "2020-02-03T09:15:59Z", "type": "forcePushed"}, {"oid": "a9f24d60791134afc629baa4caa5960844bc15b0", "url": "https://github.com/candlepin/candlepin/commit/a9f24d60791134afc629baa4caa5960844bc15b0", "message": "ENT-1872: Port DistributorVersionResource to spec-first\n - Add yaml definitions of resource and DTOs\n - Update Translator\n - Fix broken tests", "committedDate": "2020-02-03T09:47:53Z", "type": "forcePushed"}, {"oid": "79c62e72bb9198b85f6b290852ce7f207684f2ec", "url": "https://github.com/candlepin/candlepin/commit/79c62e72bb9198b85f6b290852ce7f207684f2ec", "message": "ENT-1872: Port DistributorVersionResource to spec-first\n - Add yaml definitions of resource and DTOs\n - Update Translator\n - Fix broken tests", "committedDate": "2020-02-03T11:32:11Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDU1NDU2Mw==", "url": "https://github.com/candlepin/candlepin/pull/2596#discussion_r374554563", "bodyText": "From looking around the documentation, this property is a way to simulate Set/HashSet (even though openapi will generate a List, and does not seem to have a way to make that a Set), but it does not get enforced. I've tried it out with: curl -k -u admin:admin --request POST -H \"Content-Type: application/json\" -d '{\"displayName\": \"display_name8\", \"name\": \"name8\", \"capabilities\": [ {\"id\": \"id8\", \"name\": \"name8\"}, {\"id\": \"id8\", \"name\": \"name8\"} ]}' https://localhost:8443/candlepin/distributor_versions which should result in a capability List with only 1 element, but instead we have 2 elements that are identical.\nIn this specific case it is not a problem, because we always use the streaming api and convert to Set explicitly, but it is not ideal that openapi itself does not enforce this, and might cause unforseen issues later.", "author": "nikosmoum", "createdAt": "2020-02-04T09:21:54Z", "path": "api/candlepin-api-spec.yaml", "diffHunk": "@@ -263,6 +400,40 @@ components:\n             value:\n               type: string\n \n+    DistributorVersionDTO:\n+      description: A DTO representation of the DistributorVersion\n+      allOf:\n+        - $ref: '#/components/schemas/TimestampedEntity'\n+        - type: object\n+          required:\n+            - displayName\n+            - id\n+            - name\n+          properties:\n+            id:\n+              type: string\n+            name:\n+              type: string\n+            displayName:\n+              type: string\n+            capabilities:\n+              type: array\n+              uniqueItems: true", "originalCommit": "79c62e72bb9198b85f6b290852ce7f207684f2ec", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDc3OTE2Nw==", "url": "https://github.com/candlepin/candlepin/pull/2596#discussion_r374779167", "bodyText": "To some extent, maybe this is an area where we should evaluate our logic and clean it up ourselves. However, that aside, we could always use the container typing as a short-term (heh) patch to deal with this.\nIt would be nice if we could stay completely within the bounds of the OpenAPI spec, but this could be another shortcoming.", "author": "Ceiu", "createdAt": "2020-02-04T16:27:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDU1NDU2Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDYwMDk0OA==", "url": "https://github.com/candlepin/candlepin/pull/2596#discussion_r374600948", "bodyText": "I did some research to understand what the required field is supposed to do, which apparently means that the specified fields will be required during deserialization/serialization. After locally testing though it seems this is not enforced.\nFor example, without the changes from this PR, I can currently do: curl -k -u admin:admin --request POST -H \"Content-Type: application/json\" -d '{}' https://localhost:8443/candlepin/distributor_versions and the request will pass through the deserialization, and will fail when hibernate will try to persist the new entity with org.hibernate.PropertyValueException: not-null property references a null or transient value : org.candlepin.model.DistributorVersion.displayName. With these changes, that also specify required fields, the same thing happens (There is no error during deserialization, the DTO is created normally but with null fields, and eventually the same failure in hibernate persist happens).\nSo I believe required should be removed, since it does not have any effect. Additionally, even if it did have an effect, we currently don't have any such restrictions on requiring fields be present on DistributorVersionDTO, so there is no immediate need to add this functionality.\nNonetheless, if this was working, and we wanted to specify fields as required, we should probably do it as a conscious decision across all entities we port, and with a common understanding/guidelines of which fields should be marked as required, and which not. For example, in this case, the id field should definitely NOT be required, because it is the database entity id, which should not be included in a POST request which tries to create a new entity.", "author": "nikosmoum", "createdAt": "2020-02-04T10:52:14Z", "path": "api/candlepin-api-spec.yaml", "diffHunk": "@@ -263,6 +400,40 @@ components:\n             value:\n               type: string\n \n+    DistributorVersionDTO:\n+      description: A DTO representation of the DistributorVersion\n+      allOf:\n+        - $ref: '#/components/schemas/TimestampedEntity'\n+        - type: object\n+          required:\n+            - displayName\n+            - id\n+            - name", "originalCommit": "79c62e72bb9198b85f6b290852ce7f207684f2ec", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTYzMDM0Mg==", "url": "https://github.com/candlepin/candlepin/pull/2596#discussion_r395630342", "bodyText": "Done.", "author": "Januson", "createdAt": "2020-03-20T13:20:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDYwMDk0OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDYwNTUzMA==", "url": "https://github.com/candlepin/candlepin/pull/2596#discussion_r374605530", "bodyText": "Same here, required doesn't seem to be enforced, so we should remove it.", "author": "nikosmoum", "createdAt": "2020-02-04T11:01:56Z", "path": "api/candlepin-api-spec.yaml", "diffHunk": "@@ -263,6 +400,40 @@ components:\n             value:\n               type: string\n \n+    DistributorVersionDTO:\n+      description: A DTO representation of the DistributorVersion\n+      allOf:\n+        - $ref: '#/components/schemas/TimestampedEntity'\n+        - type: object\n+          required:\n+            - displayName\n+            - id\n+            - name\n+          properties:\n+            id:\n+              type: string\n+            name:\n+              type: string\n+            displayName:\n+              type: string\n+            capabilities:\n+              type: array\n+              uniqueItems: true\n+              items:\n+                $ref: '#/definitions/DistributorVersionCapabilityDTO'\n+\n+    DistributorVersionCapabilityDTO:\n+      description: A DTO representation of the DistributorVersionCapability\n+      type: object\n+      required:\n+        - id\n+        - name", "originalCommit": "79c62e72bb9198b85f6b290852ce7f207684f2ec", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjQwNjQ5Nw==", "url": "https://github.com/candlepin/candlepin/pull/2596#discussion_r386406497", "bodyText": "As we've discussed before this is one area that the current dto does perform validation (name must not be null or empty), so we should keep it as such. The id though does not get validated, so there is no need to include it.\nSo with that, this section would become:\n      required:\n        - name\n      properties:\n        id:\n          type: string\n        name:\n          type: string\n          minLength: 1\n\nThe PR I just posted (#2630) introduces a DTOValidator which can be used on resources to validate incoming DTOs against the constraints generated by the required (adds @NotNull annotation), and minLength (adds @Size(min=1) annotation to make sure the string is not empty). So I'd suggest to rebase and merge this PR after that one, in order to apply the DTO validation on the DistributorVersionResource.create/update methods.", "author": "nikosmoum", "createdAt": "2020-03-02T13:57:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDYwNTUzMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTYzMDM4Mg==", "url": "https://github.com/candlepin/candlepin/pull/2596#discussion_r395630382", "bodyText": "Done.", "author": "Januson", "createdAt": "2020-03-20T13:20:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDYwNTUzMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDYwNzUyMw==", "url": "https://github.com/candlepin/candlepin/pull/2596#discussion_r374607523", "bodyText": "\ud83d\udc4d Good job on appending this alphabetically instead of appending at the end (even though not everything in the file is alphabetical yet). If we all keep doing this, the chances of requiring rebases every time a PR is merged due to everyone appending at the end will be much less.", "author": "nikosmoum", "createdAt": "2020-02-04T11:06:23Z", "path": "api/candlepin-api-spec.yaml", "diffHunk": "@@ -263,6 +400,40 @@ components:\n             value:\n               type: string\n \n+    DistributorVersionDTO:", "originalCommit": "79c62e72bb9198b85f6b290852ce7f207684f2ec", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDYxMTE3MA==", "url": "https://github.com/candlepin/candlepin/pull/2596#discussion_r374611170", "bodyText": "What exactly does the use of Supplier get us? Will it not create overhead, and we simply add one more line of code (having to do Date date = source.get();) instead of just accepting a Date?\nRegardless, the idea of using a utility method is good, and we should probably even extract it to a util class, so that we can use it throughout the spec-first port tasks, since it will be ubiquitous. The org.candlepin.util.Util.java class already has some utility methods about Dates, so we could add it there.", "author": "nikosmoum", "createdAt": "2020-02-04T11:14:48Z", "path": "server/src/main/java/org/candlepin/dto/api/v1/DistributorVersionTranslator.java", "diffHunk": "@@ -60,28 +67,43 @@ public DistributorVersionDTO populate(DistributorVersion source, DistributorVers\n     public DistributorVersionDTO populate(ModelTranslator modelTranslator, DistributorVersion source,\n         DistributorVersionDTO dest) {\n \n-        dest = super.populate(modelTranslator, source, dest);\n+        if (source == null) {\n+            throw new IllegalArgumentException(\"source is null\");\n+        }\n+\n+        if (dest == null) {\n+            throw new IllegalArgumentException(\"dest is null\");\n+        }\n \n-        dest.setId(source.getId());\n-        dest.setName(source.getName());\n-        dest.setDisplayName(source.getDisplayName());\n+        dest.id(source.getId())\n+            .name(source.getName())\n+            .displayName(source.getDisplayName())\n+            .created(toDateTime(source::getCreated))\n+            .updated(toDateTime(source::getUpdated))\n+            .capabilities(toDto(source.getCapabilities()));\n \n-        if (modelTranslator != null) {\n+        return dest;\n+    }\n \n-            Set<DistributorVersionCapability> capabilities = source.getCapabilities();\n-            if (capabilities != null && !capabilities.isEmpty()) {\n-                for (DistributorVersionCapability capability : capabilities) {\n-                    if (capability != null) {\n-                        dest.addCapability(new DistributorVersionDTO.DistributorVersionCapabilityDTO(\n-                            capability.getId(), capability.getName()));\n-                    }\n-                }\n-            }\n-            else {\n-                dest.setCapabilities(Collections.emptySet());\n-            }\n+    private OffsetDateTime toDateTime(Supplier<Date> source) {", "originalCommit": "79c62e72bb9198b85f6b290852ce7f207684f2ec", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDc5MTgxNw==", "url": "https://github.com/candlepin/candlepin/pull/2596#discussion_r374791817", "bodyText": "If we have a use of the utility such that throwing a supplier at it is easier or cleaner than just using the utility method as a mapper, then it makes sense to do so. However, I would bet that most, if not all, of our uses are going to be just raw one-off conversions for DTO translation.", "author": "Ceiu", "createdAt": "2020-02-04T16:48:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDYxMTE3MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTYzMDYxNw==", "url": "https://github.com/candlepin/candlepin/pull/2596#discussion_r395630617", "bodyText": "Done. Supplier was a leftover from experiment I forgot to rollback. Util function expects Date.", "author": "Januson", "createdAt": "2020-03-20T13:20:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDYxMTE3MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDYzMzY0OA==", "url": "https://github.com/candlepin/candlepin/pull/2596#discussion_r374633648", "bodyText": "In this case, the code throws a BadRequestException, which is 400, not 409.", "author": "nikosmoum", "createdAt": "2020-02-04T12:10:32Z", "path": "api/candlepin-api-spec.yaml", "diffHunk": "@@ -193,6 +193,143 @@ paths:\n               schema:\n                 $ref: '#/components/schemas/ExceptionMessage'\n \n+  /distributor_versions:\n+    get:\n+      tags:\n+        - DistributorVersions\n+      description: Retrieves a list of Distributor Versions\n+      operationId: getVersions\n+      x-java-response-container-type: java.util.stream.Stream\n+      security: []\n+      parameters:\n+        - name: name_search\n+          in: query\n+          required: false\n+          schema:\n+            type: string\n+        - name: capability\n+          in: query\n+          required: false\n+          schema:\n+            type: string\n+      responses:\n+        200:\n+          description: A successful operation\n+          content:\n+            application/json:\n+              schema:\n+                type: array\n+                items:\n+                  $ref: '#/definitions/DistributorVersionDTO'\n+        default:\n+          description: An unexpected exception occurred\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+\n+    post:\n+      tags:\n+        - DistributorVersions\n+      description: Creates a Distributor Version\n+      operationId: create\n+      security: []\n+      requestBody:\n+        description: A new distributor version to be created\n+        required: true\n+        content:\n+          application/json:\n+            schema:\n+              $ref: '#/components/schemas/DistributorVersionDTO'\n+      responses:\n+        200:\n+          description: A successful operation\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/DistributorVersionDTO'\n+        409:\n+          description: A distributor version already exists", "originalCommit": "79c62e72bb9198b85f6b290852ce7f207684f2ec", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTYzMDY4Mw==", "url": "https://github.com/candlepin/candlepin/pull/2596#discussion_r395630683", "bodyText": "Done.", "author": "Januson", "createdAt": "2020-03-20T13:21:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDYzMzY0OA=="}], "type": "inlineReview"}, {"oid": "c781011f3f5cc8ddbf77e1dce2ed275305a007a6", "url": "https://github.com/candlepin/candlepin/commit/c781011f3f5cc8ddbf77e1dce2ed275305a007a6", "message": "ENT-1872: Port DistributorVersionResource to spec-first\n - Add yaml definitions of resource and DTOs\n - Update Translator\n - Fix broken tests", "committedDate": "2020-03-04T12:48:01Z", "type": "forcePushed"}, {"oid": "143da33eee7f716efbb4b958646c04837e320799", "url": "https://github.com/candlepin/candlepin/commit/143da33eee7f716efbb4b958646c04837e320799", "message": "ENT-1872: Port DistributorVersionResource to spec-first\n - Add yaml definitions of resource and DTOs\n - Update Translator\n - Fix broken tests", "committedDate": "2020-03-20T12:57:27Z", "type": "forcePushed"}, {"oid": "2505cb7cca4f672242195ece520be0010d1fd57a", "url": "https://github.com/candlepin/candlepin/commit/2505cb7cca4f672242195ece520be0010d1fd57a", "message": "ENT-1872: Port DistributorVersionResource to spec-first\n - Add yaml definitions of resource and DTOs\n - Update Translator\n - Fix broken tests", "committedDate": "2020-03-20T13:14:54Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIxMjE2MQ==", "url": "https://github.com/candlepin/candlepin/pull/2596#discussion_r397212161", "bodyText": "Successful HTTP DELETE operation is actually a 204 instead of 200, and because the response is usually null, openapi specification suggests not setting a content field at all: https://swagger.io/docs/specification/describing-responses/\nThere's another instance of a DELETE request in the yaml file for ConsumerType which you could also fix. I know it's a bit of a nit-pick, but moving to openapi is a good chance to have good API documentation!", "author": "nikosmoum", "createdAt": "2020-03-24T14:49:51Z", "path": "api/candlepin-api-spec.yaml", "diffHunk": "@@ -257,6 +257,142 @@ paths:\n               schema:\n                 $ref: '#/components/schemas/ExceptionMessage'\n \n+  /distributor_versions:\n+    get:\n+      tags:\n+        - DistributorVersions\n+      description: Retrieves a list of Distributor Versions\n+      operationId: getVersions\n+      x-java-response-container-type: java.util.stream.Stream\n+      security: []\n+      parameters:\n+        - name: name_search\n+          in: query\n+          required: false\n+          schema:\n+            type: string\n+        - name: capability\n+          in: query\n+          required: false\n+          schema:\n+            type: string\n+      responses:\n+        200:\n+          description: A successful operation\n+          content:\n+            application/json:\n+              schema:\n+                type: array\n+                items:\n+                  $ref: '#/definitions/DistributorVersionDTO'\n+        default:\n+          description: An unexpected exception occurred\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+\n+    post:\n+      tags:\n+        - DistributorVersions\n+      description: Creates a Distributor Version\n+      operationId: create\n+      security: []\n+      requestBody:\n+        description: A new distributor version to be created\n+        required: true\n+        content:\n+          application/json:\n+            schema:\n+              $ref: '#/components/schemas/DistributorVersionDTO'\n+      responses:\n+        200:\n+          description: A successful operation\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/DistributorVersionDTO'\n+        400:\n+          description: A distributor version already exists\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+        default:\n+          description: An unexpected exception occurred\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+\n+  /distributor_versions/{id}:\n+    put:\n+      tags:\n+        - DistributorVersions\n+      description: Updates a Distributor Version\n+      operationId: update\n+      security: []\n+      parameters:\n+        - name: id\n+          in: path\n+          required: true\n+          schema:\n+            type: string\n+      requestBody:\n+        description: The fields and updated values to apply to the specified distributor version\n+        required: true\n+        content:\n+          application/json:\n+            schema:\n+              $ref: '#/components/schemas/DistributorVersionDTO'\n+      responses:\n+        200:\n+          description: A successful operation\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/DistributorVersionDTO'\n+        404:\n+          description: A distibutor version could not be found using the provided ID\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+        default:\n+          description: An unexpected exception occurred\n+          content:\n+            application/json:\n+              schema:\n+                $ref: '#/components/schemas/ExceptionMessage'\n+\n+    delete:\n+      tags:\n+        - DistributorVersions\n+      description: Deletes a Distributor Version\n+      operationId: delete\n+      security: []\n+      parameters:\n+        - name: id\n+          in: path\n+          required: true\n+          schema:\n+            type: string\n+      responses:\n+        200:\n+          description: A successful operation\n+          content: {}", "originalCommit": "2505cb7cca4f672242195ece520be0010d1fd57a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzcxODU2NA==", "url": "https://github.com/candlepin/candlepin/pull/2596#discussion_r397718564", "bodyText": "Done.", "author": "Januson", "createdAt": "2020-03-25T09:38:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIxMjE2MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIxOTUwOQ==", "url": "https://github.com/candlepin/candlepin/pull/2596#discussion_r397219509", "bodyText": "Sorry, I meant that the name field only for DistributorVersionCapabilityDTO is being validated and should be required (as it is), but the DistributorVersionDTO name field isn't being validated, so the required property here isn't needed", "author": "nikosmoum", "createdAt": "2020-03-24T14:58:50Z", "path": "api/candlepin-api-spec.yaml", "diffHunk": "@@ -500,6 +636,39 @@ components:\n             principalName:\n               type: string\n \n+    DistributorVersionDTO:\n+      description: A DTO representation of the DistributorVersion\n+      allOf:\n+        - $ref: '#/components/schemas/TimestampedEntity'\n+        - type: object\n+          required:\n+            - name", "originalCommit": "2505cb7cca4f672242195ece520be0010d1fd57a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzcxODYyMw==", "url": "https://github.com/candlepin/candlepin/pull/2596#discussion_r397718623", "bodyText": "Done.", "author": "Januson", "createdAt": "2020-03-25T09:38:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIxOTUwOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIyMTc4MQ==", "url": "https://github.com/candlepin/candlepin/pull/2596#discussion_r397221781", "bodyText": "Same here, only the capability name field is validated for being empty, not the distributor verison name", "author": "nikosmoum", "createdAt": "2020-03-24T15:01:43Z", "path": "api/candlepin-api-spec.yaml", "diffHunk": "@@ -500,6 +636,39 @@ components:\n             principalName:\n               type: string\n \n+    DistributorVersionDTO:\n+      description: A DTO representation of the DistributorVersion\n+      allOf:\n+        - $ref: '#/components/schemas/TimestampedEntity'\n+        - type: object\n+          required:\n+            - name\n+          properties:\n+            id:\n+              type: string\n+            name:\n+              type: string\n+              minLength: 1", "originalCommit": "2505cb7cca4f672242195ece520be0010d1fd57a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzcxODY5MQ==", "url": "https://github.com/candlepin/candlepin/pull/2596#discussion_r397718691", "bodyText": "Done.", "author": "Januson", "createdAt": "2020-03-25T09:38:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIyMTc4MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIyNTI5OA==", "url": "https://github.com/candlepin/candlepin/pull/2596#discussion_r397225298", "bodyText": "This is setting the source's updated date to the dest's created date. it should be setting the created date", "author": "nikosmoum", "createdAt": "2020-03-24T15:06:10Z", "path": "server/src/main/java/org/candlepin/dto/api/v1/DistributorVersionTranslator.java", "diffHunk": "@@ -60,28 +63,38 @@ public DistributorVersionDTO populate(DistributorVersion source, DistributorVers\n     public DistributorVersionDTO populate(ModelTranslator modelTranslator, DistributorVersion source,\n         DistributorVersionDTO dest) {\n \n-        dest = super.populate(modelTranslator, source, dest);\n+        if (source == null) {\n+            throw new IllegalArgumentException(\"source is null\");\n+        }\n \n-        dest.setId(source.getId());\n-        dest.setName(source.getName());\n-        dest.setDisplayName(source.getDisplayName());\n+        if (dest == null) {\n+            throw new IllegalArgumentException(\"dest is null\");\n+        }\n \n-        if (modelTranslator != null) {\n+        dest.id(source.getId())\n+            .name(source.getName())\n+            .displayName(source.getDisplayName())\n+            .created(Util.toDateTime(source.getUpdated()))", "originalCommit": "2505cb7cca4f672242195ece520be0010d1fd57a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzcxODc2MQ==", "url": "https://github.com/candlepin/candlepin/pull/2596#discussion_r397718761", "bodyText": "Done.", "author": "Januson", "createdAt": "2020-03-25T09:38:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIyNTI5OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzY1MTEzMg==", "url": "https://github.com/candlepin/candlepin/pull/2596#discussion_r397651132", "bodyText": "One more thing I forgot to mention. Now that our DTOs don't extend CandlepinDTO, which had a @JsonFilter annotation that ensures the dynamic property filter is used during their serialization, we need to indirectly add that annotation to all DTOs we port to openapi.\nSo both DistributorVersionDTO and DistributorVersionCapabilityDTO should have a mixin added in the JsonProvider.addMixInAnnotationsForDTOs method just like all other DTOs", "author": "nikosmoum", "createdAt": "2020-03-25T07:27:09Z", "path": "api/candlepin-api-spec.yaml", "diffHunk": "@@ -500,6 +636,39 @@ components:\n             principalName:\n               type: string\n \n+    DistributorVersionDTO:\n+      description: A DTO representation of the DistributorVersion\n+      allOf:\n+        - $ref: '#/components/schemas/TimestampedEntity'\n+        - type: object\n+          required:\n+            - name\n+          properties:\n+            id:\n+              type: string\n+            name:\n+              type: string\n+              minLength: 1\n+            displayName:\n+              type: string\n+            capabilities:\n+              type: array\n+              uniqueItems: true\n+              items:\n+                $ref: '#/definitions/DistributorVersionCapabilityDTO'\n+\n+    DistributorVersionCapabilityDTO:", "originalCommit": "2505cb7cca4f672242195ece520be0010d1fd57a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzcxODg0Mg==", "url": "https://github.com/candlepin/candlepin/pull/2596#discussion_r397718842", "bodyText": "Done.", "author": "Januson", "createdAt": "2020-03-25T09:38:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzY1MTEzMg=="}], "type": "inlineReview"}, {"oid": "b1e2d4d3ac373f4623fd35fb0aaa30931eabbc59", "url": "https://github.com/candlepin/candlepin/commit/b1e2d4d3ac373f4623fd35fb0aaa30931eabbc59", "message": "ENT-1872: Port DistributorVersionResource to spec-first\n - Add yaml definitions of resource and DTOs\n - Update Translator\n - Fix broken tests", "committedDate": "2020-03-25T09:37:17Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzczMzI0Nw==", "url": "https://github.com/candlepin/candlepin/pull/2596#discussion_r397733247", "bodyText": "One more thing I forgot (sorry, I know I'm asking for changes multiple times instead of all at once, but it's hard to keep in mind everything that needs to be in line. I'll try to take some notes of a complete list of things to look for in each openapi port PR review from now on!):\nNow that we've marked the DistributorVersionCapabilityDTO's name field as required: true and minLength: 1, this is going to generate some validation annotations, but we still need to manually run the validation (with DTOValidator) on the created/update endpoints with: validator.validateConstraints(dto);. Also, the old DTO is validating that none of the capability DTOs set by the setCapabilities setter is null, so we also have to check this ourselves using validator.validateCollectionElementsNotNull(dto::getCapabilities);", "author": "nikosmoum", "createdAt": "2020-03-25T10:01:30Z", "path": "server/src/main/java/org/candlepin/resource/DistributorVersionResource.java", "diffHunk": "@@ -170,14 +132,8 @@ public DistributorVersionDTO create(\n         return this.translator.translate(curator.create(toCreate), DistributorVersionDTO.class);\n     }\n \n-    @ApiOperation(notes = \"Updates a Distributor Version\", value = \"update\")\n-    @PUT\n-    @Consumes(MediaType.APPLICATION_JSON)\n-    @Produces(MediaType.APPLICATION_JSON)\n-    @Path(\"/{id}\")\n-    public DistributorVersionDTO update(@PathParam(\"id\") String id,\n-        @ApiParam(name = \"distributorVersion\", required = true) DistributorVersionDTO dto,\n-        @Context Principal principal) {\n+    @Override\n+    public DistributorVersionDTO update(String id, DistributorVersionDTO dto) {", "originalCommit": "b1e2d4d3ac373f4623fd35fb0aaa30931eabbc59", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzkwNjY2Nw==", "url": "https://github.com/candlepin/candlepin/pull/2596#discussion_r397906667", "bodyText": "Done.", "author": "Januson", "createdAt": "2020-03-25T14:39:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzczMzI0Nw=="}], "type": "inlineReview"}, {"oid": "08b3c5f4bb7bf353e155fa8363bd381ab50acccd", "url": "https://github.com/candlepin/candlepin/commit/08b3c5f4bb7bf353e155fa8363bd381ab50acccd", "message": "ENT-1872: Port DistributorVersionResource to spec-first\n - Add yaml definitions of resource and DTOs\n - Update Translator\n - Fix broken tests", "committedDate": "2020-03-25T13:32:04Z", "type": "forcePushed"}, {"oid": "b28179f46388947898db2d03c88a3226783d5802", "url": "https://github.com/candlepin/candlepin/commit/b28179f46388947898db2d03c88a3226783d5802", "message": "ENT-1872: Port DistributorVersionResource to spec-first\n - Add yaml definitions of resource and DTOs\n - Update Translator\n - Fix broken tests", "committedDate": "2020-03-25T13:34:20Z", "type": "commit"}, {"oid": "b28179f46388947898db2d03c88a3226783d5802", "url": "https://github.com/candlepin/candlepin/commit/b28179f46388947898db2d03c88a3226783d5802", "message": "ENT-1872: Port DistributorVersionResource to spec-first\n - Add yaml definitions of resource and DTOs\n - Update Translator\n - Fix broken tests", "committedDate": "2020-03-25T13:34:20Z", "type": "forcePushed"}]}