{"pr_number": 2694, "pr_title": "Bug 1751848 Stopped checking & consider pools irrespective of Consumer Entitlement SLA for auto attach. (ENT-2278)", "pr_createdAt": "2020-05-06T07:05:35Z", "pr_url": "https://github.com/candlepin/candlepin/pull/2694", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDU5Nzg1OQ==", "url": "https://github.com/candlepin/candlepin/pull/2694#discussion_r420597859", "bodyText": "Now that is_pool_sla_valid is removed, there's a few related methods that are no longer used that we can also remove. Specifically get_slas_of_existing_consumer_entitlements_from_compliance_status,  is_pool_sla_null_or_exempt, isLevelExempt, and also should_pool_be_prioritized_for_sla because it was not used by anything anyway", "author": "nikosmoum", "createdAt": "2020-05-06T07:36:43Z", "path": "server/src/main/resources/rules/rules.js", "diffHunk": "@@ -2725,47 +2725,6 @@ var Autobind = {\n         return true;\n     },\n \n-    /*\n-     * The pool is valid if any of these is true:\n-     *  - The pool's SLA is null or in the exempt list.\n-     *  - The pool's SLA is non-null, non-exempt, and the consumer does not have any existing entitlements.\n-     *  - The pool's SLA is non-null, non-exempt, and the consumer has existing entitlements,\n-     *    but none of their products has an SLA or a product has an SLA and it is exempt.\n-     *  - The pool's SLA is non-null, non-exempt, and the consumer has existing entitlements,\n-     *    and at least one of them has a product with a non-null SLA that matches the pool SLA.\n-     *\n-     * The pool is invalid if this is true:\n-     *  - The pool's SLA is non-null, non-exempt, and the consumer has existing entitlements,\n-     *    and one or more of those have products with non-null SLAs,\n-     *    but those SLAs do not match with the pool's SLA.\n-     */\n-    is_pool_sla_valid: function(context, pool) {\n-        var poolSLA = pool.getProductAttribute('support_level');\n-\n-        if (is_pool_sla_null_or_exempt(context, poolSLA)) {\n-            return true;\n-        }\n-\n-        var consumer_entitlement_slas = this.get_slas_of_existing_consumer_entitlements_from_compliance_status(context);", "originalCommit": "9dd0a44bbd88fdf234b84a35035e5a4c227681dc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDY3ODQ0MA==", "url": "https://github.com/candlepin/candlepin/pull/2694#discussion_r420678440", "bodyText": "Yes these methods are not in used.\nRemoved it.", "author": "wolfdale", "createdAt": "2020-05-06T10:06:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDU5Nzg1OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDY0MDA4NQ==", "url": "https://github.com/candlepin/candlepin/pull/2694#discussion_r420640085", "bodyText": "Now that we have a change in behaviour, that is tested by this test, we should remove the other tests that were testing the previous behaviour (the only still pass for the wrong reasons, because they were wrongly written in the first place):\nselectBestPoolsDoesNotFilterPoolsBySLAWhenConsumerHasOnlyNullEntitlementSLAs,\nselectBestPoolsFiltersPoolsBySLAWhenConsumerWithSLAHasNonNullNonMatchingEntitlementSLAsAndOwnerDefaultSLAIsUsed,\nselectBestPoolsFiltersPoolsBySLAWhenConsumerWithSLAHasNonNullNonMatchingEntitlementSLAsAndOverrideSLAIsUsed,\nselectBestPoolsFiltersPoolsBySLAWhenConsumerHasNonNullNonMatchingEntitlementSLAsAndConsumerSLAIsUsed,\nselectBestPoolsDoesNotFilterPoolsBySLAWhenConsumerHasNonNullMatchingEntitlementSLAs", "author": "nikosmoum", "createdAt": "2020-05-06T08:56:24Z", "path": "server/src/test/java/org/candlepin/policy/AutobindRulesTest.java", "diffHunk": "@@ -638,6 +638,59 @@ public void selectBestPoolsFiltersPoolsBySLAWhenConsumerHasNonNullNonMatchingEnt\n         assertTrue(bestPools.contains(new PoolQuantity(noSLAPool, 1)));\n     }\n \n+    @Test\n+    @SuppressWarnings(\"checkstyle:LineLength\")\n+    public void selectBestPoolsDoesNotFilterPoolsByConsumerEntitlementInsteadPrioritizePoolsMatchingConsumerSLA() {", "originalCommit": "9dd0a44bbd88fdf234b84a35035e5a4c227681dc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDY3ODYyNQ==", "url": "https://github.com/candlepin/candlepin/pull/2694#discussion_r420678625", "bodyText": "Removed these unit tests & Fixed the commit message.", "author": "wolfdale", "createdAt": "2020-05-06T10:06:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDY0MDA4NQ=="}], "type": "inlineReview"}, {"oid": "442877f10a7e9f10c3ad5aac873bb8d4e60e03c6", "url": "https://github.com/candlepin/candlepin/commit/442877f10a7e9f10c3ad5aac873bb8d4e60e03c6", "message": "1751848: Stopped checking & consider pools irrespective of Consumer Entitlement SLA for auto attach.\n\n\t- Removed Pool validation on Consumer Existing SLA from rules.js\n\t- SLA is only going to be used to prioritize/de-prioritize pools.", "committedDate": "2020-05-06T09:56:38Z", "type": "commit"}, {"oid": "442877f10a7e9f10c3ad5aac873bb8d4e60e03c6", "url": "https://github.com/candlepin/candlepin/commit/442877f10a7e9f10c3ad5aac873bb8d4e60e03c6", "message": "1751848: Stopped checking & consider pools irrespective of Consumer Entitlement SLA for auto attach.\n\n\t- Removed Pool validation on Consumer Existing SLA from rules.js\n\t- SLA is only going to be used to prioritize/de-prioritize pools.", "committedDate": "2020-05-06T09:56:38Z", "type": "forcePushed"}]}