{"pr_number": 2732, "pr_title": "ENT-1856: Port ConsumerDTO to openapi spec", "pr_createdAt": "2020-06-25T07:11:20Z", "pr_url": "https://github.com/candlepin/candlepin/pull/2732", "timeline": [{"oid": "720066db86da9c0529832498453d2b8c57286288", "url": "https://github.com/candlepin/candlepin/commit/720066db86da9c0529832498453d2b8c57286288", "message": "ENT-1856: Port ConsumerDTO to openapi spec\n - Udpated specifications for CapabilityDTO, ConsumerDTO,\n   ConsumerInstalledProductDTO, HypervisorIdDTO\n - Added ConsumerDTOArrayElement to exclude the properties\n   mentioned as HateoasArrayExclude\n - Updated the pojo.mustache to generate a map method to\n   get value from the specific key\n - Updated the ConsumerTypeDeserializer to get appropriate\n   consumer type based on incoming object/string", "committedDate": "2020-06-25T07:22:17Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjIwMzQ1MA==", "url": "https://github.com/candlepin/candlepin/pull/2732#discussion_r446203450", "bodyText": "Since this will be recognized as a getter, will this show up as an additional field to the serialized DTOs?", "author": "Ceiu", "createdAt": "2020-06-26T14:02:10Z", "path": "buildSrc/src/main/resources/templates/pojo.mustache", "diffHunk": "@@ -86,6 +86,14 @@ public class {{classname}} {{#parent}}extends {{{parent}}}{{/parent}} {{#seriali\n \n     return this;\n   }\n+\n+  public {{items.datatypeWithEnum}} get{{nameInCamelCase}}Value({{{items.datatypeWithEnum}}} {{name}}Key) {", "originalCommit": "720066db86da9c0529832498453d2b8c57286288", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjkxMjQ2Nw==", "url": "https://github.com/candlepin/candlepin/pull/2732#discussion_r446912467", "bodyText": "This method will be generated for all auto-generated DTOs.", "author": "sonalidhome", "createdAt": "2020-06-29T11:55:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjIwMzQ1MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODMxNzc5MA==", "url": "https://github.com/candlepin/candlepin/pull/2732#discussion_r448317790", "bodyText": "I don't think it will be recognized as a getter, since it has accepts an argument", "author": "nikosmoum", "createdAt": "2020-07-01T12:07:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjIwMzQ1MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODM2MTY4OA==", "url": "https://github.com/candlepin/candlepin/pull/2732#discussion_r448361688", "bodyText": "hmm, I'll revert the template changes rather create a new method inside ConsumerResource.java. Template changes could difficult to keep track on. We'll have to update this in OpenAPIGenerator.", "author": "sonalidhome", "createdAt": "2020-07-01T13:26:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjIwMzQ1MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTYzMzUzMQ==", "url": "https://github.com/candlepin/candlepin/pull/2732#discussion_r445633531", "bodyText": "There are a few more API endpoints where ConsumerDTO is being returned in a list/array:\nConsumerResource.getGuests\nOwnerResource.listConsumers\nOwnerResource.getHypervisors\nThey should all be changed to return ConsumerDTOArrayElement instead", "author": "nikosmoum", "createdAt": "2020-06-25T15:11:43Z", "path": "server/src/main/java/org/candlepin/resource/ConsumerResource.java", "diffHunk": "@@ -408,7 +409,7 @@ public void sanitizeConsumerFacts(Consumer consumer) {\n     @Produces(MediaType.APPLICATION_JSON)\n     @Wrapped(element = \"consumers\")\n     @SuppressWarnings(\"checkstyle:indentation\")\n-    public CandlepinQuery<ConsumerDTO> list(@QueryParam(\"username\") String userName,\n+    public CandlepinQuery<ConsumerDTOArrayElement> list(@QueryParam(\"username\") String userName,", "originalCommit": "720066db86da9c0529832498453d2b8c57286288", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzQzMjMxNA==", "url": "https://github.com/candlepin/candlepin/pull/2732#discussion_r447432314", "bodyText": "Right, Updated the methods.", "author": "sonalidhome", "createdAt": "2020-06-30T06:10:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTYzMzUzMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTYzODc4MQ==", "url": "https://github.com/candlepin/candlepin/pull/2732#discussion_r445638781", "bodyText": "Since this class no longer extends the TimestampedEntityTranslator, we should manually set the created and updated fields here.", "author": "nikosmoum", "createdAt": "2020-06-25T15:19:03Z", "path": "server/src/main/java/org/candlepin/dto/api/v1/ConsumerInstalledProductTranslator.java", "diffHunk": "@@ -58,16 +59,22 @@ public ConsumerInstalledProductDTO populate(ConsumerInstalledProduct source,\n     public ConsumerInstalledProductDTO populate(ModelTranslator translator, ConsumerInstalledProduct source,\n         ConsumerInstalledProductDTO dest) {\n \n-        dest = super.populate(translator, source, dest);\n+        if (source == null) {\n+            throw new IllegalArgumentException(\"source is null\");\n+        }\n \n-        dest.setId(source.getId());\n-        dest.setProductId(source.getProductId());\n-        dest.setProductName(source.getProductName());\n-        dest.setVersion(source.getVersion());\n-        dest.setArch(source.getArch());\n-        dest.setStatus(source.getStatus());\n-        dest.setStartDate(source.getStartDate());\n-        dest.setEndDate(source.getEndDate());\n+        if (dest == null) {\n+            throw new IllegalArgumentException(\"dest is null\");\n+        }\n+\n+        dest.id(source.getId())", "originalCommit": "720066db86da9c0529832498453d2b8c57286288", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzQzMjI5OA==", "url": "https://github.com/candlepin/candlepin/pull/2732#discussion_r447432298", "bodyText": "Corrected.", "author": "sonalidhome", "createdAt": "2020-06-30T06:10:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTYzODc4MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTYzOTM0NA==", "url": "https://github.com/candlepin/candlepin/pull/2732#discussion_r445639344", "bodyText": "Since this class no longer extends the TimestampedEntityTranslator, we should manually set the created and updated fields here.", "author": "nikosmoum", "createdAt": "2020-06-25T15:19:52Z", "path": "server/src/main/java/org/candlepin/dto/api/v1/HypervisorIdTranslator.java", "diffHunk": "@@ -55,13 +55,17 @@ public HypervisorIdDTO populate(HypervisorId source, HypervisorIdDTO dest) {\n     public HypervisorIdDTO populate(ModelTranslator translator, HypervisorId source,\n         HypervisorIdDTO dest) {\n \n-        dest = super.populate(translator, source, dest);\n+        if (source == null) {\n+            throw new IllegalArgumentException(\"source is null\");\n+        }\n \n-        dest.setId(source.getId() != null ? source.getId().toString() : null);\n-        dest.setHypervisorId(source.getHypervisorId());\n-        dest.setReporterId(source.getReporterId());\n+        if (dest == null) {\n+            throw new IllegalArgumentException(\"dest is null\");\n+        }\n \n-        return dest;\n+        return dest.id(source.getId() != null ? source.getId().toString() : null)", "originalCommit": "720066db86da9c0529832498453d2b8c57286288", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzQzMjI3Ng==", "url": "https://github.com/candlepin/candlepin/pull/2732#discussion_r447432276", "bodyText": "Updated.", "author": "sonalidhome", "createdAt": "2020-06-30T06:10:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTYzOTM0NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjIyMTQyMQ==", "url": "https://github.com/candlepin/candlepin/pull/2732#discussion_r446221421", "bodyText": "I believe, since this GuestIdDTO is within a list, we should instead use the GuestIdDTOArrayElement here.\nI am not 100% sure though, so before doing that, you could check what current master does (e.g. does a GET /consumer/{consumer_uuid} for a consumer that has guest ids that themselves have attributes return the attributes too?)", "author": "nikosmoum", "createdAt": "2020-06-26T14:33:10Z", "path": "api/candlepin-api-spec.yaml", "diffHunk": "@@ -3992,6 +3992,196 @@ components:\n             serial:\n               $ref: '#/components/schemas/CertificateSerialDTO'\n \n+    CapabilityDTO:\n+      description: Represents a consumer capability\n+      properties:\n+        id:\n+          type: string\n+        name:\n+          type: string\n+\n+    ConsumerDTO:\n+      description: Represents a consumer\n+      allOf:\n+        - $ref: '#/components/schemas/TimestampedEntity'\n+        - type: object\n+          properties:\n+              id:\n+                type: string\n+              uuid:\n+                type: string\n+              name:\n+                type: string\n+              username:\n+                type: string\n+              entitlementStatus:\n+                type: string\n+              serviceLevel:\n+                type: string\n+              role:\n+                type: string\n+              usage:\n+                type: string\n+              addOns:\n+                type: array\n+                uniqueItems: true\n+                items:\n+                  type: string\n+              systemPurposeStatus:\n+                type: string\n+              releaseVer:\n+                $ref: '#/components/schemas/ReleaseVerDTO'\n+              owner:\n+                $ref: '#/components/schemas/NestedOwnerDTO'\n+              environment:\n+                $ref: '#/components/schemas/EnvironmentDTO'\n+              entitlementCount:\n+                type: integer\n+                format: int64\n+              facts:\n+                type: object\n+                additionalProperties:\n+                  type: string\n+              lastCheckin:\n+                type: string\n+                format: date-time\n+              installedProducts:\n+                type: array\n+                uniqueItems: true\n+                items:\n+                  $ref: '#/components/schemas/ConsumerInstalledProductDTO'\n+              canActivate:\n+                type: boolean\n+              capabilities:\n+                type: array\n+                uniqueItems: true\n+                items:\n+                  $ref: '#/components/schemas/CapabilityDTO'\n+              hypervisorId:\n+                $ref: '#/components/schemas/HypervisorIdDTO'\n+              contentTags:\n+                type: array\n+                uniqueItems: true\n+                items:\n+                  type: string\n+              autoheal:\n+                type: boolean\n+              annotations:\n+                type: string\n+              contentAccessMode:\n+                type: string\n+              type:\n+                $ref: '#/components/schemas/ConsumerTypeDTO'\n+              idCert:\n+                allOf:\n+                  - $ref: '#/components/schemas/CertificateDTO'\n+              guestIds:\n+                type: array\n+                items:\n+                  $ref: '#/components/schemas/GuestIdDTO'", "originalCommit": "720066db86da9c0529832498453d2b8c57286288", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzQzMjE2Mg==", "url": "https://github.com/candlepin/candlepin/pull/2732#discussion_r447432162", "bodyText": "We are setting empty guest details for every Consumer translation to ConsumerDTO. \n  \n    \n      candlepin/server/src/main/java/org/candlepin/dto/api/v1/ConsumerTranslator.java\n    \n    \n         Line 176\n      in\n      3c74b22\n    \n    \n    \n    \n\n        \n          \n           dest.setGuestIds(new ArrayList<>()); \n        \n    \n  \n\n\nHence there is no need to update the GuestIdDTOArrayElement here.", "author": "sonalidhome", "createdAt": "2020-06-30T06:10:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjIyMTQyMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjIyMzA3Ng==", "url": "https://github.com/candlepin/candlepin/pull/2732#discussion_r446223076", "bodyText": "should be something like Represents a reduced view of a consumer (excluding data like facts and identify certificate)", "author": "nikosmoum", "createdAt": "2020-06-26T14:36:02Z", "path": "api/candlepin-api-spec.yaml", "diffHunk": "@@ -3992,6 +3992,196 @@ components:\n             serial:\n               $ref: '#/components/schemas/CertificateSerialDTO'\n \n+    CapabilityDTO:\n+      description: Represents a consumer capability\n+      properties:\n+        id:\n+          type: string\n+        name:\n+          type: string\n+\n+    ConsumerDTO:\n+      description: Represents a consumer\n+      allOf:\n+        - $ref: '#/components/schemas/TimestampedEntity'\n+        - type: object\n+          properties:\n+              id:\n+                type: string\n+              uuid:\n+                type: string\n+              name:\n+                type: string\n+              username:\n+                type: string\n+              entitlementStatus:\n+                type: string\n+              serviceLevel:\n+                type: string\n+              role:\n+                type: string\n+              usage:\n+                type: string\n+              addOns:\n+                type: array\n+                uniqueItems: true\n+                items:\n+                  type: string\n+              systemPurposeStatus:\n+                type: string\n+              releaseVer:\n+                $ref: '#/components/schemas/ReleaseVerDTO'\n+              owner:\n+                $ref: '#/components/schemas/NestedOwnerDTO'\n+              environment:\n+                $ref: '#/components/schemas/EnvironmentDTO'\n+              entitlementCount:\n+                type: integer\n+                format: int64\n+              facts:\n+                type: object\n+                additionalProperties:\n+                  type: string\n+              lastCheckin:\n+                type: string\n+                format: date-time\n+              installedProducts:\n+                type: array\n+                uniqueItems: true\n+                items:\n+                  $ref: '#/components/schemas/ConsumerInstalledProductDTO'\n+              canActivate:\n+                type: boolean\n+              capabilities:\n+                type: array\n+                uniqueItems: true\n+                items:\n+                  $ref: '#/components/schemas/CapabilityDTO'\n+              hypervisorId:\n+                $ref: '#/components/schemas/HypervisorIdDTO'\n+              contentTags:\n+                type: array\n+                uniqueItems: true\n+                items:\n+                  type: string\n+              autoheal:\n+                type: boolean\n+              annotations:\n+                type: string\n+              contentAccessMode:\n+                type: string\n+              type:\n+                $ref: '#/components/schemas/ConsumerTypeDTO'\n+              idCert:\n+                allOf:\n+                  - $ref: '#/components/schemas/CertificateDTO'\n+              guestIds:\n+                type: array\n+                items:\n+                  $ref: '#/components/schemas/GuestIdDTO'\n+              href:\n+                type: string\n+\n+    ConsumerDTOArrayElement:\n+      description: Represents a consumer", "originalCommit": "720066db86da9c0529832498453d2b8c57286288", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzQzMjE5OA==", "url": "https://github.com/candlepin/candlepin/pull/2732#discussion_r447432198", "bodyText": "Updated.", "author": "sonalidhome", "createdAt": "2020-06-30T06:10:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjIyMzA3Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjIyNDAzMg==", "url": "https://github.com/candlepin/candlepin/pull/2732#discussion_r446224032", "bodyText": "was allOf added here by accident?", "author": "nikosmoum", "createdAt": "2020-06-26T14:37:41Z", "path": "api/candlepin-api-spec.yaml", "diffHunk": "@@ -3992,6 +3992,196 @@ components:\n             serial:\n               $ref: '#/components/schemas/CertificateSerialDTO'\n \n+    CapabilityDTO:\n+      description: Represents a consumer capability\n+      properties:\n+        id:\n+          type: string\n+        name:\n+          type: string\n+\n+    ConsumerDTO:\n+      description: Represents a consumer\n+      allOf:\n+        - $ref: '#/components/schemas/TimestampedEntity'\n+        - type: object\n+          properties:\n+              id:\n+                type: string\n+              uuid:\n+                type: string\n+              name:\n+                type: string\n+              username:\n+                type: string\n+              entitlementStatus:\n+                type: string\n+              serviceLevel:\n+                type: string\n+              role:\n+                type: string\n+              usage:\n+                type: string\n+              addOns:\n+                type: array\n+                uniqueItems: true\n+                items:\n+                  type: string\n+              systemPurposeStatus:\n+                type: string\n+              releaseVer:\n+                $ref: '#/components/schemas/ReleaseVerDTO'\n+              owner:\n+                $ref: '#/components/schemas/NestedOwnerDTO'\n+              environment:\n+                $ref: '#/components/schemas/EnvironmentDTO'\n+              entitlementCount:\n+                type: integer\n+                format: int64\n+              facts:\n+                type: object\n+                additionalProperties:\n+                  type: string\n+              lastCheckin:\n+                type: string\n+                format: date-time\n+              installedProducts:\n+                type: array\n+                uniqueItems: true\n+                items:\n+                  $ref: '#/components/schemas/ConsumerInstalledProductDTO'\n+              canActivate:\n+                type: boolean\n+              capabilities:\n+                type: array\n+                uniqueItems: true\n+                items:\n+                  $ref: '#/components/schemas/CapabilityDTO'\n+              hypervisorId:\n+                $ref: '#/components/schemas/HypervisorIdDTO'\n+              contentTags:\n+                type: array\n+                uniqueItems: true\n+                items:\n+                  type: string\n+              autoheal:\n+                type: boolean\n+              annotations:\n+                type: string\n+              contentAccessMode:\n+                type: string\n+              type:\n+                $ref: '#/components/schemas/ConsumerTypeDTO'\n+              idCert:\n+                allOf:\n+                  - $ref: '#/components/schemas/CertificateDTO'", "originalCommit": "720066db86da9c0529832498453d2b8c57286288", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzQzMjIwOQ==", "url": "https://github.com/candlepin/candlepin/pull/2732#discussion_r447432209", "bodyText": "Yes, I was initially trying out an option writeOnly: true. Later removed but allOf remained to delete.", "author": "sonalidhome", "createdAt": "2020-06-30T06:10:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjIyNDAzMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjIzMTc1OA==", "url": "https://github.com/candlepin/candlepin/pull/2732#discussion_r446231758", "bodyText": "Why are we substituting the fieldName variable in all of these strings? It's a static variable with the value 'label' that never gets reassigned as far as I can see, so there's not point. Specifically about the exception messages, we should try to keep them the same (or similar) to before, since 'Unexpected consumer type format:' is much clearer than 'The field label is missing from: '", "author": "nikosmoum", "createdAt": "2020-06-26T14:50:44Z", "path": "server/src/main/java/org/candlepin/jackson/ConsumerTypeDeserializer.java", "diffHunk": "@@ -16,77 +16,69 @@\n \n import org.candlepin.common.exceptions.CandlepinJsonProcessingException;\n import org.candlepin.dto.api.v1.ConsumerTypeDTO;\n-import org.candlepin.model.ConsumerType.ConsumerTypeEnum;\n \n import com.fasterxml.jackson.core.JsonParser;\n-import com.fasterxml.jackson.core.JsonProcessingException;\n+import com.fasterxml.jackson.core.TreeNode;\n import com.fasterxml.jackson.databind.DeserializationContext;\n-import com.fasterxml.jackson.databind.ObjectMapper;\n-import com.fasterxml.jackson.databind.deser.std.StdDeserializer;\n+import com.fasterxml.jackson.databind.JsonDeserializer;\n \n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n \n import java.io.IOException;\n \n-\n-\n /**\n- * The ConsumerTypeDeserializer handles deserialization of consumer types defined as strings or\n- * objects on existing objects.\n+ * Handles the deserialization of the \"label\" field by wrapping it in a {@link ConsumerTypeDTO} object,\n+ * by handling both of the following formats: <pre> {@code \"type\":\"value\" } </pre> and\n+ * <pre> {@code \"type\":{\"label \":\"value\", \"manifest\":\"value\"} } </pre>.\n  */\n-public class ConsumerTypeDeserializer extends StdDeserializer<ConsumerTypeDTO> {\n-    private static Logger log = LoggerFactory.getLogger(ConsumerTypeDeserializer.class);\n+public class ConsumerTypeDeserializer extends JsonDeserializer<ConsumerTypeDTO> {\n \n-    public ConsumerTypeDeserializer() {\n-        this(null);\n-    }\n+    private static Logger log = LoggerFactory.getLogger(ConsumerTypeDeserializer.class);\n \n-    public ConsumerTypeDeserializer(Class<?> valueClass) {\n-        super(valueClass);\n-    }\n+    private static String fieldName = \"label\";\n \n     @Override\n     public ConsumerTypeDTO deserialize(JsonParser parser, DeserializationContext context)\n-        throws IOException, JsonProcessingException {\n+        throws IOException {\n \n-        // We're expecting an object or a string\n-        switch (parser.currentToken()) {\n-            case START_OBJECT:\n-                return this.parseTypeFromObject(parser);\n+        TreeNode node = parser.readValueAsTree();\n \n-            case VALUE_STRING:\n-                return this.parseTypeFromString(parser);\n+        if (node.isValueNode()) {\n+            log.debug(\"Processing {} as a value node.\", fieldName);\n \n-            default:\n-                throw new CandlepinJsonProcessingException(\"Unexpected consumer type format: \" +\n-                    parser.readValueAsTree(), parser.getCurrentLocation());\n+            return parseValueNode(node);\n+        }\n+        else if (node.isObject()) {\n+            log.debug(\"Processing {} as a containing object node.\", fieldName);\n+\n+            TreeNode valueNode = node.path(fieldName);\n+            if (valueNode.isMissingNode()) {\n+                throw new CandlepinJsonProcessingException(\n+                    \"The field \" + fieldName + \" is missing from: \" + node.asToken(),", "originalCommit": "720066db86da9c0529832498453d2b8c57286288", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzQzMjIzMQ==", "url": "https://github.com/candlepin/candlepin/pull/2732#discussion_r447432231", "bodyText": "Agreed, Updated the exception messages.", "author": "sonalidhome", "createdAt": "2020-06-30T06:10:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjIzMTc1OA=="}], "type": "inlineReview"}, {"oid": "830c3e90d60fc2b9eecf0fb082f3e11145431463", "url": "https://github.com/candlepin/candlepin/commit/830c3e90d60fc2b9eecf0fb082f3e11145431463", "message": "ENT-1856: Port ConsumerDTO to openapi spec\n - Udpated specifications for CapabilityDTO, ConsumerDTO,\n   ConsumerInstalledProductDTO, HypervisorIdDTO\n - Added ConsumerDTOArrayElement to exclude the properties\n   mentioned as HateoasArrayExclude\n - Updated the pojo.mustache to generate a map method to\n   get value from the specific key\n - Updated the ConsumerTypeDeserializer to get appropriate\n   consumer type based on incoming object/string", "committedDate": "2020-06-29T12:18:07Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODMyMzQ4OA==", "url": "https://github.com/candlepin/candlepin/pull/2732#discussion_r448323488", "bodyText": "this field should be added in the required: list, and also have the minLength: 1 property added since ConsumerDTO is currently throwing an exception when it's null or empty", "author": "nikosmoum", "createdAt": "2020-07-01T12:19:27Z", "path": "api/candlepin-api-spec.yaml", "diffHunk": "@@ -3992,6 +3992,195 @@ components:\n             serial:\n               $ref: '#/components/schemas/CertificateSerialDTO'\n \n+    CapabilityDTO:\n+      description: Represents a consumer capability\n+      properties:\n+        id:\n+          type: string\n+        name:\n+          type: string\n+\n+    ConsumerDTO:\n+      description: Represents a consumer\n+      allOf:\n+        - $ref: '#/components/schemas/TimestampedEntity'\n+        - type: object\n+          properties:\n+              id:\n+                type: string\n+              uuid:\n+                type: string\n+              name:\n+                type: string\n+              username:\n+                type: string\n+              entitlementStatus:\n+                type: string\n+              serviceLevel:\n+                type: string\n+              role:\n+                type: string\n+              usage:\n+                type: string\n+              addOns:\n+                type: array\n+                uniqueItems: true\n+                items:\n+                  type: string\n+              systemPurposeStatus:\n+                type: string\n+              releaseVer:\n+                $ref: '#/components/schemas/ReleaseVerDTO'\n+              owner:\n+                $ref: '#/components/schemas/NestedOwnerDTO'\n+              environment:\n+                $ref: '#/components/schemas/EnvironmentDTO'\n+              entitlementCount:\n+                type: integer\n+                format: int64\n+              facts:\n+                type: object\n+                additionalProperties:\n+                  type: string\n+              lastCheckin:\n+                type: string\n+                format: date-time\n+              installedProducts:\n+                type: array\n+                uniqueItems: true\n+                items:\n+                  $ref: '#/components/schemas/ConsumerInstalledProductDTO'\n+              canActivate:\n+                type: boolean\n+              capabilities:\n+                type: array\n+                uniqueItems: true\n+                items:\n+                  $ref: '#/components/schemas/CapabilityDTO'\n+              hypervisorId:\n+                $ref: '#/components/schemas/HypervisorIdDTO'\n+              contentTags:\n+                type: array\n+                uniqueItems: true\n+                items:\n+                  type: string\n+              autoheal:\n+                type: boolean\n+              annotations:\n+                type: string\n+              contentAccessMode:\n+                type: string\n+              type:\n+                $ref: '#/components/schemas/ConsumerTypeDTO'\n+              idCert:\n+                $ref: '#/components/schemas/CertificateDTO'\n+              guestIds:\n+                type: array\n+                items:\n+                  $ref: '#/components/schemas/GuestIdDTO'\n+              href:\n+                type: string\n+\n+    ConsumerDTOArrayElement:\n+      description: Represents a reduced view of a consumer (excluding data like facts and identify certificate)\n+      allOf:\n+        - $ref: '#/components/schemas/TimestampedEntity'\n+        - type: object\n+          properties:\n+            id:\n+              type: string\n+            uuid:\n+              type: string\n+            name:\n+              type: string\n+            username:\n+              type: string\n+            entitlementStatus:\n+              type: string\n+            serviceLevel:\n+              type: string\n+            role:\n+              type: string\n+            usage:\n+              type: string\n+            addOns:\n+              type: array\n+              uniqueItems: true\n+              items:\n+                type: string\n+            systemPurposeStatus:\n+              type: string\n+            releaseVer:\n+              $ref: '#/components/schemas/ReleaseVerDTO'\n+            owner:\n+              $ref: '#/components/schemas/NestedOwnerDTO'\n+            environment:\n+              $ref: '#/components/schemas/EnvironmentDTO'\n+            entitlementCount:\n+              type: integer\n+              format: int64\n+            lastCheckin:\n+              type: string\n+              format: date-time\n+            installedProducts:\n+              type: array\n+              uniqueItems: true\n+              items:\n+                $ref: '#/components/schemas/ConsumerInstalledProductDTO'\n+            canActivate:\n+              type: boolean\n+            capabilities:\n+              type: array\n+              uniqueItems: true\n+              items:\n+                $ref: '#/components/schemas/CapabilityDTO'\n+            hypervisorId:\n+              $ref: '#/components/schemas/HypervisorIdDTO'\n+            contentTags:\n+              type: array\n+              uniqueItems: true\n+              items:\n+                type: string\n+            autoheal:\n+              type: boolean\n+            annotations:\n+              type: string\n+            contentAccessMode:\n+              type: string\n+            type:\n+              $ref: '#/components/schemas/ConsumerTypeDTO'\n+            guestIds:\n+              type: array\n+              items:\n+                $ref: '#/components/schemas/GuestIdDTOArrayElement'\n+            href:\n+              type: string\n+\n+    ConsumerInstalledProductDTO:\n+      description: Represents consumer installed product details\n+      allOf:\n+          - $ref: '#/components/schemas/TimestampedEntity'\n+          - type: object\n+            properties:\n+              id:\n+                type: string\n+              productId:", "originalCommit": "830c3e90d60fc2b9eecf0fb082f3e11145431463", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODg0ODQyOQ==", "url": "https://github.com/candlepin/candlepin/pull/2732#discussion_r448848429", "bodyText": "Added.", "author": "sonalidhome", "createdAt": "2020-07-02T08:49:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODMyMzQ4OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODMyNDUxMw==", "url": "https://github.com/candlepin/candlepin/pull/2732#discussion_r448324513", "bodyText": "this field should be added in the required: list, and also have the minLength: 1 property added, since ConsumerDTO is currently throwing an exception when it's null or empty", "author": "nikosmoum", "createdAt": "2020-07-01T12:21:22Z", "path": "api/candlepin-api-spec.yaml", "diffHunk": "@@ -3992,6 +3992,195 @@ components:\n             serial:\n               $ref: '#/components/schemas/CertificateSerialDTO'\n \n+    CapabilityDTO:\n+      description: Represents a consumer capability\n+      properties:\n+        id:\n+          type: string\n+        name:", "originalCommit": "830c3e90d60fc2b9eecf0fb082f3e11145431463", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODg0ODE5Ng==", "url": "https://github.com/candlepin/candlepin/pull/2732#discussion_r448848196", "bodyText": "Added.", "author": "sonalidhome", "createdAt": "2020-07-02T08:48:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODMyNDUxMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODM4MjczMA==", "url": "https://github.com/candlepin/candlepin/pull/2732#discussion_r448382730", "bodyText": "Since ConsumerDTO is currently throwing an exception when the GuestIdDTO.guestId field is null, we should add that field in the required: list in  GuestIdDTO and GuestIdDTOArrayElement specifications.", "author": "nikosmoum", "createdAt": "2020-07-01T13:59:01Z", "path": "api/candlepin-api-spec.yaml", "diffHunk": "@@ -3992,6 +3992,195 @@ components:\n             serial:\n               $ref: '#/components/schemas/CertificateSerialDTO'\n \n+    CapabilityDTO:\n+      description: Represents a consumer capability\n+      properties:\n+        id:\n+          type: string\n+        name:\n+          type: string\n+\n+    ConsumerDTO:\n+      description: Represents a consumer\n+      allOf:\n+        - $ref: '#/components/schemas/TimestampedEntity'\n+        - type: object\n+          properties:\n+              id:\n+                type: string\n+              uuid:\n+                type: string\n+              name:\n+                type: string\n+              username:\n+                type: string\n+              entitlementStatus:\n+                type: string\n+              serviceLevel:\n+                type: string\n+              role:\n+                type: string\n+              usage:\n+                type: string\n+              addOns:\n+                type: array\n+                uniqueItems: true\n+                items:\n+                  type: string\n+              systemPurposeStatus:\n+                type: string\n+              releaseVer:\n+                $ref: '#/components/schemas/ReleaseVerDTO'\n+              owner:\n+                $ref: '#/components/schemas/NestedOwnerDTO'\n+              environment:\n+                $ref: '#/components/schemas/EnvironmentDTO'\n+              entitlementCount:\n+                type: integer\n+                format: int64\n+              facts:\n+                type: object\n+                additionalProperties:\n+                  type: string\n+              lastCheckin:\n+                type: string\n+                format: date-time\n+              installedProducts:\n+                type: array\n+                uniqueItems: true\n+                items:\n+                  $ref: '#/components/schemas/ConsumerInstalledProductDTO'\n+              canActivate:\n+                type: boolean\n+              capabilities:\n+                type: array\n+                uniqueItems: true\n+                items:\n+                  $ref: '#/components/schemas/CapabilityDTO'\n+              hypervisorId:\n+                $ref: '#/components/schemas/HypervisorIdDTO'\n+              contentTags:\n+                type: array\n+                uniqueItems: true\n+                items:\n+                  type: string\n+              autoheal:\n+                type: boolean\n+              annotations:\n+                type: string\n+              contentAccessMode:\n+                type: string\n+              type:\n+                $ref: '#/components/schemas/ConsumerTypeDTO'\n+              idCert:\n+                $ref: '#/components/schemas/CertificateDTO'\n+              guestIds:\n+                type: array\n+                items:\n+                  $ref: '#/components/schemas/GuestIdDTO'", "originalCommit": "830c3e90d60fc2b9eecf0fb082f3e11145431463", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODg0OTY5Nw==", "url": "https://github.com/candlepin/candlepin/pull/2732#discussion_r448849697", "bodyText": "Added.", "author": "sonalidhome", "createdAt": "2020-07-02T08:51:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODM4MjczMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODg2NDk4Mg==", "url": "https://github.com/candlepin/candlepin/pull/2732#discussion_r448864982", "bodyText": "It's not the id field that needs to be in required:, but the guestId one", "author": "nikosmoum", "createdAt": "2020-07-02T09:16:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODM4MjczMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODkyNjIxNA==", "url": "https://github.com/candlepin/candlepin/pull/2732#discussion_r448926214", "bodyText": "corrected.", "author": "sonalidhome", "createdAt": "2020-07-02T11:11:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODM4MjczMA=="}], "type": "inlineReview"}, {"oid": "986bfb0f6d8fc7e0ce68d34db8ead8e67cb1c2be", "url": "https://github.com/candlepin/candlepin/commit/986bfb0f6d8fc7e0ce68d34db8ead8e67cb1c2be", "message": "ENT-1856: Port ConsumerDTO to openapi spec\n - Udpated specifications for CapabilityDTO, ConsumerDTO,\n   ConsumerInstalledProductDTO, HypervisorIdDTO\n - Added ConsumerDTOArrayElement to exclude the properties\n   mentioned as HateoasArrayExclude\n - Updated the ConsumerTypeDeserializer to get appropriate\n   consumer type based on incoming object/string", "committedDate": "2020-07-02T08:46:15Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODg2ODc2Ng==", "url": "https://github.com/candlepin/candlepin/pull/2732#discussion_r448868766", "bodyText": "One more thing: the required: property is not recognized in this place, it has to be under the allOf: property (at the same level as properties:) for the annotations to be generated", "author": "nikosmoum", "createdAt": "2020-07-02T09:23:13Z", "path": "api/candlepin-api-spec.yaml", "diffHunk": "@@ -3992,6 +3992,201 @@ components:\n             serial:\n               $ref: '#/components/schemas/CertificateSerialDTO'\n \n+    CapabilityDTO:\n+      description: Represents a consumer capability\n+      required:\n+        - name\n+      properties:\n+        id:\n+          type: string\n+        name:\n+          type: string\n+          minLength: 1\n+\n+    ConsumerDTO:\n+      description: Represents a consumer\n+      allOf:\n+        - $ref: '#/components/schemas/TimestampedEntity'\n+        - type: object\n+          properties:\n+              id:\n+                type: string\n+              uuid:\n+                type: string\n+              name:\n+                type: string\n+              username:\n+                type: string\n+              entitlementStatus:\n+                type: string\n+              serviceLevel:\n+                type: string\n+              role:\n+                type: string\n+              usage:\n+                type: string\n+              addOns:\n+                type: array\n+                uniqueItems: true\n+                items:\n+                  type: string\n+              systemPurposeStatus:\n+                type: string\n+              releaseVer:\n+                $ref: '#/components/schemas/ReleaseVerDTO'\n+              owner:\n+                $ref: '#/components/schemas/NestedOwnerDTO'\n+              environment:\n+                $ref: '#/components/schemas/EnvironmentDTO'\n+              entitlementCount:\n+                type: integer\n+                format: int64\n+              facts:\n+                type: object\n+                additionalProperties:\n+                  type: string\n+              lastCheckin:\n+                type: string\n+                format: date-time\n+              installedProducts:\n+                type: array\n+                uniqueItems: true\n+                items:\n+                  $ref: '#/components/schemas/ConsumerInstalledProductDTO'\n+              canActivate:\n+                type: boolean\n+              capabilities:\n+                type: array\n+                uniqueItems: true\n+                items:\n+                  $ref: '#/components/schemas/CapabilityDTO'\n+              hypervisorId:\n+                $ref: '#/components/schemas/HypervisorIdDTO'\n+              contentTags:\n+                type: array\n+                uniqueItems: true\n+                items:\n+                  type: string\n+              autoheal:\n+                type: boolean\n+              annotations:\n+                type: string\n+              contentAccessMode:\n+                type: string\n+              type:\n+                $ref: '#/components/schemas/ConsumerTypeDTO'\n+              idCert:\n+                $ref: '#/components/schemas/CertificateDTO'\n+              guestIds:\n+                type: array\n+                items:\n+                  $ref: '#/components/schemas/GuestIdDTO'\n+              href:\n+                type: string\n+\n+    ConsumerDTOArrayElement:\n+      description: Represents a reduced view of a consumer (excluding data like facts and identify certificate)\n+      allOf:\n+        - $ref: '#/components/schemas/TimestampedEntity'\n+        - type: object\n+          properties:\n+            id:\n+              type: string\n+            uuid:\n+              type: string\n+            name:\n+              type: string\n+            username:\n+              type: string\n+            entitlementStatus:\n+              type: string\n+            serviceLevel:\n+              type: string\n+            role:\n+              type: string\n+            usage:\n+              type: string\n+            addOns:\n+              type: array\n+              uniqueItems: true\n+              items:\n+                type: string\n+            systemPurposeStatus:\n+              type: string\n+            releaseVer:\n+              $ref: '#/components/schemas/ReleaseVerDTO'\n+            owner:\n+              $ref: '#/components/schemas/NestedOwnerDTO'\n+            environment:\n+              $ref: '#/components/schemas/EnvironmentDTO'\n+            entitlementCount:\n+              type: integer\n+              format: int64\n+            lastCheckin:\n+              type: string\n+              format: date-time\n+            installedProducts:\n+              type: array\n+              uniqueItems: true\n+              items:\n+                $ref: '#/components/schemas/ConsumerInstalledProductDTO'\n+            canActivate:\n+              type: boolean\n+            capabilities:\n+              type: array\n+              uniqueItems: true\n+              items:\n+                $ref: '#/components/schemas/CapabilityDTO'\n+            hypervisorId:\n+              $ref: '#/components/schemas/HypervisorIdDTO'\n+            contentTags:\n+              type: array\n+              uniqueItems: true\n+              items:\n+                type: string\n+            autoheal:\n+              type: boolean\n+            annotations:\n+              type: string\n+            contentAccessMode:\n+              type: string\n+            type:\n+              $ref: '#/components/schemas/ConsumerTypeDTO'\n+            guestIds:\n+              type: array\n+              items:\n+                $ref: '#/components/schemas/GuestIdDTOArrayElement'\n+            href:\n+              type: string\n+\n+    ConsumerInstalledProductDTO:\n+      description: Represents consumer installed product details\n+      required:\n+        - productId", "originalCommit": "986bfb0f6d8fc7e0ce68d34db8ead8e67cb1c2be", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODkyNTMyNA==", "url": "https://github.com/candlepin/candlepin/pull/2732#discussion_r448925324", "bodyText": "Corrected.", "author": "sonalidhome", "createdAt": "2020-07-02T11:09:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODg2ODc2Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODg2OTI1Ng==", "url": "https://github.com/candlepin/candlepin/pull/2732#discussion_r448869256", "bodyText": "Same here, required: needs to be at the same level as properties: is", "author": "nikosmoum", "createdAt": "2020-07-02T09:24:07Z", "path": "api/candlepin-api-spec.yaml", "diffHunk": "@@ -4202,6 +4397,8 @@ components:\n \n     GuestIdDTO:\n       description: Represents a guest ID running on a virt host consumer\n+      required:", "originalCommit": "986bfb0f6d8fc7e0ce68d34db8ead8e67cb1c2be", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODkyNTI3MA==", "url": "https://github.com/candlepin/candlepin/pull/2732#discussion_r448925270", "bodyText": "Corrected.", "author": "sonalidhome", "createdAt": "2020-07-02T11:09:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODg2OTI1Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODg2OTM2MA==", "url": "https://github.com/candlepin/candlepin/pull/2732#discussion_r448869360", "bodyText": "Same here, required: needs to be at the same level as properties: is", "author": "nikosmoum", "createdAt": "2020-07-02T09:24:16Z", "path": "api/candlepin-api-spec.yaml", "diffHunk": "@@ -4217,6 +4414,8 @@ components:\n \n     GuestIdDTOArrayElement:\n       description: Represents a guest ID running on a virt host consumer. Does not include the attributes field\n+      required:", "originalCommit": "986bfb0f6d8fc7e0ce68d34db8ead8e67cb1c2be", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODkyNTIxNQ==", "url": "https://github.com/candlepin/candlepin/pull/2732#discussion_r448925215", "bodyText": "Corrected.", "author": "sonalidhome", "createdAt": "2020-07-02T11:09:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODg2OTM2MA=="}], "type": "inlineReview"}, {"oid": "b72770793a1bc00acf504eae757bae8aec6244d6", "url": "https://github.com/candlepin/candlepin/commit/b72770793a1bc00acf504eae757bae8aec6244d6", "message": "ENT-1856: Port ConsumerDTO to openapi spec\n - Udpated specifications for CapabilityDTO, ConsumerDTO,\n   ConsumerInstalledProductDTO, HypervisorIdDTO\n - Added ConsumerDTOArrayElement to exclude the properties\n   mentioned as HateoasArrayExclude\n - Updated the ConsumerTypeDeserializer to get appropriate\n   consumer type based on incoming object/string", "committedDate": "2020-07-02T11:07:22Z", "type": "commit"}, {"oid": "b72770793a1bc00acf504eae757bae8aec6244d6", "url": "https://github.com/candlepin/candlepin/commit/b72770793a1bc00acf504eae757bae8aec6244d6", "message": "ENT-1856: Port ConsumerDTO to openapi spec\n - Udpated specifications for CapabilityDTO, ConsumerDTO,\n   ConsumerInstalledProductDTO, HypervisorIdDTO\n - Added ConsumerDTOArrayElement to exclude the properties\n   mentioned as HateoasArrayExclude\n - Updated the ConsumerTypeDeserializer to get appropriate\n   consumer type based on incoming object/string", "committedDate": "2020-07-02T11:07:22Z", "type": "forcePushed"}]}