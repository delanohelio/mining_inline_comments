{"pr_number": 2682, "pr_title": "ENT-1859: Port EnvironmentDTO to openapi spec", "pr_createdAt": "2020-04-17T09:24:03Z", "pr_url": "https://github.com/candlepin/candlepin/pull/2682", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDE4NTM0Mg==", "url": "https://github.com/candlepin/candlepin/pull/2682#discussion_r410185342", "bodyText": "I hope this will not change the API schema defination. Previously it was not unique.", "author": "sonalidhome", "createdAt": "2020-04-17T12:20:43Z", "path": "api/candlepin-api-spec.yaml", "diffHunk": "@@ -1265,6 +1265,35 @@ components:\n           type: string\n           minLength: 1\n \n+    EnvironmentDTO:\n+      description: DTO representing an environment\n+      allOf:\n+        - $ref: '#/components/schemas/TimestampedEntity'\n+        - type: object\n+          properties:\n+            id:\n+              type: string\n+            name:\n+              type: string\n+            description:\n+              type: string\n+            owner:\n+              $ref: \"#/components/schemas/NestedOwnerDTO\"\n+            environmentContent:\n+              type: array\n+              uniqueItems: true", "originalCommit": "a90f0addd888d84307c8edc083b076b62f8ab325", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDIxMzA0Ng==", "url": "https://github.com/candlepin/candlepin/pull/2682#discussion_r410213046", "bodyText": "It should be fine, because even thougn now it is a Collection<>, before the DTO was created we were using the Environment.java model entity, which uses a Set, so we should be fine", "author": "nikosmoum", "createdAt": "2020-04-17T13:13:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDE4NTM0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDIxMzQ2OQ==", "url": "https://github.com/candlepin/candlepin/pull/2682#discussion_r410213469", "bodyText": "No I don't think it will impact the APIs.\nEarlier environmentContent property was backed by a HashMap (I assume this was done to gain performance with quick equality check while adding a content), now it is changed with a Set representation, this is much more aligned with the entity class Environment which also follows a Set representation for EnvironmentContent.", "author": "wolfdale", "createdAt": "2020-04-17T13:14:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDE4NTM0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDM1NTIzNA==", "url": "https://github.com/candlepin/candlepin/pull/2682#discussion_r410355234", "bodyText": "While true, one thing we want to be careful about is adding restrictions that will inadvertently break current clients (even if they're doing silly things). When it comes to API or communication design, I like to follow Postel's law as much as possible. Basically: be conservative in what you send, be liberal in what you accept.\nI think this will be fine, but this is something where I want to make sure everyone is on the same page.", "author": "Ceiu", "createdAt": "2020-04-17T17:06:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDE4NTM0Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDIxNDYxNg==", "url": "https://github.com/candlepin/candlepin/pull/2682#discussion_r410214616", "bodyText": "Since we're trying to have this spec also be a good source of documentation, we should provide better descriptions.\nA good guideline for all descriptions is: Try to use information from the model entity's class javadoc comment (in this case Environment.java), instead of from the DTO, because our DTOs don't have useful documentation (it's always something like \"A DTO representation of X entity\"). Then, take that and try to distill it to not have any implementation details, and be concise. In this case it could be something like: \"Represents an environment within an org used to enable/disable/promote content in specific places\"", "author": "nikosmoum", "createdAt": "2020-04-17T13:16:30Z", "path": "api/candlepin-api-spec.yaml", "diffHunk": "@@ -1265,6 +1265,35 @@ components:\n           type: string\n           minLength: 1\n \n+    EnvironmentDTO:\n+      description: DTO representing an environment", "originalCommit": "a90f0addd888d84307c8edc083b076b62f8ab325", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTA5OTc3MA==", "url": "https://github.com/candlepin/candlepin/pull/2682#discussion_r411099770", "bodyText": "Agreed. Added description for EnvironmentDTO & EnvironmentContentDTO", "author": "wolfdale", "createdAt": "2020-04-20T05:20:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDIxNDYxNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDIyMDQ5Mg==", "url": "https://github.com/candlepin/candlepin/pull/2682#discussion_r410220492", "bodyText": "Nitpick: No need for Arrays.asList here if only 1 element is being added, you can create empty HashSet and then add it", "author": "nikosmoum", "createdAt": "2020-04-17T13:26:15Z", "path": "server/src/test/java/org/candlepin/dto/api/v1/ConsumerDTOTest.java", "diffHunk": "@@ -92,6 +92,22 @@ public ConsumerDTOTest() {\n \n         NestedOwnerDTO owner = new NestedOwnerDTO().id(\"OwnerId\").displayName(\"Name\").key(\"12345\");\n \n+        ContentDTO cDTO = new ContentDTO()\n+            .id(\"ContentId\")\n+            .name(\"ContentName\")\n+            .modifiedProductIds(new HashSet<>(Arrays.asList(\"ID1\", \"ID2\")));\n+\n+        Set<EnvironmentContentDTO> envContentDTO = new HashSet<>(Arrays.asList(new EnvironmentContentDTO()", "originalCommit": "a90f0addd888d84307c8edc083b076b62f8ab325", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDM2OTk3NA==", "url": "https://github.com/candlepin/candlepin/pull/2682#discussion_r410369974", "bodyText": "There's also Collections.singleton and Util.asSet", "author": "Ceiu", "createdAt": "2020-04-17T17:34:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDIyMDQ5Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTA5OTgzMQ==", "url": "https://github.com/candlepin/candlepin/pull/2682#discussion_r411099831", "bodyText": "Done.", "author": "wolfdale", "createdAt": "2020-04-20T05:20:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDIyMDQ5Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDI0MjQ0MQ==", "url": "https://github.com/candlepin/candlepin/pull/2682#discussion_r410242441", "bodyText": "One more minor change, that we could apply in general from now on: Use org.candlepin.util.Util.toDateTime() to as a utility converter from Date to OffsetDateTime", "author": "nikosmoum", "createdAt": "2020-04-17T14:00:17Z", "path": "server/src/main/java/org/candlepin/dto/api/v1/EnvironmentTranslator.java", "diffHunk": "@@ -64,35 +62,48 @@ public EnvironmentDTO populate(Environment source, EnvironmentDTO dest) {\n     public EnvironmentDTO populate(ModelTranslator translator, Environment source,\n         EnvironmentDTO dest) {\n \n-        dest = super.populate(translator, source, dest);\n+        if (source == null) {\n+            throw new IllegalArgumentException(\"source is null\");\n+        }\n+\n+        if (dest == null) {\n+            throw new IllegalArgumentException(\"destination is null\");\n+        }\n \n-        dest.setId(source.getId());\n-        dest.setName(source.getName());\n-        dest.setDescription(source.getDescription());\n+        Date created = source.getCreated();\n+        dest.created(created != null ? created.toInstant().atOffset(ZoneOffset.UTC) : null);\n+\n+        Date updated = source.getUpdated();\n+        dest.updated(updated != null ? updated.toInstant().atOffset(ZoneOffset.UTC) : null);", "originalCommit": "a90f0addd888d84307c8edc083b076b62f8ab325", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTA5OTkwNg==", "url": "https://github.com/candlepin/candlepin/pull/2682#discussion_r411099906", "bodyText": "Fixed.", "author": "wolfdale", "createdAt": "2020-04-20T05:20:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDI0MjQ0MQ=="}], "type": "inlineReview"}, {"oid": "a00a36345c1ccb67d1428190ee783b61d83c6511", "url": "https://github.com/candlepin/candlepin/commit/a00a36345c1ccb67d1428190ee783b61d83c6511", "message": "ENT-1859: Port EnvironmentDTO to openapi spec", "committedDate": "2020-04-20T05:17:18Z", "type": "commit"}, {"oid": "a00a36345c1ccb67d1428190ee783b61d83c6511", "url": "https://github.com/candlepin/candlepin/commit/a00a36345c1ccb67d1428190ee783b61d83c6511", "message": "ENT-1859: Port EnvironmentDTO to openapi spec", "committedDate": "2020-04-20T05:17:18Z", "type": "forcePushed"}]}