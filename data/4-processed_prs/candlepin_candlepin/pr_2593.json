{"pr_number": 2593, "pr_title": "ENT-1849: Port AsyncJobStatusDTO to openapi spec", "pr_createdAt": "2020-01-30T07:15:02Z", "pr_url": "https://github.com/candlepin/candlepin/pull/2593", "timeline": [{"oid": "4a8be66e069d050cc7967c8f505301183f2ad8d4", "url": "https://github.com/candlepin/candlepin/commit/4a8be66e069d050cc7967c8f505301183f2ad8d4", "message": "ENT-1849: Port AsyncJobStatusDTO to openapi spec\n- Added specifications in yaml file\n- Removed existing AsyncJobstatusDTO and AsyncJobstatusDTOTest\n- Updated the populate method of translator\n- Updated JUnit tests", "committedDate": "2020-01-30T07:19:34Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjgzMjkwMg==", "url": "https://github.com/candlepin/candlepin/pull/2593#discussion_r372832902", "bodyText": "We should be more cautious here, checking for null, and using format instead of concatenation: source.getId() != null ? String.format(\"/jobs/%s\", source.getId()) : null", "author": "nikosmoum", "createdAt": "2020-01-30T09:15:22Z", "path": "server/src/main/java/org/candlepin/dto/api/v1/AsyncJobStatusTranslator.java", "diffHunk": "@@ -58,27 +60,45 @@ public AsyncJobStatusDTO populate(AsyncJobStatus source, AsyncJobStatusDTO desti\n     public AsyncJobStatusDTO populate(ModelTranslator translator, AsyncJobStatus source,\n         AsyncJobStatusDTO destination) {\n \n-        destination = super.populate(translator, source, destination);\n+        if (source == null) {\n+            throw new IllegalArgumentException(\"source is null\");\n+        }\n+\n+        if (destination == null) {\n+            throw new IllegalArgumentException(\"destination is null\");\n+        }\n+\n+        Date created = source.getCreated();\n+        destination.setCreated(created != null ? created.toInstant().atOffset(ZoneOffset.UTC) : null);\n+\n+        Date updated = source.getUpdated();\n+        destination.setUpdated(updated != null ? updated.toInstant().atOffset(ZoneOffset.UTC) : null);\n \n         destination.setId(source.getId());\n-        destination.setJobKey(source.getJobKey());\n+        destination.setKey(source.getJobKey());\n         destination.setName(source.getName());\n         destination.setGroup(source.getGroup());\n         destination.setOrigin(source.getOrigin());\n         destination.setExecutor(source.getExecutor());\n         destination.setPrincipal(source.getPrincipalName());\n-        destination.setStartTime(source.getStartTime());\n-        destination.setEndTime(source.getEndTime());\n-        destination.setAttempts(source.getAttempts());\n-        destination.setMaxAttempts(source.getMaxAttempts());\n-        destination.setResult(source.getJobResult());\n \n         JobState state = source.getState();\n         destination.setState(state != null ? state.name() : null);\n \n         JobState pstate = source.getPreviousState();\n         destination.setPreviousState(pstate != null ? pstate.name() : null);\n \n+        Date startTime = source.getStartTime();\n+        destination.setStartTime(startTime != null ? startTime.toInstant().atOffset(ZoneOffset.UTC) : null);\n+\n+        Date endTime = source.getEndTime();\n+        destination.setEndTime(endTime != null ? endTime.toInstant().atOffset(ZoneOffset.UTC) : null);\n+\n+        destination.setAttempts(source.getAttempts());\n+        destination.setMaxAttempts(source.getMaxAttempts());\n+        destination.setStatusPath(\"/jobs/\" + source.getId());", "originalCommit": "4a8be66e069d050cc7967c8f505301183f2ad8d4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mjg5NDUxMw==", "url": "https://github.com/candlepin/candlepin/pull/2593#discussion_r372894513", "bodyText": "agreed, corrected.", "author": "sonalidhome", "createdAt": "2020-01-30T11:24:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjgzMjkwMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjgzODMzMg==", "url": "https://github.com/candlepin/candlepin/pull/2593#discussion_r372838332", "bodyText": "Is this needed? From what I recall there is a conversation in another PR between @abhiskum and @Ceiu that we should not use discriminator.", "author": "nikosmoum", "createdAt": "2020-01-30T09:26:42Z", "path": "api/candlepin-api-spec.yaml", "diffHunk": "@@ -232,6 +232,61 @@ components:\n             manifest:\n               type: boolean\n \n+    AsyncJobStatusDTO:\n+      description: DTO representing an async job status\n+      discriminator:\n+        propertyName: type", "originalCommit": "4a8be66e069d050cc7967c8f505301183f2ad8d4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mjg3NjI5NA==", "url": "https://github.com/candlepin/candlepin/pull/2593#discussion_r372876294", "bodyText": "@nikosmoum yes, we have decided not to use 'discriminator' in DTO definition.", "author": "abhiskum", "createdAt": "2020-01-30T10:43:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjgzODMzMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mjg5NDIyOA==", "url": "https://github.com/candlepin/candlepin/pull/2593#discussion_r372894228", "bodyText": "I missed PR conversion.\nAfter a discussion with @abhiskum, I understood we should not be adding this. Now eliminated it from the code.", "author": "sonalidhome", "createdAt": "2020-01-30T11:23:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjgzODMzMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mjc5MjAxNQ==", "url": "https://github.com/candlepin/candlepin/pull/2593#discussion_r372792015", "bodyText": "@sonalidhome Here you can use self-reference setter methods.\ndestination.id(...).key(..).name('..') ...", "author": "abhiskum", "createdAt": "2020-01-30T07:25:54Z", "path": "server/src/main/java/org/candlepin/dto/api/v1/AsyncJobStatusTranslator.java", "diffHunk": "@@ -58,27 +60,45 @@ public AsyncJobStatusDTO populate(AsyncJobStatus source, AsyncJobStatusDTO desti\n     public AsyncJobStatusDTO populate(ModelTranslator translator, AsyncJobStatus source,\n         AsyncJobStatusDTO destination) {\n \n-        destination = super.populate(translator, source, destination);\n+        if (source == null) {\n+            throw new IllegalArgumentException(\"source is null\");\n+        }\n+\n+        if (destination == null) {\n+            throw new IllegalArgumentException(\"destination is null\");\n+        }\n+\n+        Date created = source.getCreated();\n+        destination.setCreated(created != null ? created.toInstant().atOffset(ZoneOffset.UTC) : null);\n+\n+        Date updated = source.getUpdated();\n+        destination.setUpdated(updated != null ? updated.toInstant().atOffset(ZoneOffset.UTC) : null);\n \n         destination.setId(source.getId());\n-        destination.setJobKey(source.getJobKey());\n+        destination.setKey(source.getJobKey());", "originalCommit": "4a8be66e069d050cc7967c8f505301183f2ad8d4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mjg5MjUxMg==", "url": "https://github.com/candlepin/candlepin/pull/2593#discussion_r372892512", "bodyText": "Updated as suggested.", "author": "sonalidhome", "createdAt": "2020-01-30T11:19:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mjc5MjAxNQ=="}], "type": "inlineReview"}, {"oid": "9db856d17ce9a85d083dc2f4760331701d09aad3", "url": "https://github.com/candlepin/candlepin/commit/9db856d17ce9a85d083dc2f4760331701d09aad3", "message": "ENT-1849: Port AsyncJobStatusDTO to openapi spec\n- Added specifications in yaml file\n- Removed existing AsyncJobstatusDTO and AsyncJobstatusDTOTest\n- Updated the populate method of translator\n- Updated JUnit tests", "committedDate": "2020-01-30T11:17:49Z", "type": "forcePushed"}, {"oid": "1dfa2a1b58be1acd04846042dbcacf523b86d5f7", "url": "https://github.com/candlepin/candlepin/commit/1dfa2a1b58be1acd04846042dbcacf523b86d5f7", "message": "ENT-1849: Port AsyncJobStatusDTO to openapi spec\n- Added specifications in yaml file\n- Removed existing AsyncJobstatusDTO and AsyncJobstatusDTOTest\n- Updated the populate method of translator\n- Updated JUnit tests", "committedDate": "2020-01-30T11:27:00Z", "type": "commit"}, {"oid": "1dfa2a1b58be1acd04846042dbcacf523b86d5f7", "url": "https://github.com/candlepin/candlepin/commit/1dfa2a1b58be1acd04846042dbcacf523b86d5f7", "message": "ENT-1849: Port AsyncJobStatusDTO to openapi spec\n- Added specifications in yaml file\n- Removed existing AsyncJobstatusDTO and AsyncJobstatusDTOTest\n- Updated the populate method of translator\n- Updated JUnit tests", "committedDate": "2020-01-30T11:27:00Z", "type": "forcePushed"}]}