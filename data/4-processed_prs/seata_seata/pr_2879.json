{"pr_number": 2879, "pr_title": "bugfix: fix deadlock during springboot project startup", "pr_createdAt": "2020-07-10T17:23:41Z", "pr_url": "https://github.com/seata/seata/pull/2879", "timeline": [{"oid": "0e3e3aef7622b727f6441f7cbbc4b6c5955d142d", "url": "https://github.com/seata/seata/commit/0e3e3aef7622b727f6441f7cbbc4b6c5955d142d", "message": "bugfix: fix deadlock on 'main' and 'timeoutChecker' threads", "committedDate": "2020-07-10T15:26:21Z", "type": "commit"}, {"oid": "886307b9f747b6e306f420f226aa40ed4111bc6a", "url": "https://github.com/seata/seata/commit/886307b9f747b6e306f420f226aa40ed4111bc6a", "message": "bugfix: fix deadlock on 'main' and 'timeoutChecker' threads", "committedDate": "2020-07-10T15:48:19Z", "type": "commit"}, {"oid": "97173590719abf2df7a7cd5e1798a1000545255d", "url": "https://github.com/seata/seata/commit/97173590719abf2df7a7cd5e1798a1000545255d", "message": "AT\u6a21\u5f0f\u5728\u4e0d\u9700\u8981\u6267\u884c\u4ee3\u7406\u65f6\uff0c\u4e0d\u8d70\u4ee3\u7406\u3002", "committedDate": "2020-07-10T16:43:10Z", "type": "commit"}, {"oid": "df851974043014e420ee65a829e67730772b2b20", "url": "https://github.com/seata/seata/commit/df851974043014e420ee65a829e67730772b2b20", "message": "\u53d8\u91cf\u8c03\u6574", "committedDate": "2020-07-10T16:56:15Z", "type": "commit"}, {"oid": "a5c3675e9a5fc47dd2eab1cfc8d67e63173859bc", "url": "https://github.com/seata/seata/commit/a5c3675e9a5fc47dd2eab1cfc8d67e63173859bc", "message": "\u6d4b\u8bd5\u7528\u4f8b\u8c03\u6574\u3002", "committedDate": "2020-07-11T02:54:50Z", "type": "commit"}, {"oid": "e6118885ec2953bce2a52bc69da6b8d3731dfe46", "url": "https://github.com/seata/seata/commit/e6118885ec2953bce2a52bc69da6b8d3731dfe46", "message": "\u6dfb\u52a0\u914d\u7f6ebean\u672a\u627e\u5230\u7684\u8b66\u544a\u65e5\u5fd7\u3002", "committedDate": "2020-07-11T03:15:07Z", "type": "commit"}, {"oid": "b78d07e9007f068df16eb0cc3f2735c32c15afd7", "url": "https://github.com/seata/seata/commit/b78d07e9007f068df16eb0cc3f2735c32c15afd7", "message": "Merge branch 'develop' into bugfix-deadlock", "committedDate": "2020-07-13T09:56:33Z", "type": "commit"}, {"oid": "e28b5d2ccc1bb66532eb5f294030838e36f85edb", "url": "https://github.com/seata/seata/commit/e28b5d2ccc1bb66532eb5f294030838e36f85edb", "message": "Merge branch 'develop' into bugfix-deadlock", "committedDate": "2020-07-16T01:39:25Z", "type": "commit"}, {"oid": "019229e1b451e3751baf50b8a430bd03c2a85a67", "url": "https://github.com/seata/seata/commit/019229e1b451e3751baf50b8a430bd03c2a85a67", "message": "Merge branch 'develop' into bugfix-deadlock", "committedDate": "2020-07-16T10:00:03Z", "type": "commit"}, {"oid": "c71622a417b234fbc56fb0a1a8ec6a00ec8fb98f", "url": "https://github.com/seata/seata/commit/c71622a417b234fbc56fb0a1a8ec6a00ec8fb98f", "message": "\u975eXA\u4e5f\u4e0d\u8fdb\u5165\u4ee3\u7406\u3002", "committedDate": "2020-07-21T10:04:14Z", "type": "commit"}, {"oid": "0a7661253441aa5f8d7359c867c0fa19a966a97b", "url": "https://github.com/seata/seata/commit/0a7661253441aa5f8d7359c867c0fa19a966a97b", "message": "Merge branch 'develop' into bugfix-deadlock", "committedDate": "2020-07-23T01:02:07Z", "type": "commit"}, {"oid": "84dc3c91b81e7d2febe0c236fa0c5b56d33a45b5", "url": "https://github.com/seata/seata/commit/84dc3c91b81e7d2febe0c236fa0c5b56d33a45b5", "message": "Merge branch 'develop' into bugfix-deadlock", "committedDate": "2020-07-24T06:57:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTg4MzIwOQ==", "url": "https://github.com/seata/seata/pull/2879#discussion_r459883209", "bodyText": "Please use ConcurrentHashMap.", "author": "xingfudeshi", "createdAt": "2020-07-24T07:01:24Z", "path": "seata-spring-boot-starter/src/main/java/io/seata/spring/boot/autoconfigure/StarterConstants.java", "diffHunk": "@@ -78,40 +53,7 @@\n     public static final String CONFIG_ZK_PREFIX = CONFIG_PREFIX + \".zk\";\n     public static final String CONFIG_FILE_PREFIX = CONFIG_PREFIX + \".file\";\n \n-    public static final HashMap<String, Class> PROPERTY_MAP = new HashMap<String, Class>(MAP_CAPACITY) {\n-        private static final long serialVersionUID = -8902807645596274597L;\n-\n-        {\n-            put(CLIENT_RM_PREFIX, RmProperties.class);\n-            put(CLIENT_TM_PREFIX, TmProperties.class);\n-            put(LOCK_PREFIX, LockProperties.class);\n-            put(SERVICE_PREFIX, ServiceProperties.class);\n-            put(SHUTDOWN_PREFIX, ShutdownProperties.class);\n-            put(THREAD_FACTORY_PREFIX, ThreadFactoryProperties.class);\n-            put(UNDO_PREFIX, UndoProperties.class);\n-            put(LOG_PREFIX, LogProperties.class);\n-            put(TRANSPORT_PREFIX, TransportProperties.class);\n-            put(CONFIG_PREFIX, ConfigProperties.class);\n-            put(CONFIG_FILE_PREFIX, ConfigFileProperties.class);\n-            put(REGISTRY_PREFIX, RegistryProperties.class);\n-\n-            put(CONFIG_NACOS_PREFIX, ConfigNacosProperties.class);\n-            put(CONFIG_CONSUL_PREFIX, ConfigConsulProperties.class);\n-            put(CONFIG_ZK_PREFIX, ConfigZooKeeperProperties.class);\n-            put(CONFIG_APOLLO_PREFIX, ConfigApolloProperties.class);\n-            put(CONFIG_ETCD3_PREFIX, ConfigEtcd3Properties.class);\n-\n-            put(REGISTRY_CONSUL_PREFIX, RegistryConsulProperties.class);\n-            put(REGISTRY_ETCD3_PREFIX, RegistryEtcd3Properties.class);\n-            put(REGISTRY_EUREKA_PREFIX, RegistryEurekaProperties.class);\n-            put(REGISTRY_NACOS_PREFIX, RegistryNacosProperties.class);\n-            put(REGISTRY_REDIS_PREFIX, RegistryRedisProperties.class);\n-            put(REGISTRY_SOFA_PREFIX, RegistrySofaProperties.class);\n-            put(REGISTRY_ZK_PREFIX, RegistryZooKeeperProperties.class);\n-        }\n-\n-    };\n-\n+    public static final HashMap<String, Object> PROPERTY_BEAN_MAP = new HashMap(MAP_CAPACITY);", "originalCommit": "84dc3c91b81e7d2febe0c236fa0c5b56d33a45b5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTg4NTUyOQ==", "url": "https://github.com/seata/seata/pull/2879#discussion_r459885529", "bodyText": "\u8fd9\u4e2a\u6570\u636e\u5728SeataAutoConfiguration\u5b9e\u4f8b\u5316\u65f6\u521b\u5efa\uff0c\u540e\u9762\u53ea\u4f1a\u6709\u8bfb\u53d6\u64cd\u4f5c\uff0c\u5e76\u4e0d\u5b58\u5728\u7ebf\u7a0b\u5b89\u5168\u95ee\u9898\u3002", "author": "wangliang181230", "createdAt": "2020-07-24T07:08:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTg4MzIwOQ=="}], "type": "inlineReview"}, {"oid": "f5340a1a541ce34c263263439181a66db5bf2548", "url": "https://github.com/seata/seata/commit/f5340a1a541ce34c263263439181a66db5bf2548", "message": "\u4f18\u5316\u8b66\u544a\u65e5\u5fd7\u6253\u5370\u529f\u80fd\u3002", "committedDate": "2020-07-24T07:24:36Z", "type": "commit"}, {"oid": "1505144f6be658ed060a4b59d4266195513e6900", "url": "https://github.com/seata/seata/commit/1505144f6be658ed060a4b59d4266195513e6900", "message": "\u5c0f\u8c03\u6574\u3002", "committedDate": "2020-07-24T07:32:19Z", "type": "commit"}, {"oid": "48955ffc4e5886c603c0c40d838306fbdda1a573", "url": "https://github.com/seata/seata/commit/48955ffc4e5886c603c0c40d838306fbdda1a573", "message": "Merge remote-tracking branch 'remotes/upstream/develop' into bugfix-deadlock\n\n# Conflicts:\n#\tspring/src/main/java/io/seata/spring/annotation/datasource/SeataAutoDataSourceProxyAdvice.java", "committedDate": "2020-07-31T02:33:41Z", "type": "commit"}, {"oid": "cf25f464b74290c8e39092bad74264abf1793531", "url": "https://github.com/seata/seata/commit/cf25f464b74290c8e39092bad74264abf1793531", "message": "\u9879\u76ee\u542f\u52a8\u65f6\uff0cDataSourceProxy\u4e5f\u80fdput\u548cinit", "committedDate": "2020-07-31T03:02:50Z", "type": "commit"}, {"oid": "e2c4f8852d4b1d5f9e46eaddb9b56625cf8793df", "url": "https://github.com/seata/seata/commit/e2c4f8852d4b1d5f9e46eaddb9b56625cf8793df", "message": "Merge branch 'develop' into bugfix-deadlock", "committedDate": "2020-07-31T07:13:35Z", "type": "commit"}, {"oid": "6ee78c36b7d15f6b8624256878e8f73a769c70cd", "url": "https://github.com/seata/seata/commit/6ee78c36b7d15f6b8624256878e8f73a769c70cd", "message": "Merge branch 'develop' into bugfix-deadlock", "committedDate": "2020-08-05T10:36:05Z", "type": "commit"}, {"oid": "66b60bc45963ee4805d3ad50ea6c74164bf6a9fc", "url": "https://github.com/seata/seata/commit/66b60bc45963ee4805d3ad50ea6c74164bf6a9fc", "message": "Merge branch 'develop' into bugfix-deadlock", "committedDate": "2020-08-07T06:33:36Z", "type": "commit"}, {"oid": "86e9467015a4e74bbe6bd5af9feb0c1277142edf", "url": "https://github.com/seata/seata/commit/86e9467015a4e74bbe6bd5af9feb0c1277142edf", "message": "\u4fee\u590d\u521b\u5efa\u4ee3\u7406\u65f6\uff0cXA\u6f0f\u5224\u65ad\u4e86\u7684BUG\u3002", "committedDate": "2020-08-07T06:41:16Z", "type": "commit"}, {"oid": "6d7708ce7d0d8abe207c21f0151c53e87223bb30", "url": "https://github.com/seata/seata/commit/6d7708ce7d0d8abe207c21f0151c53e87223bb30", "message": "\u6dfb\u52a0DataSourceProxyWrapper\uff0c\u5e76\u4f18\u5316DataSourceProxyHolder", "committedDate": "2020-08-07T07:47:54Z", "type": "commit"}, {"oid": "6fc042976e85706787c87cf95ebb986a8d902d54", "url": "https://github.com/seata/seata/commit/6fc042976e85706787c87cf95ebb986a8d902d54", "message": "fix style.", "committedDate": "2020-08-10T01:50:21Z", "type": "commit"}, {"oid": "012ebb2b549fd452a264cd97628beafd790fe4a1", "url": "https://github.com/seata/seata/commit/012ebb2b549fd452a264cd97628beafd790fe4a1", "message": "Merge branch 'develop' into bugfix-deadlock", "committedDate": "2020-08-13T01:33:13Z", "type": "commit"}, {"oid": "48ed85cacc398bb9be97391b9ffc4695ef4a6861", "url": "https://github.com/seata/seata/commit/48ed85cacc398bb9be97391b9ffc4695ef4a6861", "message": "\u5982\u679c\u7528\u6237\u81ea\u5df1\u4ee3\u7406\u4e86DataSource\uff0c\u5219\u89e3\u9664\u4ee3\u7406\u3002", "committedDate": "2020-08-13T09:05:37Z", "type": "commit"}, {"oid": "eadf4b2b839d31eeb51051430dd9755b58991840", "url": "https://github.com/seata/seata/commit/eadf4b2b839d31eeb51051430dd9755b58991840", "message": "\u5982\u679c\u7528\u6237\u81ea\u5df1\u4ee3\u7406\u4e86DataSource\uff0c\u5219\u89e3\u9664\u4ee3\u7406\u3002", "committedDate": "2020-08-13T09:06:59Z", "type": "commit"}, {"oid": "9463e5f1c99d8bb128334e0d1b3266fdeebe6061", "url": "https://github.com/seata/seata/commit/9463e5f1c99d8bb128334e0d1b3266fdeebe6061", "message": "\u91cd\u547d\u540dDataSourceWrapper\u4e3aSeataDataSource", "committedDate": "2020-08-13T09:12:51Z", "type": "commit"}, {"oid": "ab14795a4c2afd4d2faf029ec7082f98a3317252", "url": "https://github.com/seata/seata/commit/ab14795a4c2afd4d2faf029ec7082f98a3317252", "message": "\u5982\u679c\u7528\u6237\u624b\u52a8\u4ee3\u7406\u4e86\u6570\u636e\u6e90\uff0c\u81ea\u52a8\u89e3\u9664\u4ee3\u7406\u3002AOP\u4f1a\u81ea\u52a8\u62e6\u622a\u5e76\u5224\u65ad\u662f\u5426\u4f7f\u7528\u4ee3\u7406\u3002", "committedDate": "2020-08-17T08:13:45Z", "type": "commit"}, {"oid": "37bf9dd6794f2e65a506310bcc6cc3b598b91ab6", "url": "https://github.com/seata/seata/commit/37bf9dd6794f2e65a506310bcc6cc3b598b91ab6", "message": "\u521d\u59cb\u5316\u6570\u636e\u6e90\u4ee3\u7406\u65f6\uff0c\u8df3\u8fc7\u6392\u9664\u7684\u6570\u636e\u6e90\u7c7b\u3002", "committedDate": "2020-08-17T09:21:12Z", "type": "commit"}, {"oid": "8104c2cabb010d1238eeaf81ac7c69f76bfd55ce", "url": "https://github.com/seata/seata/commit/8104c2cabb010d1238eeaf81ac7c69f76bfd55ce", "message": "Merge remote-tracking branch 'remotes/upstream/develop' into bugfix-deadlock", "committedDate": "2020-09-18T01:42:14Z", "type": "commit"}, {"oid": "5ce114dfe5dbdc025ec24c4b2a4aa3613baab7cf", "url": "https://github.com/seata/seata/commit/5ce114dfe5dbdc025ec24c4b2a4aa3613baab7cf", "message": "optimize code", "committedDate": "2020-09-18T03:04:11Z", "type": "commit"}, {"oid": "0f9f304fc103ab630c794226cc25442aaa371536", "url": "https://github.com/seata/seata/commit/0f9f304fc103ab630c794226cc25442aaa371536", "message": "\u79fb\u9664\u6389\u5df2\u62c6\u5206\u51fa\u53bb\u7684\u4ee3\u7801\u3002", "committedDate": "2020-09-18T04:24:52Z", "type": "commit"}, {"oid": "d72ff9a2ed64272fddf56e92d4160deafd075ebd", "url": "https://github.com/seata/seata/commit/d72ff9a2ed64272fddf56e92d4160deafd075ebd", "message": "\u5c0f\u8c03\u6574", "committedDate": "2020-09-18T05:29:04Z", "type": "commit"}, {"oid": "ad031213f0aee55fe5945f0e6d4375557daa0940", "url": "https://github.com/seata/seata/commit/ad031213f0aee55fe5945f0e6d4375557daa0940", "message": "Merge remote-tracking branch 'remotes/upstream/develop' into bugfix-deadlock\n\n# Conflicts:\n#\tseata-spring-boot-starter/src/main/java/io/seata/spring/boot/autoconfigure/StarterConstants.java", "committedDate": "2020-09-18T11:07:50Z", "type": "commit"}, {"oid": "eba0a3fa521546e1d8dd93bbe05b501cb3f32420", "url": "https://github.com/seata/seata/commit/eba0a3fa521546e1d8dd93bbe05b501cb3f32420", "message": "Merge branch 'develop' into bugfix-deadlock", "committedDate": "2020-09-30T01:58:13Z", "type": "commit"}, {"oid": "5a3b98d26394d68430282239dc59b243e5b57461", "url": "https://github.com/seata/seata/commit/5a3b98d26394d68430282239dc59b243e5b57461", "message": "Merge remote-tracking branch 'remotes/upstream/develop' into bugfix-deadlock\n\n# Conflicts:\n#\tseata-spring-boot-starter/src/main/java/io/seata/spring/boot/autoconfigure/SeataAutoConfiguration.java", "committedDate": "2020-10-10T08:55:18Z", "type": "commit"}, {"oid": "d11912ea347013448f61603707bcef3a1c182fd3", "url": "https://github.com/seata/seata/commit/d11912ea347013448f61603707bcef3a1c182fd3", "message": "optimize code", "committedDate": "2020-10-10T09:00:53Z", "type": "commit"}, {"oid": "1876316efc6ca79af308d8e94ed5baa0dff84c83", "url": "https://github.com/seata/seata/commit/1876316efc6ca79af308d8e94ed5baa0dff84c83", "message": "Merge branch 'develop' into bugfix-deadlock", "committedDate": "2020-10-12T02:09:11Z", "type": "commit"}, {"oid": "8b4b0d93ca7ba9b7c4123716c2d1e5d3cc134751", "url": "https://github.com/seata/seata/commit/8b4b0d93ca7ba9b7c4123716c2d1e5d3cc134751", "message": "Merge remote-tracking branch 'remotes/upstream/develop' into bugfix-deadlock", "committedDate": "2020-10-12T11:04:28Z", "type": "commit"}, {"oid": "95e45b083f958d249507e5982cfc4011d7465777", "url": "https://github.com/seata/seata/commit/95e45b083f958d249507e5982cfc4011d7465777", "message": "Merge remote-tracking branch 'remotes/upstream/develop' into bugfix-deadlock", "committedDate": "2020-10-15T08:36:55Z", "type": "commit"}, {"oid": "8cce680176d2e70c21e1b452a022e7ee4896756b", "url": "https://github.com/seata/seata/commit/8cce680176d2e70c21e1b452a022e7ee4896756b", "message": "Merge remote-tracking branch 'remotes/upstream/develop' into bugfix-deadlock\n\n# Conflicts:\n#\tseata-spring-boot-starter/src/main/java/io/seata/spring/boot/autoconfigure/StarterConstants.java", "committedDate": "2020-10-17T15:50:59Z", "type": "commit"}, {"oid": "66906dd3a1340c8e7f630843669fa41ae8f98b07", "url": "https://github.com/seata/seata/commit/66906dd3a1340c8e7f630843669fa41ae8f98b07", "message": "merge", "committedDate": "2020-10-17T15:53:38Z", "type": "commit"}, {"oid": "49f6ae1c2bdd634710dabe06eef9023f79450d8d", "url": "https://github.com/seata/seata/commit/49f6ae1c2bdd634710dabe06eef9023f79450d8d", "message": "Merge remote-tracking branch 'remotes/upstream/develop' into bugfix-deadlock\n\n# Conflicts:\n#\tseata-spring-boot-starter/src/main/java/io/seata/spring/boot/autoconfigure/StarterConstants.java", "committedDate": "2020-10-29T03:31:00Z", "type": "commit"}, {"oid": "40e7120c18f4919360c3224029a1d1f553a35bdf", "url": "https://github.com/seata/seata/commit/40e7120c18f4919360c3224029a1d1f553a35bdf", "message": "Merge branch 'develop' into bugfix-deadlock", "committedDate": "2020-11-11T01:44:41Z", "type": "commit"}, {"oid": "a23200936dfda38077c695db5cf4a6160f219ac8", "url": "https://github.com/seata/seata/commit/a23200936dfda38077c695db5cf4a6160f219ac8", "message": "Merge branch 'develop' into bugfix-deadlock", "committedDate": "2020-11-11T02:37:44Z", "type": "commit"}]}