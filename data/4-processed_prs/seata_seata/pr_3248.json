{"pr_number": 3248, "pr_title": "optimize: refactor loadBalance config from registry.conf to file.conf.", "pr_createdAt": "2020-11-01T11:14:36Z", "pr_url": "https://github.com/seata/seata/pull/3248", "timeline": [{"oid": "3cc14a0c31b534c6a502b1fa6abac363e4e2c58e", "url": "https://github.com/seata/seata/commit/3cc14a0c31b534c6a502b1fa6abac363e4e2c58e", "message": "refactor: loadBalance config from registry.conf to file.conf.", "committedDate": "2020-11-01T11:13:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTcxNDE0Ng==", "url": "https://github.com/seata/seata/pull/3248#discussion_r515714146", "bodyText": "is not allowed", "author": "a364176773", "createdAt": "2020-11-02T02:37:35Z", "path": "seata-spring-boot-starter/src/test/java/io/seata/spring/boot/autoconfigure/PropertiesTest.java", "diffHunk": "@@ -36,15 +36,7 @@\n import io.seata.spring.boot.autoconfigure.properties.config.ConfigNacosProperties;\n import io.seata.spring.boot.autoconfigure.properties.config.ConfigProperties;\n import io.seata.spring.boot.autoconfigure.properties.config.ConfigZooKeeperProperties;\n-import io.seata.spring.boot.autoconfigure.properties.registry.RegistryConsulProperties;\n-import io.seata.spring.boot.autoconfigure.properties.registry.RegistryCustomProperties;\n-import io.seata.spring.boot.autoconfigure.properties.registry.RegistryEtcd3Properties;\n-import io.seata.spring.boot.autoconfigure.properties.registry.RegistryEurekaProperties;\n-import io.seata.spring.boot.autoconfigure.properties.registry.RegistryNacosProperties;\n-import io.seata.spring.boot.autoconfigure.properties.registry.RegistryProperties;\n-import io.seata.spring.boot.autoconfigure.properties.registry.RegistryRedisProperties;\n-import io.seata.spring.boot.autoconfigure.properties.registry.RegistrySofaProperties;\n-import io.seata.spring.boot.autoconfigure.properties.registry.RegistryZooKeeperProperties;\n+import io.seata.spring.boot.autoconfigure.properties.registry.*;", "originalCommit": "3cc14a0c31b534c6a502b1fa6abac363e4e2c58e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTcxNDIzNw==", "url": "https://github.com/seata/seata/pull/3248#discussion_r515714237", "bodyText": "Blank lines can be removed", "author": "a364176773", "createdAt": "2020-11-02T02:38:08Z", "path": "server/src/main/resources/registry.conf", "diffHunk": "@@ -1,8 +1,7 @@\n registry {\n   # file \u3001nacos \u3001eureka\u3001redis\u3001zk\u3001consul\u3001etcd3\u3001sofa\n   type = \"file\"\n-  loadBalance = \"RandomLoadBalance\"\n-  loadBalanceVirtualNodes = 10\n+", "originalCommit": "3cc14a0c31b534c6a502b1fa6abac363e4e2c58e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "3dad6cb9c482ad11e58bf47b41c8971fb79a2305", "url": "https://github.com/seata/seata/commit/3dad6cb9c482ad11e58bf47b41c8971fb79a2305", "message": "Merge branch 'develop' into feature/loadbalance_1101", "committedDate": "2020-11-02T02:51:53Z", "type": "commit"}, {"oid": "29cc9be20a34b2916aeb58492d1bafbdfbe4c0ed", "url": "https://github.com/seata/seata/commit/29cc9be20a34b2916aeb58492d1bafbdfbe4c0ed", "message": "Merge branch 'develop' into feature/loadbalance_1101", "committedDate": "2020-11-02T10:15:42Z", "type": "commit"}, {"oid": "078f4c7a5b52298278175e49d234bb11ab1d8644", "url": "https://github.com/seata/seata/commit/078f4c7a5b52298278175e49d234bb11ab1d8644", "message": "\u652f\u6301CI\u6301\u7eed\u96c6\u6210, \u8865\u5145\u9057\u6f0f\u63d0\u4ea4\u7684 LoadBalanceProperties", "committedDate": "2020-11-02T12:39:43Z", "type": "commit"}, {"oid": "7baba8cbbbb0b1a28e936bbae58a68044719a1a8", "url": "https://github.com/seata/seata/commit/7baba8cbbbb0b1a28e936bbae58a68044719a1a8", "message": "\u4fee\u6539\u5404\u5927\u6a21\u5757\u7684\u8d1f\u8f7d\u5747\u8861\u914d\u7f6e, \u4eceregistry.conf\u79fb\u52a8\u5230file.conf", "committedDate": "2020-11-02T13:12:10Z", "type": "commit"}, {"oid": "07bb4a96398e05b258bc7539af56985cc89c4d99", "url": "https://github.com/seata/seata/commit/07bb4a96398e05b258bc7539af56985cc89c4d99", "message": "\u6539\u4e3aclient.loadBalance\u3002  \u4fee\u590d SpringBootConfigurationProvider \u914d\u7f6e\u652f\u6301", "committedDate": "2020-11-03T11:43:37Z", "type": "commit"}, {"oid": "c2c051e4e06f71d0caaf8b3182a50f1ef478d23a", "url": "https://github.com/seata/seata/commit/c2c051e4e06f71d0caaf8b3182a50f1ef478d23a", "message": "\u4fee\u590dspringboot\u914d\u7f6e\u63d0\u793a, \u589e\u52a0\u914d\u7f6e\u4e2d\u5fc3\u83b7\u53d6\u8d1f\u8f7d\u5747\u8861\u7684\u6d4b\u8bd5\u7528\u4f8b", "committedDate": "2020-11-04T06:18:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzgwNDUzNg==", "url": "https://github.com/seata/seata/pull/3248#discussion_r517804536", "bodyText": "Change this name\n\u6539\u4e00\u4e0b\u8fd9\u4e2a\u540d\u5b57", "author": "ph3636", "createdAt": "2020-11-05T05:43:31Z", "path": "discovery/seata-discovery-core/src/main/java/io/seata/discovery/loadbalance/ConsistentHashLoadBalance.java", "diffHunk": "@@ -36,8 +35,14 @@\n @LoadLevel(name = \"ConsistentHashLoadBalance\")\n public class ConsistentHashLoadBalance extends AbstractLoadBalance {\n \n-    private static final String VIRTUAL_NODES = FILE_ROOT_REGISTRY + FILE_CONFIG_SPLIT_CHAR + \"loadBalanceVirtualNodes\";\n-    private static final int VIRTUAL_NODES_NUM = ConfigurationFactory.CURRENT_FILE_INSTANCE.getInt(VIRTUAL_NODES, VIRTUAL_NODES_DEFAULT);\n+    /**\n+     * The constant LOAD_BALANCE_TYPE.", "originalCommit": "c2c051e4e06f71d0caaf8b3182a50f1ef478d23a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODU1MzkzMg==", "url": "https://github.com/seata/seata/pull/3248#discussion_r518553932", "bodyText": "Change the name or delete it", "author": "ph3636", "createdAt": "2020-11-06T06:50:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzgwNDUzNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODMzMDYwNg==", "url": "https://github.com/seata/seata/pull/3248#discussion_r528330606", "bodyText": "\u4e00\u76f4\u4ee5\u4e3a\u6539\u4e86\uff0c\u4eca\u5929\u6838\u5bf9\u624d\u53d1\u73b0\u6ca1\u6539\u3002  \u521a\u521a\u6539\u6389\u4e86", "author": "ls9527", "createdAt": "2020-11-22T12:45:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzgwNDUzNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzgwNTM3Mg==", "url": "https://github.com/seata/seata/pull/3248#discussion_r517805372", "bodyText": "These are redundant\n\u8fd9\u4e9b\u662f\u591a\u4f59", "author": "ph3636", "createdAt": "2020-11-05T05:46:18Z", "path": "script/server/config/file.properties", "diffHunk": "@@ -25,3 +25,5 @@ store.redis.database=0\n store.redis.minConn=1\n store.redis.maxConn=10\n store.redis.queryLimit=100\n+loadBalance.type=RandomLoadBalance\n+loadBalance.consistentHash.virtualNodes=10", "originalCommit": "c2c051e4e06f71d0caaf8b3182a50f1ef478d23a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODMzMDkzNg==", "url": "https://github.com/seata/seata/pull/3248#discussion_r528330936", "bodyText": "\u591a\u4f59\u7684\u5220\u6389\u4e86", "author": "ls9527", "createdAt": "2020-11-22T12:48:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzgwNTM3Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzgwNTUxMQ==", "url": "https://github.com/seata/seata/pull/3248#discussion_r517805511", "bodyText": "These are redundant\n\u8fd9\u4e9b\u662f\u591a\u4f59", "author": "ph3636", "createdAt": "2020-11-05T05:46:51Z", "path": "script/server/config/file.yml", "diffHunk": "@@ -44,4 +44,9 @@ store:\n     minConn: 1\n     maxConn: 10\n     queryLimit: 100\n+loadBalance:\n+  type: RandomLoadBalance\n+  consistentHash:\n+    virtualNodes: 10", "originalCommit": "c2c051e4e06f71d0caaf8b3182a50f1ef478d23a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA2MTExMQ==", "url": "https://github.com/seata/seata/pull/3248#discussion_r518061111", "bodyText": "\u591a\u8c22\u5927\u795e\uff0c \u5df2\u5c06\u591a\u4f59\u7684\u90e8\u5206\u5220\u9664\u3002  \u5c06loadBalance\u7684 type \u548c  visualNodes \u533a\u5206\u5f00\u4e86\u3002", "author": "ls9527", "createdAt": "2020-11-05T13:45:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzgwNTUxMQ=="}], "type": "inlineReview"}, {"oid": "48ca9130e0e710bae8651ab47b45e9fbd43fba31", "url": "https://github.com/seata/seata/commit/48ca9130e0e710bae8651ab47b45e9fbd43fba31", "message": "\u5220\u9664\u65e0\u7528\u7684\u8d1f\u8f7d\u5747\u8861\u914d\u7f6e", "committedDate": "2020-11-05T13:43:43Z", "type": "commit"}, {"oid": "147595a5f482c36f0d456171e50e02ebc2a286e0", "url": "https://github.com/seata/seata/commit/147595a5f482c36f0d456171e50e02ebc2a286e0", "message": "Merge branch 'develop' into feature/loadbalance_1101", "committedDate": "2020-11-10T15:37:45Z", "type": "commit"}, {"oid": "811dd9fd91d86bc74f5d18a152d22cab71c62770", "url": "https://github.com/seata/seata/commit/811dd9fd91d86bc74f5d18a152d22cab71c62770", "message": "Merge remote-tracking branch 'seata/develop' into feature/loadbalance_1101\n\n# Conflicts:\n#\tseata-spring-boot-starter/src/main/java/io/seata/spring/boot/autoconfigure/StarterConstants.java", "committedDate": "2020-11-11T16:33:27Z", "type": "commit"}, {"oid": "1daf10780e90ce79658c11aed200c68bef4494a5", "url": "https://github.com/seata/seata/commit/1daf10780e90ce79658c11aed200c68bef4494a5", "message": "\u4fee\u590d\u4ee3\u7801\u5408\u5e76", "committedDate": "2020-11-11T16:34:48Z", "type": "commit"}, {"oid": "882e4eeb1d4a226b1f4581bdd617d0e9c694dca5", "url": "https://github.com/seata/seata/commit/882e4eeb1d4a226b1f4581bdd617d0e9c694dca5", "message": "Merge branch 'develop' into feature/loadbalance_1101", "committedDate": "2020-11-22T12:26:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODMyOTY0Nw==", "url": "https://github.com/seata/seata/pull/3248#discussion_r528329647", "bodyText": "unwanted file", "author": "a364176773", "createdAt": "2020-11-22T12:39:36Z", "path": "discovery/seata-discovery-core/src/test/resources/file.conf", "diffHunk": "@@ -0,0 +1,23 @@\n+#", "originalCommit": "882e4eeb1d4a226b1f4581bdd617d0e9c694dca5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "986942ea2f109d6d8abeac3c28eadf6430f43c46", "url": "https://github.com/seata/seata/commit/986942ea2f109d6d8abeac3c28eadf6430f43c46", "message": "\u4fee\u6539 LOAD_BALANCE_CONSISTENT_HASH_VISUAL_NODES \u7684\u6ce8\u91ca", "committedDate": "2020-11-22T12:43:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODMyOTkwMg==", "url": "https://github.com/seata/seata/pull/3248#discussion_r528329902", "bodyText": "unnecessary change", "author": "a364176773", "createdAt": "2020-11-22T12:41:18Z", "path": "script/server/config/file.conf", "diffHunk": "@@ -49,5 +49,4 @@ store {\n     maxConn = 10\n     queryLimit = 100\n   }\n-\n-}\n+}", "originalCommit": "882e4eeb1d4a226b1f4581bdd617d0e9c694dca5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODMyOTkxNw==", "url": "https://github.com/seata/seata/pull/3248#discussion_r528329917", "bodyText": "unnecessary change", "author": "a364176773", "createdAt": "2020-11-22T12:41:27Z", "path": "script/server/config/file.properties", "diffHunk": "@@ -24,4 +24,4 @@ store.redis.password=\n store.redis.database=0\n store.redis.minConn=1\n store.redis.maxConn=10\n-store.redis.queryLimit=100\n+store.redis.queryLimit=100", "originalCommit": "882e4eeb1d4a226b1f4581bdd617d0e9c694dca5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODMyOTk0NQ==", "url": "https://github.com/seata/seata/pull/3248#discussion_r528329945", "bodyText": "unnecessary change", "author": "a364176773", "createdAt": "2020-11-22T12:41:32Z", "path": "script/server/config/file.yml", "diffHunk": "@@ -43,5 +43,4 @@ store:\n     database: 0\n     minConn: 1\n     maxConn: 10\n-    queryLimit: 100\n-\n+    queryLimit: 100", "originalCommit": "882e4eeb1d4a226b1f4581bdd617d0e9c694dca5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODMzMDE1NA==", "url": "https://github.com/seata/seata/pull/3248#discussion_r528330154", "bodyText": "unnecessary change", "author": "a364176773", "createdAt": "2020-11-22T12:43:01Z", "path": "server/src/main/resources/file.conf", "diffHunk": "@@ -50,4 +50,4 @@ store {\n     queryLimit = 100\n   }\n \n-}\n+}", "originalCommit": "882e4eeb1d4a226b1f4581bdd617d0e9c694dca5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f645e9fc4518c90d56bf4549be3ade45b65fd779", "url": "https://github.com/seata/seata/commit/f645e9fc4518c90d56bf4549be3ade45b65fd779", "message": "\u56de\u6eda\u4e0d\u5fc5\u8981\u7684\u914d\u7f6e\u66f4\u6539", "committedDate": "2020-11-22T13:11:07Z", "type": "commit"}, {"oid": "f645e9fc4518c90d56bf4549be3ade45b65fd779", "url": "https://github.com/seata/seata/commit/f645e9fc4518c90d56bf4549be3ade45b65fd779", "message": "\u56de\u6eda\u4e0d\u5fc5\u8981\u7684\u914d\u7f6e\u66f4\u6539", "committedDate": "2020-11-22T13:11:07Z", "type": "forcePushed"}, {"oid": "f977d55d029afa8797c432acca97262ed23d0a9a", "url": "https://github.com/seata/seata/commit/f977d55d029afa8797c432acca97262ed23d0a9a", "message": "Merge remote-tracking branch 'github-seata/develop' into feature/loadbalance_1101\n\n# Conflicts:\n#\tdiscovery/seata-discovery-core/src/main/java/io/seata/discovery/loadbalance/ConsistentHashLoadBalance.java\n#\tscript/client/conf/file.conf\n#\tscript/client/spring/application.properties\n#\tscript/client/spring/application.yml\n#\tseata-spring-boot-starter/src/main/java/io/seata/spring/boot/autoconfigure/SeataAutoConfiguration.java\n#\tseata-spring-boot-starter/src/main/java/io/seata/spring/boot/autoconfigure/StarterConstants.java", "committedDate": "2021-01-16T16:48:43Z", "type": "commit"}, {"oid": "dbe8743bc4f5b845f7b5eea5f610fddc78273953", "url": "https://github.com/seata/seata/commit/dbe8743bc4f5b845f7b5eea5f610fddc78273953", "message": "\u589e\u52a01.5.0\u7684\u66f4\u65b0\u63cf\u8ff0\u6587\u6863", "committedDate": "2021-01-17T09:57:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3ODA4MTAxNg==", "url": "https://github.com/seata/seata/pull/3248#discussion_r578081016", "bodyText": "migrate instead of migration, migration is not a verb.", "author": "l81893521", "createdAt": "2021-02-18T02:23:00Z", "path": "changes/en-us/1.5.0.md", "diffHunk": "@@ -59,7 +59,7 @@\n   - [[#3420](https://github.com/seata/seata/pull/3420)] optimize enumerated classes and add unit tests\t\n   - [[#3436](https://github.com/seata/seata/pull/3436)] optimize typo in SQLType class \t\n   - [[#3439](https://github.com/seata/seata/pull/3439)] adjust the order of springApplicationContextProvider\n-\n+  - [[#3248](https://github.com/seata/seata/pull/3248)] optimize the config of load-balance migration to belong the client node", "originalCommit": "dbe8743bc4f5b845f7b5eea5f610fddc78273953", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "3a8e38e5c1a1908a86627bcf338d1b2ee67593a5", "url": "https://github.com/seata/seata/commit/3a8e38e5c1a1908a86627bcf338d1b2ee67593a5", "message": "Merge branch 'develop' into feature/loadbalance_1101", "committedDate": "2021-03-19T02:31:09Z", "type": "commit"}, {"oid": "dea89bd54896cfbe2d71a92f9efc161419baf9ed", "url": "https://github.com/seata/seata/commit/dea89bd54896cfbe2d71a92f9efc161419baf9ed", "message": "Update SeataPropertiesAutoConfiguration.java", "committedDate": "2021-03-19T02:37:21Z", "type": "commit"}]}