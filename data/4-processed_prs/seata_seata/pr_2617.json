{"pr_number": 2617, "pr_title": "bugfix: fix incorrect getAnnotation about class and method", "pr_createdAt": "2020-04-26T15:33:36Z", "pr_url": "https://github.com/seata/seata/pull/2617", "timeline": [{"oid": "adc024c578496fa45bab02c9fabada45d8d71f3c", "url": "https://github.com/seata/seata/commit/adc024c578496fa45bab02c9fabada45d8d71f3c", "message": "fix bug for getAnnotation", "committedDate": "2020-04-26T15:32:27Z", "type": "commit"}, {"oid": "2aeaab270cd29cb40860e8cc3fbeac78924ebfb3", "url": "https://github.com/seata/seata/commit/2aeaab270cd29cb40860e8cc3fbeac78924ebfb3", "message": "Merge branch 'develop' into element_type", "committedDate": "2020-04-27T01:57:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTQ3MDA1Mw==", "url": "https://github.com/seata/seata/pull/2617#discussion_r415470053", "bodyText": "How about to use lambda for more readable like :\n        return Optional.ofNullable(method)\n                       .map(m -> m.getAnnotation(annotationClass))\n                       .orElse(Optional.ofNullable(targetClass)\n                                       .map(t -> t.getAnnotation(annotationClass))\n                                       .orElse(null));", "author": "helloworlde", "createdAt": "2020-04-27T02:35:38Z", "path": "spring/src/main/java/io/seata/spring/annotation/GlobalTransactionalInterceptor.java", "diffHunk": "@@ -166,8 +165,11 @@ public TransactionInfo getTransactionInfo() {\n     }\n \n     private <T extends Annotation> T getAnnotation(Method method, Class<?> targetClass, Class<T> annotationClass) {\n-        return method == null ? targetClass == null ? null : targetClass.getAnnotation(annotationClass)\n-            : method.getAnnotation(annotationClass);\n+        T annotation = null == method ? null : method.getAnnotation(annotationClass);\n+        if (null == annotation) {\n+            annotation = null == targetClass ? null : targetClass.getAnnotation(annotationClass);\n+        }\n+        return annotation;\n     }", "originalCommit": "2aeaab270cd29cb40860e8cc3fbeac78924ebfb3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTQ4MDY4Mg==", "url": "https://github.com/seata/seata/pull/2617#discussion_r415480682", "bodyText": "thx", "author": "a364176773", "createdAt": "2020-04-27T03:13:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTQ3MDA1Mw=="}], "type": "inlineReview"}, {"oid": "fc03cd99040aa273da35d10737c81e70621c9beb", "url": "https://github.com/seata/seata/commit/fc03cd99040aa273da35d10737c81e70621c9beb", "message": "optimize code, add test case", "committedDate": "2020-04-27T03:32:45Z", "type": "commit"}, {"oid": "f526dc7a0857c4d800e64b6dcecaf86b7bd636a5", "url": "https://github.com/seata/seata/commit/f526dc7a0857c4d800e64b6dcecaf86b7bd636a5", "message": "Merge branch 'element_type' of https://github.com/a364176773/seata into element_type", "committedDate": "2020-04-27T03:33:39Z", "type": "commit"}, {"oid": "23b912f591519bc4d435030d716e35ce089b6146", "url": "https://github.com/seata/seata/commit/23b912f591519bc4d435030d716e35ce089b6146", "message": "Merge branch 'develop' into element_type", "committedDate": "2020-04-27T06:09:38Z", "type": "commit"}, {"oid": "3f9431b62ae3d853b729ef9b24b656ac79ad40e2", "url": "https://github.com/seata/seata/commit/3f9431b62ae3d853b729ef9b24b656ac79ad40e2", "message": "Merge branch 'develop' into element_type", "committedDate": "2020-04-27T07:51:58Z", "type": "commit"}, {"oid": "42b6b48c69202d6695e2993b6f5d910f0d375177", "url": "https://github.com/seata/seata/commit/42b6b48c69202d6695e2993b6f5d910f0d375177", "message": "optimize test case", "committedDate": "2020-04-27T08:26:50Z", "type": "commit"}, {"oid": "717c87397c06e46b779616f274125bb0112d3328", "url": "https://github.com/seata/seata/commit/717c87397c06e46b779616f274125bb0112d3328", "message": "optimize test case", "committedDate": "2020-04-27T08:47:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTY1NzY3NQ==", "url": "https://github.com/seata/seata/pull/2617#discussion_r415657675", "bodyText": "The global variable declare in testGetAnnotation method?", "author": "jsbxyyx", "createdAt": "2020-04-27T09:30:11Z", "path": "spring/src/test/java/io/seata/spring/annotation/MethodDescTest.java", "diffHunk": "@@ -37,6 +36,8 @@\n     private static Class<?> targetClass = null;\n     private static GlobalTransactional transactional = null;\n \n+    private static final GlobalTransactionalInterceptor globalTransactionalInterceptor=new GlobalTransactionalInterceptor(null);", "originalCommit": "717c87397c06e46b779616f274125bb0112d3328", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTY2MTU3Ng==", "url": "https://github.com/seata/seata/pull/2617#discussion_r415661576", "bodyText": "ok", "author": "a364176773", "createdAt": "2020-04-27T09:35:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTY1NzY3NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTY3NjM2MA==", "url": "https://github.com/seata/seata/pull/2617#discussion_r415676360", "bodyText": "The global variable declare in testGetAnnotation method?\n\nPTAL @jsbxyyx", "author": "a364176773", "createdAt": "2020-04-27T09:57:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTY1NzY3NQ=="}], "type": "inlineReview"}, {"oid": "6067713a03cf4e50d1bb295cd5d8e569e1435dce", "url": "https://github.com/seata/seata/commit/6067713a03cf4e50d1bb295cd5d8e569e1435dce", "message": "modify test case", "committedDate": "2020-04-27T09:37:41Z", "type": "commit"}, {"oid": "6c4dce15b844a1362cd86a0654a581c5189159b5", "url": "https://github.com/seata/seata/commit/6c4dce15b844a1362cd86a0654a581c5189159b5", "message": "modify test case", "committedDate": "2020-04-28T01:22:25Z", "type": "commit"}, {"oid": "2019034e9957b501d71687ac279da0cf46115d34", "url": "https://github.com/seata/seata/commit/2019034e9957b501d71687ac279da0cf46115d34", "message": "add support for read annotation on class", "committedDate": "2020-04-28T01:57:27Z", "type": "commit"}, {"oid": "df690b658d27d92ac46adab0aaaa9cfb6709ec10", "url": "https://github.com/seata/seata/commit/df690b658d27d92ac46adab0aaaa9cfb6709ec10", "message": "exclude base class methods", "committedDate": "2020-04-28T07:52:10Z", "type": "commit"}, {"oid": "d9b7c08bf840a06567452f0f49fe09a29230b3c1", "url": "https://github.com/seata/seata/commit/d9b7c08bf840a06567452f0f49fe09a29230b3c1", "message": "optimize code", "committedDate": "2020-04-29T02:57:30Z", "type": "commit"}, {"oid": "cfd97f2755955a085358187de5c91405256b5610", "url": "https://github.com/seata/seata/commit/cfd97f2755955a085358187de5c91405256b5610", "message": "Merge branch 'develop' into element_type", "committedDate": "2020-04-29T07:52:48Z", "type": "commit"}, {"oid": "3cd04d12b32bff3438c9a1576a2700d9b2cef5d9", "url": "https://github.com/seata/seata/commit/3cd04d12b32bff3438c9a1576a2700d9b2cef5d9", "message": "Merge branch 'develop' into element_type", "committedDate": "2020-05-03T05:12:59Z", "type": "commit"}, {"oid": "24dcb4698aae059c08fc4866142fc2d1268575c0", "url": "https://github.com/seata/seata/commit/24dcb4698aae059c08fc4866142fc2d1268575c0", "message": "Merge branch 'develop' into element_type", "committedDate": "2020-05-04T06:49:32Z", "type": "commit"}, {"oid": "10c866a9a7abe85157e21900759a98a433ce1c9a", "url": "https://github.com/seata/seata/commit/10c866a9a7abe85157e21900759a98a433ce1c9a", "message": "Merge branch 'develop' into element_type", "committedDate": "2020-05-05T02:34:25Z", "type": "commit"}, {"oid": "bc1bfa36aa06e92aa871cce06eb140cca2a11fb2", "url": "https://github.com/seata/seata/commit/bc1bfa36aa06e92aa871cce06eb140cca2a11fb2", "message": "Merge branch 'develop' into element_type", "committedDate": "2020-05-06T01:15:46Z", "type": "commit"}, {"oid": "274d71e715b3f1023202784590184e5d6cb36a0a", "url": "https://github.com/seata/seata/commit/274d71e715b3f1023202784590184e5d6cb36a0a", "message": "resolve conflicts", "committedDate": "2020-05-08T08:00:56Z", "type": "commit"}, {"oid": "25817708b43e158a14673fc3f27b1c650b04ed0e", "url": "https://github.com/seata/seata/commit/25817708b43e158a14673fc3f27b1c650b04ed0e", "message": "Merge branch 'develop' into element_type", "committedDate": "2020-05-18T03:43:03Z", "type": "commit"}, {"oid": "271e5048a31f57fde4920ddd67c27876f9883c0c", "url": "https://github.com/seata/seata/commit/271e5048a31f57fde4920ddd67c27876f9883c0c", "message": "Merge branch 'develop' into element_type", "committedDate": "2020-05-19T01:22:53Z", "type": "commit"}, {"oid": "268ac711755b09510330143b457cc73e4aa9caa0", "url": "https://github.com/seata/seata/commit/268ac711755b09510330143b457cc73e4aa9caa0", "message": "add test cases", "committedDate": "2020-05-19T02:32:50Z", "type": "commit"}]}