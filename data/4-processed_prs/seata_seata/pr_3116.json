{"pr_number": 3116, "pr_title": "feature:support configuring apolloService and apolloCluster", "pr_createdAt": "2020-09-15T10:16:10Z", "pr_url": "https://github.com/seata/seata/pull/3116", "timeline": [{"oid": "2996061648499a42e7d7959167df52dea15c4fc2", "url": "https://github.com/seata/seata/commit/2996061648499a42e7d7959167df52dea15c4fc2", "message": "support configuring apolloService and apolloCluster", "committedDate": "2020-09-15T10:15:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODU2NzQ3MA==", "url": "https://github.com/seata/seata/pull/3116#discussion_r488567470", "bodyText": "APOLLO_CLUSTER = \"seata\"  Is that better?", "author": "a364176773", "createdAt": "2020-09-15T10:44:28Z", "path": "config/seata-config-apollo/src/main/java/io/seata/config/apollo/ApolloConfiguration.java", "diffHunk": "@@ -54,17 +54,21 @@\n     private static final String APP_ID = \"appId\";\n     private static final String APOLLO_META = \"apolloMeta\";\n     private static final String APOLLO_SECRET = \"apolloAccesskeySecret\";\n+    private static final String APOLLO_CLUSTER = \"cluster\";", "originalCommit": "2996061648499a42e7d7959167df52dea15c4fc2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODU3OTk0MQ==", "url": "https://github.com/seata/seata/pull/3116#discussion_r488579941", "bodyText": "yes", "author": "slinpq", "createdAt": "2020-09-15T11:07:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODU2NzQ3MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODU2NzU1MA==", "url": "https://github.com/seata/seata/pull/3116#discussion_r488567550", "bodyText": "file", "author": "a364176773", "createdAt": "2020-09-15T10:44:36Z", "path": "server/src/main/resources/registry.conf", "diffHunk": "@@ -57,7 +57,7 @@ registry {\n \n config {\n   # file\u3001nacos \u3001apollo\u3001zk\u3001consul\u3001etcd3\n-  type = \"file\"\n+  type = \"apollo\"", "originalCommit": "2996061648499a42e7d7959167df52dea15c4fc2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODU2NzYxNQ==", "url": "https://github.com/seata/seata/pull/3116#discussion_r488567615", "bodyText": "cluster = \"seata\"  Is that better?", "author": "a364176773", "createdAt": "2020-09-15T10:44:47Z", "path": "server/src/main/resources/registry.conf", "diffHunk": "@@ -71,9 +71,12 @@ config {\n   }\n   apollo {\n     appId = \"seata-server\"\n+    ## apolloConfigService will cover apolloMeta\n     apolloMeta = \"http://192.168.1.204:8801\"\n+    apolloConfigService = \"http://192.168.1.204:8080\"\n     namespace = \"application\"\n     apolloAccesskeySecret = \"\"\n+    cluster = \"cluster\"", "originalCommit": "2996061648499a42e7d7959167df52dea15c4fc2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDcyNzI1OQ==", "url": "https://github.com/seata/seata/pull/3116#discussion_r490727259", "bodyText": "change", "author": "a364176773", "createdAt": "2020-09-18T06:23:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODU2NzYxNQ=="}], "type": "inlineReview"}, {"oid": "8e8288e8a45affd83eda14c4ca9c360f906bb18d", "url": "https://github.com/seata/seata/commit/8e8288e8a45affd83eda14c4ca9c360f906bb18d", "message": "support configuring apolloService and apolloCluster", "committedDate": "2020-09-15T11:18:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTEwODY5Ng==", "url": "https://github.com/seata/seata/pull/3116#discussion_r489108696", "bodyText": "If the value is \"\"?", "author": "a364176773", "createdAt": "2020-09-16T01:32:21Z", "path": "config/seata-config-apollo/src/main/java/io/seata/config/apollo/ApolloConfiguration.java", "diffHunk": "@@ -176,6 +180,12 @@ private void readyApolloConfig() {\n                 System.setProperty(PROP_APOLLO_SECRET, secretKey);\n             }\n         }\n+        if (!properties.containsKey(APOLLO_CLUSTER)) {\n+            System.setProperty(PROP_APOLLO_CLUSTER, FILE_CONFIG.getConfig(getApolloCluster()));", "originalCommit": "8e8288e8a45affd83eda14c4ca9c360f906bb18d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTExMjc0Mw==", "url": "https://github.com/seata/seata/pull/3116#discussion_r489112743", "bodyText": "It is \"default\",the default value of apollo.", "author": "slinpq", "createdAt": "2020-09-16T01:47:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTEwODY5Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTExMjc4Ng==", "url": "https://github.com/seata/seata/pull/3116#discussion_r489112786", "bodyText": "It is \"default\",the default value of apollo.", "author": "slinpq", "createdAt": "2020-09-16T01:47:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTEwODY5Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDI5MDMzMg==", "url": "https://github.com/seata/seata/pull/3116#discussion_r490290332", "bodyText": "It is \"default\",the default value of apollo.\n\nI mean, if it's empty, don't set it", "author": "a364176773", "createdAt": "2020-09-17T14:26:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTEwODY5Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDI5OTYzNg==", "url": "https://github.com/seata/seata/pull/3116#discussion_r490299636", "bodyText": "The apollo client will set 'default',if it's empty.", "author": "slinpq", "createdAt": "2020-09-17T14:37:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTEwODY5Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDMwMDUwOQ==", "url": "https://github.com/seata/seata/pull/3116#discussion_r490300509", "bodyText": "The apollo client will set 'default',if it's empty.", "author": "slinpq", "createdAt": "2020-09-17T14:38:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTEwODY5Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTEwODczMw==", "url": "https://github.com/seata/seata/pull/3116#discussion_r489108733", "bodyText": "If the value is \"\"?", "author": "a364176773", "createdAt": "2020-09-16T01:32:29Z", "path": "config/seata-config-apollo/src/main/java/io/seata/config/apollo/ApolloConfiguration.java", "diffHunk": "@@ -176,6 +180,12 @@ private void readyApolloConfig() {\n                 System.setProperty(PROP_APOLLO_SECRET, secretKey);\n             }\n         }\n+        if (!properties.containsKey(APOLLO_CLUSTER)) {\n+            System.setProperty(PROP_APOLLO_CLUSTER, FILE_CONFIG.getConfig(getApolloCluster()));\n+        }\n+        if (!properties.containsKey(APOLLO_CONFIG_SERVICE)) {\n+            System.setProperty(PROP_APOLLO_CONFIG_SERVICE, FILE_CONFIG.getConfig(getApolloConfigService()));", "originalCommit": "8e8288e8a45affd83eda14c4ca9c360f906bb18d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTExMzM4MA==", "url": "https://github.com/seata/seata/pull/3116#discussion_r489113380", "bodyText": "It is empty.Apollo will use apolloMeta.If apolloMeta is empty.The addr of apollo will be null.", "author": "slinpq", "createdAt": "2020-09-16T01:49:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTEwODczMw=="}], "type": "inlineReview"}, {"oid": "17e68e5d35353a9ce0be2f23711b389557eba097", "url": "https://github.com/seata/seata/commit/17e68e5d35353a9ce0be2f23711b389557eba097", "message": "Merge branch 'develop' into develop", "committedDate": "2020-09-18T06:21:29Z", "type": "commit"}, {"oid": "5cc910849dc69535e72584361708968480563bed", "url": "https://github.com/seata/seata/commit/5cc910849dc69535e72584361708968480563bed", "message": "support configuring apolloService and apolloCluster", "committedDate": "2020-09-18T06:50:41Z", "type": "commit"}, {"oid": "f5b8ee740827f2479b8f51e0b7e709edee5bcdb5", "url": "https://github.com/seata/seata/commit/f5b8ee740827f2479b8f51e0b7e709edee5bcdb5", "message": "Merge branch 'develop' of https://github.com/slinpq/seata into develop", "committedDate": "2020-09-18T06:50:57Z", "type": "commit"}, {"oid": "6aff33542f6221251f8c33c1af29673b1f102110", "url": "https://github.com/seata/seata/commit/6aff33542f6221251f8c33c1af29673b1f102110", "message": "Merge branch 'develop' into develop", "committedDate": "2020-09-21T08:48:41Z", "type": "commit"}, {"oid": "737a85003840d94b3dfe61a9a018a687591c83bb", "url": "https://github.com/seata/seata/commit/737a85003840d94b3dfe61a9a018a687591c83bb", "message": "Merge branch 'develop' into develop", "committedDate": "2020-09-28T09:33:15Z", "type": "commit"}, {"oid": "83e7cddebab597b04132a186ca002693b0257f48", "url": "https://github.com/seata/seata/commit/83e7cddebab597b04132a186ca002693b0257f48", "message": "Merge branch 'develop' into develop", "committedDate": "2020-10-01T13:18:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODIzODAzOA==", "url": "https://github.com/seata/seata/pull/3116#discussion_r498238038", "bodyText": "Pls Give it a initial size.", "author": "xingfudeshi", "createdAt": "2020-10-01T13:20:17Z", "path": "config/seata-config-apollo/src/main/java/io/seata/config/apollo/ApolloConfiguration.java", "diffHunk": "@@ -54,17 +54,21 @@\n     private static final String APP_ID = \"appId\";\n     private static final String APOLLO_META = \"apolloMeta\";\n     private static final String APOLLO_SECRET = \"apolloAccesskeySecret\";\n+    private static final String APOLLO_CLUSTER = \"seata\";\n+    private static final String APOLLO_CONFIG_SERVICE = \"apolloConfigService\";\n     private static final String PROP_APP_ID = \"app.id\";\n     private static final String PROP_APOLLO_META = \"apollo.meta\";\n+    private static final String PROP_APOLLO_CONFIG_SERVICE = \"apollo.configService\";\n     private static final String PROP_APOLLO_SECRET = \"apollo.accesskey.secret\";\n+    private static final String PROP_APOLLO_CLUSTER = \"apollo.cluster\";\n     private static final String NAMESPACE = \"namespace\";\n     private static final String DEFAULT_NAMESPACE = \"application\";\n     private static final Configuration FILE_CONFIG = ConfigurationFactory.CURRENT_FILE_INSTANCE;\n     private static volatile Config config;\n     private ExecutorService configOperateExecutor;\n     private static final int CORE_CONFIG_OPERATE_THREAD = 1;\n     private static final ConcurrentMap<String, Set<ConfigurationChangeListener>> LISTENER_SERVICE_MAP\n-        = new ConcurrentHashMap<>();\n+            = new ConcurrentHashMap<>();", "originalCommit": "83e7cddebab597b04132a186ca002693b0257f48", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "2cdf6caef34ce31ca5774e11ca937568c1f84eb9", "url": "https://github.com/seata/seata/commit/2cdf6caef34ce31ca5774e11ca937568c1f84eb9", "message": "Merge branch 'develop' into develop", "committedDate": "2020-10-10T07:57:41Z", "type": "commit"}, {"oid": "91f6a6aca9eb51ecc73b2b3f2865919852fb4b31", "url": "https://github.com/seata/seata/commit/91f6a6aca9eb51ecc73b2b3f2865919852fb4b31", "message": "Merge branch 'develop' into develop", "committedDate": "2020-11-11T01:27:35Z", "type": "commit"}, {"oid": "2208a5f4b9c22dcfc48d929bb54559dbc7923c57", "url": "https://github.com/seata/seata/commit/2208a5f4b9c22dcfc48d929bb54559dbc7923c57", "message": "Merge branch 'develop' into develop", "committedDate": "2020-11-22T12:52:19Z", "type": "commit"}]}