{"pr_number": 2510, "pr_title": "feature: add LZ4 compressor", "pr_createdAt": "2020-04-04T14:51:58Z", "pr_url": "https://github.com/seata/seata/pull/2510", "timeline": [{"oid": "f2551bc0aa87e7ae1b77dc767457364a4f03e6c9", "url": "https://github.com/seata/seata/commit/f2551bc0aa87e7ae1b77dc767457364a4f03e6c9", "message": "add LZ4 compressor", "committedDate": "2020-04-04T14:52:15Z", "type": "forcePushed"}, {"oid": "a44a3fb1fb5caf0bfa070b18fd44a49c06a7efb5", "url": "https://github.com/seata/seata/commit/a44a3fb1fb5caf0bfa070b18fd44a49c06a7efb5", "message": "add LZ4 compressor", "committedDate": "2020-04-04T14:53:38Z", "type": "forcePushed"}, {"oid": "c41baeaf32781f5469a7ff369569f05c656a71ab", "url": "https://github.com/seata/seata/commit/c41baeaf32781f5469a7ff369569f05c656a71ab", "message": "add LZ4 compressor", "committedDate": "2020-04-04T14:55:41Z", "type": "forcePushed"}, {"oid": "f78f4dc069e8048daba513578a3745ccbeb77480", "url": "https://github.com/seata/seata/commit/f78f4dc069e8048daba513578a3745ccbeb77480", "message": "add LZ4 compressor", "committedDate": "2020-04-07T03:22:33Z", "type": "forcePushed"}, {"oid": "cac665f886bd04ade069bf12550cd61854d4990c", "url": "https://github.com/seata/seata/commit/cac665f886bd04ade069bf12550cd61854d4990c", "message": "add LZ4 compressor", "committedDate": "2020-04-07T03:41:45Z", "type": "forcePushed"}, {"oid": "de9502ac589b5b7262b47c1bc58b32f3ca9d5dae", "url": "https://github.com/seata/seata/commit/de9502ac589b5b7262b47c1bc58b32f3ca9d5dae", "message": "add LZ4 compressor", "committedDate": "2020-04-07T04:44:26Z", "type": "forcePushed"}, {"oid": "ebc488d9a633828c35b29314333f0da04496ad78", "url": "https://github.com/seata/seata/commit/ebc488d9a633828c35b29314333f0da04496ad78", "message": "add LZ4 compressor", "committedDate": "2020-04-07T05:11:19Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTI5MDYzNA==", "url": "https://github.com/seata/seata/pull/2510#discussion_r405290634", "bodyText": "Please put version into all and bom files. For details, please refer to bzip2", "author": "ph3636", "createdAt": "2020-04-08T06:39:36Z", "path": "compressor/seata-compressor-lz4/pom.xml", "diffHunk": "@@ -0,0 +1,43 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!--\n+  ~  Copyright 1999-2019 Seata.io Group.\n+  ~\n+  ~  Licensed under the Apache License, Version 2.0 (the \"License\");\n+  ~  you may not use this file except in compliance with the License.\n+  ~  You may obtain a copy of the License at\n+  ~\n+  ~       http://www.apache.org/licenses/LICENSE-2.0\n+  ~\n+  ~  Unless required by applicable law or agreed to in writing, software\n+  ~  distributed under the License is distributed on an \"AS IS\" BASIS,\n+  ~  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+  ~  See the License for the specific language governing permissions and\n+  ~  limitations under the License.\n+  -->\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+    <parent>\n+        <groupId>io.seata</groupId>\n+        <artifactId>seata-compressor</artifactId>\n+        <version>${revision}</version>\n+    </parent>\n+    <modelVersion>4.0.0</modelVersion>\n+    <artifactId>seata-compressor-lz4</artifactId>\n+    <packaging>jar</packaging>\n+    <name>seata-compressor-lz4 ${project.version}</name>\n+\n+    <dependencies>\n+        <dependency>\n+            <groupId>${project.groupId}</groupId>\n+            <artifactId>seata-core</artifactId>\n+            <version>${project.version}</version>\n+        </dependency>\n+        <dependency>\n+            <groupId>org.lz4</groupId>\n+            <artifactId>lz4-java</artifactId>\n+            <version>1.7.1</version>", "originalCommit": "f4727f47eec79db84f7ea33ed868c05b8d964abc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTk4NTQ3NQ==", "url": "https://github.com/seata/seata/pull/2510#discussion_r405985475", "bodyText": "seata-all file also needs to contain seata-compressor-lz4", "author": "ph3636", "createdAt": "2020-04-09T06:37:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTI5MDYzNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTI5MTEyMg==", "url": "https://github.com/seata/seata/pull/2510#discussion_r405291122", "bodyText": "Java package at the top,Change BZip2Util and SevenZUtil by the way, if you can", "author": "ph3636", "createdAt": "2020-04-08T06:40:48Z", "path": "compressor/seata-compressor-lz4/src/main/java/io/seata/compressor/lz4/Lz4Util.java", "diffHunk": "@@ -0,0 +1,77 @@\n+/*\n+ *  Copyright 1999-2019 Seata.io Group.\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+package io.seata.compressor.lz4;\n+\n+import net.jpountz.lz4.LZ4BlockInputStream;\n+import net.jpountz.lz4.LZ4BlockOutputStream;\n+import net.jpountz.lz4.LZ4Compressor;\n+import net.jpountz.lz4.LZ4Factory;\n+import net.jpountz.lz4.LZ4FastDecompressor;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.ByteArrayOutputStream;\n+import java.io.IOException;", "originalCommit": "f4727f47eec79db84f7ea33ed868c05b8d964abc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTI5MjQ1OQ==", "url": "https://github.com/seata/seata/pull/2510#discussion_r405292459", "bodyText": "You don't need to initialize such a large value, just keep the default value", "author": "ph3636", "createdAt": "2020-04-08T06:44:06Z", "path": "compressor/seata-compressor-lz4/src/main/java/io/seata/compressor/lz4/Lz4Util.java", "diffHunk": "@@ -0,0 +1,77 @@\n+/*\n+ *  Copyright 1999-2019 Seata.io Group.\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+package io.seata.compressor.lz4;\n+\n+import net.jpountz.lz4.LZ4BlockInputStream;\n+import net.jpountz.lz4.LZ4BlockOutputStream;\n+import net.jpountz.lz4.LZ4Compressor;\n+import net.jpountz.lz4.LZ4Factory;\n+import net.jpountz.lz4.LZ4FastDecompressor;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.ByteArrayOutputStream;\n+import java.io.IOException;\n+\n+/**\n+ * the Lz4 Util\n+ *\n+ * @author diguage\n+ */\n+public class Lz4Util {\n+    private static final Logger LOGGER = LoggerFactory.getLogger(Lz4Util.class);\n+    private static final int ARRAY_SIZE = 2048;\n+\n+    private static final LZ4Factory LZ4_FACTORY = LZ4Factory.fastestInstance();\n+\n+    public static byte[] compress(byte[] bytes) {\n+        if (bytes == null) {\n+            throw new NullPointerException(\"bytes is null\");\n+        }\n+        LZ4Compressor compressor = LZ4_FACTORY.fastCompressor();\n+        ByteArrayOutputStream outputStream = new ByteArrayOutputStream();\n+        try (LZ4BlockOutputStream lz4BlockOutputStream\n+                     = new LZ4BlockOutputStream(outputStream, ARRAY_SIZE, compressor)) {\n+            lz4BlockOutputStream.write(bytes);\n+        } catch (IOException e) {\n+            LOGGER.error(\"compress bytes error\", e);\n+        }\n+        return outputStream.toByteArray();\n+    }\n+\n+    public static byte[] decompress(byte[] bytes) {\n+        if (bytes == null) {\n+            throw new NullPointerException(\"bytes is null\");\n+        }\n+\n+        ByteArrayOutputStream outputStream = new ByteArrayOutputStream(ARRAY_SIZE);", "originalCommit": "f4727f47eec79db84f7ea33ed868c05b8d964abc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTQ4NjQ0MA==", "url": "https://github.com/seata/seata/pull/2510#discussion_r405486440", "bodyText": "The default size is 32.  Is it too small?\nMaybe I can change the ARRAY_SIZE  to 1024. Is it OK?", "author": "diguage", "createdAt": "2020-04-08T12:29:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTI5MjQ1OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTI5NDIyMA==", "url": "https://github.com/seata/seata/pull/2510#discussion_r405294220", "bodyText": "This one can get rid of static decoration", "author": "ph3636", "createdAt": "2020-04-08T06:48:25Z", "path": "compressor/seata-compressor-lz4/src/main/java/io/seata/compressor/lz4/Lz4Util.java", "diffHunk": "@@ -0,0 +1,77 @@\n+/*\n+ *  Copyright 1999-2019 Seata.io Group.\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+package io.seata.compressor.lz4;\n+\n+import net.jpountz.lz4.LZ4BlockInputStream;\n+import net.jpountz.lz4.LZ4BlockOutputStream;\n+import net.jpountz.lz4.LZ4Compressor;\n+import net.jpountz.lz4.LZ4Factory;\n+import net.jpountz.lz4.LZ4FastDecompressor;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.ByteArrayOutputStream;\n+import java.io.IOException;\n+\n+/**\n+ * the Lz4 Util\n+ *\n+ * @author diguage\n+ */\n+public class Lz4Util {\n+    private static final Logger LOGGER = LoggerFactory.getLogger(Lz4Util.class);\n+    private static final int ARRAY_SIZE = 2048;\n+\n+    private static final LZ4Factory LZ4_FACTORY = LZ4Factory.fastestInstance();", "originalCommit": "f4727f47eec79db84f7ea33ed868c05b8d964abc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTQ5MDM2Mg==", "url": "https://github.com/seata/seata/pull/2510#discussion_r405490362", "bodyText": "The LZ4_FACTORY is used in the static methods.", "author": "diguage", "createdAt": "2020-04-08T12:36:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTI5NDIyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTk4NTAxMg==", "url": "https://github.com/seata/seata/pull/2510#discussion_r405985012", "bodyText": "Remove the static variable and use it directly in the method", "author": "ph3636", "createdAt": "2020-04-09T06:36:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTI5NDIyMA=="}], "type": "inlineReview"}, {"oid": "88622109781a5ec421059da46c850c1b619dc0b0", "url": "https://github.com/seata/seata/commit/88622109781a5ec421059da46c850c1b619dc0b0", "message": "add LZ4 compressor", "committedDate": "2020-04-08T12:38:29Z", "type": "forcePushed"}, {"oid": "145272f8aa9bd37803b065f236267db36d35af07", "url": "https://github.com/seata/seata/commit/145272f8aa9bd37803b065f236267db36d35af07", "message": "add LZ4 compressor", "committedDate": "2020-04-09T11:42:34Z", "type": "forcePushed"}, {"oid": "dc446a24877abe450f066f42de5f0e87f9d922f3", "url": "https://github.com/seata/seata/commit/dc446a24877abe450f066f42de5f0e87f9d922f3", "message": "add LZ4 compressor", "committedDate": "2020-04-10T02:10:47Z", "type": "forcePushed"}, {"oid": "7d855c5f6f1b2d5824f27e7cc97241b6267a4900", "url": "https://github.com/seata/seata/commit/7d855c5f6f1b2d5824f27e7cc97241b6267a4900", "message": "add LZ4 compressor", "committedDate": "2020-04-10T04:55:22Z", "type": "forcePushed"}, {"oid": "481b9e01c83e5e94d19d455a5e633819edc325a2", "url": "https://github.com/seata/seata/commit/481b9e01c83e5e94d19d455a5e633819edc325a2", "message": "add LZ4 compressor", "committedDate": "2020-04-10T12:46:18Z", "type": "forcePushed"}, {"oid": "33c6aaeb1e38acb06bcaad71b7b22b9268a27306", "url": "https://github.com/seata/seata/commit/33c6aaeb1e38acb06bcaad71b7b22b9268a27306", "message": "add LZ4 compressor", "committedDate": "2020-04-13T01:52:25Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzgwNzcyMA==", "url": "https://github.com/seata/seata/pull/2510#discussion_r413807720", "bodyText": "pls add lz4-java dependency in all.pom", "author": "slievrly", "createdAt": "2020-04-23T13:45:24Z", "path": "all/pom.xml", "diffHunk": "@@ -284,6 +284,11 @@\n             <artifactId>seata-compressor-zip</artifactId>\n             <version>${project.version}</version>\n         </dependency>\n+        <dependency>", "originalCommit": "343957f055040a484279bf827ad7cdce12cd8072", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDI0NDAxMg==", "url": "https://github.com/seata/seata/pull/2510#discussion_r414244012", "bodyText": "OK\ud83d\udc4c\nPlease review.", "author": "diguage", "createdAt": "2020-04-24T02:20:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzgwNzcyMA=="}], "type": "inlineReview"}, {"oid": "60766087391889dc390ab3d6a0352b02b5396547", "url": "https://github.com/seata/seata/commit/60766087391889dc390ab3d6a0352b02b5396547", "message": "add LZ4 compressor", "committedDate": "2020-04-24T02:13:59Z", "type": "commit"}, {"oid": "e1c18ccea1e50037d621b0b768c683a8957e4eea", "url": "https://github.com/seata/seata/commit/e1c18ccea1e50037d621b0b768c683a8957e4eea", "message": "add missing config for seata-all", "committedDate": "2020-04-24T02:13:59Z", "type": "commit"}, {"oid": "6911527dbdc644caf36fce416ceb0074c504addf", "url": "https://github.com/seata/seata/commit/6911527dbdc644caf36fce416ceb0074c504addf", "message": "add lz4-java dependency in all/pom.pom", "committedDate": "2020-04-24T02:19:42Z", "type": "commit"}, {"oid": "6911527dbdc644caf36fce416ceb0074c504addf", "url": "https://github.com/seata/seata/commit/6911527dbdc644caf36fce416ceb0074c504addf", "message": "add lz4-java dependency in all/pom.pom", "committedDate": "2020-04-24T02:19:42Z", "type": "forcePushed"}, {"oid": "a4cd9e41e8d3c4861c46ed50fb0373068bd1121d", "url": "https://github.com/seata/seata/commit/a4cd9e41e8d3c4861c46ed50fb0373068bd1121d", "message": "Merge branch 'develop' into lz4-compressor", "committedDate": "2020-04-25T06:12:16Z", "type": "commit"}, {"oid": "1ee32e65fd0b54c9f521543e164b3034ad476e19", "url": "https://github.com/seata/seata/commit/1ee32e65fd0b54c9f521543e164b3034ad476e19", "message": "Merge branch 'develop' into lz4-compressor", "committedDate": "2020-04-26T05:42:22Z", "type": "commit"}, {"oid": "40f5eb0c4c97c8efb20a40bed7d0c4e2fd0af043", "url": "https://github.com/seata/seata/commit/40f5eb0c4c97c8efb20a40bed7d0c4e2fd0af043", "message": "Merge branch 'develop' into lz4-compressor", "committedDate": "2020-04-28T10:18:04Z", "type": "commit"}]}