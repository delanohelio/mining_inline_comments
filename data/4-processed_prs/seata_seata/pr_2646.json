{"pr_number": 2646, "pr_title": "feature: add support for HikariCP", "pr_createdAt": "2020-04-30T10:08:12Z", "pr_url": "https://github.com/seata/seata/pull/2646", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTEyNzA2Mg==", "url": "https://github.com/seata/seata/pull/2646#discussion_r419127062", "bodyText": "", "author": "slievrly", "createdAt": "2020-05-03T16:30:34Z", "path": "server/src/main/java/io/seata/server/store/HikariDataSourceGenerator.java", "diffHunk": "@@ -0,0 +1,59 @@\n+/*\n+ *  Copyright 1999-2019 Seata.io Group.\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+package io.seata.server.store;\n+\n+import javax.sql.DataSource;\n+import java.util.Properties;\n+\n+import com.zaxxer.hikari.HikariConfig;\n+import com.zaxxer.hikari.HikariDataSource;\n+import io.seata.common.loader.LoadLevel;\n+import io.seata.core.store.db.AbstractDataSourceGenerator;\n+\n+/**\n+ * The type Hikari data source generator.\n+ *\n+ * @author diguage\n+ */\n+@LoadLevel(name = \"hikari\")\n+public class HikariDataSourceGenerator extends AbstractDataSourceGenerator {\n+    @Override\n+    public DataSource generateDataSource() {\n+        Properties properties = new Properties();\n+        properties.setProperty(\"dataSource.cachePrepStmts\", \"true\");\n+        properties.setProperty(\"dataSource.prepStmtCacheSize\", \"250\");\n+        properties.setProperty(\"dataSource.prepStmtCacheSqlLimit\", \"2048\");\n+        properties.setProperty(\"dataSource.useServerPrepStmts\", \"true\");\n+        properties.setProperty(\"dataSource.useLocalSessionState\", \"true\");\n+        properties.setProperty(\"dataSource.rewriteBatchedStatements\", \"true\");\n+        properties.setProperty(\"dataSource.cacheResultSetMetadata\", \"true\");\n+        properties.setProperty(\"dataSource.cacheServerConfiguration\", \"true\");\n+        properties.setProperty(\"dataSource.elideSetAutoCommits\", \"true\");\n+        properties.setProperty(\"dataSource.maintainTimeStats\", \"false\");\n+\n+        HikariConfig config = new HikariConfig(properties);\n+        config.setDriverClassName(getDriverClassName());\n+        config.setJdbcUrl(getUrl());\n+        config.setUsername(getUser());\n+        config.setPassword(getPassword());\n+        config.setMaximumPoolSize(getMaxConn());\n+        config.setMinimumIdle(getMinConn());\n+        config.setAutoCommit(true);\n+        config.setConnectionTestQuery(getValidationQuery(getDBType()));", "originalCommit": "4da2e81da4ed0aa23d49013ed361f0ca8d9174f4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDY4OTExMg==", "url": "https://github.com/seata/seata/pull/2646#discussion_r420689112", "bodyText": "@diguage How was the problem solved?", "author": "slievrly", "createdAt": "2020-05-06T10:27:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTEyNzA2Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDg3NzI1MA==", "url": "https://github.com/seata/seata/pull/2646#discussion_r420877250", "bodyText": "@slievrly\nYes. I have deleted the statement.", "author": "diguage", "createdAt": "2020-05-06T15:20:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTEyNzA2Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTIxODQ5MQ==", "url": "https://github.com/seata/seata/pull/2646#discussion_r421218491", "bodyText": "@diguage Is the code not committed?", "author": "slievrly", "createdAt": "2020-05-07T03:31:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTEyNzA2Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTI3MzU0NA==", "url": "https://github.com/seata/seata/pull/2646#discussion_r421273544", "bodyText": "@slievrly\nSorry. I forgot to commit.", "author": "diguage", "createdAt": "2020-05-07T06:43:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTEyNzA2Mg=="}], "type": "inlineReview"}, {"oid": "d714992aeb81300bc7f95f0c0582a5e966dc8d19", "url": "https://github.com/seata/seata/commit/d714992aeb81300bc7f95f0c0582a5e966dc8d19", "message": "feature: add support for HikariCP", "committedDate": "2020-05-04T01:07:31Z", "type": "commit"}, {"oid": "d714992aeb81300bc7f95f0c0582a5e966dc8d19", "url": "https://github.com/seata/seata/commit/d714992aeb81300bc7f95f0c0582a5e966dc8d19", "message": "feature: add support for HikariCP", "committedDate": "2020-05-04T01:07:31Z", "type": "forcePushed"}, {"oid": "1f121cac4ac1220ea601390af3929f799b03b4dc", "url": "https://github.com/seata/seata/commit/1f121cac4ac1220ea601390af3929f799b03b4dc", "message": "Merge branch 'develop' into hikari-data-source", "committedDate": "2020-05-06T10:22:50Z", "type": "commit"}, {"oid": "8c43fde36328b78d015e1aa314d914198b561def", "url": "https://github.com/seata/seata/commit/8c43fde36328b78d015e1aa314d914198b561def", "message": "delete config for connectionTestQuery", "committedDate": "2020-05-07T06:40:42Z", "type": "commit"}, {"oid": "e375e5b4d361cbda5d233d2f7f7194acfe79cafb", "url": "https://github.com/seata/seata/commit/e375e5b4d361cbda5d233d2f7f7194acfe79cafb", "message": "Merge branch 'hikari-data-source' of github.com:diguage/seata into hikari-data-source", "committedDate": "2020-05-07T06:42:01Z", "type": "commit"}, {"oid": "f4190691ba21b7ca92d61b7ea7094b851c356db0", "url": "https://github.com/seata/seata/commit/f4190691ba21b7ca92d61b7ea7094b851c356db0", "message": "Merge branch 'develop' into hikari-data-source", "committedDate": "2020-05-08T01:20:45Z", "type": "commit"}, {"oid": "55e768b9c3f2c374bc40372bf328254cea3246a5", "url": "https://github.com/seata/seata/commit/55e768b9c3f2c374bc40372bf328254cea3246a5", "message": "Merge branch 'develop' into hikari-data-source", "committedDate": "2020-05-08T04:00:03Z", "type": "commit"}, {"oid": "7e3dd2278b1a28c08a7985c850561a501187f7d9", "url": "https://github.com/seata/seata/commit/7e3dd2278b1a28c08a7985c850561a501187f7d9", "message": "Merge branch 'develop' into hikari-data-source", "committedDate": "2020-05-08T09:04:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTk0NzA1Ng==", "url": "https://github.com/seata/seata/pull/2646#discussion_r421947056", "bodyText": "connectionTimeout is equivalent to druid maxWait? if yes, please add config.setConnectionTimeout(getMaxWait());", "author": "a364176773", "createdAt": "2020-05-08T05:31:25Z", "path": "server/src/main/java/io/seata/server/store/HikariDataSourceGenerator.java", "diffHunk": "@@ -0,0 +1,58 @@\n+/*\n+ *  Copyright 1999-2019 Seata.io Group.\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+package io.seata.server.store;\n+\n+import javax.sql.DataSource;\n+import java.util.Properties;\n+\n+import com.zaxxer.hikari.HikariConfig;\n+import com.zaxxer.hikari.HikariDataSource;\n+import io.seata.common.loader.LoadLevel;\n+import io.seata.core.store.db.AbstractDataSourceGenerator;\n+\n+/**\n+ * The type Hikari data source generator.\n+ *\n+ * @author diguage\n+ */\n+@LoadLevel(name = \"hikari\")\n+public class HikariDataSourceGenerator extends AbstractDataSourceGenerator {\n+    @Override\n+    public DataSource generateDataSource() {\n+        Properties properties = new Properties();\n+        properties.setProperty(\"dataSource.cachePrepStmts\", \"true\");\n+        properties.setProperty(\"dataSource.prepStmtCacheSize\", \"250\");\n+        properties.setProperty(\"dataSource.prepStmtCacheSqlLimit\", \"2048\");\n+        properties.setProperty(\"dataSource.useServerPrepStmts\", \"true\");\n+        properties.setProperty(\"dataSource.useLocalSessionState\", \"true\");\n+        properties.setProperty(\"dataSource.rewriteBatchedStatements\", \"true\");\n+        properties.setProperty(\"dataSource.cacheResultSetMetadata\", \"true\");\n+        properties.setProperty(\"dataSource.cacheServerConfiguration\", \"true\");\n+        properties.setProperty(\"dataSource.elideSetAutoCommits\", \"true\");\n+        properties.setProperty(\"dataSource.maintainTimeStats\", \"false\");\n+\n+        HikariConfig config = new HikariConfig(properties);\n+        config.setDriverClassName(getDriverClassName());\n+        config.setJdbcUrl(getUrl());\n+        config.setUsername(getUser());\n+        config.setPassword(getPassword());\n+        config.setMaximumPoolSize(getMaxConn());\n+        config.setMinimumIdle(getMinConn());\n+        config.setAutoCommit(true);\n+", "originalCommit": "55e768b9c3f2c374bc40372bf328254cea3246a5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjQ0NTI2MQ==", "url": "https://github.com/seata/seata/pull/2646#discussion_r422445261", "bodyText": "OK", "author": "diguage", "createdAt": "2020-05-09T02:54:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTk0NzA1Ng=="}], "type": "inlineReview"}, {"oid": "731805fc13f887611eabe0211d09d4f2a8ed195d", "url": "https://github.com/seata/seata/commit/731805fc13f887611eabe0211d09d4f2a8ed195d", "message": "add config for connectionTimeout", "committedDate": "2020-05-09T02:54:32Z", "type": "commit"}]}