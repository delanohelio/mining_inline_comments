{"pr_number": 2554, "pr_title": "bugfix: add zk serializer.", "pr_createdAt": "2020-04-15T02:56:50Z", "pr_url": "https://github.com/seata/seata/pull/2554", "timeline": [{"oid": "c635ca48730dc23a6daf0d55aa82d04d92b7b1eb", "url": "https://github.com/seata/seata/commit/c635ca48730dc23a6daf0d55aa82d04d92b7b1eb", "message": "feature: add zk serializer.", "committedDate": "2020-04-15T02:56:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODcyNzc3MA==", "url": "https://github.com/seata/seata/pull/2554#discussion_r408727770", "bodyText": "Exception replace to Throwable ? Class.forName can be appears LinkageError", "author": "jsbxyyx", "createdAt": "2020-04-15T10:05:10Z", "path": "config/seata-config-zk/src/main/java/io/seata/config/zk/ZookeeperConfiguration.java", "diffHunk": "@@ -245,4 +250,23 @@ public void handleDataDeleted(String s) {\n         }\n     }\n \n+    private ZkSerializer getZkSerializer() {\n+        ZkSerializer zkSerializer = null;\n+        String serializer = FILE_CONFIG.getConfig(FILE_CONFIG_KEY_PREFIX + SERIALIZER_KEY);\n+        if (StringUtils.isNotBlank(serializer)) {\n+            try {\n+                Class<?> aClass = Class.forName(serializer);\n+                zkSerializer = (ZkSerializer) aClass.newInstance();\n+            } catch (ClassNotFoundException cfe) {\n+                LOGGER.error(\"No zk serializer class found, serializer:{}\", serializer, cfe);\n+            } catch (Exception e) {", "originalCommit": "c635ca48730dc23a6daf0d55aa82d04d92b7b1eb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTUyNDM3Mg==", "url": "https://github.com/seata/seata/pull/2554#discussion_r409524372", "bodyText": "Done.", "author": "objcoding", "createdAt": "2020-04-16T12:42:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODcyNzc3MA=="}], "type": "inlineReview"}, {"oid": "5856d19752b0ccf669234c72f6b9f8ff67c7c808", "url": "https://github.com/seata/seata/commit/5856d19752b0ccf669234c72f6b9f8ff67c7c808", "message": "Merge branch 'develop' into zk-serializer", "committedDate": "2020-04-16T10:03:23Z", "type": "commit"}, {"oid": "65b47d67611edffe00fadf4730faaf6d5392940d", "url": "https://github.com/seata/seata/commit/65b47d67611edffe00fadf4730faaf6d5392940d", "message": "Merge branch 'develop' into zk-serializer", "committedDate": "2020-04-16T12:40:03Z", "type": "commit"}, {"oid": "13b66816811d9a76e4d01e7add5e7e3ea93fe584", "url": "https://github.com/seata/seata/commit/13b66816811d9a76e4d01e7add5e7e3ea93fe584", "message": "add zk serializer.", "committedDate": "2020-04-16T14:09:13Z", "type": "commit"}, {"oid": "8e7e8c8eddf44d12bb471f75361f033d3cb747f5", "url": "https://github.com/seata/seata/commit/8e7e8c8eddf44d12bb471f75361f033d3cb747f5", "message": "add DefaultZkSerializer.java", "committedDate": "2020-04-16T14:09:23Z", "type": "commit"}, {"oid": "12429de78226e2c18add4dc64632854aedb23b22", "url": "https://github.com/seata/seata/commit/12429de78226e2c18add4dc64632854aedb23b22", "message": "Class.forName can be appears LinkageError", "committedDate": "2020-04-16T14:10:00Z", "type": "commit"}, {"oid": "8670b248f2be4bd0ec1ef49b218402fe0b17c368", "url": "https://github.com/seata/seata/commit/8670b248f2be4bd0ec1ef49b218402fe0b17c368", "message": "Merge remote-tracking branch 'origin/zk-serializer' into zk-serializer", "committedDate": "2020-04-16T14:10:14Z", "type": "commit"}, {"oid": "bbd18c3770a6663b2cf63def72d2664ecf9d7588", "url": "https://github.com/seata/seata/commit/bbd18c3770a6663b2cf63def72d2664ecf9d7588", "message": "License for DefaultZkSerializer.java", "committedDate": "2020-04-16T14:11:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTU5NDI0OQ==", "url": "https://github.com/seata/seata/pull/2554#discussion_r409594249", "bodyText": "Default config type is file.", "author": "l81893521", "createdAt": "2020-04-16T14:19:00Z", "path": "server/src/main/resources/registry.conf", "diffHunk": "@@ -54,7 +54,7 @@ registry {\n \n config {\n   # file\u3001nacos \u3001apollo\u3001zk\u3001consul\u3001etcd3\n-  type = \"file\"\n+  type = \"zk\"", "originalCommit": "bbd18c3770a6663b2cf63def72d2664ecf9d7588", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTU5NzQxMA==", "url": "https://github.com/seata/seata/pull/2554#discussion_r409597410", "bodyText": "Done.", "author": "objcoding", "createdAt": "2020-04-16T14:23:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTU5NDI0OQ=="}], "type": "inlineReview"}, {"oid": "dbb229d0d025ae94b1227589dfa3e4a49fcbf0bc", "url": "https://github.com/seata/seata/commit/dbb229d0d025ae94b1227589dfa3e4a49fcbf0bc", "message": "Default config type is file.", "committedDate": "2020-04-16T14:22:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTYwMjM0Nw==", "url": "https://github.com/seata/seata/pull/2554#discussion_r409602347", "bodyText": "How about use log to tell users, zkSerializer would use DefaultZkSerializer", "author": "l81893521", "createdAt": "2020-04-16T14:29:10Z", "path": "config/seata-config-zk/src/main/java/io/seata/config/zk/ZookeeperConfiguration.java", "diffHunk": "@@ -247,4 +252,23 @@ public void handleDataDeleted(String s) {\n         }\n     }\n \n+    private ZkSerializer getZkSerializer() {\n+        ZkSerializer zkSerializer = null;\n+        String serializer = FILE_CONFIG.getConfig(FILE_CONFIG_KEY_PREFIX + SERIALIZER_KEY);\n+        if (StringUtils.isNotBlank(serializer)) {\n+            try {\n+                Class<?> aClass = Class.forName(serializer);\n+                zkSerializer = (ZkSerializer) aClass.newInstance();\n+            } catch (ClassNotFoundException cfe) {\n+                LOGGER.error(\"No zk serializer class found, serializer:{}\", serializer, cfe);\n+            } catch (Throwable cause) {\n+                LOGGER.error(\"found zk serializer encountered an unknown exception\", cause);\n+            }\n+        }\n+        if (zkSerializer == null) {\n+            zkSerializer = new DefaultZkSerializer();", "originalCommit": "dbb229d0d025ae94b1227589dfa3e4a49fcbf0bc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTYwNTE5Mw==", "url": "https://github.com/seata/seata/pull/2554#discussion_r409605193", "bodyText": "Done.", "author": "objcoding", "createdAt": "2020-04-16T14:32:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTYwMjM0Nw=="}], "type": "inlineReview"}, {"oid": "3690abac77cb2e01b3ef7aa69ba393034525c6d0", "url": "https://github.com/seata/seata/commit/3690abac77cb2e01b3ef7aa69ba393034525c6d0", "message": "fix getZkSerializer log", "committedDate": "2020-04-16T14:30:50Z", "type": "commit"}, {"oid": "cea21a8a8aadafa738b6c4aa826ec40e0adb1d82", "url": "https://github.com/seata/seata/commit/cea21a8a8aadafa738b6c4aa826ec40e0adb1d82", "message": "fix DefaultZkSerializer.java comment", "committedDate": "2020-04-16T14:39:47Z", "type": "commit"}, {"oid": "3bff4229ba8783efe6202ea6444a1158d2fa1774", "url": "https://github.com/seata/seata/commit/3bff4229ba8783efe6202ea6444a1158d2fa1774", "message": "remove useless import.", "committedDate": "2020-04-16T14:44:58Z", "type": "commit"}, {"oid": "a88ee0baaba90570fb553a6d47f6fe20456cf189", "url": "https://github.com/seata/seata/commit/a88ee0baaba90570fb553a6d47f6fe20456cf189", "message": "Prevent privatization of default constructor.", "committedDate": "2020-04-19T09:22:50Z", "type": "commit"}, {"oid": "9f99fded99ded66ca83e66076175410afe92dd27", "url": "https://github.com/seata/seata/commit/9f99fded99ded66ca83e66076175410afe92dd27", "message": "Merge branch 'develop' into zk-serializer", "committedDate": "2020-04-19T10:50:53Z", "type": "commit"}, {"oid": "0b780e5581b12106a12b8707f2f70daf4715eaef", "url": "https://github.com/seata/seata/commit/0b780e5581b12106a12b8707f2f70daf4715eaef", "message": "Merge branch 'develop' into zk-serializer", "committedDate": "2020-04-20T07:38:20Z", "type": "commit"}, {"oid": "079c2a4b4de5a4ad2d4a12969e58b969a4d7cdc4", "url": "https://github.com/seata/seata/commit/079c2a4b4de5a4ad2d4a12969e58b969a4d7cdc4", "message": "Merge branch 'develop' into zk-serializer", "committedDate": "2020-04-22T05:05:53Z", "type": "commit"}, {"oid": "adc2f1a578be0ec1c4cac652c6e5de6749e59596", "url": "https://github.com/seata/seata/commit/adc2f1a578be0ec1c4cac652c6e5de6749e59596", "message": "Merge branch 'develop' into zk-serializer", "committedDate": "2020-04-22T06:09:06Z", "type": "commit"}, {"oid": "debea7cf7549ea40c15ea41c8f26cc4acc16a325", "url": "https://github.com/seata/seata/commit/debea7cf7549ea40c15ea41c8f26cc4acc16a325", "message": "Merge branch 'develop' into zk-serializer", "committedDate": "2020-04-22T14:34:49Z", "type": "commit"}, {"oid": "39b4617b91b76d8e74e7bb0629178c459889fe75", "url": "https://github.com/seata/seata/commit/39b4617b91b76d8e74e7bb0629178c459889fe75", "message": "Merge remote-tracking branch 'origin/zk-serializer' into zk-serializer", "committedDate": "2020-04-22T14:35:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzQ3Nzc4Mg==", "url": "https://github.com/seata/seata/pull/2554#discussion_r413477782", "bodyText": "It is not recommended that the serializer be exposed to the user to increase the cost of understanding what code is actually defined for the configuration item.", "author": "slievrly", "createdAt": "2020-04-23T03:15:22Z", "path": "config/seata-config-core/src/main/resources/registry.conf", "diffHunk": "@@ -66,6 +66,7 @@ config {\n     serverAddr = \"127.0.0.1:2181\"\n     sessionTimeout = 6000\n     connectTimeout = 2000\n+    serializer = \"\"", "originalCommit": "39b4617b91b76d8e74e7bb0629178c459889fe75", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzg3MjAyNA==", "url": "https://github.com/seata/seata/pull/2554#discussion_r413872024", "bodyText": "This suggestion is very good.", "author": "objcoding", "createdAt": "2020-04-23T14:59:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzQ3Nzc4Mg=="}], "type": "inlineReview"}, {"oid": "19fcdf78435f78154b0081a913598cfcb21bf2f9", "url": "https://github.com/seata/seata/commit/19fcdf78435f78154b0081a913598cfcb21bf2f9", "message": "remove zk serializer configuration item", "committedDate": "2020-04-23T14:56:53Z", "type": "commit"}, {"oid": "88841845265e54dab6e994ba60662e818ef8a723", "url": "https://github.com/seata/seata/commit/88841845265e54dab6e994ba60662e818ef8a723", "message": "Merge branch 'develop' into zk-serializer", "committedDate": "2020-04-24T01:47:49Z", "type": "commit"}]}