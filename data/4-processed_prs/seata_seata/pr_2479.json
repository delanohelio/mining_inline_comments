{"pr_number": 2479, "pr_title": "bugfix: postgresql schema lowerCase", "pr_createdAt": "2020-03-29T06:45:59Z", "pr_url": "https://github.com/seata/seata/pull/2479", "timeline": [{"oid": "edc6056ed31547cbda513ba441bfa9e73ef54175", "url": "https://github.com/seata/seata/commit/edc6056ed31547cbda513ba441bfa9e73ef54175", "message": "#2435 fix pg schema lowerCase", "committedDate": "2020-03-29T06:44:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTc2MjM1Ng==", "url": "https://github.com/seata/seata/pull/2479#discussion_r399762356", "bodyText": "why if schema name not null, lower case the schema name?\nHow about the situation like below?\nCREATE DATABASE \"SeAtA\"", "author": "l81893521", "createdAt": "2020-03-29T08:07:01Z", "path": "rm-datasource/src/main/java/io/seata/rm/datasource/sql/struct/cache/PostgresqlTableMetaCache.java", "diffHunk": "@@ -102,7 +102,7 @@ private TableMeta resultSetMetaToSchema(DatabaseMetaData dbmd, String tableName)\n          * select * from \"Sel'ect\"\n          */\n         if (null != schemaName) {\n-            schemaName = schemaName.replaceAll(\"(^\\\")|(\\\"$)\", \"\");\n+            schemaName = schemaName.replaceAll(\"(^\\\")|(\\\"$)\", \"\").toLowerCase();", "originalCommit": "edc6056ed31547cbda513ba441bfa9e73ef54175", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTc4NDgyMA==", "url": "https://github.com/seata/seata/pull/2479#discussion_r399784820", "bodyText": "fix:\nselect * from TEST.test\nselect * from test.TEST\nselect * from \"Test\".test\nselect * from \"Test\".\"Select\"", "author": "jaspercloud", "createdAt": "2020-03-29T11:36:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTc2MjM1Ng=="}], "type": "inlineReview"}, {"oid": "08a7ecb28b20db82b0c71c3c8eab18ec057baab8", "url": "https://github.com/seata/seata/commit/08a7ecb28b20db82b0c71c3c8eab18ec057baab8", "message": "#2435 fix pg schema lowerCase", "committedDate": "2020-03-29T11:34:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDYyODU3Nw==", "url": "https://github.com/seata/seata/pull/2479#discussion_r400628577", "bodyText": "Can quotes exist between characters?", "author": "slievrly", "createdAt": "2020-03-31T03:56:14Z", "path": "rm-datasource/src/main/java/io/seata/rm/datasource/sql/struct/cache/PostgresqlTableMetaCache.java", "diffHunk": "@@ -100,11 +100,23 @@ private TableMeta resultSetMetaToSchema(DatabaseMetaData dbmd, String tableName)\n          * select * from \"Select\"\n          * select * from \"Sel\"\"ect\"\n          * select * from \"Sel'ect\"\n+         * select * from TEST.test\n+         * select * from test.TEST\n+         * select * from \"Test\".test\n+         * select * from \"Test\".\"Select\"\n          */\n         if (null != schemaName) {\n-            schemaName = schemaName.replaceAll(\"(^\\\")|(\\\"$)\", \"\");\n+            if (schemaName.startsWith(\"\\\"\") && schemaName.endsWith(\"\\\"\")) {\n+                schemaName = schemaName.replaceAll(\"(^\\\")|(\\\"$)\", \"\");", "originalCommit": "08a7ecb28b20db82b0c71c3c8eab18ec057baab8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTM0ODQyMQ==", "url": "https://github.com/seata/seata/pull/2479#discussion_r401348421", "bodyText": "It has been confirmed that it may contain special characters.", "author": "slievrly", "createdAt": "2020-04-01T04:24:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDYyODU3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTQ1NzgwMw==", "url": "https://github.com/seata/seata/pull/2479#discussion_r401457803", "bodyText": "support select * from \"Te\"'st\".\"Select\"", "author": "jaspercloud", "createdAt": "2020-04-01T08:55:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDYyODU3Nw=="}], "type": "inlineReview"}, {"oid": "fbd1bec06d7393078a934a6e350a09ad78f9e993", "url": "https://github.com/seata/seata/commit/fbd1bec06d7393078a934a6e350a09ad78f9e993", "message": "Merge branch 'develop' into postgresql", "committedDate": "2020-03-31T07:01:30Z", "type": "commit"}, {"oid": "1bb33dddd40acebe883eafd8efc31f172a08bd77", "url": "https://github.com/seata/seata/commit/1bb33dddd40acebe883eafd8efc31f172a08bd77", "message": "Merge branch 'develop' into postgresql", "committedDate": "2020-04-01T04:24:42Z", "type": "commit"}]}