{"pr_number": 3195, "pr_title": "optimize: opt XID related codes", "pr_createdAt": "2020-10-15T06:30:22Z", "pr_url": "https://github.com/seata/seata/pull/3195", "timeline": [{"oid": "e87670d14ebf802518193dd927a759a5b7847719", "url": "https://github.com/seata/seata/commit/e87670d14ebf802518193dd927a759a5b7847719", "message": "optimize: opt get xid", "committedDate": "2020-09-23T06:06:42Z", "type": "commit"}, {"oid": "242201ac38a2f1974106d53100cc09a16cb2f225", "url": "https://github.com/seata/seata/commit/242201ac38a2f1974106d53100cc09a16cb2f225", "message": "\u5c0f\u8c03\u6574\u3002", "committedDate": "2020-09-23T06:17:06Z", "type": "commit"}, {"oid": "f96e66db23bf91f53fb92189257299ae0e5bcc28", "url": "https://github.com/seata/seata/commit/f96e66db23bf91f53fb92189257299ae0e5bcc28", "message": "Merge remote-tracking branch 'remotes/upstream/develop' into optimize-get-xid\n\n# Conflicts:\n#\tspring/src/main/java/io/seata/spring/annotation/GlobalLock.java\n#\tspring/src/main/java/io/seata/spring/annotation/GlobalTransactional.java\n#\tspring/src/main/java/io/seata/spring/tcc/TccActionInterceptor.java\n#\ttcc/src/main/java/io/seata/rm/tcc/api/LocalTCC.java\n#\ttcc/src/main/java/io/seata/rm/tcc/api/TwoPhaseBusinessAction.java\n#\ttm/src/main/java/io/seata/tm/api/DefaultGlobalTransaction.java", "committedDate": "2020-10-12T11:13:06Z", "type": "commit"}, {"oid": "207bdff6e17ff133f53f8ca4f3d5915fe30962b0", "url": "https://github.com/seata/seata/commit/207bdff6e17ff133f53f8ca4f3d5915fe30962b0", "message": "optimize code", "committedDate": "2020-10-12T11:15:27Z", "type": "commit"}, {"oid": "a5b6630021cd5cbfc4e28366a6a368fc203f92d0", "url": "https://github.com/seata/seata/commit/a5b6630021cd5cbfc4e28366a6a368fc203f92d0", "message": "Revert some code", "committedDate": "2020-10-13T02:03:24Z", "type": "commit"}, {"oid": "f7e4a3cf4b204e02cca66b07b6c4dcc4b4d5f4f2", "url": "https://github.com/seata/seata/commit/f7e4a3cf4b204e02cca66b07b6c4dcc4b4d5f4f2", "message": "optimize code", "committedDate": "2020-10-15T02:23:49Z", "type": "commit"}, {"oid": "e4bdcf0604fc1f2459e308a798c10cb2a3b5600d", "url": "https://github.com/seata/seata/commit/e4bdcf0604fc1f2459e308a798c10cb2a3b5600d", "message": "Merge remote-tracking branch 'remotes/upstream/develop' into optimize-get-xid", "committedDate": "2020-10-15T02:24:44Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTIwMjUxMQ==", "url": "https://github.com/seata/seata/pull/3195#discussion_r505202511", "bodyText": "getXID\u65b9\u6cd5\u8c03\u7528\u7684\u6bd4\u8f83\u591a\uff0c\u5c06\u5224\u7a7a\u8f6c\u79fb\u5230bind\u65b9\u6cd5\u4f1a\u6bd4\u8f83\u597d\u4e00\u4e9b\u3002", "author": "wangliang181230", "createdAt": "2020-10-15T06:32:03Z", "path": "core/src/main/java/io/seata/core/context/RootContext.java", "diffHunk": "@@ -76,20 +77,20 @@ public static void setDefaultBranchType(BranchType defaultBranchType) {\n      *\n      * @return the xid\n      */\n+    @Nullable\n     public static String getXID() {\n-        String xid = (String) CONTEXT_HOLDER.get(KEY_XID);\n-        if (StringUtils.isNotBlank(xid)) {\n-            return xid;\n-        }", "originalCommit": "e4bdcf0604fc1f2459e308a798c10cb2a3b5600d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTIwMzM3NA==", "url": "https://github.com/seata/seata/pull/3195#discussion_r505203374", "bodyText": "bind\u65f6\u4e25\u683c\u63a7\u5236xid\u4e0d\u80fd\u4e3a\u7a7a\uff0c\u66f4\u52a0\u4e25\u8c28\u4e00\u4e9b\uff0c\u907f\u514d\u4e00\u4e9b\u672a\u77e5\u7684BUG\u3002\u540c\u65f6\uff0cget\u65b9\u6cd5\u4e2d\u7684\u5224\u7a7a\u4e5f\u53ef\u4ee5\u79fb\u9664\u6389\u4e86\u3002", "author": "wangliang181230", "createdAt": "2020-10-15T06:33:10Z", "path": "core/src/main/java/io/seata/core/context/RootContext.java", "diffHunk": "@@ -76,20 +77,20 @@ public static void setDefaultBranchType(BranchType defaultBranchType) {\n      *\n      * @return the xid\n      */\n+    @Nullable\n     public static String getXID() {\n-        String xid = (String) CONTEXT_HOLDER.get(KEY_XID);\n-        if (StringUtils.isNotBlank(xid)) {\n-            return xid;\n-        }\n-        return null;\n+        return (String) CONTEXT_HOLDER.get(KEY_XID);\n     }\n \n     /**\n-     * Bind.\n+     * Bind xid.\n      *\n      * @param xid the xid\n      */\n     public static void bind(@Nonnull String xid) {\n+        if (StringUtils.isBlank(xid)) {\n+            throw new IllegalArgumentException(\"xid must be not blank\");\n+        }", "originalCommit": "e4bdcf0604fc1f2459e308a798c10cb2a3b5600d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTIwMzcyMQ==", "url": "https://github.com/seata/seata/pull/3195#discussion_r505203721", "bodyText": "\u548cxid\u4e00\u6837\uff0c\u4e25\u683c\u63a7\u5236\u4e0d\u80fd\u4e3a\u7a7a\uff0c\u907f\u514d\u672a\u77e5\u7684BUG\u3002", "author": "wangliang181230", "createdAt": "2020-10-15T06:33:36Z", "path": "core/src/main/java/io/seata/core/context/RootContext.java", "diffHunk": "@@ -178,6 +181,9 @@ public static BranchType getBranchType() {\n      * @param branchType the branch type\n      */\n     public static void bindBranchType(@Nonnull BranchType branchType) {\n+        if (branchType == null) {\n+            throw new IllegalArgumentException(\"branchType must be not null\");\n+        }", "originalCommit": "e4bdcf0604fc1f2459e308a798c10cb2a3b5600d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTIwNTAxNg==", "url": "https://github.com/seata/seata/pull/3195#discussion_r505205016", "bodyText": "RootContext.getXID()\u65b9\u6cd5\u4f18\u5316\u8fc7\uff0c\u4e0d\u662fnull\u5c31\u662f\u975e\u7a7a\u767d\u5b57\u7b26\u4e32\uff0c\u6240\u4ee5\u8fd9\u91cc\u53ea\u8981\u5224\u65ad\u4e0d\u4e3anull\u5c31\u884c\u3002\n\u5176\u4ed6\u5730\u65b9\u4e5f\u4e00\u6837\u3002", "author": "wangliang181230", "createdAt": "2020-10-15T06:35:11Z", "path": "integration/grpc/src/main/java/io/seata/integration/grpc/interceptor/client/ClientTransactionInterceptor.java", "diffHunk": "@@ -43,7 +42,7 @@\n \n             @Override\n             public void start(Listener<RespT> responseListener, Metadata headers) {\n-                if (StringUtils.isNotBlank(xid)) {\n+                if (xid != null) {", "originalCommit": "e4bdcf0604fc1f2459e308a798c10cb2a3b5600d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTIwNzMwOA==", "url": "https://github.com/seata/seata/pull/3195#discussion_r505207308", "bodyText": "boolean unbindXid\u53c2\u6570\u4e3afalse\u65f6\uff0c\u8ddf\u6ca1\u8c03\u7528\u6b64\u65b9\u6cd5\u4e00\u4e2a\u6837\uff0c\u8be5\u53c2\u6570\u53c8\u662f\u7531\u8c03\u7528\u65b9\u4f20\u7684\uff0c\u800c\u4e14\u4f20false\u8ddf\u6ca1\u6709\u6267\u884c\u8be5\u65b9\u6cd5\u4e00\u4e2a\u6837\uff0c\u90a3\u4e48\u76f4\u63a5\u4e0d\u8c03\u7528\u8fd9\u4e2a\u65b9\u6cd5\u4e0d\u5c31\u597d\u4e86\u561b\u3002\n\u6240\u4ee5\u8fd9\u4e2a\u53c2\u6570\u6ca1\u6709\u4efb\u4f55\u610f\u4e49\u3002\u76f4\u63a5\u79fb\u9664\u6389\u4e86\u3002", "author": "wangliang181230", "createdAt": "2020-10-15T06:38:06Z", "path": "tm/src/main/java/io/seata/tm/api/DefaultGlobalTransaction.java", "diffHunk": "@@ -181,17 +180,16 @@ public void rollback() throws TransactionException {\n     }\n \n     @Override\n-    public SuspendedResourcesHolder suspend(boolean unbindXid) throws TransactionException {\n-        String xid = RootContext.getXID();\n-        if (StringUtils.isNotEmpty(xid) && unbindXid) {\n-            RootContext.unbind();\n+    public SuspendedResourcesHolder suspend() throws TransactionException {", "originalCommit": "e4bdcf0604fc1f2459e308a798c10cb2a3b5600d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTIwODE4Mw==", "url": "https://github.com/seata/seata/pull/3195#discussion_r505208183", "bodyText": "suspendedResourcesHolder.getXid()\u6539\u6210\u80af\u5b9a\u4e0d\u4e3a\u7a7a\u4e86\u3002\n\u6240\u4ee5\u8fd9\u91cc\u4e0d\u9700\u8981\u518d\u5224\u65ad\u7a7a\u503c\u4e86\u3002", "author": "wangliang181230", "createdAt": "2020-10-15T06:39:06Z", "path": "tm/src/main/java/io/seata/tm/api/DefaultGlobalTransaction.java", "diffHunk": "@@ -200,11 +198,9 @@ public void resume(SuspendedResourcesHolder suspendedResourcesHolder) throws Tra\n             return;\n         }\n         String xid = suspendedResourcesHolder.getXid();\n-        if (StringUtils.isNotEmpty(xid)) {\n-            RootContext.bind(xid);\n-            if (LOGGER.isDebugEnabled()) {\n-                LOGGER.debug(\"Resumimg the transaction,xid = {}\", xid);\n-            }\n+        RootContext.bind(xid);", "originalCommit": "e4bdcf0604fc1f2459e308a798c10cb2a3b5600d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "605bc49d6555082bb28babcd01b893fa12eec108", "url": "https://github.com/seata/seata/commit/605bc49d6555082bb28babcd01b893fa12eec108", "message": "Merge branch 'develop' into optimize-get-xid", "committedDate": "2020-10-17T10:47:31Z", "type": "commit"}]}