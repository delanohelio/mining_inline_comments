{"pr_number": 8644, "pr_title": "StrictHttpFirewall: Validate headers and parameters", "pr_createdAt": "2020-06-03T18:12:55Z", "pr_url": "https://github.com/spring-projects/spring-security/pull/8644", "timeline": [{"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDQxMzUwMA==", "url": "https://github.com/spring-projects/spring-security/pull/8644#discussion_r444413500", "bodyText": "I don't think we want to actually do the testing at this point. Could you return an enumeration that checks the names as they are returned?", "author": "jzheaux", "createdAt": "2020-06-23T18:08:59Z", "path": "web/src/main/java/org/springframework/security/web/firewall/StrictHttpFirewall.java", "diffHunk": "@@ -370,6 +474,123 @@ public FirewalledRequest getFirewalledRequest(HttpServletRequest request) throws\n \t\t\tthrow new RequestRejectedException(\"The requestURI was rejected because it can only contain printable ASCII characters.\");\n \t\t}\n \t\treturn new FirewalledRequest(request) {\n+\t\t\t@Override\n+\t\t\tpublic long getDateHeader(String name) {\n+\t\t\t\tif (!allowedHeaderNames.test(name)) {\n+\t\t\t\t\tthrow new RequestRejectedException(\"The request was rejected because the header name \\\"\" + name + \"\\\" is not allowed.\");\n+\t\t\t\t}\n+\t\t\t\treturn super.getDateHeader(name);\n+\t\t\t}\n+\n+\t\t\t@Override\n+\t\t\tpublic int getIntHeader(String name) {\n+\t\t\t\tif (!allowedHeaderNames.test(name)) {\n+\t\t\t\t\tthrow new RequestRejectedException(\"The request was rejected because the header name \\\"\" + name + \"\\\" is not allowed.\");\n+\t\t\t\t}\n+\t\t\t\treturn super.getIntHeader(name);\n+\t\t\t}\n+\n+\t\t\t@Override\n+\t\t\tpublic String getHeader(String name) {\n+\t\t\t\tif (!allowedHeaderNames.test(name)) {\n+\t\t\t\t\tthrow new RequestRejectedException(\"The request was rejected because the header name \\\"\" + name + \"\\\" is not allowed.\");\n+\t\t\t\t}\n+\t\t\t\tString value = super.getHeader(name);\n+\t\t\t\tif (value != null && !allowedHeaderValues.test(value)) {\n+\t\t\t\t\tthrow new RequestRejectedException(\"The request was rejected because the header value \\\"\" + value + \"\\\" is not allowed.\");\n+\t\t\t\t}\n+\t\t\t\treturn value;\n+\t\t\t}\n+\n+\t\t\t@Override\n+\t\t\tpublic Enumeration<String> getHeaders(String name) {\n+\t\t\t\tif (!allowedHeaderNames.test(name)) {\n+\t\t\t\t\tthrow new RequestRejectedException(\"The request was rejected because the header name \\\"\" + name + \"\\\" is not allowed.\");\n+\t\t\t\t}\n+\t\t\t\tEnumeration<String> valuesEnumeration = super.getHeaders(name);\n+\t\t\t\tif (valuesEnumeration != null) {\n+\t\t\t\t\twhile (valuesEnumeration.hasMoreElements()) {\n+\t\t\t\t\t\tString value = valuesEnumeration.nextElement();\n+\t\t\t\t\t\tif (!allowedHeaderValues.test(value)) {\n+\t\t\t\t\t\t\tthrow new RequestRejectedException(\"The request was rejected because the header value \\\"\" + value + \"\\\" is not allowed.\");\n+\t\t\t\t\t\t}\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\t\t\t\treturn super.getHeaders(name);\n+\t\t\t}\n+\n+\t\t\t@Override\n+\t\t\tpublic Enumeration<String> getHeaderNames() {\n+\t\t\t\tEnumeration<String> namesEnumeration = super.getHeaderNames();\n+\t\t\t\tif (namesEnumeration != null) {\n+\t\t\t\t\twhile (namesEnumeration.hasMoreElements()) {\n+\t\t\t\t\t\tString name = namesEnumeration.nextElement();\n+\t\t\t\t\t\tif (!allowedHeaderNames.test(name)) {\n+\t\t\t\t\t\t\tthrow new RequestRejectedException(\"The request was rejected because the header name \\\"\" + name + \"\\\" is not allowed.\");\n+\t\t\t\t\t\t}\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\t\t\t\treturn super.getHeaderNames();\n+\t\t\t}\n+\n+\t\t\t@Override\n+\t\t\tpublic String getParameter(String name) {\n+\t\t\t\tif (!allowedParameterNames.test(name)) {\n+\t\t\t\t\tthrow new RequestRejectedException(\"The request was rejected because the parameter name \\\"\" + name + \"\\\" is not allowed.\");\n+\t\t\t\t}\n+\t\t\t\tString value = super.getParameter(name);\n+\t\t\t\tif (value != null && !allowedParameterValues.test(value)) {\n+\t\t\t\t\tthrow new RequestRejectedException(\"The request was rejected because the parameter value \\\"\" + value + \"\\\" is not allowed.\");\n+\t\t\t\t}\n+\t\t\t\treturn value;\n+\t\t\t}\n+\n+\t\t\t@Override\n+\t\t\tpublic Map<String, String[]> getParameterMap() {\n+\t\t\t\tMap<String, String[]> parameterMap = super.getParameterMap();\n+\t\t\t\tfor (Map.Entry<String, String[]> entry : parameterMap.entrySet()) {\n+\t\t\t\t\tString name = entry.getKey();\n+\t\t\t\t\tString[] values = entry.getValue();\n+\t\t\t\t\tif (!allowedParameterNames.test(name)) {\n+\t\t\t\t\t\tthrow new RequestRejectedException(\"The request was rejected because the parameter name \\\"\" + name + \"\\\" is not allowed.\");\n+\t\t\t\t\t}\n+\t\t\t\t\tfor (String value: values) {\n+\t\t\t\t\t\tif (!allowedParameterValues.test(value)) {\n+\t\t\t\t\t\t\tthrow new RequestRejectedException(\"The request was rejected because the parameter value \\\"\" + value + \"\\\" is not allowed.\");\n+\t\t\t\t\t\t}\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\t\t\t\treturn parameterMap;\n+\t\t\t}\n+\n+\t\t\t@Override\n+\t\t\tpublic Enumeration<String> getParameterNames() {\n+\t\t\t\tEnumeration<String> namesEnumeration = super.getParameterNames();\n+\t\t\t\twhile (namesEnumeration.hasMoreElements()) {\n+\t\t\t\t\tString name = namesEnumeration.nextElement();\n+\t\t\t\t\tif (!allowedParameterNames.test(name)) {", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDQ4NDA1OQ==", "url": "https://github.com/spring-projects/spring-security/pull/8644#discussion_r444484059", "bodyText": "Certainly. Done here and in other places where an Enumeration is returned.\nLazily testing the map returned by getParameterMap seems quite complicated and not really worth it, so I'm still eagerly testing there. If you'd like to see a different approach there, please let me know.", "author": "candrews", "createdAt": "2020-06-23T20:21:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDQxMzUwMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDQxNDkzMQ==", "url": "https://github.com/spring-projects/spring-security/pull/8644#discussion_r444414931", "bodyText": "It's a bit odd that this private method is in the middle of the methods you added. Is there a reason for that?", "author": "jzheaux", "createdAt": "2020-06-23T18:11:35Z", "path": "web/src/main/java/org/springframework/security/web/firewall/StrictHttpFirewall.java", "diffHunk": "@@ -350,11 +381,84 @@ private void urlBlocklistsAddAll(Collection<String> values) {\n \t\tthis.decodedUrlBlocklist.addAll(values);\n \t}\n \n+\t/**\n+\t * <p>\n+\t * Determines which header names should be allowed.\n+\t * The default is to reject header names that contain ISO control characters\n+\t * and characters that are not defined.\n+\t * </p>\n+\t *\n+\t * @param allowedHeaderNames the predicate for testing header names\n+\t * @see Character#isISOControl(int)\n+\t * @see Character#isDefined(int)\n+\t * @since 5.4\n+\t */\n+\tpublic void setAllowedHeaderNames(Predicate<String> allowedHeaderNames) {\n+\t\tif (allowedHeaderNames == null) {\n+\t\t\tthrow new IllegalArgumentException(\"allowedHeaderNames cannot be null\");\n+\t\t}\n+\t\tthis.allowedHeaderNames = allowedHeaderNames;\n+\t}\n+\n+\t/**\n+\t * <p>\n+\t * Determines which header values should be allowed.\n+\t * The default is to reject header values that contain ISO control characters\n+\t * and characters that are not defined.\n+\t * </p>\n+\t *\n+\t * @param allowedHeaderValues the predicate for testing hostnames\n+\t * @see Character#isISOControl(int)\n+\t * @see Character#isDefined(int)\n+\t * @since 5.4\n+\t */\n+\tpublic void setAllowedHeaderValues(Predicate<String> allowedHeaderValues) {\n+\t\tif (allowedHeaderValues == null) {\n+\t\t\tthrow new IllegalArgumentException(\"allowedHeaderValues cannot be null\");\n+\t\t}\n+\t\tthis.allowedHeaderValues = allowedHeaderValues;\n+\t}\n+\n \tprivate void urlBlocklistsRemoveAll(Collection<String> values) {", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDQxODA4NA==", "url": "https://github.com/spring-projects/spring-security/pull/8644#discussion_r444418084", "bodyText": "It doesn't make sense to me that you'd call setAllowedHostnames here since you are testing parameter values.", "author": "jzheaux", "createdAt": "2020-06-23T18:17:19Z", "path": "web/src/test/java/org/springframework/security/web/firewall/StrictHttpFirewallTests.java", "diffHunk": "@@ -595,4 +597,38 @@ public void getFirewalledRequestWhenUntrustedDomainThenException() {\n \n \t\tthis.firewall.getFirewalledRequest(this.request);\n \t}\n+\n+\t@Test(expected = RequestRejectedException.class)\n+\tpublic void getFirewalledRequestWhenControlCharacterInHeaderNameThenException() {\n+\t\tthis.request.addHeader(\"Bad\\0Name\", \"some value\");\n+\n+\t\tHttpServletRequest request = this.firewall.getFirewalledRequest(this.request);\n+\t\trequest.getHeaderNames();\n+\t}\n+\n+\t@Test(expected = RequestRejectedException.class)\n+\tpublic void getFirewalledRequestWhenControlCharacterInHeaderValueThenException() {\n+\t\tthis.request.addHeader(\"Something\", \"bad\\0value\");\n+\n+\t\tHttpServletRequest request = this.firewall.getFirewalledRequest(this.request);\n+\t\trequest.getHeader(\"Something\");\n+\t}\n+\n+\t@Test(expected = RequestRejectedException.class)\n+\tpublic void getFirewalledRequestWhenControlCharacterInParameterNameThenException() {\n+\t\tthis.request.addParameter(\"Bad\\0Name\", \"some value\");\n+\n+\t\tHttpServletRequest request = this.firewall.getFirewalledRequest(this.request);\n+\t\trequest.getParameterNames();\n+\t}\n+\n+\t@Test(expected = RequestRejectedException.class)\n+\tpublic void getFirewalledRequestWhenNotAllowedInParameterValueThenException() {\n+\t\tthis.firewall.setAllowedHostnames(value -> value.equals(\"bad value\"));", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDQ4Mzk3Mw==", "url": "https://github.com/spring-projects/spring-security/pull/8644#discussion_r444483973", "bodyText": "Agreed, fixed.", "author": "candrews", "createdAt": "2020-06-23T20:21:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDQxODA4NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDQxODY2MQ==", "url": "https://github.com/spring-projects/spring-security/pull/8644#discussion_r444418661", "bodyText": "Would you please add more tests to confirm that the different setters work? It would also be nice to confirm that the different request getters, e.g. getParameter, correctly reject a bad parameter name.", "author": "jzheaux", "createdAt": "2020-06-23T18:18:27Z", "path": "web/src/test/java/org/springframework/security/web/firewall/StrictHttpFirewallTests.java", "diffHunk": "@@ -595,4 +597,38 @@ public void getFirewalledRequestWhenUntrustedDomainThenException() {\n \n \t\tthis.firewall.getFirewalledRequest(this.request);\n \t}\n+\n+\t@Test(expected = RequestRejectedException.class)\n+\tpublic void getFirewalledRequestWhenControlCharacterInHeaderNameThenException() {\n+\t\tthis.request.addHeader(\"Bad\\0Name\", \"some value\");\n+\n+\t\tHttpServletRequest request = this.firewall.getFirewalledRequest(this.request);\n+\t\trequest.getHeaderNames();\n+\t}\n+\n+\t@Test(expected = RequestRejectedException.class)\n+\tpublic void getFirewalledRequestWhenControlCharacterInHeaderValueThenException() {\n+\t\tthis.request.addHeader(\"Something\", \"bad\\0value\");\n+\n+\t\tHttpServletRequest request = this.firewall.getFirewalledRequest(this.request);\n+\t\trequest.getHeader(\"Something\");\n+\t}\n+\n+\t@Test(expected = RequestRejectedException.class)\n+\tpublic void getFirewalledRequestWhenControlCharacterInParameterNameThenException() {\n+\t\tthis.request.addParameter(\"Bad\\0Name\", \"some value\");\n+\n+\t\tHttpServletRequest request = this.firewall.getFirewalledRequest(this.request);\n+\t\trequest.getParameterNames();\n+\t}\n+\n+\t@Test(expected = RequestRejectedException.class)\n+\tpublic void getFirewalledRequestWhenNotAllowedInParameterValueThenException() {", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDQ4NTEwNg==", "url": "https://github.com/spring-projects/spring-security/pull/8644#discussion_r444485106", "bodyText": "Absolutely! I've added a number of tests that I believe address this request.", "author": "candrews", "createdAt": "2020-06-23T20:23:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDQxODY2MQ=="}], "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDU1NDg5Nw==", "url": "https://github.com/spring-projects/spring-security/pull/8644#discussion_r444554897", "bodyText": "Will you please move these so that they are next to the other public setters?", "author": "jzheaux", "createdAt": "2020-06-23T23:03:26Z", "path": "web/src/main/java/org/springframework/security/web/firewall/StrictHttpFirewall.java", "diffHunk": "@@ -355,6 +386,79 @@ private void urlBlocklistsRemoveAll(Collection<String> values) {\n \t\tthis.decodedUrlBlocklist.removeAll(values);\n \t}\n \n+\t/**\n+\t * <p>\n+\t * Determines which header names should be allowed.\n+\t * The default is to reject header names that contain ISO control characters\n+\t * and characters that are not defined.\n+\t * </p>\n+\t *\n+\t * @param allowedHeaderNames the predicate for testing header names\n+\t * @see Character#isISOControl(int)\n+\t * @see Character#isDefined(int)\n+\t * @since 5.4\n+\t */\n+\tpublic void setAllowedHeaderNames(Predicate<String> allowedHeaderNames) {", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDU4ODI3OQ==", "url": "https://github.com/spring-projects/spring-security/pull/8644#discussion_r444588279", "bodyText": "Done \ud83d\udc4d", "author": "candrews", "createdAt": "2020-06-24T01:05:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDU1NDg5Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDU1NTUwMA==", "url": "https://github.com/spring-projects/spring-security/pull/8644#discussion_r444555500", "bodyText": "Thank you for these tests - will you please add some additional testing around the regular expression? Specifically, I think there should be a test that shows that the firewall requests a header name, a header value, and a parameter name with a control character and with an undefined character.", "author": "jzheaux", "createdAt": "2020-06-23T23:05:16Z", "path": "web/src/test/java/org/springframework/security/web/firewall/StrictHttpFirewallTests.java", "diffHunk": "@@ -595,4 +597,121 @@ public void getFirewalledRequestWhenUntrustedDomainThenException() {\n \n \t\tthis.firewall.getFirewalledRequest(this.request);\n \t}\n+\n+\t@Test(expected = RequestRejectedException.class)\n+\tpublic void getFirewalledRequestGetHeaderWhenNotAllowedHeaderNameThenException() {\n+\t\tthis.firewall.setAllowedHeaderNames(name -> !name.equals(\"bad name\"));\n+\n+\t\tHttpServletRequest request = this.firewall.getFirewalledRequest(this.request);\n+\t\trequest.getHeader(\"bad name\");\n+\t}\n+\n+\t@Test(expected = RequestRejectedException.class)\n+\tpublic void getFirewalledRequestGetHeaderWhenNotAllowedHeaderValueThenException() {\n+\t\tthis.request.addHeader(\"good name\", \"bad value\");\n+\t\tthis.firewall.setAllowedHeaderValues(value -> !value.equals(\"bad value\"));\n+\n+\t\tHttpServletRequest request = this.firewall.getFirewalledRequest(this.request);\n+\t\trequest.getHeader(\"good name\");\n+\t}\n+\n+\t@Test(expected = RequestRejectedException.class)\n+\tpublic void getFirewalledRequestGetDateHeaderWhenControlCharacterInHeaderNameThenException() {\n+\t\tthis.request.addHeader(\"Bad\\0Name\", \"some value\");\n+\n+\t\tHttpServletRequest request = this.firewall.getFirewalledRequest(this.request);\n+\t\trequest.getDateHeader(\"Bad\\0Name\");\n+\t}\n+\n+\t@Test(expected = RequestRejectedException.class)\n+\tpublic void getFirewalledRequestGetIntHeaderWhenControlCharacterInHeaderNameThenException() {\n+\t\tthis.request.addHeader(\"Bad\\0Name\", \"some value\");\n+\n+\t\tHttpServletRequest request = this.firewall.getFirewalledRequest(this.request);\n+\t\trequest.getIntHeader(\"Bad\\0Name\");\n+\t}\n+\n+\t@Test(expected = RequestRejectedException.class)\n+\tpublic void getFirewalledRequestGetHeaderWhenControlCharacterInHeaderNameThenException() {\n+\t\tthis.request.addHeader(\"Bad\\0Name\", \"some value\");\n+\n+\t\tHttpServletRequest request = this.firewall.getFirewalledRequest(this.request);\n+\t\trequest.getHeader(\"Bad\\0Name\");\n+\t}\n+\n+\t@Test(expected = RequestRejectedException.class)\n+\tpublic void getFirewalledRequestGetHeadersWhenControlCharacterInHeaderNameThenException() {\n+\t\tthis.request.addHeader(\"Bad\\0Name\", \"some value\");\n+\n+\t\tHttpServletRequest request = this.firewall.getFirewalledRequest(this.request);\n+\t\trequest.getHeaders(\"Bad\\0Name\");\n+\t}\n+\n+\t@Test(expected = RequestRejectedException.class)\n+\tpublic void getFirewalledRequestGetHeaderNamesWhenControlCharacterInHeaderNameThenException() {\n+\t\tthis.request.addHeader(\"Bad\\0Name\", \"some value\");\n+\n+\t\tHttpServletRequest request = this.firewall.getFirewalledRequest(this.request);\n+\t\trequest.getHeaderNames().nextElement();\n+\t}\n+\n+\t@Test(expected = RequestRejectedException.class)\n+\tpublic void getFirewalledRequestGetHeaderWhenControlCharacterInHeaderValueThenException() {\n+\t\tthis.request.addHeader(\"Something\", \"bad\\0value\");\n+\n+\t\tHttpServletRequest request = this.firewall.getFirewalledRequest(this.request);\n+\t\trequest.getHeader(\"Something\");\n+\t}\n+\n+\t@Test(expected = RequestRejectedException.class)\n+\tpublic void getFirewalledRequestGetHeadersWhenControlCharacterInHeaderValueThenException() {\n+\t\tthis.request.addHeader(\"Something\", \"bad\\0value\");\n+\n+\t\tHttpServletRequest request = this.firewall.getFirewalledRequest(this.request);\n+\t\trequest.getHeaders(\"Something\").nextElement();\n+\t}\n+\n+\t@Test(expected = RequestRejectedException.class)\n+\tpublic void getFirewalledRequestGetParameterWhenControlCharacterInParameterNameThenException() {", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDU4ODIzNw==", "url": "https://github.com/spring-projects/spring-security/pull/8644#discussion_r444588237", "bodyText": "I already had tests for control characters in a header name, a header value, and a parameter name; I added tests for undefined characters for those 3 cases as well.", "author": "candrews", "createdAt": "2020-06-24T01:05:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDU1NTUwMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDU1NTc1Mg==", "url": "https://github.com/spring-projects/spring-security/pull/8644#discussion_r444555752", "bodyText": "I think you mean here \"The default is to allow any parameter value.\"", "author": "jzheaux", "createdAt": "2020-06-23T23:06:04Z", "path": "web/src/main/java/org/springframework/security/web/firewall/StrictHttpFirewall.java", "diffHunk": "@@ -355,6 +386,79 @@ private void urlBlocklistsRemoveAll(Collection<String> values) {\n \t\tthis.decodedUrlBlocklist.removeAll(values);\n \t}\n \n+\t/**\n+\t * <p>\n+\t * Determines which header names should be allowed.\n+\t * The default is to reject header names that contain ISO control characters\n+\t * and characters that are not defined.\n+\t * </p>\n+\t *\n+\t * @param allowedHeaderNames the predicate for testing header names\n+\t * @see Character#isISOControl(int)\n+\t * @see Character#isDefined(int)\n+\t * @since 5.4\n+\t */\n+\tpublic void setAllowedHeaderNames(Predicate<String> allowedHeaderNames) {\n+\t\tif (allowedHeaderNames == null) {\n+\t\t\tthrow new IllegalArgumentException(\"allowedHeaderNames cannot be null\");\n+\t\t}\n+\t\tthis.allowedHeaderNames = allowedHeaderNames;\n+\t}\n+\n+\t/**\n+\t * <p>\n+\t * Determines which header values should be allowed.\n+\t * The default is to reject header values that contain ISO control characters\n+\t * and characters that are not defined.\n+\t * </p>\n+\t *\n+\t * @param allowedHeaderValues the predicate for testing hostnames\n+\t * @see Character#isISOControl(int)\n+\t * @see Character#isDefined(int)\n+\t * @since 5.4\n+\t */\n+\tpublic void setAllowedHeaderValues(Predicate<String> allowedHeaderValues) {\n+\t\tif (allowedHeaderValues == null) {\n+\t\t\tthrow new IllegalArgumentException(\"allowedHeaderValues cannot be null\");\n+\t\t}\n+\t\tthis.allowedHeaderValues = allowedHeaderValues;\n+\t}\n+\n+\t/**\n+\t * <p>\n+\t * Determines which parameter names should be allowed.\n+\t * The default is to reject header names that contain ISO control characters\n+\t * and characters that are not defined.\n+\t * </p>\n+\t *\n+\t * @param allowedParameterNames the predicate for testing parameter names\n+\t * @see Character#isISOControl(int)\n+\t * @see Character#isDefined(int)\n+\t * @since 5.4\n+\t */\n+\tpublic void setAllowedParameterNames(Predicate<String> allowedParameterNames) {\n+\t\tif (allowedParameterNames == null) {\n+\t\t\tthrow new IllegalArgumentException(\"allowedParameterNames cannot be null\");\n+\t\t}\n+\t\tthis.allowedParameterNames = allowedParameterNames;\n+\t}\n+\n+\t/**\n+\t * <p>\n+\t * Determines which parameter values should be allowed.\n+\t * The default is to any parameter value.", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDU4ODI1NQ==", "url": "https://github.com/spring-projects/spring-security/pull/8644#discussion_r444588255", "bodyText": "\ud83d\udc4d", "author": "candrews", "createdAt": "2020-06-24T01:05:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDU1NTc1Mg=="}], "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": "dfa92347e68885ae281f7bee129411aa7b552713", "url": "https://github.com/spring-projects/spring-security/commit/dfa92347e68885ae281f7bee129411aa7b552713", "message": "Validate headers and parameters in StrictHttpFirewall\n\nAdds methods to configure validation of header names and values and\nparameter names and values:\n * setAllowedHeaderNames(Predicate)\n * setAllowedHeaderValues(Predicate)\n * setAllowedParameterNames(Predicate)\n * setAllowedParameterValues(Predicate)\n\nBy default, header names, header values, and parameter names that\ncontain ISO control characters or unassigned unicode characters are\nrejected. No parameter value validation is performed by default.\n\nIssue gh-8644", "committedDate": "2020-06-24T01:51:33Z", "type": "commit"}, {"oid": "dfa92347e68885ae281f7bee129411aa7b552713", "url": "https://github.com/spring-projects/spring-security/commit/dfa92347e68885ae281f7bee129411aa7b552713", "message": "Validate headers and parameters in StrictHttpFirewall\n\nAdds methods to configure validation of header names and values and\nparameter names and values:\n * setAllowedHeaderNames(Predicate)\n * setAllowedHeaderValues(Predicate)\n * setAllowedParameterNames(Predicate)\n * setAllowedParameterValues(Predicate)\n\nBy default, header names, header values, and parameter names that\ncontain ISO control characters or unassigned unicode characters are\nrejected. No parameter value validation is performed by default.\n\nIssue gh-8644", "committedDate": "2020-06-24T01:51:33Z", "type": "forcePushed"}]}