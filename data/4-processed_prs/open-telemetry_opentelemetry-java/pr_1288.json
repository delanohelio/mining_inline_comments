{"pr_number": 1288, "pr_title": "Apply platforms to resolved classpaths instead of dependency containe\u2026", "pr_createdAt": "2020-05-29T04:41:19Z", "pr_url": "https://github.com/open-telemetry/opentelemetry-java/pull/1288", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI5MjY4Ng==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1288#discussion_r432292686", "bodyText": "One usually does not add anything directly to XXClasspath configuration. Why is this needed in this case?", "author": "iNikem", "createdAt": "2020-05-29T07:03:15Z", "path": "build.gradle", "diffHunk": "@@ -179,11 +179,14 @@ configure(opentelemetryProjects) {\n     }\n \n     dependencies {\n-\n-        implementation platform(boms.grpc),\n-                platform(boms.guava),\n-                platform(boms.protobuf),\n-                platform(boms.zipkin_reporter)\n+        configurations.all {\n+            if (it.name.endsWith('Classpath')) {", "originalCommit": "f44a791bcb880081b28cd7378529cb408d991eba", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI5NDIxOQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1288#discussion_r432294219", "bodyText": "The classpath configurations are only for resolving dependencies, not publishing them. Since we want to use the BOMs for resolving, not publishing (as we see in the large thread on the other PR ;) ), it makes sense to add them to the classpath configurations instead.\nThis is the recommended approach by Gradle for this use case - gradle/gradle#10861 (comment)", "author": "anuraaga", "createdAt": "2020-05-29T07:06:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI5MjY4Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI5NjU1Mw==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1288#discussion_r432296553", "bodyText": "Isn't it enough to use fromResolutionResult as you did below?", "author": "iNikem", "createdAt": "2020-05-29T07:12:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI5MjY4Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI5NzY3OQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1288#discussion_r432297679", "bodyText": "Nah, at first I thought so too but while working on this realized it's a different topic.\n\n\nfromResolutionResult fills in version numbers for dependencies resolved via bom. So for guava dependency, without it, it would be present but have no version number\n\n\nMoving platform from \"dependency bag\" configurations to classpath configurations. Ensures BOM imports are not added to the published POM which is a good thing to reduce the complexity of the POM, we want the BOMs to resolve the version numbers, not to publish them", "author": "anuraaga", "createdAt": "2020-05-29T07:15:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI5MjY4Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjQwMjY2Nw==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1288#discussion_r432402667", "bodyText": "maybe we should use here forcedPlatform instead of platform what's ur opinion @anuraaga", "author": "DotSpy", "createdAt": "2020-05-29T10:42:46Z", "path": "build.gradle", "diffHunk": "@@ -179,11 +179,14 @@ configure(opentelemetryProjects) {\n     }\n \n     dependencies {\n-\n-        implementation platform(boms.grpc),\n-                platform(boms.guava),\n-                platform(boms.protobuf),\n-                platform(boms.zipkin_reporter)\n+        configurations.all {\n+            if (it.name.endsWith('Classpath')) {\n+                add(it.name, platform(boms.grpc))\n+                add(it.name, platform(boms.guava))\n+                add(it.name, platform(boms.protobuf))\n+                add(it.name, platform(boms.zipkin_reporter))", "originalCommit": "f44a791bcb880081b28cd7378529cb408d991eba", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjQxNjA4NQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1288#discussion_r432416085", "bodyText": "Yeah I usually use enforcedPlatform for this sort of management - switched to it", "author": "anuraaga", "createdAt": "2020-05-29T11:13:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjQwMjY2Nw=="}], "type": "inlineReview"}, {"oid": "13b15a5614c1949f041819ee8942842380767640", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/13b15a5614c1949f041819ee8942842380767640", "message": "Apply platforms to resolved classpaths instead of dependency containers and have maven publication use resolution result for all variants.", "committedDate": "2020-06-01T16:12:57Z", "type": "commit"}, {"oid": "13b15a5614c1949f041819ee8942842380767640", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/13b15a5614c1949f041819ee8942842380767640", "message": "Apply platforms to resolved classpaths instead of dependency containers and have maven publication use resolution result for all variants.", "committedDate": "2020-06-01T16:12:57Z", "type": "forcePushed"}, {"oid": "d76cb5401bf0a70023f0b01c57d89a25e7064258", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/d76cb5401bf0a70023f0b01c57d89a25e7064258", "message": "Revert unintended", "committedDate": "2020-06-01T16:14:26Z", "type": "commit"}]}