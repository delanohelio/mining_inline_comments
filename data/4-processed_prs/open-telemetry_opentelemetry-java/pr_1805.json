{"pr_number": 1805, "pr_title": "Extract an interface for the OpenTelemetry API to later allow an SDK \u2026", "pr_createdAt": "2020-10-15T03:18:05Z", "pr_url": "https://github.com/open-telemetry/opentelemetry-java/pull/1805", "timeline": [{"oid": "fe0883cd8dc16aac34a76929a6a3c155ce5b6caf", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/fe0883cd8dc16aac34a76929a6a3c155ce5b6caf", "message": "Extract an interface for the OpenTelemetry API to later allow an SDK to implement it.", "committedDate": "2020-10-15T03:17:08Z", "type": "commit"}, {"oid": "309d1e7bd8e384654c623fb08a4e2874db001c30", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/309d1e7bd8e384654c623fb08a4e2874db001c30", "message": "Merge branch 'master' of github.com:open-telemetry/opentelemetry-java into opentelemetry-interface", "committedDate": "2020-10-15T03:17:46Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTE0MDUzMQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1805#discussion_r505140531", "bodyText": "Unfortunately the statics can't be named the same as the method name @carlosalberto. So added them with the \"global\" prefix for now.", "author": "anuraaga", "createdAt": "2020-10-15T03:19:19Z", "path": "api/src/main/java/io/opentelemetry/OpenTelemetry.java", "diffHunk": "@@ -5,255 +5,194 @@\n \n package io.opentelemetry;\n \n+import static java.util.Objects.requireNonNull;\n+\n import io.opentelemetry.baggage.BaggageManager;\n-import io.opentelemetry.baggage.DefaultBaggageManager;\n-import io.opentelemetry.baggage.spi.BaggageManagerFactory;\n import io.opentelemetry.context.propagation.ContextPropagators;\n-import io.opentelemetry.context.propagation.DefaultContextPropagators;\n-import io.opentelemetry.internal.Obfuscated;\n-import io.opentelemetry.metrics.DefaultMeterProvider;\n import io.opentelemetry.metrics.Meter;\n import io.opentelemetry.metrics.MeterProvider;\n-import io.opentelemetry.metrics.spi.MeterProviderFactory;\n-import io.opentelemetry.trace.DefaultTracerProvider;\n import io.opentelemetry.trace.Tracer;\n import io.opentelemetry.trace.TracerProvider;\n-import io.opentelemetry.trace.propagation.HttpTraceContext;\n-import io.opentelemetry.trace.spi.TracerProviderFactory;\n-import java.util.Objects;\n-import java.util.ServiceLoader;\n-import javax.annotation.Nullable;\n-import javax.annotation.concurrent.ThreadSafe;\n \n /**\n- * This class provides a static global accessor for telemetry objects {@link Tracer}, {@link Meter}\n- * and {@link BaggageManager}.\n+ * The entrypoint to telemetry functionality for tracing, metrics and baggage.\n  *\n- * <p>The telemetry objects are lazy-loaded singletons resolved via {@link ServiceLoader} mechanism.\n+ * <p>A global singleton can be retrieved by {@link #get()}. The default for the returned {@link\n+ * OpenTelemetry}, will include any {@link io.opentelemetry.trace.spi.TracerProviderFactory}, {@link\n+ * io.opentelemetry.metrics.spi.MeterProviderFactory}, or {@link\n+ * io.opentelemetry.baggage.spi.BaggageManagerFactory} found on the classpath, or otherwise will be\n+ * default, with no-op behavior.\n  *\n  * @see TracerProvider\n- * @see MeterProviderFactory\n- * @see BaggageManagerFactory\n+ * @see MeterProvider\n+ * @see BaggageManager\n  */\n-@ThreadSafe\n-public final class OpenTelemetry {\n-  private static final Object mutex = new Object();\n-\n-  @Nullable private static volatile OpenTelemetry instance;\n-\n-  private final TracerProvider tracerProvider;\n-  private final MeterProvider meterProvider;\n-  private final BaggageManager contextManager;\n-\n-  private volatile ContextPropagators propagators = DefaultContextPropagators.builder().build();\n+public interface OpenTelemetry {\n \n   /**\n-   * Returns a singleton {@link TracerProvider}.\n+   * Returns the registered global {@link OpenTelemetry}, a default {@link OpenTelemetry} composed\n+   * of functionality any {@link io.opentelemetry.trace.spi.TracerProviderFactory}, {@link\n+   * io.opentelemetry.metrics.spi.MeterProviderFactory}, or {@link\n+   * io.opentelemetry.baggage.spi.BaggageManagerFactory} found on the classpath, or otherwise will\n+   * be default, with no-op behavior.\n    *\n-   * @return registered TracerProvider or default via {@link DefaultTracerProvider#getInstance()}.\n-   * @throws IllegalStateException if a specified TracerProvider (via system properties) could not\n-   *     be found.\n+   * @throws IllegalStateException if a provider has been specified by system property using the\n+   *     interface FQCN but the specified provider cannot be found.\n    */\n-  public static TracerProvider getTracerProvider() {\n-    return getInstance().tracerProvider;\n+  static OpenTelemetry get() {\n+    return DefaultOpenTelemetry.getGlobalOpenTelemetry();\n+  }\n+\n+  /** Returns the globally registered {@link TracerProvider}. */\n+  static TracerProvider getGlobalTracerProvider() {", "originalCommit": "309d1e7bd8e384654c623fb08a4e2874db001c30", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjYzNjA3OQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1805#discussion_r506636079", "bodyText": "If I did this change, I would split the renaming in a separate PR, because that is a trivial change. Hard now to look at all changes and determine what is trivial vs what is behavior change.", "author": "bogdandrutu", "createdAt": "2020-10-16T17:55:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTE0MDUzMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjc4NTM5Mg==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1805#discussion_r506785392", "bodyText": "Do you mean making the instance methods something like getInstanceTracerProvider and swapping the names later? That seems like intentionally merging a bad name for a minor improvement in code review - the changes are only to this interface and the class. It's not something I'd generally recommend a contributor to have to do.", "author": "anuraaga", "createdAt": "2020-10-17T02:52:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTE0MDUzMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzUwODQzNA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1805#discussion_r507508434", "bodyText": "Went ahead and renamed the instance methods, still don't think it's a good idea to merge this.", "author": "anuraaga", "createdAt": "2020-10-19T06:45:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTE0MDUzMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTgxNDk5Nw==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1805#discussion_r505814997", "bodyText": "Do we need to expose this on the public interface at this point? Could the callers here just make the call to DefaultOpenTelemetry directly?", "author": "jkwatson", "createdAt": "2020-10-15T20:20:46Z", "path": "api/src/main/java/io/opentelemetry/OpenTelemetry.java", "diffHunk": "@@ -5,255 +5,194 @@\n \n package io.opentelemetry;\n \n+import static java.util.Objects.requireNonNull;\n+\n import io.opentelemetry.baggage.BaggageManager;\n-import io.opentelemetry.baggage.DefaultBaggageManager;\n-import io.opentelemetry.baggage.spi.BaggageManagerFactory;\n import io.opentelemetry.context.propagation.ContextPropagators;\n-import io.opentelemetry.context.propagation.DefaultContextPropagators;\n-import io.opentelemetry.internal.Obfuscated;\n-import io.opentelemetry.metrics.DefaultMeterProvider;\n import io.opentelemetry.metrics.Meter;\n import io.opentelemetry.metrics.MeterProvider;\n-import io.opentelemetry.metrics.spi.MeterProviderFactory;\n-import io.opentelemetry.trace.DefaultTracerProvider;\n import io.opentelemetry.trace.Tracer;\n import io.opentelemetry.trace.TracerProvider;\n-import io.opentelemetry.trace.propagation.HttpTraceContext;\n-import io.opentelemetry.trace.spi.TracerProviderFactory;\n-import java.util.Objects;\n-import java.util.ServiceLoader;\n-import javax.annotation.Nullable;\n-import javax.annotation.concurrent.ThreadSafe;\n \n /**\n- * This class provides a static global accessor for telemetry objects {@link Tracer}, {@link Meter}\n- * and {@link BaggageManager}.\n+ * The entrypoint to telemetry functionality for tracing, metrics and baggage.\n  *\n- * <p>The telemetry objects are lazy-loaded singletons resolved via {@link ServiceLoader} mechanism.\n+ * <p>A global singleton can be retrieved by {@link #get()}. The default for the returned {@link\n+ * OpenTelemetry}, will include any {@link io.opentelemetry.trace.spi.TracerProviderFactory}, {@link\n+ * io.opentelemetry.metrics.spi.MeterProviderFactory}, or {@link\n+ * io.opentelemetry.baggage.spi.BaggageManagerFactory} found on the classpath, or otherwise will be\n+ * default, with no-op behavior.\n  *\n  * @see TracerProvider\n- * @see MeterProviderFactory\n- * @see BaggageManagerFactory\n+ * @see MeterProvider\n+ * @see BaggageManager\n  */\n-@ThreadSafe\n-public final class OpenTelemetry {\n-  private static final Object mutex = new Object();\n-\n-  @Nullable private static volatile OpenTelemetry instance;\n-\n-  private final TracerProvider tracerProvider;\n-  private final MeterProvider meterProvider;\n-  private final BaggageManager contextManager;\n-\n-  private volatile ContextPropagators propagators = DefaultContextPropagators.builder().build();\n+public interface OpenTelemetry {\n \n   /**\n-   * Returns a singleton {@link TracerProvider}.\n+   * Returns the registered global {@link OpenTelemetry}, a default {@link OpenTelemetry} composed\n+   * of functionality any {@link io.opentelemetry.trace.spi.TracerProviderFactory}, {@link\n+   * io.opentelemetry.metrics.spi.MeterProviderFactory}, or {@link\n+   * io.opentelemetry.baggage.spi.BaggageManagerFactory} found on the classpath, or otherwise will\n+   * be default, with no-op behavior.\n    *\n-   * @return registered TracerProvider or default via {@link DefaultTracerProvider#getInstance()}.\n-   * @throws IllegalStateException if a specified TracerProvider (via system properties) could not\n-   *     be found.\n+   * @throws IllegalStateException if a provider has been specified by system property using the\n+   *     interface FQCN but the specified provider cannot be found.\n    */\n-  public static TracerProvider getTracerProvider() {\n-    return getInstance().tracerProvider;\n+  static OpenTelemetry get() {", "originalCommit": "309d1e7bd8e384654c623fb08a4e2874db001c30", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjAwODgxOQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1805#discussion_r506008819", "bodyText": "Oops, thanks for finding where I forgot to remove publicness, cleaned up", "author": "anuraaga", "createdAt": "2020-10-16T02:53:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTgxNDk5Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTgyMDc3Ng==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1805#discussion_r505820776", "bodyText": "The builder methods can be package access at this point, correct?", "author": "jkwatson", "createdAt": "2020-10-15T20:30:16Z", "path": "api/src/main/java/io/opentelemetry/DefaultOpenTelemetry.java", "diffHunk": "@@ -0,0 +1,239 @@\n+/*\n+ * Copyright The OpenTelemetry Authors\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+\n+package io.opentelemetry;\n+\n+import static java.util.Objects.requireNonNull;\n+\n+import io.opentelemetry.baggage.BaggageManager;\n+import io.opentelemetry.baggage.DefaultBaggageManager;\n+import io.opentelemetry.baggage.spi.BaggageManagerFactory;\n+import io.opentelemetry.context.propagation.ContextPropagators;\n+import io.opentelemetry.context.propagation.DefaultContextPropagators;\n+import io.opentelemetry.internal.Obfuscated;\n+import io.opentelemetry.metrics.DefaultMeterProvider;\n+import io.opentelemetry.metrics.Meter;\n+import io.opentelemetry.metrics.MeterProvider;\n+import io.opentelemetry.metrics.spi.MeterProviderFactory;\n+import io.opentelemetry.trace.DefaultTracerProvider;\n+import io.opentelemetry.trace.Tracer;\n+import io.opentelemetry.trace.TracerProvider;\n+import io.opentelemetry.trace.spi.TracerProviderFactory;\n+import java.util.ServiceLoader;\n+import javax.annotation.Nullable;\n+import javax.annotation.concurrent.ThreadSafe;\n+\n+/**\n+ * This class provides a static global accessor for telemetry objects {@link Tracer}, {@link Meter}\n+ * and {@link BaggageManager}.\n+ *\n+ * <p>The telemetry objects are lazy-loaded singletons resolved via {@link ServiceLoader} mechanism.\n+ *\n+ * @see TracerProvider\n+ * @see MeterProviderFactory\n+ * @see BaggageManagerFactory\n+ */\n+@ThreadSafe\n+class DefaultOpenTelemetry implements OpenTelemetry {\n+  private static final Object mutex = new Object();\n+\n+  static OpenTelemetry getGlobalOpenTelemetry() {\n+    if (globalOpenTelemetry == null) {\n+      synchronized (mutex) {\n+        if (globalOpenTelemetry == null) {\n+          globalOpenTelemetry = DefaultOpenTelemetry.builder().build();\n+        }\n+      }\n+    }\n+    return globalOpenTelemetry;\n+  }\n+\n+  static void setGlobalOpenTelemetry(OpenTelemetry openTelemetry) {\n+    globalOpenTelemetry = openTelemetry;\n+  }\n+\n+  static Builder builder() {\n+    return new Builder();\n+  }\n+\n+  @Nullable private static volatile OpenTelemetry globalOpenTelemetry;\n+\n+  private final TracerProvider tracerProvider;\n+  private final MeterProvider meterProvider;\n+  private final BaggageManager baggageManager;\n+\n+  private volatile ContextPropagators propagators = DefaultContextPropagators.builder().build();\n+\n+  @Override\n+  public TracerProvider getTracerProvider() {\n+    return tracerProvider;\n+  }\n+\n+  @Override\n+  public MeterProvider getMeterProvider() {\n+    return meterProvider;\n+  }\n+\n+  @Override\n+  public BaggageManager getBaggageManager() {\n+    return baggageManager;\n+  }\n+\n+  @Override\n+  public ContextPropagators getPropagators() {\n+    return propagators;\n+  }\n+\n+  void setPropagators(ContextPropagators propagators) {\n+    this.propagators = propagators;\n+  }\n+\n+  DefaultOpenTelemetry(\n+      TracerProvider tracerProvider,\n+      MeterProvider meterProvider,\n+      BaggageManager baggageManager,\n+      ContextPropagators propagators) {\n+    this.tracerProvider = tracerProvider;\n+    this.meterProvider = meterProvider;\n+    this.baggageManager = baggageManager;\n+    this.propagators = propagators;\n+  }\n+\n+  /**\n+   * Load provider class via {@link ServiceLoader}. A specific provider class can be requested via\n+   * setting a system property with FQCN.\n+   *\n+   * @param providerClass a provider class\n+   * @param <T> provider type\n+   * @return a provider or null if not found\n+   * @throws IllegalStateException if a specified provider is not found\n+   */\n+  @Nullable\n+  private static <T> T loadSpi(Class<T> providerClass) {\n+    String specifiedProvider = System.getProperty(providerClass.getName());\n+    ServiceLoader<T> providers = ServiceLoader.load(providerClass);\n+    for (T provider : providers) {\n+      if (specifiedProvider == null || specifiedProvider.equals(provider.getClass().getName())) {\n+        return provider;\n+      }\n+    }\n+    if (specifiedProvider != null) {\n+      throw new IllegalStateException(\n+          String.format(\"Service provider %s not found\", specifiedProvider));\n+    }\n+    return null;\n+  }\n+\n+  // for testing\n+  static void reset() {\n+    globalOpenTelemetry = null;\n+  }\n+\n+  public Builder toBuilder() {", "originalCommit": "309d1e7bd8e384654c623fb08a4e2874db001c30", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTg4ODcwMw==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1805#discussion_r505888703", "bodyText": "this will probably be something we want to inject, rather than grabbing it globally. follow-on PRs are fine.", "author": "jkwatson", "createdAt": "2020-10-15T21:59:20Z", "path": "sdk_extensions/logging/src/main/java/io/opentelemetry/sdk/logging/export/BatchLogProcessor.java", "diffHunk": "@@ -70,7 +70,7 @@ public CompletableResultCode forceFlush() {\n \n   private static class Worker implements Runnable {\n     static {\n-      Meter meter = OpenTelemetry.getMeter(\"io.opentelemetry.sdk.logging\");\n+      Meter meter = OpenTelemetry.getGlobalMeter(\"io.opentelemetry.sdk.logging\");", "originalCommit": "309d1e7bd8e384654c623fb08a4e2874db001c30", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTg4OTI5Mg==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1805#discussion_r505889292", "bodyText": "another case where we'll want to inject a MeterProvider, probably?", "author": "jkwatson", "createdAt": "2020-10-15T22:00:50Z", "path": "sdk/tracing/src/main/java/io/opentelemetry/sdk/trace/export/BatchSpanProcessor.java", "diffHunk": "@@ -133,7 +133,7 @@ public CompletableResultCode forceFlush() {\n   private static final class Worker implements Runnable {\n \n     static {\n-      Meter meter = OpenTelemetry.getMeter(\"io.opentelemetry.sdk.trace\");\n+      Meter meter = OpenTelemetry.getGlobalMeter(\"io.opentelemetry.sdk.trace\");", "originalCommit": "309d1e7bd8e384654c623fb08a4e2874db001c30", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "466babca14cd8f9fd0c4c6ad67f5314111cadc45", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/466babca14cd8f9fd0c4c6ad67f5314111cadc45", "message": "Merge branch 'master' of github.com:open-telemetry/opentelemetry-java into opentelemetry-interface", "committedDate": "2020-10-16T02:36:59Z", "type": "commit"}, {"oid": "824a8e1b83a20b7f57daa9ccce54eab49483a9ba", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/824a8e1b83a20b7f57daa9ccce54eab49483a9ba", "message": "Cleanups", "committedDate": "2020-10-16T02:53:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjYzNTE5Mw==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1805#discussion_r506635193", "bodyText": "final?", "author": "bogdandrutu", "createdAt": "2020-10-16T17:53:43Z", "path": "api/src/main/java/io/opentelemetry/DefaultOpenTelemetry.java", "diffHunk": "@@ -0,0 +1,235 @@\n+/*\n+ * Copyright The OpenTelemetry Authors\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+\n+package io.opentelemetry;\n+\n+import static java.util.Objects.requireNonNull;\n+\n+import io.opentelemetry.baggage.BaggageManager;\n+import io.opentelemetry.baggage.DefaultBaggageManager;\n+import io.opentelemetry.baggage.spi.BaggageManagerFactory;\n+import io.opentelemetry.context.propagation.ContextPropagators;\n+import io.opentelemetry.context.propagation.DefaultContextPropagators;\n+import io.opentelemetry.internal.Obfuscated;\n+import io.opentelemetry.metrics.DefaultMeterProvider;\n+import io.opentelemetry.metrics.Meter;\n+import io.opentelemetry.metrics.MeterProvider;\n+import io.opentelemetry.metrics.spi.MeterProviderFactory;\n+import io.opentelemetry.trace.DefaultTracerProvider;\n+import io.opentelemetry.trace.Tracer;\n+import io.opentelemetry.trace.TracerProvider;\n+import io.opentelemetry.trace.spi.TracerProviderFactory;\n+import java.util.ServiceLoader;\n+import javax.annotation.Nullable;\n+import javax.annotation.concurrent.ThreadSafe;\n+\n+/**\n+ * This class provides a static global accessor for telemetry objects {@link Tracer}, {@link Meter}\n+ * and {@link BaggageManager}.\n+ *\n+ * <p>The telemetry objects are lazy-loaded singletons resolved via {@link ServiceLoader} mechanism.\n+ *\n+ * @see TracerProvider\n+ * @see MeterProviderFactory\n+ * @see BaggageManagerFactory\n+ */\n+@ThreadSafe\n+class DefaultOpenTelemetry implements OpenTelemetry {", "originalCommit": "824a8e1b83a20b7f57daa9ccce54eab49483a9ba", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "924966e58733676c7c3c7e414c30a3e750b0daae", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/924966e58733676c7c3c7e414c30a3e750b0daae", "message": "mine", "committedDate": "2020-10-19T06:45:01Z", "type": "commit"}, {"oid": "45470ef11a17837725ec4ec51b94272731aff0c2", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/45470ef11a17837725ec4ec51b94272731aff0c2", "message": "final", "committedDate": "2020-10-19T06:45:17Z", "type": "commit"}, {"oid": "9f2272347da7c508a24d42ccae0e1ceb30ab264a", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/9f2272347da7c508a24d42ccae0e1ceb30ab264a", "message": "Fix shortcuts", "committedDate": "2020-10-19T06:47:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzkyOTk4MA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1805#discussion_r507929980", "bodyText": "if we do merge this as-is, we need to get these renamed ASAP, for sure.", "author": "jkwatson", "createdAt": "2020-10-19T17:33:13Z", "path": "api/src/main/java/io/opentelemetry/DefaultOpenTelemetry.java", "diffHunk": "@@ -0,0 +1,235 @@\n+/*\n+ * Copyright The OpenTelemetry Authors\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+\n+package io.opentelemetry;\n+\n+import static java.util.Objects.requireNonNull;\n+\n+import io.opentelemetry.baggage.BaggageManager;\n+import io.opentelemetry.baggage.DefaultBaggageManager;\n+import io.opentelemetry.baggage.spi.BaggageManagerFactory;\n+import io.opentelemetry.context.propagation.ContextPropagators;\n+import io.opentelemetry.context.propagation.DefaultContextPropagators;\n+import io.opentelemetry.internal.Obfuscated;\n+import io.opentelemetry.metrics.DefaultMeterProvider;\n+import io.opentelemetry.metrics.Meter;\n+import io.opentelemetry.metrics.MeterProvider;\n+import io.opentelemetry.metrics.spi.MeterProviderFactory;\n+import io.opentelemetry.trace.DefaultTracerProvider;\n+import io.opentelemetry.trace.Tracer;\n+import io.opentelemetry.trace.TracerProvider;\n+import io.opentelemetry.trace.spi.TracerProviderFactory;\n+import java.util.ServiceLoader;\n+import javax.annotation.Nullable;\n+import javax.annotation.concurrent.ThreadSafe;\n+\n+/**\n+ * This class provides a static global accessor for telemetry objects {@link Tracer}, {@link Meter}\n+ * and {@link BaggageManager}.\n+ *\n+ * <p>The telemetry objects are lazy-loaded singletons resolved via {@link ServiceLoader} mechanism.\n+ *\n+ * @see TracerProvider\n+ * @see MeterProviderFactory\n+ * @see BaggageManagerFactory\n+ */\n+@ThreadSafe\n+final class DefaultOpenTelemetry implements OpenTelemetry {\n+  private static final Object mutex = new Object();\n+\n+  static OpenTelemetry getGlobalOpenTelemetry() {\n+    if (globalOpenTelemetry == null) {\n+      synchronized (mutex) {\n+        if (globalOpenTelemetry == null) {\n+          globalOpenTelemetry = DefaultOpenTelemetry.builder().build();\n+        }\n+      }\n+    }\n+    return globalOpenTelemetry;\n+  }\n+\n+  static void setGlobalOpenTelemetry(OpenTelemetry openTelemetry) {\n+    globalOpenTelemetry = openTelemetry;\n+  }\n+\n+  static Builder builder() {\n+    return new Builder();\n+  }\n+\n+  @Nullable private static volatile OpenTelemetry globalOpenTelemetry;\n+\n+  private final TracerProvider tracerProvider;\n+  private final MeterProvider meterProvider;\n+  private final BaggageManager baggageManager;\n+\n+  private final ContextPropagators propagators;\n+\n+  @Override\n+  public TracerProvider getMyTracerProvider() {", "originalCommit": "9f2272347da7c508a24d42ccae0e1ceb30ab264a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzkzMDI3NQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1805#discussion_r507930275", "bodyText": "can you stack a 2nd PR on top of this one with the renames, so we can move fast in getting it fixed?", "author": "jkwatson", "createdAt": "2020-10-19T17:33:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzkyOTk4MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODE3NTE3OQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1805#discussion_r508175179", "bodyText": "I'd set up another PR before merging this after it's green-lighted by @bogdandrutu", "author": "anuraaga", "createdAt": "2020-10-20T02:45:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzkyOTk4MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODc0MjIzMg==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1805#discussion_r508742232", "bodyText": "{@code getTracreProvider()...} ?", "author": "carlosalberto", "createdAt": "2020-10-20T18:19:53Z", "path": "api/src/main/java/io/opentelemetry/OpenTelemetry.java", "diffHunk": "@@ -5,255 +5,185 @@\n \n package io.opentelemetry;\n \n+import static java.util.Objects.requireNonNull;\n+\n import io.opentelemetry.baggage.BaggageManager;\n-import io.opentelemetry.baggage.DefaultBaggageManager;\n-import io.opentelemetry.baggage.spi.BaggageManagerFactory;\n import io.opentelemetry.context.propagation.ContextPropagators;\n-import io.opentelemetry.context.propagation.DefaultContextPropagators;\n-import io.opentelemetry.internal.Obfuscated;\n-import io.opentelemetry.metrics.DefaultMeterProvider;\n import io.opentelemetry.metrics.Meter;\n import io.opentelemetry.metrics.MeterProvider;\n-import io.opentelemetry.metrics.spi.MeterProviderFactory;\n-import io.opentelemetry.trace.DefaultTracerProvider;\n import io.opentelemetry.trace.Tracer;\n import io.opentelemetry.trace.TracerProvider;\n-import io.opentelemetry.trace.propagation.HttpTraceContext;\n-import io.opentelemetry.trace.spi.TracerProviderFactory;\n-import java.util.Objects;\n-import java.util.ServiceLoader;\n-import javax.annotation.Nullable;\n-import javax.annotation.concurrent.ThreadSafe;\n \n /**\n- * This class provides a static global accessor for telemetry objects {@link Tracer}, {@link Meter}\n- * and {@link BaggageManager}.\n+ * The entrypoint to telemetry functionality for tracing, metrics and baggage.\n  *\n- * <p>The telemetry objects are lazy-loaded singletons resolved via {@link ServiceLoader} mechanism.\n+ * <p>The default for the OpenTelemetry API will include any {@link\n+ * io.opentelemetry.trace.spi.TracerProviderFactory}, {@link\n+ * io.opentelemetry.metrics.spi.MeterProviderFactory}, or {@link\n+ * io.opentelemetry.baggage.spi.BaggageManagerFactory} found on the classpath, or otherwise will be\n+ * default, with no-op behavior.\n  *\n  * @see TracerProvider\n- * @see MeterProviderFactory\n- * @see BaggageManagerFactory\n+ * @see MeterProvider\n+ * @see BaggageManager\n  */\n-@ThreadSafe\n-public final class OpenTelemetry {\n-  private static final Object mutex = new Object();\n-\n-  @Nullable private static volatile OpenTelemetry instance;\n-\n-  private final TracerProvider tracerProvider;\n-  private final MeterProvider meterProvider;\n-  private final BaggageManager contextManager;\n-\n-  private volatile ContextPropagators propagators = DefaultContextPropagators.builder().build();\n+public interface OpenTelemetry {\n \n-  /**\n-   * Returns a singleton {@link TracerProvider}.\n-   *\n-   * @return registered TracerProvider or default via {@link DefaultTracerProvider#getInstance()}.\n-   * @throws IllegalStateException if a specified TracerProvider (via system properties) could not\n-   *     be found.\n-   */\n-  public static TracerProvider getTracerProvider() {\n-    return getInstance().tracerProvider;\n+  /** Returns the globally registered {@link TracerProvider}. */\n+  static TracerProvider getTracerProvider() {\n+    return DefaultOpenTelemetry.getGlobalOpenTelemetry().getMyTracerProvider();\n   }\n \n   /**\n-   * Gets or creates a named tracer instance.\n+   * Gets or creates a named tracer instance from the globally registered {@link TracerProvider}.\n    *\n-   * <p>This is a shortcut method for <code>getTracerProvider().get(instrumentationName)</code>.\n+   * <p>This is a shortcut method for {@code getTracerProvider().get(instrumentationName)}\n    *\n    * @param instrumentationName The name of the instrumentation library, not the name of the\n    *     instrument*ed* library (e.g., \"io.opentelemetry.contrib.mongodb\"). Must not be null.\n    * @return a tracer instance.\n    */\n-  public static Tracer getTracer(String instrumentationName) {\n-    return getTracerProvider().get(instrumentationName);\n+  static Tracer getTracer(String instrumentationName) {\n+    return DefaultOpenTelemetry.getGlobalOpenTelemetry().getMyTracer(instrumentationName);\n   }\n \n   /**\n-   * Gets or creates a named and versioned tracer instance.\n+   * Gets or creates a named and versioned tracer instance from the globally registered {@link\n+   * TracerProvider}.\n    *\n-   * <p>This is a shortcut method for <code>\n-   * getTracerProvider().get(instrumentationName, instrumentationVersion)</code>.\n+   * <p>This is a shortcut method for @codegetTracerProvider().get(instrumentationName,", "originalCommit": "9f2272347da7c508a24d42ccae0e1ceb30ab264a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODk1MTg5OQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1805#discussion_r508951899", "bodyText": "@anuraaga fix this up and we're ready go merge, IMO", "author": "jkwatson", "createdAt": "2020-10-21T02:31:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODc0MjIzMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODk1OTgxMw==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1805#discussion_r508959813", "bodyText": "Ouch - thanks fixed", "author": "anuraaga", "createdAt": "2020-10-21T03:01:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODc0MjIzMg=="}], "type": "inlineReview"}, {"oid": "4dfbacda8ce05960bea465e17c61307c3941226c", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/4dfbacda8ce05960bea465e17c61307c3941226c", "message": "Fix javadoc", "committedDate": "2020-10-21T02:54:03Z", "type": "commit"}, {"oid": "4279a59a4441e4259cf2655a114e5b0318c6a2a6", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/4279a59a4441e4259cf2655a114e5b0318c6a2a6", "message": "Merge branch 'master' of github.com:open-telemetry/opentelemetry-java into opentelemetry-interface", "committedDate": "2020-10-21T05:05:40Z", "type": "commit"}, {"oid": "06787179072340d374d7ffc46b5b27a04f90857e", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/06787179072340d374d7ffc46b5b27a04f90857e", "message": "More merge", "committedDate": "2020-10-21T05:14:26Z", "type": "commit"}]}