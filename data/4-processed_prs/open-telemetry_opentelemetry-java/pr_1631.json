{"pr_number": 1631, "pr_title": "Implement the keyed-attributes proposal", "pr_createdAt": "2020-09-09T21:03:41Z", "pr_url": "https://github.com/open-telemetry/opentelemetry-java/pull/1631", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQ3ODQxNw==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1631#discussion_r486478417", "bodyText": "Should this change to LongKey, long value?", "author": "bogdandrutu", "createdAt": "2020-09-10T16:30:28Z", "path": "api/src/main/java/io/opentelemetry/common/Attributes.java", "diffHunk": "@@ -201,83 +224,75 @@ public Builder setAttribute(String key, AttributeValue value) {\n     }\n \n     /**\n-     * Sets a String {@link AttributeValue} into this.\n+     * Sets a String attribute into this.\n      *\n      * @return this Builder\n      */\n     public Builder setAttribute(String key, String value) {\n-      AttributeValue v = stringAttributeValue(value);\n-      return setAttribute(key, v);\n+      return setAttribute(stringKey(key), value);\n     }\n \n     /**\n-     * Sets a long {@link AttributeValue} into this.\n+     * Sets a long attribute into this.\n      *\n      * @return this Builder\n      */\n     public Builder setAttribute(String key, long value) {", "originalCommit": "78de78f21e62543820b939e4a4dbf5cfd45f9059", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjUxMzM0Mg==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1631#discussion_r486513342", "bodyText": "My thought was, since these are already type-safe, to keep the easy option in the API, for cases where people don't want to directly use the new keys. The method that takes the generic key should cover the particular, and would end up being the same method signature as this if we change the first parameter to LongKey.", "author": "jkwatson", "createdAt": "2020-09-10T17:28:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQ3ODQxNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njg0NDcyOQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1631#discussion_r486844729", "bodyText": "Yeah I don't think we need to change these methods to use the keys. We could consider removing these methods - I'm on the fence on how useful these are for users. Keys will always have a significant performance benefit compared to creating a wrapper key every time this is invoked, so removing them reduces the chances of a user not realizing that.", "author": "anuraaga", "createdAt": "2020-09-11T08:04:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQ3ODQxNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzA5OTU1Nw==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1631#discussion_r487099557", "bodyText": "At the very least, I was thinking we should add some strongly worded language to the javadoc about preferring to use the method that takes the Key.", "author": "jkwatson", "createdAt": "2020-09-11T14:52:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQ3ODQxNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODA2MjQyOQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1631#discussion_r488062429", "bodyText": "added some javadoc to the relevant methods.", "author": "jkwatson", "createdAt": "2020-09-14T16:23:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQ3ODQxNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjgzOTM4OA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1631#discussion_r486839388", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             * This interface provides a handle for setting the values of {@link Attributes}. The type of value\n          \n          \n            \n             * This interface provides a handle for setting the values of {@link Attributes}. The type of a value", "author": "anuraaga", "createdAt": "2020-09-11T07:53:58Z", "path": "api/src/main/java/io/opentelemetry/common/AttributeKey.java", "diffHunk": "@@ -0,0 +1,32 @@\n+/*\n+ * Copyright 2020, OpenTelemetry Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.opentelemetry.common;\n+\n+/**\n+ * This interface provides a handle for setting the values of {@link Attributes}. The type of value", "originalCommit": "78de78f21e62543820b939e4a4dbf5cfd45f9059", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzIyNzExMg==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1631#discussion_r487227112", "bodyText": "hmm. I think the original reads a little better, personally.", "author": "jkwatson", "createdAt": "2020-09-11T18:49:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjgzOTM4OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjgzOTc5NA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1631#discussion_r486839794", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              String get();\n          \n          \n            \n              String getName();\n          \n      \n    \n    \n  \n\nNot strong suggestion but I feel lack of symmetry between this get and getType", "author": "anuraaga", "createdAt": "2020-09-11T07:54:42Z", "path": "api/src/main/java/io/opentelemetry/common/AttributeKey.java", "diffHunk": "@@ -0,0 +1,32 @@\n+/*\n+ * Copyright 2020, OpenTelemetry Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.opentelemetry.common;\n+\n+/**\n+ * This interface provides a handle for setting the values of {@link Attributes}. The type of value\n+ * that can be set with an implementation of this key is denoted by the type parameter.\n+ *\n+ * @param <T> The type of value that can be set with the key.\n+ */\n+@SuppressWarnings(\"rawtypes\")\n+public interface AttributeKey<T> extends Comparable<AttributeKey> {\n+  /** Returns the underlying String representation of the key. */\n+  String get();", "originalCommit": "78de78f21e62543820b939e4a4dbf5cfd45f9059", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzA5Mjk2MA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1631#discussion_r487092960", "bodyText": "getKey() seems better than name to me. And, I agree with the sentiment, for sure.", "author": "jkwatson", "createdAt": "2020-09-11T14:42:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjgzOTc5NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzI4NjM5MQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1631#discussion_r487286391", "bodyText": "done.", "author": "jkwatson", "createdAt": "2020-09-11T20:55:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjgzOTc5NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njg0MDIwMA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1631#discussion_r486840200", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            public abstract class AttributeKeyImpl<T> implements AttributeKey<T> {\n          \n          \n            \n            abstract class AttributeKeyImpl<T> implements AttributeKey<T> {", "author": "anuraaga", "createdAt": "2020-09-11T07:55:24Z", "path": "api/src/main/java/io/opentelemetry/common/AttributeKeyImpl.java", "diffHunk": "@@ -0,0 +1,182 @@\n+/*\n+ * Copyright 2020, OpenTelemetry Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.opentelemetry.common;\n+\n+import java.util.List;\n+\n+@SuppressWarnings(\"rawtypes\")\n+public abstract class AttributeKeyImpl<T> implements AttributeKey<T> {", "originalCommit": "78de78f21e62543820b939e4a4dbf5cfd45f9059", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njg0MDQ2OQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1631#discussion_r486840469", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                return \"AttributeKeyImpl{\" + \"key='\" + key + '\\'' + '}';\n          \n          \n            \n                return key;\n          \n      \n    \n    \n  \n\nI think just the key is a better toString for keys", "author": "anuraaga", "createdAt": "2020-09-11T07:55:50Z", "path": "api/src/main/java/io/opentelemetry/common/AttributeKeyImpl.java", "diffHunk": "@@ -0,0 +1,182 @@\n+/*\n+ * Copyright 2020, OpenTelemetry Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.opentelemetry.common;\n+\n+import java.util.List;\n+\n+@SuppressWarnings(\"rawtypes\")\n+public abstract class AttributeKeyImpl<T> implements AttributeKey<T> {\n+  private final String key;\n+\n+  AttributeKeyImpl(String key) {\n+    this.key = key;\n+  }\n+\n+  @Override\n+  public String get() {\n+    return key;\n+  }\n+\n+  @Override\n+  public boolean equals(Object o) {\n+    if (this == o) {\n+      return true;\n+    }\n+    if (!(o instanceof AttributeKeyImpl)) {\n+      return false;\n+    }\n+\n+    AttributeKeyImpl<?> that = (AttributeKeyImpl<?>) o;\n+\n+    return key != null ? key.equals(that.key) : that.key == null;\n+  }\n+\n+  @Override\n+  public int hashCode() {\n+    return key != null ? key.hashCode() : 0;\n+  }\n+\n+  @Override\n+  public String toString() {\n+    return \"AttributeKeyImpl{\" + \"key='\" + key + '\\'' + '}';", "originalCommit": "78de78f21e62543820b939e4a4dbf5cfd45f9059", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzA5NzcwNQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1631#discussion_r487097705", "bodyText": "I'm on the fence. It will certainly read better, but I wonder if it could be misleading in tests if the failure happens when you're trying to compare to a raw String, and the toStrings would look identical.", "author": "jkwatson", "createdAt": "2020-09-11T14:49:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njg0MDQ2OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzE0OTI5Ng==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1631#discussion_r487149296", "bodyText": "Admittedly I'm biased because instrumentation tests are groovy and would be able to use the key itself in assertions instead of calling a method. This is not a strong enough reason to pick one or another though so ok with either \ud83d\ude03", "author": "anuraaga", "createdAt": "2020-09-11T16:15:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njg0MDQ2OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzI0NzEwMQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1631#discussion_r487247101", "bodyText": "wait...spock uses the toString to do assertions??? That sounds like a terrible idea.", "author": "jkwatson", "createdAt": "2020-09-11T19:27:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njg0MDQ2OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njg0MDkyMw==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1631#discussion_r486840923", "bodyText": "key should never be null I think", "author": "anuraaga", "createdAt": "2020-09-11T07:56:43Z", "path": "api/src/main/java/io/opentelemetry/common/AttributeKeyImpl.java", "diffHunk": "@@ -0,0 +1,182 @@\n+/*\n+ * Copyright 2020, OpenTelemetry Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.opentelemetry.common;\n+\n+import java.util.List;\n+\n+@SuppressWarnings(\"rawtypes\")\n+public abstract class AttributeKeyImpl<T> implements AttributeKey<T> {\n+  private final String key;\n+\n+  AttributeKeyImpl(String key) {\n+    this.key = key;\n+  }\n+\n+  @Override\n+  public String get() {\n+    return key;\n+  }\n+\n+  @Override\n+  public boolean equals(Object o) {\n+    if (this == o) {\n+      return true;\n+    }\n+    if (!(o instanceof AttributeKeyImpl)) {\n+      return false;\n+    }\n+\n+    AttributeKeyImpl<?> that = (AttributeKeyImpl<?>) o;\n+\n+    return key != null ? key.equals(that.key) : that.key == null;", "originalCommit": "78de78f21e62543820b939e4a4dbf5cfd45f9059", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzI2NjQzMw==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1631#discussion_r487266433", "bodyText": "This is generated code; I'd rather not mess with it if I don't have to.", "author": "jkwatson", "createdAt": "2020-09-11T20:09:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njg0MDkyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzI2Njk2Mg==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1631#discussion_r487266962", "bodyText": "Maybe I should switch this to autovalue....", "author": "jkwatson", "createdAt": "2020-09-11T20:10:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njg0MDkyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzI4Mzk4Nw==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1631#discussion_r487283987", "bodyText": "We currently do allow null keys from the API (in the effort to not throw errors when people mis-use the API). So, this check is important. But, even so, Autovalue allows removing all the hand-built implementations, as long as we provide a custom equals/hashcode that ignores the type and only considers the key.", "author": "jkwatson", "createdAt": "2020-09-11T20:49:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njg0MDkyMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njg0MTQyNQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1631#discussion_r486841425", "bodyText": "I guess the class may be public for these guys but I think AttributeKeys is a better home than the impl class", "author": "anuraaga", "createdAt": "2020-09-11T07:57:37Z", "path": "api/src/main/java/io/opentelemetry/common/AttributeKeyImpl.java", "diffHunk": "@@ -0,0 +1,182 @@\n+/*\n+ * Copyright 2020, OpenTelemetry Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.opentelemetry.common;\n+\n+import java.util.List;\n+\n+@SuppressWarnings(\"rawtypes\")\n+public abstract class AttributeKeyImpl<T> implements AttributeKey<T> {\n+  private final String key;\n+\n+  AttributeKeyImpl(String key) {\n+    this.key = key;\n+  }\n+\n+  @Override\n+  public String get() {\n+    return key;\n+  }\n+\n+  @Override\n+  public boolean equals(Object o) {\n+    if (this == o) {\n+      return true;\n+    }\n+    if (!(o instanceof AttributeKeyImpl)) {\n+      return false;\n+    }\n+\n+    AttributeKeyImpl<?> that = (AttributeKeyImpl<?>) o;\n+\n+    return key != null ? key.equals(that.key) : that.key == null;\n+  }\n+\n+  @Override\n+  public int hashCode() {\n+    return key != null ? key.hashCode() : 0;\n+  }\n+\n+  @Override\n+  public String toString() {\n+    return \"AttributeKeyImpl{\" + \"key='\" + key + '\\'' + '}';\n+  }\n+\n+  @Override\n+  public int compareTo(AttributeKey o) {\n+    return get().compareTo(o.get());\n+  }\n+\n+  public static StringKey stringKey(String key) {", "originalCommit": "78de78f21e62543820b939e4a4dbf5cfd45f9059", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njg0MTg0NA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1631#discussion_r486841844", "bodyText": "Also I think we can return AttributeKey<String> etc to be more generic and keep these types private as well", "author": "anuraaga", "createdAt": "2020-09-11T07:58:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njg0MTQyNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzE3MTc4MQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1631#discussion_r487171781", "bodyText": "I'll try this. I thought I had run into some issue with that, but I can't imagine what it was. :)", "author": "jkwatson", "createdAt": "2020-09-11T16:57:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njg0MTQyNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzI4NjcyMg==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1631#discussion_r487286722", "bodyText": "cool. I moved all of these to a new AttributeKeys class and made the methods return the interface types with parameter", "author": "jkwatson", "createdAt": "2020-09-11T20:56:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njg0MTQyNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njg0NjA3MA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1631#discussion_r486846070", "bodyText": "IIRC, the suggestion for a consumer interface with method per type was to avoid the somewhat lost type-safety of this pattern :) But I don't think it's that bad anyways", "author": "anuraaga", "createdAt": "2020-09-11T08:06:50Z", "path": "exporters/jaeger/src/main/java/io/opentelemetry/exporters/jaeger/Adapter.java", "diffHunk": "@@ -177,80 +179,55 @@ private Adapter() {}\n    *\n    * @param attributes the span attributes\n    * @return a collection of Jaeger key values\n-   * @see #toKeyValue(String, AttributeValue)\n-   */\n-  @VisibleForTesting\n-  static Collection<Model.KeyValue> toKeyValues(Map<String, AttributeValue> attributes) {\n-    List<Model.KeyValue> tags = new ArrayList<>(attributes.size());\n-    for (Map.Entry<String, AttributeValue> entry : attributes.entrySet()) {\n-      tags.add(toKeyValue(entry.getKey(), entry.getValue()));\n-    }\n-    return tags;\n-  }\n-\n-  /**\n-   * Converts a map of attributes into a collection of Jaeger's {@link Model.KeyValue}.\n-   *\n-   * @param attributes the span attributes\n-   * @return a collection of Jaeger key values\n-   * @see #toKeyValue(String, AttributeValue)\n+   * @see #toKeyValue\n    */\n   @VisibleForTesting\n   static Collection<Model.KeyValue> toKeyValues(ReadableAttributes attributes) {\n     final List<Model.KeyValue> tags = new ArrayList<>(attributes.size());\n     attributes.forEach(\n         new AttributeConsumer() {\n           @Override\n-          public void consume(String key, AttributeValue value) {\n+          public <T> void consume(AttributeKey<T> key, T value) {\n             tags.add(toKeyValue(key, value));\n           }\n         });\n     return tags;\n   }\n \n   /**\n-   * Converts the given key and {@link AttributeValue} into Jaeger's {@link Model.KeyValue}.\n+   * Converts the given {@link AttributeKey} and value into Jaeger's {@link Model.KeyValue}.\n    *\n    * @param key the entry key as string\n    * @param value the entry value\n    * @return a Jaeger key value\n    */\n   @VisibleForTesting\n-  static Model.KeyValue toKeyValue(String key, AttributeValue value) {\n+  static <T> Model.KeyValue toKeyValue(AttributeKey<T> key, T value) {\n     Model.KeyValue.Builder builder = Model.KeyValue.newBuilder();\n-    builder.setKey(key);\n+    builder.setKey(key.get());\n \n-    switch (value.getType()) {\n+    switch (key.getType()) {\n       case STRING:\n-        builder.setVStr(value.getStringValue());\n+        builder.setVStr((String) value);", "originalCommit": "78de78f21e62543820b939e4a4dbf5cfd45f9059", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzAwODgyOQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1631#discussion_r487008829", "bodyText": "A (not very pretty) alternative is to have AttributeKey.getValue(value) to automatically cast it (and report an error otherwise). Not sure it's a required addition though.\nOtherwise, the type safety we lose is not bad.", "author": "carlosalberto", "createdAt": "2020-09-11T12:23:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njg0NjA3MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzA5NzEwOQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1631#discussion_r487097109", "bodyText": "We can also add a secondary consumer interface that has the 8 methods on it. I originally had that when I was working on this, but discovered that it was much more cumbersome to use in basically every case inside the SDK itself.\n@carlosalberto I'm not sure how we could do the casting on the List types, though, since generics are all erased. The best we could do was verify that it was a List, but not what kind, unfortunately.", "author": "jkwatson", "createdAt": "2020-09-11T14:48:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njg0NjA3MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzE1Mjc1Mw==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1631#discussion_r487152753", "bodyText": "Did you find it cumbersome in the exporters? I'm surprised since I think I see the 8-way switch coming up a few times and figure it'd be similar if separate methods. But might be missing something, definitely agree to optimize the API for the export case since that's almost all of the iterating of attributes in practice.", "author": "anuraaga", "createdAt": "2020-09-11T16:22:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njg0NjA3MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzE3Mjc2Mg==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1631#discussion_r487172762", "bodyText": "It was super awkward in the exporters that convert to protobuf representations. There might be a better way to approach it, but I wanted to at least reduce the scope of the PR as much as I could. ;) Given that this export is SDK internal functionality, I think we can iterate on it at little more easily than the instrumentation API.", "author": "jkwatson", "createdAt": "2020-09-11T16:59:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njg0NjA3MA=="}], "type": "inlineReview"}, {"oid": "3dfeff1b2e7d8909bf542162a6ce606059701d5d", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/3dfeff1b2e7d8909bf542162a6ce606059701d5d", "message": "update for changes from the main branch", "committedDate": "2020-09-11T19:25:39Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzM1ODQ2NQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1631#discussion_r487358465", "bodyText": "Also need to check key.getKey is null?", "author": "anuraaga", "createdAt": "2020-09-12T02:55:45Z", "path": "api/src/main/java/io/opentelemetry/common/Attributes.java", "diffHunk": "@@ -169,20 +197,16 @@ public Attributes build() {\n       return sortAndFilterToAttributes(data.toArray());\n     }\n \n-    /**\n-     * Sets a bare {@link AttributeValue} into this.\n-     *\n-     * @return this Builder\n-     */\n-    public Builder setAttribute(String key, AttributeValue value) {\n-      if (key == null || key.length() == 0) {\n+    /** Sets a {@link AttributeKey} with associated value into this. */\n+    public <T> Builder setAttribute(AttributeKey<T> key, T value) {\n+      if (key == null || key.getKey().length() == 0) {", "originalCommit": "7303e011448442e61349e5832341324123035f61", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQyNDUwMQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1631#discussion_r487424501", "bodyText": "yes, good catch. obviously, we need a unit test for it, as well.", "author": "jkwatson", "createdAt": "2020-09-12T16:16:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzM1ODQ2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODAzNTM1MQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1631#discussion_r488035351", "bodyText": "done", "author": "jkwatson", "createdAt": "2020-09-14T15:43:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzM1ODQ2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzM1ODkzMg==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1631#discussion_r487358932", "bodyText": "Just had an idea which I think could have been possible with separate key impls but don't think so with AutoValue version. If the array keys implemented a marker interface like AttributeArrayKey<T> then we could also provide setAttribute(AttributeArrayKey<T>, T...). Array keys aren't so common though and we could rework later too so no big deal now though.", "author": "anuraaga", "createdAt": "2020-09-12T03:00:55Z", "path": "api/src/main/java/io/opentelemetry/common/AttributesKeys.java", "diffHunk": "@@ -0,0 +1,68 @@\n+/*\n+ * Copyright 2020, OpenTelemetry Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.opentelemetry.common;\n+\n+import java.util.List;\n+\n+/**\n+ * Creation methods for {@link AttributeKey} implementations.\n+ *\n+ * @see Attributes\n+ */\n+public class AttributesKeys {\n+  private AttributesKeys() {}\n+\n+  /** Create a new AttributeKey for String valued attributes. */\n+  public static AttributeKey<String> stringKey(String key) {\n+    return AttributeKeyImpl.create(key, AttributeType.STRING);\n+  }\n+\n+  /** Create a new AttributeKey for Boolean valued attributes. */\n+  public static AttributeKey<Boolean> booleanKey(String key) {\n+    return AttributeKeyImpl.create(key, AttributeType.BOOLEAN);\n+  }\n+\n+  /** Create a new AttributeKey for Long valued attributes. */\n+  public static AttributeKey<Long> longKey(String key) {\n+    return AttributeKeyImpl.create(key, AttributeType.LONG);\n+  }\n+\n+  /** Create a new AttributeKey for Double valued attributes. */\n+  public static AttributeKey<Double> doubleKey(String key) {\n+    return AttributeKeyImpl.create(key, AttributeType.DOUBLE);\n+  }\n+\n+  /** Create a new AttributeKey for List&lt;String&gt; valued attributes. */\n+  public static AttributeKey<List<String>> stringArrayKey(String key) {\n+    return AttributeKeyImpl.create(key, AttributeType.STRING_ARRAY);", "originalCommit": "7303e011448442e61349e5832341324123035f61", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQyNDQyNA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1631#discussion_r487424424", "bodyText": "yeah, I don't think we have any semantic conventions for array attributes, so I'm much less worried about them. Let's punt on this for now, and revisit if array attributes really become important.", "author": "jkwatson", "createdAt": "2020-09-12T16:15:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzM1ODkzMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzcxMzYzMA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1631#discussion_r487713630", "bodyText": "I would still keep the @since", "author": "thisthat", "createdAt": "2020-09-14T07:44:25Z", "path": "api/src/main/java/io/opentelemetry/common/AttributeConsumer.java", "diffHunk": "@@ -16,10 +16,7 @@\n \n package io.opentelemetry.common;\n \n-/**\n- * Convenience interface for consuming {@link ReadableAttributes}.\n- *\n- * @since 0.9.0", "originalCommit": "7303e011448442e61349e5832341324123035f61", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODAwMTIxNQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1631#discussion_r488001215", "bodyText": "oh, good call. I didn't mean to delete that. will fix.", "author": "jkwatson", "createdAt": "2020-09-14T15:00:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzcxMzYzMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODAzNTUyNw==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1631#discussion_r488035527", "bodyText": "fixed", "author": "jkwatson", "createdAt": "2020-09-14T15:43:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzcxMzYzMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzgxNTkwMA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1631#discussion_r487815900", "bodyText": "I would prefer to sanitize here rather than in the caller methods. This way this class is future proof.", "author": "thisthat", "createdAt": "2020-09-14T10:39:25Z", "path": "api/src/main/java/io/opentelemetry/common/ImmutableKeyValuePairs.java", "diffHunk": "@@ -98,14 +92,24 @@ private static void quickSort(Object[] data, int leftIndex, int rightIndex) {\n     quickSort(data, counter, rightIndex);\n   }\n \n+  private static <K extends Comparable<K>> int compareToNullSafe(K key, K pivotKey) {\n+    if (key == null) {\n+      return pivotKey == null ? 0 : -1;\n+    }\n+    if (pivotKey == null) {\n+      return 1;\n+    }\n+    return key.compareTo(pivotKey);\n+  }\n+\n   private static List<Object> dedupe(Object[] data) {\n     List<Object> result = new ArrayList<>(data.length);\n     Object previousKey = null;\n \n     for (int i = 0; i < data.length; i += 2) {\n       Object key = data[i];\n       Object value = data[i + 1];\n-      if (key == null || \"\".equals(key)) {", "originalCommit": "7303e011448442e61349e5832341324123035f61", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzk5ODQxMg==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1631#discussion_r487998412", "bodyText": "The issue is that the keys are no longer always strings, so I don't know how to do this check. Ideas welcome!", "author": "jkwatson", "createdAt": "2020-09-14T14:57:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzgxNTkwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODExMzUwOA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1631#discussion_r488113508", "bodyText": "You're right, I didn't realize that! \ud83e\udd14 I have no idea how at the moment. I  would then add some lines in the class Javadoc saying that sanitization should be done before calling sortAndFilter.", "author": "thisthat", "createdAt": "2020-09-14T17:46:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzgxNTkwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODEyMDEyNQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1631#discussion_r488120125", "bodyText": "I added some clarification to the class javadoc. Thanks for the suggestion!", "author": "jkwatson", "createdAt": "2020-09-14T17:58:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzgxNTkwMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzUzMjMzNA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1631#discussion_r487532334", "bodyText": "Why? Can there be attributes with the same key but different types?", "author": "iNikem", "createdAt": "2020-09-13T13:52:36Z", "path": "api/src/main/java/io/opentelemetry/common/AttributeKeyImpl.java", "diffHunk": "@@ -0,0 +1,57 @@\n+/*\n+ * Copyright 2020, OpenTelemetry Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.opentelemetry.common;\n+\n+import com.google.auto.value.AutoValue;\n+\n+@SuppressWarnings(\"rawtypes\")\n+@AutoValue\n+abstract class AttributeKeyImpl<T> implements AttributeKey<T> {\n+\n+  static <T> AttributeKeyImpl<T> create(String key, AttributeType type) {\n+    return new AutoValue_AttributeKeyImpl<>(key, type);\n+  }\n+\n+  //////////////////////////////////\n+  // IMPORTANT: the equals/hashcode/compareTo *only* include the key, and not the type,\n+  // so that de-duping of attributes is based on the key, and not also based on the type.", "originalCommit": "7303e011448442e61349e5832341324123035f61", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzk5OTI1NQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1631#discussion_r487999255", "bodyText": "Well... what would that mean, exactly? Certainly with the previous implementation, you get only one value per key. Having multiple values per string-key would be very odd to have to deal with in an Exporter, I think.", "author": "jkwatson", "createdAt": "2020-09-14T14:58:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzUzMjMzNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODAyNjQ4Mg==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1631#discussion_r488026482", "bodyText": "My though was that if there is NO two attributes with the same key but different type, why it is important to include only key, but not type, into equals/hashcode/compareTo?", "author": "iNikem", "createdAt": "2020-09-14T15:31:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzUzMjMzNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODAzNzE1MA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1631#discussion_r488037150", "bodyText": "Something has to make the replacement of one keyed-value with another (of a different type). This is the implementation that makes that happen. The de-duping relies on the equals/hashcode not including the type.", "author": "jkwatson", "createdAt": "2020-09-14T15:46:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzUzMjMzNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzUzMjY1OA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1631#discussion_r487532658", "bodyText": "what if key==null?", "author": "iNikem", "createdAt": "2020-09-13T13:55:09Z", "path": "api/src/main/java/io/opentelemetry/common/Attributes.java", "diffHunk": "@@ -125,6 +146,13 @@ public static Attributes of(\n   }\n \n   private static Attributes sortAndFilterToAttributes(Object... data) {\n+    // null out any empty keys\n+    for (int i = 0; i < data.length; i += 2) {\n+      AttributeKey<?> key = (AttributeKey<?>) data[i];\n+      if (key != null && (key.getKey() == null || \"\".equals(key.getKey()))) {", "originalCommit": "7303e011448442e61349e5832341324123035f61", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODAyMjc0MA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1631#discussion_r488022740", "bodyText": "If the key is already null, we don't need to null it out again, correct?", "author": "jkwatson", "createdAt": "2020-09-14T15:27:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzUzMjY1OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODAyNzYwOA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1631#discussion_r488027608", "bodyText": "A :) I see :)", "author": "iNikem", "createdAt": "2020-09-14T15:32:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzUzMjY1OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzg0OTU4Mg==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1631#discussion_r487849582", "bodyText": "I don't quite follow, why so much extends clauses were eliminated?", "author": "iNikem", "createdAt": "2020-09-14T11:46:32Z", "path": "api/src/main/java/io/opentelemetry/common/ReadableAttributes.java", "diffHunk": "@@ -21,6 +21,15 @@\n  *\n  * <p>See {@link Attributes} for the public API implementation.\n  */\n-public interface ReadableAttributes extends ReadableKeyValuePairs<String, AttributeValue> {\n-  AttributeValue get(String key);\n+public interface ReadableAttributes {", "originalCommit": "7303e011448442e61349e5832341324123035f61", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODAwMDczMQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1631#discussion_r488000731", "bodyText": "They weren't adding any value, and making it much more complicated to deal with the generic keys. It ended up being much simpler and easier to understand without the extra interface that wasn't a meaningful one to the end-consumer.", "author": "jkwatson", "createdAt": "2020-09-14T14:59:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzg0OTU4Mg=="}], "type": "inlineReview"}, {"oid": "997776298f4eb2c090cd4575a7fb47b0a3ee248e", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/997776298f4eb2c090cd4575a7fb47b0a3ee248e", "message": "Add javadoc notes to encourage using the lower-overhead attribute options.", "committedDate": "2020-09-14T16:29:19Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODU5OTk1Nw==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1631#discussion_r488599957", "bodyText": "Use https://docs.oracle.com/javase/7/docs/api/java/util/Objects.html#equals(java.lang.Object,%20java.lang.Object)?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                return getKey() != null ? getKey().equals(that.getKey()) : that.getKey() == null;\n          \n          \n            \n                return Objects.equals(getKey(), that.getKey());", "author": "Oberon00", "createdAt": "2020-09-15T11:43:46Z", "path": "api/src/main/java/io/opentelemetry/common/AttributeKeyImpl.java", "diffHunk": "@@ -0,0 +1,57 @@\n+/*\n+ * Copyright 2020, OpenTelemetry Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.opentelemetry.common;\n+\n+import com.google.auto.value.AutoValue;\n+\n+@SuppressWarnings(\"rawtypes\")\n+@AutoValue\n+abstract class AttributeKeyImpl<T> implements AttributeKey<T> {\n+\n+  static <T> AttributeKeyImpl<T> create(String key, AttributeType type) {\n+    return new AutoValue_AttributeKeyImpl<>(key, type);\n+  }\n+\n+  //////////////////////////////////\n+  // IMPORTANT: the equals/hashcode/compareTo *only* include the key, and not the type,\n+  // so that de-duping of attributes is based on the key, and not also based on the type.\n+  //////////////////////////////////\n+\n+  @Override\n+  public final boolean equals(Object o) {\n+    if (this == o) {\n+      return true;\n+    }\n+    if (!(o instanceof AttributeKeyImpl)) {\n+      return false;\n+    }\n+\n+    AttributeKeyImpl<?> that = (AttributeKeyImpl<?>) o;\n+\n+    return getKey() != null ? getKey().equals(that.getKey()) : that.getKey() == null;", "originalCommit": "efd7d1e8224736d262d7f150ea117c62b206376e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODczNTY3Ng==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1631#discussion_r488735676", "bodyText": "We can't use that in the API, due to java 7/android", "author": "jkwatson", "createdAt": "2020-09-15T14:56:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODU5OTk1Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTAyNjQyNA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1631#discussion_r491026424", "bodyText": "This API is definititely in Java 7, check the link I posted \ud83d\ude03", "author": "Oberon00", "createdAt": "2020-09-18T15:28:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODU5OTk1Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODYwMDYyOQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1631#discussion_r488600629", "bodyText": "Why no null check here? Use Objects.compare?", "author": "Oberon00", "createdAt": "2020-09-15T11:44:55Z", "path": "api/src/main/java/io/opentelemetry/common/AttributeKeyImpl.java", "diffHunk": "@@ -0,0 +1,57 @@\n+/*\n+ * Copyright 2020, OpenTelemetry Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.opentelemetry.common;\n+\n+import com.google.auto.value.AutoValue;\n+\n+@SuppressWarnings(\"rawtypes\")\n+@AutoValue\n+abstract class AttributeKeyImpl<T> implements AttributeKey<T> {\n+\n+  static <T> AttributeKeyImpl<T> create(String key, AttributeType type) {\n+    return new AutoValue_AttributeKeyImpl<>(key, type);\n+  }\n+\n+  //////////////////////////////////\n+  // IMPORTANT: the equals/hashcode/compareTo *only* include the key, and not the type,\n+  // so that de-duping of attributes is based on the key, and not also based on the type.\n+  //////////////////////////////////\n+\n+  @Override\n+  public final boolean equals(Object o) {\n+    if (this == o) {\n+      return true;\n+    }\n+    if (!(o instanceof AttributeKeyImpl)) {\n+      return false;\n+    }\n+\n+    AttributeKeyImpl<?> that = (AttributeKeyImpl<?>) o;\n+\n+    return getKey() != null ? getKey().equals(that.getKey()) : that.getKey() == null;\n+  }\n+\n+  @Override\n+  public final int hashCode() {\n+    return getKey() != null ? getKey().hashCode() : 0;\n+  }\n+\n+  @Override\n+  public int compareTo(AttributeKey o) {\n+    return getKey().compareTo(o.getKey());", "originalCommit": "efd7d1e8224736d262d7f150ea117c62b206376e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODcxNjczMw==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1631#discussion_r488716733", "bodyText": "For some reason I thought we couldn't use that with java 7/android. Let me take a look.", "author": "jkwatson", "createdAt": "2020-09-15T14:32:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODYwMDYyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODc0NjE5Mw==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1631#discussion_r488746193", "bodyText": "updated to be null-safe", "author": "jkwatson", "createdAt": "2020-09-15T15:10:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODYwMDYyOQ=="}], "type": "inlineReview"}, {"oid": "53d396e86a3af14713e9ecfb05426c6696b71d7e", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/53d396e86a3af14713e9ecfb05426c6696b71d7e", "message": "Add a generic type for the key on the ImmutableKeyValuePairs.\nThis necessitated changing the `get` to `getValue` to avoid clashing with the java.util.Map interface.\nAlso introduced convenience sub-interfaces for consuming labels and attributes, so consumers don't have to worry about the types if they don't want to.", "committedDate": "2020-09-17T15:00:56Z", "type": "commit"}, {"oid": "03db6d1f81c986dd7f63db5fc5a37cdce641e862", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/03db6d1f81c986dd7f63db5fc5a37cdce641e862", "message": "Make AttributesMap not extend map, and restore the get method name for Attributes.", "committedDate": "2020-09-17T15:00:56Z", "type": "commit"}, {"oid": "ef6ba9662b6ffdb327a1e1f1b333b7971008e33a", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/ef6ba9662b6ffdb327a1e1f1b333b7971008e33a", "message": "key class and implementation", "committedDate": "2020-09-17T15:00:56Z", "type": "commit"}, {"oid": "e72fdb05cbb14104b6b8c2ad0d0836a0573f0ab9", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/e72fdb05cbb14104b6b8c2ad0d0836a0573f0ab9", "message": "key class and implementation", "committedDate": "2020-09-17T15:00:56Z", "type": "commit"}, {"oid": "2b6a07235eab40e9f15de3427277974e00865491", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/2b6a07235eab40e9f15de3427277974e00865491", "message": "The code compiles", "committedDate": "2020-09-17T15:00:57Z", "type": "commit"}, {"oid": "e5723812a2cd63cedc85551a4d20578f8fd9e16f", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/e5723812a2cd63cedc85551a4d20578f8fd9e16f", "message": "little tweaks", "committedDate": "2020-09-17T15:00:57Z", "type": "commit"}, {"oid": "230de0af164dce5e10f16f3aaed3f67a6c17329a", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/230de0af164dce5e10f16f3aaed3f67a6c17329a", "message": "some cleanup, tests are passing", "committedDate": "2020-09-17T15:00:57Z", "type": "commit"}, {"oid": "fc1154447a8e96f94dfa40b07243b0c6575318f1", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/fc1154447a8e96f94dfa40b07243b0c6575318f1", "message": "remove AttributeValue and clean up misc. references to it.", "committedDate": "2020-09-17T15:00:58Z", "type": "commit"}, {"oid": "01c89f1378693435cc8576a1ff668871e4a209bd", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/01c89f1378693435cc8576a1ff668871e4a209bd", "message": "clean up some unused bits", "committedDate": "2020-09-17T15:00:58Z", "type": "commit"}, {"oid": "a7dbe164cd0eb6e0b711d0a95f5bed752adb2ea7", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/a7dbe164cd0eb6e0b711d0a95f5bed752adb2ea7", "message": "add a TODO", "committedDate": "2020-09-17T15:00:58Z", "type": "commit"}, {"oid": "55e22bf092621bcacc4fac65006bada9e86185ff", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/55e22bf092621bcacc4fac65006bada9e86185ff", "message": "a bit of cleanup; fix a todo", "committedDate": "2020-09-17T15:00:58Z", "type": "commit"}, {"oid": "269e259e7b913a54408206624e8ec9ed55b7ae4d", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/269e259e7b913a54408206624e8ec9ed55b7ae4d", "message": "update for changes from the main branch", "committedDate": "2020-09-17T15:00:59Z", "type": "commit"}, {"oid": "1155c27505571494b01b5d3ec92c31b846f6c46c", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/1155c27505571494b01b5d3ec92c31b846f6c46c", "message": "Change method to get the underlying key.\nMove the key creators to a AttributesKeys class.\nHide the implementation classes and replace with interface use.", "committedDate": "2020-09-17T15:00:59Z", "type": "commit"}, {"oid": "e1ab103d1b4ef4d5e5ad9ac595a73ca68eccb2bb", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/e1ab103d1b4ef4d5e5ad9ac595a73ca68eccb2bb", "message": "use autovalue for the key implementations", "committedDate": "2020-09-17T15:00:59Z", "type": "commit"}, {"oid": "cac0ae57ee960f47bda26029339db0e49acd1516", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/cac0ae57ee960f47bda26029339db0e49acd1516", "message": "fix javadoc issues", "committedDate": "2020-09-17T15:00:59Z", "type": "commit"}, {"oid": "d98eb2a08678c667b5465bf01ae57b4d803996a4", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/d98eb2a08678c667b5465bf01ae57b4d803996a4", "message": "update benchmark keys, and a few tweaks from PR review", "committedDate": "2020-09-17T15:00:59Z", "type": "commit"}, {"oid": "77f0fb5698d16d1f0e05f0fba0261b45e423b51e", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/77f0fb5698d16d1f0e05f0fba0261b45e423b51e", "message": "Add javadoc notes to encourage using the lower-overhead attribute options.", "committedDate": "2020-09-17T15:01:00Z", "type": "commit"}, {"oid": "8f1f871588e911f7d2bae7de0594c2d162b6d4e9", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/8f1f871588e911f7d2bae7de0594c2d162b6d4e9", "message": "Add javadoc clarifying subclass responsibilities around empty keys.", "committedDate": "2020-09-17T15:01:00Z", "type": "commit"}, {"oid": "dc86d829b11e2441d6d2668e004b1588edca8949", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/dc86d829b11e2441d6d2668e004b1588edca8949", "message": "make the compareTo on AttributeKeyImpl null-safe, for extra safety", "committedDate": "2020-09-17T15:01:00Z", "type": "commit"}, {"oid": "dc86d829b11e2441d6d2668e004b1588edca8949", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/dc86d829b11e2441d6d2668e004b1588edca8949", "message": "make the compareTo on AttributeKeyImpl null-safe, for extra safety", "committedDate": "2020-09-17T15:01:00Z", "type": "forcePushed"}, {"oid": "529c15f0b84b38ac9ab318b424495944e633ad16", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/529c15f0b84b38ac9ab318b424495944e633ad16", "message": "Merge branch 'master' into keyed_attribute_step_2", "committedDate": "2020-09-21T14:48:05Z", "type": "commit"}, {"oid": "40f54ae9431320a61fa256b1fbf6cbf4b5073d1a", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/40f54ae9431320a61fa256b1fbf6cbf4b5073d1a", "message": "fix formatting", "committedDate": "2020-09-21T15:32:14Z", "type": "commit"}]}