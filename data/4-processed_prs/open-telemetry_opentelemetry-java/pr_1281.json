{"pr_number": 1281, "pr_title": "Apply bom imports only if needed", "pr_createdAt": "2020-05-28T11:01:06Z", "pr_url": "https://github.com/open-telemetry/opentelemetry-java/pull/1281", "timeline": [{"oid": "2834f4b2dc1074b0fb31cc1182a81496e07d34b3", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/2834f4b2dc1074b0fb31cc1182a81496e07d34b3", "message": "Apply bom imports only if needed", "committedDate": "2020-05-28T10:56:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTc2ODczMg==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1281#discussion_r431768732", "bodyText": "I don't think we want enforce versions for all grpc components for all artifacts. But probably this is a (serious) issue that will only be resolved with #575. That is, even though we \"only\" depend on grpc-context, we force every user of the API to only use grpc versions (including other artifacts) that can work together with our grpc-context version. BTW, if grpc also depends on the proposed \"propagation.io\" context, we will still have the same problem.", "author": "Oberon00", "createdAt": "2020-05-28T11:33:18Z", "path": "build.gradle", "diffHunk": "@@ -180,10 +180,7 @@ configure(opentelemetryProjects) {\n \n     dependencies {\n \n-        implementation platform(boms.grpc),\n-                platform(boms.guava),\n-                platform(boms.protobuf),\n-                platform(boms.zipkin_reporter)\n+        implementation platform(boms.grpc)", "originalCommit": "2834f4b2dc1074b0fb31cc1182a81496e07d34b3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTg0NDQ4NA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1281#discussion_r431844484", "bodyText": "Not sure I understand the latest concern. Can you elaborate why it will be the same problem?", "author": "bogdandrutu", "createdAt": "2020-05-28T13:43:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTc2ODczMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTg2NTE4NA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1281#discussion_r431865184", "bodyText": "Any user of propagation-io-context still needs to use a propagation-io-context version compatible with the grpc version they use. It's not the same problem with BOMs but that fundamental problem remains.", "author": "Oberon00", "createdAt": "2020-05-28T14:10:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTc2ODczMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTg2NzM1NQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1281#discussion_r431867355", "bodyText": "If the user uses a grpc BOM, that BOM should include propagation-io-context and would override the version declared by opentelemetry-api.\nOn second thought, as for this PR, I think we should just not use the GRPC bom. BOMs for ensuring that all the versions of related dependencies match. But we want to depend only on a single dependency, namely the context. So there is nothing we could be incompatible with. If the user uses a grpc bom, it will override the API grpc version, which can be bad (see first paragraph of this comment, and my previous comment), but arguably better than opentelemetry-api overriding the grpc version of a user who does not use BOMs (not sure if that's the case).", "author": "Oberon00", "createdAt": "2020-05-28T14:14:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTc2ODczMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTg2ODcyMQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1281#discussion_r431868721", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    implementation platform(boms.grpc)", "author": "Oberon00", "createdAt": "2020-05-28T14:16:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTc2ODczMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTg3MDQzNg==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1281#discussion_r431870436", "bodyText": "we should use the bom for otlp exporter probably but not for API, I think that is what you say. Also user can overwrite all the versions by using their own bom. A bom ensures that all the versions for a set of artifacts are the same, user can still overwrite the bom version.", "author": "bogdandrutu", "createdAt": "2020-05-28T14:18:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTc2ODczMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTg3MzE2MA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1281#discussion_r431873160", "bodyText": "We use several grpc artifacts, e.g. grpc-protobuf and grpc-stub. So using bom to align their version seems like a totally sensible thing to do. The only concern that I raised and try to solve with this PR, is the unneeded dependency in api, which breaks api clients, such as otel auto-instrumentation agent. All other concerns regarding artifacts dependencies can be addressed separately, if they signal the actual problems.", "author": "iNikem", "createdAt": "2020-05-28T14:22:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTc2ODczMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTg3NTM4MA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1281#discussion_r431875380", "bodyText": "I agree we should use the grpc BOM for anything that actually uses grpc. But here it is applied to all artifacts, including API and SDK.", "author": "Oberon00", "createdAt": "2020-05-28T14:24:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTc2ODczMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTg4NTM0OQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1281#discussion_r431885349", "bodyText": "api uses context_prop which uses grpc.", "author": "iNikem", "createdAt": "2020-05-28T14:35:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTc2ODczMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTkxMDAzMQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1281#discussion_r431910031", "bodyText": "From  #575 I got the impression that we should treat grpc-context as \"not actually grpc but just in the same group\". Anyway, the api uses a single artifact from that BOM so I think the following choices are equally valid technically:\n\nUse the BOM for api. Then any consumers of api using gprc will be forced (by default; I know now this can be overriden) to use a grpc compatible with the grpc-context that the API uses.\nDon't use the BOM for api. Then any consumers of api using grpc will use whatever version of grpc they declared. If that version is incompatible with our grpc-context, I'm not sure what will happen.", "author": "Oberon00", "createdAt": "2020-05-28T15:06:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTc2ODczMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTkzNDQ5MQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1281#discussion_r431934491", "bodyText": "Don't use the BOM for api.\n\n+1 on this. This would simplify things overall (which is exactly what we need for the API case).", "author": "carlosalberto", "createdAt": "2020-05-28T15:39:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTc2ODczMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTk0NjQzMg==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1281#discussion_r431946432", "bodyText": "That would mean removing all shared dependency management related stuff from api. I cannot even write api libraries.grpc_context then, but have to spell it out api \"io.grpc:grpc-context:${grpcVersion}\". Are you sure? :)", "author": "iNikem", "createdAt": "2020-05-28T15:56:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTc2ODczMg=="}], "type": "inlineReview"}]}