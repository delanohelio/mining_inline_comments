{"pr_number": 1444, "pr_title": "Add ParentOrElse Sampler", "pr_createdAt": "2020-07-22T01:16:17Z", "pr_url": "https://github.com/open-telemetry/opentelemetry-java/pull/1444", "timeline": [{"oid": "7fbae9f38272197de6710757ccdcf9c224a15a38", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/7fbae9f38272197de6710757ccdcf9c224a15a38", "message": "Fix bug where Sampling status would not propagate from parent to child correctly", "committedDate": "2020-07-22T01:08:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ5NDA5NQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1444#discussion_r458494095", "bodyText": "It seems like follow parent should be a setting on any sampler, or we should support multiple samplers where any sampler can return something like NO_DECISION to allow another sampler to pick it up. Always yes seems to be unrelated to following the parent, right?", "author": "anuraaga", "createdAt": "2020-07-22T02:18:40Z", "path": "sdk/src/main/java/io/opentelemetry/sdk/trace/Samplers.java", "diffHunk": "@@ -176,6 +189,32 @@ public String getDescription() {\n     }\n   }\n \n+  @Immutable\n+  private enum FollowParentSampler implements Sampler {\n+    INSTANCE;\n+\n+    // If a parent is set, always follows the same sampling decision as the parent.\n+    // Otherwise, always makes a \"yes\" decision on {@link Span} sampling.", "originalCommit": "7fbae9f38272197de6710757ccdcf9c224a15a38", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODUxNjE2NA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1444#discussion_r458516164", "bodyText": "Oops just jumped through bogdan's link, yeah shouldn't we use parentorelse instead of adding this sampler?\nI would argue ParentOrElse(AlwaysOn) should be the default for the SDK though", "author": "anuraaga", "createdAt": "2020-07-22T03:44:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ5NDA5NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTEyNzk0Mg==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1444#discussion_r459127942", "bodyText": "@anuraaga can we argue in a separate PR? :)", "author": "bogdandrutu", "createdAt": "2020-07-22T22:52:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ5NDA5NQ=="}], "type": "inlineReview"}, {"oid": "136c15b444f159d08cda009f789caa15ac96a109", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/136c15b444f159d08cda009f789caa15ac96a109", "message": "use generic parentorelse sampler instead", "committedDate": "2020-07-22T22:45:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTEyNzcxOA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1444#discussion_r459127718", "bodyText": "I know I am annoying, but can we do this in a followup PR? This is an important change and would like to make sure everyone aggress on, just adding the parentElse is trivial to be merged.", "author": "bogdandrutu", "createdAt": "2020-07-22T22:51:24Z", "path": "sdk/src/main/java/io/opentelemetry/sdk/trace/config/TraceConfig.java", "diffHunk": "@@ -82,8 +82,7 @@\n @Immutable\n public abstract class TraceConfig {\n   // These values are the default values for all the global parameters.\n-  // TODO: decide which default sampler to use\n-  private static final Sampler DEFAULT_SAMPLER = Samplers.alwaysOn();\n+  private static final Sampler DEFAULT_SAMPLER = Samplers.parentOrElse(Samplers.alwaysOn());", "originalCommit": "136c15b444f159d08cda009f789caa15ac96a109", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTEyODc3NQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1444#discussion_r459128775", "bodyText": "That's totally fine! I hadn't realized initially that the default was already set in the spec - I can also create an issue in the spec repo to discuss this instead of doing it in a followup PR here if that makes more sense?", "author": "MitchellDumovic", "createdAt": "2020-07-22T22:54:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTEyNzcxOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTE3MDQ3MQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1444#discussion_r459170471", "bodyText": "I added an issue to the spec repo to discuss this: open-telemetry/opentelemetry-specification#728 cc @anuraaga\nOne thing that I admit to being confused about is how the sampler is meant to interact with the TraceFlags, which is slightly inconsistent across languages. If anyone can clear up some of the inconsistencies for me that would be helpful.", "author": "MitchellDumovic", "createdAt": "2020-07-23T01:25:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTEyNzcxOA=="}], "type": "inlineReview"}, {"oid": "0816e91676574861264cd1aba6da8d22b5072f20", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/0816e91676574861264cd1aba6da8d22b5072f20", "message": "bring back alwayson as default sampler", "committedDate": "2020-07-22T22:58:08Z", "type": "commit"}]}