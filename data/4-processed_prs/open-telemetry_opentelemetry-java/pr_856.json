{"pr_number": 856, "pr_title": "Add MetricProducer interface and explain how to use", "pr_createdAt": "2020-02-13T19:07:42Z", "pr_url": "https://github.com/open-telemetry/opentelemetry-java/pull/856", "timeline": [{"oid": "f60e270655e7d7f8dcd4c78d7dd65ff0ee318fa9", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/f60e270655e7d7f8dcd4c78d7dd65ff0ee318fa9", "message": "Add MetriProducer interface and explain how to use\n\nSigned-off-by: Bogdan Cristian Drutu <bogdandrutu@gmail.com>", "committedDate": "2020-02-13T19:07:27Z", "type": "commit"}, {"oid": "a2321ed31a4861f5ca2fa970c70105559ed74405", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/a2321ed31a4861f5ca2fa970c70105559ed74405", "message": "Clarify comment fro MetriExport.\n\nSigned-off-by: Bogdan Cristian Drutu <bogdandrutu@gmail.com>", "committedDate": "2020-02-13T19:17:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTA2NjMzOQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/856#discussion_r379066339", "bodyText": "add a comment before this like //fill up the buffer with metrics", "author": "jkwatson", "createdAt": "2020-02-13T19:18:42Z", "path": "sdk/src/main/java/io/opentelemetry/sdk/metrics/export/README.md", "diffHunk": "@@ -0,0 +1,98 @@\n+# OpenTelemetry metrics export framework\n+\n+The metrics world split between \"pushed based\" and \"pull based\" libraries and backends, and because\n+of this, the OpenTelemetry export framework needs to address all the possible combinations.\n+\n+To achieve the support for \"pushed based\" and \"pull based\" libraries the OpenTelemetry defines two\n+interfaces that helps with this:\n+* MetricProducer - is the interface that a \"pull based\" library should implement in order to make\n+data available to OpenTelemetry exporters.\n+* MetricExporter - is an interface that every OpenTelemetry exporter should implement in order to\n+allow \"push based\" libraries to push metrics to the backend.\n+\n+Here are some examples on how different libraries will interact with pull/push backends.\n+\n+**Push backend:**\n+\n+```java\n+import io.opentelemetry.sdk.metrics.export.MetricExporter;\n+import io.opentelemetry.sdk.metrics.export.MetricProducer;\n+\n+/**\n+ * Simple implementation of the MetricExporter that pushes data to the backend.\n+ */\n+public final class PushMetricExporter implements MetricExporter {  \n+  @Override\n+  ResultCode export(Collection<MetricData> metrics) {\n+    // A \"push based\" library calls to export metrics\n+    return pushToBackend(metrics);\n+  }\n+}\n+\n+/**\n+ * Class that periodically reads from all MetricProducers and pushes metrics using the\n+ * PushMetricExporter.\n+ */\n+public final class PushExporter {\n+  private final PushMetricExporter metricExporter;\n+  // IntervalMetricReader reads metrics from all producers periodically.\n+  private final IntervalMetricReader intervalMetricReader;\n+\n+  public PushExporter(Collection<MetricProducer> producers) {\n+    metricExporter = new PushMetricExporter();\n+    intervalMetricReader =\n+        new IntervalMetricReader(producers, metricExporter, 60 /* export interval sec*/);\n+  }\n+  \n+  // Can be accessed by any \"push based\" library to export metrics.\n+  public MetricExporter getMetricExporter() {\n+    return metricExporter;\n+  }\n+}\n+```\n+\n+**Pull backend:**\n+\n+```java\n+import io.opentelemetry.sdk.metrics.export.MetricExporter;\n+import io.opentelemetry.sdk.metrics.export.MetricProducer;import java.util.ArrayList;import java.util.Collections;\n+\n+/**\n+ * Simple implementation of the MetricExporter that stores data in memory and makes them available\n+ * via MetricProducer interface.\n+ */\n+public final class PullMetricExporter implements MetricExporter, MetricProducer {\n+  private final List<MetricData> metricsBuffer = new ArrayList<>();\n+\n+  @Override\n+  synchronized ResultCode export(Collection<MetricData> metrics) {\n+    metricsBuffer.addAll(metrics);\n+    return ResultCode.SUCCESS;\n+  }\n+  \n+  synchronized Collection<MetricData> getAllMetrics() {\n+    List<MetricData> ret = metricsBuffer;\n+    metricsBuffer = new ArrayList<>();\n+    return ret;", "originalCommit": "f60e270655e7d7f8dcd4c78d7dd65ff0ee318fa9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTExNDA4NQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/856#discussion_r379114085", "bodyText": "I think it is filled by the line 76, am I missing something?", "author": "bogdandrutu", "createdAt": "2020-02-13T20:57:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTA2NjMzOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTExNTk0NQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/856#discussion_r379115945", "bodyText": "oh, I totally misread this. You're right, carry on.", "author": "jkwatson", "createdAt": "2020-02-13T21:01:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTA2NjMzOQ=="}], "type": "inlineReview"}, {"oid": "9b17ead33b211c4f63715abab5600b8b2875ff65", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/9b17ead33b211c4f63715abab5600b8b2875ff65", "message": "Fix imports in pull example\n\nSigned-off-by: Bogdan Cristian Drutu <bogdandrutu@gmail.com>", "committedDate": "2020-02-13T20:12:26Z", "type": "commit"}]}