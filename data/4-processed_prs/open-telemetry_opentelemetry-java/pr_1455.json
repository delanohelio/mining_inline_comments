{"pr_number": 1455, "pr_title": "Added preliminary documentation for the zPages contrib module", "pr_createdAt": "2020-07-23T19:54:32Z", "pr_url": "https://github.com/open-telemetry/opentelemetry-java/pull/1455", "timeline": [{"oid": "ec31e3e9cb0212c75133331290246b258f445b13", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/ec31e3e9cb0212c75133331290246b258f445b13", "message": "Removed URLEncoder", "committedDate": "2020-07-18T00:27:58Z", "type": "commit"}, {"oid": "e0fe0ede7bbd0e660feab6b0eac647f972224a12", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/e0fe0ede7bbd0e660feab6b0eac647f972224a12", "message": "Fixed typo", "committedDate": "2020-07-18T00:44:15Z", "type": "commit"}, {"oid": "cf7f5c8f7890ffb19aabcd675ca4bcc7f4a5739a", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/cf7f5c8f7890ffb19aabcd675ca4bcc7f4a5739a", "message": "Added URLDecoding", "committedDate": "2020-07-20T21:20:21Z", "type": "commit"}, {"oid": "9db8e7e6edd7b8188fe3b4deda6b091cf2f92a66", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/9db8e7e6edd7b8188fe3b4deda6b091cf2f92a66", "message": "Included comment for string replacement", "committedDate": "2020-07-20T21:29:32Z", "type": "commit"}, {"oid": "412797843fe71d406538cd0173d414afd3872019", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/412797843fe71d406538cd0173d414afd3872019", "message": "Added unit tests for special characters in span names", "committedDate": "2020-07-20T23:50:41Z", "type": "commit"}, {"oid": "e17c337050a0c57947eea07b53c36393805fc3e3", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/e17c337050a0c57947eea07b53c36393805fc3e3", "message": "Resolved URL decoding issues", "committedDate": "2020-07-21T20:34:47Z", "type": "commit"}, {"oid": "bb58b26018ed710133ff0493894b58d70b977640", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/bb58b26018ed710133ff0493894b58d70b977640", "message": "Moved url decoding to parseQueryMap and updated the corresponding unit tests", "committedDate": "2020-07-21T22:08:18Z", "type": "commit"}, {"oid": "80a5ccf2b19dbdb2cd3fad4a968962318131883f", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/80a5ccf2b19dbdb2cd3fad4a968962318131883f", "message": "Added a README file for zPage quickstart", "committedDate": "2020-07-22T20:39:04Z", "type": "commit"}, {"oid": "dcbd9aa23db84e85639a17f02f25d2e54d5b5f4b", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/dcbd9aa23db84e85639a17f02f25d2e54d5b5f4b", "message": "Add images for README", "committedDate": "2020-07-22T20:42:13Z", "type": "commit"}, {"oid": "24ffce2bb7b6a24ba3ad8e86e476710be7ccd76a", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/24ffce2bb7b6a24ba3ad8e86e476710be7ccd76a", "message": "Updated README", "committedDate": "2020-07-22T21:02:18Z", "type": "commit"}, {"oid": "5047849b2843b486649d3a286cc36ab627f76901", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/5047849b2843b486649d3a286cc36ab627f76901", "message": "Add frontend images", "committedDate": "2020-07-22T21:52:04Z", "type": "commit"}, {"oid": "85a539ed8b5539985017b3a96e9539dd11f70aa1", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/85a539ed8b5539985017b3a96e9539dd11f70aa1", "message": "Add backend images", "committedDate": "2020-07-22T22:05:05Z", "type": "commit"}, {"oid": "4156123799670059e9ea44cb1a0174b8a65c9aed", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/4156123799670059e9ea44cb1a0174b8a65c9aed", "message": "Added our design doc", "committedDate": "2020-07-22T23:32:06Z", "type": "commit"}, {"oid": "265cf27c704f368c0b28c04c555568f1be926e9a", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/265cf27c704f368c0b28c04c555568f1be926e9a", "message": "Added details on package", "committedDate": "2020-07-23T17:19:22Z", "type": "commit"}, {"oid": "c102e45b016ccb12458c3f657fe8cf64c0cc5d2a", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/c102e45b016ccb12458c3f657fe8cf64c0cc5d2a", "message": "Reworded a few lines", "committedDate": "2020-07-23T19:17:16Z", "type": "commit"}, {"oid": "e977dcf1146700915bbe6d1a2d095aaa79ed131f", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/e977dcf1146700915bbe6d1a2d095aaa79ed131f", "message": "Merge branch 'master' of https://github.com/open-telemetry/opentelemetry-java into master", "committedDate": "2020-07-23T19:26:44Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTg3NTE5Nw==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1455#discussion_r459875197", "bodyText": "There is a proposal for a docs folder here\n#1397 (comment)\nI think for historical reference docs like design docs it could be nice to separate it away from the code. What do you think about moving it there?", "author": "anuraaga", "createdAt": "2020-07-24T06:36:33Z", "path": "sdk_extensions/zpages/DESIGN.md", "diffHunk": "@@ -0,0 +1,175 @@\n+# OpenTelemetry SDK Contrib - /tracez and /traceconfigz Design Doc", "originalCommit": "e977dcf1146700915bbe6d1a2d095aaa79ed131f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDE3NzE3Ng==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1455#discussion_r460177176", "bodyText": "Sure, that sounds good to me. I'll rename the file to be more specific to /tracez.", "author": "williamhu99", "createdAt": "2020-07-24T17:01:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTg3NTE5Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTg3NTQzMw==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1455#discussion_r459875433", "bodyText": "Let's stick with implementation for all of them", "author": "anuraaga", "createdAt": "2020-07-24T06:37:27Z", "path": "sdk_extensions/zpages/README.md", "diffHunk": "@@ -2,8 +2,100 @@\n \n [![Javadocs][javadoc-image]][javadoc-url]\n \n-This module contains code for OpenTelemetry's Java zPages.\n+This module contains code for OpenTelemetry's Java zPages, which are a collection of dynamic HTML\n+web pages that display stats and trace data.\n+\n+* Java 7 compatible.\n \n <!--- TODO: Update javadoc -->\n [javadoc-image]: https://www.javadoc.io/badge/io.opentelemetry/opentelemetry-sdk-contrib-auto-config.svg\n [javadoc-url]: https://www.javadoc.io/doc/io.opentelemetry/opentelemetry-sdk-contrib-auto-config\n+\n+## Quickstart\n+\n+### Add the dependencies to your project\n+\n+For Maven, add the following to your `pom.xml`:\n+```xml\n+<dependencies>\n+  <dependency>\n+        <groupId>io.opentelemetry</groupId>\n+        <artifactId>opentelemetry-api</artifactId>\n+        <version>0.7.0</version>\n+      </dependency>\n+      <dependency>\n+        <groupId>io.opentelemetry</groupId>\n+        <artifactId>opentelemetry-sdk</artifactId>\n+        <version>0.7.0</version>\n+      </dependency>\n+      <dependency>\n+        <groupId>io.opentelemetry</groupId>\n+        <artifactId>opentelemetry-sdk-extension-zpages</artifactId>\n+        <version>0.7.0</version>\n+      </dependency>\n+</dependencies>\n+```\n+\n+<!--- TODO: Verify gradle configuration -->\n+For Gradle, add the following to your dependencies:\n+```groovy\n+api 'io.opentelemetry:opentelemetry-api:0.7.0'", "originalCommit": "e977dcf1146700915bbe6d1a2d095aaa79ed131f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTg3NjE4Ng==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1455#discussion_r459876186", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            **Note:** The package `com.sun.net.httpserver` is required to use zPages. Please make sure your\n          \n          \n            \n            **Note:** The package `com.sun.net.httpserver` is required to use the default zPages setup. Please make sure your\n          \n      \n    \n    \n  \n\nIt's technically not required if users mount the pages to their own server, which hopefully will be fairly common.", "author": "anuraaga", "createdAt": "2020-07-24T06:39:29Z", "path": "sdk_extensions/zpages/README.md", "diffHunk": "@@ -2,8 +2,100 @@\n \n [![Javadocs][javadoc-image]][javadoc-url]\n \n-This module contains code for OpenTelemetry's Java zPages.\n+This module contains code for OpenTelemetry's Java zPages, which are a collection of dynamic HTML\n+web pages that display stats and trace data.\n+\n+* Java 7 compatible.\n \n <!--- TODO: Update javadoc -->\n [javadoc-image]: https://www.javadoc.io/badge/io.opentelemetry/opentelemetry-sdk-contrib-auto-config.svg\n [javadoc-url]: https://www.javadoc.io/doc/io.opentelemetry/opentelemetry-sdk-contrib-auto-config\n+\n+## Quickstart\n+\n+### Add the dependencies to your project\n+\n+For Maven, add the following to your `pom.xml`:\n+```xml\n+<dependencies>\n+  <dependency>\n+        <groupId>io.opentelemetry</groupId>\n+        <artifactId>opentelemetry-api</artifactId>\n+        <version>0.7.0</version>\n+      </dependency>\n+      <dependency>\n+        <groupId>io.opentelemetry</groupId>\n+        <artifactId>opentelemetry-sdk</artifactId>\n+        <version>0.7.0</version>\n+      </dependency>\n+      <dependency>\n+        <groupId>io.opentelemetry</groupId>\n+        <artifactId>opentelemetry-sdk-extension-zpages</artifactId>\n+        <version>0.7.0</version>\n+      </dependency>\n+</dependencies>\n+```\n+\n+<!--- TODO: Verify gradle configuration -->\n+For Gradle, add the following to your dependencies:\n+```groovy\n+api 'io.opentelemetry:opentelemetry-api:0.7.0'\n+api 'io.opentelemetry:opentelemetry-sdk:0.7.0'\n+implementation 'io.opentelemetry:opentelemetry-sdk-extension-zpages:0.7.0'\n+```\n+\n+### Register the zPages\n+\n+**Note:** The package `com.sun.net.httpserver` is required to use zPages. Please make sure your", "originalCommit": "e977dcf1146700915bbe6d1a2d095aaa79ed131f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDA4MTM2Nw==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1455#discussion_r460081367", "bodyText": "private static HttpServer server; (import com.sun.net.httpserver.HttpServer).\nEven with a variable like this, if the users mount to their own server, com.sun.net.httpserver is not required anymore?", "author": "wtyanan", "createdAt": "2020-07-24T14:17:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTg3NjE4Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDA4NDQ5Mw==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1455#discussion_r460084493", "bodyText": "Java is surprisingly lazy, but indeed because it's static I think the answer is no. Can we go ahead and fix it so it's not required? It just means separating out a class that manages the span processor and having only a small class dealing with the server", "author": "anuraaga", "createdAt": "2020-07-24T14:22:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTg3NjE4Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDA4ODYxMQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1455#discussion_r460088611", "bodyText": "Sorry I didn't entirely get what you meant, should we separate the current ZPageServer class somehow?", "author": "wtyanan", "createdAt": "2020-07-24T14:29:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTg3NjE4Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDM1MDQxNw==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1455#discussion_r460350417", "bodyText": "Yeah I think if we separate initialization of span processors to a separate class, the hard dependency on sun server can be avoided. But that can be a follow-up for after this PR.", "author": "anuraaga", "createdAt": "2020-07-25T01:58:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTg3NjE4Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTc4MDA2NA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1455#discussion_r465780064", "bodyText": "Quick question regarding making HttpServer not hard required. Should I separate out\nprivate static HttpServer server;\n...\npublic static void startHttpServerAndRegisterAllPages(int port) throws IOException {}\n\nto a different file. And keep the register function\npublic static void registerAllPagesToHttpServer(HttpServer server) {}\n\nWill the HttpServer type parameter still make sun package hard required?", "author": "wtyanan", "createdAt": "2020-08-05T14:44:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTg3NjE4Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjE4ODM2Mg==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1455#discussion_r466188362", "bodyText": "I think the method users will need when not using HttpServer is\nhttps://github.com/open-telemetry/opentelemetry-java/blob/master/sdk_extensions/zpages/src/main/java/io/opentelemetry/sdk/extensions/zpages/ZPageServer.java#L91\nSo if that was moved to a separate class the hard dependency should be gone I believe.", "author": "anuraaga", "createdAt": "2020-08-06T07:03:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTg3NjE4Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjYxNjI2Mg==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1455#discussion_r466616262", "bodyText": "How do they use zPages at all then with the current implementation?", "author": "wtyanan", "createdAt": "2020-08-06T18:48:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTg3NjE4Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjgxNzk4OQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1455#discussion_r466817989", "bodyText": "Haven't actually compiled this code but for example, if using Armeria, it would look something like this\nclass ZPageService implements HttpService {\n  private final ZPageHandler handler;\n\n  public HttpResponse service(ServiceRequestContext ctx, HttpRequest req) {\n    Map<String, String> params = ctx.routingContext().queryParams().stream().collect(toMap());\n    ByteBufOutputStream payload = new ByteBufOutputStream();\n    handler.emitHtml(params, payload);\n    return HttpResponse.of(RequestHeaders.of(HttpStatus.OK), HttpData.wrap(payload.buf()));\n  }\n}\nZPages.registerSpanProcessors();\n\nServerBuilder server = Server.builder();\nfor (ZPageHandler handler : ZPages.getAllHandlers()) {\n  server.service(handler.getUrlPath(), new ZPageService(handler);\n}\nserver.build().start();\nVery efficient zpages, all on the same port as my service :)", "author": "anuraaga", "createdAt": "2020-08-07T04:45:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTg3NjE4Ng=="}], "type": "inlineReview"}, {"oid": "ed8ef33353ece317374cb46b29209c030781460c", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/ed8ef33353ece317374cb46b29209c030781460c", "message": "Moved DESIGN.md to a docs folder and changed gradle config to implementation", "committedDate": "2020-07-24T17:09:38Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDM1MDUxOQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1455#discussion_r460350519", "bodyText": "Make a folder for zpages and put this and all the images inside it.", "author": "anuraaga", "createdAt": "2020-07-25T01:59:28Z", "path": "docs/TRACEZ_DESIGN.md", "diffHunk": "@@ -0,0 +1,175 @@\n+# OpenTelemetry SDK Contrib - /tracez and /traceconfigz Design Doc", "originalCommit": "ed8ef33353ece317374cb46b29209c030781460c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f595909769797804702ce7ccca807df9b177e197", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/f595909769797804702ce7ccca807df9b177e197", "message": "Changed wording regarding HttpServer requirement", "committedDate": "2020-07-27T14:34:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDkyNzY0Mw==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1455#discussion_r460927643", "bodyText": "Suggested edit:\nThe OpenTelemetry zPages are a set of dynamically generated HTML pages that display trace and\nmetrics data for a running process: the /tracez zPage displays\ntrace information about running spans, sample span latencies, and sample error spans, while the /traceconfigz zPage is a web page that allows the users to change tracing parameters, such\nas sampling probability and max number of attributes.", "author": "v-y-l", "createdAt": "2020-07-27T14:23:27Z", "path": "docs/TRACEZ_DESIGN.md", "diffHunk": "@@ -0,0 +1,175 @@\n+# OpenTelemetry SDK Contrib - /tracez and /traceconfigz Design Doc\n+\n+This file contains information about the design choices for the OpenTelemetry /tracez and\n+/traceconfigz zPages.\n+\n+## Introduction\n+\n+The OpenTelemetry zPages are a set of dynamically generated HTML pages that display trace and", "originalCommit": "ed8ef33353ece317374cb46b29209c030781460c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDkyODQ5Mw==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1455#discussion_r460928493", "bodyText": "This link seems to be broken.", "author": "v-y-l", "createdAt": "2020-07-27T14:24:32Z", "path": "docs/TRACEZ_DESIGN.md", "diffHunk": "@@ -0,0 +1,175 @@\n+# OpenTelemetry SDK Contrib - /tracez and /traceconfigz Design Doc\n+\n+This file contains information about the design choices for the OpenTelemetry /tracez and\n+/traceconfigz zPages.\n+\n+## Introduction\n+\n+The OpenTelemetry zPages are a set of dynamically generated HTML pages that display trace and\n+metrics data for a running process. Within this set, the /tracez zPage is a web page that displays\n+trace information about running spans, sample span latencies, and sample error spans. On the other\n+hand, the /traceconfigz zPage is a web page that allows the users to change tracing parameters, such\n+as sampling probability and max number of attributes.\n+\n+### /tracez zPage\n+\n+The /tracez zPage displays information on running spans, sample span latencies, and sample error\n+spans. The data is aggregated into a summary-level table:\n+\n+![tracez-table](img/tracez-table.png)\n+\n+In addition, you can click on each of the counts in the table cells to access the corresponding span\n+details. For example, here are the details of the `ChildSpan` latency sample (row 1, col 4):\n+\n+![tracez-details](img/tracez-details.png)", "originalCommit": "ed8ef33353ece317374cb46b29209c030781460c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDkzMDA5OA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1455#discussion_r460930098", "bodyText": "Nit: Leave out in addition", "author": "v-y-l", "createdAt": "2020-07-27T14:26:35Z", "path": "docs/TRACEZ_DESIGN.md", "diffHunk": "@@ -0,0 +1,175 @@\n+# OpenTelemetry SDK Contrib - /tracez and /traceconfigz Design Doc\n+\n+This file contains information about the design choices for the OpenTelemetry /tracez and\n+/traceconfigz zPages.\n+\n+## Introduction\n+\n+The OpenTelemetry zPages are a set of dynamically generated HTML pages that display trace and\n+metrics data for a running process. Within this set, the /tracez zPage is a web page that displays\n+trace information about running spans, sample span latencies, and sample error spans. On the other\n+hand, the /traceconfigz zPage is a web page that allows the users to change tracing parameters, such\n+as sampling probability and max number of attributes.\n+\n+### /tracez zPage\n+\n+The /tracez zPage displays information on running spans, sample span latencies, and sample error\n+spans. The data is aggregated into a summary-level table:\n+\n+![tracez-table](img/tracez-table.png)\n+\n+In addition, you can click on each of the counts in the table cells to access the corresponding span", "originalCommit": "ed8ef33353ece317374cb46b29209c030781460c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDkzMTUwOA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1455#discussion_r460931508", "bodyText": "Would this serve as the README.md page or is this something else? My personal take here is to keep this doc scoped to just a how-to guide and maybe a brief description of the different classes and what they do.\nSince we are publishing an entry to Google's Open Source blog, I think a deep explanation of design decisions would be more appropriate there. We could even link to the blog entry from here once it's published.", "author": "v-y-l", "createdAt": "2020-07-27T14:28:18Z", "path": "docs/TRACEZ_DESIGN.md", "diffHunk": "@@ -0,0 +1,175 @@\n+# OpenTelemetry SDK Contrib - /tracez and /traceconfigz Design Doc\n+\n+This file contains information about the design choices for the OpenTelemetry /tracez and\n+/traceconfigz zPages.\n+", "originalCommit": "ed8ef33353ece317374cb46b29209c030781460c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk0NDk4MQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1455#discussion_r460944981", "bodyText": "I believe this doc is specifically for design choices, how-to guide is the README.md file under sdk_extensions/zpages/", "author": "wtyanan", "createdAt": "2020-07-27T14:46:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDkzMTUwOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk0OTc2OA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1455#discussion_r460949768", "bodyText": "Yeah this design doc drove the implementation of zpages so we want to keep it here in the community repo to refer to the motivation and to keep the history collected.", "author": "anuraaga", "createdAt": "2020-07-27T14:52:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDkzMTUwOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDkzNDA2OA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1455#discussion_r460934068", "bodyText": "I think we can shrink this to a single sentence: We want to create a tool that lets users troubleshoot OpenTelemetry instrumentation that can also be used as a lightweight application performance monitoring tool.\nThe other stuff seems like it could become outdated. \"In addition, the implementation of the Java zPages can pave the way for future implementations in other languages, such as Python, which have yet to be built.\"", "author": "v-y-l", "createdAt": "2020-07-27T14:31:37Z", "path": "docs/TRACEZ_DESIGN.md", "diffHunk": "@@ -0,0 +1,175 @@\n+# OpenTelemetry SDK Contrib - /tracez and /traceconfigz Design Doc\n+\n+This file contains information about the design choices for the OpenTelemetry /tracez and\n+/traceconfigz zPages.\n+\n+## Introduction\n+\n+The OpenTelemetry zPages are a set of dynamically generated HTML pages that display trace and\n+metrics data for a running process. Within this set, the /tracez zPage is a web page that displays\n+trace information about running spans, sample span latencies, and sample error spans. On the other\n+hand, the /traceconfigz zPage is a web page that allows the users to change tracing parameters, such\n+as sampling probability and max number of attributes.\n+\n+### /tracez zPage\n+\n+The /tracez zPage displays information on running spans, sample span latencies, and sample error\n+spans. The data is aggregated into a summary-level table:\n+\n+![tracez-table](img/tracez-table.png)\n+\n+In addition, you can click on each of the counts in the table cells to access the corresponding span\n+details. For example, here are the details of the `ChildSpan` latency sample (row 1, col 4):\n+\n+![tracez-details](img/tracez-details.png)\n+\n+### /traceconfigz zPage\n+\n+The /traceconfigz zPage displays information about the currently active tracing configuration and \n+provides an interface for users to modify relevant parameters:\n+\n+![traceconfigz](img/traceconfigz.png)\n+\n+## Motivation\n+\n+At the moment, there are no zPages for the Java implementation of OpenTelemetry. The goal of this", "originalCommit": "ed8ef33353ece317374cb46b29209c030781460c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDkzODI1Mw==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1455#discussion_r460938253", "bodyText": "Not sure if this qualifier is necessary. I think the frontend + backend section are self-explanatory.", "author": "v-y-l", "createdAt": "2020-07-27T14:37:10Z", "path": "docs/TRACEZ_DESIGN.md", "diffHunk": "@@ -0,0 +1,175 @@\n+# OpenTelemetry SDK Contrib - /tracez and /traceconfigz Design Doc\n+\n+This file contains information about the design choices for the OpenTelemetry /tracez and\n+/traceconfigz zPages.\n+\n+## Introduction\n+\n+The OpenTelemetry zPages are a set of dynamically generated HTML pages that display trace and\n+metrics data for a running process. Within this set, the /tracez zPage is a web page that displays\n+trace information about running spans, sample span latencies, and sample error spans. On the other\n+hand, the /traceconfigz zPage is a web page that allows the users to change tracing parameters, such\n+as sampling probability and max number of attributes.\n+\n+### /tracez zPage\n+\n+The /tracez zPage displays information on running spans, sample span latencies, and sample error\n+spans. The data is aggregated into a summary-level table:\n+\n+![tracez-table](img/tracez-table.png)\n+\n+In addition, you can click on each of the counts in the table cells to access the corresponding span\n+details. For example, here are the details of the `ChildSpan` latency sample (row 1, col 4):\n+\n+![tracez-details](img/tracez-details.png)\n+\n+### /traceconfigz zPage\n+\n+The /traceconfigz zPage displays information about the currently active tracing configuration and \n+provides an interface for users to modify relevant parameters:\n+\n+![traceconfigz](img/traceconfigz.png)\n+\n+## Motivation\n+\n+At the moment, there are no zPages for the Java implementation of OpenTelemetry. The goal of this\n+project, as suggested by the title, is to create the TraceZ zPage for the Java SDK. The motivation\n+for this stems from the usefulness of zPages. Because of how they aggregate and display data, zPages\n+are great development tools for OpenTelemetry instrumentation and lightweight monitoring. In\n+addition, the implementation of the Java zPages can pave the way for future implementations in other\n+languages, such as Python, which have yet to be built.\n+\n+## Proposed Design\n+\n+We have divided the implementation of the /tracez and /traceconfigz zPages into two frontend-centric", "originalCommit": "ed8ef33353ece317374cb46b29209c030781460c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk2MzI0Ng==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1455#discussion_r460963246", "bodyText": "That is we can delete this Proposed Design section right?", "author": "wtyanan", "createdAt": "2020-07-27T15:11:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDkzODI1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTA2OTAyMA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1455#discussion_r461069020", "bodyText": "I'll remove it.", "author": "williamhu99", "createdAt": "2020-07-27T17:58:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDkzODI1Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDkzOTU0OQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1455#discussion_r460939549", "bodyText": "The information under the \"proposed design\" sections I think would make for good OSS blog post material. I will leave it to the maintainers to decide if they want to include design choices directly in this doc or elsewhere.", "author": "v-y-l", "createdAt": "2020-07-27T14:38:54Z", "path": "docs/TRACEZ_DESIGN.md", "diffHunk": "@@ -0,0 +1,175 @@\n+# OpenTelemetry SDK Contrib - /tracez and /traceconfigz Design Doc\n+\n+This file contains information about the design choices for the OpenTelemetry /tracez and\n+/traceconfigz zPages.\n+\n+## Introduction\n+\n+The OpenTelemetry zPages are a set of dynamically generated HTML pages that display trace and\n+metrics data for a running process. Within this set, the /tracez zPage is a web page that displays\n+trace information about running spans, sample span latencies, and sample error spans. On the other\n+hand, the /traceconfigz zPage is a web page that allows the users to change tracing parameters, such\n+as sampling probability and max number of attributes.\n+\n+### /tracez zPage\n+\n+The /tracez zPage displays information on running spans, sample span latencies, and sample error\n+spans. The data is aggregated into a summary-level table:\n+\n+![tracez-table](img/tracez-table.png)\n+\n+In addition, you can click on each of the counts in the table cells to access the corresponding span\n+details. For example, here are the details of the `ChildSpan` latency sample (row 1, col 4):\n+\n+![tracez-details](img/tracez-details.png)\n+\n+### /traceconfigz zPage\n+\n+The /traceconfigz zPage displays information about the currently active tracing configuration and \n+provides an interface for users to modify relevant parameters:\n+\n+![traceconfigz](img/traceconfigz.png)\n+\n+## Motivation\n+\n+At the moment, there are no zPages for the Java implementation of OpenTelemetry. The goal of this\n+project, as suggested by the title, is to create the TraceZ zPage for the Java SDK. The motivation\n+for this stems from the usefulness of zPages. Because of how they aggregate and display data, zPages\n+are great development tools for OpenTelemetry instrumentation and lightweight monitoring. In\n+addition, the implementation of the Java zPages can pave the way for future implementations in other\n+languages, such as Python, which have yet to be built.\n+\n+## Proposed Design\n+\n+We have divided the implementation of the /tracez and /traceconfigz zPages into two frontend-centric\n+and backend-centric components.\n+\n+### Frontend\n+\n+#### HttpHandler\n+\n+The `HttpHandler` is responsible for rendering corresponding HTML content. An abstract base class,\n+`ZPageHandler` (OpenCensus implementation), is implemented to standardize handlers for different\n+zPages. Each page will implement their own `ZPageHandler`, extending the base class, to generate the\n+corresponding HTML content for that page.\n+\n+![httphandler](img/httphandler.png)\n+\n+##### TraceZ Handler\n+\n+For the `TracezZPageHandler` class, the span data from `TracezDataAggregator` will be passed in when\n+an instance of the class is created. It will later be used to retrieve span information and display\n+the data in a table.\n+\n+##### TraceConfigZ Handler\n+\n+For the `TraceConfigzZPageHandler` class, the `TraceConfig` class will be used to change sampling\n+rate and tracing parameters.\n+\n+#### HttpServer\n+The `HttpServer` is responsible for listening to incoming requests, obtaining requested data, and\n+rendering corresponding HTML content. The `HttpServer` class from `com.sun.net` will be used to\n+handle http requests and responses on different routes (users need to ensure that they are using a\n+version of JDK that includes the `HttpServer` class; this requirement will be added to the README).\n+Once a request is received by the `HttpServer`, it will invoke the handle function which in turn\n+invokes the `emitHtml` function to render the HTML content.\n+\n+The `HttpServer` class utilizes `com.sun.net.httpserver` to create servers. Users need to ensure\n+that they are using a version of JDK that comes with the package.\n+\n+##### Handling Requests\n+\n+![requests-flowchart](img/requests-flowchart.png)\n+\n+### Backend\n+\n+#### Overview\n+\n+The proposed structure is encompassed by the following diagram:\n+\n+![span-lifecycle](img/span-lifecycle.png)\n+\n+Spans, which are the units of tracing, are monitored by a `SpanProcessor`. The `SpanProcessor` is\n+exposed to a `DataAggregator`, which can retrieve information about the spans through API calls.\n+Lastly, the frontend calls functions in the `DataAggregator` to obtain information needed for the\n+web page.\n+\n+#### SpanProcessor\n+\n+A `SpanProcessor` watches the lifecycle of each span, and its functions are called every time a span\n+starts or ends. For the /tracez zPage, I have implemented a `TracezSpanProcessor`, which will\n+maintain two data structures: a running span cache and a completed span cache.\n+\n+##### Visual Diagram\n+\n+Below is a visual diagram of the `TracezSpanProcessor` class:\n+\n+![span-processor-flowchart](img/span-processor-flowchart.png)\n+\n+When a span starts, it is first added to the `runningSpanCache`. Once that span ends, it is removed\n+from the `runningSpanCache` and added to the `completedSpanCache` as either a latency sample if\n+there are no errors or an error sample if there are.\n+\n+##### Initial Design", "originalCommit": "ed8ef33353ece317374cb46b29209c030781460c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTA2OTc3Mw==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1455#discussion_r461069773", "bodyText": "After reading the other OSS blog posts, I'm a little skeptical of whether we should include implementation details. Most of the posts just talk about a general overview of the product and then describe its use cases and how to start using it.", "author": "williamhu99", "createdAt": "2020-07-27T17:59:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDkzOTU0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE4NjQxNg==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1455#discussion_r461186416", "bodyText": "That sounds good with me.", "author": "v-y-l", "createdAt": "2020-07-27T21:40:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDkzOTU0OQ=="}], "type": "inlineReview"}, {"oid": "806b6322ef2e6440c0569e255ffa954cf97da42d", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/806b6322ef2e6440c0569e255ffa954cf97da42d", "message": "Added zpages folder under docs, resolved broken image links", "committedDate": "2020-07-27T15:12:53Z", "type": "commit"}, {"oid": "9e4dde8cdcae5bcd69322b04d30fd4b3d85887c2", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/9e4dde8cdcae5bcd69322b04d30fd4b3d85887c2", "message": "Resolved comments for the design md file", "committedDate": "2020-07-27T18:00:10Z", "type": "commit"}, {"oid": "86c2a517f201cc217acf5f747a62dd55078cafa1", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/86c2a517f201cc217acf5f747a62dd55078cafa1", "message": "Made a few wording changes", "committedDate": "2020-07-27T20:40:52Z", "type": "commit"}]}