{"pr_number": 2233, "pr_title": "Split global functionality into a separate class", "pr_createdAt": "2020-12-08T23:15:10Z", "pr_url": "https://github.com/open-telemetry/opentelemetry-java/pull/2233", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODkyMzIzMQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/2233#discussion_r538923231", "bodyText": "This is a big improvement. I think we need to compare with removing the getGlobalTracer type methods in favor of OpenTelemetry.get().getTracer() or OpenTelemetry.getGlobal().getTracer() or getGlobalOpentelemetry().getTracer() (static import). I think they're all fine, latter might lead to more testable user code by reducing the number of static methods involved.", "author": "anuraaga", "createdAt": "2020-12-09T00:58:07Z", "path": "api/all/src/main/java/io/opentelemetry/api/GlobalOpenTelemetry.java", "diffHunk": "@@ -0,0 +1,166 @@\n+/*\n+ * Copyright The OpenTelemetry Authors\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+\n+package io.opentelemetry.api;\n+\n+import static java.util.Objects.requireNonNull;\n+\n+import io.opentelemetry.api.metrics.Meter;\n+import io.opentelemetry.api.metrics.MeterProvider;\n+import io.opentelemetry.api.trace.Tracer;\n+import io.opentelemetry.api.trace.TracerProvider;\n+import io.opentelemetry.context.propagation.ContextPropagators;\n+import io.opentelemetry.spi.OpenTelemetryFactory;\n+import io.opentelemetry.spi.metrics.MeterProviderFactory;\n+import io.opentelemetry.spi.trace.TracerProviderFactory;\n+import javax.annotation.Nullable;\n+\n+/**\n+ * A global singleton for the entrypoint to telemetry functionality for tracing, metrics and\n+ * baggage.\n+ *\n+ * <p>The global singleton can be retrieved by {@link #get()}. The default for the returned {@link\n+ * OpenTelemetry}, if none has been set via {@link #set(OpenTelemetry)}, will be created with any\n+ * {@link OpenTelemetryFactory}, {@link TracerProviderFactory} or {@link MeterProviderFactory} found\n+ * on the classpath, or otherwise will be default, with no-op behavior.\n+ *\n+ * <p>If using the OpenTelemetry SDK, you may want to instantiate the {@link OpenTelemetry} to\n+ * provide configuration, for example of {@code Resource} or {@code Sampler}. See {@code\n+ * OpenTelemetrySdk} and {@code OpenTelemetrySdk.builder} for information on how to construct the\n+ * SDK {@link OpenTelemetry}.\n+ *\n+ * @see TracerProvider\n+ * @see MeterProvider\n+ * @see ContextPropagators\n+ */\n+public final class GlobalOpenTelemetry {", "originalCommit": "52a878f7d200b396572a931a34c8428a23e2b9b6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODkyNDY5OA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/2233#discussion_r538924698", "bodyText": "I would still not have the \"global\" functionality on the interface OpenTelemetry. Having this separation is a win in my opinion. Not sure I understand what comparison you are asking me to do.", "author": "bogdandrutu", "createdAt": "2020-12-09T01:01:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODkyMzIzMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjUyNTMzNg==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/2233#discussion_r542525336", "bodyText": "@anuraaga any further thoughts at this point? I'm inclined to this this PR the \ud83d\udc4d , but want to make sure your concerns are considered.", "author": "jkwatson", "createdAt": "2020-12-14T16:32:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODkyMzIzMQ=="}], "type": "inlineReview"}, {"oid": "32a1357a91a6d265cf888c282ac8518d7088e3fb", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/32a1357a91a6d265cf888c282ac8518d7088e3fb", "message": "Split global functionality into a separate class\n\nThis ensure clear separation of functionality. This PR does not change any functionality, it just restructures the code to separate global functionality from\nthe Default implementation. Also helps to ensure that Global initialization does not happen by mistake when working only with the default implementation.\n\nAlso it helps with methods like `OpenTelemetry.get()` and `OpenTelemetry.set()` to understand they are interacting with global instance\n\nSigned-off-by: Bogdan Drutu <bogdandrutu@gmail.com>", "committedDate": "2020-12-09T05:08:22Z", "type": "forcePushed"}, {"oid": "c6ef5dd3835703cd25030d233937d56ed4e47dc9", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/c6ef5dd3835703cd25030d233937d56ed4e47dc9", "message": "Split global functionality into a separate class\n\nThis ensure clear separation of functionality. This PR does not change any functionality, it just restructures the code to separate global functionality from\nthe Default implementation. Also helps to ensure that Global initialization does not happen by mistake when working only with the default implementation.\n\nAlso it helps with methods like `OpenTelemetry.get()` and `OpenTelemetry.set()` to understand they are interacting with global instance\n\nSigned-off-by: Bogdan Drutu <bogdandrutu@gmail.com>", "committedDate": "2020-12-09T05:14:44Z", "type": "forcePushed"}, {"oid": "c8a214a072962806bc4650818cdaf6ccfad8fb90", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/c8a214a072962806bc4650818cdaf6ccfad8fb90", "message": "Split global functionality into a separate class\n\nThis ensure clear separation of functionality. This PR does not change any functionality, it just restructures the code to separate global functionality from\nthe Default implementation. Also helps to ensure that Global initialization does not happen by mistake when working only with the default implementation.\n\nAlso it helps with methods like `OpenTelemetry.get()` and `OpenTelemetry.set()` to understand they are interacting with global instance\n\nSigned-off-by: Bogdan Drutu <bogdandrutu@gmail.com>", "committedDate": "2020-12-15T18:07:53Z", "type": "commit"}, {"oid": "c8a214a072962806bc4650818cdaf6ccfad8fb90", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/c8a214a072962806bc4650818cdaf6ccfad8fb90", "message": "Split global functionality into a separate class\n\nThis ensure clear separation of functionality. This PR does not change any functionality, it just restructures the code to separate global functionality from\nthe Default implementation. Also helps to ensure that Global initialization does not happen by mistake when working only with the default implementation.\n\nAlso it helps with methods like `OpenTelemetry.get()` and `OpenTelemetry.set()` to understand they are interacting with global instance\n\nSigned-off-by: Bogdan Drutu <bogdandrutu@gmail.com>", "committedDate": "2020-12-15T18:07:53Z", "type": "forcePushed"}]}