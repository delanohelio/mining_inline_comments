{"pr_number": 1338, "pr_title": "Convert the usages of the LabelSetSdk to use the Labels class.", "pr_createdAt": "2020-06-16T22:26:25Z", "pr_url": "https://github.com/open-telemetry/opentelemetry-java/pull/1338", "timeline": [{"oid": "0919877b3e97d6c9f67b868e8d9a102de6f65e95", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/0919877b3e97d6c9f67b868e8d9a102de6f65e95", "message": "Convert the usages of the LabelSetSdk to use the Labels class.", "committedDate": "2020-06-16T22:06:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTY2ODk4MQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1338#discussion_r441668981", "bodyText": "One of this 2 can be removed.", "author": "bogdandrutu", "createdAt": "2020-06-17T16:20:57Z", "path": "api/src/main/java/io/opentelemetry/common/Labels.java", "diffHunk": "@@ -102,6 +102,10 @@ public static Labels of(\n         key5, value5);\n   }\n \n+  public static Labels of(String[] keyValueLabelPairs) {\n+    return sortAndFilterToLabels((Object[]) keyValueLabelPairs);\n+  }\n+\n   private static Labels sortAndFilterToLabels(Object... data) {\n     return new AutoValue_Labels_ArrayBackedLabels(sortAndFilter(data));\n   }", "originalCommit": "0919877b3e97d6c9f67b868e8d9a102de6f65e95", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTcwMDE5NA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1338#discussion_r441700194", "bodyText": "yeah, it's a good point. If we move the metric APIs to use Labels explicitly, rather than varargs strings, I think we can get rid of the one I just added, altogether. I'll clean this up for this PR, though, since there no reason to have the extra method there for now.", "author": "jkwatson", "createdAt": "2020-06-17T17:11:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTY2ODk4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTcwNTU4Mw==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1338#discussion_r441705583", "bodyText": "We can do in a follow-up. Up to you to decide", "author": "bogdandrutu", "createdAt": "2020-06-17T17:21:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTY2ODk4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTcxNjA5NQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1338#discussion_r441716095", "bodyText": "yeah, let's do it in a follow-up. It's actually a bunch messier than I first suspected, due to some fun java reasons. :)", "author": "jkwatson", "createdAt": "2020-06-17T17:38:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTY2ODk4MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTY3MTYwMw==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1338#discussion_r441671603", "bodyText": "Please create an issue to revisit this logic and assign to me. seems we do unnecessary work.", "author": "bogdandrutu", "createdAt": "2020-06-17T16:25:14Z", "path": "exporters/prometheus/src/main/java/io/opentelemetry/exporters/prometheus/MetricAdapter.java", "diffHunk": "@@ -105,10 +105,18 @@ static Type toMetricFamilyType(MetricData.Descriptor.Type type) {\n     if (descriptor.getConstantLabels().size() != 0) {\n       constLabelNames = new ArrayList<>(descriptor.getConstantLabels().size());\n       constLabelValues = new ArrayList<>(descriptor.getConstantLabels().size());\n-      for (Map.Entry<String, String> entry : descriptor.getConstantLabels().entrySet()) {\n-        constLabelNames.add(toLabelName(entry.getKey()));\n-        constLabelValues.add(entry.getValue() == null ? \"\" : entry.getValue());\n-      }\n+      final List<String> finalConstLabelNames = constLabelNames;\n+      final List<String> finalConstLabelValues = constLabelValues;\n+      descriptor\n+          .getConstantLabels()\n+          .forEach(\n+              new KeyValueConsumer<String>() {\n+                @Override\n+                public void consume(String key, String value) {\n+                  finalConstLabelNames.add(toLabelName(key));\n+                  finalConstLabelValues.add(value == null ? \"\" : value);\n+                }\n+              });", "originalCommit": "0919877b3e97d6c9f67b868e8d9a102de6f65e95", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTcwMTkyMw==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1338#discussion_r441701923", "bodyText": "#1341", "author": "jkwatson", "createdAt": "2020-06-17T17:15:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTY3MTYwMw=="}], "type": "inlineReview"}]}