{"pr_number": 786, "pr_title": "Add JPA Persistence CI workflow", "pr_createdAt": "2020-05-21T16:27:07Z", "pr_url": "https://github.com/kiegroup/optaplanner/pull/786", "timeline": [{"oid": "ed8c1d01b214fea3d20c421ef4cc005c02216e79", "url": "https://github.com/kiegroup/optaplanner/commit/ed8c1d01b214fea3d20c421ef4cc005c02216e79", "message": "Add optaplanner-persistence-jpa ci workflow and test script", "committedDate": "2020-05-21T16:32:03Z", "type": "forcePushed"}, {"oid": "f3ce6af4a625c1ddb1b935193d2c840e4349eeed", "url": "https://github.com/kiegroup/optaplanner/commit/f3ce6af4a625c1ddb1b935193d2c840e4349eeed", "message": "Add CI workflow and script", "committedDate": "2020-05-22T14:41:38Z", "type": "forcePushed"}, {"oid": "32491f43996e5f95eae7f4323ac97095edf9800d", "url": "https://github.com/kiegroup/optaplanner/commit/32491f43996e5f95eae7f4323ac97095edf9800d", "message": "Add CI workflow and script", "committedDate": "2020-05-22T14:50:02Z", "type": "forcePushed"}, {"oid": "91192492aa0f7227bbafe5d05a3bdf206a41accc", "url": "https://github.com/kiegroup/optaplanner/commit/91192492aa0f7227bbafe5d05a3bdf206a41accc", "message": "Bulid with Maven", "committedDate": "2020-05-25T20:34:38Z", "type": "forcePushed"}, {"oid": "2d5c6858a67ee9bb339db8a4a70b2b2f6f67b2f1", "url": "https://github.com/kiegroup/optaplanner/commit/2d5c6858a67ee9bb339db8a4a70b2b2f6f67b2f1", "message": "Build with Maven", "committedDate": "2020-05-25T20:39:48Z", "type": "forcePushed"}, {"oid": "d7fab8a6ce2359319b8ef571268ae9e728ffa56b", "url": "https://github.com/kiegroup/optaplanner/commit/d7fab8a6ce2359319b8ef571268ae9e728ffa56b", "message": "Add JPA CI PostgreSQL container test workflow", "committedDate": "2020-06-02T17:02:39Z", "type": "commit"}, {"oid": "d7fab8a6ce2359319b8ef571268ae9e728ffa56b", "url": "https://github.com/kiegroup/optaplanner/commit/d7fab8a6ce2359319b8ef571268ae9e728ffa56b", "message": "Add JPA CI PostgreSQL container test workflow", "committedDate": "2020-06-02T17:02:39Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDUwNjQ2NQ==", "url": "https://github.com/kiegroup/optaplanner/pull/786#discussion_r434506465", "bodyText": "By default, locally the test should run with h2.\nReq: When I do \"mvn clean install\" for this module, it needs to run the tests and not require me to start up a database. So it must use an in memory database.\nWe can have a maven profile that adds postegresql and that is activated for this CI workflow.", "author": "ge0ffrey", "createdAt": "2020-06-03T11:47:00Z", "path": "optaplanner-persistence/optaplanner-persistence-jpa/pom.xml", "diffHunk": "@@ -22,6 +22,22 @@\n   </description>\n   <url>https://www.optaplanner.org</url>\n \n+  <properties>\n+    <java.module.name>org.optaplanner.persistence.jpa</java.module.name>\n+    <version.org.postgresql>42.2.12</version.org.postgresql>\n+  </properties>\n+\n+  <dependencyManagement>\n+    <dependencies>\n+      <dependency>\n+        <groupId>org.postgresql</groupId>\n+        <artifactId>postgresql</artifactId>\n+        <version>${version.org.postgresql}</version>\n+        <scope>test</scope>", "originalCommit": "d7fab8a6ce2359319b8ef571268ae9e728ffa56b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDgyMDA4Ng==", "url": "https://github.com/kiegroup/optaplanner/pull/786#discussion_r434820086", "bodyText": "Everything you described is indeed the current behaviour of this PR. Doing a fresh mvn clean install here runs the tests in an in-memory h2 database (notice that the h2 profile has activeByDefault set to true). This PR also adds a postgresql profile, which is activated when the user runs builds with -Ppostgresql like the GitHub workflow does (this requires a PostgreSQL server running in the background).", "author": "cuijulian", "createdAt": "2020-06-03T19:59:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDUwNjQ2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTAyMDQ4NQ==", "url": "https://github.com/kiegroup/optaplanner/pull/786#discussion_r435020485", "bodyText": "Maybe I would just move this dependencyManagement to the top-level pom.xml, so that it's clear what versions we declare atop of the kie-parent pom.", "author": "rsynek", "createdAt": "2020-06-04T06:30:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDUwNjQ2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTE2OTI2MQ==", "url": "https://github.com/kiegroup/optaplanner/pull/786#discussion_r435169261", "bodyText": "Good point @cuijulian - I missed that", "author": "ge0ffrey", "createdAt": "2020-06-04T11:00:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDUwNjQ2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTE3MDAwNA==", "url": "https://github.com/kiegroup/optaplanner/pull/786#discussion_r435170004", "bodyText": "+1 to declare this in the top level pom. Ideally kie-parent in the 7.x series. Can be a separate PR pair.", "author": "ge0ffrey", "createdAt": "2020-06-04T11:01:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDUwNjQ2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTAxNzQyMg==", "url": "https://github.com/kiegroup/optaplanner/pull/786#discussion_r435017422", "bodyText": "Was this the reason why it didn't work?", "author": "rsynek", "createdAt": "2020-06-04T06:22:44Z", "path": ".github/workflows/jpa_integration_ci.yml", "diffHunk": "@@ -0,0 +1,42 @@\n+# Runs optaplanner-persistence-jpa module tests in a PostgreSQL container\n+\n+name: OptaPlanner Persistence JPA CI\n+\n+on:\n+  push:\n+    branches:\n+      - master\n+  pull_request:\n+    branches:\n+      - master\n+\n+jobs:\n+  jpa-postgresql-container:\n+    runs-on: ubuntu-latest\n+    services:\n+      postgres:\n+        image: postgres\n+        env:\n+          POSTGRES_PASSWORD: postgres\n+        # Set health checks to wait until postgres has started\n+        options: >-\n+          --health-cmd pg_isready\n+          --health-interval 10s\n+          --health-timeout 5s\n+          --health-retries 5\n+        ports:\n+          # Maps tcp port 5432 on service container to the host\n+          - 5432:5432", "originalCommit": "d7fab8a6ce2359319b8ef571268ae9e728ffa56b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTE3NjczOQ==", "url": "https://github.com/kiegroup/optaplanner/pull/786#discussion_r435176739", "bodyText": "Yes, exactly.", "author": "cuijulian", "createdAt": "2020-06-04T11:15:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTAxNzQyMg=="}], "type": "inlineReview"}]}