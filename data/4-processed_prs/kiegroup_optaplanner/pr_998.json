{"pr_number": 998, "pr_title": "PLANNER-2217 Automate release of OptaPlanner documentation and distribution", "pr_createdAt": "2020-10-30T12:45:13Z", "pr_url": "https://github.com/kiegroup/optaplanner/pull/998", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA4NjYzOA==", "url": "https://github.com/kiegroup/optaplanner/pull/998#discussion_r515086638", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              echo \"Make sure the OptaPlanner project has been build with the full profile enabled before calling this script.\"\n          \n          \n            \n              echo \"Make sure the OptaPlanner project has been built with the full profile enabled before calling this script.\"", "author": "triceo", "createdAt": "2020-10-30T13:13:53Z", "path": "build/release/upload_distribution.sh", "diffHunk": "@@ -0,0 +1,78 @@\n+#!/bin/bash\n+\n+function display_help() {\n+  readonly script_name=\"./$(basename \"$0\")\"\n+\n+  echo \"This script uploads the documentation, javadocs and distribution.zip to the filemgmt.jboss.org.\"\n+  echo \"Make sure the OptaPlanner project has been build with the full profile enabled before calling this script.\"", "originalCommit": "c41a730bfeb4fe8ac3d8454aa49c589caeb126fe", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTEzNDA4NA==", "url": "https://github.com/kiegroup/optaplanner/pull/998#discussion_r515134084", "bodyText": "Good catch, thanks!", "author": "rsynek", "createdAt": "2020-10-30T14:22:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA4NjYzOA=="}], "type": "inlineReview"}, {"oid": "e6036e299c8e2dbfbc9c1756b873ab96e0fc17f5", "url": "https://github.com/kiegroup/optaplanner/commit/e6036e299c8e2dbfbc9c1756b873ab96e0fc17f5", "message": "PLANNER-2217 Add script for uploading distribution", "committedDate": "2020-10-30T15:57:38Z", "type": "forcePushed"}, {"oid": "06116fee718db8bae2566df2025a61add7dc22a1", "url": "https://github.com/kiegroup/optaplanner/commit/06116fee718db8bae2566df2025a61add7dc22a1", "message": "PLANNER-2217 Add script for uploading distribution", "committedDate": "2020-10-30T16:36:35Z", "type": "forcePushed"}, {"oid": "2cbe73508961e3c3a6d881ed4a18e125cf8e0056", "url": "https://github.com/kiegroup/optaplanner/commit/2cbe73508961e3c3a6d881ed4a18e125cf8e0056", "message": "Fix mavenCleanInstall call", "committedDate": "2020-11-03T19:40:12Z", "type": "forcePushed"}, {"oid": "d79aac4c924572d31821c44b8fd1c14ec5dbc751", "url": "https://github.com/kiegroup/optaplanner/commit/d79aac4c924572d31821c44b8fd1c14ec5dbc751", "message": "Fix checkout", "committedDate": "2020-11-03T20:31:26Z", "type": "forcePushed"}, {"oid": "a9e98f508452c3bc16399729691143e91fbbabc5", "url": "https://github.com/kiegroup/optaplanner/commit/a9e98f508452c3bc16399729691143e91fbbabc5", "message": "PLANNER-2217 Upload docs and distribution", "committedDate": "2020-11-04T11:06:44Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzMzNTQ4Mw==", "url": "https://github.com/kiegroup/optaplanner/pull/998#discussion_r517335483", "bodyText": "-8.xsd suffixes are for version 8.x explicitly ?", "author": "radtriste", "createdAt": "2020-11-04T13:18:16Z", "path": "Jenkinsfile.promote", "diffHunk": "@@ -92,6 +92,53 @@ pipeline {\n             }\n         }\n \n+        stage('Upload documentation and distribution') {\n+            when {\n+                expression { return isRelease() }\n+            }\n+            steps {\n+                script {\n+                    mavenCleanInstall('optaplanner', true, ['full'])\n+                    dir('optaplanner') {\n+                        withCredentials(bindings: [sshUserPrivateKey(credentialsId: 'optaplanner-filemgmt',\n+                                             keyFileVariable: 'SSH_KEY_JBOSS_FILEMGMT')]) {\n+                            // For testing, simulate connection via SSH:\n+                            // sh \"ssh -i $SSH_KEY_JBOSS_FILEMGMT -oKexAlgorithms=+diffie-hellman-group1-sha1 optaplanner@filemgmt.jboss.org\"\n+                            sh \"./build/release/upload_distribution.sh ${getProjectVersion()} $SSH_KEY_JBOSS_FILEMGMT\"\n+                        }\n+                    }\n+                }\n+            }\n+        }\n+\n+        stage('Update OptaPlanner website') {\n+            when {\n+                expression { return isRelease() }\n+            }\n+            steps {\n+                script {\n+                    final String websiteRepository = 'optaplanner-website'\n+                    dir(websiteRepository) {\n+                        String prBranchName = createWebsitePrBranch(websiteRepository)\n+\n+                        // Update versions in links on the website.\n+                        String nextMinorSnapshot = util.getNextVersion(getProjectVersion(), 'minor')\n+                        sh \"./build/update-versions.sh ${getProjectVersion()} $nextMinorSnapshot\"\n+\n+                        // Update the XSDs. OptaPlanner must be cloned and build with the full profile before.\n+                        String optaplannerRoot = \"$WORKSPACE/optaplanner\"\n+                        sh \"cp $optaplannerRoot/optaplanner-core/target/classes/solver.xsd xsd/solver/solver-8.xsd\"\n+                        sh \"cp $optaplannerRoot/optaplanner-benchmark/target/classes/benchmark.xsd xsd/benchmark/benchmark-8.xsd\"", "originalCommit": "a9e98f508452c3bc16399729691143e91fbbabc5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzM0MjQ0MA==", "url": "https://github.com/kiegroup/optaplanner/pull/998#discussion_r517342440", "bodyText": "Yep, and there is a symlink solver.xsd pointing to the solver-8.xsd. The point is to have XSDs for the entire 8.x, so that once we head towards 9.x, users staying on 8.x have compatible XSD already available.", "author": "rsynek", "createdAt": "2020-11-04T13:29:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzMzNTQ4Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzUwMTMyNQ==", "url": "https://github.com/kiegroup/optaplanner/pull/998#discussion_r517501325", "bodyText": "Maybe we could set this dynamic then, with the version number. Because once we change to version 9, we may forget to update that part (if still there)", "author": "radtriste", "createdAt": "2020-11-04T17:12:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzMzNTQ4Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzMzNTk5Mg==", "url": "https://github.com/kiegroup/optaplanner/pull/998#discussion_r517335992", "bodyText": "why not using getNextSnapshot method ?", "author": "radtriste", "createdAt": "2020-11-04T13:19:09Z", "path": "Jenkinsfile.promote", "diffHunk": "@@ -92,6 +92,53 @@ pipeline {\n             }\n         }\n \n+        stage('Upload documentation and distribution') {\n+            when {\n+                expression { return isRelease() }\n+            }\n+            steps {\n+                script {\n+                    mavenCleanInstall('optaplanner', true, ['full'])\n+                    dir('optaplanner') {\n+                        withCredentials(bindings: [sshUserPrivateKey(credentialsId: 'optaplanner-filemgmt',\n+                                             keyFileVariable: 'SSH_KEY_JBOSS_FILEMGMT')]) {\n+                            // For testing, simulate connection via SSH:\n+                            // sh \"ssh -i $SSH_KEY_JBOSS_FILEMGMT -oKexAlgorithms=+diffie-hellman-group1-sha1 optaplanner@filemgmt.jboss.org\"\n+                            sh \"./build/release/upload_distribution.sh ${getProjectVersion()} $SSH_KEY_JBOSS_FILEMGMT\"\n+                        }\n+                    }\n+                }\n+            }\n+        }\n+\n+        stage('Update OptaPlanner website') {\n+            when {\n+                expression { return isRelease() }\n+            }\n+            steps {\n+                script {\n+                    final String websiteRepository = 'optaplanner-website'\n+                    dir(websiteRepository) {\n+                        String prBranchName = createWebsitePrBranch(websiteRepository)\n+\n+                        // Update versions in links on the website.\n+                        String nextMinorSnapshot = util.getNextVersion(getProjectVersion(), 'minor')", "originalCommit": "a9e98f508452c3bc16399729691143e91fbbabc5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzM0NDM4MQ==", "url": "https://github.com/kiegroup/optaplanner/pull/998#discussion_r517344381", "bodyText": "'minor' vs. 'micro'. But let me do a small change.", "author": "rsynek", "createdAt": "2020-11-04T13:32:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzMzNTk5Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzQxOTMwMw==", "url": "https://github.com/kiegroup/optaplanner/pull/998#discussion_r517419303", "bodyText": "Created separate methods getNextMicroSnapshotVersion and getNextMinorSnapshotVersion.", "author": "rsynek", "createdAt": "2020-11-04T15:17:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzMzNTk5Mg=="}], "type": "inlineReview"}, {"oid": "cc28e60dd1bade4f0aade7bddb32ff885bec2f1b", "url": "https://github.com/kiegroup/optaplanner/commit/cc28e60dd1bade4f0aade7bddb32ff885bec2f1b", "message": "PLANNER-2217 Upload docs and distribution", "committedDate": "2020-11-04T15:15:22Z", "type": "forcePushed"}, {"oid": "6b5f5ed24f54f94b82d15728653f0822db92a69c", "url": "https://github.com/kiegroup/optaplanner/commit/6b5f5ed24f54f94b82d15728653f0822db92a69c", "message": "PLANNER-2217 Add script for uploading distribution", "committedDate": "2020-11-04T18:39:14Z", "type": "commit"}, {"oid": "1cb7a87432fbf04c5da4712d81693bcefdfede08", "url": "https://github.com/kiegroup/optaplanner/commit/1cb7a87432fbf04c5da4712d81693bcefdfede08", "message": "PLANNER-2217 Upload docs and distribution", "committedDate": "2020-11-04T18:39:14Z", "type": "commit"}, {"oid": "1cb7a87432fbf04c5da4712d81693bcefdfede08", "url": "https://github.com/kiegroup/optaplanner/commit/1cb7a87432fbf04c5da4712d81693bcefdfede08", "message": "PLANNER-2217 Upload docs and distribution", "committedDate": "2020-11-04T18:39:14Z", "type": "forcePushed"}]}