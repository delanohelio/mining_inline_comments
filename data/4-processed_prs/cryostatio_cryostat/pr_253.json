{"pr_number": 253, "pr_title": "Use autogenerated SSL cert for WebServer", "pr_createdAt": "2020-08-26T22:06:45Z", "pr_url": "https://github.com/cryostatio/cryostat/pull/253", "timeline": [{"oid": "a540be75444a2a0fdcff5142c2557f60ebdf94d3", "url": "https://github.com/cryostatio/cryostat/commit/a540be75444a2a0fdcff5142c2557f60ebdf94d3", "message": "Use autogenerated self-signed cert for HTTPS/WSS", "committedDate": "2020-08-25T20:38:47Z", "type": "commit"}, {"oid": "62b027691c3e6d17db499435a578ccb4a3c6f2b2", "url": "https://github.com/cryostatio/cryostat/commit/62b027691c3e6d17db499435a578ccb4a3c6f2b2", "message": "Allow user to explicitly disable HTTPS", "committedDate": "2020-08-25T20:49:21Z", "type": "commit"}, {"oid": "585c003cbbd9d2e778a04aa6c34baaa7c61d20a0", "url": "https://github.com/cryostatio/cryostat/commit/585c003cbbd9d2e778a04aa6c34baaa7c61d20a0", "message": "Update README", "committedDate": "2020-08-25T21:05:17Z", "type": "commit"}, {"oid": "3439a98a7821c0f7ec30818c32cd1c3e88bc97da", "url": "https://github.com/cryostatio/cryostat/commit/3439a98a7821c0f7ec30818c32cd1c3e88bc97da", "message": "Disable HTTPS for itests", "committedDate": "2020-08-25T21:47:32Z", "type": "commit"}, {"oid": "959e553376afecbaedadc291c011db33cd05836f", "url": "https://github.com/cryostatio/cryostat/commit/959e553376afecbaedadc291c011db33cd05836f", "message": "Replace JMX_AUTH and DISABLE_HTTPS with FORCE_INSECURE\n\nCONTAINER_JFR_FORCE_INSECURE environment variable disables SSL\ncertificate generation, which in turn disables JMX SSL as well as\nWebServer HTTPS/WSS, as well as JMX auth credential generation, if the\nvariable is set to \"true\". Otherwise, or if CONTAINER_JFR_RJMX_USER or\nCONTAINER_JFR_RJMX_PASS are set to non-empty values, JMX auth\ncredentials are enabled (and generated if necessary) and SSL is enabled.\nIf the user has not specified an SSL keystore/pass an SSL self-signed\ncertificate is generated, and either way the certificate is used for securing JMX\nas well as HTTPS/WSS.", "committedDate": "2020-08-26T22:06:19Z", "type": "commit"}, {"oid": "f5bad56879979a9eb2c881df3b662d7b78f46013", "url": "https://github.com/cryostatio/cryostat/commit/f5bad56879979a9eb2c881df3b662d7b78f46013", "message": "Remove set -x\n\nReduce verbosity of startup logging", "committedDate": "2020-08-27T15:55:45Z", "type": "commit"}, {"oid": "f6e672dbde1cc61847751d681bd6a86255f40830", "url": "https://github.com/cryostatio/cryostat/commit/f6e672dbde1cc61847751d681bd6a86255f40830", "message": "Add high-visibility banner when self-signed or no SSL is used", "committedDate": "2020-08-27T15:55:59Z", "type": "commit"}, {"oid": "526c7330616c4019574fef35e6e6decc58b75392", "url": "https://github.com/cryostatio/cryostat/commit/526c7330616c4019574fef35e6e6decc58b75392", "message": "Formatting", "committedDate": "2020-08-27T16:03:41Z", "type": "commit"}, {"oid": "07d975adf0d445e48388f86327ebc7770fbc4de3", "url": "https://github.com/cryostatio/cryostat/commit/07d975adf0d445e48388f86327ebc7770fbc4de3", "message": "Remove FORCE_INSECURE, re-add DISABLE vars\n\nReintroduce separated CONTAINER_JFR_DISABLE_SSL and CONTAINER_JFR_DISABLE_JMX_AUTH env vars rather than merged FORCE_INSECURE env var, allowing more flexibility for deployment ex. when relying on an SSL proxy", "committedDate": "2020-08-28T19:49:30Z", "type": "commit"}, {"oid": "07d975adf0d445e48388f86327ebc7770fbc4de3", "url": "https://github.com/cryostatio/cryostat/commit/07d975adf0d445e48388f86327ebc7770fbc4de3", "message": "Remove FORCE_INSECURE, re-add DISABLE vars\n\nReintroduce separated CONTAINER_JFR_DISABLE_SSL and CONTAINER_JFR_DISABLE_JMX_AUTH env vars rather than merged FORCE_INSECURE env var, allowing more flexibility for deployment ex. when relying on an SSL proxy", "committedDate": "2020-08-28T19:49:30Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDM3NjAxMg==", "url": "https://github.com/cryostatio/cryostat/pull/253#discussion_r480376012", "bodyText": "Should these be set to KEYSTORE_PATH and KEYSTORE_PASS?", "author": "ebaron", "createdAt": "2020-08-31T20:18:56Z", "path": "src/main/extras/app/entrypoint.sh", "diffHunk": "@@ -108,35 +117,45 @@ FLAGS=(\n     \"-Dcom.sun.management.jmxremote.rmi.port=$CONTAINER_JFR_RMI_PORT\"\n     \"-Djavax.net.ssl.trustStore=$SSL_TRUSTSTORE\"\n     \"-Djavax.net.ssl.trustStorePassword=$SSL_TRUSTSTORE_PASS\"\n-    \"-Djavax.net.ssl.keyStore=$SSL_KEYSTORE\"\n-    \"-Djavax.net.ssl.keyStorePassword=$SSL_KEY_PASS\"\n )\n \n-if [ -z \"$CONTAINER_JFR_RJMX_AUTH\" ]; then\n-    # default to true. This should never be disabled in production deployments\n-    CONTAINER_JFR_RJMX_AUTH=true\n-fi\n-\n createSslStores\n importTrustStores\n-generateSslCert\n-if [ \"$CONTAINER_JFR_RJMX_AUTH\" = \"true\" ] || [ -n \"$CONTAINER_JFR_RJMX_USER\" ] ||\n-    [ -n \"$CONTAINER_JFR_RJMX_PASS\" ]; then\n-    createJmxCredentials\n \n+if [ \"$CONTAINER_JFR_DISABLE_JMX_AUTH\" = \"true\" ]; then\n+    banner \"JMX Auth Disabled\"\n+    FLAGS+=(\"-Dcom.sun.management.jmxremote.authenticate=false\")\n+else\n+    createJmxCredentials\n     FLAGS+=(\"-Dcom.sun.management.jmxremote.authenticate=true\")\n     FLAGS+=(\"-Dcom.sun.management.jmxremote.password.file=$PWFILE\")\n     FLAGS+=(\"-Dcom.sun.management.jmxremote.access.file=$USRFILE\")\n-    FLAGS+=(\"-Dcom.sun.management.jmxremote.ssl=true\")\n-    FLAGS+=(\"-Dcom.sun.management.jmxremote.registry.ssl=true\")\n-    FLAGS+=(\"-Dcom.sun.management.jmxremote.ssl.need.client.auth=true\")\n-else\n-    FLAGS+=(\"-Dcom.sun.management.jmxremote.authenticate=false\")\n+fi\n+\n+if [ \"$CONTAINER_JFR_DISABLE_SSL\" = \"true\" ]; then\n+    banner \"SSL Disabled\"\n     FLAGS+=(\"-Dcom.sun.management.jmxremote.ssl=false\")\n     FLAGS+=(\"-Dcom.sun.management.jmxremote.registry.ssl=false\")\n+else\n+    FLAGS+=(\"-Dcom.sun.management.jmxremote.ssl.need.client.auth=true\")\n+\n+    if [ -z \"$KEYSTORE_PATH\" ] || [ -z \"$KEYSTORE_PASS\" ]; then\n+        generateSslCert\n+        banner \"Using self-signed SSL certificate\"\n+\n+        KEYSTORE_PATH=\"$SSL_KEYSTORE\"\n+        KEYSTORE_PASS=\"$SSL_KEY_PASS\"\n+    fi\n+\n+    FLAGS+=(\"-Djavax.net.ssl.keyStore=$SSL_KEYSTORE\")\n+    FLAGS+=(\"-Djavax.net.ssl.keyStorePassword=$SSL_KEY_PASS\")", "originalCommit": "07d975adf0d445e48388f86327ebc7770fbc4de3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDM4ODQ5OQ==", "url": "https://github.com/cryostatio/cryostat/pull/253#discussion_r480388499", "bodyText": "I think you're right. Fixed, thanks", "author": "andrewazores", "createdAt": "2020-08-31T20:44:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDM3NjAxMg=="}], "type": "inlineReview"}, {"oid": "5d5f8cc8dba5f52814df3f18e6aa9370b042a8f5", "url": "https://github.com/cryostatio/cryostat/commit/5d5f8cc8dba5f52814df3f18e6aa9370b042a8f5", "message": "Correct flags", "committedDate": "2020-08-31T20:44:05Z", "type": "commit"}]}