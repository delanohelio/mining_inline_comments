{"pr_number": 107, "pr_title": "Basic authmanager", "pr_createdAt": "2020-01-23T20:45:41Z", "pr_url": "https://github.com/cryostatio/cryostat/pull/107", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDM2MDg3MA==", "url": "https://github.com/cryostatio/cryostat/pull/107#discussion_r370360870", "bodyText": "Would it be overkill to operate on character arrays for anything dealing with the incoming credentials and nulling out the password characters immediately after use?", "author": "jiekang", "createdAt": "2020-01-23T21:21:44Z", "path": "src/main/java/com/redhat/rhjmc/containerjfr/net/BasicAuthManager.java", "diffHunk": "@@ -0,0 +1,121 @@\n+package com.redhat.rhjmc.containerjfr.net;\n+\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.nio.charset.StandardCharsets;\n+import java.nio.file.Path;\n+import java.util.Base64;\n+import java.util.Objects;\n+import java.util.Properties;\n+import java.util.concurrent.CompletableFuture;\n+import java.util.concurrent.Future;\n+import java.util.function.Supplier;\n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+\n+import com.redhat.rhjmc.containerjfr.core.log.Logger;\n+import com.redhat.rhjmc.containerjfr.core.sys.FileSystem;\n+\n+import org.apache.commons.codec.digest.DigestUtils;\n+import org.apache.commons.lang3.StringUtils;\n+\n+class BasicAuthManager extends AbstractAuthManager {\n+\n+    static final String USER_PROPERTIES_FILENAME = \"container-jfr-users.properties\";\n+\n+    private final FileSystem fs;\n+    private final Properties users;\n+    private volatile boolean configLoaded = false;\n+\n+    // TODO salted hashes\n+    BasicAuthManager(Logger logger, FileSystem fs) {\n+        super(logger);\n+        this.fs = fs;\n+        this.users = new Properties();\n+    }\n+\n+    @Override\n+    public Future<Boolean> validateToken(Supplier<String> tokenProvider) {", "originalCommit": "e0c7dba13ad1e4ec84ef3cdfd87026e5e0c71045", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDM2MTQyMw==", "url": "https://github.com/cryostatio/cryostat/pull/107#discussion_r370361423", "bodyText": "Er, overwriting with zeroes rather than nulling in this case.", "author": "jiekang", "createdAt": "2020-01-23T21:22:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDM2MDg3MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDM2ODY4MA==", "url": "https://github.com/cryostatio/cryostat/pull/107#discussion_r370368680", "bodyText": "Actually it's coming in from a library anyways, it's probably overkill.", "author": "jiekang", "createdAt": "2020-01-23T21:38:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDM2MDg3MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDM3MzE3NA==", "url": "https://github.com/cryostatio/cryostat/pull/107#discussion_r370373174", "bodyText": "It would be doable, but I wouldn't consider that to be too much of a security improvement, if that's the concern. It narrows the timing window where the password is in memory, but not considerably so, and doesn't do anything about the other places in memory where the password had to pass through first - for example, the webserver's HTTP header we parsed it out of.\nAnd if an attacker has the ability to read your ContainerJFR credentials out of JVM memory, then they probably already have access to whatever targets your ContainerJFR would have connected to and more...", "author": "andrewazores", "createdAt": "2020-01-23T21:49:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDM2MDg3MA=="}], "type": "inlineReview"}, {"oid": "52c3da7d204bf410247d3738a555452481c7bce1", "url": "https://github.com/cryostatio/cryostat/commit/52c3da7d204bf410247d3738a555452481c7bce1", "message": "Use named constant for Authorization header name", "committedDate": "2020-01-23T22:02:03Z", "type": "forcePushed"}, {"oid": "7ebb312ac4c896f2a56bd24ab555cc1e00c74691", "url": "https://github.com/cryostatio/cryostat/commit/7ebb312ac4c896f2a56bd24ab555cc1e00c74691", "message": "Use named constant for Authorization header name", "committedDate": "2020-01-24T17:57:27Z", "type": "forcePushed"}, {"oid": "91992b40e744b6afcbbdaaff593f194f229e0185", "url": "https://github.com/cryostatio/cryostat/commit/91992b40e744b6afcbbdaaff593f194f229e0185", "message": "Modify AuthManager interface for specific WebSocket/HTTP handling\n\nRather than validating generic and contextless tokens, methods are added\ncorresponding to WebSocket SubProtocol and HTTP Header processing as\nwell, so that AuthManager implementations can also directly perform auth\non these types of requests without AuthManager consumers (ex.\nMessagingServer and WebServer) needing to massage the request first to\nextract the token to provide to the AuthManager", "committedDate": "2020-01-24T22:12:01Z", "type": "commit"}, {"oid": "d65befba7d77cb52cef25b72603f69bbb5646c3d", "url": "https://github.com/cryostatio/cryostat/commit/d65befba7d77cb52cef25b72603f69bbb5646c3d", "message": "Implement first-pass Basic AuthManager\n\nAuthManager which uses a standard Java Properties file as backing for\nHTTP Basic authorization", "committedDate": "2020-01-24T22:12:01Z", "type": "commit"}, {"oid": "1d95e91bcbcfddc98d75561c979125ec4117b107", "url": "https://github.com/cryostatio/cryostat/commit/1d95e91bcbcfddc98d75561c979125ec4117b107", "message": "Allow more lenient whitespace in Authorization header", "committedDate": "2020-01-24T22:12:01Z", "type": "commit"}, {"oid": "b0da738aeece611ea0738b999f54e7cc4a8f4e75", "url": "https://github.com/cryostatio/cryostat/commit/b0da738aeece611ea0738b999f54e7cc4a8f4e75", "message": "Expect WebSocket subprotocol token to be base64 encoded", "committedDate": "2020-01-24T22:12:01Z", "type": "commit"}, {"oid": "160265ce1c4b21e3392d70abeefc9ac487542697", "url": "https://github.com/cryostatio/cryostat/commit/160265ce1c4b21e3392d70abeefc9ac487542697", "message": "Gracefully handle malformed/invalid base64 inputs", "committedDate": "2020-01-24T22:12:01Z", "type": "commit"}, {"oid": "07d27fdeeaab429236bb822d1da8619299c0015e", "url": "https://github.com/cryostatio/cryostat/commit/07d27fdeeaab429236bb822d1da8619299c0015e", "message": "Return false futures rather than null", "committedDate": "2020-01-24T22:12:01Z", "type": "commit"}, {"oid": "74767a6fed65365d56cdeac3b8efbc6ddca86b9b", "url": "https://github.com/cryostatio/cryostat/commit/74767a6fed65365d56cdeac3b8efbc6ddca86b9b", "message": "Guard against blank strings, not just nulls", "committedDate": "2020-01-24T22:12:01Z", "type": "commit"}, {"oid": "4168bbafd530af0de05e382056e0ee4679c165bb", "url": "https://github.com/cryostatio/cryostat/commit/4168bbafd530af0de05e382056e0ee4679c165bb", "message": "Update web-client", "committedDate": "2020-01-24T22:12:01Z", "type": "commit"}, {"oid": "a2e5a31399f08c269bc8bb174362f3db5e724874", "url": "https://github.com/cryostatio/cryostat/commit/a2e5a31399f08c269bc8bb174362f3db5e724874", "message": "Expect user properties to contain sha256 password hashes", "committedDate": "2020-01-24T22:12:01Z", "type": "commit"}, {"oid": "f1e5b3d55e5257479f66ee029e94460a06192389", "url": "https://github.com/cryostatio/cryostat/commit/f1e5b3d55e5257479f66ee029e94460a06192389", "message": "Update auth manager documentation", "committedDate": "2020-01-24T22:12:01Z", "type": "commit"}, {"oid": "4e57770556a8a526b6fd3de2cba910590841f69f", "url": "https://github.com/cryostatio/cryostat/commit/4e57770556a8a526b6fd3de2cba910590841f69f", "message": "Add FileSystem to AuthManager reflective construction", "committedDate": "2020-01-24T22:12:01Z", "type": "commit"}, {"oid": "b50d8abbc86d026f9293b4cec164e254ef898290", "url": "https://github.com/cryostatio/cryostat/commit/b50d8abbc86d026f9293b4cec164e254ef898290", "message": "Update container-jfr-core version", "committedDate": "2020-01-24T22:12:01Z", "type": "commit"}, {"oid": "15b97de14dc9b47272979607fc9c3419e06e1e4e", "url": "https://github.com/cryostatio/cryostat/commit/15b97de14dc9b47272979607fc9c3419e06e1e4e", "message": "Use FileSystem abstraction rather than direct nio Files", "committedDate": "2020-01-24T22:12:01Z", "type": "commit"}, {"oid": "3da1a9ad75c370bd5f4dab085a067c8655778b15", "url": "https://github.com/cryostatio/cryostat/commit/3da1a9ad75c370bd5f4dab085a067c8655778b15", "message": "Fix Spotbugs charset violations", "committedDate": "2020-01-24T22:12:01Z", "type": "commit"}, {"oid": "1b4a793dcfdddfe6afe91da2fab03d78ce277f6a", "url": "https://github.com/cryostatio/cryostat/commit/1b4a793dcfdddfe6afe91da2fab03d78ce277f6a", "message": "Lazily load properties", "committedDate": "2020-01-24T22:12:01Z", "type": "commit"}, {"oid": "8cf96773d6313eb7fbaa5b199d5e779c1ae25e72", "url": "https://github.com/cryostatio/cryostat/commit/8cf96773d6313eb7fbaa5b199d5e779c1ae25e72", "message": "Add BasicAuthManagerTest", "committedDate": "2020-01-24T22:12:01Z", "type": "commit"}, {"oid": "72e63b2e14068da45f729e5518f59b22aec37432", "url": "https://github.com/cryostatio/cryostat/commit/72e63b2e14068da45f729e5518f59b22aec37432", "message": "Remove outdated TODO", "committedDate": "2020-01-24T22:12:01Z", "type": "commit"}, {"oid": "a3507a003b8d260b54d1a141125f85f17f2636be", "url": "https://github.com/cryostatio/cryostat/commit/a3507a003b8d260b54d1a141125f85f17f2636be", "message": "Use named constant for Authorization header name", "committedDate": "2020-01-24T22:12:01Z", "type": "commit"}, {"oid": "234859476998a585aaeb03ca42c84f6bf18eaadd", "url": "https://github.com/cryostatio/cryostat/commit/234859476998a585aaeb03ca42c84f6bf18eaadd", "message": "Add test for malformed basic auth properties", "committedDate": "2020-01-24T22:12:01Z", "type": "commit"}, {"oid": "58f16541a2390c3183757e97b0efb6f26d4ad91d", "url": "https://github.com/cryostatio/cryostat/commit/58f16541a2390c3183757e97b0efb6f26d4ad91d", "message": "Use BufferedReader for efficient properties loading", "committedDate": "2020-01-24T22:12:01Z", "type": "commit"}, {"oid": "58f16541a2390c3183757e97b0efb6f26d4ad91d", "url": "https://github.com/cryostatio/cryostat/commit/58f16541a2390c3183757e97b0efb6f26d4ad91d", "message": "Use BufferedReader for efficient properties loading", "committedDate": "2020-01-24T22:12:01Z", "type": "forcePushed"}]}