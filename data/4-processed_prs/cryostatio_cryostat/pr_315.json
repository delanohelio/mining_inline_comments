{"pr_number": 315, "pr_title": "Add certificateUpload to api documentation", "pr_createdAt": "2020-10-27T17:39:48Z", "pr_url": "https://github.com/cryostatio/cryostat/pull/315", "timeline": [{"oid": "dd6bb0bbf34b8c80e2fc84890af2e89f78e3febe", "url": "https://github.com/cryostatio/cryostat/commit/dd6bb0bbf34b8c80e2fc84890af2e89f78e3febe", "message": "Add entry for CertificatePostHandler", "committedDate": "2020-10-27T17:20:59Z", "type": "commit"}, {"oid": "21afa198864774e4c17235cc9120f3076621aa50", "url": "https://github.com/cryostatio/cryostat/commit/21afa198864774e4c17235cc9120f3076621aa50", "message": "Add table entry", "committedDate": "2020-10-27T17:38:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjk4OTY2Mw==", "url": "https://github.com/cryostatio/cryostat/pull/315#discussion_r512989663", "bodyText": "typo: \"can be either binary of base64\"?", "author": "andrewazores", "createdAt": "2020-10-27T19:53:50Z", "path": "HTTP_API.md", "diffHunk": "@@ -1217,3 +1219,30 @@\n     $ curl -X POST localhost:8181/api/v2/targets/localhost/snapshot\n     {\"downloadUrl\":\"http://192.168.0.109:8181/api/v1/targets/service:jmx:rmi:%2F%2F%2Fjndi%2Frmi:%2F%2Flocalhost:9091%2Fjmxrmi/recordings/snapshot-1\",\"reportUrl\":\"http://192.168.0.109:8181/api/v1/targets/service:jmx:rmi:%2F%2F%2Fjndi%2Frmi:%2F%2Flocalhost:9091%2Fjmxrmi/reports/snapshot-1\",\"id\":1,\"name\":\"snapshot-1\",\"state\":\"STOPPED\",\"startTime\":1601998841300,\"duration\":0,\"continuous\":true,\"toDisk\":true,\"maxSize\":0,\"maxAge\":0}\n     ```\n+\n+### Security\n+\n+* #### `CertificatePostHandler`\n+\n+    ###### synopsis\n+    Uploads an SSL Certificate from the client, and saves it to the truststore directory.\n+\n+    ###### request\n+    `POST /api/v2/certificates`\n+\n+    The certificate must be DER-encoded and can be either binary of base64. The supported extensions are .der, .cer, .pem. ", "originalCommit": "21afa198864774e4c17235cc9120f3076621aa50", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjk5Mzc5Mw==", "url": "https://github.com/cryostatio/cryostat/pull/315#discussion_r512993793", "bodyText": "My bad", "author": "Alexjsenn", "createdAt": "2020-10-27T20:00:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjk4OTY2Mw=="}], "type": "inlineReview"}, {"oid": "2f5a0c640d8bab8c3b5ad1e7a89773c74c1f624c", "url": "https://github.com/cryostatio/cryostat/commit/2f5a0c640d8bab8c3b5ad1e7a89773c74c1f624c", "message": "Fix typo", "committedDate": "2020-10-27T20:00:49Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzAyMzI3MQ==", "url": "https://github.com/cryostatio/cryostat/pull/315#discussion_r513023271", "bodyText": "Just for consistency, I think we should stick to localhost:8181 without the https:// for the URL.\nThere should also be the response body at the end of this example I think?\nSaved: /truststore/vertx-fib-demo.cer", "author": "vic-ma", "createdAt": "2020-10-27T20:54:17Z", "path": "HTTP_API.md", "diffHunk": "@@ -1217,3 +1219,30 @@\n     $ curl -X POST localhost:8181/api/v2/targets/localhost/snapshot\n     {\"downloadUrl\":\"http://192.168.0.109:8181/api/v1/targets/service:jmx:rmi:%2F%2F%2Fjndi%2Frmi:%2F%2Flocalhost:9091%2Fjmxrmi/recordings/snapshot-1\",\"reportUrl\":\"http://192.168.0.109:8181/api/v1/targets/service:jmx:rmi:%2F%2F%2Fjndi%2Frmi:%2F%2Flocalhost:9091%2Fjmxrmi/reports/snapshot-1\",\"id\":1,\"name\":\"snapshot-1\",\"state\":\"STOPPED\",\"startTime\":1601998841300,\"duration\":0,\"continuous\":true,\"toDisk\":true,\"maxSize\":0,\"maxAge\":0}\n     ```\n+\n+### Security\n+\n+* #### `CertificatePostHandler`\n+\n+    ###### synopsis\n+    Uploads an SSL Certificate from the client, and saves it to the truststore directory.\n+\n+    ###### request\n+    `POST /api/v2/certificates`\n+\n+    The certificate must be DER-encoded and can be either binary or base64. The supported extensions are .der, .cer, .pem. \n+    The certificate should be uploaded in a form with the name `cert`.\n+\n+    ###### response\n+    `200` - The body is `saved: ` followed by the path of the saved file.\n+\n+    `400` - No `cert` was found in the request form. The body is the error message `A file named \"cert\" was not included in the request`.\n+    \n+    `409` - A certificate with the same filename already exists in the truststore directory. The body includes the path where the file already exists.\n+\n+    `500` - The `TRUSTSTORE_DIR` environment variable is not set, or there is an unexpected error. The body is an error message.\n+\n+    ###### example\n+    ```\n+    $ curl -F cert=@vertx-fib-demo.cer https://localhost:8181/api/v2/certificates", "originalCommit": "2f5a0c640d8bab8c3b5ad1e7a89773c74c1f624c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzAyNjgyNQ==", "url": "https://github.com/cryostatio/cryostat/pull/315#discussion_r513026825", "bodyText": "I think this would be better formatted as:\n\nThe body is saved: $PATH, where $PATH is the path of the saved file.\n\nSimilar to the other handlers, just so it's more explicit, and also because it looks like the space in saved:  messes with the normal space after.", "author": "vic-ma", "createdAt": "2020-10-27T20:59:24Z", "path": "HTTP_API.md", "diffHunk": "@@ -1217,3 +1219,30 @@\n     $ curl -X POST localhost:8181/api/v2/targets/localhost/snapshot\n     {\"downloadUrl\":\"http://192.168.0.109:8181/api/v1/targets/service:jmx:rmi:%2F%2F%2Fjndi%2Frmi:%2F%2Flocalhost:9091%2Fjmxrmi/recordings/snapshot-1\",\"reportUrl\":\"http://192.168.0.109:8181/api/v1/targets/service:jmx:rmi:%2F%2F%2Fjndi%2Frmi:%2F%2Flocalhost:9091%2Fjmxrmi/reports/snapshot-1\",\"id\":1,\"name\":\"snapshot-1\",\"state\":\"STOPPED\",\"startTime\":1601998841300,\"duration\":0,\"continuous\":true,\"toDisk\":true,\"maxSize\":0,\"maxAge\":0}\n     ```\n+\n+### Security\n+\n+* #### `CertificatePostHandler`\n+\n+    ###### synopsis\n+    Uploads an SSL Certificate from the client, and saves it to the truststore directory.\n+\n+    ###### request\n+    `POST /api/v2/certificates`\n+\n+    The certificate must be DER-encoded and can be either binary or base64. The supported extensions are .der, .cer, .pem. \n+    The certificate should be uploaded in a form with the name `cert`.\n+\n+    ###### response\n+    `200` - The body is `saved: ` followed by the path of the saved file.", "originalCommit": "2f5a0c640d8bab8c3b5ad1e7a89773c74c1f624c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzA1NzY4Nw==", "url": "https://github.com/cryostatio/cryostat/pull/315#discussion_r513057687", "bodyText": "Ah, makes sense!", "author": "Alexjsenn", "createdAt": "2020-10-27T21:58:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzAyNjgyNQ=="}], "type": "inlineReview"}, {"oid": "5e7ba847510cc8ccf215818092a5202edd911abf", "url": "https://github.com/cryostatio/cryostat/commit/5e7ba847510cc8ccf215818092a5202edd911abf", "message": "Format changes", "committedDate": "2020-10-27T21:58:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzA2MjY0NA==", "url": "https://github.com/cryostatio/cryostat/pull/315#discussion_r513062644", "bodyText": "Ah, one last thing, it looks like the saved: here should be capitalized.", "author": "vic-ma", "createdAt": "2020-10-27T22:09:15Z", "path": "HTTP_API.md", "diffHunk": "@@ -1217,3 +1219,31 @@\n     $ curl -X POST localhost:8181/api/v2/targets/localhost/snapshot\n     {\"downloadUrl\":\"http://192.168.0.109:8181/api/v1/targets/service:jmx:rmi:%2F%2F%2Fjndi%2Frmi:%2F%2Flocalhost:9091%2Fjmxrmi/recordings/snapshot-1\",\"reportUrl\":\"http://192.168.0.109:8181/api/v1/targets/service:jmx:rmi:%2F%2F%2Fjndi%2Frmi:%2F%2Flocalhost:9091%2Fjmxrmi/reports/snapshot-1\",\"id\":1,\"name\":\"snapshot-1\",\"state\":\"STOPPED\",\"startTime\":1601998841300,\"duration\":0,\"continuous\":true,\"toDisk\":true,\"maxSize\":0,\"maxAge\":0}\n     ```\n+\n+### Security\n+\n+* #### `CertificatePostHandler`\n+\n+    ###### synopsis\n+    Uploads an SSL Certificate from the client, and saves it to the truststore directory.\n+\n+    ###### request\n+    `POST /api/v2/certificates`\n+\n+    The certificate must be DER-encoded and can be either binary or base64. The supported extensions are .der, .cer, .pem. \n+    The certificate should be uploaded in a form with the name `cert`.\n+\n+    ###### response\n+    `200` - The body is `saved: $PATH`, where `$PATH` is the path of the saved file.", "originalCommit": "5e7ba847510cc8ccf215818092a5202edd911abf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "15d34daf7996636da9e6c356473d4a86d890eaa5", "url": "https://github.com/cryostatio/cryostat/commit/15d34daf7996636da9e6c356473d4a86d890eaa5", "message": "Capitalize 'saved'", "committedDate": "2020-10-28T14:35:53Z", "type": "commit"}]}