{"pr_number": 186, "pr_title": "Archive path should be configurable", "pr_createdAt": "2020-06-18T15:20:06Z", "pr_url": "https://github.com/cryostatio/cryostat/pull/186", "timeline": [{"oid": "bb12366a283a20d76dedb9412118d4b9c44514e6", "url": "https://github.com/cryostatio/cryostat/commit/bb12366a283a20d76dedb9412118d4b9c44514e6", "message": "initial changes, reads the save path for local jfr recordings from the ARCHIVE_PATH env var", "committedDate": "2020-06-17T20:19:43Z", "type": "commit"}, {"oid": "86138a80c17106016eddbbb3ba0affc771b61a0e", "url": "https://github.com/cryostatio/cryostat/commit/86138a80c17106016eddbbb3ba0affc771b61a0e", "message": "Archive path should be configurable (#173)\n\nSupport for the evironment variable ARCHIVE_PATH to define path when saving\nrecordings locally. If not set, default path is /flightrecordings.", "committedDate": "2020-06-18T14:18:10Z", "type": "commit"}, {"oid": "2be5bac669132a2ef5a648ce9883ed133fc38f8b", "url": "https://github.com/cryostatio/cryostat/commit/2be5bac669132a2ef5a648ce9883ed133fc38f8b", "message": "Updated README accordingly", "committedDate": "2020-06-18T14:49:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjMyMTcyNw==", "url": "https://github.com/cryostatio/cryostat/pull/186#discussion_r442321727", "bodyText": "You should be able to have Dagger inject a Logger instance into this method as a parameter, rather than having to grab the logger by manually calling this method like this. Just add a Logger to the method's argument list.", "author": "andrewazores", "createdAt": "2020-06-18T15:40:48Z", "path": "src/main/java/com/redhat/rhjmc/containerjfr/MainModule.java", "diffHunk": "@@ -89,6 +89,17 @@ public static Gson provideGson() {\n     @Provides\n     @Named(RECORDINGS_PATH)\n     static Path provideSavedRecordingsPath() {\n-        return Paths.get(\"/\", \"flightrecordings\");\n+        String ARCHIVE_PATH = null;\n+        final Logger logger = provideLogger();", "originalCommit": "2be5bac669132a2ef5a648ce9883ed133fc38f8b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjMyNDMzMw==", "url": "https://github.com/cryostatio/cryostat/pull/186#discussion_r442324333", "bodyText": "You can see examples of this in other DI modules around the codebase, for example the NetworkModule.", "author": "andrewazores", "createdAt": "2020-06-18T15:44:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjMyMTcyNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjM3MjIzNg==", "url": "https://github.com/cryostatio/cryostat/pull/186#discussion_r442372236", "bodyText": "Ok, fixed!", "author": "Alexjsenn", "createdAt": "2020-06-18T16:59:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjMyMTcyNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjMyMjM4Nw==", "url": "https://github.com/cryostatio/cryostat/pull/186#discussion_r442322387", "bodyText": "Can you refactor this to use the Environment utility class, which is also available by dependency injection? The source for that class is in -core, so you can take a look and see what methods might be useful for you here.", "author": "andrewazores", "createdAt": "2020-06-18T15:41:47Z", "path": "src/main/java/com/redhat/rhjmc/containerjfr/MainModule.java", "diffHunk": "@@ -89,6 +89,17 @@ public static Gson provideGson() {\n     @Provides\n     @Named(RECORDINGS_PATH)\n     static Path provideSavedRecordingsPath() {\n-        return Paths.get(\"/\", \"flightrecordings\");\n+        String ARCHIVE_PATH = null;\n+        final Logger logger = provideLogger();\n+        try {\n+            ARCHIVE_PATH = System.getenv(\"ARCHIVE_PATH\");", "originalCommit": "2be5bac669132a2ef5a648ce9883ed133fc38f8b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjMyNzQ1OQ==", "url": "https://github.com/cryostatio/cryostat/pull/186#discussion_r442327459", "bodyText": "Also, what do you think of prefixing this new env var with CONTAINER_JFR_? That's how the other configuration variables are generally named.", "author": "andrewazores", "createdAt": "2020-06-18T15:48:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjMyMjM4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjM2ODM5NA==", "url": "https://github.com/cryostatio/cryostat/pull/186#discussion_r442368394", "bodyText": "After using the Environment class I realized I needed way less code!", "author": "Alexjsenn", "createdAt": "2020-06-18T16:52:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjMyMjM4Nw=="}], "type": "inlineReview"}, {"oid": "173ce16cdf19e6c90fb8e14c9ad22f3881c7f8d0", "url": "https://github.com/cryostatio/cryostat/commit/173ce16cdf19e6c90fb8e14c9ad22f3881c7f8d0", "message": "Archive path should be configurable (#173)\n\nInject logger instead of calling getlogger function.\nUse Environment class instead of System directly.", "committedDate": "2020-06-18T16:54:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjM4NzIzNw==", "url": "https://github.com/cryostatio/cryostat/pull/186#discussion_r442387237", "bodyText": "The Logger isn't used anymore. It can either be removed, or maybe there should be a message logged if the environment variable is (or isn't) set so that it's clear from the logs what path was used during a particular run.", "author": "andrewazores", "createdAt": "2020-06-18T17:25:57Z", "path": "src/main/java/com/redhat/rhjmc/containerjfr/MainModule.java", "diffHunk": "@@ -88,7 +89,7 @@ public static Gson provideGson() {\n     @SuppressFBWarnings(\"DMI_HARDCODED_ABSOLUTE_FILENAME\")\n     @Provides\n     @Named(RECORDINGS_PATH)\n-    static Path provideSavedRecordingsPath() {\n-        return Paths.get(\"/\", \"flightrecordings\");\n+    static Path provideSavedRecordingsPath(Logger logger, Environment env) {", "originalCommit": "173ce16cdf19e6c90fb8e14c9ad22f3881c7f8d0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQ2ODA4Nw==", "url": "https://github.com/cryostatio/cryostat/pull/186#discussion_r442468087", "bodyText": "Ok, logger now reports set path.", "author": "Alexjsenn", "createdAt": "2020-06-18T19:55:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjM4NzIzNw=="}], "type": "inlineReview"}, {"oid": "92bea3814aa9f9f6f99daf46b24948d081089bae", "url": "https://github.com/cryostatio/cryostat/commit/92bea3814aa9f9f6f99daf46b24948d081089bae", "message": "Logger outputs set path for archiving recordings (either set by\nCONTAINER_JFR_ARCHIVE_PATH or default)", "committedDate": "2020-06-18T19:52:43Z", "type": "commit"}]}