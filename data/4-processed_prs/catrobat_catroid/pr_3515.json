{"pr_number": 3515, "pr_title": "CATROID-336 \"Open\" .catrobat extension files", "pr_createdAt": "2020-03-11T12:11:12Z", "pr_url": "https://github.com/Catrobat/Catroid/pull/3515", "timeline": [{"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzAzNjY3Mw==", "url": "https://github.com/Catrobat/Catroid/pull/3515#discussion_r393036673", "bodyText": "This method and the other methods are already implemented in the ProjectListFragment.\nPlease, find a way (maybe pass the intent as an argument) to minimize code duplication.", "author": "gPathpp", "createdAt": "2020-03-16T13:51:50Z", "path": "catroid/src/main/java/org/catrobat/catroid/ui/ProjectListActivity.java", "diffHunk": "@@ -75,4 +100,50 @@ public void handleAddButton(View view) {\n \t\tNewProjectDialogFragment dialog = new NewProjectDialogFragment();\n \t\tdialog.show(getSupportFragmentManager(), NewProjectDialogFragment.TAG);\n \t}\n+\n+\tprivate ProjectUnzipAndImportTask.ProjectUnzipAndImportListener projectUnzipAndImportListener =\n+\t\t\tnew ProjectUnzipAndImportTask.ProjectUnzipAndImportListener() {\n+\t\t\t\t@Override\n+\t\t\t\tpublic void onImportFinished(boolean success) {\n+\t\t\t\t\tif (!success) {\n+\t\t\t\t\t\tToastUtil.showError(ProjectListActivity.this, R.string.error_import_project);\n+\t\t\t\t\t}\n+\t\t\t\t\tloadFragment(new ProjectListFragment());\n+\t\t\t\t}\n+\t\t\t};\n+\n+\tprivate ProjectImportTask.ProjectImportListener projectImportListener =\n+\t\t\tnew ProjectImportTask.ProjectImportListener() {\n+\t\t\t\t@Override\n+\t\t\t\tpublic void onImportFinished(boolean success) {\n+\t\t\t\t\tif (!success) {\n+\t\t\t\t\t\tToastUtil.showError(ProjectListActivity.this, R.string.error_import_project);\n+\t\t\t\t\t}\n+\t\t\t\t\tloadFragment(new ProjectListFragment());\n+\t\t\t\t}\n+\t\t\t};\n+\n+\tprivate void importProjectFromExternal(String path, Intent intent) {", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzQ1NDYwNQ==", "url": "https://github.com/Catrobat/Catroid/pull/3515#discussion_r393454605", "bodyText": "I don't think the import method in ProjectListFragment would work because it implemented to receive a Uri with scheme of \"file\". Whereas almost all apps share file through content URI for security.", "author": "Gwzwnglai-AuBurn", "createdAt": "2020-03-17T05:40:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzAzNjY3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzgyOTI0NA==", "url": "https://github.com/Catrobat/Catroid/pull/3515#discussion_r393829244", "bodyText": "Yes, it is possible, your new code is exactly the same as in ProjectListFragment, except the \"file\" check and the definition of the src file.\nAnd I think that's solvable with \"Uri.fromFile(...);\".\nAnd if not, have a look at the FilePickerActivity and ProjectListFragment.", "author": "gPathpp", "createdAt": "2020-03-17T16:57:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzAzNjY3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDI0NzQzNQ==", "url": "https://github.com/Catrobat/Catroid/pull/3515#discussion_r394247435", "bodyText": "Okay, I'll have a look at how to can solve it. Thanks!", "author": "Gwzwnglai-AuBurn", "createdAt": "2020-03-18T10:33:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzAzNjY3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTk3MzI5OA==", "url": "https://github.com/Catrobat/Catroid/pull/3515#discussion_r395973298", "bodyText": "@gPathpp Is the \"file\" check in the import method of ProjectListFragment, really required?", "author": "Gwzwnglai-AuBurn", "createdAt": "2020-03-21T08:21:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzAzNjY3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTk4NTk3MQ==", "url": "https://github.com/Catrobat/Catroid/pull/3515#discussion_r395985971", "bodyText": "Which scheme does the data have? Maybe a content URI?\nI will ask @84n4n4 about this check. (He wrote this code)", "author": "gPathpp", "createdAt": "2020-03-21T11:47:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzAzNjY3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTk5MzM0MQ==", "url": "https://github.com/Catrobat/Catroid/pull/3515#discussion_r395993341", "bodyText": "i cant recall exactly why this check is there. but the whole thing was a mess to get to work properly for all android versions.\nanyways:\n\nremove the check\ndont duplicate code, use the one in fragment that is there\ntest on all supported major android versions!", "author": "84n4n4", "createdAt": "2020-03-21T13:37:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzAzNjY3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjAwMDM0Mw==", "url": "https://github.com/Catrobat/Catroid/pull/3515#discussion_r396000343", "bodyText": "Which scheme does the data have? Maybe a content URI?\n\nYup, the scheme for the implicit intents is content Uri.\nThe filePickerActivity returns scheme in file Uri.", "author": "Gwzwnglai-AuBurn", "createdAt": "2020-03-21T15:10:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzAzNjY3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjAwMjE5Nw==", "url": "https://github.com/Catrobat/Catroid/pull/3515#discussion_r396002197", "bodyText": "@84n4n4 Oh. It might be an issue because I don't have access to all android versions :P (excluding emulators).\nIs it better to add an argument to the check? You must have kept it there for some reason.", "author": "Gwzwnglai-AuBurn", "createdAt": "2020-03-21T15:35:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzAzNjY3Mw=="}], "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTE5MjQ2Mg==", "url": "https://github.com/Catrobat/Catroid/pull/3515#discussion_r399192462", "bodyText": "PLEASE-EXPLAIN: Is it really necessary to bundle the intent? Why don't you pass the intent.getExtras() itself?", "author": "gPathpp", "createdAt": "2020-03-27T11:14:45Z", "path": "catroid/src/main/java/org/catrobat/catroid/ui/ProjectListActivity.java", "diffHunk": "@@ -35,18 +37,32 @@\n \n public class ProjectListActivity extends BaseCastActivity {\n \n+\tpublic static final String TAG = ProjectListActivity.class.getSimpleName();\n+\n \t@Override\n \tpublic void onCreate(Bundle savedInstanceState) {\n \t\tsuper.onCreate(savedInstanceState);\n-\n \t\tsetContentView(R.layout.activity_recycler);\n \t\tsetSupportActionBar(findViewById(R.id.toolbar));\n \t\tgetSupportActionBar().setTitle(R.string.project_list_title);\n \t\tgetSupportActionBar().setDisplayHomeAsUpEnabled(true);\n \n \t\tBottomBar.hidePlayButton(this);\n \n-\t\tloadFragment(new ProjectListFragment());\n+\t\tFragment projectListFragment = new ProjectListFragment();\n+\n+\t\tIntent importProjectFromImplicitIntent = getIntent();\n+\t\tif (importProjectFromImplicitIntent.getAction() != null) {\n+\t\t\ttry {\n+\t\t\t\tBundle data = new Bundle();\n+\t\t\t\tdata.putParcelable(\"intent\", importProjectFromImplicitIntent);\n+\t\t\t\tprojectListFragment.setArguments(data);", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzc1OTgwNQ==", "url": "https://github.com/Catrobat/Catroid/pull/3515#discussion_r403759805", "bodyText": "I'm passing the intent itself into the fragment. it's necessary to pass the intent to the import method for accessing the content provider.", "author": "Gwzwnglai-AuBurn", "createdAt": "2020-04-05T21:33:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTE5MjQ2Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTIwNDQ2Ng==", "url": "https://github.com/Catrobat/Catroid/pull/3515#discussion_r399204466", "bodyText": "PLEASE-FIX: This check is unnecessary because the other import-use-case only generates \"file\" URIs and this use-case ignores it. => the boolean-flag, the check, and these try-catches only obfuscate code.  => delete it\nThanks!", "author": "gPathpp", "createdAt": "2020-03-27T11:38:57Z", "path": "catroid/src/main/java/org/catrobat/catroid/ui/recyclerview/fragment/ProjectListFragment.java", "diffHunk": "@@ -195,8 +212,19 @@ private void importProject(Intent data) {\n \t\t\treturn;\n \t\t}\n \n-\t\tif (!data.getData().getScheme().equals(\"file\")) {\n-\t\t\tthrow new IllegalArgumentException(\"importProject has to be called with a file uri. (not a content uri\");\n+\t\tboolean isImporting = false;\n+\t\ttry {\n+\t\t\tisImporting = data.getExtras().getSerializable(\"IS_IMPORTING_FROM_IMPLICIT_INTENT\") != null;\n+\t\t} catch (NullPointerException e) {\n+\t\t\tLog.e(TAG, \"Null pointer exception\", e);\n+\t\t}\n+\n+\t\ttry {\n+\t\t\tif (!data.getData().getScheme().equals(\"file\") && !isImporting) {", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTIxNjgwNA==", "url": "https://github.com/Catrobat/Catroid/pull/3515#discussion_r399216804", "bodyText": "PLEASE FIX: Since the bundle holds the intent and vise-versa, this could probably lead to a memory loss.\nSure, the Garbage-Collector of Java may realize this, but it's also not a good idea to recycle variables.\n(->Intent->Bundle->)", "author": "gPathpp", "createdAt": "2020-03-27T12:04:15Z", "path": "catroid/src/main/java/org/catrobat/catroid/ui/recyclerview/fragment/ProjectListFragment.java", "diffHunk": "@@ -86,6 +90,19 @@\n \n \tprivate static final int REQUEST_IMPORT_PROJECT = 7;\n \n+\t@Override\n+\tpublic View onCreateView(@NonNull LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {\n+\t\tView view = super.onCreateView(inflater, container, savedInstanceState);\n+\t\tif (getArguments() != null) {\n+\t\t\tBundle data = getArguments();\n+\t\t\tIntent intent = data.getParcelable(\"intent\");\n+\t\t\tdata.putSerializable(\"IS_IMPORTING_FROM_IMPLICIT_INTENT\", true);\n+\t\t\tintent.putExtras(data);", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTIxOTYyOQ==", "url": "https://github.com/Catrobat/Catroid/pull/3515#discussion_r399219629", "bodyText": "Feel free to refactor function signatures, etc.. to get your code as short and as readable as possible ;)", "author": "gPathpp", "createdAt": "2020-03-27T12:09:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTIxNjgwNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjY1MDMyMg==", "url": "https://github.com/Catrobat/Catroid/pull/3515#discussion_r402650322", "bodyText": "Thanks for pointing these out for me!", "author": "Gwzwnglai-AuBurn", "createdAt": "2020-04-02T23:18:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTIxNjgwNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjY1MTI4OA==", "url": "https://github.com/Catrobat/Catroid/pull/3515#discussion_r402651288", "bodyText": "Thanks for pointing these out for me!", "author": "Gwzwnglai-AuBurn", "createdAt": "2020-04-02T23:21:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTIxNjgwNA=="}], "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTYxNzExNg==", "url": "https://github.com/Catrobat/Catroid/pull/3515#discussion_r405617116", "bodyText": "PRAISE: The code looks much better than before!\nPLEASE-EXPLAIN: What's the source of the null-ptr-exception?\nPLEASE-FIX: I think there is a race condition with the adapter.\nThe adapter is used in the callback methods, the import method is called \"onCreateView\", but the adapter is initialized \"inOnActivityCreated\"  => if the import finishes before the activity was created a null-ptr-exception occurs.\nhttps://stackoverflow.com/questions/28929637/difference-and-uses-of-oncreate-oncreateview-and-onactivitycreated-in-fra", "author": "gPathpp", "createdAt": "2020-04-08T15:34:31Z", "path": "catroid/src/main/java/org/catrobat/catroid/ui/recyclerview/fragment/ProjectListFragment.java", "diffHunk": "@@ -217,7 +227,7 @@ private void importProject(Intent data) {\n \t\t\t\t\t\t.execute(projectFile);\n \t\t\t}\n \t\t\tsetShowProgressBar(true);\n-\t\t} catch (IOException e) {", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTg2MDc2OQ==", "url": "https://github.com/Catrobat/Catroid/pull/3515#discussion_r411860769", "bodyText": "Actually I could not reproduce the null pointer exception in testing. But there was a test for it.", "author": "Gwzwnglai-AuBurn", "createdAt": "2020-04-21T04:32:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTYxNzExNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjI4ODgwNw==", "url": "https://github.com/Catrobat/Catroid/pull/3515#discussion_r412288807", "bodyText": "Ok, which test?\nAnyway, please fix the race condition with the adapter (move the code from \"onCreateView\" to \"onActivityCreated\").", "author": "gPathpp", "createdAt": "2020-04-21T15:31:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTYxNzExNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjQ3MzQ2Mw==", "url": "https://github.com/Catrobat/Catroid/pull/3515#discussion_r412473463", "bodyText": "This is the test: org.catrobat.catroid.uiespresso.ui.actionbar.ActionModeMergeTest.onlyTwoProjectsCheckedTest\nI moved the code from \"onCreateView\" to \"onActivityCreated\", Its much better, the progress dialog is displayed, Thanks!", "author": "Gwzwnglai-AuBurn", "createdAt": "2020-04-21T20:36:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTYxNzExNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjkzODU5MA==", "url": "https://github.com/Catrobat/Catroid/pull/3515#discussion_r412938590", "bodyText": "I see.\nPlease do not catch the exception instead avoid it.\nIn most cases, Android Studio tells you where a null-ptr exception can occur. (hover with the mouse over code with yellow background)", "author": "gPathpp", "createdAt": "2020-04-22T12:30:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTYxNzExNg=="}], "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": "96c444c8b8e0c68251a4675029dbbc7ab2d7a4f7", "url": "https://github.com/Catrobat/Catroid/commit/96c444c8b8e0c68251a4675029dbbc7ab2d7a4f7", "message": "CATROID-336 \"Open\" .catrobat extension files", "committedDate": "2020-04-29T05:33:53Z", "type": "commit"}, {"oid": "96c444c8b8e0c68251a4675029dbbc7ab2d7a4f7", "url": "https://github.com/Catrobat/Catroid/commit/96c444c8b8e0c68251a4675029dbbc7ab2d7a4f7", "message": "CATROID-336 \"Open\" .catrobat extension files", "committedDate": "2020-04-29T05:33:53Z", "type": "forcePushed"}]}