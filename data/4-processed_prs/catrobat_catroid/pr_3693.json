{"pr_number": 3693, "pr_title": "CATROID-650 + CATROID-385 Project image empty if the default scene has no screenshot", "pr_createdAt": "2020-07-21T09:11:56Z", "pr_url": "https://github.com/Catrobat/Catroid/pull/3693", "timeline": [{"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDQ2MTkzMw==", "url": "https://github.com/Catrobat/Catroid/pull/3693#discussion_r460461933", "bodyText": "please rename it to getSceneScreenShot", "author": "ndrnour", "createdAt": "2020-07-26T00:44:09Z", "path": "catroid/src/main/java/org/catrobat/catroid/io/ProjectAndSceneScreenshotLoader.java", "diffHunk": "@@ -115,6 +120,41 @@ public File getScreenshotFile(String projectName, String sceneName, boolean isBa\n \t\treturn screenshotLoader.getScreenshotFile();\n \t}\n \n+\tpublic String getScreenshotScene(File projectDir) {", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDY2NTg5Mw==", "url": "https://github.com/Catrobat/Catroid/pull/3693#discussion_r460665893", "bodyText": "There is already a function called getScreenshotFile and my function only gets the Scenename that is used for this function, not the screenshot itself.\nShould I still rename it?", "author": "juliajulie95", "createdAt": "2020-07-27T06:09:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDQ2MTkzMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk0NTk2OQ==", "url": "https://github.com/Catrobat/Catroid/pull/3693#discussion_r460945969", "bodyText": "I see. it would be clearer to me if you rename it to getScreenshotSceneName,", "author": "ndrnour", "createdAt": "2020-07-27T14:47:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDQ2MTkzMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDQ2MTk5MQ==", "url": "https://github.com/Catrobat/Catroid/pull/3693#discussion_r460461991", "bodyText": "please avoid hard coded values.", "author": "ndrnour", "createdAt": "2020-07-26T00:44:56Z", "path": "catroid/src/main/java/org/catrobat/catroid/io/ProjectAndSceneScreenshotLoader.java", "diffHunk": "@@ -115,6 +120,41 @@ public File getScreenshotFile(String projectName, String sceneName, boolean isBa\n \t\treturn screenshotLoader.getScreenshotFile();\n \t}\n \n+\tpublic String getScreenshotScene(File projectDir) {\n+\t\tFilenameFilter filter = new FilenameFilter() {\n+\n+\t\t\tpublic boolean accept(File f, String name) {\n+\t\t\t\treturn name.endsWith(\"screenshot.png\");", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDQ2MjM4NQ==", "url": "https://github.com/Catrobat/Catroid/pull/3693#discussion_r460462385", "bodyText": "why this code is needed since this function handle the structure of the new projects (projects with scenes),\nif you wanna handle the structure of the old projects (projects without Scenes like https://share.catrob.at/app/project/817) please create another function. also, why returning null if projectScreenshots.length != 0 ?", "author": "ndrnour", "createdAt": "2020-07-26T00:51:19Z", "path": "catroid/src/main/java/org/catrobat/catroid/io/ProjectAndSceneScreenshotLoader.java", "diffHunk": "@@ -115,6 +120,41 @@ public File getScreenshotFile(String projectName, String sceneName, boolean isBa\n \t\treturn screenshotLoader.getScreenshotFile();\n \t}\n \n+\tpublic String getScreenshotScene(File projectDir) {\n+\t\tFilenameFilter filter = new FilenameFilter() {\n+\n+\t\t\tpublic boolean accept(File f, String name) {\n+\t\t\t\treturn name.endsWith(\"screenshot.png\");\n+\t\t\t}\n+\t\t};\n+\t\tFile[] projectScreenshots = projectDir.listFiles(filter);\n+\t\tif (projectScreenshots == null || projectScreenshots.length != 0) {\n+\t\t\treturn null;\n+\t\t}", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDY2MTU2OA==", "url": "https://github.com/Catrobat/Catroid/pull/3693#discussion_r460661568", "bodyText": "I implemented a new way screenshots are handled. Before we always took the screenshot of the default scene, if there is none, the project thumbnail is empty. From now on we want to use the most recent manual screenshot if available, else the most recent automatic screenshot. Everytime a screenshot is saved, the current screenshot in the project folder is overwritten, so we always have the most recent screenshot.\nIn this function I'm searching for the Scene thats has the most recent screenshot. (because the screenshot loader has the scenename as parameter). If the projectfolder has a screenshot, I just return null, because we do not need the scenename.\nHere I check if the screenshot is available, if I find a screenshot in the project folder i don't need a scenename.", "author": "juliajulie95", "createdAt": "2020-07-27T05:55:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDQ2MjM4NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDQ2MjUwNQ==", "url": "https://github.com/Catrobat/Catroid/pull/3693#discussion_r460462505", "bodyText": "scene.listFiles(filter) is already defined as sceneScreenshots  in line 136, so please change it to\nscreenshots.addAll(Arrays.asList(sceneScreenshots));", "author": "ndrnour", "createdAt": "2020-07-26T00:53:14Z", "path": "catroid/src/main/java/org/catrobat/catroid/io/ProjectAndSceneScreenshotLoader.java", "diffHunk": "@@ -115,6 +120,41 @@ public File getScreenshotFile(String projectName, String sceneName, boolean isBa\n \t\treturn screenshotLoader.getScreenshotFile();\n \t}\n \n+\tpublic String getScreenshotScene(File projectDir) {\n+\t\tFilenameFilter filter = new FilenameFilter() {\n+\n+\t\t\tpublic boolean accept(File f, String name) {\n+\t\t\t\treturn name.endsWith(\"screenshot.png\");\n+\t\t\t}\n+\t\t};\n+\t\tFile[] projectScreenshots = projectDir.listFiles(filter);\n+\t\tif (projectScreenshots == null || projectScreenshots.length != 0) {\n+\t\t\treturn null;\n+\t\t}\n+\t\tList<File> screenshots = new ArrayList<>();\n+\t\tfor (File scene : projectDir.listFiles()) {\n+\t\t\tFile[] sceneScreenshots = scene.listFiles(filter);\n+\t\t\tif (sceneScreenshots != null && sceneScreenshots.length > 0) {\n+\t\t\t\tscreenshots.addAll(Arrays.asList(scene.listFiles(filter)));", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDQ2MjgzNA==", "url": "https://github.com/Catrobat/Catroid/pull/3693#discussion_r460462834", "bodyText": "Collection interface has a handy function called isEmpty()  https://developer.android.com/reference/java/util/Collection#isEmpty()\nplease replace it with if (screenshots.isEmpty())", "author": "ndrnour", "createdAt": "2020-07-26T00:58:07Z", "path": "catroid/src/main/java/org/catrobat/catroid/io/ProjectAndSceneScreenshotLoader.java", "diffHunk": "@@ -115,6 +120,41 @@ public File getScreenshotFile(String projectName, String sceneName, boolean isBa\n \t\treturn screenshotLoader.getScreenshotFile();\n \t}\n \n+\tpublic String getScreenshotScene(File projectDir) {\n+\t\tFilenameFilter filter = new FilenameFilter() {\n+\n+\t\t\tpublic boolean accept(File f, String name) {\n+\t\t\t\treturn name.endsWith(\"screenshot.png\");\n+\t\t\t}\n+\t\t};\n+\t\tFile[] projectScreenshots = projectDir.listFiles(filter);\n+\t\tif (projectScreenshots == null || projectScreenshots.length != 0) {\n+\t\t\treturn null;\n+\t\t}\n+\t\tList<File> screenshots = new ArrayList<>();\n+\t\tfor (File scene : projectDir.listFiles()) {\n+\t\t\tFile[] sceneScreenshots = scene.listFiles(filter);\n+\t\t\tif (sceneScreenshots != null && sceneScreenshots.length > 0) {\n+\t\t\t\tscreenshots.addAll(Arrays.asList(scene.listFiles(filter)));\n+\t\t\t}\n+\t\t}\n+\t\tif (screenshots.size() < 1) {", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDQ2MzExMw==", "url": "https://github.com/Catrobat/Catroid/pull/3693#discussion_r460463113", "bodyText": "again, please no hard coded values, manual_screenshot.png is already defined in StageListener.java line 106,\ncould you move it to Constants.java and refactor its usage?", "author": "ndrnour", "createdAt": "2020-07-26T01:02:08Z", "path": "catroid/src/main/java/org/catrobat/catroid/io/ProjectAndSceneScreenshotLoader.java", "diffHunk": "@@ -115,6 +120,41 @@ public File getScreenshotFile(String projectName, String sceneName, boolean isBa\n \t\treturn screenshotLoader.getScreenshotFile();\n \t}\n \n+\tpublic String getScreenshotScene(File projectDir) {\n+\t\tFilenameFilter filter = new FilenameFilter() {\n+\n+\t\t\tpublic boolean accept(File f, String name) {\n+\t\t\t\treturn name.endsWith(\"screenshot.png\");\n+\t\t\t}\n+\t\t};\n+\t\tFile[] projectScreenshots = projectDir.listFiles(filter);\n+\t\tif (projectScreenshots == null || projectScreenshots.length != 0) {\n+\t\t\treturn null;\n+\t\t}\n+\t\tList<File> screenshots = new ArrayList<>();\n+\t\tfor (File scene : projectDir.listFiles()) {\n+\t\t\tFile[] sceneScreenshots = scene.listFiles(filter);\n+\t\t\tif (sceneScreenshots != null && sceneScreenshots.length > 0) {\n+\t\t\t\tscreenshots.addAll(Arrays.asList(scene.listFiles(filter)));\n+\t\t\t}\n+\t\t}\n+\t\tif (screenshots.size() < 1) {\n+\t\t\treturn null;\n+\t\t}\n+\t\tCollections.sort(screenshots, new Comparator<File>() {\n+\t\t\t@Override\n+\t\t\tpublic int compare(File screenshot2, File screenshot1) {\n+\t\t\t\treturn Long.compare(screenshot1.lastModified(), screenshot2.lastModified());\n+\t\t\t}\n+\t\t});\n+\t\tfor (File screenshot : screenshots) {\n+\t\t\tif (screenshot.getName().equals(\"manual_screenshot.png\")) {", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDQ2NDc0MQ==", "url": "https://github.com/Catrobat/Catroid/pull/3693#discussion_r460464741", "bodyText": "same as line 152, getParentFile() returns abstract pathname of the parent directory named by this abstract pathname, or null if this pathname does not name a parent as mentioned in https://developer.android.com/reference/java/io/File#getParentFile()\nI think you need the name of the file, right?", "author": "ndrnour", "createdAt": "2020-07-26T01:26:22Z", "path": "catroid/src/main/java/org/catrobat/catroid/io/ProjectAndSceneScreenshotLoader.java", "diffHunk": "@@ -115,6 +120,41 @@ public File getScreenshotFile(String projectName, String sceneName, boolean isBa\n \t\treturn screenshotLoader.getScreenshotFile();\n \t}\n \n+\tpublic String getScreenshotScene(File projectDir) {\n+\t\tFilenameFilter filter = new FilenameFilter() {\n+\n+\t\t\tpublic boolean accept(File f, String name) {\n+\t\t\t\treturn name.endsWith(\"screenshot.png\");\n+\t\t\t}\n+\t\t};\n+\t\tFile[] projectScreenshots = projectDir.listFiles(filter);\n+\t\tif (projectScreenshots == null || projectScreenshots.length != 0) {\n+\t\t\treturn null;\n+\t\t}\n+\t\tList<File> screenshots = new ArrayList<>();\n+\t\tfor (File scene : projectDir.listFiles()) {\n+\t\t\tFile[] sceneScreenshots = scene.listFiles(filter);\n+\t\t\tif (sceneScreenshots != null && sceneScreenshots.length > 0) {\n+\t\t\t\tscreenshots.addAll(Arrays.asList(scene.listFiles(filter)));\n+\t\t\t}\n+\t\t}\n+\t\tif (screenshots.size() < 1) {\n+\t\t\treturn null;\n+\t\t}\n+\t\tCollections.sort(screenshots, new Comparator<File>() {\n+\t\t\t@Override\n+\t\t\tpublic int compare(File screenshot2, File screenshot1) {\n+\t\t\t\treturn Long.compare(screenshot1.lastModified(), screenshot2.lastModified());\n+\t\t\t}\n+\t\t});\n+\t\tfor (File screenshot : screenshots) {\n+\t\t\tif (screenshot.getName().equals(\"manual_screenshot.png\")) {\n+\t\t\t\treturn screenshot.getParentFile().getName();\n+\t\t\t}\n+\t\t}\n+\t\treturn screenshots.get(0).getParentFile().getName();", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDY2MjQwOA==", "url": "https://github.com/Catrobat/Catroid/pull/3693#discussion_r460662408", "bodyText": "I need the name of the parent file (the scene where the screenshot is saved in), that's why I take the parent and then the name. How would you do it?", "author": "juliajulie95", "createdAt": "2020-07-27T05:58:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDQ2NDc0MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDQ2NDg5OQ==", "url": "https://github.com/Catrobat/Catroid/pull/3693#discussion_r460464899", "bodyText": "what's the reason for changing the width and height? square aspect ratio! as mentioned in the description of https://jira.catrob.at/browse/CATROID-385", "author": "ndrnour", "createdAt": "2020-07-26T01:28:53Z", "path": "catroid/src/main/res/layout/activity_upload.xml", "diffHunk": "@@ -44,65 +44,69 @@\n \n         <ImageView\n             android:id=\"@+id/project_image_view\"\n-            android:layout_width=\"100dp\"\n-            android:layout_height=\"100dp\"\n+            android:layout_width=\"72dp\"\n+            android:layout_height=\"65dp\"", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDQ2NTM5NQ==", "url": "https://github.com/Catrobat/Catroid/pull/3693#discussion_r460465395", "bodyText": "this is misleading, no single change from line 56 on, please revert it and try to avoid Reformat Code (alt+ctrl+L) for the whole file, use it only for the new code.", "author": "ndrnour", "createdAt": "2020-07-26T01:35:30Z", "path": "catroid/src/main/res/layout/activity_upload.xml", "diffHunk": "@@ -44,65 +44,69 @@\n \n         <ImageView\n             android:id=\"@+id/project_image_view\"\n-            android:layout_width=\"100dp\"\n-            android:layout_height=\"100dp\"\n+            android:layout_width=\"72dp\"\n+            android:layout_height=\"65dp\"\n+            android:layout_marginStart=\"@dimen/dialog_input_offset\"\n+            android:background=\"@drawable/image_contour\"\n+            android:cropToPadding=\"true\"\n+            android:scaleType=\"centerCrop\"\n             android:layout_marginBottom=\"@dimen/details_spacing\"/>\n \n         <LinearLayout\n             android:layout_width=\"match_parent\"\n             android:layout_height=\"wrap_content\"\n             android:orientation=\"vertical\">\n \n-        <LinearLayout", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": "f04a694d8a199abfd4940eec30bd9c23271e725d", "url": "https://github.com/Catrobat/Catroid/commit/f04a694d8a199abfd4940eec30bd9c23271e725d", "message": "CATROID-650 + CATROID-385 Project image empty if the default scene has no screenshot", "committedDate": "2020-07-27T14:56:21Z", "type": "commit"}, {"oid": "f04a694d8a199abfd4940eec30bd9c23271e725d", "url": "https://github.com/Catrobat/Catroid/commit/f04a694d8a199abfd4940eec30bd9c23271e725d", "message": "CATROID-650 + CATROID-385 Project image empty if the default scene has no screenshot", "committedDate": "2020-07-27T14:56:21Z", "type": "forcePushed"}]}