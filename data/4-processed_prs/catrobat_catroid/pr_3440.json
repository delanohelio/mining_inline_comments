{"pr_number": 3440, "pr_title": "CATROID-394 Fix Google OAuth2 Login", "pr_createdAt": "2020-01-22T11:46:40Z", "pr_url": "https://github.com/Catrobat/Catroid/pull/3440", "timeline": [{"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDA3Mzg4NQ==", "url": "https://github.com/Catrobat/Catroid/pull/3440#discussion_r370073885", "bodyText": "Pleas put this into Constants class.", "author": "DinosaurierRex", "createdAt": "2020-01-23T11:50:32Z", "path": "catroid/src/main/java/org/catrobat/catroid/transfers/GoogleLoginHandler.java", "diffHunk": "@@ -47,56 +41,44 @@\n import org.catrobat.catroid.utils.DeviceSettingsProvider;\n import org.catrobat.catroid.utils.ToastUtil;\n \n-public class GooglePlusLoginHandler implements GoogleApiClient.ConnectionCallbacks,\n-\t\tGoogleApiClient.OnConnectionFailedListener,\n-\t\tCheckOAuthTokenTask.OnCheckOAuthTokenCompleteListener,\n+import static com.google.android.gms.auth.api.signin.GoogleSignIn.getClient;\n+import static com.google.android.gms.auth.api.signin.GoogleSignIn.getSignedInAccountFromIntent;\n+\n+public class GoogleLoginHandler implements CheckOAuthTokenTask.OnCheckOAuthTokenCompleteListener,\n \t\tGoogleLogInTask.OnGoogleServerLogInCompleteListener,\n \t\tCheckEmailAvailableTask.OnCheckEmailAvailableCompleteListener,\n \t\tGoogleExchangeCodeTask.OnGoogleExchangeCodeCompleteListener {\n \n \tprivate AppCompatActivity activity;\n-\tpublic static final int GPLUS_REQUEST_CODE_SIGN_IN = 0;\n \tpublic static final int REQUEST_CODE_GOOGLE_PLUS_SIGNIN = 100;\n-\tpublic static final int STATUS_CODE_SIGN_IN_CURRENTLY_IN_PROGRESS = 12502;\n-\tprivate GoogleApiClient googleApiClient;\n-\tprivate static final String GOOGLE_PLUS_CATROWEB_SERVER_CLIENT_ID = \"427226922034-r016ige5kb30q9vflqbt1h0i3arng8u1.apps.googleusercontent.com\";\n+\tprivate GoogleSignInClient googleSignInClient;\n+\tprivate static final String GOOGLE_LOGIN_CATROWEB_SERVER_CLIENT_ID = \"427226922034-r016ige5kb30q9vflqbt1h0i3arng8u1.apps.googleusercontent.com\";", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDA3NDIwOQ==", "url": "https://github.com/Catrobat/Catroid/pull/3440#discussion_r370074209", "bodyText": "Is there a reason for a SuppressWarnings", "author": "DinosaurierRex", "createdAt": "2020-01-23T11:51:21Z", "path": "catroid/src/main/java/org/catrobat/catroid/transfers/GoogleLoginHandler.java", "diffHunk": "@@ -47,56 +41,44 @@\n import org.catrobat.catroid.utils.DeviceSettingsProvider;\n import org.catrobat.catroid.utils.ToastUtil;\n \n-public class GooglePlusLoginHandler implements GoogleApiClient.ConnectionCallbacks,\n-\t\tGoogleApiClient.OnConnectionFailedListener,\n-\t\tCheckOAuthTokenTask.OnCheckOAuthTokenCompleteListener,\n+import static com.google.android.gms.auth.api.signin.GoogleSignIn.getClient;\n+import static com.google.android.gms.auth.api.signin.GoogleSignIn.getSignedInAccountFromIntent;\n+\n+public class GoogleLoginHandler implements CheckOAuthTokenTask.OnCheckOAuthTokenCompleteListener,\n \t\tGoogleLogInTask.OnGoogleServerLogInCompleteListener,\n \t\tCheckEmailAvailableTask.OnCheckEmailAvailableCompleteListener,\n \t\tGoogleExchangeCodeTask.OnGoogleExchangeCodeCompleteListener {\n \n \tprivate AppCompatActivity activity;\n-\tpublic static final int GPLUS_REQUEST_CODE_SIGN_IN = 0;\n \tpublic static final int REQUEST_CODE_GOOGLE_PLUS_SIGNIN = 100;\n-\tpublic static final int STATUS_CODE_SIGN_IN_CURRENTLY_IN_PROGRESS = 12502;\n-\tprivate GoogleApiClient googleApiClient;\n-\tprivate static final String GOOGLE_PLUS_CATROWEB_SERVER_CLIENT_ID = \"427226922034-r016ige5kb30q9vflqbt1h0i3arng8u1.apps.googleusercontent.com\";\n+\tprivate GoogleSignInClient googleSignInClient;\n+\tprivate static final String GOOGLE_LOGIN_CATROWEB_SERVER_CLIENT_ID = \"427226922034-r016ige5kb30q9vflqbt1h0i3arng8u1.apps.googleusercontent.com\";\n \n-\tpublic GooglePlusLoginHandler(AppCompatActivity activity) {\n+\t@SuppressWarnings(\"RestrictedApi\")", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDA3NzgxOQ==", "url": "https://github.com/Catrobat/Catroid/pull/3440#discussion_r370077819", "bodyText": "As seen in this link https://stackoverflow.com/questions/49464246/when-using-firebase-googlesignin-is-marked-as-internal-and-should-not-be-access it is a known issue in version 12.0.0", "author": "PlantinumX", "createdAt": "2020-01-23T12:00:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDA3NDIwOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDA3NDc4Mw==", "url": "https://github.com/Catrobat/Catroid/pull/3440#discussion_r370074783", "bodyText": "When renaming from GOOGLE PLUS to only GOOGLE, please refactor also this variables.", "author": "DinosaurierRex", "createdAt": "2020-01-23T11:52:47Z", "path": "catroid/src/main/java/org/catrobat/catroid/transfers/GoogleLoginHandler.java", "diffHunk": "@@ -47,56 +41,44 @@\n import org.catrobat.catroid.utils.DeviceSettingsProvider;\n import org.catrobat.catroid.utils.ToastUtil;\n \n-public class GooglePlusLoginHandler implements GoogleApiClient.ConnectionCallbacks,\n-\t\tGoogleApiClient.OnConnectionFailedListener,\n-\t\tCheckOAuthTokenTask.OnCheckOAuthTokenCompleteListener,\n+import static com.google.android.gms.auth.api.signin.GoogleSignIn.getClient;\n+import static com.google.android.gms.auth.api.signin.GoogleSignIn.getSignedInAccountFromIntent;\n+\n+public class GoogleLoginHandler implements CheckOAuthTokenTask.OnCheckOAuthTokenCompleteListener,\n \t\tGoogleLogInTask.OnGoogleServerLogInCompleteListener,\n \t\tCheckEmailAvailableTask.OnCheckEmailAvailableCompleteListener,\n \t\tGoogleExchangeCodeTask.OnGoogleExchangeCodeCompleteListener {\n \n \tprivate AppCompatActivity activity;\n-\tpublic static final int GPLUS_REQUEST_CODE_SIGN_IN = 0;\n \tpublic static final int REQUEST_CODE_GOOGLE_PLUS_SIGNIN = 100;", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDA3NjAwMA==", "url": "https://github.com/Catrobat/Catroid/pull/3440#discussion_r370076000", "bodyText": "May split this up and make function calls on object", "author": "DinosaurierRex", "createdAt": "2020-01-23T11:55:40Z", "path": "catroid/src/main/java/org/catrobat/catroid/utils/Utils.java", "diffHunk": "@@ -408,9 +410,9 @@ public static void invalidateLoginTokenIfUserRestricted(Context context) {\n \tpublic static void logoutUser(Context context) {\n \t\tSharedPreferences sharedPreferences = PreferenceManager.getDefaultSharedPreferences(context);\n \t\tString userName = sharedPreferences.getString(Constants.USERNAME, Constants.NO_USERNAME);\n+\t\tnew GoogleLoginHandler((AppCompatActivity) context).getGoogleSignInClient().signOut();", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": "af64eee2ed78b7011bb05a3477c821f17358dea3", "url": "https://github.com/Catrobat/Catroid/commit/af64eee2ed78b7011bb05a3477c821f17358dea3", "message": "CATROID-394 Google Sign in not working\n\t* using recommended GoogleSignInClient and not the old deprecated GoogleApiClient\n\t* for testing pls write a Robo test and upload it on the developer Console https://www.techotopia.com/index.php/A_Firebase_Test_Lab_Instrumentation_Testing_Example", "committedDate": "2020-01-23T14:39:58Z", "type": "commit"}, {"oid": "af64eee2ed78b7011bb05a3477c821f17358dea3", "url": "https://github.com/Catrobat/Catroid/commit/af64eee2ed78b7011bb05a3477c821f17358dea3", "message": "CATROID-394 Google Sign in not working\n\t* using recommended GoogleSignInClient and not the old deprecated GoogleApiClient\n\t* for testing pls write a Robo test and upload it on the developer Console https://www.techotopia.com/index.php/A_Firebase_Test_Lab_Instrumentation_Testing_Example", "committedDate": "2020-01-23T14:39:58Z", "type": "forcePushed"}]}