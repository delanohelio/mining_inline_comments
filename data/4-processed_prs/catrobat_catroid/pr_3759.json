{"pr_number": 3759, "pr_title": "CATROID-681: Show warning for downloaded project that contains Start listening to voice and Web access bricks", "pr_createdAt": "2020-08-19T21:19:40Z", "pr_url": "https://github.com/Catrobat/Catroid/pull/3759", "timeline": [{"oid": "1d8cbefd836cd6c09540343b6d518426efcdd5e8", "url": "https://github.com/Catrobat/Catroid/commit/1d8cbefd836cd6c09540343b6d518426efcdd5e8", "message": "CATROID-681: Show warning for downloaded project that contains Start listening to voice and Web access bricks", "committedDate": "2020-08-19T21:20:08Z", "type": "forcePushed"}, {"oid": "3de81944fae4be8cc1a7cd73d5cf93d5483a7387", "url": "https://github.com/Catrobat/Catroid/commit/3de81944fae4be8cc1a7cd73d5cf93d5483a7387", "message": "CATROID-681: Show warning for downloaded project that contains Start listening to voice and Web access bricks", "committedDate": "2020-09-09T20:47:04Z", "type": "forcePushed"}, {"oid": "084ae124bc971e32e58386ccb9f0e5e4dfeff85d", "url": "https://github.com/Catrobat/Catroid/commit/084ae124bc971e32e58386ccb9f0e5e4dfeff85d", "message": "CATROID-681: Show warning for downloaded project that contains Start listening to voice and Web access bricks", "committedDate": "2020-09-09T20:57:56Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjgwNjQzOQ==", "url": "https://github.com/Catrobat/Catroid/pull/3759#discussion_r486806439", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    context.getString(R.string.preference_white_list_file_key),\n          \n          \n            \n                    context.getString(R.string.preference_approved_list_file_key),\n          \n      \n    \n    \n  \n\nMany software projects, including us in 6124d53 have, due to the developments in society, recently changed all references to white and black lists to something more racially neutral, such as trusted list or approved list.\nPlease also change at all other places in this PR that refers to whitelists.", "author": "wslany", "createdAt": "2020-09-11T06:43:05Z", "path": "catroid/src/main/java/org/catrobat/catroid/ui/ProjectUtils.kt", "diffHunk": "@@ -0,0 +1,117 @@\n+/*\n+ * Catroid: An on-device visual programming system for Android devices\n+ * Copyright (C) 2010-2020 The Catrobat Team\n+ * (<http://developer.catrobat.org/credits>)\n+ *\n+ * This program is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU Affero General Public License as\n+ * published by the Free Software Foundation, either version 3 of the\n+ * License, or (at your option) any later version.\n+ *\n+ * An additional term exception under section 7 of the GNU Affero\n+ * General Public License, version 3, is available at\n+ * http://developer.catrobat.org/license_additional_term\n+ *\n+ * This program is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * GNU Affero General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Affero General Public License\n+ * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+ */\n+\n+@file:JvmName(\"ProjectUtils\")\n+\n+/**\n+ * black listed bricks as defined in CATROID-681\n+ *\n+ * StartListeningBrick and WebRequestBrick or BackgroundRequestBrick or LookRequestBrick\n+ * */\n+\n+package org.catrobat.catroid.ui\n+\n+import android.content.Context\n+import android.content.Context.MODE_PRIVATE\n+import androidx.appcompat.app.AlertDialog\n+import org.catrobat.catroid.ProjectManager\n+import org.catrobat.catroid.R\n+import org.catrobat.catroid.content.Project\n+import org.catrobat.catroid.content.bricks.BackgroundRequestBrick\n+import org.catrobat.catroid.content.bricks.Brick\n+import org.catrobat.catroid.content.bricks.LookRequestBrick\n+import org.catrobat.catroid.content.bricks.StartListeningBrick\n+import org.catrobat.catroid.content.bricks.WebRequestBrick\n+\n+/**\n+ * extension boolean function for List<Brick> data type.\n+ * check if the list contains black-listed bricks\n+ * */\n+private fun List<Brick>.containsBlackListedBricks(): Boolean {\n+    val startListeningBrickExists = any { brick ->\n+        brick is StartListeningBrick\n+    }\n+    val backgroundRequestOrWebRequestBrickExists = any { brick ->\n+        brick is WebRequestBrick || brick is BackgroundRequestBrick || brick is LookRequestBrick\n+    }\n+    return startListeningBrickExists and backgroundRequestOrWebRequestBrickExists\n+}\n+\n+/**\n+ * extension boolean function for Project data type.\n+ * check if the project contains black-listed bricks\n+ * */\n+private fun Project.shouldDisplayWarning(): Boolean {\n+    val brickList = arrayListOf<Brick>()\n+    sceneList.forEach { scene ->\n+        brickList.run {\n+            addAll(scene.backgroundSprite.allBricks)\n+            scene.spriteList.forEach { sprite ->\n+                addAll(sprite.allBricks)\n+            }\n+        }\n+    }\n+    return brickList.containsBlackListedBricks()\n+}\n+\n+/**\n+ * [only once]!\n+ * show warning dialog for downloaded projects which contains black-listed bricks\n+ * */\n+\n+fun showWarningDialogIfNeeded(context: Context) {\n+    // used for not showing the dialog again\n+    val sharedPreferences = context.getSharedPreferences(\n+        context.getString(R.string.preference_white_list_file_key),", "originalCommit": "084ae124bc971e32e58386ccb9f0e5e4dfeff85d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "01cafd2b3274e4638b69554cd332d3f1136cdfce", "url": "https://github.com/Catrobat/Catroid/commit/01cafd2b3274e4638b69554cd332d3f1136cdfce", "message": "CATROID-681: Show warning for downloaded project that contains Start listening to voice and Web access bricks", "committedDate": "2020-09-12T15:22:15Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQyMjgyNw==", "url": "https://github.com/Catrobat/Catroid/pull/3759#discussion_r487422827", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                <!-- name of shared preference file used for storing names of white listed projects -->\n          \n          \n            \n                <string name=\"preference_approved_list_file_key\" translatable=\"false\">\n          \n          \n            \n                    security_warning_white_listed_projects</string>\n          \n          \n            \n                <!-- name of shared preference file used for storing names of approved projects -->\n          \n          \n            \n                <string name=\"preference_approved_list_file_key\" translatable=\"false\">\n          \n          \n            \n                    security_warning_approved_listed_projects</string>\n          \n      \n    \n    \n  \n\nIs this actually used anywhere?", "author": "wslany", "createdAt": "2020-09-12T15:57:26Z", "path": "catroid/src/main/res/values/strings-global.xml", "diffHunk": "@@ -53,4 +53,8 @@\n     <string name=\"terms_of_use_link_template\" translatable=\"false\">&lt;a href=%1$s>%2$s&lt;/a></string>\n     <string name=\"preference_raspi_help_link\">https://catrob.at/RaspberryPi</string>\n \n+    <!-- name of shared preference file used for storing names of white listed projects -->\n+    <string name=\"preference_approved_list_file_key\" translatable=\"false\">\n+        security_warning_white_listed_projects</string>", "originalCommit": "01cafd2b3274e4638b69554cd332d3f1136cdfce", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQzNzM0Nw==", "url": "https://github.com/Catrobat/Catroid/pull/3759#discussion_r487437347", "bodyText": "just once, as you see it's a not translatable string (instead of hard coding), so this won't be shown on Crowdin", "author": "ndrnour", "createdAt": "2020-09-12T18:47:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQyMjgyNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQyMjk3Mg==", "url": "https://github.com/Catrobat/Catroid/pull/3759#discussion_r487422972", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             * black listed bricks as defined in CATROID-681\n          \n          \n            \n             * suspicious bricks as defined in CATROID-681\n          \n      \n    \n    \n  \n\nSame here: let's not use black and white for social reasons.", "author": "wslany", "createdAt": "2020-09-12T15:59:18Z", "path": "catroid/src/main/java/org/catrobat/catroid/ui/ProjectUtils.kt", "diffHunk": "@@ -0,0 +1,130 @@\n+/*\n+ * Catroid: An on-device visual programming system for Android devices\n+ * Copyright (C) 2010-2020 The Catrobat Team\n+ * (<http://developer.catrobat.org/credits>)\n+ *\n+ * This program is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU Affero General Public License as\n+ * published by the Free Software Foundation, either version 3 of the\n+ * License, or (at your option) any later version.\n+ *\n+ * An additional term exception under section 7 of the GNU Affero\n+ * General Public License, version 3, is available at\n+ * http://developer.catrobat.org/license_additional_term\n+ *\n+ * This program is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * GNU Affero General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Affero General Public License\n+ * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+ */\n+\n+@file:JvmName(\"ProjectUtils\")\n+\n+/**\n+ * black listed bricks as defined in CATROID-681", "originalCommit": "01cafd2b3274e4638b69554cd332d3f1136cdfce", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQyMzIwMQ==", "url": "https://github.com/Catrobat/Catroid/pull/3759#discussion_r487423201", "bodyText": "Do we need a comment here? According to the clean code principle, unnecessary comments should be eliminated. I know I know ;-) there are many places, but we need to start somewhere. Anyway, if we keep it, let's replace the word \"black-listed\" by \"suspicious\" or something similar.", "author": "wslany", "createdAt": "2020-09-12T16:01:45Z", "path": "catroid/src/main/java/org/catrobat/catroid/ui/ProjectUtils.kt", "diffHunk": "@@ -0,0 +1,130 @@\n+/*\n+ * Catroid: An on-device visual programming system for Android devices\n+ * Copyright (C) 2010-2020 The Catrobat Team\n+ * (<http://developer.catrobat.org/credits>)\n+ *\n+ * This program is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU Affero General Public License as\n+ * published by the Free Software Foundation, either version 3 of the\n+ * License, or (at your option) any later version.\n+ *\n+ * An additional term exception under section 7 of the GNU Affero\n+ * General Public License, version 3, is available at\n+ * http://developer.catrobat.org/license_additional_term\n+ *\n+ * This program is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * GNU Affero General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Affero General Public License\n+ * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+ */\n+\n+@file:JvmName(\"ProjectUtils\")\n+\n+/**\n+ * black listed bricks as defined in CATROID-681\n+ *\n+ * StartListeningBrick and WebRequestBrick or BackgroundRequestBrick or LookRequestBrick\n+ * */\n+\n+package org.catrobat.catroid.ui\n+\n+import android.content.Context\n+import android.content.Context.MODE_PRIVATE\n+import androidx.appcompat.app.AlertDialog\n+import org.catrobat.catroid.ProjectManager\n+import org.catrobat.catroid.R\n+import org.catrobat.catroid.content.Project\n+import org.catrobat.catroid.content.bricks.BackgroundRequestBrick\n+import org.catrobat.catroid.content.bricks.Brick\n+import org.catrobat.catroid.content.bricks.ForeverBrick\n+import org.catrobat.catroid.content.bricks.LookRequestBrick\n+import org.catrobat.catroid.content.bricks.StartListeningBrick\n+import org.catrobat.catroid.content.bricks.WebRequestBrick\n+\n+/**\n+ * extension boolean function for List<Brick> data type.\n+ * check if the list contains black-listed bricks\n+ * */", "originalCommit": "01cafd2b3274e4638b69554cd332d3f1136cdfce", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQyMzIyNQ==", "url": "https://github.com/Catrobat/Catroid/pull/3759#discussion_r487423225", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            private fun List<Brick>.containsBlackListedBricks(): Boolean {\n          \n          \n            \n            private fun List<Brick>.containsSuspiciousBricks(): Boolean {", "author": "wslany", "createdAt": "2020-09-12T16:02:03Z", "path": "catroid/src/main/java/org/catrobat/catroid/ui/ProjectUtils.kt", "diffHunk": "@@ -0,0 +1,130 @@\n+/*\n+ * Catroid: An on-device visual programming system for Android devices\n+ * Copyright (C) 2010-2020 The Catrobat Team\n+ * (<http://developer.catrobat.org/credits>)\n+ *\n+ * This program is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU Affero General Public License as\n+ * published by the Free Software Foundation, either version 3 of the\n+ * License, or (at your option) any later version.\n+ *\n+ * An additional term exception under section 7 of the GNU Affero\n+ * General Public License, version 3, is available at\n+ * http://developer.catrobat.org/license_additional_term\n+ *\n+ * This program is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * GNU Affero General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Affero General Public License\n+ * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+ */\n+\n+@file:JvmName(\"ProjectUtils\")\n+\n+/**\n+ * black listed bricks as defined in CATROID-681\n+ *\n+ * StartListeningBrick and WebRequestBrick or BackgroundRequestBrick or LookRequestBrick\n+ * */\n+\n+package org.catrobat.catroid.ui\n+\n+import android.content.Context\n+import android.content.Context.MODE_PRIVATE\n+import androidx.appcompat.app.AlertDialog\n+import org.catrobat.catroid.ProjectManager\n+import org.catrobat.catroid.R\n+import org.catrobat.catroid.content.Project\n+import org.catrobat.catroid.content.bricks.BackgroundRequestBrick\n+import org.catrobat.catroid.content.bricks.Brick\n+import org.catrobat.catroid.content.bricks.ForeverBrick\n+import org.catrobat.catroid.content.bricks.LookRequestBrick\n+import org.catrobat.catroid.content.bricks.StartListeningBrick\n+import org.catrobat.catroid.content.bricks.WebRequestBrick\n+\n+/**\n+ * extension boolean function for List<Brick> data type.\n+ * check if the list contains black-listed bricks\n+ * */\n+private fun List<Brick>.containsBlackListedBricks(): Boolean {", "originalCommit": "01cafd2b3274e4638b69554cd332d3f1136cdfce", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQyMzUyNg==", "url": "https://github.com/Catrobat/Catroid/pull/3759#discussion_r487423526", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            /**\n          \n          \n            \n             * extension boolean function for Project data type.\n          \n          \n            \n             * check if the project contains black-listed bricks\n          \n          \n            \n             * */\n          \n          \n            \n            private fun Project.shouldDisplayWarning(): Boolean {\n          \n          \n            \n            private fun Project.shouldDisplaySuspiciousBricksWarning(): Boolean {\n          \n      \n    \n    \n  \n\nIdeally, no comments, instead use clearer names.", "author": "wslany", "createdAt": "2020-09-12T16:05:38Z", "path": "catroid/src/main/java/org/catrobat/catroid/ui/ProjectUtils.kt", "diffHunk": "@@ -0,0 +1,130 @@\n+/*\n+ * Catroid: An on-device visual programming system for Android devices\n+ * Copyright (C) 2010-2020 The Catrobat Team\n+ * (<http://developer.catrobat.org/credits>)\n+ *\n+ * This program is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU Affero General Public License as\n+ * published by the Free Software Foundation, either version 3 of the\n+ * License, or (at your option) any later version.\n+ *\n+ * An additional term exception under section 7 of the GNU Affero\n+ * General Public License, version 3, is available at\n+ * http://developer.catrobat.org/license_additional_term\n+ *\n+ * This program is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * GNU Affero General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Affero General Public License\n+ * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+ */\n+\n+@file:JvmName(\"ProjectUtils\")\n+\n+/**\n+ * black listed bricks as defined in CATROID-681\n+ *\n+ * StartListeningBrick and WebRequestBrick or BackgroundRequestBrick or LookRequestBrick\n+ * */\n+\n+package org.catrobat.catroid.ui\n+\n+import android.content.Context\n+import android.content.Context.MODE_PRIVATE\n+import androidx.appcompat.app.AlertDialog\n+import org.catrobat.catroid.ProjectManager\n+import org.catrobat.catroid.R\n+import org.catrobat.catroid.content.Project\n+import org.catrobat.catroid.content.bricks.BackgroundRequestBrick\n+import org.catrobat.catroid.content.bricks.Brick\n+import org.catrobat.catroid.content.bricks.ForeverBrick\n+import org.catrobat.catroid.content.bricks.LookRequestBrick\n+import org.catrobat.catroid.content.bricks.StartListeningBrick\n+import org.catrobat.catroid.content.bricks.WebRequestBrick\n+\n+/**\n+ * extension boolean function for List<Brick> data type.\n+ * check if the list contains black-listed bricks\n+ * */\n+private fun List<Brick>.containsBlackListedBricks(): Boolean {\n+    val startListeningBrickExists = any { brick ->\n+        brick is StartListeningBrick\n+    }\n+    val backgroundRequestOrWebRequestBrickExists = any { brick ->\n+        brick is WebRequestBrick || brick is BackgroundRequestBrick || brick is LookRequestBrick\n+    }\n+    return startListeningBrickExists and backgroundRequestOrWebRequestBrickExists\n+}\n+\n+/**\n+ * extension boolean function for Project data type.\n+ * check if the project contains black-listed bricks\n+ * */\n+private fun Project.shouldDisplayWarning(): Boolean {", "originalCommit": "01cafd2b3274e4638b69554cd332d3f1136cdfce", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQyMzYzNA==", "url": "https://github.com/Catrobat/Catroid/pull/3759#discussion_r487423634", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            /**\n          \n          \n            \n             * [only once]!\n          \n          \n            \n             * show warning dialog for downloaded projects which contains black-listed bricks\n          \n          \n            \n             * */\n          \n          \n            \n            \n          \n          \n            \n            fun showWarningDialogIfNeeded(context: Context) {\n          \n          \n            \n            fun showWarningForSuspiciousBricksOnce(context: Context) {\n          \n      \n    \n    \n  \n\nIdeally, no comments, instead use clearer names.", "author": "wslany", "createdAt": "2020-09-12T16:07:07Z", "path": "catroid/src/main/java/org/catrobat/catroid/ui/ProjectUtils.kt", "diffHunk": "@@ -0,0 +1,130 @@\n+/*\n+ * Catroid: An on-device visual programming system for Android devices\n+ * Copyright (C) 2010-2020 The Catrobat Team\n+ * (<http://developer.catrobat.org/credits>)\n+ *\n+ * This program is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU Affero General Public License as\n+ * published by the Free Software Foundation, either version 3 of the\n+ * License, or (at your option) any later version.\n+ *\n+ * An additional term exception under section 7 of the GNU Affero\n+ * General Public License, version 3, is available at\n+ * http://developer.catrobat.org/license_additional_term\n+ *\n+ * This program is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * GNU Affero General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Affero General Public License\n+ * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+ */\n+\n+@file:JvmName(\"ProjectUtils\")\n+\n+/**\n+ * black listed bricks as defined in CATROID-681\n+ *\n+ * StartListeningBrick and WebRequestBrick or BackgroundRequestBrick or LookRequestBrick\n+ * */\n+\n+package org.catrobat.catroid.ui\n+\n+import android.content.Context\n+import android.content.Context.MODE_PRIVATE\n+import androidx.appcompat.app.AlertDialog\n+import org.catrobat.catroid.ProjectManager\n+import org.catrobat.catroid.R\n+import org.catrobat.catroid.content.Project\n+import org.catrobat.catroid.content.bricks.BackgroundRequestBrick\n+import org.catrobat.catroid.content.bricks.Brick\n+import org.catrobat.catroid.content.bricks.ForeverBrick\n+import org.catrobat.catroid.content.bricks.LookRequestBrick\n+import org.catrobat.catroid.content.bricks.StartListeningBrick\n+import org.catrobat.catroid.content.bricks.WebRequestBrick\n+\n+/**\n+ * extension boolean function for List<Brick> data type.\n+ * check if the list contains black-listed bricks\n+ * */\n+private fun List<Brick>.containsBlackListedBricks(): Boolean {\n+    val startListeningBrickExists = any { brick ->\n+        brick is StartListeningBrick\n+    }\n+    val backgroundRequestOrWebRequestBrickExists = any { brick ->\n+        brick is WebRequestBrick || brick is BackgroundRequestBrick || brick is LookRequestBrick\n+    }\n+    return startListeningBrickExists and backgroundRequestOrWebRequestBrickExists\n+}\n+\n+/**\n+ * extension boolean function for Project data type.\n+ * check if the project contains black-listed bricks\n+ * */\n+private fun Project.shouldDisplayWarning(): Boolean {\n+    val brickList = arrayListOf<Brick>()\n+    sceneList.forEach { scene ->\n+        brickList.run {\n+            scene.backgroundSprite.allBricks.forEach {\n+                add(it)\n+                if (it is ForeverBrick) {\n+                    addAll(it.nestedBricks)\n+                    add(it.allParts.last())\n+                }\n+            }\n+            scene.spriteList.forEach { sprite ->\n+                sprite.allBricks.forEach {\n+                    add(it)\n+                    if (it is ForeverBrick) {\n+                        addAll(it.nestedBricks)\n+                        add(it.allParts.last())\n+                    }\n+                }\n+            }\n+        }\n+    }\n+    return brickList.containsBlackListedBricks()\n+}\n+\n+/**\n+ * [only once]!\n+ * show warning dialog for downloaded projects which contains black-listed bricks\n+ * */\n+\n+fun showWarningDialogIfNeeded(context: Context) {", "originalCommit": "01cafd2b3274e4638b69554cd332d3f1136cdfce", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQzNjY0OA==", "url": "https://github.com/Catrobat/Catroid/pull/3759#discussion_r487436648", "bodyText": "true in the ideal world & non-open-source project.", "author": "ndrnour", "createdAt": "2020-09-12T18:39:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQyMzYzNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQyMzcyNQ==", "url": "https://github.com/Catrobat/Catroid/pull/3759#discussion_r487423725", "bodyText": "This is not clear to me. Why would that be necessary? Isn't that executed only once anyway?", "author": "wslany", "createdAt": "2020-09-12T16:08:37Z", "path": "catroid/src/main/java/org/catrobat/catroid/ui/ProjectUtils.kt", "diffHunk": "@@ -0,0 +1,130 @@\n+/*\n+ * Catroid: An on-device visual programming system for Android devices\n+ * Copyright (C) 2010-2020 The Catrobat Team\n+ * (<http://developer.catrobat.org/credits>)\n+ *\n+ * This program is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU Affero General Public License as\n+ * published by the Free Software Foundation, either version 3 of the\n+ * License, or (at your option) any later version.\n+ *\n+ * An additional term exception under section 7 of the GNU Affero\n+ * General Public License, version 3, is available at\n+ * http://developer.catrobat.org/license_additional_term\n+ *\n+ * This program is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * GNU Affero General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Affero General Public License\n+ * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+ */\n+\n+@file:JvmName(\"ProjectUtils\")\n+\n+/**\n+ * black listed bricks as defined in CATROID-681\n+ *\n+ * StartListeningBrick and WebRequestBrick or BackgroundRequestBrick or LookRequestBrick\n+ * */\n+\n+package org.catrobat.catroid.ui\n+\n+import android.content.Context\n+import android.content.Context.MODE_PRIVATE\n+import androidx.appcompat.app.AlertDialog\n+import org.catrobat.catroid.ProjectManager\n+import org.catrobat.catroid.R\n+import org.catrobat.catroid.content.Project\n+import org.catrobat.catroid.content.bricks.BackgroundRequestBrick\n+import org.catrobat.catroid.content.bricks.Brick\n+import org.catrobat.catroid.content.bricks.ForeverBrick\n+import org.catrobat.catroid.content.bricks.LookRequestBrick\n+import org.catrobat.catroid.content.bricks.StartListeningBrick\n+import org.catrobat.catroid.content.bricks.WebRequestBrick\n+\n+/**\n+ * extension boolean function for List<Brick> data type.\n+ * check if the list contains black-listed bricks\n+ * */\n+private fun List<Brick>.containsBlackListedBricks(): Boolean {\n+    val startListeningBrickExists = any { brick ->\n+        brick is StartListeningBrick\n+    }\n+    val backgroundRequestOrWebRequestBrickExists = any { brick ->\n+        brick is WebRequestBrick || brick is BackgroundRequestBrick || brick is LookRequestBrick\n+    }\n+    return startListeningBrickExists and backgroundRequestOrWebRequestBrickExists\n+}\n+\n+/**\n+ * extension boolean function for Project data type.\n+ * check if the project contains black-listed bricks\n+ * */\n+private fun Project.shouldDisplayWarning(): Boolean {\n+    val brickList = arrayListOf<Brick>()\n+    sceneList.forEach { scene ->\n+        brickList.run {\n+            scene.backgroundSprite.allBricks.forEach {\n+                add(it)\n+                if (it is ForeverBrick) {\n+                    addAll(it.nestedBricks)\n+                    add(it.allParts.last())\n+                }\n+            }\n+            scene.spriteList.forEach { sprite ->\n+                sprite.allBricks.forEach {\n+                    add(it)\n+                    if (it is ForeverBrick) {\n+                        addAll(it.nestedBricks)\n+                        add(it.allParts.last())\n+                    }\n+                }\n+            }\n+        }\n+    }\n+    return brickList.containsBlackListedBricks()\n+}\n+\n+/**\n+ * [only once]!\n+ * show warning dialog for downloaded projects which contains black-listed bricks\n+ * */\n+\n+fun showWarningDialogIfNeeded(context: Context) {\n+    // used for not showing the dialog again\n+    val sharedPreferences = context.getSharedPreferences(\n+        context.getString(R.string.preference_approved_list_file_key),\n+        MODE_PRIVATE\n+    )\n+    val currentProject = ProjectManager.getInstance().currentProject\n+    val projectUrl = currentProject.xmlHeader.remixParentsUrlString\n+    // if project has an url => is a downloaded project\n+    val isDownloadedProject = projectUrl.isNotBlank()\n+    // since the projectUrl is kinda unique, ues it as key for the shared preference, if it's null\n+    // that means the dialog hasn't been displayed yet\n+    val showForFirstTime = sharedPreferences.getString(projectUrl, null).isNullOrBlank()\n+\n+    if (isDownloadedProject && currentProject.shouldDisplayWarning() && showForFirstTime) {\n+        AlertDialog.Builder(context)\n+            .setTitle(context.resources.getString(R.string.warning))\n+            .setMessage(context.resources.getString(R.string.security_warning_dialog_msg))\n+            .setCancelable(false)\n+            .setPositiveButton(context.resources.getString(R.string.ok)) { dialog, _ ->\n+                sharedPreferences\n+                    .edit()\n+                    .putString(projectUrl, projectUrl)\n+                    .apply()\n+                dialog.dismiss()\n+            }\n+            .show()\n+    } else if (isDownloadedProject) {\n+        // add it anyway to avoid showing this dialog for downloaded projects, but have\n+        // black-listed bricks added by the user afterwards..", "originalCommit": "01cafd2b3274e4638b69554cd332d3f1136cdfce", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQzNzE1Ng==", "url": "https://github.com/Catrobat/Catroid/pull/3759#discussion_r487437156", "bodyText": "this scenario will explain why is this needed:\n1- download a project which doesn't have the combination of 2 suspicious bricks,\n2- modify the project by adding suspicious bricks\n3- go to the Projects screen\n4- click on the downloaded modified project\n5- the dialog is shown, which is not the case!", "author": "ndrnour", "createdAt": "2020-09-12T18:45:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQyMzcyNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQyMzc2OA==", "url": "https://github.com/Catrobat/Catroid/pull/3759#discussion_r487423768", "bodyText": "...", "author": "wslany", "createdAt": "2020-09-12T16:09:08Z", "path": "catroid/src/main/java/org/catrobat/catroid/ui/ProjectUtils.kt", "diffHunk": "@@ -0,0 +1,130 @@\n+/*\n+ * Catroid: An on-device visual programming system for Android devices\n+ * Copyright (C) 2010-2020 The Catrobat Team\n+ * (<http://developer.catrobat.org/credits>)\n+ *\n+ * This program is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU Affero General Public License as\n+ * published by the Free Software Foundation, either version 3 of the\n+ * License, or (at your option) any later version.\n+ *\n+ * An additional term exception under section 7 of the GNU Affero\n+ * General Public License, version 3, is available at\n+ * http://developer.catrobat.org/license_additional_term\n+ *\n+ * This program is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * GNU Affero General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Affero General Public License\n+ * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+ */\n+\n+@file:JvmName(\"ProjectUtils\")\n+\n+/**\n+ * black listed bricks as defined in CATROID-681\n+ *\n+ * StartListeningBrick and WebRequestBrick or BackgroundRequestBrick or LookRequestBrick\n+ * */\n+\n+package org.catrobat.catroid.ui\n+\n+import android.content.Context\n+import android.content.Context.MODE_PRIVATE\n+import androidx.appcompat.app.AlertDialog\n+import org.catrobat.catroid.ProjectManager\n+import org.catrobat.catroid.R\n+import org.catrobat.catroid.content.Project\n+import org.catrobat.catroid.content.bricks.BackgroundRequestBrick\n+import org.catrobat.catroid.content.bricks.Brick\n+import org.catrobat.catroid.content.bricks.ForeverBrick\n+import org.catrobat.catroid.content.bricks.LookRequestBrick\n+import org.catrobat.catroid.content.bricks.StartListeningBrick\n+import org.catrobat.catroid.content.bricks.WebRequestBrick\n+\n+/**\n+ * extension boolean function for List<Brick> data type.\n+ * check if the list contains black-listed bricks\n+ * */\n+private fun List<Brick>.containsBlackListedBricks(): Boolean {\n+    val startListeningBrickExists = any { brick ->\n+        brick is StartListeningBrick\n+    }\n+    val backgroundRequestOrWebRequestBrickExists = any { brick ->\n+        brick is WebRequestBrick || brick is BackgroundRequestBrick || brick is LookRequestBrick\n+    }\n+    return startListeningBrickExists and backgroundRequestOrWebRequestBrickExists\n+}\n+\n+/**\n+ * extension boolean function for Project data type.\n+ * check if the project contains black-listed bricks\n+ * */\n+private fun Project.shouldDisplayWarning(): Boolean {\n+    val brickList = arrayListOf<Brick>()\n+    sceneList.forEach { scene ->\n+        brickList.run {\n+            scene.backgroundSprite.allBricks.forEach {\n+                add(it)\n+                if (it is ForeverBrick) {\n+                    addAll(it.nestedBricks)\n+                    add(it.allParts.last())\n+                }\n+            }\n+            scene.spriteList.forEach { sprite ->\n+                sprite.allBricks.forEach {\n+                    add(it)\n+                    if (it is ForeverBrick) {\n+                        addAll(it.nestedBricks)\n+                        add(it.allParts.last())\n+                    }\n+                }\n+            }\n+        }\n+    }\n+    return brickList.containsBlackListedBricks()", "originalCommit": "01cafd2b3274e4638b69554cd332d3f1136cdfce", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "29be37816a9705e6e3fba86830cc55740f4ff395", "url": "https://github.com/Catrobat/Catroid/commit/29be37816a9705e6e3fba86830cc55740f4ff395", "message": "CATROID-681: Show warning for downloaded project that contains Start listening to voice and Web access bricks", "committedDate": "2020-09-12T18:25:06Z", "type": "forcePushed"}, {"oid": "bc1158f17ac7414935788559a650192ddf92d069", "url": "https://github.com/Catrobat/Catroid/commit/bc1158f17ac7414935788559a650192ddf92d069", "message": "CATROID-681: Show warning for downloaded project that contains Start listening to voice and Web access bricks", "committedDate": "2020-09-12T18:26:55Z", "type": "forcePushed"}, {"oid": "39437047fc390e60f3ff29d4dbdcdc3181d8320f", "url": "https://github.com/Catrobat/Catroid/commit/39437047fc390e60f3ff29d4dbdcdc3181d8320f", "message": "CATROID-681: Show warning for downloaded project that contains Start listening to voice and Web access bricks", "committedDate": "2020-09-12T18:49:58Z", "type": "forcePushed"}, {"oid": "385a43d8c7738b9eb56f152fe5f747a682f51f3c", "url": "https://github.com/Catrobat/Catroid/commit/385a43d8c7738b9eb56f152fe5f747a682f51f3c", "message": "CATROID-681: Show warning for downloaded project that contains Start listening to voice and Web access bricks", "committedDate": "2020-09-12T18:58:32Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQ2MDE0OQ==", "url": "https://github.com/Catrobat/Catroid/pull/3759#discussion_r487460149", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    security_warning_white_listed_projects</string>\n          \n          \n            \n                    security_warning_approved_projects</string>", "author": "wslany", "createdAt": "2020-09-12T23:41:31Z", "path": "catroid/src/main/res/values/strings-global.xml", "diffHunk": "@@ -53,4 +53,8 @@\n     <string name=\"terms_of_use_link_template\" translatable=\"false\">&lt;a href=%1$s>%2$s&lt;/a></string>\n     <string name=\"preference_raspi_help_link\">https://catrob.at/RaspberryPi</string>\n \n+    <!-- name of shared preference file used for storing names of approved projects -->\n+    <string name=\"preference_approved_list_file_key\" translatable=\"false\">\n+        security_warning_white_listed_projects</string>", "originalCommit": "385a43d8c7738b9eb56f152fe5f747a682f51f3c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQ2NTIyOA==", "url": "https://github.com/Catrobat/Catroid/pull/3759#discussion_r487465228", "bodyText": "done.", "author": "ndrnour", "createdAt": "2020-09-13T00:55:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQ2MDE0OQ=="}], "type": "inlineReview"}, {"oid": "e9ee6e044269ffa9a234c56bc35b1b2945215f2b", "url": "https://github.com/Catrobat/Catroid/commit/e9ee6e044269ffa9a234c56bc35b1b2945215f2b", "message": "CATROID-681: Show warning for downloaded project that contains Start listening to voice and Web access bricks", "committedDate": "2020-09-13T00:54:15Z", "type": "commit"}, {"oid": "e9ee6e044269ffa9a234c56bc35b1b2945215f2b", "url": "https://github.com/Catrobat/Catroid/commit/e9ee6e044269ffa9a234c56bc35b1b2945215f2b", "message": "CATROID-681: Show warning for downloaded project that contains Start listening to voice and Web access bricks", "committedDate": "2020-09-13T00:54:15Z", "type": "forcePushed"}]}