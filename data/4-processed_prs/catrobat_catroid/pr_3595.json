{"pr_number": 3595, "pr_title": "CATROID-542 Introduce multiplayer variables setting and UI to create it", "pr_createdAt": "2020-05-05T12:27:54Z", "pr_url": "https://github.com/Catrobat/Catroid/pull/3595", "timeline": [{"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDQzNjg4OQ==", "url": "https://github.com/Catrobat/Catroid/pull/3595#discussion_r424436889", "bodyText": "Please make this @VisibleForTesting", "author": "gPathpp", "createdAt": "2020-05-13T13:28:14Z", "path": "catroid/src/main/java/org/catrobat/catroid/ui/settingsfragments/SettingsFragment.java", "diffHunk": "@@ -401,6 +409,16 @@ public static void enableLegoMindstormsEV3Bricks(Context context) {\n \t\t\t\t.apply();\n \t}\n \n+\tpublic static void setMultiplayerVariablesPreferenceEnabled(Context context, boolean value) {", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDQ0NjM1Mg==", "url": "https://github.com/Catrobat/Catroid/pull/3595#discussion_r424446352", "bodyText": "Please try to make this a parameterized test.", "author": "gPathpp", "createdAt": "2020-05-13T13:41:06Z", "path": "catroid/src/androidTest/java/org/catrobat/catroid/uiespresso/formulaeditor/FormulaEditorMultiplayerVariablesTest.java", "diffHunk": "@@ -0,0 +1,135 @@\n+/*\n+ * Catroid: An on-device visual programming system for Android devices\n+ * Copyright (C) 2010-2020 The Catrobat Team\n+ * (<http://developer.catrobat.org/credits>)\n+ *\n+ * This program is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU Affero General Public License as\n+ * published by the Free Software Foundation, either version 3 of the\n+ * License, or (at your option) any later version.\n+ *\n+ * An additional term exception under section 7 of the GNU Affero\n+ * General Public License, version 3, is available at\n+ * http://developer.catrobat.org/license_additional_term\n+ *\n+ * This program is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * GNU Affero General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Affero General Public License\n+ * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+ */\n+\n+package org.catrobat.catroid.uiespresso.formulaeditor;\n+\n+import org.catrobat.catroid.R;\n+import org.catrobat.catroid.content.Script;\n+import org.catrobat.catroid.content.bricks.ChangeSizeByNBrick;\n+import org.catrobat.catroid.testsuites.annotations.Cat;\n+import org.catrobat.catroid.testsuites.annotations.Level;\n+import org.catrobat.catroid.ui.SpriteActivity;\n+import org.catrobat.catroid.ui.settingsfragments.SettingsFragment;\n+import org.catrobat.catroid.uiespresso.content.brick.utils.BrickTestUtils;\n+import org.catrobat.catroid.uiespresso.util.rules.FragmentActivityTestRule;\n+import org.junit.Before;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.junit.experimental.categories.Category;\n+\n+import androidx.test.core.app.ApplicationProvider;\n+\n+import static org.catrobat.catroid.uiespresso.formulaeditor.utils.FormulaEditorWrapper.onFormulaEditor;\n+import static org.hamcrest.CoreMatchers.not;\n+\n+import static androidx.test.espresso.Espresso.onView;\n+import static androidx.test.espresso.action.ViewActions.click;\n+import static androidx.test.espresso.assertion.ViewAssertions.matches;\n+import static androidx.test.espresso.matcher.ViewMatchers.isDisplayed;\n+import static androidx.test.espresso.matcher.ViewMatchers.isEnabled;\n+import static androidx.test.espresso.matcher.ViewMatchers.withId;\n+\n+public class FormulaEditorMultiplayerVariablesTest {\n+\t@Rule\n+\tpublic FragmentActivityTestRule<SpriteActivity> baseActivityTestRule = new\n+\t\t\tFragmentActivityTestRule<>(SpriteActivity.class, SpriteActivity.EXTRA_FRAGMENT_POSITION,\n+\t\t\tSpriteActivity.FRAGMENT_SCRIPTS);\n+\n+\t@Before\n+\tpublic void setUp() throws Exception {\n+\t\tScript script = BrickTestUtils.createProjectAndGetStartScript(\"FormulaEditorMultiplayerVariablesTest\");\n+\t\tscript.addBrick(new ChangeSizeByNBrick(0));\n+\n+\t\tbaseActivityTestRule.launchActivity();\n+\n+\t\tonView(withId(R.id.brick_change_size_by_edit_text))\n+\t\t\t\t.perform(click());\n+\n+\t\tonFormulaEditor()\n+\t\t\t\t.performOpenDataFragment();\n+\t}\n+\n+\t@Category({Cat.AppUi.class, Level.Functional.class})\n+\t@Test\n+\tpublic void testMultiplayerScopeIsVisibleWithEnabledPreference() {\n+\t\tSettingsFragment.setMultiplayerVariablesPreferenceEnabled(\n+\t\t\t\tApplicationProvider.getApplicationContext(), true);\n+\n+\t\tonView(withId(R.id.button_add))\n+\t\t\t\t.perform(click());\n+\n+\t\tonView(withId(R.id.multiplayer))\n+\t\t\t\t.check(matches(isDisplayed()));\n+\t}\n+\n+\t@Category({Cat.AppUi.class, Level.Functional.class})\n+\t@Test\n+\tpublic void testMultiplayerScopeIsNotVisibleWithDisabledPreference() {\n+\t\tSettingsFragment.setMultiplayerVariablesPreferenceEnabled(\n+\t\t\t\tApplicationProvider.getApplicationContext(), false);\n+\n+\t\tonView(withId(R.id.button_add))\n+\t\t\t\t.perform(click());\n+\n+\t\tonView(withId(R.id.multiplayer))\n+\t\t\t\t.check(matches(not(isDisplayed())));\n+\t}\n+\n+\t@Category({Cat.AppUi.class, Level.Functional.class})\n+\t@Test\n+\tpublic void testMakeListOptionBecomesDisabledWhenMultiplayerScopeIsSelected() {\n+\t\tSettingsFragment.setMultiplayerVariablesPreferenceEnabled(\n+\t\t\t\tApplicationProvider.getApplicationContext(), true);\n+\t\tonView(withId(R.id.button_add))\n+\t\t\t\t.perform(click());\n+\t\tonView(withId(R.id.multiplayer))\n+\t\t\t\t.perform(click());\n+\n+\t\tonView(withId(R.id.make_list))\n+\t\t\t\t.check(matches(not(isEnabled())));\n+\n+\t\tonView(withId(R.id.global))\n+\t\t\t\t.perform(click());\n+\t\tonView(withId(R.id.make_list))\n+\t\t\t\t.check(matches(isEnabled()));\n+\t}\n+\n+\t@Category({Cat.AppUi.class, Level.Functional.class})\n+\t@Test\n+\tpublic void testMultiplayerScopeBecomesDisabledWhenMakeListIsSelected() {\n+\t\tSettingsFragment.setMultiplayerVariablesPreferenceEnabled(", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": "e9334608cf21812fbafeebbe2ad864fdcf24475f", "url": "https://github.com/Catrobat/Catroid/commit/e9334608cf21812fbafeebbe2ad864fdcf24475f", "message": "CATROID-542 Introduce multiplayer variables setting and UI to create it\n\n- Add multiplayer variables feature flag\n- Add multiplayer preference to settings screen\n- Add multiplayer scope to \"New variable\" dialogs\n- Fix typo in FormulaEditorVariableScopeTest class name", "committedDate": "2020-05-14T11:47:47Z", "type": "commit"}, {"oid": "e9334608cf21812fbafeebbe2ad864fdcf24475f", "url": "https://github.com/Catrobat/Catroid/commit/e9334608cf21812fbafeebbe2ad864fdcf24475f", "message": "CATROID-542 Introduce multiplayer variables setting and UI to create it\n\n- Add multiplayer variables feature flag\n- Add multiplayer preference to settings screen\n- Add multiplayer scope to \"New variable\" dialogs\n- Fix typo in FormulaEditorVariableScopeTest class name", "committedDate": "2020-05-14T11:47:47Z", "type": "forcePushed"}]}