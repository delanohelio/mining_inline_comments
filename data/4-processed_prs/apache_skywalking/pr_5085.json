{"pr_number": 5085, "pr_title": "Include request method type in rest mapping annotations", "pr_createdAt": "2020-07-11T14:41:35Z", "pr_url": "https://github.com/apache/skywalking/pull/5085", "timeline": [{"oid": "363fa0d39f9581b714809b02cd0aac20235b1245", "url": "https://github.com/apache/skywalking/commit/363fa0d39f9581b714809b02cd0aac20235b1245", "message": "include request method type in rest mapping annotations", "committedDate": "2020-07-11T14:38:27Z", "type": "commit"}, {"oid": "48be3d23810aad586cbf2096d076f0d5f08377c7", "url": "https://github.com/apache/skywalking/commit/48be3d23810aad586cbf2096d076f0d5f08377c7", "message": "Merge pull request #1 from apache/master\n\nmerge up", "committedDate": "2020-07-13T08:27:26Z", "type": "commit"}, {"oid": "ff83b4a0a7d50104e42d18b764d0afdb97358ae7", "url": "https://github.com/apache/skywalking/commit/ff83b4a0a7d50104e42d18b764d0afdb97358ae7", "message": "Merge pull request #3 from apache/master\n\nmerge up", "committedDate": "2020-07-15T12:48:49Z", "type": "commit"}, {"oid": "762ec83a5712fb46bedca3369228262785fa0f00", "url": "https://github.com/apache/skywalking/commit/762ec83a5712fb46bedca3369228262785fa0f00", "message": "Merge branch 'master' into spring-request-method", "committedDate": "2020-07-15T12:49:28Z", "type": "commit"}, {"oid": "3e35bbc71d46aec2df1c74214b5a23f357f8db46", "url": "https://github.com/apache/skywalking/commit/3e35bbc71d46aec2df1c74214b5a23f357f8db46", "message": "add request method to operation names", "committedDate": "2020-07-15T13:36:37Z", "type": "commit"}, {"oid": "1a572312eb6f67c09d6c0a07693470f0acdefabe", "url": "https://github.com/apache/skywalking/commit/1a572312eb6f67c09d6c0a07693470f0acdefabe", "message": "add request method to operation name", "committedDate": "2020-07-15T13:48:37Z", "type": "commit"}, {"oid": "937d9f1111e5dc692f71a9071dff958689cfad35", "url": "https://github.com/apache/skywalking/commit/937d9f1111e5dc692f71a9071dff958689cfad35", "message": "Merge branch 'master' into spring-request-method", "committedDate": "2020-07-15T13:48:56Z", "type": "commit"}, {"oid": "8ff750bba4d5d631a101341709fe7e3318dd6bc6", "url": "https://github.com/apache/skywalking/commit/8ff750bba4d5d631a101341709fe7e3318dd6bc6", "message": "add request method to operation name", "committedDate": "2020-07-16T10:32:39Z", "type": "commit"}, {"oid": "19dc85be63d4a3307e52bb00c46b397c19dd331f", "url": "https://github.com/apache/skywalking/commit/19dc85be63d4a3307e52bb00c46b397c19dd331f", "message": "Merge remote-tracking branch 'origin/spring-request-method' into spring-request-method", "committedDate": "2020-07-16T10:32:47Z", "type": "commit"}, {"oid": "a21d5c62920c59660a92d2c7fd511fa391184352", "url": "https://github.com/apache/skywalking/commit/a21d5c62920c59660a92d2c7fd511fa391184352", "message": "Merge branch 'master' into spring-request-method", "committedDate": "2020-07-16T10:33:17Z", "type": "commit"}, {"oid": "d446913b361425a83bdc7e1a5e9c3541d8a7cbbb", "url": "https://github.com/apache/skywalking/commit/d446913b361425a83bdc7e1a5e9c3541d8a7cbbb", "message": "Merge branch 'master' into spring-request-method", "committedDate": "2020-07-16T10:45:20Z", "type": "commit"}, {"oid": "086cce877f5710d6a19f076533176fc17a42560c", "url": "https://github.com/apache/skywalking/commit/086cce877f5710d6a19f076533176fc17a42560c", "message": "Merge branch 'master' into spring-request-method", "committedDate": "2020-07-17T09:57:59Z", "type": "commit"}, {"oid": "d35fcbb60e5d29f245962cb21e6294ee3fa39e1f", "url": "https://github.com/apache/skywalking/commit/d35fcbb60e5d29f245962cb21e6294ee3fa39e1f", "message": "Merge branch 'master' into spring-request-method", "committedDate": "2020-07-22T22:53:01Z", "type": "commit"}, {"oid": "0908b82d10173ca648d31abdc82277bf85d01304", "url": "https://github.com/apache/skywalking/commit/0908b82d10173ca648d31abdc82277bf85d01304", "message": "e2e fix test", "committedDate": "2020-07-23T08:44:49Z", "type": "commit"}, {"oid": "01f22cc31b6472985fd559e418bc3a32e1837890", "url": "https://github.com/apache/skywalking/commit/01f22cc31b6472985fd559e418bc3a32e1837890", "message": "Merge remote-tracking branch 'origin/spring-request-method' into spring-request-method", "committedDate": "2020-07-23T08:44:57Z", "type": "commit"}, {"oid": "7e7d84e96f60bc6e225cfd88a1f408ff0ba4c525", "url": "https://github.com/apache/skywalking/commit/7e7d84e96f60bc6e225cfd88a1f408ff0ba4c525", "message": "Merge branch 'master' into spring-request-method", "committedDate": "2020-07-23T08:45:28Z", "type": "commit"}, {"oid": "9fdd51c3e9b93a700cccf3c02ccc9a9fadba639e", "url": "https://github.com/apache/skywalking/commit/9fdd51c3e9b93a700cccf3c02ccc9a9fadba639e", "message": "Merge branch 'master' into spring-request-method", "committedDate": "2020-07-23T23:36:39Z", "type": "commit"}, {"oid": "9818c6ee26ea12dea69d32a10c1d64ca225e20a8", "url": "https://github.com/apache/skywalking/commit/9818c6ee26ea12dea69d32a10c1d64ca225e20a8", "message": "Merge branch 'master' into spring-request-method", "committedDate": "2020-07-25T13:20:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTA4NzM2Nw==", "url": "https://github.com/apache/skywalking/pull/5085#discussion_r469087367", "bodyText": "this return will cause the recursive parse to be ended\uff0c should be \u201creturn null\u201d", "author": "whfjam", "createdAt": "2020-08-12T08:19:37Z", "path": "apm-sniffer/apm-sdk-plugin/spring-plugins/mvc-annotation-commons/src/main/java/org/apache/skywalking/apm/plugin/spring/mvc/commons/interceptor/RestMappingMethodInterceptor.java", "diffHunk": "@@ -80,6 +80,20 @@ public String getRequestURL(Method method) {\n \n     @Override\n     public String getAcceptedMethodTypes(Method method) {\n-        return \"\";\n+        return ParsePathUtil.recursiveParseMethodAnnotation(method, m -> {\n+            if (AnnotationUtils.getAnnotation(m, GetMapping.class) != null) {\n+                return \"{GET}\";\n+            } else if (AnnotationUtils.getAnnotation(m, PostMapping.class) != null) {\n+                return \"{POST}\";\n+            } else if (AnnotationUtils.getAnnotation(m, PutMapping.class) != null) {\n+                return \"{PUT}\";\n+            } else if (AnnotationUtils.getAnnotation(m, DeleteMapping.class) != null) {\n+                return \"{DELETE}\";\n+            } else if (AnnotationUtils.getAnnotation(m, PatchMapping.class) != null) {\n+                return \"{PATCH}\";\n+            } else {\n+                return \"\";", "originalCommit": "9818c6ee26ea12dea69d32a10c1d64ca225e20a8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTA4Nzc5NQ==", "url": "https://github.com/apache/skywalking/pull/5085#discussion_r469087795", "bodyText": "consider about return RequestMethod.GET.toString(); and so on", "author": "whfjam", "createdAt": "2020-08-12T08:20:20Z", "path": "apm-sniffer/apm-sdk-plugin/spring-plugins/mvc-annotation-commons/src/main/java/org/apache/skywalking/apm/plugin/spring/mvc/commons/interceptor/RestMappingMethodInterceptor.java", "diffHunk": "@@ -80,6 +80,20 @@ public String getRequestURL(Method method) {\n \n     @Override\n     public String getAcceptedMethodTypes(Method method) {\n-        return \"\";\n+        return ParsePathUtil.recursiveParseMethodAnnotation(method, m -> {\n+            if (AnnotationUtils.getAnnotation(m, GetMapping.class) != null) {\n+                return \"{GET}\";", "originalCommit": "9818c6ee26ea12dea69d32a10c1d64ca225e20a8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTEwMTg3Ng==", "url": "https://github.com/apache/skywalking/pull/5085#discussion_r469101876", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            return \"\";\n          \n          \n            \n                            return null;", "author": "BFergerson", "createdAt": "2020-08-12T08:43:10Z", "path": "apm-sniffer/apm-sdk-plugin/spring-plugins/mvc-annotation-commons/src/main/java/org/apache/skywalking/apm/plugin/spring/mvc/commons/interceptor/RestMappingMethodInterceptor.java", "diffHunk": "@@ -80,6 +80,20 @@ public String getRequestURL(Method method) {\n \n     @Override\n     public String getAcceptedMethodTypes(Method method) {\n-        return \"\";\n+        return ParsePathUtil.recursiveParseMethodAnnotation(method, m -> {\n+            if (AnnotationUtils.getAnnotation(m, GetMapping.class) != null) {\n+                return \"{GET}\";\n+            } else if (AnnotationUtils.getAnnotation(m, PostMapping.class) != null) {\n+                return \"{POST}\";\n+            } else if (AnnotationUtils.getAnnotation(m, PutMapping.class) != null) {\n+                return \"{PUT}\";\n+            } else if (AnnotationUtils.getAnnotation(m, DeleteMapping.class) != null) {\n+                return \"{DELETE}\";\n+            } else if (AnnotationUtils.getAnnotation(m, PatchMapping.class) != null) {\n+                return \"{PATCH}\";\n+            } else {\n+                return \"\";", "originalCommit": "9818c6ee26ea12dea69d32a10c1d64ca225e20a8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e90f54743dce07d667bb2ccc469460501402c67f", "url": "https://github.com/apache/skywalking/commit/e90f54743dce07d667bb2ccc469460501402c67f", "message": "Update apm-sniffer/apm-sdk-plugin/spring-plugins/mvc-annotation-commons/src/main/java/org/apache/skywalking/apm/plugin/spring/mvc/commons/interceptor/RestMappingMethodInterceptor.java", "committedDate": "2020-08-12T08:43:16Z", "type": "commit"}, {"oid": "a409fa3afbdcb9a4427aaebb8aa565802173a18c", "url": "https://github.com/apache/skywalking/commit/a409fa3afbdcb9a4427aaebb8aa565802173a18c", "message": "Merge branch 'master' into spring-request-method", "committedDate": "2020-08-12T08:43:29Z", "type": "commit"}, {"oid": "269f3d83ed11428a25b29dad01784646cbced710", "url": "https://github.com/apache/skywalking/commit/269f3d83ed11428a25b29dad01784646cbced710", "message": "Merge branch 'master' into spring-request-method", "committedDate": "2020-08-12T09:55:03Z", "type": "commit"}, {"oid": "f8d14f75e7e847de3caa17fe53063af1635bae08", "url": "https://github.com/apache/skywalking/commit/f8d14f75e7e847de3caa17fe53063af1635bae08", "message": "Merge branch 'master' into spring-request-method", "committedDate": "2020-08-17T13:32:45Z", "type": "commit"}, {"oid": "42eba1f39a678069d546e369cd5c1369d3ca39c6", "url": "https://github.com/apache/skywalking/commit/42eba1f39a678069d546e369cd5c1369d3ca39c6", "message": "fix test", "committedDate": "2020-08-17T14:13:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU1NjE3NA==", "url": "https://github.com/apache/skywalking/pull/5085#discussion_r471556174", "bodyText": "I think for safe, this should return \"\", right?", "author": "wu-sheng", "createdAt": "2020-08-17T15:25:28Z", "path": "apm-sniffer/apm-sdk-plugin/spring-plugins/mvc-annotation-commons/src/main/java/org/apache/skywalking/apm/plugin/spring/mvc/commons/interceptor/RestMappingMethodInterceptor.java", "diffHunk": "@@ -80,6 +80,20 @@ public String getRequestURL(Method method) {\n \n     @Override\n     public String getAcceptedMethodTypes(Method method) {\n-        return \"\";\n+        return ParsePathUtil.recursiveParseMethodAnnotation(method, m -> {\n+            if (AnnotationUtils.getAnnotation(m, GetMapping.class) != null) {\n+                return \"{GET}\";\n+            } else if (AnnotationUtils.getAnnotation(m, PostMapping.class) != null) {\n+                return \"{POST}\";\n+            } else if (AnnotationUtils.getAnnotation(m, PutMapping.class) != null) {\n+                return \"{PUT}\";\n+            } else if (AnnotationUtils.getAnnotation(m, DeleteMapping.class) != null) {\n+                return \"{DELETE}\";\n+            } else if (AnnotationUtils.getAnnotation(m, PatchMapping.class) != null) {\n+                return \"{PATCH}\";\n+            } else {\n+                return null;", "originalCommit": "42eba1f39a678069d546e369cd5c1369d3ca39c6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU2NTQxMw==", "url": "https://github.com/apache/skywalking/pull/5085#discussion_r471565413", "bodyText": "I'm sure it'll always end up being \"\" but returning null allows \n  \n    \n      skywalking/apm-sniffer/apm-sdk-plugin/spring-plugins/mvc-annotation-commons/src/main/java/org/apache/skywalking/apm/plugin/spring/mvc/commons/ParsePathUtil.java\n    \n    \n         Line 34\n      in\n      b173cde\n    \n    \n    \n    \n\n        \n          \n           if (Objects.isNull(result)) { \n        \n    \n  \n\n to execute.", "author": "BFergerson", "createdAt": "2020-08-17T15:39:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU1NjE3NA=="}], "type": "inlineReview"}, {"oid": "5931972de055da85dbb7f48c977dcf5685ada8d8", "url": "https://github.com/apache/skywalking/commit/5931972de055da85dbb7f48c977dcf5685ada8d8", "message": "test", "committedDate": "2020-08-17T16:11:24Z", "type": "commit"}, {"oid": "ac8ed16e9db68afde4d8f4f6831d151fc4566c9a", "url": "https://github.com/apache/skywalking/commit/ac8ed16e9db68afde4d8f4f6831d151fc4566c9a", "message": "test", "committedDate": "2020-08-17T16:14:03Z", "type": "commit"}, {"oid": "58b39775d2e0086df9d767780757243217630e4b", "url": "https://github.com/apache/skywalking/commit/58b39775d2e0086df9d767780757243217630e4b", "message": "test", "committedDate": "2020-08-17T16:14:48Z", "type": "commit"}, {"oid": "190ca93b6bf48e9d966de5b05cd6490ba54b7266", "url": "https://github.com/apache/skywalking/commit/190ca93b6bf48e9d966de5b05cd6490ba54b7266", "message": "test", "committedDate": "2020-08-17T16:53:02Z", "type": "commit"}, {"oid": "4f994e851f139deac4db6e8789def2e276117f04", "url": "https://github.com/apache/skywalking/commit/4f994e851f139deac4db6e8789def2e276117f04", "message": "Merge branch 'master' into spring-request-method", "committedDate": "2020-09-05T07:24:18Z", "type": "commit"}, {"oid": "02c027b27d63c0dfca127cd226877da069858d91", "url": "https://github.com/apache/skywalking/commit/02c027b27d63c0dfca127cd226877da069858d91", "message": "fix test", "committedDate": "2020-09-05T13:42:46Z", "type": "commit"}, {"oid": "07ca126580436947f8c24421c18add2a7d7e1ac3", "url": "https://github.com/apache/skywalking/commit/07ca126580436947f8c24421c18add2a7d7e1ac3", "message": "Merge branch 'master' into spring-request-method", "committedDate": "2020-09-05T13:43:08Z", "type": "commit"}, {"oid": "296cf26f6b1bda8fda1779a86d6db78692578360", "url": "https://github.com/apache/skywalking/commit/296cf26f6b1bda8fda1779a86d6db78692578360", "message": "add method type to operation name", "committedDate": "2020-09-05T14:13:24Z", "type": "commit"}]}