{"pr_number": 5209, "pr_title": "The Dubbo plugin can collect more information by custom", "pr_createdAt": "2020-07-31T04:18:28Z", "pr_url": "https://github.com/apache/skywalking/pull/5209", "timeline": [{"oid": "6b40f680cdb68d0d717abb75cc2c2dda2d53555a", "url": "https://github.com/apache/skywalking/commit/6b40f680cdb68d0d717abb75cc2c2dda2d53555a", "message": "The Dubbo plugin can collect more information by custom", "committedDate": "2020-07-31T04:13:16Z", "type": "commit"}, {"oid": "d302bbc94164d427b494d2a71660791fdaf5f703", "url": "https://github.com/apache/skywalking/commit/d302bbc94164d427b494d2a71660791fdaf5f703", "message": "fix", "committedDate": "2020-07-31T04:22:42Z", "type": "commit"}, {"oid": "a1e671c64b4e306335eb9867f14e7c76ab1b7fcc", "url": "https://github.com/apache/skywalking/commit/a1e671c64b4e306335eb9867f14e7c76ab1b7fcc", "message": "Merge branch 'master' into zhaoyuguang_0002", "committedDate": "2020-07-31T04:38:51Z", "type": "commit"}, {"oid": "ed7639435cebc955d0554b2a5ec32af6f50d0965", "url": "https://github.com/apache/skywalking/commit/ed7639435cebc955d0554b2a5ec32af6f50d0965", "message": "revert", "committedDate": "2020-07-31T06:01:49Z", "type": "commit"}, {"oid": "1353890988cc5ff5d17cf1b3e50f6ed2f1f63d47", "url": "https://github.com/apache/skywalking/commit/1353890988cc5ff5d17cf1b3e50f6ed2f1f63d47", "message": "Merge branch 'zhaoyuguang_0002' of https://github.com/zhaoyuguang/incubator-skywalking into zhaoyuguang_0002", "committedDate": "2020-07-31T06:02:05Z", "type": "commit"}, {"oid": "d6dc590fce345d9aca341b9fd87a3bbd6cec5886", "url": "https://github.com/apache/skywalking/commit/d6dc590fce345d9aca341b9fd87a3bbd6cec5886", "message": "revert", "committedDate": "2020-07-31T06:05:05Z", "type": "commit"}, {"oid": "de7250083f220d916a2c6bf4a28e291476736851", "url": "https://github.com/apache/skywalking/commit/de7250083f220d916a2c6bf4a28e291476736851", "message": "revert", "committedDate": "2020-07-31T06:06:34Z", "type": "commit"}, {"oid": "0c6b63ad48abba2b0efb31b89e4b95ac0628c71e", "url": "https://github.com/apache/skywalking/commit/0c6b63ad48abba2b0efb31b89e4b95ac0628c71e", "message": "revert", "committedDate": "2020-07-31T06:09:43Z", "type": "commit"}, {"oid": "30951f4dfa58a3498794b8f69e3da55c2a55e4e8", "url": "https://github.com/apache/skywalking/commit/30951f4dfa58a3498794b8f69e3da55c2a55e4e8", "message": "revert", "committedDate": "2020-07-31T06:12:26Z", "type": "commit"}, {"oid": "e6cb18ec558047feac11cce0f5c97b27c3ff0cf3", "url": "https://github.com/apache/skywalking/commit/e6cb18ec558047feac11cce0f5c97b27c3ff0cf3", "message": "revert", "committedDate": "2020-07-31T06:12:55Z", "type": "commit"}, {"oid": "863775cd827c21ab39771360b182e10c3ea09cca", "url": "https://github.com/apache/skywalking/commit/863775cd827c21ab39771360b182e10c3ea09cca", "message": "1", "committedDate": "2020-07-31T06:16:30Z", "type": "commit"}, {"oid": "ffae4b2605b42974ace3ca250b80f535727a77d5", "url": "https://github.com/apache/skywalking/commit/ffae4b2605b42974ace3ca250b80f535727a77d5", "message": "1", "committedDate": "2020-07-31T06:16:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzQyNTAxMA==", "url": "https://github.com/apache/skywalking/pull/5209#discussion_r463425010", "bodyText": "Isn't remote == peer? I am a little confused.", "author": "wu-sheng", "createdAt": "2020-07-31T06:17:20Z", "path": "docs/en/setup/service-agent/java-agent/README.md", "diffHunk": "@@ -135,7 +135,13 @@ property key | Description | Default |\n `correlation.element_max_number`|Max element count of the correlation context.|`3`|\n `correlation.value_max_length`|Max value length of correlation context element.|`128`|\n `plugin.kafka.bootstrap_servers`| A list of host/port pairs to use for establishing the initial connection to the Kafka cluster. | `localhost:9092`\n-`plugin.kafka.consumer_config`| Kafka producer configuration. |\n+`plugin.kafka.consumer_config`| Kafka producer configuration. ||\n+`plugin.dubbo.collect_consumer_address`| Apache Dubbo consumer collect `remote_address` and `local_address` in RPC call. |`false`| ", "originalCommit": "e6cb18ec558047feac11cce0f5c97b27c3ff0cf3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzQyNTk3OA==", "url": "https://github.com/apache/skywalking/pull/5209#discussion_r463425978", "bodyText": "remote_address and local_address is the port and IP of  Netty channel", "author": "zhaoyuguang", "createdAt": "2020-07-31T06:20:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzQyNTAxMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzQyNjk3NA==", "url": "https://github.com/apache/skywalking/pull/5209#discussion_r463426974", "bodyText": "What does today's peer look like?", "author": "wu-sheng", "createdAt": "2020-07-31T06:24:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzQyNTAxMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzQyNzU0MA==", "url": "https://github.com/apache/skywalking/pull/5209#discussion_r463427540", "bodyText": "Isn't remote == peer? I am a little confused.\n\nyes, when dubbo consumer,  remote == peer", "author": "zhaoyuguang", "createdAt": "2020-07-31T06:25:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzQyNTAxMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzQyODIxMw==", "url": "https://github.com/apache/skywalking/pull/5209#discussion_r463428213", "bodyText": "Why doesn't use peer in the entry span to collect this remote-IP directly? Also, at the same time, isn't local IP should be a part of instance information? Do you have concerns about the multiple IPs issue?", "author": "wu-sheng", "createdAt": "2020-07-31T06:27:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzQyNTAxMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzQzMDUzMA==", "url": "https://github.com/apache/skywalking/pull/5209#discussion_r463430530", "bodyText": "plugin.dubbo.collect_consumer_address  is redundant. I deleted it", "author": "zhaoyuguang", "createdAt": "2020-07-31T06:34:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzQyNTAxMA=="}], "type": "inlineReview"}, {"oid": "35860747ed23e5c9ecd1b235b1a9ecc4a17e83ca", "url": "https://github.com/apache/skywalking/commit/35860747ed23e5c9ecd1b235b1a9ecc4a17e83ca", "message": "remove  CONSUMER_ADDRESS", "committedDate": "2020-07-31T06:33:44Z", "type": "commit"}, {"oid": "e1c5bcbac11d4e0f1d866c43e0d1f9a2fa4add06", "url": "https://github.com/apache/skywalking/commit/e1c5bcbac11d4e0f1d866c43e0d1f9a2fa4add06", "message": "Merge branch 'master' into zhaoyuguang_0002", "committedDate": "2020-07-31T08:50:28Z", "type": "commit"}, {"oid": "5ddee1921c606682ff24e85d53011ee5af52a25f", "url": "https://github.com/apache/skywalking/commit/5ddee1921c606682ff24e85d53011ee5af52a25f", "message": "Merge branch 'master' into zhaoyuguang_0002", "committedDate": "2020-07-31T14:24:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzY0MzU3Mw==", "url": "https://github.com/apache/skywalking/pull/5209#discussion_r463643573", "bodyText": "Notice, the provider side is EntrySpan, which has #setPeer too. Please recheck.", "author": "wu-sheng", "createdAt": "2020-07-31T14:27:07Z", "path": "docs/en/setup/service-agent/java-agent/README.md", "diffHunk": "@@ -135,7 +135,12 @@ property key | Description | Default |\n `correlation.element_max_number`|Max element count of the correlation context.|`3`|\n `correlation.value_max_length`|Max value length of correlation context element.|`128`|\n `plugin.kafka.bootstrap_servers`| A list of host/port pairs to use for establishing the initial connection to the Kafka cluster. | `localhost:9092`\n-`plugin.kafka.consumer_config`| Kafka producer configuration. |\n+`plugin.kafka.consumer_config`| Kafka producer configuration. ||\n+`plugin.dubbo.collect_consumer_arguments`| Apache Dubbo consumer collect `arguments` in RPC call. |`false`| \n+`plugin.dubbo.consumer_arguments_length_threshold`| When `plugin.dubbo.collect_consumer_arguments` is `true`, Arguments of length from the front will to the OAP backend |`256`| \n+`plugin.dubbo.collect_provider_address`| Apache Dubbo provider collect `remote_address` and `local_address` in RPC call. |`false`| ", "originalCommit": "5ddee1921c606682ff24e85d53011ee5af52a25f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzY0MzkxMA==", "url": "https://github.com/apache/skywalking/pull/5209#discussion_r463643910", "bodyText": "Do you forget to remove this? skywalking.plugin.dubbo.collect_consumer_address=true.", "author": "wu-sheng", "createdAt": "2020-07-31T14:27:44Z", "path": "test/plugin/scenarios/dubbo-2.7.x-scenario/bin/startup.sh", "diffHunk": "@@ -18,4 +18,5 @@\n \n home=\"$(cd \"$(dirname $0)\"; pwd)\"\n \n-java -jar ${agent_opts} ${home}/../libs/dubbo-2.7.x-scenario.jar &\n\\ No newline at end of file\n+java -Dskywalking.plugin.dubbo.collect_consumer_address=true -Dskywalking.plugin.dubbo.collect_consumer_arguments=true \\", "originalCommit": "5ddee1921c606682ff24e85d53011ee5af52a25f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDgwNDY2Mw==", "url": "https://github.com/apache/skywalking/pull/5209#discussion_r464804663", "bodyText": "fixed. please recheck", "author": "zhaoyuguang", "createdAt": "2020-08-04T05:16:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzY0MzkxMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzY0NTg3Mg==", "url": "https://github.com/apache/skywalking/pull/5209#discussion_r463645872", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            `plugin.kafka.consumer_config`| Kafka producer configuration. ||\n          \n          \n            \n            `plugin.kafka. producer_config`| Kafka producer configuration. ||\n          \n      \n    \n    \n  \n\n@dmsolr Is this a typo in the previous doc? And I think you miss the other configurations of topic names in here and backend documentations.\nAlso, backend documents have some typo issues too.", "author": "wu-sheng", "createdAt": "2020-07-31T14:31:20Z", "path": "docs/en/setup/service-agent/java-agent/README.md", "diffHunk": "@@ -135,7 +135,12 @@ property key | Description | Default |\n `correlation.element_max_number`|Max element count of the correlation context.|`3`|\n `correlation.value_max_length`|Max value length of correlation context element.|`128`|\n `plugin.kafka.bootstrap_servers`| A list of host/port pairs to use for establishing the initial connection to the Kafka cluster. | `localhost:9092`\n-`plugin.kafka.consumer_config`| Kafka producer configuration. |\n+`plugin.kafka.consumer_config`| Kafka producer configuration. ||", "originalCommit": "5ddee1921c606682ff24e85d53011ee5af52a25f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzY3NDUwOA==", "url": "https://github.com/apache/skywalking/pull/5209#discussion_r463674508", "bodyText": "Fixed through #5214", "author": "wu-sheng", "createdAt": "2020-07-31T15:21:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzY0NTg3Mg=="}], "type": "inlineReview"}, {"oid": "804277c25918815a03c7495c102c5d63d6c3aa96", "url": "https://github.com/apache/skywalking/commit/804277c25918815a03c7495c102c5d63d6c3aa96", "message": "Merge branch 'master' into zhaoyuguang_0002", "committedDate": "2020-08-04T03:28:53Z", "type": "commit"}, {"oid": "1570cbb1e71ae5a1efc7c73a926f4545fa4f6b31", "url": "https://github.com/apache/skywalking/commit/1570cbb1e71ae5a1efc7c73a926f4545fa4f6b31", "message": "fix", "committedDate": "2020-08-04T04:00:39Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDg0MjI5Mw==", "url": "https://github.com/apache/skywalking/pull/5209#discussion_r464842293", "bodyText": "I prefer you to add this directly, rather than config. This is a light op, should not affect the performance like the arguments.", "author": "wu-sheng", "createdAt": "2020-08-04T07:04:32Z", "path": "apm-sniffer/apm-sdk-plugin/dubbo-2.7.x-plugin/src/main/java/org/apache/skywalking/apm/plugin/asf/dubbo/DubboInterceptor.java", "diffHunk": "@@ -83,16 +94,22 @@ public void beforeMethod(EnhancedInstance objInst, Method method, Object[] allAr\n             }\n \n             span = ContextManager.createEntrySpan(generateOperationName(requestURL, invocation), contextCarrier);\n+            if (DubboPluginConfig.Plugin.Dubbo.COLLECT_PROVIDER_REMOTE_ADDRESS) {", "originalCommit": "1570cbb1e71ae5a1efc7c73a926f4545fa4f6b31", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDg5NjQ0MA==", "url": "https://github.com/apache/skywalking/pull/5209#discussion_r464896440", "bodyText": "Yes, has remove  please recheck", "author": "zhaoyuguang", "createdAt": "2020-08-04T08:44:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDg0MjI5Mw=="}], "type": "inlineReview"}, {"oid": "0a626d23d142958cd65a5b72a5c70a4b88560aa0", "url": "https://github.com/apache/skywalking/commit/0a626d23d142958cd65a5b72a5c70a4b88560aa0", "message": "fix", "committedDate": "2020-08-04T08:43:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDkwOTk3MQ==", "url": "https://github.com/apache/skywalking/pull/5209#discussion_r464909971", "bodyText": "So, this depends on parameter#toString, right? Is this a recommended way? Or should we consider JSON? I am not using Dubbo for a long time. Is Dubbo having toString already?", "author": "wu-sheng", "createdAt": "2020-08-04T09:07:50Z", "path": "apm-sniffer/apm-sdk-plugin/dubbo-2.7.x-plugin/src/main/java/org/apache/skywalking/apm/plugin/asf/dubbo/DubboInterceptor.java", "diffHunk": "@@ -152,4 +165,26 @@ private String generateRequestURL(URL url, Invocation invocation) {\n         requestURL.append(generateOperationName(url, invocation));\n         return requestURL.toString();\n     }\n+\n+    private void collectArguments(boolean needCollectArguments, int argumentsLengthThreshold, AbstractSpan span, Invocation invocation) {\n+        if (needCollectArguments && argumentsLengthThreshold > 0) {\n+            Object[] parameters = invocation.getArguments();\n+            if (parameters != null && parameters.length > 0) {\n+                StringBuilder stringBuilder = new StringBuilder();\n+                boolean first = true;\n+                for (Object parameter : parameters) {\n+                    if (!first) {\n+                        stringBuilder.append(\",\");\n+                    }\n+                    stringBuilder.append(parameter);", "originalCommit": "0a626d23d142958cd65a5b72a5c70a4b88560aa0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDkzODc4OQ==", "url": "https://github.com/apache/skywalking/pull/5209#discussion_r464938789", "bodyText": "It's the object's own toString, which the user has to implement, I had modify markdown file", "author": "zhaoyuguang", "createdAt": "2020-08-04T09:58:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDkwOTk3MQ=="}], "type": "inlineReview"}, {"oid": "27e3da75f75297cb8148e50e585129eece1fbefe", "url": "https://github.com/apache/skywalking/commit/27e3da75f75297cb8148e50e585129eece1fbefe", "message": "fix", "committedDate": "2020-08-04T09:57:06Z", "type": "commit"}, {"oid": "351af86d6c0e47bfd532ee4c8dd3d72bcc4c594e", "url": "https://github.com/apache/skywalking/commit/351af86d6c0e47bfd532ee4c8dd3d72bcc4c594e", "message": "Update README.md\n\nRe-word.", "committedDate": "2020-08-04T10:01:50Z", "type": "commit"}, {"oid": "ea87ab0258fcc0570dcd394f534f51410f5253fc", "url": "https://github.com/apache/skywalking/commit/ea87ab0258fcc0570dcd394f534f51410f5253fc", "message": "Merge branch 'master' into zhaoyuguang_0002", "committedDate": "2020-08-04T11:05:07Z", "type": "commit"}, {"oid": "511d6b5c7885f472ec8b755d92c8074620674ac2", "url": "https://github.com/apache/skywalking/commit/511d6b5c7885f472ec8b755d92c8074620674ac2", "message": "fix", "committedDate": "2020-08-04T13:25:29Z", "type": "commit"}, {"oid": "ea83ea010f4699d1c577f4d9ece82604ff185df8", "url": "https://github.com/apache/skywalking/commit/ea83ea010f4699d1c577f4d9ece82604ff185df8", "message": "Merge branch 'master' into zhaoyuguang_0002", "committedDate": "2020-08-04T14:12:14Z", "type": "commit"}]}