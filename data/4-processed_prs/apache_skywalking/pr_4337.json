{"pr_number": 4337, "pr_title": "Set up more strict code styles and fix existing issues", "pr_createdAt": "2020-02-09T13:12:58Z", "pr_url": "https://github.com/apache/skywalking/pull/4337", "timeline": [{"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njc4MzcyNg==", "url": "https://github.com/apache/skywalking/pull/4337#discussion_r376783726", "bodyText": "Why include #?", "author": "wu-sheng", "createdAt": "2020-02-09T13:24:18Z", "path": ".github/workflows/ci-it.yaml", "diffHunk": "@@ -38,11 +38,26 @@ jobs:\n       - uses: actions/setup-java@v1\n         with:\n           java-version: 8\n+\n+      - name: Setup reviewdog\n+        run: |\n+          mkdir -p $HOME/bin && curl -sfL https://raw.githubusercontent.com/reviewdog/reviewdog/master/install.sh| sh -s -- -b $HOME/bin\n+          echo ::add-path::$HOME/bin\n+          echo ::add-path::$(go env GOPATH)/bin # for Go projects\n+\n       - name: 'Install & Test'\n         run: |\n           export MAVEN_OPTS='-XX:+TieredCompilation -XX:TieredStopAtLevel=1 -XX:+CMSClassUnloadingEnabled -XX:+UseConcMarkSweepGC -XX:-UseGCOverheadLimit -Xmx3g'\n-          ./mvnw --batch-mode -P\"agent,backend,ui,dist,CI-with-IT\" clean cobertura:cobertura verify install javadoc:javadoc\n-          CODECOV_TOKEN=\"d2065307-8f01-4637-9715-2781ef096db7\" bash <(curl -s https://codecov.io/bash)\n+          ./mvnw --batch-mode -DskipTests -Drat.skip install # -P\"agent,backend,ui,dist,CI-with-IT\" clean cobertura:cobertura verify install javadoc:javadoc\n+          # CODECOV_TOKEN=\"d2065307-8f01-4637-9715-2781ef096db7\" bash <(curl -s https://codecov.io/bash)", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njc4NDI0OQ==", "url": "https://github.com/apache/skywalking/pull/4337#discussion_r376784249", "bodyText": "Obviously just for quick testing, will revert when test finished", "author": "kezhenxu94", "createdAt": "2020-02-09T13:32:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njc4MzcyNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njc4Mzc3NQ==", "url": "https://github.com/apache/skywalking/pull/4337#discussion_r376783775", "bodyText": "Have you requested open reviewdog on GitHub?", "author": "wu-sheng", "createdAt": "2020-02-09T13:25:19Z", "path": ".github/workflows/ci-it.yaml", "diffHunk": "@@ -38,11 +38,26 @@ jobs:\n       - uses: actions/setup-java@v1\n         with:\n           java-version: 8\n+\n+      - name: Setup reviewdog", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njc4NDI2Ng==", "url": "https://github.com/apache/skywalking/pull/4337#discussion_r376784266", "bodyText": "no need", "author": "kezhenxu94", "createdAt": "2020-02-09T13:32:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njc4Mzc3NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njc4Mzc5Mw==", "url": "https://github.com/apache/skywalking/pull/4337#discussion_r376783793", "bodyText": "Do we have this token?", "author": "wu-sheng", "createdAt": "2020-02-09T13:25:33Z", "path": ".github/workflows/ci-it.yaml", "diffHunk": "@@ -38,11 +38,26 @@ jobs:\n       - uses: actions/setup-java@v1\n         with:\n           java-version: 8\n+\n+      - name: Setup reviewdog\n+        run: |\n+          mkdir -p $HOME/bin && curl -sfL https://raw.githubusercontent.com/reviewdog/reviewdog/master/install.sh| sh -s -- -b $HOME/bin\n+          echo ::add-path::$HOME/bin\n+          echo ::add-path::$(go env GOPATH)/bin # for Go projects\n+\n       - name: 'Install & Test'\n         run: |\n           export MAVEN_OPTS='-XX:+TieredCompilation -XX:TieredStopAtLevel=1 -XX:+CMSClassUnloadingEnabled -XX:+UseConcMarkSweepGC -XX:-UseGCOverheadLimit -Xmx3g'\n-          ./mvnw --batch-mode -P\"agent,backend,ui,dist,CI-with-IT\" clean cobertura:cobertura verify install javadoc:javadoc\n-          CODECOV_TOKEN=\"d2065307-8f01-4637-9715-2781ef096db7\" bash <(curl -s https://codecov.io/bash)\n+          ./mvnw --batch-mode -DskipTests -Drat.skip install # -P\"agent,backend,ui,dist,CI-with-IT\" clean cobertura:cobertura verify install javadoc:javadoc\n+          # CODECOV_TOKEN=\"d2065307-8f01-4637-9715-2781ef096db7\" bash <(curl -s https://codecov.io/bash)\n+\n+      - name: Run reviewdog\n+        env:\n+          REVIEWDOG_GITHUB_API_TOKEN: ${{ secrets.GITHUB_TOKEN }}", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njc4NDI4Mg==", "url": "https://github.com/apache/skywalking/pull/4337#discussion_r376784282", "bodyText": "It's built in GitHub Action", "author": "kezhenxu94", "createdAt": "2020-02-09T13:33:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njc4Mzc5Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njc4NDI3Mg==", "url": "https://github.com/apache/skywalking/pull/4337#discussion_r376784272", "bodyText": "[maven-checkstyle] reported by reviewdog \ud83d\udc36\nAt-clause should have a non-empty description.", "author": "github-actions", "createdAt": "2020-02-09T13:33:04Z", "path": "apm-sniffer/apm-agent/src/main/java/org/apache/skywalking/apm/agent/SkyWalkingAgent.java", "diffHunk": "@@ -184,6 +184,14 @@ public void onError(String typeName, ClassLoader classLoader, JavaModule module,\n             logger.error(\"Enhance class \" + typeName + \" error.\", throwable);\n         }\n \n+        /**\n+         * TODO: just to test reviewdog\n+         *\n+         * @param typeName", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njc4NDI3Mw==", "url": "https://github.com/apache/skywalking/pull/4337#discussion_r376784273", "bodyText": "[maven-checkstyle] reported by reviewdog \ud83d\udc36\nAt-clause should have a non-empty description.", "author": "github-actions", "createdAt": "2020-02-09T13:33:05Z", "path": "apm-sniffer/apm-agent/src/main/java/org/apache/skywalking/apm/agent/SkyWalkingAgent.java", "diffHunk": "@@ -184,6 +184,14 @@ public void onError(String typeName, ClassLoader classLoader, JavaModule module,\n             logger.error(\"Enhance class \" + typeName + \" error.\", throwable);\n         }\n \n+        /**\n+         * TODO: just to test reviewdog\n+         *\n+         * @param typeName\n+         * @param classLoader", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njc4NDI3NA==", "url": "https://github.com/apache/skywalking/pull/4337#discussion_r376784274", "bodyText": "[maven-checkstyle] reported by reviewdog \ud83d\udc36\nAt-clause should have a non-empty description.", "author": "github-actions", "createdAt": "2020-02-09T13:33:05Z", "path": "apm-sniffer/apm-agent/src/main/java/org/apache/skywalking/apm/agent/SkyWalkingAgent.java", "diffHunk": "@@ -184,6 +184,14 @@ public void onError(String typeName, ClassLoader classLoader, JavaModule module,\n             logger.error(\"Enhance class \" + typeName + \" error.\", throwable);\n         }\n \n+        /**\n+         * TODO: just to test reviewdog\n+         *\n+         * @param typeName\n+         * @param classLoader\n+         * @param module", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njc4NDI3NQ==", "url": "https://github.com/apache/skywalking/pull/4337#discussion_r376784275", "bodyText": "[maven-checkstyle] reported by reviewdog \ud83d\udc36\nAt-clause should have a non-empty description.", "author": "github-actions", "createdAt": "2020-02-09T13:33:05Z", "path": "apm-sniffer/apm-agent/src/main/java/org/apache/skywalking/apm/agent/SkyWalkingAgent.java", "diffHunk": "@@ -184,6 +184,14 @@ public void onError(String typeName, ClassLoader classLoader, JavaModule module,\n             logger.error(\"Enhance class \" + typeName + \" error.\", throwable);\n         }\n \n+        /**\n+         * TODO: just to test reviewdog\n+         *\n+         * @param typeName\n+         * @param classLoader\n+         * @param module\n+         * @param loaded", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njc4NTY3OQ==", "url": "https://github.com/apache/skywalking/pull/4337#discussion_r376785679", "bodyText": "Are these copy/paste issue?", "author": "wu-sheng", "createdAt": "2020-02-09T13:51:14Z", "path": ".github/workflows/ci-it.yaml", "diffHunk": "@@ -38,11 +38,26 @@ jobs:\n       - uses: actions/setup-java@v1\n         with:\n           java-version: 8\n+\n+      - name: Setup reviewdog\n+        run: |\n+          mkdir -p $HOME/bin && curl -sfL https://raw.githubusercontent.com/reviewdog/reviewdog/master/install.sh| sh -s -- -b $HOME/bin\n+          echo ::add-path::$HOME/bin\n+          echo ::add-path::$(go env GOPATH)/bin # for Go projects", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njc4NTc2Ng==", "url": "https://github.com/apache/skywalking/pull/4337#discussion_r376785766", "bodyText": "Does this get any chance to run? If checkstyle fail, the Install & Test step should stop the CI, no?", "author": "wu-sheng", "createdAt": "2020-02-09T13:52:34Z", "path": ".github/workflows/ci-it.yaml", "diffHunk": "@@ -38,11 +38,26 @@ jobs:\n       - uses: actions/setup-java@v1\n         with:\n           java-version: 8\n+\n+      - name: Setup reviewdog\n+        run: |\n+          mkdir -p $HOME/bin && curl -sfL https://raw.githubusercontent.com/reviewdog/reviewdog/master/install.sh| sh -s -- -b $HOME/bin\n+          echo ::add-path::$HOME/bin\n+          echo ::add-path::$(go env GOPATH)/bin # for Go projects\n+\n       - name: 'Install & Test'\n         run: |\n           export MAVEN_OPTS='-XX:+TieredCompilation -XX:TieredStopAtLevel=1 -XX:+CMSClassUnloadingEnabled -XX:+UseConcMarkSweepGC -XX:-UseGCOverheadLimit -Xmx3g'\n           ./mvnw --batch-mode -P\"agent,backend,ui,dist,CI-with-IT\" clean cobertura:cobertura verify install javadoc:javadoc\n           CODECOV_TOKEN=\"d2065307-8f01-4637-9715-2781ef096db7\" bash <(curl -s https://codecov.io/bash)\n+\n+      - name: Run reviewdog\n+        env:\n+          REVIEWDOG_GITHUB_API_TOKEN: ${{ secrets.GITHUB_TOKEN }}\n+        run: |\n+          ./mvnw clean -Dcheckstyle.fails.on.error=false checkstyle:checkstyle-aggregate", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njc4NTkxNA==", "url": "https://github.com/apache/skywalking/pull/4337#discussion_r376785914", "bodyText": "Why this is warning? I think we should remove them? (Existing @author)", "author": "wu-sheng", "createdAt": "2020-02-09T13:54:31Z", "path": "apm-checkstyle/checkStyle.xml", "diffHunk": "@@ -20,19 +20,27 @@\n <!DOCTYPE module PUBLIC\n     \"-//Puppy Crawl//DTD Check Configuration 1.3//EN\"\n     \"http://checkstyle.org/dtds/configuration_1_3.dtd\">\n-<!--Refer http://checkstyle.sourceforge.net/reports/google-java-style.html#s2.2-file-encoding -->\n <module name=\"Checker\">\n \n     <property name=\"localeLanguage\" value=\"en\"/>\n \n-    <!--To configure the check to report on the first instance in each file-->\n-    <module name=\"FileTabCharacter\"/>\n+    <module name=\"FileTabCharacter\">\n+        <property name=\"eachLine\" value=\"true\"/>\n+    </module>\n \n     <module name=\"RegexpSingleline\">\n         <property name=\"format\" value=\"System\\.out\\.println\"/>\n         <property name=\"message\" value=\"Prohibit invoking System.out.println in source code !\"/>\n     </module>\n \n+    <module name=\"RegexpSingleline\">\n+        <property name=\"severity\" value=\"warning\"/>", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njc4NTk1MQ==", "url": "https://github.com/apache/skywalking/pull/4337#discussion_r376785951", "bodyText": "Same question here. Why warning?", "author": "wu-sheng", "createdAt": "2020-02-09T13:55:13Z", "path": "apm-checkstyle/checkStyle.xml", "diffHunk": "@@ -123,4 +124,21 @@\n         <property name=\"multiLines\" value=\"1, 2, 3, 18\"/>\n     </module>\n \n+    <module name=\"TreeWalker\">\n+        <property name=\"severity\" value=\"warning\"/>", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": "e96a4251aead06bf88866baf9dbfda774238ec6f", "url": "https://github.com/apache/skywalking/commit/e96a4251aead06bf88866baf9dbfda774238ec6f", "message": "Review code styles automatically\n\n### Motivation:\n\nReview code styles with some bots automatically.\n\n### Modifications:\n\n- Set up ReviewDog in GitHub Action to review code style.\n\n- Add more check rules to checkstyle plugin.\n\n### Result:\n\n- Obvious code styles can be reviewed and commented automatically.", "committedDate": "2020-02-10T10:25:45Z", "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": "8c31743b68909e970c505e87fbc3d3a3b173b78c", "url": "https://github.com/apache/skywalking/commit/8c31743b68909e970c505e87fbc3d3a3b173b78c", "message": "Set up more strict code styles and fix existing issues\n\nMotivation:\n\nReview code styles with some bots automatically.\n\nModifications:\n\nSet up ReviewDog in GitHub Action to review code style.\n\nAdd more check rules to checkstyle plugin.\n\nResult:\n\nObvious code styles can be reviewed and commented automatically.", "committedDate": "2020-02-11T07:04:22Z", "type": "commit"}, {"oid": "8c31743b68909e970c505e87fbc3d3a3b173b78c", "url": "https://github.com/apache/skywalking/commit/8c31743b68909e970c505e87fbc3d3a3b173b78c", "message": "Set up more strict code styles and fix existing issues\n\nMotivation:\n\nReview code styles with some bots automatically.\n\nModifications:\n\nSet up ReviewDog in GitHub Action to review code style.\n\nAdd more check rules to checkstyle plugin.\n\nResult:\n\nObvious code styles can be reviewed and commented automatically.", "committedDate": "2020-02-11T07:04:22Z", "type": "forcePushed"}]}