{"pr_number": 4244, "pr_title": "Drop support of protocol v1 (sw3)", "pr_createdAt": "2020-01-16T06:16:31Z", "pr_url": "https://github.com/apache/skywalking/pull/4244", "timeline": [{"oid": "2f5cecb60a6493824a041aeeac9e969c0223f8e4", "url": "https://github.com/apache/skywalking/commit/2f5cecb60a6493824a041aeeac9e969c0223f8e4", "message": "Drop support of protocol v1 (sw3)", "committedDate": "2020-01-16T06:31:47Z", "type": "commit"}, {"oid": "04a5cf60501b7d47a8a47d8414f41e9de969ab40", "url": "https://github.com/apache/skywalking/commit/04a5cf60501b7d47a8a47d8414f41e9de969ab40", "message": "Merge branch 'master' into chore/drop-protocol-v1", "committedDate": "2020-01-16T06:32:18Z", "type": "commit"}, {"oid": "549abf4a884731f003442e9c1ce4b1441ab10501", "url": "https://github.com/apache/skywalking/commit/549abf4a884731f003442e9c1ce4b1441ab10501", "message": "Merge branch 'master' into chore/drop-protocol-v1", "committedDate": "2020-01-16T08:34:43Z", "type": "commit"}, {"oid": "e5ca4d6f4f090e76ca13d64ab92d5e28ff6eeacc", "url": "https://github.com/apache/skywalking/commit/e5ca4d6f4f090e76ca13d64ab92d5e28ff6eeacc", "message": "Remove versioning logic further", "committedDate": "2020-01-16T11:19:06Z", "type": "commit"}, {"oid": "93a8a8839e1d7ec27eba1ba9951be444ee6848ee", "url": "https://github.com/apache/skywalking/commit/93a8a8839e1d7ec27eba1ba9951be444ee6848ee", "message": "Merge branch 'master' into chore/drop-protocol-v1", "committedDate": "2020-01-16T13:05:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzcxNzY0OA==", "url": "https://github.com/apache/skywalking/pull/4244#discussion_r367717648", "bodyText": "What is this TODO for?", "author": "wu-sheng", "createdAt": "2020-01-17T00:29:31Z", "path": "apm-sniffer/apm-agent-core/src/test/java/org/apache/skywalking/apm/agent/core/context/ContextCarrierV2HeaderTest.java", "diffHunk": "@@ -107,37 +58,19 @@ public void testSerializeV2Header() {\n         CarrierItem next = contextCarrier.items();\n         while (next.hasNext()) {\n             next = next.next();\n-            if (next.getHeadKey().equals(\"sw3\")) {\n-                Assert.assertEquals(\"\", next.getHeadValue());\n-            } else if (next.getHeadKey().equals(\"sw6\")) {\n-                /**\n-                 * sampleFlag-traceId-segmentId-spanId-parentAppInstId-entryAppInstId-peerHost-entryEndpoint-parentEndpoint\n-                 *\n-                 * \"1-3.4.5-1.2.3-4-1-1-#127.0.0.1:8080-#/portal-123\"\n-                 */\n-                Assert.assertEquals(\"1-My40LjU=-MS4yLjM=-4-1-1-IzEyNy4wLjAuMTo4MDgw-Iy9wb3J0YWw=-MTIz\", next.getHeadValue());\n-            } else {\n-                Assert.fail(\"unexpected key\");\n-            }\n+            /*\n+             * sampleFlag-traceId-segmentId-spanId-parentAppInstId-entryAppInstId-peerHost-entryEndpoint-parentEndpoint\n+             *\n+             * \"1-3.4.5-1.2.3-4-1-1-#127.0.0.1:8080-#/portal-123\"\n+             */\n+            Assert.assertEquals(\"1-My40LjU=-MS4yLjM=-4-1-1-IzEyNy4wLjAuMTo4MDgw-Iy9wb3J0YWw=-MTIz\", next.getHeadValue());\n         }\n \n-        Config.Agent.ACTIVE_V1_HEADER = true;\n-        try {\n-            next = contextCarrier.items();\n-            while (next.hasNext()) {\n-                next = next.next();\n-                if (next.getHeadKey().equals(\"sw3\")) {\n-                    Assert.assertEquals(\"1.2.3|4|1|1|#127.0.0.1:8080|#/portal|123|3.4.5\", next.getHeadValue());\n-                } else if (next.getHeadKey().equals(\"sw6\")) {\n-                    //TODO, no BASE64\n-                    Assert.assertEquals(\"1-My40LjU=-MS4yLjM=-4-1-1-IzEyNy4wLjAuMTo4MDgw-Iy9wb3J0YWw=-MTIz\", next.getHeadValue());\n-                } else {\n-                    Assert.fail(\"unexpected key\");\n-                }\n-            }\n-\n-        } finally {\n-            Config.Agent.ACTIVE_V1_HEADER = false;\n+        next = contextCarrier.items();\n+        while (next.hasNext()) {\n+            next = next.next();\n+            //TODO, no BASE64", "originalCommit": "93a8a8839e1d7ec27eba1ba9951be444ee6848ee", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f8be7029cbcd9162220f2c68ddfd1c2e46b3f05d", "url": "https://github.com/apache/skywalking/commit/f8be7029cbcd9162220f2c68ddfd1c2e46b3f05d", "message": "Remove more version5-only classes", "committedDate": "2020-01-17T05:47:34Z", "type": "commit"}, {"oid": "a96589fedf90c414fda794ef569f27cbb3363dfd", "url": "https://github.com/apache/skywalking/commit/a96589fedf90c414fda794ef569f27cbb3363dfd", "message": "Merge remote-tracking branch 'origin/chore/drop-protocol-v1' into chore/drop-protocol-v1", "committedDate": "2020-01-17T05:48:00Z", "type": "commit"}, {"oid": "7745dfb8399d61172d98838b0240e41f24ab56ee", "url": "https://github.com/apache/skywalking/commit/7745dfb8399d61172d98838b0240e41f24ab56ee", "message": "Commit missing files", "committedDate": "2020-01-17T05:55:44Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzg1Mzg4Ng==", "url": "https://github.com/apache/skywalking/pull/4244#discussion_r367853886", "bodyText": "segmentCoreInfo.getVersion().number Why write in this way? .number?", "author": "wu-sheng", "createdAt": "2020-01-17T09:58:18Z", "path": "oap-server/server-receiver-plugin/skywalking-trace-receiver-plugin/src/main/java/org/apache/skywalking/oap/server/receiver/trace/provider/parser/listener/segment/SegmentSpanListener.java", "diffHunk": "@@ -81,10 +82,7 @@ public void parseFirst(SpanDecorator spanDecorator, SegmentCoreInfo segmentCoreI\n         segment.setIsError(BooleanUtils.booleanToValue(segmentCoreInfo.isError()));\n         segment.setTimeBucket(timeBucket);\n         segment.setDataBinary(segmentCoreInfo.getDataBinary());\n-        /**\n-         * Only consider v1, v2 compatible for now.\n-         */\n-        segment.setVersion(segmentCoreInfo.isV2() ? 2 : 1);\n+        segment.setVersion(segmentCoreInfo.getVersion().number);", "originalCommit": "f8be7029cbcd9162220f2c68ddfd1c2e46b3f05d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "a3844f308501a040266233bf714d467ee1a683ef", "url": "https://github.com/apache/skywalking/commit/a3844f308501a040266233bf714d467ee1a683ef", "message": "Update submodule and address review comment", "committedDate": "2020-01-17T10:34:21Z", "type": "commit"}, {"oid": "aff404a56428934af3549a7850a35f56f2f4ed38", "url": "https://github.com/apache/skywalking/commit/aff404a56428934af3549a7850a35f56f2f4ed38", "message": "Fix failed tests", "committedDate": "2020-01-17T11:06:43Z", "type": "commit"}]}