{"pr_number": 5851, "pr_title": "Support group in the service traffic and service list query.", "pr_createdAt": "2020-11-17T03:43:18Z", "pr_url": "https://github.com/apache/skywalking/pull/5851", "timeline": [{"oid": "9132f7511751c6f8116c10cc7620ed4763d49db7", "url": "https://github.com/apache/skywalking/commit/9132f7511751c6f8116c10cc7620ed4763d49db7", "message": "Support group in the service traffic and service list query.", "committedDate": "2020-11-17T03:34:54Z", "type": "commit"}, {"oid": "f94cfc1d0af58f3f932b0a17cc716302fa750812", "url": "https://github.com/apache/skywalking/commit/f94cfc1d0af58f3f932b0a17cc716302fa750812", "message": "Update changelog.", "committedDate": "2020-11-17T03:37:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDg2NjM5Mg==", "url": "https://github.com/apache/skywalking/pull/5851#discussion_r524866392", "bodyText": "Why not double \":\", typo?", "author": "hanahmily", "createdAt": "2020-11-17T03:46:39Z", "path": "docs/en/setup/backend/service-auto-grouping.md", "diffHunk": "@@ -0,0 +1,16 @@\n+# Service Auto Grouping\n+SkyWalking supports various default and customized dashboard templates. \n+Each template provides the reasonable layout for the services in the particular field. \n+Such as, services with a language agent installed \n+could have different metrics with service detected by the service mesh observability solution, \n+and different with SkyWalking's self-observability metrics dashboard.\n+\n+Therefore, since 8.3.0, SkyWalking OAP would generate the group based on this simple naming format.\n+\n+### ${service name} = [${group name}:]${logic name}", "originalCommit": "f94cfc1d0af58f3f932b0a17cc716302fa750812", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDg2NjUxNw==", "url": "https://github.com/apache/skywalking/pull/5851#discussion_r524866517", "bodyText": "Typo.", "author": "wu-sheng", "createdAt": "2020-11-17T03:47:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDg2NjM5Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDg2Nzk5OQ==", "url": "https://github.com/apache/skywalking/pull/5851#discussion_r524867999", "bodyText": "Done.", "author": "wu-sheng", "createdAt": "2020-11-17T03:53:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDg2NjM5Mg=="}], "type": "inlineReview"}, {"oid": "bca78311c48e6515cf95f0c0e62514c82b3680f1", "url": "https://github.com/apache/skywalking/commit/bca78311c48e6515cf95f0c0e62514c82b3680f1", "message": "Fix", "committedDate": "2020-11-17T03:52:31Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDg2NzQ3Mw==", "url": "https://github.com/apache/skywalking/pull/5851#discussion_r524867473", "bodyText": "\"..\" on the end", "author": "dmsolr", "createdAt": "2020-11-17T03:50:58Z", "path": "docs/en/setup/backend/backend-setup.md", "diffHunk": "@@ -108,6 +108,7 @@ or 3rd party configuration management system.\n 1. [Uninstrumented Gateways](uninstrumented-gateways.md). Configure gateways/proxies that are not supported by SkyWalking agent plugins,\n to reflect the delegation in topology graph.\n 1. [Apdex threshold](apdex-threshold.md). Configure the thresholds for different services if Apdex calculation is activated in the OAL.\n+1. [Service Grouping](service-auto-grouping.md). An automatic grouping mechanism for all services based on name..", "originalCommit": "f94cfc1d0af58f3f932b0a17cc716302fa750812", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDg2ODkwMA==", "url": "https://github.com/apache/skywalking/pull/5851#discussion_r524868900", "bodyText": "Done.", "author": "wu-sheng", "createdAt": "2020-11-17T03:56:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDg2NzQ3Mw=="}], "type": "inlineReview"}, {"oid": "bbf13426468eec36464133632a1a3d2768630bba", "url": "https://github.com/apache/skywalking/commit/bbf13426468eec36464133632a1a3d2768630bba", "message": "Fix a format issue.", "committedDate": "2020-11-17T03:56:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDg4ODk2Mg==", "url": "https://github.com/apache/skywalking/pull/5851#discussion_r524888962", "bodyText": "need to keep group as a service name prefix?", "author": "hailin0", "createdAt": "2020-11-17T05:14:39Z", "path": "oap-server/server-core/src/main/java/org/apache/skywalking/oap/server/core/analysis/manual/service/ServiceTraffic.java", "diffHunk": "@@ -93,14 +101,23 @@ public ServiceTraffic map2Data(final Map<String, Object> dbMap) {\n             ServiceTraffic serviceTraffic = new ServiceTraffic();\n             serviceTraffic.setName((String) dbMap.get(NAME));\n             serviceTraffic.setNodeType(NodeType.valueOf(((Number) dbMap.get(NODE_TYPE)).intValue()));\n+            serviceTraffic.setGroup((String) dbMap.get(GROUP));\n             return serviceTraffic;\n         }\n \n         @Override\n         public Map<String, Object> data2Map(final ServiceTraffic storageData) {\n+            final String serviceName = storageData.getName();\n+            if (NodeType.Normal.equals(storageData.getNodeType())) {\n+                int groupIdx = serviceName.indexOf(DOUBLE_COLONS_SPLIT);\n+                if (groupIdx > 0) {\n+                    storageData.setGroup(serviceName.substring(0, groupIdx));\n+                }\n+            }\n             Map<String, Object> map = new HashMap<>();\n-            map.put(NAME, storageData.getName());\n+            map.put(NAME, serviceName);", "originalCommit": "bbf13426468eec36464133632a1a3d2768630bba", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDg5NDk2MQ==", "url": "https://github.com/apache/skywalking/pull/5851#discussion_r524894961", "bodyText": "Yes, we don't remove it. As the name is a part of metrics key. Changing it will break many things.", "author": "wu-sheng", "createdAt": "2020-11-17T05:36:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDg4ODk2Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDkwMDQzNw==", "url": "https://github.com/apache/skywalking/pull/5851#discussion_r524900437", "bodyText": "ok", "author": "hailin0", "createdAt": "2020-11-17T05:54:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDg4ODk2Mg=="}], "type": "inlineReview"}, {"oid": "6ed34de5b6c2aa9906c9507d1f1aa09504995c56", "url": "https://github.com/apache/skywalking/commit/6ed34de5b6c2aa9906c9507d1f1aa09504995c56", "message": "Add group in the service query. Fix the keyword issue in the storage.", "committedDate": "2020-11-17T06:35:55Z", "type": "commit"}, {"oid": "2c0ad45f8f9c110d8e75deca8f8204c3d0a03c4f", "url": "https://github.com/apache/skywalking/commit/2c0ad45f8f9c110d8e75deca8f8204c3d0a03c4f", "message": "no message", "committedDate": "2020-11-17T06:36:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDkzNjU2NQ==", "url": "https://github.com/apache/skywalking/pull/5851#discussion_r524936565", "bodyText": "TagName.GROUP", "author": "dmsolr", "createdAt": "2020-11-17T07:36:06Z", "path": "oap-server/server-storage-plugin/storage-influxdb-plugin/src/main/java/org/apache/skywalking/oap/server/storage/plugin/influxdb/TableMetaInfo.java", "diffHunk": "@@ -62,8 +62,9 @@ public static void addModel(Model model) {\n                 || EndpointTraffic.INDEX_NAME.equals(model.getName())) {\n                 storageAndTagMap.put(EndpointTraffic.SERVICE_ID, InfluxConstants.TagName.SERVICE_ID);\n             } else {\n-                // service_traffic  name, node_type\n+                // service_traffic  name, node_type, group\n                 storageAndTagMap.put(ServiceTraffic.NODE_TYPE, InfluxConstants.TagName.NODE_TYPE);\n+                storageAndTagMap.put(ServiceTraffic.GROUP, InfluxConstants.TagName.NODE_TYPE);", "originalCommit": "2c0ad45f8f9c110d8e75deca8f8204c3d0a03c4f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDkzNzY4OQ==", "url": "https://github.com/apache/skywalking/pull/5851#discussion_r524937689", "bodyText": "Done.", "author": "wu-sheng", "createdAt": "2020-11-17T07:38:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDkzNjU2NQ=="}], "type": "inlineReview"}, {"oid": "07c15ee4a0b652bcc7ec2605cc81b939d849ef19", "url": "https://github.com/apache/skywalking/commit/07c15ee4a0b652bcc7ec2605cc81b939d849ef19", "message": "Fix.", "committedDate": "2020-11-17T07:38:32Z", "type": "commit"}, {"oid": "261e7078c5f384961d572d8435cb60de0a28a64d", "url": "https://github.com/apache/skywalking/commit/261e7078c5f384961d572d8435cb60de0a28a64d", "message": "FIX.", "committedDate": "2020-11-17T07:40:19Z", "type": "commit"}, {"oid": "d00bcd6a5701bfdf0e9b8ee79b426df643ef6617", "url": "https://github.com/apache/skywalking/commit/d00bcd6a5701bfdf0e9b8ee79b426df643ef6617", "message": "Fix MetadataQuery issue.", "committedDate": "2020-11-17T12:50:09Z", "type": "commit"}, {"oid": "f71df9bd5e7123dd0b84596ced6acfd15f3cdb7d", "url": "https://github.com/apache/skywalking/commit/f71df9bd5e7123dd0b84596ced6acfd15f3cdb7d", "message": "Fix searchEndpoint.", "committedDate": "2020-11-17T12:54:16Z", "type": "commit"}, {"oid": "b6d267ed66baa280c1cb3352391c6d70e3a14b1a", "url": "https://github.com/apache/skywalking/commit/b6d267ed66baa280c1cb3352391c6d70e3a14b1a", "message": "Fix.missing parameter.", "committedDate": "2020-11-17T13:23:22Z", "type": "commit"}]}