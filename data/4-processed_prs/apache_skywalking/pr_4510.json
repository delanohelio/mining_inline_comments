{"pr_number": 4510, "pr_title": "Rewrite the E2E test framework and tests", "pr_createdAt": "2020-03-14T04:56:43Z", "pr_url": "https://github.com/apache/skywalking/pull/4510", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU2MTI0NA==", "url": "https://github.com/apache/skywalking/pull/4510#discussion_r392561244", "bodyText": "Once this name changed, we are facing the awkward situation. The PR can't be merged as we set that by the INFRA team. Could we consider to change it back?", "author": "wu-sheng", "createdAt": "2020-03-14T06:16:14Z", "path": ".github/workflows/e2e.yaml", "diffHunk": "@@ -24,125 +24,97 @@ on:\n     tags:\n       - 'v*'\n \n+env:\n+  SKIP_TEST: true\n+  SW_TEST_ID: ${GITHUB_RUN_ID}\n+  SW_LOG_DIR: ${HOME}/logs/${GITHUB_RUN_ID}/\n+\n jobs:\n-  Single:\n+  Checkstyle:\n+    name: Check Codes Style\n     runs-on: ubuntu-latest\n     steps:\n       - uses: actions/checkout@v2\n-      # In the checkout@v2, it doesn't support git submodule. Execute the commands manually.\n-      - name: checkout submodules\n+      - name: Checkout Submodules\n         shell: bash\n         run: |\n           git submodule sync --recursive\n           git -c protocol.version=2 submodule update --init --force --recursive --depth=1\n-      - name: Set environment\n-        run: export MAVEN_OPTS='-Dmaven.repo.local=~/.m2/repository -XX:+TieredCompilation -XX:TieredStopAtLevel=1 -XX:+CMSClassUnloadingEnabled -XX:+UseConcMarkSweepGC -XX:-UseGCOverheadLimit -Xmx3g'\n-      - name: Compile & Install Test Codes\n-        run: |\n-          ./mvnw --batch-mode checkstyle:check apache-rat:check\n-          ./mvnw --batch-mode -Dcheckstyle.skip -Drat.skip -T2 -Dmaven.compile.fork -Dmaven.compiler.maxmem=3072 -DskipTests clean install\n-          ./mvnw --batch-mode -f test/e2e/pom.xml -pl e2e-base clean install\n-      - name: Single Node Tests(JDK8)\n-        run: export E2E_VERSION=jdk8-1.5 && bash -x test/e2e/run.sh e2e-single-service\n-      - name: Single Node Tests(InfluxDB/JDK8)\n-        run: export E2E_VERSION=jdk8-1.5 && bash -x test/e2e/run.sh e2e-influxdb\n-      - name: Single Node Tests(MySQL/JDK8)\n-        run: export E2E_VERSION=jdk8-1.5 && bash -x test/e2e/run.sh e2e-mysql\n-      - name: Single Node Tests(JDK9)\n-        run: export E2E_VERSION=jdk9-1.5 && bash -x test/e2e/run.sh e2e-single-service\n-      - name: Single Node Tests(JDK11)\n-        run: export E2E_VERSION=jdk11-1.5 && bash -x test/e2e/run.sh e2e-single-service\n-      - name: Single Node Tests(JDK12)\n-        run: export E2E_VERSION=jdk12-1.5 && bash -x test/e2e/run.sh e2e-single-service\n-      - name: Agent Reboot Tests(JDK8)\n-        run: export E2E_VERSION=jdk8-1.5 && bash -x test/e2e/run.sh e2e-agent-reboot\n-      - name: Agent Auth Tests(JDK8)\n-        run: export E2E_VERSION=jdk8-1.5 && bash -x test/e2e/run.sh e2e-agent-auth\n+      - name: Checkstyle\n+        run: ./mvnw --batch-mode -f test/e2e/pom.xml -DskipTests checkstyle:check\n \n-  Cluster:\n+  FeaturesGroup1:", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU2NzkzMw==", "url": "https://github.com/apache/skywalking/pull/4510#discussion_r392567933", "bodyText": "Once this name changed, we are facing the awkward situation. The PR can't be merged as we set that by the INFRA team. Could we consider to change it back?\n\nI begin to use matrix builds, so even I change back to Single or Cluster, the names are still not the same as before, besides, the original name is rather vague, and we could make it more clear, if you agree, I can open a ticket to ask the infra team for the help, to change the required statuses", "author": "kezhenxu94", "createdAt": "2020-03-14T08:26:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU2MTI0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU2OTQyMA==", "url": "https://github.com/apache/skywalking/pull/4510#discussion_r392569420", "bodyText": "I am OK to change. Just we need\n\nA consensus  about the task lists\nYour PR passed and ready to be merged immediately.\n\nWe could request the INFRA. Because otherwise, we can\u2019t merge any PR if INFRA changed that before this is ready.", "author": "wu-sheng", "createdAt": "2020-03-14T08:54:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU2MTI0NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU2MTMwMA==", "url": "https://github.com/apache/skywalking/pull/4510#discussion_r392561300", "bodyText": "You are changing the header format, why?", "author": "wu-sheng", "createdAt": "2020-03-14T06:17:02Z", "path": "test/e2e/e2e-data/src/main/resources/profiledSegment.gql", "diffHunk": "@@ -1,10 +1,9 @@\n-# Licensed to the Apache Software Foundation (ASF) under one\n-# or more contributor license agreements.  See the NOTICE file\n-# distributed with this work for additional information\n-# regarding copyright ownership.  The ASF licenses this file\n-# to you under the Apache License, Version 2.0 (the\n-# \"License\"); you may not use this file except in compliance\n-# with the License.  You may obtain a copy of the License at\n+# Licensed to the Apache Software Foundation (ASF) under one or more\n+# contributor license agreements.  See the NOTICE file distributed with\n+# this work for additional information regarding copyright ownership.\n+# The ASF licenses this file to You under the Apache License, Version 2.0\n+# (the \"License\"); you may not use this file except in compliance with\n+# the License.  You may obtain a copy of the License at", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU2MjM4Mw==", "url": "https://github.com/apache/skywalking/pull/4510#discussion_r392562383", "bodyText": "You are changing the header format, why?\n\nThe license headers in such kind of files are checked by Checkstyle plugin, by matching regular expression, so, have to", "author": "kezhenxu94", "createdAt": "2020-03-14T06:39:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU2MTMwMA=="}], "type": "inlineReview"}, {"oid": "54ac520bdb6036c8ed4801fc5646830d4824b818", "url": "https://github.com/apache/skywalking/commit/54ac520bdb6036c8ed4801fc5646830d4824b818", "message": "Rewrite the E2E test framework and tests\n\nMotivation:\n\nAccording the feedback from the community, the e2e tests are hard for\nthem to understand and get them started, so this pull request aims to\nrewrite the e2e tests with some improvements:\n\n- debuggable locally, now you can run every individual case directly\ninside the IDE, just like running a plain unit test.\n\n- same functionalities of multiple counterparts share the same codes,\ncases like different storages and cluster coordinators share the same\ncodes, easy to add more similar cases.\n\n- the \"end\" now extends to the Doccker images, meaning that some bugs\nlike #4483 and #4471 can be more easily and early to be discovered.\n\n- codes style and license headers are checked\n\nModifications:\n\n- adopt jupeter (a.k.a junit 5), testcontainers as the new test\nframework, all containers are orchestrated by docker-compose.yml,\nwell-known technology that developers should be familiar with.\n\n- rewrite all test cases and verify them.\n\n- reorganize the workflows in GitHub Actions.\n\nResult:\n\n- new e2e test should be easy to add.\n\n- closes https://github.com/apache/skywalking/issues/4472", "committedDate": "2020-03-16T13:40:45Z", "type": "commit"}]}