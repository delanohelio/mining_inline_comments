{"pr_number": 4228, "pr_title": "Support Browser protocol at OAP", "pr_createdAt": "2020-01-13T14:01:25Z", "pr_url": "https://github.com/apache/skywalking/pull/4228", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Njg3NDgxNA==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r366874814", "bodyText": "service_version -> one_version_of_service_*.", "author": "wu-sheng", "createdAt": "2020-01-15T13:30:09Z", "path": "oap-server/server-bootstrap/src/main/resources/browser_analysis.oal", "diffHunk": "@@ -0,0 +1,87 @@\n+/*\n+* Licensed to the Apache Software Foundation (ASF) under one or more\n+* contributor license agreements.  See the NOTICE file distributed with\n+* this work for additional information regarding copyright ownership.\n+* The ASF licenses this file to You under the Apache License, Version 2.0\n+* (the \"License\"); you may not use this file except in compliance with\n+* the License.  You may obtain a copy of the License at\n+*\n+*     http://www.apache.org/licenses/LICENSE-2.0\n+*\n+* Unless required by applicable law or agreed to in writing, software\n+* distributed under the License is distributed on an \"AS IS\" BASIS,\n+* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+* See the License for the specific language governing permissions and\n+* limitations under the License.\n+*\n+*/\n+\n+// Browser service\n+service_redirect_avg = from(ServicePerfDetail.redirectTime).longAvg();\n+service_dns_avg = from(ServicePerfDetail.dnsTime).longAvg();\n+service_req_avg = from(ServicePerfDetail.reqTime).longAvg();\n+service_dom_analysis_avg = from(ServicePerfDetail.domAnalysisTime).longAvg();\n+service_dom_ready_avg = from(ServicePerfDetail.domReadyTime).longAvg();\n+service_blank_avg = from(ServicePerfDetail.blankTime).longAvg();\n+\n+// Multiple values including p50, p75, p90, p95, p99\n+service_redirect_percentile = from(ServicePerfDetail.redirectTime).percentile(10);\n+service_dns_percentile = from(ServicePerfDetail.dnsTime).percentile(10);\n+service_req_percentile = from(ServicePerfDetail.reqTime).percentile(10);\n+service_dom_analysis_percentile = from(ServicePerfDetail.domAnalysisTime).percentile(10);\n+service_dom_ready_percentile = from(ServicePerfDetail.domReadyTime).percentile(10);\n+service_blank_percentile = from(ServicePerfDetail.blankTime).percentile(10);\n+\n+// Browser service page\n+service_page_pv = from(ServicePagePathPerfDetail.count).sum();\n+service_page_error_rate = from(ServicePagePathPerfDetail.*).percent(status == false);\n+\n+service_page_redirect_avg = from(ServicePagePathPerfDetail.redirectTime).longAvg();\n+service_page_dns_avg = from(ServicePagePathPerfDetail.dnsTime).longAvg();\n+service_page_req_avg = from(ServicePagePathPerfDetail.reqTime).longAvg();\n+service_page_dom_analysis_avg = from(ServicePagePathPerfDetail.domAnalysisTime).longAvg();\n+service_page_dom_ready_avg = from(ServicePagePathPerfDetail.domReadyTime).longAvg();\n+service_page_blank_avg = from(ServicePagePathPerfDetail.blankTime).longAvg();\n+\n+// Multiple values including p50, p75, p90, p95, p99\n+service_page_redirect_percentile = from(ServicePagePathPerfDetail.redirectTime).percentile(10);\n+service_page_dns_percentile = from(ServicePagePathPerfDetail.dnsTime).percentile(10);\n+service_page_req_percentile = from(ServicePagePathPerfDetail.reqTime).percentile(10);\n+service_page_dom_analysis_percentile = from(ServicePagePathPerfDetail.domAnalysisTime).percentile(10);\n+service_page_dom_ready_percentile = from(ServicePagePathPerfDetail.domReadyTime).percentile(10);\n+service_page_blank_percentile = from(ServicePagePathPerfDetail.blankTime).percentile(10);\n+\n+// Browser service version\n+service_version_redirect_avg = from(ServiceVersionPerfDetail.redirectTime).longAvg();", "originalCommit": "7a8628e6618ae9e4dee96ceea4e8b20734bb4283", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODIxMTA5MA==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r368211090", "bodyText": "If these are TODOs, why add this?", "author": "wu-sheng", "createdAt": "2020-01-18T06:55:20Z", "path": "oap-server/server-alarm-plugin/src/main/java/org/apache/skywalking/oap/server/core/alarm/provider/NotifyHandler.java", "diffHunk": "@@ -82,6 +82,12 @@ public NotifyHandler(AlarmRulesWatcher alarmRulesWatcher) {\n \n             endpointMetaInAlarm.setName(textName);\n             metaInAlarm = endpointMetaInAlarm;\n+        } else if (DefaultScopeDefine.inServicePageCatalog(scope)) {\n+            // TODO handler service page path catalog\n+            return;\n+        } else if (DefaultScopeDefine.inServiceVersionCatalog(scope)) {\n+            // TODO handler service version page path catalog", "originalCommit": "5bf63428ed4080cac8ea728af56468be8bbaf9ef", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODIxNDIwNg==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r368214206", "bodyText": "Done.", "author": "arugal", "createdAt": "2020-01-18T08:14:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODIxMTA5MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODIxMTIyMw==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r368211223", "bodyText": "@Fine0830 Please verify, do we really need all these percentiles? I think we shouldn't.\n@Fine0830 After you are back from the vacation, please check which metrics we really require.", "author": "wu-sheng", "createdAt": "2020-01-18T06:58:45Z", "path": "oap-server/server-bootstrap/src/main/resources/official_analysis.oal", "diffHunk": "@@ -102,3 +102,77 @@ envoy_parent_connections_used = from(EnvoyInstanceMetric.value).filter(metricNam\n // disable(top_n_database_statement);\n // disable(zipkin_span);\n // disable(jaeger_span);\n+\n+\n+// Browser metrics begin", "originalCommit": "5bf63428ed4080cac8ea728af56468be8bbaf9ef", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODIzMDk1OQ==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r368230959", "bodyText": "@kezhenxu94 I want to discuss a thing with you. In @arugal prev PR, this part of OAL is separated in another OAL, I asked him to change like this. But in these days, I prefer his way more. If those are in another OAL file, then OAL engine could provide an API to activate some OAL files, such as from browser-receiver provider. This should make our document easier. What do you think? @arugal", "author": "wu-sheng", "createdAt": "2020-01-18T14:57:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODIxMTIyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODI4ODIwOQ==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r368288209", "bodyText": "In @arugal prev PR, this part of OAL is separated in another OAL\n\nWhich PR? I'd like to have a look;\nModularizing the OAL sounds good to me, maybe divide them as per entity or metrics, and make it possible for the users to put their custom metrics in a separate file", "author": "kezhenxu94", "createdAt": "2020-01-19T11:57:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODIxMTIyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODI4OTM1Mw==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r368289353", "bodyText": "Actually, I don't want to separate too many files. It was this PR, there were two OAL files, one for backend service, the other for browser. They are activated by receiver. What do you think?", "author": "wu-sheng", "createdAt": "2020-01-19T12:17:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODIxMTIyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODI4OTg0OQ==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r368289849", "bodyText": "Actually, I don't want to separate too many files. It was this PR, there were two OAL files, one for backend service, the other for browser. They are activated by receiver. What do you think?\n\nAnyway, I'm with this idea, it doesn't matter for me how many OAL files are divided into, finally :)", "author": "kezhenxu94", "createdAt": "2020-01-19T12:24:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODIxMTIyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODI5MDY2MA==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r368290660", "bodyText": "@arugal Sorry for requesting you to change back. Could you revert to your prev idea? And activate the OAL by the receiver? The current OAL file should be activated by the core module directly.", "author": "wu-sheng", "createdAt": "2020-01-19T12:38:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODIxMTIyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODM1Mjg3MA==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r368352870", "bodyText": "And activate the OAL by the receiver?\n\nAgree.\nDesign\n\nofficial_analysis.oal and browser_analysis.oal\nofficial_analysis.oal activate by mission-metric, istio-telemetry, service-mesh, receiver-trace, receiver-so11y, receiver-jvm, receiver-clr \nbrowser_analysis.oal activate by browser-receiver\neach file will only be activated once", "author": "arugal", "createdAt": "2020-01-20T02:53:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODIxMTIyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODM1NDYzNw==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r368354637", "bodyText": "Good for me.", "author": "wu-sheng", "createdAt": "2020-01-20T03:06:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODIxMTIyMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODIzMDMxMw==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r368230313", "bodyText": "Do we use this today?", "author": "wu-sheng", "createdAt": "2020-01-18T14:43:46Z", "path": "docs/en/setup/backend/backend-alarm.md", "diffHunk": "@@ -85,7 +85,7 @@ Webhook requires the peer is a web container. The alarm message will send throug\n - **scopeId**, **scope**. All scopes are defined in org.apache.skywalking.oap.server.core.source.DefaultScopeDefine.\n - **name**. Target scope entity name.\n - **id0**. The ID of scope entity, matched the name.\n-- **id1**. Not used today.\n+- **id1**. The ID1 of scope entity.", "originalCommit": "7509a1e6fcc7b634823d5d13933b63c340b2a865", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODIzMDQ0NA==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r368230444", "bodyText": "ID1 is designed for relationship alert. I think it is not related to this PR, right?", "author": "wu-sheng", "createdAt": "2020-01-18T14:46:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODIzMDMxMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODIzMDM1MA==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r368230350", "bodyText": "All these should be named Browser*. ServiceVersion should be BrowserSingleVersion*.", "author": "wu-sheng", "createdAt": "2020-01-18T14:44:21Z", "path": "oap-server/oal-grammar/src/main/antlr4/org/apache/skywalking/oal/rt/grammar/OALLexer.g4", "diffHunk": "@@ -44,6 +44,12 @@ SRC_SERVICE_INSTANCE_CLR_GC: 'ServiceInstanceCLRGC';\n SRC_SERVICE_INSTANCE_CLR_THREAD: 'ServiceInstanceCLRThread';\n SRC_ENVOY_INSTANCE_METRIC: 'EnvoyInstanceMetric';\n \n+// Browser keywords\n+SRC_BROWSER_SERVICE_PERF_DETAIL: 'ServicePerfDetail';\n+SRC_BROWSER_SERVICE_PAGE_PATH_PERF_DETAIL: 'ServicePagePathPerfDetail';\n+SRC_BROWSER_SERVICE_VERSION_PERF_DETAIL: 'ServiceVersionPerfDetail';\n+SRC_BROWSER_SERVICE_VERSION_PAGE_PATH_PERF_DETAIL: 'ServiceVersionPagePathPerfDetail';", "originalCommit": "7509a1e6fcc7b634823d5d13933b63c340b2a865", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODIzMDQ1OQ==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r368230459", "bodyText": "Same question about id1", "author": "wu-sheng", "createdAt": "2020-01-18T14:46:24Z", "path": "oap-server/server-alarm-plugin/src/main/java/org/apache/skywalking/oap/server/core/alarm/provider/AlarmMessageFormatter.java", "diffHunk": "@@ -55,6 +55,9 @@ public AlarmMessageFormatter(String format) {\n                         case \"id\":\n                             valueFroms.add(ValueFrom.ID);\n                             break;\n+                        case \"id1\":\n+                            valueFroms.add(ValueFrom.ID1);", "originalCommit": "7509a1e6fcc7b634823d5d13933b63c340b2a865", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODIzMDUyMQ==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r368230521", "bodyText": "ID1 should not be used in this way. If this is page related alert, then id0=pageId, which is unique, so don't worry about it.", "author": "wu-sheng", "createdAt": "2020-01-18T14:47:39Z", "path": "oap-server/server-alarm-plugin/src/main/java/org/apache/skywalking/oap/server/core/alarm/provider/NotifyHandler.java", "diffHunk": "@@ -82,6 +84,38 @@ public NotifyHandler(AlarmRulesWatcher alarmRulesWatcher) {\n \n             endpointMetaInAlarm.setName(textName);\n             metaInAlarm = endpointMetaInAlarm;\n+        } else if (DefaultScopeDefine.inServicePageCatalog(scope)) {\n+            String metricsId = meta.getId();\n+            String[] ids = metricsId.split(Const.ID_SPLIT);\n+            int serviceId = Integer.parseInt(ids[0]);\n+            int pagePathId = Integer.parseInt(ids[1]);", "originalCommit": "7509a1e6fcc7b634823d5d13933b63c340b2a865", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODIzMDUzMQ==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r368230531", "bodyText": "Same issue here about id1", "author": "wu-sheng", "createdAt": "2020-01-18T14:47:58Z", "path": "oap-server/server-alarm-plugin/src/main/java/org/apache/skywalking/oap/server/core/alarm/provider/NotifyHandler.java", "diffHunk": "@@ -82,6 +84,38 @@ public NotifyHandler(AlarmRulesWatcher alarmRulesWatcher) {\n \n             endpointMetaInAlarm.setName(textName);\n             metaInAlarm = endpointMetaInAlarm;\n+        } else if (DefaultScopeDefine.inServicePageCatalog(scope)) {\n+            String metricsId = meta.getId();\n+            String[] ids = metricsId.split(Const.ID_SPLIT);\n+            int serviceId = Integer.parseInt(ids[0]);\n+            int pagePathId = Integer.parseInt(ids[1]);\n+            ServiceInventory serviceInventory = serviceInventoryCache.get(serviceId);\n+            EndpointInventory endpointInventory = endpointInventoryCache.get(pagePathId);\n+\n+            ServicePageMetaInAlarm servicePageMetaInAlarm = new ServicePageMetaInAlarm();\n+            servicePageMetaInAlarm.setMetricsName(meta.getMetricsName());\n+            servicePageMetaInAlarm.setServiceId(serviceId);\n+            servicePageMetaInAlarm.setPagePathId(pagePathId);\n+\n+            String textName = endpointInventory.getName() + \" in \" + serviceInventory.getName();\n+            servicePageMetaInAlarm.setName(textName);\n+            metaInAlarm = servicePageMetaInAlarm;\n+        } else if (DefaultScopeDefine.inServiceVersionCatalog(scope)) {\n+            String metricsId = meta.getId();\n+            String[] ids = metricsId.split(Const.ID_SPLIT);\n+            int serviceVersionId = Integer.parseInt(ids[0]);\n+            int pagePathId = Integer.parseInt(ids[1]);", "originalCommit": "7509a1e6fcc7b634823d5d13933b63c340b2a865", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODIzMDU1Nw==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r368230557", "bodyText": "SERVICE_ should be renamed to BROWSER_", "author": "wu-sheng", "createdAt": "2020-01-18T14:48:30Z", "path": "oap-server/server-core/src/main/java/org/apache/skywalking/oap/server/core/source/DefaultScopeDefine.java", "diffHunk": "@@ -71,16 +71,28 @@\n     public static final int PROFILE_TASK_LOG = 27;\n     public static final int PROFILE_TASK_SEGMENT_SNAPSHOT = 28;\n \n+    // browser\n+    public static final int BROWSER_PERF_DATA = 40;\n+    public static final int SERVICE_PERF_DETAIL = 41;\n+    public static final int SERVICE_PAGE_PATH_PERF_DETAIL = 42;\n+    public static final int SERVICE_VERSION_PERF_DETAIL = 43;\n+    public static final int SERVICE_VERSION_PAGE_PATH_PERF_DETAIL = 44;", "originalCommit": "7509a1e6fcc7b634823d5d13933b63c340b2a865", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODIzMDU4Mg==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r368230582", "bodyText": "Same rename suggestion.", "author": "wu-sheng", "createdAt": "2020-01-18T14:48:47Z", "path": "oap-server/server-core/src/main/java/org/apache/skywalking/oap/server/core/source/DefaultScopeDefine.java", "diffHunk": "@@ -71,16 +71,28 @@\n     public static final int PROFILE_TASK_LOG = 27;\n     public static final int PROFILE_TASK_SEGMENT_SNAPSHOT = 28;\n \n+    // browser\n+    public static final int BROWSER_PERF_DATA = 40;\n+    public static final int SERVICE_PERF_DETAIL = 41;\n+    public static final int SERVICE_PAGE_PATH_PERF_DETAIL = 42;\n+    public static final int SERVICE_VERSION_PERF_DETAIL = 43;\n+    public static final int SERVICE_VERSION_PAGE_PATH_PERF_DETAIL = 44;\n+\n     /**\n      * Catalog of scope, the metrics processor could use this to group all generated metrics by oal rt.\n      */\n     public static final String SERVICE_CATALOG_NAME = \"SERVICE\";\n     public static final String SERVICE_INSTANCE_CATALOG_NAME = \"SERVICE_INSTANCE\";\n     public static final String ENDPOINT_CATALOG_NAME = \"ENDPOINT\";\n \n+    public static final String SERVICE_PAGE_PATH_CATALOG_NAME = \"SERVICE_PAGE_PATH\";\n+    public static final String SERVICE_VERSION_PAGE_PATH_CATALOG_NAME = \"SERVICE_VERSION_PAGE_PATH\";", "originalCommit": "7509a1e6fcc7b634823d5d13933b63c340b2a865", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODIzMDU4NQ==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r368230585", "bodyText": "Same rename suggestion.", "author": "wu-sheng", "createdAt": "2020-01-18T14:48:52Z", "path": "oap-server/server-core/src/main/java/org/apache/skywalking/oap/server/core/source/DefaultScopeDefine.java", "diffHunk": "@@ -71,16 +71,28 @@\n     public static final int PROFILE_TASK_LOG = 27;\n     public static final int PROFILE_TASK_SEGMENT_SNAPSHOT = 28;\n \n+    // browser\n+    public static final int BROWSER_PERF_DATA = 40;\n+    public static final int SERVICE_PERF_DETAIL = 41;\n+    public static final int SERVICE_PAGE_PATH_PERF_DETAIL = 42;\n+    public static final int SERVICE_VERSION_PERF_DETAIL = 43;\n+    public static final int SERVICE_VERSION_PAGE_PATH_PERF_DETAIL = 44;\n+\n     /**\n      * Catalog of scope, the metrics processor could use this to group all generated metrics by oal rt.\n      */\n     public static final String SERVICE_CATALOG_NAME = \"SERVICE\";\n     public static final String SERVICE_INSTANCE_CATALOG_NAME = \"SERVICE_INSTANCE\";\n     public static final String ENDPOINT_CATALOG_NAME = \"ENDPOINT\";\n \n+    public static final String SERVICE_PAGE_PATH_CATALOG_NAME = \"SERVICE_PAGE_PATH\";\n+    public static final String SERVICE_VERSION_PAGE_PATH_CATALOG_NAME = \"SERVICE_VERSION_PAGE_PATH\";\n+\n     private static final Map<Integer, Boolean> SERVICE_CATALOG = new HashMap<>();\n     private static final Map<Integer, Boolean> SERVICE_INSTANCE_CATALOG = new HashMap<>();\n     private static final Map<Integer, Boolean> ENDPOINT_CATALOG = new HashMap<>();\n+    private static final Map<Integer, Boolean> SERVICE_PAGE_PATH_CATALOG = new HashMap<>();\n+    private static final Map<Integer, Boolean> SERVICE_VERSION_PAGE_PATH_CATALOG = new HashMap<>();", "originalCommit": "7509a1e6fcc7b634823d5d13933b63c340b2a865", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjM1ODc4NA==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r372358784", "bodyText": "Who will provide an external ClassLoader?", "author": "wu-sheng", "createdAt": "2020-01-29T12:39:55Z", "path": "oap-server/server-core/src/main/java/org/apache/skywalking/oap/server/core/oal/rt/OALEngineService.java", "diffHunk": "@@ -0,0 +1,84 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.oap.server.core.oal.rt;\n+\n+import lombok.extern.slf4j.Slf4j;\n+import org.apache.skywalking.oap.server.core.CoreModule;\n+import org.apache.skywalking.oap.server.core.analysis.StreamAnnotationListener;\n+import org.apache.skywalking.oap.server.core.source.SourceReceiver;\n+import org.apache.skywalking.oap.server.library.module.ModuleManager;\n+import org.apache.skywalking.oap.server.library.module.ModuleStartException;\n+import org.apache.skywalking.oap.server.library.module.Service;\n+\n+import java.lang.reflect.Constructor;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+/**\n+ *\n+ * @author zhangwei\n+ */\n+@Slf4j\n+public class OALEngineService implements Service {\n+\n+    private final Map<OALEngine.Group, OALEngine> engineMap = new HashMap<>();\n+    private final ModuleManager moduleManager;\n+\n+    public OALEngineService(ModuleManager moduleManager) {\n+        this.moduleManager = moduleManager;\n+    }\n+\n+    public void activate(OALEngine.Group group) throws ModuleStartException {\n+        activate(group, OALEngineService.class.getClassLoader());\n+    }\n+\n+    public void activate(OALEngine.Group group, ClassLoader classLoader) throws ModuleStartException {", "originalCommit": "0804f6151b25fa5a98c645a310f99c1967b9c619", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjM1OTYyNw==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r372359627", "bodyText": "This should be mapping to the service instance, right? Then it should be named. BROWSER_APP_SINGLE_VERSION_CATALOG_NAME", "author": "wu-sheng", "createdAt": "2020-01-29T12:41:50Z", "path": "oap-server/server-core/src/main/java/org/apache/skywalking/oap/server/core/source/DefaultScopeDefine.java", "diffHunk": "@@ -71,16 +71,28 @@\n     public static final int PROFILE_TASK_LOG = 27;\n     public static final int PROFILE_TASK_SEGMENT_SNAPSHOT = 28;\n \n+    // browser\n+    public static final int BROWSER_PERF_DATA = 40;\n+    public static final int BROWSER_PERF_DETAIL = 41;\n+    public static final int BROWSER_PAGE_PATH_PERF_DETAIL = 42;\n+    public static final int BROWSER_SINGLE_VERSION_PERF_DETAIL = 43;\n+    public static final int BROWSER_SINGLE_VERSION_PAGE_PATH_PERF_DETAIL = 44;\n+\n     /**\n      * Catalog of scope, the metrics processor could use this to group all generated metrics by oal rt.\n      */\n     public static final String SERVICE_CATALOG_NAME = \"SERVICE\";\n     public static final String SERVICE_INSTANCE_CATALOG_NAME = \"SERVICE_INSTANCE\";\n     public static final String ENDPOINT_CATALOG_NAME = \"ENDPOINT\";\n \n+    public static final String BROWSER_PAGE_PATH_CATALOG_NAME = \"BROWSER_PAGE_PATH\";\n+    public static final String BROWSER_SINGLE_VERSION_PAGE_PATH_CATALOG_NAME = \"BROWSER_SINGLE_VERSION_PAGE_PATH\";", "originalCommit": "0804f6151b25fa5a98c645a310f99c1967b9c619", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjM2MDI0MQ==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r372360241", "bodyText": "BROWSER_ -> BROWSER_APP_.", "author": "wu-sheng", "createdAt": "2020-01-29T12:43:19Z", "path": "oap-server/server-core/src/main/java/org/apache/skywalking/oap/server/core/source/DefaultScopeDefine.java", "diffHunk": "@@ -71,16 +71,28 @@\n     public static final int PROFILE_TASK_LOG = 27;\n     public static final int PROFILE_TASK_SEGMENT_SNAPSHOT = 28;\n \n+    // browser\n+    public static final int BROWSER_PERF_DATA = 40;", "originalCommit": "0804f6151b25fa5a98c645a310f99c1967b9c619", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjM2MjI0MQ==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r372362241", "bodyText": "Parse -> Parser.", "author": "wu-sheng", "createdAt": "2020-01-29T12:48:02Z", "path": "oap-server/server-receiver-plugin/skywalking-browser-receiver-plugin/src/main/java/org/apache/skywalking/oap/server/recevier/browser/provider/parse/BrowserPerfDataParse.java", "diffHunk": "@@ -0,0 +1,217 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.oap.server.recevier.browser.provider.parse;\n+\n+import lombok.Setter;\n+import lombok.extern.slf4j.Slf4j;\n+import org.apache.skywalking.apm.network.language.agent.BrowserPerfData;\n+import org.apache.skywalking.oap.server.core.Const;\n+import org.apache.skywalking.oap.server.core.CoreModule;\n+import org.apache.skywalking.oap.server.core.analysis.TimeBucket;\n+import org.apache.skywalking.oap.server.core.cache.ServiceInstanceInventoryCache;\n+import org.apache.skywalking.oap.server.library.buffer.BufferData;\n+import org.apache.skywalking.oap.server.library.buffer.DataStreamReader;\n+import org.apache.skywalking.oap.server.library.module.ModuleManager;\n+import org.apache.skywalking.oap.server.recevier.browser.provider.BrowserServiceModuleConfig;\n+import org.apache.skywalking.oap.server.recevier.browser.provider.parse.decorator.BrowserErrorLogDecorator;\n+import org.apache.skywalking.oap.server.recevier.browser.provider.parse.decorator.BrowserPerfDataCoreInfo;\n+import org.apache.skywalking.oap.server.recevier.browser.provider.parse.decorator.BrowserPerfDataDecorator;\n+import org.apache.skywalking.oap.server.recevier.browser.provider.parse.listener.BrowserPerfDataListener;\n+import org.apache.skywalking.oap.server.recevier.browser.provider.parse.standardization.BrowserPerfDataStandardization;\n+import org.apache.skywalking.oap.server.recevier.browser.provider.parse.standardization.BrowserPerfDataStandardizationWorker;\n+import org.apache.skywalking.oap.server.recevier.browser.provider.parse.standardization.PagePathIdExchanger;\n+import org.apache.skywalking.oap.server.telemetry.TelemetryModule;\n+import org.apache.skywalking.oap.server.telemetry.api.CounterMetrics;\n+import org.apache.skywalking.oap.server.telemetry.api.MetricsCreator;\n+import org.apache.skywalking.oap.server.telemetry.api.MetricsTag;\n+\n+import java.util.LinkedList;\n+import java.util.List;\n+\n+/**\n+ * @author zhangwei\n+ */\n+@Slf4j\n+public class BrowserPerfDataParse {", "originalCommit": "0804f6151b25fa5a98c645a310f99c1967b9c619", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjM2MzkzNA==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r372363934", "bodyText": "Naming issue. This should be related to BrowserAppSignleVersion. Not to page path even you could include the path for filter and metrics funcs.", "author": "wu-sheng", "createdAt": "2020-01-29T12:51:50Z", "path": "oap-server/server-core/src/main/java/org/apache/skywalking/oap/server/core/browser/source/BrowserSingleVersionPagePathPerfDetail.java", "diffHunk": "@@ -0,0 +1,59 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.oap.server.core.browser.source;\n+\n+import lombok.Getter;\n+import lombok.Setter;\n+import org.apache.skywalking.oap.server.core.Const;\n+import org.apache.skywalking.oap.server.core.source.ScopeDeclaration;\n+import org.apache.skywalking.oap.server.core.source.ScopeDefaultColumn;\n+import org.apache.skywalking.oap.server.core.source.Source;\n+\n+import static org.apache.skywalking.oap.server.core.source.DefaultScopeDefine.BROWSER_SINGLE_VERSION_PAGE_PATH_CATALOG_NAME;\n+import static org.apache.skywalking.oap.server.core.source.DefaultScopeDefine.BROWSER_SINGLE_VERSION_PAGE_PATH_PERF_DETAIL;\n+\n+/**\n+ * @author zhangwei\n+ */\n+@ScopeDeclaration(id = BROWSER_SINGLE_VERSION_PAGE_PATH_PERF_DETAIL, name = \"BrowserSingleVersionPagePathPerfDetail\", catalog = BROWSER_SINGLE_VERSION_PAGE_PATH_CATALOG_NAME)\n+@ScopeDefaultColumn.VirtualColumnDefinition(fieldName = \"entityId\", columnName = \"entity_id\", isID = true, type = String.class)\n+public class BrowserSingleVersionPagePathPerfDetail extends Source {", "originalCommit": "0804f6151b25fa5a98c645a310f99c1967b9c619", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjM2NDIwNA==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r372364204", "bodyText": "Catalog is not right.", "author": "wu-sheng", "createdAt": "2020-01-29T12:52:27Z", "path": "oap-server/server-core/src/main/java/org/apache/skywalking/oap/server/core/browser/source/BrowserSingleVersionPerfDetail.java", "diffHunk": "@@ -0,0 +1,56 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.oap.server.core.browser.source;\n+\n+import lombok.Getter;\n+import lombok.Setter;\n+import org.apache.skywalking.oap.server.core.source.ScopeDeclaration;\n+import org.apache.skywalking.oap.server.core.source.ScopeDefaultColumn;\n+import org.apache.skywalking.oap.server.core.source.Source;\n+\n+import static org.apache.skywalking.oap.server.core.source.DefaultScopeDefine.SERVICE_INSTANCE_CATALOG_NAME;\n+import static org.apache.skywalking.oap.server.core.source.DefaultScopeDefine.BROWSER_SINGLE_VERSION_PERF_DETAIL;\n+\n+/**\n+ * @author zhangwei\n+ */\n+@ScopeDeclaration(id = BROWSER_SINGLE_VERSION_PERF_DETAIL, name = \"BrowserSingleVersionPerfDetail\", catalog = SERVICE_INSTANCE_CATALOG_NAME)", "originalCommit": "0804f6151b25fa5a98c645a310f99c1967b9c619", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjM2NDcwNA==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r372364704", "bodyText": "BrowserPagePathPerfDetail-> BrowserAppPagePerf", "author": "wu-sheng", "createdAt": "2020-01-29T12:53:29Z", "path": "oap-server/server-core/src/main/java/org/apache/skywalking/oap/server/core/browser/source/BrowserPagePathPerfDetail.java", "diffHunk": "@@ -0,0 +1,60 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.oap.server.core.browser.source;\n+\n+import lombok.Getter;\n+import lombok.Setter;\n+import org.apache.skywalking.oap.server.core.Const;\n+import org.apache.skywalking.oap.server.core.source.ScopeDeclaration;\n+import org.apache.skywalking.oap.server.core.source.ScopeDefaultColumn;\n+import org.apache.skywalking.oap.server.core.source.Source;\n+\n+import static org.apache.skywalking.oap.server.core.source.DefaultScopeDefine.BROWSER_PAGE_PATH_CATALOG_NAME;\n+import static org.apache.skywalking.oap.server.core.source.DefaultScopeDefine.BROWSER_PAGE_PATH_PERF_DETAIL;\n+\n+/**\n+ * @author zhangwei\n+ */\n+@ScopeDeclaration(id = BROWSER_PAGE_PATH_PERF_DETAIL, name = \"BrowserPagePathPerfDetail\", catalog = BROWSER_PAGE_PATH_CATALOG_NAME)\n+@ScopeDefaultColumn.VirtualColumnDefinition(fieldName = \"entityId\", columnName = \"entity_id\", isID = true, type = String.class)\n+public class BrowserPagePathPerfDetail extends Source {", "originalCommit": "0804f6151b25fa5a98c645a310f99c1967b9c619", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjM2NTU1Mw==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r372365553", "bodyText": "Browser-> BrowserApp.", "author": "wu-sheng", "createdAt": "2020-01-29T12:55:34Z", "path": "oap-server/server-core/src/main/java/org/apache/skywalking/oap/server/core/browser/source/BrowserPerfData.java", "diffHunk": "@@ -0,0 +1,52 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.oap.server.core.browser.source;\n+\n+import lombok.Getter;\n+import lombok.Setter;\n+import org.apache.skywalking.oap.server.core.source.ScopeDeclaration;\n+import org.apache.skywalking.oap.server.core.source.Source;\n+\n+import static org.apache.skywalking.oap.server.core.source.DefaultScopeDefine.BROWSER_PERF_DATA;\n+\n+/**\n+ * @author zhangwei\n+ */\n+@ScopeDeclaration(id = BROWSER_PERF_DATA, name = \"BrowserPerfData\")\n+public class BrowserPerfData extends Source {", "originalCommit": "0804f6151b25fa5a98c645a310f99c1967b9c619", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjM2NjQ0MA==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r372366440", "bodyText": "This comment is not right.\n\nPerformance metrics of every single version .", "author": "wu-sheng", "createdAt": "2020-01-29T12:57:34Z", "path": "oap-server/server-bootstrap/src/main/resources/browser_analysis.oal", "diffHunk": "@@ -0,0 +1,87 @@\n+/*\n+* Licensed to the Apache Software Foundation (ASF) under one or more\n+* contributor license agreements.  See the NOTICE file distributed with\n+* this work for additional information regarding copyright ownership.\n+* The ASF licenses this file to You under the Apache License, Version 2.0\n+* (the \"License\"); you may not use this file except in compliance with\n+* the License.  You may obtain a copy of the License at\n+*\n+*     http://www.apache.org/licenses/LICENSE-2.0\n+*\n+* Unless required by applicable law or agreed to in writing, software\n+* distributed under the License is distributed on an \"AS IS\" BASIS,\n+* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+* See the License for the specific language governing permissions and\n+* limitations under the License.\n+*\n+*/\n+\n+// Browser service\n+browser_redirect_avg = from(BrowserPerfDetail.redirectTime).longAvg();\n+browser_dns_avg = from(BrowserPerfDetail.dnsTime).longAvg();\n+browser_req_avg = from(BrowserPerfDetail.reqTime).longAvg();\n+browser_dom_analysis_avg = from(BrowserPerfDetail.domAnalysisTime).longAvg();\n+browser_dom_ready_avg = from(BrowserPerfDetail.domReadyTime).longAvg();\n+browser_blank_avg = from(BrowserPerfDetail.blankTime).longAvg();\n+\n+// Multiple values including p50, p75, p90, p95, p99\n+browser_redirect_percentile = from(BrowserPerfDetail.redirectTime).percentile(10);\n+browser_dns_percentile = from(BrowserPerfDetail.dnsTime).percentile(10);\n+browser_req_percentile = from(BrowserPerfDetail.reqTime).percentile(10);\n+browser_dom_analysis_percentile = from(BrowserPerfDetail.domAnalysisTime).percentile(10);\n+browser_dom_ready_percentile = from(BrowserPerfDetail.domReadyTime).percentile(10);\n+browser_blank_percentile = from(BrowserPerfDetail.blankTime).percentile(10);\n+\n+// Browser service page\n+browser_page_pv = from(BrowserPagePathPerfDetail.count).sum();\n+browser_page_error_rate = from(BrowserPagePathPerfDetail.*).percent(status == false);\n+\n+browser_page_redirect_avg = from(BrowserPagePathPerfDetail.redirectTime).longAvg();\n+browser_page_dns_avg = from(BrowserPagePathPerfDetail.dnsTime).longAvg();\n+browser_page_req_avg = from(BrowserPagePathPerfDetail.reqTime).longAvg();\n+browser_page_dom_analysis_avg = from(BrowserPagePathPerfDetail.domAnalysisTime).longAvg();\n+browser_page_dom_ready_avg = from(BrowserPagePathPerfDetail.domReadyTime).longAvg();\n+browser_page_blank_avg = from(BrowserPagePathPerfDetail.blankTime).longAvg();\n+\n+// Multiple values including p50, p75, p90, p95, p99\n+browser_page_redirect_percentile = from(BrowserPagePathPerfDetail.redirectTime).percentile(10);\n+browser_page_dns_percentile = from(BrowserPagePathPerfDetail.dnsTime).percentile(10);\n+browser_page_req_percentile = from(BrowserPagePathPerfDetail.reqTime).percentile(10);\n+browser_page_dom_analysis_percentile = from(BrowserPagePathPerfDetail.domAnalysisTime).percentile(10);\n+browser_page_dom_ready_percentile = from(BrowserPagePathPerfDetail.domReadyTime).percentile(10);\n+browser_page_blank_percentile = from(BrowserPagePathPerfDetail.blankTime).percentile(10);\n+\n+// Browser service version", "originalCommit": "0804f6151b25fa5a98c645a310f99c1967b9c619", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzgzMjEwNA==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r373832104", "bodyText": "We should add error rate ranking for pages in service version.", "author": "Fine0830", "createdAt": "2020-02-02T09:32:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjM2NjQ0MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzgzMjU0NA==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r373832544", "bodyText": "As per service version dimension, will calculate all of errors sum and different catalogs sum.", "author": "Fine0830", "createdAt": "2020-02-02T09:41:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjM2NjQ0MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjM2ODA3MQ==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r372368071", "bodyText": "Browser -> BrowserApp.", "author": "wu-sheng", "createdAt": "2020-01-29T13:01:03Z", "path": "oap-server/server-core/src/main/java/org/apache/skywalking/oap/server/core/browser/source/BrowserSingleVersionPerfDetail.java", "diffHunk": "@@ -0,0 +1,56 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.oap.server.core.browser.source;\n+\n+import lombok.Getter;\n+import lombok.Setter;\n+import org.apache.skywalking.oap.server.core.source.ScopeDeclaration;\n+import org.apache.skywalking.oap.server.core.source.ScopeDefaultColumn;\n+import org.apache.skywalking.oap.server.core.source.Source;\n+\n+import static org.apache.skywalking.oap.server.core.source.DefaultScopeDefine.SERVICE_INSTANCE_CATALOG_NAME;\n+import static org.apache.skywalking.oap.server.core.source.DefaultScopeDefine.BROWSER_SINGLE_VERSION_PERF_DETAIL;\n+\n+/**\n+ * @author zhangwei\n+ */\n+@ScopeDeclaration(id = BROWSER_SINGLE_VERSION_PERF_DETAIL, name = \"BrowserSingleVersionPerfDetail\", catalog = SERVICE_INSTANCE_CATALOG_NAME)\n+@ScopeDefaultColumn.VirtualColumnDefinition(fieldName = \"entityId\", columnName = \"entity_id\", isID = true, type = String.class)\n+public class BrowserSingleVersionPerfDetail extends Source {", "originalCommit": "0804f6151b25fa5a98c645a310f99c1967b9c619", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzgyODczMg==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r373828732", "bodyText": "I don't think we need those metrics. service page metrics are enough.", "author": "Fine0830", "createdAt": "2020-02-02T08:32:59Z", "path": "oap-server/server-bootstrap/src/main/resources/browser_analysis.oal", "diffHunk": "@@ -0,0 +1,87 @@\n+/*\n+* Licensed to the Apache Software Foundation (ASF) under one or more\n+* contributor license agreements.  See the NOTICE file distributed with\n+* this work for additional information regarding copyright ownership.\n+* The ASF licenses this file to You under the Apache License, Version 2.0\n+* (the \"License\"); you may not use this file except in compliance with\n+* the License.  You may obtain a copy of the License at\n+*\n+*     http://www.apache.org/licenses/LICENSE-2.0\n+*\n+* Unless required by applicable law or agreed to in writing, software\n+* distributed under the License is distributed on an \"AS IS\" BASIS,\n+* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+* See the License for the specific language governing permissions and\n+* limitations under the License.\n+*\n+*/\n+\n+// Browser service\n+browser_redirect_avg = from(BrowserPerfDetail.redirectTime).longAvg();\n+browser_dns_avg = from(BrowserPerfDetail.dnsTime).longAvg();\n+browser_req_avg = from(BrowserPerfDetail.reqTime).longAvg();\n+browser_dom_analysis_avg = from(BrowserPerfDetail.domAnalysisTime).longAvg();\n+browser_dom_ready_avg = from(BrowserPerfDetail.domReadyTime).longAvg();\n+browser_blank_avg = from(BrowserPerfDetail.blankTime).longAvg();\n+\n+// Multiple values including p50, p75, p90, p95, p99\n+browser_redirect_percentile = from(BrowserPerfDetail.redirectTime).percentile(10);\n+browser_dns_percentile = from(BrowserPerfDetail.dnsTime).percentile(10);\n+browser_req_percentile = from(BrowserPerfDetail.reqTime).percentile(10);\n+browser_dom_analysis_percentile = from(BrowserPerfDetail.domAnalysisTime).percentile(10);\n+browser_dom_ready_percentile = from(BrowserPerfDetail.domReadyTime).percentile(10);\n+browser_blank_percentile = from(BrowserPerfDetail.blankTime).percentile(10);", "originalCommit": "0804f6151b25fa5a98c645a310f99c1967b9c619", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzgzMDU5MQ==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r373830591", "bodyText": "We should add error rate ranking for versions in service.", "author": "Fine0830", "createdAt": "2020-02-02T09:04:29Z", "path": "oap-server/server-bootstrap/src/main/resources/browser_analysis.oal", "diffHunk": "@@ -0,0 +1,87 @@\n+/*\n+* Licensed to the Apache Software Foundation (ASF) under one or more\n+* contributor license agreements.  See the NOTICE file distributed with\n+* this work for additional information regarding copyright ownership.\n+* The ASF licenses this file to You under the Apache License, Version 2.0\n+* (the \"License\"); you may not use this file except in compliance with\n+* the License.  You may obtain a copy of the License at\n+*\n+*     http://www.apache.org/licenses/LICENSE-2.0\n+*\n+* Unless required by applicable law or agreed to in writing, software\n+* distributed under the License is distributed on an \"AS IS\" BASIS,\n+* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+* See the License for the specific language governing permissions and\n+* limitations under the License.\n+*\n+*/\n+\n+// Browser service", "originalCommit": "0804f6151b25fa5a98c645a310f99c1967b9c619", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzgzMTI4MA==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r373831280", "bodyText": "We need to sort errors and calculate errors sum for different catalogs. Will need all of errors sum. Please add metics for those.", "author": "Fine0830", "createdAt": "2020-02-02T09:17:26Z", "path": "oap-server/server-bootstrap/src/main/resources/browser_analysis.oal", "diffHunk": "@@ -0,0 +1,87 @@\n+/*\n+* Licensed to the Apache Software Foundation (ASF) under one or more\n+* contributor license agreements.  See the NOTICE file distributed with\n+* this work for additional information regarding copyright ownership.\n+* The ASF licenses this file to You under the Apache License, Version 2.0\n+* (the \"License\"); you may not use this file except in compliance with\n+* the License.  You may obtain a copy of the License at\n+*\n+*     http://www.apache.org/licenses/LICENSE-2.0\n+*\n+* Unless required by applicable law or agreed to in writing, software\n+* distributed under the License is distributed on an \"AS IS\" BASIS,\n+* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+* See the License for the specific language governing permissions and\n+* limitations under the License.\n+*\n+*/\n+\n+// Browser service\n+browser_redirect_avg = from(BrowserPerfDetail.redirectTime).longAvg();\n+browser_dns_avg = from(BrowserPerfDetail.dnsTime).longAvg();\n+browser_req_avg = from(BrowserPerfDetail.reqTime).longAvg();\n+browser_dom_analysis_avg = from(BrowserPerfDetail.domAnalysisTime).longAvg();\n+browser_dom_ready_avg = from(BrowserPerfDetail.domReadyTime).longAvg();\n+browser_blank_avg = from(BrowserPerfDetail.blankTime).longAvg();\n+\n+// Multiple values including p50, p75, p90, p95, p99\n+browser_redirect_percentile = from(BrowserPerfDetail.redirectTime).percentile(10);\n+browser_dns_percentile = from(BrowserPerfDetail.dnsTime).percentile(10);\n+browser_req_percentile = from(BrowserPerfDetail.reqTime).percentile(10);\n+browser_dom_analysis_percentile = from(BrowserPerfDetail.domAnalysisTime).percentile(10);\n+browser_dom_ready_percentile = from(BrowserPerfDetail.domReadyTime).percentile(10);\n+browser_blank_percentile = from(BrowserPerfDetail.blankTime).percentile(10);\n+\n+// Browser service page\n+browser_page_pv = from(BrowserPagePathPerfDetail.count).sum();\n+browser_page_error_rate = from(BrowserPagePathPerfDetail.*).percent(status == false);\n+", "originalCommit": "0804f6151b25fa5a98c645a310f99c1967b9c619", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzgzMjg3OA==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r373832878", "bodyText": "Those metrics should be removed.", "author": "Fine0830", "createdAt": "2020-02-02T09:48:21Z", "path": "oap-server/server-bootstrap/src/main/resources/browser_analysis.oal", "diffHunk": "@@ -0,0 +1,87 @@\n+/*\n+* Licensed to the Apache Software Foundation (ASF) under one or more\n+* contributor license agreements.  See the NOTICE file distributed with\n+* this work for additional information regarding copyright ownership.\n+* The ASF licenses this file to You under the Apache License, Version 2.0\n+* (the \"License\"); you may not use this file except in compliance with\n+* the License.  You may obtain a copy of the License at\n+*\n+*     http://www.apache.org/licenses/LICENSE-2.0\n+*\n+* Unless required by applicable law or agreed to in writing, software\n+* distributed under the License is distributed on an \"AS IS\" BASIS,\n+* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+* See the License for the specific language governing permissions and\n+* limitations under the License.\n+*\n+*/\n+\n+// Browser service\n+browser_redirect_avg = from(BrowserPerfDetail.redirectTime).longAvg();\n+browser_dns_avg = from(BrowserPerfDetail.dnsTime).longAvg();\n+browser_req_avg = from(BrowserPerfDetail.reqTime).longAvg();\n+browser_dom_analysis_avg = from(BrowserPerfDetail.domAnalysisTime).longAvg();\n+browser_dom_ready_avg = from(BrowserPerfDetail.domReadyTime).longAvg();\n+browser_blank_avg = from(BrowserPerfDetail.blankTime).longAvg();\n+\n+// Multiple values including p50, p75, p90, p95, p99\n+browser_redirect_percentile = from(BrowserPerfDetail.redirectTime).percentile(10);\n+browser_dns_percentile = from(BrowserPerfDetail.dnsTime).percentile(10);\n+browser_req_percentile = from(BrowserPerfDetail.reqTime).percentile(10);\n+browser_dom_analysis_percentile = from(BrowserPerfDetail.domAnalysisTime).percentile(10);\n+browser_dom_ready_percentile = from(BrowserPerfDetail.domReadyTime).percentile(10);\n+browser_blank_percentile = from(BrowserPerfDetail.blankTime).percentile(10);\n+\n+// Browser service page\n+browser_page_pv = from(BrowserPagePathPerfDetail.count).sum();\n+browser_page_error_rate = from(BrowserPagePathPerfDetail.*).percent(status == false);\n+\n+browser_page_redirect_avg = from(BrowserPagePathPerfDetail.redirectTime).longAvg();\n+browser_page_dns_avg = from(BrowserPagePathPerfDetail.dnsTime).longAvg();\n+browser_page_req_avg = from(BrowserPagePathPerfDetail.reqTime).longAvg();\n+browser_page_dom_analysis_avg = from(BrowserPagePathPerfDetail.domAnalysisTime).longAvg();\n+browser_page_dom_ready_avg = from(BrowserPagePathPerfDetail.domReadyTime).longAvg();\n+browser_page_blank_avg = from(BrowserPagePathPerfDetail.blankTime).longAvg();\n+\n+// Multiple values including p50, p75, p90, p95, p99\n+browser_page_redirect_percentile = from(BrowserPagePathPerfDetail.redirectTime).percentile(10);\n+browser_page_dns_percentile = from(BrowserPagePathPerfDetail.dnsTime).percentile(10);\n+browser_page_req_percentile = from(BrowserPagePathPerfDetail.reqTime).percentile(10);\n+browser_page_dom_analysis_percentile = from(BrowserPagePathPerfDetail.domAnalysisTime).percentile(10);\n+browser_page_dom_ready_percentile = from(BrowserPagePathPerfDetail.domReadyTime).percentile(10);\n+browser_page_blank_percentile = from(BrowserPagePathPerfDetail.blankTime).percentile(10);\n+\n+// Browser service version\n+browser_single_version_redirect_avg = from(BrowserSingleVersionPerfDetail.redirectTime).longAvg();\n+browser_single_version_dns_avg = from(BrowserSingleVersionPerfDetail.dnsTime).longAvg();\n+browser_single_version_req_avg = from(BrowserSingleVersionPerfDetail.reqTime).longAvg();\n+browser_single_version_dom_analysis_avg = from(BrowserSingleVersionPerfDetail.domAnalysisTime).longAvg();\n+browser_single_version_dom_ready_avg = from(BrowserSingleVersionPerfDetail.domReadyTime).longAvg();\n+browser_single_version_blank_avg = from(BrowserSingleVersionPerfDetail.blankTime).longAvg();\n+\n+// Multiple values including p50, p75, p90, p95, p99\n+browser_single_version_redirect_percentile = from(BrowserSingleVersionPerfDetail.redirectTime).percentile(10);\n+browser_single_version_dns_percentile = from(BrowserSingleVersionPerfDetail.dnsTime).percentile(10);\n+browser_single_version_req_percentile = from(BrowserSingleVersionPerfDetail.reqTime).percentile(10);\n+browser_single_version_dom_analysis_percentile = from(BrowserSingleVersionPerfDetail.domAnalysisTime).percentile(10);\n+browser_single_version_dom_ready_percentile = from(BrowserSingleVersionPerfDetail.domReadyTime).percentile(10);\n+browser_single_version_blank_percentile = from(BrowserSingleVersionPerfDetail.blankTime).percentile(10);\n+", "originalCommit": "0804f6151b25fa5a98c645a310f99c1967b9c619", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzgzMzA0OQ==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r373833049", "bodyText": "Please let version page metrics keep in line with service pages.", "author": "Fine0830", "createdAt": "2020-02-02T09:51:00Z", "path": "oap-server/server-bootstrap/src/main/resources/browser_analysis.oal", "diffHunk": "@@ -0,0 +1,87 @@\n+/*\n+* Licensed to the Apache Software Foundation (ASF) under one or more\n+* contributor license agreements.  See the NOTICE file distributed with\n+* this work for additional information regarding copyright ownership.\n+* The ASF licenses this file to You under the Apache License, Version 2.0\n+* (the \"License\"); you may not use this file except in compliance with\n+* the License.  You may obtain a copy of the License at\n+*\n+*     http://www.apache.org/licenses/LICENSE-2.0\n+*\n+* Unless required by applicable law or agreed to in writing, software\n+* distributed under the License is distributed on an \"AS IS\" BASIS,\n+* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+* See the License for the specific language governing permissions and\n+* limitations under the License.\n+*\n+*/\n+\n+// Browser service\n+browser_redirect_avg = from(BrowserPerfDetail.redirectTime).longAvg();\n+browser_dns_avg = from(BrowserPerfDetail.dnsTime).longAvg();\n+browser_req_avg = from(BrowserPerfDetail.reqTime).longAvg();\n+browser_dom_analysis_avg = from(BrowserPerfDetail.domAnalysisTime).longAvg();\n+browser_dom_ready_avg = from(BrowserPerfDetail.domReadyTime).longAvg();\n+browser_blank_avg = from(BrowserPerfDetail.blankTime).longAvg();\n+\n+// Multiple values including p50, p75, p90, p95, p99\n+browser_redirect_percentile = from(BrowserPerfDetail.redirectTime).percentile(10);\n+browser_dns_percentile = from(BrowserPerfDetail.dnsTime).percentile(10);\n+browser_req_percentile = from(BrowserPerfDetail.reqTime).percentile(10);\n+browser_dom_analysis_percentile = from(BrowserPerfDetail.domAnalysisTime).percentile(10);\n+browser_dom_ready_percentile = from(BrowserPerfDetail.domReadyTime).percentile(10);\n+browser_blank_percentile = from(BrowserPerfDetail.blankTime).percentile(10);\n+\n+// Browser service page\n+browser_page_pv = from(BrowserPagePathPerfDetail.count).sum();\n+browser_page_error_rate = from(BrowserPagePathPerfDetail.*).percent(status == false);\n+\n+browser_page_redirect_avg = from(BrowserPagePathPerfDetail.redirectTime).longAvg();\n+browser_page_dns_avg = from(BrowserPagePathPerfDetail.dnsTime).longAvg();\n+browser_page_req_avg = from(BrowserPagePathPerfDetail.reqTime).longAvg();\n+browser_page_dom_analysis_avg = from(BrowserPagePathPerfDetail.domAnalysisTime).longAvg();\n+browser_page_dom_ready_avg = from(BrowserPagePathPerfDetail.domReadyTime).longAvg();\n+browser_page_blank_avg = from(BrowserPagePathPerfDetail.blankTime).longAvg();\n+\n+// Multiple values including p50, p75, p90, p95, p99\n+browser_page_redirect_percentile = from(BrowserPagePathPerfDetail.redirectTime).percentile(10);\n+browser_page_dns_percentile = from(BrowserPagePathPerfDetail.dnsTime).percentile(10);\n+browser_page_req_percentile = from(BrowserPagePathPerfDetail.reqTime).percentile(10);\n+browser_page_dom_analysis_percentile = from(BrowserPagePathPerfDetail.domAnalysisTime).percentile(10);\n+browser_page_dom_ready_percentile = from(BrowserPagePathPerfDetail.domReadyTime).percentile(10);\n+browser_page_blank_percentile = from(BrowserPagePathPerfDetail.blankTime).percentile(10);\n+\n+// Browser service version\n+browser_single_version_redirect_avg = from(BrowserSingleVersionPerfDetail.redirectTime).longAvg();\n+browser_single_version_dns_avg = from(BrowserSingleVersionPerfDetail.dnsTime).longAvg();\n+browser_single_version_req_avg = from(BrowserSingleVersionPerfDetail.reqTime).longAvg();\n+browser_single_version_dom_analysis_avg = from(BrowserSingleVersionPerfDetail.domAnalysisTime).longAvg();\n+browser_single_version_dom_ready_avg = from(BrowserSingleVersionPerfDetail.domReadyTime).longAvg();\n+browser_single_version_blank_avg = from(BrowserSingleVersionPerfDetail.blankTime).longAvg();\n+\n+// Multiple values including p50, p75, p90, p95, p99\n+browser_single_version_redirect_percentile = from(BrowserSingleVersionPerfDetail.redirectTime).percentile(10);\n+browser_single_version_dns_percentile = from(BrowserSingleVersionPerfDetail.dnsTime).percentile(10);\n+browser_single_version_req_percentile = from(BrowserSingleVersionPerfDetail.reqTime).percentile(10);\n+browser_single_version_dom_analysis_percentile = from(BrowserSingleVersionPerfDetail.domAnalysisTime).percentile(10);\n+browser_single_version_dom_ready_percentile = from(BrowserSingleVersionPerfDetail.domReadyTime).percentile(10);\n+browser_single_version_blank_percentile = from(BrowserSingleVersionPerfDetail.blankTime).percentile(10);\n+\n+// Browser service version page", "originalCommit": "0804f6151b25fa5a98c645a310f99c1967b9c619", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjM4MDA2MQ==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r376380061", "bodyText": "What is this? I think SRC_BROWSER_APP_ERROR_LOG should represent the error log?", "author": "wu-sheng", "createdAt": "2020-02-07T13:07:14Z", "path": "oap-server/oal-grammar/src/main/antlr4/org/apache/skywalking/oal/rt/grammar/OALLexer.g4", "diffHunk": "@@ -45,10 +45,11 @@ SRC_SERVICE_INSTANCE_CLR_THREAD: 'ServiceInstanceCLRThread';\n SRC_ENVOY_INSTANCE_METRIC: 'EnvoyInstanceMetric';\n \n // Browser keywords\n-SRC_BROWSER_PERF_DETAIL: 'BrowserPerfDetail';\n-SRC_BROWSER_PAGE_PATH_PERF_DETAIL: 'BrowserPagePathPerfDetail';\n-SRC_BROWSER_SINGLE_VERSION_PERF_DETAIL: 'BrowserSingleVersionPerfDetail';\n-SRC_BROWSER_SINGLE_VERSION_PAGE_PATH_PERF_DETAIL: 'BrowserSingleVersionPagePathPerfDetail';\n+SRC_BROWSER_APP_PERF: 'BrowserAppPerf';\n+SRC_BROWSER_APP_PAGE_PERF: 'BrowserAppPagePerf';\n+SRC_BROWSER_APP_SINGLE_VERSION_PERF: 'BrowserAppSingleVersionPerf';\n+SRC_BROWSER_APP_ERROR_LOG: 'BrowserAppErrorLog';\n+SRC_BROWSER_APP_PAGE_ERROR_LOG: 'BrowserAppPageErrorLog';", "originalCommit": "85fde26ef710c301322f3ab27ceb8c2165e9aaee", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjM4MDQ4MA==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r376380480", "bodyText": "Remove unless OAL.", "author": "wu-sheng", "createdAt": "2020-02-07T13:08:25Z", "path": "oap-server/server-bootstrap/src/main/resources/browser_analysis.oal", "diffHunk": "@@ -16,72 +16,34 @@\n *\n */\n \n-// Browser service\n-browser_redirect_avg = from(BrowserPerfDetail.redirectTime).longAvg();\n-browser_dns_avg = from(BrowserPerfDetail.dnsTime).longAvg();\n-browser_req_avg = from(BrowserPerfDetail.reqTime).longAvg();\n-browser_dom_analysis_avg = from(BrowserPerfDetail.domAnalysisTime).longAvg();\n-browser_dom_ready_avg = from(BrowserPerfDetail.domReadyTime).longAvg();\n-browser_blank_avg = from(BrowserPerfDetail.blankTime).longAvg();\n-\n-// Multiple values including p50, p75, p90, p95, p99\n-browser_redirect_percentile = from(BrowserPerfDetail.redirectTime).percentile(10);\n-browser_dns_percentile = from(BrowserPerfDetail.dnsTime).percentile(10);\n-browser_req_percentile = from(BrowserPerfDetail.reqTime).percentile(10);\n-browser_dom_analysis_percentile = from(BrowserPerfDetail.domAnalysisTime).percentile(10);\n-browser_dom_ready_percentile = from(BrowserPerfDetail.domReadyTime).percentile(10);\n-browser_blank_percentile = from(BrowserPerfDetail.blankTime).percentile(10);\n-\n-// Browser service page\n-browser_page_pv = from(BrowserPagePathPerfDetail.count).sum();\n-browser_page_error_rate = from(BrowserPagePathPerfDetail.*).percent(status == false);\n-\n-browser_page_redirect_avg = from(BrowserPagePathPerfDetail.redirectTime).longAvg();\n-browser_page_dns_avg = from(BrowserPagePathPerfDetail.dnsTime).longAvg();\n-browser_page_req_avg = from(BrowserPagePathPerfDetail.reqTime).longAvg();\n-browser_page_dom_analysis_avg = from(BrowserPagePathPerfDetail.domAnalysisTime).longAvg();\n-browser_page_dom_ready_avg = from(BrowserPagePathPerfDetail.domReadyTime).longAvg();\n-browser_page_blank_avg = from(BrowserPagePathPerfDetail.blankTime).longAvg();\n-\n-// Multiple values including p50, p75, p90, p95, p99\n-browser_page_redirect_percentile = from(BrowserPagePathPerfDetail.redirectTime).percentile(10);\n-browser_page_dns_percentile = from(BrowserPagePathPerfDetail.dnsTime).percentile(10);\n-browser_page_req_percentile = from(BrowserPagePathPerfDetail.reqTime).percentile(10);\n-browser_page_dom_analysis_percentile = from(BrowserPagePathPerfDetail.domAnalysisTime).percentile(10);\n-browser_page_dom_ready_percentile = from(BrowserPagePathPerfDetail.domReadyTime).percentile(10);\n-browser_page_blank_percentile = from(BrowserPagePathPerfDetail.blankTime).percentile(10);\n-\n-// Browser service version\n-browser_single_version_redirect_avg = from(BrowserSingleVersionPerfDetail.redirectTime).longAvg();\n-browser_single_version_dns_avg = from(BrowserSingleVersionPerfDetail.dnsTime).longAvg();\n-browser_single_version_req_avg = from(BrowserSingleVersionPerfDetail.reqTime).longAvg();\n-browser_single_version_dom_analysis_avg = from(BrowserSingleVersionPerfDetail.domAnalysisTime).longAvg();\n-browser_single_version_dom_ready_avg = from(BrowserSingleVersionPerfDetail.domReadyTime).longAvg();\n-browser_single_version_blank_avg = from(BrowserSingleVersionPerfDetail.blankTime).longAvg();\n-\n-// Multiple values including p50, p75, p90, p95, p99\n-browser_single_version_redirect_percentile = from(BrowserSingleVersionPerfDetail.redirectTime).percentile(10);\n-browser_single_version_dns_percentile = from(BrowserSingleVersionPerfDetail.dnsTime).percentile(10);\n-browser_single_version_req_percentile = from(BrowserSingleVersionPerfDetail.reqTime).percentile(10);\n-browser_single_version_dom_analysis_percentile = from(BrowserSingleVersionPerfDetail.domAnalysisTime).percentile(10);\n-browser_single_version_dom_ready_percentile = from(BrowserSingleVersionPerfDetail.domReadyTime).percentile(10);\n-browser_single_version_blank_percentile = from(BrowserSingleVersionPerfDetail.blankTime).percentile(10);\n-\n-// Browser service version page\n-browser_single_version_page_pv = from(BrowserSingleVersionPagePathPerfDetail.count).sum();\n-browser_single_version_page_error_rate = from(BrowserSingleVersionPagePathPerfDetail.*).percent(status == false);\n-\n-browser_single_version_page_redirect_avg = from(BrowserSingleVersionPagePathPerfDetail.redirectTime).longAvg();\n-browser_single_version_page_dns_avg = from(BrowserSingleVersionPagePathPerfDetail.dnsTime).longAvg();\n-browser_single_version_page_req_avg = from(BrowserSingleVersionPagePathPerfDetail.reqTime).longAvg();\n-browser_single_version_page_dom_analysis_avg = from(BrowserSingleVersionPagePathPerfDetail.domAnalysisTime).longAvg();\n-browser_single_version_page_dom_ready_avg = from(BrowserSingleVersionPagePathPerfDetail.domReadyTime).longAvg();\n-browser_single_version_page_blank_avg = from(BrowserSingleVersionPagePathPerfDetail.blankTime).longAvg();\n-\n-// Multiple values including p50, p75, p90, p95, p99\n-browser_single_version_page_redirect_percentile = from(BrowserSingleVersionPagePathPerfDetail.redirectTime).percentile(10);\n-browser_single_version_page_dns_percentile = from(BrowserSingleVersionPagePathPerfDetail.dnsTime).percentile(10);\n-browser_single_version_page_req_percentile = from(BrowserSingleVersionPagePathPerfDetail.reqTime).percentile(10);\n-browser_single_version_page_dom_analysis_percentile = from(BrowserSingleVersionPagePathPerfDetail.domAnalysisTime).percentile(10);\n-browser_single_version_page_dom_ready_percentile = from(BrowserSingleVersionPagePathPerfDetail.domReadyTime).percentile(10);\n-browser_single_version_page_blank_percentile = from(BrowserSingleVersionPagePathPerfDetail.blankTime).percentile(10);\n\\ No newline at end of file\n+// browser app\n+browser_app_pv = from(BrowserAppPerf.count).sum();\n+// browser_app_error_sum = from(BrowserAppErrorLog.count).sum();", "originalCommit": "85fde26ef710c301322f3ab27ceb8c2165e9aaee", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjM4OTA3OA==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r376389078", "bodyText": "There is already a SourceBuilder, please don't use duplicated name.  Also, the existing one should be renamed to Trace SourceBuilder.", "author": "wu-sheng", "createdAt": "2020-02-07T13:28:53Z", "path": "oap-server/server-receiver-plugin/skywalking-browser-receiver-plugin/src/main/java/org/apache/skywalking/oap/server/recevier/browser/provider/parser/errorlog/listener/errorlog/SourceBuilder.java", "diffHunk": "@@ -0,0 +1,58 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.oap.server.recevier.browser.provider.parser.errorlog.listener.errorlog;\n+\n+import lombok.Getter;\n+import lombok.Setter;\n+import org.apache.skywalking.oap.server.core.browser.source.BrowserAppErrorLog;\n+import org.apache.skywalking.oap.server.core.browser.source.BrowserAppPageErrorLog;\n+import org.apache.skywalking.oap.server.core.browser.source.BrowserErrorCategory;\n+\n+/**\n+ * @author zhangwei\n+ */\n+@Setter\n+@Getter\n+class SourceBuilder {", "originalCommit": "8bb2a9abf02b2c8bf1510f53871298bc0dd4be35", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjM5MDgxNg==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r376390816", "bodyText": "If uniqueId == null, this seems a NPE?", "author": "wu-sheng", "createdAt": "2020-02-07T13:32:28Z", "path": "oap-server/server-receiver-plugin/skywalking-browser-receiver-plugin/src/main/java/org/apache/skywalking/oap/server/recevier/browser/provider/parser/errorlog/listener/record/BrowserErrorLogRecordListener.java", "diffHunk": "@@ -0,0 +1,106 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.oap.server.recevier.browser.provider.parser.errorlog.listener.record;\n+\n+import org.apache.skywalking.oap.server.core.CoreModule;\n+import org.apache.skywalking.oap.server.core.browser.source.BrowserErrorLog;\n+import org.apache.skywalking.oap.server.core.source.SourceReceiver;\n+import org.apache.skywalking.oap.server.library.module.ModuleManager;\n+import org.apache.skywalking.oap.server.recevier.browser.provider.BrowserServiceModuleConfig;\n+import org.apache.skywalking.oap.server.recevier.browser.provider.parser.errorlog.decorator.BrowserErrorLogCoreInfo;\n+import org.apache.skywalking.oap.server.recevier.browser.provider.parser.errorlog.decorator.BrowserErrorLogDecorator;\n+import org.apache.skywalking.oap.server.recevier.browser.provider.parser.errorlog.listener.BrowserErrorLogListener;\n+import org.apache.skywalking.oap.server.recevier.browser.provider.parser.errorlog.listener.BrowserErrorLogListenerFactory;\n+\n+/**\n+ * Process error record.\n+ *\n+ * @author zhangwei\n+ */\n+public class BrowserErrorLogRecordListener implements BrowserErrorLogListener {\n+\n+    private final SourceReceiver sourceReceiver;\n+    private final BrowserErrorLog browserErrorLog;\n+    private BrowserErrorLogRecordSampler sampler;\n+    private SAMPLE_STATUS sampleStatus = SAMPLE_STATUS.UNKNOWN;\n+\n+    private BrowserErrorLogRecordListener(ModuleManager moduleManager, BrowserErrorLogRecordSampler sampler) {\n+        sourceReceiver = moduleManager.find(CoreModule.NAME).provider().getService(SourceReceiver.class);\n+        browserErrorLog = new BrowserErrorLog();\n+        this.sampler = sampler;\n+    }\n+\n+    @Override\n+    public void build() {\n+        filter(() -> sourceReceiver.receive(browserErrorLog));\n+    }\n+\n+    @Override\n+    public void parse(BrowserErrorLogDecorator decorator, BrowserErrorLogCoreInfo coreInfo) {\n+        filter(coreInfo.getUniqueId(), () -> {\n+            browserErrorLog.setUniqueId(coreInfo.getUniqueId());\n+            browserErrorLog.setServiceId(coreInfo.getServiceId());\n+            browserErrorLog.setServiceVersionId(coreInfo.getServiceVersionId());\n+            browserErrorLog.setPagePathId(coreInfo.getPagePathId());\n+            browserErrorLog.setPagePath(decorator.getPagePath());\n+            browserErrorLog.setTime(decorator.getTime());\n+            browserErrorLog.setTimeBucket(coreInfo.getMinuteTimeBucket());\n+            browserErrorLog.setCategory(coreInfo.getCategory());\n+            browserErrorLog.setDataBinary(decorator.toByteArray());\n+        });\n+    }\n+\n+    private void filter(Runnable runnable) {\n+        filter(null, runnable);\n+    }\n+\n+    private void filter(String uniqueId, Runnable runnable) {\n+        if (sampleStatus.equals(SAMPLE_STATUS.IGNORE)) {\n+            return;\n+        }\n+        if (sampleStatus.equals(SAMPLE_STATUS.UNKNOWN)) {\n+            if (sampler.shouldSample(uniqueId.hashCode())) {", "originalCommit": "8bb2a9abf02b2c8bf1510f53871298bc0dd4be35", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjM5MDk4Nw==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r376390987", "bodyText": "Why have this? Related to the following NPE question.", "author": "wu-sheng", "createdAt": "2020-02-07T13:32:55Z", "path": "oap-server/server-receiver-plugin/skywalking-browser-receiver-plugin/src/main/java/org/apache/skywalking/oap/server/recevier/browser/provider/parser/errorlog/listener/record/BrowserErrorLogRecordListener.java", "diffHunk": "@@ -0,0 +1,106 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.oap.server.recevier.browser.provider.parser.errorlog.listener.record;\n+\n+import org.apache.skywalking.oap.server.core.CoreModule;\n+import org.apache.skywalking.oap.server.core.browser.source.BrowserErrorLog;\n+import org.apache.skywalking.oap.server.core.source.SourceReceiver;\n+import org.apache.skywalking.oap.server.library.module.ModuleManager;\n+import org.apache.skywalking.oap.server.recevier.browser.provider.BrowserServiceModuleConfig;\n+import org.apache.skywalking.oap.server.recevier.browser.provider.parser.errorlog.decorator.BrowserErrorLogCoreInfo;\n+import org.apache.skywalking.oap.server.recevier.browser.provider.parser.errorlog.decorator.BrowserErrorLogDecorator;\n+import org.apache.skywalking.oap.server.recevier.browser.provider.parser.errorlog.listener.BrowserErrorLogListener;\n+import org.apache.skywalking.oap.server.recevier.browser.provider.parser.errorlog.listener.BrowserErrorLogListenerFactory;\n+\n+/**\n+ * Process error record.\n+ *\n+ * @author zhangwei\n+ */\n+public class BrowserErrorLogRecordListener implements BrowserErrorLogListener {\n+\n+    private final SourceReceiver sourceReceiver;\n+    private final BrowserErrorLog browserErrorLog;\n+    private BrowserErrorLogRecordSampler sampler;\n+    private SAMPLE_STATUS sampleStatus = SAMPLE_STATUS.UNKNOWN;\n+\n+    private BrowserErrorLogRecordListener(ModuleManager moduleManager, BrowserErrorLogRecordSampler sampler) {\n+        sourceReceiver = moduleManager.find(CoreModule.NAME).provider().getService(SourceReceiver.class);\n+        browserErrorLog = new BrowserErrorLog();\n+        this.sampler = sampler;\n+    }\n+\n+    @Override\n+    public void build() {\n+        filter(() -> sourceReceiver.receive(browserErrorLog));\n+    }\n+\n+    @Override\n+    public void parse(BrowserErrorLogDecorator decorator, BrowserErrorLogCoreInfo coreInfo) {\n+        filter(coreInfo.getUniqueId(), () -> {\n+            browserErrorLog.setUniqueId(coreInfo.getUniqueId());\n+            browserErrorLog.setServiceId(coreInfo.getServiceId());\n+            browserErrorLog.setServiceVersionId(coreInfo.getServiceVersionId());\n+            browserErrorLog.setPagePathId(coreInfo.getPagePathId());\n+            browserErrorLog.setPagePath(decorator.getPagePath());\n+            browserErrorLog.setTime(decorator.getTime());\n+            browserErrorLog.setTimeBucket(coreInfo.getMinuteTimeBucket());\n+            browserErrorLog.setCategory(coreInfo.getCategory());\n+            browserErrorLog.setDataBinary(decorator.toByteArray());\n+        });\n+    }\n+\n+    private void filter(Runnable runnable) {\n+        filter(null, runnable);", "originalCommit": "8bb2a9abf02b2c8bf1510f53871298bc0dd4be35", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjM5NDcxMQ==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r376394711", "bodyText": "This is error traffic, not error log. You should rename to *ErrorTraffic", "author": "wu-sheng", "createdAt": "2020-02-07T13:41:12Z", "path": "oap-server/server-core/src/main/java/org/apache/skywalking/oap/server/core/browser/source/BrowserAppErrorLog.java", "diffHunk": "@@ -0,0 +1,50 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.oap.server.core.browser.source;\n+\n+import lombok.Getter;\n+import lombok.Setter;\n+import org.apache.skywalking.oap.server.core.source.ScopeDeclaration;\n+import org.apache.skywalking.oap.server.core.source.ScopeDefaultColumn;\n+import org.apache.skywalking.oap.server.core.source.Source;\n+\n+import static org.apache.skywalking.oap.server.core.source.DefaultScopeDefine.BROWSER_APP_ERROR_LOG;\n+import static org.apache.skywalking.oap.server.core.source.DefaultScopeDefine.SERVICE_CATALOG_NAME;\n+\n+/**\n+ * @author zhangwei\n+ */\n+@ScopeDeclaration(id = BROWSER_APP_ERROR_LOG, name = \"BrowserAppErrorLog\", catalog = SERVICE_CATALOG_NAME)\n+@ScopeDefaultColumn.VirtualColumnDefinition(fieldName = \"entityId\", columnName = \"entity_id\", isID = true, type = String.class)\n+public class BrowserAppErrorLog extends Source {", "originalCommit": "8bb2a9abf02b2c8bf1510f53871298bc0dd4be35", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjM5NDg3NQ==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r376394875", "bodyText": "Log -> Traffic too.", "author": "wu-sheng", "createdAt": "2020-02-07T13:41:30Z", "path": "oap-server/server-core/src/main/java/org/apache/skywalking/oap/server/core/browser/source/BrowserAppPageErrorLog.java", "diffHunk": "@@ -0,0 +1,52 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.oap.server.core.browser.source;\n+\n+import lombok.Getter;\n+import lombok.Setter;\n+import org.apache.skywalking.oap.server.core.source.ScopeDeclaration;\n+import org.apache.skywalking.oap.server.core.source.ScopeDefaultColumn;\n+import org.apache.skywalking.oap.server.core.source.Source;\n+\n+import static org.apache.skywalking.oap.server.core.source.DefaultScopeDefine.BROWSER_APP_PAGE_ERROR_LOG;\n+import static org.apache.skywalking.oap.server.core.source.DefaultScopeDefine.ENDPOINT_CATALOG_NAME;\n+\n+/**\n+ * @author zhangwei\n+ */\n+@ScopeDeclaration(id = BROWSER_APP_PAGE_ERROR_LOG, name = \"BrowserAppPageErrorLog\", catalog = ENDPOINT_CATALOG_NAME)\n+@ScopeDefaultColumn.VirtualColumnDefinition(fieldName = \"entityId\", columnName = \"entity_id\", isID = true, type = String.class)\n+public class BrowserAppPageErrorLog extends Source {", "originalCommit": "8bb2a9abf02b2c8bf1510f53871298bc0dd4be35", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjM5NTE4OQ==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r376395189", "bodyText": "Log collect service is a streaming process mode, you should support that, so this count could be > 1.", "author": "wu-sheng", "createdAt": "2020-02-07T13:42:18Z", "path": "oap-server/server-core/src/main/java/org/apache/skywalking/oap/server/core/browser/source/BrowserAppErrorLog.java", "diffHunk": "@@ -0,0 +1,50 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.oap.server.core.browser.source;\n+\n+import lombok.Getter;\n+import lombok.Setter;\n+import org.apache.skywalking.oap.server.core.source.ScopeDeclaration;\n+import org.apache.skywalking.oap.server.core.source.ScopeDefaultColumn;\n+import org.apache.skywalking.oap.server.core.source.Source;\n+\n+import static org.apache.skywalking.oap.server.core.source.DefaultScopeDefine.BROWSER_APP_ERROR_LOG;\n+import static org.apache.skywalking.oap.server.core.source.DefaultScopeDefine.SERVICE_CATALOG_NAME;\n+\n+/**\n+ * @author zhangwei\n+ */\n+@ScopeDeclaration(id = BROWSER_APP_ERROR_LOG, name = \"BrowserAppErrorLog\", catalog = SERVICE_CATALOG_NAME)\n+@ScopeDefaultColumn.VirtualColumnDefinition(fieldName = \"entityId\", columnName = \"entity_id\", isID = true, type = String.class)\n+public class BrowserAppErrorLog extends Source {\n+\n+    @Override\n+    public int scope() {\n+        return BROWSER_APP_ERROR_LOG;\n+    }\n+\n+    @Override\n+    public String getEntityId() {\n+        return String.valueOf(id);\n+    }\n+\n+    @Getter @Setter private int id;\n+    @Getter private final int count = 1;", "originalCommit": "8bb2a9abf02b2c8bf1510f53871298bc0dd4be35", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQ3MTA0MA==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r377471040", "bodyText": "Because the client calls the uncertainty of onCompleted, leave it as it is.", "author": "arugal", "createdAt": "2020-02-11T07:12:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjM5NTE4OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjM5NTM3MA==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r376395370", "bodyText": "Same as above, could be > 1", "author": "wu-sheng", "createdAt": "2020-02-07T13:42:38Z", "path": "oap-server/server-core/src/main/java/org/apache/skywalking/oap/server/core/browser/source/BrowserAppPageErrorLog.java", "diffHunk": "@@ -0,0 +1,52 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.oap.server.core.browser.source;\n+\n+import lombok.Getter;\n+import lombok.Setter;\n+import org.apache.skywalking.oap.server.core.source.ScopeDeclaration;\n+import org.apache.skywalking.oap.server.core.source.ScopeDefaultColumn;\n+import org.apache.skywalking.oap.server.core.source.Source;\n+\n+import static org.apache.skywalking.oap.server.core.source.DefaultScopeDefine.BROWSER_APP_PAGE_ERROR_LOG;\n+import static org.apache.skywalking.oap.server.core.source.DefaultScopeDefine.ENDPOINT_CATALOG_NAME;\n+\n+/**\n+ * @author zhangwei\n+ */\n+@ScopeDeclaration(id = BROWSER_APP_PAGE_ERROR_LOG, name = \"BrowserAppPageErrorLog\", catalog = ENDPOINT_CATALOG_NAME)\n+@ScopeDefaultColumn.VirtualColumnDefinition(fieldName = \"entityId\", columnName = \"entity_id\", isID = true, type = String.class)\n+public class BrowserAppPageErrorLog extends Source {\n+\n+    @Override\n+    public int scope() {\n+        return BROWSER_APP_PAGE_ERROR_LOG;\n+    }\n+\n+    @Override\n+    public String getEntityId() {\n+        return String.valueOf(id);\n+    }\n+\n+\n+    @Getter @Setter private int id;\n+    @Getter @Setter private int serviceId;\n+    @Getter private final int count = 1;", "originalCommit": "8bb2a9abf02b2c8bf1510f53871298bc0dd4be35", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTMzOTI4NA==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r379339284", "bodyText": "I think receiver-browser should be activated by default, right? Even the UI is not ready, but it should be there because this will be a part of UI when it is ready.\nChange this to Find browser-receiver setup in the backend receiver doc. as the 2nd point.", "author": "wu-sheng", "createdAt": "2020-02-14T09:52:40Z", "path": "docs/en/setup/README.md", "diffHunk": "@@ -25,6 +25,12 @@ You can go to their project repositories for additional info about guides and re\n \n - [SkyAPM GO2Sky](https://github.com/SkyAPM/go2sky). See GO2Sky project document for more details.\n \n+## Browser agent\n+\n+- Activate the [browser-receiver](backend/backend-receivers.md#browser-receiver) following the document.", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTQwNDI0Ng==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r379404246", "bodyText": "done", "author": "arugal", "createdAt": "2020-02-14T12:25:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTMzOTI4NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTM0MTAxMA==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r379341010", "bodyText": "Move this to the 1st point. And change to\nBrowser JS Client. JS client reports the browser performance data to the backend. See skywalking-client-js project document for more details.", "author": "wu-sheng", "createdAt": "2020-02-14T09:56:21Z", "path": "docs/en/setup/README.md", "diffHunk": "@@ -25,6 +25,12 @@ You can go to their project repositories for additional info about guides and re\n \n - [SkyAPM GO2Sky](https://github.com/SkyAPM/go2sky). See GO2Sky project document for more details.\n \n+## Browser agent\n+\n+- Activate the [browser-receiver](backend/backend-receivers.md#browser-receiver) following the document.\n+\n+- [Browser Js Client](https://github.com/apache/skywalking-client-js). See `skywalking-client-js` project document for more details.", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTQwNDE5OQ==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r379404199", "bodyText": "done", "author": "arugal", "createdAt": "2020-02-14T12:25:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTM0MTAxMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTM2NjU4Mw==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r379366583", "bodyText": "Add [WIP] as prefix.", "author": "wu-sheng", "createdAt": "2020-02-14T10:49:43Z", "path": "README.md", "diffHunk": "@@ -27,6 +27,7 @@ The core features are following.\n - Distributed tracing and context propagation\n - Database access metrics. Detect slow database access statements(including SQL statements).\n - Alarm\n+- Browser performance monitoring", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTM2Njc0NA==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r379366744", "bodyText": "Open as default", "author": "wu-sheng", "createdAt": "2020-02-14T10:50:06Z", "path": "dist-material/application.yml", "diffHunk": "@@ -151,6 +151,17 @@ receiver-jvm:\n   default:\n receiver-clr:\n   default:\n+#receiver-browser:", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTQwNDExNQ==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r379404115", "bodyText": "done", "author": "arugal", "createdAt": "2020-02-14T12:25:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTM2Njc0NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTM2ODkyMQ==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r379368921", "bodyText": "Where is the error rate you asked before?", "author": "wu-sheng", "createdAt": "2020-02-14T10:54:50Z", "path": "oap-server/server-bootstrap/src/main/resources/browser_analysis.oal", "diffHunk": "@@ -0,0 +1,49 @@\n+/*\n+* Licensed to the Apache Software Foundation (ASF) under one or more\n+* contributor license agreements.  See the NOTICE file distributed with\n+* this work for additional information regarding copyright ownership.\n+* The ASF licenses this file to You under the Apache License, Version 2.0\n+* (the \"License\"); you may not use this file except in compliance with\n+* the License.  You may obtain a copy of the License at\n+*\n+*     http://www.apache.org/licenses/LICENSE-2.0\n+*\n+* Unless required by applicable law or agreed to in writing, software\n+* distributed under the License is distributed on an \"AS IS\" BASIS,\n+* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+* See the License for the specific language governing permissions and\n+* limitations under the License.\n+*\n+*/\n+\n+// browser app\n+browser_app_pv = from(BrowserAppPerf.count).sum();\n+browser_app_error_sum = from(BrowserAppErrorTraffic.count).sum();", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTQwNDA5Mw==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r379404093", "bodyText": "done", "author": "arugal", "createdAt": "2020-02-14T12:25:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTM2ODkyMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTM2OTU4OA==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r379369588", "bodyText": "As a record type, this should be in the disable oal too. Make sense?", "author": "wu-sheng", "createdAt": "2020-02-14T10:56:19Z", "path": "oap-server/server-core/src/main/java/org/apache/skywalking/oap/server/core/browser/manual/BrowserErrorTrafficRecord.java", "diffHunk": "@@ -0,0 +1,129 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.oap.server.core.browser.manual;\n+\n+import lombok.Getter;\n+import lombok.Setter;\n+import org.apache.skywalking.apm.util.StringUtil;\n+import org.apache.skywalking.oap.server.core.Const;\n+import org.apache.skywalking.oap.server.core.analysis.Stream;\n+import org.apache.skywalking.oap.server.core.analysis.record.Record;\n+import org.apache.skywalking.oap.server.core.analysis.worker.RecordStreamProcessor;\n+import org.apache.skywalking.oap.server.core.source.DefaultScopeDefine;\n+import org.apache.skywalking.oap.server.core.storage.StorageBuilder;\n+import org.apache.skywalking.oap.server.core.storage.annotation.Column;\n+import org.apache.skywalking.oap.server.library.util.CollectionUtils;\n+\n+import java.util.Base64;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+@Stream(name = BrowserErrorTrafficRecord.INDEX_NAME, scopeId = DefaultScopeDefine.BROWSER_ERROR_TRAFFIC, builder = BrowserErrorTrafficRecord.Builder.class, processor = RecordStreamProcessor.class)\n+public class BrowserErrorTrafficRecord extends Record {", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTQwMzk5OA==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r379403998", "bodyText": "done", "author": "arugal", "createdAt": "2020-02-14T12:25:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTM2OTU4OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTQwNzAxOQ==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r379407019", "bodyText": "This requires the antlr change.  browser_error_traffic should be a source.", "author": "wu-sheng", "createdAt": "2020-02-14T12:33:02Z", "path": "oap-server/server-bootstrap/src/main/resources/browser_analysis.oal", "diffHunk": "@@ -0,0 +1,56 @@\n+/*\n+* Licensed to the Apache Software Foundation (ASF) under one or more\n+* contributor license agreements.  See the NOTICE file distributed with\n+* this work for additional information regarding copyright ownership.\n+* The ASF licenses this file to You under the Apache License, Version 2.0\n+* (the \"License\"); you may not use this file except in compliance with\n+* the License.  You may obtain a copy of the License at\n+*\n+*     http://www.apache.org/licenses/LICENSE-2.0\n+*\n+* Unless required by applicable law or agreed to in writing, software\n+* distributed under the License is distributed on an \"AS IS\" BASIS,\n+* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+* See the License for the specific language governing permissions and\n+* limitations under the License.\n+*\n+*/\n+\n+// browser app\n+browser_app_pv = from(BrowserAppPerf.count).sum();\n+browser_app_error_rate = from(BrowserAppPerf.*).percent(status == false)\n+browser_app_error_sum = from(BrowserAppErrorTraffic.count).sum();\n+\n+// browser app single version\n+browser_app_single_version_pv = from(BrowserAppSingleVersionPerf.count).sum();\n+browser_app_single_version_error_rate = from(BrowserAppSingleVersionPerf.*).percent(status == false)\n+\n+// browser app page\n+browser_app_page_pv = from(BrowserAppPagePerf.count).sum();\n+browser_app_page_error_rate = from(BrowserAppPagePerf.*).percent(status == false)\n+browser_app_page_error_sum = from(BrowserAppPageErrorTraffic.count).sum();\n+\n+browser_app_page_ajax_error_sum = from(BrowserAppPageErrorTraffic.count).filter(category == BrowserErrorCategory.AJAX).sum();\n+browsre_app_page_resource_error_sum = from(BrowserAppPageErrorTraffic.count).filter(category == BrowserErrorCategory.RESOURCE).sum();\n+browsre_app_page_vue_error_sum = from(BrowserAppPageErrorTraffic.count).filter(category == BrowserErrorCategory.VUE).sum();\n+browsre_app_page_promise_error_sum = from(BrowserAppPageErrorTraffic.count).filter(category == BrowserErrorCategory.PROMISE).sum();\n+browser_app_page_js_error_sum = from(BrowserAppPageErrorTraffic.count).filter(category == BrowserErrorCategory.JS).sum();\n+browser_app_page_unknown_error_sum = from(BrowserAppPageErrorTraffic.count).filter(category == BrowserErrorCategory.UNKNOWN).sum();\n+\n+browser_app_page_redirect_avg = from(BrowserAppPagePerf.redirectTime).longAvg();\n+browser_app_page_dns_avg = from(BrowserAppPagePerf.dnsTime).longAvg();\n+browser_app_page_req_avg = from(BrowserAppPagePerf.reqTime).longAvg();\n+browser_app_page_dom_analysis_avg = from(BrowserAppPagePerf.domAnalysisTime).longAvg();\n+browser_app_page_dom_ready_avg = from(BrowserAppPagePerf.domReadyTime).longAvg();\n+browser_app_page_blank_avg = from(BrowserAppPagePerf.blankTime).longAvg();\n+\n+browser_app_page_redirect_percentile = from(BrowserAppPagePerf.redirectTime).percentile(10);\n+browser_app_page_dns_percentile = from(BrowserAppPagePerf.dnsTime).percentile(10);\n+browser_app_page_req_percentile = from(BrowserAppPagePerf.reqTime).percentile(10);\n+browser_app_page_dom_analysis_percentile = from(BrowserAppPagePerf.domAnalysisTime).percentile(10);\n+browser_app_page_dom_ready_percentile = from(BrowserAppPagePerf.domReadyTime).percentile(10);\n+browser_app_page_blank_percentile = from(BrowserAppPagePerf.blankTime).percentile(10);\n+\n+// Disable unnecessary hard core stream, targeting @Stream#name\n+/////////\n+// disable(browser_error_traffic)", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTQxMjUxNA==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r379412514", "bodyText": "Just for confirmation, is this source forwarding to OAL and manual record entity at the same time?", "author": "wu-sheng", "createdAt": "2020-02-14T12:46:33Z", "path": "oap-server/server-core/src/main/java/org/apache/skywalking/oap/server/core/browser/source/BrowserAppErrorTraffic.java", "diffHunk": "@@ -0,0 +1,52 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.oap.server.core.browser.source;\n+\n+import lombok.Getter;\n+import lombok.Setter;\n+import org.apache.skywalking.oap.server.core.source.ScopeDeclaration;\n+import org.apache.skywalking.oap.server.core.source.ScopeDefaultColumn;\n+import org.apache.skywalking.oap.server.core.source.Source;\n+\n+import static org.apache.skywalking.oap.server.core.source.DefaultScopeDefine.BROWSER_APP_ERROR_TRAFFIC;\n+import static org.apache.skywalking.oap.server.core.source.DefaultScopeDefine.SERVICE_CATALOG_NAME;\n+\n+@ScopeDeclaration(id = BROWSER_APP_ERROR_TRAFFIC, name = \"BrowserAppErrorTraffic\", catalog = SERVICE_CATALOG_NAME)\n+@ScopeDefaultColumn.VirtualColumnDefinition(fieldName = \"entityId\", columnName = \"entity_id\", isID = true, type = String.class)\n+public class BrowserAppErrorTraffic extends Source {", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTgyODQ5OA==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r379828498", "bodyText": "Only to OAL, record entity is generated by BrowserErrorTraffic.", "author": "arugal", "createdAt": "2020-02-15T12:23:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTQxMjUxNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTQxMzQ1Mg==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r379413452", "bodyText": "Comments for the interface and all implementations are required.", "author": "wu-sheng", "createdAt": "2020-02-14T12:49:01Z", "path": "oap-server/server-receiver-plugin/skywalking-browser-receiver-plugin/src/main/java/org/apache/skywalking/oap/server/recevier/browser/provider/parser/errorlog/listener/BrowserErrorLogListener.java", "diffHunk": "@@ -0,0 +1,30 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.oap.server.recevier.browser.provider.parser.errorlog.listener;\n+\n+import org.apache.skywalking.oap.server.recevier.browser.provider.parser.errorlog.decorator.BrowserErrorLogCoreInfo;\n+import org.apache.skywalking.oap.server.recevier.browser.provider.parser.errorlog.decorator.BrowserErrorLogDecorator;\n+\n+public interface BrowserErrorLogListener {", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTQxMzYyMQ==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r379413621", "bodyText": "Comments are required.", "author": "wu-sheng", "createdAt": "2020-02-14T12:49:29Z", "path": "oap-server/server-receiver-plugin/skywalking-browser-receiver-plugin/src/main/java/org/apache/skywalking/oap/server/recevier/browser/provider/parser/errorlog/BrowserErrorLogParser.java", "diffHunk": "@@ -0,0 +1,197 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.oap.server.recevier.browser.provider.parser.errorlog;\n+\n+import lombok.Setter;\n+import lombok.extern.slf4j.Slf4j;\n+import org.apache.skywalking.apm.network.language.agent.BrowserErrorLog;\n+import org.apache.skywalking.oap.server.core.Const;\n+import org.apache.skywalking.oap.server.core.CoreModule;\n+import org.apache.skywalking.oap.server.core.analysis.TimeBucket;\n+import org.apache.skywalking.oap.server.core.cache.ServiceInstanceInventoryCache;\n+import org.apache.skywalking.oap.server.library.buffer.BufferData;\n+import org.apache.skywalking.oap.server.library.buffer.DataStreamReader;\n+import org.apache.skywalking.oap.server.library.module.ModuleManager;\n+import org.apache.skywalking.oap.server.recevier.browser.provider.BrowserServiceModuleConfig;\n+import org.apache.skywalking.oap.server.recevier.browser.provider.parser.BrowserDataSource;\n+import org.apache.skywalking.oap.server.recevier.browser.provider.parser.errorlog.decorator.BrowserErrorLogCoreInfo;\n+import org.apache.skywalking.oap.server.recevier.browser.provider.parser.errorlog.decorator.BrowserErrorLogDecorator;\n+import org.apache.skywalking.oap.server.recevier.browser.provider.parser.errorlog.listener.BrowserErrorLogListener;\n+import org.apache.skywalking.oap.server.recevier.browser.provider.parser.errorlog.standardization.BrowserErrorLogStandardization;\n+import org.apache.skywalking.oap.server.recevier.browser.provider.parser.errorlog.standardization.BrowserErrorLogStandardizationWorker;\n+import org.apache.skywalking.oap.server.recevier.browser.provider.parser.errorlog.standardization.PagePathIdExchanger;\n+import org.apache.skywalking.oap.server.telemetry.TelemetryModule;\n+import org.apache.skywalking.oap.server.telemetry.api.CounterMetrics;\n+import org.apache.skywalking.oap.server.telemetry.api.MetricsCreator;\n+import org.apache.skywalking.oap.server.telemetry.api.MetricsTag;\n+\n+import java.util.LinkedList;\n+import java.util.List;\n+\n+@Slf4j\n+public class BrowserErrorLogParser {", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTQxNjA3MQ==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r379416071", "bodyText": "Why use UTC TZ specifically? Could you explain?", "author": "wu-sheng", "createdAt": "2020-02-14T12:55:50Z", "path": "test/e2e/e2e-base/src/main/java/org/apache/skywalking/e2e/metrics/MetricsMatcher.java", "diffHunk": "@@ -64,15 +72,23 @@ public static void verifyMetrics(SimpleQueryClient queryClient, String metricNam\n     }\n \n     public static void verifyPercentileMetrics(SimpleQueryClient queryClient, String metricName, String id,\n-        final LocalDateTime minutesAgo, long retryInterval, Runnable generateTraffic) throws Exception {\n+                                               final LocalDateTime minutesAgo, long retryInterval, Runnable generateTraffic) throws Exception {\n+        verifyPercentileMetrics(queryClient, metricName, id, minutesAgo, LocalDateTime.now(ZoneOffset.UTC).plusMinutes(1), retryInterval, generateTraffic);", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTQzNTI0Mw==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r379435243", "bodyText": "Before that was the UTC TZ, I just overload verifyMetrics.", "author": "arugal", "createdAt": "2020-02-14T13:42:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTQxNjA3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTQzNjY2NA==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r379436664", "bodyText": "Why change it? Please give me more details?", "author": "wu-sheng", "createdAt": "2020-02-14T13:45:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTQxNjA3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTUwOTgzMQ==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r379509831", "bodyText": "Convenient debug, set end time according to local TZ.", "author": "arugal", "createdAt": "2020-02-14T15:59:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTQxNjA3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTUxNDExOQ==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r379514119", "bodyText": "My point is, if you want to change, why don't change the existing method? Instead, you add a new method.", "author": "wu-sheng", "createdAt": "2020-02-14T16:07:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTQxNjA3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTcxNTk1NQ==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r379715955", "bodyText": "I get it.", "author": "arugal", "createdAt": "2020-02-15T04:08:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTQxNjA3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTgyNzM2OA==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r379827368", "bodyText": "Has been rollback.", "author": "arugal", "createdAt": "2020-02-15T11:59:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTQxNjA3MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTQxNjU1OQ==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r379416559", "bodyText": "Storage should be based on backend storage settings, why test case cares about this? Especially, there is nothing different with BrowserPerfITCase", "author": "wu-sheng", "createdAt": "2020-02-14T12:57:13Z", "path": "test/e2e/e2e-browser/e2e-browser-es/src/test/java/org/apache/skywalking/e2e/ESWithBrowserPerfITCase.java", "diffHunk": "@@ -0,0 +1,26 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.skywalking.e2e;\n+\n+import lombok.extern.slf4j.Slf4j;\n+import org.apache.skywalking.e2e.browser.BrowserPerfITCase;\n+\n+@Slf4j\n+public class ESWithBrowserPerfITCase extends BrowserPerfITCase {", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTgyNzE3Ng==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r379827176", "bodyText": "done", "author": "arugal", "createdAt": "2020-02-15T11:55:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTQxNjU1OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTQyMDAyNQ==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r379420025", "bodyText": "Please add the tests for different storage. And browser e2e tests should be in an separated e2e-browser-perf.yaml file.", "author": "wu-sheng", "createdAt": "2020-02-14T13:05:58Z", "path": ".github/workflows/e2e.yaml", "diffHunk": "@@ -118,3 +118,19 @@ jobs:\n         run: export E2E_VERSION=jdk8-1.3 && bash -x test/e2e/run.sh e2e-profile/e2e-profile-test-runner --storage=elasticsearch\n       - name: Profile Tests ES7(JDK8)\n         run: export E2E_VERSION=jdk8-1.3 DIST_PACKAGE=apache-skywalking-apm-bin-es7.tar.gz ES_VERSION=7.4.2 && bash -x test/e2e/run.sh e2e-profile/e2e-profile-test-runner --storage=elasticsearch\n+        \n+  Browser:\n+    runs-on: ubuntu-latest\n+    steps:\n+      - uses: actions/checkout@v1\n+        with:\n+          submodules: true\n+      - name: Set environment\n+        run: export MAVEN_OPTS='-Dmaven.repo.local=~/.m2/repository -XX:+TieredCompilation -XX:TieredStopAtLevel=1 -XX:+CMSClassUnloadingEnabled -XX:+UseConcMarkSweepGC -XX:-UseGCOverheadLimit -Xmx3g'\n+      - name: Compile & Install Test Codes\n+        run: |\n+          ./mvnw checkstyle:check apache-rat:check\n+          ./mvnw -Dcheckstyle.skip -Drat.skip -T2 -Dmaven.compile.fork -Dmaven.compiler.maxmem=3072 -DskipTests clean install\n+          ./mvnw -f test/e2e/pom.xml -pl e2e-base clean install\n+      - name: Browser Tests ES6(JDK8)\n+        run: export E2E_VERSION=jdk8-1.3 && bash -x test/e2e/run.sh e2e-browser/e2e-browser-es", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTgyNzE2Nw==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r379827167", "bodyText": "done", "author": "arugal", "createdAt": "2020-02-15T11:55:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTQyMDAyNQ=="}], "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTEzNDcwMQ==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r395134701", "bodyText": "Based on the tests, you don't need this", "author": "kezhenxu94", "createdAt": "2020-03-19T15:56:43Z", "path": "test/e2e/e2e-test/src/test/java/org/apache/skywalking/e2e/browser/BrowserE2E.java", "diffHunk": "@@ -0,0 +1,352 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.e2e.browser;\n+\n+import io.grpc.ManagedChannel;\n+import io.grpc.internal.DnsNameResolverProvider;\n+import io.grpc.netty.NettyChannelBuilder;\n+import io.grpc.stub.StreamObserver;\n+import lombok.extern.slf4j.Slf4j;\n+import org.apache.skywalking.apm.network.common.Commands;\n+import org.apache.skywalking.apm.network.common.KeyIntValuePair;\n+import org.apache.skywalking.apm.network.common.ServiceType;\n+import org.apache.skywalking.apm.network.language.agent.BrowserErrorLog;\n+import org.apache.skywalking.apm.network.language.agent.BrowserPerfData;\n+import org.apache.skywalking.apm.network.language.agent.BrowserPerfServiceGrpc;\n+import org.apache.skywalking.apm.network.language.agent.ErrorCategory;\n+import org.apache.skywalking.apm.network.register.v2.RegisterGrpc;\n+import org.apache.skywalking.apm.network.register.v2.ServiceInstance;\n+import org.apache.skywalking.apm.network.register.v2.ServiceInstanceRegisterMapping;\n+import org.apache.skywalking.apm.network.register.v2.ServiceInstances;\n+import org.apache.skywalking.apm.network.register.v2.ServiceRegisterMapping;\n+import org.apache.skywalking.apm.network.register.v2.Services;\n+import org.apache.skywalking.e2e.annotation.ContainerHostAndPort;\n+import org.apache.skywalking.e2e.annotation.DockerCompose;\n+import org.apache.skywalking.e2e.annotation.DockerContainer;\n+import org.apache.skywalking.e2e.base.SkyWalkingE2E;\n+import org.apache.skywalking.e2e.base.SkyWalkingTestAdapter;\n+import org.apache.skywalking.e2e.base.TrafficController;\n+import org.apache.skywalking.e2e.common.HostAndPort;\n+import org.apache.skywalking.e2e.retryable.RetryableTest;\n+import org.apache.skywalking.e2e.service.Service;\n+import org.apache.skywalking.e2e.service.ServicesMatcher;\n+import org.apache.skywalking.e2e.service.ServicesQuery;\n+import org.apache.skywalking.e2e.service.endpoint.Endpoint;\n+import org.apache.skywalking.e2e.service.endpoint.EndpointQuery;\n+import org.apache.skywalking.e2e.service.endpoint.Endpoints;\n+import org.apache.skywalking.e2e.service.endpoint.EndpointsMatcher;\n+import org.apache.skywalking.e2e.service.instance.Instance;\n+import org.apache.skywalking.e2e.service.instance.Instances;\n+import org.apache.skywalking.e2e.service.instance.InstancesMatcher;\n+import org.apache.skywalking.e2e.service.instance.InstancesQuery;\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.MethodOrderer;\n+import org.junit.jupiter.api.TestMethodOrder;\n+import org.testcontainers.containers.ContainerState;\n+import org.testcontainers.containers.DockerComposeContainer;\n+\n+import java.util.List;\n+import java.util.UUID;\n+import java.util.concurrent.CountDownLatch;\n+\n+import static java.util.Objects.nonNull;\n+import static org.apache.skywalking.e2e.metrics.BrowserMetricsQuery.ALL_BROWSER_METRICS;\n+import static org.apache.skywalking.e2e.metrics.BrowserMetricsQuery.ALL_BROWSER_PAGE_METRICS;\n+import static org.apache.skywalking.e2e.metrics.BrowserMetricsQuery.ALL_BROWSER_PAGE_MULTIPLE_LINEAR_METRICS;\n+import static org.apache.skywalking.e2e.metrics.BrowserMetricsQuery.ALL_BROWSER_SINGLE_VERSION_METRICS;\n+import static org.apache.skywalking.e2e.metrics.MetricsMatcher.verifyMetrics;\n+import static org.apache.skywalking.e2e.metrics.MetricsMatcher.verifyPercentileMetrics;\n+import static org.apache.skywalking.e2e.utils.Times.now;\n+import static org.apache.skywalking.e2e.utils.Yamls.load;\n+\n+@Slf4j\n+@SkyWalkingE2E\n+@TestMethodOrder(MethodOrderer.OrderAnnotation.class)", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTEzNjU4NA==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r395136584", "bodyText": "revert these, and format the ones in BrowserE2E", "author": "kezhenxu94", "createdAt": "2020-03-19T15:59:09Z", "path": "test/e2e/e2e-test/src/test/java/org/apache/skywalking/e2e/ClusterE2E.java", "diffHunk": "@@ -122,18 +123,18 @@ void topology() throws Exception {\n         verifyServiceRelationMetrics(topology.getCalls());\n \n         final String clientId = topology.getNodes()\n-                                        .stream()\n-                                        .filter(n -> n.getName().equals(providerName))\n-                                        .findFirst()\n-                                        .orElseThrow(NullPointerException::new)\n-                                        .getId();\n+            .stream()\n+            .filter(n -> n.getName().equals(providerName))\n+            .findFirst()\n+            .orElseThrow(NullPointerException::new)\n+            .getId();", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTY0MzcwMg==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r395643702", "bodyText": "done", "author": "arugal", "createdAt": "2020-03-20T13:42:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTEzNjU4NA=="}], "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTY2MjcwMQ==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r395662701", "bodyText": "this should be a test case too, verifying that registering works, and order the cases, place this at the 1st, and the others that depend on this after that, as for ordering cases, refer to AgentRebootE2E", "author": "kezhenxu94", "createdAt": "2020-03-20T14:12:31Z", "path": "test/e2e/e2e-test/src/test/java/org/apache/skywalking/e2e/browser/BrowserE2E.java", "diffHunk": "@@ -0,0 +1,353 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.e2e.browser;\n+\n+import io.grpc.ManagedChannel;\n+import io.grpc.internal.DnsNameResolverProvider;\n+import io.grpc.netty.NettyChannelBuilder;\n+import io.grpc.stub.StreamObserver;\n+import java.util.List;\n+import java.util.UUID;\n+import java.util.concurrent.CountDownLatch;\n+import lombok.extern.slf4j.Slf4j;\n+import org.apache.skywalking.apm.network.common.Commands;\n+import org.apache.skywalking.apm.network.common.KeyIntValuePair;\n+import org.apache.skywalking.apm.network.common.ServiceType;\n+import org.apache.skywalking.apm.network.language.agent.BrowserErrorLog;\n+import org.apache.skywalking.apm.network.language.agent.BrowserPerfData;\n+import org.apache.skywalking.apm.network.language.agent.BrowserPerfServiceGrpc;\n+import org.apache.skywalking.apm.network.language.agent.ErrorCategory;\n+import org.apache.skywalking.apm.network.register.v2.RegisterGrpc;\n+import org.apache.skywalking.apm.network.register.v2.ServiceInstance;\n+import org.apache.skywalking.apm.network.register.v2.ServiceInstanceRegisterMapping;\n+import org.apache.skywalking.apm.network.register.v2.ServiceInstances;\n+import org.apache.skywalking.apm.network.register.v2.ServiceRegisterMapping;\n+import org.apache.skywalking.apm.network.register.v2.Services;\n+import org.apache.skywalking.e2e.annotation.ContainerHostAndPort;\n+import org.apache.skywalking.e2e.annotation.DockerCompose;\n+import org.apache.skywalking.e2e.annotation.DockerContainer;\n+import org.apache.skywalking.e2e.base.SkyWalkingE2E;\n+import org.apache.skywalking.e2e.base.SkyWalkingTestAdapter;\n+import org.apache.skywalking.e2e.base.TrafficController;\n+import org.apache.skywalking.e2e.common.HostAndPort;\n+import org.apache.skywalking.e2e.retryable.RetryableTest;\n+import org.apache.skywalking.e2e.service.Service;\n+import org.apache.skywalking.e2e.service.ServicesMatcher;\n+import org.apache.skywalking.e2e.service.ServicesQuery;\n+import org.apache.skywalking.e2e.service.endpoint.Endpoint;\n+import org.apache.skywalking.e2e.service.endpoint.EndpointQuery;\n+import org.apache.skywalking.e2e.service.endpoint.Endpoints;\n+import org.apache.skywalking.e2e.service.endpoint.EndpointsMatcher;\n+import org.apache.skywalking.e2e.service.instance.Instance;\n+import org.apache.skywalking.e2e.service.instance.Instances;\n+import org.apache.skywalking.e2e.service.instance.InstancesMatcher;\n+import org.apache.skywalking.e2e.service.instance.InstancesQuery;\n+import org.junit.jupiter.api.BeforeAll;\n+import org.testcontainers.containers.ContainerState;\n+import org.testcontainers.containers.DockerComposeContainer;\n+\n+import static java.util.Objects.nonNull;\n+import static org.apache.skywalking.e2e.metrics.BrowserMetricsQuery.ALL_BROWSER_METRICS;\n+import static org.apache.skywalking.e2e.metrics.BrowserMetricsQuery.ALL_BROWSER_PAGE_METRICS;\n+import static org.apache.skywalking.e2e.metrics.BrowserMetricsQuery.ALL_BROWSER_PAGE_MULTIPLE_LINEAR_METRICS;\n+import static org.apache.skywalking.e2e.metrics.BrowserMetricsQuery.ALL_BROWSER_SINGLE_VERSION_METRICS;\n+import static org.apache.skywalking.e2e.metrics.MetricsMatcher.verifyMetrics;\n+import static org.apache.skywalking.e2e.metrics.MetricsMatcher.verifyPercentileMetrics;\n+import static org.apache.skywalking.e2e.utils.Times.now;\n+import static org.apache.skywalking.e2e.utils.Yamls.load;\n+\n+@Slf4j\n+@SkyWalkingE2E\n+public class BrowserE2E extends SkyWalkingTestAdapter {\n+\n+    private static final int MAX_INBOUND_MESSAGE_SIZE = 1024 * 1024 * 50;\n+\n+    private static final String BROWSER_NAME = \"e2e\";\n+\n+    private static final String BROWSER_SINGLE_VERSION_NAME = \"v1.0.0\";\n+\n+    @SuppressWarnings(\"unused\")\n+    @DockerCompose({\n+        \"docker/browser/docker-compose.${SW_STORAGE}.yml\",\n+    })\n+    protected DockerComposeContainer<?> compose;\n+\n+    @SuppressWarnings(\"unused\")\n+    @ContainerHostAndPort(name = \"ui\", port = 8080)\n+    private HostAndPort swWebappHostPort;\n+\n+    @SuppressWarnings(\"unused\")\n+    @ContainerHostAndPort(name = \"oap\", port = 11800)\n+    private HostAndPort oapHostPort;\n+\n+    @SuppressWarnings(\"unused\")\n+    @DockerContainer(\"oap\")\n+    private ContainerState oapContainer;\n+\n+    private RegisterGrpc.RegisterBlockingStub registerStub;\n+\n+    private BrowserPerfServiceGrpc.BrowserPerfServiceStub browserPerfServiceStub;\n+\n+    private volatile int browserId;\n+\n+    private volatile int browserSingleVersionId;\n+\n+    @BeforeAll\n+    public void setUp() {\n+        queryClient(swWebappHostPort);\n+\n+        final ManagedChannel channel =\n+            NettyChannelBuilder.forAddress(oapHostPort.host(), oapHostPort.port())\n+                               .nameResolverFactory(new DnsNameResolverProvider())\n+                               .maxInboundMessageSize(MAX_INBOUND_MESSAGE_SIZE)\n+                               .usePlaintext()\n+                               .build();\n+\n+        registerStub = RegisterGrpc.newBlockingStub(channel);\n+        browserPerfServiceStub = BrowserPerfServiceGrpc.newStub(channel);\n+\n+        register();\n+        generateTraffic();\n+    }\n+\n+    @RetryableTest\n+    void verify() throws Exception {\n+        final List<Service> services = graphql.browserServices(new ServicesQuery().start(startTime).end(now()));\n+        LOGGER.info(\"services: {}\", services);\n+\n+        load(\"expected/browser/services.yml\")\n+            .as(ServicesMatcher.class).verify(services);\n+\n+        for (Service service : services) {\n+            LOGGER.info(\"verifying service version: {}\", service);\n+            // service metrics\n+            verifyBrowserMetrics(service);\n+\n+            // service version\n+            verifyBrowserSingleVersion(service);\n+\n+            // service page path\n+            verifyBrowserPagePath(service);\n+        }\n+    }\n+\n+    private void verifyBrowserMetrics(final Service service) throws Exception {\n+        for (String metricName : ALL_BROWSER_METRICS) {\n+            verifyMetrics(graphql, metricName, service.getKey(), startTime);\n+        }\n+    }\n+\n+    private Instances verifyBrowserSingleVersion(final Service service) throws Exception {\n+        Instances instances = graphql.instances(\n+            new InstancesQuery().serviceId(service.getKey()).start(startTime).end(now())\n+        );\n+        LOGGER.info(\"instances: {}\", instances);\n+        load(\"expected/browser/version.yml\").as(InstancesMatcher.class).verify(instances);\n+        // service version metrics\n+        for (Instance instance : instances.getInstances()) {\n+            verifyBrowserSingleVersionMetrics(instance);\n+        }\n+        return instances;\n+    }\n+\n+    private void verifyBrowserSingleVersionMetrics(Instance instance) throws Exception {\n+        for (String metricName : ALL_BROWSER_SINGLE_VERSION_METRICS) {\n+            verifyMetrics(graphql, metricName, instance.getKey(), startTime);\n+        }\n+    }\n+\n+    private Endpoints verifyBrowserPagePath(final Service service) throws Exception {\n+        Endpoints endpoints = graphql.endpoints(new EndpointQuery().serviceId(String.valueOf(service.getKey())));\n+        LOGGER.info(\"endpoints: {}\", endpoints);\n+        load(\"expected/browser/pagePath.yml\").as(EndpointsMatcher.class).verify(endpoints);\n+        // service page metrics\n+        for (Endpoint endpoint : endpoints.getEndpoints()) {\n+            verifyBrowserPagePathMetrics(endpoint);\n+        }\n+        return endpoints;\n+    }\n+\n+    private void verifyBrowserPagePathMetrics(Endpoint endpoint) throws Exception {\n+        for (String metricName : ALL_BROWSER_PAGE_METRICS) {\n+            verifyMetrics(graphql, metricName, endpoint.getKey(), startTime);\n+        }\n+\n+        for (String metricName : ALL_BROWSER_PAGE_MULTIPLE_LINEAR_METRICS) {\n+            verifyPercentileMetrics(graphql, metricName, endpoint.getKey(), startTime);\n+        }\n+    }\n+\n+    private void generateTraffic() {\n+        trafficController = TrafficController.builder()\n+                                             .sender(this::sendBrowserData)\n+                                             .build()\n+                                             .start();\n+    }\n+\n+    private boolean sendBrowserData() {\n+        try {\n+            BrowserPerfData.Builder perfBuilder = BrowserPerfData.newBuilder()\n+                                                                 .setServiceId(browserId)\n+                                                                 .setServiceVersionId(browserSingleVersionId)\n+                                                                 .setPagePath(\"/e2e-browser\")\n+                                                                 .setRedirectTime(10)\n+                                                                 .setDnsTime(10)\n+                                                                 .setReqTime(10)\n+                                                                 .setDomAnalysisTime(10)\n+                                                                 .setDomReadyTime(10)\n+                                                                 .setBlankTime(10);\n+            sendBrowserPerfData(perfBuilder.build());\n+\n+            for (ErrorCategory category : ErrorCategory.values()) {\n+                if (category == ErrorCategory.UNRECOGNIZED) {\n+                    continue;\n+                }\n+                BrowserErrorLog.Builder errorLogBuilder = BrowserErrorLog.newBuilder()\n+                                                                         .setUniqueId(UUID.randomUUID().toString())\n+                                                                         .setServiceId(browserId)\n+                                                                         .setServiceVersionId(browserSingleVersionId)\n+                                                                         .setPagePath(\"/e2e-browser\")\n+                                                                         .setCategory(category)\n+                                                                         .setMessage(\"test\")\n+                                                                         .setLine(1)\n+                                                                         .setCol(1)\n+                                                                         .setStack(\"e2e\")\n+                                                                         .setErrorUrl(\"/e2e/browser\");\n+                if (category == ErrorCategory.js) {\n+                    errorLogBuilder.setFirstReportedError(true);\n+                }\n+                sendBrowserErrorLog(errorLogBuilder.build());\n+            }\n+            return true;\n+        } catch (Throwable e) {\n+            LOGGER.warn(e.getMessage(), e);\n+            return false;\n+        }\n+    }\n+\n+    private void sendBrowserPerfData(BrowserPerfData browserPerfData) throws InterruptedException {\n+        final CountDownLatch latch = new CountDownLatch(1);\n+\n+        browserPerfServiceStub.collectPerfData(browserPerfData, new StreamObserver<Commands>() {\n+            @Override\n+            public void onNext(Commands commands) {\n+\n+            }\n+\n+            @Override\n+            public void onError(Throwable throwable) {\n+                throwable.printStackTrace();\n+                latch.countDown();\n+            }\n+\n+            @Override\n+            public void onCompleted() {\n+                latch.countDown();\n+            }\n+        });\n+        latch.await();\n+    }\n+\n+    private void sendBrowserErrorLog(BrowserErrorLog browserErrorLog) throws InterruptedException {\n+        final CountDownLatch latch = new CountDownLatch(1);\n+\n+        StreamObserver<BrowserErrorLog> collectStream = browserPerfServiceStub.collectErrorLogs(\n+            new StreamObserver<Commands>() {\n+                @Override\n+                public void onNext(Commands commands) {\n+\n+                }\n+\n+                @Override\n+                public void onError(Throwable throwable) {\n+                    throwable.printStackTrace();\n+                    latch.countDown();\n+                }\n+\n+                @Override\n+                public void onCompleted() {\n+                    latch.countDown();\n+                }\n+            });\n+        collectStream.onNext(browserErrorLog);\n+        collectStream.onCompleted();\n+        latch.await();\n+    }\n+\n+    private void register() {\n+        int retryIndex = 0;\n+        while (browserId == 0 || browserSingleVersionId == 0) {\n+            try {\n+                if (browserId == 0) {\n+                    browserId = registerBrowser();\n+                }\n+                if (browserId > 0) {\n+                    browserSingleVersionId = registerBrowserSingleVersion(browserId);\n+                }\n+                if (browserId > 0 && browserSingleVersionId > 0) {\n+                    break;\n+                }\n+            } catch (Throwable e) {\n+                if (++retryIndex % 5 == 0) {\n+                    LOGGER.error(e.getMessage(), e);\n+                }\n+            }\n+            try {\n+                Thread.sleep(1000);\n+            } catch (InterruptedException e) {\n+                // ignore\n+            }\n+        }\n+    }", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTk1Mzg5Mw==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r395953893", "bodyText": "Thanks @kezhenxu94.  I've changed the code based on the comments :)", "author": "arugal", "createdAt": "2020-03-21T02:40:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTY2MjcwMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTY2NDQxOA==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r395664418", "bodyText": "rename this, because the test framework will automatically convert the method name camelCaseMethodName to verify camel case method name", "author": "kezhenxu94", "createdAt": "2020-03-20T14:15:11Z", "path": "test/e2e/e2e-test/src/test/java/org/apache/skywalking/e2e/browser/BrowserE2E.java", "diffHunk": "@@ -0,0 +1,353 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.e2e.browser;\n+\n+import io.grpc.ManagedChannel;\n+import io.grpc.internal.DnsNameResolverProvider;\n+import io.grpc.netty.NettyChannelBuilder;\n+import io.grpc.stub.StreamObserver;\n+import java.util.List;\n+import java.util.UUID;\n+import java.util.concurrent.CountDownLatch;\n+import lombok.extern.slf4j.Slf4j;\n+import org.apache.skywalking.apm.network.common.Commands;\n+import org.apache.skywalking.apm.network.common.KeyIntValuePair;\n+import org.apache.skywalking.apm.network.common.ServiceType;\n+import org.apache.skywalking.apm.network.language.agent.BrowserErrorLog;\n+import org.apache.skywalking.apm.network.language.agent.BrowserPerfData;\n+import org.apache.skywalking.apm.network.language.agent.BrowserPerfServiceGrpc;\n+import org.apache.skywalking.apm.network.language.agent.ErrorCategory;\n+import org.apache.skywalking.apm.network.register.v2.RegisterGrpc;\n+import org.apache.skywalking.apm.network.register.v2.ServiceInstance;\n+import org.apache.skywalking.apm.network.register.v2.ServiceInstanceRegisterMapping;\n+import org.apache.skywalking.apm.network.register.v2.ServiceInstances;\n+import org.apache.skywalking.apm.network.register.v2.ServiceRegisterMapping;\n+import org.apache.skywalking.apm.network.register.v2.Services;\n+import org.apache.skywalking.e2e.annotation.ContainerHostAndPort;\n+import org.apache.skywalking.e2e.annotation.DockerCompose;\n+import org.apache.skywalking.e2e.annotation.DockerContainer;\n+import org.apache.skywalking.e2e.base.SkyWalkingE2E;\n+import org.apache.skywalking.e2e.base.SkyWalkingTestAdapter;\n+import org.apache.skywalking.e2e.base.TrafficController;\n+import org.apache.skywalking.e2e.common.HostAndPort;\n+import org.apache.skywalking.e2e.retryable.RetryableTest;\n+import org.apache.skywalking.e2e.service.Service;\n+import org.apache.skywalking.e2e.service.ServicesMatcher;\n+import org.apache.skywalking.e2e.service.ServicesQuery;\n+import org.apache.skywalking.e2e.service.endpoint.Endpoint;\n+import org.apache.skywalking.e2e.service.endpoint.EndpointQuery;\n+import org.apache.skywalking.e2e.service.endpoint.Endpoints;\n+import org.apache.skywalking.e2e.service.endpoint.EndpointsMatcher;\n+import org.apache.skywalking.e2e.service.instance.Instance;\n+import org.apache.skywalking.e2e.service.instance.Instances;\n+import org.apache.skywalking.e2e.service.instance.InstancesMatcher;\n+import org.apache.skywalking.e2e.service.instance.InstancesQuery;\n+import org.junit.jupiter.api.BeforeAll;\n+import org.testcontainers.containers.ContainerState;\n+import org.testcontainers.containers.DockerComposeContainer;\n+\n+import static java.util.Objects.nonNull;\n+import static org.apache.skywalking.e2e.metrics.BrowserMetricsQuery.ALL_BROWSER_METRICS;\n+import static org.apache.skywalking.e2e.metrics.BrowserMetricsQuery.ALL_BROWSER_PAGE_METRICS;\n+import static org.apache.skywalking.e2e.metrics.BrowserMetricsQuery.ALL_BROWSER_PAGE_MULTIPLE_LINEAR_METRICS;\n+import static org.apache.skywalking.e2e.metrics.BrowserMetricsQuery.ALL_BROWSER_SINGLE_VERSION_METRICS;\n+import static org.apache.skywalking.e2e.metrics.MetricsMatcher.verifyMetrics;\n+import static org.apache.skywalking.e2e.metrics.MetricsMatcher.verifyPercentileMetrics;\n+import static org.apache.skywalking.e2e.utils.Times.now;\n+import static org.apache.skywalking.e2e.utils.Yamls.load;\n+\n+@Slf4j\n+@SkyWalkingE2E\n+public class BrowserE2E extends SkyWalkingTestAdapter {\n+\n+    private static final int MAX_INBOUND_MESSAGE_SIZE = 1024 * 1024 * 50;\n+\n+    private static final String BROWSER_NAME = \"e2e\";\n+\n+    private static final String BROWSER_SINGLE_VERSION_NAME = \"v1.0.0\";\n+\n+    @SuppressWarnings(\"unused\")\n+    @DockerCompose({\n+        \"docker/browser/docker-compose.${SW_STORAGE}.yml\",\n+    })\n+    protected DockerComposeContainer<?> compose;\n+\n+    @SuppressWarnings(\"unused\")\n+    @ContainerHostAndPort(name = \"ui\", port = 8080)\n+    private HostAndPort swWebappHostPort;\n+\n+    @SuppressWarnings(\"unused\")\n+    @ContainerHostAndPort(name = \"oap\", port = 11800)\n+    private HostAndPort oapHostPort;\n+\n+    @SuppressWarnings(\"unused\")\n+    @DockerContainer(\"oap\")\n+    private ContainerState oapContainer;\n+\n+    private RegisterGrpc.RegisterBlockingStub registerStub;\n+\n+    private BrowserPerfServiceGrpc.BrowserPerfServiceStub browserPerfServiceStub;\n+\n+    private volatile int browserId;\n+\n+    private volatile int browserSingleVersionId;\n+\n+    @BeforeAll\n+    public void setUp() {\n+        queryClient(swWebappHostPort);\n+\n+        final ManagedChannel channel =\n+            NettyChannelBuilder.forAddress(oapHostPort.host(), oapHostPort.port())\n+                               .nameResolverFactory(new DnsNameResolverProvider())\n+                               .maxInboundMessageSize(MAX_INBOUND_MESSAGE_SIZE)\n+                               .usePlaintext()\n+                               .build();\n+\n+        registerStub = RegisterGrpc.newBlockingStub(channel);\n+        browserPerfServiceStub = BrowserPerfServiceGrpc.newStub(channel);\n+\n+        register();\n+        generateTraffic();\n+    }\n+\n+    @RetryableTest\n+    void verify() throws Exception {", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTY2NDgzNw==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r395664837", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    load(\"expected/browser/services.yml\")\n          \n          \n            \n                        .as(ServicesMatcher.class).verify(services);\n          \n          \n            \n                    load(\"expected/browser/services.yml\").as(ServicesMatcher.class).verify(services);", "author": "kezhenxu94", "createdAt": "2020-03-20T14:15:50Z", "path": "test/e2e/e2e-test/src/test/java/org/apache/skywalking/e2e/browser/BrowserE2E.java", "diffHunk": "@@ -0,0 +1,353 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.e2e.browser;\n+\n+import io.grpc.ManagedChannel;\n+import io.grpc.internal.DnsNameResolverProvider;\n+import io.grpc.netty.NettyChannelBuilder;\n+import io.grpc.stub.StreamObserver;\n+import java.util.List;\n+import java.util.UUID;\n+import java.util.concurrent.CountDownLatch;\n+import lombok.extern.slf4j.Slf4j;\n+import org.apache.skywalking.apm.network.common.Commands;\n+import org.apache.skywalking.apm.network.common.KeyIntValuePair;\n+import org.apache.skywalking.apm.network.common.ServiceType;\n+import org.apache.skywalking.apm.network.language.agent.BrowserErrorLog;\n+import org.apache.skywalking.apm.network.language.agent.BrowserPerfData;\n+import org.apache.skywalking.apm.network.language.agent.BrowserPerfServiceGrpc;\n+import org.apache.skywalking.apm.network.language.agent.ErrorCategory;\n+import org.apache.skywalking.apm.network.register.v2.RegisterGrpc;\n+import org.apache.skywalking.apm.network.register.v2.ServiceInstance;\n+import org.apache.skywalking.apm.network.register.v2.ServiceInstanceRegisterMapping;\n+import org.apache.skywalking.apm.network.register.v2.ServiceInstances;\n+import org.apache.skywalking.apm.network.register.v2.ServiceRegisterMapping;\n+import org.apache.skywalking.apm.network.register.v2.Services;\n+import org.apache.skywalking.e2e.annotation.ContainerHostAndPort;\n+import org.apache.skywalking.e2e.annotation.DockerCompose;\n+import org.apache.skywalking.e2e.annotation.DockerContainer;\n+import org.apache.skywalking.e2e.base.SkyWalkingE2E;\n+import org.apache.skywalking.e2e.base.SkyWalkingTestAdapter;\n+import org.apache.skywalking.e2e.base.TrafficController;\n+import org.apache.skywalking.e2e.common.HostAndPort;\n+import org.apache.skywalking.e2e.retryable.RetryableTest;\n+import org.apache.skywalking.e2e.service.Service;\n+import org.apache.skywalking.e2e.service.ServicesMatcher;\n+import org.apache.skywalking.e2e.service.ServicesQuery;\n+import org.apache.skywalking.e2e.service.endpoint.Endpoint;\n+import org.apache.skywalking.e2e.service.endpoint.EndpointQuery;\n+import org.apache.skywalking.e2e.service.endpoint.Endpoints;\n+import org.apache.skywalking.e2e.service.endpoint.EndpointsMatcher;\n+import org.apache.skywalking.e2e.service.instance.Instance;\n+import org.apache.skywalking.e2e.service.instance.Instances;\n+import org.apache.skywalking.e2e.service.instance.InstancesMatcher;\n+import org.apache.skywalking.e2e.service.instance.InstancesQuery;\n+import org.junit.jupiter.api.BeforeAll;\n+import org.testcontainers.containers.ContainerState;\n+import org.testcontainers.containers.DockerComposeContainer;\n+\n+import static java.util.Objects.nonNull;\n+import static org.apache.skywalking.e2e.metrics.BrowserMetricsQuery.ALL_BROWSER_METRICS;\n+import static org.apache.skywalking.e2e.metrics.BrowserMetricsQuery.ALL_BROWSER_PAGE_METRICS;\n+import static org.apache.skywalking.e2e.metrics.BrowserMetricsQuery.ALL_BROWSER_PAGE_MULTIPLE_LINEAR_METRICS;\n+import static org.apache.skywalking.e2e.metrics.BrowserMetricsQuery.ALL_BROWSER_SINGLE_VERSION_METRICS;\n+import static org.apache.skywalking.e2e.metrics.MetricsMatcher.verifyMetrics;\n+import static org.apache.skywalking.e2e.metrics.MetricsMatcher.verifyPercentileMetrics;\n+import static org.apache.skywalking.e2e.utils.Times.now;\n+import static org.apache.skywalking.e2e.utils.Yamls.load;\n+\n+@Slf4j\n+@SkyWalkingE2E\n+public class BrowserE2E extends SkyWalkingTestAdapter {\n+\n+    private static final int MAX_INBOUND_MESSAGE_SIZE = 1024 * 1024 * 50;\n+\n+    private static final String BROWSER_NAME = \"e2e\";\n+\n+    private static final String BROWSER_SINGLE_VERSION_NAME = \"v1.0.0\";\n+\n+    @SuppressWarnings(\"unused\")\n+    @DockerCompose({\n+        \"docker/browser/docker-compose.${SW_STORAGE}.yml\",\n+    })\n+    protected DockerComposeContainer<?> compose;\n+\n+    @SuppressWarnings(\"unused\")\n+    @ContainerHostAndPort(name = \"ui\", port = 8080)\n+    private HostAndPort swWebappHostPort;\n+\n+    @SuppressWarnings(\"unused\")\n+    @ContainerHostAndPort(name = \"oap\", port = 11800)\n+    private HostAndPort oapHostPort;\n+\n+    @SuppressWarnings(\"unused\")\n+    @DockerContainer(\"oap\")\n+    private ContainerState oapContainer;\n+\n+    private RegisterGrpc.RegisterBlockingStub registerStub;\n+\n+    private BrowserPerfServiceGrpc.BrowserPerfServiceStub browserPerfServiceStub;\n+\n+    private volatile int browserId;\n+\n+    private volatile int browserSingleVersionId;\n+\n+    @BeforeAll\n+    public void setUp() {\n+        queryClient(swWebappHostPort);\n+\n+        final ManagedChannel channel =\n+            NettyChannelBuilder.forAddress(oapHostPort.host(), oapHostPort.port())\n+                               .nameResolverFactory(new DnsNameResolverProvider())\n+                               .maxInboundMessageSize(MAX_INBOUND_MESSAGE_SIZE)\n+                               .usePlaintext()\n+                               .build();\n+\n+        registerStub = RegisterGrpc.newBlockingStub(channel);\n+        browserPerfServiceStub = BrowserPerfServiceGrpc.newStub(channel);\n+\n+        register();\n+        generateTraffic();\n+    }\n+\n+    @RetryableTest\n+    void verify() throws Exception {\n+        final List<Service> services = graphql.browserServices(new ServicesQuery().start(startTime).end(now()));\n+        LOGGER.info(\"services: {}\", services);\n+\n+        load(\"expected/browser/services.yml\")\n+            .as(ServicesMatcher.class).verify(services);", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "a2966d8f8fecdde2fe5b4ad1c008abf3c564b3ae", "url": "https://github.com/apache/skywalking/commit/a2966d8f8fecdde2fe5b4ad1c008abf3c564b3ae", "message": "commit", "committedDate": "2020-05-06T12:11:19Z", "type": "commit"}, {"oid": "fd9ed3dde9b5e24e270a9e1fe4101953424afeaf", "url": "https://github.com/apache/skywalking/commit/fd9ed3dde9b5e24e270a9e1fe4101953424afeaf", "message": "Merge branch 'master' into browser-receiver", "committedDate": "2020-07-21T10:49:18Z", "type": "commit"}, {"oid": "15b2094c18d51f4a9611cfd85960f9a6dad14683", "url": "https://github.com/apache/skywalking/commit/15b2094c18d51f4a9611cfd85960f9a6dad14683", "message": "sync change", "committedDate": "2020-08-01T09:16:01Z", "type": "commit"}, {"oid": "a157f2e85bfbbc732ec383bd866fbf503777a772", "url": "https://github.com/apache/skywalking/commit/a157f2e85bfbbc732ec383bd866fbf503777a772", "message": "Merge branch 'master' into browser-receiver\n\n# Conflicts:\n#\toap-server/server-bootstrap/pom.xml\n#\toap-server/server-receiver-plugin/pom.xml", "committedDate": "2020-08-01T09:36:36Z", "type": "commit"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": "895e7fb18fc9270eb2a023ee2e73a334977dcdcd", "url": "https://github.com/apache/skywalking/commit/895e7fb18fc9270eb2a023ee2e73a334977dcdcd", "message": "sync change", "committedDate": "2020-08-02T14:59:30Z", "type": "commit"}, {"oid": "895e7fb18fc9270eb2a023ee2e73a334977dcdcd", "url": "https://github.com/apache/skywalking/commit/895e7fb18fc9270eb2a023ee2e73a334977dcdcd", "message": "sync change", "committedDate": "2020-08-02T14:59:30Z", "type": "forcePushed"}, {"oid": "0b65880ecae60e7730282d646a487d8ba69b129a", "url": "https://github.com/apache/skywalking/commit/0b65880ecae60e7730282d646a487d8ba69b129a", "message": "Merge branch 'master' into browser-receiver", "committedDate": "2020-08-03T01:29:30Z", "type": "commit"}, {"oid": "47128149a69df27a34e2c525e7a91ebda27ce39f", "url": "https://github.com/apache/skywalking/commit/47128149a69df27a34e2c525e7a91ebda27ce39f", "message": "Merge branch 'master' into browser-receiver", "committedDate": "2020-08-03T04:42:55Z", "type": "commit"}, {"oid": "6a1aabb1d33aaf783fbab1b715e716f38c997472", "url": "https://github.com/apache/skywalking/commit/6a1aabb1d33aaf783fbab1b715e716f38c997472", "message": "fix NodeType valueOf bug", "committedDate": "2020-08-04T05:30:22Z", "type": "commit"}, {"oid": "d0c0844e2bbb1cd244090c2c0e5c4fdf0a5ea4db", "url": "https://github.com/apache/skywalking/commit/d0c0844e2bbb1cd244090c2c0e5c4fdf0a5ea4db", "message": "fix getAllBrowserServices bug of influxdb", "committedDate": "2020-08-04T08:59:12Z", "type": "commit"}, {"oid": "91e92ab52ec04a423c9b1b209fa10d68d041a42f", "url": "https://github.com/apache/skywalking/commit/91e92ab52ec04a423c9b1b209fa10d68d041a42f", "message": "Merge branch 'master' into browser-receiver", "committedDate": "2020-08-09T05:51:18Z", "type": "commit"}, {"oid": "be1561e71e38c72095234f280430751f7ddc72aa", "url": "https://github.com/apache/skywalking/commit/be1561e71e38c72095234f280430751f7ddc72aa", "message": "add some documentation and comments", "committedDate": "2020-08-09T10:08:04Z", "type": "commit"}, {"oid": "803d1d4a80d66cd4b10a90e57e9e994641624791", "url": "https://github.com/apache/skywalking/commit/803d1d4a80d66cd4b10a90e57e9e994641624791", "message": "Merge branch 'master' into browser-receiver", "committedDate": "2020-08-09T10:18:28Z", "type": "commit"}, {"oid": "d409441ed3592d41be8a1e799bf4ba27b613e5e4", "url": "https://github.com/apache/skywalking/commit/d409441ed3592d41be8a1e799bf4ba27b613e5e4", "message": "Merge branch 'master' into browser-receiver", "committedDate": "2020-08-10T13:18:29Z", "type": "commit"}, {"oid": "0aa7581d7f72b1a610ad36fc3284bdcdb77dd12b", "url": "https://github.com/apache/skywalking/commit/0aa7581d7f72b1a610ad36fc3284bdcdb77dd12b", "message": "add more performance metrics", "committedDate": "2020-08-10T14:59:18Z", "type": "commit"}, {"oid": "a6828bc6af390c4c1cb72ec7c7b3f288110b14a4", "url": "https://github.com/apache/skywalking/commit/a6828bc6af390c4c1cb72ec7c7b3f288110b14a4", "message": "Merge branch 'master' into browser-receiver", "committedDate": "2020-08-11T11:07:19Z", "type": "commit"}, {"oid": "cbd999995f1964d15f7f676961f68aab33b5e9b0", "url": "https://github.com/apache/skywalking/commit/cbd999995f1964d15f7f676961f68aab33b5e9b0", "message": "fix checkstyle", "committedDate": "2020-08-11T11:56:13Z", "type": "commit"}, {"oid": "9d2bc16e70ae9209e38ec521a7d619a7dd768d09", "url": "https://github.com/apache/skywalking/commit/9d2bc16e70ae9209e38ec521a7d619a7dd768d09", "message": "Merge remote-tracking branch 'origin/browser-receiver' into browser-receiver", "committedDate": "2020-08-11T11:56:44Z", "type": "commit"}, {"oid": "f872906d50fbe1f0c92afe42cae5339e40447d9a", "url": "https://github.com/apache/skywalking/commit/f872906d50fbe1f0c92afe42cae5339e40447d9a", "message": "rollback code", "committedDate": "2020-08-11T12:06:04Z", "type": "commit"}, {"oid": "f872906d50fbe1f0c92afe42cae5339e40447d9a", "url": "https://github.com/apache/skywalking/commit/f872906d50fbe1f0c92afe42cae5339e40447d9a", "message": "rollback code", "committedDate": "2020-08-11T12:06:04Z", "type": "forcePushed"}, {"oid": "fcc3ad8e371a93650356e97177f6591554e67cd5", "url": "https://github.com/apache/skywalking/commit/fcc3ad8e371a93650356e97177f6591554e67cd5", "message": "rollback code", "committedDate": "2020-08-11T15:02:21Z", "type": "commit"}, {"oid": "83d6044e0402c4152a53b406640d79321d0d0b88", "url": "https://github.com/apache/skywalking/commit/83d6044e0402c4152a53b406640d79321d0d0b88", "message": "Merge branch 'master' into browser-receiver", "committedDate": "2020-08-12T01:26:46Z", "type": "commit"}, {"oid": "932555c92e3c4d9ee3c579ea3c003f65cc294d09", "url": "https://github.com/apache/skywalking/commit/932555c92e3c4d9ee3c579ea3c003f65cc294d09", "message": "Merge branch 'master' into browser-receiver", "committedDate": "2020-08-14T02:14:42Z", "type": "commit"}, {"oid": "be0c61264ab9885bbef6fdd9d1f7c1a831942672", "url": "https://github.com/apache/skywalking/commit/be0c61264ab9885bbef6fdd9d1f7c1a831942672", "message": "implementation browser log query", "committedDate": "2020-08-18T02:15:36Z", "type": "commit"}, {"oid": "d6e21f95756cc0c35c8c777891c7d7d984ba7008", "url": "https://github.com/apache/skywalking/commit/d6e21f95756cc0c35c8c777891c7d7d984ba7008", "message": "sync submodule", "committedDate": "2020-08-18T02:16:54Z", "type": "commit"}, {"oid": "8e5ecf597fc8d7cee6bfbf526545c90955fc6a64", "url": "https://github.com/apache/skywalking/commit/8e5ecf597fc8d7cee6bfbf526545c90955fc6a64", "message": "Merge remote-tracking branch 'origin/browser-receiver' into browser-receiver", "committedDate": "2020-08-18T02:17:15Z", "type": "commit"}, {"oid": "c42bb6608f45b42bb8faa0b08d3a50b3082b80ed", "url": "https://github.com/apache/skywalking/commit/c42bb6608f45b42bb8faa0b08d3a50b3082b80ed", "message": "Merge branch 'master' into browser-receiver", "committedDate": "2020-08-18T04:25:58Z", "type": "commit"}, {"oid": "7db326b648077d54f5dbd0b9e3481ca9e9c3ccf5", "url": "https://github.com/apache/skywalking/commit/7db326b648077d54f5dbd0b9e3481ca9e9c3ccf5", "message": "Merge branch 'master' into browser-receiver", "committedDate": "2020-08-18T07:59:00Z", "type": "commit"}, {"oid": "ec5bc1775a600ce6c56e383dafbfc0bac67d2db6", "url": "https://github.com/apache/skywalking/commit/ec5bc1775a600ce6c56e383dafbfc0bac67d2db6", "message": "implementation browser log query", "committedDate": "2020-08-18T08:27:38Z", "type": "commit"}, {"oid": "bd6da21cfc76272990fab9c4d9a3082aaf483f95", "url": "https://github.com/apache/skywalking/commit/bd6da21cfc76272990fab9c4d9a3082aaf483f95", "message": "Merge branch 'master' into browser-receiver", "committedDate": "2020-08-19T05:12:25Z", "type": "commit"}, {"oid": "a9936b4b16eb0a29d1148596f35a3c775bbbe2cd", "url": "https://github.com/apache/skywalking/commit/a9936b4b16eb0a29d1148596f35a3c775bbbe2cd", "message": "Merge remote-tracking branch 'origin/browser-receiver' into browser-receiver", "committedDate": "2020-08-19T05:17:42Z", "type": "commit"}, {"oid": "ebc14f5810eda77c6bf94e7aba6f8728db386337", "url": "https://github.com/apache/skywalking/commit/ebc14f5810eda77c6bf94e7aba6f8728db386337", "message": "implementation browser log query", "committedDate": "2020-08-19T05:41:06Z", "type": "commit"}, {"oid": "ac599811b3dab1781b8bc028535da03a374e29b5", "url": "https://github.com/apache/skywalking/commit/ac599811b3dab1781b8bc028535da03a374e29b5", "message": "fix NPE", "committedDate": "2020-08-19T09:17:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjg4Nzg0OQ==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r472887849", "bodyText": "Forget to change.", "author": "wu-sheng", "createdAt": "2020-08-19T09:20:49Z", "path": "README.md", "diffHunk": "@@ -28,7 +28,7 @@ The core features are following.\n - Distributed tracing and context propagation\n - Database access metrics. Detect slow database access statements(including SQL statements).\n - Alarm\n-\n+- [WIP] Browser performance monitoring", "originalCommit": "ac599811b3dab1781b8bc028535da03a374e29b5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjg4OTYxNg==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r472889616", "bodyText": "I think this should be linked as a Browser agent, not here.", "author": "wu-sheng", "createdAt": "2020-08-19T09:23:34Z", "path": "docs/README.md", "diffHunk": "@@ -91,6 +91,7 @@ If you are already familiar with SkyWalking, you could use this catalog to find\n       * [Uninstrumented Gateways](en/setup/backend/uninstrumented-gateways.md). Configure gateways/proxies that are not supported by SkyWalking agent plugins, to reflect the delegation in topology graph.\n     * [UI setup document](en/setup/backend/ui-setup.md).\n     * [CLI setup document](https://github.com/apache/skywalking-cli).\n+    * [Browser performance monitoring setup document](https://github.com/apache/skywalking-client-js).", "originalCommit": "ac599811b3dab1781b8bc028535da03a374e29b5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjg5MDY5MQ==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r472890691", "bodyText": "percent is for this. I don't think we need this.", "author": "wu-sheng", "createdAt": "2020-08-19T09:25:10Z", "path": "docs/en/concepts-and-designs/oal.md", "diffHunk": "@@ -78,10 +78,15 @@ The parameter (2) is the status of this request. The status(success/failure) eff\n **percentile** is the first multiple value metrics, introduced since 7.0.0. As having multiple values, it could be query through `getMultipleLinearIntValues` GraphQL query.\n In this case, `p99`, `p95`, `p90`, `p75`, `p50` of all incoming request. The parameter is the precision of p99 latency calculation, such as in above case, 120ms and 124 are considered same.\n Before 7.0.0, use `p99`, `p95`, `p90`, `p75`, `p50` func(s) to calculate metrics separately. Still supported in 7.x, but don't be recommended, and don't be included in official OAL script. \n-> All_p99 = from(All.latency).p99(10);\n+> all_p99 = from(All.latency).p99(10);\n \n In this case, p99 value of all incoming requests. The parameter is the precision of p99 latency calculation, such as in above case, 120ms and 124 are considered same.\n \n+- `errorRate`. The error rate of browser traffic (only browser).", "originalCommit": "ac599811b3dab1781b8bc028535da03a374e29b5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjg5MTM5Mw==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r472891393", "bodyText": "If the percent is not suitable, then you should consider whether the scope design is correct.", "author": "wu-sheng", "createdAt": "2020-08-19T09:26:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjg5MDY5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjg5NTQ5MQ==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r472895491", "bodyText": "And, I can't find this in the real OAL script. please recheck.", "author": "wu-sheng", "createdAt": "2020-08-19T09:32:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjg5MDY5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzA2NTk0OA==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r473065948", "bodyText": "A new richPercent function is provided.", "author": "arugal", "createdAt": "2020-08-19T14:19:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjg5MDY5MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjg5OTY4NA==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r472899684", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            The probe in [skywalking-client-js](https://github.com/apache/skywalking-client-js) cloud use this protocol to send to backendEnd. This service provided by gRPC.\n          \n          \n            \n            The browser probe, such as  [skywalking-client-js](https://github.com/apache/skywalking-client-js) could use this protocol to send to backend. This service provided by gRPC.", "author": "wu-sheng", "createdAt": "2020-08-19T09:39:34Z", "path": "docs/en/protocols/README.md", "diffHunk": "@@ -29,6 +29,12 @@ SkyWalking javaagent begins to support this since 8.0.0.\n \n [SkyWalking Trace Data Protocol v3](Trace-Data-Protocol-v3.md) defines the communication way and format between agent and backend.\n \n+### Browser probe protocol\n+\n+The probe in [skywalking-client-js](https://github.com/apache/skywalking-client-js) cloud use this protocol to send to backendEnd. This service provided by gRPC.", "originalCommit": "ac599811b3dab1781b8bc028535da03a374e29b5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjkwMjkxMw==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r472902913", "bodyText": "Do we really need so many metrics? Please recheck @arugal @Fine0830. From the UI prototype, it doesn't need so much. Please analysis the metrics used by UI.", "author": "wu-sheng", "createdAt": "2020-08-19T09:45:17Z", "path": "oap-server/server-bootstrap/src/main/resources/oal/browser.oal", "diffHunk": "@@ -0,0 +1,73 @@\n+/*\n+* Licensed to the Apache Software Foundation (ASF) under one or more\n+* contributor license agreements.  See the NOTICE file distributed with\n+* this work for additional information regarding copyright ownership.\n+* The ASF licenses this file to You under the Apache License, Version 2.0\n+* (the \"License\"); you may not use this file except in compliance with\n+* the License.  You may obtain a copy of the License at\n+*\n+*     http://www.apache.org/licenses/LICENSE-2.0\n+*\n+* Unless required by applicable law or agreed to in writing, software\n+* distributed under the License is distributed on an \"AS IS\" BASIS,\n+* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+* See the License for the specific language governing permissions and\n+* limitations under the License.\n+*\n+*/\n+// browser app", "originalCommit": "ac599811b3dab1781b8bc028535da03a374e29b5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTY0MjAyNQ==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r475642025", "bodyText": "@wu-sheng @Fine0830  Some percentile associated metrics have been reduced, please review.", "author": "arugal", "createdAt": "2020-08-24T14:11:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjkwMjkxMw=="}], "type": "inlineReview"}, {"oid": "86a1d823f505b12e17bc47afd7ff17052f0a0b60", "url": "https://github.com/apache/skywalking/commit/86a1d823f505b12e17bc47afd7ff17052f0a0b60", "message": "support richPercent function", "committedDate": "2020-08-19T14:17:06Z", "type": "commit"}, {"oid": "dd798253b26056253c6f61757aa6d13ff79b63a4", "url": "https://github.com/apache/skywalking/commit/dd798253b26056253c6f61757aa6d13ff79b63a4", "message": "Merge branch 'master' into browser-receiver", "committedDate": "2020-08-19T14:18:57Z", "type": "commit"}, {"oid": "9dd46d0a360145f8be5f3cfcec52ccbb0380bf08", "url": "https://github.com/apache/skywalking/commit/9dd46d0a360145f8be5f3cfcec52ccbb0380bf08", "message": "Update docs/en/protocols/README.md\n\nCo-authored-by: \u5434\u665f Wu Sheng <wu.sheng@foxmail.com>", "committedDate": "2020-08-19T14:19:48Z", "type": "commit"}, {"oid": "ca2b715eaf8b3ed4e473354a0b96f37275528da8", "url": "https://github.com/apache/skywalking/commit/ca2b715eaf8b3ed4e473354a0b96f37275528da8", "message": "del unused code", "committedDate": "2020-08-19T14:23:15Z", "type": "commit"}, {"oid": "89a4c5e44ca8cad78c6a2888867c52dc8034e95f", "url": "https://github.com/apache/skywalking/commit/89a4c5e44ca8cad78c6a2888867c52dc8034e95f", "message": "Merge remote-tracking branch 'origin/browser-receiver' into browser-receiver", "committedDate": "2020-08-19T14:23:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzgyOTczMA==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r473829730", "bodyText": "This should be rate, numerator and denominator", "author": "wu-sheng", "createdAt": "2020-08-20T09:49:55Z", "path": "oap-server/server-core/src/main/java/org/apache/skywalking/oap/server/core/analysis/metrics/RichPercentMetrics.java", "diffHunk": "@@ -0,0 +1,71 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.skywalking.oap.server.core.analysis.metrics;\n+\n+import lombok.Getter;\n+import lombok.Setter;\n+import org.apache.skywalking.oap.server.core.analysis.metrics.annotation.Entrance;\n+import org.apache.skywalking.oap.server.core.analysis.metrics.annotation.Expression;\n+import org.apache.skywalking.oap.server.core.analysis.metrics.annotation.MetricsFunction;\n+import org.apache.skywalking.oap.server.core.query.sql.Function;\n+import org.apache.skywalking.oap.server.core.storage.annotation.Column;\n+\n+@MetricsFunction(functionName = \"richPercent\")\n+public abstract class RichPercentMetrics extends Metrics implements IntValueHolder {", "originalCommit": "89a4c5e44ca8cad78c6a2888867c52dc8034e95f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDQyNTQ2MA==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r474425460", "bodyText": "done", "author": "arugal", "createdAt": "2020-08-21T06:01:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzgyOTczMA=="}], "type": "inlineReview"}, {"oid": "01466da7513f5626235ebd58e65dd165327b0d07", "url": "https://github.com/apache/skywalking/commit/01466da7513f5626235ebd58e65dd165327b0d07", "message": "rename rete function", "committedDate": "2020-08-21T05:59:59Z", "type": "commit"}, {"oid": "1dd6b6f50dd439e7001b68d0e3721a9cfa8c1a5e", "url": "https://github.com/apache/skywalking/commit/1dd6b6f50dd439e7001b68d0e3721a9cfa8c1a5e", "message": "Merge branch 'master' into browser-receiver", "committedDate": "2020-08-21T06:00:54Z", "type": "commit"}, {"oid": "52646f49af1272b4afb114a3629063dc7b1c90cd", "url": "https://github.com/apache/skywalking/commit/52646f49af1272b4afb114a3629063dc7b1c90cd", "message": "fix ci", "committedDate": "2020-08-21T08:39:49Z", "type": "commit"}, {"oid": "1af7b37595ba325ee03b9fa887527e7892babb0e", "url": "https://github.com/apache/skywalking/commit/1af7b37595ba325ee03b9fa887527e7892babb0e", "message": "Merge remote-tracking branch 'origin/browser-receiver' into browser-receiver", "committedDate": "2020-08-21T08:42:04Z", "type": "commit"}, {"oid": "4227f52a565fe27d8ff840952396ce70c35a6b5b", "url": "https://github.com/apache/skywalking/commit/4227f52a565fe27d8ff840952396ce70c35a6b5b", "message": "Merge branch 'master' into browser-receiver", "committedDate": "2020-08-21T14:01:14Z", "type": "commit"}, {"oid": "e33ec0643332f54d064f3d068e8ea9593857471d", "url": "https://github.com/apache/skywalking/commit/e33ec0643332f54d064f3d068e8ea9593857471d", "message": "Merge branch 'master' into browser-receiver", "committedDate": "2020-08-22T13:02:56Z", "type": "commit"}, {"oid": "094ad2432f952aa821b1af2424d2345e64d2ea49", "url": "https://github.com/apache/skywalking/commit/094ad2432f952aa821b1af2424d2345e64d2ea49", "message": "reduce metrics", "committedDate": "2020-08-24T14:00:09Z", "type": "commit"}, {"oid": "e21559aa41e3ccd20838b76ecdf154720a1df724", "url": "https://github.com/apache/skywalking/commit/e21559aa41e3ccd20838b76ecdf154720a1df724", "message": "Merge remote-tracking branch 'origin/browser-receiver' into browser-receiver", "committedDate": "2020-08-24T14:06:45Z", "type": "commit"}, {"oid": "7b1c9fc35f12d842b59265ddfb085ff42ae96c26", "url": "https://github.com/apache/skywalking/commit/7b1c9fc35f12d842b59265ddfb085ff42ae96c26", "message": "Merge branch 'master' into browser-receiver", "committedDate": "2020-08-24T14:10:42Z", "type": "commit"}, {"oid": "852f93ab8198df289365a1ef9fb6c436cc5f0024", "url": "https://github.com/apache/skywalking/commit/852f93ab8198df289365a1ef9fb6c436cc5f0024", "message": "Merge branch 'master' into browser-receiver", "committedDate": "2020-08-24T14:13:00Z", "type": "commit"}, {"oid": "36ef91723e5f95079eaa643cbd15f047a706a031", "url": "https://github.com/apache/skywalking/commit/36ef91723e5f95079eaa643cbd15f047a706a031", "message": "add browser_app_page_fmp_percentile", "committedDate": "2020-08-25T01:40:12Z", "type": "commit"}, {"oid": "51ced14359c7f6164e8596264209136c89d5a7f4", "url": "https://github.com/apache/skywalking/commit/51ced14359c7f6164e8596264209136c89d5a7f4", "message": "Merge remote-tracking branch 'origin/browser-receiver' into browser-receiver", "committedDate": "2020-08-25T01:40:38Z", "type": "commit"}, {"oid": "645508ffd6784602e609b69cdee5516cb3361b80", "url": "https://github.com/apache/skywalking/commit/645508ffd6784602e609b69cdee5516cb3361b80", "message": "reduce", "committedDate": "2020-08-26T08:55:02Z", "type": "commit"}, {"oid": "a88411278902f60ccc27b5dd5aaccacf7378d002", "url": "https://github.com/apache/skywalking/commit/a88411278902f60ccc27b5dd5aaccacf7378d002", "message": "Merge branch 'master' into browser-receiver\n\n# Conflicts:\n#\toap-server/oal-grammar/src/main/antlr4/org/apache/skywalking/oal/rt/grammar/OALLexer.g4\n#\toap-server/oal-rt/src/test/java/org/apache/skywalking/oal/rt/parser/ScriptParserTest.java", "committedDate": "2020-08-27T02:01:32Z", "type": "commit"}, {"oid": "5f4aaaa5ce40e5e974fd0be56102c5cc489335e0", "url": "https://github.com/apache/skywalking/commit/5f4aaaa5ce40e5e974fd0be56102c5cc489335e0", "message": "Update README.md\n\n@arugal The browser agent is not for tracing.", "committedDate": "2020-08-27T02:37:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Nzk2ODE1MA==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r477968150", "bodyText": "@arugal I fixed this doc. The browser agent has nothing related to distributed tracing.\n@kezhenxu94 @ascrutae I hope either/both of you could check, whether your nodejs agents could work in the browser?", "author": "wu-sheng", "createdAt": "2020-08-27T02:39:06Z", "path": "docs/README.md", "diffHunk": "@@ -66,6 +66,8 @@ If you are already familiar with SkyWalking, you could use this catalog to find\n       * [Plugin development guide](en/setup/service-agent/java-agent/README.md#plugin-development-guide).\n       * [Agent plugin tests and performance tests](en/setup/service-agent/java-agent/README.md#test).\n     * [Other language agents](en/setup/README.md#language-agents-in-service) includes Nginx LUA, Python, .NetCore, PHP, NodeJS, Go.\n+    * Browser performance monitoring\n+      * Track the performance of the browser, such as latency of redirect, dns, ttfb. For more information, [click here](https://github.com/apache/skywalking-client-js).", "originalCommit": "5f4aaaa5ce40e5e974fd0be56102c5cc489335e0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Nzk3NzExOA==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r477977118", "bodyText": "I think you missed Filter about the in", "author": "wu-sheng", "createdAt": "2020-08-27T02:45:31Z", "path": "docs/en/concepts-and-designs/oal.md", "diffHunk": "@@ -53,6 +53,12 @@ In this case, input are request of each ServiceInstanceJVMCPU scope, avg is base\n > endpoint_percent = from(Endpoint.*).percent(status == true);\n \n In this case, all input are requests of each endpoint, condition is `endpoint.status == true`.\n+- `rate`. The rate expressed as a fraction of 100, for the condition matched input.", "originalCommit": "5f4aaaa5ce40e5e974fd0be56102c5cc489335e0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODAwOTkzNw==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r478009937", "bodyText": "It has been merged into the master branch https://github.com/apache/skywalking/blob/master/docs/en/concepts-and-designs/oal.md#filter", "author": "arugal", "createdAt": "2020-08-27T03:09:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Nzk3NzExOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODI4MjA1NA==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r478282054", "bodyText": "Why many classes have this empty line?", "author": "wu-sheng", "createdAt": "2020-08-27T09:27:24Z", "path": "oap-server/server-core/src/main/java/org/apache/skywalking/oap/server/core/query/type/BrowserErrorLog.java", "diffHunk": "@@ -0,0 +1,39 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.skywalking.oap.server.core.query.type;\n+\n+import lombok.Getter;\n+import lombok.Setter;\n+\n+@Setter\n+@Getter\n+public class BrowserErrorLog {\n+", "originalCommit": "5f4aaaa5ce40e5e974fd0be56102c5cc489335e0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODI4Mjc2Ng==", "url": "https://github.com/apache/skywalking/pull/4228#discussion_r478282766", "bodyText": "Same here. Could you recheck the codes and local format?", "author": "wu-sheng", "createdAt": "2020-08-27T09:28:38Z", "path": "oap-server/server-query-plugin/query-graphql-plugin/src/main/java/org/apache/skywalking/oap/query/graphql/resolver/BrowserLogQuery.java", "diffHunk": "@@ -0,0 +1,60 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.skywalking.oap.query.graphql.resolver;\n+\n+import com.coxautodev.graphql.tools.GraphQLQueryResolver;\n+import java.io.IOException;\n+import java.util.Optional;\n+import lombok.RequiredArgsConstructor;\n+import org.apache.skywalking.oap.server.core.CoreModule;\n+import org.apache.skywalking.oap.server.core.query.BrowserLogQueryService;\n+import org.apache.skywalking.oap.server.core.query.input.BrowserErrorLogQueryCondition;\n+import org.apache.skywalking.oap.server.core.query.type.BrowserErrorLogs;\n+import org.apache.skywalking.oap.server.library.module.ModuleManager;\n+\n+import static java.util.Objects.nonNull;\n+\n+@RequiredArgsConstructor\n+public class BrowserLogQuery implements GraphQLQueryResolver {\n+", "originalCommit": "5f4aaaa5ce40e5e974fd0be56102c5cc489335e0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "a3d095e37cbeb1f5180859e47e64050c30904260", "url": "https://github.com/apache/skywalking/commit/a3d095e37cbeb1f5180859e47e64050c30904260", "message": "comments", "committedDate": "2020-08-31T01:36:37Z", "type": "commit"}, {"oid": "b4848aaa55d95b31ce8f7547f05da942535afcfe", "url": "https://github.com/apache/skywalking/commit/b4848aaa55d95b31ce8f7547f05da942535afcfe", "message": "Merge remote-tracking branch 'origin/browser-receiver' into browser-receiver", "committedDate": "2020-08-31T01:36:53Z", "type": "commit"}, {"oid": "ca2ce1ab5ca60a5dc17c1d0294cc55720fe00d9f", "url": "https://github.com/apache/skywalking/commit/ca2ce1ab5ca60a5dc17c1d0294cc55720fe00d9f", "message": "Merge branch 'master' into browser-receiver", "committedDate": "2020-08-31T01:37:11Z", "type": "commit"}, {"oid": "73f7a18249855630a2e98619ee9d37f3186e795a", "url": "https://github.com/apache/skywalking/commit/73f7a18249855630a2e98619ee9d37f3186e795a", "message": "comments", "committedDate": "2020-08-31T01:57:34Z", "type": "commit"}, {"oid": "1fd159f208e600a0f34819fd1f9545f042c97bfa", "url": "https://github.com/apache/skywalking/commit/1fd159f208e600a0f34819fd1f9545f042c97bfa", "message": "Merge remote-tracking branch 'origin/browser-receiver' into browser-receiver", "committedDate": "2020-08-31T01:57:47Z", "type": "commit"}]}