{"pr_number": 4364, "pr_title": "Support Downsampling Data Packing feature in ES storage implementation", "pr_createdAt": "2020-02-15T13:35:04Z", "pr_url": "https://github.com/apache/skywalking/pull/4364", "timeline": [{"oid": "6dee4fab6668a1e18a43debc543bafc2d0a2d87b", "url": "https://github.com/apache/skywalking/commit/6dee4fab6668a1e18a43debc543bafc2d0a2d87b", "message": "Support day/hour/minute metrics merging into one index. Reduce the number of index 50%.", "committedDate": "2020-02-15T12:45:39Z", "type": "commit"}, {"oid": "dab8a2f72b59c89d624c8352968874b1da84e446", "url": "https://github.com/apache/skywalking/commit/dab8a2f72b59c89d624c8352968874b1da84e446", "message": "Fix style.", "committedDate": "2020-02-15T12:53:45Z", "type": "commit"}, {"oid": "10bcc8797d9a66122d376fc1e449b91a2ab2cedc", "url": "https://github.com/apache/skywalking/commit/10bcc8797d9a66122d376fc1e449b91a2ab2cedc", "message": "Fill doc about this new feature.", "committedDate": "2020-02-15T13:27:31Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTgzNDY1Mg==", "url": "https://github.com/apache/skywalking/pull/4364#discussion_r379834652", "bodyText": "nit: enablePackedDownsampling is always true, and it's never used in class PackedDownsamplingConverter", "author": "kezhenxu94", "createdAt": "2020-02-15T14:30:35Z", "path": "oap-server/server-storage-plugin/storage-elasticsearch-plugin/src/main/java/org/apache/skywalking/oap/server/storage/plugin/elasticsearch/StorageModuleElasticsearchProvider.java", "diffHunk": "@@ -174,4 +197,63 @@ private void overrideCoreModuleTTLConfig() {\n         configService.getDataTTLConfig().setDayMetricsDataTTL(config.getDayMetricsDataTTL());\n         configService.getDataTTLConfig().setMonthMetricsDataTTL(config.getMonthMetricsDataTTL());\n     }\n+\n+    public static List<IndexNameConverter> indexNameConverters(String namespace, boolean enablePackedDownsampling) {\n+        List<IndexNameConverter> converters = new ArrayList<>();\n+\n+        if (enablePackedDownsampling) {\n+            // Packed downsampling converter.\n+            converters.add(new PackedDownsamplingConverter(enablePackedDownsampling));", "originalCommit": "10bcc8797d9a66122d376fc1e449b91a2ab2cedc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTgzNTQzNA==", "url": "https://github.com/apache/skywalking/pull/4364#discussion_r379835434", "bodyText": "Fixed.", "author": "wu-sheng", "createdAt": "2020-02-15T14:46:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTgzNDY1Mg=="}], "type": "inlineReview"}, {"oid": "9dcfd974f2eccf3fe278cf0a1bcc8e4fec232e50", "url": "https://github.com/apache/skywalking/commit/9dcfd974f2eccf3fe278cf0a1bcc8e4fec232e50", "message": "FIx the converter initialization issue.", "committedDate": "2020-02-15T14:46:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTk2NTExMQ==", "url": "https://github.com/apache/skywalking/pull/4364#discussion_r379965111", "bodyText": "Do we need to increase it when packed downsampling enabled?", "author": "hanahmily", "createdAt": "2020-02-17T02:42:13Z", "path": "oap-server/server-bootstrap/src/main/resources/application.yml", "diffHunk": "@@ -104,6 +105,7 @@ storage:\n     protocol: ${SW_STORAGE_ES_HTTP_PROTOCOL:\"http\"}\n     #trustStorePath: ${SW_SW_STORAGE_ES_SSL_JKS_PATH:\"../es_keystore.jks\"}\n     #trustStorePass: ${SW_SW_STORAGE_ES_SSL_JKS_PASS:\"\"}\n+    enablePackedDownsampling: ${SW_STORAGE_ENABLE_PACKED_DOWNSAMPLING:true} # Hour and Day metrics will be merged into minute index.\n     user: ${SW_ES_USER:\"\"}\n     password: ${SW_ES_PASSWORD:\"\"}\n     indexShardsNumber: ${SW_STORAGE_ES_INDEX_SHARDS_NUMBER:2}", "originalCommit": "9dcfd974f2eccf3fe278cf0a1bcc8e4fec232e50", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}