{"pr_number": 4769, "pr_title": "Alarm support multiple scope", "pr_createdAt": "2020-05-10T04:23:19Z", "pr_url": "https://github.com/apache/skywalking/pull/4769", "timeline": [{"oid": "22067c7781aedfc3ae848c7427c25cb6fb675f52", "url": "https://github.com/apache/skywalking/commit/22067c7781aedfc3ae848c7427c25cb6fb675f52", "message": "Support service relation and database access alarm", "committedDate": "2020-05-10T03:10:25Z", "type": "commit"}, {"oid": "ff89208c41536af3a1583445c5eed7d245d39628", "url": "https://github.com/apache/skywalking/commit/ff89208c41536af3a1583445c5eed7d245d39628", "message": "support service instance relation alarm", "committedDate": "2020-05-10T03:46:17Z", "type": "commit"}, {"oid": "bfbbcbed7c81eabebf3c447b02feb74e2660f028", "url": "https://github.com/apache/skywalking/commit/bfbbcbed7c81eabebf3c447b02feb74e2660f028", "message": "support endpoint relation alarm", "committedDate": "2020-05-10T04:14:41Z", "type": "commit"}, {"oid": "e9bacde2536ea4990edc197120831637c994d95f", "url": "https://github.com/apache/skywalking/commit/e9bacde2536ea4990edc197120831637c994d95f", "message": "Merge branch 'master' into alarm-support-database", "committedDate": "2020-05-10T04:23:54Z", "type": "commit"}, {"oid": "51991cf55a1fa46e2bf0f4b2de38377b88b300a1", "url": "https://github.com/apache/skywalking/commit/51991cf55a1fa46e2bf0f4b2de38377b88b300a1", "message": "document and format the name", "committedDate": "2020-05-10T09:26:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjYxNzU2Mw==", "url": "https://github.com/apache/skywalking/pull/4769#discussion_r422617563", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            - **id1**. When using relation scope, it will be the dest entity ID. Otherwise it will be empty.\n          \n          \n            \n            - **id1**. When using relation scope, it will be the dest entity ID. Otherwise, it is empty.", "author": "wu-sheng", "createdAt": "2020-05-10T09:32:53Z", "path": "docs/en/setup/backend/backend-alarm.md", "diffHunk": "@@ -77,16 +85,16 @@ We provided a default `alarm-setting.yml` in our distribution only for convenien\n \n ### List of all potential metrics name\n The metrics names are defined in official [OAL scripts](../../guides/backend-oal-scripts.md), right now \n-metrics from **Service**, **Service Instance**, **Endpoint** scopes could be used in Alarm, we will extend in further versions. \n+metrics from **Service**, **Service Instance**, **Endpoint**, **Service Relation**, **Service Instance Relation**, **Endpoint Relation** scopes could be used in Alarm, and the **Database access** same with **Service** scope.\n \n Submit issue or pull request if you want to support any other scope in alarm.\n \n ## Webhook\n-Webhook requires the peer is a web container. The alarm message will send through HTTP post by `application/json` content type. The JSON format is based on `List<org.apache.skywalking.oap.server.core.alarm.AlarmMessage` with following key information.\n+Webhook requires the peer is a web container. The alarm message will send through HTTP post by `application/json` content type. The JSON format is based on `List<org.apache.skywalking.oap.server.core.alarm.AlarmMessage>` with following key information.\n - **scopeId**, **scope**. All scopes are defined in org.apache.skywalking.oap.server.core.source.DefaultScopeDefine.\n-- **name**. Target scope entity name.\n-- **id0**. The ID of scope entity, matched the name.\n-- **id1**. Not used today.\n+- **name**. Target scope entity name. Please follow [Entity name define](#entity-name).\n+- **id0**. The ID of scope entity, matched the name. When using relation scope, it will be the source entity ID.\n+- **id1**. When using relation scope, it will be the dest entity ID. Otherwise it will be empty.", "originalCommit": "51991cf55a1fa46e2bf0f4b2de38377b88b300a1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjYxNzYyNQ==", "url": "https://github.com/apache/skywalking/pull/4769#discussion_r422617625", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            - **id0**. The ID of scope entity, matched the name. When using relation scope, it will be the source entity ID.\n          \n          \n            \n            - **id0**. The ID of the scope entity matched the name. When using relation scope, it is the source entity ID.", "author": "wu-sheng", "createdAt": "2020-05-10T09:33:18Z", "path": "docs/en/setup/backend/backend-alarm.md", "diffHunk": "@@ -77,16 +85,16 @@ We provided a default `alarm-setting.yml` in our distribution only for convenien\n \n ### List of all potential metrics name\n The metrics names are defined in official [OAL scripts](../../guides/backend-oal-scripts.md), right now \n-metrics from **Service**, **Service Instance**, **Endpoint** scopes could be used in Alarm, we will extend in further versions. \n+metrics from **Service**, **Service Instance**, **Endpoint**, **Service Relation**, **Service Instance Relation**, **Endpoint Relation** scopes could be used in Alarm, and the **Database access** same with **Service** scope.\n \n Submit issue or pull request if you want to support any other scope in alarm.\n \n ## Webhook\n-Webhook requires the peer is a web container. The alarm message will send through HTTP post by `application/json` content type. The JSON format is based on `List<org.apache.skywalking.oap.server.core.alarm.AlarmMessage` with following key information.\n+Webhook requires the peer is a web container. The alarm message will send through HTTP post by `application/json` content type. The JSON format is based on `List<org.apache.skywalking.oap.server.core.alarm.AlarmMessage>` with following key information.\n - **scopeId**, **scope**. All scopes are defined in org.apache.skywalking.oap.server.core.source.DefaultScopeDefine.\n-- **name**. Target scope entity name.\n-- **id0**. The ID of scope entity, matched the name.\n-- **id1**. Not used today.\n+- **name**. Target scope entity name. Please follow [Entity name define](#entity-name).\n+- **id0**. The ID of scope entity, matched the name. When using relation scope, it will be the source entity ID.", "originalCommit": "51991cf55a1fa46e2bf0f4b2de38377b88b300a1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjYxNzgzMQ==", "url": "https://github.com/apache/skywalking/pull/4769#discussion_r422617831", "bodyText": "All these AccessLevel are default, we could remove them.", "author": "wu-sheng", "createdAt": "2020-05-10T09:34:56Z", "path": "oap-server/server-core/src/main/java/org/apache/skywalking/oap/server/core/alarm/ServiceRelationMetaInAlarm.java", "diffHunk": "@@ -0,0 +1,58 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.oap.server.core.alarm;\n+\n+import lombok.AccessLevel;\n+import lombok.Getter;\n+import lombok.Setter;\n+import org.apache.skywalking.oap.server.core.analysis.IDManager;\n+import org.apache.skywalking.oap.server.core.source.DefaultScopeDefine;\n+\n+@Getter(AccessLevel.PUBLIC)\n+@Setter(AccessLevel.PUBLIC)", "originalCommit": "51991cf55a1fa46e2bf0f4b2de38377b88b300a1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "111f6b4c536385e32c06419ab132802135b6f381", "url": "https://github.com/apache/skywalking/commit/111f6b4c536385e32c06419ab132802135b6f381", "message": "resolve issues", "committedDate": "2020-05-10T10:13:05Z", "type": "commit"}, {"oid": "5538f147c17ae5e5af19328fe9f63aaa7bcb4f54", "url": "https://github.com/apache/skywalking/commit/5538f147c17ae5e5af19328fe9f63aaa7bcb4f54", "message": "add database access and endpoint relation rule example", "committedDate": "2020-05-10T13:11:32Z", "type": "commit"}, {"oid": "2b2c2131b6151f748e0ecf4eb6e6a94de1bdb8ab", "url": "https://github.com/apache/skywalking/commit/2b2c2131b6151f748e0ecf4eb6e6a94de1bdb8ab", "message": "resolve code format", "committedDate": "2020-05-10T13:15:03Z", "type": "commit"}, {"oid": "251c9c278c24a365eb6a03575951d2bc7ec468dc", "url": "https://github.com/apache/skywalking/commit/251c9c278c24a365eb6a03575951d2bc7ec468dc", "message": "remove unnecessary getter and setter package declare", "committedDate": "2020-05-10T13:53:37Z", "type": "commit"}, {"oid": "e1afb09d34c007e7369f2a5d0d73ac54d8731a14", "url": "https://github.com/apache/skywalking/commit/e1afb09d34c007e7369f2a5d0d73ac54d8731a14", "message": "remove unnecessary fields", "committedDate": "2020-05-10T13:55:33Z", "type": "commit"}]}