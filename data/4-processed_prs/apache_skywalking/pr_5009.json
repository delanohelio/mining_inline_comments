{"pr_number": 5009, "pr_title": "Java agent memory leak when enhance `Worker thread` at use Thread Pool", "pr_createdAt": "2020-07-01T16:23:02Z", "pr_url": "https://github.com/apache/skywalking/pull/5009", "timeline": [{"oid": "1d481d6b2a62a99b02ccd7b097c242251ed4f2b5", "url": "https://github.com/apache/skywalking/commit/1d481d6b2a62a99b02ccd7b097c242251ed4f2b5", "message": "**Java agent memory leak** when enhance `Worker thread` at use Thread Pool FAQ", "committedDate": "2020-07-01T16:18:50Z", "type": "commit"}, {"oid": "a07d33ea93cc8defd6082ca0b59b7975d2078d86", "url": "https://github.com/apache/skywalking/commit/a07d33ea93cc8defd6082ca0b59b7975d2078d86", "message": "Merge commit '1817386391fa01c436437e098f32447f1209d6f4' into zhaoyuguang/zhaoyuguang_001\n\n# Conflicts:\n#\tdocs/en/FAQ/README.md", "committedDate": "2020-07-01T16:29:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY3NTMxNw==", "url": "https://github.com/apache/skywalking/pull/5009#discussion_r448675317", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Checked SkyWalking Thread Schedule Framework at [SkyWalking Java agent supported list](../setup/service-agent/java-agent/Supported-list.md), such as Spring FrameWork @Async, such as Spring @Async, which can implement tracing without any modification. \n          \n          \n            \n            Checked SkyWalking Thread Schedule Framework at [SkyWalking Java agent supported list](../setup/service-agent/java-agent/Supported-list.md), such as Spring FrameWork @Async, which can implement tracing without any modification.", "author": "wu-sheng", "createdAt": "2020-07-01T23:57:43Z", "path": "docs/en/FAQ/Memory-leak-enhance-Worker-thread.md", "diffHunk": "@@ -0,0 +1,32 @@\n+### Problem \n+When using a thread pool, `TraceSegment` data in a thread cannot be reported and there are memory data that cannot be recycled (memory leaks)\n+\n+### Example\n+``` java\n+    ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();\n+    executor.setThreadFactory(r -> new Thread(RunnableWrapper.of(r)));\n+```\n+\n+### Reason\n+\n+* Worker threads are enhanced, when using thread pool. \n+* According to the SkyWalking Java Agent design, when you want to trace cross thread, you need to enhance the task thread.\n+\n+### Resolve\n+\n+* When using `Thread Schedule Framework`\n+Checked SkyWalking Thread Schedule Framework at [SkyWalking Java agent supported list](../setup/service-agent/java-agent/Supported-list.md), such as Spring FrameWork @Async, such as Spring @Async, which can implement tracing without any modification. ", "originalCommit": "a07d33ea93cc8defd6082ca0b59b7975d2078d86", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY4MjA4NQ==", "url": "https://github.com/apache/skywalking/pull/5009#discussion_r448682085", "bodyText": "fixed", "author": "zhaoyuguang", "createdAt": "2020-07-02T00:23:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY3NTMxNw=="}], "type": "inlineReview"}, {"oid": "ad804c69feddee8d3550e13fb429aaece4b658e5", "url": "https://github.com/apache/skywalking/commit/ad804c69feddee8d3550e13fb429aaece4b658e5", "message": "fixed", "committedDate": "2020-07-02T00:23:15Z", "type": "commit"}]}