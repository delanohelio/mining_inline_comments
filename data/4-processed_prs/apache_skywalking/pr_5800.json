{"pr_number": 5800, "pr_title": "ALS analyzer based on Envoy metadata exchange", "pr_createdAt": "2020-11-05T16:07:12Z", "pr_url": "https://github.com/apache/skywalking/pull/5800", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODIxMDM5Mw==", "url": "https://github.com/apache/skywalking/pull/5800#discussion_r518210393", "bodyText": "NULL_DEREFERENCE:  object kv last assigned on line 53 could be null and is dereferenced at line 54.", "author": "sonatype-lift", "createdAt": "2020-11-05T17:02:41Z", "path": "oap-server/server-receiver-plugin/envoy-metrics-receiver-plugin/src/main/java/org/apache/skywalking/oap/server/receiver/envoy/als/mx/ServiceMetaInfoAdapter.java", "diffHunk": "@@ -0,0 +1,82 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.oap.server.receiver.envoy.als.mx;\n+\n+import com.google.protobuf.Any;\n+import com.google.protobuf.ByteString;\n+import com.google.protobuf.BytesValue;\n+import com.google.protobuf.Struct;\n+import java.nio.ByteBuffer;\n+import java.util.Optional;\n+import lombok.RequiredArgsConstructor;\n+import lombok.extern.slf4j.Slf4j;\n+import org.apache.skywalking.oap.server.receiver.envoy.als.ServiceMetaInfo;\n+import Wasm.Common.FlatNode;\n+import Wasm.Common.KeyVal;\n+\n+import static java.util.Objects.requireNonNull;\n+\n+/**\n+ * Adapter to {@link ServiceMetaInfo} from various of other datastructures.\n+ */\n+@Slf4j\n+@RequiredArgsConstructor\n+public class ServiceMetaInfoAdapter extends ServiceMetaInfo {\n+\n+    /**\n+     * Try to adapt a {@link ByteString} to {@link ServiceMetaInfo} instance.\n+     *\n+     * @param bv the {@link ByteString byte string} to adapt from.\n+     * @throws Exception if the {@link ByteString byte string} can not be adapted to a {@link ServiceMetaInfo}.\n+     */\n+    public ServiceMetaInfoAdapter(final ByteString bv) throws Exception {\n+        final ByteBuffer buffer = ByteBuffer.wrap(BytesValue.parseFrom(bv).getValue().toByteArray());\n+        final FlatNode flatNode = FlatNode.getRootAsFlatNode(buffer);\n+        if (log.isDebugEnabled()) {\n+            for (int i = 0; i < flatNode.labelsLength(); i++) {\n+                KeyVal kv = flatNode.labels(i);\n+                log.debug(\"wasm label: {} : {}\", kv.key(), kv.value());", "originalCommit": "b1a49bf8b77497ca01ef79bd8491f62a3e79fb56", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODQ0MzYwNw==", "url": "https://github.com/apache/skywalking/pull/5800#discussion_r518443607", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            3. Active ALS analyzer, there are two available analyzers, `k8s-mesh` and `mx-mesh`, `k8s-mesh` will use the metadata from Kubernetes cluster, `mx-mesh` will use the Envoy metadata exchange mechanism to get the service name, etc., set system env variable `SW_ENVOY_METRIC_ALS_HTTP_ANALYSIS=k8s-mesh`\n          \n          \n            \n            3. Active ALS analyzer, there are two available analyzers, `k8s-mesh` and `mx-mesh`, `k8s-mesh` uses the metadata from Kubernetes cluster, `mx-mesh` uses the Envoy metadata exchange mechanism to get the service name, etc.. Setting system env variable **SW_ENVOY_METRIC_ALS_HTTP_ANALYSIS** to activate the analyzer, such as `SW_ENVOY_METRIC_ALS_HTTP_ANALYSIS=k8s-mesh`.", "author": "wu-sheng", "createdAt": "2020-11-06T00:01:04Z", "path": "docs/en/setup/envoy/als_setting.md", "diffHunk": "@@ -19,7 +19,7 @@ You need three steps to open ALS.\n     Note: SkyWalking OAP service is at skywalking namespace, and the port of gRPC service is 11800\n     \n 2. (Default is ACTIVATED) Activate SkyWalking [envoy receiver](../backend/backend-receivers.md). \n-3. Active ALS k8s-mesh analysis, set system env variable `SW_ENVOY_METRIC_ALS_HTTP_ANALYSIS`=`k8s-mesh`\n+3. Active ALS analyzer, there are two available analyzers, `k8s-mesh` and `mx-mesh`, `k8s-mesh` will use the metadata from Kubernetes cluster, `mx-mesh` will use the Envoy metadata exchange mechanism to get the service name, etc., set system env variable `SW_ENVOY_METRIC_ALS_HTTP_ANALYSIS=k8s-mesh`", "originalCommit": "f67f8432209a6be4fcd1310d81299c53567caa60", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODQ0NDQwMA==", "url": "https://github.com/apache/skywalking/pull/5800#discussion_r518444400", "bodyText": "You copied this file from Istio, right? You should update the LICENSE of source codes, like the proto files we copied.", "author": "wu-sheng", "createdAt": "2020-11-06T00:03:30Z", "path": "oap-server/server-receiver-plugin/receiver-proto/src/main/fbs/istio/node-info.fbs", "diffHunk": "@@ -0,0 +1,48 @@\n+/* Copyright 2020 Istio Authors. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */", "originalCommit": "f67f8432209a6be4fcd1310d81299c53567caa60", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODYzNTIyMw==", "url": "https://github.com/apache/skywalking/pull/5800#discussion_r518635223", "bodyText": "Can you please kindly recheck?", "author": "kezhenxu94", "createdAt": "2020-11-06T09:44:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODQ0NDQwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODc5MTMwNA==", "url": "https://github.com/apache/skywalking/pull/5800#discussion_r518791304", "bodyText": "The license is clear. Just recommend enhancing the documentation about open ALS and metadata exchange activation.\nEven in the demo, it is activated in default, we need to highlight that, and reference to the e2e.", "author": "wu-sheng", "createdAt": "2020-11-06T14:37:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODQ0NDQwMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODQ0NDg5Ng==", "url": "https://github.com/apache/skywalking/pull/5800#discussion_r518444896", "bodyText": "Why we are adding package-info for now?", "author": "wu-sheng", "createdAt": "2020-11-06T00:05:00Z", "path": "oap-server/server-receiver-plugin/envoy-metrics-receiver-plugin/src/main/java/org/apache/skywalking/oap/server/receiver/envoy/als/mx/package-info.java", "diffHunk": "@@ -0,0 +1,24 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+/**\n+ * {@link org.apache.skywalking.oap.server.receiver.envoy.als.ALSHTTPAnalysis} implementation\n+ * based on the Envoy metadata exchange.\n+ */\n+\n+package org.apache.skywalking.oap.server.receiver.envoy.als.mx;", "originalCommit": "f67f8432209a6be4fcd1310d81299c53567caa60", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODYzNTYwNA==", "url": "https://github.com/apache/skywalking/pull/5800#discussion_r518635604", "bodyText": "Thought it was a good practice, but finally realize that we don't emphasize too much about the JavaDoc, this makes not much sense, deleted", "author": "kezhenxu94", "createdAt": "2020-11-06T09:45:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODQ0NDg5Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODQ0NjYyMg==", "url": "https://github.com/apache/skywalking/pull/5800#discussion_r518446622", "bodyText": "I only note this difference between the two analyzers. But is the meta exchange active in default in Istio? I remember it isn't. At the same time, I can't see when do you activate it.", "author": "wu-sheng", "createdAt": "2020-11-06T00:10:19Z", "path": ".github/workflows/e2e.istio.yaml", "diffHunk": "@@ -73,7 +77,7 @@ jobs:\n                --set elasticsearch.replicas=1 \\\n                --set elasticsearch.minimumMasterNodes=1 \\\n                --set elasticsearch.imageTag=7.5.1 \\\n-               --set oap.env.SW_ENVOY_METRIC_ALS_HTTP_ANALYSIS=k8s-mesh \\\n+               --set oap.env.SW_ENVOY_METRIC_ALS_HTTP_ANALYSIS=${{ matrix.analyzer }} \\", "originalCommit": "f67f8432209a6be4fcd1310d81299c53567caa60", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODc4NzczNA==", "url": "https://github.com/apache/skywalking/pull/5800#discussion_r518787734", "bodyText": "Because metadataExchange is enabled when telemetry.v2 is enabled, and telemetry.v2 is enable by default in the demo profile, we install Istio with profile=demo, hence metadataExchange is enabled too", "author": "kezhenxu94", "createdAt": "2020-11-06T14:31:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODQ0NjYyMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODQ5MzgyMg==", "url": "https://github.com/apache/skywalking/pull/5800#discussion_r518493822", "bodyText": "Here we should note the commit SHA of this file located at istio repo. and a tool or shell to update it based on this SHA.", "author": "hanahmily", "createdAt": "2020-11-06T02:51:50Z", "path": "oap-server/server-receiver-plugin/receiver-proto/src/main/fbs/istio/node-info.fbs", "diffHunk": "@@ -0,0 +1,48 @@\n+/* Copyright 2020 Istio Authors. All Rights Reserved.", "originalCommit": "f67f8432209a6be4fcd1310d81299c53567caa60", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODUwOTU2NA==", "url": "https://github.com/apache/skywalking/pull/5800#discussion_r518509564", "bodyText": "and a tool or shell to update it based on this SHA.\n\nDoing that means we want to download the file on the fly, do we still need the license for this? @wu-sheng we don't include that in source distribution then, it will be downloaded when compiling.", "author": "kezhenxu94", "createdAt": "2020-11-06T03:57:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODQ5MzgyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODUxNDI1Mg==", "url": "https://github.com/apache/skywalking/pull/5800#discussion_r518514252", "bodyText": "@wu-sheng \ud83d\udc46", "author": "kezhenxu94", "createdAt": "2020-11-06T04:17:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODQ5MzgyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODUxNTUzNQ==", "url": "https://github.com/apache/skywalking/pull/5800#discussion_r518515535", "bodyText": "What is the size of downloading. I assume this would make compiling more unstable, especially in China.", "author": "wu-sheng", "createdAt": "2020-11-06T04:22:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODQ5MzgyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODUxNjc5NQ==", "url": "https://github.com/apache/skywalking/pull/5800#discussion_r518516795", "bodyText": "What is the size of downloading. I assume this would make compiling more unstable, especially in China.\n\n1.6KB, we only download that single file with a specific commit SHA", "author": "kezhenxu94", "createdAt": "2020-11-06T04:28:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODQ5MzgyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODUxOTQxMw==", "url": "https://github.com/apache/skywalking/pull/5800#discussion_r518519413", "bodyText": "Is it possible to download this single one file?", "author": "wu-sheng", "createdAt": "2020-11-06T04:39:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODQ5MzgyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODUyMDIzMg==", "url": "https://github.com/apache/skywalking/pull/5800#discussion_r518520232", "bodyText": "Yes, I'll configure a maven phase to download this before compiling, with a URL format like this, the commit SHA is a property that can be specified (the necessity needs discussion though) https://raw.githubusercontent.com/istio/proxy/94a7d9942aa8181f688933cb265879d59a0d85dd/extensions/common/node_info.fbs", "author": "kezhenxu94", "createdAt": "2020-11-06T04:43:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODQ5MzgyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODUyMDg5Ng==", "url": "https://github.com/apache/skywalking/pull/5800#discussion_r518520896", "bodyText": "This path is not accessable from some people, if I remember correctly. I mean githubusercontent.com", "author": "wu-sheng", "createdAt": "2020-11-06T04:46:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODQ5MzgyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODU5MjY2NA==", "url": "https://github.com/apache/skywalking/pull/5800#discussion_r518592664", "bodyText": "If that's the case, I'm afraid we have to clone the repo just for that one file. @hanahmily can you elaborate more about why we need an update mechanism to this file? What makes it different from the other files that we copied from, like Envoy, Jaeger, etc.?", "author": "kezhenxu94", "createdAt": "2020-11-06T08:27:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODQ5MzgyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODU5MzUzMw==", "url": "https://github.com/apache/skywalking/pull/5800#discussion_r518593533", "bodyText": "I am totally fine with the copy and LICENSE change. This file is for sharing, nothing to concern from my understanding. I have many proto files copied from istio/envoy/...", "author": "wu-sheng", "createdAt": "2020-11-06T08:29:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODQ5MzgyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODYzNjMxOQ==", "url": "https://github.com/apache/skywalking/pull/5800#discussion_r518636319", "bodyText": "I'll just keep it as is, unless @hanahmily give a real use case where we need it", "author": "kezhenxu94", "createdAt": "2020-11-06T09:46:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODQ5MzgyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQyNzU0Nw==", "url": "https://github.com/apache/skywalking/pull/5800#discussion_r519427547", "bodyText": "Could you leave a comment that implies the location and commit sha? It is too tricky to maintain the codes without them even though the original contributor like you doesn't figure it out after several months.\nSyncing is a more complicated topic, as there are a lot of unversioned protocol files in the repo, need to be discussed further.", "author": "hanahmily", "createdAt": "2020-11-08T15:05:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODQ5MzgyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQyOTY1NQ==", "url": "https://github.com/apache/skywalking/pull/5800#discussion_r519429655", "bodyText": "Could you leave a comment that implies the location and commit sha? It is too tricky to maintain the codes without them even though the original contributor like you doesn't figure it out after several months.\nSyncing is a more complicated topic, as there are a lot of unversioned protocol files in the repo, need to be discussed further.\n\nComment is added", "author": "kezhenxu94", "createdAt": "2020-11-08T15:11:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODQ5MzgyMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODQ5NDQ5Mw==", "url": "https://github.com/apache/skywalking/pull/5800#discussion_r518494493", "bodyText": "Could you enhancement this expression to support naming rules just like k8s analysis?", "author": "hanahmily", "createdAt": "2020-11-06T02:54:16Z", "path": "oap-server/server-bootstrap/src/main/resources/metadata-service-mapping.yaml", "diffHunk": "@@ -0,0 +1,17 @@\n+# Licensed to the Apache Software Foundation (ASF) under one or more\n+# contributor license agreements.  See the NOTICE file distributed with\n+# this work for additional information regarding copyright ownership.\n+# The ASF licenses this file to You under the Apache License, Version 2.0\n+# (the \"License\"); you may not use this file except in compliance with\n+# the License.  You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+serviceName: LABELS.app", "originalCommit": "f67f8432209a6be4fcd1310d81299c53567caa60", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODYzNjQ1Nw==", "url": "https://github.com/apache/skywalking/pull/5800#discussion_r518636457", "bodyText": "DONE", "author": "kezhenxu94", "createdAt": "2020-11-06T09:46:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODQ5NDQ5Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODQ5NTA3OA==", "url": "https://github.com/apache/skywalking/pull/5800#discussion_r518495078", "bodyText": "Could you mention mx-mesh dependencies istio  metadata exchange filter?", "author": "hanahmily", "createdAt": "2020-11-06T02:56:21Z", "path": "docs/en/setup/envoy/als_setting.md", "diffHunk": "@@ -19,7 +19,7 @@ You need three steps to open ALS.\n     Note: SkyWalking OAP service is at skywalking namespace, and the port of gRPC service is 11800\n     \n 2. (Default is ACTIVATED) Activate SkyWalking [envoy receiver](../backend/backend-receivers.md). \n-3. Active ALS k8s-mesh analysis, set system env variable `SW_ENVOY_METRIC_ALS_HTTP_ANALYSIS`=`k8s-mesh`\n+3. Active ALS analyzer, there are two available analyzers, `k8s-mesh` and `mx-mesh`, `k8s-mesh` will use the metadata from Kubernetes cluster, `mx-mesh` will use the Envoy metadata exchange mechanism to get the service name, etc., set system env variable `SW_ENVOY_METRIC_ALS_HTTP_ANALYSIS=k8s-mesh`", "originalCommit": "f67f8432209a6be4fcd1310d81299c53567caa60", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODQ5ODQzOA==", "url": "https://github.com/apache/skywalking/pull/5800#discussion_r518498438", "bodyText": "#5800 (comment) I asked too. How to open metadata exchange through Istio should be highlighted.", "author": "wu-sheng", "createdAt": "2020-11-06T03:09:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODQ5NTA3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODYzNjY2NA==", "url": "https://github.com/apache/skywalking/pull/5800#discussion_r518636664", "bodyText": "Could you mention mx-mesh dependencies istio metadata exchange filter?\n\nDONE", "author": "kezhenxu94", "createdAt": "2020-11-06T09:47:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODQ5NTA3OA=="}], "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": "77e0d38e81717df16dacb17557ee355886cb2728", "url": "https://github.com/apache/skywalking/commit/77e0d38e81717df16dacb17557ee355886cb2728", "message": "ALS analyzer based on Envoy metadata exchange", "committedDate": "2020-11-06T14:38:18Z", "type": "commit"}, {"oid": "77e0d38e81717df16dacb17557ee355886cb2728", "url": "https://github.com/apache/skywalking/commit/77e0d38e81717df16dacb17557ee355886cb2728", "message": "ALS analyzer based on Envoy metadata exchange", "committedDate": "2020-11-06T14:38:18Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODc5NzAyNA==", "url": "https://github.com/apache/skywalking/pull/5800#discussion_r518797024", "bodyText": "1.7+ enabled in default? If so, good to me.", "author": "wu-sheng", "createdAt": "2020-11-06T14:46:14Z", "path": "docs/en/setup/envoy/als_setting.md", "diffHunk": "@@ -19,7 +19,14 @@ You need three steps to open ALS.\n     Note: SkyWalking OAP service is at skywalking namespace, and the port of gRPC service is 11800\n     \n 2. (Default is ACTIVATED) Activate SkyWalking [envoy receiver](../backend/backend-receivers.md). \n-3. Active ALS k8s-mesh analysis, set system env variable `SW_ENVOY_METRIC_ALS_HTTP_ANALYSIS`=`k8s-mesh`\n+3. Active ALS analyzer, there are two available analyzers, `k8s-mesh` and `mx-mesh`,\n+`k8s-mesh` uses the metadata from Kubernetes cluster, hence in this analyzer OAP needs access roles to `Pod`, `Service`, and `Endpoints`;\n+`mx-mesh` uses the Envoy metadata exchange mechanism to get the service name, etc.,\n+this analyzer requires Istio to enable the metadata exchange filter(you can enable it by\n+`--set telemetry.v2.enabled=true`, or if you're using Istio 1.7+ and installing it with profile `demo`/`preview`,", "originalCommit": "77e0d38e81717df16dacb17557ee355886cb2728", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "c7445e05f8f5cd7eeabde7fde612b2086e1031f6", "url": "https://github.com/apache/skywalking/commit/c7445e05f8f5cd7eeabde7fde612b2086e1031f6", "message": "Merge branch 'master' into feature/als-mx", "committedDate": "2020-11-07T09:25:45Z", "type": "commit"}, {"oid": "24cadacafe02c9fb06b73e5f24c6e1e2a15f0d18", "url": "https://github.com/apache/skywalking/commit/24cadacafe02c9fb06b73e5f24c6e1e2a15f0d18", "message": "Merge branch 'master' into feature/als-mx", "committedDate": "2020-11-07T12:35:20Z", "type": "commit"}, {"oid": "17a0f3c4001f415806d92878ded4bb4819962781", "url": "https://github.com/apache/skywalking/commit/17a0f3c4001f415806d92878ded4bb4819962781", "message": "Merge branch 'master' into feature/als-mx", "committedDate": "2020-11-07T13:41:00Z", "type": "commit"}, {"oid": "6644cd4d65898880b9ff13b22876b95a94383ef9", "url": "https://github.com/apache/skywalking/commit/6644cd4d65898880b9ff13b22876b95a94383ef9", "message": "Merge branch 'master' into feature/als-mx", "committedDate": "2020-11-08T01:42:10Z", "type": "commit"}, {"oid": "4444a6f3364cd9352922e7902bfb38fe20255230", "url": "https://github.com/apache/skywalking/commit/4444a6f3364cd9352922e7902bfb38fe20255230", "message": "Add module manager to analyzer initialization for use", "committedDate": "2020-11-08T09:51:18Z", "type": "commit"}, {"oid": "80eba738642ca748a2008416be51eb548def4879", "url": "https://github.com/apache/skywalking/commit/80eba738642ca748a2008416be51eb548def4879", "message": "Address the review comment to add original file location", "committedDate": "2020-11-08T15:11:19Z", "type": "commit"}]}