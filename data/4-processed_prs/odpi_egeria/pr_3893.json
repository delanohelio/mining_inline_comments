{"pr_number": 3893, "pr_title": "Add static content server to fix ui server chassis in k8s environment", "pr_createdAt": "2020-10-15T16:42:49Z", "pr_url": "https://github.com/odpi/egeria/pull/3893", "timeline": [{"oid": "2e7d6df5995e6c17dc69f36d734699db3e9c727d", "url": "https://github.com/odpi/egeria/commit/2e7d6df5995e6c17dc69f36d734699db3e9c727d", "message": "#3884 add static content server for polymer UI\n\nSigned-off-by: Nigel Jones <nigel.l.jones+git@gmail.com>", "committedDate": "2020-10-14T14:11:18Z", "type": "commit"}, {"oid": "ac771274f9c17c1ce75148d5863f78b5a383c4eb", "url": "https://github.com/odpi/egeria/commit/ac771274f9c17c1ce75148d5863f78b5a383c4eb", "message": "#3884 Add docker build from git of egeria-ui component\n\nSigned-off-by: Nigel Jones <nigel.l.jones+git@gmail.com>", "committedDate": "2020-10-14T15:24:03Z", "type": "commit"}, {"oid": "ef2ec91c3bf05c3f6086c9309397c0023249e46f", "url": "https://github.com/odpi/egeria/commit/ef2ec91c3bf05c3f6086c9309397c0023249e46f", "message": "#3884 add static content server to lab helm chart\n\nSigned-off-by: Nigel Jones <nigel.l.jones+git@gmail.com>", "committedDate": "2020-10-14T15:56:34Z", "type": "commit"}, {"oid": "4e2ffe6505b8382b43907fe8b7d2ce0c00fa1a1b", "url": "https://github.com/odpi/egeria/commit/4e2ffe6505b8382b43907fe8b7d2ce0c00fa1a1b", "message": "Merge branch 'master' of https://github.com/odpi/egeria into issue3884", "committedDate": "2020-10-14T16:37:22Z", "type": "commit"}, {"oid": "19c0057fe1a090ac39689863cedb1ee4d47c5763", "url": "https://github.com/odpi/egeria/commit/19c0057fe1a090ac39689863cedb1ee4d47c5763", "message": "#3884 add static server to lab helm chart\n;\n\nSigned-off-by: Nigel Jones <nigel.l.jones+git@gmail.com>", "committedDate": "2020-10-14T17:50:00Z", "type": "commit"}, {"oid": "929c8e4321b8c03cc3f2ad5587df153a18607bd5", "url": "https://github.com/odpi/egeria/commit/929c8e4321b8c03cc3f2ad5587df153a18607bd5", "message": "#3884 remove explicit polymer install - no longer needed\n\nSigned-off-by: Nigel Jones <nigel.l.jones+git@gmail.com>", "committedDate": "2020-10-15T13:16:09Z", "type": "commit"}, {"oid": "be66eae8157d0283e3879f0ff882a8f4407dce09", "url": "https://github.com/odpi/egeria/commit/be66eae8157d0283e3879f0ff882a8f4407dce09", "message": "#3884 Switch source of content for egeria ui static from dev to prod\n\nSigned-off-by: Nigel Jones <nigel.l.jones+git@gmail.com>", "committedDate": "2020-10-15T13:20:53Z", "type": "commit"}, {"oid": "b0a4d80c30001e5c36f10f05a0d355166c60a37d", "url": "https://github.com/odpi/egeria/commit/b0a4d80c30001e5c36f10f05a0d355166c60a37d", "message": "Merge branch 'master' of https://github.com/odpi/egeria into issue3884", "committedDate": "2020-10-15T16:36:35Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjEwNDI2Nw==", "url": "https://github.com/odpi/egeria/pull/3893#discussion_r506104267", "bodyText": "@planetf1 why is maven needed for this?", "author": "sarbull", "createdAt": "2020-10-16T07:02:20Z", "path": "open-metadata-resources/open-metadata-deployment/docker/egeria-uistatic/pom.xml", "diffHunk": "@@ -0,0 +1,146 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!-- SPDX-License-Identifier: Apache-2.0 -->\n+<!-- Copyright Contributors to the ODPi Egeria project. -->\n+\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+\n+    <parent>\n+        <artifactId>open-metadata-docker</artifactId>\n+        <groupId>org.odpi.egeria</groupId>\n+        <version>2.4-SNAPSHOT</version>\n+    </parent>\n+\n+    <modelVersion>4.0.0</modelVersion>\n+\n+    <scm>\n+        <connection>scm:git:git://github.com/odpi/egeria.git</connection>\n+        <developerConnection>scm:git:ssh://github.com/odpi/egeria.git</developerConnection>\n+        <url>http://github.com/odpi/egeria/tree/master</url>\n+    </scm>\n+\n+    <name>Docker image - Configuration</name>\n+    <description>\n+        Samples, Helm charts to configure Egeria and associated components such as docker image build scripts\n+    </description>\n+\n+    <artifactId>open-metadata-docker-uistatic</artifactId>\n+\n+    <packaging>pom</packaging>\n+    <build>\n+        <plugins>\n+            <plugin>\n+                <groupId>pl.project13.maven</groupId>\n+                <artifactId>git-commit-id-plugin</artifactId>\n+                <executions>\n+                    <execution>\n+                        <id>get git version info</id>\n+                        <goals>\n+                            <goal>revision</goal>\n+                        </goals>\n+                        <phase>initialize</phase>\n+                    </execution>\n+                </executions>\n+                <configuration>\n+                    <dotGitDirectory>${maven.multiModuleProjectDirectory}/.git</dotGitDirectory>\n+                    <prefix>git</prefix>\n+                    <dateFormatTimeZone>UTC</dateFormatTimeZone>\n+                    <skipPoms>false</skipPoms>\n+                </configuration>\n+            </plugin>\n+\n+            <!-- Setup the docker build.\n+                 Note - bound to 'install' phase as deploy causes push of maven artifacts\n+            -->\n+            <plugin>\n+                <groupId>com.spotify</groupId>\n+                <artifactId>dockerfile-maven-plugin</artifactId>\n+                <executions>\n+                    <execution>\n+                        <id>build-and-tag-latest</id>\n+                        <phase>install</phase>\n+                        <goals>\n+                            <goal>build</goal>\n+                        </goals>\n+                        <configuration>\n+                            <tag>${project.version}</tag>\n+                        </configuration>\n+                    </execution>\n+                    <execution>\n+                        <id>tag-version</id>\n+                        <phase>install</phase>\n+                        <goals>\n+                            <goal>tag</goal>\n+                        </goals>\n+                        <configuration>\n+                            <tag>${project.version}</tag>\n+                        </configuration>\n+                    </execution>\n+\n+                    <execution>\n+                        <id>push-version</id>\n+                        <phase>install</phase>\n+                        <goals>\n+                            <goal>push</goal>\n+                        </goals>\n+                        <configuration>\n+                            <tag>${project.version}</tag>\n+                        </configuration>\n+                    </execution>\n+                </executions>\n+                <configuration>\n+                    <repository>${docker.registry}/${docker.repo}/egeria-uistatic</repository>\n+                    <buildArgs>\n+                        <VCS_REF>${git.commit.id.describe}</VCS_REF>\n+                        <VCS_DATE>${git.commit.time}</VCS_DATE>\n+                        <BUILD_TIME>${git.build.time}</BUILD_TIME>\n+                        <VCS_ORIGIN>${git.remote.origin.url}</VCS_ORIGIN>\n+                    </buildArgs>\n+                </configuration>\n+            </plugin>\n+        </plugins>\n+    </build>\n+\n+    <profiles>\n+        <profile>\n+            <id>tag-latest</id>\n+            <activation>\n+                <property>\n+                    <name>docker.taglatest</name>\n+                </property>\n+            </activation>\n+            <build>\n+                <plugins>\n+                    <plugin>\n+                        <groupId>com.spotify</groupId>\n+                        <artifactId>dockerfile-maven-plugin</artifactId>\n+                        <executions>\n+                            <execution>\n+                                <id>tag-latest</id>\n+                                <phase>install</phase>\n+                                <goals>\n+                                    <goal>tag</goal>\n+                                </goals>\n+                                <configuration>\n+                                    <tag>latest</tag>\n+                                </configuration>\n+                            </execution>\n+                            <execution>\n+                                <id>push-latest</id>\n+                                <phase>install</phase>\n+                                <goals>\n+                                    <goal>push</goal>\n+                                </goals>\n+                                <configuration>\n+                                    <tag>latest</tag>\n+                                </configuration>\n+                            </execution>\n+                        </executions>\n+                    </plugin>\n+                </plugins>\n+            </build>\n+        </profile>\n+    </profiles>\n+\n+</project>", "originalCommit": "b0a4d80c30001e5c36f10f05a0d355166c60a37d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjEyNjgzMg==", "url": "https://github.com/odpi/egeria/pull/3893#discussion_r506126832", "bodyText": "Only because that is how we currently drive all our docker builds, and we already have the build pipelines setup. In some of the images we also have to retrieve files from other maven artifacts in the build, which the maven resources plugin manages. For example the main egeria image needs the assembly we create which aggregates content from many of our modules together for deployment.\nThere is no intrinsic need to use maven to build docker, and indeed it adds extra complexity. As we move images OUT of the main repo (atlas, ranger, as well as this ui) I don't see a need to use maven, though we may keep it for the base.\nI wanted to get something in and working quickly ... so to to stabilize master. Incremental changes, improving/fixing gradually. Then work on improvements. One of those is that I think the build of the image should be done from sources within the egeria-ui project -- and we can have a simple build pipeline potentially that just uses the Dockerfile directly. That way we can easily trigger off changes and keep the image updated.", "author": "planetf1", "createdAt": "2020-10-16T07:35:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjEwNDI2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjEyOTU4MQ==", "url": "https://github.com/odpi/egeria/pull/3893#discussion_r506129581", "bodyText": "i see, i have no problem with that, agree. i was imagining that the Dockerfile would be in the odpi/egeria-ui repository, but for the quickest way of stabilizing the master looks awesome so far, great work!", "author": "sarbull", "createdAt": "2020-10-16T07:39:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjEwNDI2Nw=="}], "type": "inlineReview"}, {"oid": "120fa415fb85c3ca33abe160030c540c69caac1e", "url": "https://github.com/odpi/egeria/commit/120fa415fb85c3ca33abe160030c540c69caac1e", "message": "#3884 correct zuul proxy url configuratino in odpi-egeria-lab chart\n\nSigned-off-by: Nigel Jones <nigel.l.jones+git@gmail.com>", "committedDate": "2020-10-16T11:16:33Z", "type": "commit"}, {"oid": "e2809c14a15b9fc4d4be7fad1b1e07f8595819fa", "url": "https://github.com/odpi/egeria/commit/e2809c14a15b9fc4d4be7fad1b1e07f8595819fa", "message": "#3884 Add static content for egeria ui to docker compose\n\nSigned-off-by: Nigel Jones <nigel.l.jones+git@gmail.com>", "committedDate": "2020-10-16T12:29:55Z", "type": "commit"}, {"oid": "b216e9c75545959364dc263c98f612c8c7631d21", "url": "https://github.com/odpi/egeria/commit/b216e9c75545959364dc263c98f612c8c7631d21", "message": "Merge branch 'master' of https://github.com/odpi/egeria into issue3884", "committedDate": "2020-10-16T12:30:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjM2OTQwMA==", "url": "https://github.com/odpi/egeria/pull/3893#discussion_r506369400", "bodyText": "is this ok?", "author": "sarbull", "createdAt": "2020-10-16T12:37:00Z", "path": "open-metadata-resources/open-metadata-deployment/compose/tutorials/.env", "diffHunk": "@@ -4,7 +4,7 @@\n # Version of egeria to use\n egeria_version=2.4-SNAPSHOT\n # Override if you wish to use images other than from docker hub odpi/egeria etc\n-egeria_repo=odpi\n+egeria_repo=planetf1", "originalCommit": "e2809c14a15b9fc4d4be7fad1b1e07f8595819fa", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjM5MzA1NA==", "url": "https://github.com/odpi/egeria/pull/3893#discussion_r506393054", "bodyText": "should have the HTTPS port also", "author": "sarbull", "createdAt": "2020-10-16T13:06:13Z", "path": "open-metadata-resources/open-metadata-deployment/docker/egeria-uistatic/dist/nginx.conf", "diffHunk": "@@ -0,0 +1,15 @@\n+# SPDX-License-Identifier: Apache-2.0\n+# Copyright Contributors to the Egeria project\n+\n+server {\n+    listen 80;", "originalCommit": "b216e9c75545959364dc263c98f612c8c7631d21", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjQxMjMyNA==", "url": "https://github.com/odpi/egeria/pull/3893#discussion_r506412324", "bodyText": "Agreed should look at https. I'll get this in & then let's catch changes in another iteration through? Means anyone using the charts etc in master can be working again whilst we refine. I think that nginx config needs more refinement too", "author": "planetf1", "createdAt": "2020-10-16T13:22:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjM5MzA1NA=="}], "type": "inlineReview"}]}