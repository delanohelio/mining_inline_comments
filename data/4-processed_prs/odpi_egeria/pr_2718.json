{"pr_number": 2718, "pr_title": "Asset Lineage OMAS: Reclassify, Declassify", "pr_createdAt": "2020-03-08T16:09:09Z", "pr_url": "https://github.com/odpi/egeria/pull/2718", "timeline": [{"oid": "45e1b3ddadca6f2e49438ba1788a96fab9703172", "url": "https://github.com/odpi/egeria/commit/45e1b3ddadca6f2e49438ba1788a96fab9703172", "message": "AL omas: reclassify\n\nSigned-off-by: Guy Ackermans <guy.ackermans92@gmail.com>", "committedDate": "2020-02-25T15:07:58Z", "type": "commit"}, {"oid": "e8c500edee8a4f09fb7715bcc0b92e22309b4b29", "url": "https://github.com/odpi/egeria/commit/e8c500edee8a4f09fb7715bcc0b92e22309b4b29", "message": "classification wip\n\nSigned-off-by: Guy Ackermans <guy.ackermans92@gmail.com>", "committedDate": "2020-02-27T14:56:02Z", "type": "commit"}, {"oid": "7c982e84bc4b85bffbd0199a0ccf5e7ebce95946", "url": "https://github.com/odpi/egeria/commit/7c982e84bc4b85bffbd0199a0ccf5e7ebce95946", "message": "wip\n\nSigned-off-by: Guy Ackermans <guy.ackermans92@gmail.com>", "committedDate": "2020-02-28T10:46:58Z", "type": "commit"}, {"oid": "92d388a18af4520de2859976626631dd57907135", "url": "https://github.com/odpi/egeria/commit/92d388a18af4520de2859976626631dd57907135", "message": "wip\n\nSigned-off-by: Guy Ackermans <guy.ackermans92@gmail.com>", "committedDate": "2020-02-28T11:13:46Z", "type": "commit"}, {"oid": "523c6672c1744e6bcfeafce1b9802c780a5b241e", "url": "https://github.com/odpi/egeria/commit/523c6672c1744e6bcfeafce1b9802c780a5b241e", "message": "Merge branch 'master' of https://github.com/odpi/egeria into classifications", "committedDate": "2020-02-28T11:14:00Z", "type": "commit"}, {"oid": "cfc2e0a4c581ddad75cc624f70a9f797ff9632f8", "url": "https://github.com/odpi/egeria/commit/cfc2e0a4c581ddad75cc624f70a9f797ff9632f8", "message": "WIP\n\nSigned-off-by: Guy Ackermans <guy.ackermans92@gmail.com>", "committedDate": "2020-02-28T17:26:23Z", "type": "commit"}, {"oid": "676da94578e826e650231c63f987a5daa0ea5cf4", "url": "https://github.com/odpi/egeria/commit/676da94578e826e650231c63f987a5daa0ea5cf4", "message": "WIP\n\nSigned-off-by: Guy Ackermans <guy.ackermans92@gmail.com>", "committedDate": "2020-02-28T17:28:58Z", "type": "commit"}, {"oid": "f065636b548f7003fc290b7ac2c28f8fb21a3a1f", "url": "https://github.com/odpi/egeria/commit/f065636b548f7003fc290b7ac2c28f8fb21a3a1f", "message": "OLS: ureclassify event\n\nSigned-off-by: Guy Ackermans <guy.ackermans92@gmail.com>", "committedDate": "2020-02-29T09:59:39Z", "type": "commit"}, {"oid": "06b144cfb9efd6d7b3ce1671bca011d3bfcbfba6", "url": "https://github.com/odpi/egeria/commit/06b144cfb9efd6d7b3ce1671bca011d3bfcbfba6", "message": "AL omas: imrpoved logging\n\nSigned-off-by: Guy Ackermans <guy.ackermans92@gmail.com>", "committedDate": "2020-02-29T10:17:34Z", "type": "commit"}, {"oid": "32c928b1149f79498df52f9c1b1fef80ff381980", "url": "https://github.com/odpi/egeria/commit/32c928b1149f79498df52f9c1b1fef80ff381980", "message": "AL: fix typo\n\nSigned-off-by: Guy Ackermans <guy.ackermans92@gmail.com>", "committedDate": "2020-02-29T10:20:37Z", "type": "commit"}, {"oid": "a2a3b1a0cfd24eab311358f7f37da11d193af79d", "url": "https://github.com/odpi/egeria/commit/a2a3b1a0cfd24eab311358f7f37da11d193af79d", "message": "Merge branch 'master' into classifications", "committedDate": "2020-03-01T10:08:21Z", "type": "commit"}, {"oid": "f63094af61e012b56867d3c5b07b8124747db367", "url": "https://github.com/odpi/egeria/commit/f63094af61e012b56867d3c5b07b8124747db367", "message": "AL omas: remove entitydetail check\n\nSigned-off-by: Guy Ackermans <guy.ackermans92@gmail.com>", "committedDate": "2020-03-02T09:51:13Z", "type": "commit"}, {"oid": "7fd06710143a4d3619163f25c3a368ce1b02bf60", "url": "https://github.com/odpi/egeria/commit/7fd06710143a4d3619163f25c3a368ce1b02bf60", "message": "Merge branch 'classifications' of https://github.com/GuyAckermans/egeria into classifications", "committedDate": "2020-03-02T09:52:34Z", "type": "commit"}, {"oid": "ad54f95caeaee9a082c958003aac4808f4364578", "url": "https://github.com/odpi/egeria/commit/ad54f95caeaee9a082c958003aac4808f4364578", "message": "Merge branch 'master' of https://github.com/odpi/egeria into classifications", "committedDate": "2020-03-02T09:53:19Z", "type": "commit"}, {"oid": "aa54d1dcb5ef274def1d15f31767f59cc5680d44", "url": "https://github.com/odpi/egeria/commit/aa54d1dcb5ef274def1d15f31767f59cc5680d44", "message": "OLS: wip\n\nSigned-off-by: Guy Ackermans <guy.ackermans92@gmail.com>", "committedDate": "2020-03-02T13:44:08Z", "type": "commit"}, {"oid": "3ba619840cb5470ccd7a7b12a40ffd626e3085db", "url": "https://github.com/odpi/egeria/commit/3ba619840cb5470ccd7a7b12a40ffd626e3085db", "message": "Merge branch 'master' of https://github.com/odpi/egeria into classifications", "committedDate": "2020-03-02T14:32:56Z", "type": "commit"}, {"oid": "915f1338d07c20139182f536bb131cf35eed2ec7", "url": "https://github.com/odpi/egeria/commit/915f1338d07c20139182f536bb131cf35eed2ec7", "message": "WIP\n\nSigned-off-by: Guy Ackermans <guy.ackermans92@gmail.com>", "committedDate": "2020-03-04T13:47:09Z", "type": "commit"}, {"oid": "cbbe96a0cb0e6f9b1dffacfe8a97d3869b94d5a4", "url": "https://github.com/odpi/egeria/commit/cbbe96a0cb0e6f9b1dffacfe8a97d3869b94d5a4", "message": "Merge branch 'master' of https://github.com/odpi/egeria into classifications\n\nSigned-off-by: Guy Ackermans <guy.ackermans92@gmail.com>", "committedDate": "2020-03-08T14:30:32Z", "type": "commit"}, {"oid": "cfb8b6a64692c7b8a4c418131d60eff45301e82c", "url": "https://github.com/odpi/egeria/commit/cfb8b6a64692c7b8a4c418131d60eff45301e82c", "message": "AL OMAS: Declassify\n\nSigned-off-by: Guy Ackermans <guy.ackermans92@gmail.com>", "committedDate": "2020-03-08T16:07:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQ5MzkxOQ==", "url": "https://github.com/odpi/egeria/pull/2718#discussion_r389493919", "bodyText": "Just a question here, why don't you want to use directly the event type(e..g AssetLineageEventType.UPDATE_RELATIONSHIP_EVENT) for debugging? And use another string instead?", "author": "popa-raluca", "createdAt": "2020-03-09T07:21:03Z", "path": "open-metadata-implementation/access-services/asset-lineage/asset-lineage-server/src/main/java/org/odpi/openmetadata/accessservices/assetlineage/listeners/AssetLineageOMRSTopicListener.java", "diffHunk": "@@ -167,39 +165,62 @@ private void processDeletedEntity(EntityDetail entityDetail) throws ConnectorChe\n     private void processClassifiedEntityEvent(EntityDetail entityDetail) throws OCFCheckedExceptionBase, JsonProcessingException {\n         if (!immutableValidLineageEntityEvents.contains(entityDetail.getType().getTypeDefName()))\n             return;\n-        log.debug(\"Asset Lineage OMAS is processing a Classified Entity event which contains the following entity {}: \", entityDetail.getGUID());\n+        log.debug(PROCESSING_ENTITYDETAIL_DEBUG_MESSAGE, \"classifiedEntity\", entityDetail.getGUID());\n         publisher.publishClassificationContext(entityDetail);\n     }\n \n-    private void processReclassifiedEntityEvent(EntityDetail entityDetail) {\n-        log.debug(\"Asset Lineage OMAS is processing a ReClassified Entity event which contains the following entity {}: \", entityDetail.getGUID());\n+    private void processReclassifiedEntityEvent(EntityDetail entityDetail) throws OCFCheckedExceptionBase, JsonProcessingException {\n+        if (!immutableValidLineageEntityEvents.contains(entityDetail.getType().getTypeDefName()))\n+            return;\n+        log.debug(PROCESSING_ENTITYDETAIL_DEBUG_MESSAGE, \"reclassifiedEntity\", entityDetail.getGUID());\n+        publisher.publishClassificationContext(entityDetail);\n     }\n \n-    private void processDeclassifiedEntityEvent(EntityDetail entityDetail) {\n-        log.debug(\"Asset Lineage OMAS is processing a DeClassified Entity event which contains the following entity {}: \", entityDetail.getGUID());\n+    private void processDeclassifiedEntityEvent(EntityDetail entityDetail) throws OCFCheckedExceptionBase, JsonProcessingException {\n+        if (!immutableValidLineageEntityEvents.contains(entityDetail.getType().getTypeDefName()))\n+            return;\n+        log.debug(PROCESSING_ENTITYDETAIL_DEBUG_MESSAGE, \"declassifiedEntity\", entityDetail.getGUID());\n+        if (anyValidClassificationsLeft(entityDetail)) {\n+            publisher.publishClassificationContext(entityDetail);\n+            return;\n+        }\n+        //The last relevant lineage classification has been removed from the entity\n+        LineageEvent event = new LineageEvent();\n+        event.setLineageEntity(converter.createLineageEntity(entityDetail));\n+        event.setAssetLineageEventType(AssetLineageEventType.DECLASSIFIED_ENTITY_EVENT);\n+        publisher.publishEvent(event);\n     }\n \n+\n     private void processNewRelationship(Relationship relationship) {\n-        log.debug(PROCESSING_RELATIONSHIP_DEBUG_MESSAGE, \"NewRelationship\", relationship.getGUID());\n+        log.debug(PROCESSING_RELATIONSHIP_DEBUG_MESSAGE, \"newRelationship\", relationship.getGUID());\n     }\n \n     private void processUpdatedRelationshipEvent(Relationship relationship) throws OCFCheckedExceptionBase, JsonProcessingException {\n-        log.debug(PROCESSING_RELATIONSHIP_DEBUG_MESSAGE, AssetLineageEventType.UPDATE_RELATIONSHIP_EVENT, relationship.getGUID());\n+        log.debug(PROCESSING_RELATIONSHIP_DEBUG_MESSAGE, \"updatedRelationship\", relationship.getGUID());", "originalCommit": "cfb8b6a64692c7b8a4c418131d60eff45301e82c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDAwNDk0OA==", "url": "https://github.com/odpi/egeria/pull/2718#discussion_r390004948", "bodyText": "AssetLineageEventType does not refer to the input events of the omas, but to its output events. Some input events, such as classify and reclassify, may lead to an event of the same AssetLineageEventType (CLASSIFICATION_CONTEXT). Therefore these constants are not intended for classifying the input events", "author": "GuyAckermans", "createdAt": "2020-03-09T22:53:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQ5MzkxOQ=="}], "type": "inlineReview"}, {"oid": "f994c08a59193e9352eae1d4b18396239cc4f56b", "url": "https://github.com/odpi/egeria/commit/f994c08a59193e9352eae1d4b18396239cc4f56b", "message": "OLS: fix logging\n\nSigned-off-by: Guy Ackermans <guy.ackermans92@gmail.com>", "committedDate": "2020-03-09T12:59:20Z", "type": "commit"}, {"oid": "0d723d542fb7e63e0104a103e7b119b222ae79eb", "url": "https://github.com/odpi/egeria/commit/0d723d542fb7e63e0104a103e7b119b222ae79eb", "message": "WIP\n\nSigned-off-by: Guy Ackermans <guy.ackermans92@gmail.com>", "committedDate": "2020-03-09T14:04:00Z", "type": "commit"}, {"oid": "dd848e18588436a0ac2e3c6d2b20dd522a4f6e02", "url": "https://github.com/odpi/egeria/commit/dd848e18588436a0ac2e3c6d2b20dd522a4f6e02", "message": "wip\n\nSigned-off-by: Guy Ackermans <guy.ackermans92@gmail.com>", "committedDate": "2020-03-09T14:15:05Z", "type": "commit"}, {"oid": "bf875918cdc77012b34372bca97aaa6685532d1a", "url": "https://github.com/odpi/egeria/commit/bf875918cdc77012b34372bca97aaa6685532d1a", "message": "Merge branch 'master' into classifications\n\nSigned-off-by: Guy Ackermans <guy.ackermans92@gmail.com>", "committedDate": "2020-03-09T14:16:43Z", "type": "commit"}, {"oid": "d001d1052dce74d2c2bdb757c3b4a0fe4c652910", "url": "https://github.com/odpi/egeria/commit/d001d1052dce74d2c2bdb757c3b4a0fe4c652910", "message": "AL OMAS: Configurable andd efault classification types\n\nSigned-off-by: Guy Ackermans <guy.ackermans92@gmail.com>", "committedDate": "2020-03-09T15:17:51Z", "type": "commit"}, {"oid": "2ebffbb75e290b8ed311fa2e57320630e7b26421", "url": "https://github.com/odpi/egeria/commit/2ebffbb75e290b8ed311fa2e57320630e7b26421", "message": "AL omas: refactor\n\nSigned-off-by: Guy Ackermans <guy.ackermans92@gmail.com>", "committedDate": "2020-03-09T15:21:12Z", "type": "commit"}, {"oid": "0c67cead45033cc32f01f6dc2f91609226c7853d", "url": "https://github.com/odpi/egeria/commit/0c67cead45033cc32f01f6dc2f91609226c7853d", "message": "AL omas: refactor\n\nSigned-off-by: Guy Ackermans <guy.ackermans92@gmail.com>", "committedDate": "2020-03-09T15:22:22Z", "type": "commit"}, {"oid": "b7662974e9d34171a4f95d51e0112f45b310f3cc", "url": "https://github.com/odpi/egeria/commit/b7662974e9d34171a4f95d51e0112f45b310f3cc", "message": "Merge branch 'master' of https://github.com/odpi/egeria into classifications", "committedDate": "2020-03-09T15:22:37Z", "type": "commit"}, {"oid": "4770fc589c2028a1e676bfaf0889d9be4bd67a00", "url": "https://github.com/odpi/egeria/commit/4770fc589c2028a1e676bfaf0889d9be4bd67a00", "message": "AL omas: refactor\n\nSigned-off-by: Guy Ackermans <guy.ackermans92@gmail.com>", "committedDate": "2020-03-09T15:23:40Z", "type": "commit"}, {"oid": "fcd6b21f3a03c35bbe3454d074d385f43efac92d", "url": "https://github.com/odpi/egeria/commit/fcd6b21f3a03c35bbe3454d074d385f43efac92d", "message": "Optimize imports\n\nSigned-off-by: Guy Ackermans <guy.ackermans92@gmail.com>", "committedDate": "2020-03-10T09:31:39Z", "type": "commit"}, {"oid": "200849d739e123da8e173a48578ea079119f53fb", "url": "https://github.com/odpi/egeria/commit/200849d739e123da8e173a48578ea079119f53fb", "message": "Merge branch 'master' of https://github.com/odpi/egeria into classifications", "committedDate": "2020-03-10T09:32:03Z", "type": "commit"}, {"oid": "8c44f6b0806a2fc8a20a9406e748b446db48d8c8", "url": "https://github.com/odpi/egeria/commit/8c44f6b0806a2fc8a20a9406e748b446db48d8c8", "message": "Merge branch 'master' into classifications", "committedDate": "2020-03-11T19:25:29Z", "type": "commit"}, {"oid": "d5c185bd42c144d728bd993b8d50d8d7562c372b", "url": "https://github.com/odpi/egeria/commit/d5c185bd42c144d728bd993b8d50d8d7562c372b", "message": "Merge branch 'master' into classifications", "committedDate": "2020-03-12T17:08:04Z", "type": "commit"}, {"oid": "c87ad28f74816ba5a4dcba148284416ec8b8c1b5", "url": "https://github.com/odpi/egeria/commit/c87ad28f74816ba5a4dcba148284416ec8b8c1b5", "message": "Merge branch 'master' into classifications", "committedDate": "2020-03-17T13:08:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzcwNzI3NQ==", "url": "https://github.com/odpi/egeria/pull/2718#discussion_r393707275", "bodyText": "My version of this method (not actually tested, but the result should be identical)\nprivate List<String> getLineageClassificationTypes(AccessServiceConfig accessServiceConfig) { if (accessServiceConfig.getAccessServiceOptions() != null) { return AssetLineageConstants.immutableDefaultLineageClassifications; } return accessServiceConfig.getAccessServiceOptions().get(AssetLineageConstants.LINEAGE_CLASSIFICATION_TYPES_KEY); }\nSteps taken to reach this code:\n\nnoticed else block is smaller than if block, therefore switched between themselves\nused a fast return in if block, making 1 less usage of returned list and making else block unnecessary, thus flattening landscape (aka decreasing identation) and increasing code readability\nsince the returned list/object is already initialized as null, the null check becomes unnecessary and therefore can be removed\nas a consequence, the assignment to returned list/object is also unnecessary and the result of get() method can be immediately returned\n\nI am only stating this is an improved version, not the best possible one, only by staying in the context of this method alone.\nAlso, my approach is to always use curly brackets/accolades, however they are called, when it comes to single line if statements. The web debates about this case, but in my opinion they provide code structure, thus increasing readability. Also, they help with spotting failed code merges, but if they are not used the bugs rising from these situations can turn into nightmares. The choice is ultimately the developers.", "author": "lcpopa", "createdAt": "2020-03-17T14:11:02Z", "path": "open-metadata-implementation/access-services/asset-lineage/asset-lineage-server/src/main/java/org/odpi/openmetadata/accessservices/assetlineage/admin/AssetLineageAdmin.java", "diffHunk": "@@ -119,6 +126,18 @@ public void initialize(AccessServiceConfig accessServiceConfig,\n         }\n     }\n \n+    private List<String> getLineageClassificationTypes(AccessServiceConfig accessServiceConfig) {", "originalCommit": "c87ad28f74816ba5a4dcba148284416ec8b8c1b5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzcwOTM5Mg==", "url": "https://github.com/odpi/egeria/pull/2718#discussion_r393709392", "bodyText": "How do I make GitHub properly indent code in comments ? :) Place the code in iDea to actually notice it\nThe above is only as a suggestion to improve ones code writing skills", "author": "lcpopa", "createdAt": "2020-03-17T14:13:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzcwNzI3NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDMzMzQ5OQ==", "url": "https://github.com/odpi/egeria/pull/2718#discussion_r394333499", "bodyText": "Thanks for the feedback! It made me realise there was a bug, the body of the else block should be run when either of the if statements are false. I refactored to:\nprivate List<String> getLineageClassificationTypes(AccessServiceConfig accessServiceConfig) {\n        Object lineageClassificationTypesProperty = null;\n        if (accessServiceConfig.getAccessServiceOptions() != null)\n            lineageClassificationTypesProperty = accessServiceConfig.getAccessServiceOptions().get(AssetLineageConstants.LINEAGE_CLASSIFICATION_TYPES_KEY);\n        if (lineageClassificationTypesProperty != null)\n            return (List<String>) lineageClassificationTypesProperty;\n        return AssetLineageConstants.immutableDefaultLineageClassifications;\n    }\n\nTo me code is more readable when minimising the number of lines, so using single line statements. I have never run into a failed code merge situation with this, but I can imagine it would be a big problem", "author": "GuyAckermans", "createdAt": "2020-03-18T13:10:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzcwNzI3NQ=="}], "type": "inlineReview"}, {"oid": "a3e4d9095739bf1a196ebd40334552bad5a8e3a4", "url": "https://github.com/odpi/egeria/commit/a3e4d9095739bf1a196ebd40334552bad5a8e3a4", "message": "Merge branch 'master' into classifications", "committedDate": "2020-03-18T08:46:18Z", "type": "commit"}, {"oid": "7d01a36715fdab5a4a494f46369896caca9ba630", "url": "https://github.com/odpi/egeria/commit/7d01a36715fdab5a4a494f46369896caca9ba630", "message": "Merge branch 'master' into classifications", "committedDate": "2020-03-18T12:39:12Z", "type": "commit"}, {"oid": "acdf14913917093600b16962bf355976d5ba7e86", "url": "https://github.com/odpi/egeria/commit/acdf14913917093600b16962bf355976d5ba7e86", "message": "refactor\n\nSigned-off-by: Guy Ackermans <guy.ackermans92@gmail.com>", "committedDate": "2020-03-18T13:12:30Z", "type": "commit"}, {"oid": "78e9cf293c82560fa0716e56d86b32677ccb6055", "url": "https://github.com/odpi/egeria/commit/78e9cf293c82560fa0716e56d86b32677ccb6055", "message": "Merge branch 'classifications' of https://github.com/GuyAckermans/egeria into classifications", "committedDate": "2020-03-18T13:13:04Z", "type": "commit"}]}