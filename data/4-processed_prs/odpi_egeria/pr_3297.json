{"pr_number": 3297, "pr_title": "Automation of Subject Area FVT", "pr_createdAt": "2020-07-03T10:22:03Z", "pr_url": "https://github.com/odpi/egeria/pull/3297", "timeline": [{"oid": "3b8b1403abbe0833753143898e988dd4a4c79a11", "url": "https://github.com/odpi/egeria/commit/3b8b1403abbe0833753143898e988dd4a4c79a11", "message": "Correct spotbugs dependency versions\n\nSigned-off-by: Nigel Jones <nigel.l.jones+git@gmail.com>", "committedDate": "2020-06-29T09:13:59Z", "type": "commit"}, {"oid": "a1cc9a899a0e0bf40b7033b5bbdecaed84ef9b4f", "url": "https://github.com/odpi/egeria/commit/a1cc9a899a0e0bf40b7033b5bbdecaed84ef9b4f", "message": "Ensure new failsafe plugin, and previous git commit plugin, use properties for version\n\nSigned-off-by: Nigel Jones <nigel.l.jones+git@gmail.com>", "committedDate": "2020-06-29T09:17:27Z", "type": "commit"}, {"oid": "79ec10ba2fdd8a91c954e58ffedce9f140693ae4", "url": "https://github.com/odpi/egeria/commit/79ec10ba2fdd8a91c954e58ffedce9f140693ae4", "message": "Add integration test framwework for subject area\n\nSigned-off-by: Nigel Jones <nigel.l.jones+git@gmail.com>", "committedDate": "2020-07-02T15:59:19Z", "type": "commit"}, {"oid": "19568710b774571cf0cd35ebd36b7409fc070e75", "url": "https://github.com/odpi/egeria/commit/19568710b774571cf0cd35ebd36b7409fc070e75", "message": "Moved subject area FVTs to use JUnit5 via wrapper\n\nSigned-off-by: Nigel Jones <nigel.l.jones+git@gmail.com>", "committedDate": "2020-07-03T09:49:45Z", "type": "commit"}, {"oid": "70ea5045c59deb71f9e52900276e2a54d0d86cb0", "url": "https://github.com/odpi/egeria/commit/70ea5045c59deb71f9e52900276e2a54d0d86cb0", "message": "Remove new test method added initially, now superfluous after mvoe to junit\n\nSigned-off-by: Nigel Jones <nigel.l.jones+git@gmail.com>", "committedDate": "2020-07-03T09:56:40Z", "type": "commit"}, {"oid": "95849fa9352b3c0ea68192d2a53e78688b51468a", "url": "https://github.com/odpi/egeria/commit/95849fa9352b3c0ea68192d2a53e78688b51468a", "message": "Additional comments on integration tests\n\nSigned-off-by: Nigel Jones <nigel.l.jones+git@gmail.com>", "committedDate": "2020-07-03T10:04:01Z", "type": "commit"}, {"oid": "d7cc1465273de6580eb49881bd49ad555e271457", "url": "https://github.com/odpi/egeria/commit/d7cc1465273de6580eb49881bd49ad555e271457", "message": "Move version def of groovy plugin to top level pom;\n\nSigned-off-by: Nigel Jones <nigel.l.jones+git@gmail.com>", "committedDate": "2020-07-03T10:20:41Z", "type": "commit"}, {"oid": "9d17cbd9e4c35329892bf034fb5ac24e0bb42e44", "url": "https://github.com/odpi/egeria/commit/9d17cbd9e4c35329892bf034fb5ac24e0bb42e44", "message": "Merge/fix from master\n\nSigned-off-by: Nigel Jones <nigel.l.jones+git@gmail.com>", "committedDate": "2020-07-03T10:29:21Z", "type": "commit"}, {"oid": "98907850d25658f902b924daa4137f3c21ad9410", "url": "https://github.com/odpi/egeria/commit/98907850d25658f902b924daa4137f3c21ad9410", "message": "Merge branch 'master' of https://github.com/odpi/egeria into issue426_groovy", "committedDate": "2020-07-06T08:22:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDA3NjE3OA==", "url": "https://github.com/odpi/egeria/pull/3297#discussion_r450076178", "bodyText": "@planetf1 We do have junits that inline the in memory repo to run tests, which means we do not need to have a dependant server. I like being able to run against a real server as you can change the type of repo.  I wonder if we could run the FVTs against an in memory repo and then a graph repo (in case there are quirky differences, for example around search). I raise this as a consideration in case there is something in the current structure you might want to change to accommodate running it against multiple repositories.", "author": "davidradl", "createdAt": "2020-07-06T08:50:15Z", "path": "open-metadata-test/open-metadata-fvt/access-services-fvt/subject-area-fvt/src/test/script/configureStartServer.groovy", "diffHunk": "@@ -0,0 +1,113 @@\n+#!/usr/local/bin/groovy\n+import javax.net.ssl.HttpsURLConnection\n+\n+// SPDX-License-Identifier: Apache-2.0\n+// Copyright Contributors to the ODPi Egeria project.\n+\n+// Function to convert array to String\n+\n+// Will configure a server chassis - which should already be running - for FVT testing\n+\n+import javax.net.ssl.SSLContext\n+import javax.net.ssl.TrustManager\n+import javax.net.ssl.X509TrustManager\n+\n+// Retrieve configuration - with defaults to aid in local testing (using default ports)\n+user=properties[\"user\"] ?: \"garygeeke\";\n+baseURL=properties[\"baseURL\"] ?: \"https://localhost:9443\";\n+server=properties[\"server\"] ?: \"server1\";\n+retries=properties[\"retries\"] ?: 12;\n+delay=properties[\"delay\"] ?: 10;\n+\n+// SSL setup to avoid self-signed errors for testing\n+TrustManager[] trustAllCerts = new TrustManager[]{\n+        new X509TrustManager() {\n+\n+            public java.security.cert.X509Certificate[] getAcceptedIssuers()\n+            {\n+                return null;\n+            }\n+            public void checkClientTrusted(java.security.cert.X509Certificate[] certs, String authType)\n+            {\n+                //No need to implement.\n+            }\n+            public void checkServerTrusted(java.security.cert.X509Certificate[] certs, String authType)\n+            {\n+                //No need to implement.\n+            }\n+        }\n+};\n+try\n+{\n+    SSLContext sc = SSLContext.getInstance(\"SSL\");\n+    sc.init(null, trustAllCerts, new java.security.SecureRandom());\n+    HttpsURLConnection.setDefaultSSLSocketFactory(sc.getSocketFactory());\n+}\n+catch (Exception e)\n+{\n+    System.out.println(e);\n+    System.exit(-1);\n+}\n+\n+// Wait until the platform is ready\n+connected=false;\n+i=retries;\n+while (!connected && i>0)\n+{\n+    try {\n+\n+        System.out.println(\"=== Checking platform at \" + baseURL + \" is available (\" + i + \" attempts remaining) ===\");\n+        post0 = new java.net.URL(baseURL + \"/open-metadata/platform-services/users/\" + user + \"/server-platform/origin\").openConnection();\n+        post0RC = post0.getResponseCode();\n+        println(post0RC);\n+        if (post0RC.equals(200)) {\n+            connected = true;\n+            println(post0.getInputStream().getText());\n+        } else {\n+            i--;\n+            Thread.sleep(1000 * delay);\n+        }\n+    } catch (Throwable t)\n+    {\n+        // TODO: look at whether some exceptions should be deemed irrecoverable rather than retry\n+        i--;\n+        Thread.sleep(1000 * delay);\n+    }\n+}\n+\n+// --- Configure the platform - any errors here and we exit\n+System.out.println(\"=== Configuring server: \" + server + \" ===\");\n+post1 = new URL(baseURL + \"/open-metadata/admin-services/users/\" + user + \"/servers/\" + server + \"/local-repository/mode/in-memory-repository\" ).openConnection()", "originalCommit": "98907850d25658f902b924daa4137f3c21ad9410", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDA4MTQ2Mw==", "url": "https://github.com/odpi/egeria/pull/3297#discussion_r450081463", "bodyText": "I did wonder about whether we should run the FVTs twice - once for each repo type (that we ship).\nCan you raise a note in the parent issue for that (or a new issue)- as it's just a minor change it will be easy as a new PR? It also means you have a base to work with as you add more tests, or adapt the tests to be more JUnit ish?\nAs to how that scales.. I think automation is fairly easy, but optimizing performance won't be with all the starts/stops of platforms/servers -- but if we don't do this we may contaminate test results in any case, so probably worth taking the hit\nI've also seen v.slow perf recently esp. in graph. I have #3213 but not looked at yet. That is probably a precursor.", "author": "planetf1", "createdAt": "2020-07-06T08:59:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDA3NjE3OA=="}], "type": "inlineReview"}, {"oid": "a0f44e3f296c19622356f69e4842bcac5c7db8e7", "url": "https://github.com/odpi/egeria/commit/a0f44e3f296c19622356f69e4842bcac5c7db8e7", "message": "Disable failing Subject Area tests\n\nSigned-off-by: Nigel Jones <nigel.l.jones+git@gmail.com>", "committedDate": "2020-07-06T12:02:32Z", "type": "commit"}, {"oid": "0cbfee7cd2e6f99354232f7394af04041f16fc81", "url": "https://github.com/odpi/egeria/commit/0cbfee7cd2e6f99354232f7394af04041f16fc81", "message": "Merge branch 'master' of https://github.com/odt push    pi/egeria into issue426_groovy", "committedDate": "2020-07-06T12:09:39Z", "type": "commit"}, {"oid": "4c83c967a9f87fa418c8413958face3a58502d24", "url": "https://github.com/odpi/egeria/commit/4c83c967a9f87fa418c8413958face3a58502d24", "message": "Merge branch 'master' of https://github.com/odpi/egeria into issue426_groovy", "committedDate": "2020-07-07T13:01:28Z", "type": "commit"}]}