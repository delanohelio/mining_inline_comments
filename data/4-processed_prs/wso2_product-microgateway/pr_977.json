{"pr_number": 977, "pr_title": "Fix #976 #774 - K8s issues and pull from private registries", "pr_createdAt": "2020-02-10T13:08:23Z", "pr_url": "https://github.com/wso2/product-microgateway/pull/977", "timeline": [{"oid": "69f1feaaba88648db892a3b82ddf4e933ec681a7", "url": "https://github.com/wso2/product-microgateway/commit/69f1feaaba88648db892a3b82ddf4e933ec681a7", "message": "Fix #976 #774 - K8s issues and pull from private registries", "committedDate": "2020-02-11T04:35:46Z", "type": "commit"}, {"oid": "69f1feaaba88648db892a3b82ddf4e933ec681a7", "url": "https://github.com/wso2/product-microgateway/commit/69f1feaaba88648db892a3b82ddf4e933ec681a7", "message": "Fix #976 #774 - K8s issues and pull from private registries", "committedDate": "2020-02-11T04:35:46Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQ0NTA2MQ==", "url": "https://github.com/wso2/product-microgateway/pull/977#discussion_r377445061", "bodyText": "Build image if block is not closed properly and Avoid empty cmd attribute\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                buildImage:{{containerConfig.kubernetes.kubernetesDeployment.buildImage}},\n          \n          \n            \n                buildImage:{{containerConfig.kubernetes.kubernetesDeployment.buildImage}}{{/if}}{{#if containerConfig.kubernetes.kubernetesDeployment.cmd}},", "author": "praminda", "createdAt": "2020-02-11T04:49:24Z", "path": "components/micro-gateway-cli/src/main/resources/templates/kubernetesDeployment.mustache", "diffHunk": "@@ -9,9 +9,11 @@\n     periodSeconds:{{containerConfig.kubernetes.kubernetesDeployment.periodSeconds}}{{/if}}{{#if containerConfig.kubernetes.kubernetesDeployment.livenessPort}},\n     livenessPort:{{containerConfig.kubernetes.kubernetesDeployment.livenessPort}}{{/if}}{{#if containerConfig.kubernetes.kubernetesDeployment.image}},\n     image:\"{{containerConfig.kubernetes.kubernetesDeployment.image}}\"{{/if}}{{#if containerConfig.kubernetes.kubernetesDeployment.imagePullPolicy}},\n-    imagePullPolicy:\"{{containerConfig.kubernetes.kubernetesDeployment.imagePullPolicy}}\"{{/if}}{{#if containerConfig.kubernetes.kubernetesDeployment.env}},\n+    imagePullPolicy:\"{{containerConfig.kubernetes.kubernetesDeployment.imagePullPolicy}}\"{{/if}}{{#if containerConfig.kubernetes.kubernetesDeployment.imagePullSecrets}},\n+    imagePullSecrets: [{{#containerConfig.kubernetes.kubernetesDeployment.imagePullSecrets}}\"{{.}}\"{{#unless @last}},{{/unless}}{{/containerConfig.kubernetes.kubernetesDeployment.imagePullSecrets}}]{{/if}}{{#if containerConfig.kubernetes.kubernetesDeployment.env}},\n     env:{{{containerConfig.kubernetes.kubernetesDeployment.env}}}{{/if}}{{#if containerConfig.kubernetes.kubernetesDeployment.buildImage}},\n-    buildImage:{{containerConfig.kubernetes.kubernetesDeployment.buildImage}}{{/if}}{{#if containerConfig.kubernetes.kubernetesDeployment.copyFiles.enable}},\n+    buildImage:{{containerConfig.kubernetes.kubernetesDeployment.buildImage}},", "originalCommit": "69f1feaaba88648db892a3b82ddf4e933ec681a7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQ0NjM5Ng==", "url": "https://github.com/wso2/product-microgateway/pull/977#discussion_r377446396", "bodyText": "build Image and cmd is inside the if block of build image. cmd does not have any purpose if the build image is disabled", "author": "Rajith90", "createdAt": "2020-02-11T04:58:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQ0NTA2MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQ0Njg3Mg==", "url": "https://github.com/wso2/product-microgateway/pull/977#discussion_r377446872", "bodyText": "And also it should have our default cmd , which executes the gateway shell script rather than the java -jar command", "author": "Rajith90", "createdAt": "2020-02-11T05:01:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQ0NTA2MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQ0NTM3Ng==", "url": "https://github.com/wso2/product-microgateway/pull/977#discussion_r377445376", "bodyText": "Any reason for not using default constants?", "author": "praminda", "createdAt": "2020-02-11T04:51:22Z", "path": "components/micro-gateway-cli/src/main/resources/templates/listeners.mustache", "diffHunk": "@@ -23,22 +23,22 @@ http:ListenerConfiguration secureServiceEndpointConfiguration = { {{>http2}},\n {{>docker}}\n {{>secureKubernetesIngress}}\n {{>kubernetesServiceHttps}}\n-listener gateway:APIGatewaySecureListener apiSecureListener = new(gateway:DEFAULT_HTTPS_PORT, secureServiceEndpointConfiguration);\n+listener gateway:APIGatewaySecureListener apiSecureListener = new(9095, secureServiceEndpointConfiguration);", "originalCommit": "69f1feaaba88648db892a3b82ddf4e933ec681a7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQ0NjQ4NQ==", "url": "https://github.com/wso2/product-microgateway/pull/977#discussion_r377446485", "bodyText": "Kubernetes annotations are read at the compile time. So it mandatory to have the port value during the compile time", "author": "Rajith90", "createdAt": "2020-02-11T04:58:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQ0NTM3Ng=="}], "type": "inlineReview"}]}