{"pr_number": 1049, "pr_title": "Send backend jwt header if jwt has backendJwt claim", "pr_createdAt": "2020-02-27T11:00:08Z", "pr_url": "https://github.com/wso2/product-microgateway/pull/1049", "timeline": [{"oid": "974e52e93c1a82375617be55c32681a091a39920", "url": "https://github.com/wso2/product-microgateway/commit/974e52e93c1a82375617be55c32681a091a39920", "message": "Send backend jwt header if jwt has backendJwt claim", "committedDate": "2020-02-27T11:02:46Z", "type": "commit"}, {"oid": "974e52e93c1a82375617be55c32681a091a39920", "url": "https://github.com/wso2/product-microgateway/commit/974e52e93c1a82375617be55c32681a091a39920", "message": "Send backend jwt header if jwt has backendJwt claim", "committedDate": "2020-02-27T11:02:46Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTE1NzU4OQ==", "url": "https://github.com/wso2/product-microgateway/pull/1049#discussion_r385157589", "bodyText": "Don't read the config per request. Store this in a variable and read.", "author": "Rajith90", "createdAt": "2020-02-27T14:23:47Z", "path": "components/micro-gateway-core/src/main/ballerina/src/gateway/handlers/jwt_auth_handler.bal", "diffHunk": "@@ -62,9 +63,23 @@ public type JWTAuthHandler object {\n         string credential = headerValue.substring(6, headerValue.length()).trim();\n         var authenticationResult = self.jwtAuthProvider.authenticate(credential);\n         if (authenticationResult is boolean) {\n+            setBackendJwtHeader(credential, req);\n             return authenticationResult;\n         } else {\n             return prepareAuthenticationError(\"Failed to authenticate with jwt bearer auth handler.\", authenticationResult);\n         }\n     }\n };\n+\n+public function setBackendJwtHeader(string credential, http:Request req) {\n+    (jwt:JwtPayload | error) payload = getDecodedJWTPayload(credential);\n+    if (payload is jwt:JwtPayload) {\n+        map<json>? customClaims = payload?.customClaims;\n+        // validate backend jwt claim and set it to jwt header\n+        if (customClaims is map<json> && customClaims.hasKey(BACKEND_JWT)) {\n+            printDebug(KEY_JWT_AUTH_PROVIDER, \"Set backend jwt header.\");\n+            string jwtheaderName = getConfigValue(JWT_CONFIG_INSTANCE_ID, JWT_HEADER, DEFAULT_JWT_HEADER_NAME);", "originalCommit": "974e52e93c1a82375617be55c32681a091a39920", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "4c93af3dca1624cfcc668cec6397d066c8b11c0d", "url": "https://github.com/wso2/product-microgateway/commit/4c93af3dca1624cfcc668cec6397d066c8b11c0d", "message": "Fix review comments", "committedDate": "2020-02-27T15:50:59Z", "type": "commit"}]}