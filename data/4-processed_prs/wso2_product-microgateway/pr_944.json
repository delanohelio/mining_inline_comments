{"pr_number": 944, "pr_title": "Restructure jballerina runtime and toolkit distribution", "pr_createdAt": "2020-01-22T05:55:47Z", "pr_url": "https://github.com/wso2/product-microgateway/pull/944", "timeline": [{"oid": "5e8fc0580b67c53d54507716261225764ba0f967", "url": "https://github.com/wso2/product-microgateway/commit/5e8fc0580b67c53d54507716261225764ba0f967", "message": "remove unnecessary items from toolkit", "committedDate": "2020-01-17T12:36:59Z", "type": "commit"}, {"oid": "227ac0aff98b2f94ab6e2245e2675dcbbe2d347b", "url": "https://github.com/wso2/product-microgateway/commit/227ac0aff98b2f94ab6e2245e2675dcbbe2d347b", "message": "restructure the runtime", "committedDate": "2020-01-21T06:46:08Z", "type": "commit"}, {"oid": "24b33f36719fc4f04ef5ac861bd63ec58d7b56c3", "url": "https://github.com/wso2/product-microgateway/commit/24b33f36719fc4f04ef5ac861bd63ec58d7b56c3", "message": "Merge branch 'master' of https://github.com/wso2/product-microgateway into restructure-jbal", "committedDate": "2020-01-21T06:46:49Z", "type": "commit"}, {"oid": "9d577de1a8c1856b8be4d0c2c492f7ab0a7bfdbf", "url": "https://github.com/wso2/product-microgateway/commit/9d577de1a8c1856b8be4d0c2c492f7ab0a7bfdbf", "message": "restructure the bash file", "committedDate": "2020-01-22T06:05:13Z", "type": "forcePushed"}, {"oid": "234e440320af552ac9e93f6e046e14258580276d", "url": "https://github.com/wso2/product-microgateway/commit/234e440320af552ac9e93f6e046e14258580276d", "message": "restructure the bash file", "committedDate": "2020-01-22T06:09:36Z", "type": "forcePushed"}, {"oid": "6877ea4e6a7953477ac2a7ed10c8f6621019e33c", "url": "https://github.com/wso2/product-microgateway/commit/6877ea4e6a7953477ac2a7ed10c8f6621019e33c", "message": "restructure the bash file", "committedDate": "2020-01-22T06:39:58Z", "type": "forcePushed"}, {"oid": "9724977d61d59bffe0ea4592c779ea35f2d7f28a", "url": "https://github.com/wso2/product-microgateway/commit/9724977d61d59bffe0ea4592c779ea35f2d7f28a", "message": "restructure the bash file", "committedDate": "2020-01-22T08:20:41Z", "type": "commit"}, {"oid": "9724977d61d59bffe0ea4592c779ea35f2d7f28a", "url": "https://github.com/wso2/product-microgateway/commit/9724977d61d59bffe0ea4592c779ea35f2d7f28a", "message": "restructure the bash file", "committedDate": "2020-01-22T08:20:41Z", "type": "forcePushed"}, {"oid": "4fad6e2eeedc5c12668982284cc65591f14523ae", "url": "https://github.com/wso2/product-microgateway/commit/4fad6e2eeedc5c12668982284cc65591f14523ae", "message": "comment out distributed throttling test case temporarily", "committedDate": "2020-01-22T08:25:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTM5MDc2NA==", "url": "https://github.com/wso2/product-microgateway/pull/944#discussion_r369390764", "bodyText": "Diff in this file says ballerinaKeystore is in different paths for different k8s configs. For example,\n\"${mgw-runtime.home}/runtime/bre/security/ballerinaKeystore.p12\"),\n\"{mgw-runtime.home}/security/ballerinaKeystore.p12\"),\n\"${mgw-runtime.home}/bre/security/ballerinaKeystore.p12\"", "author": "praminda", "createdAt": "2020-01-22T06:40:03Z", "path": "components/micro-gateway-cli/src/main/resources/templates/listeners.mustache", "diffHunk": "@@ -90,7 +90,7 @@ listener http:Listener tokenListenerEndpoint = new (\n         secureSocket: {\n             keyStore: {\n                 path: gateway:getConfigValue(gateway:LISTENER_CONF_INSTANCE_ID, gateway:LISTENER_CONF_KEY_STORE_PATH,\n-                    \"${ballerina.home}/bre/security/ballerinaKeystore.p12\"),\n+                    \"${mgw-runtime.home}/runtime/bre/security/ballerinaKeystore.p12\"),", "originalCommit": "234e440320af552ac9e93f6e046e14258580276d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTA4Mjg0MA==", "url": "https://github.com/wso2/product-microgateway/pull/944#discussion_r371082840", "bodyText": "fixed with 116f0fd", "author": "VirajSalaka", "createdAt": "2020-01-27T06:51:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTM5MDc2NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTM5NDYzMA==", "url": "https://github.com/wso2/product-microgateway/pull/944#discussion_r369394630", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        <source>${basedir}/target/ballerina/jballerina-tools-${ballerina.platform.version}/bre/security/ballerinaKeystore.p12</source>\n          \n          \n            \n                        <source>${project.build.directory}/ballerina/jballerina-tools-${ballerina.platform.version}/bre/security/ballerinaKeystore.p12</source>", "author": "praminda", "createdAt": "2020-01-22T06:54:32Z", "path": "distribution/src/main/assembly/gw_runtimes/gw_runtime_windows.xml", "diffHunk": "@@ -73,6 +59,14 @@\n             <source>${basedir}/resources/bin/gateway</source>\n             <outputDirectory>wso2am-micro-gw-windows-${project.version}/bin</outputDirectory>\n         </file>\n+        <file>\n+            <source>${basedir}/resources/ballerinaTruststore.p12</source>\n+            <outputDirectory>wso2am-micro-gw-windows-${project.version}/runtime/bre/security</outputDirectory>\n+        </file>\n+        <file>\n+            <source>${basedir}/target/ballerina/jballerina-tools-${ballerina.platform.version}/bre/security/ballerinaKeystore.p12</source>", "originalCommit": "6877ea4e6a7953477ac2a7ed10c8f6621019e33c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTM5NDcyOA==", "url": "https://github.com/wso2/product-microgateway/pull/944#discussion_r369394728", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        <source>${basedir}/target/ballerina/jballerina-tools-${ballerina.platform.version}/bre/security/ballerinaKeystore.p12</source>\n          \n          \n            \n                        <source>${project.build.directory}/ballerina/jballerina-tools-${ballerina.platform.version}/bre/security/ballerinaKeystore.p12</source>", "author": "praminda", "createdAt": "2020-01-22T06:54:54Z", "path": "distribution/src/main/assembly/gw_runtimes/gw_runtime_macos.xml", "diffHunk": "@@ -74,6 +60,14 @@\n             <source>${basedir}/resources/bin/gateway.bat</source>\n             <outputDirectory>wso2am-micro-gw-macos-${project.version}/bin</outputDirectory>\n         </file>\n+        <file>\n+            <source>${basedir}/resources/ballerinaTruststore.p12</source>\n+            <outputDirectory>wso2am-micro-gw-macos-${project.version}/runtime/bre/security</outputDirectory>\n+        </file>\n+        <file>\n+            <source>${basedir}/target/ballerina/jballerina-tools-${ballerina.platform.version}/bre/security/ballerinaKeystore.p12</source>", "originalCommit": "6877ea4e6a7953477ac2a7ed10c8f6621019e33c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTM5NDg2Mw==", "url": "https://github.com/wso2/product-microgateway/pull/944#discussion_r369394863", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        <source>${basedir}/target/ballerina/jballerina-tools-${ballerina.platform.version}/bre/security/ballerinaKeystore.p12</source>\n          \n          \n            \n                        <source>${project.build.directory}/ballerina/jballerina-tools-${ballerina.platform.version}/bre/security/ballerinaKeystore.p12</source>", "author": "praminda", "createdAt": "2020-01-22T06:55:32Z", "path": "distribution/src/main/assembly/gw_runtimes/gw_runtime_linux.xml", "diffHunk": "@@ -74,6 +60,14 @@\n             <source>${basedir}/resources/bin/gateway.bat</source>\n             <outputDirectory>wso2am-micro-gw-linux-${project.version}/bin</outputDirectory>\n         </file>\n+        <file>\n+            <source>${basedir}/resources/ballerinaTruststore.p12</source>\n+            <outputDirectory>wso2am-micro-gw-linux-${project.version}/runtime/bre/security</outputDirectory>\n+        </file>\n+        <file>\n+            <source>${basedir}/target/ballerina/jballerina-tools-${ballerina.platform.version}/bre/security/ballerinaKeystore.p12</source>", "originalCommit": "6877ea4e6a7953477ac2a7ed10c8f6621019e33c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTM5NDkzMg==", "url": "https://github.com/wso2/product-microgateway/pull/944#discussion_r369394932", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        <source>${basedir}/target/ballerina/jballerina-tools-${ballerina.platform.version}/bre/security/ballerinaKeystore.p12</source>\n          \n          \n            \n                        <source>${project.build.directory}/ballerina/jballerina-tools-${ballerina.platform.version}/bre/security/ballerinaKeystore.p12</source>", "author": "praminda", "createdAt": "2020-01-22T06:55:51Z", "path": "distribution/src/main/assembly/gw_runtimes/gw_runtime.xml", "diffHunk": "@@ -73,6 +59,14 @@\n             <source>${basedir}/resources/bin/gateway.bat</source>\n             <outputDirectory>wso2am-micro-gw-${project.version}/bin</outputDirectory>\n         </file>\n+        <file>\n+            <source>${basedir}/resources/ballerinaTruststore.p12</source>\n+            <outputDirectory>wso2am-micro-gw-linux-${project.version}/runtime/bre/security</outputDirectory>\n+        </file>\n+        <file>\n+            <source>${basedir}/target/ballerina/jballerina-tools-${ballerina.platform.version}/bre/security/ballerinaKeystore.p12</source>", "originalCommit": "6877ea4e6a7953477ac2a7ed10c8f6621019e33c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQwODI4Mg==", "url": "https://github.com/wso2/product-microgateway/pull/944#discussion_r369408282", "bodyText": "We no longer need to export this since we don;t use unzip utility. Shall we rename GWHOME to GW_HOME to follow the naming standards.", "author": "praminda", "createdAt": "2020-01-22T07:46:07Z", "path": "distribution/resources/bin/gateway", "diffHunk": "@@ -45,30 +45,106 @@ PRGDIR=`dirname \"$PRG\"`\n \n # set BALLERINA_HOME\n GWHOME=`cd \"$PRGDIR/..\" ; pwd`\n-export BALLERINA_HOME=$GWHOME'/runtime'\n export JAVA_HOME=$GWHOME'/lib/jdk8u202-b08-jre'\n export MGW_VERSION=\"3.1.0\"\n export GW_HOME=\"$GWHOME\"", "originalCommit": "6877ea4e6a7953477ac2a7ed10c8f6621019e33c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTA4MjkxMw==", "url": "https://github.com/wso2/product-microgateway/pull/944#discussion_r371082913", "bodyText": "changed with 116f0fd", "author": "VirajSalaka", "createdAt": "2020-01-27T06:51:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQwODI4Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQwOTAwOQ==", "url": "https://github.com/wso2/product-microgateway/pull/944#discussion_r369409009", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            if test -d \"$JAVA_PATH\"; then\n          \n          \n            \n            if [ -d \"$JAVA_PATH\" ]; then", "author": "praminda", "createdAt": "2020-01-22T07:48:36Z", "path": "distribution/resources/bin/gateway", "diffHunk": "@@ -45,30 +45,106 @@ PRGDIR=`dirname \"$PRG\"`\n \n # set BALLERINA_HOME\n GWHOME=`cd \"$PRGDIR/..\" ; pwd`\n-export BALLERINA_HOME=$GWHOME'/runtime'\n export JAVA_HOME=$GWHOME'/lib/jdk8u202-b08-jre'\n export MGW_VERSION=\"3.1.0\"\n export GW_HOME=\"$GWHOME\"\n \n-if [ -e \"$GWHOME/bin/gateway.pid\" ]; then\n-  PID=`cat \"$GWHOME\"/bin/gateway.pid`\n+JAVA_PATH=$GWHOME/lib/jdk8u202-b08-jre\n+if test -d \"$JAVA_PATH\"; then", "originalCommit": "6877ea4e6a7953477ac2a7ed10c8f6621019e33c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQxMjE3Mw==", "url": "https://github.com/wso2/product-microgateway/pull/944#discussion_r369412173", "bodyText": "So what should be the command for this case?\nmicro-gw test --debug???", "author": "praminda", "createdAt": "2020-01-22T07:58:41Z", "path": "distribution/resources/bin/gateway", "diffHunk": "@@ -45,30 +45,106 @@ PRGDIR=`dirname \"$PRG\"`\n \n # set BALLERINA_HOME\n GWHOME=`cd \"$PRGDIR/..\" ; pwd`\n-export BALLERINA_HOME=$GWHOME'/runtime'\n export JAVA_HOME=$GWHOME'/lib/jdk8u202-b08-jre'\n export MGW_VERSION=\"3.1.0\"\n export GW_HOME=\"$GWHOME\"\n \n-if [ -e \"$GWHOME/bin/gateway.pid\" ]; then\n-  PID=`cat \"$GWHOME\"/bin/gateway.pid`\n+JAVA_PATH=$GWHOME/lib/jdk8u202-b08-jre\n+if test -d \"$JAVA_PATH\"; then\n+  JAVA_HOME=$JAVA_PATH\n fi\n \n-#To run the Java classes\n-java_cmd () {\n-  if [ -z \"$JAVACMD\" ] ; then\n-      if [ -n \"$JAVA_HOME\"  ] ; then\n-          if [ -x \"$JAVA_HOME/jre/sh/java\" ] ; then\n-              # IBM's JDK on AIX uses strange locations for the executables\n-              JAVACMD=\"$JAVA_HOME/jre/sh/java\"\n-          else\n-              JAVACMD=\"$JAVA_HOME/bin/java\"\n-          fi\n-      else\n+BASE_DIR=$PWD\n+cygwin=false;\n+darwin=false;\n+os400=false;\n+mingw=false;\n+case \"`uname`\" in\n+CYGWIN*) cygwin=true;;\n+MINGW*) mingw=true;;\n+OS400*) os400=true;;\n+Darwin*) darwin=true\n+esac\n+\n+# For Cygwin, ensure paths are in UNIX format before anything is touched\n+if $cygwin; then\n+  [ -n \"$JAVA_HOME\" ] && JAVA_HOME=`cygpath --unix \"$JAVA_HOME\"`\n+fi\n+\n+# For OS400\n+if $os400; then\n+  # Set job priority to standard for interactive (interactive - 6) by using\n+  # the interactive priority - 6, the helper threads that respond to requests\n+  # will be running at the same priority as interactive jobs.\n+  COMMAND='chgjob job('$JOBNAME') runpty(6)'\n+  system $COMMAND\n+\n+  # Enable multi threading\n+  QIBM_MULTI_THREADED=Y\n+  export QIBM_MULTI_THREADED\n+fi\n+\n+# For Migwn, ensure paths are in UNIX format before anything is touched\n+if $mingw ; then\n+  [ -n \"$JAVA_HOME\" ] &&\n+    JAVA_HOME=\"`(cd \"$JAVA_HOME\"; pwd)`\"\n+fi\n+\n+if [ -z \"$JAVACMD\" ] ; then\n+    if [ -n \"$JAVA_HOME\"  ] ; then\n+        if [ -x \"$JAVA_HOME/jre/sh/java\" ] ; then\n+            # IBM's JDK on AIX uses strange locations for the executables\n+            JAVACMD=\"$JAVA_HOME/jre/sh/java\"\n+        else\n+            JAVACMD=\"$JAVA_HOME/bin/java\"\n+        fi\n+    else\n           JAVACMD=java\n+    fi\n+fi\n+\n+# For Cygwin, switch paths to Windows format before running java\n+if $cygwin; then\n+    JAVACMD=`cygpath --absolute --windows \"$JAVACMD\"`\n+fi\n+\n+if [ ! -x \"$JAVACMD\" ] ; then\n+  echo \"Error: JAVA Package inside the microgateway runtime distribution is not working.\"\n+  exit 1\n+fi\n+\n+# Ballerina test/debug command\n+argsLength=$#\n+args=($@)\n+for (( i=0; i<argsLength; i++ )); do\n+  if [  \"${args[$i]}\" = \"test\" ]; then\n+    for (( j=0; j<argsLength; j++ )); do\n+      if [ \"${args[$j]}\" = \"--debug\" ]; then", "originalCommit": "6877ea4e6a7953477ac2a7ed10c8f6621019e33c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTA4MzE1MA==", "url": "https://github.com/wso2/product-microgateway/pull/944#discussion_r371083150", "bodyText": "This is added because the ballerina platform supports these parameters.", "author": "VirajSalaka", "createdAt": "2020-01-27T06:53:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQxMjE3Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQxMzEwMw==", "url": "https://github.com/wso2/product-microgateway/pull/944#discussion_r369413103", "bodyText": "As I see BAL_JAVA_DEBUG is not a variable known to user. Shall we say,\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    echo \"Please specify the debug port for the BAL_JAVA_DEBUG variable\"\n          \n          \n            \n                    echo \"Please specify the debug port for debug parameter\"", "author": "praminda", "createdAt": "2020-01-22T08:01:36Z", "path": "distribution/resources/bin/gateway", "diffHunk": "@@ -45,30 +45,106 @@ PRGDIR=`dirname \"$PRG\"`\n \n # set BALLERINA_HOME\n GWHOME=`cd \"$PRGDIR/..\" ; pwd`\n-export BALLERINA_HOME=$GWHOME'/runtime'\n export JAVA_HOME=$GWHOME'/lib/jdk8u202-b08-jre'\n export MGW_VERSION=\"3.1.0\"\n export GW_HOME=\"$GWHOME\"\n \n-if [ -e \"$GWHOME/bin/gateway.pid\" ]; then\n-  PID=`cat \"$GWHOME\"/bin/gateway.pid`\n+JAVA_PATH=$GWHOME/lib/jdk8u202-b08-jre\n+if test -d \"$JAVA_PATH\"; then\n+  JAVA_HOME=$JAVA_PATH\n fi\n \n-#To run the Java classes\n-java_cmd () {\n-  if [ -z \"$JAVACMD\" ] ; then\n-      if [ -n \"$JAVA_HOME\"  ] ; then\n-          if [ -x \"$JAVA_HOME/jre/sh/java\" ] ; then\n-              # IBM's JDK on AIX uses strange locations for the executables\n-              JAVACMD=\"$JAVA_HOME/jre/sh/java\"\n-          else\n-              JAVACMD=\"$JAVA_HOME/bin/java\"\n-          fi\n-      else\n+BASE_DIR=$PWD\n+cygwin=false;\n+darwin=false;\n+os400=false;\n+mingw=false;\n+case \"`uname`\" in\n+CYGWIN*) cygwin=true;;\n+MINGW*) mingw=true;;\n+OS400*) os400=true;;\n+Darwin*) darwin=true\n+esac\n+\n+# For Cygwin, ensure paths are in UNIX format before anything is touched\n+if $cygwin; then\n+  [ -n \"$JAVA_HOME\" ] && JAVA_HOME=`cygpath --unix \"$JAVA_HOME\"`\n+fi\n+\n+# For OS400\n+if $os400; then\n+  # Set job priority to standard for interactive (interactive - 6) by using\n+  # the interactive priority - 6, the helper threads that respond to requests\n+  # will be running at the same priority as interactive jobs.\n+  COMMAND='chgjob job('$JOBNAME') runpty(6)'\n+  system $COMMAND\n+\n+  # Enable multi threading\n+  QIBM_MULTI_THREADED=Y\n+  export QIBM_MULTI_THREADED\n+fi\n+\n+# For Migwn, ensure paths are in UNIX format before anything is touched\n+if $mingw ; then\n+  [ -n \"$JAVA_HOME\" ] &&\n+    JAVA_HOME=\"`(cd \"$JAVA_HOME\"; pwd)`\"\n+fi\n+\n+if [ -z \"$JAVACMD\" ] ; then\n+    if [ -n \"$JAVA_HOME\"  ] ; then\n+        if [ -x \"$JAVA_HOME/jre/sh/java\" ] ; then\n+            # IBM's JDK on AIX uses strange locations for the executables\n+            JAVACMD=\"$JAVA_HOME/jre/sh/java\"\n+        else\n+            JAVACMD=\"$JAVA_HOME/bin/java\"\n+        fi\n+    else\n           JAVACMD=java\n+    fi\n+fi\n+\n+# For Cygwin, switch paths to Windows format before running java\n+if $cygwin; then\n+    JAVACMD=`cygpath --absolute --windows \"$JAVACMD\"`\n+fi\n+\n+if [ ! -x \"$JAVACMD\" ] ; then\n+  echo \"Error: JAVA Package inside the microgateway runtime distribution is not working.\"\n+  exit 1\n+fi\n+\n+# Ballerina test/debug command\n+argsLength=$#\n+args=($@)\n+for (( i=0; i<argsLength; i++ )); do\n+  if [  \"${args[$i]}\" = \"test\" ]; then\n+    for (( j=0; j<argsLength; j++ )); do\n+      if [ \"${args[$j]}\" = \"--debug\" ]; then\n+        BAL_JAVA_DEBUG=${args[$j+1]}\n       fi\n+    done\n   fi\n+done\n+\n+if [ -n \"${BAL_JAVA_DEBUG+set}\" ]; then\n+    if [ -z \"$BAL_JAVA_DEBUG\" ]; then\n+        echo \"Please specify the debug port for the BAL_JAVA_DEBUG variable\"", "originalCommit": "6877ea4e6a7953477ac2a7ed10c8f6621019e33c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQxMzIyNg==", "url": "https://github.com/wso2/product-microgateway/pull/944#discussion_r369413226", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              exit 1\n          \n          \n            \n                    exit 1", "author": "praminda", "createdAt": "2020-01-22T08:02:00Z", "path": "distribution/resources/bin/gateway", "diffHunk": "@@ -45,30 +45,106 @@ PRGDIR=`dirname \"$PRG\"`\n \n # set BALLERINA_HOME\n GWHOME=`cd \"$PRGDIR/..\" ; pwd`\n-export BALLERINA_HOME=$GWHOME'/runtime'\n export JAVA_HOME=$GWHOME'/lib/jdk8u202-b08-jre'\n export MGW_VERSION=\"3.1.0\"\n export GW_HOME=\"$GWHOME\"\n \n-if [ -e \"$GWHOME/bin/gateway.pid\" ]; then\n-  PID=`cat \"$GWHOME\"/bin/gateway.pid`\n+JAVA_PATH=$GWHOME/lib/jdk8u202-b08-jre\n+if test -d \"$JAVA_PATH\"; then\n+  JAVA_HOME=$JAVA_PATH\n fi\n \n-#To run the Java classes\n-java_cmd () {\n-  if [ -z \"$JAVACMD\" ] ; then\n-      if [ -n \"$JAVA_HOME\"  ] ; then\n-          if [ -x \"$JAVA_HOME/jre/sh/java\" ] ; then\n-              # IBM's JDK on AIX uses strange locations for the executables\n-              JAVACMD=\"$JAVA_HOME/jre/sh/java\"\n-          else\n-              JAVACMD=\"$JAVA_HOME/bin/java\"\n-          fi\n-      else\n+BASE_DIR=$PWD\n+cygwin=false;\n+darwin=false;\n+os400=false;\n+mingw=false;\n+case \"`uname`\" in\n+CYGWIN*) cygwin=true;;\n+MINGW*) mingw=true;;\n+OS400*) os400=true;;\n+Darwin*) darwin=true\n+esac\n+\n+# For Cygwin, ensure paths are in UNIX format before anything is touched\n+if $cygwin; then\n+  [ -n \"$JAVA_HOME\" ] && JAVA_HOME=`cygpath --unix \"$JAVA_HOME\"`\n+fi\n+\n+# For OS400\n+if $os400; then\n+  # Set job priority to standard for interactive (interactive - 6) by using\n+  # the interactive priority - 6, the helper threads that respond to requests\n+  # will be running at the same priority as interactive jobs.\n+  COMMAND='chgjob job('$JOBNAME') runpty(6)'\n+  system $COMMAND\n+\n+  # Enable multi threading\n+  QIBM_MULTI_THREADED=Y\n+  export QIBM_MULTI_THREADED\n+fi\n+\n+# For Migwn, ensure paths are in UNIX format before anything is touched\n+if $mingw ; then\n+  [ -n \"$JAVA_HOME\" ] &&\n+    JAVA_HOME=\"`(cd \"$JAVA_HOME\"; pwd)`\"\n+fi\n+\n+if [ -z \"$JAVACMD\" ] ; then\n+    if [ -n \"$JAVA_HOME\"  ] ; then\n+        if [ -x \"$JAVA_HOME/jre/sh/java\" ] ; then\n+            # IBM's JDK on AIX uses strange locations for the executables\n+            JAVACMD=\"$JAVA_HOME/jre/sh/java\"\n+        else\n+            JAVACMD=\"$JAVA_HOME/bin/java\"\n+        fi\n+    else\n           JAVACMD=java\n+    fi\n+fi\n+\n+# For Cygwin, switch paths to Windows format before running java\n+if $cygwin; then\n+    JAVACMD=`cygpath --absolute --windows \"$JAVACMD\"`\n+fi\n+\n+if [ ! -x \"$JAVACMD\" ] ; then\n+  echo \"Error: JAVA Package inside the microgateway runtime distribution is not working.\"\n+  exit 1\n+fi\n+\n+# Ballerina test/debug command\n+argsLength=$#\n+args=($@)\n+for (( i=0; i<argsLength; i++ )); do\n+  if [  \"${args[$i]}\" = \"test\" ]; then\n+    for (( j=0; j<argsLength; j++ )); do\n+      if [ \"${args[$j]}\" = \"--debug\" ]; then\n+        BAL_JAVA_DEBUG=${args[$j+1]}\n       fi\n+    done\n   fi\n+done\n+\n+if [ -n \"${BAL_JAVA_DEBUG+set}\" ]; then\n+    if [ -z \"$BAL_JAVA_DEBUG\" ]; then\n+        echo \"Please specify the debug port for the BAL_JAVA_DEBUG variable\"\n+  exit 1", "originalCommit": "6877ea4e6a7953477ac2a7ed10c8f6621019e33c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQyMjk0OQ==", "url": "https://github.com/wso2/product-microgateway/pull/944#discussion_r369422949", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                echo \"Warning !!!. User specified JAVA_OPTS may interfere with BAL_JAVA_DEBUG\"\n          \n          \n            \n                echo \"Warn: User specified JAVA_OPTS may interfere with BAL_JAVA_DEBUG\"", "author": "praminda", "createdAt": "2020-01-22T08:28:42Z", "path": "distribution/resources/bin/gateway", "diffHunk": "@@ -45,30 +45,106 @@ PRGDIR=`dirname \"$PRG\"`\n \n # set BALLERINA_HOME\n GWHOME=`cd \"$PRGDIR/..\" ; pwd`\n-export BALLERINA_HOME=$GWHOME'/runtime'\n export JAVA_HOME=$GWHOME'/lib/jdk8u202-b08-jre'\n export MGW_VERSION=\"3.1.0\"\n export GW_HOME=\"$GWHOME\"\n \n-if [ -e \"$GWHOME/bin/gateway.pid\" ]; then\n-  PID=`cat \"$GWHOME\"/bin/gateway.pid`\n+JAVA_PATH=$GWHOME/lib/jdk8u202-b08-jre\n+if test -d \"$JAVA_PATH\"; then\n+  JAVA_HOME=$JAVA_PATH\n fi\n \n-#To run the Java classes\n-java_cmd () {\n-  if [ -z \"$JAVACMD\" ] ; then\n-      if [ -n \"$JAVA_HOME\"  ] ; then\n-          if [ -x \"$JAVA_HOME/jre/sh/java\" ] ; then\n-              # IBM's JDK on AIX uses strange locations for the executables\n-              JAVACMD=\"$JAVA_HOME/jre/sh/java\"\n-          else\n-              JAVACMD=\"$JAVA_HOME/bin/java\"\n-          fi\n-      else\n+BASE_DIR=$PWD\n+cygwin=false;\n+darwin=false;\n+os400=false;\n+mingw=false;\n+case \"`uname`\" in\n+CYGWIN*) cygwin=true;;\n+MINGW*) mingw=true;;\n+OS400*) os400=true;;\n+Darwin*) darwin=true\n+esac\n+\n+# For Cygwin, ensure paths are in UNIX format before anything is touched\n+if $cygwin; then\n+  [ -n \"$JAVA_HOME\" ] && JAVA_HOME=`cygpath --unix \"$JAVA_HOME\"`\n+fi\n+\n+# For OS400\n+if $os400; then\n+  # Set job priority to standard for interactive (interactive - 6) by using\n+  # the interactive priority - 6, the helper threads that respond to requests\n+  # will be running at the same priority as interactive jobs.\n+  COMMAND='chgjob job('$JOBNAME') runpty(6)'\n+  system $COMMAND\n+\n+  # Enable multi threading\n+  QIBM_MULTI_THREADED=Y\n+  export QIBM_MULTI_THREADED\n+fi\n+\n+# For Migwn, ensure paths are in UNIX format before anything is touched\n+if $mingw ; then\n+  [ -n \"$JAVA_HOME\" ] &&\n+    JAVA_HOME=\"`(cd \"$JAVA_HOME\"; pwd)`\"\n+fi\n+\n+if [ -z \"$JAVACMD\" ] ; then\n+    if [ -n \"$JAVA_HOME\"  ] ; then\n+        if [ -x \"$JAVA_HOME/jre/sh/java\" ] ; then\n+            # IBM's JDK on AIX uses strange locations for the executables\n+            JAVACMD=\"$JAVA_HOME/jre/sh/java\"\n+        else\n+            JAVACMD=\"$JAVA_HOME/bin/java\"\n+        fi\n+    else\n           JAVACMD=java\n+    fi\n+fi\n+\n+# For Cygwin, switch paths to Windows format before running java\n+if $cygwin; then\n+    JAVACMD=`cygpath --absolute --windows \"$JAVACMD\"`\n+fi\n+\n+if [ ! -x \"$JAVACMD\" ] ; then\n+  echo \"Error: JAVA Package inside the microgateway runtime distribution is not working.\"\n+  exit 1\n+fi\n+\n+# Ballerina test/debug command\n+argsLength=$#\n+args=($@)\n+for (( i=0; i<argsLength; i++ )); do\n+  if [  \"${args[$i]}\" = \"test\" ]; then\n+    for (( j=0; j<argsLength; j++ )); do\n+      if [ \"${args[$j]}\" = \"--debug\" ]; then\n+        BAL_JAVA_DEBUG=${args[$j+1]}\n       fi\n+    done\n   fi\n+done\n+\n+if [ -n \"${BAL_JAVA_DEBUG+set}\" ]; then\n+    if [ -z \"$BAL_JAVA_DEBUG\" ]; then\n+        echo \"Please specify the debug port for the BAL_JAVA_DEBUG variable\"\n+  exit 1\n+    else\n+  if [ -n \"$JAVA_OPTS\" ]; then\n+    echo \"Warning !!!. User specified JAVA_OPTS may interfere with BAL_JAVA_DEBUG\"", "originalCommit": "9724977d61d59bffe0ea4592c779ea35f2d7f28a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTA4NDAwOQ==", "url": "https://github.com/wso2/product-microgateway/pull/944#discussion_r371084009", "bodyText": "fixed with ee002a5", "author": "VirajSalaka", "createdAt": "2020-01-27T06:57:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQyMjk0OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQyMzEzMw==", "url": "https://github.com/wso2/product-microgateway/pull/944#discussion_r369423133", "bodyText": "Please add a comment explaining whats going on in these conditions", "author": "praminda", "createdAt": "2020-01-22T08:29:09Z", "path": "distribution/resources/bin/gateway", "diffHunk": "@@ -45,30 +45,106 @@ PRGDIR=`dirname \"$PRG\"`\n \n # set BALLERINA_HOME\n GWHOME=`cd \"$PRGDIR/..\" ; pwd`\n-export BALLERINA_HOME=$GWHOME'/runtime'\n export JAVA_HOME=$GWHOME'/lib/jdk8u202-b08-jre'\n export MGW_VERSION=\"3.1.0\"\n export GW_HOME=\"$GWHOME\"\n \n-if [ -e \"$GWHOME/bin/gateway.pid\" ]; then\n-  PID=`cat \"$GWHOME\"/bin/gateway.pid`\n+JAVA_PATH=$GWHOME/lib/jdk8u202-b08-jre\n+if test -d \"$JAVA_PATH\"; then\n+  JAVA_HOME=$JAVA_PATH\n fi\n \n-#To run the Java classes\n-java_cmd () {\n-  if [ -z \"$JAVACMD\" ] ; then\n-      if [ -n \"$JAVA_HOME\"  ] ; then\n-          if [ -x \"$JAVA_HOME/jre/sh/java\" ] ; then\n-              # IBM's JDK on AIX uses strange locations for the executables\n-              JAVACMD=\"$JAVA_HOME/jre/sh/java\"\n-          else\n-              JAVACMD=\"$JAVA_HOME/bin/java\"\n-          fi\n-      else\n+BASE_DIR=$PWD\n+cygwin=false;\n+darwin=false;\n+os400=false;\n+mingw=false;\n+case \"`uname`\" in\n+CYGWIN*) cygwin=true;;\n+MINGW*) mingw=true;;\n+OS400*) os400=true;;\n+Darwin*) darwin=true\n+esac\n+\n+# For Cygwin, ensure paths are in UNIX format before anything is touched\n+if $cygwin; then\n+  [ -n \"$JAVA_HOME\" ] && JAVA_HOME=`cygpath --unix \"$JAVA_HOME\"`\n+fi\n+\n+# For OS400\n+if $os400; then\n+  # Set job priority to standard for interactive (interactive - 6) by using\n+  # the interactive priority - 6, the helper threads that respond to requests\n+  # will be running at the same priority as interactive jobs.\n+  COMMAND='chgjob job('$JOBNAME') runpty(6)'\n+  system $COMMAND\n+\n+  # Enable multi threading\n+  QIBM_MULTI_THREADED=Y\n+  export QIBM_MULTI_THREADED\n+fi\n+\n+# For Migwn, ensure paths are in UNIX format before anything is touched\n+if $mingw ; then\n+  [ -n \"$JAVA_HOME\" ] &&\n+    JAVA_HOME=\"`(cd \"$JAVA_HOME\"; pwd)`\"\n+fi\n+\n+if [ -z \"$JAVACMD\" ] ; then\n+    if [ -n \"$JAVA_HOME\"  ] ; then\n+        if [ -x \"$JAVA_HOME/jre/sh/java\" ] ; then\n+            # IBM's JDK on AIX uses strange locations for the executables\n+            JAVACMD=\"$JAVA_HOME/jre/sh/java\"\n+        else\n+            JAVACMD=\"$JAVA_HOME/bin/java\"\n+        fi\n+    else\n           JAVACMD=java\n+    fi\n+fi\n+\n+# For Cygwin, switch paths to Windows format before running java\n+if $cygwin; then\n+    JAVACMD=`cygpath --absolute --windows \"$JAVACMD\"`\n+fi\n+\n+if [ ! -x \"$JAVACMD\" ] ; then\n+  echo \"Error: JAVA Package inside the microgateway runtime distribution is not working.\"\n+  exit 1\n+fi\n+\n+# Ballerina test/debug command\n+argsLength=$#\n+args=($@)\n+for (( i=0; i<argsLength; i++ )); do\n+  if [  \"${args[$i]}\" = \"test\" ]; then\n+    for (( j=0; j<argsLength; j++ )); do\n+      if [ \"${args[$j]}\" = \"--debug\" ]; then\n+        BAL_JAVA_DEBUG=${args[$j+1]}\n       fi\n+    done\n   fi\n+done\n+\n+if [ -n \"${BAL_JAVA_DEBUG+set}\" ]; then", "originalCommit": "9724977d61d59bffe0ea4592c779ea35f2d7f28a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTA4Mzk3NA==", "url": "https://github.com/wso2/product-microgateway/pull/944#discussion_r371083974", "bodyText": "added with ee002a5", "author": "VirajSalaka", "createdAt": "2020-01-27T06:57:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQyMzEzMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQyMzI1OA==", "url": "https://github.com/wso2/product-microgateway/pull/944#discussion_r369423258", "bodyText": "Check the indentation of else block", "author": "praminda", "createdAt": "2020-01-22T08:29:32Z", "path": "distribution/resources/bin/gateway", "diffHunk": "@@ -45,30 +45,106 @@ PRGDIR=`dirname \"$PRG\"`\n \n # set BALLERINA_HOME\n GWHOME=`cd \"$PRGDIR/..\" ; pwd`\n-export BALLERINA_HOME=$GWHOME'/runtime'\n export JAVA_HOME=$GWHOME'/lib/jdk8u202-b08-jre'\n export MGW_VERSION=\"3.1.0\"\n export GW_HOME=\"$GWHOME\"\n \n-if [ -e \"$GWHOME/bin/gateway.pid\" ]; then\n-  PID=`cat \"$GWHOME\"/bin/gateway.pid`\n+JAVA_PATH=$GWHOME/lib/jdk8u202-b08-jre\n+if test -d \"$JAVA_PATH\"; then\n+  JAVA_HOME=$JAVA_PATH\n fi\n \n-#To run the Java classes\n-java_cmd () {\n-  if [ -z \"$JAVACMD\" ] ; then\n-      if [ -n \"$JAVA_HOME\"  ] ; then\n-          if [ -x \"$JAVA_HOME/jre/sh/java\" ] ; then\n-              # IBM's JDK on AIX uses strange locations for the executables\n-              JAVACMD=\"$JAVA_HOME/jre/sh/java\"\n-          else\n-              JAVACMD=\"$JAVA_HOME/bin/java\"\n-          fi\n-      else\n+BASE_DIR=$PWD\n+cygwin=false;\n+darwin=false;\n+os400=false;\n+mingw=false;\n+case \"`uname`\" in\n+CYGWIN*) cygwin=true;;\n+MINGW*) mingw=true;;\n+OS400*) os400=true;;\n+Darwin*) darwin=true\n+esac\n+\n+# For Cygwin, ensure paths are in UNIX format before anything is touched\n+if $cygwin; then\n+  [ -n \"$JAVA_HOME\" ] && JAVA_HOME=`cygpath --unix \"$JAVA_HOME\"`\n+fi\n+\n+# For OS400\n+if $os400; then\n+  # Set job priority to standard for interactive (interactive - 6) by using\n+  # the interactive priority - 6, the helper threads that respond to requests\n+  # will be running at the same priority as interactive jobs.\n+  COMMAND='chgjob job('$JOBNAME') runpty(6)'\n+  system $COMMAND\n+\n+  # Enable multi threading\n+  QIBM_MULTI_THREADED=Y\n+  export QIBM_MULTI_THREADED\n+fi\n+\n+# For Migwn, ensure paths are in UNIX format before anything is touched\n+if $mingw ; then\n+  [ -n \"$JAVA_HOME\" ] &&\n+    JAVA_HOME=\"`(cd \"$JAVA_HOME\"; pwd)`\"\n+fi\n+\n+if [ -z \"$JAVACMD\" ] ; then\n+    if [ -n \"$JAVA_HOME\"  ] ; then\n+        if [ -x \"$JAVA_HOME/jre/sh/java\" ] ; then\n+            # IBM's JDK on AIX uses strange locations for the executables\n+            JAVACMD=\"$JAVA_HOME/jre/sh/java\"\n+        else\n+            JAVACMD=\"$JAVA_HOME/bin/java\"\n+        fi\n+    else\n           JAVACMD=java\n+    fi\n+fi\n+\n+# For Cygwin, switch paths to Windows format before running java\n+if $cygwin; then\n+    JAVACMD=`cygpath --absolute --windows \"$JAVACMD\"`\n+fi\n+\n+if [ ! -x \"$JAVACMD\" ] ; then\n+  echo \"Error: JAVA Package inside the microgateway runtime distribution is not working.\"\n+  exit 1\n+fi\n+\n+# Ballerina test/debug command\n+argsLength=$#\n+args=($@)\n+for (( i=0; i<argsLength; i++ )); do\n+  if [  \"${args[$i]}\" = \"test\" ]; then\n+    for (( j=0; j<argsLength; j++ )); do\n+      if [ \"${args[$j]}\" = \"--debug\" ]; then\n+        BAL_JAVA_DEBUG=${args[$j+1]}\n       fi\n+    done\n   fi\n+done\n+\n+if [ -n \"${BAL_JAVA_DEBUG+set}\" ]; then\n+    if [ -z \"$BAL_JAVA_DEBUG\" ]; then\n+        echo \"Please specify the debug port for the BAL_JAVA_DEBUG variable\"\n+  exit 1\n+    else", "originalCommit": "9724977d61d59bffe0ea4592c779ea35f2d7f28a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQyNDE4Ng==", "url": "https://github.com/wso2/product-microgateway/pull/944#discussion_r369424186", "bodyText": "Looks like the block is indented with two spaces", "author": "praminda", "createdAt": "2020-01-22T08:31:48Z", "path": "distribution/resources/bin/gateway", "diffHunk": "@@ -113,61 +214,53 @@ done\n for last; do true; done\n \n if [ ! \"$CMD\" = \"stop\" ]; then\n-  if [[ ! -f \"$1\" ]]; then\n+  if [[ \"$CMD\" == \"\" ]]; then", "originalCommit": "9724977d61d59bffe0ea4592c779ea35f2d7f28a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQyNTQ2Mw==", "url": "https://github.com/wso2/product-microgateway/pull/944#discussion_r369425463", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            java_cmd_tools \"$CONFIG_FILE $CONFIG_OUT_FILE\"\n          \n          \n            \n                java_cmd_tools \"$CONFIG_FILE $CONFIG_OUT_FILE\"", "author": "praminda", "createdAt": "2020-01-22T08:34:59Z", "path": "distribution/resources/bin/gateway", "diffHunk": "@@ -113,61 +214,53 @@ done\n for last; do true; done\n \n if [ ! \"$CMD\" = \"stop\" ]; then\n-  if [[ ! -f \"$1\" ]]; then\n+  if [[ \"$CMD\" == \"\" ]]; then\n+    if [[ ! -f \"$1\" ]]; then\n       echo \"Path to executable jar file is invalid\"\n       exit 0\n-  fi\n-fi\n-\n-\n-# Extract ballerina runtime\n-if [ ! -d \"$GWHOME/runtime\" ]; then\n-    echo \"Initializing Runtime...\"\n-    java_cmd \"unzip\"\n-    if [ $? -eq 0 ]; then\n-        cp $GWHOME/lib/gateway/*.jar $GWHOME/runtime/bre/lib/\n     fi\n+  elif [[ ! -f \"${args[1]}\" ]]; then\n+      echo \"Path to executable jar file is invalid\"\n+      exit 0\n+  fi\n fi\n \n-# Set JAVA Xms and Xmx values in Ballerina runtime\n-sed -i\".back\" \"s/-Xms[0-9]*m/-Xms$JAVA_XMS_VALUE/\" $BALLERINA_HOME/bin/ballerina\n-sed -i\".back\" \"s/-Xmx[0-9]*m/-Xmx$JAVA_XMX_VALUE/\" $BALLERINA_HOME/bin/ballerina\n-rm $BALLERINA_HOME/bin/ballerina.back\n-\n-FLAG=\"false\"\n+OBSERVABILITY_FLAG=\"false\"\n CONFIG_FILE=\"$GWHOME/conf/micro-gw.conf\"\n CONFIG_OUT_FILE=\"$GWHOME/.config\"\n \n if [[ $b7a_observability_metrics_enabled == \"true\" ]]; then\n-    FLAG=\"true\"\n+    OBSERVABILITY_FLAG=\"true\"\n else\n     for c in $*\n     do\n-        if [ \"$c\" = \"--b7a.observability.enabled=true\" ] || [ \"$c\" = \"--b7a.observability.metrics.enabled=true\" ]; then \n-            FLAG=\"true\"\n-            break    \n+        if [ \"$c\" = \"--b7a.observability.enabled=true\" ] || [ \"$c\" = \"--b7a.observability.metrics.enabled=true\" ]; then\n+            OBSERVABILITY_FLAG=\"true\"\n+            break\n         fi\n-    done    \n+    done\n fi\n \n-java_cmd \"getConfig $CONFIG_FILE $CONFIG_OUT_FILE\"\n-\n-if [ -f \"$CONFIG_OUT_FILE\" ]; then\n-    if [ \"$FLAG\" != \"true\" ]; then \n-        if [ $(sed -n '1p' $CONFIG_OUT_FILE) == \"true\" ]; then\n-            FLAG=\"true\"\n-        fi\n-    fi\n-    if [ \"$FLAG\" == \"true\" ]; then\n-        jmx_port=$(sed -n '2p' $CONFIG_OUT_FILE)\n-        export JAVA_OPTS=\"-javaagent:$GWHOME/lib/gateway/jmx_prometheus_javaagent-0.12.0.jar=$jmx_port:$GWHOME/conf/Prometheus/config.yml\"\n-    fi\n-else\n-    echo \"Error while reading Observability configurations from the file\"\n+if [ ! \"$CMD\" = \"stop\" ]; then\n+java_cmd_tools \"$CONFIG_FILE $CONFIG_OUT_FILE\"", "originalCommit": "9724977d61d59bffe0ea4592c779ea35f2d7f28a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQyNTU5MQ==", "url": "https://github.com/wso2/product-microgateway/pull/944#discussion_r369425591", "bodyText": "Block is indented with two spaces", "author": "praminda", "createdAt": "2020-01-22T08:35:17Z", "path": "distribution/resources/bin/gateway", "diffHunk": "@@ -113,61 +214,53 @@ done\n for last; do true; done\n \n if [ ! \"$CMD\" = \"stop\" ]; then\n-  if [[ ! -f \"$1\" ]]; then\n+  if [[ \"$CMD\" == \"\" ]]; then\n+    if [[ ! -f \"$1\" ]]; then\n       echo \"Path to executable jar file is invalid\"\n       exit 0\n-  fi\n-fi\n-\n-\n-# Extract ballerina runtime\n-if [ ! -d \"$GWHOME/runtime\" ]; then\n-    echo \"Initializing Runtime...\"\n-    java_cmd \"unzip\"\n-    if [ $? -eq 0 ]; then\n-        cp $GWHOME/lib/gateway/*.jar $GWHOME/runtime/bre/lib/\n     fi\n+  elif [[ ! -f \"${args[1]}\" ]]; then\n+      echo \"Path to executable jar file is invalid\"\n+      exit 0\n+  fi\n fi\n \n-# Set JAVA Xms and Xmx values in Ballerina runtime\n-sed -i\".back\" \"s/-Xms[0-9]*m/-Xms$JAVA_XMS_VALUE/\" $BALLERINA_HOME/bin/ballerina\n-sed -i\".back\" \"s/-Xmx[0-9]*m/-Xmx$JAVA_XMX_VALUE/\" $BALLERINA_HOME/bin/ballerina\n-rm $BALLERINA_HOME/bin/ballerina.back\n-\n-FLAG=\"false\"\n+OBSERVABILITY_FLAG=\"false\"\n CONFIG_FILE=\"$GWHOME/conf/micro-gw.conf\"\n CONFIG_OUT_FILE=\"$GWHOME/.config\"\n \n if [[ $b7a_observability_metrics_enabled == \"true\" ]]; then\n-    FLAG=\"true\"\n+    OBSERVABILITY_FLAG=\"true\"\n else\n     for c in $*\n     do\n-        if [ \"$c\" = \"--b7a.observability.enabled=true\" ] || [ \"$c\" = \"--b7a.observability.metrics.enabled=true\" ]; then \n-            FLAG=\"true\"\n-            break    \n+        if [ \"$c\" = \"--b7a.observability.enabled=true\" ] || [ \"$c\" = \"--b7a.observability.metrics.enabled=true\" ]; then\n+            OBSERVABILITY_FLAG=\"true\"\n+            break\n         fi\n-    done    \n+    done\n fi\n \n-java_cmd \"getConfig $CONFIG_FILE $CONFIG_OUT_FILE\"\n-\n-if [ -f \"$CONFIG_OUT_FILE\" ]; then\n-    if [ \"$FLAG\" != \"true\" ]; then \n-        if [ $(sed -n '1p' $CONFIG_OUT_FILE) == \"true\" ]; then\n-            FLAG=\"true\"\n-        fi\n-    fi\n-    if [ \"$FLAG\" == \"true\" ]; then\n-        jmx_port=$(sed -n '2p' $CONFIG_OUT_FILE)\n-        export JAVA_OPTS=\"-javaagent:$GWHOME/lib/gateway/jmx_prometheus_javaagent-0.12.0.jar=$jmx_port:$GWHOME/conf/Prometheus/config.yml\"\n-    fi\n-else\n-    echo \"Error while reading Observability configurations from the file\"\n+if [ ! \"$CMD\" = \"stop\" ]; then\n+java_cmd_tools \"$CONFIG_FILE $CONFIG_OUT_FILE\"\n+  if [ -f \"$CONFIG_OUT_FILE\" ]; then", "originalCommit": "9724977d61d59bffe0ea4592c779ea35f2d7f28a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQyNzIwNw==", "url": "https://github.com/wso2/product-microgateway/pull/944#discussion_r369427207", "bodyText": "Shall we check $? = 0 before saying success?", "author": "praminda", "createdAt": "2020-01-22T08:39:13Z", "path": "distribution/resources/bin/gateway", "diffHunk": "@@ -201,14 +293,13 @@ EOF\n   done\n elif [ \"$CMD\" = \"stop\" ]; then\n   export GWHOME=\"$GWHOME\"\n-  kill -term `cat \"$GWHOME\"/bin/gateway.pid`\n-  kill -9 `lsof -t $GWHOME/logs/access_logs`\n+  kill -term `cat $GWHOME/bin/gateway.pid`\n   rm -f file $GWHOME/bin/gateway.pid\n+  echo \"Microgateway has been stopped successfully\"", "originalCommit": "9724977d61d59bffe0ea4592c779ea35f2d7f28a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTA4MjYyMQ==", "url": "https://github.com/wso2/product-microgateway/pull/944#discussion_r371082621", "bodyText": "fixed with 94a724d", "author": "VirajSalaka", "createdAt": "2020-01-27T06:50:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQyNzIwNw=="}], "type": "inlineReview"}, {"oid": "bb0aa601bf5c672db1663d7f64d6b805858f377b", "url": "https://github.com/wso2/product-microgateway/commit/bb0aa601bf5c672db1663d7f64d6b805858f377b", "message": "Update distribution/src/main/assembly/gw_runtimes/gw_runtime_windows.xml\n\nCo-Authored-By: Praminda <pramindabj@gmail.com>", "committedDate": "2020-01-27T05:14:07Z", "type": "commit"}, {"oid": "20392f61730afad2cb450374c9de1f073c01367f", "url": "https://github.com/wso2/product-microgateway/commit/20392f61730afad2cb450374c9de1f073c01367f", "message": "Update distribution/src/main/assembly/gw_runtimes/gw_runtime_macos.xml\n\nCo-Authored-By: Praminda <pramindabj@gmail.com>", "committedDate": "2020-01-27T05:14:15Z", "type": "commit"}, {"oid": "90b827628e0eae96302b49b221e2c08178176f08", "url": "https://github.com/wso2/product-microgateway/commit/90b827628e0eae96302b49b221e2c08178176f08", "message": "Update distribution/src/main/assembly/gw_runtimes/gw_runtime.xml\n\nCo-Authored-By: Praminda <pramindabj@gmail.com>", "committedDate": "2020-01-27T05:14:22Z", "type": "commit"}, {"oid": "c7130d3b246a3f08c204f26fb87add550b854f01", "url": "https://github.com/wso2/product-microgateway/commit/c7130d3b246a3f08c204f26fb87add550b854f01", "message": "Update distribution/src/main/assembly/gw_runtimes/gw_runtime_linux.xml\n\nCo-Authored-By: Praminda <pramindabj@gmail.com>", "committedDate": "2020-01-27T05:15:17Z", "type": "commit"}, {"oid": "62a6d2bf50f6c2e6cb98f570167282b4d47578fc", "url": "https://github.com/wso2/product-microgateway/commit/62a6d2bf50f6c2e6cb98f570167282b4d47578fc", "message": "Update distribution/resources/bin/gateway\n\nCo-Authored-By: Praminda <pramindabj@gmail.com>", "committedDate": "2020-01-27T05:16:41Z", "type": "commit"}, {"oid": "31bd87285d38d9ab4cfb35572272b9eb10e7f5b1", "url": "https://github.com/wso2/product-microgateway/commit/31bd87285d38d9ab4cfb35572272b9eb10e7f5b1", "message": "Update distribution/resources/bin/gateway\n\nCo-Authored-By: Praminda <pramindabj@gmail.com>", "committedDate": "2020-01-27T05:27:36Z", "type": "commit"}, {"oid": "97574fc3c6b0d8e9e01d91c2325b9d750afc6c7c", "url": "https://github.com/wso2/product-microgateway/commit/97574fc3c6b0d8e9e01d91c2325b9d750afc6c7c", "message": "Update distribution/resources/bin/gateway\n\nCo-Authored-By: Praminda <pramindabj@gmail.com>", "committedDate": "2020-01-27T05:27:58Z", "type": "commit"}, {"oid": "f10fb73078b9661fc291ea975e9f6702429a2f6b", "url": "https://github.com/wso2/product-microgateway/commit/f10fb73078b9661fc291ea975e9f6702429a2f6b", "message": "Update distribution/resources/bin/gateway\n\nCo-Authored-By: Praminda <pramindabj@gmail.com>", "committedDate": "2020-01-27T05:28:08Z", "type": "commit"}, {"oid": "116f0fd4d3555cbdb80bb171f38b71587dc95692", "url": "https://github.com/wso2/product-microgateway/commit/116f0fd4d3555cbdb80bb171f38b71587dc95692", "message": "fix commented issues", "committedDate": "2020-01-27T06:19:20Z", "type": "commit"}, {"oid": "94a724d3ba8f79d677f4d2d3ec1e94125ec01db1", "url": "https://github.com/wso2/product-microgateway/commit/94a724d3ba8f79d677f4d2d3ec1e94125ec01db1", "message": "provide proper error message during stop command if no gateway is running", "committedDate": "2020-01-27T06:48:38Z", "type": "commit"}, {"oid": "ee002a57923994065b743410db14e25ac065a88b", "url": "https://github.com/wso2/product-microgateway/commit/ee002a57923994065b743410db14e25ac065a88b", "message": "fix commented issues", "committedDate": "2020-01-27T06:56:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTA2ODk3Nw==", "url": "https://github.com/wso2/product-microgateway/pull/944#discussion_r371068977", "bodyText": "Please remove this file", "author": "praminda", "createdAt": "2020-01-27T05:33:28Z", "path": "components/micro-gateway-cli/.factorypath", "diffHunk": "@@ -0,0 +1,230 @@\n+<factorypath>", "originalCommit": "f10fb73078b9661fc291ea975e9f6702429a2f6b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTA2OTAyNA==", "url": "https://github.com/wso2/product-microgateway/pull/944#discussion_r371069024", "bodyText": "Please remove this file from the PR", "author": "praminda", "createdAt": "2020-01-27T05:33:50Z", "path": "components/micro-gateway-core/.factorypath", "diffHunk": "@@ -0,0 +1,159 @@\n+<factorypath>", "originalCommit": "f10fb73078b9661fc291ea975e9f6702429a2f6b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTA2OTA5OQ==", "url": "https://github.com/wso2/product-microgateway/pull/944#discussion_r371069099", "bodyText": "Remove this file", "author": "praminda", "createdAt": "2020-01-27T05:34:21Z", "path": "tests/.factorypath", "diffHunk": "@@ -0,0 +1,221 @@\n+<factorypath>", "originalCommit": "f10fb73078b9661fc291ea975e9f6702429a2f6b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "ed2370fb0cb33239d6773165f0a54bfe9468b394", "url": "https://github.com/wso2/product-microgateway/commit/ed2370fb0cb33239d6773165f0a54bfe9468b394", "message": "remove factory path", "committedDate": "2020-01-27T08:00:58Z", "type": "commit"}]}