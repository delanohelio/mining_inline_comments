{"pr_number": 1209, "pr_title": "Fix #1207 - Issue when endpoint url contain special characters", "pr_createdAt": "2020-04-22T13:33:37Z", "pr_url": "https://github.com/wso2/product-microgateway/pull/1209", "timeline": [{"oid": "161810d51862fd21b67547850d00bc7a43633844", "url": "https://github.com/wso2/product-microgateway/commit/161810d51862fd21b67547850d00bc7a43633844", "message": "Fix #1207 - Issue when endpoint url contain special characters\n\nWhen production endpoints containing special characters are specified in the open API definition, microgateway route the\nrequest to a wrong endpoint. This issue happens for production endpoints like \"http://test.com?value1=foo&valu2=bar\"\nwhere it contains query parameters.", "committedDate": "2020-04-22T13:27:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzQ2ODg2OQ==", "url": "https://github.com/wso2/product-microgateway/pull/1209#discussion_r413468869", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            });\n          \n          \n            \n            });", "author": "praminda", "createdAt": "2020-04-23T02:47:44Z", "path": "components/micro-gateway-cli/src/main/resources/templates/httpEndpoint.mustache", "diffHunk": "@@ -1,4 +1,4 @@\n http:Client {{qualifiedServiceName}}_{{endpointUrlType}} = new (\n-{{#if endpoints.0.isEtcdEnabled}}gateway:etcdSetup(\"{{name}}_{{endpointUrlType}}_endpoint_0\",\"{{name}}_{{endpointUrlType}}_0_etcdKey\",\"{{endpoints.0.endpointUrl}}\",\"{{endpoints.0.etcdKey}}\"){{else}}gateway:retrieveConfig(\"{{name}}_{{endpointUrlType}}_endpoint_0\",\"{{endpoints.0.endpointUrl}}\"){{/if}},\n+{{#if endpoints.0.isEtcdEnabled}}gateway:etcdSetup(\"{{name}}_{{endpointUrlType}}_endpoint_0\",\"{{name}}_{{endpointUrlType}}_0_etcdKey\",\"{{{endpoints.0.endpointUrl}}}\",\"{{endpoints.0.etcdKey}}\"){{else}}gateway:retrieveConfig(\"{{name}}_{{endpointUrlType}}_endpoint_0\",\"{{{endpoints.0.endpointUrl}}}\"){{/if}},\n { {{>http2}}{{>http2settings}}{{>caching}}{{>basicAuth}}{{>secureSocket}}\n });", "originalCommit": "161810d51862fd21b67547850d00bc7a43633844", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzQ2ODkzNA==", "url": "https://github.com/wso2/product-microgateway/pull/1209#discussion_r413468934", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            });\n          \n          \n            \n            });", "author": "praminda", "createdAt": "2020-04-23T02:48:00Z", "path": "components/micro-gateway-cli/src/main/resources/templates/httpResourceEndpoint.mustache", "diffHunk": "@@ -1,5 +1,5 @@\n http:Client {{operationId}}_{{endpointUrlType}} = new (\n {{#if endpoints.0.isEtcdEnabled}}gateway:etcdSetup(\"{{name}}_{{endpointUrlType}}_endpoint_0\",\n-\"{{name}}_{{endpointUrlType}}_0_etcdKey\", \"{{endpoints.0.endpointUrl}}\", \"{{endpoints.0.etcdKey}}\"){{else}}gateway:retrieveConfig(\"{{name}}_{{endpointUrlType}}_endpoint_0\",\"{{endpoints.0.endpointUrl}}\"){{/if}},\n+\"{{name}}_{{endpointUrlType}}_0_etcdKey\", \"{{{endpoints.0.endpointUrl}}}\", \"{{endpoints.0.etcdKey}}\"){{else}}gateway:retrieveConfig(\"{{name}}_{{endpointUrlType}}_endpoint_0\",\"{{{endpoints.0.endpointUrl}}}\"){{/if}},\n { {{>http2}}{{>caching}}{{>basicAuth}}{{>secureSocket}}\n });", "originalCommit": "161810d51862fd21b67547850d00bc7a43633844", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzQ2OTk5MQ==", "url": "https://github.com/wso2/product-microgateway/pull/1209#discussion_r413469991", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                @Test(description = \"Test Invoking the resource which  endpoint defined at resource level \"\n          \n          \n            \n                @Test(description = \"Test Invoking the resource which endpoint defined at resource level \"", "author": "praminda", "createdAt": "2020-04-23T02:51:23Z", "path": "tests/src/test/java/org/wso2/micro/gateway/tests/endpoints/ResourceLevelEndpointsTestCase.java", "diffHunk": "@@ -67,6 +67,19 @@ public void testPerResourceEndpoint() throws Exception {\n         Assert.assertEquals(response.getResponseCode(), 200, \"Response code mismatched\");\n     }\n \n+    @Test(description = \"Test Invoking the resource which  endpoint defined at resource level \"", "originalCommit": "161810d51862fd21b67547850d00bc7a43633844", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzQ3MTE3NQ==", "url": "https://github.com/wso2/product-microgateway/pull/1209#discussion_r413471175", "bodyText": "Shall we remove this part since we don't validate the response content? Just to keep the swagger short and simple?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                      content:\n          \n          \n            \n                        application/xml:\n          \n          \n            \n                          schema:\n          \n          \n            \n                            type: array\n          \n          \n            \n                            items:\n          \n          \n            \n                              $ref: \"#/components/schemas/Pet\"\n          \n          \n            \n                        application/json:\n          \n          \n            \n                          schema:\n          \n          \n            \n                            type: array\n          \n          \n            \n                            items:\n          \n          \n            \n                              $ref: \"#/components/schemas/Pet\"", "author": "praminda", "createdAt": "2020-04-23T02:54:44Z", "path": "tests/src/test/resources/openAPIs/common_api.yaml", "diffHunk": "@@ -121,6 +121,49 @@ paths:\n           description: Invalid status value\n       security:\n         - petstore_auth: []\n+  /pet/findByStatusNew:\n+    get:\n+      tags:\n+        - pet\n+      summary: Finds Pets by status\n+      description: Multiple status values can be provided with comma separated strings\n+      operationId: findPetsByStatus\n+      x-wso2-production-endpoints:\n+        urls:\n+          - https://localhost:2380/v1/pet/findByStatusNew?value1=foo&value2=bar\n+      parameters:\n+        - name: status\n+          in: query\n+          description: Status values that need to be considered for filter\n+          required: true\n+          explode: true\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+              enum:\n+                - available\n+                - pending\n+                - sold\n+              default: available\n+      responses:\n+        \"200\":\n+          description: successful operation\n+          content:\n+            application/xml:\n+              schema:\n+                type: array\n+                items:\n+                  $ref: \"#/components/schemas/Pet\"\n+            application/json:\n+              schema:\n+                type: array\n+                items:\n+                  $ref: \"#/components/schemas/Pet\"", "originalCommit": "161810d51862fd21b67547850d00bc7a43633844", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzQ3NDc0OA==", "url": "https://github.com/wso2/product-microgateway/pull/1209#discussion_r413474748", "bodyText": "Just to keep things simple\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                      explode: true\n          \n          \n            \n                      schema:\n          \n          \n            \n                        type: array\n          \n          \n            \n                        items:\n          \n          \n            \n                          type: string\n          \n          \n            \n                          enum:\n          \n          \n            \n                            - available\n          \n          \n            \n                            - pending\n          \n          \n            \n                            - sold\n          \n          \n            \n                          default: available", "author": "praminda", "createdAt": "2020-04-23T03:05:34Z", "path": "tests/src/test/resources/openAPIs/common_api.yaml", "diffHunk": "@@ -121,6 +121,49 @@ paths:\n           description: Invalid status value\n       security:\n         - petstore_auth: []\n+  /pet/findByStatusNew:\n+    get:\n+      tags:\n+        - pet\n+      summary: Finds Pets by status\n+      description: Multiple status values can be provided with comma separated strings\n+      operationId: findPetsByStatus\n+      x-wso2-production-endpoints:\n+        urls:\n+          - https://localhost:2380/v1/pet/findByStatusNew?value1=foo&value2=bar\n+      parameters:\n+        - name: status\n+          in: query\n+          description: Status values that need to be considered for filter\n+          required: true\n+          explode: true\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+              enum:\n+                - available\n+                - pending\n+                - sold\n+              default: available", "originalCommit": "161810d51862fd21b67547850d00bc7a43633844", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzQ3NTMyMw==", "url": "https://github.com/wso2/product-microgateway/pull/1209#discussion_r413475323", "bodyText": "Any reason to change the port? If there is an specific reason, better if you can put that in the PR description. It might be useful later.", "author": "praminda", "createdAt": "2020-04-23T03:07:17Z", "path": "tests/src/test/java/org/wso2/micro/gateway/tests/grpc/GrpcServer.java", "diffHunk": "@@ -31,7 +31,7 @@\n \n     public void start() throws IOException {\n         /* The port on which the server should run */\n-        int port = 50051;\n+        int port = 50075;", "originalCommit": "161810d51862fd21b67547850d00bc7a43633844", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzgzODg2MQ==", "url": "https://github.com/wso2/product-microgateway/pull/1209#discussion_r413838861", "bodyText": "There seems to be port conflict with mac. Its better to use a different port", "author": "Rajith90", "createdAt": "2020-04-23T14:22:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzQ3NTMyMw=="}], "type": "inlineReview"}, {"oid": "550cbe3de9a4ab29b57f0e6666d445b731bd9e4c", "url": "https://github.com/wso2/product-microgateway/commit/550cbe3de9a4ab29b57f0e6666d445b731bd9e4c", "message": "Fix #1210 - Improve interceptors to get path parameter related details\n\nWith this commit request.getPathParams() method is intorduced to java interceptors to get path parameter details.\nAnd for ballerina interceptors users can get it as invocationContext.attributes[\"pathParams\"] and cast it to a map.\nWith this commit users can details api_name, api_version, matching_resource , using this properties from the invocation context as well.", "committedDate": "2020-04-23T14:19:39Z", "type": "commit"}, {"oid": "550cbe3de9a4ab29b57f0e6666d445b731bd9e4c", "url": "https://github.com/wso2/product-microgateway/commit/550cbe3de9a4ab29b57f0e6666d445b731bd9e4c", "message": "Fix #1210 - Improve interceptors to get path parameter related details\n\nWith this commit request.getPathParams() method is intorduced to java interceptors to get path parameter details.\nAnd for ballerina interceptors users can get it as invocationContext.attributes[\"pathParams\"] and cast it to a map.\nWith this commit users can details api_name, api_version, matching_resource , using this properties from the invocation context as well.", "committedDate": "2020-04-23T14:19:39Z", "type": "forcePushed"}]}