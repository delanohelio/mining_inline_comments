{"pr_number": 1236, "pr_title": "Envoy config generator from swagger", "pr_createdAt": "2020-05-18T09:44:56Z", "pr_url": "https://github.com/wso2/product-microgateway/pull/1236", "timeline": [{"oid": "c4f686c79635906e24ed4c9865474d2cadcddfcd", "url": "https://github.com/wso2/product-microgateway/commit/c4f686c79635906e24ed4c9865474d2cadcddfcd", "message": "implement mgw structs", "committedDate": "2020-05-13T12:04:33Z", "type": "commit"}, {"oid": "b83cd9cb6d26a69286a14bd2d63a21beba18fcb5", "url": "https://github.com/wso2/product-microgateway/commit/b83cd9cb6d26a69286a14bd2d63a21beba18fcb5", "message": "implement multiple swagger reader", "committedDate": "2020-05-13T12:15:56Z", "type": "commit"}, {"oid": "fd110bc40ce7d86854a54e16a3abdda086380b89", "url": "https://github.com/wso2/product-microgateway/commit/fd110bc40ce7d86854a54e16a3abdda086380b89", "message": "add custom ports", "committedDate": "2020-05-14T16:42:32Z", "type": "commit"}, {"oid": "6b7dc6ac33b1e7194a2245bc2cd59d23d2aec0b1", "url": "https://github.com/wso2/product-microgateway/commit/6b7dc6ac33b1e7194a2245bc2cd59d23d2aec0b1", "message": "implement regex generator for path paramaters", "committedDate": "2020-05-14T19:09:56Z", "type": "commit"}, {"oid": "3f05010fec214a5eb2fb1ef75d750296c38816dc", "url": "https://github.com/wso2/product-microgateway/commit/3f05010fec214a5eb2fb1ef75d750296c38816dc", "message": "make cluster timeout as configs", "committedDate": "2020-05-15T13:19:48Z", "type": "commit"}, {"oid": "09996bf47763259498b9474472ce8b1be69448f0", "url": "https://github.com/wso2/product-microgateway/commit/09996bf47763259498b9474472ce8b1be69448f0", "message": "modify the regex", "committedDate": "2020-05-18T09:20:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjU4NjIwNA==", "url": "https://github.com/wso2/product-microgateway/pull/1236#discussion_r566586204", "bodyText": "Formatting issue. Shall we fix this?", "author": "dinusha92", "createdAt": "2021-01-29T05:22:41Z", "path": "internal/pkg/oasparser/config/config.go", "diffHunk": "@@ -16,9 +16,12 @@\n  */\n package config\n \n+import \"time\"\n+\n const (\n-\tLISTENER_ADDRESS   string = \"0.0.0.0\"\n-\tLISTENER_PORT      uint32 = 10000\n-\tAPI_PORT           uint32 = 8080\n-\tMANAGER_STATPREFIX string = \"ingress_http\"\n+\tLISTENER_ADDRESS  string = \"0.0.0.0\"\n+\tLISTENER_PORT     uint32 = 10000\n+\tAPI_DEFAULT_PORT   uint32 = 8080\n+\tMANAGER_STATPREFIX    string = \"ingress_http\"\n+\tCLUSTER_CONNECT_TIMEOUT    = 5 * time.Second", "originalCommit": "09996bf47763259498b9474472ce8b1be69448f0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2OTQ1NzYwMA==", "url": "https://github.com/wso2/product-microgateway/pull/1236#discussion_r569457600", "bodyText": "This is changed in the repo", "author": "chashikajw", "createdAt": "2021-02-03T14:27:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjU4NjIwNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjU4NjU2OA==", "url": "https://github.com/wso2/product-microgateway/pull/1236#discussion_r566586568", "bodyText": "Formatting issue.", "author": "dinusha92", "createdAt": "2021-01-29T05:24:12Z", "path": "internal/pkg/oasparser/constants/openApiConstants.go", "diffHunk": "@@ -16,5 +16,8 @@\n  */\n package constants\n \n-const PRODUCTION_ENDPOINTS string = \"x-wso2-production-endpoints\"\n-const SANDBOX_ENDPOINTS string = \"x-wso2-sandbox-endpoints\"\n+const (\n+\tPRODUCTION_ENDPOINTS string = \"x-wso2-production-endpoints\"\n+\tSANDBOX_ENDPOINTS string = \"x-wso2-sandbox-endpoints\"\n+)", "originalCommit": "09996bf47763259498b9474472ce8b1be69448f0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2OTQ1ODI2Ng==", "url": "https://github.com/wso2/product-microgateway/pull/1236#discussion_r569458266", "bodyText": "This is already fixed", "author": "chashikajw", "createdAt": "2021-02-03T14:28:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjU4NjU2OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjU4NjgyNQ==", "url": "https://github.com/wso2/product-microgateway/pull/1236#discussion_r566586825", "bodyText": "What is the purpose of the commented code. If there's a reason shall we mention that in a comment? If not, let's remove this :)", "author": "dinusha92", "createdAt": "2021-01-29T05:25:12Z", "path": "internal/pkg/oasparser/envoyCodegen/routesWithClusters.go", "diffHunk": "@@ -173,47 +166,104 @@ func createCluster(address core.Address, clusterName string) v2.Cluster {\n \t\t\t\t},\n \t\t\t},\n \t\t},\n-\t\t//Hosts:                []*core.Address{h},\n \t}\n-\n+\t//fmt.Println(h.GetAddress())\n \treturn cluster\n }\n \n-func createRoute(HostUrl string, resourcePath string, clusterName string) v2route.Route {\n-\t//var targetRegex = \"/\"\n-\troute := v2route.Route{\n-\t\tMatch: &v2route.RouteMatch{\n-\t\t\tPathSpecifier: &v2route.RouteMatch_SafeRegex{\n-\t\t\t\tSafeRegex: &envoy_type_matcher.RegexMatcher{\n-\t\t\t\t\tEngineType: &envoy_type_matcher.RegexMatcher_GoogleRe2{\n-\t\t\t\t\t\tGoogleRe2: &envoy_type_matcher.RegexMatcher_GoogleRE2{\n-\t\t\t\t\t\t\tMaxProgramSize: nil,\n+func createRoute(HostUrl string, basepath string, resourcePath string, clusterName string) v2route.Route {\n+\tvar fullPath = basepath + resourcePath\n+\tvar route v2route.Route\n+\n+\troutepath, isHavingPathparameter := GenerateRegex(fullPath)\n+\n+\tRouteAction := &v2route.Route_Route{\n+\t\tRoute: &v2route.RouteAction{\n+\t\t\tHostRewriteSpecifier: &v2route.RouteAction_HostRewrite{\n+\t\t\t\tHostRewrite: HostUrl,\n+\t\t\t},\n+\t\t\tClusterSpecifier: &v2route.RouteAction_Cluster{\n+\t\t\t\tCluster: clusterName,\n+\t\t\t},\n+\t\t},\n+\t}\n+\n+\tif isHavingPathparameter {\n+\t\troute = v2route.Route{\n+\t\t\tMatch: &v2route.RouteMatch{\n+\t\t\t\tPathSpecifier: &v2route.RouteMatch_SafeRegex{\n+\t\t\t\t\tSafeRegex: &envoy_type_matcher.RegexMatcher{\n+\t\t\t\t\t\tEngineType: &envoy_type_matcher.RegexMatcher_GoogleRe2{\n+\t\t\t\t\t\t\tGoogleRe2: &envoy_type_matcher.RegexMatcher_GoogleRE2{\n+\t\t\t\t\t\t\t\tMaxProgramSize: nil,\n+\t\t\t\t\t\t\t},\n \t\t\t\t\t\t},\n+\t\t\t\t\t\tRegex: routepath,\n \t\t\t\t\t},\n-\t\t\t\t\tRegex: resourcePath,\n \t\t\t\t},\n+\t\t\t\t/*Headers: []*v2route.HeaderMatcher {", "originalCommit": "09996bf47763259498b9474472ce8b1be69448f0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2OTQ1ODc3MQ==", "url": "https://github.com/wso2/product-microgateway/pull/1236#discussion_r569458771", "bodyText": "This is already removed", "author": "chashikajw", "createdAt": "2021-02-03T14:29:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjU4NjgyNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjU4Njk4Nw==", "url": "https://github.com/wso2/product-microgateway/pull/1236#discussion_r566586987", "bodyText": "License header missing.", "author": "dinusha92", "createdAt": "2021-01-29T05:25:45Z", "path": "internal/pkg/oasparser/models/apiDefinition/mgwResource.go", "diffHunk": "@@ -0,0 +1,33 @@\n+package apiDefinition", "originalCommit": "09996bf47763259498b9474472ce8b1be69448f0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2OTQ1OTI0OQ==", "url": "https://github.com/wso2/product-microgateway/pull/1236#discussion_r569459249", "bodyText": "This is already added", "author": "chashikajw", "createdAt": "2021-02-03T14:29:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjU4Njk4Nw=="}], "type": "inlineReview"}]}