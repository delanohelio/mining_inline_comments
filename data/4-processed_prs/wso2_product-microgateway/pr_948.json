{"pr_number": 948, "pr_title": "Set default values for configs", "pr_createdAt": "2020-01-22T11:55:54Z", "pr_url": "https://github.com/wso2/product-microgateway/pull/948", "timeline": [{"oid": "07d07bf5162792424400610692a118b409f3a11a", "url": "https://github.com/wso2/product-microgateway/commit/07d07bf5162792424400610692a118b409f3a11a", "message": "Set default values for configs", "committedDate": "2020-01-22T11:48:52Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTUyMzI5Mw==", "url": "https://github.com/wso2/product-microgateway/pull/948#discussion_r369523293", "bodyText": "indentation issue", "author": "Rajith90", "createdAt": "2020-01-22T12:08:05Z", "path": "components/micro-gateway-cli/src/main/resources/templates/jwtRevocation.mustache", "diffHunk": "@@ -2,7 +2,7 @@ map<string> receivedRevokedTokenMap = gateway:getRevokedTokenMap();\n     boolean jmsListenerStarted = gateway:initiateTokenRevocationJmsListener();\n \n     boolean useDefault = gateway:getConfigBooleanValue(gateway:PERSISTENT_MESSAGE_INSTANCE_ID,\n-    gateway:PERSISTENT_USE_DEFAULT, false);\n+        gateway:PERSISTENT_USE_DEFAULT, gateway:DEFAULT_PERSISTENT_USE_DEFAULT);", "originalCommit": "07d07bf5162792424400610692a118b409f3a11a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTkyMjkwMg==", "url": "https://github.com/wso2/product-microgateway/pull/948#discussion_r369922902", "bodyText": "I believe the indentation is correct here. Kindly insert the suggestion if not.", "author": "AmaliMatharaarachchi", "createdAt": "2020-01-23T04:02:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTUyMzI5Mw=="}], "type": "inlineReview"}, {"oid": "56f36a2b2b3f9fb39209669b57461faf392b833e", "url": "https://github.com/wso2/product-microgateway/commit/56f36a2b2b3f9fb39209669b57461faf392b833e", "message": "remove observability config", "committedDate": "2020-01-23T04:07:52Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTkyNDgwNg==", "url": "https://github.com/wso2/product-microgateway/pull/948#discussion_r369924806", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            // Copyright (c)  WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n          \n          \n            \n            // Copyright (c) 2020 WSO2 Inc. (http://www.wso2.org) All Rights Reserved.", "author": "praminda", "createdAt": "2020-01-23T04:15:40Z", "path": "components/micro-gateway-core/src/main/ballerina/src/gateway/constants/micro_gw_conf_defaults.bal", "diffHunk": "@@ -0,0 +1,93 @@\n+// Copyright (c)  WSO2 Inc. (http://www.wso2.org) All Rights Reserved.", "originalCommit": "56f36a2b2b3f9fb39209669b57461faf392b833e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTkyNjY3OQ==", "url": "https://github.com/wso2/product-microgateway/pull/948#discussion_r369926679", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            public const string DEFAULT_TRUST_STORE_PASSWORD = \"ballerina\";\n          \n          \n            \n            public const string DEFAULT_TRUST_STORE_PASSWORD = DEFAULT_TRUST_STORE_PATH;", "author": "praminda", "createdAt": "2020-01-23T04:27:25Z", "path": "components/micro-gateway-core/src/main/ballerina/src/gateway/constants/micro_gw_conf_defaults.bal", "diffHunk": "@@ -0,0 +1,93 @@\n+// Copyright (c)  WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+//\n+// WSO2 Inc. licenses this file to you under the Apache License,\n+// Version 2.0 (the \"License\"); you may not use this file except\n+// in compliance with the License.\n+// You may obtain a copy of the License at\n+//\n+// http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+\n+// default should bind to 0.0.0.0, not localhost. Else will not work in dockerized environments.\n+public const string DEFAULT_CONF_HOST = \"0.0.0.0\";\n+public const int DEFAULT_HTTP_PORT = 9090;\n+public const int DEFAULT_HTTPS_PORT = 9095;\n+public const string DEFAULT_KEY_STORE_PATH = \"${ballerina.home}/bre/security/ballerinaKeystore.p12\";\n+public const string DEFAULT_KEY_STORE_PASSWORD = \"ballerina\";\n+public const string DEFAULT_TRUST_STORE_PATH = \"${ballerina.home}/bre/security/ballerinaTruststore.p12\";\n+public const string DEFAULT_TRUST_STORE_PASSWORD = \"ballerina\";", "originalCommit": "56f36a2b2b3f9fb39209669b57461faf392b833e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTk1MTEyNQ==", "url": "https://github.com/wso2/product-microgateway/pull/948#discussion_r369951125", "bodyText": "Kindly consider that Ballerina does not allow us to assign a const value to another const value.", "author": "AmaliMatharaarachchi", "createdAt": "2020-01-23T06:36:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTkyNjY3OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTkyODg4MQ==", "url": "https://github.com/wso2/product-microgateway/pull/948#discussion_r369928881", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    printDebug(KEY_TOKEN_REVOCATION_JMS, \"token revoked jms Message Received\");\n          \n          \n            \n                    printDebug(KEY_TOKEN_REVOCATION_JMS, \"Token revoked jms Message Received\");", "author": "praminda", "createdAt": "2020-01-23T04:41:57Z", "path": "components/micro-gateway-core/src/main/ballerina/src/gateway/services/token_revocation_event_listener.bal", "diffHunk": "@@ -1,102 +1,100 @@\n- // Copyright (c) 2019 WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n- //\n- // WSO2 Inc. licenses this file to you under the Apache License,\n- // Version 2.0 (the \"License\"); you may not use this file except\n- // in compliance with the License.\n- // You may obtain a copy of the License at\n- //\n- // http://www.apache.org/licenses/LICENSE-2.0\n- //\n- // Unless required by applicable law or agreed to in writing,\n- // software distributed under the License is distributed on an\n- // \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n- // KIND, either express or implied.  See the License for the\n- // specific language governing permissions and limitations\n- // under the License.\n+// Copyright (c) 2019 WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+//\n+// WSO2 Inc. licenses this file to you under the Apache License,\n+// Version 2.0 (the \"License\"); you may not use this file except\n+// in compliance with the License.\n+// You may obtain a copy of the License at\n+//\n+// http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n \n- import wso2/jms;\n+import wso2/jms;\n \n- string jmsConnectioninitialContextFactoryTokenRevocation = getConfigValue(REALTIME_MESSAGE_INSTANCE_ID,\n-REALTIME_JMS_CONNECTION_INITIAL_CONTEXT_FACTORY,\n-\"bmbInitialContextFactory\");\n- string jmsConnectionProviderUrlTokenRevocation = getConfigValue(REALTIME_MESSAGE_INSTANCE_ID,\n- REALTIME_JMS_CONNECTION_PROVIDER_URL,\n-\"amqp://admin:admin@carbon/carbon?brokerlist='tcp://localhost:5672'\");\n- string jmsConnectionPasswordTokenRevocation = getConfigValue(REALTIME_MESSAGE_INSTANCE_ID,\n- REALTIME_JMS_CONNECTION_PASSWORD, \"\");\n- string jmsConnectionUsernameTokenRevocation = getConfigValue(REALTIME_MESSAGE_INSTANCE_ID,\n- REALTIME_JMS_CONNECTION_USERNAME, \"\");\n- string tokenRevocationJMSTopic = getConfigValue(REALTIME_MESSAGE_INSTANCE_ID,\n- REALTIME_JMS_CONNECTION_TOPIC, \"jwtRevocation\");\n+string jmsConnectioninitialContextFactoryTokenRevocation = getConfigValue(REALTIME_MESSAGE_INSTANCE_ID, \n+    JMS_CONNECTION_INITIAL_CONTEXT_FACTORY, DEFAULT_JMS_CONNECTION_INITIAL_CONTEXT_FACTORY);\n+string jmsConnectionProviderUrlTokenRevocation = getConfigValue(REALTIME_MESSAGE_INSTANCE_ID, JMS_CONNECTION_PROVIDER_URL,\n+    DEFAULT_JMS_CONNECTION_PROVIDER_URL);\n+string jmsConnectionPasswordTokenRevocation = getConfigValue(REALTIME_MESSAGE_INSTANCE_ID, JMS_CONNECTION_PASSWORD, \n+    DEFAULT_JMS_CONNECTION_PASSWORD);\n+string jmsConnectionUsernameTokenRevocation = getConfigValue(REALTIME_MESSAGE_INSTANCE_ID, JMS_CONNECTION_USERNAME, \n+    DEFAULT_JMS_CONNECTION_USERNAME);\n+string tokenRevocationJMSTopic = getConfigValue(REALTIME_MESSAGE_INSTANCE_ID, REALTIME_JMS_CONNECTION_TOPIC, \n+    DEFAULT_REALTIME_JMS_CONNECTION_TOPIC);\n \n-  service jmsTokenRevocation = service {\n-      resource function onMessage(jms:Message message) {\n-          printDebug(KEY_TOKEN_REVOCATION_JMS,\"token revoked jms Message Received\");\n-          if (message is jms:MapMessage) {\n-              string?|error ttl = message.getString(\"ttl\");\n-              string?|error revokedToken = message.getString(\"revokedToken\");\n-              map<string> inputMap = {};\n-              if (ttl is string && revokedToken is string) {\n-                  inputMap[revokedToken] = ttl;\n-                  var status = addToRevokedTokenMap(inputMap);\n-                  if (status is boolean) {\n-                      printDebug(KEY_TOKEN_REVOCATION_JMS, \"Successfully added to revoked token map\");\n-                  } else {\n-                      printDebug(KEY_TOKEN_REVOCATION_JMS, \"Error while ading revoked token to map\");\n-                  }\n-              } else {\n-                  printDebug(KEY_TOKEN_REVOCATION_JMS, \"No keys named revokedToken and ttl\");\n-              }\n-          } else {\n-              printError(KEY_TOKEN_REVOCATION_JMS, \"Error occurred while reading message\");\n-          }\n-      }\n-  };\n+service jmsTokenRevocation = service {\n+    resource function onMessage(jms:Message message) {\n+        printDebug(KEY_TOKEN_REVOCATION_JMS, \"token revoked jms Message Received\");", "originalCommit": "56f36a2b2b3f9fb39209669b57461faf392b833e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTkzMTU1NA==", "url": "https://github.com/wso2/product-microgateway/pull/948#discussion_r369931554", "bodyText": "We need to document all the configs in default config file using comments. So that users can get to know whats usage of each config without coming to the documentation. This we can do later in a different pull request after a proper discussion on what to document.", "author": "praminda", "createdAt": "2020-01-23T04:59:46Z", "path": "distribution/resources/conf/micro-gw-default.conf", "diffHunk": "@@ -0,0 +1,141 @@\n+[listenerConfig]", "originalCommit": "56f36a2b2b3f9fb39209669b57461faf392b833e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTk0NzA2Mg==", "url": "https://github.com/wso2/product-microgateway/pull/948#discussion_r369947062", "bodyText": "+1", "author": "AmaliMatharaarachchi", "createdAt": "2020-01-23T06:16:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTkzMTU1NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTkzMjAwOQ==", "url": "https://github.com/wso2/product-microgateway/pull/948#discussion_r369932009", "bodyText": "I hope these are unused or duplicate constants", "author": "praminda", "createdAt": "2020-01-23T05:02:28Z", "path": "components/micro-gateway-core/src/main/ballerina/src/gateway/constants/constants.bal", "diffHunk": "@@ -262,14 +261,9 @@ public const string JMS_CONNECTION_PASSWORD = \"jmsConnectionPassword\";\n public const string THROTTLE_ENDPOINT_URL = \"throttleEndpointUrl\";\n public const string THROTTLE_ENDPOINT_BASE64_HEADER = \"throttleEndpointbase64Header\";\n \n-public const string TOKEN_REVOCATION_CONF_INSTANCE_ID = \"tokenRevocationConfig\";", "originalCommit": "56f36a2b2b3f9fb39209669b57461faf392b833e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTk0NjkxMQ==", "url": "https://github.com/wso2/product-microgateway/pull/948#discussion_r369946911", "bodyText": "Most of them are duplicated. So I removed them.", "author": "AmaliMatharaarachchi", "createdAt": "2020-01-23T06:15:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTkzMjAwOQ=="}], "type": "inlineReview"}, {"oid": "5c7321c1a470393cb8484ff7a273b2825bf1ed0b", "url": "https://github.com/wso2/product-microgateway/commit/5c7321c1a470393cb8484ff7a273b2825bf1ed0b", "message": "Fix review comments", "committedDate": "2020-01-23T06:34:38Z", "type": "commit"}]}