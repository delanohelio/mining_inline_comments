{"pr_number": 946, "pr_title": "Fix #919 - Support backword compatibility for configs", "pr_createdAt": "2020-01-22T11:40:30Z", "pr_url": "https://github.com/wso2/product-microgateway/pull/946", "timeline": [{"oid": "e6f5f4f5cacc3060af28fd5ab6b187163821f4a8", "url": "https://github.com/wso2/product-microgateway/commit/e6f5f4f5cacc3060af28fd5ab6b187163821f4a8", "message": "Fix #919 - Support backword compatibility for configs", "committedDate": "2020-01-22T11:38:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTk0ODA2NA==", "url": "https://github.com/wso2/product-microgateway/pull/946#discussion_r369948064", "bodyText": "With amali's PR #948 for default configs, we have constants for default values of username and password. Let's use those after merging that PR.", "author": "praminda", "createdAt": "2020-01-23T06:21:17Z", "path": "components/micro-gateway-core/src/main/ballerina/src/gateway/listeners/api_gateway_listener.bal", "diffHunk": "@@ -123,11 +123,19 @@ public function getAuthHandlers() returns http:InboundAuthHandler[] {\n         },\n         verifyHostname: getConfigBooleanValue(HTTP_CLIENTS_INSTANCE_ID, ENABLE_HOSTNAME_VERIFICATION, true)\n     };\n+\n     http:OutboundAuthConfig? auth = ();\n+    // support backward compatibility in reading the basic auth credentials when connecting with KM.\n+    string username = getConfigValue(KM_CONF_INSTANCE_ID, USERNAME, \"\");\n+    string password = getConfigValue(KM_CONF_INSTANCE_ID, PASSWORD, \"\");\n+    if (username.length() == 0 && password.length() == 0) {\n+        username = getConfigValue(KM_CONF_SECURITY_BASIC_INSTANCE_ID, USERNAME, \"admin\");", "originalCommit": "e6f5f4f5cacc3060af28fd5ab6b187163821f4a8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "09c46dd8c7e0606a4a64b5468be0cfe02d1df512", "url": "https://github.com/wso2/product-microgateway/commit/09c46dd8c7e0606a4a64b5468be0cfe02d1df512", "message": "support default config values", "committedDate": "2020-01-24T08:14:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDUxOTgzNw==", "url": "https://github.com/wso2/product-microgateway/pull/946#discussion_r370519837", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                string username = getConfigValue(KM_CONF_INSTANCE_ID, USERNAME, \"\");\n          \n          \n            \n                string username = getConfigValue(KM_CONF_INSTANCE_ID, USERNAME, DEFAULT_USERNAME);", "author": "AmaliMatharaarachchi", "createdAt": "2020-01-24T08:35:50Z", "path": "components/micro-gateway-core/src/main/ballerina/src/gateway/listeners/api_gateway_listener.bal", "diffHunk": "@@ -120,11 +120,19 @@ public function getAuthHandlers() returns http:InboundAuthHandler[] {\n         },\n         verifyHostname: getConfigBooleanValue(HTTP_CLIENTS_INSTANCE_ID, ENABLE_HOSTNAME_VERIFICATION, true)\n     };\n+\n     http:OutboundAuthConfig? auth = ();\n-    if (getConfigBooleanValue(KM_CONF_SECURITY_BASIC_INSTANCE_ID, ENABLED, DEFAULT_KM_CONF_SECURITY_BASIC_ENABLED)) {\n+    // support backward compatibility in reading the basic auth credentials when connecting with KM.\n+    string username = getConfigValue(KM_CONF_INSTANCE_ID, USERNAME, \"\");", "originalCommit": "09c46dd8c7e0606a4a64b5468be0cfe02d1df512", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDUyMDU4OQ==", "url": "https://github.com/wso2/product-microgateway/pull/946#discussion_r370520589", "bodyText": "We can't have default values there. This is to support the old config. The empty string determines that old config is not used", "author": "Rajith90", "createdAt": "2020-01-24T08:38:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDUxOTgzNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDUyMDA4Mw==", "url": "https://github.com/wso2/product-microgateway/pull/946#discussion_r370520083", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                string password = getConfigValue(KM_CONF_INSTANCE_ID, PASSWORD, \"\");\n          \n          \n            \n                string password = getConfigValue(KM_CONF_INSTANCE_ID, PASSWORD, DEFAULT_PASSWORD);", "author": "AmaliMatharaarachchi", "createdAt": "2020-01-24T08:36:27Z", "path": "components/micro-gateway-core/src/main/ballerina/src/gateway/listeners/api_gateway_listener.bal", "diffHunk": "@@ -120,11 +120,19 @@ public function getAuthHandlers() returns http:InboundAuthHandler[] {\n         },\n         verifyHostname: getConfigBooleanValue(HTTP_CLIENTS_INSTANCE_ID, ENABLE_HOSTNAME_VERIFICATION, true)\n     };\n+\n     http:OutboundAuthConfig? auth = ();\n-    if (getConfigBooleanValue(KM_CONF_SECURITY_BASIC_INSTANCE_ID, ENABLED, DEFAULT_KM_CONF_SECURITY_BASIC_ENABLED)) {\n+    // support backward compatibility in reading the basic auth credentials when connecting with KM.\n+    string username = getConfigValue(KM_CONF_INSTANCE_ID, USERNAME, \"\");\n+    string password = getConfigValue(KM_CONF_INSTANCE_ID, PASSWORD, \"\");", "originalCommit": "09c46dd8c7e0606a4a64b5468be0cfe02d1df512", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDUyODE2MQ==", "url": "https://github.com/wso2/product-microgateway/pull/946#discussion_r370528161", "bodyText": "We can't have default values there. This is to support the old config. The empty string determines that old config is not used", "author": "Rajith90", "createdAt": "2020-01-24T08:59:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDUyMDA4Mw=="}], "type": "inlineReview"}, {"oid": "ede067e9bcf5168ec7da18d15c06730efa5f6282", "url": "https://github.com/wso2/product-microgateway/commit/ede067e9bcf5168ec7da18d15c06730efa5f6282", "message": "Update the branch", "committedDate": "2020-01-24T09:37:40Z", "type": "commit"}]}