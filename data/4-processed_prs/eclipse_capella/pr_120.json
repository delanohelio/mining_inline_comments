{"pr_number": 120, "pr_title": "[560828] [CommandLine] Add some evolutions for command line argument", "pr_createdAt": "2020-03-05T16:59:52Z", "pr_url": "https://github.com/eclipse/capella/pull/120", "timeline": [{"oid": "2f84bb4b63cd57b9289f3278d7de81fc1dc1ed4b", "url": "https://github.com/eclipse/capella/commit/2f84bb4b63cd57b9289f3278d7de81fc1dc1ed4b", "message": "[560828] [CommandLine] Add some evolutions for command line argument\nmanagement\n\nChange-Id: I4eb0e556aae4a9c90cb069fa26b3d959e984d6fe\nSigned-off-by: Tu Ton <minhtutonthat@gmail.com>", "committedDate": "2020-03-05T16:53:05Z", "type": "commit"}, {"oid": "ff7bc04b92f853ccd0056bfa3b257f924da398c7", "url": "https://github.com/eclipse/capella/commit/ff7bc04b92f853ccd0056bfa3b257f924da398c7", "message": "[560828] [CommandLine] Add some evolutions for command line argument\nmanagement\n\n- Fix failed test CommandLineFolderMigrationTest. The test failed\nbecause there are test models remaining in the workspace.\n\nChange-Id: I9e5064925cdafa64c05371fada356665319da4d4\nSigned-off-by: Tu Ton <minhtutonthat@gmail.com>", "committedDate": "2020-03-06T09:26:12Z", "type": "commit"}, {"oid": "6184f9b2bfa9dbb1b102323e00b18302d8d61cad", "url": "https://github.com/eclipse/capella/commit/6184f9b2bfa9dbb1b102323e00b18302d8d61cad", "message": "[560828] [CommandLine] Add some evolutions for command line argument\nmanagement\n\n- Bugfix: Command line help cannot read jar content\n\nChange-Id: I0dc0ece24f3f713851dfc47eb62fc8c5582f7537\nSigned-off-by: Tu Ton <minhtutonthat@gmail.com>", "committedDate": "2020-03-06T12:59:18Z", "type": "commit"}, {"oid": "a0d6756abf560505d98a7d838a40ccc6ae8da372", "url": "https://github.com/eclipse/capella/commit/a0d6756abf560505d98a7d838a40ccc6ae8da372", "message": "[560828] [CommandLine] Add some evolutions for command line argument\nmanagement\n\n- Make -exportZip becomes generic for all commands\n- Add -backup argument for Migration command line\n- Updat docs\n\nChange-Id: I713421d37c37980b3b25e09b2d06be23dc4d7808\nSigned-off-by: Tu Ton <minhtutonthat@gmail.com>", "committedDate": "2020-03-09T16:11:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDIwNTUxMA==", "url": "https://github.com/eclipse/capella/pull/120#discussion_r390205510", "bodyText": "This can be removed. The doc in already present in the overridden method.", "author": "sandupostaru", "createdAt": "2020-03-10T10:02:16Z", "path": "core/plugins/org.polarsys.capella.core.commandline.core/src/org/polarsys/capella/core/commandline/core/DefaultCommandLine.java", "diffHunk": "@@ -0,0 +1,384 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 THALES GLOBAL SERVICES.\n+ * All rights reserved. This program and the accompanying materials\n+ * are made available under the terms of the Eclipse Public License v1.0\n+ * which accompanies this distribution, and is available at\n+ * http://www.eclipse.org/legal/epl-v10.html\n+ *\n+ * Contributors:\n+ *    Thales - initial API and implementation\n+ *******************************************************************************/\n+package org.polarsys.capella.core.commandline.core;\n+\n+import java.io.File;\n+import java.io.FileInputStream;\n+import java.io.IOException;\n+import java.net.URISyntaxException;\n+import java.net.URL;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+\n+import javax.xml.XMLConstants;\n+import javax.xml.parsers.DocumentBuilder;\n+import javax.xml.parsers.DocumentBuilderFactory;\n+import javax.xml.parsers.ParserConfigurationException;\n+import javax.xml.xpath.XPath;\n+import javax.xml.xpath.XPathConstants;\n+import javax.xml.xpath.XPathExpression;\n+import javax.xml.xpath.XPathExpressionException;\n+import javax.xml.xpath.XPathFactory;\n+\n+import org.eclipse.core.resources.IFile;\n+import org.eclipse.core.resources.IFolder;\n+import org.eclipse.core.resources.IProject;\n+import org.eclipse.core.resources.IWorkspace;\n+import org.eclipse.core.resources.ResourcesPlugin;\n+import org.eclipse.core.runtime.CoreException;\n+import org.eclipse.core.runtime.FileLocator;\n+import org.eclipse.core.runtime.NullProgressMonitor;\n+import org.eclipse.core.runtime.Path;\n+import org.eclipse.emf.common.util.URI;\n+import org.eclipse.equinox.app.IApplicationContext;\n+import org.osgi.framework.Bundle;\n+import org.osgi.framework.FrameworkUtil;\n+import org.polarsys.capella.common.tools.report.config.registry.ReportManagerRegistry;\n+import org.polarsys.capella.common.tools.report.util.IReportManagerDefaultComponents;\n+import org.polarsys.capella.core.model.handler.command.CapellaResourceHelper;\n+import org.w3c.dom.Document;\n+import org.w3c.dom.Node;\n+import org.w3c.dom.NodeList;\n+import org.xml.sax.SAXException;\n+\n+public class DefaultCommandLine extends AbstractCommandLine {\n+  public static String ALL_ARGUMENT = \"/all\";\n+\n+  public DefaultCommandLine() {\n+    argHelper = CommandLineArgumentHelper.getInstance();\n+    logger = ReportManagerRegistry.getInstance().subscribe(IReportManagerDefaultComponents.DEFAULT);\n+  }\n+\n+  /**\n+   * {@inheritDoc}\n+   *\n+   * @throws CommandLineException\n+   */", "originalCommit": "a0d6756abf560505d98a7d838a40ccc6ae8da372", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDIxNDE5OQ==", "url": "https://github.com/eclipse/capella/pull/120#discussion_r390214199", "bodyText": "Extract a variable containing\n Arrays.stream(ResourcesPlugin.getWorkspace().getRoot().getProjects())\nbefore the for loop\nThis can be further optimized, but considering the size of the projects is small, I think it is ok for now.", "author": "sandupostaru", "createdAt": "2020-03-10T10:18:02Z", "path": "core/plugins/org.polarsys.capella.core.commandline.core/src/org/polarsys/capella/core/commandline/core/DefaultCommandLine.java", "diffHunk": "@@ -0,0 +1,384 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 THALES GLOBAL SERVICES.\n+ * All rights reserved. This program and the accompanying materials\n+ * are made available under the terms of the Eclipse Public License v1.0\n+ * which accompanies this distribution, and is available at\n+ * http://www.eclipse.org/legal/epl-v10.html\n+ *\n+ * Contributors:\n+ *    Thales - initial API and implementation\n+ *******************************************************************************/\n+package org.polarsys.capella.core.commandline.core;\n+\n+import java.io.File;\n+import java.io.FileInputStream;\n+import java.io.IOException;\n+import java.net.URISyntaxException;\n+import java.net.URL;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+\n+import javax.xml.XMLConstants;\n+import javax.xml.parsers.DocumentBuilder;\n+import javax.xml.parsers.DocumentBuilderFactory;\n+import javax.xml.parsers.ParserConfigurationException;\n+import javax.xml.xpath.XPath;\n+import javax.xml.xpath.XPathConstants;\n+import javax.xml.xpath.XPathExpression;\n+import javax.xml.xpath.XPathExpressionException;\n+import javax.xml.xpath.XPathFactory;\n+\n+import org.eclipse.core.resources.IFile;\n+import org.eclipse.core.resources.IFolder;\n+import org.eclipse.core.resources.IProject;\n+import org.eclipse.core.resources.IWorkspace;\n+import org.eclipse.core.resources.ResourcesPlugin;\n+import org.eclipse.core.runtime.CoreException;\n+import org.eclipse.core.runtime.FileLocator;\n+import org.eclipse.core.runtime.NullProgressMonitor;\n+import org.eclipse.core.runtime.Path;\n+import org.eclipse.emf.common.util.URI;\n+import org.eclipse.equinox.app.IApplicationContext;\n+import org.osgi.framework.Bundle;\n+import org.osgi.framework.FrameworkUtil;\n+import org.polarsys.capella.common.tools.report.config.registry.ReportManagerRegistry;\n+import org.polarsys.capella.common.tools.report.util.IReportManagerDefaultComponents;\n+import org.polarsys.capella.core.model.handler.command.CapellaResourceHelper;\n+import org.w3c.dom.Document;\n+import org.w3c.dom.Node;\n+import org.w3c.dom.NodeList;\n+import org.xml.sax.SAXException;\n+\n+public class DefaultCommandLine extends AbstractCommandLine {\n+  public static String ALL_ARGUMENT = \"/all\";\n+\n+  public DefaultCommandLine() {\n+    argHelper = CommandLineArgumentHelper.getInstance();\n+    logger = ReportManagerRegistry.getInstance().subscribe(IReportManagerDefaultComponents.DEFAULT);\n+  }\n+\n+  /**\n+   * {@inheritDoc}\n+   *\n+   * @throws CommandLineException\n+   */\n+  @Override\n+  public void prepare(IApplicationContext context) throws CommandLineException {\n+    // Import projects\n+    importProjects();\n+    // Create output folder\n+    getOrCreateOutputFolder();\n+  }\n+\n+  protected void importProjects() throws CommandLineException {\n+    String projectsToImport = argHelper.getImportProjects();\n+    if (projectsToImport != null) {\n+      try {\n+        importProjects(toList(projectsToImport));\n+      } catch (CoreException exception) {\n+        throw new CommandLineException(exception.getMessage());\n+      }\n+    }\n+  }\n+\n+  @Override\n+  public void postExecute(IApplicationContext context) throws CommandLineException {\n+    exportZips();\n+  }\n+\n+  protected void exportZips() throws CommandLineException {\n+    String projectsToExportZip = argHelper.getExportZips();\n+    if (projectsToExportZip != null) {\n+      if (projectsToExportZip.equals(ALL_ARGUMENT)) {\n+        exportProjectZips(Arrays.stream(ResourcesPlugin.getWorkspace().getRoot().getProjects())\n+            .map(iProject -> iProject.getName()).collect(Collectors.toList()));\n+      } else {\n+        exportProjectZips(toList(projectsToExportZip));\n+      }\n+    }\n+  }\n+\n+  /**\n+   * @param projectsToExportZip\n+   * @throws CoreException\n+   */\n+  protected void exportProjectZips(List<String> projectsToExportZip) throws CommandLineException {\n+    IFolder outputFolder = getOrCreateOutputFolder();\n+    if (outputFolder == null) {\n+      logger.error(Messages.export_zip_no_ouputfolder);\n+    } else {\n+      for (String project : projectsToExportZip) {\n+        Optional<IProject> anyIProject = Arrays.stream(ResourcesPlugin.getWorkspace().getRoot().getProjects())", "originalCommit": "a0d6756abf560505d98a7d838a40ccc6ae8da372", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDI3NzIwMg==", "url": "https://github.com/eclipse/capella/pull/120#discussion_r390277202", "bodyText": "Good catch. But the solution is not good :) since \"Consumed Stream pipelines should not be reused\".", "author": "minhtutonthat", "createdAt": "2020-03-10T12:26:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDIxNDE5OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDIxODExOA==", "url": "https://github.com/eclipse/capella/pull/120#discussion_r390218118", "bodyText": "Can just be:\n if (!argHelper.getInputs().equals(ALL_ARGUMENT))", "author": "sandupostaru", "createdAt": "2020-03-10T10:25:19Z", "path": "core/plugins/org.polarsys.capella.core.commandline.core/src/org/polarsys/capella/core/commandline/core/DefaultCommandLine.java", "diffHunk": "@@ -0,0 +1,384 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 THALES GLOBAL SERVICES.\n+ * All rights reserved. This program and the accompanying materials\n+ * are made available under the terms of the Eclipse Public License v1.0\n+ * which accompanies this distribution, and is available at\n+ * http://www.eclipse.org/legal/epl-v10.html\n+ *\n+ * Contributors:\n+ *    Thales - initial API and implementation\n+ *******************************************************************************/\n+package org.polarsys.capella.core.commandline.core;\n+\n+import java.io.File;\n+import java.io.FileInputStream;\n+import java.io.IOException;\n+import java.net.URISyntaxException;\n+import java.net.URL;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+\n+import javax.xml.XMLConstants;\n+import javax.xml.parsers.DocumentBuilder;\n+import javax.xml.parsers.DocumentBuilderFactory;\n+import javax.xml.parsers.ParserConfigurationException;\n+import javax.xml.xpath.XPath;\n+import javax.xml.xpath.XPathConstants;\n+import javax.xml.xpath.XPathExpression;\n+import javax.xml.xpath.XPathExpressionException;\n+import javax.xml.xpath.XPathFactory;\n+\n+import org.eclipse.core.resources.IFile;\n+import org.eclipse.core.resources.IFolder;\n+import org.eclipse.core.resources.IProject;\n+import org.eclipse.core.resources.IWorkspace;\n+import org.eclipse.core.resources.ResourcesPlugin;\n+import org.eclipse.core.runtime.CoreException;\n+import org.eclipse.core.runtime.FileLocator;\n+import org.eclipse.core.runtime.NullProgressMonitor;\n+import org.eclipse.core.runtime.Path;\n+import org.eclipse.emf.common.util.URI;\n+import org.eclipse.equinox.app.IApplicationContext;\n+import org.osgi.framework.Bundle;\n+import org.osgi.framework.FrameworkUtil;\n+import org.polarsys.capella.common.tools.report.config.registry.ReportManagerRegistry;\n+import org.polarsys.capella.common.tools.report.util.IReportManagerDefaultComponents;\n+import org.polarsys.capella.core.model.handler.command.CapellaResourceHelper;\n+import org.w3c.dom.Document;\n+import org.w3c.dom.Node;\n+import org.w3c.dom.NodeList;\n+import org.xml.sax.SAXException;\n+\n+public class DefaultCommandLine extends AbstractCommandLine {\n+  public static String ALL_ARGUMENT = \"/all\";\n+\n+  public DefaultCommandLine() {\n+    argHelper = CommandLineArgumentHelper.getInstance();\n+    logger = ReportManagerRegistry.getInstance().subscribe(IReportManagerDefaultComponents.DEFAULT);\n+  }\n+\n+  /**\n+   * {@inheritDoc}\n+   *\n+   * @throws CommandLineException\n+   */\n+  @Override\n+  public void prepare(IApplicationContext context) throws CommandLineException {\n+    // Import projects\n+    importProjects();\n+    // Create output folder\n+    getOrCreateOutputFolder();\n+  }\n+\n+  protected void importProjects() throws CommandLineException {\n+    String projectsToImport = argHelper.getImportProjects();\n+    if (projectsToImport != null) {\n+      try {\n+        importProjects(toList(projectsToImport));\n+      } catch (CoreException exception) {\n+        throw new CommandLineException(exception.getMessage());\n+      }\n+    }\n+  }\n+\n+  @Override\n+  public void postExecute(IApplicationContext context) throws CommandLineException {\n+    exportZips();\n+  }\n+\n+  protected void exportZips() throws CommandLineException {\n+    String projectsToExportZip = argHelper.getExportZips();\n+    if (projectsToExportZip != null) {\n+      if (projectsToExportZip.equals(ALL_ARGUMENT)) {\n+        exportProjectZips(Arrays.stream(ResourcesPlugin.getWorkspace().getRoot().getProjects())\n+            .map(iProject -> iProject.getName()).collect(Collectors.toList()));\n+      } else {\n+        exportProjectZips(toList(projectsToExportZip));\n+      }\n+    }\n+  }\n+\n+  /**\n+   * @param projectsToExportZip\n+   * @throws CoreException\n+   */\n+  protected void exportProjectZips(List<String> projectsToExportZip) throws CommandLineException {\n+    IFolder outputFolder = getOrCreateOutputFolder();\n+    if (outputFolder == null) {\n+      logger.error(Messages.export_zip_no_ouputfolder);\n+    } else {\n+      for (String project : projectsToExportZip) {\n+        Optional<IProject> anyIProject = Arrays.stream(ResourcesPlugin.getWorkspace().getRoot().getProjects())\n+            .filter(iProject -> iProject.getName().equals(project)).findAny();\n+        if (!anyIProject.isPresent()) {\n+          logger.error(Messages.export_zip_not_found + project);\n+        } else {\n+          IWorkspace workspace = ResourcesPlugin.getWorkspace();\n+          IFile file = outputFolder.getFile(project + \".zip\");\n+          IProject newProject = workspace.getRoot().getProject(project);\n+          WorkbenchHelper.exportZipFile(newProject, file);\n+        }\n+      }\n+    }\n+  }\n+\n+  protected void checkProject(IProject project) throws CommandLineException {\n+    if (!project.exists()) {\n+      logError(Messages.project + project.getName() + Messages.not_exist);\n+    } else {\n+      try {\n+        project.open(new NullProgressMonitor());\n+      } catch (CoreException exception) {\n+        logError(Messages.unable_open_project + project.getName());\n+      }\n+      List<IFile> melodymodellerFiles = getCapellamodellerFiles(project);\n+      // check that all melodymodeller files are compliant with current Capella version\n+      for (IFile modeller : melodymodellerFiles) {\n+        compliancyCheck(modeller);\n+      }\n+    }\n+  }\n+\n+  /**\n+   * Check that inputs arguments are valid\n+   * \n+   * @throws CommandLineException\n+   */\n+  protected void checkInputs() throws CommandLineException {\n+    if (argHelper.getInputs() == null) {\n+      logger.error(Messages.inputs_mandatory);\n+    } else if (argHelper.getInputs().equals(ALL_ARGUMENT)) {\n+      // /all is accepted as argument\n+    } else {\n+      List<String> inputs = toList(argHelper.getInputs());\n+      for (String input : inputs) {\n+        if (input.endsWith(CapellaResourceHelper.AIRD_FILE_EXTENSION)) {\n+          checkInputAirdFile(input);\n+        } else {\n+          checkInputProject(input);\n+        }\n+      }", "originalCommit": "a0d6756abf560505d98a7d838a40ccc6ae8da372", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDI3MjAzMg==", "url": "https://github.com/eclipse/capella/pull/120#discussion_r390272032", "bodyText": "I think the code's logic is clearer when \"we accept the /all argument\" than \"we check the input only it's different than /all\"", "author": "minhtutonthat", "createdAt": "2020-03-10T12:15:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDIxODExOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDI3NDAxMA==", "url": "https://github.com/eclipse/capella/pull/120#discussion_r390274010", "bodyText": "I think your opinion is influenced by the   // /all is accepted as argument  comment.\nI bet that if you remove that comment and another guy just looks as an empty branch - he won't understand why the branch is empty \ud83d\ude15 .\nIt's up to you if you make the change or not, either way works for me \ud83d\ude46\u200d\u2642\ufe0f", "author": "sandupostaru", "createdAt": "2020-03-10T12:19:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDIxODExOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDIyMDI5NQ==", "url": "https://github.com/eclipse/capella/pull/120#discussion_r390220295", "bodyText": "Question: Is it necessary to create the output folder as a project and not only as a folder using standard java API?", "author": "sandupostaru", "createdAt": "2020-03-10T10:29:09Z", "path": "core/plugins/org.polarsys.capella.core.commandline.core/src/org/polarsys/capella/core/commandline/core/DefaultCommandLine.java", "diffHunk": "@@ -0,0 +1,384 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 THALES GLOBAL SERVICES.\n+ * All rights reserved. This program and the accompanying materials\n+ * are made available under the terms of the Eclipse Public License v1.0\n+ * which accompanies this distribution, and is available at\n+ * http://www.eclipse.org/legal/epl-v10.html\n+ *\n+ * Contributors:\n+ *    Thales - initial API and implementation\n+ *******************************************************************************/\n+package org.polarsys.capella.core.commandline.core;\n+\n+import java.io.File;\n+import java.io.FileInputStream;\n+import java.io.IOException;\n+import java.net.URISyntaxException;\n+import java.net.URL;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+\n+import javax.xml.XMLConstants;\n+import javax.xml.parsers.DocumentBuilder;\n+import javax.xml.parsers.DocumentBuilderFactory;\n+import javax.xml.parsers.ParserConfigurationException;\n+import javax.xml.xpath.XPath;\n+import javax.xml.xpath.XPathConstants;\n+import javax.xml.xpath.XPathExpression;\n+import javax.xml.xpath.XPathExpressionException;\n+import javax.xml.xpath.XPathFactory;\n+\n+import org.eclipse.core.resources.IFile;\n+import org.eclipse.core.resources.IFolder;\n+import org.eclipse.core.resources.IProject;\n+import org.eclipse.core.resources.IWorkspace;\n+import org.eclipse.core.resources.ResourcesPlugin;\n+import org.eclipse.core.runtime.CoreException;\n+import org.eclipse.core.runtime.FileLocator;\n+import org.eclipse.core.runtime.NullProgressMonitor;\n+import org.eclipse.core.runtime.Path;\n+import org.eclipse.emf.common.util.URI;\n+import org.eclipse.equinox.app.IApplicationContext;\n+import org.osgi.framework.Bundle;\n+import org.osgi.framework.FrameworkUtil;\n+import org.polarsys.capella.common.tools.report.config.registry.ReportManagerRegistry;\n+import org.polarsys.capella.common.tools.report.util.IReportManagerDefaultComponents;\n+import org.polarsys.capella.core.model.handler.command.CapellaResourceHelper;\n+import org.w3c.dom.Document;\n+import org.w3c.dom.Node;\n+import org.w3c.dom.NodeList;\n+import org.xml.sax.SAXException;\n+\n+public class DefaultCommandLine extends AbstractCommandLine {\n+  public static String ALL_ARGUMENT = \"/all\";\n+\n+  public DefaultCommandLine() {\n+    argHelper = CommandLineArgumentHelper.getInstance();\n+    logger = ReportManagerRegistry.getInstance().subscribe(IReportManagerDefaultComponents.DEFAULT);\n+  }\n+\n+  /**\n+   * {@inheritDoc}\n+   *\n+   * @throws CommandLineException\n+   */\n+  @Override\n+  public void prepare(IApplicationContext context) throws CommandLineException {\n+    // Import projects\n+    importProjects();\n+    // Create output folder\n+    getOrCreateOutputFolder();\n+  }\n+\n+  protected void importProjects() throws CommandLineException {\n+    String projectsToImport = argHelper.getImportProjects();\n+    if (projectsToImport != null) {\n+      try {\n+        importProjects(toList(projectsToImport));\n+      } catch (CoreException exception) {\n+        throw new CommandLineException(exception.getMessage());\n+      }\n+    }\n+  }\n+\n+  @Override\n+  public void postExecute(IApplicationContext context) throws CommandLineException {\n+    exportZips();\n+  }\n+\n+  protected void exportZips() throws CommandLineException {\n+    String projectsToExportZip = argHelper.getExportZips();\n+    if (projectsToExportZip != null) {\n+      if (projectsToExportZip.equals(ALL_ARGUMENT)) {\n+        exportProjectZips(Arrays.stream(ResourcesPlugin.getWorkspace().getRoot().getProjects())\n+            .map(iProject -> iProject.getName()).collect(Collectors.toList()));\n+      } else {\n+        exportProjectZips(toList(projectsToExportZip));\n+      }\n+    }\n+  }\n+\n+  /**\n+   * @param projectsToExportZip\n+   * @throws CoreException\n+   */\n+  protected void exportProjectZips(List<String> projectsToExportZip) throws CommandLineException {\n+    IFolder outputFolder = getOrCreateOutputFolder();\n+    if (outputFolder == null) {\n+      logger.error(Messages.export_zip_no_ouputfolder);\n+    } else {\n+      for (String project : projectsToExportZip) {\n+        Optional<IProject> anyIProject = Arrays.stream(ResourcesPlugin.getWorkspace().getRoot().getProjects())\n+            .filter(iProject -> iProject.getName().equals(project)).findAny();\n+        if (!anyIProject.isPresent()) {\n+          logger.error(Messages.export_zip_not_found + project);\n+        } else {\n+          IWorkspace workspace = ResourcesPlugin.getWorkspace();\n+          IFile file = outputFolder.getFile(project + \".zip\");\n+          IProject newProject = workspace.getRoot().getProject(project);\n+          WorkbenchHelper.exportZipFile(newProject, file);\n+        }\n+      }\n+    }\n+  }\n+\n+  protected void checkProject(IProject project) throws CommandLineException {\n+    if (!project.exists()) {\n+      logError(Messages.project + project.getName() + Messages.not_exist);\n+    } else {\n+      try {\n+        project.open(new NullProgressMonitor());\n+      } catch (CoreException exception) {\n+        logError(Messages.unable_open_project + project.getName());\n+      }\n+      List<IFile> melodymodellerFiles = getCapellamodellerFiles(project);\n+      // check that all melodymodeller files are compliant with current Capella version\n+      for (IFile modeller : melodymodellerFiles) {\n+        compliancyCheck(modeller);\n+      }\n+    }\n+  }\n+\n+  /**\n+   * Check that inputs arguments are valid\n+   * \n+   * @throws CommandLineException\n+   */\n+  protected void checkInputs() throws CommandLineException {\n+    if (argHelper.getInputs() == null) {\n+      logger.error(Messages.inputs_mandatory);\n+    } else if (argHelper.getInputs().equals(ALL_ARGUMENT)) {\n+      // /all is accepted as argument\n+    } else {\n+      List<String> inputs = toList(argHelper.getInputs());\n+      for (String input : inputs) {\n+        if (input.endsWith(CapellaResourceHelper.AIRD_FILE_EXTENSION)) {\n+          checkInputAirdFile(input);\n+        } else {\n+          checkInputProject(input);\n+        }\n+      }\n+    }\n+  }\n+\n+  protected void checkInputProject(String projectPath) throws CommandLineException {\n+    String projectName = getProjectNameFromPath(projectPath);\n+    IProject project = ResourcesPlugin.getWorkspace().getRoot().getProject(projectName);\n+    checkProject(project);\n+  }\n+\n+  protected void checkInputAirdFile(String airdPath) throws CommandLineException {\n+    String projectName = getProjectNameFromPath(airdPath);\n+    IProject project = ResourcesPlugin.getWorkspace().getRoot().getProject(projectName);\n+    checkProject(project);\n+    IFile file = project.getFile(getRelativeFilePath(airdPath));\n+    if (!file.exists()) {\n+      String message = Messages.aird + airdPath + Messages.not_exist;\n+      logError(message);\n+      throw new CommandLineException(message);\n+    }\n+  }\n+\n+  /**\n+   * @param outputFolder\n+   * @throws CommandLineException\n+   */\n+  protected IFolder getOrCreateOutputFolder() throws CommandLineException {\n+    String outputFolder = argHelper.getOutputFolder();\n+    IFolder folder = null;\n+    if (outputFolder != null) {\n+      folder = ResourcesPlugin.getWorkspace().getRoot().getFolder(new Path(outputFolder));\n+\n+      try {\n+        IProject project = folder.getProject();\n+        if (!project.exists()) {\n+          project.create(new NullProgressMonitor());\n+        }\n+\n+        if (!project.isOpen()) {\n+          project.open(new NullProgressMonitor());\n+        }\n+        if (!folder.exists()) {\n+          folder.create(true, true, new NullProgressMonitor());\n+        } else {\n+          logInfo(outputFolder + Messages.already_exist);\n+        }\n+\n+      } catch (CoreException exception) {\n+        StringBuilder message = new StringBuilder(Messages.cannot_create_folder);\n+        logger.error(message.toString(), exception);\n+        throw new CommandLineException(message.toString());\n+      }\n+    }", "originalCommit": "a0d6756abf560505d98a7d838a40ccc6ae8da372", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDI3NDAyMQ==", "url": "https://github.com/eclipse/capella/pull/120#discussion_r390274021", "bodyText": "I also think it's better to use a standard path but outputfolder has always been used by user as a relative folder in an Eclipse project. I thinks it was implemented to be coherent with the HTMLCommandLine (where you choose a folder in a project as output).", "author": "minhtutonthat", "createdAt": "2020-03-10T12:19:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDIyMDI5NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDIyMTIwNQ==", "url": "https://github.com/eclipse/capella/pull/120#discussion_r390221205", "bodyText": "Cool \ud83d\udc4d", "author": "sandupostaru", "createdAt": "2020-03-10T10:30:53Z", "path": "core/plugins/org.polarsys.capella.core.commandline.core/src/org/polarsys/capella/core/commandline/core/DefaultCommandLine.java", "diffHunk": "@@ -0,0 +1,384 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 THALES GLOBAL SERVICES.\n+ * All rights reserved. This program and the accompanying materials\n+ * are made available under the terms of the Eclipse Public License v1.0\n+ * which accompanies this distribution, and is available at\n+ * http://www.eclipse.org/legal/epl-v10.html\n+ *\n+ * Contributors:\n+ *    Thales - initial API and implementation\n+ *******************************************************************************/\n+package org.polarsys.capella.core.commandline.core;\n+\n+import java.io.File;\n+import java.io.FileInputStream;\n+import java.io.IOException;\n+import java.net.URISyntaxException;\n+import java.net.URL;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+\n+import javax.xml.XMLConstants;\n+import javax.xml.parsers.DocumentBuilder;\n+import javax.xml.parsers.DocumentBuilderFactory;\n+import javax.xml.parsers.ParserConfigurationException;\n+import javax.xml.xpath.XPath;\n+import javax.xml.xpath.XPathConstants;\n+import javax.xml.xpath.XPathExpression;\n+import javax.xml.xpath.XPathExpressionException;\n+import javax.xml.xpath.XPathFactory;\n+\n+import org.eclipse.core.resources.IFile;\n+import org.eclipse.core.resources.IFolder;\n+import org.eclipse.core.resources.IProject;\n+import org.eclipse.core.resources.IWorkspace;\n+import org.eclipse.core.resources.ResourcesPlugin;\n+import org.eclipse.core.runtime.CoreException;\n+import org.eclipse.core.runtime.FileLocator;\n+import org.eclipse.core.runtime.NullProgressMonitor;\n+import org.eclipse.core.runtime.Path;\n+import org.eclipse.emf.common.util.URI;\n+import org.eclipse.equinox.app.IApplicationContext;\n+import org.osgi.framework.Bundle;\n+import org.osgi.framework.FrameworkUtil;\n+import org.polarsys.capella.common.tools.report.config.registry.ReportManagerRegistry;\n+import org.polarsys.capella.common.tools.report.util.IReportManagerDefaultComponents;\n+import org.polarsys.capella.core.model.handler.command.CapellaResourceHelper;\n+import org.w3c.dom.Document;\n+import org.w3c.dom.Node;\n+import org.w3c.dom.NodeList;\n+import org.xml.sax.SAXException;\n+\n+public class DefaultCommandLine extends AbstractCommandLine {\n+  public static String ALL_ARGUMENT = \"/all\";\n+\n+  public DefaultCommandLine() {\n+    argHelper = CommandLineArgumentHelper.getInstance();\n+    logger = ReportManagerRegistry.getInstance().subscribe(IReportManagerDefaultComponents.DEFAULT);\n+  }\n+\n+  /**\n+   * {@inheritDoc}\n+   *\n+   * @throws CommandLineException\n+   */\n+  @Override\n+  public void prepare(IApplicationContext context) throws CommandLineException {\n+    // Import projects\n+    importProjects();\n+    // Create output folder\n+    getOrCreateOutputFolder();\n+  }\n+\n+  protected void importProjects() throws CommandLineException {\n+    String projectsToImport = argHelper.getImportProjects();\n+    if (projectsToImport != null) {\n+      try {\n+        importProjects(toList(projectsToImport));\n+      } catch (CoreException exception) {\n+        throw new CommandLineException(exception.getMessage());\n+      }\n+    }\n+  }\n+\n+  @Override\n+  public void postExecute(IApplicationContext context) throws CommandLineException {\n+    exportZips();\n+  }\n+\n+  protected void exportZips() throws CommandLineException {\n+    String projectsToExportZip = argHelper.getExportZips();\n+    if (projectsToExportZip != null) {\n+      if (projectsToExportZip.equals(ALL_ARGUMENT)) {\n+        exportProjectZips(Arrays.stream(ResourcesPlugin.getWorkspace().getRoot().getProjects())\n+            .map(iProject -> iProject.getName()).collect(Collectors.toList()));\n+      } else {\n+        exportProjectZips(toList(projectsToExportZip));\n+      }\n+    }\n+  }\n+\n+  /**\n+   * @param projectsToExportZip\n+   * @throws CoreException\n+   */\n+  protected void exportProjectZips(List<String> projectsToExportZip) throws CommandLineException {\n+    IFolder outputFolder = getOrCreateOutputFolder();\n+    if (outputFolder == null) {\n+      logger.error(Messages.export_zip_no_ouputfolder);\n+    } else {\n+      for (String project : projectsToExportZip) {\n+        Optional<IProject> anyIProject = Arrays.stream(ResourcesPlugin.getWorkspace().getRoot().getProjects())\n+            .filter(iProject -> iProject.getName().equals(project)).findAny();\n+        if (!anyIProject.isPresent()) {\n+          logger.error(Messages.export_zip_not_found + project);\n+        } else {\n+          IWorkspace workspace = ResourcesPlugin.getWorkspace();\n+          IFile file = outputFolder.getFile(project + \".zip\");\n+          IProject newProject = workspace.getRoot().getProject(project);\n+          WorkbenchHelper.exportZipFile(newProject, file);\n+        }\n+      }\n+    }\n+  }\n+\n+  protected void checkProject(IProject project) throws CommandLineException {\n+    if (!project.exists()) {\n+      logError(Messages.project + project.getName() + Messages.not_exist);\n+    } else {\n+      try {\n+        project.open(new NullProgressMonitor());\n+      } catch (CoreException exception) {\n+        logError(Messages.unable_open_project + project.getName());\n+      }\n+      List<IFile> melodymodellerFiles = getCapellamodellerFiles(project);\n+      // check that all melodymodeller files are compliant with current Capella version\n+      for (IFile modeller : melodymodellerFiles) {\n+        compliancyCheck(modeller);\n+      }\n+    }\n+  }\n+\n+  /**\n+   * Check that inputs arguments are valid\n+   * \n+   * @throws CommandLineException\n+   */\n+  protected void checkInputs() throws CommandLineException {\n+    if (argHelper.getInputs() == null) {\n+      logger.error(Messages.inputs_mandatory);\n+    } else if (argHelper.getInputs().equals(ALL_ARGUMENT)) {\n+      // /all is accepted as argument\n+    } else {\n+      List<String> inputs = toList(argHelper.getInputs());\n+      for (String input : inputs) {\n+        if (input.endsWith(CapellaResourceHelper.AIRD_FILE_EXTENSION)) {\n+          checkInputAirdFile(input);\n+        } else {\n+          checkInputProject(input);\n+        }\n+      }\n+    }\n+  }\n+\n+  protected void checkInputProject(String projectPath) throws CommandLineException {\n+    String projectName = getProjectNameFromPath(projectPath);\n+    IProject project = ResourcesPlugin.getWorkspace().getRoot().getProject(projectName);\n+    checkProject(project);\n+  }\n+\n+  protected void checkInputAirdFile(String airdPath) throws CommandLineException {\n+    String projectName = getProjectNameFromPath(airdPath);\n+    IProject project = ResourcesPlugin.getWorkspace().getRoot().getProject(projectName);\n+    checkProject(project);\n+    IFile file = project.getFile(getRelativeFilePath(airdPath));\n+    if (!file.exists()) {\n+      String message = Messages.aird + airdPath + Messages.not_exist;\n+      logError(message);\n+      throw new CommandLineException(message);\n+    }\n+  }\n+\n+  /**\n+   * @param outputFolder\n+   * @throws CommandLineException\n+   */\n+  protected IFolder getOrCreateOutputFolder() throws CommandLineException {\n+    String outputFolder = argHelper.getOutputFolder();\n+    IFolder folder = null;\n+    if (outputFolder != null) {\n+      folder = ResourcesPlugin.getWorkspace().getRoot().getFolder(new Path(outputFolder));\n+\n+      try {\n+        IProject project = folder.getProject();\n+        if (!project.exists()) {\n+          project.create(new NullProgressMonitor());\n+        }\n+\n+        if (!project.isOpen()) {\n+          project.open(new NullProgressMonitor());\n+        }\n+        if (!folder.exists()) {\n+          folder.create(true, true, new NullProgressMonitor());\n+        } else {\n+          logInfo(outputFolder + Messages.already_exist);\n+        }\n+\n+      } catch (CoreException exception) {\n+        StringBuilder message = new StringBuilder(Messages.cannot_create_folder);\n+        logger.error(message.toString(), exception);\n+        throw new CommandLineException(message.toString());\n+      }\n+    }\n+\n+    return folder;\n+  }\n+\n+  /**\n+   * {@inheritDoc}\n+   */\n+  @Override\n+  public void printHelp() {\n+    printHelp(Collections.emptyList());\n+  }\n+  \n+  protected void printHelp(List<String> hiddenArguments) {\n+    System.out.println(\"*** Applicable arguments for command line***\"); //$NON-NLS-1$\n+    printArgumentsFromTable(\"commonParameters\", true, hiddenArguments);\n+  }\n+\n+  protected void printArgumentsFromTable(String tableId, boolean printTitle, List<String> hiddenArguments) {", "originalCommit": "a0d6756abf560505d98a7d838a40ccc6ae8da372", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDIyNTU1MA==", "url": "https://github.com/eclipse/capella/pull/120#discussion_r390225550", "bodyText": "\u26a0\ufe0f\n     this.backUpModel = backupModel;", "author": "sandupostaru", "createdAt": "2020-03-10T10:39:04Z", "path": "core/plugins/org.polarsys.capella.core.data.migration/src/org/polarsys/capella/core/data/migration/context/MigrationContext.java", "diffHunk": "@@ -66,6 +68,14 @@ public void setSkipConfirmation(boolean skipConfirmation) {\n     _skipConfirmation = skipConfirmation;\n   }\n \n+  public boolean isBackupModel() {\n+    return backUpModel;\n+  }\n+\n+  public void setBackupModel(boolean backupModel) {\n+    backUpModel = backupModel;", "originalCommit": "a0d6756abf560505d98a7d838a40ccc6ae8da372", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDI2NDc5Ng==", "url": "https://github.com/eclipse/capella/pull/120#discussion_r390264796", "bodyText": "should be eclipsec.exe instead of capella.exe for all references", "author": "sandupostaru", "createdAt": "2020-03-10T12:00:22Z", "path": "doc/plugins/org.polarsys.capella.commandline.doc/html/19. Command Line Support/19.1. Core Mechanism and Applications.html", "diffHunk": "@@ -144,9 +166,8 @@ <h3 id=\"Model_Validation\">Model Validation</h3>\n &lt;CapellaInstallationPath&gt;/capella.exe -nosplash", "originalCommit": "a0d6756abf560505d98a7d838a40ccc6ae8da372", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "53f2a461dc2c855e887098fd0eb59f8998f1ca1f", "url": "https://github.com/eclipse/capella/commit/53f2a461dc2c855e887098fd0eb59f8998f1ca1f", "message": "[560828] [CommandLine] Add some evolutions for command line argument\nmanagement\n\nChange-Id: I3adb7a57986777735dbec1da4fd204ca08593ecc\nSigned-off-by: Tu Ton <minhtutonthat@gmail.com>", "committedDate": "2020-03-10T12:27:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDI4MDE4Mg==", "url": "https://github.com/eclipse/capella/pull/120#discussion_r390280182", "bodyText": "\ud83d\udc4d", "author": "sandupostaru", "createdAt": "2020-03-10T12:32:37Z", "path": "core/plugins/org.polarsys.capella.core.commandline.core/src/org/polarsys/capella/core/commandline/core/DefaultCommandLine.java", "diffHunk": "@@ -113,9 +108,10 @@ protected void exportProjectZips(List<String> projectsToExportZip) throws Comman\n     if (outputFolder == null) {\n       logger.error(Messages.export_zip_no_ouputfolder);\n     } else {\n+      IProject[] iProjects = ResourcesPlugin.getWorkspace().getRoot().getProjects();", "originalCommit": "53f2a461dc2c855e887098fd0eb59f8998f1ca1f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}