{"pr_number": 430, "pr_title": "[568583] Renaming the Instance Role should rename the Represented Instance and vice-versa for all scenario kinds", "pr_createdAt": "2020-11-06T07:58:55Z", "pr_url": "https://github.com/eclipse/capella/pull/430", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODY0MDQxOQ==", "url": "https://github.com/eclipse/capella/pull/430#discussion_r518640419", "bodyText": "ModellingcorePackage.Literals.ABSTRACT_NAMED_ELEMENT__NAME.equals(feature) avoids feature!=null", "author": "pdulth", "createdAt": "2020-11-06T09:53:38Z", "path": "core/plugins/org.polarsys.capella.core.model.helpers/src/org/polarsys/capella/core/model/helpers/listeners/CapellaModelDataListenerForInstanceRole.java", "diffHunk": "@@ -0,0 +1,97 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 THALES GLOBAL SERVICES.\n+ * \n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ * \n+ * SPDX-License-Identifier: EPL-2.0\n+ * \n+ * Contributors:\n+ *    Thales - initial API and implementation\n+ *******************************************************************************/\n+package org.polarsys.capella.core.model.helpers.listeners;\n+\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Map.Entry;\n+\n+import org.eclipse.emf.common.notify.Notification;\n+import org.eclipse.emf.ecore.EObject;\n+import org.eclipse.emf.ecore.EStructuralFeature;\n+import org.polarsys.capella.common.data.modellingcore.ModellingcorePackage;\n+import org.polarsys.capella.common.helpers.EObjectExt;\n+import org.polarsys.capella.core.data.information.AbstractInstance;\n+import org.polarsys.capella.core.data.interaction.InstanceRole;\n+import org.polarsys.capella.core.data.interaction.InteractionPackage;\n+import org.polarsys.capella.core.data.interaction.Scenario;\n+import org.polarsys.capella.core.model.utils.NamingHelper;\n+\n+/**\n+ * \n+ * This listener will synchronize the name of InstanceRole and its represented element\n+ * \n+ */\n+public class CapellaModelDataListenerForInstanceRole extends CapellaModelDataListener {\n+  @Override\n+  public void notifyChanged(Notification notification) {\n+    // pre-condition: call contributed filters\n+    if (filterNotification(notification)) {\n+      return;\n+    }\n+\n+    // pre-condition: only SET notifications are wanted\n+    if (notification.getEventType() != Notification.SET) {\n+      return;\n+    }\n+\n+    EStructuralFeature feature = (EStructuralFeature) notification.getFeature();\n+    if (feature != null && feature.equals(ModellingcorePackage.Literals.ABSTRACT_NAMED_ELEMENT__NAME)) {", "originalCommit": "f5e6d4cc26b894039d475bd51998a42b940557cd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODY0MTc4Mw==", "url": "https://github.com/eclipse/capella/pull/430#discussion_r518641783", "bodyText": "can you use .computeIfAbsent(ch, x -> new ArrayList), otherwise, a new arrayList will be created per loop", "author": "pdulth", "createdAt": "2020-11-06T09:56:00Z", "path": "core/plugins/org.polarsys.capella.core.model.helpers/src/org/polarsys/capella/core/model/helpers/listeners/CapellaModelDataListenerForInstanceRole.java", "diffHunk": "@@ -0,0 +1,97 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 THALES GLOBAL SERVICES.\n+ * \n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ * \n+ * SPDX-License-Identifier: EPL-2.0\n+ * \n+ * Contributors:\n+ *    Thales - initial API and implementation\n+ *******************************************************************************/\n+package org.polarsys.capella.core.model.helpers.listeners;\n+\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Map.Entry;\n+\n+import org.eclipse.emf.common.notify.Notification;\n+import org.eclipse.emf.ecore.EObject;\n+import org.eclipse.emf.ecore.EStructuralFeature;\n+import org.polarsys.capella.common.data.modellingcore.ModellingcorePackage;\n+import org.polarsys.capella.common.helpers.EObjectExt;\n+import org.polarsys.capella.core.data.information.AbstractInstance;\n+import org.polarsys.capella.core.data.interaction.InstanceRole;\n+import org.polarsys.capella.core.data.interaction.InteractionPackage;\n+import org.polarsys.capella.core.data.interaction.Scenario;\n+import org.polarsys.capella.core.model.utils.NamingHelper;\n+\n+/**\n+ * \n+ * This listener will synchronize the name of InstanceRole and its represented element\n+ * \n+ */\n+public class CapellaModelDataListenerForInstanceRole extends CapellaModelDataListener {\n+  @Override\n+  public void notifyChanged(Notification notification) {\n+    // pre-condition: call contributed filters\n+    if (filterNotification(notification)) {\n+      return;\n+    }\n+\n+    // pre-condition: only SET notifications are wanted\n+    if (notification.getEventType() != Notification.SET) {\n+      return;\n+    }\n+\n+    EStructuralFeature feature = (EStructuralFeature) notification.getFeature();\n+    if (feature != null && feature.equals(ModellingcorePackage.Literals.ABSTRACT_NAMED_ELEMENT__NAME)) {\n+      String value = notification.getNewStringValue();\n+      Object notifier = notification.getNotifier();\n+\n+      if (notifier instanceof AbstractInstance) {\n+        AbstractInstance abstractInstance = ((AbstractInstance) notifier);\n+\n+        // only sync unique per-scenario instance roles\n+        Collection<EObject> representingInstanceRoles = EObjectExt.getReferencers(abstractInstance,\n+            InteractionPackage.Literals.INSTANCE_ROLE, InteractionPackage.Literals.INSTANCE_ROLE__REPRESENTED_INSTANCE);\n+\n+        if (!representingInstanceRoles.isEmpty()) {\n+          Map<Scenario, List<InstanceRole>> scenario2IRs = new HashMap<>();\n+          for (EObject instanceRole : representingInstanceRoles) {\n+            if (instanceRole instanceof InstanceRole && instanceRole.eContainer() instanceof Scenario) {\n+              Scenario scenario = (Scenario) instanceRole.eContainer();\n+              scenario2IRs.putIfAbsent(scenario, new ArrayList<>());", "originalCommit": "f5e6d4cc26b894039d475bd51998a42b940557cd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjA1NzQ1Nw==", "url": "https://github.com/eclipse/capella/pull/430#discussion_r522057457", "bodyText": "can you use .computeIfAbsent(ch, x -> new ArrayList), otherwise, a new arrayList will be created per loop\n\nNicely spotted!", "author": "sandupostaru", "createdAt": "2020-11-12T12:06:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODY0MTc4Mw=="}], "type": "inlineReview"}, {"oid": "9995241f44c835250f64f38b0bc2ebf5ba1f321c", "url": "https://github.com/eclipse/capella/commit/9995241f44c835250f64f38b0bc2ebf5ba1f321c", "message": "[568583] Renaming the Instance Role should rename the Represented\nInstance and vice-versa for all scenario kinds\n\nBug: 568583\nChange-Id: Id001482117abf9783144541e378b09306db82309\nSigned-off-by: Tu Ton <minhtutonthat@gmail.com>", "committedDate": "2020-11-12T12:14:03Z", "type": "commit"}, {"oid": "9995241f44c835250f64f38b0bc2ebf5ba1f321c", "url": "https://github.com/eclipse/capella/commit/9995241f44c835250f64f38b0bc2ebf5ba1f321c", "message": "[568583] Renaming the Instance Role should rename the Represented\nInstance and vice-versa for all scenario kinds\n\nBug: 568583\nChange-Id: Id001482117abf9783144541e378b09306db82309\nSigned-off-by: Tu Ton <minhtutonthat@gmail.com>", "committedDate": "2020-11-12T12:14:03Z", "type": "forcePushed"}]}