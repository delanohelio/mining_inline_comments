{"pr_number": 7328, "pr_title": "migration survival data", "pr_createdAt": "2020-03-24T17:06:25Z", "pr_url": "https://github.com/cBioPortal/cbioportal/pull/7328", "timeline": [{"oid": "89b487814197ea91f63e941a0a92b1076f0fae73", "url": "https://github.com/cBioPortal/cbioportal/commit/89b487814197ea91f63e941a0a92b1076f0fae73", "message": "migration survival data", "committedDate": "2020-03-26T22:33:39Z", "type": "forcePushed"}, {"oid": "24e97e24314b73f924bcc3064abd876fe4c2b770", "url": "https://github.com/cBioPortal/cbioportal/commit/24e97e24314b73f924bcc3064abd876fe4c2b770", "message": "migration survival data", "committedDate": "2020-03-27T06:01:32Z", "type": "forcePushed"}, {"oid": "b793733ccb8b3c7ab851c51a11001cafde9adb79", "url": "https://github.com/cBioPortal/cbioportal/commit/b793733ccb8b3c7ab851c51a11001cafde9adb79", "message": "search and replace survival data by pattern (has both _months and _status)", "committedDate": "2020-04-07T04:29:54Z", "type": "forcePushed"}, {"oid": "578a80aa6ff6f48301ad84399cf44d07fb98e8d2", "url": "https://github.com/cBioPortal/cbioportal/commit/578a80aa6ff6f48301ad84399cf44d07fb98e8d2", "message": "search and replace survival data by pattern (has both _months and _status)", "committedDate": "2020-04-07T04:33:33Z", "type": "forcePushed"}, {"oid": "d6863b8dcaf24cfda5a9e4017c0c04e1d721082f", "url": "https://github.com/cBioPortal/cbioportal/commit/d6863b8dcaf24cfda5a9e4017c0c04e1d721082f", "message": "search and replace survival data by pattern (has both _months and _status)", "committedDate": "2020-04-07T04:34:38Z", "type": "forcePushed"}, {"oid": "aeb132d929c8d9289f3e1fc53bfdc62386c831c3", "url": "https://github.com/cBioPortal/cbioportal/commit/aeb132d929c8d9289f3e1fc53bfdc62386c831c3", "message": "do not change data type", "committedDate": "2020-04-08T18:46:11Z", "type": "forcePushed"}, {"oid": "765a1ee68d84ae3abb0ad6f5837494b7d08bceef", "url": "https://github.com/cBioPortal/cbioportal/commit/765a1ee68d84ae3abb0ad6f5837494b7d08bceef", "message": "do not change data type", "committedDate": "2020-04-24T18:30:59Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjgyMjUxMA==", "url": "https://github.com/cBioPortal/cbioportal/pull/7328#discussion_r416822510", "bodyText": "These mappings correspond with inventory of survival types captured in 7292.  Note when the select statement is run against clinical_attribute_meta on the private database, additional attributes are identified beyond which are captured in the issue (which is restricted to the public database).  We should clarify if/when this gets run on the private database.", "author": "n1zea144", "createdAt": "2020-04-28T18:13:13Z", "path": "db-scripts/src/main/resources/migration.sql", "diffHunk": "@@ -849,4 +849,23 @@ CREATE TABLE `resource_study` (\n   PRIMARY KEY (`INTERNAL_ID`, `RESOURCE_ID`, `URL`),\n   FOREIGN KEY (`INTERNAL_ID`) REFERENCES `cancer_study` (`CANCER_STUDY_ID`) ON DELETE CASCADE\n );\n-UPDATE `info` SET `DB_SCHEMA_VERSION`=\"2.12.4\";\n\\ No newline at end of file\n+UPDATE `info` SET `DB_SCHEMA_VERSION`=\"2.12.4\";\n+\n+##version: 2.12.5\n+-- survival data migration\n+-- create temporary table to store survival attributes\n+CREATE TEMPORARY TABLE IF NOT EXISTS survival_attributes AS \n+  (SELECT DISTINCT Concat(Substr(ATTR_ID, 1, Char_length(ATTR_ID) - 7), \n+                   \"_STATUS\") AS ATTR_ID \n+   FROM   clinical_attribute_meta \n+   WHERE  ATTR_ID LIKE \"%_STATUS\" \n+          AND Substr(ATTR_ID, 1, Char_length(ATTR_ID) - 7)IN (SELECT DISTINCT \n+              Substr(ATTR_ID, 1, Char_length(ATTR_ID) - 7) AS \n+              SurvivalDataStatusPrefix \n+              FROM   clinical_attribute_meta \n+              WHERE  ATTR_ID LIKE \"%_MONTHS\")); \n+\n+-- mapping to 0/1\n+UPDATE clinical_patient SET ATTR_VALUE = CONCAT(\"1:\",ATTR_ID) WHERE ATTR_ID in (SELECT ATTR_ID FROM survival_attributes) AND ATTR_VALUE in ('DECEASED','Recurred/Progressed','Recurred','Progressed','Yes','yes','1','PROGRESSION','Event','DEAD OF MELANOMA','DEAD WITH TUMOR','Metastatic','Relapse','Localized');", "originalCommit": "765a1ee68d84ae3abb0ad6f5837494b7d08bceef", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjkxMTM0Ng==", "url": "https://github.com/cBioPortal/cbioportal/pull/7328#discussion_r416911346", "bodyText": "FYI, 7323 also captured the vocabularies from the MSK portal.", "author": "dippindots", "createdAt": "2020-04-28T20:46:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjgyMjUxMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjgyNDY0MQ==", "url": "https://github.com/cBioPortal/cbioportal/pull/7328#discussion_r416824641", "bodyText": "Only select %_STATUS attributes which have a corresponding %_MONTHS attribute.", "author": "n1zea144", "createdAt": "2020-04-28T18:16:42Z", "path": "db-scripts/src/main/resources/migration.sql", "diffHunk": "@@ -849,4 +849,23 @@ CREATE TABLE `resource_study` (\n   PRIMARY KEY (`INTERNAL_ID`, `RESOURCE_ID`, `URL`),\n   FOREIGN KEY (`INTERNAL_ID`) REFERENCES `cancer_study` (`CANCER_STUDY_ID`) ON DELETE CASCADE\n );\n-UPDATE `info` SET `DB_SCHEMA_VERSION`=\"2.12.4\";\n\\ No newline at end of file\n+UPDATE `info` SET `DB_SCHEMA_VERSION`=\"2.12.4\";\n+\n+##version: 2.12.5\n+-- survival data migration\n+-- create temporary table to store survival attributes\n+CREATE TEMPORARY TABLE IF NOT EXISTS survival_attributes AS \n+  (SELECT DISTINCT Concat(Substr(ATTR_ID, 1, Char_length(ATTR_ID) - 7), \n+                   \"_STATUS\") AS ATTR_ID \n+   FROM   clinical_attribute_meta \n+   WHERE  ATTR_ID LIKE \"%_STATUS\" \n+          AND Substr(ATTR_ID, 1, Char_length(ATTR_ID) - 7)IN (SELECT DISTINCT \n+              Substr(ATTR_ID, 1, Char_length(ATTR_ID) - 7) AS \n+              SurvivalDataStatusPrefix \n+              FROM   clinical_attribute_meta \n+              WHERE  ATTR_ID LIKE \"%_MONTHS\")); ", "originalCommit": "765a1ee68d84ae3abb0ad6f5837494b7d08bceef", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjkwMDEyOQ==", "url": "https://github.com/cBioPortal/cbioportal/pull/7328#discussion_r416900129", "bodyText": "Given that a temporary table is created, I don't think the \"If not exists\" clause is required, but it doesn't hurt.", "author": "n1zea144", "createdAt": "2020-04-28T20:26:29Z", "path": "db-scripts/src/main/resources/migration.sql", "diffHunk": "@@ -849,4 +849,23 @@ CREATE TABLE `resource_study` (\n   PRIMARY KEY (`INTERNAL_ID`, `RESOURCE_ID`, `URL`),\n   FOREIGN KEY (`INTERNAL_ID`) REFERENCES `cancer_study` (`CANCER_STUDY_ID`) ON DELETE CASCADE\n );\n-UPDATE `info` SET `DB_SCHEMA_VERSION`=\"2.12.4\";\n\\ No newline at end of file\n+UPDATE `info` SET `DB_SCHEMA_VERSION`=\"2.12.4\";\n+\n+##version: 2.12.5\n+-- survival data migration\n+-- create temporary table to store survival attributes\n+CREATE TEMPORARY TABLE IF NOT EXISTS survival_attributes AS ", "originalCommit": "765a1ee68d84ae3abb0ad6f5837494b7d08bceef", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f50b6f53d1baba2d9e78c92fef638dba06c649bf", "url": "https://github.com/cBioPortal/cbioportal/commit/f50b6f53d1baba2d9e78c92fef638dba06c649bf", "message": "migration survival data", "committedDate": "2020-04-28T20:35:50Z", "type": "forcePushed"}, {"oid": "63c7fcb50f8dcd2235caa53068da05c9f8233f14", "url": "https://github.com/cBioPortal/cbioportal/commit/63c7fcb50f8dcd2235caa53068da05c9f8233f14", "message": "migration survival data", "committedDate": "2020-05-06T16:28:16Z", "type": "forcePushed"}, {"oid": "d7dd6726db8701284ac2e069aa35876db4005c5b", "url": "https://github.com/cBioPortal/cbioportal/commit/d7dd6726db8701284ac2e069aa35876db4005c5b", "message": "migration survival data", "committedDate": "2020-05-14T19:24:52Z", "type": "commit"}, {"oid": "d7dd6726db8701284ac2e069aa35876db4005c5b", "url": "https://github.com/cBioPortal/cbioportal/commit/d7dd6726db8701284ac2e069aa35876db4005c5b", "message": "migration survival data", "committedDate": "2020-05-14T19:24:52Z", "type": "forcePushed"}]}