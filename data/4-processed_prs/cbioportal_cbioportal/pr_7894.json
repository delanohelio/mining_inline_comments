{"pr_number": 7894, "pr_title": "RFC56: Add support for custom driver annotations for CNA data", "pr_createdAt": "2020-09-22T10:23:22Z", "pr_url": "https://github.com/cBioPortal/cbioportal/pull/7894", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTAxMDIyMQ==", "url": "https://github.com/cBioPortal/cbioportal/pull/7894#discussion_r499010221", "bodyText": "has this query been tested on a db with large number of records/large study? Just wondering if there was any changes in performance that needs to be considered for periodic imports.", "author": "averyniceday", "createdAt": "2020-10-02T19:26:21Z", "path": "core/src/main/java/org/mskcc/cbio/portal/dao/DaoCnaEvent.java", "diffHunk": "@@ -147,38 +159,53 @@ private static long addCnaEventDirectly(CnaEvent cnaEvent) throws DaoException {\n         try {\n             con = JdbcUtil.getDbConnection(DaoCnaEvent.class);\n             pstmt = con.prepareStatement\n-\t\t(\"SELECT sample_cna_event.CNA_EVENT_ID, SAMPLE_ID, GENETIC_PROFILE_ID,\"\n-                    + \" ENTREZ_GENE_ID, ALTERATION FROM sample_cna_event, cna_event\"\n-                    + \" WHERE `GENETIC_PROFILE_ID`=?\"\n+\t\t(\"SELECT sample_cna_event.CNA_EVENT_ID,\"\n+                    + \" sample_cna_event.SAMPLE_ID,\"\n+                    + \" sample_cna_event.GENETIC_PROFILE_ID,\"\n+                    + \" ENTREZ_GENE_ID,\"\n+                    + \" ALTERATION,\"\n+                    + \" alteration_driver_annotation.DRIVER_FILTER,\"\n+                    + \" alteration_driver_annotation.DRIVER_FILTER_ANNOTATION,\"\n+                    + \" alteration_driver_annotation.DRIVER_TIERS_FILTER,\"\n+                    + \" alteration_driver_annotation.DRIVER_TIERS_FILTER_ANNOTATION\"\n+                    + \" FROM sample_cna_event\"\n+                    + \" LEFT JOIN alteration_driver_annotation ON\"", "originalCommit": "bb0e7e1b3c2ebcd7dc230341b252cb2e1e95f6d1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTQ4NTI2Nw==", "url": "https://github.com/cBioPortal/cbioportal/pull/7894#discussion_r501485267", "bodyText": "No, it has not. Is there a particular way to test this beforehand that you can recommend?", "author": "pvannierop", "createdAt": "2020-10-08T06:50:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTAxMDIyMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTMwOTM2MQ==", "url": "https://github.com/cBioPortal/cbioportal/pull/7894#discussion_r521309361", "bodyText": "btw i did notice this stackoverflow issue re doing a left join with empty rows: https://stackoverflow.com/questions/31207935/mysql-with-left-join-is-slow-with-empty-row. Didn't read carefully to check if this applies here but just sharing for reference. I guess in the public cBioPortal alteration_driver_annotation will be empty at first\nCould also try with e.g. the latest dump of the public portal: http://download.cbioportal.org/mysql-snapshots/mysql-snapshots-toc.html", "author": "inodb", "createdAt": "2020-11-11T12:00:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTAxMDIyMQ=="}], "type": "inlineReview"}, {"oid": "b42c6f5b311d1c63f5c943cc8a4bc80265b2bad7", "url": "https://github.com/cBioPortal/cbioportal/commit/b42c6f5b311d1c63f5c943cc8a4bc80265b2bad7", "message": "Add support for custom annotations for discrete CNA data\n\nUpdate system test report html", "committedDate": "2020-11-03T07:58:18Z", "type": "forcePushed"}, {"oid": "6e3ebbad2aae9780f611f2427772afd90adc75da", "url": "https://github.com/cBioPortal/cbioportal/commit/6e3ebbad2aae9780f611f2427772afd90adc75da", "message": "Add support for custom annotations for discrete CNA data\n\nUpdate system test report html", "committedDate": "2020-11-12T05:44:28Z", "type": "forcePushed"}, {"oid": "b4a17ae06c4c526e47ae2ffe3905179aa7eb3d2f", "url": "https://github.com/cBioPortal/cbioportal/commit/b4a17ae06c4c526e47ae2ffe3905179aa7eb3d2f", "message": "Add support for custom annotations for discrete CNA data\n\nUpdate system test report html", "committedDate": "2020-11-19T05:41:41Z", "type": "commit"}, {"oid": "b4a17ae06c4c526e47ae2ffe3905179aa7eb3d2f", "url": "https://github.com/cBioPortal/cbioportal/commit/b4a17ae06c4c526e47ae2ffe3905179aa7eb3d2f", "message": "Add support for custom annotations for discrete CNA data\n\nUpdate system test report html", "committedDate": "2020-11-19T05:41:41Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjgxMDg1NQ==", "url": "https://github.com/cBioPortal/cbioportal/pull/7894#discussion_r546810855", "bodyText": "@pvannierop @dippindots this DAO only has to do with import right?  This is not related to reading db, right?", "author": "alisman", "createdAt": "2020-12-21T16:42:38Z", "path": "core/src/main/java/org/mskcc/cbio/portal/dao/DaoMutation.java", "diffHunk": "@@ -1548,7 +1556,7 @@ public static void deleteAllRecords() throws DaoException {\n                 try {\n                     con = JdbcUtil.getDbConnection(DaoMutation.class);\n                     pstmt = con.prepareStatement(\n-                            \"SELECT DISTINCT DRIVER_TIERS_FILTER FROM mutation \"\n+                            \"SELECT DISTINCT DRIVER_TIERS_FILTER FROM alteration_driver_annotation \"", "originalCommit": "b4a17ae06c4c526e47ae2ffe3905179aa7eb3d2f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjgxMjA1Mw==", "url": "https://github.com/cBioPortal/cbioportal/pull/7894#discussion_r546812053", "bodyText": "@pvannierop is it possible that we haven't introduced appropriate indexing on this table (alteration_driver_annotation) ?", "author": "alisman", "createdAt": "2020-12-21T16:44:55Z", "path": "persistence/persistence-mybatis/src/main/resources/org/cbioportal/persistence/mybatis/MutationMapper.xml", "diffHunk": "@@ -61,6 +61,10 @@\n         INNER JOIN sample ON mutation.SAMPLE_ID = sample.INTERNAL_ID\n         INNER JOIN patient ON sample.PATIENT_ID = patient.INTERNAL_ID\n         INNER JOIN cancer_study ON patient.CANCER_STUDY_ID = cancer_study.CANCER_STUDY_ID\n+        LEFT JOIN alteration_driver_annotation ON", "originalCommit": "b4a17ae06c4c526e47ae2ffe3905179aa7eb3d2f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}