{"pr_number": 7472, "pr_title": "Flag mutations in MAF that occur outside of gene panel", "pr_createdAt": "2020-05-05T23:47:32Z", "pr_url": "https://github.com/cBioPortal/cbioportal/pull/7472", "timeline": [{"oid": "696884a7371eb45d90693498bbc8a64fd91f781c", "url": "https://github.com/cBioPortal/cbioportal/commit/696884a7371eb45d90693498bbc8a64fd91f781c", "message": "flag variants outside gene panel", "committedDate": "2020-05-05T23:40:45Z", "type": "commit"}, {"oid": "6906cb9ed75333c3cfa9a173c4ff17da7fc22713", "url": "https://github.com/cBioPortal/cbioportal/commit/6906cb9ed75333c3cfa9a173c4ff17da7fc22713", "message": "fix tests and update gene panels to flag off panel variants", "committedDate": "2020-05-19T14:10:17Z", "type": "commit"}, {"oid": "74f752ca61453a5a08093a60400f15fd7370b25a", "url": "https://github.com/cBioPortal/cbioportal/commit/74f752ca61453a5a08093a60400f15fd7370b25a", "message": "update variable names", "committedDate": "2020-05-19T14:31:51Z", "type": "commit"}, {"oid": "20bc0ec0687699719a87f4c78c4813fe7cb7f554", "url": "https://github.com/cBioPortal/cbioportal/commit/20bc0ec0687699719a87f4c78c4813fe7cb7f554", "message": "Flag the off panel variants as warning", "committedDate": "2020-05-19T14:38:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzU3ODY0OA==", "url": "https://github.com/cBioPortal/cbioportal/pull/7472#discussion_r427578648", "bodyText": "Do we still need to check NA at here? Not sure will gene_panel_list contains NA.", "author": "dippindots", "createdAt": "2020-05-19T20:26:18Z", "path": "core/src/main/scripts/importer/validateData.py", "diffHunk": "@@ -1484,16 +1485,22 @@ def checkLine(self, data):\n         if 'Hugo_Symbol' in self.cols:\n             hugo_symbol = data[self.cols.index('Hugo_Symbol')].strip()\n             # treat the empty string or 'Unknown' as a missing value\n-            if hugo_symbol in ('', 'Unknown'):\n+            if hugo_symbol in ('NA', '', 'Unknown'):\n                 hugo_symbol = None\n         if 'Entrez_Gene_Id' in self.cols:\n             entrez_id = data[self.cols.index('Entrez_Gene_Id')].strip()\n             # treat the empty string or 0 as a missing value\n-            if entrez_id in ('', '0'):\n+            if entrez_id in ('NA', '', '0'):\n                 entrez_id = None\n         # validate hugo and entrez together:\n-        self.checkGeneIdentification(hugo_symbol, entrez_id)\n-\n+        normalized_gene = self.checkGeneIdentification(hugo_symbol, entrez_id)\n+        \n+        # validate the gene to make sure its from the targeted panel\n+        if normalized_gene and self.portal.gene_panel_list and data[sample_id_column_index] in sample_ids_panel_dict:\n+            panel_id = sample_ids_panel_dict[data[sample_id_column_index]]\n+            if panel_id in self.portal.gene_panel_list and panel_id != 'NA':", "originalCommit": "20bc0ec0687699719a87f4c78c4813fe7cb7f554", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzY1ODcyMQ==", "url": "https://github.com/cBioPortal/cbioportal/pull/7472#discussion_r427658721", "bodyText": "Thanks for the review @dippindots. The panel id sometimes is NA. For example see: https://github.com/cBioPortal/cbioportal/blob/master/core/src/test/scripts/test_data/study_es_0/data_gene_panel_matrix.txt", "author": "rmadupuri", "createdAt": "2020-05-19T23:35:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzU3ODY0OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzU3OTg4Mg==", "url": "https://github.com/cBioPortal/cbioportal/pull/7472#discussion_r427579882", "bodyText": "Should we throw a warning or an error when we cannot parse a normalized_gene?", "author": "dippindots", "createdAt": "2020-05-19T20:28:38Z", "path": "core/src/main/scripts/importer/validateData.py", "diffHunk": "@@ -1828,6 +1835,23 @@ def checkValidationColumns(self, data):\n \n         return True\n \n+    def checkOffPanelVariant(self, data, normalized_gene, panel_id, hugo_symbol, entrez_id):\n+        try:\n+            normalized_gene = int(normalized_gene)\n+        except:\n+            pass", "originalCommit": "20bc0ec0687699719a87f4c78c4813fe7cb7f554", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzY2NzM2MQ==", "url": "https://github.com/cBioPortal/cbioportal/pull/7472#discussion_r427667361", "bodyText": "The normalized_gene is either a entrez id or None(when mapping in gene table is not present). If its None a warning is thrown here \n  \n    \n      cbioportal/core/src/main/scripts/importer/validateData.py\n    \n    \n         Line 725\n      in\n      3744576\n    \n    \n    \n    \n\n        \n          \n           def checkGeneIdentification(self, gene_symbol=None, entrez_id=None):", "author": "rmadupuri", "createdAt": "2020-05-20T00:01:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzU3OTg4Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzY5MzQ3Nw==", "url": "https://github.com/cBioPortal/cbioportal/pull/7472#discussion_r427693477", "bodyText": "Thanks!", "author": "dippindots", "createdAt": "2020-05-20T01:38:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzU3OTg4Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzU4NTM3Ng==", "url": "https://github.com/cBioPortal/cbioportal/pull/7472#discussion_r427585376", "bodyText": "Same as the next comment, I don't think we expect to see warnings when validate study_es_0. I don't really understand why this warning shows up since I saw those genes in the gene-panels.json.", "author": "dippindots", "createdAt": "2020-05-19T20:39:07Z", "path": "core/src/test/scripts/test_data/study_es_0/result_report.html", "diffHunk": "@@ -1259,6 +1259,13 @@ <h4 class=\"panel-title\">data_mutations_extended.maf</h4>\n                 <td>Line will not be loaded due to the variant classification filter. Filtered types: [Silent, Intron, 3&#39;UTR, 3&#39;Flank, 5&#39;UTR, 5&#39;Flank, IGR, RNA]</td>\n                 <td>Silent</td>\n               </tr>\n+              <tr class=\"warning\">\n+                <td><span class=\"glyphicon glyphicon-warning-sign\" aria-hidden=\"true\"></span><span class=\"sr-only\">Warning</span></td>\n+                <td>10, 11, 16, (9 more)</td>\n+                <td>&ndash;</td>\n+                <td>Off panel variant. Gene symbol not known to the targeted panel.</td>\n+                <td>MSH3, MYB, TP53, (4 more)</td>\n+              </tr>", "originalCommit": "20bc0ec0687699719a87f4c78c4813fe7cb7f554", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzY2ODY3MA==", "url": "https://github.com/cBioPortal/cbioportal/pull/7472#discussion_r427668670", "bodyText": "Thanks for pointing this. I wasn't sure if the test study should succeed 100% or can succeed with warnings. Added missing genes to the test gene panel and the study passed with no warnings. Reverted the reports.", "author": "rmadupuri", "createdAt": "2020-05-20T00:06:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzU4NTM3Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzU4NTQ5NA==", "url": "https://github.com/cBioPortal/cbioportal/pull/7472#discussion_r427585494", "bodyText": "Are we expecting to see warning when we validate study_es_0? I think study_es_0 should pass the validation without any warnings and errors.", "author": "dippindots", "createdAt": "2020-05-19T20:39:21Z", "path": "core/src/test/scripts/system_tests_validate_data.py", "diffHunk": "@@ -93,7 +93,7 @@ def test_exit_status_success(self):\n         # execute main function with arguments provided as if from sys.argv\n         args = validateData.interface(args)\n         exit_status = validateData.main_validate(args)\n-        self.assertEqual(0, exit_status)\n+        self.assertEqual(3, exit_status)", "originalCommit": "20bc0ec0687699719a87f4c78c4813fe7cb7f554", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzY2ODc3Mw==", "url": "https://github.com/cBioPortal/cbioportal/pull/7472#discussion_r427668773", "bodyText": "Reverted to 0.", "author": "rmadupuri", "createdAt": "2020-05-20T00:06:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzU4NTQ5NA=="}], "type": "inlineReview"}, {"oid": "9bc66621a9bbddac7e33c631f25e462cb9b7ff09", "url": "https://github.com/cBioPortal/cbioportal/commit/9bc66621a9bbddac7e33c631f25e462cb9b7ff09", "message": "updated tests and reverted html reports", "committedDate": "2020-05-19T23:16:32Z", "type": "commit"}]}