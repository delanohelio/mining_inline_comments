{"pr_number": 7969, "pr_title": "Get ref genome from meta_study instead of command line", "pr_createdAt": "2020-10-15T15:22:53Z", "pr_url": "https://github.com/cBioPortal/cbioportal/pull/7969", "timeline": [{"oid": "e805ff2f295eae71032d52dfcd754849a07a401c", "url": "https://github.com/cBioPortal/cbioportal/commit/e805ff2f295eae71032d52dfcd754849a07a401c", "message": "impl. ref genome parsing from meta_study", "committedDate": "2020-10-15T15:15:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTYzMzE5NQ==", "url": "https://github.com/cBioPortal/cbioportal/pull/7969#discussion_r505633195", "bodyText": "somehow my editor automatically removes trailing whitespace", "author": "SRodenburg", "createdAt": "2020-10-15T15:23:55Z", "path": "core/src/main/scripts/importer/cbioportal_common.py", "diffHunk": "@@ -37,7 +37,7 @@\n ADD_CASE_LIST_CLASS = \"org.mskcc.cbio.portal.scripts.AddCaseList\"\n VERSION_UTIL_CLASS = \"org.mskcc.cbio.portal.util.VersionUtil\"\n \n-# provides a key for data types to metafile specification dict.  \n+# provides a key for data types to metafile specification dict.", "originalCommit": "e805ff2f295eae71032d52dfcd754849a07a401c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTYzNDk3NQ==", "url": "https://github.com/cBioPortal/cbioportal/pull/7969#discussion_r505634975", "bodyText": "somehow this parameter is passed on but never used.", "author": "SRodenburg", "createdAt": "2020-10-15T15:26:19Z", "path": "core/src/main/scripts/importer/cbioportal_common.py", "diffHunk": "@@ -685,7 +686,6 @@ def validate_types_and_id(meta_dictionary, logger, filename):\n def parse_metadata_file(filename,\n                         logger,\n                         study_id=None,\n-                        genome_name=None,", "originalCommit": "e805ff2f295eae71032d52dfcd754849a07a401c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTYzNTM4Mw==", "url": "https://github.com/cBioPortal/cbioportal/pull/7969#discussion_r505635383", "bodyText": "arguments became obsolete now", "author": "SRodenburg", "createdAt": "2020-10-15T15:26:52Z", "path": "core/src/main/scripts/importer/metaImport.py", "diffHunk": "@@ -70,16 +70,7 @@ def interface():\n     portal_mode_group.add_argument('-n', '--no_portal_checks', default=False,\n                                        action='store_true',\n                                        help='Skip tests requiring information '\n-                                            'from the cBioPortal installation')\n-    parser.add_argument('-species', '--species', type=str, default='human',\n-                        help='species information (default: assumed human)',\n-                        required=False)\n-    parser.add_argument('-ucsc', '--ucsc_build_name', type=str, default='hg19',\n-                        help='UCSC reference genome assembly name (default: assumed hg19)',\n-                        required=False)   \n-    parser.add_argument('-ncbi', '--ncbi_build_number', type=str, default='37',\n-                         help='NCBI reference genome build number (default: assumed 37 for UCSC reference genome build hg19)',\n-                         required=False)                                                                  ", "originalCommit": "e805ff2f295eae71032d52dfcd754849a07a401c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTYzNjAxMw==", "url": "https://github.com/cBioPortal/cbioportal/pull/7969#discussion_r505636013", "bodyText": "not sure if we should also allow GRCxXX values", "author": "SRodenburg", "createdAt": "2020-10-15T15:27:48Z", "path": "core/src/main/scripts/importer/validateData.py", "diffHunk": "@@ -4453,11 +4459,18 @@ def process_metadata_files(directory, portal_instance, logger, relaxed_mode, str\n     global meta_dictionary\n     tags_file_path = None\n \n+    # implemented ref genomes\n+    reference_genome_map = {\n+        'hg19':('human','37','hg19'),\n+        'hg38':('human','38','hg38'),\n+        'mm10':('mouse','38','mm10')\n+    }\n+", "originalCommit": "e805ff2f295eae71032d52dfcd754849a07a401c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjEzNzkzOA==", "url": "https://github.com/cBioPortal/cbioportal/pull/7969#discussion_r506137938", "bodyText": "I think we should follow the values defined in portal.properties, so it's good like this. If you want to add the GRCxXX values we should change it in the properties. And just a thought: if we want to change the genome build properties in portal.properties I think we should simplify it to one property: hg19/hg38/mm10 already gives you all the information given from the three properties that we currently have.", "author": "oplantalech", "createdAt": "2020-10-16T07:50:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTYzNjAxMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTYzNjM4Nw==", "url": "https://github.com/cBioPortal/cbioportal/pull/7969#discussion_r505636387", "bodyText": "relic from previous work", "author": "SRodenburg", "createdAt": "2020-10-15T15:28:17Z", "path": "core/src/main/scripts/importer/validateData.py", "diffHunk": "@@ -4864,8 +4892,6 @@ def validate_data_relations(validators_by_meta_type, logger):\n def request_from_portal_api(server_url, api_name, logger):\n     \"\"\"Send a request to the portal API and return the decoded JSON object.\"\"\"\n \n-    print(api_name)\n-", "originalCommit": "e805ff2f295eae71032d52dfcd754849a07a401c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjEzNDQ1MA==", "url": "https://github.com/cBioPortal/cbioportal/pull/7969#discussion_r506134450", "bodyText": "I think it is wrong to assume that the default is hg19. The default is the genome specified in portal.properties, right?", "author": "oplantalech", "createdAt": "2020-10-16T07:45:52Z", "path": "core/src/main/scripts/importer/validateData.py", "diffHunk": "@@ -4518,6 +4531,21 @@ def process_metadata_files(directory, portal_instance, logger, relaxed_mode, str\n                         meta_dictionary['add_global_case_list'].lower() == 'true'):\n                     case_list_suffix_fns['all'] = filename\n \n+            if 'reference_genome' in meta_dictionary:\n+                if meta_dictionary['reference_genome'] not in reference_genome_map:\n+                    logger.error('Unknown reference genome defined. Should be one of %s' %\n+                                 list(reference_genome_map.keys()),\n+                                 extra={\n+                                     'filename_':filename,\n+                                     'cause':meta_dictionary['reference_genome'].strip()\n+                                 })\n+                else:\n+                    portal_instance.species, portal_instance.ncbi_build, portal_instance.genome_build = \\\n+                        reference_genome_map[meta_dictionary['reference_genome']]\n+            else:\n+                logger.info('No reference genome specified -- using default (hg19)',", "originalCommit": "e805ff2f295eae71032d52dfcd754849a07a401c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjEzODk4NQ==", "url": "https://github.com/cBioPortal/cbioportal/pull/7969#discussion_r506138985", "bodyText": "Another option would be to set the default to hg19 instead of being defined in portal.properties. But it should be checked if the genome build properties in portal.properties are only used here before removing them.", "author": "oplantalech", "createdAt": "2020-10-16T07:52:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjEzNDQ1MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjE4MjAzNg==", "url": "https://github.com/cBioPortal/cbioportal/pull/7969#discussion_r506182036", "bodyText": "The portal.properties are not used in the validator. AFAIK, those are only used in the Java code, and some parameters are passed on to the frontend.", "author": "SRodenburg", "createdAt": "2020-10-16T08:46:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjEzNDQ1MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjE5NTIxNA==", "url": "https://github.com/cBioPortal/cbioportal/pull/7969#discussion_r506195214", "bodyText": "@SRodenburg I see. I was confused by the portal_instance name.\nDefaults for these properties are, indeed, set here: https://github.com/cBioPortal/cbioportal/pull/7969/files/e805ff2f295eae71032d52dfcd754849a07a401c#diff-9be14d6564536099d9c431cf330dc2ad62abfecbbc191ac7c5814855dc37685eL305\nSo I think this three values can be simplified into one. As I mentioned, hg19/hg38/mm10 already gives you all the information given from the three properties that we currently have, and there is no need to deviate from the reference_genome property", "author": "oplantalech", "createdAt": "2020-10-16T09:02:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjEzNDQ1MA=="}], "type": "inlineReview"}, {"oid": "860a0a2f85b997fcaf365d16fe4d9b3c47b14f92", "url": "https://github.com/cBioPortal/cbioportal/commit/860a0a2f85b997fcaf365d16fe4d9b3c47b14f92", "message": "update docs", "committedDate": "2020-10-16T09:41:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjM2NDc2Nw==", "url": "https://github.com/cBioPortal/cbioportal/pull/7969#discussion_r506364767", "bodyText": "not entirely clear here what the values are supposed to be but will update that", "author": "inodb", "createdAt": "2020-10-16T12:30:18Z", "path": "docs/Support-multiple-reference-genomes.md", "diffHunk": "@@ -20,20 +20,4 @@ if your study is profiled by a reference geome other than a default genome value\n    ncbi.build=GRCh37\n    ucsc.build=hg19\n ```\n-* You can also overwrite default genome values by using the following options of the importer script. _**ucsc**_ and _**ncbi**_ are both required when importing a dataset profiled with a reference genome different from a default genome value listed in your portal properties file.\n-```\n-  -species SPECIES, --species SPECIES\n-                        species information (default: assumed human)\n-  -ucsc UCSC_BUILD_NAME, --ucsc_build_name UCSC_BUILD_NAME\n-                        UCSC reference genome assembly name (default: assumed\n-                        hg19)\n-  -ncbi NCBI_BUILD_NUMBER, --ncbi_build_number NCBI_BUILD_NUMBER\n-                        NCBI reference genome build number (default: assumed\n-                        GRCh37 for UCSC reference genome build hg19)\n-```\n-For instance, to load a hg38 dataset:\n-```\n-core/src/main/scripts/importer/metaImport.py  -s /path/to/your/study -jar scripts.jar -ucsc hg38 -ncbi GRCh38 -n -o\n-\n-```\n-\n+* You can also overwrite default genome values by using the following options of the importer script. For that, you have to specify the `reference_genome` field in the `meta_study.txt` file of your study.", "originalCommit": "860a0a2f85b997fcaf365d16fe4d9b3c47b14f92", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}