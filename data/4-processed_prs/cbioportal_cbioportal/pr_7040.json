{"pr_number": 7040, "pr_title": "Github action to test performance of genie private portal", "pr_createdAt": "2020-01-23T21:24:24Z", "pr_url": "https://github.com/cBioPortal/cbioportal/pull/7040", "timeline": [{"oid": "2f46ea97f921a9aae1d930f0b5d91f88d76e94bc", "url": "https://github.com/cBioPortal/cbioportal/commit/2f46ea97f921a9aae1d930f0b5d91f88d76e94bc", "message": "Added Github action genie-performance-test.yml\n- Tests genie-private POST /api/mutated-genes/fetch endpoint\n- Fails if:\n  1) curl returns a non-zero exit code\n  2) request returns a response code other than 200\n- On failure or success sends a message to slack\n- Runs at 3am EST\n\nCo-authored by: Robert Sheridan <7747489+sheridancbio@users.noreply.github.com>\nCo-authored by: Avery Wang <18199796+averyniceday@users.noreply.github.com>", "committedDate": "2020-01-23T21:11:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDM2NDkxNA==", "url": "https://github.com/cBioPortal/cbioportal/pull/7040#discussion_r370364914", "bodyText": "nice! so cool! I love that it's easy to see in code where to sign up for this alert. One question: is this channel private? I can't seem to join - maybe ok if this channel is public?", "author": "inodb", "createdAt": "2020-01-23T21:30:45Z", "path": ".github/workflows/genie-performance-test.yml", "diffHunk": "@@ -0,0 +1,44 @@\n+name: genie-performance-test\n+\n+on:\n+  schedule:\n+    - cron:  '0 8 * * *'\n+\n+jobs:\n+  probe-genie-endpoint:\n+    \n+    name: Genie private endpoint probe\n+\n+    runs-on: ubuntu-latest\n+    \n+    env:\n+      SLACK_URL_SECRET: ${{ secrets.SLACK_URL_SECRET }}\n+      SLACK_CHANNEL: backend-performance-status ", "originalCommit": "2f46ea97f921a9aae1d930f0b5d91f88d76e94bc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDM2NzUxMA==", "url": "https://github.com/cBioPortal/cbioportal/pull/7040#discussion_r370367510", "bodyText": "@mandawilson Nice! Would it be possible to also log the time the response took somewhere? Maybe it can be sent both to stdout and to the slack channel? That way even if it maybe doesn't go over the threshold we would have some idea of whether response time has changed over time.", "author": "inodb", "createdAt": "2020-01-23T21:36:12Z", "path": ".github/workflows/genie-performance-test.yml", "diffHunk": "@@ -0,0 +1,44 @@\n+name: genie-performance-test\n+\n+on:\n+  schedule:\n+    - cron:  '0 8 * * *'\n+\n+jobs:\n+  probe-genie-endpoint:\n+    \n+    name: Genie private endpoint probe\n+\n+    runs-on: ubuntu-latest\n+    \n+    env:\n+      SLACK_URL_SECRET: ${{ secrets.SLACK_URL_SECRET }}\n+      SLACK_CHANNEL: backend-performance-status \n+\n+    steps:\n+    - name: GET request to genie private page\n+      env:\n+        GENIE_DATA_ACCESS_TOKEN_SECRET: ${{ secrets.GENIE_DATA_ACCESS_TOKEN_SECRET }}\n+        MAX_WAIT_TIME_IN_SECONDS: 300\n+        URL: \"https://genie-private.cbioportal.org/api/mutated-genes/fetch\"\n+        OK_RESPONSE_CODE: 200\n+      # GET request to URL with a MAX_WAIT_TIME_IN_SECONDS second limit\n+      #   if curl fails, automatically exit with curl's non-zero exit code\n+      #   else if we did not get a OK_RESPONSE_CODE exit with a non-zero exit code\n+      #   else we are OK!\n+      run: |\n+        curl --max-time $MAX_WAIT_TIME_IN_SECONDS -s -o /dev/null -w \"%{http_code}\" -X POST -H \"Authorization:Bearer $GENIE_DATA_ACCESS_TOKEN_SECRET\" \"$URL\" -H \"accept:application/json\" -H \"Content-Type:application/json\" -d \"{\\\"studyIds\\\":[\\\"genie_private\\\"]}\" > curl.out", "originalCommit": "2f46ea97f921a9aae1d930f0b5d91f88d76e94bc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTM3ODUwNw==", "url": "https://github.com/cBioPortal/cbioportal/pull/7040#discussion_r371378507", "bodyText": "Maybe this is ok just to get the test in place ... but I think the max wait time in seconds for the mutated-genes fetch should be something like 5-10 seconds", "author": "sheridancbio", "createdAt": "2020-01-27T17:29:11Z", "path": ".github/workflows/genie-performance-test.yml", "diffHunk": "@@ -0,0 +1,44 @@\n+name: genie-performance-test\n+\n+on:\n+  schedule:\n+    - cron:  '0 8 * * *'\n+\n+jobs:\n+  probe-genie-endpoint:\n+    \n+    name: Genie private endpoint probe\n+\n+    runs-on: ubuntu-latest\n+    \n+    env:\n+      SLACK_URL_SECRET: ${{ secrets.SLACK_URL_SECRET }}\n+      SLACK_CHANNEL: backend-performance-status \n+\n+    steps:\n+    - name: GET request to genie private page\n+      env:\n+        GENIE_DATA_ACCESS_TOKEN_SECRET: ${{ secrets.GENIE_DATA_ACCESS_TOKEN_SECRET }}\n+        MAX_WAIT_TIME_IN_SECONDS: 300", "originalCommit": "2f46ea97f921a9aae1d930f0b5d91f88d76e94bc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTM3OTAzMQ==", "url": "https://github.com/cBioPortal/cbioportal/pull/7040#discussion_r371379031", "bodyText": "maybe add : rm curl.out  (or better : rm $CURL_OUTPUT_FILENAME)\nI'm not sure where this is running though --- if it is an ephemeral circle-ci kind of machine, maybe cleanup is unnecessary.", "author": "sheridancbio", "createdAt": "2020-01-27T17:30:15Z", "path": ".github/workflows/genie-performance-test.yml", "diffHunk": "@@ -0,0 +1,44 @@\n+name: genie-performance-test\n+\n+on:\n+  schedule:\n+    - cron:  '0 8 * * *'\n+\n+jobs:\n+  probe-genie-endpoint:\n+    \n+    name: Genie private endpoint probe\n+\n+    runs-on: ubuntu-latest\n+    \n+    env:\n+      SLACK_URL_SECRET: ${{ secrets.SLACK_URL_SECRET }}\n+      SLACK_CHANNEL: backend-performance-status \n+\n+    steps:\n+    - name: GET request to genie private page\n+      env:\n+        GENIE_DATA_ACCESS_TOKEN_SECRET: ${{ secrets.GENIE_DATA_ACCESS_TOKEN_SECRET }}\n+        MAX_WAIT_TIME_IN_SECONDS: 300\n+        URL: \"https://genie-private.cbioportal.org/api/mutated-genes/fetch\"\n+        OK_RESPONSE_CODE: 200\n+      # GET request to URL with a MAX_WAIT_TIME_IN_SECONDS second limit\n+      #   if curl fails, automatically exit with curl's non-zero exit code\n+      #   else if we did not get a OK_RESPONSE_CODE exit with a non-zero exit code\n+      #   else we are OK!\n+      run: |\n+        curl --max-time $MAX_WAIT_TIME_IN_SECONDS -s -o /dev/null -w \"%{http_code}\" -X POST -H \"Authorization:Bearer $GENIE_DATA_ACCESS_TOKEN_SECRET\" \"$URL\" -H \"accept:application/json\" -H \"Content-Type:application/json\" -d \"{\\\"studyIds\\\":[\\\"genie_private\\\"]}\" > curl.out\n+        RESPONSE_CODE=`cat curl.out`\n+        if [ \"$RESPONSE_CODE\" != \"$OK_RESPONSE_CODE\" ]; then", "originalCommit": "2f46ea97f921a9aae1d930f0b5d91f88d76e94bc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTQxODI2NA==", "url": "https://github.com/cBioPortal/cbioportal/pull/7040#discussion_r371418264", "bodyText": "it's indeed ephemeral so cleanup is not really necessary", "author": "inodb", "createdAt": "2020-01-27T18:51:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTM3OTAzMQ=="}], "type": "inlineReview"}]}