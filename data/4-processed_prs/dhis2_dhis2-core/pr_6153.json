{"pr_number": 6153, "pr_title": "fix: [DHIS2-8588] handling division by ZERO error", "pr_createdAt": "2020-09-15T12:30:31Z", "pr_url": "https://github.com/dhis2/dhis2-core/pull/6153", "timeline": [{"oid": "6e626a073b90445069a6a20b093cbab4f9671206", "url": "https://github.com/dhis2/dhis2-core/commit/6e626a073b90445069a6a20b093cbab4f9671206", "message": "fix: [DHIS2-8588] handling division by ZERO error\n\nSome data elements, which are not compulsory are returned as NULL values for this query. So, when converting to ZERO, we can face a division by ZERO error. This happens in cases when we have a division operation in the formula and the denominator is set to ZERO (for the cases when they are NULL).", "committedDate": "2020-09-15T12:28:32Z", "type": "commit"}, {"oid": "25b95a6680c91167f9b1a8391a421af7cb678dec", "url": "https://github.com/dhis2/dhis2-core/commit/25b95a6680c91167f9b1a8391a421af7cb678dec", "message": "fix: [DHIS2-8588] Code formatting", "committedDate": "2020-09-15T12:36:50Z", "type": "commit"}, {"oid": "d7e3c1d3a8b917e496d9483877bb7b4ca66b9811", "url": "https://github.com/dhis2/dhis2-core/commit/d7e3c1d3a8b917e496d9483877bb7b4ca66b9811", "message": "fix: [DHIS2-8588] Code formatting", "committedDate": "2020-09-15T12:45:42Z", "type": "commit"}, {"oid": "4d7d643c62000f85b32aefde1e961b88333cd84c", "url": "https://github.com/dhis2/dhis2-core/commit/4d7d643c62000f85b32aefde1e961b88333cd84c", "message": "fix: [DHIS2-8588] Sonarqube issue", "committedDate": "2020-09-15T13:36:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODcwNzA3Nw==", "url": "https://github.com/dhis2/dhis2-core/pull/6153#discussion_r488707077", "bodyText": "Could be this Exception Handler be moved at the CrudControllerAdvice level? The CrudControllerAdvice is annotated with @ControllerAdvice and it is applied to all the controllers in the system.\nI'm just thinking here that perhaps this handler is very specific to ANalytics, so it's better to keep it separated from the global exception handling strategy.\nIn any case, I would perhaps make the ExceptionHandler class its own class, which could be perhaps applied to all *AnalyticsManager in the system.", "author": "luciano-fiandesio", "createdAt": "2020-09-15T14:20:44Z", "path": "dhis-2/dhis-services/dhis-service-analytics/src/main/java/org/hisp/dhis/analytics/event/data/JdbcEventAnalyticsManager.java", "diffHunk": "@@ -628,4 +672,26 @@ private String resolveCoordinateFieldColumnName( String coordinateField, EventQu\n         }\n         return coordinateField;\n     }\n+\n+    protected static class ExceptionHandler", "originalCommit": "4d7d643c62000f85b32aefde1e961b88333cd84c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODcxMTA5OQ==", "url": "https://github.com/dhis2/dhis2-core/pull/6153#discussion_r488711099", "bodyText": "Hey @luciano-fiandesio,\nthis method is just deciding which exception should be thrown. It's very specific to this situation.\nOnce the exception is thrown, it will be handled by the CrudControllerAdvice:\n@ExceptionHandler( QueryRuntimeException.class ) public void queryRuntimeExceptionHandler( QueryRuntimeException ex, HttpServletResponse response, HttpServletRequest request ) { webMessageService.send( WebMessageUtils.conflict( ex.getMessage(), ex.getErrorCode() ), response, request ); }", "author": "maikelarabori", "createdAt": "2020-09-15T14:25:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODcwNzA3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODcxMjc3NQ==", "url": "https://github.com/dhis2/dhis2-core/pull/6153#discussion_r488712775", "bodyText": "Regarding the second point, this is could be done. But would require a great amount of refactoring. I would say we can create a task for it if you guys agree, and we can tackle as part of another PR.\nWhat do you think?", "author": "maikelarabori", "createdAt": "2020-09-15T14:27:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODcwNzA3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDA5MzQ2OQ==", "url": "https://github.com/dhis2/dhis2-core/pull/6153#discussion_r494093469", "bodyText": "This sounds like a task for a different issue/PR. I will merge this PR. @maikelarabori you can create a new issue for the second part of that comment and discuss further with Luciano :)", "author": "stian-sandvold", "createdAt": "2020-09-24T07:23:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODcwNzA3Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzUxODQ5Mg==", "url": "https://github.com/dhis2/dhis2-core/pull/6153#discussion_r493518492", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public JdbcEventAnalyticsManager(JdbcTemplate jdbcTemplate, StatementBuilder statementBuilder,\n          \n          \n            \n                public JdbcEventAnalyticsManager( JdbcTemplate jdbcTemplate, StatementBuilder statementBuilder,", "author": "stian-sandvold", "createdAt": "2020-09-23T12:16:10Z", "path": "dhis-2/dhis-services/dhis-service-analytics/src/main/java/org/hisp/dhis/analytics/event/data/JdbcEventAnalyticsManager.java", "diffHunk": "@@ -102,10 +106,14 @@\n @Component( \"org.hisp.dhis.analytics.event.EventAnalyticsManager\" )\n public class JdbcEventAnalyticsManager\n     extends AbstractJdbcEventAnalyticsManager\n-        implements EventAnalyticsManager\n+    implements EventAnalyticsManager\n {\n-    public JdbcEventAnalyticsManager( JdbcTemplate jdbcTemplate, StatementBuilder statementBuilder,\n-        ProgramIndicatorService programIndicatorService, ProgramIndicatorSubqueryBuilder programIndicatorSubqueryBuilder )\n+\n+    private static final String OPEN_IN = \" in (\";\n+\n+    public JdbcEventAnalyticsManager(JdbcTemplate jdbcTemplate, StatementBuilder statementBuilder,", "originalCommit": "4d7d643c62000f85b32aefde1e961b88333cd84c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "4cc1a66fbb3c423901636ea2297ef185d4c2ee26", "url": "https://github.com/dhis2/dhis2-core/commit/4cc1a66fbb3c423901636ea2297ef185d4c2ee26", "message": "Update dhis-2/dhis-services/dhis-service-analytics/src/main/java/org/hisp/dhis/analytics/event/data/JdbcEventAnalyticsManager.java", "committedDate": "2020-09-23T12:17:59Z", "type": "commit"}]}