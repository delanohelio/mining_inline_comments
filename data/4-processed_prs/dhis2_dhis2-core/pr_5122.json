{"pr_number": 5122, "pr_title": "fix: upgradescript to handle a change in the key column", "pr_createdAt": "2020-03-17T15:07:18Z", "pr_url": "https://github.com/dhis2/dhis2-core/pull/5122", "timeline": [{"oid": "f58ba56cb5070b2fa926f9d405a406ef600109de", "url": "https://github.com/dhis2/dhis2-core/commit/f58ba56cb5070b2fa926f9d405a406ef600109de", "message": "Add upgradescript to handle a change in the key column", "committedDate": "2020-03-17T15:03:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc1MzA1NQ==", "url": "https://github.com/dhis2/dhis2-core/pull/5122#discussion_r393753055", "bodyText": "Hey, is there also more advanced patterns that we need to support, where SEQUENTIAL() is only part of the pattern?", "author": "Bekkalizer", "createdAt": "2020-03-17T15:13:11Z", "path": "dhis-2/dhis-support/dhis-support-db-migration/src/main/resources/org/hisp/dhis/db/migration/2.31/V2_31_23_Upgrade_sequential_nuber_counter_key.sql", "diffHunk": "@@ -0,0 +1 @@\n+UPDATE sequentialnumbercounter SET key = substring(key, 12, (length(key)-12)) WHERE key LIKE 'SEQUENTIAL(%)';", "originalCommit": "f58ba56cb5070b2fa926f9d405a406ef600109de", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc5MTM2Nw==", "url": "https://github.com/dhis2/dhis2-core/pull/5122#discussion_r393791367", "bodyText": "So, had a call with Stian. We figured out that the above fix os OK. An example pattern of BETA-SEQUENTIAL(###) would be stored differently in 2.30, 2.31, 2.32 and beyond.\nFor 2.30, the sequential part of a pattern is always stored as SEQUENTIAL(###) in the counter table.\nFor 2.31, the sequential part of a pattern is always stored as ### in the counter table.\nFor 2.32 and beyond, the entire pattern is stored in the counter table: BETA-###\nThis PR only takes care of upgrades between 2.30 and 2.31. We will make another PR for upgrades to 2.32 and beyond.", "author": "Bekkalizer", "createdAt": "2020-03-17T16:03:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc1MzA1NQ=="}], "type": "inlineReview"}]}