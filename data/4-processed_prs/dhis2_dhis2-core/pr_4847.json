{"pr_number": 4847, "pr_title": "ci: Test multiple docker images", "pr_createdAt": "2020-02-10T13:48:48Z", "pr_url": "https://github.com/dhis2/dhis2-core/pull/4847", "timeline": [{"oid": "5903c9bc54e3fc37b33a4ac3a7549127768239ba", "url": "https://github.com/dhis2/dhis2-core/commit/5903c9bc54e3fc37b33a4ac3a7549127768239ba", "message": "ci: adding matrix for docker-variants to run tests with", "committedDate": "2020-02-10T10:17:22Z", "type": "commit"}, {"oid": "d54c2d6f7296afd75fb32280be39b7381a54f5a0", "url": "https://github.com/dhis2/dhis2-core/commit/d54c2d6f7296afd75fb32280be39b7381a54f5a0", "message": "temp: removing publish and post failure to test this on jenkins", "committedDate": "2020-02-10T10:17:55Z", "type": "commit"}, {"oid": "4479c4d83f7fd81ea162033aff0a212bc8f4c988", "url": "https://github.com/dhis2/dhis2-core/commit/4479c4d83f7fd81ea162033aff0a212bc8f4c988", "message": "fix: stages inside matrix", "committedDate": "2020-02-10T10:33:33Z", "type": "commit"}, {"oid": "53aa35d0853bce397afdd2742a50f2d5c5df65c0", "url": "https://github.com/dhis2/dhis2-core/commit/53aa35d0853bce397afdd2742a50f2d5c5df65c0", "message": "fix: post inside stage", "committedDate": "2020-02-10T10:39:39Z", "type": "commit"}, {"oid": "a0b38b3245b20894ebf08f3febb8d916de230763", "url": "https://github.com/dhis2/dhis2-core/commit/a0b38b3245b20894ebf08f3febb8d916de230763", "message": "fix: adding script block", "committedDate": "2020-02-10T10:46:39Z", "type": "commit"}, {"oid": "652e024c07950b94d5aed162af0bb8ffa1605f60", "url": "https://github.com/dhis2/dhis2-core/commit/652e024c07950b94d5aed162af0bb8ffa1605f60", "message": "fix: steps block", "committedDate": "2020-02-10T10:53:02Z", "type": "commit"}, {"oid": "e1573da915c32247b40d94f3d3a1ef5460fb7230", "url": "https://github.com/dhis2/dhis2-core/commit/e1573da915c32247b40d94f3d3a1ef5460fb7230", "message": "temp: changing the image name", "committedDate": "2020-02-10T10:55:06Z", "type": "commit"}, {"oid": "19053bcf5fec9937eb40acc7ff0ad7056ab718a3", "url": "https://github.com/dhis2/dhis2-core/commit/19053bcf5fec9937eb40acc7ff0ad7056ab718a3", "message": "fix: removing redundant \"", "committedDate": "2020-02-10T11:45:46Z", "type": "commit"}, {"oid": "beb64c69e32659c06890125295526ab3a090cabc", "url": "https://github.com/dhis2/dhis2-core/commit/beb64c69e32659c06890125295526ab3a090cabc", "message": "Merge branch 'master' into ci/parallel-test-runs", "committedDate": "2020-02-10T12:11:02Z", "type": "commit"}, {"oid": "b3bac1e7c806729078d71fcd135d307bd6ff123e", "url": "https://github.com/dhis2/dhis2-core/commit/b3bac1e7c806729078d71fcd135d307bd6ff123e", "message": "fix: adding default docker variant", "committedDate": "2020-02-10T12:30:56Z", "type": "commit"}, {"oid": "565fd8a93e1be11f86e93407bc1cf57980a80757", "url": "https://github.com/dhis2/dhis2-core/commit/565fd8a93e1be11f86e93407bc1cf57980a80757", "message": "ci: moving post always stage", "committedDate": "2020-02-10T12:54:58Z", "type": "commit"}, {"oid": "e5d918c3f352cbea89fda57dee4c574b1d491767", "url": "https://github.com/dhis2/dhis2-core/commit/e5d918c3f352cbea89fda57dee4c574b1d491767", "message": "fix: docker_variant var", "committedDate": "2020-02-10T13:07:59Z", "type": "commit"}, {"oid": "79af259c655323f39dec89888486057ddad75b50", "url": "https://github.com/dhis2/dhis2-core/commit/79af259c655323f39dec89888486057ddad75b50", "message": "fix: docker_var", "committedDate": "2020-02-10T13:22:30Z", "type": "commit"}, {"oid": "99975ec22f521d2dc50dd0eb920a589914135b73", "url": "https://github.com/dhis2/dhis2-core/commit/99975ec22f521d2dc50dd0eb920a589914135b73", "message": "fix: cleanup", "committedDate": "2020-02-10T13:35:31Z", "type": "commit"}, {"oid": "b804c38de1d7c8031b2f61b3ad7e1e9e3addf320", "url": "https://github.com/dhis2/dhis2-core/commit/b804c38de1d7c8031b2f61b3ad7e1e9e3addf320", "message": "fix: revert temporarily removed stages", "committedDate": "2020-02-10T13:42:42Z", "type": "commit"}, {"oid": "f3ebad5e68e4264df510da44fc7ed5eef9caf8a1", "url": "https://github.com/dhis2/dhis2-core/commit/f3ebad5e68e4264df510da44fc7ed5eef9caf8a1", "message": "fix: empty lines", "committedDate": "2020-02-10T13:43:39Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjU0MDIwNw==", "url": "https://github.com/dhis2/dhis2-core/pull/4847#discussion_r382540207", "bodyText": "Not sure if we can pull it off, but it would be nice if we have a single place where we source the variants we build for both this file, and the containers defined in: https://github.com/dhis2/dhis2-core/blob/master/docker/shared/containers-list.sh#L26-L42\nMaking sure our container versions are up-to-date is currently something that we don't track super-well, and we are opening ourselves up for more complications when we hardcode them in multiple places.", "author": "varl", "createdAt": "2020-02-21T11:48:29Z", "path": "Jenkinsfile-publish-image", "diffHunk": "@@ -83,32 +83,55 @@ pipeline {\n             }\n         }\n \n-        stage('Start instance') {\n-            steps {\n-                dir(\"dhis-2/dhis-e2e-test\") {\n-                    sh \"IMAGE_NAME=${DOCKER_CORE_IMAGE_FULL_NAME} docker-compose -p ${COMPOSE_PARAMETER} up -d\"\n-                }\n-            }\n-        }\n-\n         stage('Run api tests') {\n-            steps {\n-                script {\n-                    TESTS_IMAGE_FULL_NAME = \"core-api-tests:${DOCKER_IMAGE_TAG}\"\n-\n-                    dir(\"dhis-2/dhis-e2e-test\") {\n-                        sh \"docker build -t ${TESTS_IMAGE_FULL_NAME} .\"\n-                        sh \"IMAGE_NAME=${TESTS_IMAGE_FULL_NAME} docker-compose -p ${COMPOSE_PARAMETER} -f docker-compose.e2e.yml up --exit-code-from e2e-test\"\n+            matrix {\n+                axes {\n+                    axis {\n+                        name 'DOCKER_VARIANT'\n+                        values '-tomcat-8.5-jdk8-openjdk-slim', '-tomcat-9.0.27-jdk11-openjdk-slim'", "originalCommit": "f3ebad5e68e4264df510da44fc7ed5eef9caf8a1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}