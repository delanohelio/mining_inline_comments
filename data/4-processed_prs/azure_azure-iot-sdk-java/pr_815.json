{"pr_number": 815, "pr_title": "feat(iot-service): Add support for setting http read and connect timeouts for registry manager operations", "pr_createdAt": "2020-06-18T18:51:35Z", "pr_url": "https://github.com/Azure/azure-iot-sdk-java/pull/815", "timeline": [{"oid": "aa0a0fed55c752e92784ef65bb40401e2c0e50d1", "url": "https://github.com/Azure/azure-iot-sdk-java/commit/aa0a0fed55c752e92784ef65bb40401e2c0e50d1", "message": "feat(iot-service): Add support for setting http read and connect timeouts for registry manager operations", "committedDate": "2020-06-18T18:44:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQzNTQ2Ng==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/815#discussion_r442435466", "bodyText": "TODO?", "author": "abhipsaMisra", "createdAt": "2020-06-18T18:54:22Z", "path": "service/iot-service-client/src/main/java/com/microsoft/azure/sdk/iot/service/RegistryManager.java", "diffHunk": "@@ -582,9 +589,7 @@ private void removeDeviceOperation(String deviceId, String etag) throws IOExcept\n         String sasToken = new IotHubServiceSasToken(this.iotHubConnectionString).toString();\n \n         // Codes_SRS_SERVICE_SDK_JAVA_REGISTRYMANAGER_12_049: [The function shall create a new HttpRequest for removing the device from IotHub]\n-        HttpRequest request = new HttpRequest(url, HttpMethod.DELETE, new byte[0]);\n-        request.setReadTimeoutMillis(DEFAULT_HTTP_TIMEOUT_MS);\n-        request.setHeaderField(\"authorization\", sasToken);\n+        HttpRequest request = CreateRequest(url, HttpMethod.DELETE, new byte[0], sasToken); //TODO", "originalCommit": "aa0a0fed55c752e92784ef65bb40401e2c0e50d1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQzNTcxOA==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/815#discussion_r442435718", "bodyText": "good catch, I'll delete this", "author": "timtay-microsoft", "createdAt": "2020-06-18T18:54:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQzNTQ2Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQzNTk0NA==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/815#discussion_r442435944", "bodyText": "why infinite connect timeout?", "author": "abhipsaMisra", "createdAt": "2020-06-18T18:55:12Z", "path": "service/iot-service-client/src/main/java/com/microsoft/azure/sdk/iot/service/RegistryManagerOptions.java", "diffHunk": "@@ -9,9 +9,18 @@\n @Builder\n public class RegistryManagerOptions\n {\n+    protected static final Integer DEFAULT_HTTP_READ_TIMEOUT_MS = 24000; // 24 seconds\n+    protected static final Integer DEFAULT_HTTP_CONNECT_TIMEOUT_MS = 0; // infinite", "originalCommit": "aa0a0fed55c752e92784ef65bb40401e2c0e50d1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQzOTI2NQ==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/815#discussion_r442439265", "bodyText": "This was the default behavior since the SDK never set an http connect timeout before.", "author": "timtay-microsoft", "createdAt": "2020-06-18T19:00:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQzNTk0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQ0MDIzNg==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/815#discussion_r442440236", "bodyText": "By default, http connections in java have no read or connect timeouts. However, our SDK did manually set the read timeout to 24 seconds. This PR doesn't change the default behavior of the SDK", "author": "timtay-microsoft", "createdAt": "2020-06-18T19:02:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQzNTk0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQ0ODYxNQ==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/815#discussion_r442448615", "bodyText": "Sure, but should the SDK set a timeout value for http connect? If the http connection cannot be established (network issue/ proxy hasn't been set up etc), then when would this actually time out and throw an exception? Would we rely on the TCP layer underneath throwing an exception (which can take minutes)?", "author": "abhipsaMisra", "createdAt": "2020-06-18T19:19:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQzNTk0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQ1MjQ5MA==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/815#discussion_r442452490", "bodyText": "One could argue it wouldn't be a breaking change to start adding connect timeouts by default. The same exception would be thrown for a connect timeout as a read timeout. The only difference is the exception message. I'll add the same default of 24 seconds for the connect timeout", "author": "timtay-microsoft", "createdAt": "2020-06-18T19:27:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQzNTk0NA=="}], "type": "inlineReview"}, {"oid": "7249f1521132b70bba6202ac4024641c3c0266e9", "url": "https://github.com/Azure/azure-iot-sdk-java/commit/7249f1521132b70bba6202ac4024641c3c0266e9", "message": "cr comments", "committedDate": "2020-06-18T18:55:16Z", "type": "commit"}, {"oid": "e9e3fabfdc4f78e59b2a0274e76c5f89aa4328aa", "url": "https://github.com/Azure/azure-iot-sdk-java/commit/e9e3fabfdc4f78e59b2a0274e76c5f89aa4328aa", "message": "cr comments", "committedDate": "2020-06-18T19:01:52Z", "type": "commit"}, {"oid": "bcf664a08152f46ef240e8a56061a7a2375756f6", "url": "https://github.com/Azure/azure-iot-sdk-java/commit/bcf664a08152f46ef240e8a56061a7a2375756f6", "message": "set default connect timeout to 24 seconds, too", "committedDate": "2020-06-18T19:35:07Z", "type": "commit"}]}