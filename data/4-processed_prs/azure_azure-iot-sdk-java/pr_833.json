{"pr_number": 833, "pr_title": "fix(prov-dev, prov-serv): Fix provisioning clients not sending content length with http requests", "pr_createdAt": "2020-07-02T18:06:03Z", "pr_url": "https://github.com/Azure/azure-iot-sdk-java/pull/833", "timeline": [{"oid": "deb0b5298f57fac20d3b448753b870c3138a3ee3", "url": "https://github.com/Azure/azure-iot-sdk-java/commit/deb0b5298f57fac20d3b448753b870c3138a3ee3", "message": "fix(prov-dev, prov-serv): Fix provisioning clients not sending content length with http requests\n\nDPS would occasionally return a 411 error because this wasn't being sent", "committedDate": "2020-07-02T18:04:53Z", "type": "commit"}, {"oid": "3c97bd109e7ac751f49dccfe75821b1f67e3726e", "url": "https://github.com/Azure/azure-iot-sdk-java/commit/3c97bd109e7ac751f49dccfe75821b1f67e3726e", "message": "Merge branch 'master' into timtay/provisioningTest", "committedDate": "2020-07-06T17:13:19Z", "type": "commit"}, {"oid": "ac167e9bd72ce78c0dcd4241e04ff1d48642956d", "url": "https://github.com/Azure/azure-iot-sdk-java/commit/ac167e9bd72ce78c0dcd4241e04ff1d48642956d", "message": "Merge branch 'master' into timtay/provisioningTest", "committedDate": "2020-07-06T20:10:02Z", "type": "commit"}, {"oid": "7f0d0916ce33a93d45d68415b1924907aa52d2ba", "url": "https://github.com/Azure/azure-iot-sdk-java/commit/7f0d0916ce33a93d45d68415b1924907aa52d2ba", "message": "Merge branch 'master' into timtay/provisioningTest", "committedDate": "2020-07-07T00:56:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDU2MTQ1OQ==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/833#discussion_r450561459", "bodyText": "If this is not a hard requirement, why was it throwing failure only occasionally?", "author": "bikamani", "createdAt": "2020-07-07T01:27:33Z", "path": "provisioning/provisioning-service-client/src/main/java/com/microsoft/azure/sdk/iot/provisioning/service/contract/ContractApiHttp.java", "diffHunk": "@@ -183,6 +184,7 @@ private HttpRequest createRequest(URL url, HttpMethod method, Map<String, String\n         request.setHeaderField(HEADER_FIELD_NAME_ACCEPT, HEADER_FIELD_VALUE_ACCEPT);\n         request.setHeaderField(HEADER_FIELD_NAME_CONTENT_TYPE, HEADER_FIELD_VALUE_CONTENT_TYPE);\n         request.setHeaderField(HEADER_FIELD_NAME_CHARSET, HEADER_FIELD_VALUE_CHARSET);\n+        request.setHeaderField(HEADER_FIELD_NAME_CONTENT_LENGTH, payload != null ? String.valueOf(payload.length) : \"0\");", "originalCommit": "7f0d0916ce33a93d45d68415b1924907aa52d2ba", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDk3NTg4OA==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/833#discussion_r450975888", "bodyText": "I'm not sure. Service folks didn't answer me when I asked if it was a hard requirement. This seems like a safe change to make regardless, though", "author": "timtay-microsoft", "createdAt": "2020-07-07T16:02:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDU2MTQ1OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDU2MTc4Nw==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/833#discussion_r450561787", "bodyText": "Do we not have any e2e tests for this change?", "author": "bikamani", "createdAt": "2020-07-07T01:28:58Z", "path": "provisioning/provisioning-device-client/src/main/java/com/microsoft/azure/sdk/iot/provisioning/device/internal/contract/http/ContractAPIHttp.java", "diffHunk": "@@ -126,6 +127,7 @@ private HttpRequest prepareRequest(\n         request.setHeaderField(USER_AGENT, userAgentValue);\n         request.setHeaderField(ACCEPT, ACCEPT_VALUE);\n         request.setHeaderField(CONTENT_TYPE, ACCEPT_VALUE + \"; \" + ACCEPT_CHARSET);\n+        request.setHeaderField(CONTENT_LENGTH, payload != null ? String.valueOf(payload.length) : \"0\");", "originalCommit": "7f0d0916ce33a93d45d68415b1924907aa52d2ba", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDk3NTQ1NQ==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/833#discussion_r450975455", "bodyText": "Our e2e tests already hit both the device and service side of this change. The fact that I've stopped seeing those 411 errors is about as close as I can get to verifying that this works.", "author": "timtay-microsoft", "createdAt": "2020-07-07T16:01:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDU2MTc4Nw=="}], "type": "inlineReview"}]}