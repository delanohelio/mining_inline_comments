{"pr_number": 702, "pr_title": "refactor(e2e): Adjust timing in token renewal tests", "pr_createdAt": "2020-02-06T20:32:21Z", "pr_url": "https://github.com/Azure/azure-iot-sdk-java/pull/702", "timeline": [{"oid": "161815f6f8df0d603229e34f6ebcd80f1aa55a67", "url": "https://github.com/Azure/azure-iot-sdk-java/commit/161815f6f8df0d603229e34f6ebcd80f1aa55a67", "message": "refactor(e2e): Adjust timing in token renewal tests\n\ntest sometimes fails with case that mqtt connection never lost connection to hub. This implied that the test didn't wait long enough before checking that the grace period had ended. Adding more buffer time to ensure that the grace period ends before we check that mqtt connection was lost", "committedDate": "2020-02-06T20:31:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjA3Mjg0NQ==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/702#discussion_r376072845", "bodyText": "Is the comment below up to date? Is it 5 minute or 10 minutes?", "author": "bikamani", "createdAt": "2020-02-06T20:46:47Z", "path": "iot-e2e-tests/common/src/main/java/com/microsoft/azure/sdk/iot/common/tests/iothub/TokenRenewalTests.java", "diffHunk": "@@ -75,9 +75,9 @@ public static void stopProxy()\n     @Test\n     public void tokenRenewalWorks() throws Exception\n     {\n-        final long SECONDS_FOR_SAS_TOKEN_TO_LIVE_BEFORE_RENEWAL = 60;\n-        final long EXPIRED_SAS_TOKEN_GRACE_PERIOD_SECONDS = 600;\n-        final long EXTRA_BUFFER_TO_ENSURE_TOKEN_EXPIRED_SECONDS = 30;\n+        final long SECONDS_FOR_SAS_TOKEN_TO_LIVE_BEFORE_RENEWAL = 30;\n+        final long EXPIRED_SAS_TOKEN_GRACE_PERIOD_SECONDS = 600; //service extends 10 minute grace period after a token has expired\n+        final long EXTRA_BUFFER_TO_ENSURE_TOKEN_EXPIRED_SECONDS = 120; //wait time beyond the expected grace period, just in case\n \n         List<InternalClient> clients = createClientsToTest();\n ", "originalCommit": "161815f6f8df0d603229e34f6ebcd80f1aa55a67", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjA5MDg5OQ==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/702#discussion_r376090899", "bodyText": "The below comment is wrong, I'll update it. It should be 10", "author": "timtay-microsoft", "createdAt": "2020-02-06T21:26:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjA3Mjg0NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjA3MzAxMg==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/702#discussion_r376073012", "bodyText": "so we need 2 extra minutes for the test to succeed?", "author": "bikamani", "createdAt": "2020-02-06T20:47:07Z", "path": "iot-e2e-tests/common/src/main/java/com/microsoft/azure/sdk/iot/common/tests/iothub/TokenRenewalTests.java", "diffHunk": "@@ -75,9 +75,9 @@ public static void stopProxy()\n     @Test\n     public void tokenRenewalWorks() throws Exception\n     {\n-        final long SECONDS_FOR_SAS_TOKEN_TO_LIVE_BEFORE_RENEWAL = 60;\n-        final long EXPIRED_SAS_TOKEN_GRACE_PERIOD_SECONDS = 600;\n-        final long EXTRA_BUFFER_TO_ENSURE_TOKEN_EXPIRED_SECONDS = 30;\n+        final long SECONDS_FOR_SAS_TOKEN_TO_LIVE_BEFORE_RENEWAL = 30;\n+        final long EXPIRED_SAS_TOKEN_GRACE_PERIOD_SECONDS = 600; //service extends 10 minute grace period after a token has expired\n+        final long EXTRA_BUFFER_TO_ENSURE_TOKEN_EXPIRED_SECONDS = 120; //wait time beyond the expected grace period, just in case", "originalCommit": "161815f6f8df0d603229e34f6ebcd80f1aa55a67", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjA5MTQ0Mw==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/702#discussion_r376091443", "bodyText": "Yes, this test needs to open a connection, let the first token expire, and then let the service grace period expire. Only after all of that will the test check things like that the MQTT connection was lost.", "author": "timtay-microsoft", "createdAt": "2020-02-06T21:27:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjA3MzAxMg=="}], "type": "inlineReview"}, {"oid": "99b49bb54f9d6ff0104902645e6f47bfd454ae6e", "url": "https://github.com/Azure/azure-iot-sdk-java/commit/99b49bb54f9d6ff0104902645e6f47bfd454ae6e", "message": "address cr comments", "committedDate": "2020-02-06T21:28:01Z", "type": "commit"}, {"oid": "bf3194642c99997c75c582e037dc36ac4a3884e9", "url": "https://github.com/Azure/azure-iot-sdk-java/commit/bf3194642c99997c75c582e037dc36ac4a3884e9", "message": "address cr part 2", "committedDate": "2020-02-06T21:30:39Z", "type": "commit"}]}