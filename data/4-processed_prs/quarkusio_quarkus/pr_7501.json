{"pr_number": 7501, "pr_title": "Quarkus recommended labels", "pr_createdAt": "2020-03-01T14:36:07Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/7501", "timeline": [{"oid": "bbf4603b2c75902abff1e7ec8073f45f07ce981b", "url": "https://github.com/quarkusio/quarkus/commit/bbf4603b2c75902abff1e7ec8073f45f07ce981b", "message": "doc: Align kubernetes.adoc with recent changes", "committedDate": "2020-03-01T14:39:24Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjExOTE5Mg==", "url": "https://github.com/quarkusio/quarkus/pull/7501#discussion_r386119192", "bodyText": "cusotmized -> customized", "author": "geoand", "createdAt": "2020-03-01T15:57:28Z", "path": "docs/src/main/asciidoc/kubernetes.adoc", "diffHunk": "@@ -113,85 +101,223 @@ The full source of the `kubernetes.json` file looks something like this:\n                 }\n               }\n             } ],\n-            \"image\" : \"yourDockerUsername/test-quarkus-app:1.0-SNAPSHOT\",\n+            \"image\" : \"yourDockerUsernmae/test-quarkus-app:1.0-SNAPSHOT\",\n             \"imagePullPolicy\" : \"IfNotPresent\",\n             \"name\" : \"test-quarkus-app\"\n           } ]\n         }\n       }\n     }\n-  } ]\n+  },\n+  {\n+  \"apiVersion\" : \"v1\",\n+  \"kind\" : \"Service\",\n+    \"metadata\" : {\n+      \"annotations\": {\n+       \"app.quarkus.io/vcs-url\" : \"<some url>\",\n+       \"app.quarkus.io/commit-id\" : \"<some git SHA>\",\n+      },\n+      \"labels\" : {\n+        \"app.kubernetes.io/name\" : \"test-quarkus-app\",\n+        \"app.kubernetes.io/version\" : \"1.0-SNAPSHOT\",\n+      },\n+      \"name\" : \"test-quarkus-app\"\n+    },\n+  \"spec\" : {\n+    \"ports\" : [ {\n+      \"name\" : \"http\",\n+      \"port\" : 8080,\n+      \"targetPort\" : 8080\n+    } ],\n+    \"selector\" : {\n+      \"app.kubernetes.io/name\" : \"test-quarkus-app\",\n+      \"app.kubernetes.io/version\" : \"1.0-SNAPSHOT\"\n+    },\n+    \"type\" : \"ClusterIP\"\n+  }\n+ }\n }\n ----\n \n An important thing to note about the `Deployment` is that is uses `yourDockerUsername/test-quarkus-app:1.0-SNAPSHOT` as the Docker image of the `Pod`.\n+The name of the image is controlled by the container-image extension and can be customized using the usual `applcation.properties`.\n \n-Also the `Service` is configured to use container port `8080` (which is automatically picked up by the standard Quarkus configuration).\n+For example with a configuration like:\n \n-=== Add readiness and liveness probes\n+[source]\n+----\n+quarkus.container-image.group=quarkus #optional, default to the system user name\n+quarkus.container-image.name=demo-app #optional, defaults to the application name\n+quarkus.container-image.tag=1.0       #optional, defaults to the application version\n+----\n \n-By default the Kubernetes resources do not contain readiness and liveness probes in the generated `Deployment`. Adding them however is just a matter of adding the Smallrye Health extension like so:\n+The image that will be used in the generated manifests will be `quarkus/demo-app:1.0`\n \n-[source,xml]\n+=== Defining a docker registry\n+\n+The docker registry can be specified, with the following property:\n+\n+[source]\n ----\n-    <dependency>\n-      <groupId>io.quarkus</groupId>\n-      <artifactId>quarkus-smallrye-health</artifactId>\n-    </dependency>\n+quarkus.container-image.registry=http://my.docker-registry.net\n ----\n \n-The values of the generated probes will be determined by the configured health properties: `quarkus.smallrye-health.root-path`, `quarkus.smallrye-health.liveness-path` and `quarkus.smallrye-health.readiness-path`.\n-More information about the health extension can be found in the relevant link:microprofile-health[guide].\n+By adding this property along the rest of the container-image properties of the previous section, the generated manifests will use the image `http://my.docker-registry.net/quarkus/demo-app:1.0`.\n \n-=== Using the Kubernetes client\n \n-Applications that are deployed to Kubernetes and need to access the API server, will usually make use of the `kubernetes-client` extension:\n+The image is not the only thing that can be cusotmized in the generated manifests. The kubernetes extension provides a rich set of configuration properties, that allow customization.", "originalCommit": "bbf4603b2c75902abff1e7ec8073f45f07ce981b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjIxNjY5Mw==", "url": "https://github.com/quarkusio/quarkus/pull/7501#discussion_r386216693", "bodyText": "This hasn't been fixed", "author": "geoand", "createdAt": "2020-03-02T06:34:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjExOTE5Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjExOTI2MA==", "url": "https://github.com/quarkusio/quarkus/pull/7501#discussion_r386119260", "bodyText": "generted -> generated", "author": "geoand", "createdAt": "2020-03-01T15:58:31Z", "path": "docs/src/main/asciidoc/kubernetes.adoc", "diffHunk": "@@ -113,85 +101,223 @@ The full source of the `kubernetes.json` file looks something like this:\n                 }\n               }\n             } ],\n-            \"image\" : \"yourDockerUsername/test-quarkus-app:1.0-SNAPSHOT\",\n+            \"image\" : \"yourDockerUsernmae/test-quarkus-app:1.0-SNAPSHOT\",\n             \"imagePullPolicy\" : \"IfNotPresent\",\n             \"name\" : \"test-quarkus-app\"\n           } ]\n         }\n       }\n     }\n-  } ]\n+  },\n+  {\n+  \"apiVersion\" : \"v1\",\n+  \"kind\" : \"Service\",\n+    \"metadata\" : {\n+      \"annotations\": {\n+       \"app.quarkus.io/vcs-url\" : \"<some url>\",\n+       \"app.quarkus.io/commit-id\" : \"<some git SHA>\",\n+      },\n+      \"labels\" : {\n+        \"app.kubernetes.io/name\" : \"test-quarkus-app\",\n+        \"app.kubernetes.io/version\" : \"1.0-SNAPSHOT\",\n+      },\n+      \"name\" : \"test-quarkus-app\"\n+    },\n+  \"spec\" : {\n+    \"ports\" : [ {\n+      \"name\" : \"http\",\n+      \"port\" : 8080,\n+      \"targetPort\" : 8080\n+    } ],\n+    \"selector\" : {\n+      \"app.kubernetes.io/name\" : \"test-quarkus-app\",\n+      \"app.kubernetes.io/version\" : \"1.0-SNAPSHOT\"\n+    },\n+    \"type\" : \"ClusterIP\"\n+  }\n+ }\n }\n ----\n \n An important thing to note about the `Deployment` is that is uses `yourDockerUsername/test-quarkus-app:1.0-SNAPSHOT` as the Docker image of the `Pod`.\n+The name of the image is controlled by the container-image extension and can be customized using the usual `applcation.properties`.\n \n-Also the `Service` is configured to use container port `8080` (which is automatically picked up by the standard Quarkus configuration).\n+For example with a configuration like:\n \n-=== Add readiness and liveness probes\n+[source]\n+----\n+quarkus.container-image.group=quarkus #optional, default to the system user name\n+quarkus.container-image.name=demo-app #optional, defaults to the application name\n+quarkus.container-image.tag=1.0       #optional, defaults to the application version\n+----\n \n-By default the Kubernetes resources do not contain readiness and liveness probes in the generated `Deployment`. Adding them however is just a matter of adding the Smallrye Health extension like so:\n+The image that will be used in the generated manifests will be `quarkus/demo-app:1.0`\n \n-[source,xml]\n+=== Defining a docker registry\n+\n+The docker registry can be specified, with the following property:\n+\n+[source]\n ----\n-    <dependency>\n-      <groupId>io.quarkus</groupId>\n-      <artifactId>quarkus-smallrye-health</artifactId>\n-    </dependency>\n+quarkus.container-image.registry=http://my.docker-registry.net\n ----\n \n-The values of the generated probes will be determined by the configured health properties: `quarkus.smallrye-health.root-path`, `quarkus.smallrye-health.liveness-path` and `quarkus.smallrye-health.readiness-path`.\n-More information about the health extension can be found in the relevant link:microprofile-health[guide].\n+By adding this property along the rest of the container-image properties of the previous section, the generated manifests will use the image `http://my.docker-registry.net/quarkus/demo-app:1.0`.\n \n-=== Using the Kubernetes client\n \n-Applications that are deployed to Kubernetes and need to access the API server, will usually make use of the `kubernetes-client` extension:\n+The image is not the only thing that can be cusotmized in the generated manifests. The kubernetes extension provides a rich set of configuration properties, that allow customization.\n \n-[source,xml]\n+=== Labels and Annotations\n+\n+==== Labels\n+\n+The generted manifests use the Kubernetes link:https://kubernetes.io/docs/concepts/overview/working-with-objects/common-labels[recommended labels].", "originalCommit": "bbf4603b2c75902abff1e7ec8073f45f07ce981b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjExOTM0Mg==", "url": "https://github.com/quarkusio/quarkus/pull/7501#discussion_r386119342", "bodyText": "addtiinal -> additional", "author": "geoand", "createdAt": "2020-03-01T16:00:14Z", "path": "docs/src/main/asciidoc/kubernetes.adoc", "diffHunk": "@@ -113,85 +101,223 @@ The full source of the `kubernetes.json` file looks something like this:\n                 }\n               }\n             } ],\n-            \"image\" : \"yourDockerUsername/test-quarkus-app:1.0-SNAPSHOT\",\n+            \"image\" : \"yourDockerUsernmae/test-quarkus-app:1.0-SNAPSHOT\",\n             \"imagePullPolicy\" : \"IfNotPresent\",\n             \"name\" : \"test-quarkus-app\"\n           } ]\n         }\n       }\n     }\n-  } ]\n+  },\n+  {\n+  \"apiVersion\" : \"v1\",\n+  \"kind\" : \"Service\",\n+    \"metadata\" : {\n+      \"annotations\": {\n+       \"app.quarkus.io/vcs-url\" : \"<some url>\",\n+       \"app.quarkus.io/commit-id\" : \"<some git SHA>\",\n+      },\n+      \"labels\" : {\n+        \"app.kubernetes.io/name\" : \"test-quarkus-app\",\n+        \"app.kubernetes.io/version\" : \"1.0-SNAPSHOT\",\n+      },\n+      \"name\" : \"test-quarkus-app\"\n+    },\n+  \"spec\" : {\n+    \"ports\" : [ {\n+      \"name\" : \"http\",\n+      \"port\" : 8080,\n+      \"targetPort\" : 8080\n+    } ],\n+    \"selector\" : {\n+      \"app.kubernetes.io/name\" : \"test-quarkus-app\",\n+      \"app.kubernetes.io/version\" : \"1.0-SNAPSHOT\"\n+    },\n+    \"type\" : \"ClusterIP\"\n+  }\n+ }\n }\n ----\n \n An important thing to note about the `Deployment` is that is uses `yourDockerUsername/test-quarkus-app:1.0-SNAPSHOT` as the Docker image of the `Pod`.\n+The name of the image is controlled by the container-image extension and can be customized using the usual `applcation.properties`.\n \n-Also the `Service` is configured to use container port `8080` (which is automatically picked up by the standard Quarkus configuration).\n+For example with a configuration like:\n \n-=== Add readiness and liveness probes\n+[source]\n+----\n+quarkus.container-image.group=quarkus #optional, default to the system user name\n+quarkus.container-image.name=demo-app #optional, defaults to the application name\n+quarkus.container-image.tag=1.0       #optional, defaults to the application version\n+----\n \n-By default the Kubernetes resources do not contain readiness and liveness probes in the generated `Deployment`. Adding them however is just a matter of adding the Smallrye Health extension like so:\n+The image that will be used in the generated manifests will be `quarkus/demo-app:1.0`\n \n-[source,xml]\n+=== Defining a docker registry\n+\n+The docker registry can be specified, with the following property:\n+\n+[source]\n ----\n-    <dependency>\n-      <groupId>io.quarkus</groupId>\n-      <artifactId>quarkus-smallrye-health</artifactId>\n-    </dependency>\n+quarkus.container-image.registry=http://my.docker-registry.net\n ----\n \n-The values of the generated probes will be determined by the configured health properties: `quarkus.smallrye-health.root-path`, `quarkus.smallrye-health.liveness-path` and `quarkus.smallrye-health.readiness-path`.\n-More information about the health extension can be found in the relevant link:microprofile-health[guide].\n+By adding this property along the rest of the container-image properties of the previous section, the generated manifests will use the image `http://my.docker-registry.net/quarkus/demo-app:1.0`.\n \n-=== Using the Kubernetes client\n \n-Applications that are deployed to Kubernetes and need to access the API server, will usually make use of the `kubernetes-client` extension:\n+The image is not the only thing that can be cusotmized in the generated manifests. The kubernetes extension provides a rich set of configuration properties, that allow customization.\n \n-[source,xml]\n+=== Labels and Annotations\n+\n+==== Labels\n+\n+The generted manifests use the Kubernetes link:https://kubernetes.io/docs/concepts/overview/working-with-objects/common-labels[recommended labels].\n+These labels can be customized using `quarkus.kubernetes.name`, `quarkus.kubernetes.version` and `quarkus.kubernetes.part-of`.\n+For example by adding the following configuration to your `application.properties`:\n+\n+[source]\n ----\n-    <dependency>\n-      <groupId>io.quarkus</groupId>\n-      <artifactId>quarkus-kubernetes-client</artifactId>\n-    </dependency>\n+quarkus.kubernetes.part-of=todo-app\n+quarkus.kubernetes.name=todo-rest\n+quarkus.kubernetes.version=1.0-rc.1\n ----\n \n-To access the API server from within a Kubernetes cluster, some RBAC related resources are required (e.g. a ServiceAccount, a RoleBinding etc.).\n-So, when the `kubernetes-client` extension is present, the `kubernetes` extension is going to create those resources automatically, so that application will be granted the `view` role.\n-If more roles are required, they will have to be added manually.\n+The generated generated resources will have the labels:\n \n-== Tuning the generated resources using application.properties\n+[source, json]\n+----\n+  \"labels\" : {\n+    \"app.kubernetes.io/part-of\" : \"todo-app\",\n+    \"app.kubernetes.io/name\" : \"todo-rest\",\n+    \"app.kubernetes.io/version\" : \"1.0-rc.1\"\n+  }\n+----\n \n-The Kubernetes extension allows tuning the generated manifest, using the `application.properties` file.\n-Here are some examples:\n+==== Custom Labels\n \n-=== Changing the number of replicas:\n-To change the number of replicas from 1 to  3:\n+To add addtional Labels, for example `foo=bar`:", "originalCommit": "bbf4603b2c75902abff1e7ec8073f45f07ce981b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjExOTQ2OQ==", "url": "https://github.com/quarkusio/quarkus/pull/7501#discussion_r386119469", "bodyText": "varialbes -> variables", "author": "geoand", "createdAt": "2020-03-01T16:01:35Z", "path": "docs/src/main/asciidoc/kubernetes.adoc", "diffHunk": "@@ -113,85 +101,223 @@ The full source of the `kubernetes.json` file looks something like this:\n                 }\n               }\n             } ],\n-            \"image\" : \"yourDockerUsername/test-quarkus-app:1.0-SNAPSHOT\",\n+            \"image\" : \"yourDockerUsernmae/test-quarkus-app:1.0-SNAPSHOT\",\n             \"imagePullPolicy\" : \"IfNotPresent\",\n             \"name\" : \"test-quarkus-app\"\n           } ]\n         }\n       }\n     }\n-  } ]\n+  },\n+  {\n+  \"apiVersion\" : \"v1\",\n+  \"kind\" : \"Service\",\n+    \"metadata\" : {\n+      \"annotations\": {\n+       \"app.quarkus.io/vcs-url\" : \"<some url>\",\n+       \"app.quarkus.io/commit-id\" : \"<some git SHA>\",\n+      },\n+      \"labels\" : {\n+        \"app.kubernetes.io/name\" : \"test-quarkus-app\",\n+        \"app.kubernetes.io/version\" : \"1.0-SNAPSHOT\",\n+      },\n+      \"name\" : \"test-quarkus-app\"\n+    },\n+  \"spec\" : {\n+    \"ports\" : [ {\n+      \"name\" : \"http\",\n+      \"port\" : 8080,\n+      \"targetPort\" : 8080\n+    } ],\n+    \"selector\" : {\n+      \"app.kubernetes.io/name\" : \"test-quarkus-app\",\n+      \"app.kubernetes.io/version\" : \"1.0-SNAPSHOT\"\n+    },\n+    \"type\" : \"ClusterIP\"\n+  }\n+ }\n }\n ----\n \n An important thing to note about the `Deployment` is that is uses `yourDockerUsername/test-quarkus-app:1.0-SNAPSHOT` as the Docker image of the `Pod`.\n+The name of the image is controlled by the container-image extension and can be customized using the usual `applcation.properties`.\n \n-Also the `Service` is configured to use container port `8080` (which is automatically picked up by the standard Quarkus configuration).\n+For example with a configuration like:\n \n-=== Add readiness and liveness probes\n+[source]\n+----\n+quarkus.container-image.group=quarkus #optional, default to the system user name\n+quarkus.container-image.name=demo-app #optional, defaults to the application name\n+quarkus.container-image.tag=1.0       #optional, defaults to the application version\n+----\n \n-By default the Kubernetes resources do not contain readiness and liveness probes in the generated `Deployment`. Adding them however is just a matter of adding the Smallrye Health extension like so:\n+The image that will be used in the generated manifests will be `quarkus/demo-app:1.0`\n \n-[source,xml]\n+=== Defining a docker registry\n+\n+The docker registry can be specified, with the following property:\n+\n+[source]\n ----\n-    <dependency>\n-      <groupId>io.quarkus</groupId>\n-      <artifactId>quarkus-smallrye-health</artifactId>\n-    </dependency>\n+quarkus.container-image.registry=http://my.docker-registry.net\n ----\n \n-The values of the generated probes will be determined by the configured health properties: `quarkus.smallrye-health.root-path`, `quarkus.smallrye-health.liveness-path` and `quarkus.smallrye-health.readiness-path`.\n-More information about the health extension can be found in the relevant link:microprofile-health[guide].\n+By adding this property along the rest of the container-image properties of the previous section, the generated manifests will use the image `http://my.docker-registry.net/quarkus/demo-app:1.0`.\n \n-=== Using the Kubernetes client\n \n-Applications that are deployed to Kubernetes and need to access the API server, will usually make use of the `kubernetes-client` extension:\n+The image is not the only thing that can be cusotmized in the generated manifests. The kubernetes extension provides a rich set of configuration properties, that allow customization.\n \n-[source,xml]\n+=== Labels and Annotations\n+\n+==== Labels\n+\n+The generted manifests use the Kubernetes link:https://kubernetes.io/docs/concepts/overview/working-with-objects/common-labels[recommended labels].\n+These labels can be customized using `quarkus.kubernetes.name`, `quarkus.kubernetes.version` and `quarkus.kubernetes.part-of`.\n+For example by adding the following configuration to your `application.properties`:\n+\n+[source]\n ----\n-    <dependency>\n-      <groupId>io.quarkus</groupId>\n-      <artifactId>quarkus-kubernetes-client</artifactId>\n-    </dependency>\n+quarkus.kubernetes.part-of=todo-app\n+quarkus.kubernetes.name=todo-rest\n+quarkus.kubernetes.version=1.0-rc.1\n ----\n \n-To access the API server from within a Kubernetes cluster, some RBAC related resources are required (e.g. a ServiceAccount, a RoleBinding etc.).\n-So, when the `kubernetes-client` extension is present, the `kubernetes` extension is going to create those resources automatically, so that application will be granted the `view` role.\n-If more roles are required, they will have to be added manually.\n+The generated generated resources will have the labels:\n \n-== Tuning the generated resources using application.properties\n+[source, json]\n+----\n+  \"labels\" : {\n+    \"app.kubernetes.io/part-of\" : \"todo-app\",\n+    \"app.kubernetes.io/name\" : \"todo-rest\",\n+    \"app.kubernetes.io/version\" : \"1.0-rc.1\"\n+  }\n+----\n \n-The Kubernetes extension allows tuning the generated manifest, using the `application.properties` file.\n-Here are some examples:\n+==== Custom Labels\n \n-=== Changing the number of replicas:\n-To change the number of replicas from 1 to  3:\n+To add addtional Labels, for example `foo=bar`:\n \n [source]\n ----\n-quarkus.kubernetes.replicas=3\n+quarkus.kubernetes.labels.foo=bar\n ----\n \n-=== Defining a docker registry and repository\n+====  Annotations\n+\n+Out of the box the generated resources will be annotated with version control related information that can be used either by tooling, or by the user for troubleshooting purposes.\n+\n+[source, json]\n+----\n+  \"annotations\": {\n+    \"app.quarkus.io/vcs-url\" : \"<some url>\",\n+    \"app.quarkus.io/commit-id\" : \"<some git SHA>\",\n+   }\n+----\n+\n+==== Custom Annotations\n+\n+Custom annotations can be added in way similar to labels. For example to add the annotation `foo=bar`:\n \n-The docker registry and the user of the docker image can be specified, with the following properties:\n \n [source]\n ----\n-quarkus.kubernetes.group=myUser\n-quarkus.docker.registry=http://my.docker-registry.net\n+quarkus.kubernetes.annotations.foo=bar\n ----\n \n-Note: These options used to be `quarkus.kubernetes.docker.registry` and `quarkus.kubernetes.group` respectively.\n+==== Environment variables\n+\n+Kubernetes provides multiple ways of defining environment varialbes:", "originalCommit": "bbf4603b2c75902abff1e7ec8073f45f07ce981b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjExOTUzMg==", "url": "https://github.com/quarkusio/quarkus/pull/7501#discussion_r386119532", "bodyText": "environmnet -> environment", "author": "geoand", "createdAt": "2020-03-01T16:02:44Z", "path": "docs/src/main/asciidoc/kubernetes.adoc", "diffHunk": "@@ -113,85 +101,223 @@ The full source of the `kubernetes.json` file looks something like this:\n                 }\n               }\n             } ],\n-            \"image\" : \"yourDockerUsername/test-quarkus-app:1.0-SNAPSHOT\",\n+            \"image\" : \"yourDockerUsernmae/test-quarkus-app:1.0-SNAPSHOT\",\n             \"imagePullPolicy\" : \"IfNotPresent\",\n             \"name\" : \"test-quarkus-app\"\n           } ]\n         }\n       }\n     }\n-  } ]\n+  },\n+  {\n+  \"apiVersion\" : \"v1\",\n+  \"kind\" : \"Service\",\n+    \"metadata\" : {\n+      \"annotations\": {\n+       \"app.quarkus.io/vcs-url\" : \"<some url>\",\n+       \"app.quarkus.io/commit-id\" : \"<some git SHA>\",\n+      },\n+      \"labels\" : {\n+        \"app.kubernetes.io/name\" : \"test-quarkus-app\",\n+        \"app.kubernetes.io/version\" : \"1.0-SNAPSHOT\",\n+      },\n+      \"name\" : \"test-quarkus-app\"\n+    },\n+  \"spec\" : {\n+    \"ports\" : [ {\n+      \"name\" : \"http\",\n+      \"port\" : 8080,\n+      \"targetPort\" : 8080\n+    } ],\n+    \"selector\" : {\n+      \"app.kubernetes.io/name\" : \"test-quarkus-app\",\n+      \"app.kubernetes.io/version\" : \"1.0-SNAPSHOT\"\n+    },\n+    \"type\" : \"ClusterIP\"\n+  }\n+ }\n }\n ----\n \n An important thing to note about the `Deployment` is that is uses `yourDockerUsername/test-quarkus-app:1.0-SNAPSHOT` as the Docker image of the `Pod`.\n+The name of the image is controlled by the container-image extension and can be customized using the usual `applcation.properties`.\n \n-Also the `Service` is configured to use container port `8080` (which is automatically picked up by the standard Quarkus configuration).\n+For example with a configuration like:\n \n-=== Add readiness and liveness probes\n+[source]\n+----\n+quarkus.container-image.group=quarkus #optional, default to the system user name\n+quarkus.container-image.name=demo-app #optional, defaults to the application name\n+quarkus.container-image.tag=1.0       #optional, defaults to the application version\n+----\n \n-By default the Kubernetes resources do not contain readiness and liveness probes in the generated `Deployment`. Adding them however is just a matter of adding the Smallrye Health extension like so:\n+The image that will be used in the generated manifests will be `quarkus/demo-app:1.0`\n \n-[source,xml]\n+=== Defining a docker registry\n+\n+The docker registry can be specified, with the following property:\n+\n+[source]\n ----\n-    <dependency>\n-      <groupId>io.quarkus</groupId>\n-      <artifactId>quarkus-smallrye-health</artifactId>\n-    </dependency>\n+quarkus.container-image.registry=http://my.docker-registry.net\n ----\n \n-The values of the generated probes will be determined by the configured health properties: `quarkus.smallrye-health.root-path`, `quarkus.smallrye-health.liveness-path` and `quarkus.smallrye-health.readiness-path`.\n-More information about the health extension can be found in the relevant link:microprofile-health[guide].\n+By adding this property along the rest of the container-image properties of the previous section, the generated manifests will use the image `http://my.docker-registry.net/quarkus/demo-app:1.0`.\n \n-=== Using the Kubernetes client\n \n-Applications that are deployed to Kubernetes and need to access the API server, will usually make use of the `kubernetes-client` extension:\n+The image is not the only thing that can be cusotmized in the generated manifests. The kubernetes extension provides a rich set of configuration properties, that allow customization.\n \n-[source,xml]\n+=== Labels and Annotations\n+\n+==== Labels\n+\n+The generted manifests use the Kubernetes link:https://kubernetes.io/docs/concepts/overview/working-with-objects/common-labels[recommended labels].\n+These labels can be customized using `quarkus.kubernetes.name`, `quarkus.kubernetes.version` and `quarkus.kubernetes.part-of`.\n+For example by adding the following configuration to your `application.properties`:\n+\n+[source]\n ----\n-    <dependency>\n-      <groupId>io.quarkus</groupId>\n-      <artifactId>quarkus-kubernetes-client</artifactId>\n-    </dependency>\n+quarkus.kubernetes.part-of=todo-app\n+quarkus.kubernetes.name=todo-rest\n+quarkus.kubernetes.version=1.0-rc.1\n ----\n \n-To access the API server from within a Kubernetes cluster, some RBAC related resources are required (e.g. a ServiceAccount, a RoleBinding etc.).\n-So, when the `kubernetes-client` extension is present, the `kubernetes` extension is going to create those resources automatically, so that application will be granted the `view` role.\n-If more roles are required, they will have to be added manually.\n+The generated generated resources will have the labels:\n \n-== Tuning the generated resources using application.properties\n+[source, json]\n+----\n+  \"labels\" : {\n+    \"app.kubernetes.io/part-of\" : \"todo-app\",\n+    \"app.kubernetes.io/name\" : \"todo-rest\",\n+    \"app.kubernetes.io/version\" : \"1.0-rc.1\"\n+  }\n+----\n \n-The Kubernetes extension allows tuning the generated manifest, using the `application.properties` file.\n-Here are some examples:\n+==== Custom Labels\n \n-=== Changing the number of replicas:\n-To change the number of replicas from 1 to  3:\n+To add addtional Labels, for example `foo=bar`:\n \n [source]\n ----\n-quarkus.kubernetes.replicas=3\n+quarkus.kubernetes.labels.foo=bar\n ----\n \n-=== Defining a docker registry and repository\n+====  Annotations\n+\n+Out of the box the generated resources will be annotated with version control related information that can be used either by tooling, or by the user for troubleshooting purposes.\n+\n+[source, json]\n+----\n+  \"annotations\": {\n+    \"app.quarkus.io/vcs-url\" : \"<some url>\",\n+    \"app.quarkus.io/commit-id\" : \"<some git SHA>\",\n+   }\n+----\n+\n+==== Custom Annotations\n+\n+Custom annotations can be added in way similar to labels. For example to add the annotation `foo=bar`:\n \n-The docker registry and the user of the docker image can be specified, with the following properties:\n \n [source]\n ----\n-quarkus.kubernetes.group=myUser\n-quarkus.docker.registry=http://my.docker-registry.net\n+quarkus.kubernetes.annotations.foo=bar\n ----\n \n-Note: These options used to be `quarkus.kubernetes.docker.registry` and `quarkus.kubernetes.group` respectively.\n+==== Environment variables\n+\n+Kubernetes provides multiple ways of defining environment varialbes:\n \n-=== Adding labels:\n-To add a new label to all generated resources, say `foo=bar`:\n+- key value pairs\n+- from Secret\n+- from ConfigMap\n+- from fields\n+\n+To add a key value pair as an environmnet variable in the generated resources:", "originalCommit": "bbf4603b2c75902abff1e7ec8073f45f07ce981b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjIxNjczOA==", "url": "https://github.com/quarkusio/quarkus/pull/7501#discussion_r386216738", "bodyText": "Same here", "author": "geoand", "createdAt": "2020-03-02T06:34:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjExOTUzMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjExOTY0NA==", "url": "https://github.com/quarkusio/quarkus/pull/7501#discussion_r386119644", "bodyText": "There is an extra space before 3", "author": "geoand", "createdAt": "2020-03-01T16:04:37Z", "path": "docs/src/main/asciidoc/kubernetes.adoc", "diffHunk": "@@ -113,85 +101,223 @@ The full source of the `kubernetes.json` file looks something like this:\n                 }\n               }\n             } ],\n-            \"image\" : \"yourDockerUsername/test-quarkus-app:1.0-SNAPSHOT\",\n+            \"image\" : \"yourDockerUsernmae/test-quarkus-app:1.0-SNAPSHOT\",\n             \"imagePullPolicy\" : \"IfNotPresent\",\n             \"name\" : \"test-quarkus-app\"\n           } ]\n         }\n       }\n     }\n-  } ]\n+  },\n+  {\n+  \"apiVersion\" : \"v1\",\n+  \"kind\" : \"Service\",\n+    \"metadata\" : {\n+      \"annotations\": {\n+       \"app.quarkus.io/vcs-url\" : \"<some url>\",\n+       \"app.quarkus.io/commit-id\" : \"<some git SHA>\",\n+      },\n+      \"labels\" : {\n+        \"app.kubernetes.io/name\" : \"test-quarkus-app\",\n+        \"app.kubernetes.io/version\" : \"1.0-SNAPSHOT\",\n+      },\n+      \"name\" : \"test-quarkus-app\"\n+    },\n+  \"spec\" : {\n+    \"ports\" : [ {\n+      \"name\" : \"http\",\n+      \"port\" : 8080,\n+      \"targetPort\" : 8080\n+    } ],\n+    \"selector\" : {\n+      \"app.kubernetes.io/name\" : \"test-quarkus-app\",\n+      \"app.kubernetes.io/version\" : \"1.0-SNAPSHOT\"\n+    },\n+    \"type\" : \"ClusterIP\"\n+  }\n+ }\n }\n ----\n \n An important thing to note about the `Deployment` is that is uses `yourDockerUsername/test-quarkus-app:1.0-SNAPSHOT` as the Docker image of the `Pod`.\n+The name of the image is controlled by the container-image extension and can be customized using the usual `applcation.properties`.\n \n-Also the `Service` is configured to use container port `8080` (which is automatically picked up by the standard Quarkus configuration).\n+For example with a configuration like:\n \n-=== Add readiness and liveness probes\n+[source]\n+----\n+quarkus.container-image.group=quarkus #optional, default to the system user name\n+quarkus.container-image.name=demo-app #optional, defaults to the application name\n+quarkus.container-image.tag=1.0       #optional, defaults to the application version\n+----\n \n-By default the Kubernetes resources do not contain readiness and liveness probes in the generated `Deployment`. Adding them however is just a matter of adding the Smallrye Health extension like so:\n+The image that will be used in the generated manifests will be `quarkus/demo-app:1.0`\n \n-[source,xml]\n+=== Defining a docker registry\n+\n+The docker registry can be specified, with the following property:\n+\n+[source]\n ----\n-    <dependency>\n-      <groupId>io.quarkus</groupId>\n-      <artifactId>quarkus-smallrye-health</artifactId>\n-    </dependency>\n+quarkus.container-image.registry=http://my.docker-registry.net\n ----\n \n-The values of the generated probes will be determined by the configured health properties: `quarkus.smallrye-health.root-path`, `quarkus.smallrye-health.liveness-path` and `quarkus.smallrye-health.readiness-path`.\n-More information about the health extension can be found in the relevant link:microprofile-health[guide].\n+By adding this property along the rest of the container-image properties of the previous section, the generated manifests will use the image `http://my.docker-registry.net/quarkus/demo-app:1.0`.\n \n-=== Using the Kubernetes client\n \n-Applications that are deployed to Kubernetes and need to access the API server, will usually make use of the `kubernetes-client` extension:\n+The image is not the only thing that can be cusotmized in the generated manifests. The kubernetes extension provides a rich set of configuration properties, that allow customization.\n \n-[source,xml]\n+=== Labels and Annotations\n+\n+==== Labels\n+\n+The generted manifests use the Kubernetes link:https://kubernetes.io/docs/concepts/overview/working-with-objects/common-labels[recommended labels].\n+These labels can be customized using `quarkus.kubernetes.name`, `quarkus.kubernetes.version` and `quarkus.kubernetes.part-of`.\n+For example by adding the following configuration to your `application.properties`:\n+\n+[source]\n ----\n-    <dependency>\n-      <groupId>io.quarkus</groupId>\n-      <artifactId>quarkus-kubernetes-client</artifactId>\n-    </dependency>\n+quarkus.kubernetes.part-of=todo-app\n+quarkus.kubernetes.name=todo-rest\n+quarkus.kubernetes.version=1.0-rc.1\n ----\n \n-To access the API server from within a Kubernetes cluster, some RBAC related resources are required (e.g. a ServiceAccount, a RoleBinding etc.).\n-So, when the `kubernetes-client` extension is present, the `kubernetes` extension is going to create those resources automatically, so that application will be granted the `view` role.\n-If more roles are required, they will have to be added manually.\n+The generated generated resources will have the labels:\n \n-== Tuning the generated resources using application.properties\n+[source, json]\n+----\n+  \"labels\" : {\n+    \"app.kubernetes.io/part-of\" : \"todo-app\",\n+    \"app.kubernetes.io/name\" : \"todo-rest\",\n+    \"app.kubernetes.io/version\" : \"1.0-rc.1\"\n+  }\n+----\n \n-The Kubernetes extension allows tuning the generated manifest, using the `application.properties` file.\n-Here are some examples:\n+==== Custom Labels\n \n-=== Changing the number of replicas:\n-To change the number of replicas from 1 to  3:\n+To add addtional Labels, for example `foo=bar`:\n \n [source]\n ----\n-quarkus.kubernetes.replicas=3\n+quarkus.kubernetes.labels.foo=bar\n ----\n \n-=== Defining a docker registry and repository\n+====  Annotations\n+\n+Out of the box the generated resources will be annotated with version control related information that can be used either by tooling, or by the user for troubleshooting purposes.\n+\n+[source, json]\n+----\n+  \"annotations\": {\n+    \"app.quarkus.io/vcs-url\" : \"<some url>\",\n+    \"app.quarkus.io/commit-id\" : \"<some git SHA>\",\n+   }\n+----\n+\n+==== Custom Annotations\n+\n+Custom annotations can be added in way similar to labels. For example to add the annotation `foo=bar`:\n \n-The docker registry and the user of the docker image can be specified, with the following properties:\n \n [source]\n ----\n-quarkus.kubernetes.group=myUser\n-quarkus.docker.registry=http://my.docker-registry.net\n+quarkus.kubernetes.annotations.foo=bar\n ----\n \n-Note: These options used to be `quarkus.kubernetes.docker.registry` and `quarkus.kubernetes.group` respectively.\n+==== Environment variables\n+\n+Kubernetes provides multiple ways of defining environment varialbes:\n \n-=== Adding labels:\n-To add a new label to all generated resources, say `foo=bar`:\n+- key value pairs\n+- from Secret\n+- from ConfigMap\n+- from fields\n+\n+To add a key value pair as an environmnet variable in the generated resources:\n \n [source]\n ----\n-quarkus.kubernetes.labels.foo=bar\n+quarkus.kubernetes.env-vars.my-env-var.value=foobar\n+----\n+\n+The command above will add `MY_ENV_VAR=foobar` as an environment variable.\n+Please note that the key `my-env-var` will be converted to uppercase and dashes will be replaced by underscores resulting in `MY_ENV_VAR`.\n+\n+You may also noticed that in contrast to labels, and annotations for environment variables you don't just use a key=value approach.\n+That is because for environment variables there are additional options rather than just value.\n+\n+===== Environment variables from Secret\n+\n+To add all key value pairs of a `Secret` as environment variables:\n+\n+[source]\n+----\n+quarkus.kubernetes.env-vars.my-env-var.secret=my-secret\n+----\n+\n+===== Environment variables from ConfigMap\n+\n+To add all key value pairs of a `ConfigMap` as environment variables:\n+\n+[source]\n+----\n+quarkus.kubernetes.env-vars.my-env-var.configmap=my-secret\n+----\n+\n+\n+==== Mounting volumes\n+\n+The Kubernetes extension allows the user to configure both volumes and mounts for the application.\n+\n+Any volume can be mounted with a simple configuration:\n+\n+[source]\n+----\n+quarkus.kubernetes.mounts.my-volume.path=/where/to/mount\n+----\n+\n+This will add a mount to my pod for volume `my-voume` to path `/where/to/mount`\n+\n+The volumes themselves can be configured as shown in the sections below:\n+\n+===== Secret volumes\n+\n+[source]\n+----\n+quarkus.kubernetes.secret-volumes.my-volume.secret-name=my-secret\n+----\n+\n+===== ConfigMap volumes\n+\n+[source]\n+----\n+quarkus.kubernetes.config-map-volumes.my-volume.config-map-name=my-secret\n+----\n+\n+=== Changing the number of replicas:\n+\n+To change the number of replicas from 1 to  3:", "originalCommit": "bbf4603b2c75902abff1e7ec8073f45f07ce981b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "ce73d842b69cc91afd68cbc8ae74127f3fa2b337", "url": "https://github.com/quarkusio/quarkus/commit/ce73d842b69cc91afd68cbc8ae74127f3fa2b337", "message": "doc: Align kubernetes.adoc with recent changes", "committedDate": "2020-03-01T17:06:55Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjIxMjc0Mw==", "url": "https://github.com/quarkusio/quarkus/pull/7501#discussion_r386212743", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * The name of the group this component belogs too\n          \n          \n            \n                 * The name of the group this component belongs too", "author": "geoand", "createdAt": "2020-03-02T06:16:44Z", "path": "extensions/kubernetes/vanilla/deployment/src/main/java/io/quarkus/kubernetes/deployment/KnativeConfig.java", "diffHunk": "@@ -11,11 +11,12 @@\n \n @ConfigRoot\n public class KnativeConfig implements PlatformConfiguration {\n+\n     /**\n-     * The group of the application.\n+     * The name of the group this component belogs too", "originalCommit": "ce73d842b69cc91afd68cbc8ae74127f3fa2b337", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjIxMjc3OA==", "url": "https://github.com/quarkusio/quarkus/pull/7501#discussion_r386212778", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * The name of the group this component belogs too\n          \n          \n            \n                 * The name of the group this component belongs too", "author": "geoand", "createdAt": "2020-03-02T06:16:54Z", "path": "extensions/kubernetes/vanilla/deployment/src/main/java/io/quarkus/kubernetes/deployment/KubernetesConfig.java", "diffHunk": "@@ -13,10 +13,10 @@\n public class KubernetesConfig implements PlatformConfiguration {\n \n     /**\n-     * The group of the application.\n+     * The name of the group this component belogs too", "originalCommit": "ce73d842b69cc91afd68cbc8ae74127f3fa2b337", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjIxMjgxNQ==", "url": "https://github.com/quarkusio/quarkus/pull/7501#discussion_r386212815", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * The name of the group this component belogs too\n          \n          \n            \n                 * The name of the group this component belongs too", "author": "geoand", "createdAt": "2020-03-02T06:17:05Z", "path": "extensions/kubernetes/vanilla/deployment/src/main/java/io/quarkus/kubernetes/deployment/OpenshiftConfig.java", "diffHunk": "@@ -14,10 +14,10 @@\n public class OpenshiftConfig implements PlatformConfiguration {\n \n     /**\n-     * The group of the application.\n+     * The name of the group this component belogs too", "originalCommit": "ce73d842b69cc91afd68cbc8ae74127f3fa2b337", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjIxMzI1Mw==", "url": "https://github.com/quarkusio/quarkus/pull/7501#discussion_r386213253", "bodyText": "This comment seems to have been removed from the code that adds ApplyContainerImageDecorator. Should it be re-added sicne the issue is still open or has the issue been side-stepped?", "author": "geoand", "createdAt": "2020-03-02T06:18:58Z", "path": "extensions/kubernetes/vanilla/deployment/src/main/java/io/quarkus/kubernetes/deployment/KubernetesProcessor.java", "diffHunk": "@@ -370,16 +374,14 @@ private void applyBuildItems(Session session,\n         String openshiftName = openshiftConfig.name.orElse(name);\n         String knativeName = knativeConfig.name.orElse(name);\n \n-        //TODO: This is needed until https://github.com/dekorateio/dekorate/issues/456 is resolved.", "originalCommit": "ce73d842b69cc91afd68cbc8ae74127f3fa2b337", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjIxNDUwNQ==", "url": "https://github.com/quarkusio/quarkus/pull/7501#discussion_r386214505", "bodyText": "With these changes DOCKER_REGISTRY_PROPERTY and APP_GROUP_PROPERTY are no longer used", "author": "geoand", "createdAt": "2020-03-02T06:24:32Z", "path": "extensions/kubernetes/vanilla/deployment/src/main/java/io/quarkus/kubernetes/deployment/KubernetesProcessor.java", "diffHunk": "@@ -151,65 +156,48 @@ public void build(ApplicationInfoBuildItem applicationInfo,\n                 .map(KubernetesDeploymentTargetBuildItem::getName)\n                 .collect(Collectors.toSet());\n \n-        // this is a hack to get kubernetes.registry working because currently it's not supported as is in Dekorate\n-        Optional<String> dockerRegistry = KubernetesConfigUtil.getDockerRegistry(config);\n-        dockerRegistry.ifPresent(v -> System.setProperty(DOCKER_REGISTRY_PROPERTY, v));\n-\n-        // this is a hack to work around Dekorate using the default group for some of the properties\n-        Optional<String> kubernetesGroup = KubernetesConfigUtil.getGroup(config);\n-        kubernetesGroup.ifPresent(v -> System.setProperty(APP_GROUP_PROPERTY, v));", "originalCommit": "ce73d842b69cc91afd68cbc8ae74127f3fa2b337", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjIxNDg4Mw==", "url": "https://github.com/quarkusio/quarkus/pull/7501#discussion_r386214883", "bodyText": "Can we have a comment here please explaining that dekorate adds these automatically and we want to replace them with more specific ones?", "author": "geoand", "createdAt": "2020-03-02T06:26:23Z", "path": "extensions/kubernetes/vanilla/deployment/src/main/java/io/quarkus/kubernetes/deployment/KubernetesProcessor.java", "diffHunk": "@@ -259,20 +247,36 @@ private void applyGlobalConfig(Session session, KubernetesConfig config) {\n      * @param config The {@link PlatformConfiguration} instance\n      * @param now\n      */\n-    private void applyConfig(Session session, String target, String name, PlatformConfiguration config, ZonedDateTime now) {\n+    private void applyConfig(Session session, Project project, String target, String name, PlatformConfiguration config,\n+            ZonedDateTime now) {\n         //Labels\n         config.getLabels().forEach((key, value) -> {\n             session.resources().decorate(target, new AddLabelDecorator(new Label(key, value)));\n         });\n \n+        if (OPENSHIFT.equals(target)) {\n+            session.resources().decorate(OPENSHIFT, new AddLabelDecorator(new Label(OPENSHIFT_APP_RUNTIME, QUARKUS)));\n+        }\n+\n         //Annotations\n         config.getAnnotations().forEach((key, value) -> {\n             session.resources().decorate(target, new AddAnnotationDecorator(new Annotation(key, value)));\n         });\n+\n+        ScmInfo scm = project.getScmInfo();\n+        String vcsUrl = scm != null ? scm.getUrl() : Annotations.UNKNOWN;\n+        String commitId = scm != null ? scm.getCommit() : Annotations.UNKNOWN;\n+\n+        session.resources().decorate(target, new RemoveAnnotationDecorator(Annotations.VCS_URL));\n+        session.resources().decorate(target, new RemoveAnnotationDecorator(Annotations.COMMIT_ID));", "originalCommit": "ce73d842b69cc91afd68cbc8ae74127f3fa2b337", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjIxNTY5Ng==", "url": "https://github.com/quarkusio/quarkus/pull/7501#discussion_r386215696", "bodyText": "I think we should probably use Kubernetes (upper-case K) in all instances of the doc that aren't referring to code", "author": "geoand", "createdAt": "2020-03-02T06:29:57Z", "path": "docs/src/main/asciidoc/kubernetes.adoc", "diffHunk": "@@ -51,19 +51,8 @@ When we added the `kubernetes` extension to the command line invocation above, t\n     </dependency>\n ----\n \n-By adding this dependency, we now have the ability to configure the Kubernetes resource generation and application using the usual `application.properties` approach that Quarkus provides.\n-The configuration items that are available can be found in: `io.quarkus.kubernetes.deployment.KubernetesConfig` class.\n-Furthermore, the items provided by `io.quarkus.deployment.ApplicationConfig` affect the Kubernetes resources.\n-\n-By using the following configuration for example:\n-\n-[source]\n-----\n-quarkus.kubernetes.group=yourDockerUsername # this is optional and defaults to your username if not set.\n-quarkus.application.name=test-quarkus-app # this is also optional and defaults to the project name if not set\n-----\n-\n-and following the execution of `./mvnw package` you will notice amongst the other files that are created, two files named\n+By adding this dependency, we enable the generation of kubernetes manifests each time we perform a build.", "originalCommit": "ce73d842b69cc91afd68cbc8ae74127f3fa2b337", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjIxNTgzNQ==", "url": "https://github.com/quarkusio/quarkus/pull/7501#discussion_r386215835", "bodyText": "This change doesn't look right :)", "author": "geoand", "createdAt": "2020-03-02T06:30:32Z", "path": "docs/src/main/asciidoc/kubernetes.adoc", "diffHunk": "@@ -113,84 +101,222 @@ The full source of the `kubernetes.json` file looks something like this:\n                 }\n               }\n             } ],\n-            \"image\" : \"yourDockerUsername/test-quarkus-app:1.0-SNAPSHOT\",\n+            \"image\" : \"yourDockerUsernmae/test-quarkus-app:1.0-SNAPSHOT\",", "originalCommit": "ce73d842b69cc91afd68cbc8ae74127f3fa2b337", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjIxNjgyNw==", "url": "https://github.com/quarkusio/quarkus/pull/7501#discussion_r386216827", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            You may also noticed that in contrast to labels, and annotations for environment variables you don't just use a key=value approach.\n          \n          \n            \n            You may also noticed that in contrast to labels and annotations for environment variables you don't just use a key=value approach.", "author": "geoand", "createdAt": "2020-03-02T06:35:01Z", "path": "docs/src/main/asciidoc/kubernetes.adoc", "diffHunk": "@@ -113,84 +101,222 @@ The full source of the `kubernetes.json` file looks something like this:\n                 }\n               }\n             } ],\n-            \"image\" : \"yourDockerUsername/test-quarkus-app:1.0-SNAPSHOT\",\n+            \"image\" : \"yourDockerUsernmae/test-quarkus-app:1.0-SNAPSHOT\",\n             \"imagePullPolicy\" : \"IfNotPresent\",\n             \"name\" : \"test-quarkus-app\"\n           } ]\n         }\n       }\n     }\n-  } ]\n+  },\n+  {\n+  \"apiVersion\" : \"v1\",\n+  \"kind\" : \"Service\",\n+    \"metadata\" : {\n+      \"annotations\": {\n+       \"app.quarkus.io/vcs-url\" : \"<some url>\",\n+       \"app.quarkus.io/commit-id\" : \"<some git SHA>\",\n+      },\n+      \"labels\" : {\n+        \"app.kubernetes.io/name\" : \"test-quarkus-app\",\n+        \"app.kubernetes.io/version\" : \"1.0-SNAPSHOT\",\n+      },\n+      \"name\" : \"test-quarkus-app\"\n+    },\n+  \"spec\" : {\n+    \"ports\" : [ {\n+      \"name\" : \"http\",\n+      \"port\" : 8080,\n+      \"targetPort\" : 8080\n+    } ],\n+    \"selector\" : {\n+      \"app.kubernetes.io/name\" : \"test-quarkus-app\",\n+      \"app.kubernetes.io/version\" : \"1.0-SNAPSHOT\"\n+    },\n+    \"type\" : \"ClusterIP\"\n+  }\n+ }\n }\n ----\n \n An important thing to note about the `Deployment` is that is uses `yourDockerUsername/test-quarkus-app:1.0-SNAPSHOT` as the Docker image of the `Pod`.\n+The name of the image is controlled by the container-image extension and can be customized using the usual `applcation.properties`.\n \n-Also the `Service` is configured to use container port `8080` (which is automatically picked up by the standard Quarkus configuration).\n+For example with a configuration like:\n \n-=== Add readiness and liveness probes\n+[source]\n+----\n+quarkus.container-image.group=quarkus #optional, default to the system user name\n+quarkus.container-image.name=demo-app #optional, defaults to the application name\n+quarkus.container-image.tag=1.0       #optional, defaults to the application version\n+----\n \n-By default the Kubernetes resources do not contain readiness and liveness probes in the generated `Deployment`. Adding them however is just a matter of adding the Smallrye Health extension like so:\n+The image that will be used in the generated manifests will be `quarkus/demo-app:1.0`\n \n-[source,xml]\n+=== Defining a docker registry\n+\n+The docker registry can be specified, with the following property:\n+\n+[source]\n ----\n-    <dependency>\n-      <groupId>io.quarkus</groupId>\n-      <artifactId>quarkus-smallrye-health</artifactId>\n-    </dependency>\n+quarkus.container-image.registry=http://my.docker-registry.net\n ----\n \n-The values of the generated probes will be determined by the configured health properties: `quarkus.smallrye-health.root-path`, `quarkus.smallrye-health.liveness-path` and `quarkus.smallrye-health.readiness-path`.\n-More information about the health extension can be found in the relevant link:microprofile-health[guide].\n+By adding this property along the rest of the container-image properties of the previous section, the generated manifests will use the image `http://my.docker-registry.net/quarkus/demo-app:1.0`.\n \n-=== Using the Kubernetes client\n \n-Applications that are deployed to Kubernetes and need to access the API server, will usually make use of the `kubernetes-client` extension:\n+The image is not the only thing that can be cusotmized in the generated manifests. The kubernetes extension provides a rich set of configuration properties, that allow customization.\n \n-[source,xml]\n+=== Labels and Annotations\n+\n+==== Labels\n+\n+The generated manifests use the Kubernetes link:https://kubernetes.io/docs/concepts/overview/working-with-objects/common-labels[recommended labels].\n+These labels can be customized using `quarkus.kubernetes.name`, `quarkus.kubernetes.version` and `quarkus.kubernetes.part-of`.\n+For example by adding the following configuration to your `application.properties`:\n+\n+[source]\n ----\n-    <dependency>\n-      <groupId>io.quarkus</groupId>\n-      <artifactId>quarkus-kubernetes-client</artifactId>\n-    </dependency>\n+quarkus.kubernetes.part-of=todo-app\n+quarkus.kubernetes.name=todo-rest\n+quarkus.kubernetes.version=1.0-rc.1\n ----\n \n-To access the API server from within a Kubernetes cluster, some RBAC related resources are required (e.g. a ServiceAccount, a RoleBinding etc.).\n-So, when the `kubernetes-client` extension is present, the `kubernetes` extension is going to create those resources automatically, so that application will be granted the `view` role.\n-If more roles are required, they will have to be added manually.\n+The generated generated resources will have the labels:\n \n-== Tuning the generated resources using application.properties\n+[source, json]\n+----\n+  \"labels\" : {\n+    \"app.kubernetes.io/part-of\" : \"todo-app\",\n+    \"app.kubernetes.io/name\" : \"todo-rest\",\n+    \"app.kubernetes.io/version\" : \"1.0-rc.1\"\n+  }\n+----\n \n-The Kubernetes extension allows tuning the generated manifest, using the `application.properties` file.\n-Here are some examples:\n+==== Custom Labels\n \n-=== Changing the number of replicas:\n-To change the number of replicas from 1 to  3:\n+To add additional Labels, for example `foo=bar`:\n \n [source]\n ----\n-quarkus.kubernetes.replicas=3\n+quarkus.kubernetes.labels.foo=bar\n ----\n \n-=== Defining a docker registry and repository\n+====  Annotations\n+\n+Out of the box the generated resources will be annotated with version control related information that can be used either by tooling, or by the user for troubleshooting purposes.\n+\n+[source, json]\n+----\n+  \"annotations\": {\n+    \"app.quarkus.io/vcs-url\" : \"<some url>\",\n+    \"app.quarkus.io/commit-id\" : \"<some git SHA>\",\n+   }\n+----\n+\n+==== Custom Annotations\n+\n+Custom annotations can be added in way similar to labels. For example to add the annotation `foo=bar`:\n \n-The docker registry and the user of the docker image can be specified, with the following properties:\n \n [source]\n ----\n-quarkus.kubernetes.group=myUser\n-quarkus.docker.registry=http://my.docker-registry.net\n+quarkus.kubernetes.annotations.foo=bar\n ----\n \n-Note: These options used to be `quarkus.kubernetes.docker.registry` and `quarkus.kubernetes.group` respectively.\n+==== Environment variables\n \n-=== Adding labels:\n-To add a new label to all generated resources, say `foo=bar`:\n+Kubernetes provides multiple ways of defining environment variables:\n+\n+- key value pairs\n+- from Secret\n+- from ConfigMap\n+- from fields\n+\n+To add a key value pair as an environmnet variable in the generated resources:\n \n [source]\n ----\n-quarkus.kubernetes.labels.foo=bar\n+quarkus.kubernetes.env-vars.my-env-var.value=foobar\n+----\n+\n+The command above will add `MY_ENV_VAR=foobar` as an environment variable.\n+Please note that the key `my-env-var` will be converted to uppercase and dashes will be replaced by underscores resulting in `MY_ENV_VAR`.\n+\n+You may also noticed that in contrast to labels, and annotations for environment variables you don't just use a key=value approach.", "originalCommit": "ce73d842b69cc91afd68cbc8ae74127f3fa2b337", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjIxNjg5OA==", "url": "https://github.com/quarkusio/quarkus/pull/7501#discussion_r386216898", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            That is because for environment variables there are additional options rather than just value.\n          \n          \n            \n            That is because for environment variables there are additional options rather than just setting a value.", "author": "geoand", "createdAt": "2020-03-02T06:35:19Z", "path": "docs/src/main/asciidoc/kubernetes.adoc", "diffHunk": "@@ -113,84 +101,222 @@ The full source of the `kubernetes.json` file looks something like this:\n                 }\n               }\n             } ],\n-            \"image\" : \"yourDockerUsername/test-quarkus-app:1.0-SNAPSHOT\",\n+            \"image\" : \"yourDockerUsernmae/test-quarkus-app:1.0-SNAPSHOT\",\n             \"imagePullPolicy\" : \"IfNotPresent\",\n             \"name\" : \"test-quarkus-app\"\n           } ]\n         }\n       }\n     }\n-  } ]\n+  },\n+  {\n+  \"apiVersion\" : \"v1\",\n+  \"kind\" : \"Service\",\n+    \"metadata\" : {\n+      \"annotations\": {\n+       \"app.quarkus.io/vcs-url\" : \"<some url>\",\n+       \"app.quarkus.io/commit-id\" : \"<some git SHA>\",\n+      },\n+      \"labels\" : {\n+        \"app.kubernetes.io/name\" : \"test-quarkus-app\",\n+        \"app.kubernetes.io/version\" : \"1.0-SNAPSHOT\",\n+      },\n+      \"name\" : \"test-quarkus-app\"\n+    },\n+  \"spec\" : {\n+    \"ports\" : [ {\n+      \"name\" : \"http\",\n+      \"port\" : 8080,\n+      \"targetPort\" : 8080\n+    } ],\n+    \"selector\" : {\n+      \"app.kubernetes.io/name\" : \"test-quarkus-app\",\n+      \"app.kubernetes.io/version\" : \"1.0-SNAPSHOT\"\n+    },\n+    \"type\" : \"ClusterIP\"\n+  }\n+ }\n }\n ----\n \n An important thing to note about the `Deployment` is that is uses `yourDockerUsername/test-quarkus-app:1.0-SNAPSHOT` as the Docker image of the `Pod`.\n+The name of the image is controlled by the container-image extension and can be customized using the usual `applcation.properties`.\n \n-Also the `Service` is configured to use container port `8080` (which is automatically picked up by the standard Quarkus configuration).\n+For example with a configuration like:\n \n-=== Add readiness and liveness probes\n+[source]\n+----\n+quarkus.container-image.group=quarkus #optional, default to the system user name\n+quarkus.container-image.name=demo-app #optional, defaults to the application name\n+quarkus.container-image.tag=1.0       #optional, defaults to the application version\n+----\n \n-By default the Kubernetes resources do not contain readiness and liveness probes in the generated `Deployment`. Adding them however is just a matter of adding the Smallrye Health extension like so:\n+The image that will be used in the generated manifests will be `quarkus/demo-app:1.0`\n \n-[source,xml]\n+=== Defining a docker registry\n+\n+The docker registry can be specified, with the following property:\n+\n+[source]\n ----\n-    <dependency>\n-      <groupId>io.quarkus</groupId>\n-      <artifactId>quarkus-smallrye-health</artifactId>\n-    </dependency>\n+quarkus.container-image.registry=http://my.docker-registry.net\n ----\n \n-The values of the generated probes will be determined by the configured health properties: `quarkus.smallrye-health.root-path`, `quarkus.smallrye-health.liveness-path` and `quarkus.smallrye-health.readiness-path`.\n-More information about the health extension can be found in the relevant link:microprofile-health[guide].\n+By adding this property along the rest of the container-image properties of the previous section, the generated manifests will use the image `http://my.docker-registry.net/quarkus/demo-app:1.0`.\n \n-=== Using the Kubernetes client\n \n-Applications that are deployed to Kubernetes and need to access the API server, will usually make use of the `kubernetes-client` extension:\n+The image is not the only thing that can be cusotmized in the generated manifests. The kubernetes extension provides a rich set of configuration properties, that allow customization.\n \n-[source,xml]\n+=== Labels and Annotations\n+\n+==== Labels\n+\n+The generated manifests use the Kubernetes link:https://kubernetes.io/docs/concepts/overview/working-with-objects/common-labels[recommended labels].\n+These labels can be customized using `quarkus.kubernetes.name`, `quarkus.kubernetes.version` and `quarkus.kubernetes.part-of`.\n+For example by adding the following configuration to your `application.properties`:\n+\n+[source]\n ----\n-    <dependency>\n-      <groupId>io.quarkus</groupId>\n-      <artifactId>quarkus-kubernetes-client</artifactId>\n-    </dependency>\n+quarkus.kubernetes.part-of=todo-app\n+quarkus.kubernetes.name=todo-rest\n+quarkus.kubernetes.version=1.0-rc.1\n ----\n \n-To access the API server from within a Kubernetes cluster, some RBAC related resources are required (e.g. a ServiceAccount, a RoleBinding etc.).\n-So, when the `kubernetes-client` extension is present, the `kubernetes` extension is going to create those resources automatically, so that application will be granted the `view` role.\n-If more roles are required, they will have to be added manually.\n+The generated generated resources will have the labels:\n \n-== Tuning the generated resources using application.properties\n+[source, json]\n+----\n+  \"labels\" : {\n+    \"app.kubernetes.io/part-of\" : \"todo-app\",\n+    \"app.kubernetes.io/name\" : \"todo-rest\",\n+    \"app.kubernetes.io/version\" : \"1.0-rc.1\"\n+  }\n+----\n \n-The Kubernetes extension allows tuning the generated manifest, using the `application.properties` file.\n-Here are some examples:\n+==== Custom Labels\n \n-=== Changing the number of replicas:\n-To change the number of replicas from 1 to  3:\n+To add additional Labels, for example `foo=bar`:\n \n [source]\n ----\n-quarkus.kubernetes.replicas=3\n+quarkus.kubernetes.labels.foo=bar\n ----\n \n-=== Defining a docker registry and repository\n+====  Annotations\n+\n+Out of the box the generated resources will be annotated with version control related information that can be used either by tooling, or by the user for troubleshooting purposes.\n+\n+[source, json]\n+----\n+  \"annotations\": {\n+    \"app.quarkus.io/vcs-url\" : \"<some url>\",\n+    \"app.quarkus.io/commit-id\" : \"<some git SHA>\",\n+   }\n+----\n+\n+==== Custom Annotations\n+\n+Custom annotations can be added in way similar to labels. For example to add the annotation `foo=bar`:\n \n-The docker registry and the user of the docker image can be specified, with the following properties:\n \n [source]\n ----\n-quarkus.kubernetes.group=myUser\n-quarkus.docker.registry=http://my.docker-registry.net\n+quarkus.kubernetes.annotations.foo=bar\n ----\n \n-Note: These options used to be `quarkus.kubernetes.docker.registry` and `quarkus.kubernetes.group` respectively.\n+==== Environment variables\n \n-=== Adding labels:\n-To add a new label to all generated resources, say `foo=bar`:\n+Kubernetes provides multiple ways of defining environment variables:\n+\n+- key value pairs\n+- from Secret\n+- from ConfigMap\n+- from fields\n+\n+To add a key value pair as an environmnet variable in the generated resources:\n \n [source]\n ----\n-quarkus.kubernetes.labels.foo=bar\n+quarkus.kubernetes.env-vars.my-env-var.value=foobar\n+----\n+\n+The command above will add `MY_ENV_VAR=foobar` as an environment variable.\n+Please note that the key `my-env-var` will be converted to uppercase and dashes will be replaced by underscores resulting in `MY_ENV_VAR`.\n+\n+You may also noticed that in contrast to labels, and annotations for environment variables you don't just use a key=value approach.\n+That is because for environment variables there are additional options rather than just value.", "originalCommit": "ce73d842b69cc91afd68cbc8ae74127f3fa2b337", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "be495a1a8b48b84902f5e1bd41a3e1ef47a2a661", "url": "https://github.com/quarkusio/quarkus/commit/be495a1a8b48b84902f5e1bd41a3e1ef47a2a661", "message": "doc: Align kubernetes.adoc with recent changes", "committedDate": "2020-03-03T12:35:45Z", "type": "forcePushed"}, {"oid": "d3cfa95eef5826bed2589a39459961c2795ee5af", "url": "https://github.com/quarkusio/quarkus/commit/d3cfa95eef5826bed2589a39459961c2795ee5af", "message": "doc: Align kubernetes.adoc with recent changes", "committedDate": "2020-03-03T13:29:08Z", "type": "forcePushed"}, {"oid": "e1c8c906274bbc23f3f4677f76af3a49172c95ce", "url": "https://github.com/quarkusio/quarkus/commit/e1c8c906274bbc23f3f4677f76af3a49172c95ce", "message": "doc: Align kubernetes.adoc with recent changes", "committedDate": "2020-03-03T13:44:18Z", "type": "forcePushed"}, {"oid": "068eb985325fc7456f2f8da552737cb58e837ed0", "url": "https://github.com/quarkusio/quarkus/commit/068eb985325fc7456f2f8da552737cb58e837ed0", "message": "doc: Align kubernetes.adoc with recent changes", "committedDate": "2020-03-03T14:08:08Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzE4ODI1Nw==", "url": "https://github.com/quarkusio/quarkus/pull/7501#discussion_r387188257", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            The name of the image is controlled by the container-image extension and can be customized using the usual `applcation.properties`.\n          \n          \n            \n            The name of the image is controlled by the container-image extension and can be customized using the usual `application.properties`.", "author": "gsmet", "createdAt": "2020-03-03T17:47:15Z", "path": "docs/src/main/asciidoc/kubernetes.adoc", "diffHunk": "@@ -120,77 +108,215 @@ The full source of the `kubernetes.json` file looks something like this:\n         }\n       }\n     }\n-  } ]\n+  },\n+  {\n+  \"apiVersion\" : \"v1\",\n+  \"kind\" : \"Service\",\n+    \"metadata\" : {\n+      \"annotations\": {\n+       \"app.quarkus.io/vcs-url\" : \"<some url>\",\n+       \"app.quarkus.io/commit-id\" : \"<some git SHA>\",\n+      },\n+      \"labels\" : {\n+        \"app.kubernetes.io/name\" : \"test-quarkus-app\",\n+        \"app.kubernetes.io/version\" : \"1.0-SNAPSHOT\",\n+      },\n+      \"name\" : \"test-quarkus-app\"\n+    },\n+  \"spec\" : {\n+    \"ports\" : [ {\n+      \"name\" : \"http\",\n+      \"port\" : 8080,\n+      \"targetPort\" : 8080\n+    } ],\n+    \"selector\" : {\n+      \"app.kubernetes.io/name\" : \"test-quarkus-app\",\n+      \"app.kubernetes.io/version\" : \"1.0-SNAPSHOT\"\n+    },\n+    \"type\" : \"ClusterIP\"\n+  }\n+ }\n }\n ----\n \n An important thing to note about the `Deployment` is that is uses `yourDockerUsername/test-quarkus-app:1.0-SNAPSHOT` as the Docker image of the `Pod`.\n+The name of the image is controlled by the container-image extension and can be customized using the usual `applcation.properties`.", "originalCommit": "068eb985325fc7456f2f8da552737cb58e837ed0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzE4ODQwOQ==", "url": "https://github.com/quarkusio/quarkus/pull/7501#discussion_r387188409", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            === Defining a docker registry\n          \n          \n            \n            === Defining a Docker registry", "author": "gsmet", "createdAt": "2020-03-03T17:47:36Z", "path": "docs/src/main/asciidoc/kubernetes.adoc", "diffHunk": "@@ -120,77 +108,215 @@ The full source of the `kubernetes.json` file looks something like this:\n         }\n       }\n     }\n-  } ]\n+  },\n+  {\n+  \"apiVersion\" : \"v1\",\n+  \"kind\" : \"Service\",\n+    \"metadata\" : {\n+      \"annotations\": {\n+       \"app.quarkus.io/vcs-url\" : \"<some url>\",\n+       \"app.quarkus.io/commit-id\" : \"<some git SHA>\",\n+      },\n+      \"labels\" : {\n+        \"app.kubernetes.io/name\" : \"test-quarkus-app\",\n+        \"app.kubernetes.io/version\" : \"1.0-SNAPSHOT\",\n+      },\n+      \"name\" : \"test-quarkus-app\"\n+    },\n+  \"spec\" : {\n+    \"ports\" : [ {\n+      \"name\" : \"http\",\n+      \"port\" : 8080,\n+      \"targetPort\" : 8080\n+    } ],\n+    \"selector\" : {\n+      \"app.kubernetes.io/name\" : \"test-quarkus-app\",\n+      \"app.kubernetes.io/version\" : \"1.0-SNAPSHOT\"\n+    },\n+    \"type\" : \"ClusterIP\"\n+  }\n+ }\n }\n ----\n \n An important thing to note about the `Deployment` is that is uses `yourDockerUsername/test-quarkus-app:1.0-SNAPSHOT` as the Docker image of the `Pod`.\n+The name of the image is controlled by the container-image extension and can be customized using the usual `applcation.properties`.\n \n-Also the `Service` is configured to use container port `8080` (which is automatically picked up by the standard Quarkus configuration).\n+For example with a configuration like:\n \n-=== Add readiness and liveness probes\n+[source]\n+----\n+quarkus.container-image.group=quarkus #optional, default to the system user name\n+quarkus.container-image.name=demo-app #optional, defaults to the application name\n+quarkus.container-image.tag=1.0       #optional, defaults to the application version\n+----\n \n-By default the Kubernetes resources do not contain readiness and liveness probes in the generated `Deployment`. Adding them however is just a matter of adding the Smallrye Health extension like so:\n+The image that will be used in the generated manifests will be `quarkus/demo-app:1.0`\n \n-[source,xml]\n+=== Defining a docker registry", "originalCommit": "068eb985325fc7456f2f8da552737cb58e837ed0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzE4ODU1Mg==", "url": "https://github.com/quarkusio/quarkus/pull/7501#discussion_r387188552", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            The docker registry can be specified, with the following property:\n          \n          \n            \n            The Docker registry can be specified with the following property:", "author": "gsmet", "createdAt": "2020-03-03T17:47:49Z", "path": "docs/src/main/asciidoc/kubernetes.adoc", "diffHunk": "@@ -120,77 +108,215 @@ The full source of the `kubernetes.json` file looks something like this:\n         }\n       }\n     }\n-  } ]\n+  },\n+  {\n+  \"apiVersion\" : \"v1\",\n+  \"kind\" : \"Service\",\n+    \"metadata\" : {\n+      \"annotations\": {\n+       \"app.quarkus.io/vcs-url\" : \"<some url>\",\n+       \"app.quarkus.io/commit-id\" : \"<some git SHA>\",\n+      },\n+      \"labels\" : {\n+        \"app.kubernetes.io/name\" : \"test-quarkus-app\",\n+        \"app.kubernetes.io/version\" : \"1.0-SNAPSHOT\",\n+      },\n+      \"name\" : \"test-quarkus-app\"\n+    },\n+  \"spec\" : {\n+    \"ports\" : [ {\n+      \"name\" : \"http\",\n+      \"port\" : 8080,\n+      \"targetPort\" : 8080\n+    } ],\n+    \"selector\" : {\n+      \"app.kubernetes.io/name\" : \"test-quarkus-app\",\n+      \"app.kubernetes.io/version\" : \"1.0-SNAPSHOT\"\n+    },\n+    \"type\" : \"ClusterIP\"\n+  }\n+ }\n }\n ----\n \n An important thing to note about the `Deployment` is that is uses `yourDockerUsername/test-quarkus-app:1.0-SNAPSHOT` as the Docker image of the `Pod`.\n+The name of the image is controlled by the container-image extension and can be customized using the usual `applcation.properties`.\n \n-Also the `Service` is configured to use container port `8080` (which is automatically picked up by the standard Quarkus configuration).\n+For example with a configuration like:\n \n-=== Add readiness and liveness probes\n+[source]\n+----\n+quarkus.container-image.group=quarkus #optional, default to the system user name\n+quarkus.container-image.name=demo-app #optional, defaults to the application name\n+quarkus.container-image.tag=1.0       #optional, defaults to the application version\n+----\n \n-By default the Kubernetes resources do not contain readiness and liveness probes in the generated `Deployment`. Adding them however is just a matter of adding the Smallrye Health extension like so:\n+The image that will be used in the generated manifests will be `quarkus/demo-app:1.0`\n \n-[source,xml]\n+=== Defining a docker registry\n+\n+The docker registry can be specified, with the following property:", "originalCommit": "068eb985325fc7456f2f8da552737cb58e837ed0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzE4ODk0Nw==", "url": "https://github.com/quarkusio/quarkus/pull/7501#discussion_r387188947", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            By adding this property along the rest of the container-image properties of the previous section, the generated manifests will use the image `http://my.docker-registry.net/quarkus/demo-app:1.0`.\n          \n          \n            \n            By adding this property along with the rest of the container-image properties of the previous section, the generated manifests will use the image `http://my.docker-registry.net/quarkus/demo-app:1.0`.", "author": "gsmet", "createdAt": "2020-03-03T17:48:26Z", "path": "docs/src/main/asciidoc/kubernetes.adoc", "diffHunk": "@@ -120,77 +108,215 @@ The full source of the `kubernetes.json` file looks something like this:\n         }\n       }\n     }\n-  } ]\n+  },\n+  {\n+  \"apiVersion\" : \"v1\",\n+  \"kind\" : \"Service\",\n+    \"metadata\" : {\n+      \"annotations\": {\n+       \"app.quarkus.io/vcs-url\" : \"<some url>\",\n+       \"app.quarkus.io/commit-id\" : \"<some git SHA>\",\n+      },\n+      \"labels\" : {\n+        \"app.kubernetes.io/name\" : \"test-quarkus-app\",\n+        \"app.kubernetes.io/version\" : \"1.0-SNAPSHOT\",\n+      },\n+      \"name\" : \"test-quarkus-app\"\n+    },\n+  \"spec\" : {\n+    \"ports\" : [ {\n+      \"name\" : \"http\",\n+      \"port\" : 8080,\n+      \"targetPort\" : 8080\n+    } ],\n+    \"selector\" : {\n+      \"app.kubernetes.io/name\" : \"test-quarkus-app\",\n+      \"app.kubernetes.io/version\" : \"1.0-SNAPSHOT\"\n+    },\n+    \"type\" : \"ClusterIP\"\n+  }\n+ }\n }\n ----\n \n An important thing to note about the `Deployment` is that is uses `yourDockerUsername/test-quarkus-app:1.0-SNAPSHOT` as the Docker image of the `Pod`.\n+The name of the image is controlled by the container-image extension and can be customized using the usual `applcation.properties`.\n \n-Also the `Service` is configured to use container port `8080` (which is automatically picked up by the standard Quarkus configuration).\n+For example with a configuration like:\n \n-=== Add readiness and liveness probes\n+[source]\n+----\n+quarkus.container-image.group=quarkus #optional, default to the system user name\n+quarkus.container-image.name=demo-app #optional, defaults to the application name\n+quarkus.container-image.tag=1.0       #optional, defaults to the application version\n+----\n \n-By default the Kubernetes resources do not contain readiness and liveness probes in the generated `Deployment`. Adding them however is just a matter of adding the Smallrye Health extension like so:\n+The image that will be used in the generated manifests will be `quarkus/demo-app:1.0`\n \n-[source,xml]\n+=== Defining a docker registry\n+\n+The docker registry can be specified, with the following property:\n+\n+[source]\n ----\n-    <dependency>\n-      <groupId>io.quarkus</groupId>\n-      <artifactId>quarkus-smallrye-health</artifactId>\n-    </dependency>\n+quarkus.container-image.registry=http://my.docker-registry.net\n ----\n \n-The values of the generated probes will be determined by the configured health properties: `quarkus.smallrye-health.root-path`, `quarkus.smallrye-health.liveness-path` and `quarkus.smallrye-health.readiness-path`.\n-More information about the health extension can be found in the relevant link:microprofile-health[guide].\n+By adding this property along the rest of the container-image properties of the previous section, the generated manifests will use the image `http://my.docker-registry.net/quarkus/demo-app:1.0`.", "originalCommit": "068eb985325fc7456f2f8da552737cb58e837ed0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzE4OTA4Mg==", "url": "https://github.com/quarkusio/quarkus/pull/7501#discussion_r387189082", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            The image is not the only thing that can be customized in the generated manifests. The kubernetes extension provides a rich set of configuration properties, that allow customization.\n          \n          \n            \n            The image is not the only thing that can be customized in the generated manifests. The kubernetes extension provides a rich set of configuration properties that allow customization.", "author": "gsmet", "createdAt": "2020-03-03T17:48:42Z", "path": "docs/src/main/asciidoc/kubernetes.adoc", "diffHunk": "@@ -120,77 +108,215 @@ The full source of the `kubernetes.json` file looks something like this:\n         }\n       }\n     }\n-  } ]\n+  },\n+  {\n+  \"apiVersion\" : \"v1\",\n+  \"kind\" : \"Service\",\n+    \"metadata\" : {\n+      \"annotations\": {\n+       \"app.quarkus.io/vcs-url\" : \"<some url>\",\n+       \"app.quarkus.io/commit-id\" : \"<some git SHA>\",\n+      },\n+      \"labels\" : {\n+        \"app.kubernetes.io/name\" : \"test-quarkus-app\",\n+        \"app.kubernetes.io/version\" : \"1.0-SNAPSHOT\",\n+      },\n+      \"name\" : \"test-quarkus-app\"\n+    },\n+  \"spec\" : {\n+    \"ports\" : [ {\n+      \"name\" : \"http\",\n+      \"port\" : 8080,\n+      \"targetPort\" : 8080\n+    } ],\n+    \"selector\" : {\n+      \"app.kubernetes.io/name\" : \"test-quarkus-app\",\n+      \"app.kubernetes.io/version\" : \"1.0-SNAPSHOT\"\n+    },\n+    \"type\" : \"ClusterIP\"\n+  }\n+ }\n }\n ----\n \n An important thing to note about the `Deployment` is that is uses `yourDockerUsername/test-quarkus-app:1.0-SNAPSHOT` as the Docker image of the `Pod`.\n+The name of the image is controlled by the container-image extension and can be customized using the usual `applcation.properties`.\n \n-Also the `Service` is configured to use container port `8080` (which is automatically picked up by the standard Quarkus configuration).\n+For example with a configuration like:\n \n-=== Add readiness and liveness probes\n+[source]\n+----\n+quarkus.container-image.group=quarkus #optional, default to the system user name\n+quarkus.container-image.name=demo-app #optional, defaults to the application name\n+quarkus.container-image.tag=1.0       #optional, defaults to the application version\n+----\n \n-By default the Kubernetes resources do not contain readiness and liveness probes in the generated `Deployment`. Adding them however is just a matter of adding the Smallrye Health extension like so:\n+The image that will be used in the generated manifests will be `quarkus/demo-app:1.0`\n \n-[source,xml]\n+=== Defining a docker registry\n+\n+The docker registry can be specified, with the following property:\n+\n+[source]\n ----\n-    <dependency>\n-      <groupId>io.quarkus</groupId>\n-      <artifactId>quarkus-smallrye-health</artifactId>\n-    </dependency>\n+quarkus.container-image.registry=http://my.docker-registry.net\n ----\n \n-The values of the generated probes will be determined by the configured health properties: `quarkus.smallrye-health.root-path`, `quarkus.smallrye-health.liveness-path` and `quarkus.smallrye-health.readiness-path`.\n-More information about the health extension can be found in the relevant link:microprofile-health[guide].\n+By adding this property along the rest of the container-image properties of the previous section, the generated manifests will use the image `http://my.docker-registry.net/quarkus/demo-app:1.0`.\n \n-=== Using the Kubernetes client\n \n-Applications that are deployed to Kubernetes and need to access the API server, will usually make use of the `kubernetes-client` extension:\n+The image is not the only thing that can be customized in the generated manifests. The kubernetes extension provides a rich set of configuration properties, that allow customization.", "originalCommit": "068eb985325fc7456f2f8da552737cb58e837ed0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzE4OTQ2Ng==", "url": "https://github.com/quarkusio/quarkus/pull/7501#discussion_r387189466", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            To add additional Labels, for example `foo=bar`:\n          \n          \n            \n            To add additional custom labels, for example `foo=bar`:", "author": "gsmet", "createdAt": "2020-03-03T17:49:20Z", "path": "docs/src/main/asciidoc/kubernetes.adoc", "diffHunk": "@@ -120,77 +108,215 @@ The full source of the `kubernetes.json` file looks something like this:\n         }\n       }\n     }\n-  } ]\n+  },\n+  {\n+  \"apiVersion\" : \"v1\",\n+  \"kind\" : \"Service\",\n+    \"metadata\" : {\n+      \"annotations\": {\n+       \"app.quarkus.io/vcs-url\" : \"<some url>\",\n+       \"app.quarkus.io/commit-id\" : \"<some git SHA>\",\n+      },\n+      \"labels\" : {\n+        \"app.kubernetes.io/name\" : \"test-quarkus-app\",\n+        \"app.kubernetes.io/version\" : \"1.0-SNAPSHOT\",\n+      },\n+      \"name\" : \"test-quarkus-app\"\n+    },\n+  \"spec\" : {\n+    \"ports\" : [ {\n+      \"name\" : \"http\",\n+      \"port\" : 8080,\n+      \"targetPort\" : 8080\n+    } ],\n+    \"selector\" : {\n+      \"app.kubernetes.io/name\" : \"test-quarkus-app\",\n+      \"app.kubernetes.io/version\" : \"1.0-SNAPSHOT\"\n+    },\n+    \"type\" : \"ClusterIP\"\n+  }\n+ }\n }\n ----\n \n An important thing to note about the `Deployment` is that is uses `yourDockerUsername/test-quarkus-app:1.0-SNAPSHOT` as the Docker image of the `Pod`.\n+The name of the image is controlled by the container-image extension and can be customized using the usual `applcation.properties`.\n \n-Also the `Service` is configured to use container port `8080` (which is automatically picked up by the standard Quarkus configuration).\n+For example with a configuration like:\n \n-=== Add readiness and liveness probes\n+[source]\n+----\n+quarkus.container-image.group=quarkus #optional, default to the system user name\n+quarkus.container-image.name=demo-app #optional, defaults to the application name\n+quarkus.container-image.tag=1.0       #optional, defaults to the application version\n+----\n \n-By default the Kubernetes resources do not contain readiness and liveness probes in the generated `Deployment`. Adding them however is just a matter of adding the Smallrye Health extension like so:\n+The image that will be used in the generated manifests will be `quarkus/demo-app:1.0`\n \n-[source,xml]\n+=== Defining a docker registry\n+\n+The docker registry can be specified, with the following property:\n+\n+[source]\n ----\n-    <dependency>\n-      <groupId>io.quarkus</groupId>\n-      <artifactId>quarkus-smallrye-health</artifactId>\n-    </dependency>\n+quarkus.container-image.registry=http://my.docker-registry.net\n ----\n \n-The values of the generated probes will be determined by the configured health properties: `quarkus.smallrye-health.root-path`, `quarkus.smallrye-health.liveness-path` and `quarkus.smallrye-health.readiness-path`.\n-More information about the health extension can be found in the relevant link:microprofile-health[guide].\n+By adding this property along the rest of the container-image properties of the previous section, the generated manifests will use the image `http://my.docker-registry.net/quarkus/demo-app:1.0`.\n \n-=== Using the Kubernetes client\n \n-Applications that are deployed to Kubernetes and need to access the API server, will usually make use of the `kubernetes-client` extension:\n+The image is not the only thing that can be customized in the generated manifests. The kubernetes extension provides a rich set of configuration properties, that allow customization.\n \n-[source,xml]\n+=== Labels and Annotations\n+\n+==== Labels\n+\n+The generated manifests use the Kubernetes link:https://kubernetes.io/docs/concepts/overview/working-with-objects/common-labels[recommended labels].\n+These labels can be customized using `quarkus.kubernetes.name`, `quarkus.kubernetes.version` and `quarkus.kubernetes.part-of`.\n+For example by adding the following configuration to your `application.properties`:\n+\n+[source]\n ----\n-    <dependency>\n-      <groupId>io.quarkus</groupId>\n-      <artifactId>quarkus-kubernetes-client</artifactId>\n-    </dependency>\n+quarkus.kubernetes.part-of=todo-app\n+quarkus.kubernetes.name=todo-rest\n+quarkus.kubernetes.version=1.0-rc.1\n ----\n \n-To access the API server from within a Kubernetes cluster, some RBAC related resources are required (e.g. a ServiceAccount, a RoleBinding etc.).\n-So, when the `kubernetes-client` extension is present, the `kubernetes` extension is going to create those resources automatically, so that application will be granted the `view` role.\n-If more roles are required, they will have to be added manually.\n+The generated generated resources will have the labels:\n \n-== Tuning the generated resources using application.properties\n+[source, json]\n+----\n+  \"labels\" : {\n+    \"app.kubernetes.io/part-of\" : \"todo-app\",\n+    \"app.kubernetes.io/name\" : \"todo-rest\",\n+    \"app.kubernetes.io/version\" : \"1.0-rc.1\"\n+  }\n+----\n \n-The Kubernetes extension allows tuning the generated manifest, using the `application.properties` file.\n-Here are some examples:\n+==== Custom Labels\n \n-=== Changing the number of replicas:\n-To change the number of replicas from 1 to  3:\n+To add additional Labels, for example `foo=bar`:", "originalCommit": "068eb985325fc7456f2f8da552737cb58e837ed0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzE4OTY3NQ==", "url": "https://github.com/quarkusio/quarkus/pull/7501#discussion_r387189675", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Out of the box the generated resources will be annotated with version control related information that can be used either by tooling, or by the user for troubleshooting purposes.\n          \n          \n            \n            Out of the box, the generated resources will be annotated with version control related information that can be used either by tooling, or by the user for troubleshooting purposes.", "author": "gsmet", "createdAt": "2020-03-03T17:49:41Z", "path": "docs/src/main/asciidoc/kubernetes.adoc", "diffHunk": "@@ -120,77 +108,215 @@ The full source of the `kubernetes.json` file looks something like this:\n         }\n       }\n     }\n-  } ]\n+  },\n+  {\n+  \"apiVersion\" : \"v1\",\n+  \"kind\" : \"Service\",\n+    \"metadata\" : {\n+      \"annotations\": {\n+       \"app.quarkus.io/vcs-url\" : \"<some url>\",\n+       \"app.quarkus.io/commit-id\" : \"<some git SHA>\",\n+      },\n+      \"labels\" : {\n+        \"app.kubernetes.io/name\" : \"test-quarkus-app\",\n+        \"app.kubernetes.io/version\" : \"1.0-SNAPSHOT\",\n+      },\n+      \"name\" : \"test-quarkus-app\"\n+    },\n+  \"spec\" : {\n+    \"ports\" : [ {\n+      \"name\" : \"http\",\n+      \"port\" : 8080,\n+      \"targetPort\" : 8080\n+    } ],\n+    \"selector\" : {\n+      \"app.kubernetes.io/name\" : \"test-quarkus-app\",\n+      \"app.kubernetes.io/version\" : \"1.0-SNAPSHOT\"\n+    },\n+    \"type\" : \"ClusterIP\"\n+  }\n+ }\n }\n ----\n \n An important thing to note about the `Deployment` is that is uses `yourDockerUsername/test-quarkus-app:1.0-SNAPSHOT` as the Docker image of the `Pod`.\n+The name of the image is controlled by the container-image extension and can be customized using the usual `applcation.properties`.\n \n-Also the `Service` is configured to use container port `8080` (which is automatically picked up by the standard Quarkus configuration).\n+For example with a configuration like:\n \n-=== Add readiness and liveness probes\n+[source]\n+----\n+quarkus.container-image.group=quarkus #optional, default to the system user name\n+quarkus.container-image.name=demo-app #optional, defaults to the application name\n+quarkus.container-image.tag=1.0       #optional, defaults to the application version\n+----\n \n-By default the Kubernetes resources do not contain readiness and liveness probes in the generated `Deployment`. Adding them however is just a matter of adding the Smallrye Health extension like so:\n+The image that will be used in the generated manifests will be `quarkus/demo-app:1.0`\n \n-[source,xml]\n+=== Defining a docker registry\n+\n+The docker registry can be specified, with the following property:\n+\n+[source]\n ----\n-    <dependency>\n-      <groupId>io.quarkus</groupId>\n-      <artifactId>quarkus-smallrye-health</artifactId>\n-    </dependency>\n+quarkus.container-image.registry=http://my.docker-registry.net\n ----\n \n-The values of the generated probes will be determined by the configured health properties: `quarkus.smallrye-health.root-path`, `quarkus.smallrye-health.liveness-path` and `quarkus.smallrye-health.readiness-path`.\n-More information about the health extension can be found in the relevant link:microprofile-health[guide].\n+By adding this property along the rest of the container-image properties of the previous section, the generated manifests will use the image `http://my.docker-registry.net/quarkus/demo-app:1.0`.\n \n-=== Using the Kubernetes client\n \n-Applications that are deployed to Kubernetes and need to access the API server, will usually make use of the `kubernetes-client` extension:\n+The image is not the only thing that can be customized in the generated manifests. The kubernetes extension provides a rich set of configuration properties, that allow customization.\n \n-[source,xml]\n+=== Labels and Annotations\n+\n+==== Labels\n+\n+The generated manifests use the Kubernetes link:https://kubernetes.io/docs/concepts/overview/working-with-objects/common-labels[recommended labels].\n+These labels can be customized using `quarkus.kubernetes.name`, `quarkus.kubernetes.version` and `quarkus.kubernetes.part-of`.\n+For example by adding the following configuration to your `application.properties`:\n+\n+[source]\n ----\n-    <dependency>\n-      <groupId>io.quarkus</groupId>\n-      <artifactId>quarkus-kubernetes-client</artifactId>\n-    </dependency>\n+quarkus.kubernetes.part-of=todo-app\n+quarkus.kubernetes.name=todo-rest\n+quarkus.kubernetes.version=1.0-rc.1\n ----\n \n-To access the API server from within a Kubernetes cluster, some RBAC related resources are required (e.g. a ServiceAccount, a RoleBinding etc.).\n-So, when the `kubernetes-client` extension is present, the `kubernetes` extension is going to create those resources automatically, so that application will be granted the `view` role.\n-If more roles are required, they will have to be added manually.\n+The generated generated resources will have the labels:\n \n-== Tuning the generated resources using application.properties\n+[source, json]\n+----\n+  \"labels\" : {\n+    \"app.kubernetes.io/part-of\" : \"todo-app\",\n+    \"app.kubernetes.io/name\" : \"todo-rest\",\n+    \"app.kubernetes.io/version\" : \"1.0-rc.1\"\n+  }\n+----\n \n-The Kubernetes extension allows tuning the generated manifest, using the `application.properties` file.\n-Here are some examples:\n+==== Custom Labels\n \n-=== Changing the number of replicas:\n-To change the number of replicas from 1 to  3:\n+To add additional Labels, for example `foo=bar`:\n \n [source]\n ----\n-quarkus.kubernetes.replicas=3\n+quarkus.kubernetes.labels.foo=bar\n ----\n \n-=== Defining a docker registry and repository\n+====  Annotations\n+\n+Out of the box the generated resources will be annotated with version control related information that can be used either by tooling, or by the user for troubleshooting purposes.", "originalCommit": "068eb985325fc7456f2f8da552737cb58e837ed0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzE4OTg2NQ==", "url": "https://github.com/quarkusio/quarkus/pull/7501#discussion_r387189865", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Custom annotations can be added in way similar to labels. For example to add the annotation `foo=bar`:\n          \n          \n            \n            Custom annotations can be added in a way similar to labels. For example to add the annotation `foo=bar`:", "author": "gsmet", "createdAt": "2020-03-03T17:50:01Z", "path": "docs/src/main/asciidoc/kubernetes.adoc", "diffHunk": "@@ -120,77 +108,215 @@ The full source of the `kubernetes.json` file looks something like this:\n         }\n       }\n     }\n-  } ]\n+  },\n+  {\n+  \"apiVersion\" : \"v1\",\n+  \"kind\" : \"Service\",\n+    \"metadata\" : {\n+      \"annotations\": {\n+       \"app.quarkus.io/vcs-url\" : \"<some url>\",\n+       \"app.quarkus.io/commit-id\" : \"<some git SHA>\",\n+      },\n+      \"labels\" : {\n+        \"app.kubernetes.io/name\" : \"test-quarkus-app\",\n+        \"app.kubernetes.io/version\" : \"1.0-SNAPSHOT\",\n+      },\n+      \"name\" : \"test-quarkus-app\"\n+    },\n+  \"spec\" : {\n+    \"ports\" : [ {\n+      \"name\" : \"http\",\n+      \"port\" : 8080,\n+      \"targetPort\" : 8080\n+    } ],\n+    \"selector\" : {\n+      \"app.kubernetes.io/name\" : \"test-quarkus-app\",\n+      \"app.kubernetes.io/version\" : \"1.0-SNAPSHOT\"\n+    },\n+    \"type\" : \"ClusterIP\"\n+  }\n+ }\n }\n ----\n \n An important thing to note about the `Deployment` is that is uses `yourDockerUsername/test-quarkus-app:1.0-SNAPSHOT` as the Docker image of the `Pod`.\n+The name of the image is controlled by the container-image extension and can be customized using the usual `applcation.properties`.\n \n-Also the `Service` is configured to use container port `8080` (which is automatically picked up by the standard Quarkus configuration).\n+For example with a configuration like:\n \n-=== Add readiness and liveness probes\n+[source]\n+----\n+quarkus.container-image.group=quarkus #optional, default to the system user name\n+quarkus.container-image.name=demo-app #optional, defaults to the application name\n+quarkus.container-image.tag=1.0       #optional, defaults to the application version\n+----\n \n-By default the Kubernetes resources do not contain readiness and liveness probes in the generated `Deployment`. Adding them however is just a matter of adding the Smallrye Health extension like so:\n+The image that will be used in the generated manifests will be `quarkus/demo-app:1.0`\n \n-[source,xml]\n+=== Defining a docker registry\n+\n+The docker registry can be specified, with the following property:\n+\n+[source]\n ----\n-    <dependency>\n-      <groupId>io.quarkus</groupId>\n-      <artifactId>quarkus-smallrye-health</artifactId>\n-    </dependency>\n+quarkus.container-image.registry=http://my.docker-registry.net\n ----\n \n-The values of the generated probes will be determined by the configured health properties: `quarkus.smallrye-health.root-path`, `quarkus.smallrye-health.liveness-path` and `quarkus.smallrye-health.readiness-path`.\n-More information about the health extension can be found in the relevant link:microprofile-health[guide].\n+By adding this property along the rest of the container-image properties of the previous section, the generated manifests will use the image `http://my.docker-registry.net/quarkus/demo-app:1.0`.\n \n-=== Using the Kubernetes client\n \n-Applications that are deployed to Kubernetes and need to access the API server, will usually make use of the `kubernetes-client` extension:\n+The image is not the only thing that can be customized in the generated manifests. The kubernetes extension provides a rich set of configuration properties, that allow customization.\n \n-[source,xml]\n+=== Labels and Annotations\n+\n+==== Labels\n+\n+The generated manifests use the Kubernetes link:https://kubernetes.io/docs/concepts/overview/working-with-objects/common-labels[recommended labels].\n+These labels can be customized using `quarkus.kubernetes.name`, `quarkus.kubernetes.version` and `quarkus.kubernetes.part-of`.\n+For example by adding the following configuration to your `application.properties`:\n+\n+[source]\n ----\n-    <dependency>\n-      <groupId>io.quarkus</groupId>\n-      <artifactId>quarkus-kubernetes-client</artifactId>\n-    </dependency>\n+quarkus.kubernetes.part-of=todo-app\n+quarkus.kubernetes.name=todo-rest\n+quarkus.kubernetes.version=1.0-rc.1\n ----\n \n-To access the API server from within a Kubernetes cluster, some RBAC related resources are required (e.g. a ServiceAccount, a RoleBinding etc.).\n-So, when the `kubernetes-client` extension is present, the `kubernetes` extension is going to create those resources automatically, so that application will be granted the `view` role.\n-If more roles are required, they will have to be added manually.\n+The generated generated resources will have the labels:\n \n-== Tuning the generated resources using application.properties\n+[source, json]\n+----\n+  \"labels\" : {\n+    \"app.kubernetes.io/part-of\" : \"todo-app\",\n+    \"app.kubernetes.io/name\" : \"todo-rest\",\n+    \"app.kubernetes.io/version\" : \"1.0-rc.1\"\n+  }\n+----\n \n-The Kubernetes extension allows tuning the generated manifest, using the `application.properties` file.\n-Here are some examples:\n+==== Custom Labels\n \n-=== Changing the number of replicas:\n-To change the number of replicas from 1 to  3:\n+To add additional Labels, for example `foo=bar`:\n \n [source]\n ----\n-quarkus.kubernetes.replicas=3\n+quarkus.kubernetes.labels.foo=bar\n ----\n \n-=== Defining a docker registry and repository\n+====  Annotations\n+\n+Out of the box the generated resources will be annotated with version control related information that can be used either by tooling, or by the user for troubleshooting purposes.\n+\n+[source, json]\n+----\n+  \"annotations\": {\n+    \"app.quarkus.io/vcs-url\" : \"<some url>\",\n+    \"app.quarkus.io/commit-id\" : \"<some git SHA>\",\n+   }\n+----\n+\n+==== Custom Annotations\n+\n+Custom annotations can be added in way similar to labels. For example to add the annotation `foo=bar`:", "originalCommit": "068eb985325fc7456f2f8da552737cb58e837ed0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzE5MDM3OQ==", "url": "https://github.com/quarkusio/quarkus/pull/7501#discussion_r387190379", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            You may also noticed that in contrast to labels and annotations for environment variables you don't just use a key=value approach.\n          \n          \n            \n            You may also have noticed that in contrast to labels and annotations for environment variables you don't just use a `key=value` approach.", "author": "gsmet", "createdAt": "2020-03-03T17:50:53Z", "path": "docs/src/main/asciidoc/kubernetes.adoc", "diffHunk": "@@ -120,77 +108,215 @@ The full source of the `kubernetes.json` file looks something like this:\n         }\n       }\n     }\n-  } ]\n+  },\n+  {\n+  \"apiVersion\" : \"v1\",\n+  \"kind\" : \"Service\",\n+    \"metadata\" : {\n+      \"annotations\": {\n+       \"app.quarkus.io/vcs-url\" : \"<some url>\",\n+       \"app.quarkus.io/commit-id\" : \"<some git SHA>\",\n+      },\n+      \"labels\" : {\n+        \"app.kubernetes.io/name\" : \"test-quarkus-app\",\n+        \"app.kubernetes.io/version\" : \"1.0-SNAPSHOT\",\n+      },\n+      \"name\" : \"test-quarkus-app\"\n+    },\n+  \"spec\" : {\n+    \"ports\" : [ {\n+      \"name\" : \"http\",\n+      \"port\" : 8080,\n+      \"targetPort\" : 8080\n+    } ],\n+    \"selector\" : {\n+      \"app.kubernetes.io/name\" : \"test-quarkus-app\",\n+      \"app.kubernetes.io/version\" : \"1.0-SNAPSHOT\"\n+    },\n+    \"type\" : \"ClusterIP\"\n+  }\n+ }\n }\n ----\n \n An important thing to note about the `Deployment` is that is uses `yourDockerUsername/test-quarkus-app:1.0-SNAPSHOT` as the Docker image of the `Pod`.\n+The name of the image is controlled by the container-image extension and can be customized using the usual `applcation.properties`.\n \n-Also the `Service` is configured to use container port `8080` (which is automatically picked up by the standard Quarkus configuration).\n+For example with a configuration like:\n \n-=== Add readiness and liveness probes\n+[source]\n+----\n+quarkus.container-image.group=quarkus #optional, default to the system user name\n+quarkus.container-image.name=demo-app #optional, defaults to the application name\n+quarkus.container-image.tag=1.0       #optional, defaults to the application version\n+----\n \n-By default the Kubernetes resources do not contain readiness and liveness probes in the generated `Deployment`. Adding them however is just a matter of adding the Smallrye Health extension like so:\n+The image that will be used in the generated manifests will be `quarkus/demo-app:1.0`\n \n-[source,xml]\n+=== Defining a docker registry\n+\n+The docker registry can be specified, with the following property:\n+\n+[source]\n ----\n-    <dependency>\n-      <groupId>io.quarkus</groupId>\n-      <artifactId>quarkus-smallrye-health</artifactId>\n-    </dependency>\n+quarkus.container-image.registry=http://my.docker-registry.net\n ----\n \n-The values of the generated probes will be determined by the configured health properties: `quarkus.smallrye-health.root-path`, `quarkus.smallrye-health.liveness-path` and `quarkus.smallrye-health.readiness-path`.\n-More information about the health extension can be found in the relevant link:microprofile-health[guide].\n+By adding this property along the rest of the container-image properties of the previous section, the generated manifests will use the image `http://my.docker-registry.net/quarkus/demo-app:1.0`.\n \n-=== Using the Kubernetes client\n \n-Applications that are deployed to Kubernetes and need to access the API server, will usually make use of the `kubernetes-client` extension:\n+The image is not the only thing that can be customized in the generated manifests. The kubernetes extension provides a rich set of configuration properties, that allow customization.\n \n-[source,xml]\n+=== Labels and Annotations\n+\n+==== Labels\n+\n+The generated manifests use the Kubernetes link:https://kubernetes.io/docs/concepts/overview/working-with-objects/common-labels[recommended labels].\n+These labels can be customized using `quarkus.kubernetes.name`, `quarkus.kubernetes.version` and `quarkus.kubernetes.part-of`.\n+For example by adding the following configuration to your `application.properties`:\n+\n+[source]\n ----\n-    <dependency>\n-      <groupId>io.quarkus</groupId>\n-      <artifactId>quarkus-kubernetes-client</artifactId>\n-    </dependency>\n+quarkus.kubernetes.part-of=todo-app\n+quarkus.kubernetes.name=todo-rest\n+quarkus.kubernetes.version=1.0-rc.1\n ----\n \n-To access the API server from within a Kubernetes cluster, some RBAC related resources are required (e.g. a ServiceAccount, a RoleBinding etc.).\n-So, when the `kubernetes-client` extension is present, the `kubernetes` extension is going to create those resources automatically, so that application will be granted the `view` role.\n-If more roles are required, they will have to be added manually.\n+The generated generated resources will have the labels:\n \n-== Tuning the generated resources using application.properties\n+[source, json]\n+----\n+  \"labels\" : {\n+    \"app.kubernetes.io/part-of\" : \"todo-app\",\n+    \"app.kubernetes.io/name\" : \"todo-rest\",\n+    \"app.kubernetes.io/version\" : \"1.0-rc.1\"\n+  }\n+----\n \n-The Kubernetes extension allows tuning the generated manifest, using the `application.properties` file.\n-Here are some examples:\n+==== Custom Labels\n \n-=== Changing the number of replicas:\n-To change the number of replicas from 1 to  3:\n+To add additional Labels, for example `foo=bar`:\n \n [source]\n ----\n-quarkus.kubernetes.replicas=3\n+quarkus.kubernetes.labels.foo=bar\n ----\n \n-=== Defining a docker registry and repository\n+====  Annotations\n+\n+Out of the box the generated resources will be annotated with version control related information that can be used either by tooling, or by the user for troubleshooting purposes.\n+\n+[source, json]\n+----\n+  \"annotations\": {\n+    \"app.quarkus.io/vcs-url\" : \"<some url>\",\n+    \"app.quarkus.io/commit-id\" : \"<some git SHA>\",\n+   }\n+----\n+\n+==== Custom Annotations\n+\n+Custom annotations can be added in way similar to labels. For example to add the annotation `foo=bar`:\n \n-The docker registry and the user of the docker image can be specified, with the following properties:\n \n [source]\n ----\n-quarkus.kubernetes.group=myUser\n-quarkus.docker.registry=http://my.docker-registry.net\n+quarkus.kubernetes.annotations.foo=bar\n ----\n \n-Note: These options used to be `quarkus.kubernetes.docker.registry` and `quarkus.kubernetes.group` respectively.\n+==== Environment variables\n \n-=== Adding labels:\n-To add a new label to all generated resources, say `foo=bar`:\n+Kubernetes provides multiple ways of defining environment variables:\n+\n+- key value pairs\n+- from Secret\n+- from ConfigMap\n+- from fields\n+\n+To add a key value pair as an environment variable in the generated resources:\n \n [source]\n ----\n-quarkus.kubernetes.labels.foo=bar\n+quarkus.kubernetes.env-vars.my-env-var.value=foobar\n+----\n+\n+The command above will add `MY_ENV_VAR=foobar` as an environment variable.\n+Please note that the key `my-env-var` will be converted to uppercase and dashes will be replaced by underscores resulting in `MY_ENV_VAR`.\n+\n+You may also noticed that in contrast to labels and annotations for environment variables you don't just use a key=value approach.", "originalCommit": "068eb985325fc7456f2f8da552737cb58e837ed0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzE5MDcyNg==", "url": "https://github.com/quarkusio/quarkus/pull/7501#discussion_r387190726", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            This will add a mount to my pod for volume `my-voume` to path `/where/to/mount`\n          \n          \n            \n            This will add a mount to my pod for volume `my-volume` to path `/where/to/mount`.", "author": "gsmet", "createdAt": "2020-03-03T17:51:32Z", "path": "docs/src/main/asciidoc/kubernetes.adoc", "diffHunk": "@@ -120,77 +108,215 @@ The full source of the `kubernetes.json` file looks something like this:\n         }\n       }\n     }\n-  } ]\n+  },\n+  {\n+  \"apiVersion\" : \"v1\",\n+  \"kind\" : \"Service\",\n+    \"metadata\" : {\n+      \"annotations\": {\n+       \"app.quarkus.io/vcs-url\" : \"<some url>\",\n+       \"app.quarkus.io/commit-id\" : \"<some git SHA>\",\n+      },\n+      \"labels\" : {\n+        \"app.kubernetes.io/name\" : \"test-quarkus-app\",\n+        \"app.kubernetes.io/version\" : \"1.0-SNAPSHOT\",\n+      },\n+      \"name\" : \"test-quarkus-app\"\n+    },\n+  \"spec\" : {\n+    \"ports\" : [ {\n+      \"name\" : \"http\",\n+      \"port\" : 8080,\n+      \"targetPort\" : 8080\n+    } ],\n+    \"selector\" : {\n+      \"app.kubernetes.io/name\" : \"test-quarkus-app\",\n+      \"app.kubernetes.io/version\" : \"1.0-SNAPSHOT\"\n+    },\n+    \"type\" : \"ClusterIP\"\n+  }\n+ }\n }\n ----\n \n An important thing to note about the `Deployment` is that is uses `yourDockerUsername/test-quarkus-app:1.0-SNAPSHOT` as the Docker image of the `Pod`.\n+The name of the image is controlled by the container-image extension and can be customized using the usual `applcation.properties`.\n \n-Also the `Service` is configured to use container port `8080` (which is automatically picked up by the standard Quarkus configuration).\n+For example with a configuration like:\n \n-=== Add readiness and liveness probes\n+[source]\n+----\n+quarkus.container-image.group=quarkus #optional, default to the system user name\n+quarkus.container-image.name=demo-app #optional, defaults to the application name\n+quarkus.container-image.tag=1.0       #optional, defaults to the application version\n+----\n \n-By default the Kubernetes resources do not contain readiness and liveness probes in the generated `Deployment`. Adding them however is just a matter of adding the Smallrye Health extension like so:\n+The image that will be used in the generated manifests will be `quarkus/demo-app:1.0`\n \n-[source,xml]\n+=== Defining a docker registry\n+\n+The docker registry can be specified, with the following property:\n+\n+[source]\n ----\n-    <dependency>\n-      <groupId>io.quarkus</groupId>\n-      <artifactId>quarkus-smallrye-health</artifactId>\n-    </dependency>\n+quarkus.container-image.registry=http://my.docker-registry.net\n ----\n \n-The values of the generated probes will be determined by the configured health properties: `quarkus.smallrye-health.root-path`, `quarkus.smallrye-health.liveness-path` and `quarkus.smallrye-health.readiness-path`.\n-More information about the health extension can be found in the relevant link:microprofile-health[guide].\n+By adding this property along the rest of the container-image properties of the previous section, the generated manifests will use the image `http://my.docker-registry.net/quarkus/demo-app:1.0`.\n \n-=== Using the Kubernetes client\n \n-Applications that are deployed to Kubernetes and need to access the API server, will usually make use of the `kubernetes-client` extension:\n+The image is not the only thing that can be customized in the generated manifests. The kubernetes extension provides a rich set of configuration properties, that allow customization.\n \n-[source,xml]\n+=== Labels and Annotations\n+\n+==== Labels\n+\n+The generated manifests use the Kubernetes link:https://kubernetes.io/docs/concepts/overview/working-with-objects/common-labels[recommended labels].\n+These labels can be customized using `quarkus.kubernetes.name`, `quarkus.kubernetes.version` and `quarkus.kubernetes.part-of`.\n+For example by adding the following configuration to your `application.properties`:\n+\n+[source]\n ----\n-    <dependency>\n-      <groupId>io.quarkus</groupId>\n-      <artifactId>quarkus-kubernetes-client</artifactId>\n-    </dependency>\n+quarkus.kubernetes.part-of=todo-app\n+quarkus.kubernetes.name=todo-rest\n+quarkus.kubernetes.version=1.0-rc.1\n ----\n \n-To access the API server from within a Kubernetes cluster, some RBAC related resources are required (e.g. a ServiceAccount, a RoleBinding etc.).\n-So, when the `kubernetes-client` extension is present, the `kubernetes` extension is going to create those resources automatically, so that application will be granted the `view` role.\n-If more roles are required, they will have to be added manually.\n+The generated generated resources will have the labels:\n \n-== Tuning the generated resources using application.properties\n+[source, json]\n+----\n+  \"labels\" : {\n+    \"app.kubernetes.io/part-of\" : \"todo-app\",\n+    \"app.kubernetes.io/name\" : \"todo-rest\",\n+    \"app.kubernetes.io/version\" : \"1.0-rc.1\"\n+  }\n+----\n \n-The Kubernetes extension allows tuning the generated manifest, using the `application.properties` file.\n-Here are some examples:\n+==== Custom Labels\n \n-=== Changing the number of replicas:\n-To change the number of replicas from 1 to  3:\n+To add additional Labels, for example `foo=bar`:\n \n [source]\n ----\n-quarkus.kubernetes.replicas=3\n+quarkus.kubernetes.labels.foo=bar\n ----\n \n-=== Defining a docker registry and repository\n+====  Annotations\n+\n+Out of the box the generated resources will be annotated with version control related information that can be used either by tooling, or by the user for troubleshooting purposes.\n+\n+[source, json]\n+----\n+  \"annotations\": {\n+    \"app.quarkus.io/vcs-url\" : \"<some url>\",\n+    \"app.quarkus.io/commit-id\" : \"<some git SHA>\",\n+   }\n+----\n+\n+==== Custom Annotations\n+\n+Custom annotations can be added in way similar to labels. For example to add the annotation `foo=bar`:\n \n-The docker registry and the user of the docker image can be specified, with the following properties:\n \n [source]\n ----\n-quarkus.kubernetes.group=myUser\n-quarkus.docker.registry=http://my.docker-registry.net\n+quarkus.kubernetes.annotations.foo=bar\n ----\n \n-Note: These options used to be `quarkus.kubernetes.docker.registry` and `quarkus.kubernetes.group` respectively.\n+==== Environment variables\n \n-=== Adding labels:\n-To add a new label to all generated resources, say `foo=bar`:\n+Kubernetes provides multiple ways of defining environment variables:\n+\n+- key value pairs\n+- from Secret\n+- from ConfigMap\n+- from fields\n+\n+To add a key value pair as an environment variable in the generated resources:\n \n [source]\n ----\n-quarkus.kubernetes.labels.foo=bar\n+quarkus.kubernetes.env-vars.my-env-var.value=foobar\n+----\n+\n+The command above will add `MY_ENV_VAR=foobar` as an environment variable.\n+Please note that the key `my-env-var` will be converted to uppercase and dashes will be replaced by underscores resulting in `MY_ENV_VAR`.\n+\n+You may also noticed that in contrast to labels and annotations for environment variables you don't just use a key=value approach.\n+That is because for environment variables there are additional options rather than just setting a value.\n+\n+===== Environment variables from Secret\n+\n+To add all key value pairs of a `Secret` as environment variables:\n+\n+[source]\n+----\n+quarkus.kubernetes.env-vars.my-env-var.secret=my-secret\n+----\n+\n+===== Environment variables from ConfigMap\n+\n+To add all key value pairs of a `ConfigMap` as environment variables:\n+\n+[source]\n+----\n+quarkus.kubernetes.env-vars.my-env-var.configmap=my-secret\n+----\n+\n+\n+==== Mounting volumes\n+\n+The Kubernetes extension allows the user to configure both volumes and mounts for the application.\n+\n+Any volume can be mounted with a simple configuration:\n+\n+[source]\n+----\n+quarkus.kubernetes.mounts.my-volume.path=/where/to/mount\n+----\n+\n+This will add a mount to my pod for volume `my-voume` to path `/where/to/mount`", "originalCommit": "068eb985325fc7456f2f8da552737cb58e837ed0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzE5MDk1MA==", "url": "https://github.com/quarkusio/quarkus/pull/7501#discussion_r387190950", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            By default the Kubernetes resources do not contain readiness and liveness probes in the generated `Deployment`. Adding them however is just a matter of adding the Smallrye Health extension like so:\n          \n          \n            \n            By default the Kubernetes resources do not contain readiness and liveness probes in the generated `Deployment`. Adding them however is just a matter of adding the SmallRye Health extension like so:", "author": "gsmet", "createdAt": "2020-03-03T17:51:58Z", "path": "docs/src/main/asciidoc/kubernetes.adoc", "diffHunk": "@@ -120,77 +108,215 @@ The full source of the `kubernetes.json` file looks something like this:\n         }\n       }\n     }\n-  } ]\n+  },\n+  {\n+  \"apiVersion\" : \"v1\",\n+  \"kind\" : \"Service\",\n+    \"metadata\" : {\n+      \"annotations\": {\n+       \"app.quarkus.io/vcs-url\" : \"<some url>\",\n+       \"app.quarkus.io/commit-id\" : \"<some git SHA>\",\n+      },\n+      \"labels\" : {\n+        \"app.kubernetes.io/name\" : \"test-quarkus-app\",\n+        \"app.kubernetes.io/version\" : \"1.0-SNAPSHOT\",\n+      },\n+      \"name\" : \"test-quarkus-app\"\n+    },\n+  \"spec\" : {\n+    \"ports\" : [ {\n+      \"name\" : \"http\",\n+      \"port\" : 8080,\n+      \"targetPort\" : 8080\n+    } ],\n+    \"selector\" : {\n+      \"app.kubernetes.io/name\" : \"test-quarkus-app\",\n+      \"app.kubernetes.io/version\" : \"1.0-SNAPSHOT\"\n+    },\n+    \"type\" : \"ClusterIP\"\n+  }\n+ }\n }\n ----\n \n An important thing to note about the `Deployment` is that is uses `yourDockerUsername/test-quarkus-app:1.0-SNAPSHOT` as the Docker image of the `Pod`.\n+The name of the image is controlled by the container-image extension and can be customized using the usual `applcation.properties`.\n \n-Also the `Service` is configured to use container port `8080` (which is automatically picked up by the standard Quarkus configuration).\n+For example with a configuration like:\n \n-=== Add readiness and liveness probes\n+[source]\n+----\n+quarkus.container-image.group=quarkus #optional, default to the system user name\n+quarkus.container-image.name=demo-app #optional, defaults to the application name\n+quarkus.container-image.tag=1.0       #optional, defaults to the application version\n+----\n \n-By default the Kubernetes resources do not contain readiness and liveness probes in the generated `Deployment`. Adding them however is just a matter of adding the Smallrye Health extension like so:\n+The image that will be used in the generated manifests will be `quarkus/demo-app:1.0`\n \n-[source,xml]\n+=== Defining a docker registry\n+\n+The docker registry can be specified, with the following property:\n+\n+[source]\n ----\n-    <dependency>\n-      <groupId>io.quarkus</groupId>\n-      <artifactId>quarkus-smallrye-health</artifactId>\n-    </dependency>\n+quarkus.container-image.registry=http://my.docker-registry.net\n ----\n \n-The values of the generated probes will be determined by the configured health properties: `quarkus.smallrye-health.root-path`, `quarkus.smallrye-health.liveness-path` and `quarkus.smallrye-health.readiness-path`.\n-More information about the health extension can be found in the relevant link:microprofile-health[guide].\n+By adding this property along the rest of the container-image properties of the previous section, the generated manifests will use the image `http://my.docker-registry.net/quarkus/demo-app:1.0`.\n \n-=== Using the Kubernetes client\n \n-Applications that are deployed to Kubernetes and need to access the API server, will usually make use of the `kubernetes-client` extension:\n+The image is not the only thing that can be customized in the generated manifests. The kubernetes extension provides a rich set of configuration properties, that allow customization.\n \n-[source,xml]\n+=== Labels and Annotations\n+\n+==== Labels\n+\n+The generated manifests use the Kubernetes link:https://kubernetes.io/docs/concepts/overview/working-with-objects/common-labels[recommended labels].\n+These labels can be customized using `quarkus.kubernetes.name`, `quarkus.kubernetes.version` and `quarkus.kubernetes.part-of`.\n+For example by adding the following configuration to your `application.properties`:\n+\n+[source]\n ----\n-    <dependency>\n-      <groupId>io.quarkus</groupId>\n-      <artifactId>quarkus-kubernetes-client</artifactId>\n-    </dependency>\n+quarkus.kubernetes.part-of=todo-app\n+quarkus.kubernetes.name=todo-rest\n+quarkus.kubernetes.version=1.0-rc.1\n ----\n \n-To access the API server from within a Kubernetes cluster, some RBAC related resources are required (e.g. a ServiceAccount, a RoleBinding etc.).\n-So, when the `kubernetes-client` extension is present, the `kubernetes` extension is going to create those resources automatically, so that application will be granted the `view` role.\n-If more roles are required, they will have to be added manually.\n+The generated generated resources will have the labels:\n \n-== Tuning the generated resources using application.properties\n+[source, json]\n+----\n+  \"labels\" : {\n+    \"app.kubernetes.io/part-of\" : \"todo-app\",\n+    \"app.kubernetes.io/name\" : \"todo-rest\",\n+    \"app.kubernetes.io/version\" : \"1.0-rc.1\"\n+  }\n+----\n \n-The Kubernetes extension allows tuning the generated manifest, using the `application.properties` file.\n-Here are some examples:\n+==== Custom Labels\n \n-=== Changing the number of replicas:\n-To change the number of replicas from 1 to  3:\n+To add additional Labels, for example `foo=bar`:\n \n [source]\n ----\n-quarkus.kubernetes.replicas=3\n+quarkus.kubernetes.labels.foo=bar\n ----\n \n-=== Defining a docker registry and repository\n+====  Annotations\n+\n+Out of the box the generated resources will be annotated with version control related information that can be used either by tooling, or by the user for troubleshooting purposes.\n+\n+[source, json]\n+----\n+  \"annotations\": {\n+    \"app.quarkus.io/vcs-url\" : \"<some url>\",\n+    \"app.quarkus.io/commit-id\" : \"<some git SHA>\",\n+   }\n+----\n+\n+==== Custom Annotations\n+\n+Custom annotations can be added in way similar to labels. For example to add the annotation `foo=bar`:\n \n-The docker registry and the user of the docker image can be specified, with the following properties:\n \n [source]\n ----\n-quarkus.kubernetes.group=myUser\n-quarkus.docker.registry=http://my.docker-registry.net\n+quarkus.kubernetes.annotations.foo=bar\n ----\n \n-Note: These options used to be `quarkus.kubernetes.docker.registry` and `quarkus.kubernetes.group` respectively.\n+==== Environment variables\n \n-=== Adding labels:\n-To add a new label to all generated resources, say `foo=bar`:\n+Kubernetes provides multiple ways of defining environment variables:\n+\n+- key value pairs\n+- from Secret\n+- from ConfigMap\n+- from fields\n+\n+To add a key value pair as an environment variable in the generated resources:\n \n [source]\n ----\n-quarkus.kubernetes.labels.foo=bar\n+quarkus.kubernetes.env-vars.my-env-var.value=foobar\n+----\n+\n+The command above will add `MY_ENV_VAR=foobar` as an environment variable.\n+Please note that the key `my-env-var` will be converted to uppercase and dashes will be replaced by underscores resulting in `MY_ENV_VAR`.\n+\n+You may also noticed that in contrast to labels and annotations for environment variables you don't just use a key=value approach.\n+That is because for environment variables there are additional options rather than just setting a value.\n+\n+===== Environment variables from Secret\n+\n+To add all key value pairs of a `Secret` as environment variables:\n+\n+[source]\n+----\n+quarkus.kubernetes.env-vars.my-env-var.secret=my-secret\n+----\n+\n+===== Environment variables from ConfigMap\n+\n+To add all key value pairs of a `ConfigMap` as environment variables:\n+\n+[source]\n+----\n+quarkus.kubernetes.env-vars.my-env-var.configmap=my-secret\n+----\n+\n+\n+==== Mounting volumes\n+\n+The Kubernetes extension allows the user to configure both volumes and mounts for the application.\n+\n+Any volume can be mounted with a simple configuration:\n+\n+[source]\n+----\n+quarkus.kubernetes.mounts.my-volume.path=/where/to/mount\n+----\n+\n+This will add a mount to my pod for volume `my-voume` to path `/where/to/mount`\n+\n+The volumes themselves can be configured as shown in the sections below:\n+\n+===== Secret volumes\n+\n+[source]\n+----\n+quarkus.kubernetes.secret-volumes.my-volume.secret-name=my-secret\n+----\n+\n+===== ConfigMap volumes\n+\n+[source]\n+----\n+quarkus.kubernetes.config-map-volumes.my-volume.config-map-name=my-secret\n+----\n+\n+=== Changing the number of replicas:\n+\n+To change the number of replicas from 1 to 3:\n+\n+[source]\n ----\n+quarkus.kubernetes.replicas=3\n+----\n+\n+=== Add readiness and liveness probes\n+\n+By default the Kubernetes resources do not contain readiness and liveness probes in the generated `Deployment`. Adding them however is just a matter of adding the Smallrye Health extension like so:", "originalCommit": "068eb985325fc7456f2f8da552737cb58e837ed0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzE5MTQzMA==", "url": "https://github.com/quarkusio/quarkus/pull/7501#discussion_r387191430", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Applications that are deployed to Kubernetes and need to access the API server, will usually make use of the `kubernetes-client` extension:\n          \n          \n            \n            Applications that are deployed to Kubernetes and need to access the API server will usually make use of the `kubernetes-client` extension:", "author": "gsmet", "createdAt": "2020-03-03T17:52:55Z", "path": "docs/src/main/asciidoc/kubernetes.adoc", "diffHunk": "@@ -203,16 +329,37 @@ quarkus.kubernetes.readiness-probe.period-seconds=45\n \n Here you can find a complete reference to all the available configuration options:\n \n-==== Configuration options\n+=== Using the Kubernetes client\n+\n+Applications that are deployed to Kubernetes and need to access the API server, will usually make use of the `kubernetes-client` extension:", "originalCommit": "068eb985325fc7456f2f8da552737cb58e837ed0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "b9da790bd76943a155db75f699c4e7648d5d8575", "url": "https://github.com/quarkusio/quarkus/commit/b9da790bd76943a155db75f699c4e7648d5d8575", "message": "chore: Show warning about certs on s2i builds too", "committedDate": "2020-03-03T19:14:12Z", "type": "forcePushed"}, {"oid": "80572c6518a62b8702b77cafe94dbb2d38fcc664", "url": "https://github.com/quarkusio/quarkus/commit/80572c6518a62b8702b77cafe94dbb2d38fcc664", "message": "feat: Add custom labels for vcs info", "committedDate": "2020-03-05T11:12:34Z", "type": "commit"}, {"oid": "4d763a7f2eef488f49f0e1086ce8587c2eb3f04b", "url": "https://github.com/quarkusio/quarkus/commit/4d763a7f2eef488f49f0e1086ce8587c2eb3f04b", "message": "feat: Adopt recommended k8s/openshift labels", "committedDate": "2020-03-05T11:13:25Z", "type": "commit"}, {"oid": "ce576fd9312e18f2e750dad142aa88f6a8a741a4", "url": "https://github.com/quarkusio/quarkus/commit/ce576fd9312e18f2e750dad142aa88f6a8a741a4", "message": "fix: Openshift DEPLOYMENT_CONFIG constant", "committedDate": "2020-03-05T11:13:25Z", "type": "commit"}, {"oid": "7e307b1ed012fd94d185cc2030d6a57b9764f638", "url": "https://github.com/quarkusio/quarkus/commit/7e307b1ed012fd94d185cc2030d6a57b9764f638", "message": "doc: Align kubernetes.adoc with recent changes", "committedDate": "2020-03-05T11:13:25Z", "type": "commit"}, {"oid": "2e53b5e6c9ba4c5a26c277761a8297991a8d4ffa", "url": "https://github.com/quarkusio/quarkus/commit/2e53b5e6c9ba4c5a26c277761a8297991a8d4ffa", "message": "feat: Adopt recommended k8s/openshift labels", "committedDate": "2020-03-05T11:13:25Z", "type": "commit"}, {"oid": "f3f85159afe3cffccb8637f6591a791cc945644c", "url": "https://github.com/quarkusio/quarkus/commit/f3f85159afe3cffccb8637f6591a791cc945644c", "message": "chore: Show warning about certs on s2i builds too", "committedDate": "2020-03-05T11:13:25Z", "type": "commit"}, {"oid": "f3f85159afe3cffccb8637f6591a791cc945644c", "url": "https://github.com/quarkusio/quarkus/commit/f3f85159afe3cffccb8637f6591a791cc945644c", "message": "chore: Show warning about certs on s2i builds too", "committedDate": "2020-03-05T11:13:25Z", "type": "forcePushed"}]}