{"pr_number": 10896, "pr_title": "Register PropertyCodecProvider automatically", "pr_createdAt": "2020-07-22T08:56:54Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/10896", "timeline": [{"oid": "a3d23cb6513d26b0a678b67a2444de6629663804", "url": "https://github.com/quarkusio/quarkus/commit/a3d23cb6513d26b0a678b67a2444de6629663804", "message": "Register PropertyCodecProvider automatically\n\nFixes #10528", "committedDate": "2020-07-31T12:07:35Z", "type": "forcePushed"}, {"oid": "25e2428653dfe3c572a6747d4172ca560e9d48a6", "url": "https://github.com/quarkusio/quarkus/commit/25e2428653dfe3c572a6747d4172ca560e9d48a6", "message": "Register PropertyCodecProvider automatically\n\nFixes #10528", "committedDate": "2020-08-12T12:44:12Z", "type": "forcePushed"}, {"oid": "f204fce2c2f42979e70f9540403ff7e49fd9a5dc", "url": "https://github.com/quarkusio/quarkus/commit/f204fce2c2f42979e70f9540403ff7e49fd9a5dc", "message": "Register PropertyCodecProvider automatically\n\nFixes #10528", "committedDate": "2020-09-14T09:21:57Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzg1NTUyMA==", "url": "https://github.com/quarkusio/quarkus/pull/10896#discussion_r487855520", "bodyText": "Does this class get used anywhere?", "author": "geoand", "createdAt": "2020-09-14T11:58:13Z", "path": "integration-tests/mongodb-client/src/main/java/io/quarkus/it/mongodb/pojo/OptionalPropertyCodecProvider.java", "diffHunk": "@@ -0,0 +1,61 @@\n+package io.quarkus.it.mongodb.pojo;\n+\n+import java.util.Optional;\n+\n+import org.bson.BsonReader;\n+import org.bson.BsonWriter;\n+import org.bson.codecs.Codec;\n+import org.bson.codecs.DecoderContext;\n+import org.bson.codecs.EncoderContext;\n+import org.bson.codecs.pojo.PropertyCodecProvider;\n+import org.bson.codecs.pojo.PropertyCodecRegistry;\n+import org.bson.codecs.pojo.TypeWithTypeParameters;\n+\n+/**\n+ * This PropertyCodecProvider register a codec provider for the Optional type.\n+ * This allows the POJO Codec to handle it as it's a generic type.\n+ * See: http://mongodb.github.io/mongo-java-driver/3.12/bson/pojos/#generics-support\n+ */\n+public class OptionalPropertyCodecProvider implements PropertyCodecProvider {", "originalCommit": "f204fce2c2f42979e70f9540403ff7e49fd9a5dc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzg1NjkyOA==", "url": "https://github.com/quarkusio/quarkus/pull/10896#discussion_r487856928", "bodyText": "Yes, this is the purpose of this PR ;)\nIt will be discovered by the processor and used when creating the POJO Codec.\nMaybe I need to provie a better javadoc comment to explain this.", "author": "loicmathieu", "createdAt": "2020-09-14T12:00:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzg1NTUyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzg1OTQ5MA==", "url": "https://github.com/quarkusio/quarkus/pull/10896#discussion_r487859490", "bodyText": "Ah OK, now I see...\nThis is part of the integration test, not the extension itself. I thought this was part of the extension and was wondering how it got registered...\nSo I suggest that you enhance the comment of this class to make it evident that it gets discovered  and automatically registered by the extension - I am sure we'll forget in a while :)", "author": "geoand", "createdAt": "2020-09-14T12:05:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzg1NTUyMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzg2NTg2Mg==", "url": "https://github.com/quarkusio/quarkus/pull/10896#discussion_r487865862", "bodyText": "Why can't we do it automatically in the extension? I'm not sure I understand what the problem is?", "author": "gsmet", "createdAt": "2020-09-14T12:17:14Z", "path": "docs/src/main/asciidoc/mongodb.adoc", "diffHunk": "@@ -573,6 +573,11 @@ a discriminator field inside the document. It can be useful when working with ab\n \n Quarkus will automatically register all the classes annotated with `@BsonDiscriminator` with the POJO codec.\n \n+The POJO Codec have enhanced generic support via `PropertyCodecProvider`,\n+Quarkus will automatically register any `PropertyCodecProvider` with the POJO Codec.\n+If you deploy your application as a native executable, be aware that reflection may not work properly with generic types, so you may need to register it manually for reflection,", "originalCommit": "f204fce2c2f42979e70f9540403ff7e49fd9a5dc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzkzMTY1Ng==", "url": "https://github.com/quarkusio/quarkus/pull/10896#discussion_r487931656", "bodyText": "It's a general comment on generic usage, we cannot know which type will be used so if no code use it in a way that we can discover it (for example, this type is not an entity, not returned by JAX-RS, ...) it may be missing on the native image.\nThis sentence comes from some discussion around generic type usage, I don't remember it precisely", "author": "loicmathieu", "createdAt": "2020-09-14T13:47:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzg2NTg2Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODQ0MjAyNw==", "url": "https://github.com/quarkusio/quarkus/pull/10896#discussion_r488442027", "bodyText": "@gsmet are you OK with this comment or do you want me to change it ?", "author": "loicmathieu", "createdAt": "2020-09-15T07:20:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzg2NTg2Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODUxMDU2OA==", "url": "https://github.com/quarkusio/quarkus/pull/10896#discussion_r488510568", "bodyText": "I still don't understand what the problem is. Could you give an example of what is supposedly not working?", "author": "gsmet", "createdAt": "2020-09-15T09:11:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzg2NTg2Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODYxMzg0Ng==", "url": "https://github.com/quarkusio/quarkus/pull/10896#discussion_r488613846", "bodyText": "If you use an Optional<T> as a field of a of Pojo class and use a MySubPojo class at runtime as T in a way that can be discovered by GraalVM (for example, don't return it from a JAX-RS endpoint or stuff like this), you may need to register it for reflection.", "author": "loicmathieu", "createdAt": "2020-09-15T12:08:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzg2NTg2Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODYxMzkzNw==", "url": "https://github.com/quarkusio/quarkus/pull/10896#discussion_r488613937", "bodyText": "I can remove this sentence if you prefere", "author": "loicmathieu", "createdAt": "2020-09-15T12:08:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzg2NTg2Mg=="}], "type": "inlineReview"}, {"oid": "74524307dc561218481d159fc5e27531ebcc34c4", "url": "https://github.com/quarkusio/quarkus/commit/74524307dc561218481d159fc5e27531ebcc34c4", "message": "Register PropertyCodecProvider automatically\n\nFixes #10528", "committedDate": "2020-10-08T07:43:04Z", "type": "forcePushed"}, {"oid": "60ca95f6f24c58dd5fd3d4c779fed2c213761a78", "url": "https://github.com/quarkusio/quarkus/commit/60ca95f6f24c58dd5fd3d4c779fed2c213761a78", "message": "Register PropertyCodecProvider automaticallly", "committedDate": "2020-10-08T07:46:40Z", "type": "commit"}, {"oid": "60ca95f6f24c58dd5fd3d4c779fed2c213761a78", "url": "https://github.com/quarkusio/quarkus/commit/60ca95f6f24c58dd5fd3d4c779fed2c213761a78", "message": "Register PropertyCodecProvider automaticallly", "committedDate": "2020-10-08T07:46:40Z", "type": "forcePushed"}]}