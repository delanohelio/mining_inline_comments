{"pr_number": 9732, "pr_title": "Reactive db2 client", "pr_createdAt": "2020-06-02T17:25:06Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/9732", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDEzMjc4OQ==", "url": "https://github.com/quarkusio/quarkus/pull/9732#discussion_r434132789", "bodyText": "IBM and Red Hat both :)\nLooks correct, but I believe we generally don't have such notices? I see the other reactive integration tests have them, but not other module.", "author": "Sanne", "createdAt": "2020-06-02T19:41:42Z", "path": "integration-tests/reactive-db2-client/pom.xml", "diffHunk": "@@ -0,0 +1,265 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!--\n+  ~ Copyright 2020 IBM Corporation", "originalCommit": "ab1a50222ed2b495bd26a37bc25ce9ea2cd8c1e5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDEzNTYyMQ==", "url": "https://github.com/quarkusio/quarkus/pull/9732#discussion_r434135621", "bodyText": "Yea I noticed the other reactive DB integration tests had this header, so I changed it to IBM since it was me who was creating the file", "author": "aguibert", "createdAt": "2020-06-02T19:47:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDEzMjc4OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDM3MDgyNg==", "url": "https://github.com/quarkusio/quarkus/pull/9732#discussion_r434370826", "bodyText": "I would be in favor of removing the header completely if possible.", "author": "cescoffier", "createdAt": "2020-06-03T07:43:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDEzMjc4OQ=="}], "type": "inlineReview"}, {"oid": "bab9a32ec1efe81787111c919d44edc51804130c", "url": "https://github.com/quarkusio/quarkus/commit/bab9a32ec1efe81787111c919d44edc51804130c", "message": "Add reactive DB2 client to CI jobs", "committedDate": "2020-06-02T20:23:21Z", "type": "forcePushed"}, {"oid": "61676922c539b8248d9cd7fa941034eab2094d62", "url": "https://github.com/quarkusio/quarkus/commit/61676922c539b8248d9cd7fa941034eab2094d62", "message": "Add reactive DB2 client to CI jobs", "committedDate": "2020-06-02T23:25:05Z", "type": "forcePushed"}, {"oid": "07492d51146d85b3478dd2f4d6ce02cdcda7ae24", "url": "https://github.com/quarkusio/quarkus/commit/07492d51146d85b3478dd2f4d6ce02cdcda7ae24", "message": "Add reactive DB2 client to CI jobs", "committedDate": "2020-06-03T03:16:08Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDM2NzQwOQ==", "url": "https://github.com/quarkusio/quarkus/pull/9732#discussion_r434367409", "bodyText": "Why are surefire tests skipped?", "author": "cescoffier", "createdAt": "2020-06-03T07:36:37Z", "path": "extensions/reactive-db2-client/deployment/pom.xml", "diffHunk": "@@ -0,0 +1,63 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+    <modelVersion>4.0.0</modelVersion>\n+\n+    <parent>\n+        <groupId>io.quarkus</groupId>\n+        <artifactId>quarkus-reactive-db2-client-parent</artifactId>\n+        <version>999-SNAPSHOT</version>\n+        <relativePath>../</relativePath>\n+    </parent>\n+\n+    <artifactId>quarkus-reactive-db2-client-deployment</artifactId>\n+\n+    <name>Quarkus - Reactive DB2 Client - Deployment</name>\n+\n+    <dependencies>\n+        <dependency>\n+            <groupId>io.quarkus</groupId>\n+            <artifactId>quarkus-reactive-datasource-deployment</artifactId>\n+        </dependency>\n+        <dependency>\n+            <groupId>io.quarkus</groupId>\n+            <artifactId>quarkus-vertx-deployment</artifactId>\n+        </dependency>\n+        <dependency>\n+            <groupId>io.quarkus</groupId>\n+            <artifactId>quarkus-credentials-deployment</artifactId>\n+        </dependency>\n+        <dependency>\n+            <groupId>io.quarkus</groupId>\n+            <artifactId>quarkus-reactive-db2-client</artifactId>\n+        </dependency>\n+        <dependency>\n+            <groupId>io.quarkus</groupId>\n+            <artifactId>quarkus-smallrye-health-spi</artifactId>\n+        </dependency>\n+    </dependencies>\n+\n+    <build>\n+        <plugins>\n+            <plugin>\n+                <artifactId>maven-compiler-plugin</artifactId>\n+                <configuration>\n+                    <annotationProcessorPaths>\n+                        <path>\n+                            <groupId>io.quarkus</groupId>\n+                            <artifactId>quarkus-extension-processor</artifactId>\n+                            <version>${project.version}</version>\n+                        </path>\n+                    </annotationProcessorPaths>\n+                </configuration>\n+            </plugin>\n+            <plugin>\n+                <artifactId>maven-surefire-plugin</artifactId>\n+                <configuration>\n+                    <skip>true</skip>", "originalCommit": "07492d51146d85b3478dd2f4d6ce02cdcda7ae24", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDQ0NTMzOQ==", "url": "https://github.com/quarkusio/quarkus/pull/9732#discussion_r434445339", "bodyText": "+1\nIf there's a good reason let's add a comment.", "author": "Sanne", "createdAt": "2020-06-03T09:48:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDM2NzQwOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDYxMTQzNQ==", "url": "https://github.com/quarkusio/quarkus/pull/9732#discussion_r434611435", "bodyText": "This was copied from another reactive db module that was requiring a DB for unit tests and enabling them with a sys props, but since I don't have any unit tests for this module I'll just remove this block", "author": "aguibert", "createdAt": "2020-06-03T14:29:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDM2NzQwOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDM2ODQ2Ng==", "url": "https://github.com/quarkusio/quarkus/pull/9732#discussion_r434368466", "bodyText": "Importing the smallrye-mutiny-vertx-db2-client should bring vertx-db2-client", "author": "cescoffier", "createdAt": "2020-06-03T07:38:32Z", "path": "extensions/reactive-db2-client/runtime/pom.xml", "diffHunk": "@@ -0,0 +1,67 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+    <modelVersion>4.0.0</modelVersion>\n+\n+    <parent>\n+        <groupId>io.quarkus</groupId>\n+        <artifactId>quarkus-reactive-db2-client-parent</artifactId>\n+        <version>999-SNAPSHOT</version>\n+        <relativePath>../</relativePath>\n+    </parent>\n+\n+    <artifactId>quarkus-reactive-db2-client</artifactId>\n+\n+    <name>Quarkus - Reactive DB2 Client - Runtime</name>\n+    <description>Connect to the DB2 database using the reactive pattern</description>\n+    <dependencies>\n+        <dependency>\n+            <groupId>io.quarkus</groupId>\n+            <artifactId>quarkus-reactive-datasource</artifactId>\n+        </dependency>\n+        <dependency>\n+            <groupId>io.quarkus</groupId>\n+            <artifactId>quarkus-vertx</artifactId>\n+        </dependency>\n+        <dependency>\n+            <groupId>io.vertx</groupId>\n+            <artifactId>vertx-db2-client</artifactId>", "originalCommit": "07492d51146d85b3478dd2f4d6ce02cdcda7ae24", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDYxMTYyNw==", "url": "https://github.com/quarkusio/quarkus/pull/9732#discussion_r434611627", "bodyText": "Good point, removed", "author": "aguibert", "createdAt": "2020-06-03T14:29:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDM2ODQ2Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDM2OTYxNg==", "url": "https://github.com/quarkusio/quarkus/pull/9732#discussion_r434369616", "bodyText": "Probably more a question for @mkouba, but what's the reason to not use a regular @Inject or an Instance?", "author": "cescoffier", "createdAt": "2020-06-03T07:40:47Z", "path": "extensions/reactive-db2-client/runtime/src/main/java/io/quarkus/reactive/db2/client/runtime/health/ReactiveDB2DataSourceHealthCheck.java", "diffHunk": "@@ -0,0 +1,47 @@\n+package io.quarkus.reactive.db2.client.runtime.health;\n+\n+import java.util.concurrent.CompletableFuture;\n+import java.util.concurrent.TimeUnit;\n+\n+import javax.annotation.PostConstruct;\n+import javax.enterprise.context.ApplicationScoped;\n+\n+import org.eclipse.microprofile.health.HealthCheck;\n+import org.eclipse.microprofile.health.HealthCheckResponse;\n+import org.eclipse.microprofile.health.HealthCheckResponseBuilder;\n+import org.eclipse.microprofile.health.Readiness;\n+\n+import io.quarkus.arc.Arc;\n+import io.vertx.db2client.DB2Pool;\n+\n+@Readiness\n+@ApplicationScoped\n+public class ReactiveDB2DataSourceHealthCheck implements HealthCheck {\n+    private DB2Pool db2Pool;\n+\n+    @PostConstruct\n+    protected void init() {\n+        db2Pool = Arc.container().instance(DB2Pool.class).get();", "originalCommit": "07492d51146d85b3478dd2f4d6ce02cdcda7ae24", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDM3MzYwMw==", "url": "https://github.com/quarkusio/quarkus/pull/9732#discussion_r434373603", "bodyText": "+1 for @Inject or Instance.", "author": "mkouba", "createdAt": "2020-06-03T07:48:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDM2OTYxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDYxMjE2Mw==", "url": "https://github.com/quarkusio/quarkus/pull/9732#discussion_r434612163", "bodyText": "This was copied from the other reactive DB health checks, will update this to use @Inject", "author": "aguibert", "createdAt": "2020-06-03T14:30:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDM2OTYxNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDM3MDI1Mw==", "url": "https://github.com/quarkusio/quarkus/pull/9732#discussion_r434370253", "bodyText": "Using the Mutiny version would simplify this to:\npool.query(...).await().atMost(Duration.ofSeconds(10))", "author": "cescoffier", "createdAt": "2020-06-03T07:42:00Z", "path": "extensions/reactive-db2-client/runtime/src/main/java/io/quarkus/reactive/db2/client/runtime/health/ReactiveDB2DataSourceHealthCheck.java", "diffHunk": "@@ -0,0 +1,47 @@\n+package io.quarkus.reactive.db2.client.runtime.health;\n+\n+import java.util.concurrent.CompletableFuture;\n+import java.util.concurrent.TimeUnit;\n+\n+import javax.annotation.PostConstruct;\n+import javax.enterprise.context.ApplicationScoped;\n+\n+import org.eclipse.microprofile.health.HealthCheck;\n+import org.eclipse.microprofile.health.HealthCheckResponse;\n+import org.eclipse.microprofile.health.HealthCheckResponseBuilder;\n+import org.eclipse.microprofile.health.Readiness;\n+\n+import io.quarkus.arc.Arc;\n+import io.vertx.db2client.DB2Pool;\n+\n+@Readiness\n+@ApplicationScoped\n+public class ReactiveDB2DataSourceHealthCheck implements HealthCheck {\n+    private DB2Pool db2Pool;\n+\n+    @PostConstruct\n+    protected void init() {\n+        db2Pool = Arc.container().instance(DB2Pool.class).get();\n+    }\n+\n+    @Override\n+    public HealthCheckResponse call() {\n+        HealthCheckResponseBuilder builder = HealthCheckResponse.named(\"Reactive DB2 connection health check\").up();\n+\n+        try {\n+            CompletableFuture<Void> databaseConnectionAttempt = new CompletableFuture<>();", "originalCommit": "07492d51146d85b3478dd2f4d6ce02cdcda7ae24", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "da301af2c745dec6c733035fcc7ff3e5f56185db", "url": "https://github.com/quarkusio/quarkus/commit/da301af2c745dec6c733035fcc7ff3e5f56185db", "message": "Initial copy of the reactive DB2 client extension", "committedDate": "2020-06-04T13:57:14Z", "type": "commit"}, {"oid": "aa81a609cf528dfcfceab17820ed31f857c6b198", "url": "https://github.com/quarkusio/quarkus/commit/aa81a609cf528dfcfceab17820ed31f857c6b198", "message": "Add Mutiny integration to reactive-db2-client", "committedDate": "2020-06-04T13:57:15Z", "type": "commit"}, {"oid": "1f43a2304e6b3940483872083d04c7b1b8ed911f", "url": "https://github.com/quarkusio/quarkus/commit/1f43a2304e6b3940483872083d04c7b1b8ed911f", "message": "Add integration test module for reactive DB2 client", "committedDate": "2020-06-04T13:57:15Z", "type": "commit"}, {"oid": "7ef374d2d7909a293a46f1ca46778a6cc2462714", "url": "https://github.com/quarkusio/quarkus/commit/7ef374d2d7909a293a46f1ca46778a6cc2462714", "message": "Add documentation for reactive DB2 client", "committedDate": "2020-06-04T13:57:15Z", "type": "commit"}, {"oid": "39c6adc99fbbff942c4f1af3abd78b57c25f1b7c", "url": "https://github.com/quarkusio/quarkus/commit/39c6adc99fbbff942c4f1af3abd78b57c25f1b7c", "message": "Add reactive DB2 client to CI jobs", "committedDate": "2020-06-04T13:57:15Z", "type": "commit"}, {"oid": "c96108bbc10b76bb24f860526b0d7f8e83e62d48", "url": "https://github.com/quarkusio/quarkus/commit/c96108bbc10b76bb24f860526b0d7f8e83e62d48", "message": "Address review comments from Clement", "committedDate": "2020-06-04T13:57:15Z", "type": "commit"}, {"oid": "c96108bbc10b76bb24f860526b0d7f8e83e62d48", "url": "https://github.com/quarkusio/quarkus/commit/c96108bbc10b76bb24f860526b0d7f8e83e62d48", "message": "Address review comments from Clement", "committedDate": "2020-06-04T13:57:15Z", "type": "forcePushed"}]}