{"pr_number": 12292, "pr_title": "Support OIDC cookie domain property", "pr_createdAt": "2020-09-23T12:38:05Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/12292", "timeline": [{"oid": "634c9610288ae89170dea0fd6c32c74665ebbadb", "url": "https://github.com/quarkusio/quarkus/commit/634c9610288ae89170dea0fd6c32c74665ebbadb", "message": "Support OIDC cookie domain property", "committedDate": "2020-09-23T12:41:24Z", "type": "forcePushed"}, {"oid": "6f11ab7e43efe7edeab98209997204d4c26dad15", "url": "https://github.com/quarkusio/quarkus/commit/6f11ab7e43efe7edeab98209997204d4c26dad15", "message": "Support OIDC cookie domain property", "committedDate": "2020-09-23T12:58:35Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzYxMjk3Mg==", "url": "https://github.com/quarkusio/quarkus/pull/12292#discussion_r493612972", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            OIDC adapter uses cookies to keep the session, code flow and post logout state.\n          \n          \n            \n            The OIDC adapter uses cookies to keep the session, code flow and post logout state.", "author": "gastaldi", "createdAt": "2020-09-23T13:55:47Z", "path": "docs/src/main/asciidoc/security-openid-connect-web-authentication.adoc", "diffHunk": "@@ -191,6 +191,17 @@ In such cases a `quarkus.oidc.authentication.redirect-path` property has to be s\n \n If `quarkus.oidc.authentication.redirect-path` is set but the original request URL has to be restored after the user has been redirected back to a callback URL such as `http://localhost:8080/service/callback` then a `quarkus.oidc.authentication.restore-path-after-redirect` property has to be set to `true` which will restore the request URL such as `http://localhost:8080/service/1`, etc.\n \n+[[oidc-cookies]]\n+== Dealing with Cookies\n+\n+OIDC adapter uses cookies to keep the session, code flow and post logout state.", "originalCommit": "6f11ab7e43efe7edeab98209997204d4c26dad15", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzYxNDc2OQ==", "url": "https://github.com/quarkusio/quarkus/pull/12292#discussion_r493614769", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            If you access the protected resources with the overlapping or different roots, for example, `/index.html` and `/web-app/service` or `/web-app/service1` and `/web-app/service2` or `/web-app1/service` and `/web-app2/service` then most likely you also need to set a `quarkus.oidc.authentication.cookie-path` property to a path value common to all of the application resources, such as `/` or `/web-app`, etc.\n          \n          \n            \n            If you access the protected resources with overlapping or different roots, for example: \n          \n          \n            \n            \n          \n          \n            \n            * `/index.html` and `/web-app/service`\n          \n          \n            \n            * `/web-app/service1` and `/web-app/service2`\n          \n          \n            \n            * `/web-app1/service` and `/web-app2/service` \n          \n          \n            \n            \n          \n          \n            \n            then most likely you also need to set a `quarkus.oidc.authentication.cookie-path` property to a path value that is common to all of them, such as `/` or `/web-app`, etc.", "author": "gastaldi", "createdAt": "2020-09-23T13:57:54Z", "path": "docs/src/main/asciidoc/security-openid-connect-web-authentication.adoc", "diffHunk": "@@ -191,6 +191,17 @@ In such cases a `quarkus.oidc.authentication.redirect-path` property has to be s\n \n If `quarkus.oidc.authentication.redirect-path` is set but the original request URL has to be restored after the user has been redirected back to a callback URL such as `http://localhost:8080/service/callback` then a `quarkus.oidc.authentication.restore-path-after-redirect` property has to be set to `true` which will restore the request URL such as `http://localhost:8080/service/1`, etc.\n \n+[[oidc-cookies]]\n+== Dealing with Cookies\n+\n+OIDC adapter uses cookies to keep the session, code flow and post logout state.\n+\n+If you access the protected resources with the overlapping or different roots, for example, `/index.html` and `/web-app/service` or `/web-app/service1` and `/web-app/service2` or `/web-app1/service` and `/web-app2/service` then most likely you also need to set a `quarkus.oidc.authentication.cookie-path` property to a path value common to all of the application resources, such as `/` or `/web-app`, etc.", "originalCommit": "6f11ab7e43efe7edeab98209997204d4c26dad15", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzYxNjkxMg==", "url": "https://github.com/quarkusio/quarkus/pull/12292#discussion_r493616912", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            If your application is deployed across multiple domains then you may also need to set a `quarkus.oidc.authentication.cookie-domain` property.\n          \n          \n            \n            \n          \n          \n            \n            Otherwise the browser cache manager may keep request path specific cookies which in turn may lead to some difficult to diagnoze errors. For example, an authorization code flow may fail due to a missing state cookie if a user has initially accessed `/index.html` but configured a callback URI to `/web-app/callback`.\n          \n          \n            \n            If your application is deployed across multiple domains, make sure to set a `quarkus.oidc.authentication.cookie-domain` property, otherwise the browser cache manager may keep request path specific cookies. \n          \n          \n            \n            Not setting this property may lead to some errors that are difficult to diagnose, for example: an authorization code flow may fail due to a missing state cookie if a user has initially accessed `/index.html` but configured a callback URI to `/web-app/callback`.", "author": "gastaldi", "createdAt": "2020-09-23T14:00:20Z", "path": "docs/src/main/asciidoc/security-openid-connect-web-authentication.adoc", "diffHunk": "@@ -191,6 +191,17 @@ In such cases a `quarkus.oidc.authentication.redirect-path` property has to be s\n \n If `quarkus.oidc.authentication.redirect-path` is set but the original request URL has to be restored after the user has been redirected back to a callback URL such as `http://localhost:8080/service/callback` then a `quarkus.oidc.authentication.restore-path-after-redirect` property has to be set to `true` which will restore the request URL such as `http://localhost:8080/service/1`, etc.\n \n+[[oidc-cookies]]\n+== Dealing with Cookies\n+\n+OIDC adapter uses cookies to keep the session, code flow and post logout state.\n+\n+If you access the protected resources with the overlapping or different roots, for example, `/index.html` and `/web-app/service` or `/web-app/service1` and `/web-app/service2` or `/web-app1/service` and `/web-app2/service` then most likely you also need to set a `quarkus.oidc.authentication.cookie-path` property to a path value common to all of the application resources, such as `/` or `/web-app`, etc.\n+\n+If your application is deployed across multiple domains then you may also need to set a `quarkus.oidc.authentication.cookie-domain` property.\n+\n+Otherwise the browser cache manager may keep request path specific cookies which in turn may lead to some difficult to diagnoze errors. For example, an authorization code flow may fail due to a missing state cookie if a user has initially accessed `/index.html` but configured a callback URI to `/web-app/callback`.", "originalCommit": "6f11ab7e43efe7edeab98209997204d4c26dad15", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDI1ODAyMg==", "url": "https://github.com/quarkusio/quarkus/pull/12292#discussion_r494258022", "bodyText": "Hi @gastaldi Not sure about this last suggestion - the warning about the path specific cookies applies to the path property as well. I think I'd rather move If your application is deployed across multiple domains then you may also need to set a quarkus.oidc.authentication.cookie-domain property. to follow this warning which would be implied", "author": "sberyozkin", "createdAt": "2020-09-24T12:02:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzYxNjkxMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDI4NjE3Nw==", "url": "https://github.com/quarkusio/quarkus/pull/12292#discussion_r494286177", "bodyText": "Hi @gastaldi I've updated the domain cookie text - as not setting it will affect the session cookie as opposed to a state cookie (which may be affected without a path property). How does it look ?", "author": "sberyozkin", "createdAt": "2020-09-24T12:44:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzYxNjkxMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDMwMDMwMg==", "url": "https://github.com/quarkusio/quarkus/pull/12292#discussion_r494300302", "bodyText": "I think it looks good. Good work \ud83d\ude09", "author": "gastaldi", "createdAt": "2020-09-24T13:05:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzYxNjkxMg=="}], "type": "inlineReview"}, {"oid": "57ff4076c352f2c03d69b4f6bb4e2492deb0daf6", "url": "https://github.com/quarkusio/quarkus/commit/57ff4076c352f2c03d69b4f6bb4e2492deb0daf6", "message": "Support OIDC cookie domain property", "committedDate": "2020-09-24T12:23:53Z", "type": "forcePushed"}, {"oid": "3b618e69605ce85cfc72a650b4b81885af82cbaf", "url": "https://github.com/quarkusio/quarkus/commit/3b618e69605ce85cfc72a650b4b81885af82cbaf", "message": "Support OIDC cookie domain property", "committedDate": "2020-09-24T12:42:24Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDI5NDA0NQ==", "url": "https://github.com/quarkusio/quarkus/pull/12292#discussion_r494294045", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            If your application is deployed across multiple domains, make sure to set a `quarkus.oidc.authentication.cookie-domain` property for the session cookie be visible to all protected Quarkus services, for example, if you have 2 services deployd at:\n          \n          \n            \n            If your application is deployed across multiple domains, make sure to set a `quarkus.oidc.authentication.cookie-domain` property for the session cookie be visible to all protected Quarkus services, for example, if you have 2 services deployed at:", "author": "gastaldi", "createdAt": "2020-09-24T12:56:05Z", "path": "docs/src/main/asciidoc/security-openid-connect-web-authentication.adoc", "diffHunk": "@@ -191,6 +191,28 @@ In such cases a `quarkus.oidc.authentication.redirect-path` property has to be s\n \n If `quarkus.oidc.authentication.redirect-path` is set but the original request URL has to be restored after the user has been redirected back to a callback URL such as `http://localhost:8080/service/callback` then a `quarkus.oidc.authentication.restore-path-after-redirect` property has to be set to `true` which will restore the request URL such as `http://localhost:8080/service/1`, etc.\n \n+[[oidc-cookies]]\n+== Dealing with Cookies\n+\n+The OIDC adapter uses cookies to keep the session, code flow and post logout state.\n+\n+If you access the protected resources with overlapping or different roots, for example: \n+\n+* `/index.html` and `/web-app/service`\n+* `/web-app/service1` and `/web-app/service2`\n+* `/web-app1/service` and `/web-app2/service` \n+\n+then most likely you also need to set a `quarkus.oidc.authentication.cookie-path` property to a path value that is common to all of them, such as `/` or `/web-app`, etc.\n+\n+Otherwise the browser cache manager may keep request path specific cookies which in turn may lead to some difficult to diagnoze errors. For example, an authorization code flow may fail due to a missing state cookie if a user has initially accessed `/index.html` but configured a callback URI to `/web-app/callback`.\n+\n+If your application is deployed across multiple domains, make sure to set a `quarkus.oidc.authentication.cookie-domain` property for the session cookie be visible to all protected Quarkus services, for example, if you have 2 services deployd at:", "originalCommit": "3b618e69605ce85cfc72a650b4b81885af82cbaf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDI5NDM3NA==", "url": "https://github.com/quarkusio/quarkus/pull/12292#discussion_r494294374", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            then `quarkus.oidc.authentication.cookie-domain` property must be set to `company.net`.\n          \n          \n            \n            then the `quarkus.oidc.authentication.cookie-domain` property must be set to `company.net`.", "author": "gastaldi", "createdAt": "2020-09-24T12:56:37Z", "path": "docs/src/main/asciidoc/security-openid-connect-web-authentication.adoc", "diffHunk": "@@ -191,6 +191,28 @@ In such cases a `quarkus.oidc.authentication.redirect-path` property has to be s\n \n If `quarkus.oidc.authentication.redirect-path` is set but the original request URL has to be restored after the user has been redirected back to a callback URL such as `http://localhost:8080/service/callback` then a `quarkus.oidc.authentication.restore-path-after-redirect` property has to be set to `true` which will restore the request URL such as `http://localhost:8080/service/1`, etc.\n \n+[[oidc-cookies]]\n+== Dealing with Cookies\n+\n+The OIDC adapter uses cookies to keep the session, code flow and post logout state.\n+\n+If you access the protected resources with overlapping or different roots, for example: \n+\n+* `/index.html` and `/web-app/service`\n+* `/web-app/service1` and `/web-app/service2`\n+* `/web-app1/service` and `/web-app2/service` \n+\n+then most likely you also need to set a `quarkus.oidc.authentication.cookie-path` property to a path value that is common to all of them, such as `/` or `/web-app`, etc.\n+\n+Otherwise the browser cache manager may keep request path specific cookies which in turn may lead to some difficult to diagnoze errors. For example, an authorization code flow may fail due to a missing state cookie if a user has initially accessed `/index.html` but configured a callback URI to `/web-app/callback`.\n+\n+If your application is deployed across multiple domains, make sure to set a `quarkus.oidc.authentication.cookie-domain` property for the session cookie be visible to all protected Quarkus services, for example, if you have 2 services deployd at:\n+\n+* https://whatever.wherever.company.net/\n+* https://another.address.company.net/\n+\n+then `quarkus.oidc.authentication.cookie-domain` property must be set to `company.net`.", "originalCommit": "3b618e69605ce85cfc72a650b4b81885af82cbaf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "d3ec7fb4c2c3b4e287214db12dea114dc863da1d", "url": "https://github.com/quarkusio/quarkus/commit/d3ec7fb4c2c3b4e287214db12dea114dc863da1d", "message": "Support OIDC cookie domain property", "committedDate": "2020-09-24T13:03:35Z", "type": "commit"}, {"oid": "d3ec7fb4c2c3b4e287214db12dea114dc863da1d", "url": "https://github.com/quarkusio/quarkus/commit/d3ec7fb4c2c3b4e287214db12dea114dc863da1d", "message": "Support OIDC cookie domain property", "committedDate": "2020-09-24T13:03:35Z", "type": "forcePushed"}]}