{"pr_number": 11420, "pr_title": "URL patterns for WebFilters are optional", "pr_createdAt": "2020-08-17T14:24:45Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/11420", "timeline": [{"oid": "8a630b3fabcffc4c190a108a0a1256208ce2b276", "url": "https://github.com/quarkusio/quarkus/commit/8a630b3fabcffc4c190a108a0a1256208ce2b276", "message": "URL patterns for WebFilters are optional\n\nAccording to the spec, servlet names can be specified instead\nFixes #11417", "committedDate": "2020-08-17T14:31:16Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTg1NjE5MA==", "url": "https://github.com/quarkusio/quarkus/pull/11420#discussion_r471856190", "bodyText": "this should not be an error. 3rd party jars sometimes define these in web-framgement.xml, with the intention the application can map them if required.", "author": "stuartwdouglas", "createdAt": "2020-08-18T01:07:48Z", "path": "extensions/undertow/deployment/src/main/java/io/quarkus/undertow/deployment/UndertowBuildStep.java", "diffHunk": "@@ -417,16 +417,34 @@ public ServletDeploymentManagerBuildItem build(List<ServletBuildItem> servlets,\n         }\n         if (webMetaData.getFilterMappings() != null) {\n             for (FilterMappingMetaData mapping : webMetaData.getFilterMappings()) {\n-                for (String m : mapping.getUrlPatterns()) {\n-                    if (mapping.getDispatchers() == null || mapping.getDispatchers().isEmpty()) {\n-                        recorder.addFilterURLMapping(deployment, mapping.getFilterName(), m, REQUEST);\n-                    } else {\n-\n-                        for (DispatcherType dispatcher : mapping.getDispatchers()) {\n-                            recorder.addFilterURLMapping(deployment, mapping.getFilterName(), m,\n-                                    javax.servlet.DispatcherType.valueOf(dispatcher.name()));\n+                List<String> urlPatterns = mapping.getUrlPatterns();\n+                List<String> servletNames = mapping.getServletNames();\n+                if (urlPatterns != null && !urlPatterns.isEmpty()) {\n+                    for (String m : urlPatterns) {\n+                        if (mapping.getDispatchers() == null || mapping.getDispatchers().isEmpty()) {\n+                            recorder.addFilterURLMapping(deployment, mapping.getFilterName(), m, REQUEST);\n+                        } else {\n+                            for (DispatcherType dispatcher : mapping.getDispatchers()) {\n+                                recorder.addFilterURLMapping(deployment, mapping.getFilterName(), m,\n+                                        javax.servlet.DispatcherType.valueOf(dispatcher.name()));\n+                            }\n+                        }\n+                    }\n+                } else if (servletNames != null && !servletNames.isEmpty()) {\n+                    // No URL Patterns found, map to servlet name instead\n+                    for (String name : servletNames) {\n+                        if (mapping.getDispatchers() == null || mapping.getDispatchers().isEmpty()) {\n+                            recorder.addFilterServletNameMapping(deployment, mapping.getFilterName(), name, REQUEST);\n+                        } else {\n+                            for (DispatcherType dispatcher : mapping.getDispatchers()) {\n+                                recorder.addFilterServletNameMapping(deployment, mapping.getFilterName(), name,\n+                                        javax.servlet.DispatcherType.valueOf(dispatcher.name()));\n+                            }\n                         }\n                     }\n+                } else {\n+                    throw new IllegalStateException(", "originalCommit": "aab50b33a17d5d6c6fed284e19c9c9b9b4223937", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTg1ODA4NQ==", "url": "https://github.com/quarkusio/quarkus/pull/11420#discussion_r471858085", "bodyText": "Ok, exception removed", "author": "gastaldi", "createdAt": "2020-08-18T01:14:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTg1NjE5MA=="}], "type": "inlineReview"}, {"oid": "60955c39a726b6dfd4e64b303c24578e93eb8632", "url": "https://github.com/quarkusio/quarkus/commit/60955c39a726b6dfd4e64b303c24578e93eb8632", "message": "Using StandardCharsets in test case", "committedDate": "2020-08-18T01:14:15Z", "type": "forcePushed"}, {"oid": "3bd8254045a0353500ec41b02982b5091607ccb5", "url": "https://github.com/quarkusio/quarkus/commit/3bd8254045a0353500ec41b02982b5091607ccb5", "message": "URL patterns for WebFilters are optional\n\nAccording to the spec, servlet names can be specified instead\nFixes #11417", "committedDate": "2020-08-18T14:44:12Z", "type": "commit"}, {"oid": "98a819db73add32c25b815c7b8d040a19aec2aee", "url": "https://github.com/quarkusio/quarkus/commit/98a819db73add32c25b815c7b8d040a19aec2aee", "message": "Using StandardCharsets in test case", "committedDate": "2020-08-18T14:44:14Z", "type": "commit"}, {"oid": "98a819db73add32c25b815c7b8d040a19aec2aee", "url": "https://github.com/quarkusio/quarkus/commit/98a819db73add32c25b815c7b8d040a19aec2aee", "message": "Using StandardCharsets in test case", "committedDate": "2020-08-18T14:44:14Z", "type": "forcePushed"}]}