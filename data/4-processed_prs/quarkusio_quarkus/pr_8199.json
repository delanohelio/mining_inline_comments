{"pr_number": 8199, "pr_title": "Added ability for custom manifest entries in MANIFEST.MF", "pr_createdAt": "2020-03-26T15:12:28Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/8199", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODkwNzI5Mg==", "url": "https://github.com/quarkusio/quarkus/pull/8199#discussion_r398907292", "bodyText": "Configuration of the Mojo is really legacy at this point so there isn't much point in adding more. All Quarkus configuration is now done via the Quarkus Config System (of which ManifestConfig which you have already changed is a part)", "author": "geoand", "createdAt": "2020-03-26T21:35:39Z", "path": "devtools/maven/src/main/java/io/quarkus/maven/BuildMojo.java", "diffHunk": "@@ -117,6 +121,31 @@\n     @Parameter(property = \"ignoredEntries\")\n     private String[] ignoredEntries;\n \n+    /**\n+     * Custom entries into the Manifest can be configured like:\n+     * <code><pre>\n+     * &#x3C;configuration&#x3E;\n+     *   &#x3C;manifestSections&#x3E;\n+     *     &#x3C;manifestSection&#x3E;\n+     *       &#x3C;name&#x3E;Custom Entries&#x3C;/name&#x3E;\n+     *       &#x3C;manifestEntries&#x3E;\n+     *          &#x3C;manifestEntry&#x3E;\n+     *             &#x3C;entryKey&#x3E;Entry_Key1&#x3C;/entryKey&#x3E;\n+     *             &#x3C;entryValue&#x3E;Entry Value 1&#x3C;/entryValue&#x3E;\n+     *          &#x3C;/manifestEntry&#x3E;\n+     *          &#x3C;manifestEntry&#x3E;\n+     *             &#x3C;entryKey&#x3E;Entry_Key2&#x3C;/entryKey&#x3E;\n+     *             &#x3C;entryValue&#x3E;Entry Value 2&#x3C;/entryValue&#x3E;\n+     *          &#x3C;/manifestEntry&#x3E;\n+     *       &#x3C;/manifestEntries&#x3E;\n+     *     &#x3C;/manifestSection&#x3E;\n+     *   &#x3C;/manifestSections&#x3E;\n+     * &#x3C;/configuration&#x3E;\n+     * </pre></code>\n+     */\n+    @Parameter(property = \"manifestSections\")\n+    private List<ManifestSection> manifestSections;", "originalCommit": "6acbbb107170f1eefeb674ad6ebd7aa8d9c4b02c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODkxNTcyMQ==", "url": "https://github.com/quarkusio/quarkus/pull/8199#discussion_r398915721", "bodyText": "We can probably drop this file", "author": "geoand", "createdAt": "2020-03-26T21:53:44Z", "path": "integration-tests/maven/src/test/resources/projects/custom-manifest-section/src/main/resources/META-INF/resources/index.html", "diffHunk": "@@ -0,0 +1,153 @@\n+<!DOCTYPE html>", "originalCommit": "6acbbb107170f1eefeb674ad6ebd7aa8d9c4b02c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODkxNjA5NA==", "url": "https://github.com/quarkusio/quarkus/pull/8199#discussion_r398916094", "bodyText": "Let's put the configuration in the properties and not have the Mojo configuration at all, since that is how we expect users will configure things", "author": "geoand", "createdAt": "2020-03-26T21:54:33Z", "path": "integration-tests/maven/src/test/resources/projects/custom-manifest-section/pom.xml", "diffHunk": "@@ -0,0 +1,105 @@\n+<?xml version=\"1.0\"?>\n+<project xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\" xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+    xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\">\n+  <modelVersion>4.0.0</modelVersion>\n+  <groupId>org.acme</groupId>\n+  <artifactId>acme</artifactId>\n+  <version>1.0-SNAPSHOT</version>\n+  <properties>\n+    <quarkus.platform.group-id>io.quarkus</quarkus.platform.group-id>\n+    <quarkus.platform.artifact-id>quarkus-bom</quarkus.platform.artifact-id>\n+    <quarkus.platform.version>@project.version@</quarkus.platform.version>\n+    <quarkus-plugin.version>@project.version@</quarkus-plugin.version>\n+    <maven.compiler.source>1.8</maven.compiler.source>\n+    <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>\n+    <maven.compiler.target>1.8</maven.compiler.target>\n+  </properties>\n+  <dependencyManagement>\n+    <dependencies>\n+      <dependency>\n+        <groupId>${quarkus.platform.group-id}</groupId>\n+        <artifactId>${quarkus.platform.artifact-id}</artifactId>\n+        <version>${quarkus.platform.version}</version>\n+        <type>pom</type>\n+        <scope>import</scope>\n+      </dependency>\n+    </dependencies>\n+  </dependencyManagement>\n+  <dependencies>\n+    <dependency>\n+      <groupId>io.quarkus</groupId>\n+      <artifactId>quarkus-resteasy</artifactId>\n+    </dependency>\n+    <dependency>\n+      <groupId>io.quarkus</groupId>\n+      <artifactId>quarkus-arc</artifactId>\n+    </dependency>\n+    <dependency>\n+      <groupId>io.quarkus</groupId>\n+      <artifactId>quarkus-junit5</artifactId>\n+      <scope>test</scope>\n+    </dependency>\n+    <dependency>\n+      <groupId>io.rest-assured</groupId>\n+      <artifactId>rest-assured</artifactId>\n+      <scope>test</scope>\n+    </dependency>\n+  </dependencies>\n+  <build>\n+    <plugins>\n+      <plugin>\n+        <groupId>io.quarkus</groupId>\n+        <artifactId>quarkus-maven-plugin</artifactId>\n+        <version>${quarkus-plugin.version}</version>\n+        <configuration>\n+          <manifestSections>\n+            <manifestSection>\n+              <name>Test Information</name>\n+              <manifestEntries>\n+                <manifestEntry>\n+                  <entryKey>Test-Key-1</entryKey>\n+                  <entryValue>Test Value 1</entryValue>\n+                </manifestEntry>\n+                <manifestEntry>\n+                  <entryKey>Test-Key-2</entryKey>\n+                  <entryValue>Test Value 2</entryValue>\n+                </manifestEntry>\n+              </manifestEntries>\n+            </manifestSection>\n+          </manifestSections>", "originalCommit": "6acbbb107170f1eefeb674ad6ebd7aa8d9c4b02c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTIzNTQxMA==", "url": "https://github.com/quarkusio/quarkus/pull/8199#discussion_r399235410", "bodyText": "@geoand As we will just be using the property, should I simplify these separators to just \":\" and \"=\"?", "author": "aaron-rogers82", "createdAt": "2020-03-27T12:40:52Z", "path": "core/deployment/src/main/java/io/quarkus/deployment/pkg/steps/JarResultBuildStep.java", "diffHunk": "@@ -116,6 +116,9 @@\n     private static final OpenOption[] DEFAULT_OPEN_OPTIONS = { TRUNCATE_EXISTING, WRITE, CREATE };\n     private static final BiPredicate<Path, BasicFileAttributes> IS_JSON_FILE_PREDICATE = new IsJsonFilePredicate();\n \n+    private static final String MANIFEST_SECTION_SEPARATOR = \"::\";\n+    private static final String MANIFEST_ENTRY_KV_SEPARATOR = \"\\\\=\\\\|\\\\|\\\\=\";", "originalCommit": "6acbbb107170f1eefeb674ad6ebd7aa8d9c4b02c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTIzNjAzNA==", "url": "https://github.com/quarkusio/quarkus/pull/8199#discussion_r399236034", "bodyText": "Yeah, that makes sense", "author": "geoand", "createdAt": "2020-03-27T12:42:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTIzNTQxMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDE4ODc5Nw==", "url": "https://github.com/quarkusio/quarkus/pull/8199#discussion_r400188797", "bodyText": "@aloubyansky @stuartwdouglas are you OK with this format?", "author": "geoand", "createdAt": "2020-03-30T13:26:26Z", "path": "core/deployment/src/main/java/io/quarkus/deployment/pkg/ManifestConfig.java", "diffHunk": "@@ -12,4 +15,11 @@\n     @ConfigItem(defaultValue = \"true\")\n     public boolean addImplementationEntries;\n \n+    /**\n+     * Custom manifest sections to be added to the MANIFEST.MF file.\n+     * An example of the user defined property:\n+     * quarkus.package.manifest.manifest-sections={Section Name}:{Key1}={Value1},{Section Name}:{Key2}={Value2}", "originalCommit": "1ae7dd2217d46284c7ad69166843528fae7832ad", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU3ODEwNQ==", "url": "https://github.com/quarkusio/quarkus/pull/8199#discussion_r400578105", "bodyText": "I think this should be represented as a Map, rather than a fully de-typed format.", "author": "stuartwdouglas", "createdAt": "2020-03-31T00:46:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDE4ODc5Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU3OTE0NA==", "url": "https://github.com/quarkusio/quarkus/pull/8199#discussion_r400579144", "bodyText": "I think it should be possible to test this using QuarkusProdModeTest rather than a maven integration test. QuarkusProdModeTest is much more lightweight and a lot faster to run, so should be used where possible.", "author": "stuartwdouglas", "createdAt": "2020-03-31T00:49:57Z", "path": "integration-tests/maven/src/test/resources/projects/custom-manifest-section/pom.xml", "diffHunk": "@@ -0,0 +1,90 @@\n+<?xml version=\"1.0\"?>\n+<project xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\" xmlns=\"http://maven.apache.org/POM/4.0.0\"", "originalCommit": "1ae7dd2217d46284c7ad69166843528fae7832ad", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDkwNjkyNg==", "url": "https://github.com/quarkusio/quarkus/pull/8199#discussion_r400906926", "bodyText": "@stuartwdouglas Where is the best place to put the test? Should I keep the test in integration-tests/maven or move them into integration-tests/main?", "author": "aaron-rogers82", "createdAt": "2020-03-31T13:20:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU3OTE0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDkzNzQ4Nw==", "url": "https://github.com/quarkusio/quarkus/pull/8199#discussion_r400937487", "bodyText": "The maven one, please.", "author": "aloubyansky", "createdAt": "2020-03-31T14:01:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU3OTE0NA=="}], "type": "inlineReview"}, {"oid": "f0f72c85095bd1101924deb69b64ae6d02accfaa", "url": "https://github.com/quarkusio/quarkus/commit/f0f72c85095bd1101924deb69b64ae6d02accfaa", "message": "Added ability for custom manifest sections entries to be added to manifest.mf", "committedDate": "2020-03-31T18:22:25Z", "type": "commit"}]}