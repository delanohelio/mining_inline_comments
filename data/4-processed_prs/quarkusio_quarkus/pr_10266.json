{"pr_number": 10266, "pr_title": "Enable forwarded for prefix header configuration", "pr_createdAt": "2020-06-25T12:02:52Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/10266", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk3MDc2Nw==", "url": "https://github.com/quarkusio/quarkus/pull/10266#discussion_r446970767", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            In those scenarios, Quarkus can be configured to automatically updates information like protocol, host, port and URI\n          \n          \n            \n            In those scenarios, Quarkus can be configured to automatically update information like protocol, host, port and URI", "author": "gsmet", "createdAt": "2020-06-29T13:27:57Z", "path": "docs/src/main/asciidoc/vertx.adoc", "diffHunk": "@@ -703,6 +703,49 @@ java.lang.IllegalStateException: Failed to create cache dir\n \n Assuming `/tmp/` is writeable this can be fixed by setting the `vertx.cacheDirBase` property to point to a directory in `/tmp/` for instance in OpenShift by creating an environment variable `JAVA_OPTS` with the value `-Dvertx.cacheDirBase=/tmp/vertx`.\n \n+== Running behind a reverse proxy\n+\n+Quarkus could be accessed through proxies that additionally generates headers (e.g. `X-Forwarded-Host`) to keep\n+information from the client-facing side of the proxy servers that is altered or lost when they are involved.\n+In those scenarios, Quarkus can be configured to automatically updates information like protocol, host, port and URI", "originalCommit": "f00103df7f39b09c0e46563da33749599b52d1ed", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzA2OTcwMw==", "url": "https://github.com/quarkusio/quarkus/pull/10266#discussion_r447069703", "bodyText": "done", "author": "ejba", "createdAt": "2020-06-29T15:43:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk3MDc2Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk3MDg0OA==", "url": "https://github.com/quarkusio/quarkus/pull/10266#discussion_r446970848", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Quarkus could be accessed through proxies that additionally generates headers (e.g. `X-Forwarded-Host`) to keep\n          \n          \n            \n            Quarkus could be accessed through proxies that additionally generate headers (e.g. `X-Forwarded-Host`) to keep", "author": "gsmet", "createdAt": "2020-06-29T13:28:04Z", "path": "docs/src/main/asciidoc/vertx.adoc", "diffHunk": "@@ -703,6 +703,49 @@ java.lang.IllegalStateException: Failed to create cache dir\n \n Assuming `/tmp/` is writeable this can be fixed by setting the `vertx.cacheDirBase` property to point to a directory in `/tmp/` for instance in OpenShift by creating an environment variable `JAVA_OPTS` with the value `-Dvertx.cacheDirBase=/tmp/vertx`.\n \n+== Running behind a reverse proxy\n+\n+Quarkus could be accessed through proxies that additionally generates headers (e.g. `X-Forwarded-Host`) to keep", "originalCommit": "f00103df7f39b09c0e46563da33749599b52d1ed", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzA2OTc1MQ==", "url": "https://github.com/quarkusio/quarkus/pull/10266#discussion_r447069751", "bodyText": "done", "author": "ejba", "createdAt": "2020-06-29T15:43:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk3MDg0OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk3MTA2MA==", "url": "https://github.com/quarkusio/quarkus/pull/10266#discussion_r446971060", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            IMPORTANT: Activate this feature makes the server exposed to several security issues (i.e. information spoofing).\n          \n          \n            \n            IMPORTANT: Activating this feature makes the server exposed to several security issues (i.e. information spoofing).", "author": "gsmet", "createdAt": "2020-06-29T13:28:25Z", "path": "docs/src/main/asciidoc/vertx.adoc", "diffHunk": "@@ -703,6 +703,49 @@ java.lang.IllegalStateException: Failed to create cache dir\n \n Assuming `/tmp/` is writeable this can be fixed by setting the `vertx.cacheDirBase` property to point to a directory in `/tmp/` for instance in OpenShift by creating an environment variable `JAVA_OPTS` with the value `-Dvertx.cacheDirBase=/tmp/vertx`.\n \n+== Running behind a reverse proxy\n+\n+Quarkus could be accessed through proxies that additionally generates headers (e.g. `X-Forwarded-Host`) to keep\n+information from the client-facing side of the proxy servers that is altered or lost when they are involved.\n+In those scenarios, Quarkus can be configured to automatically updates information like protocol, host, port and URI\n+reflecting the values in these headers.\n+\n+IMPORTANT: Activate this feature makes the server exposed to several security issues (i.e. information spoofing).", "originalCommit": "f00103df7f39b09c0e46563da33749599b52d1ed", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk3MTQyMw==", "url": "https://github.com/quarkusio/quarkus/pull/10266#discussion_r446971423", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Both configurations related with standard and non-standard headers can be combine. Therefore, the\n          \n          \n            \n            Both configurations related with standard and non-standard headers can be combined.", "author": "gsmet", "createdAt": "2020-06-29T13:28:56Z", "path": "docs/src/main/asciidoc/vertx.adoc", "diffHunk": "@@ -703,6 +703,49 @@ java.lang.IllegalStateException: Failed to create cache dir\n \n Assuming `/tmp/` is writeable this can be fixed by setting the `vertx.cacheDirBase` property to point to a directory in `/tmp/` for instance in OpenShift by creating an environment variable `JAVA_OPTS` with the value `-Dvertx.cacheDirBase=/tmp/vertx`.\n \n+== Running behind a reverse proxy\n+\n+Quarkus could be accessed through proxies that additionally generates headers (e.g. `X-Forwarded-Host`) to keep\n+information from the client-facing side of the proxy servers that is altered or lost when they are involved.\n+In those scenarios, Quarkus can be configured to automatically updates information like protocol, host, port and URI\n+reflecting the values in these headers.\n+\n+IMPORTANT: Activate this feature makes the server exposed to several security issues (i.e. information spoofing).\n+Consider activate it only when running behind a reverse proxy.\n+\n+To setup this feature, please include the following lines in `src/main/resources/application.properties`:\n+[source]\n+----\n+quarkus.http.proxy-address-forwarding=true\n+----\n+\n+To consider only de-facto standard header (`Forwarded` header), please include the following lines in `src/main/resources/application.properties`:\n+[source]\n+----\n+quarkus.http.allow-forwarded=true\n+----\n+\n+To consider only non-standard headers, please include the following lines instead in `src/main/resources/application.properties`:\n+\n+[source]\n+----\n+quarkus.http.proxy-address-forwarding=true\n+quarkus.http.proxy.enable-forwarded-host=true\n+quarkus.http.proxy.enable-forwarded-prefix=true\n+----\n+\n+Both configurations related with standard and non-standard headers can be combine. Therefore, the", "originalCommit": "f00103df7f39b09c0e46563da33749599b52d1ed", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk3MTgwMg==", "url": "https://github.com/quarkusio/quarkus/pull/10266#discussion_r446971802", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            `Forwarded` header will have precedence in presence of both set of headers.\n          \n          \n            \n            In this case, the `Forwarded` header will have precedence in presence of both set of headers.", "author": "gsmet", "createdAt": "2020-06-29T13:29:28Z", "path": "docs/src/main/asciidoc/vertx.adoc", "diffHunk": "@@ -703,6 +703,49 @@ java.lang.IllegalStateException: Failed to create cache dir\n \n Assuming `/tmp/` is writeable this can be fixed by setting the `vertx.cacheDirBase` property to point to a directory in `/tmp/` for instance in OpenShift by creating an environment variable `JAVA_OPTS` with the value `-Dvertx.cacheDirBase=/tmp/vertx`.\n \n+== Running behind a reverse proxy\n+\n+Quarkus could be accessed through proxies that additionally generates headers (e.g. `X-Forwarded-Host`) to keep\n+information from the client-facing side of the proxy servers that is altered or lost when they are involved.\n+In those scenarios, Quarkus can be configured to automatically updates information like protocol, host, port and URI\n+reflecting the values in these headers.\n+\n+IMPORTANT: Activate this feature makes the server exposed to several security issues (i.e. information spoofing).\n+Consider activate it only when running behind a reverse proxy.\n+\n+To setup this feature, please include the following lines in `src/main/resources/application.properties`:\n+[source]\n+----\n+quarkus.http.proxy-address-forwarding=true\n+----\n+\n+To consider only de-facto standard header (`Forwarded` header), please include the following lines in `src/main/resources/application.properties`:\n+[source]\n+----\n+quarkus.http.allow-forwarded=true\n+----\n+\n+To consider only non-standard headers, please include the following lines instead in `src/main/resources/application.properties`:\n+\n+[source]\n+----\n+quarkus.http.proxy-address-forwarding=true\n+quarkus.http.proxy.enable-forwarded-host=true\n+quarkus.http.proxy.enable-forwarded-prefix=true\n+----\n+\n+Both configurations related with standard and non-standard headers can be combine. Therefore, the\n+`Forwarded` header will have precedence in presence of both set of headers.", "originalCommit": "f00103df7f39b09c0e46563da33749599b52d1ed", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzA2OTgwOQ==", "url": "https://github.com/quarkusio/quarkus/pull/10266#discussion_r447069809", "bodyText": "done", "author": "ejba", "createdAt": "2020-06-29T15:43:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk3MTgwMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk3MTkxNQ==", "url": "https://github.com/quarkusio/quarkus/pull/10266#discussion_r446971915", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Supported forwarding address headers:\n          \n          \n            \n            Supported forwarding address headers are:", "author": "gsmet", "createdAt": "2020-06-29T13:29:38Z", "path": "docs/src/main/asciidoc/vertx.adoc", "diffHunk": "@@ -703,6 +703,49 @@ java.lang.IllegalStateException: Failed to create cache dir\n \n Assuming `/tmp/` is writeable this can be fixed by setting the `vertx.cacheDirBase` property to point to a directory in `/tmp/` for instance in OpenShift by creating an environment variable `JAVA_OPTS` with the value `-Dvertx.cacheDirBase=/tmp/vertx`.\n \n+== Running behind a reverse proxy\n+\n+Quarkus could be accessed through proxies that additionally generates headers (e.g. `X-Forwarded-Host`) to keep\n+information from the client-facing side of the proxy servers that is altered or lost when they are involved.\n+In those scenarios, Quarkus can be configured to automatically updates information like protocol, host, port and URI\n+reflecting the values in these headers.\n+\n+IMPORTANT: Activate this feature makes the server exposed to several security issues (i.e. information spoofing).\n+Consider activate it only when running behind a reverse proxy.\n+\n+To setup this feature, please include the following lines in `src/main/resources/application.properties`:\n+[source]\n+----\n+quarkus.http.proxy-address-forwarding=true\n+----\n+\n+To consider only de-facto standard header (`Forwarded` header), please include the following lines in `src/main/resources/application.properties`:\n+[source]\n+----\n+quarkus.http.allow-forwarded=true\n+----\n+\n+To consider only non-standard headers, please include the following lines instead in `src/main/resources/application.properties`:\n+\n+[source]\n+----\n+quarkus.http.proxy-address-forwarding=true\n+quarkus.http.proxy.enable-forwarded-host=true\n+quarkus.http.proxy.enable-forwarded-prefix=true\n+----\n+\n+Both configurations related with standard and non-standard headers can be combine. Therefore, the\n+`Forwarded` header will have precedence in presence of both set of headers.\n+\n+Supported forwarding address headers:", "originalCommit": "f00103df7f39b09c0e46563da33749599b52d1ed", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzA3MDAwMQ==", "url": "https://github.com/quarkusio/quarkus/pull/10266#discussion_r447070001", "bodyText": "done", "author": "ejba", "createdAt": "2020-06-29T15:44:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk3MTkxNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk3MzMwOA==", "url": "https://github.com/quarkusio/quarkus/pull/10266#discussion_r446973308", "bodyText": "I'm not sure I'm following the purpose of this list?\nAlso are the two headers config documented somewhere?", "author": "gsmet", "createdAt": "2020-06-29T13:31:38Z", "path": "docs/src/main/asciidoc/vertx.adoc", "diffHunk": "@@ -703,6 +703,49 @@ java.lang.IllegalStateException: Failed to create cache dir\n \n Assuming `/tmp/` is writeable this can be fixed by setting the `vertx.cacheDirBase` property to point to a directory in `/tmp/` for instance in OpenShift by creating an environment variable `JAVA_OPTS` with the value `-Dvertx.cacheDirBase=/tmp/vertx`.\n \n+== Running behind a reverse proxy\n+\n+Quarkus could be accessed through proxies that additionally generates headers (e.g. `X-Forwarded-Host`) to keep\n+information from the client-facing side of the proxy servers that is altered or lost when they are involved.\n+In those scenarios, Quarkus can be configured to automatically updates information like protocol, host, port and URI\n+reflecting the values in these headers.\n+\n+IMPORTANT: Activate this feature makes the server exposed to several security issues (i.e. information spoofing).\n+Consider activate it only when running behind a reverse proxy.\n+\n+To setup this feature, please include the following lines in `src/main/resources/application.properties`:\n+[source]\n+----\n+quarkus.http.proxy-address-forwarding=true\n+----\n+\n+To consider only de-facto standard header (`Forwarded` header), please include the following lines in `src/main/resources/application.properties`:\n+[source]\n+----\n+quarkus.http.allow-forwarded=true\n+----\n+\n+To consider only non-standard headers, please include the following lines instead in `src/main/resources/application.properties`:\n+\n+[source]\n+----\n+quarkus.http.proxy-address-forwarding=true\n+quarkus.http.proxy.enable-forwarded-host=true\n+quarkus.http.proxy.enable-forwarded-prefix=true\n+----\n+\n+Both configurations related with standard and non-standard headers can be combine. Therefore, the\n+`Forwarded` header will have precedence in presence of both set of headers.\n+\n+Supported forwarding address headers:\n+\n+* `Forwarded`\n+* `X-Forwarded-Proto`\n+* `X-Forwarded-Host`\n+* `X-Forwarded-Port`\n+* `X-Forwarded-Prefix`", "originalCommit": "f00103df7f39b09c0e46563da33749599b52d1ed", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzA1NTUyNw==", "url": "https://github.com/quarkusio/quarkus/pull/10266#discussion_r447055527", "bodyText": "My intention was to provide a list of headers that Quarkus can use to rewrite request's data. As I didn't find any documentation that expose the list, I decided to include it.\nIf you think this list shouldn't be here, I can remove it.", "author": "ejba", "createdAt": "2020-06-29T15:24:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk3MzMwOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzA2ODAwOQ==", "url": "https://github.com/quarkusio/quarkus/pull/10266#discussion_r447068009", "bodyText": "The X-Forwarded-Prefix header config support is something new. Some ingress proxies (e.g. nginx) generates this header when they remove a prefix in the request's path to keep the original info. However, you have special cases like envoy which it use another header, x-envoy-path if I am not in mistake, for the same purpose. Hence, I let this header \"configurable\".", "author": "ejba", "createdAt": "2020-06-29T15:41:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk3MzMwOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzA2OTM3OQ==", "url": "https://github.com/quarkusio/quarkus/pull/10266#discussion_r447069379", "bodyText": "You can check these config properties here.", "author": "ejba", "createdAt": "2020-06-29T15:43:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk3MzMwOA=="}], "type": "inlineReview"}, {"oid": "2fb5b702cac2228cae3b7674ca22b1b31f4ed226", "url": "https://github.com/quarkusio/quarkus/commit/2fb5b702cac2228cae3b7674ca22b1b31f4ed226", "message": "Enable forwarded for prefix header configuration", "committedDate": "2020-06-29T15:43:28Z", "type": "forcePushed"}, {"oid": "2935fbc7e4d5c9f501900f9a0f381785a245d67a", "url": "https://github.com/quarkusio/quarkus/commit/2935fbc7e4d5c9f501900f9a0f381785a245d67a", "message": "Enable forwarded for prefix header configuration", "committedDate": "2020-07-03T07:26:10Z", "type": "commit"}, {"oid": "2935fbc7e4d5c9f501900f9a0f381785a245d67a", "url": "https://github.com/quarkusio/quarkus/commit/2935fbc7e4d5c9f501900f9a0f381785a245d67a", "message": "Enable forwarded for prefix header configuration", "committedDate": "2020-07-03T07:26:10Z", "type": "forcePushed"}]}