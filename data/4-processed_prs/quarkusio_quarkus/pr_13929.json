{"pr_number": 13929, "pr_title": "Disable XML mapping by default and allow Hibernate ORM integrations to re-enable it if necessary", "pr_createdAt": "2020-12-16T16:03:06Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/13929", "timeline": [{"oid": "1b2a0db368fe766f45958bf6d99ed73ac640249c", "url": "https://github.com/quarkusio/quarkus/commit/1b2a0db368fe766f45958bf6d99ed73ac640249c", "message": "Disable XML mapping by default\n\nOnly enable it if extensions specifically request it.\n\nSigned-off-by: Yoann Rodi\u00e8re <yoann@hibernate.org>", "committedDate": "2020-12-17T09:10:35Z", "type": "forcePushed"}, {"oid": "a30209ff0cf1e0c3db7e64e27ba5918eb00d3ac1", "url": "https://github.com/quarkusio/quarkus/commit/a30209ff0cf1e0c3db7e64e27ba5918eb00d3ac1", "message": "Enable XML mapping by default (temporarily)\n\nThis is needed not just for envers, but also for external extensions, in\nparticular debezium-quarkus-outbox.\n\nSigned-off-by: Yoann Rodi\u00e8re <yoann@hibernate.org>", "committedDate": "2020-12-17T12:49:24Z", "type": "commit"}, {"oid": "95d3897d05e2eeb5d7a9a53f64d1b6be5337c0db", "url": "https://github.com/quarkusio/quarkus/commit/95d3897d05e2eeb5d7a9a53f64d1b6be5337c0db", "message": "Introduce descriptors for Hibernate ORM integrations\n\nFor now these descriptors only contain an optional init listener, but\nwe're going to add more.\n\nSigned-off-by: Yoann Rodi\u00e8re <yoann@hibernate.org>", "committedDate": "2020-12-17T12:49:24Z", "type": "commit"}, {"oid": "4c6d7918b8af4a68863b86314a02a83cdbf55a83", "url": "https://github.com/quarkusio/quarkus/commit/4c6d7918b8af4a68863b86314a02a83cdbf55a83", "message": "Allow Hibernate ORM integrations to declare their reliance on XML mapping\n\nSigned-off-by: Yoann Rodi\u00e8re <yoann@hibernate.org>", "committedDate": "2020-12-17T12:49:25Z", "type": "commit"}, {"oid": "8a4d6e065071be1e48fb1a98735c95a37cd4a846", "url": "https://github.com/quarkusio/quarkus/commit/8a4d6e065071be1e48fb1a98735c95a37cd4a846", "message": "Disable XML mapping by default\n\nOnly enable it if extensions specifically request it.\n\nSigned-off-by: Yoann Rodi\u00e8re <yoann@hibernate.org>", "committedDate": "2020-12-17T12:49:25Z", "type": "commit"}, {"oid": "8a4d6e065071be1e48fb1a98735c95a37cd4a846", "url": "https://github.com/quarkusio/quarkus/commit/8a4d6e065071be1e48fb1a98735c95a37cd4a846", "message": "Disable XML mapping by default\n\nOnly enable it if extensions specifically request it.\n\nSigned-off-by: Yoann Rodi\u00e8re <yoann@hibernate.org>", "committedDate": "2020-12-17T12:49:25Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTE3NTI1Mg==", "url": "https://github.com/quarkusio/quarkus/pull/13929#discussion_r545175252", "bodyText": "We try to avoid lambdas at runtime.", "author": "gsmet", "createdAt": "2020-12-17T15:24:32Z", "path": "extensions/hibernate-orm/runtime/src/main/java/io/quarkus/hibernate/orm/runtime/FastBootHibernatePersistenceProvider.java", "diffHunk": "@@ -176,12 +176,9 @@ private EntityManagerFactoryBuilder getEntityManagerFactoryBuilderOrNull(String\n                 injectRuntimeConfiguration(persistenceUnitName, hibernateOrmRuntimeConfig, runtimeSettingsBuilder);\n             }\n \n-            for (HibernateOrmIntegrationRuntimeInitListener listener : integrationRuntimeInitListeners\n+            for (HibernateOrmIntegrationRuntimeDescriptor descriptor : integrationRuntimeDescriptors\n                     .getOrDefault(persistenceUnitName, Collections.emptyList())) {\n-                if (listener == null) {\n-                    continue;\n-                }\n-                listener.contributeRuntimeProperties(runtimeSettingsBuilder::put);\n+                descriptor.getInitListener().ifPresent(l -> l.contributeRuntimeProperties(runtimeSettingsBuilder::put));", "originalCommit": "8a4d6e065071be1e48fb1a98735c95a37cd4a846", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTE3NTk3OA==", "url": "https://github.com/quarkusio/quarkus/pull/13929#discussion_r545175978", "bodyText": "Same here.", "author": "gsmet", "createdAt": "2020-12-17T15:25:25Z", "path": "extensions/hibernate-orm/runtime/src/main/java/io/quarkus/hibernate/orm/runtime/boot/FastBootMetadataBuilder.java", "diffHunk": "@@ -319,12 +320,10 @@ public RecordedState build() {\n \n         IntegrationSettings.Builder integrationSettingsBuilder = new IntegrationSettings.Builder();\n \n-        for (HibernateOrmIntegrationStaticInitListener listener : integrationStaticInitListeners) {\n-            if (listener == null) {\n-                continue;\n-            }\n-            listener.onMetadataInitialized(fullMeta, metamodelBuilder.getBootstrapContext(),\n-                    integrationSettingsBuilder::put);\n+        for (HibernateOrmIntegrationStaticDescriptor descriptor : integrationStaticDescriptors) {\n+            descriptor.getInitListener()\n+                    .ifPresent(listener -> listener.onMetadataInitialized(fullMeta, metamodelBuilder.getBootstrapContext(),", "originalCommit": "8a4d6e065071be1e48fb1a98735c95a37cd4a846", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "c840579ee5927051da70dbbcf988a02f260a2b7b", "url": "https://github.com/quarkusio/quarkus/commit/c840579ee5927051da70dbbcf988a02f260a2b7b", "message": "Avoid lambdas\n\nSigned-off-by: Yoann Rodi\u00e8re <yoann@hibernate.org>", "committedDate": "2020-12-17T15:48:45Z", "type": "commit"}, {"oid": "c840579ee5927051da70dbbcf988a02f260a2b7b", "url": "https://github.com/quarkusio/quarkus/commit/c840579ee5927051da70dbbcf988a02f260a2b7b", "message": "Avoid lambdas\n\nSigned-off-by: Yoann Rodi\u00e8re <yoann@hibernate.org>", "committedDate": "2020-12-17T15:48:45Z", "type": "forcePushed"}]}