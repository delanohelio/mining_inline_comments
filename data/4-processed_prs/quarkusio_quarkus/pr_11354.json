{"pr_number": 11354, "pr_title": "Make the various beans produced in RedisAPIProducer ApplicationScoped", "pr_createdAt": "2020-08-12T16:31:20Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/11354", "timeline": [{"oid": "0a3ea6417f09fbc79dabd8c788607d89bfb98574", "url": "https://github.com/quarkusio/quarkus/commit/0a3ea6417f09fbc79dabd8c788607d89bfb98574", "message": "refactor: make the various beans produced in RedisAPIProducer ApplicationScoped\n\nThis follows up https://github.com/quarkusio/quarkus/issues/11314#issuecomment-672749462 so that the beans are produced lazily.", "committedDate": "2020-08-14T16:29:32Z", "type": "forcePushed"}, {"oid": "a80c671192f6c218ccb6a4f57e025151df3c0348", "url": "https://github.com/quarkusio/quarkus/commit/a80c671192f6c218ccb6a4f57e025151df3c0348", "message": "refactor: make the various beans produced in RedisAPIProducer ApplicationScoped\n\nThis follows up https://github.com/quarkusio/quarkus/issues/11314#issuecomment-672749462 so that the beans are produced lazily.", "committedDate": "2020-08-17T18:40:02Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTc0ODU0Ng==", "url": "https://github.com/quarkusio/quarkus/pull/11354#discussion_r471748546", "bodyText": "@gsmet I kind of need this to fix #11354 (comment) as registering the classes for reflection did not solve the issue.\nI could not dig deeper what caused the issues though as I was out of depth lacking CDI and generated bytecode expertise ;-)\nLet me know what you think of this.", "author": "machi1990", "createdAt": "2020-08-17T20:11:14Z", "path": "extensions/redis-client/runtime/src/main/java/io/quarkus/redis/client/runtime/RedisAPIProducer.java", "diffHunk": "@@ -133,4 +107,24 @@ private String buildConnectionString(InetSocketAddress address) {\n \n         return builder.toString();\n     }\n+\n+    static class MutinyRedisClient extends io.vertx.mutiny.redis.client.Redis {\n+        MutinyRedisClient(Redis delegate) {\n+            super(delegate);\n+        }\n+\n+        MutinyRedisClient() {\n+            super(null);\n+        }\n+    }\n+\n+    static class MutinyRedisClientAPI extends io.vertx.mutiny.redis.client.RedisAPI {\n+        MutinyRedisClientAPI(RedisAPI delegate) {\n+            super(delegate);\n+        }\n+\n+        MutinyRedisClientAPI() {\n+            super(null);\n+        }\n+    }", "originalCommit": "a80c671192f6c218ccb6a4f57e025151df3c0348", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTc2MTk3OA==", "url": "https://github.com/quarkusio/quarkus/pull/11354#discussion_r471761978", "bodyText": "I have absolutely no idea :). @mkouba ?", "author": "gsmet", "createdAt": "2020-08-17T20:38:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTc0ODU0Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQ2NTc0Ng==", "url": "https://github.com/quarkusio/quarkus/pull/11354#discussion_r476465746", "bodyText": "Hm, the no-args constructor defined on io.vertx.mutiny.redis.client.Redis is package-private so it cannot be accessed from a client proxy generated for a producer method declared on a class with different package... but I can see that you've tried to wrap the mutiny redis client in a special class. @machi1990 Do you still get the same IllegalAccessError?", "author": "mkouba", "createdAt": "2020-08-25T13:52:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTc0ODU0Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQ2ODY3OQ==", "url": "https://github.com/quarkusio/quarkus/pull/11354#discussion_r476468679", "bodyText": "Hm, the no-args constructor defined on io.vertx.mutiny.redis.client.Redis is package-private so it cannot be accessed from a client proxy generated for a producer method declared on a class with different package...\n\nI am wondering why a no arg ctor is needed in this case since the extension takes care of producing the instances by calling appropriate ctor.\n\nbut I can see that you've tried to wrap the mutiny redis client in a special class. @machi1990 Do you still get the same IllegalAccessError?\n\nWrapping it in a special class get's me past the error.", "author": "machi1990", "createdAt": "2020-08-25T13:56:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTc0ODU0Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQ5MjY5Nw==", "url": "https://github.com/quarkusio/quarkus/pull/11354#discussion_r476492697", "bodyText": "I am wondering why a no arg ctor is needed in this case since the extension takes care of producing the instances by calling appropriate ctor.\n\nIt's necessary to create a client proxy instance (used for normal scopes).", "author": "mkouba", "createdAt": "2020-08-25T14:27:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTc0ODU0Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQ5NTE2OA==", "url": "https://github.com/quarkusio/quarkus/pull/11354#discussion_r476495168", "bodyText": "Thanks for clarifying.\nYou think the fix I used is an appropriate one?", "author": "machi1990", "createdAt": "2020-08-25T14:31:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTc0ODU0Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjUwMjQwMA==", "url": "https://github.com/quarkusio/quarkus/pull/11354#discussion_r476502400", "bodyText": "It's probably OK.", "author": "mkouba", "createdAt": "2020-08-25T14:40:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTc0ODU0Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjU0ODg1Ng==", "url": "https://github.com/quarkusio/quarkus/pull/11354#discussion_r476548856", "bodyText": "Thanks. I suppose this PR is good to go then :-)", "author": "machi1990", "createdAt": "2020-08-25T15:43:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTc0ODU0Ng=="}], "type": "inlineReview"}, {"oid": "a66b61f0cdba9c88b1c27584aa28028be0591a7b", "url": "https://github.com/quarkusio/quarkus/commit/a66b61f0cdba9c88b1c27584aa28028be0591a7b", "message": "refactor: make the various beans produced in RedisAPIProducer ApplicationScoped\n\nThis follows up https://github.com/quarkusio/quarkus/issues/11314#issuecomment-672749462 so that the beans are produced lazily.", "committedDate": "2020-08-25T13:57:49Z", "type": "forcePushed"}, {"oid": "1d82449ba1d7cbad42e1486f430d3af16ccfa66d", "url": "https://github.com/quarkusio/quarkus/commit/1d82449ba1d7cbad42e1486f430d3af16ccfa66d", "message": "refactor: make the various beans produced in RedisAPIProducer ApplicationScoped\n\nThis follows up https://github.com/quarkusio/quarkus/issues/11314#issuecomment-672749462 so that the beans are produced lazily.", "committedDate": "2020-08-25T14:13:20Z", "type": "forcePushed"}, {"oid": "1e6637ecec19002b554558e4ced796c7db2c9339", "url": "https://github.com/quarkusio/quarkus/commit/1e6637ecec19002b554558e4ced796c7db2c9339", "message": "refactor: make the various beans produced in RedisAPIProducer ApplicationScoped\n\nThis follows up https://github.com/quarkusio/quarkus/issues/11314#issuecomment-672749462 so that the beans are produced lazily.", "committedDate": "2020-08-25T14:20:15Z", "type": "forcePushed"}, {"oid": "f23f2191fa9324ecff7edfe2f4743e82656a5ba0", "url": "https://github.com/quarkusio/quarkus/commit/f23f2191fa9324ecff7edfe2f4743e82656a5ba0", "message": "refactor: make the various beans produced in RedisAPIProducer ApplicationScoped\n\nThis follows up https://github.com/quarkusio/quarkus/issues/11314#issuecomment-672749462 so that the beans are produced lazily.", "committedDate": "2020-08-26T13:14:42Z", "type": "forcePushed"}, {"oid": "5d7940f4917f975de876b3d021832429ab16978d", "url": "https://github.com/quarkusio/quarkus/commit/5d7940f4917f975de876b3d021832429ab16978d", "message": "refactor: make the various beans produced in RedisAPIProducer ApplicationScoped\n\nThis follows up https://github.com/quarkusio/quarkus/issues/11314#issuecomment-672749462 so that the beans are produced lazily.", "committedDate": "2020-08-27T09:26:10Z", "type": "forcePushed"}, {"oid": "3251b6218b1724e28989b605cff43ca387db169a", "url": "https://github.com/quarkusio/quarkus/commit/3251b6218b1724e28989b605cff43ca387db169a", "message": "refactor: make the various beans produced in RedisAPIProducer ApplicationScoped\n\nThis follows up https://github.com/quarkusio/quarkus/issues/11314#issuecomment-672749462 so that the beans are produced lazily.", "committedDate": "2020-08-28T15:46:16Z", "type": "commit"}, {"oid": "3251b6218b1724e28989b605cff43ca387db169a", "url": "https://github.com/quarkusio/quarkus/commit/3251b6218b1724e28989b605cff43ca387db169a", "message": "refactor: make the various beans produced in RedisAPIProducer ApplicationScoped\n\nThis follows up https://github.com/quarkusio/quarkus/issues/11314#issuecomment-672749462 so that the beans are produced lazily.", "committedDate": "2020-08-28T15:46:16Z", "type": "forcePushed"}]}