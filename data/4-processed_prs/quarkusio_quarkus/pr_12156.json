{"pr_number": 12156, "pr_title": "Only include bootstrap dependencies in quarkus:dev ClassPath", "pr_createdAt": "2020-09-17T04:17:21Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/12156", "timeline": [{"oid": "61e6d525ea74c1b49c952ac69cb740ca5b1ad51e", "url": "https://github.com/quarkusio/quarkus/commit/61e6d525ea74c1b49c952ac69cb740ca5b1ad51e", "message": "Only include bootstrap dependencies in quarkus:dev ClassPath\n\nThe rest of the depenencies are resolved in the bootstrap resolver,\nhaving them on the ClassPath only causes problems.\n\nA similar fix could be applied to Gradle, however I am not sure\nhow to filter the dependencies to only include those required\nfor bootstrap.\n\nFixes #12136", "committedDate": "2020-10-19T04:38:50Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzYwOTI5Mw==", "url": "https://github.com/quarkusio/quarkus/pull/12156#discussion_r507609293", "bodyText": "That's io.quarkus.bootstrap.BootstrapConstants.DESCRIPTOR_PATH, btw.", "author": "aloubyansky", "createdAt": "2020-10-19T09:38:18Z", "path": "devtools/maven/src/main/java/io/quarkus/maven/DevMojo.java", "diffHunk": "@@ -93,6 +95,7 @@\n  */\n @Mojo(name = \"dev\", defaultPhase = LifecyclePhase.PREPARE_PACKAGE, requiresDependencyResolution = ResolutionScope.COMPILE_PLUS_RUNTIME)\n public class DevMojo extends AbstractMojo {\n+    private static final String EXT_PROPERTIES_PATH = \"META-INF/quarkus-extension.properties\";", "originalCommit": "61e6d525ea74c1b49c952ac69cb740ca5b1ad51e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzYxMDU3Ng==", "url": "https://github.com/quarkusio/quarkus/pull/12156#discussion_r507610576", "bodyText": "It doesn't look like this change is necessary. There is already public AppArtifactKey(String groupId, String artifactId, String classifier, String type)", "author": "aloubyansky", "createdAt": "2020-10-19T09:40:28Z", "path": "independent-projects/bootstrap/app-model/src/main/java/io/quarkus/bootstrap/model/AppArtifactKey.java", "diffHunk": "@@ -70,7 +70,7 @@ public static AppArtifactKey fromString(String str) {\n     protected final String classifier;\n     protected final String type;\n \n-    protected AppArtifactKey(String[] parts) {\n+    public AppArtifactKey(String[] parts) {", "originalCommit": "61e6d525ea74c1b49c952ac69cb740ca5b1ad51e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODEyMDYzNw==", "url": "https://github.com/quarkusio/quarkus/pull/12156#discussion_r508120637", "bodyText": "It makes the code a lot simpler. This is the ctor that is used by the existing code that reads from quarkus-extensions.properties, I would need to copy the logic.", "author": "stuartwdouglas", "createdAt": "2020-10-19T23:31:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzYxMDU3Ng=="}], "type": "inlineReview"}, {"oid": "c674393bd154723b9a2b49ac9dd2e78d4f6d6d4a", "url": "https://github.com/quarkusio/quarkus/commit/c674393bd154723b9a2b49ac9dd2e78d4f6d6d4a", "message": "Only include bootstrap dependencies in quarkus:dev ClassPath\n\nThe rest of the depenencies are resolved in the bootstrap resolver,\nhaving them on the ClassPath only causes problems.\n\nA similar fix could be applied to Gradle, however I am not sure\nhow to filter the dependencies to only include those required\nfor bootstrap.\n\nFixes #12136", "committedDate": "2020-10-19T23:37:17Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODc0Njc5Nw==", "url": "https://github.com/quarkusio/quarkus/pull/12156#discussion_r508746797", "bodyText": "There is AppArtifactKey.fromString(str) actually.", "author": "aloubyansky", "createdAt": "2020-10-20T18:27:18Z", "path": "devtools/maven/src/main/java/io/quarkus/maven/DevMojo.java", "diffHunk": "@@ -717,11 +720,35 @@ void prepare(final boolean triggerCompile) throws Exception {\n \n             //in most cases these are not used, however they need to be present for some\n             //parent-first cases such as logging\n+            //first we go through and get all the parent first artifacts\n+            Set<AppArtifactKey> parentFirstArtifacts = new HashSet<>();\n+            for (Artifact appDep : project.getArtifacts()) {\n+                if (appDep.getArtifactHandler().getExtension().equals(\"jar\")) {\n+                    try (ZipFile file = new ZipFile(appDep.getFile())) {\n+                        ZipEntry entry = file.getEntry(BootstrapConstants.DESCRIPTOR_PATH);\n+                        if (entry != null) {\n+                            Properties p = new Properties();\n+                            try (InputStream inputStream = file.getInputStream(entry)) {\n+                                p.load(inputStream);\n+                                String parentFirst = p.getProperty(AppModel.PARENT_FIRST_ARTIFACTS);\n+                                if (parentFirst != null) {\n+                                    String[] artifacts = parentFirst.split(\",\");\n+                                    for (String artifact : artifacts) {\n+                                        parentFirstArtifacts.add(new AppArtifactKey(artifact.split(\":\")));", "originalCommit": "c674393bd154723b9a2b49ac9dd2e78d4f6d6d4a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "847ece98fa44615530d6a49aeffdad6e7adba337", "url": "https://github.com/quarkusio/quarkus/commit/847ece98fa44615530d6a49aeffdad6e7adba337", "message": "Only include bootstrap dependencies in quarkus:dev ClassPath\n\nThe rest of the depenencies are resolved in the bootstrap resolver,\nhaving them on the ClassPath only causes problems.\n\nA similar fix could be applied to Gradle, however I am not sure\nhow to filter the dependencies to only include those required\nfor bootstrap.\n\nFixes #12136", "committedDate": "2020-10-22T04:26:30Z", "type": "commit"}, {"oid": "847ece98fa44615530d6a49aeffdad6e7adba337", "url": "https://github.com/quarkusio/quarkus/commit/847ece98fa44615530d6a49aeffdad6e7adba337", "message": "Only include bootstrap dependencies in quarkus:dev ClassPath\n\nThe rest of the depenencies are resolved in the bootstrap resolver,\nhaving them on the ClassPath only causes problems.\n\nA similar fix could be applied to Gradle, however I am not sure\nhow to filter the dependencies to only include those required\nfor bootstrap.\n\nFixes #12136", "committedDate": "2020-10-22T04:26:30Z", "type": "forcePushed"}]}