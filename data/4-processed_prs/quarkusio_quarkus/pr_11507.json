{"pr_number": 11507, "pr_title": "Manage Quartz Jobs through ArC", "pr_createdAt": "2020-08-21T01:21:06Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/11507", "timeline": [{"oid": "5d814cac178b371aeda0c2096f42542a0f61e8d3", "url": "https://github.com/quarkusio/quarkus/commit/5d814cac178b371aeda0c2096f42542a0f61e8d3", "message": "Manage Jobs through ArC\n\nFixes #11496", "committedDate": "2020-08-21T01:45:02Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDU3MDAwMA==", "url": "https://github.com/quarkusio/quarkus/pull/11507#discussion_r474570000", "bodyText": "Just a side note - do we somehow automatically register all implementations of Job as beans? I didn't find any such logic in quartz processors but it might be just lack of caffeine on my side :)", "author": "manovotn", "createdAt": "2020-08-21T09:23:23Z", "path": "extensions/quartz/deployment/src/test/java/io/quarkus/quartz/test/InjectJobTest.java", "diffHunk": "@@ -0,0 +1,94 @@\n+package io.quarkus.quartz.test;\n+\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+\n+import java.util.concurrent.CountDownLatch;\n+import java.util.concurrent.TimeUnit;\n+\n+import javax.enterprise.context.ApplicationScoped;\n+import javax.enterprise.event.Observes;\n+import javax.enterprise.inject.Produces;\n+import javax.inject.Inject;\n+import javax.inject.Singleton;\n+\n+import org.jboss.shrinkwrap.api.ShrinkWrap;\n+import org.jboss.shrinkwrap.api.asset.StringAsset;\n+import org.jboss.shrinkwrap.api.spec.JavaArchive;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.RegisterExtension;\n+import org.quartz.Job;\n+import org.quartz.JobBuilder;\n+import org.quartz.JobDetail;\n+import org.quartz.JobExecutionContext;\n+import org.quartz.JobExecutionException;\n+import org.quartz.Scheduler;\n+import org.quartz.SchedulerException;\n+import org.quartz.SimpleScheduleBuilder;\n+import org.quartz.Trigger;\n+import org.quartz.TriggerBuilder;\n+\n+import io.quarkus.arc.Arc;\n+import io.quarkus.runtime.StartupEvent;\n+import io.quarkus.test.QuarkusUnitTest;\n+\n+public class InjectJobTest {\n+\n+    @RegisterExtension\n+    static final QuarkusUnitTest test = new QuarkusUnitTest()\n+            .setArchiveProducer(() -> ShrinkWrap.create(JavaArchive.class)\n+                    .addClasses(Starter.class, Service.class, CountDownLatchProducer.class)\n+                    .addAsResource(new StringAsset(\"quarkus.quartz.force-start=true\"),\n+                            \"application.properties\"));\n+\n+    @Test\n+    public void testSimpleScheduledJobs() throws InterruptedException {\n+        CountDownLatch latch = Arc.container().instance(CountDownLatch.class).get();\n+        assertTrue(latch.await(5, TimeUnit.SECONDS), \"Latch count: \" + latch.getCount());\n+    }\n+\n+    @ApplicationScoped\n+    public static class CountDownLatchProducer {\n+        @Produces\n+        @Singleton\n+        CountDownLatch LATCH = new CountDownLatch(2);\n+    }\n+\n+    @ApplicationScoped\n+    public static class Service {\n+\n+        @Inject\n+        CountDownLatch latch;\n+\n+        public void execute() {\n+            latch.countDown();\n+        }\n+\n+    }\n+\n+    public static class Starter implements Job {", "originalCommit": "5d814cac178b371aeda0c2096f42542a0f61e8d3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDcxNTI5Ng==", "url": "https://github.com/quarkusio/quarkus/pull/11507#discussion_r474715296", "bodyText": "@manovotn I don't think so, should we?", "author": "gastaldi", "createdAt": "2020-08-21T13:58:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDU3MDAwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDcxOTEyNg==", "url": "https://github.com/quarkusio/quarkus/pull/11507#discussion_r474719126", "bodyText": "Well, the fix you did requires them to be beans, otherwise you cannot pull them ArC.\nBut even in your test which doesn't use scope annotations on that class it becomes a bean, so there are some transformations going on presumably, I was just unable to pinpoint them. I suppose we consider any class with an injection point a bean and slap @Dependent on it...", "author": "manovotn", "createdAt": "2020-08-21T14:04:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDU3MDAwMA=="}], "type": "inlineReview"}, {"oid": "3d95e74219767a1aa5efd4b3474658825b8a6675", "url": "https://github.com/quarkusio/quarkus/commit/3d95e74219767a1aa5efd4b3474658825b8a6675", "message": "Update Quartz documentation", "committedDate": "2020-08-21T14:42:56Z", "type": "forcePushed"}, {"oid": "c1bf056a19a28d42e61667aa79f3d48ed7b3ba7a", "url": "https://github.com/quarkusio/quarkus/commit/c1bf056a19a28d42e61667aa79f3d48ed7b3ba7a", "message": "Update Quartz documentation", "committedDate": "2020-08-21T14:53:33Z", "type": "forcePushed"}, {"oid": "1e26899fd79aa89da54bb4391331015368d4f0a7", "url": "https://github.com/quarkusio/quarkus/commit/1e26899fd79aa89da54bb4391331015368d4f0a7", "message": "Manage Jobs through ArC\n\nFixes #11496", "committedDate": "2020-08-21T16:31:33Z", "type": "commit"}, {"oid": "cc3ea94b564fd6dad193fa55371aa686cdedba36", "url": "https://github.com/quarkusio/quarkus/commit/cc3ea94b564fd6dad193fa55371aa686cdedba36", "message": "Update Quartz documentation", "committedDate": "2020-08-21T16:31:34Z", "type": "forcePushed"}, {"oid": "102f6156ac92478bad532b9f20ae5e1fd76a614a", "url": "https://github.com/quarkusio/quarkus/commit/102f6156ac92478bad532b9f20ae5e1fd76a614a", "message": "Update Quartz documentation", "committedDate": "2020-08-21T17:02:24Z", "type": "commit"}, {"oid": "102f6156ac92478bad532b9f20ae5e1fd76a614a", "url": "https://github.com/quarkusio/quarkus/commit/102f6156ac92478bad532b9f20ae5e1fd76a614a", "message": "Update Quartz documentation", "committedDate": "2020-08-21T17:02:24Z", "type": "forcePushed"}]}