{"pr_number": 6375, "pr_title": "Use mongodb-driver-sync instead of mongo-java-driver", "pr_createdAt": "2020-01-02T10:17:39Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/6375", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzE5MDIxMQ==", "url": "https://github.com/quarkusio/quarkus/pull/6375#discussion_r363190211", "bodyText": "It should be declared in the bom.", "author": "cescoffier", "createdAt": "2020-01-06T08:01:16Z", "path": "extensions/mongodb-client/runtime/pom.xml", "diffHunk": "@@ -13,6 +13,17 @@\n     <artifactId>quarkus-mongodb-client</artifactId>\n     <name>Quarkus - MongoDB Client - Runtime</name>\n     <description>An imperative and reactive client for MongoDB</description>\n+\n+    <dependencyManagement>\n+        <dependencies>\n+            <dependency>\n+                <groupId>org.mongodb</groupId>\n+                <artifactId>mongodb-driver-async</artifactId>\n+                <version>3.10.2</version>", "originalCommit": "81fe2a64f089d7323517ea119db65326b14bc93f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzIxNjkxMQ==", "url": "https://github.com/quarkusio/quarkus/pull/6375#discussion_r363216911", "bodyText": "It was a leftover: removed", "author": "loicmathieu", "createdAt": "2020-01-06T09:32:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzE5MDIxMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzE5MDQzOA==", "url": "https://github.com/quarkusio/quarkus/pull/6375#discussion_r363190438", "bodyText": "This might be considered as a breaking change as the application code need to be updated.", "author": "cescoffier", "createdAt": "2020-01-06T08:02:12Z", "path": "integration-tests/mongodb-client/src/main/java/io/quarkus/it/mongodb/BookCodec.java", "diffHunk": "@@ -9,14 +9,14 @@\n import org.bson.codecs.DecoderContext;\n import org.bson.codecs.EncoderContext;\n \n-import com.mongodb.MongoClient;\n+import com.mongodb.MongoClientSettings;\n \n public class BookCodec implements CollectibleCodec<Book> {\n \n     private final Codec<Document> documentCodec;\n \n     public BookCodec() {\n-        this.documentCodec = MongoClient.getDefaultCodecRegistry().get(Document.class);\n+        this.documentCodec = MongoClientSettings.getDefaultCodecRegistry().get(Document.class);", "originalCommit": "81fe2a64f089d7323517ea119db65326b14bc93f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzIxNzcyMQ==", "url": "https://github.com/quarkusio/quarkus/pull/6375#discussion_r363217721", "bodyText": "Yes, it is described in the PR and I added the breaking change label.\nThe extension is still in preview so I think we can have this kind of small breaking change but if youre against it I'm OK.\nIn fact, it's not really a breaking change as the user can include the legacy driver that still contains this class.", "author": "loicmathieu", "createdAt": "2020-01-06T09:35:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzE5MDQzOA=="}], "type": "inlineReview"}, {"oid": "43ab9c5193d93615155fb2899be08a73a00b8630", "url": "https://github.com/quarkusio/quarkus/commit/43ab9c5193d93615155fb2899be08a73a00b8630", "message": "Use mongodb-driver-sync instead of mongo-java-driver", "committedDate": "2020-01-06T09:28:58Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzMyNzIyOA==", "url": "https://github.com/quarkusio/quarkus/pull/6375#discussion_r363327228", "bodyText": "If you declare the mongo-driver-async in the BOM I think you can remove this exclusion", "author": "gastaldi", "createdAt": "2020-01-06T14:55:58Z", "path": "extensions/mongodb-client/runtime/pom.xml", "diffHunk": "@@ -29,11 +30,25 @@\n         </dependency>\n         <dependency>\n             <groupId>org.mongodb</groupId>\n-            <artifactId>mongo-java-driver</artifactId>\n+            <artifactId>mongodb-driver-sync</artifactId>\n+        </dependency>\n+        <dependency>\n+            <groupId>org.mongodb</groupId>\n+            <artifactId>mongodb-driver-async</artifactId>\n         </dependency>\n         <dependency>\n             <groupId>org.mongodb</groupId>\n             <artifactId>mongodb-driver-reactivestreams</artifactId>\n+            <exclusions>\n+                <!--\n+                    Exclude mongodb-driver-async as it shares dependencies with mongodb-driver-sync so we need\n+                    to have both versions aligned which is not the case if it is a transitive dependency of mongodb-driver-reactivestreams.", "originalCommit": "43ab9c5193d93615155fb2899be08a73a00b8630", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzM0OTczOA==", "url": "https://github.com/quarkusio/quarkus/pull/6375#discussion_r363349738", "bodyText": "Yes, this was again a leftover of my attemp to fix the dependencies issue", "author": "loicmathieu", "createdAt": "2020-01-06T15:45:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzMyNzIyOA=="}], "type": "inlineReview"}, {"oid": "5c00a2c37af6d9d6ef5d8387fc413cb26215945b", "url": "https://github.com/quarkusio/quarkus/commit/5c00a2c37af6d9d6ef5d8387fc413cb26215945b", "message": "Use mongodb-driver-sync instead of mongo-java-driver", "committedDate": "2020-01-06T15:46:48Z", "type": "forcePushed"}, {"oid": "14ff54ff407df834c0506c042293dfe0c43e5a95", "url": "https://github.com/quarkusio/quarkus/commit/14ff54ff407df834c0506c042293dfe0c43e5a95", "message": "Use mongodb-driver-sync instead of mongo-java-driver", "committedDate": "2020-01-06T16:46:10Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDIyMTYxNg==", "url": "https://github.com/quarkusio/quarkus/pull/6375#discussion_r364221616", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            We didn't include the legacy MongoDB client per default. It contains the old MongoDB Java API (DB, DBCollection,... )\n          \n          \n            \n            We don't include the legacy MongoDB client by default. It contains the now retired MongoDB Java API (DB, DBCollection,... )", "author": "gsmet", "createdAt": "2020-01-08T13:09:13Z", "path": "docs/src/main/asciidoc/mongodb.adoc", "diffHunk": "@@ -479,6 +479,21 @@ So when you access the `/health/ready` endpoint of your application you will hav\n \n This behavior can be disabled by setting the `quarkus.mongodb.health.enabled` property to `false` in your `application.properties`.\n \n+== The legacy client\n+\n+We didn't include the legacy MongoDB client per default. It contains the old MongoDB Java API (DB, DBCollection,... )", "originalCommit": "14ff54ff407df834c0506c042293dfe0c43e5a95", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDIyMTgzNA==", "url": "https://github.com/quarkusio/quarkus/pull/6375#discussion_r364221834", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            If you want to use the legacy API, you need to include the following dependency inside your `pom.xml`.\n          \n          \n            \n            If you want to use the legacy API, you need to add the following dependency to your `pom.xml`:", "author": "gsmet", "createdAt": "2020-01-08T13:09:44Z", "path": "docs/src/main/asciidoc/mongodb.adoc", "diffHunk": "@@ -479,6 +479,21 @@ So when you access the `/health/ready` endpoint of your application you will hav\n \n This behavior can be disabled by setting the `quarkus.mongodb.health.enabled` property to `false` in your `application.properties`.\n \n+== The legacy client\n+\n+We didn't include the legacy MongoDB client per default. It contains the old MongoDB Java API (DB, DBCollection,... )\n+and the `com.mongodb.MongoClient` that is now superseded by `com.mongodb.client.MongoClient`.\n+\n+If you want to use the legacy API, you need to include the following dependency inside your `pom.xml`.", "originalCommit": "14ff54ff407df834c0506c042293dfe0c43e5a95", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDIyMjIwMw==", "url": "https://github.com/quarkusio/quarkus/pull/6375#discussion_r364222203", "bodyText": "Do we need a PR for the quickstart too (if there is one)?", "author": "gsmet", "createdAt": "2020-01-08T13:10:48Z", "path": "docs/src/main/asciidoc/mongodb.adoc", "diffHunk": "@@ -346,7 +346,7 @@ public class FruitCodec implements CollectibleCodec<Fruit> {\n     private final Codec<Document> documentCodec;\n \n     public FruitCodec() {\n-        this.documentCodec = MongoClient.getDefaultCodecRegistry().get(Document.class);\n+        this.documentCodec = MongoClientSettings.getDefaultCodecRegistry().get(Document.class);", "originalCommit": "14ff54ff407df834c0506c042293dfe0c43e5a95", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDYyMTcwMg==", "url": "https://github.com/quarkusio/quarkus/pull/6375#discussion_r364621702", "bodyText": "Yes, I'll send it today or tomorrow.\nAs we add some stuff to Hibernate with Panache and MongoDB with Panache lately I will check these two quickstart also to align them with the guides.", "author": "loicmathieu", "createdAt": "2020-01-09T08:59:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDIyMjIwMw=="}], "type": "inlineReview"}, {"oid": "f4d7ec5e3ff3db31fdea07c1c3616b35d3c8edcc", "url": "https://github.com/quarkusio/quarkus/commit/f4d7ec5e3ff3db31fdea07c1c3616b35d3c8edcc", "message": "Use mongodb-driver-sync instead of mongo-java-driver", "committedDate": "2020-01-09T09:04:43Z", "type": "commit"}, {"oid": "f4d7ec5e3ff3db31fdea07c1c3616b35d3c8edcc", "url": "https://github.com/quarkusio/quarkus/commit/f4d7ec5e3ff3db31fdea07c1c3616b35d3c8edcc", "message": "Use mongodb-driver-sync instead of mongo-java-driver", "committedDate": "2020-01-09T09:04:43Z", "type": "forcePushed"}]}