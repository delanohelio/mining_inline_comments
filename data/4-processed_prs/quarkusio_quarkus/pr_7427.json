{"pr_number": 7427, "pr_title": "Add Gradle support in multi-stage docker build for native images", "pr_createdAt": "2020-02-25T23:22:20Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/7427", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTEzNzcyNg==", "url": "https://github.com/quarkusio/quarkus/pull/7427#discussion_r385137726", "bodyText": "I am not sure we upgraded to GraalVM 20 already", "author": "gastaldi", "createdAt": "2020-02-27T13:51:44Z", "path": "build-parent/pom.xml", "diffHunk": "@@ -32,7 +32,7 @@\n         <!-- These properties are needed in order for them to be resolvable by the documentation -->\n         <!-- The Graal version we suggest using in documentation - as that's\n            what we work with by self downloading it: -->\n-        <graal-sdk.version-for-documentation>19.3.1</graal-sdk.version-for-documentation>\n+        <graal-sdk.version-for-documentation>20.0.0</graal-sdk.version-for-documentation>", "originalCommit": "5082d8552167adb81b23e372a481e3cad4818335", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTE2Njk1Ng==", "url": "https://github.com/quarkusio/quarkus/pull/7427#discussion_r385166956", "bodyText": "This PR quarkusio/quarkus-images#55 updated the version to 20.0.0 in the image.", "author": "fmhwong", "createdAt": "2020-02-27T14:55:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTEzNzcyNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTE3MDczNA==", "url": "https://github.com/quarkusio/quarkus/pull/7427#discussion_r385170734", "bodyText": "Right, the image is there, but we need #7320 and #7321 to be merged first to officially say we support GraalVM 20 \ud83d\ude09", "author": "gastaldi", "createdAt": "2020-02-27T15:01:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTEzNzcyNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTE3ODAwNg==", "url": "https://github.com/quarkusio/quarkus/pull/7427#discussion_r385178006", "bodyText": "I see, thx", "author": "fmhwong", "createdAt": "2020-02-27T15:17:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTEzNzcyNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODE5NTY4OQ==", "url": "https://github.com/quarkusio/quarkus/pull/7427#discussion_r388195689", "bodyText": "We need to go back to 19.3.1 here.", "author": "gsmet", "createdAt": "2020-03-05T10:12:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTEzNzcyNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDQzNTI5Mg==", "url": "https://github.com/quarkusio/quarkus/pull/7427#discussion_r390435292", "bodyText": "Version reverted back to 19.3.1", "author": "fmhwong", "createdAt": "2020-03-10T16:13:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTEzNzcyNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODE5NjU2Nw==", "url": "https://github.com/quarkusio/quarkus/pull/7427#discussion_r388196567", "bodyText": "This needs a bit of rewording IMHO because the getting started project is a Maven one. So it makes no sense putting the Gradle one there.\nI would put that sentence just after the Maven example. And then have something like \"If you are using Gradle in your project, you can use this sample Dockerfile:\"", "author": "gsmet", "createdAt": "2020-03-05T10:14:15Z", "path": "docs/src/main/asciidoc/building-native-image.adoc", "diffHunk": "@@ -364,8 +365,30 @@ EXPOSE 8080\n CMD [\"./application\", \"-Dquarkus.http.host=0.0.0.0\"]\n ----\n \n+Sample Dockerfile for building with Gradle:\n+[source,dockerfile,subs=attributes+]\n+----\n+## Stage 1 : build with maven builder image with native capabilities\n+FROM quay.io/quarkus/centos-quarkus-maven:{graalvm-version}-java8 AS build\n+COPY src /usr/src/app/src\n+COPY build.gradle /usr/src/app\n+COPY settings.gradle /usr/src/app\n+COPY gradle.properties /usr/src/app\n+USER root\n+RUN chown -R quarkus /usr/src/app\n+USER quarkus\n+RUN gradle -b /usr/src/app/build.gradle clean buildNative\n+\n+## Stage 2 : create the docker final image\n+FROM registry.access.redhat.com/ubi8/ubi-minimal\n+WORKDIR /work/\n+COPY --from=build /usr/src/app/build/*-runner /work/application\n+RUN chmod 775 /work\n+EXPOSE 8080\n+CMD [\"./application\", \"-Dquarkus.http.host=0.0.0.0\"]\n+----\n \n-Save this file in `src/main/docker/Dockerfile.multistage` as it is not included in the getting started quickstart.\n+Pick one of the above Dockerfile samples and save it in `src/main/docker/Dockerfile.multistage` as it is not included in the getting started quickstart.", "originalCommit": "5082d8552167adb81b23e372a481e3cad4818335", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "532ed201f2972c3cc1b315393fec5aea929e5125", "url": "https://github.com/quarkusio/quarkus/commit/532ed201f2972c3cc1b315393fec5aea929e5125", "message": "Add Gradle support in doc", "committedDate": "2020-03-07T00:32:34Z", "type": "forcePushed"}, {"oid": "1b32d45ecafbbffdfae0080806f4aef967c873be", "url": "https://github.com/quarkusio/quarkus/commit/1b32d45ecafbbffdfae0080806f4aef967c873be", "message": "Add Gradle support in doc", "committedDate": "2020-03-07T00:36:17Z", "type": "commit"}, {"oid": "1b32d45ecafbbffdfae0080806f4aef967c873be", "url": "https://github.com/quarkusio/quarkus/commit/1b32d45ecafbbffdfae0080806f4aef967c873be", "message": "Add Gradle support in doc", "committedDate": "2020-03-07T00:36:17Z", "type": "forcePushed"}]}