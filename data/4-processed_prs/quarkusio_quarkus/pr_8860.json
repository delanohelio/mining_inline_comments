{"pr_number": 8860, "pr_title": "Generate uber jar for native image source jar if the uberJar option of quarkus-maven-plugin is enabled", "pr_createdAt": "2020-04-26T08:31:21Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/8860", "timeline": [{"oid": "5e4c83db6c8c4c1ff8bd63a5a142e3bb97d6f3dc", "url": "https://github.com/quarkusio/quarkus/commit/5e4c83db6c8c4c1ff8bd63a5a142e3bb97d6f3dc", "message": "[#8850] Generate uber jar for native image source jar if the uberJar option of quarkus-maven-plugin is enabled", "committedDate": "2020-05-27T13:50:50Z", "type": "commit"}, {"oid": "450776c1a3a7496b2181bfaa60f609044687f5f8", "url": "https://github.com/quarkusio/quarkus/commit/450776c1a3a7496b2181bfaa60f609044687f5f8", "message": "[#8850] Enable uber jar strategy for Windows automatically and add in-code documentation plus logging", "committedDate": "2020-05-27T13:50:52Z", "type": "commit"}, {"oid": "450776c1a3a7496b2181bfaa60f609044687f5f8", "url": "https://github.com/quarkusio/quarkus/commit/450776c1a3a7496b2181bfaa60f609044687f5f8", "message": "[#8850] Enable uber jar strategy for Windows automatically and add in-code documentation plus logging", "committedDate": "2020-05-27T13:50:52Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTUzMDM3NA==", "url": "https://github.com/quarkusio/quarkus/pull/8860#discussion_r431530374", "bodyText": "I think this should only be for windows. We just want one format to build the native image from in general, this is an intermediate state so it should not matter to the user, but having two different formats means more possible things to debug.", "author": "stuartwdouglas", "createdAt": "2020-05-28T01:20:10Z", "path": "core/deployment/src/main/java/io/quarkus/deployment/pkg/steps/JarResultBuildStep.java", "diffHunk": "@@ -593,23 +616,54 @@ public NativeImageSourceJarBuildItem buildNativeImageJar(CurateOutcomeBuildItem\n             List<GeneratedClassBuildItem> generatedClasses,\n             List<GeneratedNativeImageClassBuildItem> nativeImageResources,\n             List<GeneratedResourceBuildItem> generatedResources,\n-            MainClassBuildItem mainClassBuildItem) throws Exception {\n-        Path thinJarDirectory = outputTargetBuildItem.getOutputDirectory()\n+            MainClassBuildItem mainClassBuildItem,\n+            List<UberJarRequiredBuildItem> uberJarRequired) throws Exception {\n+        Path targetDirectory = outputTargetBuildItem.getOutputDirectory()\n                 .resolve(outputTargetBuildItem.getBaseName() + \"-native-image-source-jar\");\n-        IoUtils.recursiveDelete(thinJarDirectory);\n-        Files.createDirectories(thinJarDirectory);\n-        copyJsonConfigFiles(applicationArchivesBuildItem, thinJarDirectory);\n-\n-        Path runnerJar = thinJarDirectory\n-                .resolve(outputTargetBuildItem.getBaseName() + packageConfig.runnerSuffix + \".jar\");\n-        Path libDir = thinJarDirectory.resolve(LIB);\n-        Files.createDirectories(libDir);\n+        IoUtils.recursiveDelete(targetDirectory);\n+        Files.createDirectories(targetDirectory);\n \n         List<GeneratedClassBuildItem> allClasses = new ArrayList<>(generatedClasses);\n         allClasses.addAll(nativeImageResources.stream()\n                 .map((s) -> new GeneratedClassBuildItem(true, s.getName(), s.getClassData()))\n                 .collect(Collectors.toList()));\n \n+        boolean uberJarRequested = !uberJarRequired.isEmpty() || packageConfig.uberJar;", "originalCommit": "450776c1a3a7496b2181bfaa60f609044687f5f8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjQ0MjAwOQ==", "url": "https://github.com/quarkusio/quarkus/pull/8860#discussion_r432442009", "bodyText": "@stuartwdouglas Can you check if my last change is what you had in mind?", "author": "Mobe91", "createdAt": "2020-05-29T12:13:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTUzMDM3NA=="}], "type": "inlineReview"}, {"oid": "f86565a5af72090e1ea6e4f19a77595cf400d0eb", "url": "https://github.com/quarkusio/quarkus/commit/f86565a5af72090e1ea6e4f19a77595cf400d0eb", "message": "[#8850] Change windows logic for uber jar generation", "committedDate": "2020-05-29T12:12:33Z", "type": "commit"}]}