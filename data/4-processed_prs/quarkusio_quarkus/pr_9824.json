{"pr_number": 9824, "pr_title": "Take Java migration classes into account in Flyway extension", "pr_createdAt": "2020-06-05T12:23:09Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/9824", "timeline": [{"oid": "baf1dd3575761e991c6742dacdf08cdc6e7a577e", "url": "https://github.com/quarkusio/quarkus/commit/baf1dd3575761e991c6742dacdf08cdc6e7a577e", "message": "Take Java migration classes into account in Flyway extension\n\nFixes: #9819", "committedDate": "2020-06-05T12:34:00Z", "type": "commit"}, {"oid": "baf1dd3575761e991c6742dacdf08cdc6e7a577e", "url": "https://github.com/quarkusio/quarkus/commit/baf1dd3575761e991c6742dacdf08cdc6e7a577e", "message": "Take Java migration classes into account in Flyway extension\n\nFixes: #9819", "committedDate": "2020-06-05T12:34:00Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTk2MjAyOQ==", "url": "https://github.com/quarkusio/quarkus/pull/9824#discussion_r435962029", "bodyText": "BaseJavaMigration implements JavaMigration, wouldn't classes from the statement above be included here?", "author": "gastaldi", "createdAt": "2020-06-05T14:32:08Z", "path": "extensions/flyway/deployment/src/main/java/io/quarkus/flyway/FlywayProcessor.java", "diffHunk": "@@ -87,9 +101,27 @@ void build(BuildProducer<FeatureBuildItem> featureProducer,\n         List<String> applicationMigrations = discoverApplicationMigrations(getMigrationLocations(dataSourceNames));\n         recorder.setApplicationMigrationFiles(applicationMigrations);\n \n+        Set<Class<?>> javaMigrationClasses = new HashSet<>();\n+        addJavaMigrations(combinedIndexBuildItem.getIndex().getAllKnownImplementors(JAVA_MIGRATION), context,\n+                reflectiveClassProducer, javaMigrationClasses);\n+        addJavaMigrations(combinedIndexBuildItem.getIndex().getAllKnownSubclasses(BASE_JAVA_MIGRATION), context,", "originalCommit": "baf1dd3575761e991c6742dacdf08cdc6e7a577e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTk2MjQ1OA==", "url": "https://github.com/quarkusio/quarkus/pull/9824#discussion_r435962458", "bodyText": "I wonder if we shouldn't just stick to the first statement", "author": "gastaldi", "createdAt": "2020-06-05T14:32:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTk2MjAyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTk2MzE5Mw==", "url": "https://github.com/quarkusio/quarkus/pull/9824#discussion_r435963193", "bodyText": "Unfortunately no - I tried it (unless I tried wrongi)", "author": "geoand", "createdAt": "2020-06-05T14:34:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTk2MjAyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTk2NDQ4OA==", "url": "https://github.com/quarkusio/quarkus/pull/9824#discussion_r435964488", "bodyText": "Perhaps the Flyway JAR needs to be Jandexed too? (eg. make the extension produce a IndexDependencyBuildItem)", "author": "gastaldi", "createdAt": "2020-06-05T14:36:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTk2MjAyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTk3NjU0Nw==", "url": "https://github.com/quarkusio/quarkus/pull/9824#discussion_r435976547", "bodyText": "I don't think so, but if you want to try and if it works push an extra commit to my PR, that's fine with me", "author": "geoand", "createdAt": "2020-06-05T14:54:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTk2MjAyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTk5NjI5MA==", "url": "https://github.com/quarkusio/quarkus/pull/9824#discussion_r435996290", "bodyText": "Done \ud83d\ude09 See if that makes sense", "author": "gastaldi", "createdAt": "2020-06-05T15:27:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTk2MjAyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjAwNDQ4Mg==", "url": "https://github.com/quarkusio/quarkus/pull/9824#discussion_r436004482", "bodyText": "If the tests pass, I'm fine with it, thanks!", "author": "geoand", "createdAt": "2020-06-05T15:39:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTk2MjAyOQ=="}], "type": "inlineReview"}, {"oid": "2a463d1590f9c36f5abb517fa78a583e4610223e", "url": "https://github.com/quarkusio/quarkus/commit/2a463d1590f9c36f5abb517fa78a583e4610223e", "message": "Index flyway dependency to look for all JavaMigration implementations", "committedDate": "2020-06-05T15:29:37Z", "type": "commit"}, {"oid": "2a463d1590f9c36f5abb517fa78a583e4610223e", "url": "https://github.com/quarkusio/quarkus/commit/2a463d1590f9c36f5abb517fa78a583e4610223e", "message": "Index flyway dependency to look for all JavaMigration implementations", "committedDate": "2020-06-05T15:29:37Z", "type": "forcePushed"}, {"oid": "7a5efed2a97d88656484b431b472210e2bb7d2f3", "url": "https://github.com/quarkusio/quarkus/commit/7a5efed2a97d88656484b431b472210e2bb7d2f3", "message": "Use Collection instead of forcing to List", "committedDate": "2020-06-05T16:23:26Z", "type": "commit"}]}