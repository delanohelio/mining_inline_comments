{"pr_number": 11852, "pr_title": "Fix panache repository operations failure with multiple persistence units", "pr_createdAt": "2020-09-03T11:18:45Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/11852", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjkwNDk2OA==", "url": "https://github.com/quarkusio/quarkus/pull/11852#discussion_r482904968", "bodyText": "Hmmm. Do we support using both approaches correctly?\nI haven't checked thoroughly but my bet would be it won't work.", "author": "gsmet", "createdAt": "2020-09-03T11:25:18Z", "path": "extensions/panache/hibernate-orm-panache/deployment/src/main/java/io/quarkus/hibernate/orm/panache/deployment/PanacheHibernateResourceProcessor.java", "diffHunk": "@@ -186,6 +197,10 @@ void build(CombinedIndexBuildItem index,\n                 }\n             }\n         }\n+\n+        panacheEntities.addAll(modelClasses);\n+\n+        recordPanacheEntityPersistenceUnits(recorder, jpaModelPersistenceUnitMapping, panacheEntities);", "originalCommit": "648469149679830bf7ed99a68b82fc2b22beeed9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjkwOTUxMg==", "url": "https://github.com/quarkusio/quarkus/pull/11852#discussion_r482909512", "bodyText": "I'm not sure I was clear but I meant: mixing Panache entities and Panache repositories approaches.", "author": "gsmet", "createdAt": "2020-09-03T11:34:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjkwNDk2OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjkyMjUyOA==", "url": "https://github.com/quarkusio/quarkus/pull/11852#discussion_r482922528", "bodyText": "I am not sure it is clear enough. You mean a PanacheEntity cannot have the corresponding Panache repository?\nIf so, I think it is very possible. I once used that pattern here:\n\nTodoRepository.java\nTodo.java", "author": "machi1990", "createdAt": "2020-09-03T11:58:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjkwNDk2OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mjk0MjE0NQ==", "url": "https://github.com/quarkusio/quarkus/pull/11852#discussion_r482942145", "bodyText": "No I mean: what happens if you have:\n\nEntity1 which is an entity using the Active Record pattern and inheriting from PanacheEntity\nEntity2 which uses the Panache repository pattern\nall in the same project.", "author": "gsmet", "createdAt": "2020-09-03T12:33:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjkwNDk2OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mjk0NDk4NQ==", "url": "https://github.com/quarkusio/quarkus/pull/11852#discussion_r482944985", "bodyText": "This should work too.\nIt's what I've in my test case I just did not extend it enough: let me add it so that we can confirm that it works.", "author": "machi1990", "createdAt": "2020-09-03T12:38:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjkwNDk2OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mjk0OTY4MA==", "url": "https://github.com/quarkusio/quarkus/pull/11852#discussion_r482949680", "bodyText": "@gsmet I've added this test case in a separate commit 789e6ed", "author": "machi1990", "createdAt": "2020-09-03T12:46:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjkwNDk2OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mjk2OTA2OA==", "url": "https://github.com/quarkusio/quarkus/pull/11852#discussion_r482969068", "bodyText": "OK, perfect if we have a test!", "author": "gsmet", "createdAt": "2020-09-03T13:16:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjkwNDk2OA=="}], "type": "inlineReview"}, {"oid": "ee6a45b40059a165fc4072e5b8d6f491d859b009", "url": "https://github.com/quarkusio/quarkus/commit/ee6a45b40059a165fc4072e5b8d6f491d859b009", "message": "fix(panache): repository operations failure with multiple persistence units in 1.8.0.cr1\n\nFixes https://github.com/quarkusio/quarkus/issues/11842", "committedDate": "2020-09-03T14:55:21Z", "type": "commit"}, {"oid": "7347e9b25c7697a7b5e7caf82549a32e4f29494b", "url": "https://github.com/quarkusio/quarkus/commit/7347e9b25c7697a7b5e7caf82549a32e4f29494b", "message": "test(panache): add a test case to show that we can mix the repository and active record pattern\n\nFollows up https://github.com/quarkusio/quarkus/pull/11852#discussion_r482944985", "committedDate": "2020-09-03T14:55:22Z", "type": "commit"}, {"oid": "7347e9b25c7697a7b5e7caf82549a32e4f29494b", "url": "https://github.com/quarkusio/quarkus/commit/7347e9b25c7697a7b5e7caf82549a32e4f29494b", "message": "test(panache): add a test case to show that we can mix the repository and active record pattern\n\nFollows up https://github.com/quarkusio/quarkus/pull/11852#discussion_r482944985", "committedDate": "2020-09-03T14:55:22Z", "type": "forcePushed"}]}