{"pr_number": 10886, "pr_title": "gRPC code gen to generate health and reflection stubs", "pr_createdAt": "2020-07-21T14:59:28Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/10886", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODE3MTQ4OQ==", "url": "https://github.com/quarkusio/quarkus/pull/10886#discussion_r458171489", "bodyText": "I would prefer if we could stick to the four spaces convention.\nIt's not consistent across all the source code but most of our pom files are this way.", "author": "gsmet", "createdAt": "2020-07-21T15:07:49Z", "path": "extensions/grpc/codegen/pom.xml", "diffHunk": "@@ -0,0 +1,131 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+  <modelVersion>4.0.0</modelVersion>\n+  <parent>\n+    <artifactId>quarkus-grpc-parent</artifactId>\n+    <groupId>io.quarkus</groupId>\n+    <version>999-SNAPSHOT</version>\n+    <relativePath>../</relativePath>\n+  </parent>\n+\n+  <artifactId>quarkus-grpc-codegen</artifactId>\n+  <name>Quarkus - gRPC - Code Gen</name>", "originalCommit": "f8290666df99cdfabd17e17b62206231af71ee43", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI5NzIyOA==", "url": "https://github.com/quarkusio/quarkus/pull/10886#discussion_r458297228", "bodyText": "Is it possible to add this to our formatter?", "author": "michalszynkiewicz", "createdAt": "2020-07-21T18:17:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODE3MTQ4OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODYxNDQ4NA==", "url": "https://github.com/quarkusio/quarkus/pull/10886#discussion_r458614484", "bodyText": "fixed", "author": "michalszynkiewicz", "createdAt": "2020-07-22T08:11:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODE3MTQ4OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODE3MjE2OQ==", "url": "https://github.com/quarkusio/quarkus/pull/10886#discussion_r458172169", "bodyText": "Shouldn't the version be in the BOM? Or there's a good reason to have them here?", "author": "gsmet", "createdAt": "2020-07-21T15:08:47Z", "path": "extensions/grpc/codegen/pom.xml", "diffHunk": "@@ -0,0 +1,131 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+  <modelVersion>4.0.0</modelVersion>\n+  <parent>\n+    <artifactId>quarkus-grpc-parent</artifactId>\n+    <groupId>io.quarkus</groupId>\n+    <version>999-SNAPSHOT</version>\n+    <relativePath>../</relativePath>\n+  </parent>\n+\n+  <artifactId>quarkus-grpc-codegen</artifactId>\n+  <name>Quarkus - gRPC - Code Gen</name>\n+\n+  <dependencies>\n+    <dependency>\n+      <groupId>io.quarkus</groupId>\n+      <artifactId>quarkus-core-deployment</artifactId>\n+    </dependency>\n+    <dependency>\n+      <groupId>io.quarkus</groupId>\n+      <artifactId>quarkus-devtools-utilities</artifactId>\n+    </dependency>\n+\n+    <dependency>\n+      <groupId>com.google.protobuf</groupId>\n+      <artifactId>protoc</artifactId>\n+      <classifier>linux-aarch_64</classifier>\n+      <type>exe</type>\n+      <version>${protoc.version}</version>", "originalCommit": "f8290666df99cdfabd17e17b62206231af71ee43", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI5NjQ3Mg==", "url": "https://github.com/quarkusio/quarkus/pull/10886#discussion_r458296472", "bodyText": "If I remember correctly, the only reason was that there is a lot of them.\nIf you think it's okay to have them all in the BOM, I'll move them.", "author": "michalszynkiewicz", "createdAt": "2020-07-21T18:16:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODE3MjE2OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODYxNDYwNw==", "url": "https://github.com/quarkusio/quarkus/pull/10886#discussion_r458614607", "bodyText": "moved", "author": "michalszynkiewicz", "createdAt": "2020-07-22T08:12:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODE3MjE2OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODE3MjYyMQ==", "url": "https://github.com/quarkusio/quarkus/pull/10886#discussion_r458172621", "bodyText": "spaces will work as is on Windows and macOS?", "author": "gsmet", "createdAt": "2020-07-21T15:09:24Z", "path": "extensions/grpc/codegen/src/main/java/io/quarkus/grpc/deployment/GrpcCodeGen.java", "diffHunk": "@@ -94,6 +95,14 @@ public boolean trigger(CodeGenContext context) throws CodeGenException {\n         return false;\n     }\n \n+    private String escapeWhitespace(String path) {\n+        if (OS.determineOS() == OS.LINUX) {\n+            return path.replaceAll(\" \", \"\\\\ \");\n+        } else {\n+            return path;", "originalCommit": "f8290666df99cdfabd17e17b62206231af71ee43", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI3NjA5Mw==", "url": "https://github.com/quarkusio/quarkus/pull/10886#discussion_r458276093", "bodyText": "I don't know, I don't really have a way to check.\n@rsvoboda reported that it doesn't work on linux", "author": "michalszynkiewicz", "createdAt": "2020-07-21T17:42:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODE3MjYyMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODU3NzA3Ng==", "url": "https://github.com/quarkusio/quarkus/pull/10886#discussion_r458577076", "bodyText": "To shed some more light on it, the paths are passed as separate arguments in the ProcessBuilder's command, so they should be okay without backslashes before spaces. It's protoc that doesn't handle them properly on Linux. I don't know about other systems.", "author": "michalszynkiewicz", "createdAt": "2020-07-22T07:01:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODE3MjYyMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTMyNzY2OA==", "url": "https://github.com/quarkusio/quarkus/pull/10886#discussion_r459327668", "bodyText": "Maybe @cescoffier can check on macOS if you can put together a test case?", "author": "gsmet", "createdAt": "2020-07-23T09:35:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODE3MjYyMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTM5MzM3OA==", "url": "https://github.com/quarkusio/quarkus/pull/10886#discussion_r459393378", "bodyText": "@cescoffier checked and this version (without \\ before spaces) worked for him on Mac", "author": "michalszynkiewicz", "createdAt": "2020-07-23T11:53:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODE3MjYyMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODE3MzIzNA==", "url": "https://github.com/quarkusio/quarkus/pull/10886#discussion_r458173234", "bodyText": "Same here about the 4 spaces convention.", "author": "gsmet", "createdAt": "2020-07-21T15:10:11Z", "path": "extensions/grpc/stubs/pom.xml", "diffHunk": "@@ -0,0 +1,64 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+  <modelVersion>4.0.0</modelVersion>\n+  <parent>\n+    <artifactId>quarkus-grpc-parent</artifactId>\n+    <groupId>io.quarkus</groupId>\n+    <version>999-SNAPSHOT</version>\n+    <relativePath>../</relativePath>\n+  </parent>\n+\n+  <artifactId>quarkus-grpc-stubs</artifactId>\n+  <name>Quarkus - gRPC - Stubs for health and reflection</name>\n+\n+  <dependencies>", "originalCommit": "f8290666df99cdfabd17e17b62206231af71ee43", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "5964ae0f7f3ad1fae54d2294c840f640b92827d8", "url": "https://github.com/quarkusio/quarkus/commit/5964ae0f7f3ad1fae54d2294c840f640b92827d8", "message": "grpc code gen to generate health and reflection stubs\n\nfixes #10214", "committedDate": "2020-07-22T08:11:28Z", "type": "forcePushed"}, {"oid": "3ecb3686f38177953d96bd29993a593407ae0a30", "url": "https://github.com/quarkusio/quarkus/commit/3ecb3686f38177953d96bd29993a593407ae0a30", "message": "grpc code gen to generate health and reflection stubs\n\nfixes #10214", "committedDate": "2020-07-22T08:20:05Z", "type": "commit"}, {"oid": "3ecb3686f38177953d96bd29993a593407ae0a30", "url": "https://github.com/quarkusio/quarkus/commit/3ecb3686f38177953d96bd29993a593407ae0a30", "message": "grpc code gen to generate health and reflection stubs\n\nfixes #10214", "committedDate": "2020-07-22T08:20:05Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTMyNjg2Ng==", "url": "https://github.com/quarkusio/quarkus/pull/10886#discussion_r459326866", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            To do it, edit the `pom.xml` file to add the quarkus gRPC extension dependency and the JSR 305 (just under `<dependencies>`):\n          \n          \n            \n            To do it, edit the `pom.xml` file to add the Quarkus gRPC extension dependency and the JSR 305 (just under `<dependencies>`):", "author": "gsmet", "createdAt": "2020-07-23T09:34:04Z", "path": "docs/src/main/asciidoc/grpc-getting-started.adoc", "diffHunk": "@@ -308,3 +254,88 @@ Then, open http://localhost:8080/hello/quarkus in a browser, and you should get\n \n Like any other Quarkus applications, you can package it with: `mvn package`.\n You can also package the application into a native executable with: `mvn package -Pnative`.\n+\n+== Generating Java files from proto with protobuf-maven-plugin\n+\n+Alternatively to using Quarkus code generation to generate stubs for `proto` files, you can also use\n+`protobuf-maven-plugin` for this purpose.\n+To do it, edit the `pom.xml` file to add the quarkus gRPC extension dependency and the JSR 305 (just under `<dependencies>`):", "originalCommit": "3ecb3686f38177953d96bd29993a593407ae0a30", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTMyNzEwOA==", "url": "https://github.com/quarkusio/quarkus/pull/10886#discussion_r459327108", "bodyText": "You're talking about the JSR 305 but it's not in the extract below?", "author": "gsmet", "createdAt": "2020-07-23T09:34:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTMyNjg2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTM5Mjk1Mg==", "url": "https://github.com/quarkusio/quarkus/pull/10886#discussion_r459392952", "bodyText": "I only moved the section in the original commit, it seems it was a bit outdated.\nI removed JSR305 and did some further fixes to the docs.", "author": "michalszynkiewicz", "createdAt": "2020-07-23T11:52:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTMyNjg2Ng=="}], "type": "inlineReview"}, {"oid": "bbb79f107a3a8ac661618b9b3ba55c022d311c94", "url": "https://github.com/quarkusio/quarkus/commit/bbb79f107a3a8ac661618b9b3ba55c022d311c94", "message": "grpc docs fixes", "committedDate": "2020-07-23T11:24:05Z", "type": "commit"}, {"oid": "bbb79f107a3a8ac661618b9b3ba55c022d311c94", "url": "https://github.com/quarkusio/quarkus/commit/bbb79f107a3a8ac661618b9b3ba55c022d311c94", "message": "grpc docs fixes", "committedDate": "2020-07-23T11:24:05Z", "type": "forcePushed"}]}