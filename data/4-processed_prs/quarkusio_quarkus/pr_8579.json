{"pr_number": 8579, "pr_title": "Reactive routes - fix race condition in generated handlers", "pr_createdAt": "2020-04-15T08:47:43Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/8579", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTIxODczNQ==", "url": "https://github.com/quarkusio/quarkus/pull/8579#discussion_r409218735", "bodyText": "This is RUNTIME_INIT, isn't the bean container started in STATIC_INIT so will always be ready?", "author": "stuartwdouglas", "createdAt": "2020-04-16T00:57:16Z", "path": "extensions/vertx-web/deployment/src/main/java/io/quarkus/vertx/web/deployment/VertxWebProcessor.java", "diffHunk": "@@ -211,7 +212,9 @@ void addAdditionalRoutes(\n             BuildProducer<RouteBuildItem> routeProducer,\n             BuildProducer<FilterBuildItem> filterProducer,\n             List<RequireBodyHandlerBuildItem> bodyHandlerRequired,\n-            BeanArchiveIndexBuildItem beanArchive) throws IOException {\n+            BeanArchiveIndexBuildItem beanArchive,\n+            // Make sure the routes are produced after the CDI container is ready - we need to initialize some state in the generated RouteHandler constructors\n+            BeanContainerBuildItem beanContainer) throws IOException {", "originalCommit": "6fc03260539ab7783f62ffa1fb342a6165987fdb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTIyMDYzMA==", "url": "https://github.com/quarkusio/quarkus/pull/8579#discussion_r409220630", "bodyText": "I think you also want to produce a ServiceStartBuildItem to make sure that this is ready when the HTTP port is opened.", "author": "stuartwdouglas", "createdAt": "2020-04-16T01:04:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTIxODczNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTMwMDI5NQ==", "url": "https://github.com/quarkusio/quarkus/pull/8579#discussion_r409300295", "bodyText": "This is RUNTIME_INIT, isn't the bean container started in STATIC_INIT so will always be ready?\n\nAh yes, that's a good point.\n\nI think you also want to produce a ServiceStartBuildItem to make sure that this is ready when the HTTP port is opened.\n\nThat shouldn't be necessary because this build step produces RouteBuildItem which is consumed by a build step that is a dependant of a build step that produces ServiceStartBuildItem(\"vertx-http\").", "author": "mkouba", "createdAt": "2020-04-16T05:58:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTIxODczNQ=="}], "type": "inlineReview"}, {"oid": "4297e2cb09deb2e44bf96a9c4f077007248a6465", "url": "https://github.com/quarkusio/quarkus/commit/4297e2cb09deb2e44bf96a9c4f077007248a6465", "message": "Reactive routes - fix race condition in generated handlers\n\n- follows up on https://github.com/quarkusio/quarkus/pull/8536", "committedDate": "2020-04-16T06:49:03Z", "type": "commit"}, {"oid": "4297e2cb09deb2e44bf96a9c4f077007248a6465", "url": "https://github.com/quarkusio/quarkus/commit/4297e2cb09deb2e44bf96a9c4f077007248a6465", "message": "Reactive routes - fix race condition in generated handlers\n\n- follows up on https://github.com/quarkusio/quarkus/pull/8536", "committedDate": "2020-04-16T06:49:03Z", "type": "forcePushed"}]}