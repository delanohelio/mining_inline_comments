{"pr_number": 12462, "pr_title": "Add warning for MP Metric API usage with Micrometer", "pr_createdAt": "2020-10-01T19:54:43Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/12462", "timeline": [{"oid": "194611471e8f2fbde78c7c7794530d1829b10a3c", "url": "https://github.com/quarkusio/quarkus/commit/194611471e8f2fbde78c7c7794530d1829b10a3c", "message": "Add warning for MP Metric API usage with Micrometer\n\n- Future versions will require use of SmallRye Metrics extension to use MP Metrics APIs", "committedDate": "2020-10-01T20:09:17Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQ5MDM4NQ==", "url": "https://github.com/quarkusio/quarkus/pull/12462#discussion_r498490385", "bodyText": "We can't word the warning this way unless/until the smallrye-metrics and micrometer extensions can be enabled at the same time.  What might be better is to warn that the MP Metrics API is being supported in a compatibility mode, which may be subject to change over time. (or something).", "author": "ebullient", "createdAt": "2020-10-01T20:16:50Z", "path": "extensions/micrometer/deployment/src/main/java/io/quarkus/micrometer/deployment/binder/mpmetrics/MicroprofileMetricsProcessor.java", "diffHunk": "@@ -62,6 +62,25 @@ AdditionalBeanBuildItem registerBeanClasses() {\n                 .build();\n     }\n \n+    @BuildStep(onlyIf = MicroprofileMetricsEnabled.class)\n+    void logWarningForMpMetricsUsage(CombinedIndexBuildItem combinedIndexBuildItem) {\n+        IndexView index = combinedIndexBuildItem.getIndex();\n+        boolean mpMetricsPresent = false;\n+\n+        // Find usage of MP Metrics annotations\n+        for (DotName annotation : MetricDotNames.individualMetrics) {\n+            if (index.getAnnotations(annotation).size() > 0) {\n+                mpMetricsPresent = true;\n+                break;\n+            }\n+        }\n+\n+        if (mpMetricsPresent) {\n+            log.warn(\"Use of MicroProfile Metrics annotations with the `quarkus-micrometer` extension in future Quarkus \" +\n+                    \"versions will require using the `quarkus-smallrye-metrics` extension instead.\");\n+        }", "originalCommit": "194611471e8f2fbde78c7c7794530d1829b10a3c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQ5MDYwNA==", "url": "https://github.com/quarkusio/quarkus/pull/12462#discussion_r498490604", "bodyText": "Same as above.", "author": "ebullient", "createdAt": "2020-10-01T20:17:17Z", "path": "extensions/micrometer/runtime/src/main/java/io/quarkus/micrometer/runtime/config/MicroprofileMetricsConfig.java", "diffHunk": "@@ -14,15 +14,18 @@\n      * Microprofile Metrics support.\n      * <p>\n      * Support for Microprofile metrics will be enabled if micrometer\n-     * support is enabled, and this value is true. You need to also\n-     * include the microprofile api jar to your dependencies:\n+     * support is enabled and the MicroProfile Metrics dependency is present:\n      *\n      * <pre>\n      * &lt;dependency&gt;\n      *   &lt;groupId&gt;org.eclipse.microprofile.metrics&lt;/groupId&gt;\n      *   &lt;artifactId&gt;microprofile-metrics-api&lt;/artifactId&gt;\n      * &lt;/dependency&gt;\n      * </pre>\n+     * <p>\n+     * Future versions of the micrometer extension will not include compatibility\n+     * for MicroProfile Metrics. A future version will require the\n+     * `quarkus-smallrye-metrics` extension for MicroProfile Metrics APIs with micrometer.", "originalCommit": "194611471e8f2fbde78c7c7794530d1829b10a3c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "23d0c172e6a407464118dfb1bd098d86650e214f", "url": "https://github.com/quarkusio/quarkus/commit/23d0c172e6a407464118dfb1bd098d86650e214f", "message": "Add warning for MP Metric API usage with Micrometer\n\n- Future versions will require use of SmallRye Metrics extension to use MP Metrics APIs", "committedDate": "2020-10-02T13:35:49Z", "type": "forcePushed"}, {"oid": "f069ddcd90064fd8e0d663de1644e3a6f59805c0", "url": "https://github.com/quarkusio/quarkus/commit/f069ddcd90064fd8e0d663de1644e3a6f59805c0", "message": "Add warning for MP Metric API usage with Micrometer\n\n- Future versions will require use of SmallRye Metrics extension to use MP Metrics APIs", "committedDate": "2020-10-02T13:39:35Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODgyOTk0Ng==", "url": "https://github.com/quarkusio/quarkus/pull/12462#discussion_r498829946", "bodyText": "You can probably remove \"This application uses the MP Metrics API.\" from the javadoc.", "author": "ebullient", "createdAt": "2020-10-02T13:43:39Z", "path": "extensions/micrometer/runtime/src/main/java/io/quarkus/micrometer/runtime/config/MicroprofileMetricsConfig.java", "diffHunk": "@@ -14,15 +14,19 @@\n      * Microprofile Metrics support.\n      * <p>\n      * Support for Microprofile metrics will be enabled if micrometer\n-     * support is enabled, and this value is true. You need to also\n-     * include the microprofile api jar to your dependencies:\n+     * support is enabled and the MicroProfile Metrics dependency is present:\n      *\n      * <pre>\n      * &lt;dependency&gt;\n      *   &lt;groupId&gt;org.eclipse.microprofile.metrics&lt;/groupId&gt;\n      *   &lt;artifactId&gt;microprofile-metrics-api&lt;/artifactId&gt;\n      * &lt;/dependency&gt;\n      * </pre>\n+     * <p>\n+     * This application uses the MP Metrics API.", "originalCommit": "f069ddcd90064fd8e0d663de1644e3a6f59805c0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODgzMzgxNw==", "url": "https://github.com/quarkusio/quarkus/pull/12462#discussion_r498833817", "bodyText": "Fixed now", "author": "kenfinnigan", "createdAt": "2020-10-02T13:50:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODgyOTk0Ng=="}], "type": "inlineReview"}, {"oid": "dee997a4d49c0b07be9ec268c0e953b59363374d", "url": "https://github.com/quarkusio/quarkus/commit/dee997a4d49c0b07be9ec268c0e953b59363374d", "message": "Add warning for MP Metric API usage with Micrometer\n\n- Future versions will require use of SmallRye Metrics extension to use MP Metrics APIs", "committedDate": "2020-10-02T13:49:26Z", "type": "commit"}, {"oid": "dee997a4d49c0b07be9ec268c0e953b59363374d", "url": "https://github.com/quarkusio/quarkus/commit/dee997a4d49c0b07be9ec268c0e953b59363374d", "message": "Add warning for MP Metric API usage with Micrometer\n\n- Future versions will require use of SmallRye Metrics extension to use MP Metrics APIs", "committedDate": "2020-10-02T13:49:26Z", "type": "forcePushed"}]}