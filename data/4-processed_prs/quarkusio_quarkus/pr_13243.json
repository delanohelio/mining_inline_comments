{"pr_number": 13243, "pr_title": "Introduce gitflow-incremental-builder", "pr_createdAt": "2020-11-11T20:32:26Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/13243", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTYyMjg1Nw==", "url": "https://github.com/quarkusio/quarkus/pull/13243#discussion_r521622857", "bodyText": "Notes:\n\n-Dinvoker.skip is offtopic but still worthwhile (skip maven invoker tests, e.g. in enforcer-rules)\n-Dgib -Dgib.disable just triggers the download of GIB and its dependencies", "author": "famod", "createdAt": "2020-11-11T20:35:15Z", "path": ".github/workflows/ci-actions.yml", "diffHunk": "@@ -83,7 +83,7 @@ jobs:\n           key: q2maven-${{ steps.get-date.outputs.date }}\n       - name: Build\n         run: |\n-          mvn -e -B -DskipTests -DskipITs -Dno-format clean install\n+          mvn -e -B -DskipTests -DskipITs -Dinvoker.skip -Dno-format -Dgib -Dgib.disable clean install", "originalCommit": "4799d0a4c53b05d4d2e44cce6f58d5ce5fea3a63", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTYzNjgyNA==", "url": "https://github.com/quarkusio/quarkus/pull/13243#discussion_r521636824", "bodyText": "I wonder if we should replace -DskipTests -DskipITs -Dno-format with -Dquickly", "author": "gastaldi", "createdAt": "2020-11-11T21:03:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTYyMjg1Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTY0NDM3MA==", "url": "https://github.com/quarkusio/quarkus/pull/13243#discussion_r521644370", "bodyText": "IIRC, a few weeks ago someone said: -Dquickly is only for local usage.\nBut yeah, I also do see your point.", "author": "famod", "createdAt": "2020-11-11T21:18:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTYyMjg1Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTkwMDM2Nw==", "url": "https://github.com/quarkusio/quarkus/pull/13243#discussion_r521900367", "bodyText": "-Dquickly skips the formatting check though. There seem to be tests that use maven invoker, won't they be affected by -Dinvoker.skip?", "author": "aloubyansky", "createdAt": "2020-11-12T07:55:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTYyMjg1Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTk0MDIzNg==", "url": "https://github.com/quarkusio/quarkus/pull/13243#discussion_r521940236", "bodyText": "There seem to be tests that use maven invoker, won't they be affected by -Dinvoker.skip?\n\nYes, that's what should happen. This initial JDK11 build shall only build everything and populate a local Maven repo that is then reused by subsequent jobs. This initial job shall not execute any tests (see also -DskipTests), AFAICS.", "author": "famod", "createdAt": "2020-11-12T08:57:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTYyMjg1Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzA1NjIyNA==", "url": "https://github.com/quarkusio/quarkus/pull/13243#discussion_r523056224", "bodyText": "Please do not use -Dquickly in CI build.\nThis thing will evolve depending on what people need for local usage and we don't want CI to be impacted.", "author": "gsmet", "createdAt": "2020-11-13T16:19:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTYyMjg1Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODYzNjk4Ng==", "url": "https://github.com/quarkusio/quarkus/pull/13243#discussion_r528636986", "bodyText": "Btw, the doc job is using -Dquickly: https://github.com/quarkusio/quarkus/blob/master/.github/workflows/doc-build.yml#L45", "author": "famod", "createdAt": "2020-11-23T11:30:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTYyMjg1Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTYyNDMyNg==", "url": "https://github.com/quarkusio/quarkus/pull/13243#discussion_r521624326", "bodyText": "I was looking long and hard for a possibility to have some kind of conditional logic in the env section but it seems this is not supported by GH Workflows.\nThat's why I ended up with this build step that creates an output that is then exposed as a job output to subsequent jobs.\nI could have created a spearate job for this but then I would need to extend needs of each job.", "author": "famod", "createdAt": "2020-11-11T20:38:25Z", "path": ".github/workflows/ci-actions.yml", "diffHunk": "@@ -95,6 +95,30 @@ jobs:\n       - name: Delete Local Artifacts From Cache\n         shell: bash\n         run: rm -r ~/.m2/repository/io/quarkus\n+      - name: Get GIB arguments", "originalCommit": "4799d0a4c53b05d4d2e44cce6f58d5ce5fea3a63", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTYyNTQxNw==", "url": "https://github.com/quarkusio/quarkus/pull/13243#discussion_r521625417", "bodyText": "Notes:\n\nthis entire block is now present for almost each job\nI decided to only add the remote, not directly fetch from it, so that GIB can decide whether or not to fetch master at all (see the \"Get GIB arguments\" step further up for the cases where GIB disables itself)", "author": "famod", "createdAt": "2020-11-11T20:40:20Z", "path": ".github/workflows/ci-actions.yml", "diffHunk": "@@ -130,6 +154,11 @@ jobs:\n           sudo service mysql stop || true\n \n       - uses: actions/checkout@v2\n+        with:\n+          fetch-depth: 0\n+      - name: Add quarkusio remote\n+        shell: bash\n+        run: git remote add quarkusio https://github.com/quarkusio/quarkus.git", "originalCommit": "4799d0a4c53b05d4d2e44cce6f58d5ce5fea3a63", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTYyNjI5Ng==", "url": "https://github.com/quarkusio/quarkus/pull/13243#discussion_r521626296", "bodyText": "I had some nasty formatting/escaping problems with eval, especially with -Dgib.disableIfBranchRegex='master|\\d+\\.\\d+|.*backport.*' (see further up).\nAFAICT eval ist not required so I simply removed it from every mvn call.", "author": "famod", "createdAt": "2020-11-11T20:41:51Z", "path": ".github/workflows/ci-actions.yml", "diffHunk": "@@ -154,7 +183,8 @@ jobs:\n         shell: bash\n         run: tar -xzf maven-repo.tgz -C ~\n       - name: Build with Maven\n-        run: eval mvn $JVM_TEST_MAVEN_OPTS install -pl !integration-tests/gradle -pl !integration-tests/maven -pl !integration-tests/devtools ${{ matrix.java.maven_args}}", "originalCommit": "4799d0a4c53b05d4d2e44cce6f58d5ce5fea3a63", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTYyNzM3NA==", "url": "https://github.com/quarkusio/quarkus/pull/13243#discussion_r521627374", "bodyText": "While -f is more efficient, here we need -pl which retains the entire reactor internally (=all modules) so that GIB can properly detect changes and map them to modules.\nWith -f GIB would only \"see\" a fraction of the modules and change detection would not work as we need it to.", "author": "famod", "createdAt": "2020-11-11T20:44:09Z", "path": ".github/workflows/ci-actions.yml", "diffHunk": "@@ -452,9 +512,9 @@ jobs:\n         shell: bash\n         run: tar -xzf maven-repo.tgz -C ~\n       - name: Build with Maven\n-        run: mvn -B --settings .github/mvn-settings.xml -Dno-native -Dno-format -DskipTests -Dtcks install\n+        run: mvn -B --settings .github/mvn-settings.xml -Dno-native -Dno-format -DskipTests -Dtcks install ${{ needs.build-jdk11.outputs.gib_args }}\n       - name: Verify with Maven\n-        run: mvn -B --settings .github/mvn-settings.xml -f tcks/pom.xml verify\n+        run: mvn -B --settings .github/mvn-settings.xml -Dtcks -pl tcks -amd verify ${{ needs.build-jdk11.outputs.gib_args }}", "originalCommit": "4799d0a4c53b05d4d2e44cce6f58d5ce5fea3a63", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzA2MTA5Nw==", "url": "https://github.com/quarkusio/quarkus/pull/13243#discussion_r523061097", "bodyText": "Won't this thing run the build and the tests of all the modules triggered by amd?", "author": "gsmet", "createdAt": "2020-11-13T16:27:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTYyNzM3NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzA4NDQ1NA==", "url": "https://github.com/quarkusio/quarkus/pull/13243#discussion_r523084454", "bodyText": "No, because the profile overwrites the modules so that only tcks is left:\n        <profile>\n            <id>tcks</id>\n            <activation>\n                <property>\n                    <name>tcks</name>\n                </property>\n            </activation>\n            <modules>\n                <module>tcks</module>\n            </modules>\n        </profile>", "author": "famod", "createdAt": "2020-11-13T17:02:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTYyNzM3NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDMzOTY2NQ==", "url": "https://github.com/quarkusio/quarkus/pull/13243#discussion_r524339665", "bodyText": "Hmmm, I do that in HV and it adds the modules, it doesn't overwrite them.", "author": "gsmet", "createdAt": "2020-11-16T15:11:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTYyNzM3NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDM0NDkxMA==", "url": "https://github.com/quarkusio/quarkus/pull/13243#discussion_r524344910", "bodyText": "You are absolutely right!\nThe thing here is that -pl tcks -amd builds Quarkus - TCK - Parent and everything that depends on it, which is basically just all those tcks submodules.", "author": "famod", "createdAt": "2020-11-16T15:18:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTYyNzM3NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDM1MTI0Nw==", "url": "https://github.com/quarkusio/quarkus/pull/13243#discussion_r524351247", "bodyText": "...and from those modules GIB is removing the ones that are not changed (or don't depend on changed modules).\nLocal example with an uncommitted change in extensions/vertx/runtime/pom.xml:\n$ mvn -Dgib -Dgib.dbc -Dtcks -pl tcks -amd validate -Dgib.dsph\n[INFO] Scanning for projects...\n[INFO] gitflow-incremental-builder 3.12.0 starting...\n[INFO] ------------------------------------------------------------------------\n[INFO] Changed Artifacts:\n[INFO]\n[INFO] quarkus-vertx (but deselected)\n[INFO]\n[INFO] gitflow-incremental-builder exiting...\n[INFO] ------------------------------------------------------------------------\n[INFO] Reactor Build Order:\n[INFO]\n[INFO] Quarkus - TCK - MicroProfile Health                                [jar]\n[INFO] Quarkus - TCK - MicroProfile JWT                                   [jar]\n[INFO] Quarkus - TCK - MicroProfile Reactive Messaging                    [jar]\n[INFO] Quarkus - TCK - MicroProfile OpenAPI                               [jar]\n[INFO]\n\nPS: I'm lazy \ud83d\ude09; dbc is disableBranchComparison and dsph is disableSelectedProjectsHandling.", "author": "famod", "createdAt": "2020-11-16T15:26:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTYyNzM3NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3NzExNzE5NQ==", "url": "https://github.com/quarkusio/quarkus/pull/13243#discussion_r577117195", "bodyText": "This should also be resolved by now.", "author": "famod", "createdAt": "2021-02-16T20:30:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTYyNzM3NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTYyODM5Mg==", "url": "https://github.com/quarkusio/quarkus/pull/13243#discussion_r521628392", "bodyText": "Additionally to eval (see futher up) I also had issues with IFS=,.\nSince Maven doesn't mind a trailing ,, I simplified it all a bit.", "author": "famod", "createdAt": "2020-11-11T20:46:10Z", "path": ".github/workflows/ci-actions.yml", "diffHunk": "@@ -512,14 +577,13 @@ jobs:\n           CATEGORY: ${{matrix.category}}\n         run: |\n           for i in $TEST_MODULES\n-          do modules+=(\"integration-tests/$i\"); done\n-          IFS=,\n-          eval mvn -pl \"${modules[*]}\" $NATIVE_TEST_MAVEN_OPTS\n+          do modules+=\"integration-tests/$i,\"; done", "originalCommit": "4799d0a4c53b05d4d2e44cce6f58d5ce5fea3a63", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTYzMDg4MQ==", "url": "https://github.com/quarkusio/quarkus/pull/13243#discussion_r521630881", "bodyText": "I am not totally certain on this, but can we name it incremental (and the activation property)? I think it's more intuitive (although gib is shorter to type, but I think readability is important)\nThe reason why I am uncertain is that I see that you have other parameters when you use -Dgib that also starts with -Dgib., so maybe it makes sense.\nI'm curious to know what others think.", "author": "gastaldi", "createdAt": "2020-11-11T20:51:08Z", "path": "pom.xml", "diffHunk": "@@ -205,6 +206,36 @@\n                 <module>tcks</module>\n             </modules>\n         </profile>\n+        <profile>\n+            <id>gib</id>", "originalCommit": "4799d0a4c53b05d4d2e44cce6f58d5ce5fea3a63", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTY0NDkyOA==", "url": "https://github.com/quarkusio/quarkus/pull/13243#discussion_r521644928", "bodyText": "Yeah sure, why not.", "author": "famod", "createdAt": "2020-11-11T21:19:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTYzMDg4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDAzMTc4Ng==", "url": "https://github.com/quarkusio/quarkus/pull/13243#discussion_r524031786", "bodyText": "@aloubyansky @gsmet @maxandersen what would you prefer? -Dgib or -Dincremental?\nAll other gib.* properties must stay this way since those are GIB built-ins.", "author": "famod", "createdAt": "2020-11-16T09:37:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTYzMDg4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTY3OTcyMQ==", "url": "https://github.com/quarkusio/quarkus/pull/13243#discussion_r531679721", "bodyText": "\"-Dmore-quickly\" ? :)\njust kidding.\n\"-Dincremental\" works for me. better to have profile be about the intent rather than the technology used.", "author": "maxandersen", "createdAt": "2020-11-27T16:06:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTYzMDg4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTcxNzE3NQ==", "url": "https://github.com/quarkusio/quarkus/pull/13243#discussion_r531717175", "bodyText": "Ok, renamed to incremental.", "author": "famod", "createdAt": "2020-11-27T17:53:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTYzMDg4MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTYzMTI5MQ==", "url": "https://github.com/quarkusio/quarkus/pull/13243#discussion_r521631291", "bodyText": "Add to the Dependabot descriptor?", "author": "gastaldi", "createdAt": "2020-11-11T20:51:55Z", "path": "pom.xml", "diffHunk": "@@ -35,6 +35,7 @@\n         <postgres.url>jdbc:postgresql:hibernate_orm_test</postgres.url>\n \n         <nexus-staging-maven-plugin.version>1.6.8</nexus-staging-maven-plugin.version>\n+        <gitflow-incremental-builder.version>3.12.0</gitflow-incremental-builder.version>", "originalCommit": "4799d0a4c53b05d4d2e44cce6f58d5ce5fea3a63", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQ0OTExNg==", "url": "https://github.com/quarkusio/quarkus/pull/13243#discussion_r526449116", "bodyText": "Done.", "author": "famod", "createdAt": "2020-11-18T21:56:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTYzMTI5MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzA1OTY3Nw==", "url": "https://github.com/quarkusio/quarkus/pull/13243#discussion_r523059677", "bodyText": "When does it happen exactly? I would like to understand when this case happens and when the other case happens?\nTypically, I don't understand why we only disable backport PRs in the other case.", "author": "gsmet", "createdAt": "2020-11-13T16:25:11Z", "path": ".github/workflows/ci-actions.yml", "diffHunk": "@@ -95,6 +95,30 @@ jobs:\n       - name: Delete Local Artifacts From Cache\n         shell: bash\n         run: rm -r ~/.m2/repository/io/quarkus\n+      - name: Get GIB arguments\n+        id: get-gib-args\n+        env:\n+          PULL_REQUEST_BASE: ${{ github.event.pull_request.base.sha }}\n+        run: |\n+          # See also: https://github.com/vackosar/gitflow-incremental-builder#configuration\n+          # Common GIB_ARGS for all CI cases (hint: see also pom.xml):\n+          # - disableSelectedProjectsHandling: required to detect changes in jobs that use -pl\n+          # - untracked: to ignore files created by jobs (and uncommitted to be consistent)\n+          GIB_ARGS=\"-Dgib -Dgib.disableSelectedProjectsHandling -Dgib.untracked=false -Dgib.uncommitted=false\"\n+          if [ -n \"$PULL_REQUEST_BASE\" ]\n+          then\n+              # The PR defines a clear merge target so just use that branch for reference", "originalCommit": "4799d0a4c53b05d4d2e44cce6f58d5ce5fea3a63", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzA2NTQ3Ng==", "url": "https://github.com/quarkusio/quarkus/pull/13243#discussion_r523065476", "bodyText": "Also one question related to that: I don't understand exactly how things work for a PR because the remote master might be totally different from the one used to create the PR (if not rebased). I fail to understand how it works in this case?", "author": "gsmet", "createdAt": "2020-11-13T16:34:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzA1OTY3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzA3ODExMQ==", "url": "https://github.com/quarkusio/quarkus/pull/13243#discussion_r523078111", "bodyText": "When does it happen exactly? I would like to understand when this case happens and when the other case happens?\n\nAs far I was able to observe/test, this case happens when the workflow run was triggered by a pull request and not just merely by a push to a branch that does not yet have a PR.\n\nTypically, I don't understand why we only disable backport PRs in the other case.\n\nThe idea here is that there is no guessing when you have a PR because the PR clearly defines the target branch. So for some foo-backport-bar branch (or whatever) that already has a PR, GIB can simply take the target branch from the PR as reference and compare to that (e.g. 1.10).\n\nI don't understand exactly how things work for a PR because the remote master might be totally different from the one used to create the PR\n\nWhen gathering the changes, the source branch (=from where the \"working branch\", or in GIB terms \"base branch\", was branched off) is not so important. GIB or better to say JGit will find the common merge base and do the comparison from there.\nBtw, I am still hoping that someone with write access to this repo will try my \"Idea for testing this closer to reality\" (see PR description).\nIn my fork I wasn't able to properly test with multiple repos. But come to think of it, maybe I should just fork again from my fork to try to simulate it.", "author": "famod", "createdAt": "2020-11-13T16:54:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzA1OTY3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzA5MTU2Nw==", "url": "https://github.com/quarkusio/quarkus/pull/13243#discussion_r523091567", "bodyText": "PS, regarding:\n\nTypically, I don't understand why we only disable backport PRs in the other case.\n\nI've just corrected the following bit in the PR description which I think contributed to the confusion:\nFrom:\n\nNote: master, release branches (e.g. 1.10) and backport-PR-branches are not built incrementally (yet)!\n\nTo:\n\nNote: master, release branches (e.g. 1.10) and backport-branches (without PR) are not built incrementally (yet)!", "author": "famod", "createdAt": "2020-11-13T17:08:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzA1OTY3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzExMzE1Mw==", "url": "https://github.com/quarkusio/quarkus/pull/13243#discussion_r523113153", "bodyText": "PPS:\n\nBut come to think of it, maybe I should just fork again from my fork to try to simulate it.\n\nHm, doesn't work. You can only have one fork.", "author": "famod", "createdAt": "2020-11-13T17:32:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzA1OTY3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDM0NTQ1Ng==", "url": "https://github.com/quarkusio/quarkus/pull/13243#discussion_r524345456", "bodyText": "So... maybe I'm missing something but from what I understood of what you say...\nif [ -n \"$PULL_REQUEST_BASE\" ]\nWe are in the pull request case. We have a proper sha to which we can compare our changes. PULL_REQUEST_BASE is not a branch but a sha that points to the commit on top of which we have added the commits in the PR? Right?\nIf so, in this case, I don't want to use GIB for backport PRs either. I remember having said that before. In the case of the backport PRs, I want a full build in all cases.\nelse\nIf this case doesn't concern PRs, I would just disable the incremental build altogether. Especially since things are not very clear and we don't have a sha to compare to.", "author": "gsmet", "createdAt": "2020-11-16T15:19:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzA1OTY3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDM3NTkwOQ==", "url": "https://github.com/quarkusio/quarkus/pull/13243#discussion_r524375909", "bodyText": "PULL_REQUEST_BASE is not a branch but a sha\n\nYes.\n\na sha that points to the commit on top of which we have added the commits in the PR? Right?\n\nOnly if e.g. master did not receive any new commits since the PR branch was created.\nThere is a good explanation here: https://github.community/t/how-to-get-base-sha-when-using-pull-request-target/142021/6\n\nIf so, in this case, I don't want to use GIB for backport PRs either.\n\nPersonally I think with a PR it is pretty safe already since you have a clear merge target/comparison reference (the most recent SHA at PR creation time from e.g. 1.10). Additionally, with this PR, master and release branches are still built fully.\nBut these are just my 2 cents and if you want to play it extra safe so be it.\n\nIf this case doesn't concern PRs, I would just disable the incremental build altogether.\n\nThis would mean that branches in forks are always built fully. That's a pretty \"hard\" decision, IMO.\nThat's also why I asked on Zulip whether we can always expected \"backport\" to be contained in names of branches that do not target master but a release branch instead (e.g. 1.10).\nBtw, it is not a problem if master has advanced since creating the branch because the history of master is never rewritten (I suppose).", "author": "famod", "createdAt": "2020-11-16T15:57:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzA1OTY3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQ1MDA0Mw==", "url": "https://github.com/quarkusio/quarkus/pull/13243#discussion_r526450043", "bodyText": "Update: *.backport.* branches are now not built incrementally, even if there is a PR.", "author": "famod", "createdAt": "2020-11-18T21:58:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzA1OTY3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3NzExNjI0Nw==", "url": "https://github.com/quarkusio/quarkus/pull/13243#discussion_r577116247", "bodyText": "I think is resolved. As of now, branches in forks will also be built incrementally (which I definitely recommend) and *.backport.* branches are never built incrementally, with or without PR.", "author": "famod", "createdAt": "2021-02-16T20:28:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzA1OTY3Nw=="}], "type": "inlineReview"}, {"oid": "1cb32814462be5b77d5fbb7b896003a09a633dea", "url": "https://github.com/quarkusio/quarkus/commit/1cb32814462be5b77d5fbb7b896003a09a633dea", "message": "Introduce gitflow-incremental-builder\n\nRelates to #11622\n\nNote: master, release branches (e.g. 1.10) and backport-PR-branches are not built incrementally (yet)!", "committedDate": "2020-11-18T21:51:55Z", "type": "forcePushed"}, {"oid": "7b9611fe1e7dfe96e627e4b018d519f39420b27d", "url": "https://github.com/quarkusio/quarkus/commit/7b9611fe1e7dfe96e627e4b018d519f39420b27d", "message": "Introduce gitflow-incremental-builder\n\nRelates to #11622\n\nNote: master, release branches (e.g. 1.10) and backport-PR-branches are not built incrementally (yet)!", "committedDate": "2020-11-25T10:39:10Z", "type": "forcePushed"}, {"oid": "7fe0512b0b53cf72775b3b72b57ce45ab6de599a", "url": "https://github.com/quarkusio/quarkus/commit/7fe0512b0b53cf72775b3b72b57ce45ab6de599a", "message": "Introduce gitflow-incremental-builder\n\nRelates to #11622\n\nNote: master, release branches (e.g. 1.10) and backport-branches are not built incrementally!", "committedDate": "2020-11-27T17:52:03Z", "type": "forcePushed"}, {"oid": "585d178234012d1a71f59400de86edbb8bfad555", "url": "https://github.com/quarkusio/quarkus/commit/585d178234012d1a71f59400de86edbb8bfad555", "message": "Introduce gitflow-incremental-builder\n\nRelates to #11622\n\nNote: master, release branches (e.g. 1.10) and backport-branches are not built incrementally!", "committedDate": "2020-11-27T22:15:48Z", "type": "forcePushed"}, {"oid": "e9919f23054df4e4fdcc97d4768a5395c47cb513", "url": "https://github.com/quarkusio/quarkus/commit/e9919f23054df4e4fdcc97d4768a5395c47cb513", "message": "Introduce gitflow-incremental-builder\n\nRelates to #11622\n\nNote: master, release branches (e.g. 1.10) and backport-branches are not built incrementally!", "committedDate": "2020-11-29T19:49:35Z", "type": "forcePushed"}, {"oid": "3a7f71566c4758c389dbd696a32d7e969edda479", "url": "https://github.com/quarkusio/quarkus/commit/3a7f71566c4758c389dbd696a32d7e969edda479", "message": "Introduce gitflow-incremental-builder\n\nRelates to #11622\n\nNote: master, release branches (e.g. 1.10) and backport-branches are not built incrementally!", "committedDate": "2020-11-29T19:53:35Z", "type": "forcePushed"}, {"oid": "7d4bbc4c2f7233cabc4d4d3b28c6769116339789", "url": "https://github.com/quarkusio/quarkus/commit/7d4bbc4c2f7233cabc4d4d3b28c6769116339789", "message": "Introduce gitflow-incremental-builder\n\nRelates to #11622\n\nNote: master, release branches (e.g. 1.10) and backport-branches are not built incrementally!", "committedDate": "2020-11-30T20:40:53Z", "type": "forcePushed"}, {"oid": "dcf3b957c166623a0dee90ca468954693d306c4b", "url": "https://github.com/quarkusio/quarkus/commit/dcf3b957c166623a0dee90ca468954693d306c4b", "message": "Introduce gitflow-incremental-builder\n\nRelates to #11622\n\nNote: master, release branches (e.g. 1.10) and backport-branches are not built incrementally!", "committedDate": "2020-12-14T16:58:34Z", "type": "forcePushed"}, {"oid": "5e9dd3a37626ce5608115111cfa92f46cc6a349a", "url": "https://github.com/quarkusio/quarkus/commit/5e9dd3a37626ce5608115111cfa92f46cc6a349a", "message": "Introduce gitflow-incremental-builder\n\nRelates to #11622\n\nNote: master, release branches (e.g. 1.10) and backport-branches are not built incrementally!", "committedDate": "2020-12-16T00:16:05Z", "type": "forcePushed"}, {"oid": "9c4af3df4aaaf9147fd0ace9ff8715444dc17053", "url": "https://github.com/quarkusio/quarkus/commit/9c4af3df4aaaf9147fd0ace9ff8715444dc17053", "message": "Introduce gitflow-incremental-builder\n\nRelates to #11622\n\nNote: master, release branches (e.g. 1.10) and backport-branches are not built incrementally!", "committedDate": "2020-12-16T10:05:31Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDM4NTM2Ng==", "url": "https://github.com/quarkusio/quarkus/pull/13243#discussion_r544385366", "bodyText": "This and the next line need to be removed (was a temporary workaround).", "author": "famod", "createdAt": "2020-12-16T15:21:34Z", "path": ".github/workflows/ci-actions.yml", "diffHunk": "@@ -102,6 +102,33 @@ jobs:\n       - name: Delete Local Artifacts From Cache\n         shell: bash\n         run: rm -r ~/.m2/repository/io/quarkus\n+      - name: Get GIB arguments\n+        id: get-gib-args\n+        env:\n+          PULL_REQUEST_BASE: ${{ github.event.pull_request.base.sha }}\n+        run: |\n+          # See also: https://github.com/vackosar/gitflow-incremental-builder#configuration\n+          # Common GIB_ARGS for all CI cases (hint: see also pom.xml):\n+          # - disableSelectedProjectsHandling: required to detect changes in jobs that use -pl\n+          # - untracked: to ignore files created by jobs (and uncommitted to be consistent)\n+          # - forces build of quarkus-core.* (see https://github.com/quarkusio/quarkus/pull/13543#issuecomment-735955489)", "originalCommit": "9c4af3df4aaaf9147fd0ace9ff8715444dc17053", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjI1MDg2MA==", "url": "https://github.com/quarkusio/quarkus/pull/13243#discussion_r546250860", "bodyText": "Done.", "author": "famod", "createdAt": "2020-12-19T15:33:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDM4NTM2Ng=="}], "type": "inlineReview"}, {"oid": "0f04033ba4dd055171f96044382adbe9015a5523", "url": "https://github.com/quarkusio/quarkus/commit/0f04033ba4dd055171f96044382adbe9015a5523", "message": "Introduce gitflow-incremental-builder\n\nRelates to #11622\n\nNote: master, release branches (e.g. 1.10) and backport-branches are not built incrementally!", "committedDate": "2020-12-19T15:31:55Z", "type": "forcePushed"}, {"oid": "f32d09b8592ac288affa05c906a2416aa19815b1", "url": "https://github.com/quarkusio/quarkus/commit/f32d09b8592ac288affa05c906a2416aa19815b1", "message": "Introduce gitflow-incremental-builder\n\nRelates to #11622\n\nNote: master, release branches (e.g. 1.10) and backport-branches are not built incrementally!", "committedDate": "2020-12-25T11:35:22Z", "type": "forcePushed"}, {"oid": "d2e43166b7401fd5f55aa57ece43cc80aa3f9674", "url": "https://github.com/quarkusio/quarkus/commit/d2e43166b7401fd5f55aa57ece43cc80aa3f9674", "message": "Introduce gitflow-incremental-builder\n\nRelates to #11622\n\nNote: master, release branches (e.g. 1.10) and backport-branches are not built incrementally!", "committedDate": "2021-01-11T15:36:41Z", "type": "forcePushed"}, {"oid": "4d8de2d261ccbee942833fbe84d438e57b0cb6c1", "url": "https://github.com/quarkusio/quarkus/commit/4d8de2d261ccbee942833fbe84d438e57b0cb6c1", "message": "Introduce gitflow-incremental-builder\n\nRelates to #11622\n\nNote: master, release branches (e.g. 1.10) and backport-branches are not built incrementally!", "committedDate": "2021-01-19T21:38:44Z", "type": "forcePushed"}, {"oid": "c4fcba427a56958b0327e2c3559b706f2b7efb6d", "url": "https://github.com/quarkusio/quarkus/commit/c4fcba427a56958b0327e2c3559b706f2b7efb6d", "message": "Introduce gitflow-incremental-builder\n\nRelates to #11622\n\nNote: master, release branches (e.g. 1.10) and backport-branches are not built incrementally!", "committedDate": "2021-01-28T18:14:40Z", "type": "forcePushed"}, {"oid": "b83038ab39e1947bf174ade7931466342ccb7226", "url": "https://github.com/quarkusio/quarkus/commit/b83038ab39e1947bf174ade7931466342ccb7226", "message": "Move bom-descriptor-json min deps to profile for incremental build efficiency", "committedDate": "2021-02-11T18:16:29Z", "type": "forcePushed"}, {"oid": "4565fad8824e671f6f1b80223b6a7cbb470aed79", "url": "https://github.com/quarkusio/quarkus/commit/4565fad8824e671f6f1b80223b6a7cbb470aed79", "message": "Introduce gitflow-incremental-builder\n\nRelates to #11622\n\nNote: master, release branches (e.g. 1.10) and backport-branches are not built incrementally!\n\nIncludes some efficiency teaks to bom-descriptor-json\nand a \"shadow CI\" for a temporary parallel testing phase.", "committedDate": "2021-02-16T12:51:12Z", "type": "forcePushed"}, {"oid": "94dbd896290d90ab96579356d7449e126c41ab1b", "url": "https://github.com/quarkusio/quarkus/commit/94dbd896290d90ab96579356d7449e126c41ab1b", "message": "Introduce gitflow-incremental-builder\n\nRelates to #11622\n\nNote: master, release branches (e.g. 1.10) and backport-branches are not built incrementally!\n\nIncludes some efficiency teaks to bom-descriptor-json\nand a \"shadow CI\" for a temporary parallel testing phase.", "committedDate": "2021-02-16T16:34:52Z", "type": "forcePushed"}, {"oid": "0dfe5a3e222d4ba640e5e277cc0967d76ef4d40d", "url": "https://github.com/quarkusio/quarkus/commit/0dfe5a3e222d4ba640e5e277cc0967d76ef4d40d", "message": "Introduce gitflow-incremental-builder\n\nRelates to #11622\n\nNote: master, release branches (e.g. 1.10) and backport-branches are not built incrementally!\n\nIncludes some efficiency teaks to bom-descriptor-json\nand a \"shadow CI\" for a temporary parallel testing phase.", "committedDate": "2021-02-18T15:53:39Z", "type": "forcePushed"}, {"oid": "d5de8323c01694a85d0ee1a946e75ba9515875fc", "url": "https://github.com/quarkusio/quarkus/commit/d5de8323c01694a85d0ee1a946e75ba9515875fc", "message": "Introduce gitflow-incremental-builder\n\nRelates to #11622\n\nNote: master, release branches (e.g. 1.10) and backport-branches are not built incrementally!\n\nIncludes some efficiency teaks to bom-descriptor-json\nand a \"shadow CI\" for a temporary parallel testing phase.", "committedDate": "2021-02-19T17:47:59Z", "type": "forcePushed"}, {"oid": "0658cc0823af31d7499a75f3efe42ac7260ced5b", "url": "https://github.com/quarkusio/quarkus/commit/0658cc0823af31d7499a75f3efe42ac7260ced5b", "message": "Introduce gitflow-incremental-builder\n\nRelates to #11622\n\nNote: master, release branches (e.g. 1.10) and backport-branches are not built incrementally!\n\nIncludes some efficiency teaks to bom-descriptor-json\nand a \"shadow CI\" for a temporary parallel testing phase.", "committedDate": "2021-02-25T21:20:36Z", "type": "commit"}, {"oid": "0658cc0823af31d7499a75f3efe42ac7260ced5b", "url": "https://github.com/quarkusio/quarkus/commit/0658cc0823af31d7499a75f3efe42ac7260ced5b", "message": "Introduce gitflow-incremental-builder\n\nRelates to #11622\n\nNote: master, release branches (e.g. 1.10) and backport-branches are not built incrementally!\n\nIncludes some efficiency teaks to bom-descriptor-json\nand a \"shadow CI\" for a temporary parallel testing phase.", "committedDate": "2021-02-25T21:20:36Z", "type": "forcePushed"}]}