{"pr_number": 8775, "pr_title": "Qute docs bugs", "pr_createdAt": "2020-04-23T07:53:22Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/8775", "timeline": [{"oid": "fb32f348e4568053c0f447f115758e856310a40c", "url": "https://github.com/quarkusio/quarkus/commit/fb32f348e4568053c0f447f115758e856310a40c", "message": "Qute docs - fix example in user tags section\n\n- resolves #8751", "committedDate": "2020-04-23T07:37:33Z", "type": "commit"}, {"oid": "c4e99a999194b17104a5dd12c24a6a024b94e594", "url": "https://github.com/quarkusio/quarkus/commit/c4e99a999194b17104a5dd12c24a6a024b94e594", "message": "Qute SetSectionHelper - add \"let\" alias, mention the section in the docs\n\n- resolves #8749", "committedDate": "2020-04-23T07:49:48Z", "type": "commit"}, {"oid": "4d4a27d1ffef7156ca7d6e07419a15d1bbd091a4", "url": "https://github.com/quarkusio/quarkus/commit/4d4a27d1ffef7156ca7d6e07419a15d1bbd091a4", "message": "Qute docs - fix VariantTemplate example\n\n- resolves #8752", "committedDate": "2020-04-23T07:52:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzY0MjgzMw==", "url": "https://github.com/quarkusio/quarkus/pull/8775#discussion_r413642833", "bodyText": "We should still remove #{with expr as binding} because it does not have the semantics of with, and can be done with #{let binding = expr}.", "author": "FroMage", "createdAt": "2020-04-23T09:03:32Z", "path": "docs/src/main/asciidoc/qute-reference.adoc", "diffHunk": "@@ -513,6 +513,28 @@ This section might also come in handy when we'd like to avoid multiple expensive\n ----\n <1> `it` is the result of `item.callExpensiveLogicToGetTheValue(1,'foo',bazinga)`. The method is only invoked once even though the result may be used in multiple expressions.\n \n+===== Let/Set Section\n+\n+This section is an alternative to `{#with}` which allows to specify multiple named parameters:", "originalCommit": "4d4a27d1ffef7156ca7d6e07419a15d1bbd091a4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzY5Njg5MA==", "url": "https://github.com/quarkusio/quarkus/pull/8775#discussion_r413696890", "bodyText": "Ok. The semantics of with is not well-defined in Qute (or in templates in general) but I agree that it could be replaced with let/set.", "author": "mkouba", "createdAt": "2020-04-23T10:23:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzY0MjgzMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzc2MDY0OQ==", "url": "https://github.com/quarkusio/quarkus/pull/8775#discussion_r413760649", "bodyText": "Well, with to modify the current scope is fine, it's the version with as which is problematic.", "author": "FroMage", "createdAt": "2020-04-23T12:09:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzY0MjgzMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzc2ODg1NQ==", "url": "https://github.com/quarkusio/quarkus/pull/8775#discussion_r413768855", "bodyText": "Done.", "author": "mkouba", "createdAt": "2020-04-23T12:22:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzY0MjgzMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzY0MzU5NA==", "url": "https://github.com/quarkusio/quarkus/pull/8775#discussion_r413643594", "bodyText": "Huh, why did you rename it? Does the #item tag namespace clash with the local variable item? If that's the case it's a bug.", "author": "FroMage", "createdAt": "2020-04-23T09:04:39Z", "path": "docs/src/main/asciidoc/qute-reference.adoc", "diffHunk": "@@ -567,30 +589,30 @@ Let's suppose we have a template called `item.html`:\n <1> `showImage` is a named parameter.\n <2> `it` is a special key that is replaced with the first unnamed param of the tag.\n \n-Now if we register this template under the name `item` and if we add a `UserTagSectionHelper` to the engine:\n+Now if we register this template under the name `itemDetail` and if we add a `UserTagSectionHelper` to the engine:\n \n [source,java]\n ----\n Engine engine = Engine.builder()\n-                   .addSectionHelper(new UserTagSectionHelper.Factory(\"item\"))\n+                   .addSectionHelper(new UserTagSectionHelper.Factory(\"myItem\",\"itemDetail.html\"))\n                    .build();\n ----\n \n-NOTE: In Quarkus, all files from the `src/main/resources/templates/tags` are registered and monitored automatically.\n+NOTE: In Quarkus, all files from the `src/main/resources/templates/tags` are registered and monitored automatically!\n \n We can include the tag like this:\n \n [source,html]\n ----\n <ul>\n-{#each items}\n+{#for item in items}\n   <li>\n-  {#item this showImage=true /} <1>\n+  {#myItem item showImage=true /} <1>", "originalCommit": "4d4a27d1ffef7156ca7d6e07419a15d1bbd091a4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzY2NDA2OQ==", "url": "https://github.com/quarkusio/quarkus/pull/8775#discussion_r413664069", "bodyText": "No, it could be item or anything else. I just wanted to have the example more readable... {#item item} is not good.", "author": "mkouba", "createdAt": "2020-04-23T09:33:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzY0MzU5NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzY2NjQ1OA==", "url": "https://github.com/quarkusio/quarkus/pull/8775#discussion_r413666458", "bodyText": "OK, pfew :)\nBut frankly #{item item} is still way better than #{myItem item}. Perhaps it's #{itemDescription item} you were aiming for? ;)", "author": "FroMage", "createdAt": "2020-04-23T09:37:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzY0MzU5NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzcxOTUxOQ==", "url": "https://github.com/quarkusio/quarkus/pull/8775#discussion_r413719519", "bodyText": "But frankly #{item item} is still way better than #{myItem item}.\n\nOh, really? ;-) Anyway, #{itemDescription item} or {#itemDetail item} reads definitely better. My intention was to show the link between the tag name registered above. But this is not important in quarkus where tags are registered automatically.", "author": "mkouba", "createdAt": "2020-04-23T10:59:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzY0MzU5NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzY0NDA4MQ==", "url": "https://github.com/quarkusio/quarkus/pull/8775#discussion_r413644081", "bodyText": "This is the first place I realised how we can pass more than one parameter to a tag. Is this formally documented somewhere else in this file? If not, it should, I was sure I would need a comma.", "author": "FroMage", "createdAt": "2020-04-23T09:05:20Z", "path": "docs/src/main/asciidoc/qute-reference.adoc", "diffHunk": "@@ -567,30 +589,30 @@ Let's suppose we have a template called `item.html`:\n <1> `showImage` is a named parameter.\n <2> `it` is a special key that is replaced with the first unnamed param of the tag.\n \n-Now if we register this template under the name `item` and if we add a `UserTagSectionHelper` to the engine:\n+Now if we register this template under the name `itemDetail` and if we add a `UserTagSectionHelper` to the engine:\n \n [source,java]\n ----\n Engine engine = Engine.builder()\n-                   .addSectionHelper(new UserTagSectionHelper.Factory(\"item\"))\n+                   .addSectionHelper(new UserTagSectionHelper.Factory(\"myItem\",\"itemDetail.html\"))\n                    .build();\n ----\n \n-NOTE: In Quarkus, all files from the `src/main/resources/templates/tags` are registered and monitored automatically.\n+NOTE: In Quarkus, all files from the `src/main/resources/templates/tags` are registered and monitored automatically!\n \n We can include the tag like this:\n \n [source,html]\n ----\n <ul>\n-{#each items}\n+{#for item in items}\n   <li>\n-  {#item this showImage=true /} <1>\n+  {#myItem item showImage=true /} <1>", "originalCommit": "4d4a27d1ffef7156ca7d6e07419a15d1bbd091a4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzY4OTc4OQ==", "url": "https://github.com/quarkusio/quarkus/pull/8775#discussion_r413689789", "bodyText": "Comma was never required. It's not documented. The whole SPI needs docs but since it's still a WIP it has a lower priority. In short, a section/tag may consume any number of named/unnamed parameters and it's the responsibility of a section to interprete the params, i.e. it could be an expression ('item.name') or it could be ignored (such as in in the {#for item in items}).\nWe already have #7326.", "author": "mkouba", "createdAt": "2020-04-23T10:11:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzY0NDA4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzc3NjkxNw==", "url": "https://github.com/quarkusio/quarkus/pull/8775#discussion_r413776917", "bodyText": "So, this is what bugs me about the regularity of those tags. Some use in or as keywords (not evaluated) while others use = which seems to be an operator, but I'm not clear on that either.\nThe semantics are not clear to me as a user. And it doesn't appear regular.\nCompare this with the following syntax:\n<ul>\n#{list items:products, as:'product'}\n    <li>${product}</li>\n#{/list}\n</ul>\n\nWhere you can pass exactly one unnamed parameter to a tag, or you pass them by name with the : operator and , separator. As you can see, here products is an expression, while 'product' is a string. The semantics are clear.\nIt's less flexible, but it's much more consistent with programming language constructs. For example, I'm not sure how the current semantics of passing parameters as-is to Java tag implementation combines with the rule for named parameters: can I call #{foo first second third=something} and expect it to work if foo is a Java tag?\nUsing the current Qute syntax, this would mean:\n{#for items, as='item'}\n\nNow, given that we only have as in the problematic with form (which we should remove in favour of let/set), that only leaves us with a single keyword in, and I've observed people mostly write custom tags using taglet files (not in Java), perhaps there's not much risk in this sort of keybord behaviour proliferating to confuse users.\nBut at the very least, we need to document that parameters are passed separated by spaces, named parameters use =.", "author": "FroMage", "createdAt": "2020-04-23T12:34:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzY0NDA4MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzY0NDkzNg==", "url": "https://github.com/quarkusio/quarkus/pull/8775#discussion_r413644936", "bodyText": "As I see tests mentioning this I have to ask what it refers to?", "author": "FroMage", "createdAt": "2020-04-23T09:06:29Z", "path": "independent-projects/qute/core/src/test/java/io/quarkus/qute/UserTagTest.java", "diffHunk": "@@ -17,17 +17,17 @@ public void testUserTag() {\n \n         Template tag = engine.parse(\"{#if showImage}{it.name}{#else}nope{/if}\");\n         engine.putTemplate(\"my-tag-id\", tag);\n-        Template template1 = engine.parse(\"{#myTag order showImage=true /}\");\n-        Template template2 = engine.parse(\"{#myTag order /}\");\n-        Template template3 = engine.parse(\"{#myTag showImage=false /}\");\n-        Template template4 = engine.parse(\"{#each this}{#myTag showImage=false /}{/each}\");\n \n         Map<String, Object> order = new HashMap<>();\n         order.put(\"name\", \"Herbert\");\n-        assertEquals(\"Herbert\", template1.render(Collections.singletonMap(\"order\", order)));\n-        assertEquals(\"nope\", template2.render(Collections.singletonMap(\"order\", order)));\n-        assertEquals(\"nope\", template3.render(Collections.singletonMap(\"order\", order)));\n-        assertEquals(\"nope\", template4.render(Collections.singletonMap(\"order\", order)));\n+        assertEquals(\"Herbert\",\n+                engine.parse(\"{#myTag order showImage=true /}\").render(Collections.singletonMap(\"order\", order)));\n+        assertEquals(\"nope\", engine.parse(\"{#myTag order /}\").render(Collections.singletonMap(\"order\", order)));\n+        assertEquals(\"nope\", engine.parse(\"{#myTag showImage=false /}\").render(Collections.singletonMap(\"order\", order)));\n+        assertEquals(\"nope\",\n+                engine.parse(\"{#each this}{#myTag showImage=false /}{/each}\").render(Collections.singletonMap(\"order\", order)));", "originalCommit": "4d4a27d1ffef7156ca7d6e07419a15d1bbd091a4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzY5NTc2MQ==", "url": "https://github.com/quarkusio/quarkus/pull/8775#discussion_r413695761", "bodyText": "In this particular case it refers to the data object passed to the template. this always returns the last context object on the stack.", "author": "mkouba", "createdAt": "2020-04-23T10:21:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzY0NDkzNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzc3NzczMA==", "url": "https://github.com/quarkusio/quarkus/pull/8775#discussion_r413777730", "bodyText": "If it's not documented, it should not be implemented. If it's implemented it should be documented.\nATM I don't see the value of having this be implemented and resolved, so I suggest we disable it.", "author": "FroMage", "createdAt": "2020-04-23T12:35:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzY0NDkzNg=="}], "type": "inlineReview"}, {"oid": "feba3c9874de9457c10c2cc8c80e9c06f785552b", "url": "https://github.com/quarkusio/quarkus/commit/feba3c9874de9457c10c2cc8c80e9c06f785552b", "message": "Qute - remove alias from the With section", "committedDate": "2020-04-23T12:24:38Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzc3OTk5MA==", "url": "https://github.com/quarkusio/quarkus/pull/8775#discussion_r413779990", "bodyText": "No it is not: it does not change the scope: it adds new lexical bindings.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            This section is an alternative to `{#with}` which allows to specify one or more named parameters:\n          \n          \n            \n            This section allows you to define named local variables:", "author": "FroMage", "createdAt": "2020-04-23T12:39:04Z", "path": "docs/src/main/asciidoc/qute-reference.adoc", "diffHunk": "@@ -489,29 +489,40 @@ This could be useful to simplify the template structure:\n <1> The `name` will be resolved against the `item.parent`.\n <2> The `description` will be also resolved against the `item.parent`.\n \n-It's also possible to specify an alias for the context object:\n+This section might also come in handy when we'd like to avoid multiple expensive invocations:\n \n [source,html]\n ----\n-{#with item.parent as myParent} <1>\n-  <h1>{myParent.name}</h1>\n+{#with item.callExpensiveLogicToGetTheValue(1,'foo',bazinga)}\n+  {#if this is \"fun\"} <1>\n+    <h1>Yay!</h1>\n+  {#else}\n+    <h1>{this} is not fun at all!</h1>\n+  {/if}\n {/with}\n ----\n-<1> `myParent` is the alias that can be used inside the tag.\n+<1> `this` is the result of `item.callExpensiveLogicToGetTheValue(1,'foo',bazinga)`. The method is only invoked once even though the result may be used in multiple expressions.\n \n-This section might also come in handy when we'd like to avoid multiple expensive invocations:\n+===== Let/Set Section\n \n+This section is an alternative to `{#with}` which allows to specify one or more named parameters:", "originalCommit": "feba3c9874de9457c10c2cc8c80e9c06f785552b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzc5Mjk4NA==", "url": "https://github.com/quarkusio/quarkus/pull/8775#discussion_r413792984", "bodyText": "No it is not: it does not change the scope: it adds new lexical bindings.\n\nNot really. Under the hood it does modify the current context. But I can change the wording. No problem.", "author": "mkouba", "createdAt": "2020-04-23T12:57:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzc3OTk5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzc5NzQ4MQ==", "url": "https://github.com/quarkusio/quarkus/pull/8775#discussion_r413797481", "bodyText": "OK, fine, it does introduce a new scope, right? It doesn't modify the current scope in the sense that it modifies the existing scope, right?\nI still think that in this context, saying something along the lines of \"it defines new local variables\" is the easiest thing to explain to devs, no? We just want to make it clear that it's a bounded local scope with new bindings.", "author": "FroMage", "createdAt": "2020-04-23T13:03:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzc3OTk5MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzc4MDQzNA==", "url": "https://github.com/quarkusio/quarkus/pull/8775#discussion_r413780434", "bodyText": "Damnit, this is back. But at least this time it makes sense.", "author": "FroMage", "createdAt": "2020-04-23T12:39:44Z", "path": "docs/src/main/asciidoc/qute-reference.adoc", "diffHunk": "@@ -489,29 +489,40 @@ This could be useful to simplify the template structure:\n <1> The `name` will be resolved against the `item.parent`.\n <2> The `description` will be also resolved against the `item.parent`.\n \n-It's also possible to specify an alias for the context object:\n+This section might also come in handy when we'd like to avoid multiple expensive invocations:\n \n [source,html]\n ----\n-{#with item.parent as myParent} <1>\n-  <h1>{myParent.name}</h1>\n+{#with item.callExpensiveLogicToGetTheValue(1,'foo',bazinga)}", "originalCommit": "feba3c9874de9457c10c2cc8c80e9c06f785552b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzc4MTIyMA==", "url": "https://github.com/quarkusio/quarkus/pull/8775#discussion_r413781220", "bodyText": "This price thing confuses me: it's not coming from order.item.parent/myParent, right?", "author": "FroMage", "createdAt": "2020-04-23T12:40:53Z", "path": "docs/src/main/asciidoc/qute-reference.adoc", "diffHunk": "@@ -489,29 +489,40 @@ This could be useful to simplify the template structure:\n <1> The `name` will be resolved against the `item.parent`.\n <2> The `description` will be also resolved against the `item.parent`.\n \n-It's also possible to specify an alias for the context object:\n+This section might also come in handy when we'd like to avoid multiple expensive invocations:\n \n [source,html]\n ----\n-{#with item.parent as myParent} <1>\n-  <h1>{myParent.name}</h1>\n+{#with item.callExpensiveLogicToGetTheValue(1,'foo',bazinga)}\n+  {#if this is \"fun\"} <1>\n+    <h1>Yay!</h1>\n+  {#else}\n+    <h1>{this} is not fun at all!</h1>\n+  {/if}\n {/with}\n ----\n-<1> `myParent` is the alias that can be used inside the tag.\n+<1> `this` is the result of `item.callExpensiveLogicToGetTheValue(1,'foo',bazinga)`. The method is only invoked once even though the result may be used in multiple expressions.\n \n-This section might also come in handy when we'd like to avoid multiple expensive invocations:\n+===== Let/Set Section\n \n+This section is an alternative to `{#with}` which allows to specify one or more named parameters:\n [source,html]\n ----\n-{#with item.callExpensiveLogicToGetTheValue(true) as it}\n-  {#if it is \"fun\"} <1>\n-    <h1>Yay!</h1>\n-  {#else}\n-    <h1>{it} is not fun at all!</h1>\n-  {/if}\n-{/with}\n+{#let myParent=order.item.parent}\n+  <h1>{myParent.name}</h1>\n+  <p>Price: {price}", "originalCommit": "feba3c9874de9457c10c2cc8c80e9c06f785552b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzc5NDEyMg==", "url": "https://github.com/quarkusio/quarkus/pull/8775#discussion_r413794122", "bodyText": "Nope. It's a mistake. Good catch! The original version had a price param too. Normally, Qute would attempt to find a price in the parent contexts...", "author": "mkouba", "createdAt": "2020-04-23T12:58:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzc4MTIyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzc5NTkzOQ==", "url": "https://github.com/quarkusio/quarkus/pull/8775#discussion_r413795939", "bodyText": "Well, it's fine that it would resolve it from the parent scope (that's what I expect), I just wanted to be sure, because its presence in this example confused me.", "author": "FroMage", "createdAt": "2020-04-23T13:01:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzc4MTIyMA=="}], "type": "inlineReview"}, {"oid": "b76fce8e03a3aed7999fe4fa8a0d351cde3f042e", "url": "https://github.com/quarkusio/quarkus/commit/b76fce8e03a3aed7999fe4fa8a0d351cde3f042e", "message": "Qute - remove alias from the With section", "committedDate": "2020-04-23T13:01:30Z", "type": "commit"}, {"oid": "b76fce8e03a3aed7999fe4fa8a0d351cde3f042e", "url": "https://github.com/quarkusio/quarkus/commit/b76fce8e03a3aed7999fe4fa8a0d351cde3f042e", "message": "Qute - remove alias from the With section", "committedDate": "2020-04-23T13:01:30Z", "type": "forcePushed"}]}