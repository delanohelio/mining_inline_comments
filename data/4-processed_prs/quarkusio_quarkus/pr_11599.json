{"pr_number": 11599, "pr_title": "Switch from elasticearch-maven-plugin to docker-maven-plugin to start Elasticsearch for ITs", "pr_createdAt": "2020-08-25T12:14:41Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/11599", "timeline": [{"oid": "ba6244a20bf9c742a2a804bb09e5d92e7506b9f9", "url": "https://github.com/quarkusio/quarkus/commit/ba6244a20bf9c742a2a804bb09e5d92e7506b9f9", "message": "Start Elasticsearch in the GitHub actions build", "committedDate": "2020-08-25T13:17:33Z", "type": "forcePushed"}, {"oid": "9e6f7b1790b5a6b71fd821adb5414ec9a38eb155", "url": "https://github.com/quarkusio/quarkus/commit/9e6f7b1790b5a6b71fd821adb5414ec9a38eb155", "message": "Start Elasticsearch in the GitHub actions build", "committedDate": "2020-08-25T13:20:01Z", "type": "forcePushed"}, {"oid": "94028a62a555d0cdf9d90a0a16b5b5ba65db9597", "url": "https://github.com/quarkusio/quarkus/commit/94028a62a555d0cdf9d90a0a16b5b5ba65db9597", "message": "Start Elasticsearch in the GitHub actions build", "committedDate": "2020-08-25T15:53:59Z", "type": "forcePushed"}, {"oid": "d5c89e6bd2c4f23b0cc8522e9fe9ab455a84cf63", "url": "https://github.com/quarkusio/quarkus/commit/d5c89e6bd2c4f23b0cc8522e9fe9ab455a84cf63", "message": "Switch from elasticearch-maven-plugin to docker-maven-plugin to start Elasticsearch for ITs", "committedDate": "2020-08-26T06:54:14Z", "type": "commit"}, {"oid": "410cb2f519131aa63ea6ae61e420d45451e67ef1", "url": "https://github.com/quarkusio/quarkus/commit/410cb2f519131aa63ea6ae61e420d45451e67ef1", "message": "Make it possible to run Elasticsearch-related tests against an external ES instance", "committedDate": "2020-08-26T06:54:14Z", "type": "commit"}, {"oid": "2089b5154dbcae14bcfdf414a702fc75aeeeec04", "url": "https://github.com/quarkusio/quarkus/commit/2089b5154dbcae14bcfdf414a702fc75aeeeec04", "message": "Start Elasticsearch in the GitHub actions build", "committedDate": "2020-08-26T06:54:14Z", "type": "commit"}, {"oid": "2089b5154dbcae14bcfdf414a702fc75aeeeec04", "url": "https://github.com/quarkusio/quarkus/commit/2089b5154dbcae14bcfdf414a702fc75aeeeec04", "message": "Start Elasticsearch in the GitHub actions build", "committedDate": "2020-08-26T06:54:14Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzEzOTk2NQ==", "url": "https://github.com/quarkusio/quarkus/pull/11599#discussion_r477139965", "bodyText": "Interesting, I just learned about this script.", "author": "Sanne", "createdAt": "2020-08-26T08:49:45Z", "path": "integration-tests/elasticsearch-rest-client/pom.xml", "diffHunk": "@@ -91,35 +97,94 @@\n               <skip>false</skip>\n             </configuration>\n           </plugin>\n+        </plugins>\n+      </build>\n+    </profile>\n+\n+    <profile>\n+      <id>docker-elasticsearch</id>\n+      <activation>\n+        <property>\n+          <name>docker</name>\n+        </property>\n+      </activation>\n+      <properties>\n+        <elasticsearch.hosts>localhost:9200</elasticsearch.hosts>\n+        <elasticsearch.protocol>http</elasticsearch.protocol>\n+      </properties>\n+      <build>\n+        <plugins>\n           <plugin>\n-            <groupId>com.github.alexcojocaru</groupId>\n-            <artifactId>elasticsearch-maven-plugin</artifactId>\n+            <groupId>io.fabric8</groupId>\n+            <artifactId>docker-maven-plugin</artifactId>\n             <configuration>\n-              <timeout>90</timeout>\n-              <pathConf>${project.build.directory}/test-classes/elasticsearch-maven-plugin/configuration/</pathConf>\n-              <autoCreateIndex>true</autoCreateIndex>\n+              <images>\n+                <image>\n+                  <name>${elasticsearch.image}</name>\n+                  <alias>elasticsearch</alias>\n+                  <run>\n+                    <env>\n+                      <discovery.type>single-node</discovery.type>\n+                    </env>\n+                    <ports>\n+                      <port>9200:9200</port>\n+                    </ports>\n+                    <log>\n+                      <prefix>Elasticsearch: </prefix>\n+                      <date>default</date>\n+                      <color>cyan</color>\n+                    </log>\n+                    <wait>\n+                      <http>\n+                        <url>http://localhost:9200</url>\n+                        <method>GET</method>\n+                        <status>200</status>\n+                      </http>\n+                      <time>20000</time>\n+                    </wait>\n+                  </run>\n+                </image>\n+              </images>\n+              <allContainers>true</allContainers>\n             </configuration>\n-            <!-- Different executions from 2.x: the \"start\" goal has been renamed in version 5  -->\n             <executions>\n               <execution>\n-                <id>start-elasticsearch</id>\n+                <id>docker-start</id>\n                 <phase>process-test-classes</phase>\n                 <goals>\n-                  <goal>runforked</goal>\n+                  <goal>stop</goal>\n+                  <goal>start</goal>\n                 </goals>\n               </execution>\n               <execution>\n-                <id>stop-elasticsearch</id>\n+                <id>docker-stop</id>\n                 <phase>post-integration-test</phase>\n                 <goals>\n                   <goal>stop</goal>\n                 </goals>\n               </execution>\n             </executions>\n           </plugin>\n+          <plugin>\n+            <groupId>org.codehaus.mojo</groupId>\n+            <artifactId>exec-maven-plugin</artifactId>\n+            <executions>\n+              <execution>\n+                <id>docker-prune</id>\n+                <phase>generate-resources</phase>\n+                <goals>\n+                  <goal>exec</goal>\n+                </goals>\n+                <configuration>\n+                  <executable>${basedir}/../../.github/docker-prune.sh</executable>", "originalCommit": "2089b5154dbcae14bcfdf414a702fc75aeeeec04", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzE1MjE4Mw==", "url": "https://github.com/quarkusio/quarkus/pull/11599#discussion_r477152183", "bodyText": "I copy-pasted that from another pom file. Not sure it's useful, but well... that's how it works everywhere else \ud83e\udd37", "author": "yrodiere", "createdAt": "2020-08-26T09:10:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzEzOTk2NQ=="}], "type": "inlineReview"}]}