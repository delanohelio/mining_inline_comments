{"pr_number": 11500, "pr_title": "Kubernetes secret config changes", "pr_createdAt": "2020-08-20T15:28:24Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/11500", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDA4ODQzNQ==", "url": "https://github.com/quarkusio/quarkus/pull/11500#discussion_r474088435", "bodyText": "The TODO is no longer valid, we should remove it, or replace with an up-to-date text.", "author": "Ladicek", "createdAt": "2020-08-20T15:49:34Z", "path": "extensions/kubernetes-config/runtime/src/main/java/io/quarkus/kubernetes/client/runtime/AbstractKubernetesConfigSourceUtil.java", "diffHunk": "@@ -72,6 +72,7 @@ abstract ConfigSource createPropertiesConfigSource(String kubernetesConfigSource\n             } else {\n                 // TODO all keys named `*.{properties,yml,yaml}` are categorized as file sources,\n                 //  but here, we only look for `application.{properties,yml,yaml}`\n+                // Also see qualifier in categorize function below", "originalCommit": "7626f01be3f73ab5fd90e357984082791a88b431", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDA4ODYwOQ==", "url": "https://github.com/quarkusio/quarkus/pull/11500#discussion_r474088609", "bodyText": "I'd say startsWith, to be safe.", "author": "Ladicek", "createdAt": "2020-08-20T15:49:50Z", "path": "extensions/kubernetes-config/runtime/src/main/java/io/quarkus/kubernetes/client/runtime/AbstractKubernetesConfigSourceUtil.java", "diffHunk": "@@ -91,7 +92,8 @@ private static CategorizedConfigSourceData categorize(Map<String, String> data)\n         List<Map.Entry<String, String>> fileData = new ArrayList<>();\n         for (Map.Entry<String, String> entry : data.entrySet()) {\n             String key = entry.getKey();\n-            if (key.endsWith(\".yml\") || key.endsWith(\".yaml\") || key.endsWith(\".properties\")) {\n+            if ((key.contains(\"application\")) &&", "originalCommit": "7626f01be3f73ab5fd90e357984082791a88b431", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDA5MDIzOA==", "url": "https://github.com/quarkusio/quarkus/pull/11500#discussion_r474090238", "bodyText": "Why not keep the existing tests? They should still pass, no? At least the one that verifies content of application.properties.", "author": "Ladicek", "createdAt": "2020-08-20T15:52:05Z", "path": "extensions/kubernetes-config/runtime/src/test/java/io/quarkus/kubernetes/client/runtime/SecretConfigSourceUtilTest.java", "diffHunk": "@@ -102,14 +102,18 @@ void testWithAllKindsOfData() {\n         List<ConfigSource> configSources = sut.toConfigSources(secret.getMetadata().getName(), secret.getData());\n \n         assertThat(configSources).hasSize(4);\n-        assertThat(configSources).filteredOn(c -> c.getName().toLowerCase().contains(\"literal\"))\n-                .hasOnlyOneElementSatisfying(c -> {\n-                    assertThat(c.getProperties()).containsOnly(entry(\"some.key\", \"someValue\"));\n-                });\n-        assertThat(configSources).filteredOn(c -> c.getName().toLowerCase().contains(\"application.properties\"))", "originalCommit": "7626f01be3f73ab5fd90e357984082791a88b431", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDA5ODM0NA==", "url": "https://github.com/quarkusio/quarkus/pull/11500#discussion_r474098344", "bodyText": "For some reason the existing code was adding a \"-literal\" to the secret key. No idea why, I searched the code and it wasn't removed so I removed it. It was on line 53", "author": "noelo", "createdAt": "2020-08-20T16:04:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDA5MDIzOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDU4NDQyMg==", "url": "https://github.com/quarkusio/quarkus/pull/11500#discussion_r474584422", "bodyText": "OK, but that's not a reason to delete the test, right? The secret has application.properties, application.yaml and application.yml keys, and we still want to test those.", "author": "Ladicek", "createdAt": "2020-08-21T09:39:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDA5MDIzOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDU5OTE5Mg==", "url": "https://github.com/quarkusio/quarkus/pull/11500#discussion_r474599192", "bodyText": "the test was incomplete, the literal returned only the \"some.key\" element where it should have had everything except the \"application.properties, application.yml and application.yaml\"....the next line ensures that all k/v other than these are returned.", "author": "noelo", "createdAt": "2020-08-21T09:57:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDA5MDIzOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDYwOTEyOQ==", "url": "https://github.com/quarkusio/quarkus/pull/11500#discussion_r474609129", "bodyText": "Sorry, I still don't understand why we can't have tests for the application.* keys. If the previous test was wrong, can't we fix it?", "author": "Ladicek", "createdAt": "2020-08-21T10:19:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDA5MDIzOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDYxMzQ2MQ==", "url": "https://github.com/quarkusio/quarkus/pull/11500#discussion_r474613461", "bodyText": "ahh right I was looking at the wrong thing, I see what you mean. I'll add that back in.", "author": "noelo", "createdAt": "2020-08-21T10:27:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDA5MDIzOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDY0NjA0NA==", "url": "https://github.com/quarkusio/quarkus/pull/11500#discussion_r474646044", "bodyText": "Ha, I just realized that there were tests for application.{yml,yaml} below that I didn't notice. That's probably why my comments didn't make much sense :-)", "author": "Ladicek", "createdAt": "2020-08-21T11:45:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDA5MDIzOA=="}], "type": "inlineReview"}, {"oid": "31ef4ada879b6d1cc7d0c61b9e9eccd50b2abc69", "url": "https://github.com/quarkusio/quarkus/commit/31ef4ada879b6d1cc7d0c61b9e9eccd50b2abc69", "message": "Fix for #11461\n\nFixing minor updates after review\n\nRe-added missing test\n\nFixed configmap tests", "committedDate": "2020-08-21T14:58:50Z", "type": "forcePushed"}, {"oid": "13eabbee538330f6025e8f574af1d06ed205d800", "url": "https://github.com/quarkusio/quarkus/commit/13eabbee538330f6025e8f574af1d06ed205d800", "message": "Fix for #11461\n\nFixing minor updates after review\n\nRe-added missing test\n\nFixed configmap tests", "committedDate": "2020-08-21T15:20:10Z", "type": "forcePushed"}, {"oid": "5fcb06a510578f05baaffc2191dff2b619bfb266", "url": "https://github.com/quarkusio/quarkus/commit/5fcb06a510578f05baaffc2191dff2b619bfb266", "message": "Fix for #11461\n\nFixing minor updates after review\n\nRe-added missing test\n\nFixed configmap tests", "committedDate": "2020-08-27T12:54:22Z", "type": "forcePushed"}, {"oid": "79584f8caebbc96fecfb4278baac57effe3c807d", "url": "https://github.com/quarkusio/quarkus/commit/79584f8caebbc96fecfb4278baac57effe3c807d", "message": "Fix for #11461\n\nFixing minor updates after review\n\nRe-added missing test\n\nFixed configmap tests", "committedDate": "2020-08-27T16:28:11Z", "type": "forcePushed"}, {"oid": "48b0c15d9c958ae3c669d03643bf99d908bb810f", "url": "https://github.com/quarkusio/quarkus/commit/48b0c15d9c958ae3c669d03643bf99d908bb810f", "message": "Fix for #11461\n\nFixing minor updates after review\n\nRe-added missing test\n\nFixed configmap tests", "committedDate": "2020-08-28T08:32:22Z", "type": "forcePushed"}, {"oid": "2a5cd97f23302e987de357e5a53a4a215af4d223", "url": "https://github.com/quarkusio/quarkus/commit/2a5cd97f23302e987de357e5a53a4a215af4d223", "message": "Fix for #11461\n\nFixing minor updates after review\n\nRe-added missing test\n\nFixed configmap tests", "committedDate": "2020-08-31T09:00:53Z", "type": "commit"}, {"oid": "2a5cd97f23302e987de357e5a53a4a215af4d223", "url": "https://github.com/quarkusio/quarkus/commit/2a5cd97f23302e987de357e5a53a4a215af4d223", "message": "Fix for #11461\n\nFixing minor updates after review\n\nRe-added missing test\n\nFixed configmap tests", "committedDate": "2020-08-31T09:00:53Z", "type": "forcePushed"}]}