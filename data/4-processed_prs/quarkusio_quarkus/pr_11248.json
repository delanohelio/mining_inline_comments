{"pr_number": 11248, "pr_title": "Fail build with HAL resource without serializer #11246", "pr_createdAt": "2020-08-06T09:40:31Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/11248", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjI5NTgzMg==", "url": "https://github.com/quarkusio/quarkus/pull/11248#discussion_r466295832", "bodyText": "You should rely on the Capabilities here. The ones existing don't really cover your use case (I checked, even if their names sound appealing, they are not covering your needs) so you will need to add RESTEASY_JACKSON and RESTEASY_JSONB and produce them from the respective processors together with the others.", "author": "gsmet", "createdAt": "2020-08-06T09:46:04Z", "path": "extensions/panache/rest-data-panache/deployment/src/main/java/io/quarkus/rest/data/panache/deployment/RestDataProcessor.java", "diffHunk": "@@ -57,4 +63,36 @@ JsonbSerializerBuildItem registerJsonbSerializers() {\n     RuntimeInitializedClassBuildItem el() {\n         return new RuntimeInitializedClassBuildItem(EL.class.getCanonicalName());\n     }\n+\n+    private void verifyHalResources(IndexView index, List<RestDataResourceBuildItem> resourceBuildItems) {\n+        if (!hasJsonProcessor() && hasHalResource(index, resourceBuildItems)) {\n+            logger.warn(\"Cannot generate HAL endpoints without a serializer. \"\n+                    + \"Make sure you have either Jsonb or Jackson RESTEasy extension enabled.\");\n+            throw new RestDataBuildException(\"Cannot generate HAL endpoints without a serializer\");\n+        }\n+    }\n+\n+    private boolean hasHalResource(IndexView index, List<RestDataResourceBuildItem> resourceBuildItems) {\n+        ResourcePropertiesAccessor propertiesAccessor = new ResourcePropertiesAccessor(index);\n+        for (RestDataResourceBuildItem resource : resourceBuildItems) {\n+            if (propertiesAccessor.isHal(resource.getResourceInfo().getClassInfo())) {\n+                return true;\n+            }\n+        }\n+        return false;\n+    }\n+\n+    private boolean hasJsonProcessor() {", "originalCommit": "7a904029b93e7ac3cc8f076a4783145498f7d6da", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjI5NjMyNg==", "url": "https://github.com/quarkusio/quarkus/pull/11248#discussion_r466296326", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                + \"Make sure you have either Jsonb or Jackson RESTEasy extension enabled.\");\n          \n          \n            \n                                + \"Make sure you have either RESTEasy JSON-B or Jackson extension enabled.\");", "author": "gsmet", "createdAt": "2020-08-06T09:46:57Z", "path": "extensions/panache/rest-data-panache/deployment/src/main/java/io/quarkus/rest/data/panache/deployment/RestDataProcessor.java", "diffHunk": "@@ -57,4 +63,36 @@ JsonbSerializerBuildItem registerJsonbSerializers() {\n     RuntimeInitializedClassBuildItem el() {\n         return new RuntimeInitializedClassBuildItem(EL.class.getCanonicalName());\n     }\n+\n+    private void verifyHalResources(IndexView index, List<RestDataResourceBuildItem> resourceBuildItems) {\n+        if (!hasJsonProcessor() && hasHalResource(index, resourceBuildItems)) {\n+            logger.warn(\"Cannot generate HAL endpoints without a serializer. \"\n+                    + \"Make sure you have either Jsonb or Jackson RESTEasy extension enabled.\");", "originalCommit": "7a904029b93e7ac3cc8f076a4783145498f7d6da", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjI5ODExOA==", "url": "https://github.com/quarkusio/quarkus/pull/11248#discussion_r466298118", "bodyText": "Either you log a warning or you throw an exception. In this case, I would just throw an exception with the proper message.\nAlso I don't think you need a specific exception for this. An IllegalStateException would be perfectly adequate IMHO.", "author": "gsmet", "createdAt": "2020-08-06T09:50:13Z", "path": "extensions/panache/rest-data-panache/deployment/src/main/java/io/quarkus/rest/data/panache/deployment/RestDataProcessor.java", "diffHunk": "@@ -57,4 +63,36 @@ JsonbSerializerBuildItem registerJsonbSerializers() {\n     RuntimeInitializedClassBuildItem el() {\n         return new RuntimeInitializedClassBuildItem(EL.class.getCanonicalName());\n     }\n+\n+    private void verifyHalResources(IndexView index, List<RestDataResourceBuildItem> resourceBuildItems) {\n+        if (!hasJsonProcessor() && hasHalResource(index, resourceBuildItems)) {\n+            logger.warn(\"Cannot generate HAL endpoints without a serializer. \"\n+                    + \"Make sure you have either Jsonb or Jackson RESTEasy extension enabled.\");\n+            throw new RestDataBuildException(\"Cannot generate HAL endpoints without a serializer\");", "originalCommit": "7a904029b93e7ac3cc8f076a4783145498f7d6da", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "8e132c299346a020ff2249f40f101b38b25e0ecf", "url": "https://github.com/quarkusio/quarkus/commit/8e132c299346a020ff2249f40f101b38b25e0ecf", "message": "Fail build with HAL resource without serializer #11246", "committedDate": "2020-08-07T08:40:46Z", "type": "forcePushed"}, {"oid": "19ba0d496980c6001155315b337ccf4789977148", "url": "https://github.com/quarkusio/quarkus/commit/19ba0d496980c6001155315b337ccf4789977148", "message": "Fail build with HAL resource without serializer #11246", "committedDate": "2020-08-20T13:45:43Z", "type": "forcePushed"}, {"oid": "fc66a0deb063bd87f873bfcbbf120cc897dded51", "url": "https://github.com/quarkusio/quarkus/commit/fc66a0deb063bd87f873bfcbbf120cc897dded51", "message": "Fail build with HAL resource without serializer #11246", "committedDate": "2020-10-26T12:08:23Z", "type": "forcePushed"}, {"oid": "b71a8943edf56ffe151b94b9c14f8d986aaa81ca", "url": "https://github.com/quarkusio/quarkus/commit/b71a8943edf56ffe151b94b9c14f8d986aaa81ca", "message": "Fail build with HAL resource without serializer #11246", "committedDate": "2020-11-04T14:34:57Z", "type": "forcePushed"}, {"oid": "76ce627c842fa5e44fb67b7348e2e7915c23dedf", "url": "https://github.com/quarkusio/quarkus/commit/76ce627c842fa5e44fb67b7348e2e7915c23dedf", "message": "Fail build with HAL resource without serializer #11246", "committedDate": "2020-12-09T11:04:27Z", "type": "forcePushed"}, {"oid": "6669cd46a89b59758f32f5374972152365ed70f3", "url": "https://github.com/quarkusio/quarkus/commit/6669cd46a89b59758f32f5374972152365ed70f3", "message": "Fail build with HAL resource without serializer #11246", "committedDate": "2021-01-20T14:44:34Z", "type": "forcePushed"}, {"oid": "bda2e56d89b95ca978ad0144468351684259912a", "url": "https://github.com/quarkusio/quarkus/commit/bda2e56d89b95ca978ad0144468351684259912a", "message": "Fail build with HAL resource without serializer #11246", "committedDate": "2021-03-15T11:42:49Z", "type": "commit"}, {"oid": "bda2e56d89b95ca978ad0144468351684259912a", "url": "https://github.com/quarkusio/quarkus/commit/bda2e56d89b95ca978ad0144468351684259912a", "message": "Fail build with HAL resource without serializer #11246", "committedDate": "2021-03-15T11:42:49Z", "type": "forcePushed"}]}