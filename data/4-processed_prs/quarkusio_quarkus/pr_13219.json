{"pr_number": 13219, "pr_title": "Introduce runnerParentFirstArtifact for use with RunnerClassLoader", "pr_createdAt": "2020-11-10T20:48:53Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/13219", "timeline": [{"oid": "c6541b0f1600b645d356f6e040358158f3b8f3d0", "url": "https://github.com/quarkusio/quarkus/commit/c6541b0f1600b645d356f6e040358158f3b8f3d0", "message": "Introduce runnerParentFirstArtifact for use with RunnerClassLoader\n\nFixes: #13216", "committedDate": "2020-11-11T07:28:19Z", "type": "forcePushed"}, {"oid": "130f00a20f1622b37b705e124d9fcff8a3efda43", "url": "https://github.com/quarkusio/quarkus/commit/130f00a20f1622b37b705e124d9fcff8a3efda43", "message": "Introduce runnerParentFirstArtifact for use with RunnerClassLoader\n\nFixes: #13216", "committedDate": "2020-11-11T07:32:06Z", "type": "forcePushed"}, {"oid": "ff5401d5afbe9f4a588b7591309713ac1f5b8d47", "url": "https://github.com/quarkusio/quarkus/commit/ff5401d5afbe9f4a588b7591309713ac1f5b8d47", "message": "Introduce runnerParentFirstArtifact for use with RunnerClassLoader\n\nFixes: #13216", "committedDate": "2020-11-11T07:35:06Z", "type": "forcePushed"}, {"oid": "d29cb98697697d50f8835d022a5f3499cf013666", "url": "https://github.com/quarkusio/quarkus/commit/d29cb98697697d50f8835d022a5f3499cf013666", "message": "Introduce runnerParentFirstArtifact for use with RunnerClassLoader\n\nFixes: #13216", "committedDate": "2020-11-11T07:37:26Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTM3OTExNw==", "url": "https://github.com/quarkusio/quarkus/pull/13219#discussion_r521379117", "bodyText": "Are you sure about all of these?  In particular the SLF4J ones shouldn't be necessary, nor should the SmallRye one.  Also the svm one shouldn't be needed either since it's only used for annotations AFAICT.", "author": "dmlloyd", "createdAt": "2020-11-11T14:03:37Z", "path": "core/runtime/pom.xml", "diffHunk": "@@ -150,6 +150,19 @@\n                         <parentFirstArtifact>org.junit.platform:junit-platform-commons</parentFirstArtifact>\n                         <parentFirstArtifact>org.junit.platform:junit-platform-engine</parentFirstArtifact>\n                     </parentFirstArtifacts>\n+                    <runnerParentFirstArtifacts>\n+                        <runnerParentFirstArtifact>io.quarkus:quarkus-bootstrap-runner</runnerParentFirstArtifact>\n+                        <runnerParentFirstArtifact>io.quarkus:quarkus-development-mode-spi</runnerParentFirstArtifact>\n+                        <!-- logging dependencies always need to be loaded by the JDK ClassLoader -->\n+                        <runnerParentFirstArtifact>org.jboss.logging:jboss-logging</runnerParentFirstArtifact>\n+                        <runnerParentFirstArtifact>org.jboss.logmanager:jboss-logmanager-embedded</runnerParentFirstArtifact>\n+                        <runnerParentFirstArtifact>org.jboss.slf4j:slf4j-jboss-logmanager</runnerParentFirstArtifact>\n+                        <runnerParentFirstArtifact>org.slf4j:slf4j-api</runnerParentFirstArtifact>\n+                        <!-- The following dependencies are dependencies of the JBoss Logging so they too need  be loaded by the JDK ClassLoader -->\n+                        <runnerParentFirstArtifact>io.smallrye.common:smallrye-common-io</runnerParentFirstArtifact>\n+                        <runnerParentFirstArtifact>org.wildfly.common:wildfly-common</runnerParentFirstArtifact>\n+                        <runnerParentFirstArtifact>org.graalvm.sdk:graal-sdk</runnerParentFirstArtifact>\n+                    </runnerParentFirstArtifacts>", "originalCommit": "d29cb98697697d50f8835d022a5f3499cf013666", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTM4NTg4MQ==", "url": "https://github.com/quarkusio/quarkus/pull/13219#discussion_r521385881", "bodyText": "Right, the slf4j stuff isn't necessary.\nThe smallrye stuff is necessary however (see the updated comments)", "author": "geoand", "createdAt": "2020-11-11T14:14:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTM3OTExNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTM5ODM0Mg==", "url": "https://github.com/quarkusio/quarkus/pull/13219#discussion_r521398342", "bodyText": "What about the graalvm SDK?  What needs that at run time?", "author": "dmlloyd", "createdAt": "2020-11-11T14:32:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTM3OTExNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTQwMjg4NA==", "url": "https://github.com/quarkusio/quarkus/pull/13219#discussion_r521402884", "bodyText": "That one is needed because of: \n  \n    \n      quarkus/independent-projects/bootstrap/runner/src/main/java/io/quarkus/bootstrap/logging/InitialConfigurator.java\n    \n    \n         Line 51\n      in\n      966b504\n    \n    \n    \n    \n\n        \n          \n           if (ImageInfo.inImageBuildtimeCode()) {", "author": "geoand", "createdAt": "2020-11-11T14:38:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTM3OTExNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTQwNDEyNQ==", "url": "https://github.com/quarkusio/quarkus/pull/13219#discussion_r521404125", "bodyText": "Ah I see.  I wonder if that's worth replacing it with the contents of that method:\n        if (System.getProperty(\"org.graalvm.nativeimage.imagecode\").equals(\"runtime\")) {", "author": "dmlloyd", "createdAt": "2020-11-11T14:40:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTM3OTExNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTQwNTc4MA==", "url": "https://github.com/quarkusio/quarkus/pull/13219#discussion_r521405780", "bodyText": "Good idea! Let me do that", "author": "geoand", "createdAt": "2020-11-11T14:42:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTM3OTExNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTQxMTg2OA==", "url": "https://github.com/quarkusio/quarkus/pull/13219#discussion_r521411868", "bodyText": "I pushed a commit that removes the dependency on the GraalVM jar", "author": "geoand", "createdAt": "2020-11-11T14:51:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTM3OTExNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTQyNjU5MQ==", "url": "https://github.com/quarkusio/quarkus/pull/13219#discussion_r521426591", "bodyText": "Hmmm. What does it bring to avoid having it there?\nI'm not sure it's such a good idea to not rely on proper APIs.", "author": "gsmet", "createdAt": "2020-11-11T15:12:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTM3OTExNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTQzMzQxMQ==", "url": "https://github.com/quarkusio/quarkus/pull/13219#discussion_r521433411", "bodyText": "Just minimizing the class path size, particularly with a JAR that is never really used.  Note that the system property name and value are both stable APIs as well.", "author": "dmlloyd", "createdAt": "2020-11-11T15:22:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTM3OTExNw=="}], "type": "inlineReview"}, {"oid": "ecd1ac0e0bf5ca11f6f8ddd29919a8fef2b42404", "url": "https://github.com/quarkusio/quarkus/commit/ecd1ac0e0bf5ca11f6f8ddd29919a8fef2b42404", "message": "Introduce runnerParentFirstArtifact for use with RunnerClassLoader\n\nFixes: #13216", "committedDate": "2020-11-11T14:11:44Z", "type": "forcePushed"}, {"oid": "88dbf349ee82cb281e7c9883c9122842ec5f38fe", "url": "https://github.com/quarkusio/quarkus/commit/88dbf349ee82cb281e7c9883c9122842ec5f38fe", "message": "Replace org.graalvm.sdk:graal-sdk dependency in runner bootstrap with custom class\n\nThis is done in order to avoid making this dependency a runtimeParentDependency,\nwhich means that we can reduce the number of jars loaded by the JDK ClassLoader", "committedDate": "2020-11-11T14:55:53Z", "type": "forcePushed"}, {"oid": "de94cd9ba35af8ec386074d78963bd459f01cb88", "url": "https://github.com/quarkusio/quarkus/commit/de94cd9ba35af8ec386074d78963bd459f01cb88", "message": "Introduce runnerParentFirstArtifact for use with RunnerClassLoader\n\nFixes: #13216", "committedDate": "2020-11-13T06:37:45Z", "type": "commit"}, {"oid": "14abc111caa283cc406449581fd7cd029a379922", "url": "https://github.com/quarkusio/quarkus/commit/14abc111caa283cc406449581fd7cd029a379922", "message": "Replace org.graalvm.sdk:graal-sdk dependency in runner bootstrap with custom class\n\nThis is done in order to avoid making this dependency a runtimeParentDependency,\nwhich means that we can reduce the number of jars loaded by the JDK ClassLoader", "committedDate": "2020-11-13T06:37:45Z", "type": "commit"}, {"oid": "14abc111caa283cc406449581fd7cd029a379922", "url": "https://github.com/quarkusio/quarkus/commit/14abc111caa283cc406449581fd7cd029a379922", "message": "Replace org.graalvm.sdk:graal-sdk dependency in runner bootstrap with custom class\n\nThis is done in order to avoid making this dependency a runtimeParentDependency,\nwhich means that we can reduce the number of jars loaded by the JDK ClassLoader", "committedDate": "2020-11-13T06:37:45Z", "type": "forcePushed"}]}