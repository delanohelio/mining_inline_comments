{"pr_number": 10037, "pr_title": "Add docker support for fast-jar", "pr_createdAt": "2020-06-16T08:09:09Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/10037", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDY2ODI0Ng==", "url": "https://github.com/quarkusio/quarkus/pull/10037#discussion_r440668246", "bodyText": "We probably don't want this", "author": "geoand", "createdAt": "2020-06-16T08:14:38Z", "path": "core/deployment/src/main/java/io/quarkus/deployment/mutability/ReaugmentTask.java", "diffHunk": "@@ -1,7 +1,6 @@\n package io.quarkus.deployment.mutability;\n \n-import static io.quarkus.deployment.pkg.steps.JarResultBuildStep.BUILD_SYSTEM_PROPERTIES;\n-import static io.quarkus.deployment.pkg.steps.JarResultBuildStep.DEPLOYMENT_QUARKUS;\n+import static io.quarkus.deployment.pkg.steps.JarResultBuildStep.*;", "originalCommit": "6a446ba7a245a9b3d8618199c5998d949200c444", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDY5NDk4Ng==", "url": "https://github.com/quarkusio/quarkus/pull/10037#discussion_r440694986", "bodyText": "oops, I am using a different computer and the IDE was not fully setup properly.", "author": "stuartwdouglas", "createdAt": "2020-06-16T08:56:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDY2ODI0Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDc2MjYzOQ==", "url": "https://github.com/quarkusio/quarkus/pull/10037#discussion_r440762639", "bodyText": "Seems like your IDE is still messing with you :)", "author": "geoand", "createdAt": "2020-06-16T10:54:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDY2ODI0Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDY4MDE5MA==", "url": "https://github.com/quarkusio/quarkus/pull/10037#discussion_r440680190", "bodyText": "\ud83d\udc4d", "author": "geoand", "createdAt": "2020-06-16T08:33:58Z", "path": "extensions/container-image/container-image-docker/deployment/src/main/java/io/quarkus/container/image/docker/deployment/DockerProcessor.java", "diffHunk": "@@ -210,6 +216,8 @@ private DockerfilePaths getDockerfilePaths(DockerConfig dockerConfig, boolean fo\n         } else {\n             if (dockerConfig.dockerfileJvmPath.isPresent()) {\n                 return ProvidedDockerfile.get(Paths.get(dockerConfig.dockerfileJvmPath.get()), outputDirectory);\n+            } else if (packageConfig.type.equals(PackageConfig.FAST_JAR)) {", "originalCommit": "6a446ba7a245a9b3d8618199c5998d949200c444", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDcwMjE5NQ==", "url": "https://github.com/quarkusio/quarkus/pull/10037#discussion_r440702195", "bodyText": "This needs to be:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            COPY ${build_dir}/quarkus-app/lib/* /deployments/lib/\n          \n          \n            \n            COPY ${build_dir}/quarkus-app/lib/ /deployments/lib/\n          \n      \n    \n    \n  \n\nOthewise Docker doesn't preserve the directory structure and running the container doesn't work", "author": "geoand", "createdAt": "2020-06-16T09:08:27Z", "path": "devtools/platform-descriptor-json/src/main/resources/templates/dockerfile-fast-jar.ftl", "diffHunk": "@@ -0,0 +1,56 @@\n+####\n+# This Dockerfile is used in order to build a container that runs the Quarkus application in JVM mode\n+#\n+# Before building the docker image run:\n+#\n+# mvn package\n+#\n+# Then, build the image with:\n+#\n+# docker build -f src/main/docker/Dockerfile.jvm -t quarkus/${project_artifactId}-jvm .\n+#\n+# Then run the container using:\n+#\n+# docker run -i --rm -p 8080:8080 quarkus/${project_artifactId}-jvm\n+#\n+# If you want to include the debug port into your docker image\n+# you will have to expose the debug port (default 5005) like this :  EXPOSE 8080 5050\n+# \n+# Then run the container using : \n+#\n+# docker run -i --rm -p 8080:8080 -p 5005:5005 -e JAVA_ENABLE_DEBUG=\"true\" quarkus/${project_artifactId}-jvm\n+#\n+###\n+FROM registry.access.redhat.com/ubi8/ubi-minimal:8.1\n+\n+ARG JAVA_PACKAGE=java-11-openjdk-headless\n+ARG RUN_JAVA_VERSION=1.3.8\n+\n+ENV LANG='en_US.UTF-8' LANGUAGE='en_US:en'\n+\n+# Install java and the run-java script\n+# Also set up permissions for user `1001`\n+RUN microdnf install curl ca-certificates ${JAVA_PACKAGE} \\\n+    && microdnf update \\\n+    && microdnf clean all \\\n+    && mkdir /deployments \\\n+    && chown 1001 /deployments \\\n+    && chmod \"g+rwX\" /deployments \\\n+    && chown 1001:root /deployments \\\n+    && curl https://repo1.maven.org/maven2/io/fabric8/run-java-sh/${RUN_JAVA_VERSION}/run-java-sh-${RUN_JAVA_VERSION}-sh.sh -o /deployments/run-java.sh \\\n+    && chown 1001 /deployments/run-java.sh \\\n+    && chmod 540 /deployments/run-java.sh \\\n+    && echo \"securerandom.source=file:/dev/urandom\" >> /etc/alternatives/jre/lib/security/java.security\n+\n+# Configure the JAVA_OPTIONS, you can add -XshowSettings:vm to also display the heap size.\n+ENV JAVA_OPTIONS=\"-Dquarkus.http.host=0.0.0.0 -Djava.util.logging.manager=org.jboss.logmanager.LogManager\"\n+\n+COPY ${build_dir}/quarkus-app/lib/* /deployments/lib/", "originalCommit": "6a446ba7a245a9b3d8618199c5998d949200c444", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDcwMzc2MQ==", "url": "https://github.com/quarkusio/quarkus/pull/10037#discussion_r440703761", "bodyText": "Oops, I fixed this in the local project I was testing with, but forgot to update the template", "author": "stuartwdouglas", "createdAt": "2020-06-16T09:11:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDcwMjE5NQ=="}], "type": "inlineReview"}, {"oid": "8fb2a14ccc4a4948cbcd5d54a6ab3464c72045e7", "url": "https://github.com/quarkusio/quarkus/commit/8fb2a14ccc4a4948cbcd5d54a6ab3464c72045e7", "message": "Add docker support for fast-jar", "committedDate": "2020-06-16T10:19:38Z", "type": "forcePushed"}, {"oid": "8232d0ed26d473fc2e29e4b68b1b73d2c6743978", "url": "https://github.com/quarkusio/quarkus/commit/8232d0ed26d473fc2e29e4b68b1b73d2c6743978", "message": "Add docker support for fast-jar", "committedDate": "2020-06-16T10:57:42Z", "type": "forcePushed"}, {"oid": "c2aed3a82817b2844a969c037affb67200002478", "url": "https://github.com/quarkusio/quarkus/commit/c2aed3a82817b2844a969c037affb67200002478", "message": "Add docker support for fast-jar", "committedDate": "2020-06-16T13:40:15Z", "type": "forcePushed"}, {"oid": "4ab3213e31462b25ce80286827936867fb55e9c3", "url": "https://github.com/quarkusio/quarkus/commit/4ab3213e31462b25ce80286827936867fb55e9c3", "message": "Add docker support for fast-jar", "committedDate": "2020-06-17T02:06:08Z", "type": "forcePushed"}, {"oid": "34df2f823da877e3b5a62bee788d3754810b3ade", "url": "https://github.com/quarkusio/quarkus/commit/34df2f823da877e3b5a62bee788d3754810b3ade", "message": "Add docker support for fast-jar", "committedDate": "2020-06-17T05:26:46Z", "type": "commit"}, {"oid": "34df2f823da877e3b5a62bee788d3754810b3ade", "url": "https://github.com/quarkusio/quarkus/commit/34df2f823da877e3b5a62bee788d3754810b3ade", "message": "Add docker support for fast-jar", "committedDate": "2020-06-17T05:26:46Z", "type": "forcePushed"}]}