{"pr_number": 12683, "pr_title": "Provide helpful error-message for BindException on quarkus.http.port", "pr_createdAt": "2020-10-13T13:00:07Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/12683", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzk2NjU5MQ==", "url": "https://github.com/quarkusio/quarkus/pull/12683#discussion_r503966591", "bodyText": "What's the deal with this?", "author": "geoand", "createdAt": "2020-10-13T13:48:08Z", "path": "core/deployment/src/main/java/io/quarkus/deployment/dev/IsolatedDevModeMain.java", "diffHunk": "@@ -108,9 +109,28 @@ public void accept(Integer integer) {\n                 runner = start.runMainClass(context.getArgs());\n                 firstStartCompleted = true;\n             } catch (Throwable t) {\n-                deploymentProblem = t;\n-                if (!augmentDone) {\n-                    log.error(\"Failed to start quarkus\", t);\n+                Throwable rootCause = t;\n+                while (rootCause.getCause() != null) {\n+                    rootCause = rootCause.getCause();\n+                }\n+                if (rootCause instanceof BindException) {\n+                    int port = ConfigProviderResolver.instance().getConfig()\n+                            .getOptionalValue(\"quarkus.http.port\", Integer.class).orElse(8080);\n+                    log.error(\"Port \" + port + \" seems to be in use by another process. \" +\n+                            \"Quarkus may already be running or the port is used by another application.\");\n+                    if (System.getProperty(\"os.name\").startsWith(\"Windows\")) {\n+                        log.info(\"Use 'netstat -a -b -n -o' to identify the process occupying the port.\");\n+                        log.info(\"You can try to kill it with 'taskkill /PID <pid>' or via the Task Manager.\");\n+                    } else {\n+                        log.info(\"Use 'netstat -anop | grep \" + port + \"' to identify the process occupying the port.\");\n+                        log.info(\"You can try to kill it with 'kill -9 <pid>'.\");\n+                    }\n+                    System.exit(-1);", "originalCommit": "981011f3b063cca6bb560a807487437739103cb8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzk3NDc4Mg==", "url": "https://github.com/quarkusio/quarkus/pull/12683#discussion_r503974782", "bodyText": "@geoand can you give a more detailed comment, please?", "author": "xumk", "createdAt": "2020-10-13T13:58:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzk2NjU5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzk3NDg0Mw==", "url": "https://github.com/quarkusio/quarkus/pull/12683#discussion_r503974843", "bodyText": "And shouldn't we call close();?", "author": "gsmet", "createdAt": "2020-10-13T13:58:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzk2NjU5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzk3Nzg4NQ==", "url": "https://github.com/quarkusio/quarkus/pull/12683#discussion_r503977885", "bodyText": "Good catch. I think deploymentProblem = rootCause; needs to be assigned here and System.exit shouldn't be explicitly called?", "author": "gastaldi", "createdAt": "2020-10-13T14:02:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzk2NjU5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzk4MjU0Nw==", "url": "https://github.com/quarkusio/quarkus/pull/12683#discussion_r503982547", "bodyText": "Yeah, I don't see why System.exit is being called here. Can you explain?", "author": "geoand", "createdAt": "2020-10-13T14:08:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzk2NjU5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzk4MjU2NA==", "url": "https://github.com/quarkusio/quarkus/pull/12683#discussion_r503982564", "bodyText": "@gastaldi ok. I added it", "author": "xumk", "createdAt": "2020-10-13T14:08:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzk2NjU5MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzk2NzA1Mw==", "url": "https://github.com/quarkusio/quarkus/pull/12683#discussion_r503967053", "bodyText": "These error messages are super useful, thanks!", "author": "geoand", "createdAt": "2020-10-13T13:48:40Z", "path": "core/deployment/src/main/java/io/quarkus/deployment/dev/IsolatedDevModeMain.java", "diffHunk": "@@ -108,9 +109,28 @@ public void accept(Integer integer) {\n                 runner = start.runMainClass(context.getArgs());\n                 firstStartCompleted = true;\n             } catch (Throwable t) {\n-                deploymentProblem = t;\n-                if (!augmentDone) {\n-                    log.error(\"Failed to start quarkus\", t);\n+                Throwable rootCause = t;\n+                while (rootCause.getCause() != null) {\n+                    rootCause = rootCause.getCause();\n+                }\n+                if (rootCause instanceof BindException) {", "originalCommit": "981011f3b063cca6bb560a807487437739103cb8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "72dd941c464acef3458db03516bd374d923b53c6", "url": "https://github.com/quarkusio/quarkus/commit/72dd941c464acef3458db03516bd374d923b53c6", "message": "issue #4890 Provide helpful error-message for BindException on quarkus.http.port", "committedDate": "2020-10-13T14:28:18Z", "type": "forcePushed"}, {"oid": "9cee739a4a853e3de72bc9af8c87c02428298fdf", "url": "https://github.com/quarkusio/quarkus/commit/9cee739a4a853e3de72bc9af8c87c02428298fdf", "message": "issue #4890 Provide helpful error-message for BindException on quarkus.http.port", "committedDate": "2020-10-14T11:28:35Z", "type": "forcePushed"}, {"oid": "60d0f4b6b86949932ec0a33ad829e12571f531fa", "url": "https://github.com/quarkusio/quarkus/commit/60d0f4b6b86949932ec0a33ad829e12571f531fa", "message": "fix restart", "committedDate": "2020-10-15T09:06:02Z", "type": "forcePushed"}, {"oid": "f8985f905553e70d5f3e33fc7283b94310f62eea", "url": "https://github.com/quarkusio/quarkus/commit/f8985f905553e70d5f3e33fc7283b94310f62eea", "message": "Squash all commits", "committedDate": "2020-10-15T09:12:26Z", "type": "forcePushed"}, {"oid": "502c7ea28c51e22b46903a25e62d089e06c951ee", "url": "https://github.com/quarkusio/quarkus/commit/502c7ea28c51e22b46903a25e62d089e06c951ee", "message": "solved #4890 Provide helpful error-message for BindException on quarkus.http.port", "committedDate": "2020-10-15T09:16:27Z", "type": "forcePushed"}, {"oid": "137bb83eb17bd429af7b0f05e8086d49994281f9", "url": "https://github.com/quarkusio/quarkus/commit/137bb83eb17bd429af7b0f05e8086d49994281f9", "message": "refactor: Split KubernetesProcessor into pieces", "committedDate": "2020-10-14T14:39:07Z", "type": "forcePushed"}, {"oid": "4c7a57e30531f5d73ab5f87daf33d36838b7d827", "url": "https://github.com/quarkusio/quarkus/commit/4c7a57e30531f5d73ab5f87daf33d36838b7d827", "message": "fix restart", "committedDate": "2020-10-15T09:05:41Z", "type": "forcePushed"}, {"oid": "96f09aeed8efe63ad22fcd5090ceb2163d3e1b80", "url": "https://github.com/quarkusio/quarkus/commit/96f09aeed8efe63ad22fcd5090ceb2163d3e1b80", "message": "solved #4890 Provide helpful error-message for BindException on quarkus.http.port", "committedDate": "2020-10-15T10:13:10Z", "type": "commit"}, {"oid": "96f09aeed8efe63ad22fcd5090ceb2163d3e1b80", "url": "https://github.com/quarkusio/quarkus/commit/96f09aeed8efe63ad22fcd5090ceb2163d3e1b80", "message": "solved #4890 Provide helpful error-message for BindException on quarkus.http.port", "committedDate": "2020-10-15T10:13:10Z", "type": "forcePushed"}]}