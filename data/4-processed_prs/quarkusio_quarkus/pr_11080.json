{"pr_number": 11080, "pr_title": "Add ability to directly specify endpoints in tests", "pr_createdAt": "2020-07-30T06:47:01Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/11080", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc3NDA0NQ==", "url": "https://github.com/quarkusio/quarkus/pull/11080#discussion_r462774045", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Both RESTassured and ``@TestHTTPResource` allow you to specify the endpoint class you are testing rather than hard coding\n          \n          \n            \n            Both RESTassured and `@TestHTTPResource` allow you to specify the endpoint class you are testing rather than hard coding", "author": "geoand", "createdAt": "2020-07-30T06:47:59Z", "path": "docs/src/main/asciidoc/getting-started-testing.adoc", "diffHunk": "@@ -228,6 +228,115 @@ public class StaticContentTest {\n \n For now `@TestHTTPResource` allows you to inject `URI`, `URL` and `String` representations of the URL.\n \n+== Testing a specific endpoint\n+\n+Both RESTassured and ``@TestHTTPResource` allow you to specify the endpoint class you are testing rather than hard coding", "originalCommit": "ccc93842cc70386fa01d33cdf2080190df9a1dd8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc3NDM1Ng==", "url": "https://github.com/quarkusio/quarkus/pull/11080#discussion_r462774356", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            a path. This current supports both JAX-RS endpoints and Servlet's. This makes it a lot easier to see exactly which endpoints\n          \n          \n            \n            a path. This currently supports both JAX-RS endpoints and Servlets. This makes it a lot easier to see exactly which endpoints", "author": "geoand", "createdAt": "2020-07-30T06:48:24Z", "path": "docs/src/main/asciidoc/getting-started-testing.adoc", "diffHunk": "@@ -228,6 +228,115 @@ public class StaticContentTest {\n \n For now `@TestHTTPResource` allows you to inject `URI`, `URL` and `String` representations of the URL.\n \n+== Testing a specific endpoint\n+\n+Both RESTassured and ``@TestHTTPResource` allow you to specify the endpoint class you are testing rather than hard coding\n+a path. This current supports both JAX-RS endpoints and Servlet's. This makes it a lot easier to see exactly which endpoints", "originalCommit": "ccc93842cc70386fa01d33cdf2080190df9a1dd8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc4MjM2NA==", "url": "https://github.com/quarkusio/quarkus/pull/11080#discussion_r462782364", "bodyText": "Does this really need to be volatile?", "author": "geoand", "createdAt": "2020-07-30T06:58:47Z", "path": "test-framework/junit5/src/main/java/io/quarkus/test/junit/QuarkusTestExtension.java", "diffHunk": "@@ -103,6 +105,7 @@\n     private static List<Object> afterEachCallbacks;\n     private static Class<?> quarkusTestMethodContextClass;\n     private static Class<? extends QuarkusTestProfile> quarkusTestProfile;\n+    private static volatile List<Function<Class<?>, String>> testHttpEndpointProviders;", "originalCommit": "ccc93842cc70386fa01d33cdf2080190df9a1dd8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc5NTk4OA==", "url": "https://github.com/quarkusio/quarkus/pull/11080#discussion_r462795988", "bodyText": "no, the original approach I took with this had it being set from a buildstep, but that was compex and would not work in native, so I abandoned the approach.", "author": "stuartwdouglas", "createdAt": "2020-07-30T07:15:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc4MjM2NA=="}], "type": "inlineReview"}, {"oid": "52da5e265e0b44784b39b27b5b716e4f4bc8233d", "url": "https://github.com/quarkusio/quarkus/commit/52da5e265e0b44784b39b27b5b716e4f4bc8233d", "message": "Add ability to directly specify endpoints in tests\n\nThis makes it easy to specify eactly what endpoint is being\ntested.", "committedDate": "2020-07-30T08:23:49Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjkwNjc3OQ==", "url": "https://github.com/quarkusio/quarkus/pull/11080#discussion_r462906779", "bodyText": "Does it take into account the root path? And the potential @ApplicationPath?", "author": "gsmet", "createdAt": "2020-07-30T10:36:27Z", "path": "docs/src/main/asciidoc/getting-started-testing.adoc", "diffHunk": "@@ -228,6 +228,118 @@ public class StaticContentTest {\n \n For now `@TestHTTPResource` allows you to inject `URI`, `URL` and `String` representations of the URL.\n \n+== Testing a specific endpoint\n+\n+Both RESTassured and `@TestHTTPResource` allow you to specify the endpoint class you are testing rather than hard coding\n+a path. This currently supports both JAX-RS endpoints and Servlets. This makes it a lot easier to see exactly which endpoints\n+a given test is testing.\n+\n+For the purposes of these examples I am going to assume we have an endpoint that looks like the following:\n+\n+[source,java]\n+----\n+@Path(\"/hello\")\n+public class GreetingResource {\n+\n+    @GET\n+    @Produces(MediaType.TEXT_PLAIN)\n+    public String hello() {\n+        return \"hello\";\n+    }\n+}\n+----\n+\n+NOTE: This currently does not support the `@ApplicationPath()` annotation to set the JAX-RS context path. Use the\n+`quarkus.resteasy.path` config value instead if you want a custom context path.\n+\n+=== TestHTTPResource\n+\n+You can the use the `io.quarkus.test.common.http.TestHTTPEndpoint` annotation to specify the endpoint path, and the path\n+will be extracted from the provided endpoint. If you also specify a value for the `TestHTTPResource` endpoint it will\n+be appended to the end of the endpoint path.\n+\n+[source,java]\n+----\n+package org.acme.getting.started.testing;\n+\n+import java.io.ByteArrayOutputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.net.URL;\n+import java.nio.charset.StandardCharsets;\n+\n+import org.junit.jupiter.api.Assertions;\n+import org.junit.jupiter.api.Test;\n+\n+import io.quarkus.test.common.http.TestHTTPEndpoint;\n+import io.quarkus.test.common.http.TestHTTPResource;\n+import io.quarkus.test.junit.QuarkusTest;\n+\n+@QuarkusTest\n+public class StaticContentTest {\n+\n+    @TestHTTPEndpoint(GreetingResource.class)  // <1>\n+    @TestHTTPResource\n+    URL url;\n+\n+    @Test\n+    public void testIndexHtml() throws Exception {\n+        try (InputStream in = url.openStream()) {\n+            String contents = readStream(in);\n+            Assertions.assertTrue(contents.equals(\"hello\"));\n+        }\n+    }\n+\n+    private static String readStream(InputStream in) throws IOException {\n+        byte[] data = new byte[1024];\n+        int r;\n+        ByteArrayOutputStream out = new ByteArrayOutputStream();\n+        while ((r = in.read(data)) > 0) {\n+            out.write(data, 0, r);\n+        }\n+        return new String(out.toByteArray(), StandardCharsets.UTF_8);\n+    }\n+}\n+----\n+<1> Because `GreetingResource` is annotated with `@Path(\"/hello\")` the injected URL", "originalCommit": "52da5e265e0b44784b39b27b5b716e4f4bc8233d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjkwNzkxMA==", "url": "https://github.com/quarkusio/quarkus/pull/11080#discussion_r462907910", "bodyText": "@ApplicationPath is mentioned in the doc to not be supported", "author": "geoand", "createdAt": "2020-07-30T10:38:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjkwNjc3OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjkwODE0NA==", "url": "https://github.com/quarkusio/quarkus/pull/11080#discussion_r462908144", "bodyText": "quarkus.resteasy.path is supported", "author": "geoand", "createdAt": "2020-07-30T10:39:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjkwNjc3OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjkyMDM2Nw==", "url": "https://github.com/quarkusio/quarkus/pull/11080#discussion_r462920367", "bodyText": "OK, sorry for the noise then :).", "author": "gsmet", "createdAt": "2020-07-30T11:04:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjkwNjc3OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjkyMTMyNA==", "url": "https://github.com/quarkusio/quarkus/pull/11080#discussion_r462921324", "bodyText": "No worries :)", "author": "geoand", "createdAt": "2020-07-30T11:07:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjkwNjc3OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjkyMTQ1NA==", "url": "https://github.com/quarkusio/quarkus/pull/11080#discussion_r462921454", "bodyText": "I could not really think of a way to handle it in native mode that was not just re-indexing everything. It seemed like a small caveat to an otherwise nice feature though.\nWhen this is in should we change our quickstarts and guides to use it?", "author": "stuartwdouglas", "createdAt": "2020-07-30T11:07:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjkwNjc3OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjkyMjQ3MQ==", "url": "https://github.com/quarkusio/quarkus/pull/11080#discussion_r462922471", "bodyText": "Yeah, that would be the best to make it known to users", "author": "geoand", "createdAt": "2020-07-30T11:09:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjkwNjc3OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjkyMjczOA==", "url": "https://github.com/quarkusio/quarkus/pull/11080#discussion_r462922738", "bodyText": "@stuartwdouglas are you planning on doing the follow up for reactive routes, or should I?", "author": "geoand", "createdAt": "2020-07-30T11:10:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjkwNjc3OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjkyNjk1NQ==", "url": "https://github.com/quarkusio/quarkus/pull/11080#discussion_r462926955", "bodyText": "I am not doing anything more tonight, if you don't do it I will look at it tomorrow. We could also do Websockets, although they support URI templates in their path so it would need to just register the constant part of the template.", "author": "stuartwdouglas", "createdAt": "2020-07-30T11:19:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjkwNjc3OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjkyOTAyNQ==", "url": "https://github.com/quarkusio/quarkus/pull/11080#discussion_r462929025", "bodyText": "I have lowered the revs on the engine with PTO approaching, so I may or may not do it today :). In any case I'll let you know.", "author": "geoand", "createdAt": "2020-07-30T11:23:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjkwNjc3OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjkzNzg0Mw==", "url": "https://github.com/quarkusio/quarkus/pull/11080#discussion_r462937843", "bodyText": "I will just do it tomorrow, its simple and there is no hurry.", "author": "stuartwdouglas", "createdAt": "2020-07-30T11:42:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjkwNjc3OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjkzOTA1NQ==", "url": "https://github.com/quarkusio/quarkus/pull/11080#discussion_r462939055", "bodyText": "Yeah I know. The rest of my day is probably going to be pretty light so I'll most likely do it", "author": "geoand", "createdAt": "2020-07-30T11:45:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjkwNjc3OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjk1MTYxMw==", "url": "https://github.com/quarkusio/quarkus/pull/11080#discussion_r462951613", "bodyText": "I didn't realize it would be that easy :) #11092", "author": "geoand", "createdAt": "2020-07-30T12:12:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjkwNjc3OQ=="}], "type": "inlineReview"}, {"oid": "3ccb86a8a74d73fe09eee4dca935b3afdb9ef3c7", "url": "https://github.com/quarkusio/quarkus/commit/3ccb86a8a74d73fe09eee4dca935b3afdb9ef3c7", "message": "Add ability to directly specify endpoints in tests\n\nThis makes it easy to specify eactly what endpoint is being\ntested.", "committedDate": "2020-07-30T10:54:14Z", "type": "forcePushed"}, {"oid": "8adee0d978f3590dae8e71719cf0e5c3f268b85f", "url": "https://github.com/quarkusio/quarkus/commit/8adee0d978f3590dae8e71719cf0e5c3f268b85f", "message": "Fix broken native tests with @TestHTTPEndpoint", "committedDate": "2020-07-30T15:16:15Z", "type": "forcePushed"}, {"oid": "ee4dd0a205af898ae527941f74e2a2ac88e0ddce", "url": "https://github.com/quarkusio/quarkus/commit/ee4dd0a205af898ae527941f74e2a2ac88e0ddce", "message": "Add ability to directly specify endpoints in tests\n\nThis makes it easy to specify eactly what endpoint is being\ntested.", "committedDate": "2020-07-30T22:55:29Z", "type": "forcePushed"}, {"oid": "bc681175138374b023d8a98971739672978fae4a", "url": "https://github.com/quarkusio/quarkus/commit/bc681175138374b023d8a98971739672978fae4a", "message": "Add ability to directly specify endpoints in tests\n\nThis makes it easy to specify eactly what endpoint is being\ntested.", "committedDate": "2020-07-31T01:33:57Z", "type": "commit"}, {"oid": "44b177aa613e98079a37e9a4d2b30b7427a28b8e", "url": "https://github.com/quarkusio/quarkus/commit/44b177aa613e98079a37e9a4d2b30b7427a28b8e", "message": "Add Reactive Routes support to @TestHTTPEndpoint", "committedDate": "2020-07-31T01:34:03Z", "type": "forcePushed"}, {"oid": "fddd2e1e89230e46a49724312f8c2f7c144554ee", "url": "https://github.com/quarkusio/quarkus/commit/fddd2e1e89230e46a49724312f8c2f7c144554ee", "message": "Add Reactive Routes support to @TestHTTPEndpoint", "committedDate": "2020-07-31T01:59:39Z", "type": "commit"}, {"oid": "fddd2e1e89230e46a49724312f8c2f7c144554ee", "url": "https://github.com/quarkusio/quarkus/commit/fddd2e1e89230e46a49724312f8c2f7c144554ee", "message": "Add Reactive Routes support to @TestHTTPEndpoint", "committedDate": "2020-07-31T01:59:39Z", "type": "forcePushed"}]}