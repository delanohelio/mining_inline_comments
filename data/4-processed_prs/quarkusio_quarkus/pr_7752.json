{"pr_number": 7752, "pr_title": "Do not print the banner if the target charset does not like it", "pr_createdAt": "2020-03-10T20:28:30Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/7752", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDU5NTkzMg==", "url": "https://github.com/quarkusio/quarkus/pull/7752#discussion_r390595932", "bodyText": "should we put a \"(banner can not be encoded on \" + charset + \")\" or at least a debug log ?", "author": "maxandersen", "createdAt": "2020-03-10T20:37:58Z", "path": "core/runtime/src/main/java/io/quarkus/runtime/logging/BannerFormatter.java", "diffHunk": "@@ -58,6 +59,13 @@ public String format(ExtLogRecord extLogRecord) {\n \n     @Override\n     public String getHead(Handler h) {\n-        return bannerSupplier.get();\n+        final String banner = bannerSupplier.get();\n+        final Charset charset;\n+        try {\n+            charset = Charset.forName(h.getEncoding());\n+            return charset.newEncoder().canEncode(banner) ? banner : \"\";", "originalCommit": "b56e21d51add169ab39330669a73f21875707a57", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDg2MzAxNA==", "url": "https://github.com/quarkusio/quarkus/pull/7752#discussion_r390863014", "bodyText": "The challenge is that you can't really log from here. I think we could enhance the log manager to do that though at some point.", "author": "dmlloyd", "createdAt": "2020-03-11T10:06:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDU5NTkzMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDYxNzg3NA==", "url": "https://github.com/quarkusio/quarkus/pull/7752#discussion_r390617874", "bodyText": "I was pulling my hair why this was resulting nothing printed...I added a ignored.printStacktrace() and getting this:\njava.lang.IllegalArgumentException: Null charset name\n\tat java.base/java.nio.charset.Charset.lookup(Charset.java:455)\n\tat java.base/java.nio.charset.Charset.forName(Charset.java:526)\n\tat io.quarkus.runtime.logging.BannerFormatter.getHead(BannerFormatter.java:65)\n\tat org.jboss.logmanager.handlers.WriterHandler.writeHead(WriterHandler.java:114)\n\tat org.jboss.logmanager.handlers.WriterHandler.setWriter(WriterHandler.java:99)\n\tat org.jboss.logmanager.handlers.OutputStreamHandler.setWriter(OutputStreamHandler.java:99)\n\tat org.jboss.logmanager.handlers.ConsoleHandler.<init>(ConsoleHandler.java:123)\n\tat org.jboss.logmanager.handlers.ConsoleHandler.<init>(ConsoleHandler.java:100)\n\tat io.quarkus.runtime.logging.LoggingSetupRecorder.configureConsoleHandler(LoggingSetupRecorder.java:255)\n\tat io.quarkus.runtime.logging.LoggingSetupRecorder.initializeLogging(LoggingSetupRecorder.java:100)\n\tat io.quarkus.deployment.steps.LoggingResourceProcessor$setupLoggingRuntimeInit17.deploy_0(LoggingResourceProcessor$setupLoggingRuntimeInit17.zig:129)\n\tat io.quarkus.deployment.steps.LoggingResourceProcessor$setupLoggingRuntimeInit17.deploy(LoggingResourceProcessor$setupLoggingRuntimeInit17.zig:36)\n\tat io.quarkus.runner.ApplicationImpl.doStart(ApplicationImpl.zig:130)\n\tat io.quarkus.runtime.Application.start(Application.java:90)\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n\tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.base/java.lang.reflect.Method.invoke(Method.java:566)\n\tat io.quarkus.runner.bootstrap.StartupActionImpl.run(StartupActionImpl.java:96)\n\tat io.quarkus.dev.IsolatedDevModeMain.firstStart(IsolatedDevModeMain.java:60)\n\tat io.quarkus.dev.IsolatedDevModeMain.accept(IsolatedDevModeMain.java:236)\n\tat io.quarkus.dev.IsolatedDevModeMain.accept(IsolatedDevModeMain.java:39)\n\tat io.quarkus.bootstrap.app.CuratedApplication.runInCl(CuratedApplication.java:131)\n\tat io.quarkus.bootstrap.app.CuratedApplication.runInAugmentClassLoader(CuratedApplication.java:84)\n\tat io.quarkus.dev.DevModeMain.start(DevModeMain.java:104)\n\tat io.quarkus.dev.DevModeMain.main(DevModeMain.java:46)", "author": "maxandersen", "createdAt": "2020-03-10T21:18:57Z", "path": "core/runtime/src/main/java/io/quarkus/runtime/logging/BannerFormatter.java", "diffHunk": "@@ -58,6 +59,13 @@ public String format(ExtLogRecord extLogRecord) {\n \n     @Override\n     public String getHead(Handler h) {\n-        return bannerSupplier.get();\n+        final String banner = bannerSupplier.get();\n+        final Charset charset;\n+        try {\n+            charset = Charset.forName(h.getEncoding());\n+            return charset.newEncoder().canEncode(banner) ? banner : \"\";\n+        } catch (IllegalArgumentException ignored) {\n+            return \"\";", "originalCommit": "b56e21d51add169ab39330669a73f21875707a57", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "6994b6a53b691545a6956ef05d40dfdddd9595b7", "url": "https://github.com/quarkusio/quarkus/commit/6994b6a53b691545a6956ef05d40dfdddd9595b7", "message": "Do not print the banner if the target charset does not like it", "committedDate": "2020-03-10T21:44:39Z", "type": "commit"}, {"oid": "6994b6a53b691545a6956ef05d40dfdddd9595b7", "url": "https://github.com/quarkusio/quarkus/commit/6994b6a53b691545a6956ef05d40dfdddd9595b7", "message": "Do not print the banner if the target charset does not like it", "committedDate": "2020-03-10T21:44:39Z", "type": "forcePushed"}]}