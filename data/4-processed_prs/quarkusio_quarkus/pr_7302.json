{"pr_number": 7302, "pr_title": "Show a proper error message when @Inject is used in NativeTest", "pr_createdAt": "2020-02-20T08:51:51Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/7302", "timeline": [{"oid": "da246f6a74de040df5ef43cb34ae9176d49a0058", "url": "https://github.com/quarkusio/quarkus/commit/da246f6a74de040df5ef43cb34ae9176d49a0058", "message": "Show a proper error message when @Inject is used in NativeTest\n\nFixes: #7300", "committedDate": "2020-02-20T09:01:00Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTg2MzI4Mw==", "url": "https://github.com/quarkusio/quarkus/pull/7302#discussion_r381863283", "bodyText": "in QuarkusTest tests -> in NativeImageTest tests?", "author": "Ladicek", "createdAt": "2020-02-20T09:01:37Z", "path": "test-framework/junit5/src/main/java/io/quarkus/test/junit/NativeTestExtension.java", "diffHunk": "@@ -71,6 +75,23 @@ public void beforeAll(ExtensionContext extensionContext) throws Exception {\n         }\n     }\n \n+    private void ensureNoInjectAnnotationIsUsed(Class<?> testClass) {\n+        Class<?> current = testClass;\n+        while (current.getSuperclass() != null) {\n+            for (Field field : current.getDeclaredFields()) {\n+                Inject injectAnnotation = field.getAnnotation(Inject.class);\n+                if (injectAnnotation != null) {\n+                    throw new JUnitException(\n+                            \"@Inject is not supported in QuarkusTest tests. Offending field is \"", "originalCommit": "da246f6a74de040df5ef43cb34ae9176d49a0058", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTg2NDU4NA==", "url": "https://github.com/quarkusio/quarkus/pull/7302#discussion_r381864584", "bodyText": "Thanks!", "author": "geoand", "createdAt": "2020-02-20T09:04:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTg2MzI4Mw=="}], "type": "inlineReview"}, {"oid": "5e15c459c4a1a7dbd94f6b9cd5d01aa22abcedcd", "url": "https://github.com/quarkusio/quarkus/commit/5e15c459c4a1a7dbd94f6b9cd5d01aa22abcedcd", "message": "Show a proper error message when @Inject is used in NativeTest\n\nFixes: #7300", "committedDate": "2020-02-20T09:03:39Z", "type": "forcePushed"}, {"oid": "ddd0bcf90d94264d3f1cbffadaafebe8e3002ca3", "url": "https://github.com/quarkusio/quarkus/commit/ddd0bcf90d94264d3f1cbffadaafebe8e3002ca3", "message": "Show a proper error message when @Inject is used in NativeTest\n\nFixes: #7300", "committedDate": "2020-02-20T11:15:51Z", "type": "forcePushed"}, {"oid": "1f8e4fdcadcbce25528dadb84d5f43645360ad68", "url": "https://github.com/quarkusio/quarkus/commit/1f8e4fdcadcbce25528dadb84d5f43645360ad68", "message": "Show a proper error message when @Inject is used in NativeTest\n\nFixes: #7300", "committedDate": "2020-02-20T11:25:31Z", "type": "forcePushed"}, {"oid": "d481e834d9e9cb0d3065a1c3a54e28f4e620a26f", "url": "https://github.com/quarkusio/quarkus/commit/d481e834d9e9cb0d3065a1c3a54e28f4e620a26f", "message": "Show a proper error message when @Inject is used in NativeTest\n\nFixes: #7300", "committedDate": "2020-02-20T13:00:18Z", "type": "forcePushed"}, {"oid": "d0761d1bd1286e91b17c108f5c7b954f1dd0d5f3", "url": "https://github.com/quarkusio/quarkus/commit/d0761d1bd1286e91b17c108f5c7b954f1dd0d5f3", "message": "Remove unused injection into test", "committedDate": "2020-02-20T16:07:29Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjIwNzk2NQ==", "url": "https://github.com/quarkusio/quarkus/pull/7302#discussion_r382207965", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             * {@link @QuarkusTest} so the test class structure must be take this into account\n          \n          \n            \n             * {@link @QuarkusTest} so the test class structure must take this into account.", "author": "gsmet", "createdAt": "2020-02-20T19:23:49Z", "path": "test-framework/junit5/src/main/java/io/quarkus/test/junit/NativeImageTest.java", "diffHunk": "@@ -20,6 +20,9 @@\n  * run, it is expected that the JVM tests will be standard unit tests that are\n  * executed by surefire, while the native image tests will be integration tests\n  * executed by failsafe.\n+ * This also means that injection of beans into a test class using {@code @Inject} is not supported\n+ * in native image tests. Such injection is only possible in tests injected with\n+ * {@link @QuarkusTest} so the test class structure must be take this into account", "originalCommit": "d0761d1bd1286e91b17c108f5c7b954f1dd0d5f3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjIxNzM4OQ==", "url": "https://github.com/quarkusio/quarkus/pull/7302#discussion_r382217389", "bodyText": "It wouldn't have been a proper PR of mine unless it had a typo :). Thanks for spotting it", "author": "geoand", "createdAt": "2020-02-20T19:41:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjIwNzk2NQ=="}], "type": "inlineReview"}, {"oid": "a17b6a81c8d2ad8d35b1ee7f578d3295d538a3ad", "url": "https://github.com/quarkusio/quarkus/commit/a17b6a81c8d2ad8d35b1ee7f578d3295d538a3ad", "message": "Remove unused injection into test", "committedDate": "2020-02-20T19:41:11Z", "type": "forcePushed"}, {"oid": "2cea862dbab1f9133ff5e0d7d9cdbef11e2d1e27", "url": "https://github.com/quarkusio/quarkus/commit/2cea862dbab1f9133ff5e0d7d9cdbef11e2d1e27", "message": "Show a proper error message when @Inject is used in NativeTest\n\nFixes: #7300", "committedDate": "2020-02-20T22:30:41Z", "type": "commit"}, {"oid": "4ee107619d767109c278695b38105e8059432e6d", "url": "https://github.com/quarkusio/quarkus/commit/4ee107619d767109c278695b38105e8059432e6d", "message": "Remove unused injection into test", "committedDate": "2020-02-20T22:30:41Z", "type": "commit"}, {"oid": "4ee107619d767109c278695b38105e8059432e6d", "url": "https://github.com/quarkusio/quarkus/commit/4ee107619d767109c278695b38105e8059432e6d", "message": "Remove unused injection into test", "committedDate": "2020-02-20T22:30:41Z", "type": "forcePushed"}]}