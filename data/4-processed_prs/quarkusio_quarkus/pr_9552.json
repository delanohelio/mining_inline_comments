{"pr_number": 9552, "pr_title": "Add Credentials Provider Documentation", "pr_createdAt": "2020-05-24T09:57:40Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/9552", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY1NjMyOA==", "url": "https://github.com/quarkusio/quarkus/pull/9552#discussion_r429656328", "bodyText": "Small typo in th but may be this doc can be simplified a bit, may be just Provides an indirection between credentials consumers such as Agroal and implementers such as Vault....", "author": "sberyozkin", "createdAt": "2020-05-24T17:09:59Z", "path": "extensions/credentials/runtime/src/main/java/io/quarkus/credentials/CredentialsProvider.java", "diffHunk": "@@ -2,11 +2,21 @@\n \n import java.util.Map;\n \n+/**\n+ * Service Programming Interface that provides an indirection between credentials consumers (e.g. agroal)\n+ * and implementers (e.g. vault). Detailed information is available in th dedicated guide.", "originalCommit": "a572ea6ee0aa329402cc7aae90a5c6dc3070de69", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDA0NjkxMg==", "url": "https://github.com/quarkusio/quarkus/pull/9552#discussion_r430046912", "bodyText": "done. thanks.", "author": "vsevel", "createdAt": "2020-05-25T18:51:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY1NjMyOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTc5MTYwOQ==", "url": "https://github.com/quarkusio/quarkus/pull/9552#discussion_r429791609", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Username/password based authentication is very common, but that is not by far the only one.\n          \n          \n            \n            Username/password based authentication is very common, but that is not by any means the only one.", "author": "geoand", "createdAt": "2020-05-25T08:04:33Z", "path": "docs/src/main/asciidoc/credentials-provider.adoc", "diffHunk": "@@ -0,0 +1,194 @@\n+////\n+This guide is maintained in the main Quarkus repository\n+and pull requests should be submitted there:\n+https://github.com/quarkusio/quarkus/tree/master/docs/src/main/asciidoc\n+////\n+= Quarkus - Using a Credentials Provider\n+\n+include::./attributes.adoc[]\n+:extension-status: preview\n+:vault-datasource-guide: link:vault-datasource[Vault Datasource guide]\n+\n+Interacting with a datastore typically implies first connecting using credentials.\n+Those credentials will allow the client to be identified, authenticated and eventually authorized.\n+Username/password based authentication is very common, but that is not by far the only one.", "originalCommit": "a572ea6ee0aa329402cc7aae90a5c6dc3070de69", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTc5MTkzOA==", "url": "https://github.com/quarkusio/quarkus/pull/9552#discussion_r429791938", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Quarkus introduces a middle abstraction called `Credentials Provider`,\n          \n          \n            \n            Quarkus introduces an intermediate abstraction called `Credentials Provider`,", "author": "geoand", "createdAt": "2020-05-25T08:05:14Z", "path": "docs/src/main/asciidoc/credentials-provider.adoc", "diffHunk": "@@ -0,0 +1,194 @@\n+////\n+This guide is maintained in the main Quarkus repository\n+and pull requests should be submitted there:\n+https://github.com/quarkusio/quarkus/tree/master/docs/src/main/asciidoc\n+////\n+= Quarkus - Using a Credentials Provider\n+\n+include::./attributes.adoc[]\n+:extension-status: preview\n+:vault-datasource-guide: link:vault-datasource[Vault Datasource guide]\n+\n+Interacting with a datastore typically implies first connecting using credentials.\n+Those credentials will allow the client to be identified, authenticated and eventually authorized.\n+Username/password based authentication is very common, but that is not by far the only one.\n+Such credentials information may appear in the application configuration,\n+but it is becoming increasingly popular to store this type of sensitive information in secure stores,\n+such as HashiCorp Vault, Azure Key Vault or the AWS Secrets Manager to name just a few.\n+\n+To bridge datastores that consume credentials, which can take different forms,\n+and secure stores that provide those credentials,\n+Quarkus introduces a middle abstraction called `Credentials Provider`,", "originalCommit": "a572ea6ee0aa329402cc7aae90a5c6dc3070de69", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTc5MzAyMQ==", "url": "https://github.com/quarkusio/quarkus/pull/9552#discussion_r429793021", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            All extensions that rely on username/password authentication do provide also the possibility to set configuration\n          \n          \n            \n            properties in the `application.properties` as an alternative. But the `Credentials Provider` is the only option\n          \n          \n            \n            All extensions that rely on username/password authentication also allow setting configuration\n          \n          \n            \n            properties in `application.properties` as an alternative. But the `Credentials Provider` is the only option", "author": "geoand", "createdAt": "2020-05-25T08:07:32Z", "path": "docs/src/main/asciidoc/credentials-provider.adoc", "diffHunk": "@@ -0,0 +1,194 @@\n+////\n+This guide is maintained in the main Quarkus repository\n+and pull requests should be submitted there:\n+https://github.com/quarkusio/quarkus/tree/master/docs/src/main/asciidoc\n+////\n+= Quarkus - Using a Credentials Provider\n+\n+include::./attributes.adoc[]\n+:extension-status: preview\n+:vault-datasource-guide: link:vault-datasource[Vault Datasource guide]\n+\n+Interacting with a datastore typically implies first connecting using credentials.\n+Those credentials will allow the client to be identified, authenticated and eventually authorized.\n+Username/password based authentication is very common, but that is not by far the only one.\n+Such credentials information may appear in the application configuration,\n+but it is becoming increasingly popular to store this type of sensitive information in secure stores,\n+such as HashiCorp Vault, Azure Key Vault or the AWS Secrets Manager to name just a few.\n+\n+To bridge datastores that consume credentials, which can take different forms,\n+and secure stores that provide those credentials,\n+Quarkus introduces a middle abstraction called `Credentials Provider`,\n+that some extensions may support to consume credentials (e.g. `agroal`),\n+and some others may implement to produce credentials (e.g. `vault`).\n+\n+This Service Programming Interface (SPI) may also be used by implementers that want to support custom providers\n+not yet  implemented in Quarkus (e.g. Azure Key Vault ).\n+\n+Currently, the `Credentials Provider` interface is implemented by the `vault` extension, and is supported\n+by the following credentials consumer extensions:\n+\n+* `agroal`\n+* `reactive-mysql-client`\n+* `reactive-pg-client`\n+\n+All extensions that rely on username/password authentication do provide also the possibility to set configuration\n+properties in the `application.properties` as an alternative. But the `Credentials Provider` is the only option", "originalCommit": "a572ea6ee0aa329402cc7aae90a5c6dc3070de69", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTc5MzUwNQ==", "url": "https://github.com/quarkusio/quarkus/pull/9552#discussion_r429793505", "bodyText": "Does {vault-datasource-guide}  work?\nI'm not an adoc expert, so just asking :)", "author": "geoand", "createdAt": "2020-05-25T08:08:29Z", "path": "docs/src/main/asciidoc/credentials-provider.adoc", "diffHunk": "@@ -0,0 +1,194 @@\n+////\n+This guide is maintained in the main Quarkus repository\n+and pull requests should be submitted there:\n+https://github.com/quarkusio/quarkus/tree/master/docs/src/main/asciidoc\n+////\n+= Quarkus - Using a Credentials Provider\n+\n+include::./attributes.adoc[]\n+:extension-status: preview\n+:vault-datasource-guide: link:vault-datasource[Vault Datasource guide]\n+\n+Interacting with a datastore typically implies first connecting using credentials.\n+Those credentials will allow the client to be identified, authenticated and eventually authorized.\n+Username/password based authentication is very common, but that is not by far the only one.\n+Such credentials information may appear in the application configuration,\n+but it is becoming increasingly popular to store this type of sensitive information in secure stores,\n+such as HashiCorp Vault, Azure Key Vault or the AWS Secrets Manager to name just a few.\n+\n+To bridge datastores that consume credentials, which can take different forms,\n+and secure stores that provide those credentials,\n+Quarkus introduces a middle abstraction called `Credentials Provider`,\n+that some extensions may support to consume credentials (e.g. `agroal`),\n+and some others may implement to produce credentials (e.g. `vault`).\n+\n+This Service Programming Interface (SPI) may also be used by implementers that want to support custom providers\n+not yet  implemented in Quarkus (e.g. Azure Key Vault ).\n+\n+Currently, the `Credentials Provider` interface is implemented by the `vault` extension, and is supported\n+by the following credentials consumer extensions:\n+\n+* `agroal`\n+* `reactive-mysql-client`\n+* `reactive-pg-client`\n+\n+All extensions that rely on username/password authentication do provide also the possibility to set configuration\n+properties in the `application.properties` as an alternative. But the `Credentials Provider` is the only option\n+if credentials are generated (e.g. `Vault Dynamic DB Credentials`) or if a custom credentials provider is required.\n+\n+This guide will show how to use the `Credentials Provider` provided in the `vault` extension,\n+then we will look at implementing a custom `Credentials Provider`, and finally we will talk about additional\n+considerations regarding implementing a `Credentials Provider` in a new extension.\n+\n+include::./status-include.adoc[]\n+\n+== Prerequisites\n+\n+To complete this guide, you need:\n+\n+* roughly 20 minutes\n+* an IDE\n+* JDK 1.8+ installed with `JAVA_HOME` configured appropriately\n+* Apache Maven {maven-version}\n+* Docker installed\n+\n+== Vault Credentials Provider\n+\n+To configure a `Vault Credentials Provider` you need to provide the following property(ies):\n+\n+[source, properties]\n+----\n+quarkus.vault.credentials-provider.<name>.<property>=<value>\n+----\n+\n+The `<name>` will be used in the consumer to refer to this provider. The `<property>` and `<value>` fields are specific to the `Vault Credentials Provider`. For complete details, please refer to the {vault-datasource-guide}.", "originalCommit": "a572ea6ee0aa329402cc7aae90a5c6dc3070de69", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTg0ODU5Mw==", "url": "https://github.com/quarkusio/quarkus/pull/9552#discussion_r429848593", "bodyText": "Yes, it's defined in the attributes at the top of the document.", "author": "gsmet", "createdAt": "2020-05-25T09:59:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTc5MzUwNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTg1MjM1Nw==", "url": "https://github.com/quarkusio/quarkus/pull/9552#discussion_r429852357", "bodyText": "Got it, thanks", "author": "geoand", "createdAt": "2020-05-25T10:07:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTc5MzUwNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTc5NDU2MQ==", "url": "https://github.com/quarkusio/quarkus/pull/9552#discussion_r429794561", "bodyText": "I think these need a little explaining as it's not mentioned in the docs below or above that the implementation of CredentialsProvider needs to be a CDI bean", "author": "geoand", "createdAt": "2020-05-25T08:10:43Z", "path": "docs/src/main/asciidoc/credentials-provider.adoc", "diffHunk": "@@ -0,0 +1,194 @@\n+////\n+This guide is maintained in the main Quarkus repository\n+and pull requests should be submitted there:\n+https://github.com/quarkusio/quarkus/tree/master/docs/src/main/asciidoc\n+////\n+= Quarkus - Using a Credentials Provider\n+\n+include::./attributes.adoc[]\n+:extension-status: preview\n+:vault-datasource-guide: link:vault-datasource[Vault Datasource guide]\n+\n+Interacting with a datastore typically implies first connecting using credentials.\n+Those credentials will allow the client to be identified, authenticated and eventually authorized.\n+Username/password based authentication is very common, but that is not by far the only one.\n+Such credentials information may appear in the application configuration,\n+but it is becoming increasingly popular to store this type of sensitive information in secure stores,\n+such as HashiCorp Vault, Azure Key Vault or the AWS Secrets Manager to name just a few.\n+\n+To bridge datastores that consume credentials, which can take different forms,\n+and secure stores that provide those credentials,\n+Quarkus introduces a middle abstraction called `Credentials Provider`,\n+that some extensions may support to consume credentials (e.g. `agroal`),\n+and some others may implement to produce credentials (e.g. `vault`).\n+\n+This Service Programming Interface (SPI) may also be used by implementers that want to support custom providers\n+not yet  implemented in Quarkus (e.g. Azure Key Vault ).\n+\n+Currently, the `Credentials Provider` interface is implemented by the `vault` extension, and is supported\n+by the following credentials consumer extensions:\n+\n+* `agroal`\n+* `reactive-mysql-client`\n+* `reactive-pg-client`\n+\n+All extensions that rely on username/password authentication do provide also the possibility to set configuration\n+properties in the `application.properties` as an alternative. But the `Credentials Provider` is the only option\n+if credentials are generated (e.g. `Vault Dynamic DB Credentials`) or if a custom credentials provider is required.\n+\n+This guide will show how to use the `Credentials Provider` provided in the `vault` extension,\n+then we will look at implementing a custom `Credentials Provider`, and finally we will talk about additional\n+considerations regarding implementing a `Credentials Provider` in a new extension.\n+\n+include::./status-include.adoc[]\n+\n+== Prerequisites\n+\n+To complete this guide, you need:\n+\n+* roughly 20 minutes\n+* an IDE\n+* JDK 1.8+ installed with `JAVA_HOME` configured appropriately\n+* Apache Maven {maven-version}\n+* Docker installed\n+\n+== Vault Credentials Provider\n+\n+To configure a `Vault Credentials Provider` you need to provide the following property(ies):\n+\n+[source, properties]\n+----\n+quarkus.vault.credentials-provider.<name>.<property>=<value>\n+----\n+\n+The `<name>` will be used in the consumer to refer to this provider. The `<property>` and `<value>` fields are specific to the `Vault Credentials Provider`. For complete details, please refer to the {vault-datasource-guide}.\n+\n+For instance:\n+\n+[source, properties]\n+----\n+quarkus.vault.credentials-provider.mydatabase.kv-path=myapps/vault-quickstart/db\n+----\n+\n+Once defined, the `mydatabase` provider can be used in any extension that supports the `Credentials Provider` interface. For instance in `agroal`:\n+\n+[source, properties]\n+----\n+# configure your datasource\n+quarkus.datasource.db-kind = postgresql\n+quarkus.datasource.username = sarah\n+quarkus.datasource.credentials-provider = mydatabase\n+quarkus.datasource.jdbc.url = jdbc:postgresql://localhost:5432/mydatabase\n+----\n+\n+Note that `quarkus.datasource.username` is the original `agroal` property, whereas the `password` property\n+is not included because the value will come from the `mydatabase` credentials provider we just defined.\n+An alternative is to define both username and password in Vault and drop the `quarkus.datasource.username`\n+property from configuration. All consuming extensions do support the ability to fetch both the username\n+and password from the provider, or just the password.\n+\n+== Custom Credentials Provider\n+\n+Implementing a custom credentials provider is the only option when a vault product is not yet supported in Quarkus, or if credentials need to be retrieved from a custom store.\n+\n+The only interface to implement is:\n+\n+[source, java]\n+----\n+public interface CredentialsProvider {\n+\n+    String USER_PROPERTY_NAME = \"user\";\n+    String PASSWORD_PROPERTY_NAME = \"password\";\n+\n+    Map<String, String> getCredentials(String credentialsProviderName);\n+\n+}\n+----\n+\n+`USER_PROPERTY_NAME` and `PASSWORD_PROPERTY_NAME` are standard properties that should be recognized by any consuming extension that support username/password based authentication.\n+\n+Here is a simple implementation example:\n+\n+[source, java]\n+----\n+@ApplicationScoped\n+@Unremovable", "originalCommit": "a572ea6ee0aa329402cc7aae90a5c6dc3070de69", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDA0OTYwMQ==", "url": "https://github.com/quarkusio/quarkus/pull/9552#discussion_r430049601", "bodyText": "I have added:\n\nIt is required that implementations be valid ApplicationScoped CDI beans.\nHere is a simple example:\n...", "author": "vsevel", "createdAt": "2020-05-25T19:04:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTc5NDU2MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTc5NTU2MA==", "url": "https://github.com/quarkusio/quarkus/pull/9552#discussion_r429795560", "bodyText": "It might be too late now to change this, but this seems inconsistent. The value of credentials-provider-type is the CDI name, where I would expect that it would either be the class, or the property be named credentials-provider-name", "author": "geoand", "createdAt": "2020-05-25T08:12:51Z", "path": "docs/src/main/asciidoc/credentials-provider.adoc", "diffHunk": "@@ -0,0 +1,194 @@\n+////\n+This guide is maintained in the main Quarkus repository\n+and pull requests should be submitted there:\n+https://github.com/quarkusio/quarkus/tree/master/docs/src/main/asciidoc\n+////\n+= Quarkus - Using a Credentials Provider\n+\n+include::./attributes.adoc[]\n+:extension-status: preview\n+:vault-datasource-guide: link:vault-datasource[Vault Datasource guide]\n+\n+Interacting with a datastore typically implies first connecting using credentials.\n+Those credentials will allow the client to be identified, authenticated and eventually authorized.\n+Username/password based authentication is very common, but that is not by far the only one.\n+Such credentials information may appear in the application configuration,\n+but it is becoming increasingly popular to store this type of sensitive information in secure stores,\n+such as HashiCorp Vault, Azure Key Vault or the AWS Secrets Manager to name just a few.\n+\n+To bridge datastores that consume credentials, which can take different forms,\n+and secure stores that provide those credentials,\n+Quarkus introduces a middle abstraction called `Credentials Provider`,\n+that some extensions may support to consume credentials (e.g. `agroal`),\n+and some others may implement to produce credentials (e.g. `vault`).\n+\n+This Service Programming Interface (SPI) may also be used by implementers that want to support custom providers\n+not yet  implemented in Quarkus (e.g. Azure Key Vault ).\n+\n+Currently, the `Credentials Provider` interface is implemented by the `vault` extension, and is supported\n+by the following credentials consumer extensions:\n+\n+* `agroal`\n+* `reactive-mysql-client`\n+* `reactive-pg-client`\n+\n+All extensions that rely on username/password authentication do provide also the possibility to set configuration\n+properties in the `application.properties` as an alternative. But the `Credentials Provider` is the only option\n+if credentials are generated (e.g. `Vault Dynamic DB Credentials`) or if a custom credentials provider is required.\n+\n+This guide will show how to use the `Credentials Provider` provided in the `vault` extension,\n+then we will look at implementing a custom `Credentials Provider`, and finally we will talk about additional\n+considerations regarding implementing a `Credentials Provider` in a new extension.\n+\n+include::./status-include.adoc[]\n+\n+== Prerequisites\n+\n+To complete this guide, you need:\n+\n+* roughly 20 minutes\n+* an IDE\n+* JDK 1.8+ installed with `JAVA_HOME` configured appropriately\n+* Apache Maven {maven-version}\n+* Docker installed\n+\n+== Vault Credentials Provider\n+\n+To configure a `Vault Credentials Provider` you need to provide the following property(ies):\n+\n+[source, properties]\n+----\n+quarkus.vault.credentials-provider.<name>.<property>=<value>\n+----\n+\n+The `<name>` will be used in the consumer to refer to this provider. The `<property>` and `<value>` fields are specific to the `Vault Credentials Provider`. For complete details, please refer to the {vault-datasource-guide}.\n+\n+For instance:\n+\n+[source, properties]\n+----\n+quarkus.vault.credentials-provider.mydatabase.kv-path=myapps/vault-quickstart/db\n+----\n+\n+Once defined, the `mydatabase` provider can be used in any extension that supports the `Credentials Provider` interface. For instance in `agroal`:\n+\n+[source, properties]\n+----\n+# configure your datasource\n+quarkus.datasource.db-kind = postgresql\n+quarkus.datasource.username = sarah\n+quarkus.datasource.credentials-provider = mydatabase\n+quarkus.datasource.jdbc.url = jdbc:postgresql://localhost:5432/mydatabase\n+----\n+\n+Note that `quarkus.datasource.username` is the original `agroal` property, whereas the `password` property\n+is not included because the value will come from the `mydatabase` credentials provider we just defined.\n+An alternative is to define both username and password in Vault and drop the `quarkus.datasource.username`\n+property from configuration. All consuming extensions do support the ability to fetch both the username\n+and password from the provider, or just the password.\n+\n+== Custom Credentials Provider\n+\n+Implementing a custom credentials provider is the only option when a vault product is not yet supported in Quarkus, or if credentials need to be retrieved from a custom store.\n+\n+The only interface to implement is:\n+\n+[source, java]\n+----\n+public interface CredentialsProvider {\n+\n+    String USER_PROPERTY_NAME = \"user\";\n+    String PASSWORD_PROPERTY_NAME = \"password\";\n+\n+    Map<String, String> getCredentials(String credentialsProviderName);\n+\n+}\n+----\n+\n+`USER_PROPERTY_NAME` and `PASSWORD_PROPERTY_NAME` are standard properties that should be recognized by any consuming extension that support username/password based authentication.\n+\n+Here is a simple implementation example:\n+\n+[source, java]\n+----\n+@ApplicationScoped\n+@Unremovable\n+public class MyCredentialsProvider implements CredentialsProvider {\n+\n+\t@Override\n+\tpublic Map<String, String> getCredentials(String credentialsProviderName) {\n+\n+\t\tMap<String, String> properties = new HashMap<>();\n+\t\tproperties.put(USER_PROPERTY_NAME, \"hibernate_orm_test\");\n+\t\tproperties.put(PASSWORD_PROPERTY_NAME, \"hibernate_orm_test\");\n+\t\treturn properties;\n+\t}\n+\n+}\n+----\n+\n+Note that we decided here to return both the username and the password.\n+\n+This provider may be used in a datasource definition like this:\n+\n+[source, properties]\n+----\n+quarkus.datasource.db-kind=postgresql\n+quarkus.datasource.credentials-provider=custom\n+quarkus.datasource.jdbc.url=jdbc:postgresql://localhost:5431/hibernate_orm_test\n+----\n+\n+It is also possible to pass configuration properties to the provider using standard MicroProfile `Config` injection:\n+\n+[source, properties]\n+----\n+custom.foo=bar\n+----\n+\n+And in the provider implementation:\n+\n+[source, java]\n+----\n+@Inject\n+Config config;\n+\n+@Override\n+public Map<String, String> getCredentials(String credentialsProviderName) {\n+\n+    System.out.println(\"MyCredentialsProvider called with foo=\" + config.getValue(credentialsProviderName + \".foo\", String.class));\n+    ...\n+----\n+\n+== New Credentials Provider extension\n+\n+When creating a custom `Credentials Provider` in a new extension, there are a few additional considerations.\n+\n+First, you need to name it to avoid collisions in case multiple credentials providers are available in the project:\n+\n+[source, java]\n+----\n+@ApplicationScoped\n+@Unremovable\n+@Named(\"my-credentials-provider\")\n+public class MyCredentialsProvider implements CredentialsProvider {\n+----\n+\n+It is the responsibility of the consumer to allow a `credentials-provider-type` property:\n+\n+[source, properties]\n+----\n+quarkus.datasource.credentials-provider = custom\n+quarkus.datasource.credentials-provider-type = my-credentials-provider", "originalCommit": "a572ea6ee0aa329402cc7aae90a5c6dc3070de69", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDA1ODMzNg==", "url": "https://github.com/quarkusio/quarkus/pull/9552#discussion_r430058336", "bodyText": "good point.\nto me, the name is mydatabase, as in:\nquarkus.vault.credentials-provider.mydatabase.kv-path=myapps/vault-quickstart/db\n\nquarkus.datasource.credentials-provider = mydatabase\n\nand reflected in the method parameter:\nMap<String, String> getCredentials(String credentialsProviderName);\n\ninstead of credentials-provider-type or credentials-provider-name, may be credentials-provider-cdi-name or credentials-provider-bean-name would be more appropriate.\nor we replace the name by an id:\nMap<String, String> getCredentials(String credentialsProviderId);\n\nand use credentials-provider-name as you suggest in place of credentials-provider-type.\nas far as being too late, I suppose you are talking about 1.5? it is an easy change, and I would be surprised if anybody was using the credentials-provider-type property today. so we can do it now, or I can schedule this small evolution for 1.6. Let me know.\ncc @gsmet", "author": "vsevel", "createdAt": "2020-05-25T19:46:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTc5NTU2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDA1OTIwNg==", "url": "https://github.com/quarkusio/quarkus/pull/9552#discussion_r430059206", "bodyText": "I am personally in favor of making the change now if we have the time, but I'll let @gsmet decide", "author": "geoand", "createdAt": "2020-05-25T19:50:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTc5NTU2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI1NTk1OA==", "url": "https://github.com/quarkusio/quarkus/pull/9552#discussion_r430255958", "bodyText": "Let's go with credentials-provider-bean-name but it needs to happen fast if we want it for 1.5 as I will cut the release at the beginning of the afternoon if all goes well.", "author": "gsmet", "createdAt": "2020-05-26T08:51:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTc5NTU2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDM0OTYwOQ==", "url": "https://github.com/quarkusio/quarkus/pull/9552#discussion_r430349609", "bodyText": "credentials-provider-bean-name sounds a bit too technical (will it always be a bean ?), credentials-provider-name seems a good compromise", "author": "sberyozkin", "createdAt": "2020-05-26T11:42:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTc5NTU2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDM1MDIwNQ==", "url": "https://github.com/quarkusio/quarkus/pull/9552#discussion_r430350205", "bodyText": "Looking at the code it seems to always be a bean name.\nI am fine with the compromise suggestion", "author": "geoand", "createdAt": "2020-05-26T11:43:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTc5NTU2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDM1MDYzMg==", "url": "https://github.com/quarkusio/quarkus/pull/9552#discussion_r430350632", "bodyText": "@gsmet I am just seeing your message now. I think the renaming is too short since there are code changes. I would suggest that you merge the doc PR, and I am creating now a different PR for the naming change, that you may decide to apply on 1.5 or not.", "author": "vsevel", "createdAt": "2020-05-26T11:44:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTc5NTU2MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTg0NzY0Nw==", "url": "https://github.com/quarkusio/quarkus/pull/9552#discussion_r429847647", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            not yet  implemented in Quarkus (e.g. Azure Key Vault ).\n          \n          \n            \n            not yet  implemented in Quarkus (e.g. Azure Key Vault).", "author": "gsmet", "createdAt": "2020-05-25T09:57:26Z", "path": "docs/src/main/asciidoc/credentials-provider.adoc", "diffHunk": "@@ -0,0 +1,194 @@\n+////\n+This guide is maintained in the main Quarkus repository\n+and pull requests should be submitted there:\n+https://github.com/quarkusio/quarkus/tree/master/docs/src/main/asciidoc\n+////\n+= Quarkus - Using a Credentials Provider\n+\n+include::./attributes.adoc[]\n+:extension-status: preview\n+:vault-datasource-guide: link:vault-datasource[Vault Datasource guide]\n+\n+Interacting with a datastore typically implies first connecting using credentials.\n+Those credentials will allow the client to be identified, authenticated and eventually authorized.\n+Username/password based authentication is very common, but that is not by far the only one.\n+Such credentials information may appear in the application configuration,\n+but it is becoming increasingly popular to store this type of sensitive information in secure stores,\n+such as HashiCorp Vault, Azure Key Vault or the AWS Secrets Manager to name just a few.\n+\n+To bridge datastores that consume credentials, which can take different forms,\n+and secure stores that provide those credentials,\n+Quarkus introduces a middle abstraction called `Credentials Provider`,\n+that some extensions may support to consume credentials (e.g. `agroal`),\n+and some others may implement to produce credentials (e.g. `vault`).\n+\n+This Service Programming Interface (SPI) may also be used by implementers that want to support custom providers\n+not yet  implemented in Quarkus (e.g. Azure Key Vault ).", "originalCommit": "a572ea6ee0aa329402cc7aae90a5c6dc3070de69", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTg0ODI3MA==", "url": "https://github.com/quarkusio/quarkus/pull/9552#discussion_r429848270", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            To configure a `Vault Credentials Provider` you need to provide the following property(ies):\n          \n          \n            \n            To configure a `Vault Credentials Provider` you need to provide the following properties:\n          \n      \n    \n    \n  \n\nlet's not make things awkward :)", "author": "gsmet", "createdAt": "2020-05-25T09:58:38Z", "path": "docs/src/main/asciidoc/credentials-provider.adoc", "diffHunk": "@@ -0,0 +1,194 @@\n+////\n+This guide is maintained in the main Quarkus repository\n+and pull requests should be submitted there:\n+https://github.com/quarkusio/quarkus/tree/master/docs/src/main/asciidoc\n+////\n+= Quarkus - Using a Credentials Provider\n+\n+include::./attributes.adoc[]\n+:extension-status: preview\n+:vault-datasource-guide: link:vault-datasource[Vault Datasource guide]\n+\n+Interacting with a datastore typically implies first connecting using credentials.\n+Those credentials will allow the client to be identified, authenticated and eventually authorized.\n+Username/password based authentication is very common, but that is not by far the only one.\n+Such credentials information may appear in the application configuration,\n+but it is becoming increasingly popular to store this type of sensitive information in secure stores,\n+such as HashiCorp Vault, Azure Key Vault or the AWS Secrets Manager to name just a few.\n+\n+To bridge datastores that consume credentials, which can take different forms,\n+and secure stores that provide those credentials,\n+Quarkus introduces a middle abstraction called `Credentials Provider`,\n+that some extensions may support to consume credentials (e.g. `agroal`),\n+and some others may implement to produce credentials (e.g. `vault`).\n+\n+This Service Programming Interface (SPI) may also be used by implementers that want to support custom providers\n+not yet  implemented in Quarkus (e.g. Azure Key Vault ).\n+\n+Currently, the `Credentials Provider` interface is implemented by the `vault` extension, and is supported\n+by the following credentials consumer extensions:\n+\n+* `agroal`\n+* `reactive-mysql-client`\n+* `reactive-pg-client`\n+\n+All extensions that rely on username/password authentication do provide also the possibility to set configuration\n+properties in the `application.properties` as an alternative. But the `Credentials Provider` is the only option\n+if credentials are generated (e.g. `Vault Dynamic DB Credentials`) or if a custom credentials provider is required.\n+\n+This guide will show how to use the `Credentials Provider` provided in the `vault` extension,\n+then we will look at implementing a custom `Credentials Provider`, and finally we will talk about additional\n+considerations regarding implementing a `Credentials Provider` in a new extension.\n+\n+include::./status-include.adoc[]\n+\n+== Prerequisites\n+\n+To complete this guide, you need:\n+\n+* roughly 20 minutes\n+* an IDE\n+* JDK 1.8+ installed with `JAVA_HOME` configured appropriately\n+* Apache Maven {maven-version}\n+* Docker installed\n+\n+== Vault Credentials Provider\n+\n+To configure a `Vault Credentials Provider` you need to provide the following property(ies):", "originalCommit": "a572ea6ee0aa329402cc7aae90a5c6dc3070de69", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTg0OTM2NA==", "url": "https://github.com/quarkusio/quarkus/pull/9552#discussion_r429849364", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            It is also possible to pass configuration properties to the provider using standard MicroProfile `Config` injection:\n          \n          \n            \n            It is also possible to pass configuration properties to the provider using standard MicroProfile Config injection:", "author": "gsmet", "createdAt": "2020-05-25T10:00:58Z", "path": "docs/src/main/asciidoc/credentials-provider.adoc", "diffHunk": "@@ -0,0 +1,194 @@\n+////\n+This guide is maintained in the main Quarkus repository\n+and pull requests should be submitted there:\n+https://github.com/quarkusio/quarkus/tree/master/docs/src/main/asciidoc\n+////\n+= Quarkus - Using a Credentials Provider\n+\n+include::./attributes.adoc[]\n+:extension-status: preview\n+:vault-datasource-guide: link:vault-datasource[Vault Datasource guide]\n+\n+Interacting with a datastore typically implies first connecting using credentials.\n+Those credentials will allow the client to be identified, authenticated and eventually authorized.\n+Username/password based authentication is very common, but that is not by far the only one.\n+Such credentials information may appear in the application configuration,\n+but it is becoming increasingly popular to store this type of sensitive information in secure stores,\n+such as HashiCorp Vault, Azure Key Vault or the AWS Secrets Manager to name just a few.\n+\n+To bridge datastores that consume credentials, which can take different forms,\n+and secure stores that provide those credentials,\n+Quarkus introduces a middle abstraction called `Credentials Provider`,\n+that some extensions may support to consume credentials (e.g. `agroal`),\n+and some others may implement to produce credentials (e.g. `vault`).\n+\n+This Service Programming Interface (SPI) may also be used by implementers that want to support custom providers\n+not yet  implemented in Quarkus (e.g. Azure Key Vault ).\n+\n+Currently, the `Credentials Provider` interface is implemented by the `vault` extension, and is supported\n+by the following credentials consumer extensions:\n+\n+* `agroal`\n+* `reactive-mysql-client`\n+* `reactive-pg-client`\n+\n+All extensions that rely on username/password authentication do provide also the possibility to set configuration\n+properties in the `application.properties` as an alternative. But the `Credentials Provider` is the only option\n+if credentials are generated (e.g. `Vault Dynamic DB Credentials`) or if a custom credentials provider is required.\n+\n+This guide will show how to use the `Credentials Provider` provided in the `vault` extension,\n+then we will look at implementing a custom `Credentials Provider`, and finally we will talk about additional\n+considerations regarding implementing a `Credentials Provider` in a new extension.\n+\n+include::./status-include.adoc[]\n+\n+== Prerequisites\n+\n+To complete this guide, you need:\n+\n+* roughly 20 minutes\n+* an IDE\n+* JDK 1.8+ installed with `JAVA_HOME` configured appropriately\n+* Apache Maven {maven-version}\n+* Docker installed\n+\n+== Vault Credentials Provider\n+\n+To configure a `Vault Credentials Provider` you need to provide the following property(ies):\n+\n+[source, properties]\n+----\n+quarkus.vault.credentials-provider.<name>.<property>=<value>\n+----\n+\n+The `<name>` will be used in the consumer to refer to this provider. The `<property>` and `<value>` fields are specific to the `Vault Credentials Provider`. For complete details, please refer to the {vault-datasource-guide}.\n+\n+For instance:\n+\n+[source, properties]\n+----\n+quarkus.vault.credentials-provider.mydatabase.kv-path=myapps/vault-quickstart/db\n+----\n+\n+Once defined, the `mydatabase` provider can be used in any extension that supports the `Credentials Provider` interface. For instance in `agroal`:\n+\n+[source, properties]\n+----\n+# configure your datasource\n+quarkus.datasource.db-kind = postgresql\n+quarkus.datasource.username = sarah\n+quarkus.datasource.credentials-provider = mydatabase\n+quarkus.datasource.jdbc.url = jdbc:postgresql://localhost:5432/mydatabase\n+----\n+\n+Note that `quarkus.datasource.username` is the original `agroal` property, whereas the `password` property\n+is not included because the value will come from the `mydatabase` credentials provider we just defined.\n+An alternative is to define both username and password in Vault and drop the `quarkus.datasource.username`\n+property from configuration. All consuming extensions do support the ability to fetch both the username\n+and password from the provider, or just the password.\n+\n+== Custom Credentials Provider\n+\n+Implementing a custom credentials provider is the only option when a vault product is not yet supported in Quarkus, or if credentials need to be retrieved from a custom store.\n+\n+The only interface to implement is:\n+\n+[source, java]\n+----\n+public interface CredentialsProvider {\n+\n+    String USER_PROPERTY_NAME = \"user\";\n+    String PASSWORD_PROPERTY_NAME = \"password\";\n+\n+    Map<String, String> getCredentials(String credentialsProviderName);\n+\n+}\n+----\n+\n+`USER_PROPERTY_NAME` and `PASSWORD_PROPERTY_NAME` are standard properties that should be recognized by any consuming extension that support username/password based authentication.\n+\n+Here is a simple implementation example:\n+\n+[source, java]\n+----\n+@ApplicationScoped\n+@Unremovable\n+public class MyCredentialsProvider implements CredentialsProvider {\n+\n+\t@Override\n+\tpublic Map<String, String> getCredentials(String credentialsProviderName) {\n+\n+\t\tMap<String, String> properties = new HashMap<>();\n+\t\tproperties.put(USER_PROPERTY_NAME, \"hibernate_orm_test\");\n+\t\tproperties.put(PASSWORD_PROPERTY_NAME, \"hibernate_orm_test\");\n+\t\treturn properties;\n+\t}\n+\n+}\n+----\n+\n+Note that we decided here to return both the username and the password.\n+\n+This provider may be used in a datasource definition like this:\n+\n+[source, properties]\n+----\n+quarkus.datasource.db-kind=postgresql\n+quarkus.datasource.credentials-provider=custom\n+quarkus.datasource.jdbc.url=jdbc:postgresql://localhost:5431/hibernate_orm_test\n+----\n+\n+It is also possible to pass configuration properties to the provider using standard MicroProfile `Config` injection:", "originalCommit": "a572ea6ee0aa329402cc7aae90a5c6dc3070de69", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTg0OTU0Mw==", "url": "https://github.com/quarkusio/quarkus/pull/9552#discussion_r429849543", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            When creating a custom `Credentials Provider` in a new extension, there are a few additional considerations.\n          \n          \n            \n            When creating a custom credentials provider in a new extension, there are a few additional considerations.", "author": "gsmet", "createdAt": "2020-05-25T10:01:24Z", "path": "docs/src/main/asciidoc/credentials-provider.adoc", "diffHunk": "@@ -0,0 +1,194 @@\n+////\n+This guide is maintained in the main Quarkus repository\n+and pull requests should be submitted there:\n+https://github.com/quarkusio/quarkus/tree/master/docs/src/main/asciidoc\n+////\n+= Quarkus - Using a Credentials Provider\n+\n+include::./attributes.adoc[]\n+:extension-status: preview\n+:vault-datasource-guide: link:vault-datasource[Vault Datasource guide]\n+\n+Interacting with a datastore typically implies first connecting using credentials.\n+Those credentials will allow the client to be identified, authenticated and eventually authorized.\n+Username/password based authentication is very common, but that is not by far the only one.\n+Such credentials information may appear in the application configuration,\n+but it is becoming increasingly popular to store this type of sensitive information in secure stores,\n+such as HashiCorp Vault, Azure Key Vault or the AWS Secrets Manager to name just a few.\n+\n+To bridge datastores that consume credentials, which can take different forms,\n+and secure stores that provide those credentials,\n+Quarkus introduces a middle abstraction called `Credentials Provider`,\n+that some extensions may support to consume credentials (e.g. `agroal`),\n+and some others may implement to produce credentials (e.g. `vault`).\n+\n+This Service Programming Interface (SPI) may also be used by implementers that want to support custom providers\n+not yet  implemented in Quarkus (e.g. Azure Key Vault ).\n+\n+Currently, the `Credentials Provider` interface is implemented by the `vault` extension, and is supported\n+by the following credentials consumer extensions:\n+\n+* `agroal`\n+* `reactive-mysql-client`\n+* `reactive-pg-client`\n+\n+All extensions that rely on username/password authentication do provide also the possibility to set configuration\n+properties in the `application.properties` as an alternative. But the `Credentials Provider` is the only option\n+if credentials are generated (e.g. `Vault Dynamic DB Credentials`) or if a custom credentials provider is required.\n+\n+This guide will show how to use the `Credentials Provider` provided in the `vault` extension,\n+then we will look at implementing a custom `Credentials Provider`, and finally we will talk about additional\n+considerations regarding implementing a `Credentials Provider` in a new extension.\n+\n+include::./status-include.adoc[]\n+\n+== Prerequisites\n+\n+To complete this guide, you need:\n+\n+* roughly 20 minutes\n+* an IDE\n+* JDK 1.8+ installed with `JAVA_HOME` configured appropriately\n+* Apache Maven {maven-version}\n+* Docker installed\n+\n+== Vault Credentials Provider\n+\n+To configure a `Vault Credentials Provider` you need to provide the following property(ies):\n+\n+[source, properties]\n+----\n+quarkus.vault.credentials-provider.<name>.<property>=<value>\n+----\n+\n+The `<name>` will be used in the consumer to refer to this provider. The `<property>` and `<value>` fields are specific to the `Vault Credentials Provider`. For complete details, please refer to the {vault-datasource-guide}.\n+\n+For instance:\n+\n+[source, properties]\n+----\n+quarkus.vault.credentials-provider.mydatabase.kv-path=myapps/vault-quickstart/db\n+----\n+\n+Once defined, the `mydatabase` provider can be used in any extension that supports the `Credentials Provider` interface. For instance in `agroal`:\n+\n+[source, properties]\n+----\n+# configure your datasource\n+quarkus.datasource.db-kind = postgresql\n+quarkus.datasource.username = sarah\n+quarkus.datasource.credentials-provider = mydatabase\n+quarkus.datasource.jdbc.url = jdbc:postgresql://localhost:5432/mydatabase\n+----\n+\n+Note that `quarkus.datasource.username` is the original `agroal` property, whereas the `password` property\n+is not included because the value will come from the `mydatabase` credentials provider we just defined.\n+An alternative is to define both username and password in Vault and drop the `quarkus.datasource.username`\n+property from configuration. All consuming extensions do support the ability to fetch both the username\n+and password from the provider, or just the password.\n+\n+== Custom Credentials Provider\n+\n+Implementing a custom credentials provider is the only option when a vault product is not yet supported in Quarkus, or if credentials need to be retrieved from a custom store.\n+\n+The only interface to implement is:\n+\n+[source, java]\n+----\n+public interface CredentialsProvider {\n+\n+    String USER_PROPERTY_NAME = \"user\";\n+    String PASSWORD_PROPERTY_NAME = \"password\";\n+\n+    Map<String, String> getCredentials(String credentialsProviderName);\n+\n+}\n+----\n+\n+`USER_PROPERTY_NAME` and `PASSWORD_PROPERTY_NAME` are standard properties that should be recognized by any consuming extension that support username/password based authentication.\n+\n+Here is a simple implementation example:\n+\n+[source, java]\n+----\n+@ApplicationScoped\n+@Unremovable\n+public class MyCredentialsProvider implements CredentialsProvider {\n+\n+\t@Override\n+\tpublic Map<String, String> getCredentials(String credentialsProviderName) {\n+\n+\t\tMap<String, String> properties = new HashMap<>();\n+\t\tproperties.put(USER_PROPERTY_NAME, \"hibernate_orm_test\");\n+\t\tproperties.put(PASSWORD_PROPERTY_NAME, \"hibernate_orm_test\");\n+\t\treturn properties;\n+\t}\n+\n+}\n+----\n+\n+Note that we decided here to return both the username and the password.\n+\n+This provider may be used in a datasource definition like this:\n+\n+[source, properties]\n+----\n+quarkus.datasource.db-kind=postgresql\n+quarkus.datasource.credentials-provider=custom\n+quarkus.datasource.jdbc.url=jdbc:postgresql://localhost:5431/hibernate_orm_test\n+----\n+\n+It is also possible to pass configuration properties to the provider using standard MicroProfile `Config` injection:\n+\n+[source, properties]\n+----\n+custom.foo=bar\n+----\n+\n+And in the provider implementation:\n+\n+[source, java]\n+----\n+@Inject\n+Config config;\n+\n+@Override\n+public Map<String, String> getCredentials(String credentialsProviderName) {\n+\n+    System.out.println(\"MyCredentialsProvider called with foo=\" + config.getValue(credentialsProviderName + \".foo\", String.class));\n+    ...\n+----\n+\n+== New Credentials Provider extension\n+\n+When creating a custom `Credentials Provider` in a new extension, there are a few additional considerations.", "originalCommit": "a572ea6ee0aa329402cc7aae90a5c6dc3070de69", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTg0OTk5Nw==", "url": "https://github.com/quarkusio/quarkus/pull/9552#discussion_r429849997", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            by the credentials provider, not just the username and password. So when you design the new `Credentials Provider`\n          \n          \n            \n            by the credentials provider, not just the username and password. So when you design the new credentials provider", "author": "gsmet", "createdAt": "2020-05-25T10:02:22Z", "path": "docs/src/main/asciidoc/credentials-provider.adoc", "diffHunk": "@@ -0,0 +1,194 @@\n+////\n+This guide is maintained in the main Quarkus repository\n+and pull requests should be submitted there:\n+https://github.com/quarkusio/quarkus/tree/master/docs/src/main/asciidoc\n+////\n+= Quarkus - Using a Credentials Provider\n+\n+include::./attributes.adoc[]\n+:extension-status: preview\n+:vault-datasource-guide: link:vault-datasource[Vault Datasource guide]\n+\n+Interacting with a datastore typically implies first connecting using credentials.\n+Those credentials will allow the client to be identified, authenticated and eventually authorized.\n+Username/password based authentication is very common, but that is not by far the only one.\n+Such credentials information may appear in the application configuration,\n+but it is becoming increasingly popular to store this type of sensitive information in secure stores,\n+such as HashiCorp Vault, Azure Key Vault or the AWS Secrets Manager to name just a few.\n+\n+To bridge datastores that consume credentials, which can take different forms,\n+and secure stores that provide those credentials,\n+Quarkus introduces a middle abstraction called `Credentials Provider`,\n+that some extensions may support to consume credentials (e.g. `agroal`),\n+and some others may implement to produce credentials (e.g. `vault`).\n+\n+This Service Programming Interface (SPI) may also be used by implementers that want to support custom providers\n+not yet  implemented in Quarkus (e.g. Azure Key Vault ).\n+\n+Currently, the `Credentials Provider` interface is implemented by the `vault` extension, and is supported\n+by the following credentials consumer extensions:\n+\n+* `agroal`\n+* `reactive-mysql-client`\n+* `reactive-pg-client`\n+\n+All extensions that rely on username/password authentication do provide also the possibility to set configuration\n+properties in the `application.properties` as an alternative. But the `Credentials Provider` is the only option\n+if credentials are generated (e.g. `Vault Dynamic DB Credentials`) or if a custom credentials provider is required.\n+\n+This guide will show how to use the `Credentials Provider` provided in the `vault` extension,\n+then we will look at implementing a custom `Credentials Provider`, and finally we will talk about additional\n+considerations regarding implementing a `Credentials Provider` in a new extension.\n+\n+include::./status-include.adoc[]\n+\n+== Prerequisites\n+\n+To complete this guide, you need:\n+\n+* roughly 20 minutes\n+* an IDE\n+* JDK 1.8+ installed with `JAVA_HOME` configured appropriately\n+* Apache Maven {maven-version}\n+* Docker installed\n+\n+== Vault Credentials Provider\n+\n+To configure a `Vault Credentials Provider` you need to provide the following property(ies):\n+\n+[source, properties]\n+----\n+quarkus.vault.credentials-provider.<name>.<property>=<value>\n+----\n+\n+The `<name>` will be used in the consumer to refer to this provider. The `<property>` and `<value>` fields are specific to the `Vault Credentials Provider`. For complete details, please refer to the {vault-datasource-guide}.\n+\n+For instance:\n+\n+[source, properties]\n+----\n+quarkus.vault.credentials-provider.mydatabase.kv-path=myapps/vault-quickstart/db\n+----\n+\n+Once defined, the `mydatabase` provider can be used in any extension that supports the `Credentials Provider` interface. For instance in `agroal`:\n+\n+[source, properties]\n+----\n+# configure your datasource\n+quarkus.datasource.db-kind = postgresql\n+quarkus.datasource.username = sarah\n+quarkus.datasource.credentials-provider = mydatabase\n+quarkus.datasource.jdbc.url = jdbc:postgresql://localhost:5432/mydatabase\n+----\n+\n+Note that `quarkus.datasource.username` is the original `agroal` property, whereas the `password` property\n+is not included because the value will come from the `mydatabase` credentials provider we just defined.\n+An alternative is to define both username and password in Vault and drop the `quarkus.datasource.username`\n+property from configuration. All consuming extensions do support the ability to fetch both the username\n+and password from the provider, or just the password.\n+\n+== Custom Credentials Provider\n+\n+Implementing a custom credentials provider is the only option when a vault product is not yet supported in Quarkus, or if credentials need to be retrieved from a custom store.\n+\n+The only interface to implement is:\n+\n+[source, java]\n+----\n+public interface CredentialsProvider {\n+\n+    String USER_PROPERTY_NAME = \"user\";\n+    String PASSWORD_PROPERTY_NAME = \"password\";\n+\n+    Map<String, String> getCredentials(String credentialsProviderName);\n+\n+}\n+----\n+\n+`USER_PROPERTY_NAME` and `PASSWORD_PROPERTY_NAME` are standard properties that should be recognized by any consuming extension that support username/password based authentication.\n+\n+Here is a simple implementation example:\n+\n+[source, java]\n+----\n+@ApplicationScoped\n+@Unremovable\n+public class MyCredentialsProvider implements CredentialsProvider {\n+\n+\t@Override\n+\tpublic Map<String, String> getCredentials(String credentialsProviderName) {\n+\n+\t\tMap<String, String> properties = new HashMap<>();\n+\t\tproperties.put(USER_PROPERTY_NAME, \"hibernate_orm_test\");\n+\t\tproperties.put(PASSWORD_PROPERTY_NAME, \"hibernate_orm_test\");\n+\t\treturn properties;\n+\t}\n+\n+}\n+----\n+\n+Note that we decided here to return both the username and the password.\n+\n+This provider may be used in a datasource definition like this:\n+\n+[source, properties]\n+----\n+quarkus.datasource.db-kind=postgresql\n+quarkus.datasource.credentials-provider=custom\n+quarkus.datasource.jdbc.url=jdbc:postgresql://localhost:5431/hibernate_orm_test\n+----\n+\n+It is also possible to pass configuration properties to the provider using standard MicroProfile `Config` injection:\n+\n+[source, properties]\n+----\n+custom.foo=bar\n+----\n+\n+And in the provider implementation:\n+\n+[source, java]\n+----\n+@Inject\n+Config config;\n+\n+@Override\n+public Map<String, String> getCredentials(String credentialsProviderName) {\n+\n+    System.out.println(\"MyCredentialsProvider called with foo=\" + config.getValue(credentialsProviderName + \".foo\", String.class));\n+    ...\n+----\n+\n+== New Credentials Provider extension\n+\n+When creating a custom `Credentials Provider` in a new extension, there are a few additional considerations.\n+\n+First, you need to name it to avoid collisions in case multiple credentials providers are available in the project:\n+\n+[source, java]\n+----\n+@ApplicationScoped\n+@Unremovable\n+@Named(\"my-credentials-provider\")\n+public class MyCredentialsProvider implements CredentialsProvider {\n+----\n+\n+It is the responsibility of the consumer to allow a `credentials-provider-type` property:\n+\n+[source, properties]\n+----\n+quarkus.datasource.credentials-provider = custom\n+quarkus.datasource.credentials-provider-type = my-credentials-provider\n+----\n+\n+The extension should allow runtime config, such as the `CredentialsProviderConfig` from the `vault` extension\n+to configure any custom property in the provider. For an AWS Secrets Manager extension, this could be:\n+\n+* `region`\n+* `credentials-type`\n+* `secrets-id`\n+\n+Note also that some consumers such as `agroal` will add to their connection configuration any properties returned\n+by the credentials provider, not just the username and password. So when you design the new `Credentials Provider`", "originalCommit": "a572ea6ee0aa329402cc7aae90a5c6dc3070de69", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "227fb95d175ad8c6c5ad83750f24553f8d6b976b", "url": "https://github.com/quarkusio/quarkus/commit/227fb95d175ad8c6c5ad83750f24553f8d6b976b", "message": "Credentials Provider Documentation", "committedDate": "2020-05-25T19:10:52Z", "type": "commit"}, {"oid": "227fb95d175ad8c6c5ad83750f24553f8d6b976b", "url": "https://github.com/quarkusio/quarkus/commit/227fb95d175ad8c6c5ad83750f24553f8d6b976b", "message": "Credentials Provider Documentation", "committedDate": "2020-05-25T19:10:52Z", "type": "forcePushed"}]}