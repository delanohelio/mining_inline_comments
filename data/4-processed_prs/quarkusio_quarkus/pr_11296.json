{"pr_number": 11296, "pr_title": "Use metadata for gradle/maven repositories and separate gradle plugin version", "pr_createdAt": "2020-08-10T09:37:08Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/11296", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Nzg1NTQ1Ng==", "url": "https://github.com/quarkusio/quarkus/pull/11296#discussion_r467855456", "bodyText": "fyi, this is not the image we need to paramaterize currently. its nice its there but this isn't related to native builds.", "author": "maxandersen", "createdAt": "2020-08-10T12:00:32Z", "path": "devtools/platform-descriptor-json/src/main/resources/bundled-codestarts/tooling/dockerfiles/base/src/main/docker/Dockerfile.tpl.qute.fast-jar", "diffHunk": "@@ -21,10 +21,10 @@\n # docker run -i --rm -p 8080:8080 -p 5005:5005 -e JAVA_ENABLE_DEBUG=\"true\" quarkus/{project.artifact-id}-jvm\n #\n ###\n-FROM registry.access.redhat.com/ubi8/ubi-minimal:8.1\n+FROM {dockerfile.fast-jar.from}", "originalCommit": "f7418a8c8f8d7b2c40b991cd6e092afc1b85f130", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Nzg2MDYzMg==", "url": "https://github.com/quarkusio/quarkus/pull/11296#discussion_r467860632", "bodyText": "ah ok, well :)", "author": "ia3andy", "createdAt": "2020-08-10T12:11:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Nzg1NTQ1Ng=="}], "type": "inlineReview"}, {"oid": "f5678625462361bc657520a3979f6fb982a30afa", "url": "https://github.com/quarkusio/quarkus/commit/f5678625462361bc657520a3979f6fb982a30afa", "message": "Use metadata for gradle/maven repositories and separate gradle plugin version\n\nAs part of #11256", "committedDate": "2020-08-17T16:02:06Z", "type": "forcePushed"}, {"oid": "ecec6263776d6a192bee5235e4e49022c58ac062", "url": "https://github.com/quarkusio/quarkus/commit/ecec6263776d6a192bee5235e4e49022c58ac062", "message": "Use metadata for gradle/maven repositories and separate gradle plugin version\n\nAs part of #11256", "committedDate": "2020-08-17T16:25:40Z", "type": "forcePushed"}, {"oid": "7f96623b8463a46e8f3df609272dca1cd2184141", "url": "https://github.com/quarkusio/quarkus/commit/7f96623b8463a46e8f3df609272dca1cd2184141", "message": "Use metadata for gradle/maven repositories and separate gradle plugin version\n\nAs part of #11256", "committedDate": "2020-08-18T08:12:23Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjAwNjA5MQ==", "url": "https://github.com/quarkusio/quarkus/pull/11296#discussion_r472006091", "bodyText": "@mgorniew nice hey :)", "author": "ia3andy", "createdAt": "2020-08-18T08:27:10Z", "path": "independent-projects/tools/devtools-common/src/main/java/io/quarkus/devtools/project/BuildTool.java", "diffHunk": "@@ -71,18 +71,20 @@ public ExtensionManager createExtensionManager(final Path projectDirPath,\n         }\n     }\n \n+    public String getKey() {\n+        return toString().toLowerCase().replace(\"_\", \"-\");\n+    }\n+\n     public static BuildTool resolveExistingProject(Path path) {\n         return QuarkusProject.resolveExistingProjectBuildTool(path);\n     }\n \n     public static BuildTool findTool(String tool) {\n-        if (\"GRADLE\".equalsIgnoreCase(tool))\n-            return GRADLE;\n-        else if (\"GRADLE_KOTLIN_DSL\".equalsIgnoreCase(tool) || \"gradle-kotlin-dsl\".equalsIgnoreCase(tool))\n-            return GRADLE_KOTLIN_DSL;\n-        else if (\"MAVEN\".equalsIgnoreCase(tool))\n-            return MAVEN;\n-        else\n-            return null;\n+        for (BuildTool value : BuildTool.values()) {\n+            if (value.toString().equalsIgnoreCase(tool) || value.getKey().equalsIgnoreCase(tool)) {\n+                return value;", "originalCommit": "7f96623b8463a46e8f3df609272dca1cd2184141", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "d5c767147f5240fb3c11de0f1a3ccdffa884c0a4", "url": "https://github.com/quarkusio/quarkus/commit/d5c767147f5240fb3c11de0f1a3ccdffa884c0a4", "message": "Use metadata for gradle/maven repositories and separate gradle plugin version\n\nAs part of #11256", "committedDate": "2020-08-18T08:44:21Z", "type": "forcePushed"}, {"oid": "9f352cc7ae936e30e2332b5e947dfb7f1486714e", "url": "https://github.com/quarkusio/quarkus/commit/9f352cc7ae936e30e2332b5e947dfb7f1486714e", "message": "Use metadata for gradle/maven repositories and separate gradle plugin version\n\nAs part of #11256", "committedDate": "2020-08-18T08:59:54Z", "type": "forcePushed"}, {"oid": "4b067f7073eacc8e04c094f243e26dbaf72216ed", "url": "https://github.com/quarkusio/quarkus/commit/4b067f7073eacc8e04c094f243e26dbaf72216ed", "message": "Use metadata for gradle/maven repositories and separate gradle plugin version\n\nAs part of #11256", "committedDate": "2020-08-18T09:07:51Z", "type": "commit"}, {"oid": "4b067f7073eacc8e04c094f243e26dbaf72216ed", "url": "https://github.com/quarkusio/quarkus/commit/4b067f7073eacc8e04c094f243e26dbaf72216ed", "message": "Use metadata for gradle/maven repositories and separate gradle plugin version\n\nAs part of #11256", "committedDate": "2020-08-18T09:07:51Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjgwNTM0Nw==", "url": "https://github.com/quarkusio/quarkus/pull/11296#discussion_r472805347", "bodyText": "Removing plugin-version will break QuarkusJsonPlatformDescriptorResolver.getBundledPlatformQuarkusVersionOrNull()", "author": "aloubyansky", "createdAt": "2020-08-19T07:30:27Z", "path": "devtools/platform-descriptor-json/src/main/filtered/quarkus.properties", "diffHunk": "@@ -8,10 +8,16 @@ kotlin-version=${kotlin.version}\n scala-version=${scala.version}\n scala-plugin-version=${scala-plugin.version}\n \n-# Plugin metadata\n-plugin-groupId=${project.groupId}\n-plugin-artifactId=quarkus-maven-plugin\n-plugin-version=${project.version}", "originalCommit": "4b067f7073eacc8e04c094f243e26dbaf72216ed", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjgwNTc1OQ==", "url": "https://github.com/quarkusio/quarkus/pull/11296#discussion_r472805759", "bodyText": "Is this targeting 1.8.x?", "author": "aloubyansky", "createdAt": "2020-08-19T07:30:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjgwNTM0Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjgxODI0NQ==", "url": "https://github.com/quarkusio/quarkus/pull/11296#discussion_r472818245", "bodyText": "yes it is targeting 1.8.x (should be alright right?). This is why I made a different PR for 1.7.x #11439", "author": "ia3andy", "createdAt": "2020-08-19T07:44:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjgwNTM0Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjkxNDUzMA==", "url": "https://github.com/quarkusio/quarkus/pull/11296#discussion_r472914530", "bodyText": "wait - why are we talking about removing plugin-version ?", "author": "maxandersen", "createdAt": "2020-08-19T10:06:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjgwNTM0Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjkyNjgyNQ==", "url": "https://github.com/quarkusio/quarkus/pull/11296#discussion_r472926825", "bodyText": "Yes, there was too much confusion in the code with it (it was used as quarkus-core-version), it is now split in 3:\nquarkus-core-version=${project.version}\n...\nmaven-plugin-version=${project.version}\n...\ngradle-plugin-version=${project.version}", "author": "ia3andy", "createdAt": "2020-08-19T10:28:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjgwNTM0Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjgwODM5MA==", "url": "https://github.com/quarkusio/quarkus/pull/11296#discussion_r472808390", "bodyText": "Could you add more comments explaining what's being done here?", "author": "aloubyansky", "createdAt": "2020-08-19T07:34:04Z", "path": "independent-projects/tools/devtools-common/src/main/java/io/quarkus/devtools/commands/handlers/CreateProjectCommandHandler.java", "diffHunk": "@@ -135,4 +148,91 @@ public QuarkusCommandOutcome execute(QuarkusCommandInvocation invocation) throws\n         }\n         return QuarkusCommandOutcome.success();\n     }\n+\n+    // # CLOSE YOUR EYES PLEASE", "originalCommit": "4b067f7073eacc8e04c094f243e26dbaf72216ed", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjgxNzAxOQ==", "url": "https://github.com/quarkusio/quarkus/pull/11296#discussion_r472817019", "bodyText": "You were supposed to close your eyes :-)\n@aloubyansky I would prefer to avoid new commits if possible as CI passed, this is supposed to be deleted very soon, it's just using @gastaldi new metadata for the legacy codegen in a quick and dirty way.", "author": "ia3andy", "createdAt": "2020-08-19T07:43:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjgwODM5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjkyNTQ0Mw==", "url": "https://github.com/quarkusio/quarkus/pull/11296#discussion_r472925443", "bodyText": "this looks fine to me - whats the quick and dirty part ? that it only honors the first repo?", "author": "maxandersen", "createdAt": "2020-08-19T10:25:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjgwODM5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjkzMDkyNQ==", "url": "https://github.com/quarkusio/quarkus/pull/11296#discussion_r472930925", "bodyText": "Well it's plain xml content in java, I personally find it ugly.", "author": "ia3andy", "createdAt": "2020-08-19T10:35:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjgwODM5MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjkxNzUzNQ==", "url": "https://github.com/quarkusio/quarkus/pull/11296#discussion_r472917535", "bodyText": "shouldn't this be group-id to be consistent ?", "author": "maxandersen", "createdAt": "2020-08-19T10:11:48Z", "path": "devtools/platform-descriptor-json/src/main/resources/bundled-codestarts/buildtool/gradle-kotlin-dsl/codestart.yml", "diffHunk": "@@ -7,7 +7,7 @@ language:\n   base:\n     data:\n       quarkus:\n-        plugin:\n+        gradle-plugin:\n           id: io.quarkus", "originalCommit": "4b067f7073eacc8e04c094f243e26dbaf72216ed", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjkxNzkxNg==", "url": "https://github.com/quarkusio/quarkus/pull/11296#discussion_r472917916", "bodyText": "ah this is actually a gradle plugin id ;) not maven artifact. never mind then.", "author": "maxandersen", "createdAt": "2020-08-19T10:12:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjkxNzUzNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjkxODc1NQ==", "url": "https://github.com/quarkusio/quarkus/pull/11296#discussion_r472918755", "bodyText": "is this just to handle we can point to community version when productized versoin not available ?", "author": "maxandersen", "createdAt": "2020-08-19T10:14:10Z", "path": "devtools/platform-descriptor-json/src/main/resources/bundled-codestarts/buildtool/gradle/base/gradle.tpl.qute.properties", "diffHunk": "@@ -1,6 +1,6 @@\n #Gradle properties\n-#Tue Jun 16 08:41:21 UTC 2020\n-quarkusPluginVersion={quarkus.plugin.version}\n+quarkusPluginId={quarkus.gradle-plugin.id}\n+quarkusPluginVersion={quarkus.gradle-plugin.version}", "originalCommit": "4b067f7073eacc8e04c094f243e26dbaf72216ed", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjkyNTgwMw==", "url": "https://github.com/quarkusio/quarkus/pull/11296#discussion_r472925803", "bodyText": "yes! but also because it's makes sense to have it independent from the maven one..", "author": "ia3andy", "createdAt": "2020-08-19T10:26:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjkxODc1NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjk3NTM5NA==", "url": "https://github.com/quarkusio/quarkus/pull/11296#discussion_r472975394", "bodyText": "@maxandersen test ping comment", "author": "ia3andy", "createdAt": "2020-08-19T12:00:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjkxODc1NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjkyMTkwMQ==", "url": "https://github.com/quarkusio/quarkus/pull/11296#discussion_r472921901", "bodyText": "what is that flag actually used for ?", "author": "maxandersen", "createdAt": "2020-08-19T10:19:48Z", "path": "devtools/platform-descriptor-json/src/main/resources/bundled-codestarts/tooling/dockerfiles/codestart.yml", "diffHunk": "@@ -2,3 +2,17 @@\n name: dockerfiles\n type: tooling\n preselected: true\n+language:\n+  base:\n+    data:\n+      dockerfile:\n+        jvm:\n+          from: registry.access.redhat.com/ubi8/ubi-minimal:8.1\n+          java-package: java-11-openjdk-headless\n+          run-java-version: 1.3.8", "originalCommit": "4b067f7073eacc8e04c094f243e26dbaf72216ed", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjkyNTMzNA==", "url": "https://github.com/quarkusio/quarkus/pull/11296#discussion_r472925334", "bodyText": "This is not \"used\", just we have it all in one location", "author": "ia3andy", "createdAt": "2020-08-19T10:25:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjkyMTkwMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjkyMjE2Mg==", "url": "https://github.com/quarkusio/quarkus/pull/11296#discussion_r472922162", "bodyText": "shouldn't this be tied to what version of java user targeted ?", "author": "maxandersen", "createdAt": "2020-08-19T10:20:14Z", "path": "devtools/platform-descriptor-json/src/main/resources/bundled-codestarts/tooling/dockerfiles/codestart.yml", "diffHunk": "@@ -2,3 +2,17 @@\n name: dockerfiles\n type: tooling\n preselected: true\n+language:\n+  base:\n+    data:\n+      dockerfile:\n+        jvm:\n+          from: registry.access.redhat.com/ubi8/ubi-minimal:8.1\n+          java-package: java-11-openjdk-headless", "originalCommit": "4b067f7073eacc8e04c094f243e26dbaf72216ed", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjkyNTEyOQ==", "url": "https://github.com/quarkusio/quarkus/pull/11296#discussion_r472925129", "bodyText": "I have no idea, this is taken from the legacy codegen.", "author": "ia3andy", "createdAt": "2020-08-19T10:25:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjkyMjE2Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjk3ODIwMg==", "url": "https://github.com/quarkusio/quarkus/pull/11296#discussion_r472978202", "bodyText": "okey, separate issue then.", "author": "maxandersen", "createdAt": "2020-08-19T12:06:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjkyMjE2Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjkyNzgwNg==", "url": "https://github.com/quarkusio/quarkus/pull/11296#discussion_r472927806", "bodyText": "hmm - isn't there cases where plugin-version is the only thing availalbe as a fallback?", "author": "maxandersen", "createdAt": "2020-08-19T10:30:09Z", "path": "independent-projects/tools/platform-descriptor-resolver-json/src/main/java/io/quarkus/platform/descriptor/resolver/json/QuarkusJsonPlatformDescriptorResolver.java", "diffHunk": "@@ -711,12 +711,7 @@ private static String getBundledPlatformQuarkusVersionOrNull() {\n         } catch (IOException e) {\n             throw new IllegalStateException(\"Failed to load quarkus.properties from the classpath\", e);\n         }\n-        final String quarkusVersion = props.getProperty(\"plugin-version\");", "originalCommit": "4b067f7073eacc8e04c094f243e26dbaf72216ed", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjkzMjk1NQ==", "url": "https://github.com/quarkusio/quarkus/pull/11296#discussion_r472932955", "bodyText": "It would only fail with an older version of the platform I believe. But we don't have to do backward compat on new major, right @aloubyansky?\nIMHO it's better to be not compatible here, than failing somewhere else because we missed something.", "author": "ia3andy", "createdAt": "2020-08-19T10:39:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjkyNzgwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjk3NzgxOA==", "url": "https://github.com/quarkusio/quarkus/pull/11296#discussion_r472977818", "bodyText": "you aren't guaranteed to have a platform - even in newer versions.", "author": "maxandersen", "createdAt": "2020-08-19T12:05:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjkyNzgwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjk4MTkwMQ==", "url": "https://github.com/quarkusio/quarkus/pull/11296#discussion_r472981901", "bodyText": "misspoke - or rather, users can make a pom that has no platform ref; but that is not reelvant for here as this is during fully controlled codegenaration.", "author": "maxandersen", "createdAt": "2020-08-19T12:13:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjkyNzgwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjk4MjE3NA==", "url": "https://github.com/quarkusio/quarkus/pull/11296#discussion_r472982174", "bodyText": "It seems you are mixing with something else right?", "author": "ia3andy", "createdAt": "2020-08-19T12:14:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjkyNzgwNg=="}], "type": "inlineReview"}]}