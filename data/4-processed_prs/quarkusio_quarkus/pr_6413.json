{"pr_number": 6413, "pr_title": "Fix Kubernetes manifest port handling", "pr_createdAt": "2020-01-06T10:05:56Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/6413", "timeline": [{"oid": "ac2c3f689a76040bf3d9679a85911dcbc75fd51c", "url": "https://github.com/quarkusio/quarkus/commit/ac2c3f689a76040bf3d9679a85911dcbc75fd51c", "message": "Fix Kubernetes manifest port handling\n\nThis is needed because of the config changes that went in 1.1.\nOne thing that needed to be removed because of those changes was\nthe warning we used to produce about potential mismatch between\nthe port in the Kubernetes manifests and the port set at runtime\n\nFixes: #6408", "committedDate": "2020-01-06T10:05:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzM2Njc2MA==", "url": "https://github.com/quarkusio/quarkus/pull/6413#discussion_r363366760", "bodyText": "This is really wrong; it's a run time configuration property.  I think we need to revisit this.", "author": "dmlloyd", "createdAt": "2020-01-06T16:21:13Z", "path": "extensions/vertx-http/deployment/src/main/java/io/quarkus/vertx/http/deployment/VertxHttpProcessor.java", "diffHunk": "@@ -76,11 +75,9 @@ void filterMultipleVertxInstancesWarning(LaunchModeBuildItem launchModeBuildItem\n     }\n \n     @BuildStep(onlyIf = IsNormal.class)\n-    @Record(value = ExecutionTime.RUNTIME_INIT, optional = true)\n-    public KubernetesPortBuildItem kubernetes(HttpConfiguration config, VertxHttpRecorder recorder) {\n-        int port = ConfigProvider.getConfig().getValue(\"quarkus.http.port\", OptionalInt.class).orElse(8080);\n-        recorder.warnIfPortChanged(config, port);\n-        return new KubernetesPortBuildItem(config.port, \"http\");\n+    public KubernetesPortBuildItem kubernetes() {\n+        int port = ConfigProvider.getConfig().getOptionalValue(\"quarkus.http.port\", Integer.class).orElse(8080);", "originalCommit": "ac2c3f689a76040bf3d9679a85911dcbc75fd51c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzM3MjM0NA==", "url": "https://github.com/quarkusio/quarkus/pull/6413#discussion_r363372344", "bodyText": "I'll think of a better solution for 1.2. Unfortunately without this change, Kubernetes manifest generation for 1.1 was sort of broken", "author": "geoand", "createdAt": "2020-01-06T16:32:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzM2Njc2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzM3NzA1NQ==", "url": "https://github.com/quarkusio/quarkus/pull/6413#discussion_r363377055", "bodyText": "@dmlloyd yeah, we agreed with @geoand that there was something fishy. This is just a quick fix for 1.1.1. We need to discuss how we can solve this properly.", "author": "gsmet", "createdAt": "2020-01-06T16:42:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzM2Njc2MA=="}], "type": "inlineReview"}]}