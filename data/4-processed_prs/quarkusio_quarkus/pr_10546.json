{"pr_number": 10546, "pr_title": "Hot reload logging fixes", "pr_createdAt": "2020-07-08T02:37:43Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/10546", "timeline": [{"oid": "a30ab3fb2cafba18c76cab2e6a104e4f5d95db85", "url": "https://github.com/quarkusio/quarkus/commit/a30ab3fb2cafba18c76cab2e6a104e4f5d95db85", "message": "Hot reload logging fixes\n\nFixes various logging problems on failed starts, including:\n- Vert.x error about undeploying verticles before vert.x was initialized\n- No logging if restart fails until issue is fixed\n- Startup failure reason being logged twice\n\nFixes #6209", "committedDate": "2020-07-08T02:35:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTMwNzM0OQ==", "url": "https://github.com/quarkusio/quarkus/pull/10546#discussion_r451307349", "bodyText": "So the only difference compared to the injected observer param is that the Vertx instance is only obtained if there is at least one bean that extends AbstractVerticle?", "author": "mkouba", "createdAt": "2020-07-08T06:17:48Z", "path": "extensions/vertx/runtime/src/main/java/io/quarkus/vertx/runtime/VertxProducer.java", "diffHunk": "@@ -115,6 +110,8 @@ void undeployVerticles(@Observes @BeforeDestroyed(ApplicationScoped.class) Objec\n                     // Only existing instances are considered\n                     try {\n                         AbstractVerticle verticle = (AbstractVerticle) instance;\n+                        io.vertx.mutiny.core.Vertx mutiny = beanManager.createInstance()", "originalCommit": "a30ab3fb2cafba18c76cab2e6a104e4f5d95db85", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTMwODk5Mg==", "url": "https://github.com/quarkusio/quarkus/pull/10546#discussion_r451308992", "bodyText": "One already created bean, which generally won't happen until runtime when you actually have vert.x.\nCurrently if you fail in static init then this method is called, but vert.x is not ready yet (as it is a runtime bean), so you get an extra unrelated exception in your logs (and possible unclean shutdown).", "author": "stuartwdouglas", "createdAt": "2020-07-08T06:22:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTMwNzM0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTMxMTUwNQ==", "url": "https://github.com/quarkusio/quarkus/pull/10546#discussion_r451311505", "bodyText": "I see. That makes sense.", "author": "mkouba", "createdAt": "2020-07-08T06:29:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTMwNzM0OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTMwNzkxNg==", "url": "https://github.com/quarkusio/quarkus/pull/10546#discussion_r451307916", "bodyText": "So what happens if a user code injects Vertx?", "author": "mkouba", "createdAt": "2020-07-08T06:19:27Z", "path": "extensions/vertx/runtime/src/main/java/io/quarkus/vertx/runtime/VertxProducer.java", "diffHunk": "@@ -34,25 +33,22 @@\n \n     private static final Logger LOGGER = Logger.getLogger(VertxProducer.class);\n \n-    @Inject\n-    Vertx vertx;\n-\n     @Singleton\n     @Produces\n-    public EventBus eventbus() {\n+    public EventBus eventbus(Vertx vertx) {", "originalCommit": "a30ab3fb2cafba18c76cab2e6a104e4f5d95db85", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTMwOTE4MQ==", "url": "https://github.com/quarkusio/quarkus/pull/10546#discussion_r451309181", "bodyText": "It's undeployVerticles that is the problem, if it was in a different class these would be fine.", "author": "stuartwdouglas", "createdAt": "2020-07-08T06:23:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTMwNzkxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTMxMTUzNg==", "url": "https://github.com/quarkusio/quarkus/pull/10546#discussion_r451311536", "bodyText": "OK.", "author": "mkouba", "createdAt": "2020-07-08T06:29:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTMwNzkxNg=="}], "type": "inlineReview"}]}