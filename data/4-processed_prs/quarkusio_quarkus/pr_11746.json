{"pr_number": 11746, "pr_title": "RUNTIME_INIT synthetic beans - improve docs and error message", "pr_createdAt": "2020-08-31T11:22:07Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/11746", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDA2NjgyMw==", "url": "https://github.com/quarkusio/quarkus/pull/11746#discussion_r480066823", "bodyText": "Can we have an example, or a link to some code to make this more tangible?", "author": "geoand", "createdAt": "2020-08-31T11:24:20Z", "path": "docs/src/main/asciidoc/cdi-reference.adoc", "diffHunk": "@@ -814,14 +814,34 @@ The extended `BeanConfigurator` accepts either a `io.quarkus.runtime.RuntimeValu\n [source,java]\n ----\n @BuildStep\n-@Record(STATIC_INIT)\n+@Record(STATIC_INIT) <1>\n SyntheticBeanBuildItem syntheticBean(TestRecorder recorder) {\n    return SyntheticBeanBuildItem.configure(Foo.class).scope(Singleton.class)\n+                .runtimeValue(recorder.createFoo()) <2>\n+                .done();\n+}\n+----\n+<1> By default, a synthetic bean is initialized during `STATIC_INIT`.\n+<2> The bean instance is supplied by a value returned from a recorder method.\n+\n+It is possible to mark a synthetic bean to be initialized during `RUNTIME_INIT`:\n+\n+.`RUNTIME_INIT` `SyntheticBeanBuildItem` Example\n+[source,java]\n+----\n+@BuildStep\n+@Record(RUNTIME_INIT) <1>\n+SyntheticBeanBuildItem syntheticBean(TestRecorder recorder) {\n+   return SyntheticBeanBuildItem.configure(Foo.class).scope(Singleton.class)\n+                .setRuntimeInit() <2>\n                 .runtimeValue(recorder.createFoo())\n                 .done();\n }\n ----\n+<1> The recorder must be executed in the `ExecutionTime.RUNTIME_INIT` phase.\n+<2> The bean instance is initialized during `RUNTIME_INIT`.\n \n+IMPORTANT: Synthetic bean initialized during `RUNTIME_INIT` must not be accessed during `STATIC_INIT`. `RUNTIME_INIT` build steps that access a runtime-init synthetic bean should consume the `SyntheticBeansRuntimeInitBuildItem`.", "originalCommit": "0da220e695181b90659eac1475a9df4e80a3f349", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDA2OTEwOA==", "url": "https://github.com/quarkusio/quarkus/pull/11746#discussion_r480069108", "bodyText": "Hm, I don't think we use it anywhere ATM. I will add an example...", "author": "mkouba", "createdAt": "2020-08-31T11:29:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDA2NjgyMw=="}], "type": "inlineReview"}, {"oid": "cae349472f7f29b0fa4c6e65af0af3281ad68044", "url": "https://github.com/quarkusio/quarkus/commit/cae349472f7f29b0fa4c6e65af0af3281ad68044", "message": "RUNTIME_INIT synthetic beans - improve docs and error message\n\n- is related to #11337", "committedDate": "2020-08-31T11:58:26Z", "type": "commit"}, {"oid": "cae349472f7f29b0fa4c6e65af0af3281ad68044", "url": "https://github.com/quarkusio/quarkus/commit/cae349472f7f29b0fa4c6e65af0af3281ad68044", "message": "RUNTIME_INIT synthetic beans - improve docs and error message\n\n- is related to #11337", "committedDate": "2020-08-31T11:58:26Z", "type": "forcePushed"}]}