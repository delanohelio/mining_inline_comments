{"pr_number": 7143, "pr_title": "Undertow: unused servlet initParams code, adds tests", "pr_createdAt": "2020-02-11T14:55:55Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/7143", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzc0NTE5NA==", "url": "https://github.com/quarkusio/quarkus/pull/7143#discussion_r377745194", "bodyText": "Actually I think it should be:\nif (servlet.getInitParam() != null) {\n   for (ParamValueMetaData pvm : servlet.getInitParam()) {\n      params.put(pvm.getParamName(), pvm.getParamValue());\n   }\n}\nAnd the for loop below can be removed completely", "author": "gastaldi", "createdAt": "2020-02-11T16:23:59Z", "path": "extensions/undertow/deployment/src/main/java/io/quarkus/undertow/deployment/UndertowBuildStep.java", "diffHunk": "@@ -329,16 +328,12 @@ public ServletDeploymentManagerBuildItem build(List<ServletBuildItem> servlets,\n         if (webMetaData.getServlets() != null) {\n             for (ServletMetaData servlet : webMetaData.getServlets()) {\n                 reflectiveClasses.accept(new ReflectiveClassBuildItem(false, false, servlet.getServletClass()));\n-                Map<String, String> params = new HashMap<>();\n-                for (Map.Entry<String, String> i : params.entrySet()) {", "originalCommit": "68e77eb275934ac73fb99fed2890405a3b8f744e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzc4NTA3NQ==", "url": "https://github.com/quarkusio/quarkus/pull/7143#discussion_r377785075", "bodyText": "@gastaldi The thing is I tried exactly that without any impact :)\nThat is why I went ahead with the test, to reach out to that part of code.\nDo you happen to have any hint on the test case?\nNo point in having here something that actually doesn't get used.\nI'll check it again though...", "author": "Karm", "createdAt": "2020-02-11T17:27:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzc0NTE5NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzc5NTIwMg==", "url": "https://github.com/quarkusio/quarkus/pull/7143#discussion_r377795202", "bodyText": "Do you happen to have any hint on the test case?\n\nI think your test case looks correct. You mean that the init parameters are not set in the ServletMetaData object?", "author": "gastaldi", "createdAt": "2020-02-11T17:46:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzc0NTE5NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzg4OTgwNA==", "url": "https://github.com/quarkusio/quarkus/pull/7143#discussion_r377889804", "bodyText": "This parameter should just be deleted. The init params are added in the next line with a seperate call to the recorder.", "author": "stuartwdouglas", "createdAt": "2020-02-11T20:49:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzc0NTE5NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzc0NTczMA==", "url": "https://github.com/quarkusio/quarkus/pull/7143#discussion_r377745730", "bodyText": "This should be:\nif (filter.getInitParam() != null) {\n   for (ParamValueMetaData pvm : filter.getInitParam()) {\n      params.put(pvm.getParamName(), pvm.getParamValue());\n   }\n}\nAnd the for loop below can be removed", "author": "gastaldi", "createdAt": "2020-02-11T16:24:48Z", "path": "extensions/undertow/deployment/src/main/java/io/quarkus/undertow/deployment/UndertowBuildStep.java", "diffHunk": "@@ -402,16 +397,13 @@ public ServletDeploymentManagerBuildItem build(List<ServletBuildItem> servlets,\n         if (webMetaData.getFilters() != null) {\n             for (FilterMetaData filter : webMetaData.getFilters()) {\n                 reflectiveClasses.accept(new ReflectiveClassBuildItem(false, false, filter.getFilterClass()));\n-                Map<String, String> params = new HashMap<>();", "originalCommit": "68e77eb275934ac73fb99fed2890405a3b8f744e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "af0251cfff43b386814f5a44285dd515810996a8", "url": "https://github.com/quarkusio/quarkus/commit/af0251cfff43b386814f5a44285dd515810996a8", "message": "Undertow: unused servlet initParams code, adds tests\n\nTwo occurences of\n\n```\n- Map<String, String> params = new HashMap<>();\n- for (Map.Entry<String, String> i : params.entrySet()) {\n-     params.put(i.getKey(), i.getValue());\n- }\n```\n\nare removed from UndertowBuildStep.\n\nNew tests covering init params and descriptions for Servlet and Filter were added, both for xml and annotation.", "committedDate": "2020-02-12T11:10:19Z", "type": "commit"}, {"oid": "af0251cfff43b386814f5a44285dd515810996a8", "url": "https://github.com/quarkusio/quarkus/commit/af0251cfff43b386814f5a44285dd515810996a8", "message": "Undertow: unused servlet initParams code, adds tests\n\nTwo occurences of\n\n```\n- Map<String, String> params = new HashMap<>();\n- for (Map.Entry<String, String> i : params.entrySet()) {\n-     params.put(i.getKey(), i.getValue());\n- }\n```\n\nare removed from UndertowBuildStep.\n\nNew tests covering init params and descriptions for Servlet and Filter were added, both for xml and annotation.", "committedDate": "2020-02-12T11:10:19Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODE4OTI0MQ==", "url": "https://github.com/quarkusio/quarkus/pull/7143#discussion_r378189241", "bodyText": "I am not sure it's a good idea to change the API here. Other extensions (external to core - camel?) may be using it", "author": "gastaldi", "createdAt": "2020-02-12T11:19:03Z", "path": "extensions/undertow/runtime/src/main/java/io/quarkus/undertow/runtime/UndertowDeploymentRecorder.java", "diffHunk": "@@ -221,16 +220,13 @@ public static SocketAddress getHttpAddress() {\n             Class<?> servletClass,\n             boolean asyncSupported,\n             int loadOnStartup,\n-            BeanContainer beanContainer, Map<String, String> initParams,\n+            BeanContainer beanContainer,", "originalCommit": "af0251cfff43b386814f5a44285dd515810996a8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODIyODM4NQ==", "url": "https://github.com/quarkusio/quarkus/pull/7143#discussion_r378228385", "bodyText": "@gastaldi Hmm, such external extension would have to be fiddling with how Servlet is built in Quarkus and use Undertow extension for that...\nIf you have any suggestion what area such extension might appear in, I will try to find it and run its tests...", "author": "Karm", "createdAt": "2020-02-12T12:46:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODE4OTI0MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODIyOTUwOA==", "url": "https://github.com/quarkusio/quarkus/pull/7143#discussion_r378229508", "bodyText": "Check if camel-quarkus is using it, otherwise it may be good to go then", "author": "gastaldi", "createdAt": "2020-02-12T12:48:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODE4OTI0MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODI3NTc1OQ==", "url": "https://github.com/quarkusio/quarkus/pull/7143#discussion_r378275759", "bodyText": "@gastaldi I run quarkus-camel tests, excluding Mongo (does not build with Quarkus master, talked to @ppalaga ) and JMS (local network shenanigans), and it looks unaffected, e.g. org.apache.camel.quarkus.component.servlet.CamelServletTest is \u2714\ufe0f  etc.\n\nbasic search for usage of said API did not show anything...\n\nIMHO safe to go.", "author": "Karm", "createdAt": "2020-02-12T14:14:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODE4OTI0MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODE4OTYxNg==", "url": "https://github.com/quarkusio/quarkus/pull/7143#discussion_r378189616", "bodyText": "Where are these init params used?", "author": "gastaldi", "createdAt": "2020-02-12T11:19:52Z", "path": "extensions/undertow/deployment/src/main/java/io/quarkus/undertow/deployment/UndertowBuildStep.java", "diffHunk": "@@ -499,7 +488,7 @@ public ServletDeploymentManagerBuildItem build(List<ServletBuildItem> servlets,\n             String filterClass = filter.getFilterClass();\n             reflectiveClasses.accept(new ReflectiveClassBuildItem(false, false, filterClass));\n             recorder.registerFilter(deployment, filter.getName(), context.classProxy(filterClass), filter.isAsyncSupported(),\n-                    bc.getValue(), filter.getInitParams(), filter.getInstanceFactory());\n+                    bc.getValue(), filter.getInstanceFactory());", "originalCommit": "af0251cfff43b386814f5a44285dd515810996a8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODIyNjcxNA==", "url": "https://github.com/quarkusio/quarkus/pull/7143#discussion_r378226714", "bodyText": "@gastaldi\nWell, they were redundantly used in in io.quarkus.undertow.runtime.UndertowDeploymentRecorder#registerFilter.\nThe real place where initParams are set for filters is this: UndertowBuildStep.java#L406.", "author": "Karm", "createdAt": "2020-02-12T12:42:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODE4OTYxNg=="}], "type": "inlineReview"}]}