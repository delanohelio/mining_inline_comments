{"pr_number": 9091, "pr_title": "Optimize Dockerfile.native for smaller docker-image size", "pr_createdAt": "2020-05-05T15:33:54Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/9091", "timeline": [{"oid": "d2f2bc265419032b5b46646bdb041a288fd1948f", "url": "https://github.com/quarkusio/quarkus/commit/d2f2bc265419032b5b46646bdb041a288fd1948f", "message": "optimize dockerfile for smaller docker-image", "committedDate": "2020-05-05T15:06:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDIwNzQwMg==", "url": "https://github.com/quarkusio/quarkus/pull/9091#discussion_r420207402", "bodyText": "just a quick comment: we lost the chmod in passing. It's not a problem?\n/cc @cescoffier", "author": "gsmet", "createdAt": "2020-05-05T15:39:43Z", "path": "devtools/platform-descriptor-json/src/main/resources/templates/dockerfile-native.ftl", "diffHunk": "@@ -16,13 +16,7 @@\n ###\n FROM registry.access.redhat.com/ubi8/ubi-minimal:8.1\n WORKDIR /work/\n-COPY ${build_dir}/*-runner /work/application\n-\n-# set up permissions for user `1001`\n-RUN chmod 775 /work /work/application \\\n-  && chown -R 1001 /work \\\n-  && chmod -R \"g+rwX\" /work \\\n-  && chown -R 1001:root /work\n+COPY --chown=1001:root ${build_dir}/*-runner /work/application", "originalCommit": "d2f2bc265419032b5b46646bdb041a288fd1948f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDIwOTY5MQ==", "url": "https://github.com/quarkusio/quarkus/pull/9091#discussion_r420209691", "bodyText": "@gsmet I see, but not a problem in my tests.", "author": "haraldatbmw", "createdAt": "2020-05-05T15:42:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDIwNzQwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDIxMjQ1MA==", "url": "https://github.com/quarkusio/quarkus/pull/9091#discussion_r420212450", "bodyText": "@gsmet Don't know if podman or other docker versions have problems.\nAlso my Windows docker deamon does it correct.\n\nSECURITY WARNING: You are building a Docker image from Windows against a non-Windows Docker host. All files and directories added to build context will have '-rwxr-xr-x' permissions. It is recommended to double check and reset permissions for sensitive files and directories.", "author": "haraldatbmw", "createdAt": "2020-05-05T15:46:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDIwNzQwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDIxMzEyNQ==", "url": "https://github.com/quarkusio/quarkus/pull/9091#discussion_r420213125", "bodyText": "Well, you're the one who insisted on it :)\n#6461", "author": "gsmet", "createdAt": "2020-05-05T15:47:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDIwNzQwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDIxNTA3OQ==", "url": "https://github.com/quarkusio/quarkus/pull/9091#discussion_r420215079", "bodyText": "Yes, seams my newer docker daemon fixed this already.", "author": "haraldatbmw", "createdAt": "2020-05-05T15:50:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDIwNzQwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDM1OTk2MQ==", "url": "https://github.com/quarkusio/quarkus/pull/9091#discussion_r420359961", "bodyText": "@cescoffier IIRC you added these commands, mind taking a look?", "author": "geoand", "createdAt": "2020-05-05T19:40:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDIwNzQwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDU2MzgxMQ==", "url": "https://github.com/quarkusio/quarkus/pull/9091#discussion_r420563811", "bodyText": "These commands were the recommendation made by Ope3nshift and Podman.\nThe change looks good but it needs to be tested carefully.", "author": "cescoffier", "createdAt": "2020-05-06T06:09:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDIwNzQwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDY2MTA4Mg==", "url": "https://github.com/quarkusio/quarkus/pull/9091#discussion_r420661082", "bodyText": "Do you have automated tests for deployment into Openshift and with Podman?", "author": "haraldatbmw", "createdAt": "2020-05-06T09:34:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDIwNzQwMg=="}], "type": "inlineReview"}]}