{"pr_number": 12170, "pr_title": "Fix maven wrapper not working in codestarts", "pr_createdAt": "2020-09-17T14:58:45Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/12170", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDMzMzY3NQ==", "url": "https://github.com/quarkusio/quarkus/pull/12170#discussion_r490333675", "bodyText": "Where is this expression resolved?", "author": "aloubyansky", "createdAt": "2020-09-17T15:15:03Z", "path": "devtools/platform-descriptor-json/src/main/resources/codestarts/quarkus/core/tooling/maven-wrapper/base/.mvn/wrapper/MavenWrapperDownloader.tpl.qute.java", "diffHunk": "@@ -0,0 +1,117 @@\n+/*\n+ * Copyright 2007-present the original author or authors.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+import java.net.*;\n+import java.io.*;\n+import java.nio.channels.*;\n+import java.util.Properties;\n+\n+public class MavenWrapperDownloader {\n+\n+    private static final String WRAPPER_VERSION = \"{maven.wrapper-version}\";\n+    /**\n+     * Default URL to download the maven-wrapper.jar from, if no 'downloadUrl' is provided.\n+     */\n+    private static final String DEFAULT_DOWNLOAD_URL = \"https://repo.maven.apache.org/maven2/io/takari/maven-wrapper/\"\n+        + WRAPPER_VERSION + \"/maven-wrapper-\" + WRAPPER_VERSION + \".jar\";", "originalCommit": "d6867f60aedb7f07b95a18f7a7992d177209a74a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDMzNTY3OQ==", "url": "https://github.com/quarkusio/quarkus/pull/12170#discussion_r490335679", "bodyText": "@aloubyansky this is not my code, but copied from the maven wrapper.", "author": "ia3andy", "createdAt": "2020-09-17T15:17:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDMzMzY3NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDMzNjYyMw==", "url": "https://github.com/quarkusio/quarkus/pull/12170#discussion_r490336623", "bodyText": "https://github.com/takari/maven-wrapper/blob/master/.mvn/wrapper/MavenWrapperDownloader.java", "author": "ia3andy", "createdAt": "2020-09-17T15:19:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDMzMzY3NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDM1NTc2OQ==", "url": "https://github.com/quarkusio/quarkus/pull/12170#discussion_r490355769", "bodyText": "So just to be clear: I think it's a VERY bad idea to have copied the Maven Wrapper in our code. It's going to be a nightmare to maintain.\nNot related to this PR per se though.", "author": "gsmet", "createdAt": "2020-09-17T15:45:44Z", "path": "devtools/platform-descriptor-json/src/main/resources/codestarts/quarkus/core/tooling/maven-wrapper/base/mvnw.tpl.qute", "diffHunk": "@@ -212,9 +212,9 @@ else\n       echo \"Couldn't find .mvn/wrapper/maven-wrapper.jar, downloading it ...\"\n     fi\n     if [ -n \"$MVNW_REPOURL\" ]; then\n-      jarUrl=\"$MVNW_REPOURL/io/takari/maven-wrapper/{maven.version}/maven-wrapper-{maven.version}.jar\"\n+      jarUrl=\"$MVNW_REPOURL/io/takari/maven-wrapper/{maven.wrapper-version}/maven-wrapper-{maven.wrapper-version}.jar\"\n     else\n-      jarUrl=\"https://repo.maven.apache.org/maven2/io/takari/maven-wrapper/{maven.version}/maven-wrapper-{maven.version}.jar\"\n+      jarUrl=\"https://repo.maven.apache.org/maven2/io/takari/maven-wrapper/{maven.wrapper-version}/maven-wrapper-{maven.wrapper-version}.jar\"", "originalCommit": "d6867f60aedb7f07b95a18f7a7992d177209a74a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDM1ODYyMg==", "url": "https://github.com/quarkusio/quarkus/pull/12170#discussion_r490358622", "bodyText": "I agree with @gsmet here. Ideally the Maven Wrapper plugin should be run to produce these artifacts to avoid people from maintaining this snippet", "author": "gastaldi", "createdAt": "2020-09-17T15:49:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDM1NTc2OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDQ1NTYzMA==", "url": "https://github.com/quarkusio/quarkus/pull/12170#discussion_r490455630", "bodyText": "@gastaldi @gsmet if you look closer, you will see that we just provides the scripts (not the actual wrapper) which is downloaded automatically when the user first start the command.\nThe scripts shouldn't change very often (and are not coupled to any version) so it shouldn't be a burden to maintain them.\nRegarding the maven version, we could make it dynamic using the maven version used during the build, I didn't have time to do it and didn't know if it wasn't better to have it coded?", "author": "ia3andy", "createdAt": "2020-09-17T18:03:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDM1NTc2OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDQ4NDAxNA==", "url": "https://github.com/quarkusio/quarkus/pull/12170#discussion_r490484014", "bodyText": "@ia3andy I know, it's the wrapper script I was referring to. Since this is auto-generated from the Tanaki plugin I don't see the point why we need to replicate that behavior.\nJust my 2c ;)", "author": "gastaldi", "createdAt": "2020-09-17T18:55:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDM1NTc2OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDc4MTA4OA==", "url": "https://github.com/quarkusio/quarkus/pull/12170#discussion_r490781088", "bodyText": "@gastaldi feel free to submit a PR that auto-generate those files in the src/main/resources/codestarts/quarkus/core/tooling/maven-wrapper/base/ directory, that would be cool indeed. Just be careful not to avoid generating the jar, and if you do it, you could also remove the data in the codestart.yml as the version will already be in the generated file.", "author": "ia3andy", "createdAt": "2020-09-18T08:18:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDM1NTc2OQ=="}], "type": "inlineReview"}, {"oid": "770178474e3f972606224333168f8d554b38fafd", "url": "https://github.com/quarkusio/quarkus/commit/770178474e3f972606224333168f8d554b38fafd", "message": "Fix maven wrapper not working in codestarts\nmaven-wrapper.properties is necessary to automatically download the jar\nit was working by luck when a parent folder contains a  directory", "committedDate": "2020-09-18T21:36:49Z", "type": "commit"}, {"oid": "770178474e3f972606224333168f8d554b38fafd", "url": "https://github.com/quarkusio/quarkus/commit/770178474e3f972606224333168f8d554b38fafd", "message": "Fix maven wrapper not working in codestarts\nmaven-wrapper.properties is necessary to automatically download the jar\nit was working by luck when a parent folder contains a  directory", "committedDate": "2020-09-18T21:36:49Z", "type": "forcePushed"}]}