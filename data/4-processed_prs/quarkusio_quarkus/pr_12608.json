{"pr_number": 12608, "pr_title": "Add commonTags to micrometer doc", "pr_createdAt": "2020-10-08T18:31:14Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/12608", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTkzOTk2OQ==", "url": "https://github.com/quarkusio/quarkus/pull/12608#discussion_r501939969", "bodyText": "Remove the extra \"the\" before \"this example\"", "author": "kenfinnigan", "createdAt": "2020-10-08T18:48:54Z", "path": "docs/src/main/asciidoc/micrometer.adoc", "diffHunk": "@@ -280,6 +280,42 @@ jvm_memory_committed_bytes{area=\"nonheap\",id=\"CodeHeap 'non-profiled nmethods'\",\n Note that metrics appear lazily, you often won't see any data for your endpoint until\n something tries to access it, etc.\n \n+== Adding custom configuration or common tags\n+\n+Micrometer uses `MeterFilter` instances to customize the metrics emitted by `MeterRegistry` instances.\n+The Micrometer extension will detect `MeterFilter` CDI beans and use them when initializing `MeterRegistry` instances.\n+\n+[source,java]\n+----\n+@Singleton\n+public class CustomConfiguration {\n+\n+    @ConfigProperty(name = \"deployment.env\")\n+    String deploymentEnv;\n+\n+    /** Define common tags that apply only to a Prometheus Registry */\n+    @Produces\n+    @Singleton\n+    @MeterFilterConstraint(applyTo = PrometheusMeterRegistry.class)\n+    public MeterFilter configurePrometheusRegistries() {\n+        return MeterFilter.commonTags(Arrays.asList(\n+                Tag.of(\"registry\", \"prometheus\")));\n+    }\n+\n+    /** Define common tags that apply globally */\n+    @Produces\n+    @Singleton\n+    public MeterFilter configureAllRegistries() {\n+        return MeterFilter.commonTags(Arrays.asList(\n+                Tag.of(\"env\", deploymentEnv)));\n+    }\n+}\n+----\n+\n+In the this example, a singleton CDI bean will produce two different `MeterFilter` beans. One will be applied only to", "originalCommit": "3ef2acb82f688b7ae2b15a2b4264ae0b070a2ba4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTk0Nzg3NQ==", "url": "https://github.com/quarkusio/quarkus/pull/12608#discussion_r501947875", "bodyText": "woops! good catch, thanks!", "author": "ebullient", "createdAt": "2020-10-08T19:02:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTkzOTk2OQ=="}], "type": "inlineReview"}, {"oid": "a89fba7a1c622619b90719d4d097b9b3e3256022", "url": "https://github.com/quarkusio/quarkus/commit/a89fba7a1c622619b90719d4d097b9b3e3256022", "message": "Add commonTags to micrometer doc", "committedDate": "2020-10-08T19:01:58Z", "type": "commit"}, {"oid": "a89fba7a1c622619b90719d4d097b9b3e3256022", "url": "https://github.com/quarkusio/quarkus/commit/a89fba7a1c622619b90719d4d097b9b3e3256022", "message": "Add commonTags to micrometer doc", "committedDate": "2020-10-08T19:01:58Z", "type": "forcePushed"}]}