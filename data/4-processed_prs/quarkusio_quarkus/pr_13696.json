{"pr_number": 13696, "pr_title": "Allow injection of SearchSession/SearchMapping", "pr_createdAt": "2020-12-04T10:23:51Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/13696", "timeline": [{"oid": "ba58b1637f4a6ec925bbecfa5c94a104b70cf8f4", "url": "https://github.com/quarkusio/quarkus/commit/ba58b1637f4a6ec925bbecfa5c94a104b70cf8f4", "message": "Update some warnings about Hibernate Search being in Beta\n\nSigned-off-by: Yoann Rodi\u00e8re <yoann@hibernate.org>", "committedDate": "2020-12-04T10:48:59Z", "type": "forcePushed"}, {"oid": "b7dd16edc6ca4e30ed51fc583118985292882cc1", "url": "https://github.com/quarkusio/quarkus/commit/b7dd16edc6ca4e30ed51fc583118985292882cc1", "message": "Update some warnings about Hibernate Search being in Beta\n\nSigned-off-by: Yoann Rodi\u00e8re <yoann@hibernate.org>", "committedDate": "2020-12-04T14:46:46Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjI3MjU4MA==", "url": "https://github.com/quarkusio/quarkus/pull/13696#discussion_r536272580", "bodyText": "Is this intended?", "author": "gastaldi", "createdAt": "2020-12-04T17:50:26Z", "path": "extensions/hibernate-search-orm-elasticsearch/deployment/pom.xml", "diffHunk": "@@ -52,6 +67,118 @@\n                     </annotationProcessorPaths>\n                 </configuration>\n             </plugin>\n+            <plugin>\n+                <artifactId>maven-surefire-plugin</artifactId>\n+                <configuration>\n+                    <skip>true</skip>", "originalCommit": "b7dd16edc6ca4e30ed51fc583118985292882cc1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjI4NDUzNw==", "url": "https://github.com/quarkusio/quarkus/pull/13696#discussion_r536284537", "bodyText": "Yes, they need Elasticsearch so they are run if -Dtest-containers", "author": "gsmet", "createdAt": "2020-12-04T18:10:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjI3MjU4MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjI4NDI0Mg==", "url": "https://github.com/quarkusio/quarkus/pull/13696#discussion_r536284242", "bodyText": "Don't you expect the configuration to be potentially different depending on the PU?\nDoesn't need to be part of this PR, just asking.", "author": "gsmet", "createdAt": "2020-12-04T18:09:38Z", "path": "extensions/hibernate-search-orm-elasticsearch/deployment/src/test/resources/application.properties", "diffHunk": "@@ -0,0 +1,11 @@\n+quarkus.datasource.db-kind=h2\n+quarkus.datasource.jdbc.url=jdbc:h2:mem:default;DB_CLOSE_DELAY=-1\n+\n+quarkus.hibernate-orm.dialect=org.hibernate.dialect.H2Dialect\n+quarkus.hibernate-orm.database.generation=drop-and-create\n+\n+quarkus.hibernate-search-orm.elasticsearch.version=7\n+quarkus.hibernate-search-orm.elasticsearch.hosts=${elasticsearch.hosts:localhost:9200}\n+quarkus.hibernate-search-orm.elasticsearch.protocol=${elasticsearch.protocol:http}\n+quarkus.hibernate-search-orm.schema-management.strategy=drop-and-create-and-drop\n+quarkus.hibernate-search-orm.automatic-indexing.synchronization.strategy=sync", "originalCommit": "b7dd16edc6ca4e30ed51fc583118985292882cc1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzI4MzcwMg==", "url": "https://github.com/quarkusio/quarkus/pull/13696#discussion_r537283702", "bodyText": "Right now you can make do by defining one backend per PU, but some settings (like this one) will have to be the same on all PUs, which is not great.\nSo yes, we'd need additional changes to fully support multiple PUs. In another PR :)", "author": "yrodiere", "createdAt": "2020-12-07T07:28:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjI4NDI0Mg=="}], "type": "inlineReview"}, {"oid": "b5e6eb60cccfa8acad601662c6f855b37fd2c63e", "url": "https://github.com/quarkusio/quarkus/commit/b5e6eb60cccfa8acad601662c6f855b37fd2c63e", "message": "Do not acquire the per-request Session when unwrapping a Session to its API contracts\n\nThis is important for Hibernate Search in particular.", "committedDate": "2020-12-07T10:40:42Z", "type": "commit"}, {"oid": "c2362019fedec135bc6879e64f7b1d8fdd92420b", "url": "https://github.com/quarkusio/quarkus/commit/c2362019fedec135bc6879e64f7b1d8fdd92420b", "message": "Do not acquire the per-request Session when getting the SessionFactory from a TransactionScopedSession\n\nThis is important for Hibernate Search in particular.\n\nSigned-off-by: Yoann Rodi\u00e8re <yoann@hibernate.org>", "committedDate": "2020-12-07T10:40:42Z", "type": "commit"}, {"oid": "757a73ac2d74dfd9af665a6d9426954214a1f2f0", "url": "https://github.com/quarkusio/quarkus/commit/757a73ac2d74dfd9af665a6d9426954214a1f2f0", "message": "Support injection of SearchMapping/SearchSession\n\nSigned-off-by: Yoann Rodi\u00e8re <yoann@hibernate.org>", "committedDate": "2020-12-07T10:40:43Z", "type": "commit"}, {"oid": "acbebf3eb2fd8ffaded93a79b49773752829679e", "url": "https://github.com/quarkusio/quarkus/commit/acbebf3eb2fd8ffaded93a79b49773752829679e", "message": "Move HSearch configuration tests to their own package\n\nSigned-off-by: Yoann Rodi\u00e8re <yoann@hibernate.org>", "committedDate": "2020-12-07T10:40:43Z", "type": "commit"}, {"oid": "e1574d2a571bb320573579a4852054862842f852", "url": "https://github.com/quarkusio/quarkus/commit/e1574d2a571bb320573579a4852054862842f852", "message": "Add configuration for executing tests in extensions/hibernate-search-orm-elasticsearch/deployment\n\nSigned-off-by: Yoann Rodi\u00e8re <yoann@hibernate.org>", "committedDate": "2020-12-07T10:40:43Z", "type": "commit"}, {"oid": "c641e7e68fafc285ff6cb5f49401843b80531a5a", "url": "https://github.com/quarkusio/quarkus/commit/c641e7e68fafc285ff6cb5f49401843b80531a5a", "message": "Test injection of SearchMapping/SearchSession\n\nSigned-off-by: Yoann Rodi\u00e8re <yoann@hibernate.org>", "committedDate": "2020-12-07T10:40:43Z", "type": "commit"}, {"oid": "c740c27b64bc842b52018be3356552be6474f1f5", "url": "https://github.com/quarkusio/quarkus/commit/c740c27b64bc842b52018be3356552be6474f1f5", "message": "Use SearchSession injection in the quickstart\n\nSigned-off-by: Yoann Rodi\u00e8re <yoann@hibernate.org>", "committedDate": "2020-12-07T10:40:43Z", "type": "commit"}, {"oid": "abf99e75035bdbf430246206a36779323343cbc7", "url": "https://github.com/quarkusio/quarkus/commit/abf99e75035bdbf430246206a36779323343cbc7", "message": "Update some warnings about Hibernate Search being in Beta\n\nSigned-off-by: Yoann Rodi\u00e8re <yoann@hibernate.org>", "committedDate": "2020-12-07T10:40:43Z", "type": "commit"}, {"oid": "abf99e75035bdbf430246206a36779323343cbc7", "url": "https://github.com/quarkusio/quarkus/commit/abf99e75035bdbf430246206a36779323343cbc7", "message": "Update some warnings about Hibernate Search being in Beta\n\nSigned-off-by: Yoann Rodi\u00e8re <yoann@hibernate.org>", "committedDate": "2020-12-07T10:40:43Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzQ3OTMwNw==", "url": "https://github.com/quarkusio/quarkus/pull/13696#discussion_r537479307", "bodyText": "\ud83d\udcaf", "author": "Sanne", "createdAt": "2020-12-07T12:46:58Z", "path": "docs/src/main/asciidoc/hibernate-search-orm-elasticsearch.adoc", "diffHunk": "@@ -14,12 +14,6 @@ We will also explore how you can can query your Elasticsearch cluster using the\n \n include::./status-include.adoc[]\n \n-[WARNING]\n-====\n-This extension is based on a beta version of Hibernate Search.\n-While APIs are quite stable and the code is of production quality and thoroughly tested, some features are still missing, performance might not be optimal and some APIs or configuration properties might change as the extension matures.\n-====\n-", "originalCommit": "abf99e75035bdbf430246206a36779323343cbc7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzQ4MTA5MA==", "url": "https://github.com/quarkusio/quarkus/pull/13696#discussion_r537481090", "bodyText": "Not a blocker, but I'd prefer such a note to be fully expressed with an example.", "author": "Sanne", "createdAt": "2020-12-07T12:49:39Z", "path": "docs/src/main/asciidoc/hibernate-search-orm-elasticsearch.adoc", "diffHunk": "@@ -481,16 +475,26 @@ It is definitely too aggressive for person names but it is perfect for the book\n \n == Adding full text capabilities to our REST service\n \n-In our existing `LibraryResource`, we just need to inject the following methods (and add a few ``import``s):\n+In our existing `LibraryResource`, we just need to inject the `SearchSession`:\n+\n+[source,java]\n+----\n+    @Inject\n+    SearchSession searchSession; // <1>\n+----\n+<1> Inject a Hibernate Search session, which relies on the `EntityManager` under the hood.\n+Applications with multiple persistence units can use a CDI qualifier to select the right one:\n+either `@Named` or `@io.quarkus.hibernate.orm.PersistenceUnit`.", "originalCommit": "abf99e75035bdbf430246206a36779323343cbc7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzQ5NjQ0Nw==", "url": "https://github.com/quarkusio/quarkus/pull/13696#discussion_r537496447", "bodyText": "Ok, I'll add an example in the next PR that adds first-class support for multiple PUs.", "author": "yrodiere", "createdAt": "2020-12-07T13:14:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzQ4MTA5MA=="}], "type": "inlineReview"}]}