{"pr_number": 12142, "pr_title": "Support '*' in CORS configuration", "pr_createdAt": "2020-09-16T16:15:37Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/12142", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDEwMjM3NQ==", "url": "https://github.com/quarkusio/quarkus/pull/12142#discussion_r490102375", "bodyText": "We avoid star imports.", "author": "gsmet", "createdAt": "2020-09-17T09:26:56Z", "path": "extensions/vertx-http/runtime/src/main/java/io/quarkus/vertx/http/runtime/cors/CORSFilter.java", "diffHunk": "@@ -1,11 +1,8 @@\n package io.quarkus.vertx.http.runtime.cors;\n \n-import java.util.ArrayList;\n-import java.util.Collections;\n-import java.util.List;\n-import java.util.Objects;\n-import java.util.Optional;\n+import java.util.*;", "originalCommit": "2b219362c745a049ea2a17943004be4273d9431c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDEwMzA2Nw==", "url": "https://github.com/quarkusio/quarkus/pull/12142#discussion_r490103067", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    return list.isEmpty() || list.size() == 1 && \"*\".equals(list.get(0));\n          \n          \n            \n                    return list.isEmpty() || (list.size() == 1 && \"*\".equals(list.get(0)));\n          \n      \n    \n    \n  \n\nalways better to be explicit.", "author": "gsmet", "createdAt": "2020-09-17T09:28:00Z", "path": "extensions/vertx-http/runtime/src/main/java/io/quarkus/vertx/http/runtime/cors/CORSFilter.java", "diffHunk": "@@ -121,4 +119,13 @@ public void handle(RoutingContext event) {\n             }\n         }\n     }\n-}\n+\n+    private boolean containsOnlyWildcard(Optional<List<String>> optionalList) {\n+        if (!optionalList.isPresent()) {\n+            return true;\n+        }\n+\n+        List<String> list = optionalList.get();\n+        return list.isEmpty() || list.size() == 1 && \"*\".equals(list.get(0));", "originalCommit": "2b219362c745a049ea2a17943004be4273d9431c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDE4ODE4MQ==", "url": "https://github.com/quarkusio/quarkus/pull/12142#discussion_r490188181", "bodyText": "Yeah I think this is important too", "author": "ia3andy", "createdAt": "2020-09-17T12:01:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDEwMzA2Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDEwMzU4OQ==", "url": "https://github.com/quarkusio/quarkus/pull/12142#discussion_r490103589", "bodyText": "Why this change, it doesn't look related to dealing with *?", "author": "gsmet", "createdAt": "2020-09-17T09:28:53Z", "path": "extensions/vertx-http/runtime/src/main/java/io/quarkus/vertx/http/runtime/cors/CORSConfig.java", "diffHunk": "@@ -31,7 +30,7 @@\n      * default: returns any requested method as valid\n      */\n     @ConfigItem\n-    public Optional<List<HttpMethod>> methods;\n+    public Optional<List<String>> methods;", "originalCommit": "2b219362c745a049ea2a17943004be4273d9431c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDEyODg0NQ==", "url": "https://github.com/quarkusio/quarkus/pull/12142#discussion_r490128845", "bodyText": "@gsmet it change was same added possibility  use * for cors methods. Can you promt me how best to do it?", "author": "xumk", "createdAt": "2020-09-17T10:10:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDEwMzU4OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDE4NzYyNQ==", "url": "https://github.com/quarkusio/quarkus/pull/12142#discussion_r490187625", "bodyText": "I think it's because * is not in the HttpMethod Enum", "author": "ia3andy", "createdAt": "2020-09-17T12:00:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDEwMzU4OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTIwMjE2OA==", "url": "https://github.com/quarkusio/quarkus/pull/12142#discussion_r491202168", "bodyText": "Ah OK, totally missed it, sorry.", "author": "gsmet", "createdAt": "2020-09-18T21:38:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDEwMzU4OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDE4OTU3MQ==", "url": "https://github.com/quarkusio/quarkus/pull/12142#discussion_r490189571", "bodyText": "Maybe you can still convert them to HttpMethod Enum to avoid having invalid inputs?", "author": "ia3andy", "createdAt": "2020-09-17T12:04:01Z", "path": "extensions/vertx-http/runtime/src/main/java/io/quarkus/vertx/http/runtime/cors/CORSFilter.java", "diffHunk": "@@ -58,9 +55,10 @@ private void processMethods(HttpServerResponse response, String allowMethodsValu\n             }\n \n             List<String> validRequestedMethods = new ArrayList<>();\n-            for (HttpMethod configMethod : corsConfig.methods.get()) {\n-                if (requestedMethods.contains(configMethod.name().toLowerCase())) {\n-                    validRequestedMethods.add(configMethod.name());\n+            List<String> methods = corsConfig.methods.get().stream().map(String::trim).collect(Collectors.toList());", "originalCommit": "2b219362c745a049ea2a17943004be4273d9431c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDE5MTIxNA==", "url": "https://github.com/quarkusio/quarkus/pull/12142#discussion_r490191214", "bodyText": "do you have a better label than containsOnlyWildcard for this method?\nmaybe something like isConfiguredWithWildcard", "author": "ia3andy", "createdAt": "2020-09-17T12:06:57Z", "path": "extensions/vertx-http/runtime/src/main/java/io/quarkus/vertx/http/runtime/cors/CORSFilter.java", "diffHunk": "@@ -121,4 +119,13 @@ public void handle(RoutingContext event) {\n             }\n         }\n     }\n-}\n+\n+    private boolean containsOnlyWildcard(Optional<List<String>> optionalList) {", "originalCommit": "2b219362c745a049ea2a17943004be4273d9431c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDE5MjM4MA==", "url": "https://github.com/quarkusio/quarkus/pull/12142#discussion_r490192380", "bodyText": "Maybe you could make this static and add a small test making sure it responds correctly?", "author": "ia3andy", "createdAt": "2020-09-17T12:09:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDE5MTIxNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDIxNjcwMg==", "url": "https://github.com/quarkusio/quarkus/pull/12142#discussion_r490216702", "bodyText": "Maybe you could make this static and add a small test making sure it responds correctly?\n\nActually, it is a good one. This should have been tested indirectly in this CORSWildcardSecurityTestCase but now that I've seen this suggestion I've realized CORSWildcardSecurityTestCase needs its application properties updated.\n@xumk please update it to check both wildcard origins and headers", "author": "sberyozkin", "createdAt": "2020-09-17T12:49:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDE5MTIxNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDg2NjM3NQ==", "url": "https://github.com/quarkusio/quarkus/pull/12142#discussion_r490866375", "bodyText": "@xumk I guess you could extend CORSWildcardSecurityTestCase.java and just overrides the config?", "author": "ia3andy", "createdAt": "2020-09-18T10:54:59Z", "path": "extensions/vertx-http/deployment/src/test/java/io/quarkus/vertx/http/cors/CORSWildcardStarSecurityTestCase.java", "diffHunk": "@@ -0,0 +1,153 @@\n+package io.quarkus.vertx.http.cors;\n+\n+import static io.restassured.RestAssured.given;\n+\n+import java.util.function.Supplier;\n+\n+import org.hamcrest.Matchers;\n+import org.jboss.shrinkwrap.api.ShrinkWrap;\n+import org.jboss.shrinkwrap.api.asset.StringAsset;\n+import org.jboss.shrinkwrap.api.spec.JavaArchive;\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.DisplayName;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.RegisterExtension;\n+\n+import io.quarkus.security.test.utils.TestIdentityController;\n+import io.quarkus.security.test.utils.TestIdentityProvider;\n+import io.quarkus.test.QuarkusUnitTest;\n+import io.quarkus.vertx.http.security.PathHandler;\n+\n+public class CORSWildcardStarSecurityTestCase {", "originalCommit": "beaa1ac5da0b7e9f22ec7fb1c0105c99a62a07c3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDg3MDQ4OA==", "url": "https://github.com/quarkusio/quarkus/pull/12142#discussion_r490870488", "bodyText": "@ia3andy I thought which will be better it have two test for two configuration. First test configuration is not include this properties (work CORS like before) and second test configuration is include this properties with * values", "author": "xumk", "createdAt": "2020-09-18T11:02:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDg2NjM3NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDg3Njg5Mg==", "url": "https://github.com/quarkusio/quarkus/pull/12142#discussion_r490876892", "bodyText": "ah ok, I misread it ;-)", "author": "ia3andy", "createdAt": "2020-09-18T11:15:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDg2NjM3NQ=="}], "type": "inlineReview"}, {"oid": "8f9302be7468381f8a1ad6dcf26140fd2db85138", "url": "https://github.com/quarkusio/quarkus/commit/8f9302be7468381f8a1ad6dcf26140fd2db85138", "message": "Support '*' in CORS filter configuration", "committedDate": "2020-09-19T08:31:31Z", "type": "commit"}]}