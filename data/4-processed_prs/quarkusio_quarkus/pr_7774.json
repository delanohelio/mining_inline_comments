{"pr_number": 7774, "pr_title": "Make GraalVM Java 11 the default image", "pr_createdAt": "2020-03-11T13:32:26Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/7774", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTExMzE0NA==", "url": "https://github.com/quarkusio/quarkus/pull/7774#discussion_r391113144", "bodyText": "This doc section is about Java 8 but the default {graalvm-flavor} value is ...-java11. Is that OK to keep things that way?", "author": "gwenneg", "createdAt": "2020-03-11T16:47:03Z", "path": "docs/src/main/asciidoc/native-and-ssl.adoc", "diffHunk": "@@ -206,7 +206,7 @@ You can for example modify your `Dockerfile.native` as follows to copy the requi\n ==== Java 8\n [source, subs=attributes+]\n ----\n-FROM quay.io/quarkus/ubi-quarkus-native-image:{graalvm-version}-java8 as nativebuilder\n+FROM quay.io/quarkus/ubi-quarkus-native-image:{graalvm-flavor} as nativebuilder", "originalCommit": "97886955246d14e7adb01b1334d3d2d89e0394ee", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTExNjM5Ng==", "url": "https://github.com/quarkusio/quarkus/pull/7774#discussion_r391116396", "bodyText": "Since JDK 11 is the default version, do we need to keep that sentence?", "author": "gwenneg", "createdAt": "2020-03-11T16:51:53Z", "path": "docs/src/main/asciidoc/deploying-to-openshift-s2i.adoc", "diffHunk": "@@ -52,7 +52,7 @@ curl $URL/hello/greeting/quarkus\n [TIP]\n ====\n The `oc new-app` command above uses a builder image compatible with JDK 8.\n-In order to create a JDK 11 native compatible image use `quay.io/quarkus/ubi-quarkus-native-s2i:{graalvm-version}-java11` as a builder image.\n+In order to create a JDK 11 native compatible image use `quay.io/quarkus/ubi-quarkus-native-s2i:{graalvm-flavor}` as a builder image.", "originalCommit": "97886955246d14e7adb01b1334d3d2d89e0394ee", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTEyNTg2Ng==", "url": "https://github.com/quarkusio/quarkus/pull/7774#discussion_r391125866", "bodyText": "Right let's drop it. Search and replace was a bit too extreme apparently :).", "author": "gsmet", "createdAt": "2020-03-11T17:06:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTExNjM5Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTExNjgxMg==", "url": "https://github.com/quarkusio/quarkus/pull/7774#discussion_r391116812", "bodyText": "Same here.", "author": "gwenneg", "createdAt": "2020-03-11T16:52:33Z", "path": "docs/src/main/asciidoc/deploying-to-openshift-s2i.adoc", "diffHunk": "@@ -117,11 +117,11 @@ The end result is an image that is less than 40 MB in size (compressed) and does\n The minimal build is depending on the S2I build since it is using the output (native runnable application) from the S2I build. However, you do not need to create an application with `oc new-app`. Instead you could use `oc new-build` like this:\n [source, shell, subs=\"attributes\"]\n ----\n-oc new-build quay.io/quarkus/ubi-quarkus-native-s2i:{graalvm-version}-java8~{quickstarts-clone-url} \\\n+oc new-build quay.io/quarkus/ubi-quarkus-native-s2i:{graalvm-flavor}~{quickstarts-clone-url} \\\n     --context-dir=getting-started --name=quarkus-quickstart-native\n ----\n \n-Like in previous commands, use `quay.io/quarkus/ubi-quarkus-native-s2i:{graalvm-version}-java11` for building a JDK 11 compatible image.\n+Like in previous commands, use `quay.io/quarkus/ubi-quarkus-native-s2i:{graalvm-flavor}` for building a JDK 11 compatible image.", "originalCommit": "97886955246d14e7adb01b1334d3d2d89e0394ee", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTEyNjI1Nw==", "url": "https://github.com/quarkusio/quarkus/pull/7774#discussion_r391126257", "bodyText": "Dropped.", "author": "gsmet", "createdAt": "2020-03-11T17:06:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTExNjgxMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTExODI2MQ==", "url": "https://github.com/quarkusio/quarkus/pull/7774#discussion_r391118261", "bodyText": "The image URL will be the same for both JDK here, there's no reason to keep that tip in its current state (but maybe it could be rewritten differently).", "author": "gwenneg", "createdAt": "2020-03-11T16:54:36Z", "path": "docs/src/main/asciidoc/maven-tooling.adoc", "diffHunk": "@@ -371,8 +371,8 @@ Note that in this case the build itself runs in a Docker container too, so you d\n \n [TIP]\n ====\n-By default, the native image will be generated using the `quay.io/quarkus/ubi-quarkus-native-image:{graalvm-version}-java8` Docker image which is only compatible with JDK 8.\n-If you want to build a native image compatible with JDK 11, you will have to use the `-Dquarkus.native.builder-image=quay.io/quarkus/ubi-quarkus-native-image:{graalvm-version}-java11` build argument.\n+By default, the native image will be generated using the `quay.io/quarkus/ubi-quarkus-native-image:{graalvm-flavor}` Docker image which is only compatible with JDK 8.\n+If you want to build a native image compatible with JDK 11, you will have to use the `-Dquarkus.native.builder-image=quay.io/quarkus/ubi-quarkus-native-image:{graalvm-flavor}` build argument.", "originalCommit": "97886955246d14e7adb01b1334d3d2d89e0394ee", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTE0MDQxMA==", "url": "https://github.com/quarkusio/quarkus/pull/7774#discussion_r391140410", "bodyText": "Same here.", "author": "gsmet", "createdAt": "2020-03-11T17:27:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTExODI2MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTEyMjM5Mg==", "url": "https://github.com/quarkusio/quarkus/pull/7774#discussion_r391122392", "bodyText": "The image URL will be the same for both JDK here, there's no reason to keep that tip in its current state (but maybe it could be rewritten differently).", "author": "gwenneg", "createdAt": "2020-03-11T17:00:47Z", "path": "docs/src/main/asciidoc/gradle-tooling.adoc", "diffHunk": "@@ -283,8 +283,8 @@ Note that in this case the build itself runs in a Docker container too, so you d\n \n [TIP]\n ====\n-By default, the native image will be generated using the `quay.io/quarkus/ubi-quarkus-native-image:{graalvm-version}-java8` Docker image which is only compatible with JDK 8.\n-If you want to build a native image compatible with JDK 11, you will have to use the `-Dquarkus.native.builder-image=quay.io/quarkus/ubi-quarkus-native-image:{graalvm-version}-java11` build argument.\n+By default, the native image will be generated using the `quay.io/quarkus/ubi-quarkus-native-image:{graalvm-flavor}` Docker image which is only compatible with JDK 8.\n+If you want to build a native image compatible with JDK 11, you will have to use the `-Dquarkus.native.builder-image=quay.io/quarkus/ubi-quarkus-native-image:{graalvm-flavor}` build argument.", "originalCommit": "97886955246d14e7adb01b1334d3d2d89e0394ee", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTEyNzY1OQ==", "url": "https://github.com/quarkusio/quarkus/pull/7774#discussion_r391127659", "bodyText": "I dropped it. We want to deprecate Java 8 so let's move everyone to JDK 11.", "author": "gsmet", "createdAt": "2020-03-11T17:08:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTEyMjM5Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTEzNjMyOQ==", "url": "https://github.com/quarkusio/quarkus/pull/7774#discussion_r391136329", "bodyText": "Hum. I thought a bit more about it and came up with another version of it.", "author": "gsmet", "createdAt": "2020-03-11T17:22:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTEyMjM5Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTEyNTU3MQ==", "url": "https://github.com/quarkusio/quarkus/pull/7774#discussion_r391125571", "bodyText": "I'm removing that mention.", "author": "gsmet", "createdAt": "2020-03-11T17:05:47Z", "path": "docs/src/main/asciidoc/building-native-image.adoc", "diffHunk": "@@ -369,7 +369,7 @@ Save this file in `src/main/docker/Dockerfile.multistage` as it is not included\n \n [WARNING]\n ====\n-Replace the -java8 in the base image with -java11 if you want to use Java 11.\n+Replace `-java11` in the base image with `-java8` if you want to use Java 8.", "originalCommit": "97886955246d14e7adb01b1334d3d2d89e0394ee", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "964dff0c3836d05cdeaf7a6267ef48c835847b3e", "url": "https://github.com/quarkusio/quarkus/commit/964dff0c3836d05cdeaf7a6267ef48c835847b3e", "message": "Make GraalVM Java 11 the default image", "committedDate": "2020-03-11T17:34:24Z", "type": "commit"}, {"oid": "964dff0c3836d05cdeaf7a6267ef48c835847b3e", "url": "https://github.com/quarkusio/quarkus/commit/964dff0c3836d05cdeaf7a6267ef48c835847b3e", "message": "Make GraalVM Java 11 the default image", "committedDate": "2020-03-11T17:34:24Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTI0NjA0Nw==", "url": "https://github.com/quarkusio/quarkus/pull/7774#discussion_r391246047", "bodyText": "This is unrelated to this PR, but why do we need two columns (Property Name and Value) while they contain the exact same content for all lines of the table?", "author": "gwenneg", "createdAt": "2020-03-11T20:21:33Z", "path": "docs/src/main/asciidoc/README.adoc", "diffHunk": "@@ -44,5 +44,6 @@ complete list of externalized variables for use is given in the following table:\n |\\{quickstarts-blob-url}|{quickstarts-blob-url}| Quickstarts URL to master blob source tree; used for referencing source files.\n |\\{quickstarts-tree-url}|{quickstarts-tree-url}| Quickstarts URL to master source tree root; used for referencing directories.\n \n-|\\{graalvm-version}|{graalvm-version}| Recommended Graal VM version to use.\n+|\\{graalvm-version}|{graalvm-version}| Recommended GraalVM version to use.\n+|\\{graalvm-flavor}|{graalvm-flavor}| The full flavor of GraaVM to use e.g. `19.3.1-java11`.", "originalCommit": "b7835cfd18d79367c8bb001b27557a3d8318a933", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTI0OTQ4MQ==", "url": "https://github.com/quarkusio/quarkus/pull/7774#discussion_r391249481", "bodyText": "They do not. One is escaped, not the other.", "author": "gsmet", "createdAt": "2020-03-11T20:28:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTI0NjA0Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTI1Mjg5NQ==", "url": "https://github.com/quarkusio/quarkus/pull/7774#discussion_r391252895", "bodyText": "Oh I missed that detail, sorry :)", "author": "gwenneg", "createdAt": "2020-03-11T20:35:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTI0NjA0Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTI1ODMxOQ==", "url": "https://github.com/quarkusio/quarkus/pull/7774#discussion_r391258319", "bodyText": "I can see the HTML with different values in quarkus-documentation-999-SNAPSHOT.zip, but is this file actually published somewhere on a public website? I can't find it anywhere on https://quarkus.io/.", "author": "gwenneg", "createdAt": "2020-03-11T20:46:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTI0NjA0Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTI1ODY0Mw==", "url": "https://github.com/quarkusio/quarkus/pull/7774#discussion_r391258643", "bodyText": "On GH, there isn't any difference in terms of display between columns 1 and 2.", "author": "gwenneg", "createdAt": "2020-03-11T20:47:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTI0NjA0Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTUxMDY2Mw==", "url": "https://github.com/quarkusio/quarkus/pull/7774#discussion_r391510663", "bodyText": "No, it's not. It's just for reference, we don't publish it.\nThat would be a GH bug :).", "author": "gsmet", "createdAt": "2020-03-12T09:58:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTI0NjA0Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTYwMDI0Ng==", "url": "https://github.com/quarkusio/quarkus/pull/7774#discussion_r391600246", "bodyText": "Then I still don't understand why we need the Value column.", "author": "gwenneg", "createdAt": "2020-03-12T12:54:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTI0NjA0Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTI1MDUwMA==", "url": "https://github.com/quarkusio/quarkus/pull/7774#discussion_r391250500", "bodyText": "The last part is not easy to read, I would change it to something like:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            The list of the available Docker images can be found on https://quay.io/repository/quarkus/ubi-quarkus-native-image?tab=tags[quay.io]. Note that not all the images are compatible with a given Quarkus version.\n          \n          \n            \n            The list of the available Docker images can be found on https://quay.io/repository/quarkus/ubi-quarkus-native-image?tab=tags[quay.io]. Note that a given Quarkus version is not compatible with all the images.", "author": "gwenneg", "createdAt": "2020-03-11T20:30:26Z", "path": "docs/src/main/asciidoc/gradle-tooling.adoc", "diffHunk": "@@ -283,8 +283,12 @@ Note that in this case the build itself runs in a Docker container too, so you d\n \n [TIP]\n ====\n-By default, the native image will be generated using the `quay.io/quarkus/ubi-quarkus-native-image:{graalvm-version}-java8` Docker image which is only compatible with JDK 8.\n-If you want to build a native image compatible with JDK 11, you will have to use the `-Dquarkus.native.builder-image=quay.io/quarkus/ubi-quarkus-native-image:{graalvm-version}-java11` build argument.\n+By default, the native executable will be generated using the `quay.io/quarkus/ubi-quarkus-native-image:{graalvm-flavor}` Docker image.\n+\n+If you want to build a native executable with a different Docker image (for instance to use a different GraalVM version),\n+use the `-Dquarkus.native.builder-image=<image name>` build argument.\n+\n+The list of the available Docker images can be found on https://quay.io/repository/quarkus/ubi-quarkus-native-image?tab=tags[quay.io]. Note that not all the images are compatible with a given Quarkus version.", "originalCommit": "b7835cfd18d79367c8bb001b27557a3d8318a933", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTI1MDg5Mg==", "url": "https://github.com/quarkusio/quarkus/pull/7774#discussion_r391250892", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            The list of the available Docker images can be found on https://quay.io/repository/quarkus/ubi-quarkus-native-image?tab=tags[quay.io]. Note that not all the images are compatible with a given Quarkus version.\n          \n          \n            \n            The list of the available Docker images can be found on https://quay.io/repository/quarkus/ubi-quarkus-native-image?tab=tags[quay.io]. Note that a given Quarkus version is not compatible with all the images.", "author": "gwenneg", "createdAt": "2020-03-11T20:31:14Z", "path": "docs/src/main/asciidoc/maven-tooling.adoc", "diffHunk": "@@ -371,8 +371,12 @@ Note that in this case the build itself runs in a Docker container too, so you d\n \n [TIP]\n ====\n-By default, the native image will be generated using the `quay.io/quarkus/ubi-quarkus-native-image:{graalvm-version}-java8` Docker image which is only compatible with JDK 8.\n-If you want to build a native image compatible with JDK 11, you will have to use the `-Dquarkus.native.builder-image=quay.io/quarkus/ubi-quarkus-native-image:{graalvm-version}-java11` build argument.\n+By default, the native executable will be generated using the `quay.io/quarkus/ubi-quarkus-native-image:{graalvm-flavor}` Docker image.\n+\n+If you want to build a native executable with a different Docker image (for instance to use a different GraalVM version),\n+use the `-Dquarkus.native.builder-image=<image name>` build argument.\n+\n+The list of the available Docker images can be found on https://quay.io/repository/quarkus/ubi-quarkus-native-image?tab=tags[quay.io]. Note that not all the images are compatible with a given Quarkus version.", "originalCommit": "b7835cfd18d79367c8bb001b27557a3d8318a933", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTI1MTkwNg==", "url": "https://github.com/quarkusio/quarkus/pull/7774#discussion_r391251906", "bodyText": "I don't know if there was a mistake in the previous version, but the path where the certs were copied was different. The one you kept in this PR is from the Java 8 section.", "author": "gwenneg", "createdAt": "2020-03-11T20:33:22Z", "path": "docs/src/main/asciidoc/native-and-ssl.adoc", "diffHunk": "@@ -199,42 +199,31 @@ Don't forget to move your GraalVM directory back to where it was.\n \n === Working with containers\n \n-When working with containers, the idea is to bundle both the SunEC library and the certificates in the container and to point your binary to them using the system properties mentioned above.\n+When working with containers, the idea is to bundle the certificates in the container and to point your binary to them using the system property mentioned above.\n \n You can for example modify your `Dockerfile.native` as follows to copy the required files to your final image:\n \n-==== Java 8\n [source, subs=attributes+]\n ----\n-FROM quay.io/quarkus/ubi-quarkus-native-image:{graalvm-version}-java8 as nativebuilder\n-RUN mkdir -p /tmp/ssl-libs/lib \\\n-  && cp /opt/graalvm/jre/lib/security/cacerts /tmp/ssl-libs \\\n-  && cp /opt/graalvm/jre/lib/amd64/libsunec.so /tmp/ssl-libs/lib/\n+FROM quay.io/quarkus/ubi-quarkus-native-image:{graalvm-flavor} as nativebuilder\n+RUN mkdir -p /tmp/ssl \\\n+  && cp /opt/graalvm/lib/security/cacerts /tmp/ssl\n \n FROM registry.access.redhat.com/ubi8/ubi-minimal\n WORKDIR /work/\n-COPY --from=nativebuilder /tmp/ssl-libs/ /work/\n+COPY --from=nativebuilder /tmp/ssl/ /work/\n COPY target/*-runner /work/application\n-RUN chmod 775 /work /work/application\n-EXPOSE 8080\n-CMD [\"./application\", \"-Dquarkus.http.host=0.0.0.0\", \"-Djava.library.path=/work/lib\", \"-Djavax.net.ssl.trustStore=/work/cacerts\"]\n-----\n \n-==== Java 11\n-[source, subs=attributes+]\n-----\n-FROM quay.io/quarkus/ubi-quarkus-native-image:{graalvm-version}-java11 as nativebuilder\n-RUN mkdir -p /tmp/ssl-libs/lib \\\n-  && cp /opt/graalvm/lib/security/cacerts /tmp/ssl-libs \\\n-  && cp /opt/graalvm/lib/libsunec.so /tmp/ssl-libs/lib/", "originalCommit": "b7835cfd18d79367c8bb001b27557a3d8318a933", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTUxMTIwNw==", "url": "https://github.com/quarkusio/quarkus/pull/7774#discussion_r391511207", "bodyText": "I decided to change the name as it doesn't contain any library anymore.", "author": "gsmet", "createdAt": "2020-03-12T09:59:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTI1MTkwNg=="}], "type": "inlineReview"}, {"oid": "adaa68eb45a701dca7b48f068581b372feb22b4b", "url": "https://github.com/quarkusio/quarkus/commit/adaa68eb45a701dca7b48f068581b372feb22b4b", "message": "Report the changes made in Dockerfile.native in the SSL doc", "committedDate": "2020-03-12T11:37:47Z", "type": "commit"}, {"oid": "adaa68eb45a701dca7b48f068581b372feb22b4b", "url": "https://github.com/quarkusio/quarkus/commit/adaa68eb45a701dca7b48f068581b372feb22b4b", "message": "Report the changes made in Dockerfile.native in the SSL doc", "committedDate": "2020-03-12T11:37:47Z", "type": "forcePushed"}]}