{"pr_number": 6552, "pr_title": "Restore the ability to use a system property for remote-dev", "pr_createdAt": "2020-01-14T15:54:08Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/6552", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQ2MDQ3Mw==", "url": "https://github.com/quarkusio/quarkus/pull/6552#discussion_r366460473", "bodyText": "You also need an InputStreamReader explicitly set up with UTF-8 here, and load the properties from the reader, else there will be encoding problems.", "author": "dmlloyd", "createdAt": "2020-01-14T17:03:08Z", "path": "extensions/undertow-websockets/deployment/src/main/java/io/quarkus/undertow/websockets/deployment/WebsocketHotReloadSetup.java", "diffHunk": "@@ -31,17 +31,27 @@\n \n     @Override\n     public void setupHotDeployment(HotReplacementContext hotReplacementContext) {\n-        List<Path> resources = hotReplacementContext.getResourcesDir();\n-        if (!resources.isEmpty()) {\n-            //TODO: fix this\n-            File appConfig = resources.get(0).resolve(\"application.properties\").toFile();\n-            if (appConfig.isFile()) {\n-                try (InputStream pw = new FileInputStream(appConfig)) {\n-                    Properties p = new Properties();\n-                    p.load(pw);\n-                    replacementPassword = p.getProperty(HotReplacementWebsocketEndpoint.QUARKUS_HOT_RELOAD_PASSWORD);\n-                } catch (IOException e) {\n-                    logger.error(\"Failed to read application.properties\", e);\n+        // we can't use the typical ConfigProvider.getConfig() because it throws an ISE\n+        String password = System.getProperty(HotReplacementWebsocketEndpoint.QUARKUS_HOT_RELOAD_PASSWORD);\n+        if (password == null || password.isEmpty()) {\n+            password = System.getenv(HotReplacementWebsocketEndpoint.QUARKUS_HOT_RELOAD_PASSWORD_ENV);\n+        }\n+\n+        if (password != null && !password.isEmpty()) {\n+            replacementPassword = password;\n+        } else {\n+            List<Path> resources = hotReplacementContext.getResourcesDir();\n+            if (!resources.isEmpty()) {\n+                //TODO: fix this\n+                File appConfig = resources.get(0).resolve(\"application.properties\").toFile();\n+                if (appConfig.isFile()) {\n+                    try (InputStream pw = new FileInputStream(appConfig)) {", "originalCommit": "c96f24ac3472627c3f93c408049a6931e99cae47", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQ2NjcwNg==", "url": "https://github.com/quarkusio/quarkus/pull/6552#discussion_r366466706", "bodyText": "Well I just copied what was already in place, I didn't change anything there.\nThe UI probably shows a change because I moved it inside else.\nI just added the reading from the system property and env var", "author": "geoand", "createdAt": "2020-01-14T17:15:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQ2MDQ3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQ2NzM1OA==", "url": "https://github.com/quarkusio/quarkus/pull/6552#discussion_r366467358", "bodyText": "Would you like me to fix it anyway?", "author": "geoand", "createdAt": "2020-01-14T17:16:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQ2MDQ3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQ2ODY2NQ==", "url": "https://github.com/quarkusio/quarkus/pull/6552#discussion_r366468665", "bodyText": "Yes, please let's do it.", "author": "gsmet", "createdAt": "2020-01-14T17:19:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQ2MDQ3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQ2OTA4NA==", "url": "https://github.com/quarkusio/quarkus/pull/6552#discussion_r366469084", "bodyText": "Well I just copied what was already in place, I didn't change anything there.\nThe UI probably shows a change because I moved it inside else.\nI just added the reading from the system property and env var\n\nAh, that's not good, it should be fixed in the original place too.\n\nWould you like me to fix it anyway?\n\nYes, please.", "author": "dmlloyd", "createdAt": "2020-01-14T17:20:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQ2MDQ3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQ2OTU0Ng==", "url": "https://github.com/quarkusio/quarkus/pull/6552#discussion_r366469546", "bodyText": "So I reckon this doesn't work with Yaml as we are playing with the properties file directly?", "author": "gsmet", "createdAt": "2020-01-14T17:21:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQ2MDQ3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQ3MTkxOA==", "url": "https://github.com/quarkusio/quarkus/pull/6552#discussion_r366471918", "bodyText": "Sorry I didn't mean copy - paste, I meant move into the else branch.\nI'm only on my phone now so I can't really fix it, I'll do that later on tonight or tomorrow morning.\nAnd yes it won't work with YAML. We could of course add the YAML dependency and try to locate that file as well. Should we do it now or wait until someone complains?", "author": "geoand", "createdAt": "2020-01-14T17:26:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQ2MDQ3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQ3MzE3OA==", "url": "https://github.com/quarkusio/quarkus/pull/6552#discussion_r366473178", "bodyText": "It would be nice to fix the underlying problem...", "author": "dmlloyd", "createdAt": "2020-01-14T17:28:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQ2MDQ3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQ3ODIwNA==", "url": "https://github.com/quarkusio/quarkus/pull/6552#discussion_r366478204", "bodyText": "Underlying problem, meaning? \ud83d\ude05", "author": "geoand", "createdAt": "2020-01-14T17:39:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQ2MDQ3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQ4MjI5Mg==", "url": "https://github.com/quarkusio/quarkus/pull/6552#discussion_r366482292", "bodyText": "I mean actually loading these values from config instead of using this outside channel to access the values.", "author": "dmlloyd", "createdAt": "2020-01-14T17:47:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQ2MDQ3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQ5MTc2NA==", "url": "https://github.com/quarkusio/quarkus/pull/6552#discussion_r366491764", "bodyText": "Oh, yeah! I'll give it a shot and see if I can come up with anything", "author": "geoand", "createdAt": "2020-01-14T18:08:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQ2MDQ3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjU2NjcyNw==", "url": "https://github.com/quarkusio/quarkus/pull/6552#discussion_r366566727", "bodyText": "I pushed a fix to use InputStreamReader for now. I'll dig into the issue more to see if there is any change using the regular config infrastructure tomorrow morning", "author": "geoand", "createdAt": "2020-01-14T20:53:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQ2MDQ3Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQ2OTA1MQ==", "url": "https://github.com/quarkusio/quarkus/pull/6552#discussion_r366469051", "bodyText": "Should we rename the _HOT_RELOAD constants to _LIVE_RELOAD (it can be done in a separate commit/pr)", "author": "gsmet", "createdAt": "2020-01-14T17:20:22Z", "path": "extensions/undertow-websockets/deployment/src/main/java/io/quarkus/undertow/websockets/deployment/HotReplacementWebsocketEndpoint.java", "diffHunk": "@@ -36,6 +36,7 @@\n     static final String QUARKUS_HOT_RELOAD = \"/quarkus/live-reload\";\n     static final String QUARKUS_SECURITY_KEY = \"quarkus-security-key\";\n     static final String QUARKUS_HOT_RELOAD_PASSWORD = \"quarkus.live-reload.password\";\n+    static final String QUARKUS_HOT_RELOAD_PASSWORD_ENV = \"QUARKUS_LIVE_RELOAD_PASSWORD\";", "originalCommit": "c96f24ac3472627c3f93c408049a6931e99cae47", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQ3MjY4Nw==", "url": "https://github.com/quarkusio/quarkus/pull/6552#discussion_r366472687", "bodyText": "Good idea, we use that terminology elsewhere so it makes sense to be consistent", "author": "geoand", "createdAt": "2020-01-14T17:27:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQ2OTA1MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjU2Njc4Mg==", "url": "https://github.com/quarkusio/quarkus/pull/6552#discussion_r366566782", "bodyText": "Done", "author": "geoand", "createdAt": "2020-01-14T20:53:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQ2OTA1MQ=="}], "type": "inlineReview"}, {"oid": "c9bca77d4ad2925811d9753e15ed243a2b0a774e", "url": "https://github.com/quarkusio/quarkus/commit/c9bca77d4ad2925811d9753e15ed243a2b0a774e", "message": "Make sure we read properties with UTF8 encoding during live-reload", "committedDate": "2020-01-14T20:50:50Z", "type": "forcePushed"}, {"oid": "21ba858348c2f7beeaec0b7fe69cb60b69e02d58", "url": "https://github.com/quarkusio/quarkus/commit/21ba858348c2f7beeaec0b7fe69cb60b69e02d58", "message": "Make sure we read properties with UTF8 encoding during live-reload", "committedDate": "2020-01-15T18:48:52Z", "type": "forcePushed"}, {"oid": "829667384d5d35b3f6722c67b3a16f3f33381d07", "url": "https://github.com/quarkusio/quarkus/commit/829667384d5d35b3f6722c67b3a16f3f33381d07", "message": "Restore the ability to use a system property for remote-dev\n\nFixes: #6550", "committedDate": "2020-01-16T19:03:29Z", "type": "commit"}, {"oid": "d6b0d920ffe387963044868d52c5f2b2b5dfa948", "url": "https://github.com/quarkusio/quarkus/commit/d6b0d920ffe387963044868d52c5f2b2b5dfa948", "message": "Make sure we read properties with UTF8 encoding during live-reload", "committedDate": "2020-01-16T19:03:30Z", "type": "commit"}, {"oid": "d6b0d920ffe387963044868d52c5f2b2b5dfa948", "url": "https://github.com/quarkusio/quarkus/commit/d6b0d920ffe387963044868d52c5f2b2b5dfa948", "message": "Make sure we read properties with UTF8 encoding during live-reload", "committedDate": "2020-01-16T19:03:30Z", "type": "forcePushed"}]}