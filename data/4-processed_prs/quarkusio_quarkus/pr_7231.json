{"pr_number": 7231, "pr_title": "Add support for MutinyVerticle", "pr_createdAt": "2020-02-17T14:54:18Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/7231", "timeline": [{"oid": "43037d6f096531fdb554a685e033ceb1f32255d6", "url": "https://github.com/quarkusio/quarkus/commit/43037d6f096531fdb554a685e033ceb1f32255d6", "message": "Document verticle support\n\nAlso add a test verifying that verticle instances can be beans.", "committedDate": "2020-02-18T10:46:37Z", "type": "forcePushed"}, {"oid": "085d0955bf716c5114f4b6a78d5797c1e8e691b0", "url": "https://github.com/quarkusio/quarkus/commit/085d0955bf716c5114f4b6a78d5797c1e8e691b0", "message": "Document verticle support\n\nAlso add a test verifying that verticle instances can be beans.", "committedDate": "2020-02-19T10:02:29Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTM2MDU3Ng==", "url": "https://github.com/quarkusio/quarkus/pull/7231#discussion_r381360576", "bodyText": "It should quite easy to deploy those verticles automatically.\nSomething like:\nvoid deploy(@Observes StartupEvent event, Vertx vertx, Instance<AbstractVerticle> verticles) {\n   for (AbstractVerticle verticle : verticles) {\n     vertx.deployVerticle(verticle).await().indefinitely();\n   }\n}", "author": "mkouba", "createdAt": "2020-02-19T15:48:41Z", "path": "docs/src/main/asciidoc/vertx.adoc", "diffHunk": "@@ -498,6 +498,86 @@ Then, create the native executable with:\n ./mvnw package -Pnative\n ----\n \n+== Deploying verticles\n+\n+https://vertx.io/docs/vertx-core/java/#_verticles[Verticles] is \"a simple, scalable, actor-like deployment and concurrency model\" provided by _Vert.x_.\n+This model does not claim to be a strict actor-model implementation, but it does share similarities especially with respect to concurrency, scaling and deployment.\n+To use this model, you write and _deploy_ verticles, communicating with each other by sending messages on the event bus.\n+\n+You can deploy _verticles_ in Quarkus.\n+It supports:\n+\n+* _bare_ verticle - Java classes extending `io.vertx.core.AbstractVerticle`\n+* _Mutiny_ verticle - Java classes extending `io.smallrye.mutiny.vertx.core.AbstractVerticle`\n+\n+To deploy verticles, use the regular Vert.x API:\n+\n+[source, java]\n+====\n+@Inject Vertx vertx;\n+\n+// ...\n+vertx.deployVerticle(MyVerticle.class.getName(), ar -> { });\n+vertx.deployVerticle(new MyVerticle(), ar -> { });\n+====\n+\n+You can also pass deployment options to configure the verticle as well as set the number of instances.\n+\n+Verticles are not _beans_ by default.\n+However, you can implement them as _ApplicationScoped_ beans and get injection support:\n+\n+[source, java]\n+====\n+package io.quarkus.vertx.verticles;\n+\n+import io.smallrye.mutiny.Uni;\n+import io.smallrye.mutiny.vertx.core.AbstractVerticle;\n+import org.eclipse.microprofile.config.inject.ConfigProperty;\n+\n+import javax.enterprise.context.ApplicationScoped;\n+\n+@ApplicationScoped\n+public class MyBeanVerticle extends AbstractVerticle {\n+\n+    @ConfigProperty(name = \"address\") String address;\n+\n+    @Override\n+    public Uni<Void> asyncStart() {\n+        return vertx.eventBus().consumer(address)\n+                .handler(m -> m.replyAndForget(\"hello\"))\n+                .completionHandler();\n+    }\n+}\n+====\n+\n+Don't inject the `vertx` instance in an injected verticle.\n+Access the `vertx` instance using the `vertx` file in your `start` / `asyncStart` method.\n+\n+Then, deploy the verticle instance with:\n+\n+[source, java]\n+====\n+package io.quarkus.vertx.verticles;\n+\n+import io.quarkus.runtime.StartupEvent;\n+import io.vertx.mutiny.core.Vertx;\n+\n+import javax.enterprise.context.ApplicationScoped;\n+import javax.enterprise.event.Observes;\n+import javax.inject.Inject;\n+\n+@ApplicationScoped\n+public class VerticleDeployer {\n+\n+    @Inject Vertx vertx;\n+    @Inject MyBeanVerticle verticle;\n+\n+    public void init(@Observes StartupEvent e) {\n+         vertx.deployVerticle(verticle).await().indefinitely();", "originalCommit": "085d0955bf716c5114f4b6a78d5797c1e8e691b0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTQyODQyMg==", "url": "https://github.com/quarkusio/quarkus/pull/7231#discussion_r381428422", "bodyText": "ah ah! I didn't know this! Let me update the documentation.", "author": "cescoffier", "createdAt": "2020-02-19T17:28:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTM2MDU3Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTkwMjQ5Mw==", "url": "https://github.com/quarkusio/quarkus/pull/7231#discussion_r381902493", "bodyText": "Updated the doc and the test!\nSoon I will be a CDI master... soon", "author": "cescoffier", "createdAt": "2020-02-20T10:11:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTM2MDU3Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTM2MzI2Mg==", "url": "https://github.com/quarkusio/quarkus/pull/7231#discussion_r381363262", "bodyText": "I'd reword this sentence. Maybe something like \"You don't have to inject the Vertx instance but instead leverage the instance stored in the protected field of AbstractVerticle\"...", "author": "mkouba", "createdAt": "2020-02-19T15:52:39Z", "path": "docs/src/main/asciidoc/vertx.adoc", "diffHunk": "@@ -498,6 +498,86 @@ Then, create the native executable with:\n ./mvnw package -Pnative\n ----\n \n+== Deploying verticles\n+\n+https://vertx.io/docs/vertx-core/java/#_verticles[Verticles] is \"a simple, scalable, actor-like deployment and concurrency model\" provided by _Vert.x_.\n+This model does not claim to be a strict actor-model implementation, but it does share similarities especially with respect to concurrency, scaling and deployment.\n+To use this model, you write and _deploy_ verticles, communicating with each other by sending messages on the event bus.\n+\n+You can deploy _verticles_ in Quarkus.\n+It supports:\n+\n+* _bare_ verticle - Java classes extending `io.vertx.core.AbstractVerticle`\n+* _Mutiny_ verticle - Java classes extending `io.smallrye.mutiny.vertx.core.AbstractVerticle`\n+\n+To deploy verticles, use the regular Vert.x API:\n+\n+[source, java]\n+====\n+@Inject Vertx vertx;\n+\n+// ...\n+vertx.deployVerticle(MyVerticle.class.getName(), ar -> { });\n+vertx.deployVerticle(new MyVerticle(), ar -> { });\n+====\n+\n+You can also pass deployment options to configure the verticle as well as set the number of instances.\n+\n+Verticles are not _beans_ by default.\n+However, you can implement them as _ApplicationScoped_ beans and get injection support:\n+\n+[source, java]\n+====\n+package io.quarkus.vertx.verticles;\n+\n+import io.smallrye.mutiny.Uni;\n+import io.smallrye.mutiny.vertx.core.AbstractVerticle;\n+import org.eclipse.microprofile.config.inject.ConfigProperty;\n+\n+import javax.enterprise.context.ApplicationScoped;\n+\n+@ApplicationScoped\n+public class MyBeanVerticle extends AbstractVerticle {\n+\n+    @ConfigProperty(name = \"address\") String address;\n+\n+    @Override\n+    public Uni<Void> asyncStart() {\n+        return vertx.eventBus().consumer(address)\n+                .handler(m -> m.replyAndForget(\"hello\"))\n+                .completionHandler();\n+    }\n+}\n+====\n+\n+Don't inject the `vertx` instance in an injected verticle.", "originalCommit": "085d0955bf716c5114f4b6a78d5797c1e8e691b0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTQyODU3Ng==", "url": "https://github.com/quarkusio/quarkus/pull/7231#discussion_r381428576", "bodyText": "Yes, that's better.", "author": "cescoffier", "createdAt": "2020-02-19T17:28:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTM2MzI2Mg=="}], "type": "inlineReview"}, {"oid": "88793507e09f1c9fd94028fa7c66559a9ab8c98a", "url": "https://github.com/quarkusio/quarkus/commit/88793507e09f1c9fd94028fa7c66559a9ab8c98a", "message": "Document verticle support\n\nAlso add a test verifying that verticle instances can be beans.", "committedDate": "2020-02-20T10:08:59Z", "type": "forcePushed"}, {"oid": "7accdaecc5435388bc3f6063045b61f3b593338e", "url": "https://github.com/quarkusio/quarkus/commit/7accdaecc5435388bc3f6063045b61f3b593338e", "message": "Document verticle support\n\nAlso add a test verifying that verticle instances can be beans.", "committedDate": "2020-02-20T10:10:35Z", "type": "forcePushed"}, {"oid": "a4a7c9aa9561a928789e58e9bf8893f88495fcc1", "url": "https://github.com/quarkusio/quarkus/commit/a4a7c9aa9561a928789e58e9bf8893f88495fcc1", "message": "Document verticle support\n\nAlso add a test verifying that verticle instances can be beans.", "committedDate": "2020-02-20T13:20:37Z", "type": "forcePushed"}, {"oid": "859cc28a7d30bffb4b5377ce90cec97b29efc63e", "url": "https://github.com/quarkusio/quarkus/commit/859cc28a7d30bffb4b5377ce90cec97b29efc63e", "message": "Add support for Mutiny Verticle\n\nMutiny Verticle is a variant of Verticle using the Mutiny API.", "committedDate": "2020-02-20T19:27:00Z", "type": "commit"}, {"oid": "8755db2707688d743960ef3d1a63019b1867f50b", "url": "https://github.com/quarkusio/quarkus/commit/8755db2707688d743960ef3d1a63019b1867f50b", "message": "Document verticle support\n\nAlso add a test verifying that verticle instances can be beans.", "committedDate": "2020-02-20T19:27:03Z", "type": "commit"}, {"oid": "8755db2707688d743960ef3d1a63019b1867f50b", "url": "https://github.com/quarkusio/quarkus/commit/8755db2707688d743960ef3d1a63019b1867f50b", "message": "Document verticle support\n\nAlso add a test verifying that verticle instances can be beans.", "committedDate": "2020-02-20T19:27:03Z", "type": "forcePushed"}]}