{"pr_number": 13460, "pr_title": "Allow Prometheus annotations to be modified/omitted", "pr_createdAt": "2020-11-24T20:46:40Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/13460", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTg4MDcxMg==", "url": "https://github.com/quarkusio/quarkus/pull/13460#discussion_r529880712", "bodyText": "I'm kinda on the fence about having such a separate configuration root.\nI think it might be weird for a used that prometheus configuration would only affect Kubernetes manifests.\n@iocanel WDYT?", "author": "geoand", "createdAt": "2020-11-24T21:12:22Z", "path": "extensions/kubernetes/vanilla/deployment/src/main/java/io/quarkus/kubernetes/deployment/PrometheusConfiguration.java", "diffHunk": "@@ -0,0 +1,65 @@\n+package io.quarkus.kubernetes.deployment;\n+\n+import io.quarkus.runtime.annotations.ConfigItem;\n+import io.quarkus.runtime.annotations.ConfigRoot;\n+\n+@ConfigRoot\n+public class PrometheusConfiguration {", "originalCommit": "f13f10c003ca73edd157f07daa8b6c4e7528e24a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTg4NTM0OA==", "url": "https://github.com/quarkusio/quarkus/pull/13460#discussion_r529885348", "bodyText": "This is what I was asking about. I ended up making it its own thing because of how the annotations are added (as a subcontext for minikube, openshift, and vanilla kubernetes).\nI wanted to be able to re-ingest that prefix value..\n@ConfigItem(defaultValue = \"${quarkus.prometheus.prefix}/path\")\nAs soon as this configuration is nested, e.g. underneath Kubernetes:\n@ConfigItem(defaultValue = \"${quarkus.kubernetes.prometheus.prefix}/path\")\nIt may be just how I attempted it the first time, but the hierarchy of configuration between the kubernetes types made this a little tricky for me to sort out how to do (specifically to ensure I could reuse that prefix as the default value for other attributes), given I think I could end up with ${quarkus.openshift.prometheus.prefix}/path or whatever.\n@geoand .. you're supposed to be reading. TOMORROW.", "author": "ebullient", "createdAt": "2020-11-24T21:20:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTg4MDcxMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDE0NDM4Mw==", "url": "https://github.com/quarkusio/quarkus/pull/13460#discussion_r530144383", "bodyText": "I think we should probably move this configuration part of io.quarkus.kubernetes.deployment.PlatformConfiguration", "author": "geoand", "createdAt": "2020-11-25T06:57:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTg4MDcxMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDM1MDcwNA==", "url": "https://github.com/quarkusio/quarkus/pull/13460#discussion_r530350704", "bodyText": "That's where I put it initially, but I couldn't figure out how to do that w/o having it become ${quarkus.kubernetes.prometheus.prefix}/path or ${quarkus.openshift.prometheus.prefix}/path or ...", "author": "ebullient", "createdAt": "2020-11-25T12:51:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTg4MDcxMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDM1MTM3Mw==", "url": "https://github.com/quarkusio/quarkus/pull/13460#discussion_r530351373", "bodyText": "It would be come that. But what is that a problem?", "author": "geoand", "createdAt": "2020-11-25T12:52:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTg4MDcxMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDM1MjYwNw==", "url": "https://github.com/quarkusio/quarkus/pull/13460#discussion_r530352607", "bodyText": "See my first comment about setting default values.  I don't see how I can do that from one common place when the String is different depending on kube flavor.", "author": "ebullient", "createdAt": "2020-11-25T12:54:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTg4MDcxMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDM1MzUyNg==", "url": "https://github.com/quarkusio/quarkus/pull/13460#discussion_r530353526", "bodyText": "OK, I see.\nYou'll have to do that manually in the processor code.", "author": "geoand", "createdAt": "2020-11-25T12:56:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTg4MDcxMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDM4MzkyOA==", "url": "https://github.com/quarkusio/quarkus/pull/13460#discussion_r530383928", "bodyText": "Right. From a documentation perspective (understanding how default values are set, etc), that's why I thought it was more appropriate (in the end) to make it its own thing. There are a few other cross-config references w/in the kube space, but they are into other config roots (container config), so this isn't a problem in those cases.", "author": "ebullient", "createdAt": "2020-11-25T13:44:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTg4MDcxMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDM4NTk4OA==", "url": "https://github.com/quarkusio/quarkus/pull/13460#discussion_r530385988", "bodyText": "Yeah, as this config is only about Kubernetes and not standalone Prometeus, it really sure should be properly namespaced.\nIt's a bit more work, but it should be worth it.", "author": "geoand", "createdAt": "2020-11-25T13:48:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTg4MDcxMg=="}], "type": "inlineReview"}, {"oid": "bb336d06b6bc6784c0f8bcda872e2d3b34d7c257", "url": "https://github.com/quarkusio/quarkus/commit/bb336d06b6bc6784c0f8bcda872e2d3b34d7c257", "message": "Allow Prometheus annotations to be modified/omitted", "committedDate": "2020-11-30T21:38:12Z", "type": "forcePushed"}, {"oid": "6d628511b21c3417e63f1174f455540d2f0312d4", "url": "https://github.com/quarkusio/quarkus/commit/6d628511b21c3417e63f1174f455540d2f0312d4", "message": "Allow Prometheus annotations to be modified/omitted", "committedDate": "2020-12-02T03:08:02Z", "type": "forcePushed"}, {"oid": "4b66beabbca75abcdf89cae93f3e42969ca2a548", "url": "https://github.com/quarkusio/quarkus/commit/4b66beabbca75abcdf89cae93f3e42969ca2a548", "message": "Allow Prometheus annotations to be modified/omitted", "committedDate": "2020-12-02T19:04:08Z", "type": "commit"}, {"oid": "4b66beabbca75abcdf89cae93f3e42969ca2a548", "url": "https://github.com/quarkusio/quarkus/commit/4b66beabbca75abcdf89cae93f3e42969ca2a548", "message": "Allow Prometheus annotations to be modified/omitted", "committedDate": "2020-12-02T19:04:08Z", "type": "forcePushed"}]}