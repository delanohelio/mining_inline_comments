{"pr_number": 401, "pr_title": "SLIM-2631 fix connection slot leak", "pr_createdAt": "2020-08-17T12:18:59Z", "pr_url": "https://github.com/OSGP/open-smart-grid-platform/pull/401", "timeline": [{"oid": "89bb8ee60da6869422a904dfe2df233227309a92", "url": "https://github.com/OSGP/open-smart-grid-platform/commit/89bb8ee60da6869422a904dfe2df233227309a92", "message": "SLIM-2631 fix connection slot leak", "committedDate": "2020-08-17T12:16:32Z", "type": "commit"}, {"oid": "4b722fb9d7e65aa35e354956582e954e9e1c9230", "url": "https://github.com/OSGP/open-smart-grid-platform/commit/4b722fb9d7e65aa35e354956582e954e9e1c9230", "message": "SLIM-2631 revert test", "committedDate": "2020-08-17T12:20:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQ0MTY2Mw==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/401#discussion_r471441663", "bodyText": "this is the fix, if the connection fails somehow, release the slot. There is a postProcessing method also that releases the connection, but it checks it the connection was null and then returns, but of course in case of connection failure the connection is null, so the slot was never released.", "author": "coendamen", "createdAt": "2020-08-17T12:23:21Z", "path": "osgp/protocol-adapter-dlms/osgp-protocol-adapter-dlms/src/main/java/org/opensmartgridplatform/adapter/protocol/dlms/infra/messaging/DlmsConnectionMessageProcessor.java", "diffHunk": "@@ -58,13 +57,18 @@\n \n     public DlmsConnectionManager createConnectionForDevice(final DlmsDevice device,\n             final MessageMetadata messageMetadata) throws OsgpException {\n-        \n+\n         throttlingService.openConnection();\n \n         final DlmsMessageListener dlmsMessageListener = this\n                 .createMessageListenerForDeviceConnection(device, messageMetadata);\n \n-        return this.dlmsConnectionHelper.createConnectionForDevice(device, dlmsMessageListener);\n+        try {", "originalCommit": "4b722fb9d7e65aa35e354956582e954e9e1c9230", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQ1MDMzMw==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/401#discussion_r471450333", "bodyText": "Use finally instead?", "author": "jandik", "createdAt": "2020-08-17T12:40:25Z", "path": "osgp/protocol-adapter-dlms/osgp-protocol-adapter-dlms/src/main/java/org/opensmartgridplatform/adapter/protocol/dlms/infra/messaging/DlmsConnectionMessageProcessor.java", "diffHunk": "@@ -58,13 +57,18 @@\n \n     public DlmsConnectionManager createConnectionForDevice(final DlmsDevice device,\n             final MessageMetadata messageMetadata) throws OsgpException {\n-        \n+\n         throttlingService.openConnection();\n \n         final DlmsMessageListener dlmsMessageListener = this\n                 .createMessageListenerForDeviceConnection(device, messageMetadata);\n \n-        return this.dlmsConnectionHelper.createConnectionForDevice(device, dlmsMessageListener);\n+        try {\n+            return this.dlmsConnectionHelper.createConnectionForDevice(device, dlmsMessageListener);\n+        } catch (Exception e) {\n+            throttlingService.closeConnection();", "originalCommit": "4b722fb9d7e65aa35e354956582e954e9e1c9230", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}