{"pr_number": 342, "pr_title": "FLEX-5303 Handle IEC60870 light measurement events", "pr_createdAt": "2020-06-04T17:07:10Z", "pr_url": "https://github.com/OSGP/open-smart-grid-platform/pull/342", "timeline": [{"oid": "0574cab644c09eeb708c3a387c0030bf984904b5", "url": "https://github.com/OSGP/open-smart-grid-platform/commit/0574cab644c09eeb708c3a387c0030bf984904b5", "message": "FLEX-5303 ~ Handles IEC60870 light measurement events\n\nImplements IEC60870 event acquisition scenario for light measurement\ndevices spontaneously sending an ASDU with data concerning the light\nsensor status.\nThe data with the event is translated to an event notification for the\nplatform indicating whether the light sensor of the light measurement\ndevice reports dark or light.\n\nUpdate the default device type from DA_DEVICE (old name of a renamed\nenum value) to DISTRIBUTION_AUTOMATION_DEVICE.", "committedDate": "2020-06-04T16:57:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTg1NTczMA==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/342#discussion_r435855730", "bodyText": "we could do without the anonymous inner class:\nthis.jmsTemplate.send(session -> {\nfinal ObjectMessage objectMessage = session.createObjectMessage(requestMessage);\nobjectMessage.setJMSType(messageType);\nobjectMessage.setStringProperty(Constants.ORGANISATION_IDENTIFICATION,\nrequestMessage.getOrganisationIdentification());\nobjectMessage.setStringProperty(Constants.DEVICE_IDENTIFICATION, requestMessage.getDeviceIdentification());\nreturn objectMessage;\n\n});", "author": "robindenadel", "createdAt": "2020-06-05T11:18:37Z", "path": "osgp/protocol-adapter-iec60870/osgp-protocol-adapter-iec60870/src/main/java/org/opensmartgridplatform/adapter/protocol/iec60870/infra/messaging/OsgpRequestMessageSender.java", "diffHunk": "@@ -0,0 +1,54 @@\n+/**\n+ * Copyright 2020 Smart Society Services B.V.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ */\n+package org.opensmartgridplatform.adapter.protocol.iec60870.infra.messaging;\n+\n+import javax.jms.JMSException;\n+import javax.jms.Message;\n+import javax.jms.ObjectMessage;\n+import javax.jms.Session;\n+\n+import org.opensmartgridplatform.shared.infra.jms.Constants;\n+import org.opensmartgridplatform.shared.infra.jms.RequestMessage;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.beans.factory.annotation.Qualifier;\n+import org.springframework.jms.core.JmsTemplate;\n+import org.springframework.jms.core.MessageCreator;\n+import org.springframework.stereotype.Component;\n+\n+@Component(value = \"protocolIec60870OutboundOsgpCoreRequestsMessageSender\")\n+public class OsgpRequestMessageSender {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(OsgpRequestMessageSender.class);\n+\n+    @Autowired\n+    @Qualifier(\"protocolIec60870OutboundOsgpCoreRequestsJmsTemplate\")\n+    private JmsTemplate jmsTemplate;\n+\n+    public void send(final RequestMessage requestMessage, final String messageType) {\n+        LOGGER.info(\"Sending request message to OSGP.\");\n+\n+        this.jmsTemplate.send(new MessageCreator() {\n+\n+            @Override\n+            public Message createMessage(final Session session) throws JMSException {\n+                final ObjectMessage objectMessage = session.createObjectMessage(requestMessage);\n+                objectMessage.setJMSType(messageType);\n+                objectMessage.setStringProperty(Constants.ORGANISATION_IDENTIFICATION,\n+                        requestMessage.getOrganisationIdentification());\n+                objectMessage.setStringProperty(Constants.DEVICE_IDENTIFICATION,\n+                        requestMessage.getDeviceIdentification());\n+\n+                return objectMessage;\n+            }", "originalCommit": "0574cab644c09eeb708c3a387c0030bf984904b5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTk2NzMwNA==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/342#discussion_r435967304", "bodyText": "I replaced the anonymous class by a lambda expression.\nIt may be better if we figure out if one form or the other is a preferred way of handling things.\nWithout a declared preference this might just lead to changing \"in the other direction\" in some other pull request.", "author": "bvdzwet", "createdAt": "2020-06-05T14:40:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTg1NTczMA=="}], "type": "inlineReview"}, {"oid": "f91580d2c7267fcc69624f5c9d55b403b3328c50", "url": "https://github.com/OSGP/open-smart-grid-platform/commit/f91580d2c7267fcc69624f5c9d55b403b3328c50", "message": "FLEX-5303 ~ replaces anonymous class by lambda expression", "committedDate": "2020-06-05T14:35:58Z", "type": "commit"}]}