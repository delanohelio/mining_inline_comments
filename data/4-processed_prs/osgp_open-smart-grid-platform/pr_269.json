{"pr_number": 269, "pr_title": "DevicetodeviceMapper will now check for existing Manufacturer & Model\u2026", "pr_createdAt": "2020-04-06T09:16:51Z", "pr_url": "https://github.com/OSGP/open-smart-grid-platform/pull/269", "timeline": [{"oid": "be0cd83fd5168445afc6efff412fe597421e81b2", "url": "https://github.com/OSGP/open-smart-grid-platform/commit/be0cd83fd5168445afc6efff412fe597421e81b2", "message": "DevicetodeviceMapper will now check for existing Manufacturer & ModelCode combination, also changed deviceinstallation.xsd to force ModelCode and delete Metered and Descirption attributes", "committedDate": "2020-04-06T08:29:01Z", "type": "commit"}, {"oid": "bdd468466b75bbc216409ccd19d1d0283d775581", "url": "https://github.com/OSGP/open-smart-grid-platform/commit/bdd468466b75bbc216409ccd19d1d0283d775581", "message": "FLEX-3161: Remoded setMetered and setDescription from cucumber CreateDeviceSteps", "committedDate": "2020-04-06T09:52:59Z", "type": "commit"}, {"oid": "0541402432f7620d06a714043cb7dfc025b71b47", "url": "https://github.com/OSGP/open-smart-grid-platform/commit/0541402432f7620d06a714043cb7dfc025b71b47", "message": "/FLEX-3161: adapted existing AddDevice features not to use Metered and Description attributes", "committedDate": "2020-04-06T12:06:54Z", "type": "commit"}, {"oid": "27de12a6f540fda2d37afd9bb22b00287c9dafad", "url": "https://github.com/OSGP/open-smart-grid-platform/commit/27de12a6f540fda2d37afd9bb22b00287c9dafad", "message": "FLEX-3161: Adapted cucumber scenario in AddDevice.feature to include Manufacturer code", "committedDate": "2020-04-07T07:59:43Z", "type": "commit"}, {"oid": "a7ce3cfa557856de3a043a5d14ee844a633ea945", "url": "https://github.com/OSGP/open-smart-grid-platform/commit/a7ce3cfa557856de3a043a5d14ee844a633ea945", "message": "FLEX-3161 Added cucumbertest to test this functionality", "committedDate": "2020-04-09T11:58:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjMwNTY1OA==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/269#discussion_r406305658", "bodyText": "Remove this line.", "author": "rlemmers", "createdAt": "2020-04-09T15:54:02Z", "path": "integration-tests/cucumber-tests-platform-common/src/test/java/org/opensmartgridplatform/cucumber/platform/common/glue/steps/ws/core/deviceinstallation/CreateDeviceSteps.java", "diffHunk": "@@ -62,6 +62,28 @@ public void receivingAnAddDeviceRequestWithAnUnknownOrganization(final Map<Strin\n         this.receivingAnAddDeviceRequest(settings);\n     }\n \n+    @When(\"^receiving an add device request with an unknown manufacturer and device model combination$\")\n+    public void receivingAnAddDeviceRequestWithAnUnknownManufacturerAndDeviceModelCombination(\n+            final Map<String, String> settings) {\n+\n+        System.out.println(\"HELP\");", "originalCommit": "a7ce3cfa557856de3a043a5d14ee844a633ea945", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODAxMTc2NQ==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/269#discussion_r408011765", "bodyText": "hmm.. forgot to commit change it seems.. it should be gone now.", "author": "vsombroek", "createdAt": "2020-04-14T09:53:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjMwNTY1OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyOTE3MQ==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/269#discussion_r406629171", "bodyText": "To get rid of code duplication, add the device model fields (manufacturer and model code) to the map and then call the existing method receivingAnAddDeviceRequest(..).", "author": "rlemmers", "createdAt": "2020-04-10T06:54:23Z", "path": "integration-tests/cucumber-tests-platform-common/src/test/java/org/opensmartgridplatform/cucumber/platform/common/glue/steps/ws/core/deviceinstallation/CreateDeviceSteps.java", "diffHunk": "@@ -62,6 +62,28 @@ public void receivingAnAddDeviceRequestWithAnUnknownOrganization(final Map<Strin\n         this.receivingAnAddDeviceRequest(settings);\n     }\n \n+    @When(\"^receiving an add device request with an unknown manufacturer and device model combination$\")\n+    public void receivingAnAddDeviceRequestWithAnUnknownManufacturerAndDeviceModelCombination(\n+            final Map<String, String> settings) {\n+\n+        System.out.println(\"HELP\");\n+        final AddDeviceRequest request = new AddDeviceRequest();\n+        final Device device = this.createDevice(settings);\n+\n+        final DeviceModel deviceModel = new DeviceModel();\n+        deviceModel.setManufacturer(getString(settings, PlatformKeys.KEY_DEVICE_MODEL_MANUFACTURER,\n+                PlatformCommonDefaults.DEFAULT_DEVICE_MODEL_MANUFACTURER));\n+        deviceModel.setModelCode(getString(settings, PlatformKeys.KEY_DEVICE_MODEL_MODELCODE, \"nonexistingmodel\"));\n+        device.setDeviceModel(deviceModel);\n+        request.setDevice(device);\n+\n+        try {\n+            ScenarioContext.current().put(PlatformKeys.RESPONSE, this.client.addDevice(request));\n+        } catch (final Exception ex) {\n+            ScenarioContext.current().put(PlatformKeys.RESPONSE, ex);\n+        }\n+    }\n+", "originalCommit": "a7ce3cfa557856de3a043a5d14ee844a633ea945", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODAxMjQ3Nw==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/269#discussion_r408012477", "bodyText": "Done.. got rid of this new/custom createDeviceStep completely", "author": "vsombroek", "createdAt": "2020-04-14T09:55:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyOTE3MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYzMDI4Ng==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/269#discussion_r406630286", "bodyText": "Also specify the manufacturer code (now we've stated the manufacturer code and code define the device model). Add the manufacturer code to the device models in the other scenarios as well.", "author": "rlemmers", "createdAt": "2020-04-10T06:58:13Z", "path": "integration-tests/cucumber-tests-platform-common/src/test/resources/features/common/osgp-adapter-ws-core/DeviceInstallation/AddDevice.feature", "diffHunk": "@@ -7,7 +7,6 @@ Feature: CoreDeviceInstallation Device Creating\n   Scenario Outline: Add New Device\n     Given a device model\n       | ModelCode | <ModelCode> |", "originalCommit": "a7ce3cfa557856de3a043a5d14ee844a633ea945", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYzNzMzOQ==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/269#discussion_r406637339", "bodyText": "Why is this needed? The default \"add device\" step should create a valid device, when specifying just a device identification (so scenarios can focus on the parts that are relevant for them).\nWhat manufacturer is used by default in \"add device\"? Perhaps we should set that one to \"Test\"?", "author": "rlemmers", "createdAt": "2020-04-10T07:21:30Z", "path": "integration-tests/cucumber-tests-platform-common/src/test/resources/features/common/osgp-adapter-ws-core/DeviceInstallation/AddDevice.feature", "diffHunk": "@@ -139,24 +129,23 @@ Feature: CoreDeviceInstallation Device Creating\n       | PublicKeyPresent       | <PublicKeyPresent>      |\n       | Manufacturer           | <Manufacturer>          |\n       | DeviceModelCode        | <ModelCode>             |\n-      | DeviceModelDescription | <Description>           |\n-      | Metered                | <Metered>               |\n     Then the add device response contains soap fault\n       | FaultCode        | SOAP-ENV:Client                                                                                                                                                                                                                             |\n       | FaultString      | Validation error                                                                                                                                                                                                                            |\n       | ValidationErrors | cvc-pattern-valid: Value '<DeviceIdentification>' is not facet-valid with respect to pattern '[^ ]{0,40}' for type 'Identification'.;cvc-type.3.1.3: The value '<DeviceIdentification>' of element 'ns2:DeviceIdentification' is not valid. |\n \n     Examples: \n-      | DeviceUid  | DeviceIdentification   | Alias | Owner    | ContainerPostalCode | ContainerCity | ContainerStreet | ContainerNumber | ContainerMunicipality | GpsLatitude | GpsLongitude | Activated | HasSchedule | PublicKeyPresent | Manufacturer | ModelCode  | Description | Metered |\n-      | 1234567890 | \"                    \" |       | test-org | 1234AA              | Maastricht    | Stationsstraat  |              12 |                       |           0 |            0 | false     | false       | false            | Test         | Test Model | Test        | true    |\n+      | DeviceUid  | DeviceIdentification   | Alias | Owner    | ContainerPostalCode | ContainerCity | ContainerStreet | ContainerNumber | ContainerMunicipality | GpsLatitude | GpsLongitude | Activated | HasSchedule | PublicKeyPresent | Manufacturer | ModelCode  |\n+      | 1234567890 | \"                    \" |       | test-org | 1234AA              | Maastricht    | Stationsstraat  |              12 |                       |           0 |            0 | false     | false       | false            | Test         | Test Model |\n \n   Scenario: Add New Device With Unknown Owner Organization\n     Given a device model\n       | ModelCode | Test Model |\n-      | Metered   | true       |\n+      | Manufacturer | Test |\n     When receiving an add device request with an unknown organization\n       | DeviceIdentification | TEST1024000000001 |\n       | Owner                | org-test          |\n+      | Manufacturer         | Test              |", "originalCommit": "a7ce3cfa557856de3a043a5d14ee844a633ea945", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODAxMzYxOQ==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/269#discussion_r408013619", "bodyText": "Default was Kaif .. changed this to Test.. all seems fine now, removed this Manufacturer-setting in some other places too where it wasn't a focussed part of the scenario.", "author": "vsombroek", "createdAt": "2020-04-14T09:56:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYzNzMzOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYzODMzNA==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/269#discussion_r406638334", "bodyText": "Slightly shorter:\nGiven an ssld device\n| DeviceIdentification | TEST1024000000001 |", "author": "rlemmers", "createdAt": "2020-04-10T07:24:27Z", "path": "integration-tests/cucumber-tests-platform-common/src/test/resources/features/common/osgp-adapter-ws-core/DeviceInstallation/AddDevice.feature", "diffHunk": "@@ -234,5 +221,21 @@ Feature: CoreDeviceInstallation Device Creating\n       | Enabled                    | false    |\n     When receiving an add device request\n       | DeviceIdentification | TEST1024000000001 |\n+      | Manufacturer         | Test              |\n     Then the add device response contains soap fault\n       | Message | DISABLED_ORGANISATION |\n+       \n+  Scenario: Add a device with incorrect Model and Manufacturer combination\n+    Given a device\n+      | DeviceIdentification | TEST1024000000001 |\n+      | DeviceType           | SSLD              |", "originalCommit": "a7ce3cfa557856de3a043a5d14ee844a633ea945", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODAxMzY1OQ==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/269#discussion_r408013659", "bodyText": "ok", "author": "vsombroek", "createdAt": "2020-04-14T09:56:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYzODMzNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYzODkxOA==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/269#discussion_r406638918", "bodyText": "\"Kaif\" as device identification?", "author": "rlemmers", "createdAt": "2020-04-10T07:26:15Z", "path": "integration-tests/cucumber-tests-platform-common/src/test/resources/features/common/osgp-adapter-ws-core/DeviceInstallation/AddDevice.feature", "diffHunk": "@@ -234,5 +221,21 @@ Feature: CoreDeviceInstallation Device Creating\n       | Enabled                    | false    |\n     When receiving an add device request\n       | DeviceIdentification | TEST1024000000001 |\n+      | Manufacturer         | Test              |\n     Then the add device response contains soap fault\n       | Message | DISABLED_ORGANISATION |\n+       \n+  Scenario: Add a device with incorrect Model and Manufacturer combination\n+    Given a device\n+      | DeviceIdentification | TEST1024000000001 |\n+      | DeviceType           | SSLD              |\n+    When receiving an add device request with an unknown manufacturer and device model combination\n+      | DeviceIdentification | Kaif             |", "originalCommit": "a7ce3cfa557856de3a043a5d14ee844a633ea945", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODAxMzg5MA==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/269#discussion_r408013890", "bodyText": "This was default, changed it to \"Test\"", "author": "vsombroek", "createdAt": "2020-04-14T09:57:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYzODkxOA=="}], "type": "inlineReview"}, {"oid": "d26dae6f089d61876879ab42fa390b9abd33b617", "url": "https://github.com/OSGP/open-smart-grid-platform/commit/d26dae6f089d61876879ab42fa390b9abd33b617", "message": "changes that arised from the review comments are now implemented\n\nhttps://github.com/OSGP/open-smart-grid-platform/pull/269", "committedDate": "2020-04-14T10:00:00Z", "type": "commit"}]}