{"pr_number": 437, "pr_title": "increased code coverage ConfigurationManagementServices", "pr_createdAt": "2020-09-29T07:06:38Z", "pr_url": "https://github.com/OSGP/open-smart-grid-platform/pull/437", "timeline": [{"oid": "4a51318e36e91afa0aac60743b574863924076fd", "url": "https://github.com/OSGP/open-smart-grid-platform/commit/4a51318e36e91afa0aac60743b574863924076fd", "message": "added first tests. Not finished.", "committedDate": "2020-09-22T09:22:01Z", "type": "commit"}, {"oid": "60634ab9c8ceee1515482f3f85937e839c8284f1", "url": "https://github.com/OSGP/open-smart-grid-platform/commit/60634ab9c8ceee1515482f3f85937e839c8284f1", "message": "changed wrong test, test coverage increased", "committedDate": "2020-09-22T10:47:27Z", "type": "commit"}, {"oid": "40da79404c7b3f48123a1df2ac5ccc4496ec519b", "url": "https://github.com/OSGP/open-smart-grid-platform/commit/40da79404c7b3f48123a1df2ac5ccc4496ec519b", "message": "tests improved and code style applied", "committedDate": "2020-09-24T09:56:31Z", "type": "commit"}, {"oid": "219617eeeecbdb418ca13c8b959bac82249bce79", "url": "https://github.com/OSGP/open-smart-grid-platform/commit/219617eeeecbdb418ca13c8b959bac82249bce79", "message": "more changes, replaced assert from junit with AssertJ", "committedDate": "2020-09-24T11:30:35Z", "type": "commit"}, {"oid": "fb5bb957c4e034c87d5929493c75e1d718116658", "url": "https://github.com/OSGP/open-smart-grid-platform/commit/fb5bb957c4e034c87d5929493c75e1d718116658", "message": "Merge pull request #2 from OSGP/development\n\nUpdating Fork", "committedDate": "2020-09-24T11:43:31Z", "type": "commit"}, {"oid": "e73a5830ceb55721dee46662671229ef2a5bbb9c", "url": "https://github.com/OSGP/open-smart-grid-platform/commit/e73a5830ceb55721dee46662671229ef2a5bbb9c", "message": "Merge branch 'development' into code_quality/Increase_coverage_of_ConfigurationManagementService", "committedDate": "2020-09-24T11:44:09Z", "type": "commit"}, {"oid": "8f4fd6b315a5df92920bc2ebb70aeb43248d5572", "url": "https://github.com/OSGP/open-smart-grid-platform/commit/8f4fd6b315a5df92920bc2ebb70aeb43248d5572", "message": "class variables moved to function", "committedDate": "2020-09-24T12:30:16Z", "type": "commit"}, {"oid": "8a185e21fa2b503ebba41b3a67df1548048198fc", "url": "https://github.com/OSGP/open-smart-grid-platform/commit/8a185e21fa2b503ebba41b3a67df1548048198fc", "message": "clarification for use of reflection", "committedDate": "2020-09-24T13:56:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA3NjE5NQ==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/437#discussion_r503076195", "bodyText": "licence header is missing", "author": "robindenadel", "createdAt": "2020-10-12T06:58:29Z", "path": "osgp/platform/osgp-adapter-domain-core/src/test/java/org/opensmartgridplatform/adapter/domain/core/application/services/ConfigurationManagementServiceTest.java", "diffHunk": "@@ -0,0 +1,290 @@\n+package org.opensmartgridplatform.adapter.domain.core.application.services;", "originalCommit": "8a185e21fa2b503ebba41b3a67df1548048198fc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA3Njc5OA==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/437#discussion_r503076798", "bodyText": "Remove this line; the default strictness is better.\nFix unnecessary stubbing.", "author": "robindenadel", "createdAt": "2020-10-12T06:59:48Z", "path": "osgp/platform/osgp-adapter-domain-core/src/test/java/org/opensmartgridplatform/adapter/domain/core/application/services/ConfigurationManagementServiceTest.java", "diffHunk": "@@ -0,0 +1,290 @@\n+package org.opensmartgridplatform.adapter.domain.core.application.services;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.Mockito.any;\n+import static org.mockito.Mockito.doNothing;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.when;\n+\n+import java.io.ByteArrayOutputStream;\n+import java.io.PrintStream;\n+import java.lang.reflect.Field;\n+import java.util.ArrayList;\n+\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.ArgumentCaptor;\n+import org.mockito.Captor;\n+import org.mockito.InjectMocks;\n+import org.mockito.Mock;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+import org.mockito.junit.jupiter.MockitoSettings;\n+import org.mockito.quality.Strictness;\n+import org.opensmartgridplatform.adapter.domain.core.application.mapping.DomainCoreMapper;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.core.OsgpCoreRequestMessageSender;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.ws.WebServiceResponseMessageSender;\n+import org.opensmartgridplatform.domain.core.entities.Device;\n+import org.opensmartgridplatform.domain.core.entities.Organisation;\n+import org.opensmartgridplatform.domain.core.entities.Ssld;\n+import org.opensmartgridplatform.domain.core.exceptions.UnknownEntityException;\n+import org.opensmartgridplatform.domain.core.repositories.SsldRepository;\n+import org.opensmartgridplatform.domain.core.services.DeviceDomainService;\n+import org.opensmartgridplatform.domain.core.services.OrganisationDomainService;\n+import org.opensmartgridplatform.domain.core.valueobjects.Configuration;\n+import org.opensmartgridplatform.domain.core.valueobjects.RelayConfiguration;\n+import org.opensmartgridplatform.domain.core.valueobjects.RelayMap;\n+import org.opensmartgridplatform.domain.core.valueobjects.RelayType;\n+import org.opensmartgridplatform.dto.valueobjects.ConfigurationDto;\n+import org.opensmartgridplatform.shared.exceptionhandling.ComponentType;\n+import org.opensmartgridplatform.shared.exceptionhandling.FunctionalException;\n+import org.opensmartgridplatform.shared.exceptionhandling.OsgpException;\n+import org.opensmartgridplatform.shared.infra.jms.CorrelationIds;\n+import org.opensmartgridplatform.shared.infra.jms.RequestMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessageResultType;\n+import org.springframework.beans.factory.annotation.Qualifier;\n+\n+@ExtendWith(MockitoExtension.class)\n+@MockitoSettings(strictness = Strictness.LENIENT)", "originalCommit": "8a185e21fa2b503ebba41b3a67df1548048198fc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA3Nzk3MA==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/437#discussion_r503077970", "bodyText": "rename the field to correlationIds", "author": "robindenadel", "createdAt": "2020-10-12T07:02:37Z", "path": "osgp/platform/osgp-adapter-domain-core/src/test/java/org/opensmartgridplatform/adapter/domain/core/application/services/ConfigurationManagementServiceTest.java", "diffHunk": "@@ -0,0 +1,290 @@\n+package org.opensmartgridplatform.adapter.domain.core.application.services;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.Mockito.any;\n+import static org.mockito.Mockito.doNothing;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.when;\n+\n+import java.io.ByteArrayOutputStream;\n+import java.io.PrintStream;\n+import java.lang.reflect.Field;\n+import java.util.ArrayList;\n+\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.ArgumentCaptor;\n+import org.mockito.Captor;\n+import org.mockito.InjectMocks;\n+import org.mockito.Mock;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+import org.mockito.junit.jupiter.MockitoSettings;\n+import org.mockito.quality.Strictness;\n+import org.opensmartgridplatform.adapter.domain.core.application.mapping.DomainCoreMapper;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.core.OsgpCoreRequestMessageSender;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.ws.WebServiceResponseMessageSender;\n+import org.opensmartgridplatform.domain.core.entities.Device;\n+import org.opensmartgridplatform.domain.core.entities.Organisation;\n+import org.opensmartgridplatform.domain.core.entities.Ssld;\n+import org.opensmartgridplatform.domain.core.exceptions.UnknownEntityException;\n+import org.opensmartgridplatform.domain.core.repositories.SsldRepository;\n+import org.opensmartgridplatform.domain.core.services.DeviceDomainService;\n+import org.opensmartgridplatform.domain.core.services.OrganisationDomainService;\n+import org.opensmartgridplatform.domain.core.valueobjects.Configuration;\n+import org.opensmartgridplatform.domain.core.valueobjects.RelayConfiguration;\n+import org.opensmartgridplatform.domain.core.valueobjects.RelayMap;\n+import org.opensmartgridplatform.domain.core.valueobjects.RelayType;\n+import org.opensmartgridplatform.dto.valueobjects.ConfigurationDto;\n+import org.opensmartgridplatform.shared.exceptionhandling.ComponentType;\n+import org.opensmartgridplatform.shared.exceptionhandling.FunctionalException;\n+import org.opensmartgridplatform.shared.exceptionhandling.OsgpException;\n+import org.opensmartgridplatform.shared.infra.jms.CorrelationIds;\n+import org.opensmartgridplatform.shared.infra.jms.RequestMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessageResultType;\n+import org.springframework.beans.factory.annotation.Qualifier;\n+\n+@ExtendWith(MockitoExtension.class)\n+@MockitoSettings(strictness = Strictness.LENIENT)\n+public class ConfigurationManagementServiceTest {\n+    @Mock\n+    private WebServiceResponseMessageSender webServiceResponseMessageSender;\n+    @Mock\n+    private SsldRepository ssldRepository;\n+    @Mock\n+    private ConfigurationDto configurationDto;\n+    @Mock\n+    private DomainCoreMapper domainCoreMapper;\n+    @Mock\n+    private OrganisationDomainService organisationDomainService;\n+    @Mock\n+    private DeviceDomainService deviceDomainService;\n+    @Mock\n+    private CorrelationIds ids;", "originalCommit": "8a185e21fa2b503ebba41b3a67df1548048198fc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA3ODM2OA==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/437#discussion_r503078368", "bodyText": "give this field a descriptive name like messageTypeArgumentCaptor", "author": "robindenadel", "createdAt": "2020-10-12T07:03:36Z", "path": "osgp/platform/osgp-adapter-domain-core/src/test/java/org/opensmartgridplatform/adapter/domain/core/application/services/ConfigurationManagementServiceTest.java", "diffHunk": "@@ -0,0 +1,290 @@\n+package org.opensmartgridplatform.adapter.domain.core.application.services;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.Mockito.any;\n+import static org.mockito.Mockito.doNothing;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.when;\n+\n+import java.io.ByteArrayOutputStream;\n+import java.io.PrintStream;\n+import java.lang.reflect.Field;\n+import java.util.ArrayList;\n+\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.ArgumentCaptor;\n+import org.mockito.Captor;\n+import org.mockito.InjectMocks;\n+import org.mockito.Mock;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+import org.mockito.junit.jupiter.MockitoSettings;\n+import org.mockito.quality.Strictness;\n+import org.opensmartgridplatform.adapter.domain.core.application.mapping.DomainCoreMapper;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.core.OsgpCoreRequestMessageSender;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.ws.WebServiceResponseMessageSender;\n+import org.opensmartgridplatform.domain.core.entities.Device;\n+import org.opensmartgridplatform.domain.core.entities.Organisation;\n+import org.opensmartgridplatform.domain.core.entities.Ssld;\n+import org.opensmartgridplatform.domain.core.exceptions.UnknownEntityException;\n+import org.opensmartgridplatform.domain.core.repositories.SsldRepository;\n+import org.opensmartgridplatform.domain.core.services.DeviceDomainService;\n+import org.opensmartgridplatform.domain.core.services.OrganisationDomainService;\n+import org.opensmartgridplatform.domain.core.valueobjects.Configuration;\n+import org.opensmartgridplatform.domain.core.valueobjects.RelayConfiguration;\n+import org.opensmartgridplatform.domain.core.valueobjects.RelayMap;\n+import org.opensmartgridplatform.domain.core.valueobjects.RelayType;\n+import org.opensmartgridplatform.dto.valueobjects.ConfigurationDto;\n+import org.opensmartgridplatform.shared.exceptionhandling.ComponentType;\n+import org.opensmartgridplatform.shared.exceptionhandling.FunctionalException;\n+import org.opensmartgridplatform.shared.exceptionhandling.OsgpException;\n+import org.opensmartgridplatform.shared.infra.jms.CorrelationIds;\n+import org.opensmartgridplatform.shared.infra.jms.RequestMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessageResultType;\n+import org.springframework.beans.factory.annotation.Qualifier;\n+\n+@ExtendWith(MockitoExtension.class)\n+@MockitoSettings(strictness = Strictness.LENIENT)\n+public class ConfigurationManagementServiceTest {\n+    @Mock\n+    private WebServiceResponseMessageSender webServiceResponseMessageSender;\n+    @Mock\n+    private SsldRepository ssldRepository;\n+    @Mock\n+    private ConfigurationDto configurationDto;\n+    @Mock\n+    private DomainCoreMapper domainCoreMapper;\n+    @Mock\n+    private OrganisationDomainService organisationDomainService;\n+    @Mock\n+    private DeviceDomainService deviceDomainService;\n+    @Mock\n+    private CorrelationIds ids;\n+    @Mock\n+    private Configuration configuration;\n+    @Mock\n+    private OsgpCoreRequestMessageSender osgpCoreRequestMessageSender;\n+    @Mock\n+    private Ssld ssld;\n+    @Mock\n+    private Device device;\n+    @Captor\n+    private ArgumentCaptor<RequestMessage> requestMessageArgumentCaptor;\n+    @Captor\n+    private ArgumentCaptor<String> stringArgumentCaptorOne;", "originalCommit": "8a185e21fa2b503ebba41b3a67df1548048198fc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA3ODUxNQ==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/437#discussion_r503078515", "bodyText": "give this field a descriptive name like ipAddressArgumentCaptor", "author": "robindenadel", "createdAt": "2020-10-12T07:03:58Z", "path": "osgp/platform/osgp-adapter-domain-core/src/test/java/org/opensmartgridplatform/adapter/domain/core/application/services/ConfigurationManagementServiceTest.java", "diffHunk": "@@ -0,0 +1,290 @@\n+package org.opensmartgridplatform.adapter.domain.core.application.services;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.Mockito.any;\n+import static org.mockito.Mockito.doNothing;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.when;\n+\n+import java.io.ByteArrayOutputStream;\n+import java.io.PrintStream;\n+import java.lang.reflect.Field;\n+import java.util.ArrayList;\n+\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.ArgumentCaptor;\n+import org.mockito.Captor;\n+import org.mockito.InjectMocks;\n+import org.mockito.Mock;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+import org.mockito.junit.jupiter.MockitoSettings;\n+import org.mockito.quality.Strictness;\n+import org.opensmartgridplatform.adapter.domain.core.application.mapping.DomainCoreMapper;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.core.OsgpCoreRequestMessageSender;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.ws.WebServiceResponseMessageSender;\n+import org.opensmartgridplatform.domain.core.entities.Device;\n+import org.opensmartgridplatform.domain.core.entities.Organisation;\n+import org.opensmartgridplatform.domain.core.entities.Ssld;\n+import org.opensmartgridplatform.domain.core.exceptions.UnknownEntityException;\n+import org.opensmartgridplatform.domain.core.repositories.SsldRepository;\n+import org.opensmartgridplatform.domain.core.services.DeviceDomainService;\n+import org.opensmartgridplatform.domain.core.services.OrganisationDomainService;\n+import org.opensmartgridplatform.domain.core.valueobjects.Configuration;\n+import org.opensmartgridplatform.domain.core.valueobjects.RelayConfiguration;\n+import org.opensmartgridplatform.domain.core.valueobjects.RelayMap;\n+import org.opensmartgridplatform.domain.core.valueobjects.RelayType;\n+import org.opensmartgridplatform.dto.valueobjects.ConfigurationDto;\n+import org.opensmartgridplatform.shared.exceptionhandling.ComponentType;\n+import org.opensmartgridplatform.shared.exceptionhandling.FunctionalException;\n+import org.opensmartgridplatform.shared.exceptionhandling.OsgpException;\n+import org.opensmartgridplatform.shared.infra.jms.CorrelationIds;\n+import org.opensmartgridplatform.shared.infra.jms.RequestMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessageResultType;\n+import org.springframework.beans.factory.annotation.Qualifier;\n+\n+@ExtendWith(MockitoExtension.class)\n+@MockitoSettings(strictness = Strictness.LENIENT)\n+public class ConfigurationManagementServiceTest {\n+    @Mock\n+    private WebServiceResponseMessageSender webServiceResponseMessageSender;\n+    @Mock\n+    private SsldRepository ssldRepository;\n+    @Mock\n+    private ConfigurationDto configurationDto;\n+    @Mock\n+    private DomainCoreMapper domainCoreMapper;\n+    @Mock\n+    private OrganisationDomainService organisationDomainService;\n+    @Mock\n+    private DeviceDomainService deviceDomainService;\n+    @Mock\n+    private CorrelationIds ids;\n+    @Mock\n+    private Configuration configuration;\n+    @Mock\n+    private OsgpCoreRequestMessageSender osgpCoreRequestMessageSender;\n+    @Mock\n+    private Ssld ssld;\n+    @Mock\n+    private Device device;\n+    @Captor\n+    private ArgumentCaptor<RequestMessage> requestMessageArgumentCaptor;\n+    @Captor\n+    private ArgumentCaptor<String> stringArgumentCaptorOne;\n+    @Captor\n+    private ArgumentCaptor<String> stringArgumentCaptorTwo;", "originalCommit": "8a185e21fa2b503ebba41b3a67df1548048198fc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA3ODczOA==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/437#discussion_r503078738", "bodyText": "give this field a descriptive name like priorityArgumentCaptor", "author": "robindenadel", "createdAt": "2020-10-12T07:04:23Z", "path": "osgp/platform/osgp-adapter-domain-core/src/test/java/org/opensmartgridplatform/adapter/domain/core/application/services/ConfigurationManagementServiceTest.java", "diffHunk": "@@ -0,0 +1,290 @@\n+package org.opensmartgridplatform.adapter.domain.core.application.services;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.Mockito.any;\n+import static org.mockito.Mockito.doNothing;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.when;\n+\n+import java.io.ByteArrayOutputStream;\n+import java.io.PrintStream;\n+import java.lang.reflect.Field;\n+import java.util.ArrayList;\n+\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.ArgumentCaptor;\n+import org.mockito.Captor;\n+import org.mockito.InjectMocks;\n+import org.mockito.Mock;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+import org.mockito.junit.jupiter.MockitoSettings;\n+import org.mockito.quality.Strictness;\n+import org.opensmartgridplatform.adapter.domain.core.application.mapping.DomainCoreMapper;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.core.OsgpCoreRequestMessageSender;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.ws.WebServiceResponseMessageSender;\n+import org.opensmartgridplatform.domain.core.entities.Device;\n+import org.opensmartgridplatform.domain.core.entities.Organisation;\n+import org.opensmartgridplatform.domain.core.entities.Ssld;\n+import org.opensmartgridplatform.domain.core.exceptions.UnknownEntityException;\n+import org.opensmartgridplatform.domain.core.repositories.SsldRepository;\n+import org.opensmartgridplatform.domain.core.services.DeviceDomainService;\n+import org.opensmartgridplatform.domain.core.services.OrganisationDomainService;\n+import org.opensmartgridplatform.domain.core.valueobjects.Configuration;\n+import org.opensmartgridplatform.domain.core.valueobjects.RelayConfiguration;\n+import org.opensmartgridplatform.domain.core.valueobjects.RelayMap;\n+import org.opensmartgridplatform.domain.core.valueobjects.RelayType;\n+import org.opensmartgridplatform.dto.valueobjects.ConfigurationDto;\n+import org.opensmartgridplatform.shared.exceptionhandling.ComponentType;\n+import org.opensmartgridplatform.shared.exceptionhandling.FunctionalException;\n+import org.opensmartgridplatform.shared.exceptionhandling.OsgpException;\n+import org.opensmartgridplatform.shared.infra.jms.CorrelationIds;\n+import org.opensmartgridplatform.shared.infra.jms.RequestMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessageResultType;\n+import org.springframework.beans.factory.annotation.Qualifier;\n+\n+@ExtendWith(MockitoExtension.class)\n+@MockitoSettings(strictness = Strictness.LENIENT)\n+public class ConfigurationManagementServiceTest {\n+    @Mock\n+    private WebServiceResponseMessageSender webServiceResponseMessageSender;\n+    @Mock\n+    private SsldRepository ssldRepository;\n+    @Mock\n+    private ConfigurationDto configurationDto;\n+    @Mock\n+    private DomainCoreMapper domainCoreMapper;\n+    @Mock\n+    private OrganisationDomainService organisationDomainService;\n+    @Mock\n+    private DeviceDomainService deviceDomainService;\n+    @Mock\n+    private CorrelationIds ids;\n+    @Mock\n+    private Configuration configuration;\n+    @Mock\n+    private OsgpCoreRequestMessageSender osgpCoreRequestMessageSender;\n+    @Mock\n+    private Ssld ssld;\n+    @Mock\n+    private Device device;\n+    @Captor\n+    private ArgumentCaptor<RequestMessage> requestMessageArgumentCaptor;\n+    @Captor\n+    private ArgumentCaptor<String> stringArgumentCaptorOne;\n+    @Captor\n+    private ArgumentCaptor<String> stringArgumentCaptorTwo;\n+    @Captor\n+    private ArgumentCaptor<Integer> integerArgumentCaptor;", "originalCommit": "8a185e21fa2b503ebba41b3a67df1548048198fc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA4MTQ0NQ==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/437#discussion_r503081445", "bodyText": "give this field a descriptive name like scheduledTimeArgumentCaptor", "author": "robindenadel", "createdAt": "2020-10-12T07:10:10Z", "path": "osgp/platform/osgp-adapter-domain-core/src/test/java/org/opensmartgridplatform/adapter/domain/core/application/services/ConfigurationManagementServiceTest.java", "diffHunk": "@@ -0,0 +1,290 @@\n+package org.opensmartgridplatform.adapter.domain.core.application.services;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.Mockito.any;\n+import static org.mockito.Mockito.doNothing;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.when;\n+\n+import java.io.ByteArrayOutputStream;\n+import java.io.PrintStream;\n+import java.lang.reflect.Field;\n+import java.util.ArrayList;\n+\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.ArgumentCaptor;\n+import org.mockito.Captor;\n+import org.mockito.InjectMocks;\n+import org.mockito.Mock;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+import org.mockito.junit.jupiter.MockitoSettings;\n+import org.mockito.quality.Strictness;\n+import org.opensmartgridplatform.adapter.domain.core.application.mapping.DomainCoreMapper;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.core.OsgpCoreRequestMessageSender;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.ws.WebServiceResponseMessageSender;\n+import org.opensmartgridplatform.domain.core.entities.Device;\n+import org.opensmartgridplatform.domain.core.entities.Organisation;\n+import org.opensmartgridplatform.domain.core.entities.Ssld;\n+import org.opensmartgridplatform.domain.core.exceptions.UnknownEntityException;\n+import org.opensmartgridplatform.domain.core.repositories.SsldRepository;\n+import org.opensmartgridplatform.domain.core.services.DeviceDomainService;\n+import org.opensmartgridplatform.domain.core.services.OrganisationDomainService;\n+import org.opensmartgridplatform.domain.core.valueobjects.Configuration;\n+import org.opensmartgridplatform.domain.core.valueobjects.RelayConfiguration;\n+import org.opensmartgridplatform.domain.core.valueobjects.RelayMap;\n+import org.opensmartgridplatform.domain.core.valueobjects.RelayType;\n+import org.opensmartgridplatform.dto.valueobjects.ConfigurationDto;\n+import org.opensmartgridplatform.shared.exceptionhandling.ComponentType;\n+import org.opensmartgridplatform.shared.exceptionhandling.FunctionalException;\n+import org.opensmartgridplatform.shared.exceptionhandling.OsgpException;\n+import org.opensmartgridplatform.shared.infra.jms.CorrelationIds;\n+import org.opensmartgridplatform.shared.infra.jms.RequestMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessageResultType;\n+import org.springframework.beans.factory.annotation.Qualifier;\n+\n+@ExtendWith(MockitoExtension.class)\n+@MockitoSettings(strictness = Strictness.LENIENT)\n+public class ConfigurationManagementServiceTest {\n+    @Mock\n+    private WebServiceResponseMessageSender webServiceResponseMessageSender;\n+    @Mock\n+    private SsldRepository ssldRepository;\n+    @Mock\n+    private ConfigurationDto configurationDto;\n+    @Mock\n+    private DomainCoreMapper domainCoreMapper;\n+    @Mock\n+    private OrganisationDomainService organisationDomainService;\n+    @Mock\n+    private DeviceDomainService deviceDomainService;\n+    @Mock\n+    private CorrelationIds ids;\n+    @Mock\n+    private Configuration configuration;\n+    @Mock\n+    private OsgpCoreRequestMessageSender osgpCoreRequestMessageSender;\n+    @Mock\n+    private Ssld ssld;\n+    @Mock\n+    private Device device;\n+    @Captor\n+    private ArgumentCaptor<RequestMessage> requestMessageArgumentCaptor;\n+    @Captor\n+    private ArgumentCaptor<String> stringArgumentCaptorOne;\n+    @Captor\n+    private ArgumentCaptor<String> stringArgumentCaptorTwo;\n+    @Captor\n+    private ArgumentCaptor<Integer> integerArgumentCaptor;\n+    @Captor\n+    private ArgumentCaptor<Long> longArgumentCaptor;", "originalCommit": "8a185e21fa2b503ebba41b3a67df1548048198fc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA4MjU3Mw==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/437#discussion_r503082573", "bodyText": "whole file: Add some blank lines to arrange some code blocks.\nSee https://www.oracle.com/java/technologies/javase/codeconventions-indentation.html", "author": "robindenadel", "createdAt": "2020-10-12T07:12:29Z", "path": "osgp/platform/osgp-adapter-domain-core/src/test/java/org/opensmartgridplatform/adapter/domain/core/application/services/ConfigurationManagementServiceTest.java", "diffHunk": "@@ -0,0 +1,290 @@\n+package org.opensmartgridplatform.adapter.domain.core.application.services;", "originalCommit": "8a185e21fa2b503ebba41b3a67df1548048198fc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA5ODI1Mw==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/437#discussion_r503098253", "bodyText": "you've created the fields\nprivate final String organisationIdentification = \"a\";\nprivate final String deviceIdentification = \"b\";\nprivate final String correlationUid = \"c\"\nand still uses \"a\", \"b\" and \"c\" in the test code. This is very odd.\nRefactor the fields to constants, and use these constants in the test code.", "author": "robindenadel", "createdAt": "2020-10-12T07:44:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA4MjU3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA5ODczNQ==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/437#discussion_r503098735", "bodyText": "reduce duplicate code by introducing some methods", "author": "robindenadel", "createdAt": "2020-10-12T07:44:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA4MjU3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzc3ODI2Mg==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/437#discussion_r503778262", "bodyText": "I removed some unnecessary parts, but which duplicate code needs to be reduced. I only have blocks of Mockito.when and Assertions.assertThat. These blocks very between classes and don't seem very suitable for being placed in a seperate method.", "author": "mvanOsch", "createdAt": "2020-10-13T08:50:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA4MjU3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTQyNjkyNg==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/437#discussion_r531426926", "bodyText": "For example, some when blocks could be refactored to a method\n    private void arrangeOrganisationDeviceAndIpAddress(final Organisation organisation, final Device activeDevice,\n            final String ipAddress) throws UnknownEntityException, FunctionalException {\n        when(this.organisationDomainService.searchOrganisation(any(String.class))).thenReturn(organisation);\n        when(this.deviceDomainService.searchActiveDevice(any(), any())).thenReturn(activeDevice);\n        when(activeDevice.getIpAddress()).thenReturn(ipAddress);\n    }\n\nand call this method like this\nthis.arrangeOrganisationDeviceAndIpAddress(new Organisation(), this.device, IP_ADDRESS);", "author": "robindenadel", "createdAt": "2020-11-27T07:39:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA4MjU3Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA4NDg5OA==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/437#discussion_r503084898", "bodyText": "ids -> correlation ids", "author": "robindenadel", "createdAt": "2020-10-12T07:17:22Z", "path": "osgp/platform/osgp-adapter-domain-core/src/test/java/org/opensmartgridplatform/adapter/domain/core/application/services/ConfigurationManagementServiceTest.java", "diffHunk": "@@ -0,0 +1,290 @@\n+package org.opensmartgridplatform.adapter.domain.core.application.services;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.Mockito.any;\n+import static org.mockito.Mockito.doNothing;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.when;\n+\n+import java.io.ByteArrayOutputStream;\n+import java.io.PrintStream;\n+import java.lang.reflect.Field;\n+import java.util.ArrayList;\n+\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.ArgumentCaptor;\n+import org.mockito.Captor;\n+import org.mockito.InjectMocks;\n+import org.mockito.Mock;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+import org.mockito.junit.jupiter.MockitoSettings;\n+import org.mockito.quality.Strictness;\n+import org.opensmartgridplatform.adapter.domain.core.application.mapping.DomainCoreMapper;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.core.OsgpCoreRequestMessageSender;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.ws.WebServiceResponseMessageSender;\n+import org.opensmartgridplatform.domain.core.entities.Device;\n+import org.opensmartgridplatform.domain.core.entities.Organisation;\n+import org.opensmartgridplatform.domain.core.entities.Ssld;\n+import org.opensmartgridplatform.domain.core.exceptions.UnknownEntityException;\n+import org.opensmartgridplatform.domain.core.repositories.SsldRepository;\n+import org.opensmartgridplatform.domain.core.services.DeviceDomainService;\n+import org.opensmartgridplatform.domain.core.services.OrganisationDomainService;\n+import org.opensmartgridplatform.domain.core.valueobjects.Configuration;\n+import org.opensmartgridplatform.domain.core.valueobjects.RelayConfiguration;\n+import org.opensmartgridplatform.domain.core.valueobjects.RelayMap;\n+import org.opensmartgridplatform.domain.core.valueobjects.RelayType;\n+import org.opensmartgridplatform.dto.valueobjects.ConfigurationDto;\n+import org.opensmartgridplatform.shared.exceptionhandling.ComponentType;\n+import org.opensmartgridplatform.shared.exceptionhandling.FunctionalException;\n+import org.opensmartgridplatform.shared.exceptionhandling.OsgpException;\n+import org.opensmartgridplatform.shared.infra.jms.CorrelationIds;\n+import org.opensmartgridplatform.shared.infra.jms.RequestMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessageResultType;\n+import org.springframework.beans.factory.annotation.Qualifier;\n+\n+@ExtendWith(MockitoExtension.class)\n+@MockitoSettings(strictness = Strictness.LENIENT)\n+public class ConfigurationManagementServiceTest {\n+    @Mock\n+    private WebServiceResponseMessageSender webServiceResponseMessageSender;\n+    @Mock\n+    private SsldRepository ssldRepository;\n+    @Mock\n+    private ConfigurationDto configurationDto;\n+    @Mock\n+    private DomainCoreMapper domainCoreMapper;\n+    @Mock\n+    private OrganisationDomainService organisationDomainService;\n+    @Mock\n+    private DeviceDomainService deviceDomainService;\n+    @Mock\n+    private CorrelationIds ids;\n+    @Mock\n+    private Configuration configuration;\n+    @Mock\n+    private OsgpCoreRequestMessageSender osgpCoreRequestMessageSender;\n+    @Mock\n+    private Ssld ssld;\n+    @Mock\n+    private Device device;\n+    @Captor\n+    private ArgumentCaptor<RequestMessage> requestMessageArgumentCaptor;\n+    @Captor\n+    private ArgumentCaptor<String> stringArgumentCaptorOne;\n+    @Captor\n+    private ArgumentCaptor<String> stringArgumentCaptorTwo;\n+    @Captor\n+    private ArgumentCaptor<Integer> integerArgumentCaptor;\n+    @Captor\n+    private ArgumentCaptor<Long> longArgumentCaptor;\n+    @Captor\n+    private ArgumentCaptor<ResponseMessage> responseMessageArgumentCaptor;\n+    @InjectMocks\n+    @Qualifier(\"organisationDomainService\")\n+    private ConfigurationManagementService configurationManagementService;\n+    private final String organisationIdentification = \"a\";\n+    private final String deviceIdentification = \"b\";\n+    private final String correlationUid = \"c\";\n+    private OsgpException exception;\n+    private final ByteArrayOutputStream outContent = new ByteArrayOutputStream();\n+    @BeforeEach\n+    public void setUp() throws NoSuchFieldException,\n+            SecurityException, IllegalArgumentException, IllegalAccessException {\n+        // make ids", "originalCommit": "8a185e21fa2b503ebba41b3a67df1548048198fc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA4NjQ4MA==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/437#discussion_r503086480", "bodyText": "remove this unnecessary code", "author": "robindenadel", "createdAt": "2020-10-12T07:20:46Z", "path": "osgp/platform/osgp-adapter-domain-core/src/test/java/org/opensmartgridplatform/adapter/domain/core/application/services/ConfigurationManagementServiceTest.java", "diffHunk": "@@ -0,0 +1,290 @@\n+package org.opensmartgridplatform.adapter.domain.core.application.services;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.Mockito.any;\n+import static org.mockito.Mockito.doNothing;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.when;\n+\n+import java.io.ByteArrayOutputStream;\n+import java.io.PrintStream;\n+import java.lang.reflect.Field;\n+import java.util.ArrayList;\n+\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.ArgumentCaptor;\n+import org.mockito.Captor;\n+import org.mockito.InjectMocks;\n+import org.mockito.Mock;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+import org.mockito.junit.jupiter.MockitoSettings;\n+import org.mockito.quality.Strictness;\n+import org.opensmartgridplatform.adapter.domain.core.application.mapping.DomainCoreMapper;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.core.OsgpCoreRequestMessageSender;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.ws.WebServiceResponseMessageSender;\n+import org.opensmartgridplatform.domain.core.entities.Device;\n+import org.opensmartgridplatform.domain.core.entities.Organisation;\n+import org.opensmartgridplatform.domain.core.entities.Ssld;\n+import org.opensmartgridplatform.domain.core.exceptions.UnknownEntityException;\n+import org.opensmartgridplatform.domain.core.repositories.SsldRepository;\n+import org.opensmartgridplatform.domain.core.services.DeviceDomainService;\n+import org.opensmartgridplatform.domain.core.services.OrganisationDomainService;\n+import org.opensmartgridplatform.domain.core.valueobjects.Configuration;\n+import org.opensmartgridplatform.domain.core.valueobjects.RelayConfiguration;\n+import org.opensmartgridplatform.domain.core.valueobjects.RelayMap;\n+import org.opensmartgridplatform.domain.core.valueobjects.RelayType;\n+import org.opensmartgridplatform.dto.valueobjects.ConfigurationDto;\n+import org.opensmartgridplatform.shared.exceptionhandling.ComponentType;\n+import org.opensmartgridplatform.shared.exceptionhandling.FunctionalException;\n+import org.opensmartgridplatform.shared.exceptionhandling.OsgpException;\n+import org.opensmartgridplatform.shared.infra.jms.CorrelationIds;\n+import org.opensmartgridplatform.shared.infra.jms.RequestMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessageResultType;\n+import org.springframework.beans.factory.annotation.Qualifier;\n+\n+@ExtendWith(MockitoExtension.class)\n+@MockitoSettings(strictness = Strictness.LENIENT)\n+public class ConfigurationManagementServiceTest {\n+    @Mock\n+    private WebServiceResponseMessageSender webServiceResponseMessageSender;\n+    @Mock\n+    private SsldRepository ssldRepository;\n+    @Mock\n+    private ConfigurationDto configurationDto;\n+    @Mock\n+    private DomainCoreMapper domainCoreMapper;\n+    @Mock\n+    private OrganisationDomainService organisationDomainService;\n+    @Mock\n+    private DeviceDomainService deviceDomainService;\n+    @Mock\n+    private CorrelationIds ids;\n+    @Mock\n+    private Configuration configuration;\n+    @Mock\n+    private OsgpCoreRequestMessageSender osgpCoreRequestMessageSender;\n+    @Mock\n+    private Ssld ssld;\n+    @Mock\n+    private Device device;\n+    @Captor\n+    private ArgumentCaptor<RequestMessage> requestMessageArgumentCaptor;\n+    @Captor\n+    private ArgumentCaptor<String> stringArgumentCaptorOne;\n+    @Captor\n+    private ArgumentCaptor<String> stringArgumentCaptorTwo;\n+    @Captor\n+    private ArgumentCaptor<Integer> integerArgumentCaptor;\n+    @Captor\n+    private ArgumentCaptor<Long> longArgumentCaptor;\n+    @Captor\n+    private ArgumentCaptor<ResponseMessage> responseMessageArgumentCaptor;\n+    @InjectMocks\n+    @Qualifier(\"organisationDomainService\")\n+    private ConfigurationManagementService configurationManagementService;\n+    private final String organisationIdentification = \"a\";\n+    private final String deviceIdentification = \"b\";\n+    private final String correlationUid = \"c\";\n+    private OsgpException exception;\n+    private final ByteArrayOutputStream outContent = new ByteArrayOutputStream();\n+    @BeforeEach\n+    public void setUp() throws NoSuchFieldException,\n+            SecurityException, IllegalArgumentException, IllegalAccessException {\n+        // make ids\n+        this.ids = new CorrelationIds(this.organisationIdentification, this.deviceIdentification, this.correlationUid);\n+        this.configurationManagementService = new ConfigurationManagementService();\n+\n+        // do injection using reflection\n+        // Inject Mocks doesn't inject these mocks, possibly because they are in the parent class of\n+        // ConfigurationManagementService\n+        this.injectionUsingReflection(AbstractService.class, \"organisationDomainService\",\n+                this.configurationManagementService, this.organisationDomainService);\n+        this.injectionUsingReflection(AbstractService.class, \"deviceDomainService\", this.configurationManagementService,\n+                this.deviceDomainService);\n+        this.injectionUsingReflection(AbstractService.class, \"domainCoreMapper\", this.configurationManagementService,\n+                this.domainCoreMapper);\n+        this.injectionUsingReflection(AbstractService.class, \"osgpCoreRequestMessageSender\",\n+                this.configurationManagementService, this.osgpCoreRequestMessageSender);\n+        this.injectionUsingReflection(AbstractService.class, \"webServiceResponseMessageSender\",\n+                this.configurationManagementService, this.webServiceResponseMessageSender);\n+        this.injectionUsingReflection(AbstractService.class, \"ssldRepository\", this.configurationManagementService,\n+                this.ssldRepository);", "originalCommit": "8a185e21fa2b503ebba41b3a67df1548048198fc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzc3NTc2NA==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/437#discussion_r503775764", "bodyText": "This code doesn't seem to be unnecessary. Mockito's injection with the Mock annotation doesn't seem to work, possibly because the fields are actually in the parent class AbstractService rather than in ConfigurationManagementService. Simply removing the code results in nullpointer exceptions because the mock is never inserted.", "author": "mvanOsch", "createdAt": "2020-10-13T08:46:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA4NjQ4MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ3MTY2NQ==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/437#discussion_r516471665", "bodyText": "it works without this code block", "author": "robindenadel", "createdAt": "2020-11-03T07:44:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA4NjQ4MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTQyODcyMw==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/437#discussion_r531428723", "bodyText": "you really should change this", "author": "robindenadel", "createdAt": "2020-11-27T07:44:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA4NjQ4MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA4Nzc4Mw==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/437#discussion_r503087783", "bodyText": "Since we are going to check for these values in the assert part of more than one test, refactor these into constants", "author": "robindenadel", "createdAt": "2020-10-12T07:23:20Z", "path": "osgp/platform/osgp-adapter-domain-core/src/test/java/org/opensmartgridplatform/adapter/domain/core/application/services/ConfigurationManagementServiceTest.java", "diffHunk": "@@ -0,0 +1,290 @@\n+package org.opensmartgridplatform.adapter.domain.core.application.services;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.Mockito.any;\n+import static org.mockito.Mockito.doNothing;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.when;\n+\n+import java.io.ByteArrayOutputStream;\n+import java.io.PrintStream;\n+import java.lang.reflect.Field;\n+import java.util.ArrayList;\n+\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.ArgumentCaptor;\n+import org.mockito.Captor;\n+import org.mockito.InjectMocks;\n+import org.mockito.Mock;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+import org.mockito.junit.jupiter.MockitoSettings;\n+import org.mockito.quality.Strictness;\n+import org.opensmartgridplatform.adapter.domain.core.application.mapping.DomainCoreMapper;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.core.OsgpCoreRequestMessageSender;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.ws.WebServiceResponseMessageSender;\n+import org.opensmartgridplatform.domain.core.entities.Device;\n+import org.opensmartgridplatform.domain.core.entities.Organisation;\n+import org.opensmartgridplatform.domain.core.entities.Ssld;\n+import org.opensmartgridplatform.domain.core.exceptions.UnknownEntityException;\n+import org.opensmartgridplatform.domain.core.repositories.SsldRepository;\n+import org.opensmartgridplatform.domain.core.services.DeviceDomainService;\n+import org.opensmartgridplatform.domain.core.services.OrganisationDomainService;\n+import org.opensmartgridplatform.domain.core.valueobjects.Configuration;\n+import org.opensmartgridplatform.domain.core.valueobjects.RelayConfiguration;\n+import org.opensmartgridplatform.domain.core.valueobjects.RelayMap;\n+import org.opensmartgridplatform.domain.core.valueobjects.RelayType;\n+import org.opensmartgridplatform.dto.valueobjects.ConfigurationDto;\n+import org.opensmartgridplatform.shared.exceptionhandling.ComponentType;\n+import org.opensmartgridplatform.shared.exceptionhandling.FunctionalException;\n+import org.opensmartgridplatform.shared.exceptionhandling.OsgpException;\n+import org.opensmartgridplatform.shared.infra.jms.CorrelationIds;\n+import org.opensmartgridplatform.shared.infra.jms.RequestMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessageResultType;\n+import org.springframework.beans.factory.annotation.Qualifier;\n+\n+@ExtendWith(MockitoExtension.class)\n+@MockitoSettings(strictness = Strictness.LENIENT)\n+public class ConfigurationManagementServiceTest {\n+    @Mock\n+    private WebServiceResponseMessageSender webServiceResponseMessageSender;\n+    @Mock\n+    private SsldRepository ssldRepository;\n+    @Mock\n+    private ConfigurationDto configurationDto;\n+    @Mock\n+    private DomainCoreMapper domainCoreMapper;\n+    @Mock\n+    private OrganisationDomainService organisationDomainService;\n+    @Mock\n+    private DeviceDomainService deviceDomainService;\n+    @Mock\n+    private CorrelationIds ids;\n+    @Mock\n+    private Configuration configuration;\n+    @Mock\n+    private OsgpCoreRequestMessageSender osgpCoreRequestMessageSender;\n+    @Mock\n+    private Ssld ssld;\n+    @Mock\n+    private Device device;\n+    @Captor\n+    private ArgumentCaptor<RequestMessage> requestMessageArgumentCaptor;\n+    @Captor\n+    private ArgumentCaptor<String> stringArgumentCaptorOne;\n+    @Captor\n+    private ArgumentCaptor<String> stringArgumentCaptorTwo;\n+    @Captor\n+    private ArgumentCaptor<Integer> integerArgumentCaptor;\n+    @Captor\n+    private ArgumentCaptor<Long> longArgumentCaptor;\n+    @Captor\n+    private ArgumentCaptor<ResponseMessage> responseMessageArgumentCaptor;\n+    @InjectMocks\n+    @Qualifier(\"organisationDomainService\")\n+    private ConfigurationManagementService configurationManagementService;\n+    private final String organisationIdentification = \"a\";\n+    private final String deviceIdentification = \"b\";\n+    private final String correlationUid = \"c\";\n+    private OsgpException exception;\n+    private final ByteArrayOutputStream outContent = new ByteArrayOutputStream();\n+    @BeforeEach\n+    public void setUp() throws NoSuchFieldException,\n+            SecurityException, IllegalArgumentException, IllegalAccessException {\n+        // make ids\n+        this.ids = new CorrelationIds(this.organisationIdentification, this.deviceIdentification, this.correlationUid);\n+        this.configurationManagementService = new ConfigurationManagementService();\n+\n+        // do injection using reflection\n+        // Inject Mocks doesn't inject these mocks, possibly because they are in the parent class of\n+        // ConfigurationManagementService\n+        this.injectionUsingReflection(AbstractService.class, \"organisationDomainService\",\n+                this.configurationManagementService, this.organisationDomainService);\n+        this.injectionUsingReflection(AbstractService.class, \"deviceDomainService\", this.configurationManagementService,\n+                this.deviceDomainService);\n+        this.injectionUsingReflection(AbstractService.class, \"domainCoreMapper\", this.configurationManagementService,\n+                this.domainCoreMapper);\n+        this.injectionUsingReflection(AbstractService.class, \"osgpCoreRequestMessageSender\",\n+                this.configurationManagementService, this.osgpCoreRequestMessageSender);\n+        this.injectionUsingReflection(AbstractService.class, \"webServiceResponseMessageSender\",\n+                this.configurationManagementService, this.webServiceResponseMessageSender);\n+        this.injectionUsingReflection(AbstractService.class, \"ssldRepository\", this.configurationManagementService,\n+                this.ssldRepository);\n+\n+        System.setOut(new PrintStream(this.outContent));\n+    }\n+    @Test\n+    public void testTrySetConfiguration() throws FunctionalException, UnknownEntityException {\n+        final long scheduleTime = 1;\n+        final String messageType = \"none\";\n+        final int messagePriority = 1;\n+\n+        final Organisation testOrganisation = new Organisation();", "originalCommit": "8a185e21fa2b503ebba41b3a67df1548048198fc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ3MzYwMA==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/437#discussion_r516473600", "bodyText": "testOrganisation is still not a constant", "author": "robindenadel", "createdAt": "2020-11-03T07:49:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA4Nzc4Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA4OTI0Nw==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/437#discussion_r503089247", "bodyText": "you can use\nList relayMapList = Arrays.asList(relayMap);\ninstead", "author": "robindenadel", "createdAt": "2020-10-12T07:26:17Z", "path": "osgp/platform/osgp-adapter-domain-core/src/test/java/org/opensmartgridplatform/adapter/domain/core/application/services/ConfigurationManagementServiceTest.java", "diffHunk": "@@ -0,0 +1,290 @@\n+package org.opensmartgridplatform.adapter.domain.core.application.services;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.Mockito.any;\n+import static org.mockito.Mockito.doNothing;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.when;\n+\n+import java.io.ByteArrayOutputStream;\n+import java.io.PrintStream;\n+import java.lang.reflect.Field;\n+import java.util.ArrayList;\n+\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.ArgumentCaptor;\n+import org.mockito.Captor;\n+import org.mockito.InjectMocks;\n+import org.mockito.Mock;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+import org.mockito.junit.jupiter.MockitoSettings;\n+import org.mockito.quality.Strictness;\n+import org.opensmartgridplatform.adapter.domain.core.application.mapping.DomainCoreMapper;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.core.OsgpCoreRequestMessageSender;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.ws.WebServiceResponseMessageSender;\n+import org.opensmartgridplatform.domain.core.entities.Device;\n+import org.opensmartgridplatform.domain.core.entities.Organisation;\n+import org.opensmartgridplatform.domain.core.entities.Ssld;\n+import org.opensmartgridplatform.domain.core.exceptions.UnknownEntityException;\n+import org.opensmartgridplatform.domain.core.repositories.SsldRepository;\n+import org.opensmartgridplatform.domain.core.services.DeviceDomainService;\n+import org.opensmartgridplatform.domain.core.services.OrganisationDomainService;\n+import org.opensmartgridplatform.domain.core.valueobjects.Configuration;\n+import org.opensmartgridplatform.domain.core.valueobjects.RelayConfiguration;\n+import org.opensmartgridplatform.domain.core.valueobjects.RelayMap;\n+import org.opensmartgridplatform.domain.core.valueobjects.RelayType;\n+import org.opensmartgridplatform.dto.valueobjects.ConfigurationDto;\n+import org.opensmartgridplatform.shared.exceptionhandling.ComponentType;\n+import org.opensmartgridplatform.shared.exceptionhandling.FunctionalException;\n+import org.opensmartgridplatform.shared.exceptionhandling.OsgpException;\n+import org.opensmartgridplatform.shared.infra.jms.CorrelationIds;\n+import org.opensmartgridplatform.shared.infra.jms.RequestMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessageResultType;\n+import org.springframework.beans.factory.annotation.Qualifier;\n+\n+@ExtendWith(MockitoExtension.class)\n+@MockitoSettings(strictness = Strictness.LENIENT)\n+public class ConfigurationManagementServiceTest {\n+    @Mock\n+    private WebServiceResponseMessageSender webServiceResponseMessageSender;\n+    @Mock\n+    private SsldRepository ssldRepository;\n+    @Mock\n+    private ConfigurationDto configurationDto;\n+    @Mock\n+    private DomainCoreMapper domainCoreMapper;\n+    @Mock\n+    private OrganisationDomainService organisationDomainService;\n+    @Mock\n+    private DeviceDomainService deviceDomainService;\n+    @Mock\n+    private CorrelationIds ids;\n+    @Mock\n+    private Configuration configuration;\n+    @Mock\n+    private OsgpCoreRequestMessageSender osgpCoreRequestMessageSender;\n+    @Mock\n+    private Ssld ssld;\n+    @Mock\n+    private Device device;\n+    @Captor\n+    private ArgumentCaptor<RequestMessage> requestMessageArgumentCaptor;\n+    @Captor\n+    private ArgumentCaptor<String> stringArgumentCaptorOne;\n+    @Captor\n+    private ArgumentCaptor<String> stringArgumentCaptorTwo;\n+    @Captor\n+    private ArgumentCaptor<Integer> integerArgumentCaptor;\n+    @Captor\n+    private ArgumentCaptor<Long> longArgumentCaptor;\n+    @Captor\n+    private ArgumentCaptor<ResponseMessage> responseMessageArgumentCaptor;\n+    @InjectMocks\n+    @Qualifier(\"organisationDomainService\")\n+    private ConfigurationManagementService configurationManagementService;\n+    private final String organisationIdentification = \"a\";\n+    private final String deviceIdentification = \"b\";\n+    private final String correlationUid = \"c\";\n+    private OsgpException exception;\n+    private final ByteArrayOutputStream outContent = new ByteArrayOutputStream();\n+    @BeforeEach\n+    public void setUp() throws NoSuchFieldException,\n+            SecurityException, IllegalArgumentException, IllegalAccessException {\n+        // make ids\n+        this.ids = new CorrelationIds(this.organisationIdentification, this.deviceIdentification, this.correlationUid);\n+        this.configurationManagementService = new ConfigurationManagementService();\n+\n+        // do injection using reflection\n+        // Inject Mocks doesn't inject these mocks, possibly because they are in the parent class of\n+        // ConfigurationManagementService\n+        this.injectionUsingReflection(AbstractService.class, \"organisationDomainService\",\n+                this.configurationManagementService, this.organisationDomainService);\n+        this.injectionUsingReflection(AbstractService.class, \"deviceDomainService\", this.configurationManagementService,\n+                this.deviceDomainService);\n+        this.injectionUsingReflection(AbstractService.class, \"domainCoreMapper\", this.configurationManagementService,\n+                this.domainCoreMapper);\n+        this.injectionUsingReflection(AbstractService.class, \"osgpCoreRequestMessageSender\",\n+                this.configurationManagementService, this.osgpCoreRequestMessageSender);\n+        this.injectionUsingReflection(AbstractService.class, \"webServiceResponseMessageSender\",\n+                this.configurationManagementService, this.webServiceResponseMessageSender);\n+        this.injectionUsingReflection(AbstractService.class, \"ssldRepository\", this.configurationManagementService,\n+                this.ssldRepository);\n+\n+        System.setOut(new PrintStream(this.outContent));\n+    }\n+    @Test\n+    public void testTrySetConfiguration() throws FunctionalException, UnknownEntityException {\n+        final long scheduleTime = 1;\n+        final String messageType = \"none\";\n+        final int messagePriority = 1;\n+\n+        final Organisation testOrganisation = new Organisation();\n+\n+        final RelayMap relayMap = new RelayMap(1, 1, RelayType.LIGHT, \"1\");\n+        final ArrayList<RelayMap> relayMapList = new ArrayList<>();\n+        relayMapList.add(relayMap);", "originalCommit": "8a185e21fa2b503ebba41b3a67df1548048198fc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA4OTYzNw==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/437#discussion_r503089637", "bodyText": "refactor \"333.333.1.22\" into a constant", "author": "robindenadel", "createdAt": "2020-10-12T07:27:04Z", "path": "osgp/platform/osgp-adapter-domain-core/src/test/java/org/opensmartgridplatform/adapter/domain/core/application/services/ConfigurationManagementServiceTest.java", "diffHunk": "@@ -0,0 +1,290 @@\n+package org.opensmartgridplatform.adapter.domain.core.application.services;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.Mockito.any;\n+import static org.mockito.Mockito.doNothing;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.when;\n+\n+import java.io.ByteArrayOutputStream;\n+import java.io.PrintStream;\n+import java.lang.reflect.Field;\n+import java.util.ArrayList;\n+\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.ArgumentCaptor;\n+import org.mockito.Captor;\n+import org.mockito.InjectMocks;\n+import org.mockito.Mock;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+import org.mockito.junit.jupiter.MockitoSettings;\n+import org.mockito.quality.Strictness;\n+import org.opensmartgridplatform.adapter.domain.core.application.mapping.DomainCoreMapper;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.core.OsgpCoreRequestMessageSender;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.ws.WebServiceResponseMessageSender;\n+import org.opensmartgridplatform.domain.core.entities.Device;\n+import org.opensmartgridplatform.domain.core.entities.Organisation;\n+import org.opensmartgridplatform.domain.core.entities.Ssld;\n+import org.opensmartgridplatform.domain.core.exceptions.UnknownEntityException;\n+import org.opensmartgridplatform.domain.core.repositories.SsldRepository;\n+import org.opensmartgridplatform.domain.core.services.DeviceDomainService;\n+import org.opensmartgridplatform.domain.core.services.OrganisationDomainService;\n+import org.opensmartgridplatform.domain.core.valueobjects.Configuration;\n+import org.opensmartgridplatform.domain.core.valueobjects.RelayConfiguration;\n+import org.opensmartgridplatform.domain.core.valueobjects.RelayMap;\n+import org.opensmartgridplatform.domain.core.valueobjects.RelayType;\n+import org.opensmartgridplatform.dto.valueobjects.ConfigurationDto;\n+import org.opensmartgridplatform.shared.exceptionhandling.ComponentType;\n+import org.opensmartgridplatform.shared.exceptionhandling.FunctionalException;\n+import org.opensmartgridplatform.shared.exceptionhandling.OsgpException;\n+import org.opensmartgridplatform.shared.infra.jms.CorrelationIds;\n+import org.opensmartgridplatform.shared.infra.jms.RequestMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessageResultType;\n+import org.springframework.beans.factory.annotation.Qualifier;\n+\n+@ExtendWith(MockitoExtension.class)\n+@MockitoSettings(strictness = Strictness.LENIENT)\n+public class ConfigurationManagementServiceTest {\n+    @Mock\n+    private WebServiceResponseMessageSender webServiceResponseMessageSender;\n+    @Mock\n+    private SsldRepository ssldRepository;\n+    @Mock\n+    private ConfigurationDto configurationDto;\n+    @Mock\n+    private DomainCoreMapper domainCoreMapper;\n+    @Mock\n+    private OrganisationDomainService organisationDomainService;\n+    @Mock\n+    private DeviceDomainService deviceDomainService;\n+    @Mock\n+    private CorrelationIds ids;\n+    @Mock\n+    private Configuration configuration;\n+    @Mock\n+    private OsgpCoreRequestMessageSender osgpCoreRequestMessageSender;\n+    @Mock\n+    private Ssld ssld;\n+    @Mock\n+    private Device device;\n+    @Captor\n+    private ArgumentCaptor<RequestMessage> requestMessageArgumentCaptor;\n+    @Captor\n+    private ArgumentCaptor<String> stringArgumentCaptorOne;\n+    @Captor\n+    private ArgumentCaptor<String> stringArgumentCaptorTwo;\n+    @Captor\n+    private ArgumentCaptor<Integer> integerArgumentCaptor;\n+    @Captor\n+    private ArgumentCaptor<Long> longArgumentCaptor;\n+    @Captor\n+    private ArgumentCaptor<ResponseMessage> responseMessageArgumentCaptor;\n+    @InjectMocks\n+    @Qualifier(\"organisationDomainService\")\n+    private ConfigurationManagementService configurationManagementService;\n+    private final String organisationIdentification = \"a\";\n+    private final String deviceIdentification = \"b\";\n+    private final String correlationUid = \"c\";\n+    private OsgpException exception;\n+    private final ByteArrayOutputStream outContent = new ByteArrayOutputStream();\n+    @BeforeEach\n+    public void setUp() throws NoSuchFieldException,\n+            SecurityException, IllegalArgumentException, IllegalAccessException {\n+        // make ids\n+        this.ids = new CorrelationIds(this.organisationIdentification, this.deviceIdentification, this.correlationUid);\n+        this.configurationManagementService = new ConfigurationManagementService();\n+\n+        // do injection using reflection\n+        // Inject Mocks doesn't inject these mocks, possibly because they are in the parent class of\n+        // ConfigurationManagementService\n+        this.injectionUsingReflection(AbstractService.class, \"organisationDomainService\",\n+                this.configurationManagementService, this.organisationDomainService);\n+        this.injectionUsingReflection(AbstractService.class, \"deviceDomainService\", this.configurationManagementService,\n+                this.deviceDomainService);\n+        this.injectionUsingReflection(AbstractService.class, \"domainCoreMapper\", this.configurationManagementService,\n+                this.domainCoreMapper);\n+        this.injectionUsingReflection(AbstractService.class, \"osgpCoreRequestMessageSender\",\n+                this.configurationManagementService, this.osgpCoreRequestMessageSender);\n+        this.injectionUsingReflection(AbstractService.class, \"webServiceResponseMessageSender\",\n+                this.configurationManagementService, this.webServiceResponseMessageSender);\n+        this.injectionUsingReflection(AbstractService.class, \"ssldRepository\", this.configurationManagementService,\n+                this.ssldRepository);\n+\n+        System.setOut(new PrintStream(this.outContent));\n+    }\n+    @Test\n+    public void testTrySetConfiguration() throws FunctionalException, UnknownEntityException {\n+        final long scheduleTime = 1;\n+        final String messageType = \"none\";\n+        final int messagePriority = 1;\n+\n+        final Organisation testOrganisation = new Organisation();\n+\n+        final RelayMap relayMap = new RelayMap(1, 1, RelayType.LIGHT, \"1\");\n+        final ArrayList<RelayMap> relayMapList = new ArrayList<>();\n+        relayMapList.add(relayMap);\n+\n+        when(this.organisationDomainService.searchOrganisation(any(String.class))).thenReturn(testOrganisation);\n+        when(this.deviceDomainService.searchActiveDevice(any(), any())).thenReturn(this.device);\n+        when(this.configuration.getRelayConfiguration()).thenReturn(new RelayConfiguration(relayMapList));\n+        when(this.ssldRepository.findById(any())).thenReturn(java.util.Optional.of(this.ssld));\n+        when(this.domainCoreMapper.map(any(), any())).thenReturn(this.configurationDto);\n+        doNothing().when(this.ssld).updateOutputSettings(any());\n+        when(this.device.getIpAddress()).thenReturn(\"333.333.1.22\");", "originalCommit": "8a185e21fa2b503ebba41b3a67df1548048198fc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA5MDA2OQ==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/437#discussion_r503090069", "bodyText": "this should be constants", "author": "robindenadel", "createdAt": "2020-10-12T07:28:00Z", "path": "osgp/platform/osgp-adapter-domain-core/src/test/java/org/opensmartgridplatform/adapter/domain/core/application/services/ConfigurationManagementServiceTest.java", "diffHunk": "@@ -0,0 +1,290 @@\n+package org.opensmartgridplatform.adapter.domain.core.application.services;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.Mockito.any;\n+import static org.mockito.Mockito.doNothing;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.when;\n+\n+import java.io.ByteArrayOutputStream;\n+import java.io.PrintStream;\n+import java.lang.reflect.Field;\n+import java.util.ArrayList;\n+\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.ArgumentCaptor;\n+import org.mockito.Captor;\n+import org.mockito.InjectMocks;\n+import org.mockito.Mock;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+import org.mockito.junit.jupiter.MockitoSettings;\n+import org.mockito.quality.Strictness;\n+import org.opensmartgridplatform.adapter.domain.core.application.mapping.DomainCoreMapper;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.core.OsgpCoreRequestMessageSender;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.ws.WebServiceResponseMessageSender;\n+import org.opensmartgridplatform.domain.core.entities.Device;\n+import org.opensmartgridplatform.domain.core.entities.Organisation;\n+import org.opensmartgridplatform.domain.core.entities.Ssld;\n+import org.opensmartgridplatform.domain.core.exceptions.UnknownEntityException;\n+import org.opensmartgridplatform.domain.core.repositories.SsldRepository;\n+import org.opensmartgridplatform.domain.core.services.DeviceDomainService;\n+import org.opensmartgridplatform.domain.core.services.OrganisationDomainService;\n+import org.opensmartgridplatform.domain.core.valueobjects.Configuration;\n+import org.opensmartgridplatform.domain.core.valueobjects.RelayConfiguration;\n+import org.opensmartgridplatform.domain.core.valueobjects.RelayMap;\n+import org.opensmartgridplatform.domain.core.valueobjects.RelayType;\n+import org.opensmartgridplatform.dto.valueobjects.ConfigurationDto;\n+import org.opensmartgridplatform.shared.exceptionhandling.ComponentType;\n+import org.opensmartgridplatform.shared.exceptionhandling.FunctionalException;\n+import org.opensmartgridplatform.shared.exceptionhandling.OsgpException;\n+import org.opensmartgridplatform.shared.infra.jms.CorrelationIds;\n+import org.opensmartgridplatform.shared.infra.jms.RequestMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessageResultType;\n+import org.springframework.beans.factory.annotation.Qualifier;\n+\n+@ExtendWith(MockitoExtension.class)\n+@MockitoSettings(strictness = Strictness.LENIENT)\n+public class ConfigurationManagementServiceTest {\n+    @Mock\n+    private WebServiceResponseMessageSender webServiceResponseMessageSender;\n+    @Mock\n+    private SsldRepository ssldRepository;\n+    @Mock\n+    private ConfigurationDto configurationDto;\n+    @Mock\n+    private DomainCoreMapper domainCoreMapper;\n+    @Mock\n+    private OrganisationDomainService organisationDomainService;\n+    @Mock\n+    private DeviceDomainService deviceDomainService;\n+    @Mock\n+    private CorrelationIds ids;\n+    @Mock\n+    private Configuration configuration;\n+    @Mock\n+    private OsgpCoreRequestMessageSender osgpCoreRequestMessageSender;\n+    @Mock\n+    private Ssld ssld;\n+    @Mock\n+    private Device device;\n+    @Captor\n+    private ArgumentCaptor<RequestMessage> requestMessageArgumentCaptor;\n+    @Captor\n+    private ArgumentCaptor<String> stringArgumentCaptorOne;\n+    @Captor\n+    private ArgumentCaptor<String> stringArgumentCaptorTwo;\n+    @Captor\n+    private ArgumentCaptor<Integer> integerArgumentCaptor;\n+    @Captor\n+    private ArgumentCaptor<Long> longArgumentCaptor;\n+    @Captor\n+    private ArgumentCaptor<ResponseMessage> responseMessageArgumentCaptor;\n+    @InjectMocks\n+    @Qualifier(\"organisationDomainService\")\n+    private ConfigurationManagementService configurationManagementService;\n+    private final String organisationIdentification = \"a\";\n+    private final String deviceIdentification = \"b\";\n+    private final String correlationUid = \"c\";", "originalCommit": "8a185e21fa2b503ebba41b3a67df1548048198fc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA5MTc2MQ==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/437#discussion_r503091761", "bodyText": "replace this line with\nassertThat(this.outContent.toString()).contains(\"Configuration is empty, skip sending a request to device\");", "author": "robindenadel", "createdAt": "2020-10-12T07:31:25Z", "path": "osgp/platform/osgp-adapter-domain-core/src/test/java/org/opensmartgridplatform/adapter/domain/core/application/services/ConfigurationManagementServiceTest.java", "diffHunk": "@@ -0,0 +1,290 @@\n+package org.opensmartgridplatform.adapter.domain.core.application.services;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.Mockito.any;\n+import static org.mockito.Mockito.doNothing;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.when;\n+\n+import java.io.ByteArrayOutputStream;\n+import java.io.PrintStream;\n+import java.lang.reflect.Field;\n+import java.util.ArrayList;\n+\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.ArgumentCaptor;\n+import org.mockito.Captor;\n+import org.mockito.InjectMocks;\n+import org.mockito.Mock;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+import org.mockito.junit.jupiter.MockitoSettings;\n+import org.mockito.quality.Strictness;\n+import org.opensmartgridplatform.adapter.domain.core.application.mapping.DomainCoreMapper;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.core.OsgpCoreRequestMessageSender;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.ws.WebServiceResponseMessageSender;\n+import org.opensmartgridplatform.domain.core.entities.Device;\n+import org.opensmartgridplatform.domain.core.entities.Organisation;\n+import org.opensmartgridplatform.domain.core.entities.Ssld;\n+import org.opensmartgridplatform.domain.core.exceptions.UnknownEntityException;\n+import org.opensmartgridplatform.domain.core.repositories.SsldRepository;\n+import org.opensmartgridplatform.domain.core.services.DeviceDomainService;\n+import org.opensmartgridplatform.domain.core.services.OrganisationDomainService;\n+import org.opensmartgridplatform.domain.core.valueobjects.Configuration;\n+import org.opensmartgridplatform.domain.core.valueobjects.RelayConfiguration;\n+import org.opensmartgridplatform.domain.core.valueobjects.RelayMap;\n+import org.opensmartgridplatform.domain.core.valueobjects.RelayType;\n+import org.opensmartgridplatform.dto.valueobjects.ConfigurationDto;\n+import org.opensmartgridplatform.shared.exceptionhandling.ComponentType;\n+import org.opensmartgridplatform.shared.exceptionhandling.FunctionalException;\n+import org.opensmartgridplatform.shared.exceptionhandling.OsgpException;\n+import org.opensmartgridplatform.shared.infra.jms.CorrelationIds;\n+import org.opensmartgridplatform.shared.infra.jms.RequestMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessageResultType;\n+import org.springframework.beans.factory.annotation.Qualifier;\n+\n+@ExtendWith(MockitoExtension.class)\n+@MockitoSettings(strictness = Strictness.LENIENT)\n+public class ConfigurationManagementServiceTest {\n+    @Mock\n+    private WebServiceResponseMessageSender webServiceResponseMessageSender;\n+    @Mock\n+    private SsldRepository ssldRepository;\n+    @Mock\n+    private ConfigurationDto configurationDto;\n+    @Mock\n+    private DomainCoreMapper domainCoreMapper;\n+    @Mock\n+    private OrganisationDomainService organisationDomainService;\n+    @Mock\n+    private DeviceDomainService deviceDomainService;\n+    @Mock\n+    private CorrelationIds ids;\n+    @Mock\n+    private Configuration configuration;\n+    @Mock\n+    private OsgpCoreRequestMessageSender osgpCoreRequestMessageSender;\n+    @Mock\n+    private Ssld ssld;\n+    @Mock\n+    private Device device;\n+    @Captor\n+    private ArgumentCaptor<RequestMessage> requestMessageArgumentCaptor;\n+    @Captor\n+    private ArgumentCaptor<String> stringArgumentCaptorOne;\n+    @Captor\n+    private ArgumentCaptor<String> stringArgumentCaptorTwo;\n+    @Captor\n+    private ArgumentCaptor<Integer> integerArgumentCaptor;\n+    @Captor\n+    private ArgumentCaptor<Long> longArgumentCaptor;\n+    @Captor\n+    private ArgumentCaptor<ResponseMessage> responseMessageArgumentCaptor;\n+    @InjectMocks\n+    @Qualifier(\"organisationDomainService\")\n+    private ConfigurationManagementService configurationManagementService;\n+    private final String organisationIdentification = \"a\";\n+    private final String deviceIdentification = \"b\";\n+    private final String correlationUid = \"c\";\n+    private OsgpException exception;\n+    private final ByteArrayOutputStream outContent = new ByteArrayOutputStream();\n+    @BeforeEach\n+    public void setUp() throws NoSuchFieldException,\n+            SecurityException, IllegalArgumentException, IllegalAccessException {\n+        // make ids\n+        this.ids = new CorrelationIds(this.organisationIdentification, this.deviceIdentification, this.correlationUid);\n+        this.configurationManagementService = new ConfigurationManagementService();\n+\n+        // do injection using reflection\n+        // Inject Mocks doesn't inject these mocks, possibly because they are in the parent class of\n+        // ConfigurationManagementService\n+        this.injectionUsingReflection(AbstractService.class, \"organisationDomainService\",\n+                this.configurationManagementService, this.organisationDomainService);\n+        this.injectionUsingReflection(AbstractService.class, \"deviceDomainService\", this.configurationManagementService,\n+                this.deviceDomainService);\n+        this.injectionUsingReflection(AbstractService.class, \"domainCoreMapper\", this.configurationManagementService,\n+                this.domainCoreMapper);\n+        this.injectionUsingReflection(AbstractService.class, \"osgpCoreRequestMessageSender\",\n+                this.configurationManagementService, this.osgpCoreRequestMessageSender);\n+        this.injectionUsingReflection(AbstractService.class, \"webServiceResponseMessageSender\",\n+                this.configurationManagementService, this.webServiceResponseMessageSender);\n+        this.injectionUsingReflection(AbstractService.class, \"ssldRepository\", this.configurationManagementService,\n+                this.ssldRepository);\n+\n+        System.setOut(new PrintStream(this.outContent));\n+    }\n+    @Test\n+    public void testTrySetConfiguration() throws FunctionalException, UnknownEntityException {\n+        final long scheduleTime = 1;\n+        final String messageType = \"none\";\n+        final int messagePriority = 1;\n+\n+        final Organisation testOrganisation = new Organisation();\n+\n+        final RelayMap relayMap = new RelayMap(1, 1, RelayType.LIGHT, \"1\");\n+        final ArrayList<RelayMap> relayMapList = new ArrayList<>();\n+        relayMapList.add(relayMap);\n+\n+        when(this.organisationDomainService.searchOrganisation(any(String.class))).thenReturn(testOrganisation);\n+        when(this.deviceDomainService.searchActiveDevice(any(), any())).thenReturn(this.device);\n+        when(this.configuration.getRelayConfiguration()).thenReturn(new RelayConfiguration(relayMapList));\n+        when(this.ssldRepository.findById(any())).thenReturn(java.util.Optional.of(this.ssld));\n+        when(this.domainCoreMapper.map(any(), any())).thenReturn(this.configurationDto);\n+        doNothing().when(this.ssld).updateOutputSettings(any());\n+        when(this.device.getIpAddress()).thenReturn(\"333.333.1.22\");\n+\n+        this.configurationManagementService.setConfiguration(this.ids, this.configuration, scheduleTime,\n+                messageType, messagePriority);\n+\n+        verify(this.osgpCoreRequestMessageSender).sendWithScheduledTime(this.requestMessageArgumentCaptor.capture(),\n+                this.stringArgumentCaptorOne.capture(), this.integerArgumentCaptor.capture(),\n+                this.stringArgumentCaptorTwo.capture(), this.longArgumentCaptor.capture());\n+\n+        assertThat(this.requestMessageArgumentCaptor.getValue().getCorrelationUid()).isEqualTo(\"c\");\n+        assertThat(this.requestMessageArgumentCaptor.getValue().getOrganisationIdentification()).isEqualTo(\"a\");\n+        assertThat(this.requestMessageArgumentCaptor.getValue().getDeviceIdentification()).isEqualTo(\"b\");\n+        assertThat(this.stringArgumentCaptorOne.getValue()).isEqualTo(messageType);\n+        assertThat(this.integerArgumentCaptor.getValue()).isEqualTo(1);\n+        assertThat(this.stringArgumentCaptorTwo.getValue()).isEqualTo(\"333.333.1.22\");\n+        assertThat(this.longArgumentCaptor.getValue()).isEqualTo(1);\n+    }\n+    @Test\n+    public void testTrySetConfigurationWithNoConfiguration() throws Exception {\n+        final long scheduleTime = 1;\n+        final String messageType = \"none\";\n+        final int messagePriority = 1;\n+\n+        final Organisation testOrganisation = new Organisation();\n+        when(this.organisationDomainService.searchOrganisation(any(String.class))).thenReturn(testOrganisation);\n+        when(this.deviceDomainService.searchActiveDevice(any(), any())).thenReturn(new Device());\n+        when(this.organisationDomainService.searchOrganisation(any(String.class))).thenReturn(testOrganisation);\n+\n+        this.configurationManagementService.setConfiguration(this.ids, null, scheduleTime, messageType, messagePriority);\n+\n+        assertThat(this.outContent.toString().contains(\"Configuration is empty, skip sending a request to device\")).isTrue();", "originalCommit": "8a185e21fa2b503ebba41b3a67df1548048198fc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA5NjExOQ==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/437#discussion_r503096119", "bodyText": "this should be one line, check your format settings", "author": "robindenadel", "createdAt": "2020-10-12T07:40:17Z", "path": "osgp/platform/osgp-adapter-domain-core/src/test/java/org/opensmartgridplatform/adapter/domain/core/application/services/ConfigurationManagementServiceTest.java", "diffHunk": "@@ -0,0 +1,290 @@\n+package org.opensmartgridplatform.adapter.domain.core.application.services;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.Mockito.any;\n+import static org.mockito.Mockito.doNothing;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.when;\n+\n+import java.io.ByteArrayOutputStream;\n+import java.io.PrintStream;\n+import java.lang.reflect.Field;\n+import java.util.ArrayList;\n+\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.ArgumentCaptor;\n+import org.mockito.Captor;\n+import org.mockito.InjectMocks;\n+import org.mockito.Mock;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+import org.mockito.junit.jupiter.MockitoSettings;\n+import org.mockito.quality.Strictness;\n+import org.opensmartgridplatform.adapter.domain.core.application.mapping.DomainCoreMapper;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.core.OsgpCoreRequestMessageSender;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.ws.WebServiceResponseMessageSender;\n+import org.opensmartgridplatform.domain.core.entities.Device;\n+import org.opensmartgridplatform.domain.core.entities.Organisation;\n+import org.opensmartgridplatform.domain.core.entities.Ssld;\n+import org.opensmartgridplatform.domain.core.exceptions.UnknownEntityException;\n+import org.opensmartgridplatform.domain.core.repositories.SsldRepository;\n+import org.opensmartgridplatform.domain.core.services.DeviceDomainService;\n+import org.opensmartgridplatform.domain.core.services.OrganisationDomainService;\n+import org.opensmartgridplatform.domain.core.valueobjects.Configuration;\n+import org.opensmartgridplatform.domain.core.valueobjects.RelayConfiguration;\n+import org.opensmartgridplatform.domain.core.valueobjects.RelayMap;\n+import org.opensmartgridplatform.domain.core.valueobjects.RelayType;\n+import org.opensmartgridplatform.dto.valueobjects.ConfigurationDto;\n+import org.opensmartgridplatform.shared.exceptionhandling.ComponentType;\n+import org.opensmartgridplatform.shared.exceptionhandling.FunctionalException;\n+import org.opensmartgridplatform.shared.exceptionhandling.OsgpException;\n+import org.opensmartgridplatform.shared.infra.jms.CorrelationIds;\n+import org.opensmartgridplatform.shared.infra.jms.RequestMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessageResultType;\n+import org.springframework.beans.factory.annotation.Qualifier;\n+\n+@ExtendWith(MockitoExtension.class)\n+@MockitoSettings(strictness = Strictness.LENIENT)\n+public class ConfigurationManagementServiceTest {\n+    @Mock\n+    private WebServiceResponseMessageSender webServiceResponseMessageSender;\n+    @Mock\n+    private SsldRepository ssldRepository;\n+    @Mock\n+    private ConfigurationDto configurationDto;\n+    @Mock\n+    private DomainCoreMapper domainCoreMapper;\n+    @Mock\n+    private OrganisationDomainService organisationDomainService;\n+    @Mock\n+    private DeviceDomainService deviceDomainService;\n+    @Mock\n+    private CorrelationIds ids;\n+    @Mock\n+    private Configuration configuration;\n+    @Mock\n+    private OsgpCoreRequestMessageSender osgpCoreRequestMessageSender;\n+    @Mock\n+    private Ssld ssld;\n+    @Mock\n+    private Device device;\n+    @Captor\n+    private ArgumentCaptor<RequestMessage> requestMessageArgumentCaptor;\n+    @Captor\n+    private ArgumentCaptor<String> stringArgumentCaptorOne;\n+    @Captor\n+    private ArgumentCaptor<String> stringArgumentCaptorTwo;\n+    @Captor\n+    private ArgumentCaptor<Integer> integerArgumentCaptor;\n+    @Captor\n+    private ArgumentCaptor<Long> longArgumentCaptor;\n+    @Captor\n+    private ArgumentCaptor<ResponseMessage> responseMessageArgumentCaptor;\n+    @InjectMocks\n+    @Qualifier(\"organisationDomainService\")\n+    private ConfigurationManagementService configurationManagementService;\n+    private final String organisationIdentification = \"a\";\n+    private final String deviceIdentification = \"b\";\n+    private final String correlationUid = \"c\";\n+    private OsgpException exception;\n+    private final ByteArrayOutputStream outContent = new ByteArrayOutputStream();\n+    @BeforeEach\n+    public void setUp() throws NoSuchFieldException,\n+            SecurityException, IllegalArgumentException, IllegalAccessException {\n+        // make ids\n+        this.ids = new CorrelationIds(this.organisationIdentification, this.deviceIdentification, this.correlationUid);\n+        this.configurationManagementService = new ConfigurationManagementService();\n+\n+        // do injection using reflection\n+        // Inject Mocks doesn't inject these mocks, possibly because they are in the parent class of\n+        // ConfigurationManagementService\n+        this.injectionUsingReflection(AbstractService.class, \"organisationDomainService\",\n+                this.configurationManagementService, this.organisationDomainService);\n+        this.injectionUsingReflection(AbstractService.class, \"deviceDomainService\", this.configurationManagementService,\n+                this.deviceDomainService);\n+        this.injectionUsingReflection(AbstractService.class, \"domainCoreMapper\", this.configurationManagementService,\n+                this.domainCoreMapper);\n+        this.injectionUsingReflection(AbstractService.class, \"osgpCoreRequestMessageSender\",\n+                this.configurationManagementService, this.osgpCoreRequestMessageSender);\n+        this.injectionUsingReflection(AbstractService.class, \"webServiceResponseMessageSender\",\n+                this.configurationManagementService, this.webServiceResponseMessageSender);\n+        this.injectionUsingReflection(AbstractService.class, \"ssldRepository\", this.configurationManagementService,\n+                this.ssldRepository);\n+\n+        System.setOut(new PrintStream(this.outContent));\n+    }\n+    @Test\n+    public void testTrySetConfiguration() throws FunctionalException, UnknownEntityException {\n+        final long scheduleTime = 1;\n+        final String messageType = \"none\";\n+        final int messagePriority = 1;\n+\n+        final Organisation testOrganisation = new Organisation();\n+\n+        final RelayMap relayMap = new RelayMap(1, 1, RelayType.LIGHT, \"1\");\n+        final ArrayList<RelayMap> relayMapList = new ArrayList<>();\n+        relayMapList.add(relayMap);\n+\n+        when(this.organisationDomainService.searchOrganisation(any(String.class))).thenReturn(testOrganisation);\n+        when(this.deviceDomainService.searchActiveDevice(any(), any())).thenReturn(this.device);\n+        when(this.configuration.getRelayConfiguration()).thenReturn(new RelayConfiguration(relayMapList));\n+        when(this.ssldRepository.findById(any())).thenReturn(java.util.Optional.of(this.ssld));\n+        when(this.domainCoreMapper.map(any(), any())).thenReturn(this.configurationDto);\n+        doNothing().when(this.ssld).updateOutputSettings(any());\n+        when(this.device.getIpAddress()).thenReturn(\"333.333.1.22\");\n+\n+        this.configurationManagementService.setConfiguration(this.ids, this.configuration, scheduleTime,\n+                messageType, messagePriority);\n+\n+        verify(this.osgpCoreRequestMessageSender).sendWithScheduledTime(this.requestMessageArgumentCaptor.capture(),\n+                this.stringArgumentCaptorOne.capture(), this.integerArgumentCaptor.capture(),\n+                this.stringArgumentCaptorTwo.capture(), this.longArgumentCaptor.capture());\n+\n+        assertThat(this.requestMessageArgumentCaptor.getValue().getCorrelationUid()).isEqualTo(\"c\");\n+        assertThat(this.requestMessageArgumentCaptor.getValue().getOrganisationIdentification()).isEqualTo(\"a\");\n+        assertThat(this.requestMessageArgumentCaptor.getValue().getDeviceIdentification()).isEqualTo(\"b\");\n+        assertThat(this.stringArgumentCaptorOne.getValue()).isEqualTo(messageType);\n+        assertThat(this.integerArgumentCaptor.getValue()).isEqualTo(1);\n+        assertThat(this.stringArgumentCaptorTwo.getValue()).isEqualTo(\"333.333.1.22\");\n+        assertThat(this.longArgumentCaptor.getValue()).isEqualTo(1);\n+    }\n+    @Test\n+    public void testTrySetConfigurationWithNoConfiguration() throws Exception {\n+        final long scheduleTime = 1;\n+        final String messageType = \"none\";\n+        final int messagePriority = 1;\n+\n+        final Organisation testOrganisation = new Organisation();\n+        when(this.organisationDomainService.searchOrganisation(any(String.class))).thenReturn(testOrganisation);\n+        when(this.deviceDomainService.searchActiveDevice(any(), any())).thenReturn(new Device());\n+        when(this.organisationDomainService.searchOrganisation(any(String.class))).thenReturn(testOrganisation);\n+\n+        this.configurationManagementService.setConfiguration(this.ids, null, scheduleTime, messageType, messagePriority);\n+\n+        assertThat(this.outContent.toString().contains(\"Configuration is empty, skip sending a request to device\")).isTrue();\n+    }\n+    @Test\n+    public void\n+    testTrySetConfigurationWithNullRelayConfiguration() throws UnknownEntityException, FunctionalException {", "originalCommit": "8a185e21fa2b503ebba41b3a67df1548048198fc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA5OTgwMA==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/437#discussion_r503099800", "bodyText": "remove this unnecessary code", "author": "robindenadel", "createdAt": "2020-10-12T07:46:51Z", "path": "osgp/platform/osgp-adapter-domain-core/src/test/java/org/opensmartgridplatform/adapter/domain/core/application/services/ConfigurationManagementServiceTest.java", "diffHunk": "@@ -0,0 +1,290 @@\n+package org.opensmartgridplatform.adapter.domain.core.application.services;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.Mockito.any;\n+import static org.mockito.Mockito.doNothing;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.when;\n+\n+import java.io.ByteArrayOutputStream;\n+import java.io.PrintStream;\n+import java.lang.reflect.Field;\n+import java.util.ArrayList;\n+\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.ArgumentCaptor;\n+import org.mockito.Captor;\n+import org.mockito.InjectMocks;\n+import org.mockito.Mock;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+import org.mockito.junit.jupiter.MockitoSettings;\n+import org.mockito.quality.Strictness;\n+import org.opensmartgridplatform.adapter.domain.core.application.mapping.DomainCoreMapper;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.core.OsgpCoreRequestMessageSender;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.ws.WebServiceResponseMessageSender;\n+import org.opensmartgridplatform.domain.core.entities.Device;\n+import org.opensmartgridplatform.domain.core.entities.Organisation;\n+import org.opensmartgridplatform.domain.core.entities.Ssld;\n+import org.opensmartgridplatform.domain.core.exceptions.UnknownEntityException;\n+import org.opensmartgridplatform.domain.core.repositories.SsldRepository;\n+import org.opensmartgridplatform.domain.core.services.DeviceDomainService;\n+import org.opensmartgridplatform.domain.core.services.OrganisationDomainService;\n+import org.opensmartgridplatform.domain.core.valueobjects.Configuration;\n+import org.opensmartgridplatform.domain.core.valueobjects.RelayConfiguration;\n+import org.opensmartgridplatform.domain.core.valueobjects.RelayMap;\n+import org.opensmartgridplatform.domain.core.valueobjects.RelayType;\n+import org.opensmartgridplatform.dto.valueobjects.ConfigurationDto;\n+import org.opensmartgridplatform.shared.exceptionhandling.ComponentType;\n+import org.opensmartgridplatform.shared.exceptionhandling.FunctionalException;\n+import org.opensmartgridplatform.shared.exceptionhandling.OsgpException;\n+import org.opensmartgridplatform.shared.infra.jms.CorrelationIds;\n+import org.opensmartgridplatform.shared.infra.jms.RequestMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessageResultType;\n+import org.springframework.beans.factory.annotation.Qualifier;\n+\n+@ExtendWith(MockitoExtension.class)\n+@MockitoSettings(strictness = Strictness.LENIENT)\n+public class ConfigurationManagementServiceTest {\n+    @Mock\n+    private WebServiceResponseMessageSender webServiceResponseMessageSender;\n+    @Mock\n+    private SsldRepository ssldRepository;\n+    @Mock\n+    private ConfigurationDto configurationDto;\n+    @Mock\n+    private DomainCoreMapper domainCoreMapper;\n+    @Mock\n+    private OrganisationDomainService organisationDomainService;\n+    @Mock\n+    private DeviceDomainService deviceDomainService;\n+    @Mock\n+    private CorrelationIds ids;\n+    @Mock\n+    private Configuration configuration;\n+    @Mock\n+    private OsgpCoreRequestMessageSender osgpCoreRequestMessageSender;\n+    @Mock\n+    private Ssld ssld;\n+    @Mock\n+    private Device device;\n+    @Captor\n+    private ArgumentCaptor<RequestMessage> requestMessageArgumentCaptor;\n+    @Captor\n+    private ArgumentCaptor<String> stringArgumentCaptorOne;\n+    @Captor\n+    private ArgumentCaptor<String> stringArgumentCaptorTwo;\n+    @Captor\n+    private ArgumentCaptor<Integer> integerArgumentCaptor;\n+    @Captor\n+    private ArgumentCaptor<Long> longArgumentCaptor;\n+    @Captor\n+    private ArgumentCaptor<ResponseMessage> responseMessageArgumentCaptor;\n+    @InjectMocks\n+    @Qualifier(\"organisationDomainService\")\n+    private ConfigurationManagementService configurationManagementService;\n+    private final String organisationIdentification = \"a\";\n+    private final String deviceIdentification = \"b\";\n+    private final String correlationUid = \"c\";\n+    private OsgpException exception;\n+    private final ByteArrayOutputStream outContent = new ByteArrayOutputStream();\n+    @BeforeEach\n+    public void setUp() throws NoSuchFieldException,\n+            SecurityException, IllegalArgumentException, IllegalAccessException {\n+        // make ids\n+        this.ids = new CorrelationIds(this.organisationIdentification, this.deviceIdentification, this.correlationUid);\n+        this.configurationManagementService = new ConfigurationManagementService();\n+\n+        // do injection using reflection\n+        // Inject Mocks doesn't inject these mocks, possibly because they are in the parent class of\n+        // ConfigurationManagementService\n+        this.injectionUsingReflection(AbstractService.class, \"organisationDomainService\",\n+                this.configurationManagementService, this.organisationDomainService);\n+        this.injectionUsingReflection(AbstractService.class, \"deviceDomainService\", this.configurationManagementService,\n+                this.deviceDomainService);\n+        this.injectionUsingReflection(AbstractService.class, \"domainCoreMapper\", this.configurationManagementService,\n+                this.domainCoreMapper);\n+        this.injectionUsingReflection(AbstractService.class, \"osgpCoreRequestMessageSender\",\n+                this.configurationManagementService, this.osgpCoreRequestMessageSender);\n+        this.injectionUsingReflection(AbstractService.class, \"webServiceResponseMessageSender\",\n+                this.configurationManagementService, this.webServiceResponseMessageSender);\n+        this.injectionUsingReflection(AbstractService.class, \"ssldRepository\", this.configurationManagementService,\n+                this.ssldRepository);\n+\n+        System.setOut(new PrintStream(this.outContent));\n+    }\n+    @Test\n+    public void testTrySetConfiguration() throws FunctionalException, UnknownEntityException {\n+        final long scheduleTime = 1;\n+        final String messageType = \"none\";\n+        final int messagePriority = 1;\n+\n+        final Organisation testOrganisation = new Organisation();\n+\n+        final RelayMap relayMap = new RelayMap(1, 1, RelayType.LIGHT, \"1\");\n+        final ArrayList<RelayMap> relayMapList = new ArrayList<>();\n+        relayMapList.add(relayMap);\n+\n+        when(this.organisationDomainService.searchOrganisation(any(String.class))).thenReturn(testOrganisation);\n+        when(this.deviceDomainService.searchActiveDevice(any(), any())).thenReturn(this.device);\n+        when(this.configuration.getRelayConfiguration()).thenReturn(new RelayConfiguration(relayMapList));\n+        when(this.ssldRepository.findById(any())).thenReturn(java.util.Optional.of(this.ssld));\n+        when(this.domainCoreMapper.map(any(), any())).thenReturn(this.configurationDto);\n+        doNothing().when(this.ssld).updateOutputSettings(any());\n+        when(this.device.getIpAddress()).thenReturn(\"333.333.1.22\");\n+\n+        this.configurationManagementService.setConfiguration(this.ids, this.configuration, scheduleTime,\n+                messageType, messagePriority);\n+\n+        verify(this.osgpCoreRequestMessageSender).sendWithScheduledTime(this.requestMessageArgumentCaptor.capture(),\n+                this.stringArgumentCaptorOne.capture(), this.integerArgumentCaptor.capture(),\n+                this.stringArgumentCaptorTwo.capture(), this.longArgumentCaptor.capture());\n+\n+        assertThat(this.requestMessageArgumentCaptor.getValue().getCorrelationUid()).isEqualTo(\"c\");\n+        assertThat(this.requestMessageArgumentCaptor.getValue().getOrganisationIdentification()).isEqualTo(\"a\");\n+        assertThat(this.requestMessageArgumentCaptor.getValue().getDeviceIdentification()).isEqualTo(\"b\");\n+        assertThat(this.stringArgumentCaptorOne.getValue()).isEqualTo(messageType);\n+        assertThat(this.integerArgumentCaptor.getValue()).isEqualTo(1);\n+        assertThat(this.stringArgumentCaptorTwo.getValue()).isEqualTo(\"333.333.1.22\");\n+        assertThat(this.longArgumentCaptor.getValue()).isEqualTo(1);\n+    }\n+    @Test\n+    public void testTrySetConfigurationWithNoConfiguration() throws Exception {\n+        final long scheduleTime = 1;\n+        final String messageType = \"none\";\n+        final int messagePriority = 1;\n+\n+        final Organisation testOrganisation = new Organisation();\n+        when(this.organisationDomainService.searchOrganisation(any(String.class))).thenReturn(testOrganisation);\n+        when(this.deviceDomainService.searchActiveDevice(any(), any())).thenReturn(new Device());\n+        when(this.organisationDomainService.searchOrganisation(any(String.class))).thenReturn(testOrganisation);\n+\n+        this.configurationManagementService.setConfiguration(this.ids, null, scheduleTime, messageType, messagePriority);\n+\n+        assertThat(this.outContent.toString().contains(\"Configuration is empty, skip sending a request to device\")).isTrue();\n+    }\n+    @Test\n+    public void\n+    testTrySetConfigurationWithNullRelayConfiguration() throws UnknownEntityException, FunctionalException {\n+        final long scheduleTime = 1;\n+        final String messageType = \"none\";\n+        final int messagePriority = 1;\n+\n+        final Organisation testOrganisation = new Organisation();\n+        when(this.organisationDomainService.searchOrganisation(any(String.class))).thenReturn(testOrganisation);\n+        when(this.deviceDomainService.searchActiveDevice(any(), any())).thenReturn(new Device());\n+        when(this.configuration.getRelayConfiguration()).thenReturn(null);\n+\n+        this.configurationManagementService.setConfiguration(this.ids, this.configuration, scheduleTime,\n+                messageType, messagePriority);\n+\n+        verify(this.osgpCoreRequestMessageSender).sendWithScheduledTime(this.requestMessageArgumentCaptor.capture(),\n+                this.stringArgumentCaptorOne.capture(), this.integerArgumentCaptor.capture(),\n+                this.stringArgumentCaptorTwo.capture(), this.longArgumentCaptor.capture());\n+\n+        assertThat(this.requestMessageArgumentCaptor.getValue().getCorrelationUid()).isEqualTo(\"c\");\n+        assertThat(this.requestMessageArgumentCaptor.getValue().getOrganisationIdentification()).isEqualTo(\"a\");\n+        assertThat(this.requestMessageArgumentCaptor.getValue().getDeviceIdentification()).isEqualTo(\"b\");\n+        assertThat(this.stringArgumentCaptorOne.getValue()).isEqualTo(messageType);\n+        assertThat(this.integerArgumentCaptor.getValue()).isEqualTo(1);\n+        assertThat(this.stringArgumentCaptorTwo.getValue()).isEqualTo(null);\n+        assertThat(this.longArgumentCaptor.getValue()).isEqualTo(1);\n+    }\n+    @Test\n+    public void testGetConfiguration() throws UnknownEntityException, FunctionalException {\n+        final String messageType = \"none\";\n+        final int messagePriority = 1;\n+\n+        when(this.organisationDomainService.searchOrganisation(any(String.class))).thenReturn(new Organisation());\n+        when(this.deviceDomainService.searchActiveDevice(any(), any())).thenReturn(this.device);\n+        when(this.device.getIpAddress()).thenReturn(\"333.333.1.22\");\n+\n+        this.configurationManagementService.getConfiguration(this.organisationIdentification, this.deviceIdentification,\n+                this.correlationUid, messageType, messagePriority);\n+\n+        verify(this.osgpCoreRequestMessageSender).send(this.requestMessageArgumentCaptor.capture(),\n+                this.stringArgumentCaptorOne.capture(), this.integerArgumentCaptor.capture(),\n+                this.stringArgumentCaptorTwo.capture());\n+\n+        assertThat(this.requestMessageArgumentCaptor.getValue().getCorrelationUid()).isEqualTo(\"c\");\n+        assertThat(this.requestMessageArgumentCaptor.getValue().getOrganisationIdentification()).isEqualTo(\"a\");\n+        assertThat(this.requestMessageArgumentCaptor.getValue().getDeviceIdentification()).isEqualTo(\"b\");\n+        assertThat(this.stringArgumentCaptorOne.getValue()).isEqualTo(messageType);\n+        assertThat(this.integerArgumentCaptor.getValue()).isEqualTo(1);\n+        assertThat(this.stringArgumentCaptorTwo.getValue()).isEqualTo(\"333.333.1.22\");\n+    }\n+    @Test\n+    public void testHandleGetConfigurationResponse() throws UnknownEntityException, FunctionalException {\n+        final String messageType = \"none\";\n+        final int messagePriority = 1;\n+        this.exception = null;\n+        when(this.organisationDomainService.searchOrganisation(any(String.class))).thenReturn(new Organisation());\n+        when(this.deviceDomainService.searchActiveDevice(any(), any())).thenReturn(new Device());\n+        when(this.ssldRepository.findByDeviceIdentification(\"b\")).thenReturn(new Ssld());\n+\n+        this.configurationManagementService.handleGetConfigurationResponse(this.configurationDto, this.ids,\n+                messageType, messagePriority,\n+                ResponseMessageResultType.OK, this.exception);\n+\n+        verify(this.webServiceResponseMessageSender).send(this.responseMessageArgumentCaptor.capture());\n+\n+        assertThat(this.responseMessageArgumentCaptor.getValue().getCorrelationUid()).isEqualTo(\"c\");\n+        assertThat(this.responseMessageArgumentCaptor.getValue().getOrganisationIdentification()).isEqualTo(\"a\");\n+        assertThat(this.responseMessageArgumentCaptor.getValue().getDeviceIdentification()).isEqualTo(\"b\");\n+        assertThat(this.responseMessageArgumentCaptor.getValue().getResult()).isEqualTo(ResponseMessageResultType.OK);\n+    }\n+    @Test\n+    public void testHandleGetConfigurationResponseWithException() throws UnknownEntityException, FunctionalException {\n+        final String messageType = \"none\";\n+        final int messagePriority = 1;\n+        this.exception = new OsgpException(ComponentType.DOMAIN_ADMIN, \"a\");\n+\n+        when(this.organisationDomainService.searchOrganisation(any(String.class))).thenReturn(new Organisation());\n+        when(this.deviceDomainService.searchActiveDevice(any(), any())).thenReturn(new Device());\n+        when(this.ssldRepository.findByDeviceIdentification(\"b\")).thenReturn(new Ssld());\n+", "originalCommit": "8a185e21fa2b503ebba41b3a67df1548048198fc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzEwMDU4MA==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/437#discussion_r503100580", "bodyText": "remove this line", "author": "robindenadel", "createdAt": "2020-10-12T07:48:25Z", "path": "osgp/platform/osgp-adapter-domain-core/src/test/java/org/opensmartgridplatform/adapter/domain/core/application/services/ConfigurationManagementServiceTest.java", "diffHunk": "@@ -0,0 +1,290 @@\n+package org.opensmartgridplatform.adapter.domain.core.application.services;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.Mockito.any;\n+import static org.mockito.Mockito.doNothing;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.when;\n+\n+import java.io.ByteArrayOutputStream;\n+import java.io.PrintStream;\n+import java.lang.reflect.Field;\n+import java.util.ArrayList;\n+\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.ArgumentCaptor;\n+import org.mockito.Captor;\n+import org.mockito.InjectMocks;\n+import org.mockito.Mock;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+import org.mockito.junit.jupiter.MockitoSettings;\n+import org.mockito.quality.Strictness;\n+import org.opensmartgridplatform.adapter.domain.core.application.mapping.DomainCoreMapper;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.core.OsgpCoreRequestMessageSender;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.ws.WebServiceResponseMessageSender;\n+import org.opensmartgridplatform.domain.core.entities.Device;\n+import org.opensmartgridplatform.domain.core.entities.Organisation;\n+import org.opensmartgridplatform.domain.core.entities.Ssld;\n+import org.opensmartgridplatform.domain.core.exceptions.UnknownEntityException;\n+import org.opensmartgridplatform.domain.core.repositories.SsldRepository;\n+import org.opensmartgridplatform.domain.core.services.DeviceDomainService;\n+import org.opensmartgridplatform.domain.core.services.OrganisationDomainService;\n+import org.opensmartgridplatform.domain.core.valueobjects.Configuration;\n+import org.opensmartgridplatform.domain.core.valueobjects.RelayConfiguration;\n+import org.opensmartgridplatform.domain.core.valueobjects.RelayMap;\n+import org.opensmartgridplatform.domain.core.valueobjects.RelayType;\n+import org.opensmartgridplatform.dto.valueobjects.ConfigurationDto;\n+import org.opensmartgridplatform.shared.exceptionhandling.ComponentType;\n+import org.opensmartgridplatform.shared.exceptionhandling.FunctionalException;\n+import org.opensmartgridplatform.shared.exceptionhandling.OsgpException;\n+import org.opensmartgridplatform.shared.infra.jms.CorrelationIds;\n+import org.opensmartgridplatform.shared.infra.jms.RequestMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessageResultType;\n+import org.springframework.beans.factory.annotation.Qualifier;\n+\n+@ExtendWith(MockitoExtension.class)\n+@MockitoSettings(strictness = Strictness.LENIENT)\n+public class ConfigurationManagementServiceTest {\n+    @Mock\n+    private WebServiceResponseMessageSender webServiceResponseMessageSender;\n+    @Mock\n+    private SsldRepository ssldRepository;\n+    @Mock\n+    private ConfigurationDto configurationDto;\n+    @Mock\n+    private DomainCoreMapper domainCoreMapper;\n+    @Mock\n+    private OrganisationDomainService organisationDomainService;\n+    @Mock\n+    private DeviceDomainService deviceDomainService;\n+    @Mock\n+    private CorrelationIds ids;\n+    @Mock\n+    private Configuration configuration;\n+    @Mock\n+    private OsgpCoreRequestMessageSender osgpCoreRequestMessageSender;\n+    @Mock\n+    private Ssld ssld;\n+    @Mock\n+    private Device device;\n+    @Captor\n+    private ArgumentCaptor<RequestMessage> requestMessageArgumentCaptor;\n+    @Captor\n+    private ArgumentCaptor<String> stringArgumentCaptorOne;\n+    @Captor\n+    private ArgumentCaptor<String> stringArgumentCaptorTwo;\n+    @Captor\n+    private ArgumentCaptor<Integer> integerArgumentCaptor;\n+    @Captor\n+    private ArgumentCaptor<Long> longArgumentCaptor;\n+    @Captor\n+    private ArgumentCaptor<ResponseMessage> responseMessageArgumentCaptor;\n+    @InjectMocks\n+    @Qualifier(\"organisationDomainService\")\n+    private ConfigurationManagementService configurationManagementService;\n+    private final String organisationIdentification = \"a\";\n+    private final String deviceIdentification = \"b\";\n+    private final String correlationUid = \"c\";\n+    private OsgpException exception;\n+    private final ByteArrayOutputStream outContent = new ByteArrayOutputStream();\n+    @BeforeEach\n+    public void setUp() throws NoSuchFieldException,\n+            SecurityException, IllegalArgumentException, IllegalAccessException {\n+        // make ids\n+        this.ids = new CorrelationIds(this.organisationIdentification, this.deviceIdentification, this.correlationUid);\n+        this.configurationManagementService = new ConfigurationManagementService();\n+\n+        // do injection using reflection\n+        // Inject Mocks doesn't inject these mocks, possibly because they are in the parent class of\n+        // ConfigurationManagementService\n+        this.injectionUsingReflection(AbstractService.class, \"organisationDomainService\",\n+                this.configurationManagementService, this.organisationDomainService);\n+        this.injectionUsingReflection(AbstractService.class, \"deviceDomainService\", this.configurationManagementService,\n+                this.deviceDomainService);\n+        this.injectionUsingReflection(AbstractService.class, \"domainCoreMapper\", this.configurationManagementService,\n+                this.domainCoreMapper);\n+        this.injectionUsingReflection(AbstractService.class, \"osgpCoreRequestMessageSender\",\n+                this.configurationManagementService, this.osgpCoreRequestMessageSender);\n+        this.injectionUsingReflection(AbstractService.class, \"webServiceResponseMessageSender\",\n+                this.configurationManagementService, this.webServiceResponseMessageSender);\n+        this.injectionUsingReflection(AbstractService.class, \"ssldRepository\", this.configurationManagementService,\n+                this.ssldRepository);\n+\n+        System.setOut(new PrintStream(this.outContent));\n+    }\n+    @Test\n+    public void testTrySetConfiguration() throws FunctionalException, UnknownEntityException {\n+        final long scheduleTime = 1;\n+        final String messageType = \"none\";\n+        final int messagePriority = 1;\n+\n+        final Organisation testOrganisation = new Organisation();\n+\n+        final RelayMap relayMap = new RelayMap(1, 1, RelayType.LIGHT, \"1\");\n+        final ArrayList<RelayMap> relayMapList = new ArrayList<>();\n+        relayMapList.add(relayMap);\n+\n+        when(this.organisationDomainService.searchOrganisation(any(String.class))).thenReturn(testOrganisation);\n+        when(this.deviceDomainService.searchActiveDevice(any(), any())).thenReturn(this.device);\n+        when(this.configuration.getRelayConfiguration()).thenReturn(new RelayConfiguration(relayMapList));\n+        when(this.ssldRepository.findById(any())).thenReturn(java.util.Optional.of(this.ssld));\n+        when(this.domainCoreMapper.map(any(), any())).thenReturn(this.configurationDto);\n+        doNothing().when(this.ssld).updateOutputSettings(any());\n+        when(this.device.getIpAddress()).thenReturn(\"333.333.1.22\");\n+\n+        this.configurationManagementService.setConfiguration(this.ids, this.configuration, scheduleTime,\n+                messageType, messagePriority);\n+\n+        verify(this.osgpCoreRequestMessageSender).sendWithScheduledTime(this.requestMessageArgumentCaptor.capture(),\n+                this.stringArgumentCaptorOne.capture(), this.integerArgumentCaptor.capture(),\n+                this.stringArgumentCaptorTwo.capture(), this.longArgumentCaptor.capture());\n+\n+        assertThat(this.requestMessageArgumentCaptor.getValue().getCorrelationUid()).isEqualTo(\"c\");\n+        assertThat(this.requestMessageArgumentCaptor.getValue().getOrganisationIdentification()).isEqualTo(\"a\");\n+        assertThat(this.requestMessageArgumentCaptor.getValue().getDeviceIdentification()).isEqualTo(\"b\");\n+        assertThat(this.stringArgumentCaptorOne.getValue()).isEqualTo(messageType);\n+        assertThat(this.integerArgumentCaptor.getValue()).isEqualTo(1);\n+        assertThat(this.stringArgumentCaptorTwo.getValue()).isEqualTo(\"333.333.1.22\");\n+        assertThat(this.longArgumentCaptor.getValue()).isEqualTo(1);\n+    }\n+    @Test\n+    public void testTrySetConfigurationWithNoConfiguration() throws Exception {\n+        final long scheduleTime = 1;\n+        final String messageType = \"none\";\n+        final int messagePriority = 1;\n+\n+        final Organisation testOrganisation = new Organisation();\n+        when(this.organisationDomainService.searchOrganisation(any(String.class))).thenReturn(testOrganisation);", "originalCommit": "8a185e21fa2b503ebba41b3a67df1548048198fc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzEwMTMyOA==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/437#discussion_r503101328", "bodyText": "remove these lines", "author": "robindenadel", "createdAt": "2020-10-12T07:49:42Z", "path": "osgp/platform/osgp-adapter-domain-core/src/test/java/org/opensmartgridplatform/adapter/domain/core/application/services/ConfigurationManagementServiceTest.java", "diffHunk": "@@ -0,0 +1,290 @@\n+package org.opensmartgridplatform.adapter.domain.core.application.services;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.Mockito.any;\n+import static org.mockito.Mockito.doNothing;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.when;\n+\n+import java.io.ByteArrayOutputStream;\n+import java.io.PrintStream;\n+import java.lang.reflect.Field;\n+import java.util.ArrayList;\n+\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.ArgumentCaptor;\n+import org.mockito.Captor;\n+import org.mockito.InjectMocks;\n+import org.mockito.Mock;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+import org.mockito.junit.jupiter.MockitoSettings;\n+import org.mockito.quality.Strictness;\n+import org.opensmartgridplatform.adapter.domain.core.application.mapping.DomainCoreMapper;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.core.OsgpCoreRequestMessageSender;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.ws.WebServiceResponseMessageSender;\n+import org.opensmartgridplatform.domain.core.entities.Device;\n+import org.opensmartgridplatform.domain.core.entities.Organisation;\n+import org.opensmartgridplatform.domain.core.entities.Ssld;\n+import org.opensmartgridplatform.domain.core.exceptions.UnknownEntityException;\n+import org.opensmartgridplatform.domain.core.repositories.SsldRepository;\n+import org.opensmartgridplatform.domain.core.services.DeviceDomainService;\n+import org.opensmartgridplatform.domain.core.services.OrganisationDomainService;\n+import org.opensmartgridplatform.domain.core.valueobjects.Configuration;\n+import org.opensmartgridplatform.domain.core.valueobjects.RelayConfiguration;\n+import org.opensmartgridplatform.domain.core.valueobjects.RelayMap;\n+import org.opensmartgridplatform.domain.core.valueobjects.RelayType;\n+import org.opensmartgridplatform.dto.valueobjects.ConfigurationDto;\n+import org.opensmartgridplatform.shared.exceptionhandling.ComponentType;\n+import org.opensmartgridplatform.shared.exceptionhandling.FunctionalException;\n+import org.opensmartgridplatform.shared.exceptionhandling.OsgpException;\n+import org.opensmartgridplatform.shared.infra.jms.CorrelationIds;\n+import org.opensmartgridplatform.shared.infra.jms.RequestMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessageResultType;\n+import org.springframework.beans.factory.annotation.Qualifier;\n+\n+@ExtendWith(MockitoExtension.class)\n+@MockitoSettings(strictness = Strictness.LENIENT)\n+public class ConfigurationManagementServiceTest {\n+    @Mock\n+    private WebServiceResponseMessageSender webServiceResponseMessageSender;\n+    @Mock\n+    private SsldRepository ssldRepository;\n+    @Mock\n+    private ConfigurationDto configurationDto;\n+    @Mock\n+    private DomainCoreMapper domainCoreMapper;\n+    @Mock\n+    private OrganisationDomainService organisationDomainService;\n+    @Mock\n+    private DeviceDomainService deviceDomainService;\n+    @Mock\n+    private CorrelationIds ids;\n+    @Mock\n+    private Configuration configuration;\n+    @Mock\n+    private OsgpCoreRequestMessageSender osgpCoreRequestMessageSender;\n+    @Mock\n+    private Ssld ssld;\n+    @Mock\n+    private Device device;\n+    @Captor\n+    private ArgumentCaptor<RequestMessage> requestMessageArgumentCaptor;\n+    @Captor\n+    private ArgumentCaptor<String> stringArgumentCaptorOne;\n+    @Captor\n+    private ArgumentCaptor<String> stringArgumentCaptorTwo;\n+    @Captor\n+    private ArgumentCaptor<Integer> integerArgumentCaptor;\n+    @Captor\n+    private ArgumentCaptor<Long> longArgumentCaptor;\n+    @Captor\n+    private ArgumentCaptor<ResponseMessage> responseMessageArgumentCaptor;\n+    @InjectMocks\n+    @Qualifier(\"organisationDomainService\")\n+    private ConfigurationManagementService configurationManagementService;\n+    private final String organisationIdentification = \"a\";\n+    private final String deviceIdentification = \"b\";\n+    private final String correlationUid = \"c\";\n+    private OsgpException exception;\n+    private final ByteArrayOutputStream outContent = new ByteArrayOutputStream();\n+    @BeforeEach\n+    public void setUp() throws NoSuchFieldException,\n+            SecurityException, IllegalArgumentException, IllegalAccessException {\n+        // make ids\n+        this.ids = new CorrelationIds(this.organisationIdentification, this.deviceIdentification, this.correlationUid);\n+        this.configurationManagementService = new ConfigurationManagementService();\n+\n+        // do injection using reflection\n+        // Inject Mocks doesn't inject these mocks, possibly because they are in the parent class of\n+        // ConfigurationManagementService\n+        this.injectionUsingReflection(AbstractService.class, \"organisationDomainService\",\n+                this.configurationManagementService, this.organisationDomainService);\n+        this.injectionUsingReflection(AbstractService.class, \"deviceDomainService\", this.configurationManagementService,\n+                this.deviceDomainService);\n+        this.injectionUsingReflection(AbstractService.class, \"domainCoreMapper\", this.configurationManagementService,\n+                this.domainCoreMapper);\n+        this.injectionUsingReflection(AbstractService.class, \"osgpCoreRequestMessageSender\",\n+                this.configurationManagementService, this.osgpCoreRequestMessageSender);\n+        this.injectionUsingReflection(AbstractService.class, \"webServiceResponseMessageSender\",\n+                this.configurationManagementService, this.webServiceResponseMessageSender);\n+        this.injectionUsingReflection(AbstractService.class, \"ssldRepository\", this.configurationManagementService,\n+                this.ssldRepository);\n+\n+        System.setOut(new PrintStream(this.outContent));\n+    }\n+    @Test\n+    public void testTrySetConfiguration() throws FunctionalException, UnknownEntityException {\n+        final long scheduleTime = 1;\n+        final String messageType = \"none\";\n+        final int messagePriority = 1;\n+\n+        final Organisation testOrganisation = new Organisation();\n+\n+        final RelayMap relayMap = new RelayMap(1, 1, RelayType.LIGHT, \"1\");\n+        final ArrayList<RelayMap> relayMapList = new ArrayList<>();\n+        relayMapList.add(relayMap);\n+\n+        when(this.organisationDomainService.searchOrganisation(any(String.class))).thenReturn(testOrganisation);\n+        when(this.deviceDomainService.searchActiveDevice(any(), any())).thenReturn(this.device);\n+        when(this.configuration.getRelayConfiguration()).thenReturn(new RelayConfiguration(relayMapList));\n+        when(this.ssldRepository.findById(any())).thenReturn(java.util.Optional.of(this.ssld));\n+        when(this.domainCoreMapper.map(any(), any())).thenReturn(this.configurationDto);\n+        doNothing().when(this.ssld).updateOutputSettings(any());\n+        when(this.device.getIpAddress()).thenReturn(\"333.333.1.22\");\n+\n+        this.configurationManagementService.setConfiguration(this.ids, this.configuration, scheduleTime,\n+                messageType, messagePriority);\n+\n+        verify(this.osgpCoreRequestMessageSender).sendWithScheduledTime(this.requestMessageArgumentCaptor.capture(),\n+                this.stringArgumentCaptorOne.capture(), this.integerArgumentCaptor.capture(),\n+                this.stringArgumentCaptorTwo.capture(), this.longArgumentCaptor.capture());\n+\n+        assertThat(this.requestMessageArgumentCaptor.getValue().getCorrelationUid()).isEqualTo(\"c\");\n+        assertThat(this.requestMessageArgumentCaptor.getValue().getOrganisationIdentification()).isEqualTo(\"a\");\n+        assertThat(this.requestMessageArgumentCaptor.getValue().getDeviceIdentification()).isEqualTo(\"b\");\n+        assertThat(this.stringArgumentCaptorOne.getValue()).isEqualTo(messageType);\n+        assertThat(this.integerArgumentCaptor.getValue()).isEqualTo(1);\n+        assertThat(this.stringArgumentCaptorTwo.getValue()).isEqualTo(\"333.333.1.22\");\n+        assertThat(this.longArgumentCaptor.getValue()).isEqualTo(1);\n+    }\n+    @Test\n+    public void testTrySetConfigurationWithNoConfiguration() throws Exception {\n+        final long scheduleTime = 1;\n+        final String messageType = \"none\";\n+        final int messagePriority = 1;\n+\n+        final Organisation testOrganisation = new Organisation();\n+        when(this.organisationDomainService.searchOrganisation(any(String.class))).thenReturn(testOrganisation);\n+        when(this.deviceDomainService.searchActiveDevice(any(), any())).thenReturn(new Device());\n+        when(this.organisationDomainService.searchOrganisation(any(String.class))).thenReturn(testOrganisation);\n+\n+        this.configurationManagementService.setConfiguration(this.ids, null, scheduleTime, messageType, messagePriority);\n+\n+        assertThat(this.outContent.toString().contains(\"Configuration is empty, skip sending a request to device\")).isTrue();\n+    }\n+    @Test\n+    public void\n+    testTrySetConfigurationWithNullRelayConfiguration() throws UnknownEntityException, FunctionalException {\n+        final long scheduleTime = 1;\n+        final String messageType = \"none\";\n+        final int messagePriority = 1;\n+\n+        final Organisation testOrganisation = new Organisation();\n+        when(this.organisationDomainService.searchOrganisation(any(String.class))).thenReturn(testOrganisation);\n+        when(this.deviceDomainService.searchActiveDevice(any(), any())).thenReturn(new Device());\n+        when(this.configuration.getRelayConfiguration()).thenReturn(null);\n+\n+        this.configurationManagementService.setConfiguration(this.ids, this.configuration, scheduleTime,\n+                messageType, messagePriority);\n+\n+        verify(this.osgpCoreRequestMessageSender).sendWithScheduledTime(this.requestMessageArgumentCaptor.capture(),\n+                this.stringArgumentCaptorOne.capture(), this.integerArgumentCaptor.capture(),\n+                this.stringArgumentCaptorTwo.capture(), this.longArgumentCaptor.capture());\n+\n+        assertThat(this.requestMessageArgumentCaptor.getValue().getCorrelationUid()).isEqualTo(\"c\");\n+        assertThat(this.requestMessageArgumentCaptor.getValue().getOrganisationIdentification()).isEqualTo(\"a\");\n+        assertThat(this.requestMessageArgumentCaptor.getValue().getDeviceIdentification()).isEqualTo(\"b\");\n+        assertThat(this.stringArgumentCaptorOne.getValue()).isEqualTo(messageType);\n+        assertThat(this.integerArgumentCaptor.getValue()).isEqualTo(1);\n+        assertThat(this.stringArgumentCaptorTwo.getValue()).isEqualTo(null);\n+        assertThat(this.longArgumentCaptor.getValue()).isEqualTo(1);\n+    }\n+    @Test\n+    public void testGetConfiguration() throws UnknownEntityException, FunctionalException {\n+        final String messageType = \"none\";\n+        final int messagePriority = 1;\n+\n+        when(this.organisationDomainService.searchOrganisation(any(String.class))).thenReturn(new Organisation());\n+        when(this.deviceDomainService.searchActiveDevice(any(), any())).thenReturn(this.device);\n+        when(this.device.getIpAddress()).thenReturn(\"333.333.1.22\");\n+\n+        this.configurationManagementService.getConfiguration(this.organisationIdentification, this.deviceIdentification,\n+                this.correlationUid, messageType, messagePriority);\n+\n+        verify(this.osgpCoreRequestMessageSender).send(this.requestMessageArgumentCaptor.capture(),\n+                this.stringArgumentCaptorOne.capture(), this.integerArgumentCaptor.capture(),\n+                this.stringArgumentCaptorTwo.capture());\n+\n+        assertThat(this.requestMessageArgumentCaptor.getValue().getCorrelationUid()).isEqualTo(\"c\");\n+        assertThat(this.requestMessageArgumentCaptor.getValue().getOrganisationIdentification()).isEqualTo(\"a\");\n+        assertThat(this.requestMessageArgumentCaptor.getValue().getDeviceIdentification()).isEqualTo(\"b\");\n+        assertThat(this.stringArgumentCaptorOne.getValue()).isEqualTo(messageType);\n+        assertThat(this.integerArgumentCaptor.getValue()).isEqualTo(1);\n+        assertThat(this.stringArgumentCaptorTwo.getValue()).isEqualTo(\"333.333.1.22\");\n+    }\n+    @Test\n+    public void testHandleGetConfigurationResponse() throws UnknownEntityException, FunctionalException {\n+        final String messageType = \"none\";\n+        final int messagePriority = 1;\n+        this.exception = null;\n+        when(this.organisationDomainService.searchOrganisation(any(String.class))).thenReturn(new Organisation());\n+        when(this.deviceDomainService.searchActiveDevice(any(), any())).thenReturn(new Device());", "originalCommit": "8a185e21fa2b503ebba41b3a67df1548048198fc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "3aa6c1016da1ee56f0b8843a3bcc10819a367ff3", "url": "https://github.com/OSGP/open-smart-grid-platform/commit/3aa6c1016da1ee56f0b8843a3bcc10819a367ff3", "message": "fixed several issues, mainly code style.\n\nAdded license header, changes unnecessary code and fixed some other small issues", "committedDate": "2020-10-13T08:57:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ3MTkwNw==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/437#discussion_r516471907", "bodyText": "A single-line comment should be preceded by a blank line, see https://www.oracle.com/java/technologies/javase/codeconventions-comments.html#341", "author": "robindenadel", "createdAt": "2020-11-03T07:44:54Z", "path": "osgp/platform/osgp-adapter-domain-core/src/test/java/org/opensmartgridplatform/adapter/domain/core/application/services/ConfigurationManagementServiceTest.java", "diffHunk": "@@ -0,0 +1,275 @@\n+/**\n+ * Copyright 2020 Alliander N.V.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ */\n+package org.opensmartgridplatform.adapter.domain.core.application.services;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.Mockito.any;\n+import static org.mockito.Mockito.doNothing;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.when;\n+\n+import java.io.ByteArrayOutputStream;\n+import java.io.PrintStream;\n+import java.lang.reflect.Field;\n+import java.util.Arrays;\n+import java.util.List;\n+\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.ArgumentCaptor;\n+import org.mockito.Captor;\n+import org.mockito.InjectMocks;\n+import org.mockito.Mock;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+import org.opensmartgridplatform.adapter.domain.core.application.mapping.DomainCoreMapper;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.core.OsgpCoreRequestMessageSender;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.ws.WebServiceResponseMessageSender;\n+import org.opensmartgridplatform.domain.core.entities.Device;\n+import org.opensmartgridplatform.domain.core.entities.Organisation;\n+import org.opensmartgridplatform.domain.core.entities.Ssld;\n+import org.opensmartgridplatform.domain.core.exceptions.UnknownEntityException;\n+import org.opensmartgridplatform.domain.core.repositories.SsldRepository;\n+import org.opensmartgridplatform.domain.core.services.DeviceDomainService;\n+import org.opensmartgridplatform.domain.core.services.OrganisationDomainService;\n+import org.opensmartgridplatform.domain.core.valueobjects.Configuration;\n+import org.opensmartgridplatform.domain.core.valueobjects.RelayConfiguration;\n+import org.opensmartgridplatform.domain.core.valueobjects.RelayMap;\n+import org.opensmartgridplatform.domain.core.valueobjects.RelayType;\n+import org.opensmartgridplatform.dto.valueobjects.ConfigurationDto;\n+import org.opensmartgridplatform.shared.exceptionhandling.ComponentType;\n+import org.opensmartgridplatform.shared.exceptionhandling.FunctionalException;\n+import org.opensmartgridplatform.shared.exceptionhandling.OsgpException;\n+import org.opensmartgridplatform.shared.infra.jms.CorrelationIds;\n+import org.opensmartgridplatform.shared.infra.jms.RequestMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessageResultType;\n+import org.springframework.beans.factory.annotation.Qualifier;\n+\n+@ExtendWith(MockitoExtension.class)\n+public class ConfigurationManagementServiceTest {\n+    @Mock\n+    private WebServiceResponseMessageSender webServiceResponseMessageSender;\n+    @Mock\n+    private SsldRepository ssldRepository;\n+    @Mock\n+    private ConfigurationDto configurationDto;\n+    @Mock\n+    private DomainCoreMapper domainCoreMapper;\n+    @Mock\n+    private OrganisationDomainService organisationDomainService;\n+    @Mock\n+    private DeviceDomainService deviceDomainService;\n+    @Mock\n+    private CorrelationIds correlationIds;\n+    @Mock\n+    private Configuration configuration;\n+    @Mock\n+    private OsgpCoreRequestMessageSender osgpCoreRequestMessageSender;\n+    @Mock\n+    private Ssld ssld;\n+    @Mock\n+    private Device device;\n+    @Captor\n+    private ArgumentCaptor<RequestMessage> requestMessageArgumentCaptor;\n+    @Captor\n+    private ArgumentCaptor<String> messageTypeArgumentCaptor;\n+    @Captor\n+    private ArgumentCaptor<String> ipAddressArgumentCaptor;\n+    @Captor\n+    private ArgumentCaptor<Integer> messagePriorityArgumentCaptor;\n+    @Captor\n+    private ArgumentCaptor<Long> scheduledTimeArgumentCaptor;\n+    @Captor\n+    private ArgumentCaptor<ResponseMessage> responseMessageArgumentCaptor;\n+    @InjectMocks\n+    @Qualifier(\"organisationDomainService\")\n+    private ConfigurationManagementService configurationManagementService;\n+\n+    private static final String organisationIdentification = \"orgIdentification\";\n+    private static final String deviceIdentification = \"deviceIdentification\";\n+    private static final String correlationUid = \"correlationUid\";\n+    private static final long scheduleTime = 1;\n+    private static final String messageType = \"none\";\n+    private static final int messagePriority = 1;\n+    private static final String ipAddress = \"333.333.1.22\";\n+\n+    private OsgpException exception;\n+    private static final ByteArrayOutputStream outContent = new ByteArrayOutputStream();\n+\n+    @BeforeEach\n+    public void setUp() throws NoSuchFieldException,\n+            SecurityException, IllegalArgumentException, IllegalAccessException {\n+        // make correlationIds", "originalCommit": "3aa6c1016da1ee56f0b8843a3bcc10819a367ff3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ3MjExMw==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/437#discussion_r516472113", "bodyText": "Constants should be all uppercase with words separated by underscores, see https://www.oracle.com/java/technologies/javase/codeconventions-namingconventions.html", "author": "robindenadel", "createdAt": "2020-11-03T07:45:26Z", "path": "osgp/platform/osgp-adapter-domain-core/src/test/java/org/opensmartgridplatform/adapter/domain/core/application/services/ConfigurationManagementServiceTest.java", "diffHunk": "@@ -0,0 +1,275 @@\n+/**\n+ * Copyright 2020 Alliander N.V.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ */\n+package org.opensmartgridplatform.adapter.domain.core.application.services;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.Mockito.any;\n+import static org.mockito.Mockito.doNothing;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.when;\n+\n+import java.io.ByteArrayOutputStream;\n+import java.io.PrintStream;\n+import java.lang.reflect.Field;\n+import java.util.Arrays;\n+import java.util.List;\n+\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.ArgumentCaptor;\n+import org.mockito.Captor;\n+import org.mockito.InjectMocks;\n+import org.mockito.Mock;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+import org.opensmartgridplatform.adapter.domain.core.application.mapping.DomainCoreMapper;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.core.OsgpCoreRequestMessageSender;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.ws.WebServiceResponseMessageSender;\n+import org.opensmartgridplatform.domain.core.entities.Device;\n+import org.opensmartgridplatform.domain.core.entities.Organisation;\n+import org.opensmartgridplatform.domain.core.entities.Ssld;\n+import org.opensmartgridplatform.domain.core.exceptions.UnknownEntityException;\n+import org.opensmartgridplatform.domain.core.repositories.SsldRepository;\n+import org.opensmartgridplatform.domain.core.services.DeviceDomainService;\n+import org.opensmartgridplatform.domain.core.services.OrganisationDomainService;\n+import org.opensmartgridplatform.domain.core.valueobjects.Configuration;\n+import org.opensmartgridplatform.domain.core.valueobjects.RelayConfiguration;\n+import org.opensmartgridplatform.domain.core.valueobjects.RelayMap;\n+import org.opensmartgridplatform.domain.core.valueobjects.RelayType;\n+import org.opensmartgridplatform.dto.valueobjects.ConfigurationDto;\n+import org.opensmartgridplatform.shared.exceptionhandling.ComponentType;\n+import org.opensmartgridplatform.shared.exceptionhandling.FunctionalException;\n+import org.opensmartgridplatform.shared.exceptionhandling.OsgpException;\n+import org.opensmartgridplatform.shared.infra.jms.CorrelationIds;\n+import org.opensmartgridplatform.shared.infra.jms.RequestMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessageResultType;\n+import org.springframework.beans.factory.annotation.Qualifier;\n+\n+@ExtendWith(MockitoExtension.class)\n+public class ConfigurationManagementServiceTest {\n+    @Mock\n+    private WebServiceResponseMessageSender webServiceResponseMessageSender;\n+    @Mock\n+    private SsldRepository ssldRepository;\n+    @Mock\n+    private ConfigurationDto configurationDto;\n+    @Mock\n+    private DomainCoreMapper domainCoreMapper;\n+    @Mock\n+    private OrganisationDomainService organisationDomainService;\n+    @Mock\n+    private DeviceDomainService deviceDomainService;\n+    @Mock\n+    private CorrelationIds correlationIds;\n+    @Mock\n+    private Configuration configuration;\n+    @Mock\n+    private OsgpCoreRequestMessageSender osgpCoreRequestMessageSender;\n+    @Mock\n+    private Ssld ssld;\n+    @Mock\n+    private Device device;\n+    @Captor\n+    private ArgumentCaptor<RequestMessage> requestMessageArgumentCaptor;\n+    @Captor\n+    private ArgumentCaptor<String> messageTypeArgumentCaptor;\n+    @Captor\n+    private ArgumentCaptor<String> ipAddressArgumentCaptor;\n+    @Captor\n+    private ArgumentCaptor<Integer> messagePriorityArgumentCaptor;\n+    @Captor\n+    private ArgumentCaptor<Long> scheduledTimeArgumentCaptor;\n+    @Captor\n+    private ArgumentCaptor<ResponseMessage> responseMessageArgumentCaptor;\n+    @InjectMocks\n+    @Qualifier(\"organisationDomainService\")\n+    private ConfigurationManagementService configurationManagementService;\n+\n+    private static final String organisationIdentification = \"orgIdentification\";\n+    private static final String deviceIdentification = \"deviceIdentification\";\n+    private static final String correlationUid = \"correlationUid\";\n+    private static final long scheduleTime = 1;\n+    private static final String messageType = \"none\";\n+    private static final int messagePriority = 1;\n+    private static final String ipAddress = \"333.333.1.22\";", "originalCommit": "3aa6c1016da1ee56f0b8843a3bcc10819a367ff3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ3NTMyMQ==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/437#discussion_r516475321", "bodyText": "check to the constant messagePriority\ngoes for other tests as well", "author": "robindenadel", "createdAt": "2020-11-03T07:53:10Z", "path": "osgp/platform/osgp-adapter-domain-core/src/test/java/org/opensmartgridplatform/adapter/domain/core/application/services/ConfigurationManagementServiceTest.java", "diffHunk": "@@ -0,0 +1,275 @@\n+/**\n+ * Copyright 2020 Alliander N.V.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ */\n+package org.opensmartgridplatform.adapter.domain.core.application.services;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.Mockito.any;\n+import static org.mockito.Mockito.doNothing;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.when;\n+\n+import java.io.ByteArrayOutputStream;\n+import java.io.PrintStream;\n+import java.lang.reflect.Field;\n+import java.util.Arrays;\n+import java.util.List;\n+\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.ArgumentCaptor;\n+import org.mockito.Captor;\n+import org.mockito.InjectMocks;\n+import org.mockito.Mock;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+import org.opensmartgridplatform.adapter.domain.core.application.mapping.DomainCoreMapper;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.core.OsgpCoreRequestMessageSender;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.ws.WebServiceResponseMessageSender;\n+import org.opensmartgridplatform.domain.core.entities.Device;\n+import org.opensmartgridplatform.domain.core.entities.Organisation;\n+import org.opensmartgridplatform.domain.core.entities.Ssld;\n+import org.opensmartgridplatform.domain.core.exceptions.UnknownEntityException;\n+import org.opensmartgridplatform.domain.core.repositories.SsldRepository;\n+import org.opensmartgridplatform.domain.core.services.DeviceDomainService;\n+import org.opensmartgridplatform.domain.core.services.OrganisationDomainService;\n+import org.opensmartgridplatform.domain.core.valueobjects.Configuration;\n+import org.opensmartgridplatform.domain.core.valueobjects.RelayConfiguration;\n+import org.opensmartgridplatform.domain.core.valueobjects.RelayMap;\n+import org.opensmartgridplatform.domain.core.valueobjects.RelayType;\n+import org.opensmartgridplatform.dto.valueobjects.ConfigurationDto;\n+import org.opensmartgridplatform.shared.exceptionhandling.ComponentType;\n+import org.opensmartgridplatform.shared.exceptionhandling.FunctionalException;\n+import org.opensmartgridplatform.shared.exceptionhandling.OsgpException;\n+import org.opensmartgridplatform.shared.infra.jms.CorrelationIds;\n+import org.opensmartgridplatform.shared.infra.jms.RequestMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessageResultType;\n+import org.springframework.beans.factory.annotation.Qualifier;\n+\n+@ExtendWith(MockitoExtension.class)\n+public class ConfigurationManagementServiceTest {\n+    @Mock\n+    private WebServiceResponseMessageSender webServiceResponseMessageSender;\n+    @Mock\n+    private SsldRepository ssldRepository;\n+    @Mock\n+    private ConfigurationDto configurationDto;\n+    @Mock\n+    private DomainCoreMapper domainCoreMapper;\n+    @Mock\n+    private OrganisationDomainService organisationDomainService;\n+    @Mock\n+    private DeviceDomainService deviceDomainService;\n+    @Mock\n+    private CorrelationIds correlationIds;\n+    @Mock\n+    private Configuration configuration;\n+    @Mock\n+    private OsgpCoreRequestMessageSender osgpCoreRequestMessageSender;\n+    @Mock\n+    private Ssld ssld;\n+    @Mock\n+    private Device device;\n+    @Captor\n+    private ArgumentCaptor<RequestMessage> requestMessageArgumentCaptor;\n+    @Captor\n+    private ArgumentCaptor<String> messageTypeArgumentCaptor;\n+    @Captor\n+    private ArgumentCaptor<String> ipAddressArgumentCaptor;\n+    @Captor\n+    private ArgumentCaptor<Integer> messagePriorityArgumentCaptor;\n+    @Captor\n+    private ArgumentCaptor<Long> scheduledTimeArgumentCaptor;\n+    @Captor\n+    private ArgumentCaptor<ResponseMessage> responseMessageArgumentCaptor;\n+    @InjectMocks\n+    @Qualifier(\"organisationDomainService\")\n+    private ConfigurationManagementService configurationManagementService;\n+\n+    private static final String organisationIdentification = \"orgIdentification\";\n+    private static final String deviceIdentification = \"deviceIdentification\";\n+    private static final String correlationUid = \"correlationUid\";\n+    private static final long scheduleTime = 1;\n+    private static final String messageType = \"none\";\n+    private static final int messagePriority = 1;\n+    private static final String ipAddress = \"333.333.1.22\";\n+\n+    private OsgpException exception;\n+    private static final ByteArrayOutputStream outContent = new ByteArrayOutputStream();\n+\n+    @BeforeEach\n+    public void setUp() throws NoSuchFieldException,\n+            SecurityException, IllegalArgumentException, IllegalAccessException {\n+        // make correlationIds\n+        this.correlationIds = new CorrelationIds(organisationIdentification, deviceIdentification, correlationUid);\n+        this.configurationManagementService = new ConfigurationManagementService();\n+\n+        // do injection using reflection\n+        // Inject Mocks doesn't inject these mocks, possibly because they are in the parent class of\n+        // ConfigurationManagementService\n+        this.injectionUsingReflection(\"organisationDomainService\",\n+                this.configurationManagementService, this.organisationDomainService);\n+        this.injectionUsingReflection(\"deviceDomainService\", this.configurationManagementService,\n+                this.deviceDomainService);\n+        this.injectionUsingReflection(\"domainCoreMapper\", this.configurationManagementService,\n+                this.domainCoreMapper);\n+        this.injectionUsingReflection(\"osgpCoreRequestMessageSender\",\n+                this.configurationManagementService, this.osgpCoreRequestMessageSender);\n+        this.injectionUsingReflection(\"webServiceResponseMessageSender\",\n+                this.configurationManagementService, this.webServiceResponseMessageSender);\n+        this.injectionUsingReflection(\"ssldRepository\", this.configurationManagementService,\n+                this.ssldRepository);\n+\n+        System.setOut(new PrintStream(this.outContent));\n+    }\n+\n+    @Test\n+    public void testTrySetConfiguration() throws FunctionalException, UnknownEntityException {\n+        final Organisation testOrganisation = new Organisation();\n+\n+        final RelayMap relayMap = new RelayMap(1, 1, RelayType.LIGHT, \"1\");\n+        final List<RelayMap> relayMapList = Arrays.asList(relayMap);\n+\n+        when(this.organisationDomainService.searchOrganisation(any(String.class))).thenReturn(testOrganisation);\n+        when(this.deviceDomainService.searchActiveDevice(any(), any())).thenReturn(this.device);\n+        when(this.configuration.getRelayConfiguration()).thenReturn(new RelayConfiguration(relayMapList));\n+        when(this.ssldRepository.findById(any())).thenReturn(java.util.Optional.of(this.ssld));\n+        when(this.domainCoreMapper.map(any(), any())).thenReturn(this.configurationDto);\n+        doNothing().when(this.ssld).updateOutputSettings(any());\n+        when(this.device.getIpAddress()).thenReturn(ipAddress);\n+\n+        this.configurationManagementService.setConfiguration(this.correlationIds, this.configuration, scheduleTime,\n+                messageType, messagePriority);\n+\n+        verify(this.osgpCoreRequestMessageSender).sendWithScheduledTime(this.requestMessageArgumentCaptor.capture(),\n+                this.messageTypeArgumentCaptor.capture(), this.messagePriorityArgumentCaptor.capture(),\n+                this.ipAddressArgumentCaptor.capture(), this.scheduledTimeArgumentCaptor.capture());\n+\n+        assertThat(this.requestMessageArgumentCaptor.getValue().getCorrelationUid()).isEqualTo(\"correlationUid\");\n+        assertThat(this.requestMessageArgumentCaptor.getValue().getOrganisationIdentification()).isEqualTo(\"orgIdentification\");\n+        assertThat(this.requestMessageArgumentCaptor.getValue().getDeviceIdentification()).isEqualTo(\"deviceIdentification\");\n+        assertThat(this.messageTypeArgumentCaptor.getValue()).isEqualTo(messageType);\n+        assertThat(this.messagePriorityArgumentCaptor.getValue()).isEqualTo(1);", "originalCommit": "3aa6c1016da1ee56f0b8843a3bcc10819a367ff3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ3NTU2Nw==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/437#discussion_r516475567", "bodyText": "check to the constant scheduleTime\ngoes for other tests as well", "author": "robindenadel", "createdAt": "2020-11-03T07:53:43Z", "path": "osgp/platform/osgp-adapter-domain-core/src/test/java/org/opensmartgridplatform/adapter/domain/core/application/services/ConfigurationManagementServiceTest.java", "diffHunk": "@@ -0,0 +1,275 @@\n+/**\n+ * Copyright 2020 Alliander N.V.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ */\n+package org.opensmartgridplatform.adapter.domain.core.application.services;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.Mockito.any;\n+import static org.mockito.Mockito.doNothing;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.when;\n+\n+import java.io.ByteArrayOutputStream;\n+import java.io.PrintStream;\n+import java.lang.reflect.Field;\n+import java.util.Arrays;\n+import java.util.List;\n+\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.ArgumentCaptor;\n+import org.mockito.Captor;\n+import org.mockito.InjectMocks;\n+import org.mockito.Mock;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+import org.opensmartgridplatform.adapter.domain.core.application.mapping.DomainCoreMapper;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.core.OsgpCoreRequestMessageSender;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.ws.WebServiceResponseMessageSender;\n+import org.opensmartgridplatform.domain.core.entities.Device;\n+import org.opensmartgridplatform.domain.core.entities.Organisation;\n+import org.opensmartgridplatform.domain.core.entities.Ssld;\n+import org.opensmartgridplatform.domain.core.exceptions.UnknownEntityException;\n+import org.opensmartgridplatform.domain.core.repositories.SsldRepository;\n+import org.opensmartgridplatform.domain.core.services.DeviceDomainService;\n+import org.opensmartgridplatform.domain.core.services.OrganisationDomainService;\n+import org.opensmartgridplatform.domain.core.valueobjects.Configuration;\n+import org.opensmartgridplatform.domain.core.valueobjects.RelayConfiguration;\n+import org.opensmartgridplatform.domain.core.valueobjects.RelayMap;\n+import org.opensmartgridplatform.domain.core.valueobjects.RelayType;\n+import org.opensmartgridplatform.dto.valueobjects.ConfigurationDto;\n+import org.opensmartgridplatform.shared.exceptionhandling.ComponentType;\n+import org.opensmartgridplatform.shared.exceptionhandling.FunctionalException;\n+import org.opensmartgridplatform.shared.exceptionhandling.OsgpException;\n+import org.opensmartgridplatform.shared.infra.jms.CorrelationIds;\n+import org.opensmartgridplatform.shared.infra.jms.RequestMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessageResultType;\n+import org.springframework.beans.factory.annotation.Qualifier;\n+\n+@ExtendWith(MockitoExtension.class)\n+public class ConfigurationManagementServiceTest {\n+    @Mock\n+    private WebServiceResponseMessageSender webServiceResponseMessageSender;\n+    @Mock\n+    private SsldRepository ssldRepository;\n+    @Mock\n+    private ConfigurationDto configurationDto;\n+    @Mock\n+    private DomainCoreMapper domainCoreMapper;\n+    @Mock\n+    private OrganisationDomainService organisationDomainService;\n+    @Mock\n+    private DeviceDomainService deviceDomainService;\n+    @Mock\n+    private CorrelationIds correlationIds;\n+    @Mock\n+    private Configuration configuration;\n+    @Mock\n+    private OsgpCoreRequestMessageSender osgpCoreRequestMessageSender;\n+    @Mock\n+    private Ssld ssld;\n+    @Mock\n+    private Device device;\n+    @Captor\n+    private ArgumentCaptor<RequestMessage> requestMessageArgumentCaptor;\n+    @Captor\n+    private ArgumentCaptor<String> messageTypeArgumentCaptor;\n+    @Captor\n+    private ArgumentCaptor<String> ipAddressArgumentCaptor;\n+    @Captor\n+    private ArgumentCaptor<Integer> messagePriorityArgumentCaptor;\n+    @Captor\n+    private ArgumentCaptor<Long> scheduledTimeArgumentCaptor;\n+    @Captor\n+    private ArgumentCaptor<ResponseMessage> responseMessageArgumentCaptor;\n+    @InjectMocks\n+    @Qualifier(\"organisationDomainService\")\n+    private ConfigurationManagementService configurationManagementService;\n+\n+    private static final String organisationIdentification = \"orgIdentification\";\n+    private static final String deviceIdentification = \"deviceIdentification\";\n+    private static final String correlationUid = \"correlationUid\";\n+    private static final long scheduleTime = 1;\n+    private static final String messageType = \"none\";\n+    private static final int messagePriority = 1;\n+    private static final String ipAddress = \"333.333.1.22\";\n+\n+    private OsgpException exception;\n+    private static final ByteArrayOutputStream outContent = new ByteArrayOutputStream();\n+\n+    @BeforeEach\n+    public void setUp() throws NoSuchFieldException,\n+            SecurityException, IllegalArgumentException, IllegalAccessException {\n+        // make correlationIds\n+        this.correlationIds = new CorrelationIds(organisationIdentification, deviceIdentification, correlationUid);\n+        this.configurationManagementService = new ConfigurationManagementService();\n+\n+        // do injection using reflection\n+        // Inject Mocks doesn't inject these mocks, possibly because they are in the parent class of\n+        // ConfigurationManagementService\n+        this.injectionUsingReflection(\"organisationDomainService\",\n+                this.configurationManagementService, this.organisationDomainService);\n+        this.injectionUsingReflection(\"deviceDomainService\", this.configurationManagementService,\n+                this.deviceDomainService);\n+        this.injectionUsingReflection(\"domainCoreMapper\", this.configurationManagementService,\n+                this.domainCoreMapper);\n+        this.injectionUsingReflection(\"osgpCoreRequestMessageSender\",\n+                this.configurationManagementService, this.osgpCoreRequestMessageSender);\n+        this.injectionUsingReflection(\"webServiceResponseMessageSender\",\n+                this.configurationManagementService, this.webServiceResponseMessageSender);\n+        this.injectionUsingReflection(\"ssldRepository\", this.configurationManagementService,\n+                this.ssldRepository);\n+\n+        System.setOut(new PrintStream(this.outContent));\n+    }\n+\n+    @Test\n+    public void testTrySetConfiguration() throws FunctionalException, UnknownEntityException {\n+        final Organisation testOrganisation = new Organisation();\n+\n+        final RelayMap relayMap = new RelayMap(1, 1, RelayType.LIGHT, \"1\");\n+        final List<RelayMap> relayMapList = Arrays.asList(relayMap);\n+\n+        when(this.organisationDomainService.searchOrganisation(any(String.class))).thenReturn(testOrganisation);\n+        when(this.deviceDomainService.searchActiveDevice(any(), any())).thenReturn(this.device);\n+        when(this.configuration.getRelayConfiguration()).thenReturn(new RelayConfiguration(relayMapList));\n+        when(this.ssldRepository.findById(any())).thenReturn(java.util.Optional.of(this.ssld));\n+        when(this.domainCoreMapper.map(any(), any())).thenReturn(this.configurationDto);\n+        doNothing().when(this.ssld).updateOutputSettings(any());\n+        when(this.device.getIpAddress()).thenReturn(ipAddress);\n+\n+        this.configurationManagementService.setConfiguration(this.correlationIds, this.configuration, scheduleTime,\n+                messageType, messagePriority);\n+\n+        verify(this.osgpCoreRequestMessageSender).sendWithScheduledTime(this.requestMessageArgumentCaptor.capture(),\n+                this.messageTypeArgumentCaptor.capture(), this.messagePriorityArgumentCaptor.capture(),\n+                this.ipAddressArgumentCaptor.capture(), this.scheduledTimeArgumentCaptor.capture());\n+\n+        assertThat(this.requestMessageArgumentCaptor.getValue().getCorrelationUid()).isEqualTo(\"correlationUid\");\n+        assertThat(this.requestMessageArgumentCaptor.getValue().getOrganisationIdentification()).isEqualTo(\"orgIdentification\");\n+        assertThat(this.requestMessageArgumentCaptor.getValue().getDeviceIdentification()).isEqualTo(\"deviceIdentification\");\n+        assertThat(this.messageTypeArgumentCaptor.getValue()).isEqualTo(messageType);\n+        assertThat(this.messagePriorityArgumentCaptor.getValue()).isEqualTo(1);\n+        assertThat(this.ipAddressArgumentCaptor.getValue()).isEqualTo(ipAddress);\n+        assertThat(this.scheduledTimeArgumentCaptor.getValue()).isEqualTo(1);", "originalCommit": "3aa6c1016da1ee56f0b8843a3bcc10819a367ff3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "7a4943f9e4395617e25ea6df3fa711bfb748ec11", "url": "https://github.com/OSGP/open-smart-grid-platform/commit/7a4943f9e4395617e25ea6df3fa711bfb748ec11", "message": "Several code quality improvements to ConfigurationManagementServiceTest\n\nMake some changes to improve code quality: renamed constants, make a variable constant. change a few checks to check the constant rather than a number and moved a few asserts to a seperate method since they are always checked together", "committedDate": "2020-11-26T09:31:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTQzMDA5Ng==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/437#discussion_r531430096", "bodyText": "The static field ConfigurationManagementServiceTest.OUT_CONTENT should be accessed in a static way.\nSo replace this.OUT_CONTENT with OUT_CONTENT\ngoes for all the occurences of this.OUT_CONTENT", "author": "robindenadel", "createdAt": "2020-11-27T07:47:40Z", "path": "osgp/platform/osgp-adapter-domain-core/src/test/java/org/opensmartgridplatform/adapter/domain/core/application/services/ConfigurationManagementServiceTest.java", "diffHunk": "@@ -0,0 +1,275 @@\n+/**\n+ * Copyright 2020 Alliander N.V.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ */\n+package org.opensmartgridplatform.adapter.domain.core.application.services;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.Mockito.any;\n+import static org.mockito.Mockito.doNothing;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.when;\n+\n+import java.io.ByteArrayOutputStream;\n+import java.io.PrintStream;\n+import java.lang.reflect.Field;\n+import java.util.Arrays;\n+import java.util.List;\n+\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.ArgumentCaptor;\n+import org.mockito.Captor;\n+import org.mockito.InjectMocks;\n+import org.mockito.Mock;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+import org.opensmartgridplatform.adapter.domain.core.application.mapping.DomainCoreMapper;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.core.OsgpCoreRequestMessageSender;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.ws.WebServiceResponseMessageSender;\n+import org.opensmartgridplatform.domain.core.entities.Device;\n+import org.opensmartgridplatform.domain.core.entities.Organisation;\n+import org.opensmartgridplatform.domain.core.entities.Ssld;\n+import org.opensmartgridplatform.domain.core.exceptions.UnknownEntityException;\n+import org.opensmartgridplatform.domain.core.repositories.SsldRepository;\n+import org.opensmartgridplatform.domain.core.services.DeviceDomainService;\n+import org.opensmartgridplatform.domain.core.services.OrganisationDomainService;\n+import org.opensmartgridplatform.domain.core.valueobjects.Configuration;\n+import org.opensmartgridplatform.domain.core.valueobjects.RelayConfiguration;\n+import org.opensmartgridplatform.domain.core.valueobjects.RelayMap;\n+import org.opensmartgridplatform.domain.core.valueobjects.RelayType;\n+import org.opensmartgridplatform.dto.valueobjects.ConfigurationDto;\n+import org.opensmartgridplatform.shared.exceptionhandling.ComponentType;\n+import org.opensmartgridplatform.shared.exceptionhandling.FunctionalException;\n+import org.opensmartgridplatform.shared.exceptionhandling.OsgpException;\n+import org.opensmartgridplatform.shared.infra.jms.CorrelationIds;\n+import org.opensmartgridplatform.shared.infra.jms.RequestMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessageResultType;\n+import org.springframework.beans.factory.annotation.Qualifier;\n+\n+@ExtendWith(MockitoExtension.class)\n+public class ConfigurationManagementServiceTest {\n+    @Mock\n+    private WebServiceResponseMessageSender webServiceResponseMessageSender;\n+    @Mock\n+    private SsldRepository ssldRepository;\n+    @Mock\n+    private ConfigurationDto configurationDto;\n+    @Mock\n+    private DomainCoreMapper domainCoreMapper;\n+    @Mock\n+    private OrganisationDomainService organisationDomainService;\n+    @Mock\n+    private DeviceDomainService deviceDomainService;\n+    @Mock\n+    private CorrelationIds correlationIds;\n+    @Mock\n+    private Configuration configuration;\n+    @Mock\n+    private OsgpCoreRequestMessageSender osgpCoreRequestMessageSender;\n+    @Mock\n+    private Ssld ssld;\n+    @Mock\n+    private Device device;\n+    @Captor\n+    private ArgumentCaptor<RequestMessage> requestMessageArgumentCaptor;\n+    @Captor\n+    private ArgumentCaptor<String> messageTypeArgumentCaptor;\n+    @Captor\n+    private ArgumentCaptor<String> ipAddressArgumentCaptor;\n+    @Captor\n+    private ArgumentCaptor<Integer> messagePriorityArgumentCaptor;\n+    @Captor\n+    private ArgumentCaptor<Long> scheduledTimeArgumentCaptor;\n+    @Captor\n+    private ArgumentCaptor<ResponseMessage> responseMessageArgumentCaptor;\n+    @InjectMocks\n+    @Qualifier(\"organisationDomainService\")\n+    private ConfigurationManagementService configurationManagementService;\n+\n+    private static final String ORG_IDENTIFICATION = \"orgIdentification\";\n+    private static final String DEVICE_IDENTIFICATION = \"deviceIdentification\";\n+    private static final String CORRELATION_UID = \"correlationUid\";\n+    private static final long SCHEDULE_TIME = 1;\n+    private static final String MESSAGE_TYPE = \"none\";\n+    private static final int MESSAGE_PRIORITY = 1;\n+    private static final String IP_ADDRESS = \"333.333.1.22\";\n+\n+    private OsgpException exception;\n+    private static final ByteArrayOutputStream OUT_CONTENT = new ByteArrayOutputStream();\n+    private static final Organisation TEST_ORGANISATION = new Organisation();\n+\n+    @BeforeEach\n+    public void setUp() throws NoSuchFieldException,\n+            SecurityException, IllegalArgumentException, IllegalAccessException {\n+\n+        // make correlationIds\n+        this.correlationIds = new CorrelationIds(ORG_IDENTIFICATION, DEVICE_IDENTIFICATION, CORRELATION_UID);\n+        this.configurationManagementService = new ConfigurationManagementService();\n+\n+        // do injection using reflection\n+        // Inject Mocks doesn't inject these mocks, possibly because they are in the parent class of\n+        // ConfigurationManagementService\n+        this.injectionUsingReflection(\"organisationDomainService\",\n+                this.configurationManagementService, this.organisationDomainService);\n+        this.injectionUsingReflection(\"deviceDomainService\", this.configurationManagementService,\n+                this.deviceDomainService);\n+        this.injectionUsingReflection(\"domainCoreMapper\", this.configurationManagementService,\n+                this.domainCoreMapper);\n+        this.injectionUsingReflection(\"osgpCoreRequestMessageSender\",\n+                this.configurationManagementService, this.osgpCoreRequestMessageSender);\n+        this.injectionUsingReflection(\"webServiceResponseMessageSender\",\n+                this.configurationManagementService, this.webServiceResponseMessageSender);\n+        this.injectionUsingReflection(\"ssldRepository\", this.configurationManagementService,\n+                this.ssldRepository);\n+\n+        System.setOut(new PrintStream(this.OUT_CONTENT));", "originalCommit": "7a4943f9e4395617e25ea6df3fa711bfb748ec11", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "bce83258512828ebae36f6b972210a97c88c8943", "url": "https://github.com/OSGP/open-smart-grid-platform/commit/bce83258512828ebae36f6b972210a97c88c8943", "message": "Several more code quality fixes.\n\nremoved public for the class and tests, and removed \nthe this before the static values.", "committedDate": "2020-12-01T08:29:10Z", "type": "commit"}, {"oid": "372fc75c3a2a9a9e8471aa8ee5813e353cd9a7a8", "url": "https://github.com/OSGP/open-smart-grid-platform/commit/372fc75c3a2a9a9e8471aa8ee5813e353cd9a7a8", "message": "One more code quality fix\n\nanother this removed, missed in the last commit", "committedDate": "2020-12-01T08:37:52Z", "type": "commit"}, {"oid": "6c12413769ab430df9e66bfd0b02122f60acdeec", "url": "https://github.com/OSGP/open-smart-grid-platform/commit/6c12413769ab430df9e66bfd0b02122f60acdeec", "message": "Removed reflection and improved some tests\n\nwith some changes the mock injection worked without injection. Two tests used (faulty) logger output in assertion, this was changed to check that specific methods were not called", "committedDate": "2020-12-10T09:20:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzMzOTQ3Mw==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/437#discussion_r543339473", "bodyText": "Formatting not OK, check your settings", "author": "robindenadel", "createdAt": "2020-12-15T13:27:20Z", "path": "osgp/platform/osgp-adapter-domain-core/src/test/java/org/opensmartgridplatform/adapter/domain/core/application/services/ConfigurationManagementServiceTest.java", "diffHunk": "@@ -0,0 +1,243 @@\n+/**\n+ * Copyright 2020 Alliander N.V.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ */\n+package org.opensmartgridplatform.adapter.domain.core.application.services;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.Mockito.any;\n+import static org.mockito.Mockito.doNothing;\n+import static org.mockito.Mockito.never;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.when;\n+\n+import java.util.Collections;\n+import java.util.List;\n+\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.ArgumentCaptor;\n+import org.mockito.Captor;\n+import org.mockito.InjectMocks;\n+import org.mockito.Mock;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+import org.opensmartgridplatform.adapter.domain.core.application.mapping.DomainCoreMapper;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.core.OsgpCoreRequestMessageSender;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.ws.WebServiceResponseMessageSender;\n+import org.opensmartgridplatform.domain.core.entities.Device;\n+import org.opensmartgridplatform.domain.core.entities.Organisation;\n+import org.opensmartgridplatform.domain.core.entities.Ssld;\n+import org.opensmartgridplatform.domain.core.exceptions.UnknownEntityException;\n+import org.opensmartgridplatform.domain.core.repositories.SsldRepository;\n+import org.opensmartgridplatform.domain.core.services.DeviceDomainService;\n+import org.opensmartgridplatform.domain.core.services.OrganisationDomainService;\n+import org.opensmartgridplatform.domain.core.valueobjects.Configuration;\n+import org.opensmartgridplatform.domain.core.valueobjects.RelayConfiguration;\n+import org.opensmartgridplatform.domain.core.valueobjects.RelayMap;\n+import org.opensmartgridplatform.domain.core.valueobjects.RelayType;\n+import org.opensmartgridplatform.dto.valueobjects.ConfigurationDto;\n+import org.opensmartgridplatform.shared.exceptionhandling.ComponentType;\n+import org.opensmartgridplatform.shared.exceptionhandling.FunctionalException;\n+import org.opensmartgridplatform.shared.exceptionhandling.OsgpException;\n+import org.opensmartgridplatform.shared.infra.jms.CorrelationIds;\n+import org.opensmartgridplatform.shared.infra.jms.RequestMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessageResultType;\n+import org.springframework.beans.factory.annotation.Qualifier;\n+\n+@ExtendWith(MockitoExtension.class)\n+class ConfigurationManagementServiceTest {\n+    @Mock\n+    private WebServiceResponseMessageSender webServiceResponseMessageSender;\n+    @Mock\n+    private SsldRepository ssldRepository;\n+    @Mock\n+    private ConfigurationDto configurationDto;\n+    @Mock\n+    private DomainCoreMapper domainCoreMapper;\n+    @Mock\n+    private OrganisationDomainService organisationDomainService;\n+    @Mock\n+    private DeviceDomainService deviceDomainService;\n+    @Mock\n+    private CorrelationIds correlationIds;\n+    @Mock\n+    private Configuration configuration;\n+    @Mock\n+    private OsgpCoreRequestMessageSender osgpCoreRequestMessageSender;\n+    @Mock\n+    private Ssld ssld;\n+    @Mock\n+    private Device device;\n+    @Captor\n+    private ArgumentCaptor<RequestMessage> requestMessageArgumentCaptor;\n+    @Captor\n+    private ArgumentCaptor<String> messageTypeArgumentCaptor;\n+    @Captor\n+    private ArgumentCaptor<String> ipAddressArgumentCaptor;\n+    @Captor\n+    private ArgumentCaptor<Integer> messagePriorityArgumentCaptor;\n+    @Captor\n+    private ArgumentCaptor<Long> scheduledTimeArgumentCaptor;\n+    @Captor\n+    private ArgumentCaptor<ResponseMessage> responseMessageArgumentCaptor;\n+    @InjectMocks\n+    @Qualifier(\"organisationDomainService\")\n+    private ConfigurationManagementService configurationManagementService;\n+\n+    private static final String ORG_IDENTIFICATION = \"orgIdentification\";\n+    private static final String DEVICE_IDENTIFICATION = \"deviceIdentification\";\n+    private static final String CORRELATION_UID = \"correlationUid\";\n+    private static final long SCHEDULE_TIME = 1;\n+    private static final String MESSAGE_TYPE = \"none\";\n+    private static final int MESSAGE_PRIORITY = 1;\n+    private static final String IP_ADDRESS = \"333.333.1.22\";\n+\n+    private OsgpException exception;\n+    private static final Organisation TEST_ORGANISATION = new Organisation();\n+\n+    @BeforeEach\n+    public void setUp() throws SecurityException, IllegalArgumentException {\n+\n+        // make correlationIds\n+        this.correlationIds = new CorrelationIds(ORG_IDENTIFICATION, DEVICE_IDENTIFICATION, CORRELATION_UID);\n+    }\n+\n+    @Test\n+    void testTrySetConfiguration() throws FunctionalException, UnknownEntityException {\n+        final RelayMap relayMap = new RelayMap(1, 1, RelayType.LIGHT, \"1\");\n+        final List<RelayMap> relayMapList = Collections.singletonList(relayMap);\n+\n+        when(this.organisationDomainService.searchOrganisation(any(String.class))).thenReturn(TEST_ORGANISATION);\n+        when(this.deviceDomainService.searchActiveDevice(any(), any())).thenReturn(this.device);\n+        when(this.configuration.getRelayConfiguration()).thenReturn(new RelayConfiguration(relayMapList));\n+        when(this.ssldRepository.findById(any())).thenReturn(java.util.Optional.of(this.ssld));\n+        when(this.domainCoreMapper.map(any(), any())).thenReturn(this.configurationDto);\n+        doNothing().when(this.ssld).updateOutputSettings(any());\n+        when(this.device.getIpAddress()).thenReturn(IP_ADDRESS);\n+\n+        this.configurationManagementService.setConfiguration(this.correlationIds, this.configuration, SCHEDULE_TIME,\n+                MESSAGE_TYPE, MESSAGE_PRIORITY);\n+\n+        verify(this.osgpCoreRequestMessageSender).sendWithScheduledTime(this.requestMessageArgumentCaptor.capture(),\n+                this.messageTypeArgumentCaptor.capture(), this.messagePriorityArgumentCaptor.capture(),\n+                this.ipAddressArgumentCaptor.capture(), this.scheduledTimeArgumentCaptor.capture());\n+\n+        this.checkRequestMessageArgumentCaptor();\n+        assertThat(this.messageTypeArgumentCaptor.getValue()).isEqualTo(MESSAGE_TYPE);\n+        assertThat(this.messagePriorityArgumentCaptor.getValue()).isEqualTo(MESSAGE_PRIORITY);\n+        assertThat(this.ipAddressArgumentCaptor.getValue()).isEqualTo(IP_ADDRESS);\n+        assertThat(this.scheduledTimeArgumentCaptor.getValue()).isEqualTo(SCHEDULE_TIME);\n+    }\n+\n+    @Test\n+    void testTrySetConfigurationWithNoConfiguration() throws Exception {\n+        this.configurationManagementService.setConfiguration(this.correlationIds, null, SCHEDULE_TIME, MESSAGE_TYPE,\n+                MESSAGE_PRIORITY);\n+\n+        verify(this.domainCoreMapper, never()).map(any(), any());\n+    }\n+\n+    @Test\n+    void testTrySetConfigurationWithNullRelayConfiguration() throws UnknownEntityException, FunctionalException {\n+        final Organisation testOrganisation = new Organisation();\n+        when(this.organisationDomainService.searchOrganisation(any(String.class))).thenReturn(testOrganisation);\n+        when(this.deviceDomainService.searchActiveDevice(any(), any())).thenReturn(new Device());\n+        when(this.configuration.getRelayConfiguration()).thenReturn(null);\n+\n+        this.configurationManagementService.setConfiguration(this.correlationIds, this.configuration, SCHEDULE_TIME,\n+                MESSAGE_TYPE, MESSAGE_PRIORITY);\n+\n+        verify(this.osgpCoreRequestMessageSender).sendWithScheduledTime(this.requestMessageArgumentCaptor.capture(),\n+                this.messageTypeArgumentCaptor.capture(), this.messagePriorityArgumentCaptor.capture(),\n+                this.ipAddressArgumentCaptor.capture(), this.scheduledTimeArgumentCaptor.capture());\n+\n+        this.checkRequestMessageArgumentCaptor();\n+        assertThat(this.messageTypeArgumentCaptor.getValue()).isEqualTo(MESSAGE_TYPE);\n+        assertThat(this.messagePriorityArgumentCaptor.getValue()).isEqualTo(MESSAGE_PRIORITY);\n+        assertThat(this.ipAddressArgumentCaptor.getValue()).isNull();\n+        assertThat(this.scheduledTimeArgumentCaptor.getValue()).isEqualTo(SCHEDULE_TIME);    }", "originalCommit": "6c12413769ab430df9e66bfd0b02122f60acdeec", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "c8249c3427474aeb864c944236a56f34d0868087", "url": "https://github.com/OSGP/open-smart-grid-platform/commit/c8249c3427474aeb864c944236a56f34d0868087", "message": "Apply code format styles", "committedDate": "2020-12-15T13:50:14Z", "type": "commit"}]}