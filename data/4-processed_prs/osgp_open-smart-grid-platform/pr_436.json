{"pr_number": 436, "pr_title": "Code quality/increase coverage of device installation service", "pr_createdAt": "2020-09-29T07:04:34Z", "pr_url": "https://github.com/OSGP/open-smart-grid-platform/pull/436", "timeline": [{"oid": "f5fbe8103df54aa46bab2a8945810faca6b5065c", "url": "https://github.com/OSGP/open-smart-grid-platform/commit/f5fbe8103df54aa46bab2a8945810faca6b5065c", "message": "Added new tests for the DeviceInstallationServiceTest class\n\nCoverage has been increased to 95.6%", "committedDate": "2020-09-22T07:51:42Z", "type": "commit"}, {"oid": "4623479e15b76b5e91f6f1412d553982489cba5f", "url": "https://github.com/OSGP/open-smart-grid-platform/commit/4623479e15b76b5e91f6f1412d553982489cba5f", "message": "- Using AssertJ and mockito\n- Removed verify usage and replaced all with argument captors", "committedDate": "2020-09-24T12:39:17Z", "type": "commit"}, {"oid": "fc2909ae9cd9bbd4c3f1a2a48bbf71c2e95771df", "url": "https://github.com/OSGP/open-smart-grid-platform/commit/fc2909ae9cd9bbd4c3f1a2a48bbf71c2e95771df", "message": "- Removed whitespace", "committedDate": "2020-09-24T14:11:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA1NzQ3Mg==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/436#discussion_r503057472", "bodyText": "licence header missing", "author": "robindenadel", "createdAt": "2020-10-12T06:09:02Z", "path": "osgp/platform/osgp-adapter-domain-core/src/test/java/org/opensmartgridplatform/adapter/domain/core/application/services/DeviceInstallationServiceTest.java", "diffHunk": "@@ -0,0 +1,276 @@\n+package org.opensmartgridplatform.adapter.domain.core.application.services;", "originalCommit": "fc2909ae9cd9bbd4c3f1a2a48bbf71c2e95771df", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDY4OTU2Mg==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/436#discussion_r510689562", "bodyText": "move the licence header to the top", "author": "robindenadel", "createdAt": "2020-10-23T07:31:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA1NzQ3Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA2MDYwMg==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/436#discussion_r503060602", "bodyText": "Remove this line; the default strictness is better.", "author": "robindenadel", "createdAt": "2020-10-12T06:18:59Z", "path": "osgp/platform/osgp-adapter-domain-core/src/test/java/org/opensmartgridplatform/adapter/domain/core/application/services/DeviceInstallationServiceTest.java", "diffHunk": "@@ -0,0 +1,276 @@\n+package org.opensmartgridplatform.adapter.domain.core.application.services;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.when;\n+\n+import java.util.Arrays;\n+import java.util.Collections;\n+\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.ArgumentCaptor;\n+import org.mockito.Captor;\n+import org.mockito.InjectMocks;\n+import org.mockito.Mock;\n+import org.mockito.Mockito;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+import org.mockito.junit.jupiter.MockitoSettings;\n+import org.mockito.quality.Strictness;\n+import org.opensmartgridplatform.adapter.domain.core.application.mapping.DomainCoreMapper;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.core.OsgpCoreRequestMessageSender;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.ws.WebServiceResponseMessageSender;\n+import org.opensmartgridplatform.domain.core.entities.Device;\n+import org.opensmartgridplatform.domain.core.entities.LightMeasurementDevice;\n+import org.opensmartgridplatform.domain.core.entities.Ssld;\n+import org.opensmartgridplatform.domain.core.exceptions.ValidationException;\n+import org.opensmartgridplatform.domain.core.repositories.SsldRepository;\n+import org.opensmartgridplatform.domain.core.services.DeviceDomainService;\n+import org.opensmartgridplatform.domain.core.services.OrganisationDomainService;\n+import org.opensmartgridplatform.domain.core.valueobjects.DeviceStatus;\n+import org.opensmartgridplatform.domain.core.valueobjects.DeviceStatusMapped;\n+import org.opensmartgridplatform.domain.core.valueobjects.LightType;\n+import org.opensmartgridplatform.domain.core.valueobjects.LightValue;\n+import org.opensmartgridplatform.domain.core.valueobjects.LinkType;\n+import org.opensmartgridplatform.domain.core.valueobjects.TariffValue;\n+import org.opensmartgridplatform.shared.exceptionhandling.ComponentType;\n+import org.opensmartgridplatform.shared.exceptionhandling.FunctionalException;\n+import org.opensmartgridplatform.shared.exceptionhandling.NoDeviceResponseException;\n+import org.opensmartgridplatform.shared.exceptionhandling.TechnicalException;\n+import org.opensmartgridplatform.shared.infra.jms.CorrelationIds;\n+import org.opensmartgridplatform.shared.infra.jms.RequestMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessageResultType;\n+\n+@ExtendWith(MockitoExtension.class)\n+@MockitoSettings(strictness = Strictness.LENIENT)", "originalCommit": "fc2909ae9cd9bbd4c3f1a2a48bbf71c2e95771df", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA2MTY4NA==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/436#discussion_r503061684", "bodyText": "rename the field to argumentResponseMessage", "author": "robindenadel", "createdAt": "2020-10-12T06:21:55Z", "path": "osgp/platform/osgp-adapter-domain-core/src/test/java/org/opensmartgridplatform/adapter/domain/core/application/services/DeviceInstallationServiceTest.java", "diffHunk": "@@ -0,0 +1,276 @@\n+package org.opensmartgridplatform.adapter.domain.core.application.services;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.when;\n+\n+import java.util.Arrays;\n+import java.util.Collections;\n+\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.ArgumentCaptor;\n+import org.mockito.Captor;\n+import org.mockito.InjectMocks;\n+import org.mockito.Mock;\n+import org.mockito.Mockito;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+import org.mockito.junit.jupiter.MockitoSettings;\n+import org.mockito.quality.Strictness;\n+import org.opensmartgridplatform.adapter.domain.core.application.mapping.DomainCoreMapper;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.core.OsgpCoreRequestMessageSender;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.ws.WebServiceResponseMessageSender;\n+import org.opensmartgridplatform.domain.core.entities.Device;\n+import org.opensmartgridplatform.domain.core.entities.LightMeasurementDevice;\n+import org.opensmartgridplatform.domain.core.entities.Ssld;\n+import org.opensmartgridplatform.domain.core.exceptions.ValidationException;\n+import org.opensmartgridplatform.domain.core.repositories.SsldRepository;\n+import org.opensmartgridplatform.domain.core.services.DeviceDomainService;\n+import org.opensmartgridplatform.domain.core.services.OrganisationDomainService;\n+import org.opensmartgridplatform.domain.core.valueobjects.DeviceStatus;\n+import org.opensmartgridplatform.domain.core.valueobjects.DeviceStatusMapped;\n+import org.opensmartgridplatform.domain.core.valueobjects.LightType;\n+import org.opensmartgridplatform.domain.core.valueobjects.LightValue;\n+import org.opensmartgridplatform.domain.core.valueobjects.LinkType;\n+import org.opensmartgridplatform.domain.core.valueobjects.TariffValue;\n+import org.opensmartgridplatform.shared.exceptionhandling.ComponentType;\n+import org.opensmartgridplatform.shared.exceptionhandling.FunctionalException;\n+import org.opensmartgridplatform.shared.exceptionhandling.NoDeviceResponseException;\n+import org.opensmartgridplatform.shared.exceptionhandling.TechnicalException;\n+import org.opensmartgridplatform.shared.infra.jms.CorrelationIds;\n+import org.opensmartgridplatform.shared.infra.jms.RequestMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessageResultType;\n+\n+@ExtendWith(MockitoExtension.class)\n+@MockitoSettings(strictness = Strictness.LENIENT)\n+public class DeviceInstallationServiceTest {\n+\t\n+\t@Mock\n+\tprivate OrganisationDomainService organisationDomainService;\n+\t\n+\t@Mock\n+\tprivate DeviceDomainService deviceDomainService;\n+\t\n+\t@Mock\n+\tprivate OsgpCoreRequestMessageSender osgpCoreRequestMessageSender;\n+\t\n+\t@Mock\n+\tprivate WebServiceResponseMessageSender webServiceResponseMessageSender;\n+\t\n+\t@Mock\n+\tprivate DomainCoreMapper domainCoreMapper;\n+\t\n+\t@Mock\n+\tprivate SsldRepository ssldRepository;\n+\t\n+\t@InjectMocks\n+\tprivate DeviceInstallationService deviceInstallationService;\n+\n+\t@Captor\n+\tprivate ArgumentCaptor<ResponseMessage> argumentResM;", "originalCommit": "fc2909ae9cd9bbd4c3f1a2a48bbf71c2e95771df", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA2MTgzNg==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/436#discussion_r503061836", "bodyText": "rename the field to argumentRequestMessage", "author": "robindenadel", "createdAt": "2020-10-12T06:22:19Z", "path": "osgp/platform/osgp-adapter-domain-core/src/test/java/org/opensmartgridplatform/adapter/domain/core/application/services/DeviceInstallationServiceTest.java", "diffHunk": "@@ -0,0 +1,276 @@\n+package org.opensmartgridplatform.adapter.domain.core.application.services;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.when;\n+\n+import java.util.Arrays;\n+import java.util.Collections;\n+\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.ArgumentCaptor;\n+import org.mockito.Captor;\n+import org.mockito.InjectMocks;\n+import org.mockito.Mock;\n+import org.mockito.Mockito;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+import org.mockito.junit.jupiter.MockitoSettings;\n+import org.mockito.quality.Strictness;\n+import org.opensmartgridplatform.adapter.domain.core.application.mapping.DomainCoreMapper;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.core.OsgpCoreRequestMessageSender;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.ws.WebServiceResponseMessageSender;\n+import org.opensmartgridplatform.domain.core.entities.Device;\n+import org.opensmartgridplatform.domain.core.entities.LightMeasurementDevice;\n+import org.opensmartgridplatform.domain.core.entities.Ssld;\n+import org.opensmartgridplatform.domain.core.exceptions.ValidationException;\n+import org.opensmartgridplatform.domain.core.repositories.SsldRepository;\n+import org.opensmartgridplatform.domain.core.services.DeviceDomainService;\n+import org.opensmartgridplatform.domain.core.services.OrganisationDomainService;\n+import org.opensmartgridplatform.domain.core.valueobjects.DeviceStatus;\n+import org.opensmartgridplatform.domain.core.valueobjects.DeviceStatusMapped;\n+import org.opensmartgridplatform.domain.core.valueobjects.LightType;\n+import org.opensmartgridplatform.domain.core.valueobjects.LightValue;\n+import org.opensmartgridplatform.domain.core.valueobjects.LinkType;\n+import org.opensmartgridplatform.domain.core.valueobjects.TariffValue;\n+import org.opensmartgridplatform.shared.exceptionhandling.ComponentType;\n+import org.opensmartgridplatform.shared.exceptionhandling.FunctionalException;\n+import org.opensmartgridplatform.shared.exceptionhandling.NoDeviceResponseException;\n+import org.opensmartgridplatform.shared.exceptionhandling.TechnicalException;\n+import org.opensmartgridplatform.shared.infra.jms.CorrelationIds;\n+import org.opensmartgridplatform.shared.infra.jms.RequestMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessageResultType;\n+\n+@ExtendWith(MockitoExtension.class)\n+@MockitoSettings(strictness = Strictness.LENIENT)\n+public class DeviceInstallationServiceTest {\n+\t\n+\t@Mock\n+\tprivate OrganisationDomainService organisationDomainService;\n+\t\n+\t@Mock\n+\tprivate DeviceDomainService deviceDomainService;\n+\t\n+\t@Mock\n+\tprivate OsgpCoreRequestMessageSender osgpCoreRequestMessageSender;\n+\t\n+\t@Mock\n+\tprivate WebServiceResponseMessageSender webServiceResponseMessageSender;\n+\t\n+\t@Mock\n+\tprivate DomainCoreMapper domainCoreMapper;\n+\t\n+\t@Mock\n+\tprivate SsldRepository ssldRepository;\n+\t\n+\t@InjectMocks\n+\tprivate DeviceInstallationService deviceInstallationService;\n+\n+\t@Captor\n+\tprivate ArgumentCaptor<ResponseMessage> argumentResM;\n+\n+\t@Captor\n+\tprivate ArgumentCaptor<RequestMessage> argumentReqM;", "originalCommit": "fc2909ae9cd9bbd4c3f1a2a48bbf71c2e95771df", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA2MzA1MQ==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/436#discussion_r503063051", "bodyText": "give this field a descriptive name like argumentMessageType", "author": "robindenadel", "createdAt": "2020-10-12T06:25:39Z", "path": "osgp/platform/osgp-adapter-domain-core/src/test/java/org/opensmartgridplatform/adapter/domain/core/application/services/DeviceInstallationServiceTest.java", "diffHunk": "@@ -0,0 +1,276 @@\n+package org.opensmartgridplatform.adapter.domain.core.application.services;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.when;\n+\n+import java.util.Arrays;\n+import java.util.Collections;\n+\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.ArgumentCaptor;\n+import org.mockito.Captor;\n+import org.mockito.InjectMocks;\n+import org.mockito.Mock;\n+import org.mockito.Mockito;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+import org.mockito.junit.jupiter.MockitoSettings;\n+import org.mockito.quality.Strictness;\n+import org.opensmartgridplatform.adapter.domain.core.application.mapping.DomainCoreMapper;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.core.OsgpCoreRequestMessageSender;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.ws.WebServiceResponseMessageSender;\n+import org.opensmartgridplatform.domain.core.entities.Device;\n+import org.opensmartgridplatform.domain.core.entities.LightMeasurementDevice;\n+import org.opensmartgridplatform.domain.core.entities.Ssld;\n+import org.opensmartgridplatform.domain.core.exceptions.ValidationException;\n+import org.opensmartgridplatform.domain.core.repositories.SsldRepository;\n+import org.opensmartgridplatform.domain.core.services.DeviceDomainService;\n+import org.opensmartgridplatform.domain.core.services.OrganisationDomainService;\n+import org.opensmartgridplatform.domain.core.valueobjects.DeviceStatus;\n+import org.opensmartgridplatform.domain.core.valueobjects.DeviceStatusMapped;\n+import org.opensmartgridplatform.domain.core.valueobjects.LightType;\n+import org.opensmartgridplatform.domain.core.valueobjects.LightValue;\n+import org.opensmartgridplatform.domain.core.valueobjects.LinkType;\n+import org.opensmartgridplatform.domain.core.valueobjects.TariffValue;\n+import org.opensmartgridplatform.shared.exceptionhandling.ComponentType;\n+import org.opensmartgridplatform.shared.exceptionhandling.FunctionalException;\n+import org.opensmartgridplatform.shared.exceptionhandling.NoDeviceResponseException;\n+import org.opensmartgridplatform.shared.exceptionhandling.TechnicalException;\n+import org.opensmartgridplatform.shared.infra.jms.CorrelationIds;\n+import org.opensmartgridplatform.shared.infra.jms.RequestMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessageResultType;\n+\n+@ExtendWith(MockitoExtension.class)\n+@MockitoSettings(strictness = Strictness.LENIENT)\n+public class DeviceInstallationServiceTest {\n+\t\n+\t@Mock\n+\tprivate OrganisationDomainService organisationDomainService;\n+\t\n+\t@Mock\n+\tprivate DeviceDomainService deviceDomainService;\n+\t\n+\t@Mock\n+\tprivate OsgpCoreRequestMessageSender osgpCoreRequestMessageSender;\n+\t\n+\t@Mock\n+\tprivate WebServiceResponseMessageSender webServiceResponseMessageSender;\n+\t\n+\t@Mock\n+\tprivate DomainCoreMapper domainCoreMapper;\n+\t\n+\t@Mock\n+\tprivate SsldRepository ssldRepository;\n+\t\n+\t@InjectMocks\n+\tprivate DeviceInstallationService deviceInstallationService;\n+\n+\t@Captor\n+\tprivate ArgumentCaptor<ResponseMessage> argumentResM;\n+\n+\t@Captor\n+\tprivate ArgumentCaptor<RequestMessage> argumentReqM;\n+\n+\t@Captor\n+\tprivate ArgumentCaptor<String> argumentStringOne;", "originalCommit": "fc2909ae9cd9bbd4c3f1a2a48bbf71c2e95771df", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA2MzIxMg==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/436#discussion_r503063212", "bodyText": "give this field a descriptive name like argumentIpAddress", "author": "robindenadel", "createdAt": "2020-10-12T06:26:05Z", "path": "osgp/platform/osgp-adapter-domain-core/src/test/java/org/opensmartgridplatform/adapter/domain/core/application/services/DeviceInstallationServiceTest.java", "diffHunk": "@@ -0,0 +1,276 @@\n+package org.opensmartgridplatform.adapter.domain.core.application.services;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.when;\n+\n+import java.util.Arrays;\n+import java.util.Collections;\n+\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.ArgumentCaptor;\n+import org.mockito.Captor;\n+import org.mockito.InjectMocks;\n+import org.mockito.Mock;\n+import org.mockito.Mockito;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+import org.mockito.junit.jupiter.MockitoSettings;\n+import org.mockito.quality.Strictness;\n+import org.opensmartgridplatform.adapter.domain.core.application.mapping.DomainCoreMapper;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.core.OsgpCoreRequestMessageSender;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.ws.WebServiceResponseMessageSender;\n+import org.opensmartgridplatform.domain.core.entities.Device;\n+import org.opensmartgridplatform.domain.core.entities.LightMeasurementDevice;\n+import org.opensmartgridplatform.domain.core.entities.Ssld;\n+import org.opensmartgridplatform.domain.core.exceptions.ValidationException;\n+import org.opensmartgridplatform.domain.core.repositories.SsldRepository;\n+import org.opensmartgridplatform.domain.core.services.DeviceDomainService;\n+import org.opensmartgridplatform.domain.core.services.OrganisationDomainService;\n+import org.opensmartgridplatform.domain.core.valueobjects.DeviceStatus;\n+import org.opensmartgridplatform.domain.core.valueobjects.DeviceStatusMapped;\n+import org.opensmartgridplatform.domain.core.valueobjects.LightType;\n+import org.opensmartgridplatform.domain.core.valueobjects.LightValue;\n+import org.opensmartgridplatform.domain.core.valueobjects.LinkType;\n+import org.opensmartgridplatform.domain.core.valueobjects.TariffValue;\n+import org.opensmartgridplatform.shared.exceptionhandling.ComponentType;\n+import org.opensmartgridplatform.shared.exceptionhandling.FunctionalException;\n+import org.opensmartgridplatform.shared.exceptionhandling.NoDeviceResponseException;\n+import org.opensmartgridplatform.shared.exceptionhandling.TechnicalException;\n+import org.opensmartgridplatform.shared.infra.jms.CorrelationIds;\n+import org.opensmartgridplatform.shared.infra.jms.RequestMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessageResultType;\n+\n+@ExtendWith(MockitoExtension.class)\n+@MockitoSettings(strictness = Strictness.LENIENT)\n+public class DeviceInstallationServiceTest {\n+\t\n+\t@Mock\n+\tprivate OrganisationDomainService organisationDomainService;\n+\t\n+\t@Mock\n+\tprivate DeviceDomainService deviceDomainService;\n+\t\n+\t@Mock\n+\tprivate OsgpCoreRequestMessageSender osgpCoreRequestMessageSender;\n+\t\n+\t@Mock\n+\tprivate WebServiceResponseMessageSender webServiceResponseMessageSender;\n+\t\n+\t@Mock\n+\tprivate DomainCoreMapper domainCoreMapper;\n+\t\n+\t@Mock\n+\tprivate SsldRepository ssldRepository;\n+\t\n+\t@InjectMocks\n+\tprivate DeviceInstallationService deviceInstallationService;\n+\n+\t@Captor\n+\tprivate ArgumentCaptor<ResponseMessage> argumentResM;\n+\n+\t@Captor\n+\tprivate ArgumentCaptor<RequestMessage> argumentReqM;\n+\n+\t@Captor\n+\tprivate ArgumentCaptor<String> argumentStringOne;\n+\n+\t@Captor\n+\tprivate ArgumentCaptor<String> argumentStringTwo;", "originalCommit": "fc2909ae9cd9bbd4c3f1a2a48bbf71c2e95771df", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA2MzI5OQ==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/436#discussion_r503063299", "bodyText": "give this field a descriptive name like argumentPriority", "author": "robindenadel", "createdAt": "2020-10-12T06:26:20Z", "path": "osgp/platform/osgp-adapter-domain-core/src/test/java/org/opensmartgridplatform/adapter/domain/core/application/services/DeviceInstallationServiceTest.java", "diffHunk": "@@ -0,0 +1,276 @@\n+package org.opensmartgridplatform.adapter.domain.core.application.services;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.when;\n+\n+import java.util.Arrays;\n+import java.util.Collections;\n+\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.ArgumentCaptor;\n+import org.mockito.Captor;\n+import org.mockito.InjectMocks;\n+import org.mockito.Mock;\n+import org.mockito.Mockito;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+import org.mockito.junit.jupiter.MockitoSettings;\n+import org.mockito.quality.Strictness;\n+import org.opensmartgridplatform.adapter.domain.core.application.mapping.DomainCoreMapper;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.core.OsgpCoreRequestMessageSender;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.ws.WebServiceResponseMessageSender;\n+import org.opensmartgridplatform.domain.core.entities.Device;\n+import org.opensmartgridplatform.domain.core.entities.LightMeasurementDevice;\n+import org.opensmartgridplatform.domain.core.entities.Ssld;\n+import org.opensmartgridplatform.domain.core.exceptions.ValidationException;\n+import org.opensmartgridplatform.domain.core.repositories.SsldRepository;\n+import org.opensmartgridplatform.domain.core.services.DeviceDomainService;\n+import org.opensmartgridplatform.domain.core.services.OrganisationDomainService;\n+import org.opensmartgridplatform.domain.core.valueobjects.DeviceStatus;\n+import org.opensmartgridplatform.domain.core.valueobjects.DeviceStatusMapped;\n+import org.opensmartgridplatform.domain.core.valueobjects.LightType;\n+import org.opensmartgridplatform.domain.core.valueobjects.LightValue;\n+import org.opensmartgridplatform.domain.core.valueobjects.LinkType;\n+import org.opensmartgridplatform.domain.core.valueobjects.TariffValue;\n+import org.opensmartgridplatform.shared.exceptionhandling.ComponentType;\n+import org.opensmartgridplatform.shared.exceptionhandling.FunctionalException;\n+import org.opensmartgridplatform.shared.exceptionhandling.NoDeviceResponseException;\n+import org.opensmartgridplatform.shared.exceptionhandling.TechnicalException;\n+import org.opensmartgridplatform.shared.infra.jms.CorrelationIds;\n+import org.opensmartgridplatform.shared.infra.jms.RequestMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessageResultType;\n+\n+@ExtendWith(MockitoExtension.class)\n+@MockitoSettings(strictness = Strictness.LENIENT)\n+public class DeviceInstallationServiceTest {\n+\t\n+\t@Mock\n+\tprivate OrganisationDomainService organisationDomainService;\n+\t\n+\t@Mock\n+\tprivate DeviceDomainService deviceDomainService;\n+\t\n+\t@Mock\n+\tprivate OsgpCoreRequestMessageSender osgpCoreRequestMessageSender;\n+\t\n+\t@Mock\n+\tprivate WebServiceResponseMessageSender webServiceResponseMessageSender;\n+\t\n+\t@Mock\n+\tprivate DomainCoreMapper domainCoreMapper;\n+\t\n+\t@Mock\n+\tprivate SsldRepository ssldRepository;\n+\t\n+\t@InjectMocks\n+\tprivate DeviceInstallationService deviceInstallationService;\n+\n+\t@Captor\n+\tprivate ArgumentCaptor<ResponseMessage> argumentResM;\n+\n+\t@Captor\n+\tprivate ArgumentCaptor<RequestMessage> argumentReqM;\n+\n+\t@Captor\n+\tprivate ArgumentCaptor<String> argumentStringOne;\n+\n+\t@Captor\n+\tprivate ArgumentCaptor<String> argumentStringTwo;\n+\n+\t@Captor\n+\tprivate ArgumentCaptor<Integer> argumentInt;", "originalCommit": "fc2909ae9cd9bbd4c3f1a2a48bbf71c2e95771df", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA2NDI0Mg==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/436#discussion_r503064242", "bodyText": "Since we are going to check the values in the assert part of the tests, it is clearer to create constants for testIp, testUid, testOrganisation, testDevice and testMessageType. Furthmore, create a constant for testMessagePriority with value 1", "author": "robindenadel", "createdAt": "2020-10-12T06:29:04Z", "path": "osgp/platform/osgp-adapter-domain-core/src/test/java/org/opensmartgridplatform/adapter/domain/core/application/services/DeviceInstallationServiceTest.java", "diffHunk": "@@ -0,0 +1,276 @@\n+package org.opensmartgridplatform.adapter.domain.core.application.services;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.when;\n+\n+import java.util.Arrays;\n+import java.util.Collections;\n+\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.ArgumentCaptor;\n+import org.mockito.Captor;\n+import org.mockito.InjectMocks;\n+import org.mockito.Mock;\n+import org.mockito.Mockito;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+import org.mockito.junit.jupiter.MockitoSettings;\n+import org.mockito.quality.Strictness;\n+import org.opensmartgridplatform.adapter.domain.core.application.mapping.DomainCoreMapper;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.core.OsgpCoreRequestMessageSender;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.ws.WebServiceResponseMessageSender;\n+import org.opensmartgridplatform.domain.core.entities.Device;\n+import org.opensmartgridplatform.domain.core.entities.LightMeasurementDevice;\n+import org.opensmartgridplatform.domain.core.entities.Ssld;\n+import org.opensmartgridplatform.domain.core.exceptions.ValidationException;\n+import org.opensmartgridplatform.domain.core.repositories.SsldRepository;\n+import org.opensmartgridplatform.domain.core.services.DeviceDomainService;\n+import org.opensmartgridplatform.domain.core.services.OrganisationDomainService;\n+import org.opensmartgridplatform.domain.core.valueobjects.DeviceStatus;\n+import org.opensmartgridplatform.domain.core.valueobjects.DeviceStatusMapped;\n+import org.opensmartgridplatform.domain.core.valueobjects.LightType;\n+import org.opensmartgridplatform.domain.core.valueobjects.LightValue;\n+import org.opensmartgridplatform.domain.core.valueobjects.LinkType;\n+import org.opensmartgridplatform.domain.core.valueobjects.TariffValue;\n+import org.opensmartgridplatform.shared.exceptionhandling.ComponentType;\n+import org.opensmartgridplatform.shared.exceptionhandling.FunctionalException;\n+import org.opensmartgridplatform.shared.exceptionhandling.NoDeviceResponseException;\n+import org.opensmartgridplatform.shared.exceptionhandling.TechnicalException;\n+import org.opensmartgridplatform.shared.infra.jms.CorrelationIds;\n+import org.opensmartgridplatform.shared.infra.jms.RequestMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessageResultType;\n+\n+@ExtendWith(MockitoExtension.class)\n+@MockitoSettings(strictness = Strictness.LENIENT)\n+public class DeviceInstallationServiceTest {\n+\t\n+\t@Mock\n+\tprivate OrganisationDomainService organisationDomainService;\n+\t\n+\t@Mock\n+\tprivate DeviceDomainService deviceDomainService;\n+\t\n+\t@Mock\n+\tprivate OsgpCoreRequestMessageSender osgpCoreRequestMessageSender;\n+\t\n+\t@Mock\n+\tprivate WebServiceResponseMessageSender webServiceResponseMessageSender;\n+\t\n+\t@Mock\n+\tprivate DomainCoreMapper domainCoreMapper;\n+\t\n+\t@Mock\n+\tprivate SsldRepository ssldRepository;\n+\t\n+\t@InjectMocks\n+\tprivate DeviceInstallationService deviceInstallationService;\n+\n+\t@Captor\n+\tprivate ArgumentCaptor<ResponseMessage> argumentResM;\n+\n+\t@Captor\n+\tprivate ArgumentCaptor<RequestMessage> argumentReqM;\n+\n+\t@Captor\n+\tprivate ArgumentCaptor<String> argumentStringOne;\n+\n+\t@Captor\n+\tprivate ArgumentCaptor<String> argumentStringTwo;\n+\n+\t@Captor\n+\tprivate ArgumentCaptor<Integer> argumentInt;\n+\t\n+\t@Test\n+\tpublic void testGetStatusTestDeviceTypeIsNotLmdType() throws FunctionalException {\n+\t\tfinal Device device = Mockito.mock(Device.class);\n+\t\twhen(device.getIpAddress()).thenReturn(\"testIp\");\n+\t\twhen(this.deviceDomainService.searchActiveDevice(\"testDevice\", ComponentType.DOMAIN_CORE)).thenReturn(device);\n+\t\t\n+\t\tthis.deviceInstallationService.getStatus(\"testOrganisation\", \"testDevice\", \"testUid\", \"testMessageType\", 1);", "originalCommit": "fc2909ae9cd9bbd4c3f1a2a48bbf71c2e95771df", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA2NjEwNA==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/436#discussion_r503066104", "bodyText": "Since\nnew RequestMessage(\n\"testUid\",\n\"testOrganisation\",\n\"testDevice\", null);\nis used in other tests, refactor it to a constant. If other tests use other parameters, refactor it to a method.", "author": "robindenadel", "createdAt": "2020-10-12T06:33:56Z", "path": "osgp/platform/osgp-adapter-domain-core/src/test/java/org/opensmartgridplatform/adapter/domain/core/application/services/DeviceInstallationServiceTest.java", "diffHunk": "@@ -0,0 +1,276 @@\n+package org.opensmartgridplatform.adapter.domain.core.application.services;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.when;\n+\n+import java.util.Arrays;\n+import java.util.Collections;\n+\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.ArgumentCaptor;\n+import org.mockito.Captor;\n+import org.mockito.InjectMocks;\n+import org.mockito.Mock;\n+import org.mockito.Mockito;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+import org.mockito.junit.jupiter.MockitoSettings;\n+import org.mockito.quality.Strictness;\n+import org.opensmartgridplatform.adapter.domain.core.application.mapping.DomainCoreMapper;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.core.OsgpCoreRequestMessageSender;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.ws.WebServiceResponseMessageSender;\n+import org.opensmartgridplatform.domain.core.entities.Device;\n+import org.opensmartgridplatform.domain.core.entities.LightMeasurementDevice;\n+import org.opensmartgridplatform.domain.core.entities.Ssld;\n+import org.opensmartgridplatform.domain.core.exceptions.ValidationException;\n+import org.opensmartgridplatform.domain.core.repositories.SsldRepository;\n+import org.opensmartgridplatform.domain.core.services.DeviceDomainService;\n+import org.opensmartgridplatform.domain.core.services.OrganisationDomainService;\n+import org.opensmartgridplatform.domain.core.valueobjects.DeviceStatus;\n+import org.opensmartgridplatform.domain.core.valueobjects.DeviceStatusMapped;\n+import org.opensmartgridplatform.domain.core.valueobjects.LightType;\n+import org.opensmartgridplatform.domain.core.valueobjects.LightValue;\n+import org.opensmartgridplatform.domain.core.valueobjects.LinkType;\n+import org.opensmartgridplatform.domain.core.valueobjects.TariffValue;\n+import org.opensmartgridplatform.shared.exceptionhandling.ComponentType;\n+import org.opensmartgridplatform.shared.exceptionhandling.FunctionalException;\n+import org.opensmartgridplatform.shared.exceptionhandling.NoDeviceResponseException;\n+import org.opensmartgridplatform.shared.exceptionhandling.TechnicalException;\n+import org.opensmartgridplatform.shared.infra.jms.CorrelationIds;\n+import org.opensmartgridplatform.shared.infra.jms.RequestMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessageResultType;\n+\n+@ExtendWith(MockitoExtension.class)\n+@MockitoSettings(strictness = Strictness.LENIENT)\n+public class DeviceInstallationServiceTest {\n+\t\n+\t@Mock\n+\tprivate OrganisationDomainService organisationDomainService;\n+\t\n+\t@Mock\n+\tprivate DeviceDomainService deviceDomainService;\n+\t\n+\t@Mock\n+\tprivate OsgpCoreRequestMessageSender osgpCoreRequestMessageSender;\n+\t\n+\t@Mock\n+\tprivate WebServiceResponseMessageSender webServiceResponseMessageSender;\n+\t\n+\t@Mock\n+\tprivate DomainCoreMapper domainCoreMapper;\n+\t\n+\t@Mock\n+\tprivate SsldRepository ssldRepository;\n+\t\n+\t@InjectMocks\n+\tprivate DeviceInstallationService deviceInstallationService;\n+\n+\t@Captor\n+\tprivate ArgumentCaptor<ResponseMessage> argumentResM;\n+\n+\t@Captor\n+\tprivate ArgumentCaptor<RequestMessage> argumentReqM;\n+\n+\t@Captor\n+\tprivate ArgumentCaptor<String> argumentStringOne;\n+\n+\t@Captor\n+\tprivate ArgumentCaptor<String> argumentStringTwo;\n+\n+\t@Captor\n+\tprivate ArgumentCaptor<Integer> argumentInt;\n+\t\n+\t@Test\n+\tpublic void testGetStatusTestDeviceTypeIsNotLmdType() throws FunctionalException {\n+\t\tfinal Device device = Mockito.mock(Device.class);\n+\t\twhen(device.getIpAddress()).thenReturn(\"testIp\");\n+\t\twhen(this.deviceDomainService.searchActiveDevice(\"testDevice\", ComponentType.DOMAIN_CORE)).thenReturn(device);\n+\t\t\n+\t\tthis.deviceInstallationService.getStatus(\"testOrganisation\", \"testDevice\", \"testUid\", \"testMessageType\", 1);\n+\n+\t\tverify(this.osgpCoreRequestMessageSender).send(this.argumentReqM.capture(), this.argumentStringOne.capture(),\n+\t\t\t\tthis.argumentInt.capture(), this.argumentStringTwo.capture());\n+\n+\t\tassertThat(this.argumentReqM.getValue()).usingRecursiveComparison().isEqualTo(new RequestMessage(\n+\t\t\t\t\"testUid\",\n+\t\t\t\t\"testOrganisation\",\n+\t\t\t\t\"testDevice\", null));", "originalCommit": "fc2909ae9cd9bbd4c3f1a2a48bbf71c2e95771df", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA2NjUyNA==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/436#discussion_r503066524", "bodyText": "Since\nnew CorrelationIds(\"testOrganisation\", \"testDevice\", \"testUid\")\nis used in other tests, refactor it to a constant", "author": "robindenadel", "createdAt": "2020-10-12T06:34:56Z", "path": "osgp/platform/osgp-adapter-domain-core/src/test/java/org/opensmartgridplatform/adapter/domain/core/application/services/DeviceInstallationServiceTest.java", "diffHunk": "@@ -0,0 +1,276 @@\n+package org.opensmartgridplatform.adapter.domain.core.application.services;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.when;\n+\n+import java.util.Arrays;\n+import java.util.Collections;\n+\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.ArgumentCaptor;\n+import org.mockito.Captor;\n+import org.mockito.InjectMocks;\n+import org.mockito.Mock;\n+import org.mockito.Mockito;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+import org.mockito.junit.jupiter.MockitoSettings;\n+import org.mockito.quality.Strictness;\n+import org.opensmartgridplatform.adapter.domain.core.application.mapping.DomainCoreMapper;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.core.OsgpCoreRequestMessageSender;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.ws.WebServiceResponseMessageSender;\n+import org.opensmartgridplatform.domain.core.entities.Device;\n+import org.opensmartgridplatform.domain.core.entities.LightMeasurementDevice;\n+import org.opensmartgridplatform.domain.core.entities.Ssld;\n+import org.opensmartgridplatform.domain.core.exceptions.ValidationException;\n+import org.opensmartgridplatform.domain.core.repositories.SsldRepository;\n+import org.opensmartgridplatform.domain.core.services.DeviceDomainService;\n+import org.opensmartgridplatform.domain.core.services.OrganisationDomainService;\n+import org.opensmartgridplatform.domain.core.valueobjects.DeviceStatus;\n+import org.opensmartgridplatform.domain.core.valueobjects.DeviceStatusMapped;\n+import org.opensmartgridplatform.domain.core.valueobjects.LightType;\n+import org.opensmartgridplatform.domain.core.valueobjects.LightValue;\n+import org.opensmartgridplatform.domain.core.valueobjects.LinkType;\n+import org.opensmartgridplatform.domain.core.valueobjects.TariffValue;\n+import org.opensmartgridplatform.shared.exceptionhandling.ComponentType;\n+import org.opensmartgridplatform.shared.exceptionhandling.FunctionalException;\n+import org.opensmartgridplatform.shared.exceptionhandling.NoDeviceResponseException;\n+import org.opensmartgridplatform.shared.exceptionhandling.TechnicalException;\n+import org.opensmartgridplatform.shared.infra.jms.CorrelationIds;\n+import org.opensmartgridplatform.shared.infra.jms.RequestMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessageResultType;\n+\n+@ExtendWith(MockitoExtension.class)\n+@MockitoSettings(strictness = Strictness.LENIENT)\n+public class DeviceInstallationServiceTest {\n+\t\n+\t@Mock\n+\tprivate OrganisationDomainService organisationDomainService;\n+\t\n+\t@Mock\n+\tprivate DeviceDomainService deviceDomainService;\n+\t\n+\t@Mock\n+\tprivate OsgpCoreRequestMessageSender osgpCoreRequestMessageSender;\n+\t\n+\t@Mock\n+\tprivate WebServiceResponseMessageSender webServiceResponseMessageSender;\n+\t\n+\t@Mock\n+\tprivate DomainCoreMapper domainCoreMapper;\n+\t\n+\t@Mock\n+\tprivate SsldRepository ssldRepository;\n+\t\n+\t@InjectMocks\n+\tprivate DeviceInstallationService deviceInstallationService;\n+\n+\t@Captor\n+\tprivate ArgumentCaptor<ResponseMessage> argumentResM;\n+\n+\t@Captor\n+\tprivate ArgumentCaptor<RequestMessage> argumentReqM;\n+\n+\t@Captor\n+\tprivate ArgumentCaptor<String> argumentStringOne;\n+\n+\t@Captor\n+\tprivate ArgumentCaptor<String> argumentStringTwo;\n+\n+\t@Captor\n+\tprivate ArgumentCaptor<Integer> argumentInt;\n+\t\n+\t@Test\n+\tpublic void testGetStatusTestDeviceTypeIsNotLmdType() throws FunctionalException {\n+\t\tfinal Device device = Mockito.mock(Device.class);\n+\t\twhen(device.getIpAddress()).thenReturn(\"testIp\");\n+\t\twhen(this.deviceDomainService.searchActiveDevice(\"testDevice\", ComponentType.DOMAIN_CORE)).thenReturn(device);\n+\t\t\n+\t\tthis.deviceInstallationService.getStatus(\"testOrganisation\", \"testDevice\", \"testUid\", \"testMessageType\", 1);\n+\n+\t\tverify(this.osgpCoreRequestMessageSender).send(this.argumentReqM.capture(), this.argumentStringOne.capture(),\n+\t\t\t\tthis.argumentInt.capture(), this.argumentStringTwo.capture());\n+\n+\t\tassertThat(this.argumentReqM.getValue()).usingRecursiveComparison().isEqualTo(new RequestMessage(\n+\t\t\t\t\"testUid\",\n+\t\t\t\t\"testOrganisation\",\n+\t\t\t\t\"testDevice\", null));\n+\t\tassertThat(this.argumentStringOne.getValue()).isEqualTo(\"testMessageType\");\n+\t\tassertThat(this.argumentInt.getValue()).isEqualTo(1);\n+\t\tassertThat(this.argumentStringTwo.getValue()).isEqualTo(\"testIp\");\n+\t}\n+\t\n+\t@Test\n+\tpublic void testGetStatusTestDeviceTypeIsLmdType() throws FunctionalException {\n+\t\tfinal Device device = Mockito.mock(Device.class);\n+\t\twhen(device.getDeviceType()).thenReturn(\"LMD\");\n+\t\twhen(device.getIpAddress()).thenReturn(\"testIp\");\n+\t\twhen(this.deviceDomainService.searchActiveDevice(\"testDevice\", ComponentType.DOMAIN_CORE)).thenReturn(device);\n+\n+\t\tthis.deviceInstallationService.getStatus(\"testOrganisation\", \"testDevice\", \"testUid\", \"testMessageType\", 1);\n+\n+\t\tverify(this.osgpCoreRequestMessageSender).send(this.argumentReqM.capture(), this.argumentStringOne.capture(),\n+\t\t\t\tthis.argumentInt.capture(), this.argumentStringTwo.capture());\n+\n+\t\tassertThat(this.argumentReqM.getValue()).usingRecursiveComparison().isEqualTo(new RequestMessage(\n+\t\t\t\t\"testUid\",\n+\t\t\t\t\"testOrganisation\",\n+\t\t\t\t\"testDevice\", null));\n+\t\tassertThat(this.argumentStringOne.getValue()).isEqualTo(\"GET_LIGHT_SENSOR_STATUS\");\n+\t\tassertThat(this.argumentInt.getValue()).isEqualTo(1);\n+\t\tassertThat(this.argumentStringTwo.getValue()).isEqualTo(\"testIp\");\n+\t}\n+\n+\t@Test\n+\tpublic void testHandleGetStatusResponseNotOk() {\n+\t\tthis.deviceInstallationService.handleGetStatusResponse(null, new CorrelationIds(\"testOrganisation\", \"testDevice\", \"testUid\"),\n+\t\t\t\t\"testMessageType\", 1, ResponseMessageResultType.NOT_OK, null);\n+\n+\t\tverify(this.webServiceResponseMessageSender).send(this.argumentResM.capture());\n+\t\tassertThat(this.argumentResM.getValue()).usingRecursiveComparison().isEqualTo(ResponseMessage.newResponseMessageBuilder()\n+\t\t\t\t.withIds(new CorrelationIds(\"testOrganisation\", \"testDevice\", \"testUid\"))", "originalCommit": "fc2909ae9cd9bbd4c3f1a2a48bbf71c2e95771df", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA2NzM1Mw==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/436#discussion_r503067353", "bodyText": "Refactor the building of a response message to a method and use that method in other tests as well", "author": "robindenadel", "createdAt": "2020-10-12T06:36:58Z", "path": "osgp/platform/osgp-adapter-domain-core/src/test/java/org/opensmartgridplatform/adapter/domain/core/application/services/DeviceInstallationServiceTest.java", "diffHunk": "@@ -0,0 +1,276 @@\n+package org.opensmartgridplatform.adapter.domain.core.application.services;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.when;\n+\n+import java.util.Arrays;\n+import java.util.Collections;\n+\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.ArgumentCaptor;\n+import org.mockito.Captor;\n+import org.mockito.InjectMocks;\n+import org.mockito.Mock;\n+import org.mockito.Mockito;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+import org.mockito.junit.jupiter.MockitoSettings;\n+import org.mockito.quality.Strictness;\n+import org.opensmartgridplatform.adapter.domain.core.application.mapping.DomainCoreMapper;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.core.OsgpCoreRequestMessageSender;\n+import org.opensmartgridplatform.adapter.domain.core.infra.jms.ws.WebServiceResponseMessageSender;\n+import org.opensmartgridplatform.domain.core.entities.Device;\n+import org.opensmartgridplatform.domain.core.entities.LightMeasurementDevice;\n+import org.opensmartgridplatform.domain.core.entities.Ssld;\n+import org.opensmartgridplatform.domain.core.exceptions.ValidationException;\n+import org.opensmartgridplatform.domain.core.repositories.SsldRepository;\n+import org.opensmartgridplatform.domain.core.services.DeviceDomainService;\n+import org.opensmartgridplatform.domain.core.services.OrganisationDomainService;\n+import org.opensmartgridplatform.domain.core.valueobjects.DeviceStatus;\n+import org.opensmartgridplatform.domain.core.valueobjects.DeviceStatusMapped;\n+import org.opensmartgridplatform.domain.core.valueobjects.LightType;\n+import org.opensmartgridplatform.domain.core.valueobjects.LightValue;\n+import org.opensmartgridplatform.domain.core.valueobjects.LinkType;\n+import org.opensmartgridplatform.domain.core.valueobjects.TariffValue;\n+import org.opensmartgridplatform.shared.exceptionhandling.ComponentType;\n+import org.opensmartgridplatform.shared.exceptionhandling.FunctionalException;\n+import org.opensmartgridplatform.shared.exceptionhandling.NoDeviceResponseException;\n+import org.opensmartgridplatform.shared.exceptionhandling.TechnicalException;\n+import org.opensmartgridplatform.shared.infra.jms.CorrelationIds;\n+import org.opensmartgridplatform.shared.infra.jms.RequestMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessage;\n+import org.opensmartgridplatform.shared.infra.jms.ResponseMessageResultType;\n+\n+@ExtendWith(MockitoExtension.class)\n+@MockitoSettings(strictness = Strictness.LENIENT)\n+public class DeviceInstallationServiceTest {\n+\t\n+\t@Mock\n+\tprivate OrganisationDomainService organisationDomainService;\n+\t\n+\t@Mock\n+\tprivate DeviceDomainService deviceDomainService;\n+\t\n+\t@Mock\n+\tprivate OsgpCoreRequestMessageSender osgpCoreRequestMessageSender;\n+\t\n+\t@Mock\n+\tprivate WebServiceResponseMessageSender webServiceResponseMessageSender;\n+\t\n+\t@Mock\n+\tprivate DomainCoreMapper domainCoreMapper;\n+\t\n+\t@Mock\n+\tprivate SsldRepository ssldRepository;\n+\t\n+\t@InjectMocks\n+\tprivate DeviceInstallationService deviceInstallationService;\n+\n+\t@Captor\n+\tprivate ArgumentCaptor<ResponseMessage> argumentResM;\n+\n+\t@Captor\n+\tprivate ArgumentCaptor<RequestMessage> argumentReqM;\n+\n+\t@Captor\n+\tprivate ArgumentCaptor<String> argumentStringOne;\n+\n+\t@Captor\n+\tprivate ArgumentCaptor<String> argumentStringTwo;\n+\n+\t@Captor\n+\tprivate ArgumentCaptor<Integer> argumentInt;\n+\t\n+\t@Test\n+\tpublic void testGetStatusTestDeviceTypeIsNotLmdType() throws FunctionalException {\n+\t\tfinal Device device = Mockito.mock(Device.class);\n+\t\twhen(device.getIpAddress()).thenReturn(\"testIp\");\n+\t\twhen(this.deviceDomainService.searchActiveDevice(\"testDevice\", ComponentType.DOMAIN_CORE)).thenReturn(device);\n+\t\t\n+\t\tthis.deviceInstallationService.getStatus(\"testOrganisation\", \"testDevice\", \"testUid\", \"testMessageType\", 1);\n+\n+\t\tverify(this.osgpCoreRequestMessageSender).send(this.argumentReqM.capture(), this.argumentStringOne.capture(),\n+\t\t\t\tthis.argumentInt.capture(), this.argumentStringTwo.capture());\n+\n+\t\tassertThat(this.argumentReqM.getValue()).usingRecursiveComparison().isEqualTo(new RequestMessage(\n+\t\t\t\t\"testUid\",\n+\t\t\t\t\"testOrganisation\",\n+\t\t\t\t\"testDevice\", null));\n+\t\tassertThat(this.argumentStringOne.getValue()).isEqualTo(\"testMessageType\");\n+\t\tassertThat(this.argumentInt.getValue()).isEqualTo(1);\n+\t\tassertThat(this.argumentStringTwo.getValue()).isEqualTo(\"testIp\");\n+\t}\n+\t\n+\t@Test\n+\tpublic void testGetStatusTestDeviceTypeIsLmdType() throws FunctionalException {\n+\t\tfinal Device device = Mockito.mock(Device.class);\n+\t\twhen(device.getDeviceType()).thenReturn(\"LMD\");\n+\t\twhen(device.getIpAddress()).thenReturn(\"testIp\");\n+\t\twhen(this.deviceDomainService.searchActiveDevice(\"testDevice\", ComponentType.DOMAIN_CORE)).thenReturn(device);\n+\n+\t\tthis.deviceInstallationService.getStatus(\"testOrganisation\", \"testDevice\", \"testUid\", \"testMessageType\", 1);\n+\n+\t\tverify(this.osgpCoreRequestMessageSender).send(this.argumentReqM.capture(), this.argumentStringOne.capture(),\n+\t\t\t\tthis.argumentInt.capture(), this.argumentStringTwo.capture());\n+\n+\t\tassertThat(this.argumentReqM.getValue()).usingRecursiveComparison().isEqualTo(new RequestMessage(\n+\t\t\t\t\"testUid\",\n+\t\t\t\t\"testOrganisation\",\n+\t\t\t\t\"testDevice\", null));\n+\t\tassertThat(this.argumentStringOne.getValue()).isEqualTo(\"GET_LIGHT_SENSOR_STATUS\");\n+\t\tassertThat(this.argumentInt.getValue()).isEqualTo(1);\n+\t\tassertThat(this.argumentStringTwo.getValue()).isEqualTo(\"testIp\");\n+\t}\n+\n+\t@Test\n+\tpublic void testHandleGetStatusResponseNotOk() {\n+\t\tthis.deviceInstallationService.handleGetStatusResponse(null, new CorrelationIds(\"testOrganisation\", \"testDevice\", \"testUid\"),\n+\t\t\t\t\"testMessageType\", 1, ResponseMessageResultType.NOT_OK, null);\n+\n+\t\tverify(this.webServiceResponseMessageSender).send(this.argumentResM.capture());\n+\t\tassertThat(this.argumentResM.getValue()).usingRecursiveComparison().isEqualTo(ResponseMessage.newResponseMessageBuilder()\n+\t\t\t\t.withIds(new CorrelationIds(\"testOrganisation\", \"testDevice\", \"testUid\"))\n+\t\t\t\t.withResult(ResponseMessageResultType.NOT_OK).withOsgpException(null)\n+\t\t\t\t.withDataObject(null).withMessagePriority(1).build());\n+\t}\n+\n+\t@Test\n+\tpublic void testHandleGetStatusResponseOkLmdStatusNotNull() throws FunctionalException, ValidationException {\n+\t\tfinal TariffValue editedTariffValue = new TariffValue();\n+\t\teditedTariffValue.setHigh(true);\n+\t\teditedTariffValue.setIndex(10);\n+\t\tfinal DeviceStatusMapped deviceStatus = new DeviceStatusMapped(null,\n+\t\t\t\tArrays.asList(new LightValue(0, true, 50), new LightValue(1, true, 75), new LightValue(2, false, 0)),\n+\t\t\t\tLinkType.ETHERNET, LinkType.GPRS, LightType.ONE_TO_TEN_VOLT,0\n+\t\t);\n+\t\twhen(this.domainCoreMapper.map(null, DeviceStatus.class)).thenReturn(deviceStatus);\n+\n+\t\tfinal Device mockedDevice = Mockito.mock(Device.class);\n+\t\twhen(mockedDevice.getDeviceType()).thenReturn(LightMeasurementDevice.LMD_TYPE);\n+\t\twhen(this.deviceDomainService.searchDevice(\"testDevice\")).thenReturn(mockedDevice);\n+\n+\t\tthis.deviceInstallationService.handleGetStatusResponse(null, new CorrelationIds(\"testOrganisation\", \"testDevice\", \"testUid\"),\n+\t\t\t\t\"testMessageType\", 1, ResponseMessageResultType.OK, null);\n+\n+\t\tverify(this.webServiceResponseMessageSender).send(this.argumentResM.capture());\n+\t\tassertThat(this.argumentResM.getValue()).usingRecursiveComparison().isEqualTo(ResponseMessage.newResponseMessageBuilder()\n+\t\t\t\t.withIds(new CorrelationIds(\"testOrganisation\", \"testDevice\", \"testUid\"))\n+\t\t\t\t.withResult(ResponseMessageResultType.OK).withOsgpException(null)\n+\t\t\t\t.withDataObject(deviceStatus)\n+\t\t\t\t.withMessagePriority(1)\n+\t\t\t\t.build());", "originalCommit": "fc2909ae9cd9bbd4c3f1a2a48bbf71c2e95771df", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "a9bffc257e7eee211941601a4502361e4f820b61", "url": "https://github.com/OSGP/open-smart-grid-platform/commit/a9bffc257e7eee211941601a4502361e4f820b61", "message": "- Added License Header\n- Renamed some fields\n- Added response message creation method\n- Refactored some repeatedly used objects into constants", "committedDate": "2020-10-13T08:23:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDY5MTk1Nw==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/436#discussion_r510691957", "bodyText": "Formatting not ok, check your IDE settings", "author": "robindenadel", "createdAt": "2020-10-23T07:36:37Z", "path": "osgp/platform/osgp-adapter-domain-core/src/test/java/org/opensmartgridplatform/adapter/domain/core/application/services/DeviceInstallationServiceTest.java", "diffHunk": "@@ -0,0 +1,275 @@\n+package org.opensmartgridplatform.adapter.domain.core.application.services;", "originalCommit": "a9bffc257e7eee211941601a4502361e4f820b61", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjc2NDg1OA==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/436#discussion_r512764858", "bodyText": "Which part of the formatting is not okay?", "author": "MithraicMagic", "createdAt": "2020-10-27T14:57:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDY5MTk1Nw=="}], "type": "inlineReview"}, {"oid": "5c6cd9c701d1e32c983962a113978661590d7637", "url": "https://github.com/OSGP/open-smart-grid-platform/commit/5c6cd9c701d1e32c983962a113978661590d7637", "message": "- Formatting using the eclipse Config", "committedDate": "2020-11-17T14:31:28Z", "type": "commit"}]}