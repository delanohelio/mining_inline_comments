{"pr_number": 3069, "pr_title": "Fix stale documents due to changed APIs", "pr_createdAt": "2020-09-18T05:35:17Z", "pr_url": "https://github.com/line/armeria/pull/3069", "timeline": [{"oid": "6fac9a10f83d3cdd01573afcb1a7cd07cc94290a", "url": "https://github.com/line/armeria/commit/6fac9a10f83d3cdd01573afcb1a7cd07cc94290a", "message": "Fix stale documents due to changed APIs", "committedDate": "2020-09-18T05:30:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDc0ODY0Nw==", "url": "https://github.com/line/armeria/pull/3069#discussion_r490748647", "bodyText": "Could you use {@linkplain #getAll(ClassLoader) getAll(Version.class.getClassLoader())}?", "author": "minwoox", "createdAt": "2020-09-18T07:14:58Z", "path": "core/src/main/java/com/linecorp/armeria/common/util/Version.java", "diffHunk": "@@ -111,7 +111,7 @@ public static Version get(String artifactId, ClassLoader classLoader) {\n \n     /**\n      * Retrieves the version information of Armeria artifacts.\n-     * This method is a shortcut for {@code identify(Version.class.getClassLoader())}.\n+     * This method is a shortcut for {@code getAll(Version.class.getClassLoader())}.", "originalCommit": "6fac9a10f83d3cdd01573afcb1a7cd07cc94290a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDc1MzY2Mg==", "url": "https://github.com/line/armeria/pull/3069#discussion_r490753662", "bodyText": "updated also.", "author": "wooyeong", "createdAt": "2020-09-18T07:25:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDc0ODY0Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDc0OTM4NA==", "url": "https://github.com/line/armeria/pull/3069#discussion_r490749384", "bodyText": "Could you use ensureAvailable(RequestLogProperty.RESPONSE_HEADERS) instead?", "author": "minwoox", "createdAt": "2020-09-18T07:16:42Z", "path": "site/src/pages/docs/client-retry.mdx", "diffHunk": "@@ -71,7 +71,7 @@ new RetryRule() {\n             }\n         }\n \n-        if (ctx.log().responseHeaders().status() == HttpStatus.TOO_MANY_REQUESTS) {\n+        if (ctx.log().partial().responseHeaders().status() == HttpStatus.TOO_MANY_REQUESTS) {", "originalCommit": "6fac9a10f83d3cdd01573afcb1a7cd07cc94290a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDc1Mjc3MQ==", "url": "https://github.com/line/armeria/pull/3069#discussion_r490752771", "bodyText": "Fixed!", "author": "wooyeong", "createdAt": "2020-09-18T07:23:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDc0OTM4NA=="}], "type": "inlineReview"}, {"oid": "7d373fa078a5310164aac08108efa7f450dfd734", "url": "https://github.com/line/armeria/commit/7d373fa078a5310164aac08108efa7f450dfd734", "message": "Address @minwoox's comment", "committedDate": "2020-09-18T07:21:48Z", "type": "commit"}, {"oid": "cc7bb46fab7e97375e62788fede5d049fb189e10", "url": "https://github.com/line/armeria/commit/cc7bb46fab7e97375e62788fede5d049fb189e10", "message": "Address 2", "committedDate": "2020-09-18T07:25:00Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDc2OTcxNA==", "url": "https://github.com/line/armeria/pull/3069#discussion_r490769714", "bodyText": "could you break the line, please?\nor extract the status to a variable so that the line doesn't get too long?", "author": "minwoox", "createdAt": "2020-09-18T07:57:30Z", "path": "site/src/pages/docs/client-retry.mdx", "diffHunk": "@@ -71,7 +71,7 @@ new RetryRule() {\n             }\n         }\n \n-        if (ctx.log().responseHeaders().status() == HttpStatus.TOO_MANY_REQUESTS) {\n+        if (ctx.log().ensureAvailable(RequestLogProperty.RESPONSE_HEADERS).responseHeaders().status() == HttpStatus.TOO_MANY_REQUESTS) {", "originalCommit": "cc7bb46fab7e97375e62788fede5d049fb189e10", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDc5MTk5OQ==", "url": "https://github.com/line/armeria/pull/3069#discussion_r490791999", "bodyText": "introduced a variable.", "author": "wooyeong", "createdAt": "2020-09-18T08:37:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDc2OTcxNA=="}], "type": "inlineReview"}, {"oid": "c58f8e8033b6f0a6c017cbc469671c7418eb7e7d", "url": "https://github.com/line/armeria/commit/c58f8e8033b6f0a6c017cbc469671c7418eb7e7d", "message": "Introduce a variable to hold `HttpStatus`", "committedDate": "2020-09-18T08:36:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTY5NDU3Mw==", "url": "https://github.com/line/armeria/pull/3069#discussion_r491694573", "bodyText": "@link is better than @linkplain in this case because the text is code.", "author": "trustin", "createdAt": "2020-09-20T14:02:40Z", "path": "core/src/main/java/com/linecorp/armeria/common/util/Version.java", "diffHunk": "@@ -111,7 +111,7 @@ public static Version get(String artifactId, ClassLoader classLoader) {\n \n     /**\n      * Retrieves the version information of Armeria artifacts.\n-     * This method is a shortcut for {@code identify(Version.class.getClassLoader())}.\n+     * This method is a shortcut for {@linkplain #getAll(ClassLoader) getAll(Version.class.getClassLoader())}.", "originalCommit": "c58f8e8033b6f0a6c017cbc469671c7418eb7e7d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTgyMjcwNg==", "url": "https://github.com/line/armeria/pull/3069#discussion_r491822706", "bodyText": "Updated.", "author": "wooyeong", "createdAt": "2020-09-21T06:49:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTY5NDU3Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTY5NDY3Nw==", "url": "https://github.com/line/armeria/pull/3069#discussion_r491694677", "bodyText": "I don't think we need to do this because the response headers are always available at this point. It can be unavailable only when cause != null.", "author": "trustin", "createdAt": "2020-09-20T14:03:58Z", "path": "site/src/pages/docs/client-retry.mdx", "diffHunk": "@@ -71,7 +71,8 @@ new RetryRule() {\n             }\n         }\n \n-        if (ctx.log().responseHeaders().status() == HttpStatus.TOO_MANY_REQUESTS) {\n+        HttpStatus status = ctx.log().ensureAvailable(RequestLogProperty.RESPONSE_HEADERS).responseHeaders().status();\n+        if (status == HttpStatus.TOO_MANY_REQUESTS) {", "originalCommit": "c58f8e8033b6f0a6c017cbc469671c7418eb7e7d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTY5NDk1OA==", "url": "https://github.com/line/armeria/pull/3069#discussion_r491694958", "bodyText": "Ah, looks like we can reach here even when cause != null. I think we should guard with isAvailable() instead of using ensureAvailable(), so that shouldRetry() does not raise an exception but just return next().", "author": "trustin", "createdAt": "2020-09-20T14:07:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTY5NDY3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTc1MzE3Mg==", "url": "https://github.com/line/armeria/pull/3069#discussion_r491753172", "bodyText": "It can be unavailable only when cause != null.\n\nWell, it's available even when cause != null. (With the status HttpStatus.UNKNOWN)\nSo I think we can use partial() which was used at first. Sorry about it. \ud83d\ude05", "author": "minwoox", "createdAt": "2020-09-21T00:20:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTY5NDY3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTgyMjYyMQ==", "url": "https://github.com/line/armeria/pull/3069#discussion_r491822621", "bodyText": "Updated back!", "author": "wooyeong", "createdAt": "2020-09-21T06:49:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTY5NDY3Nw=="}], "type": "inlineReview"}, {"oid": "61a079dc571c16e044a8ce22739b6d1370e169a5", "url": "https://github.com/line/armeria/commit/61a079dc571c16e044a8ce22739b6d1370e169a5", "message": "linkplain to link, ensureAvailable to partial", "committedDate": "2020-09-21T06:48:37Z", "type": "commit"}]}