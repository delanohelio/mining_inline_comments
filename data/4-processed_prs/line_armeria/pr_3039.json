{"pr_number": 3039, "pr_title": "Log the implementations found by SPI", "pr_createdAt": "2020-08-31T13:55:29Z", "pr_url": "https://github.com/line/armeria/pull/3039", "timeline": [{"oid": "b805c2566aed463b54a64d36e1612a3f0ab4bc19", "url": "https://github.com/line/armeria/commit/b805c2566aed463b54a64d36e1612a3f0ab4bc19", "message": "Log the implementations found by SPI\nMotivation:\nIt's not easy to recognize if Java SPI service interfaces are not applied correctly due to fat JAR, etc.\nThis is the related link and possible solution in that case: https://romanmarkunas.com/build/2018/11/13/0007-build-gradle-fat-jars/\n\nModification:\n- Log the implementations found by SPI.\n\nResult:\n- You are now easily get noticed whether SPI servie interfaces are applied correctly.", "committedDate": "2020-08-31T13:54:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDkyNTk5NA==", "url": "https://github.com/line/armeria/pull/3039#discussion_r480925994", "bodyText": "How about using Loaded instead of Found to meet the term ServiceLoader.load?", "author": "ikhoon", "createdAt": "2020-09-01T07:38:18Z", "path": "core/src/main/java/com/linecorp/armeria/common/SerializationFormat.java", "diffHunk": "@@ -67,10 +75,16 @@\n                                    \"unknown\", create(\"application\", \"x-unknown\")));\n \n         // Load all serialization formats from the providers.\n-        ServiceLoader.load(SerializationFormatProvider.class,\n-                           SerializationFormatProvider.class.getClassLoader())\n-                     .forEach(p -> p.entries().forEach(e -> register(mutableUriTextToFormats,\n+        final List<SerializationFormatProvider> providers = Streams.stream(\n+                ServiceLoader.load(SerializationFormatProvider.class,\n+                                   SerializationFormatProvider.class.getClassLoader())).collect(\n+                toImmutableList());\n+        if (!providers.isEmpty()) {\n+            logger.info(\"Found {}: {}\", SerializationFormatProvider.class.getSimpleName(), providers);", "originalCommit": "b805c2566aed463b54a64d36e1612a3f0ab4bc19", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mjc4Mzk4Mg==", "url": "https://github.com/line/armeria/pull/3039#discussion_r482783982", "bodyText": "Fixed. \ud83d\ude09", "author": "minwoox", "createdAt": "2020-09-03T08:00:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDkyNTk5NA=="}], "type": "inlineReview"}, {"oid": "9c868c04ea284e0d13a0f58df96807a6f9633c37", "url": "https://github.com/line/armeria/commit/9c868c04ea284e0d13a0f58df96807a6f9633c37", "message": "Address the comment by @ikhoon", "committedDate": "2020-09-03T07:59:44Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mjg3Mjk3Nw==", "url": "https://github.com/line/armeria/pull/3039#discussion_r482872977", "bodyText": "ImmutableList.copyOf, think it should work", "author": "anuraaga", "createdAt": "2020-09-03T10:24:25Z", "path": "core/src/main/java/com/linecorp/armeria/common/SerializationFormat.java", "diffHunk": "@@ -67,10 +75,16 @@\n                                    \"unknown\", create(\"application\", \"x-unknown\")));\n \n         // Load all serialization formats from the providers.\n-        ServiceLoader.load(SerializationFormatProvider.class,\n-                           SerializationFormatProvider.class.getClassLoader())\n-                     .forEach(p -> p.entries().forEach(e -> register(mutableUriTextToFormats,\n+        final List<SerializationFormatProvider> providers = Streams.stream(", "originalCommit": "9c868c04ea284e0d13a0f58df96807a6f9633c37", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mjg3OTEwMA==", "url": "https://github.com/line/armeria/pull/3039#discussion_r482879100", "bodyText": "Fixed. Thanks \ud83d\ude09", "author": "minwoox", "createdAt": "2020-09-03T10:36:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mjg3Mjk3Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mjg3MzkxNQ==", "url": "https://github.com/line/armeria/pull/3039#discussion_r482873915", "bodyText": "Does toStringHelper do anything without adding fields to it?", "author": "anuraaga", "createdAt": "2020-09-03T10:26:14Z", "path": "thrift0.13/src/main/java/com/linecorp/armeria/internal/common/thrift/ThriftSerializationFormatProvider.java", "diffHunk": "@@ -63,4 +64,9 @@ private static MediaType create(String subtype) {\n     private static MediaType create(String subtype, String protocol) {\n         return create(subtype).withParameter(\"protocol\", protocol);\n     }\n+\n+    @Override\n+    public String toString() {\n+        return MoreObjects.toStringHelper(this).toString();", "originalCommit": "9c868c04ea284e0d13a0f58df96807a6f9633c37", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mjg3Njc5Nw==", "url": "https://github.com/line/armeria/pull/3039#discussion_r482876797", "bodyText": "Not exactly. \ud83d\ude04 Just removing the reference from the result string.\nBut yeah, this creates an additional instance so let me just use the string. \ud83d\ude04", "author": "minwoox", "createdAt": "2020-09-03T10:31:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mjg3MzkxNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mjg4MTE4OQ==", "url": "https://github.com/line/armeria/pull/3039#discussion_r482881189", "bodyText": "Changed my mind and just removed the method completely. \ud83d\ude09", "author": "minwoox", "createdAt": "2020-09-03T10:40:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mjg3MzkxNQ=="}], "type": "inlineReview"}, {"oid": "35bd07d225d108d7798750df7cb146d40a691172", "url": "https://github.com/line/armeria/commit/35bd07d225d108d7798750df7cb146d40a691172", "message": "Address comments by @anuraaga", "committedDate": "2020-09-03T10:38:43Z", "type": "commit"}, {"oid": "43c079a7c1b6c20ecdb6aea3fc8db013d8ea7e36", "url": "https://github.com/line/armeria/commit/43c079a7c1b6c20ecdb6aea3fc8db013d8ea7e36", "message": "Remove unused import", "committedDate": "2020-09-03T10:39:44Z", "type": "commit"}, {"oid": "f9e14253fead27584e274c0e04b3e5f3d792c65c", "url": "https://github.com/line/armeria/commit/f9e14253fead27584e274c0e04b3e5f3d792c65c", "message": "Remove unused", "committedDate": "2020-09-03T13:24:04Z", "type": "commit"}]}