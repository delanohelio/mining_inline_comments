{"pr_number": 2969, "pr_title": "Fix to set content-type correctly for gRPC Trailers-Only", "pr_createdAt": "2020-08-05T03:35:59Z", "pr_url": "https://github.com/line/armeria/pull/2969", "timeline": [{"oid": "b3b810bdf6bff8ac2a75caa26c31bb6b02ae77fc", "url": "https://github.com/line/armeria/commit/b3b810bdf6bff8ac2a75caa26c31bb6b02ae77fc", "message": "Fix to set content-type correctly for gRPC Trailers-Only\nMotivation:\nWe hardcoded the content-type with `application/grpc+proto` when sending gRPC Trailers-Only.\nIt is no harm to set the value because there's no following messages.\nBut I think it's better to set the content-type of the corresponding gRPC request so that a user\ndoesn't get surprised.\n\nModifications:\n- Set the content-type of the corresponding gRPC request to the gRPC Trailers-Only.\n\nResult:\n- gRPC Trailers-Only now has the content-type of the corresponding gRPC request.", "committedDate": "2020-08-05T03:35:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTQ1NzMzOA==", "url": "https://github.com/line/armeria/pull/2969#discussion_r465457338", "bodyText": "nit:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        ServiceRequestContext ctx, HttpHeadersBuilder trailerBuilder, Status status, Metadata metadata) {\n          \n          \n            \n                        ServiceRequestContext ctx, HttpHeadersBuilder trailersBuilder, Status status, Metadata metadata) {", "author": "ikhoon", "createdAt": "2020-08-05T03:57:37Z", "path": "grpc/src/main/java/com/linecorp/armeria/server/grpc/ArmeriaServerCall.java", "diffHunk": "@@ -515,22 +517,22 @@ private void setClientStreamClosed() {\n \n     // Returns ResponseHeaders if headersSent == false or HttpHeaders otherwise.\n     static HttpHeaders statusToTrailers(\n-            ServiceRequestContext ctx, Status status, Metadata metadata, boolean headersSent) {\n-        final HttpHeadersBuilder trailers = GrpcTrailersUtil.statusToTrailers(\n-                status.getCode().value(), status.getDescription(), headersSent);\n+            ServiceRequestContext ctx, HttpHeadersBuilder trailerBuilder, Status status, Metadata metadata) {", "originalCommit": "b3b810bdf6bff8ac2a75caa26c31bb6b02ae77fc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTUxMTg0MQ==", "url": "https://github.com/line/armeria/pull/2969#discussion_r465511841", "bodyText": "Fixed. \ud83d\ude09", "author": "minwoox", "createdAt": "2020-08-05T06:53:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTQ1NzMzOA=="}], "type": "inlineReview"}, {"oid": "bd3b0149185a6c033e54a0b29d4ad17c78cd8d31", "url": "https://github.com/line/armeria/commit/bd3b0149185a6c033e54a0b29d4ad17c78cd8d31", "message": "Address the comment by @ikhoon", "committedDate": "2020-08-05T06:32:51Z", "type": "commit"}]}