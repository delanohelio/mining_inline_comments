{"pr_number": 3024, "pr_title": "Allow a user choose a path when a Thrift/gRPC service has more than one path", "pr_createdAt": "2020-08-25T10:00:11Z", "pr_url": "https://github.com/line/armeria/pull/3024", "timeline": [{"oid": "92b712255d20f13c1ce9982727cdc86f4d3307fa", "url": "https://github.com/line/armeria/commit/92b712255d20f13c1ce9982727cdc86f4d3307fa", "message": "Allow a user choose a path when a Thrift/gRPC service has more than two paths", "committedDate": "2020-08-25T10:02:45Z", "type": "forcePushed"}, {"oid": "c27abd2316e2399c6d801895c72b5544f089de3e", "url": "https://github.com/line/armeria/commit/c27abd2316e2399c6d801895c72b5544f089de3e", "message": "Allow a user choose a path when a Thrift/gRPC service has more than two paths", "committedDate": "2020-08-25T10:08:42Z", "type": "forcePushed"}, {"oid": "1cb11d4fcf50f8751a7224f8d3ec43e180a75380", "url": "https://github.com/line/armeria/commit/1cb11d4fcf50f8751a7224f8d3ec43e180a75380", "message": "Allow a user choose a path when a Thrift/gRPC service has more than two paths", "committedDate": "2020-08-25T10:10:30Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Njg0OTI1OQ==", "url": "https://github.com/line/armeria/pull/3024#discussion_r476849259", "bodyText": "Notice that I need to use the endpointPath parameter to fetch the correct endpoint and thriftMethod above.", "author": "kojilin", "createdAt": "2020-08-25T23:22:06Z", "path": "docs-client/src/lib/transports/thrift.ts", "diffHunk": "@@ -58,7 +59,7 @@ export default class ThriftTransport extends Transport {\n       hdrs.set(name, value);\n     }\n \n-    const httpResponse = await fetch(endpoint.pathMapping, {\n+    const httpResponse = await fetch(endpointPath || endpoint.pathMapping, {", "originalCommit": "1cb11d4fcf50f8751a7224f8d3ec43e180a75380", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzEzODEyMQ==", "url": "https://github.com/line/armeria/pull/3024#discussion_r477138121", "bodyText": "Question: can we do concatAndDedup for the queries as well?", "author": "minwoox", "createdAt": "2020-08-26T08:46:39Z", "path": "core/src/main/java/com/linecorp/armeria/server/docs/DocService.java", "diffHunk": "@@ -333,7 +333,7 @@ private ServiceInfo addServiceExamples(ServiceInfo service) {\n                         // generated by the plugin.\n                         concatAndDedup(exampleHeaders.get(m.name()), m.exampleHeaders()),\n                         concatAndDedup(exampleRequests.get(m.name()), m.exampleRequests()),\n-                        examplePaths.get(m.name()),\n+                        concatAndDedup(examplePaths.get(m.name()), m.examplePaths()),\n                         exampleQueries.get(m.name()),", "originalCommit": "9b3c246144f343ff1713366cc527127aa5f7e9a8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzEzOTU3OA==", "url": "https://github.com/line/armeria/pull/3024#discussion_r477139578", "bodyText": "How about removing this constructor because it's unstableApi and not used anymore?", "author": "minwoox", "createdAt": "2020-08-26T08:49:10Z", "path": "thrift0.13/src/main/java/com/linecorp/armeria/internal/server/thrift/ThriftDocServicePlugin.java", "diffHunk": "@@ -266,7 +268,15 @@ private static MethodInfo newMethodInfo(String name,\n                       .map(TypeSignature::ofNamed)\n                       .collect(toImmutableList());\n \n-        return new MethodInfo(name, returnTypeSignature, parameters, exceptionTypeSignatures, endpoints);", "originalCommit": "9b3c246144f343ff1713366cc527127aa5f7e9a8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzIyNzM4MA==", "url": "https://github.com/line/armeria/pull/3024#discussion_r477227380", "bodyText": "one question, in this PR I remove the ImmutableList.builderWithExpectedSize(Iterables.size(examplePaths)); and change it don't use size. Because below code is making iterable after streamed.\n    private static <T> Iterable<T> concatAndDedup(Iterable<T> first, Iterable<T> second) {\n        return Stream.concat(Streams.stream(first), Streams.stream(second)).distinct()::iterator;\n    }\n}\n\nIs it intentioned? I mean when we see the Iterable parameter, should we think we just can iterate once.", "author": "kojilin", "createdAt": "2020-08-26T11:25:10Z", "path": "core/src/main/java/com/linecorp/armeria/server/docs/DocService.java", "diffHunk": "@@ -333,8 +333,8 @@ private ServiceInfo addServiceExamples(ServiceInfo service) {\n                         // generated by the plugin.\n                         concatAndDedup(exampleHeaders.get(m.name()), m.exampleHeaders()),\n                         concatAndDedup(exampleRequests.get(m.name()), m.exampleRequests()),\n-                        examplePaths.get(m.name()),\n-                        exampleQueries.get(m.name()),\n+                        concatAndDedup(examplePaths.get(m.name()), m.examplePaths()),\n+                        concatAndDedup(exampleQueries.get(m.name()), m.exampleQueries()),", "originalCommit": "a27ac4d58ef7626bfde5a3f5531cf208bf036d13", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzgwMzk0Ng==", "url": "https://github.com/line/armeria/pull/3024#discussion_r477803946", "bodyText": "Oops I think we can just do distinct().collect(toImmutableList());", "author": "minwoox", "createdAt": "2020-08-27T00:45:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzIyNzM4MA=="}], "type": "inlineReview"}, {"oid": "c8268af0d99d56c95b37e2df7d8a99141c02cbc5", "url": "https://github.com/line/armeria/commit/c8268af0d99d56c95b37e2df7d8a99141c02cbc5", "message": "Tweak examples", "committedDate": "2020-08-27T08:47:55Z", "type": "forcePushed"}, {"oid": "cdd563640c321add69454c910b9628be26e51542", "url": "https://github.com/line/armeria/commit/cdd563640c321add69454c910b9628be26e51542", "message": "Separate endpoint page, only dropdown for rpc.\nDisable query for rpc.", "committedDate": "2020-09-03T12:14:14Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDE2NDEyOQ==", "url": "https://github.com/line/armeria/pull/3024#discussion_r484164129", "bodyText": "nit: No need to use return?", "author": "trustin", "createdAt": "2020-09-07T03:22:22Z", "path": "docs-client/src/containers/MethodPage/EndpointPath.tsx", "diffHunk": "@@ -32,39 +33,54 @@ interface Props {\n   onPathFormChange: (e: ChangeEvent<HTMLInputElement>) => void;\n }\n \n-const EndpointPath: React.FunctionComponent<Props> = (props) => (\n-  <>\n-    <Typography variant=\"body2\" paragraph />\n-    <Button color=\"secondary\" onClick={props.onEditEndpointPathClick}>\n-      Endpoint path\n-    </Button>\n-    <Typography variant=\"body2\" paragraph />\n-    {props.endpointPathOpen && (\n-      <>\n-        {props.examplePaths.length > 0 && (\n-          <>\n-            <Typography variant=\"body2\" paragraph />\n-            <Dropdown\n-              placeholder=\"Select an example path...\"\n-              options={props.examplePaths}\n-              onChange={props.onSelectedPathChange}\n-            />\n-          </>\n-        )}\n-        <Typography variant=\"body2\" paragraph />\n-        <TextField\n-          fullWidth\n-          value={props.additionalPath}\n-          placeholder={endpointPathPlaceHolder}\n-          onChange={props.onPathFormChange}\n-          inputProps={{\n-            readOnly: !props.editable,\n-            className: 'code',\n-          }}\n-        />\n-      </>\n-    )}\n-  </>\n-);\n+const EndpointPath: React.FunctionComponent<Props> = (props) => {\n+  return (", "originalCommit": "cdd563640c321add69454c910b9628be26e51542", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "67278c9d7a630bfdfa221fb28871dd79c628f587", "url": "https://github.com/line/armeria/commit/67278c9d7a630bfdfa221fb28871dd79c628f587", "message": "Allow a user choose a path when a Thrift/gRPC service has more than two paths", "committedDate": "2020-09-07T10:58:34Z", "type": "commit"}, {"oid": "f8c6c2ab5b7358fc0928a951a74aab573d7c29b2", "url": "https://github.com/line/armeria/commit/f8c6c2ab5b7358fc0928a951a74aab573d7c29b2", "message": "Fix endpoint is not match additional path problem", "committedDate": "2020-09-07T10:58:34Z", "type": "commit"}, {"oid": "ef25cd8892ef6b7f81f8d5216795123a8ceac090", "url": "https://github.com/line/armeria/commit/ef25cd8892ef6b7f81f8d5216795123a8ceac090", "message": "Follow comments.", "committedDate": "2020-09-07T10:58:34Z", "type": "commit"}, {"oid": "dc7d67d245c74e63b393320e9d9b5dccf7eeca88", "url": "https://github.com/line/armeria/commit/dc7d67d245c74e63b393320e9d9b5dccf7eeca88", "message": "Follow comments.", "committedDate": "2020-09-07T10:58:34Z", "type": "commit"}, {"oid": "c48731f1b39c52e1fe0c7fd22c1444062a84978f", "url": "https://github.com/line/armeria/commit/c48731f1b39c52e1fe0c7fd22c1444062a84978f", "message": "Only filter non annotated service's example path.", "committedDate": "2020-09-07T10:58:34Z", "type": "commit"}, {"oid": "7b99dd9d6e5ecf6a8db408fd28933363f8cd0eda", "url": "https://github.com/line/armeria/commit/7b99dd9d6e5ecf6a8db408fd28933363f8cd0eda", "message": "Follow comments", "committedDate": "2020-09-07T10:58:34Z", "type": "commit"}, {"oid": "ecbee7f2b353b7f5a7f2624ab1ed837cd2c7c9ef", "url": "https://github.com/line/armeria/commit/ecbee7f2b353b7f5a7f2624ab1ed837cd2c7c9ef", "message": "Add examples", "committedDate": "2020-09-07T10:58:34Z", "type": "commit"}, {"oid": "4d45fe21e8ad6eb9fe4260506bed595cad9b3a40", "url": "https://github.com/line/armeria/commit/4d45fe21e8ad6eb9fe4260506bed595cad9b3a40", "message": "Tweak examples", "committedDate": "2020-09-07T10:58:34Z", "type": "commit"}, {"oid": "5b760ca3bc05d517a8e5c9fbd4eb22a07e773d50", "url": "https://github.com/line/armeria/commit/5b760ca3bc05d517a8e5c9fbd4eb22a07e773d50", "message": "Separate endpoint page, only dropdown for rpc.\nDisable query for rpc.", "committedDate": "2020-09-07T10:58:34Z", "type": "commit"}, {"oid": "f8a32c4705bb3224422b6a9330ad5582e3827c16", "url": "https://github.com/line/armeria/commit/f8a32c4705bb3224422b6a9330ad5582e3827c16", "message": "Using endpoint directly instead of ginving example path", "committedDate": "2020-09-07T11:46:14Z", "type": "forcePushed"}, {"oid": "9a8e4f0f29191e41fbc28120a581a5a8e7797530", "url": "https://github.com/line/armeria/commit/9a8e4f0f29191e41fbc28120a581a5a8e7797530", "message": "Using endpoint directly instead of ginving example path", "committedDate": "2020-09-07T11:48:39Z", "type": "commit"}, {"oid": "9a8e4f0f29191e41fbc28120a581a5a8e7797530", "url": "https://github.com/line/armeria/commit/9a8e4f0f29191e41fbc28120a581a5a8e7797530", "message": "Using endpoint directly instead of ginving example path", "committedDate": "2020-09-07T11:48:39Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njk5MDMwMw==", "url": "https://github.com/line/armeria/pull/3024#discussion_r486990303", "bodyText": "Could remove | null?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                endpointPath?: string | null,\n          \n          \n            \n                endpointPath?: string,", "author": "ikhoon", "createdAt": "2020-09-11T11:44:00Z", "path": "docs-client/src/lib/transports/transport.ts", "diffHunk": "@@ -51,11 +51,44 @@ export default abstract class Transport {\n     return this.doSend(method, filledHeaders, bodyJson, endpointPath, queries);\n   }\n \n-  public findDebugMimeTypeEndpoint(method: Method): Endpoint {\n-    const endpoint = method.endpoints.find((ep) =>\n-      ep.availableMimeTypes.includes(this.getDebugMimeType()),\n-    );\n+  public findDebugMimeTypeEndpoint(\n+    method: Method,\n+    endpointPath?: string | null,", "originalCommit": "9a8e4f0f29191e41fbc28120a581a5a8e7797530", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "0ea348ff6a5b0b41683269833e518f3cde33cf06", "url": "https://github.com/line/armeria/commit/0ea348ff6a5b0b41683269833e518f3cde33cf06", "message": "convert null to undefined.", "committedDate": "2020-09-21T06:58:11Z", "type": "commit"}, {"oid": "0ea348ff6a5b0b41683269833e518f3cde33cf06", "url": "https://github.com/line/armeria/commit/0ea348ff6a5b0b41683269833e518f3cde33cf06", "message": "convert null to undefined.", "committedDate": "2020-09-21T06:58:11Z", "type": "forcePushed"}]}