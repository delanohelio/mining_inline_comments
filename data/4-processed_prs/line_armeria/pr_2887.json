{"pr_number": 2887, "pr_title": "Successful events for proxy ssl should be ignored", "pr_createdAt": "2020-07-08T14:19:14Z", "pr_url": "https://github.com/line/armeria/pull/2887", "timeline": [{"oid": "ae3a308968e68594a442f7b0815e32147985bf77", "url": "https://github.com/line/armeria/commit/ae3a308968e68594a442f7b0815e32147985bf77", "message": "Successful events for proxxy ssl should be ignored", "committedDate": "2020-07-08T14:11:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTYyNTQ0OA==", "url": "https://github.com/line/armeria/pull/2887#discussion_r451625448", "bodyText": "How about adding more detail to this comment, like when this can happen?", "author": "trustin", "createdAt": "2020-07-08T15:17:36Z", "path": "core/src/main/java/com/linecorp/armeria/client/HttpClientPipelineConfigurator.java", "diffHunk": "@@ -195,6 +195,11 @@ public void userEventTriggered(ChannelHandlerContext ctx, Object evt) throws Exc\n                     return;\n                 }\n \n+                if (!sslHandler.handshakeFuture().isDone()) {\n+                    // Ignore successful handshake events for other SslHandlers in the pipeline.", "originalCommit": "ae3a308968e68594a442f7b0815e32147985bf77", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "1a9b27c0d69c0bd02506a747b899799413e157de", "url": "https://github.com/line/armeria/commit/1a9b27c0d69c0bd02506a747b899799413e157de", "message": "add more explanation on why we need to check handshakeFuture", "committedDate": "2020-07-08T15:50:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTkzMTY1MQ==", "url": "https://github.com/line/armeria/pull/2887#discussion_r451931651", "bodyText": "How about testHttpToHttpsEndpoint? so that people get easily noticed the differences with the test below.\nOr I think we can just combine these two tests into one.", "author": "minwoox", "createdAt": "2020-07-09T02:41:57Z", "path": "core/src/test/java/com/linecorp/armeria/client/proxy/ProxyClientIntegrationTest.java", "diffHunk": "@@ -331,12 +336,32 @@ void testHttpProxyPrefaceFailure() throws Exception {\n         clientFactory.close();\n     }\n \n-    @Test\n-    void testHttpsProxyBasicCase() throws Exception {\n+    @ParameterizedTest\n+    @EnumSource(value = SessionProtocol.class, mode = Mode.INCLUDE, names = {\"H1C\", \"H2C\", \"HTTP\"})\n+    void testHttpsProxyBasicCase(SessionProtocol protocol) throws Exception {", "originalCommit": "1a9b27c0d69c0bd02506a747b899799413e157de", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "2f032ed4ff07c60a509501f84ad76f52db1b2ab1", "url": "https://github.com/line/armeria/commit/2f032ed4ff07c60a509501f84ad76f52db1b2ab1", "message": "combine tests for https proxy", "committedDate": "2020-07-09T13:08:06Z", "type": "commit"}]}