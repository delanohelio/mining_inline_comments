{"pr_number": 2457, "pr_title": "Apply gradle-versions-plugin to dependencyManagement project", "pr_createdAt": "2020-02-06T07:54:04Z", "pr_url": "https://github.com/line/armeria/pull/2457", "timeline": [{"oid": "e6100f8192b8fa3dfe06b5f2a0e15ed978e75277", "url": "https://github.com/line/armeria/commit/e6100f8192b8fa3dfe06b5f2a0e15ed978e75277", "message": "Apply gradle-versions-plugin to dependencyManagement project instead of manually aggregating all dependencies.", "committedDate": "2020-02-06T07:48:42Z", "type": "commit"}, {"oid": "0c94d77f48031e5fa7c75de8ee1dd4a48f70b386", "url": "https://github.com/line/armeria/commit/0c94d77f48031e5fa7c75de8ee1dd4a48f70b386", "message": "Add nudge for updating downgraded version overrides.", "committedDate": "2020-02-07T05:53:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjIyNjc1MA==", "url": "https://github.com/line/armeria/pull/2457#discussion_r376226750", "bodyText": "Could you explain why this has been removed?", "author": "trustin", "createdAt": "2020-02-07T06:02:13Z", "path": "gradle.properties", "diffHunk": "@@ -23,7 +23,6 @@ googleAnalyticsId=UA-145425527-1\n \n # Gradle options\n org.gradle.jvmargs=-Xmx1280m\n-org.gradle.configureondemand=true", "originalCommit": "0c94d77f48031e5fa7c75de8ee1dd4a48f70b386", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjIyODMxMA==", "url": "https://github.com/line/armeria/pull/2457#discussion_r376228310", "bodyText": "Oops completely forgot to explain - added to PR description", "author": "anuraaga", "createdAt": "2020-02-07T06:09:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjIyNjc1MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjIyNjk3NQ==", "url": "https://github.com/line/armeria/pull/2457#discussion_r376226975", "bodyText": "How about adding an alias task to the root project?", "author": "trustin", "createdAt": "2020-02-07T06:03:26Z", "path": "gradle/scripts/README.md", "diffHunk": "@@ -213,7 +213,7 @@ boms:\n applied so you can conveniently check if your dependencies are out of date:\n \n ```\n-$ ./gradlew dependencyUpdates -Drevision=release\n+$ ./gradlew dependencyManagement:dependencyUpdates", "originalCommit": "0c94d77f48031e5fa7c75de8ee1dd4a48f70b386", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjIyODUyNQ==", "url": "https://github.com/line/armeria/pull/2457#discussion_r376228525", "bodyText": "Went ahead and just removed the path so the task is run when there's no colon. Should we add an alias too or is this ok?", "author": "anuraaga", "createdAt": "2020-02-07T06:10:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjIyNjk3NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjIyOTg5OA==", "url": "https://github.com/line/armeria/pull/2457#discussion_r376229898", "bodyText": "I think it's OK.", "author": "trustin", "createdAt": "2020-02-07T06:17:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjIyNjk3NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjIyNzEyOQ==", "url": "https://github.com/line/armeria/pull/2457#discussion_r376227129", "bodyText": "Nice work!", "author": "trustin", "createdAt": "2020-02-07T06:04:10Z", "path": "gradle/scripts/lib/common-dependencies.gradle", "diffHunk": "@@ -90,10 +97,45 @@ configure(dependencyManagementProject) {\n             }\n         }\n     }\n+\n+\n+    tasks {\n+        dependencyUpdates {\n+            revision = 'release'\n+\n+            resolutionStrategy {\n+                componentSelection { rules ->\n+                    rules.all { ComponentSelection selection ->\n+                        boolean rejected = ['alpha', 'beta', 'rc', 'cr', 'm', 'preview'].any { qualifier ->\n+                            selection.candidate.version ==~ /(?i).*[.-]${qualifier}[.\\d-]*/\n+                        }\n+                        if (rejected) {\n+                            selection.reject('Release candidate')\n+                        }\n+                    }\n+                }\n+            }\n+\n+            checkConstraints = true\n+\n+            // We have downgraded versions for legacy artifacts which versions plugin has no way of handling.\n+            // But we can provide a reminder to manually check for updates.\n+            doLast {\n+                logger.quiet \"Don't forget to check the following for updates to legacy version downgrades\"\n+                managedDependencyOverrides.each { override ->\n+                    def (group, artifact, version) = override.split(':')\n+                    def parts = version.split('\\\\.')\n+                    if (parts.length >= 2) {\n+                        logger.quiet \"${artifact} is currently version ${version}\"\n+                        logger.quiet \"https://search.maven.org/search?q=g:${group}%20a:${artifact}%20v:${parts[0]}.${parts[1]}.*\\n\"", "originalCommit": "0c94d77f48031e5fa7c75de8ee1dd4a48f70b386", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "d9ea8c5ca1b949a5cdc82505ef2879be87b7209b", "url": "https://github.com/line/armeria/commit/d9ea8c5ca1b949a5cdc82505ef2879be87b7209b", "message": "Remove path", "committedDate": "2020-02-07T06:10:15Z", "type": "commit"}]}