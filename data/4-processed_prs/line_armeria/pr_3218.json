{"pr_number": 3218, "pr_title": "Fix NPE in `TomcatService` when the server is shutdown.", "pr_createdAt": "2020-12-11T12:16:34Z", "pr_url": "https://github.com/line/armeria/pull/3218", "timeline": [{"oid": "d50d212f420e47027e48d9f4ab36405c516b0623", "url": "https://github.com/line/armeria/commit/d50d212f420e47027e48d9f4ab36405c516b0623", "message": "Fix NPE in `TomcatService` when the server is shutdown.\nMotivation:\nNPE is raised in `TomcatService` when the server is shutdown.\n\nModification:\n- Respond with 503 if the `Connector` is in stopped state in `TomcatService`.\n\nResult:\n- You no longer see NPE in `TomcatService` when stopping the server.\n- Close #3136", "committedDate": "2020-12-11T12:15:32Z", "type": "commit"}, {"oid": "cc4747eedb030d893b470005aff514d5f22554d5", "url": "https://github.com/line/armeria/commit/cc4747eedb030d893b470005aff514d5f22554d5", "message": "Add more if conditions", "committedDate": "2020-12-13T09:34:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjEwNzIyNA==", "url": "https://github.com/line/armeria/pull/3218#discussion_r542107224", "bodyText": "nit: Could use switch-case?", "author": "trustin", "createdAt": "2020-12-14T04:40:30Z", "path": "tomcat9/src/main/java/com/linecorp/armeria/server/tomcat/TomcatService.java", "diffHunk": "@@ -400,6 +410,13 @@ public final HttpResponse serve(ServiceRequestContext ctx, HttpRequest req) thro\n         return res;\n     }\n \n+    private static boolean isConnectorStopped(LifecycleState connectorState) {\n+        return connectorState == LifecycleState.STOPPED ||\n+               connectorState == LifecycleState.DESTROYING ||\n+               connectorState == LifecycleState.DESTROYED ||\n+               connectorState == LifecycleState.FAILED;", "originalCommit": "a7798bcd4f12a2be263190b6bb840cbcf01555f6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjk1MjIzOA==", "url": "https://github.com/line/armeria/pull/3218#discussion_r542952238", "bodyText": "Fixed. \ud83d\ude09", "author": "minwoox", "createdAt": "2020-12-15T00:28:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjEwNzIyNA=="}], "type": "inlineReview"}, {"oid": "433fd08e1a1eb52b00ea0deb15be7975f014159c", "url": "https://github.com/line/armeria/commit/433fd08e1a1eb52b00ea0deb15be7975f014159c", "message": "Address the comment by @trustin", "committedDate": "2020-12-15T00:27:57Z", "type": "commit"}, {"oid": "433fd08e1a1eb52b00ea0deb15be7975f014159c", "url": "https://github.com/line/armeria/commit/433fd08e1a1eb52b00ea0deb15be7975f014159c", "message": "Address the comment by @trustin", "committedDate": "2020-12-15T00:27:57Z", "type": "forcePushed"}]}