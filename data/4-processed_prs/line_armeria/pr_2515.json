{"pr_number": 2515, "pr_title": "Make `RequestContextExporter` capable of exporting request ID", "pr_createdAt": "2020-02-19T13:48:53Z", "pr_url": "https://github.com/line/armeria/pull/2515", "timeline": [{"oid": "ab505a32516dc427e442654096cd40c7c0e60edd", "url": "https://github.com/line/armeria/commit/ab505a32516dc427e442654096cd40c7c0e60edd", "message": "Exporting request_id into RequestContextExporter\n\nMotivation:\nRequestContextExportor did not have export for req.id\n\nModification:\n\n - Introduce REQ_ID into BuiltInProperty\n - Introduce method for REQ_ID\n - Update test", "committedDate": "2020-02-19T13:48:00Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTMwMDg1MA==", "url": "https://github.com/line/armeria/pull/2515#discussion_r381300850", "bodyText": "Please address about this ctx.id().text()\nRequestId class also has shortText() for human-readable. I think later one is better, but this can make people confuse if two id is nearly same.", "author": "JunoJunho", "createdAt": "2020-02-19T13:50:02Z", "path": "core/src/main/java/com/linecorp/armeria/common/logging/RequestContextExporter.java", "diffHunk": "@@ -423,6 +427,10 @@ private static String getAuthority(RequestContext ctx, HttpHeaders headers) {\n         return null;\n     }\n \n+    private static void exportId(Map<String, String> out, RequestContext ctx) {\n+        putBuiltInProperty(out, REQ_ID, ctx.id().text());", "originalCommit": "ab505a32516dc427e442654096cd40c7c0e60edd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTMwNDM1Mg==", "url": "https://github.com/line/armeria/pull/2515#discussion_r381304352", "bodyText": "I'd lean towards using full, not human readable. This is often used for searching logs based on the ID so precision is nice.", "author": "anuraaga", "createdAt": "2020-02-19T13:56:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTMwMDg1MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTc4Mjc4NA==", "url": "https://github.com/line/armeria/pull/2515#discussion_r381782784", "bodyText": "{@code \"req.id\"} - the request ID. ?", "author": "trustin", "createdAt": "2020-02-20T05:55:47Z", "path": "core/src/main/java/com/linecorp/armeria/common/logging/BuiltInProperty.java", "diffHunk": "@@ -90,6 +90,10 @@\n      * The port number is omitted when it is same with the default port number of the current {@link Scheme}.\n      */\n     REQ_AUTHORITY(\"req.authority\"),\n+    /**\n+     * {@code \"req.id\"} - the id of the request.", "originalCommit": "ab505a32516dc427e442654096cd40c7c0e60edd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTk4NzM3NQ==", "url": "https://github.com/line/armeria/pull/2515#discussion_r381987375", "bodyText": "Hmm.. I wrote this comment in terms of consistency.\nI think it does not matter. If you want more it, I will edit it.\nBut I think current is okay to me.", "author": "JunoJunho", "createdAt": "2020-02-20T13:09:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTc4Mjc4NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjAzNzI1Ng==", "url": "https://github.com/line/armeria/pull/2515#discussion_r382037256", "bodyText": "It has to be ID at least. I updated the file for you.", "author": "trustin", "createdAt": "2020-02-20T14:35:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTc4Mjc4NA=="}], "type": "inlineReview"}, {"oid": "39c21a93a7326b4ba45f91c34a26377d33632a58", "url": "https://github.com/line/armeria/commit/39c21a93a7326b4ba45f91c34a26377d33632a58", "message": "Update test", "committedDate": "2020-02-20T13:05:20Z", "type": "commit"}, {"oid": "ade049708c1773d1b91257c33f87e74a3ca5b6ea", "url": "https://github.com/line/armeria/commit/ade049708c1773d1b91257c33f87e74a3ca5b6ea", "message": "Update BuiltInProperty.java", "committedDate": "2020-02-20T14:35:11Z", "type": "commit"}]}