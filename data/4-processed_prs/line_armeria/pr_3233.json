{"pr_number": 3233, "pr_title": "Add `Http2Exception: Stream x does not exist` as an expected exception", "pr_createdAt": "2020-12-17T07:51:20Z", "pr_url": "https://github.com/line/armeria/pull/3233", "timeline": [{"oid": "1d7a4193704b5fc9647a0d7bb5148434ababeca2", "url": "https://github.com/line/armeria/commit/1d7a4193704b5fc9647a0d7bb5148434ababeca2", "message": "Add `Http2Exception: Stream x does not exist` as an expected exception\n\nMotivation:\n\nIf a client sends data after a GOAWAY frame is sent by a remote peer,\nNetty disgards the received data and raises `Http2Exception: Stream x does not exist`.\nIt is an expected behavior and does not leave a warn message to nofity users.\n\nModifications:\n\n- Add  `Http2Exception: Stream x does not exist` to expected exceptions\n\nResult:\n\n- You no longer see `Http2Exception: Stream x does not exist` error message anymore.\n- Fixes #3208", "committedDate": "2020-12-17T07:39:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTcwNTQ2NQ==", "url": "https://github.com/line/armeria/pull/3233#discussion_r545705465", "bodyText": "Question: Do we need to check if the error is PROTOCOL_ERROR?\nCan we combine two patterns?", "author": "minwoox", "createdAt": "2020-12-18T09:27:10Z", "path": "core/src/main/java/com/linecorp/armeria/common/util/Exceptions.java", "diffHunk": "@@ -167,9 +171,17 @@ public static boolean isExpected(Throwable cause) {\n                 return true;\n             }\n \n-            if (cause instanceof Http2Exception && IGNORABLE_HTTP2_ERROR_MESSAGE.matcher(msg).find()) {\n-                // Can happen when disconnected prematurely.\n-                return true;\n+            if (cause instanceof Http2Exception) {\n+                if (IGNORABLE_HTTP2_ERROR_MESSAGE_STREAM_CLOSED.matcher(msg).find()) {", "originalCommit": "1d7a4193704b5fc9647a0d7bb5148434ababeca2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzA1NDkxOQ==", "url": "https://github.com/line/armeria/pull/3233#discussion_r547054919", "bodyText": "Question: Do we need to check if the error is PROTOCOL_ERROR?\n\nLet me check how the error is raised.\n\nCan we combine two patterns?\n\nThe two pattern is IGNORABLE_HTTP2_ERROR_MESSAGE_STREAM_CLOSED and IGNORABLE_HTTP2_ERROR_MESSAGE_GOAWAY?\nIn my opinion, it would be better to keep separate patterns because:\n\nAs the exceptions will not be raised frequently, the regular expression cost would not be expensive.\nIt is difficult to manage if we add a new pattern.", "author": "ikhoon", "createdAt": "2020-12-22T04:00:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTcwNTQ2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzA1NjY1MQ==", "url": "https://github.com/line/armeria/pull/3233#discussion_r547056651", "bodyText": "Question: Do we need to check if the error is PROTOCOL_ERROR?\n\nLet me check how the error is raised.\n\nThe error seems to be raised with STREAM_CLOSED.\nhttps://github.com/netty/netty/blob/e5951d46fc89db507ba7d2968d2ede26378f0b04/codec-http2/src/main/java/io/netty/handler/codec/http2/DefaultHttp2RemoteFlowController.java#L105\nhttps://github.com/netty/netty/blob/e5951d46fc89db507ba7d2968d2ede26378f0b04/codec-http2/src/main/java/io/netty/handler/codec/http2/DefaultHttp2RemoteFlowController.java#L481-L482", "author": "ikhoon", "createdAt": "2020-12-22T04:07:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTcwNTQ2NQ=="}], "type": "inlineReview"}, {"oid": "9b9d132eb42b5a7549ed1f87e984db49b0b89fd7", "url": "https://github.com/line/armeria/commit/9b9d132eb42b5a7549ed1f87e984db49b0b89fd7", "message": "Address comments by @trustin", "committedDate": "2020-12-23T04:01:46Z", "type": "commit"}, {"oid": "6e7a97a782c01f4bbcfea46e2fc61f9c211ce755", "url": "https://github.com/line/armeria/commit/6e7a97a782c01f4bbcfea46e2fc61f9c211ce755", "message": "Revert ExceptionsTest", "committedDate": "2020-12-23T04:05:15Z", "type": "commit"}, {"oid": "8f84cd746ddfe757b3623fd5a80c358ac0571308", "url": "https://github.com/line/armeria/commit/8f84cd746ddfe757b3623fd5a80c358ac0571308", "message": "Checkstyle", "committedDate": "2020-12-23T07:44:47Z", "type": "commit"}, {"oid": "8f84cd746ddfe757b3623fd5a80c358ac0571308", "url": "https://github.com/line/armeria/commit/8f84cd746ddfe757b3623fd5a80c358ac0571308", "message": "Checkstyle", "committedDate": "2020-12-23T07:44:47Z", "type": "forcePushed"}]}