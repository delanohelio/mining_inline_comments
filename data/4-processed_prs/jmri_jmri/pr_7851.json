{"pr_number": 7851, "pr_title": "Better test cleanup.", "pr_createdAt": "2020-01-03T23:06:44Z", "pr_url": "https://github.com/JMRI/JMRI/pull/7851", "timeline": [{"oid": "0c499a0c8a2d16f9c5338aa28029440943b2281e", "url": "https://github.com/JMRI/JMRI/commit/0c499a0c8a2d16f9c5338aa28029440943b2281e", "message": "more test setup/teardown work for jenkins", "committedDate": "2020-01-03T16:03:41Z", "type": "commit"}, {"oid": "a154e255f997e90a65cc78ab7ea25585d70cf4d1", "url": "https://github.com/JMRI/JMRI/commit/a154e255f997e90a65cc78ab7ea25585d70cf4d1", "message": "prevent NPE in headless mode.", "committedDate": "2020-01-03T21:45:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjk5MDY5Ng==", "url": "https://github.com/JMRI/JMRI/pull/7851#discussion_r362990696", "bodyText": "Why use Collectors and not layoutBlocks = new ArrayList<>(InstanceManager.getDefault(LayoutBlockManager.class).getNamedBeanSet());?\n(Not having tried this myself, it seems that might be more readable.)", "author": "rhwood", "createdAt": "2020-01-03T23:11:09Z", "path": "java/test/jmri/jmrit/display/layoutEditor/LayoutEditorToolsTest.java", "diffHunk": "@@ -604,45 +603,47 @@ public void setUp() throws Exception {\n                 String uBlockName = \"Block \" + i;\n                 InstanceManager.getDefault(LayoutBlockManager.class).createNewLayoutBlock(sBlockName, uBlockName);\n             }\n-            layoutBlocks = InstanceManager.getDefault(LayoutBlockManager.class).getNamedBeanList();\n+            layoutBlocks = InstanceManager.getDefault(LayoutBlockManager.class).getNamedBeanSet().stream().collect(Collectors.toList());", "originalCommit": "a154e255f997e90a65cc78ab7ea25585d70cf4d1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjk5NzU0NQ==", "url": "https://github.com/JMRI/JMRI/pull/7851#discussion_r362997545", "bodyText": "Even better, change layoutBloxks declaration to a Set and use it natively.", "author": "bobjacobsen", "createdAt": "2020-01-03T23:56:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjk5MDY5Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjk5ODY4Nw==", "url": "https://github.com/JMRI/JMRI/pull/7851#discussion_r362998687", "bodyText": "Other parts of the test are requesting specific items by indexes in order (sometimes repeating the same index), which is why I didn't suggest using a Set.", "author": "rhwood", "createdAt": "2020-01-04T00:05:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjk5MDY5Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzAwODM3NA==", "url": "https://github.com/JMRI/JMRI/pull/7851#discussion_r363008374", "bodyText": "Why use Collectors and not layoutBlocks = new ArrayList<>(InstanceManager.getDefault(LayoutBlockManager.class).getNamedBeanSet());?\n(Not having tried this myself, it seems that might be more readable.)\n\nI actually like how streaming to the collector reads.", "author": "pabender", "createdAt": "2020-01-04T01:42:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjk5MDY5Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzAwOTY1Nw==", "url": "https://github.com/JMRI/JMRI/pull/7851#discussion_r363009657", "bodyText": "Even better, change layoutBloxks declaration to a Set and use it natively.\n\nAs Randall said, we are pulling specific elements and I am trying to change the actual tests as little as possible.\nThat said, this test class was initially written with arrays for all of the named bean objects, with each array initialized in a common loop.  I broke the loop into 4 parts.  I don\u2019t think most of the registered objects are actually used, so it may be a good idea to reduce the number of objects created to only those actually used.\nI\u2019ll take that bit of refactoring on next, but I want to see if explicitly closing the layout editors helps on Jenkins first.  Neither of the jenkins jobs that run \u2018ant logalltest\u2019  have been completing successfully for a while now.", "author": "pabender", "createdAt": "2020-01-04T02:04:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjk5MDY5Ng=="}], "type": "inlineReview"}]}