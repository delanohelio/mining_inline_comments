{"pr_number": 177, "pr_title": "DEV-1420 Apply CMEK to patient report bucket", "pr_createdAt": "2020-07-30T13:57:51Z", "pr_url": "https://github.com/hartwigmedical/pipeline5/pull/177", "timeline": [{"oid": "2e9ea4e466d9f2a8c98fcf023f4ca966f318eb04", "url": "https://github.com/hartwigmedical/pipeline5/commit/2e9ea4e466d9f2a8c98fcf023f4ca966f318eb04", "message": "DEV-1420 Apply CMEK to patient report bucket\n\nIf the pipeline creates this bucket (as it is likely to do when we are\nrunning Platinum) it will now check that a CMEK is specified and apply\nit to the new bucket.", "committedDate": "2020-07-30T13:57:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzAyOTAxMw==", "url": "https://github.com/hartwigmedical/pipeline5/pull/177#discussion_r463029013", "bodyText": "I don't think its actually possible for cmek to be empty, its a mandatory argument now.", "author": "pauldwolfe", "createdAt": "2020-07-30T14:16:33Z", "path": "cluster/src/main/java/com/hartwig/pipeline/report/PipelineResultsProvider.java", "diffHunk": "@@ -25,10 +25,14 @@ public static PipelineResultsProvider from(final Storage storage, final Argument\n     public PipelineResults get() {\n         Bucket reportBucket = storage.get(arguments.patientReportBucket());\n         if (reportBucket == null) {\n-            reportBucket = storage.create(BucketInfo.newBuilder(arguments.patientReportBucket())\n+            BucketInfo.Builder builder = BucketInfo.newBuilder(arguments.patientReportBucket())\n                     .setStorageClass(StorageClass.REGIONAL)\n-                    .setLocation(arguments.region())\n-                    .build());\n+                    .setLocation(arguments.region());\n+            if (arguments.cmek().trim().isEmpty()) {", "originalCommit": "2e9ea4e466d9f2a8c98fcf023f4ca966f318eb04", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzM3Njk4MQ==", "url": "https://github.com/hartwigmedical/pipeline5/pull/177#discussion_r463376981", "bodyText": "It can be set to a string of spaces (and maybe the empty string too, I didn't check that) using quotes on the command line.", "author": "nedleitch", "createdAt": "2020-07-31T02:44:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzAyOTAxMw=="}], "type": "inlineReview"}]}