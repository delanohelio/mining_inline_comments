{"pr_number": 210, "pr_title": "DEV-1555 Print failure logs at the end of pipeline", "pr_createdAt": "2020-10-08T20:49:46Z", "pr_url": "https://github.com/hartwigmedical/pipeline5/pull/210", "timeline": [{"oid": "4935d60da6bd8c976f5b7a3ac9797828d4828d81", "url": "https://github.com/hartwigmedical/pipeline5/commit/4935d60da6bd8c976f5b7a3ac9797828d4828d81", "message": "DEV-1555 Print failure logs at the end of pipeline\n\nAdds a field to the stage outputs to cache a reference to the log blob in case of failure.\n\nLittle awkward as we need to explicitly add the log everywhere, but can't find another solution\nwith the current state of the StageOutputs. The lanes in the BwaAligner also make it a bit\ntricky to make a really general solution.", "committedDate": "2020-10-08T20:48:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjM5NDI4OQ==", "url": "https://github.com/hartwigmedical/pipeline5/pull/210#discussion_r502394289", "bodyText": "I can see the reasoning (it's a summary showing any failures) but it's not necessarily a failure. Could we call it StageSummary or ExecutionSummary or something similar?", "author": "nedleitch", "createdAt": "2020-10-09T12:32:07Z", "path": "cluster/src/main/java/com/hartwig/pipeline/report/FailureSummary.java", "diffHunk": "@@ -0,0 +1,38 @@\n+package com.hartwig.pipeline.report;\n+\n+import java.util.List;\n+import java.util.stream.Collectors;\n+\n+import com.google.cloud.storage.Blob;\n+import com.google.cloud.storage.Storage;\n+import com.hartwig.pipeline.PipelineState;\n+import com.hartwig.pipeline.StageOutput;\n+import com.hartwig.pipeline.execution.PipelineStatus;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+public class FailureSummary {", "originalCommit": "4935d60da6bd8c976f5b7a3ac9797828d4828d81", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzM1OTE1NQ==", "url": "https://github.com/hartwigmedical/pipeline5/pull/210#discussion_r503359155", "bodyText": "See your point, going with VmExecutionLogSummary", "author": "pauldwolfe", "createdAt": "2020-10-12T15:06:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjM5NDI4OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjM5NDUzNg==", "url": "https://github.com/hartwigmedical/pipeline5/pull/210#discussion_r502394536", "bodyText": "I thought we had a requirement that it live in the top-level?", "author": "nedleitch", "createdAt": "2020-10-09T12:32:36Z", "path": "cluster/src/main/java/com/hartwig/pipeline/execution/vm/BashStartupScript.java", "diffHunk": "@@ -50,7 +50,7 @@ String asUnixString(StorageStrategy storageStrategy) {\n                 \"function die() {\",\n                 \"  exit_code=$?\",\n                 \"  echo \\\"Unknown failure: called command returned $exit_code\\\"\",\n-                format(\"  gsutil -m cp %s gs://%s\", localLogFile, runtimeBucketName),\n+                format(\"  gsutil -m cp %s gs://%s/results/\", localLogFile, runtimeBucketName),", "originalCommit": "4935d60da6bd8c976f5b7a3ac9797828d4828d81", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzM1OTg0Mg==", "url": "https://github.com/hartwigmedical/pipeline5/pull/210#discussion_r503359842", "bodyText": "don't think so, when the run succeeds this is where the logs go.", "author": "pauldwolfe", "createdAt": "2020-10-12T15:07:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjM5NDUzNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjM5NDk0Nw==", "url": "https://github.com/hartwigmedical/pipeline5/pull/210#discussion_r502394947", "bodyText": "How is this related?", "author": "nedleitch", "createdAt": "2020-10-09T12:33:19Z", "path": "cluster/src/main/java/com/hartwig/pipeline/resource/OverriddenReferenceGenome.java", "diffHunk": "@@ -53,7 +53,7 @@ public String gridssBreakendPon() {\n \n     @Override\n     public String gridssBreakpointPon() {\n-        return decorated.gridssBreakpointPon();\n+        return decorated.gridssBreakendPon();", "originalCommit": "4935d60da6bd8c976f5b7a3ac9797828d4828d81", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzM1OTM4NA==", "url": "https://github.com/hartwigmedical/pipeline5/pull/210#discussion_r503359384", "bodyText": "Not, was used to introduce a failure", "author": "pauldwolfe", "createdAt": "2020-10-12T15:06:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjM5NDk0Nw=="}], "type": "inlineReview"}, {"oid": "c5ed4235b25c7ab3daa95af4a38b5d990551d862", "url": "https://github.com/hartwigmedical/pipeline5/commit/c5ed4235b25c7ab3daa95af4a38b5d990551d862", "message": "DEV-1555 Print failure logs at the end of pipeline\n\nChange to use pointers to GCS locations rather than the actual blobs, as in some cases the\nblob won't yet exist when the output is created. Also now explicit that the pointers are only\nfor logs of failed stages.\n\nAlso addressing review feedback:\n- Better name for summary class\n- Remove change to bash script\n- Remove accidental commit to OverriddenReferenceGenome", "committedDate": "2020-10-12T17:05:23Z", "type": "commit"}]}