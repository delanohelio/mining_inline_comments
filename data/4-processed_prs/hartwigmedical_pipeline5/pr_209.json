{"pr_number": 209, "pr_title": "DEV-1547 Run from bam files and allow overriding of ref genome", "pr_createdAt": "2020-10-07T20:27:32Z", "pr_url": "https://github.com/hartwigmedical/pipeline5/pull/209", "timeline": [{"oid": "d4b6c6066acbb72f855de48e91dfc728d643bd81", "url": "https://github.com/hartwigmedical/pipeline5/commit/d4b6c6066acbb72f855de48e91dfc728d643bd81", "message": "DEV-1547 Add optional bam to the sample model", "committedDate": "2020-10-06T19:17:07Z", "type": "commit"}, {"oid": "5aff0816ca4e326f7e021876eda7ef7c6119b104", "url": "https://github.com/hartwigmedical/pipeline5/commit/5aff0816ca4e326f7e021876eda7ef7c6119b104", "message": "DEV-1547 Add ability to override the reference genome", "committedDate": "2020-10-06T19:50:56Z", "type": "commit"}, {"oid": "e830516989b6e36f339893e19563a17f21ccaa09", "url": "https://github.com/hartwigmedical/pipeline5/commit/e830516989b6e36f339893e19563a17f21ccaa09", "message": "DEV-1547 Run from bam files specified in JSON and allow overriding of ref genome\n\nBam support is added via the JSON datamodel, with an optional path. If the path is there, lanes\nare ignored and the BwaAligner just returns the location of the bam to subsequent stages.\n\nOverriding the ref genome is done with a new argument (this will be a bit more convenient in\nplatinum, as including it the JSON will mean a lot of duplication). If the argument is present,\nthe resource files are decorated and a special command is added to the bash script to download\nthe genome to the normal resources directory.", "committedDate": "2020-10-07T20:25:15Z", "type": "commit"}, {"oid": "ccdebead16574a3d84ffbb06511f3f0d2e9c1716", "url": "https://github.com/hartwigmedical/pipeline5/commit/ccdebead16574a3d84ffbb06511f3f0d2e9c1716", "message": "DEV-1547 Fix typo in decorator and merge master", "committedDate": "2020-10-08T14:35:58Z", "type": "commit"}, {"oid": "cf60b4fe5a34a87f46a6022780f71d702e65e15e", "url": "https://github.com/hartwigmedical/pipeline5/commit/cf60b4fe5a34a87f46a6022780f71d702e65e15e", "message": "DEV-1547 Fix failing test", "committedDate": "2020-10-08T15:08:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTg2NTg0Mw==", "url": "https://github.com/hartwigmedical/pipeline5/pull/209#discussion_r501865843", "bodyText": "I'd prefer to see this as a String.format() call", "author": "nedleitch", "createdAt": "2020-10-08T16:48:05Z", "path": "cluster/src/main/java/com/hartwig/pipeline/resource/OverrideReferenceGenomeCommand.java", "diffHunk": "@@ -0,0 +1,23 @@\n+package com.hartwig.pipeline.resource;\n+\n+import java.util.Collections;\n+import java.util.List;\n+\n+import com.hartwig.pipeline.Arguments;\n+import com.hartwig.pipeline.execution.vm.BashCommand;\n+import com.hartwig.pipeline.execution.vm.unix.MkDirCommand;\n+\n+public class OverrideReferenceGenomeCommand {\n+\n+    static final String RESOURCES_OVERRIDE = \"/opt/resources/\" + ResourceNames.REFERENCE_GENOME + \"/override\";\n+\n+    public static List<BashCommand> overrides(final Arguments arguments) {\n+        return arguments.refGenomeUrl()\n+                .map(p -> List.of(new MkDirCommand(RESOURCES_OVERRIDE), copyDownReferenceGenome(p)))\n+                .orElse(Collections.emptyList());\n+    }\n+\n+    private static BashCommand copyDownReferenceGenome(final String p) {\n+        return () -> \"gsutil -qm cp -n \" + p.substring(0, p.lastIndexOf('.')) + \"* \" + RESOURCES_OVERRIDE;", "originalCommit": "cf60b4fe5a34a87f46a6022780f71d702e65e15e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "d153fb41b69afef7790e7051ccbbe21d95bd8806", "url": "https://github.com/hartwigmedical/pipeline5/commit/d153fb41b69afef7790e7051ccbbe21d95bd8806", "message": "DEV-1547 Review comments", "committedDate": "2020-10-08T17:47:37Z", "type": "commit"}]}