{"pr_number": 3897, "pr_title": "chore(expression-language): improve variable resolving for expression evaluation", "pr_createdAt": "2020-02-21T12:58:00Z", "pr_url": "https://github.com/camunda-cloud/zeebe/pull/3897", "timeline": [{"oid": "acc02e49e3da06e2477271abe5f3dcd786ec6d3d", "url": "https://github.com/camunda-cloud/zeebe/commit/acc02e49e3da06e2477271abe5f3dcd786ec6d3d", "message": "chore(expression-language): pass variables as context\n\n* pass a context for evaluating an expression instead of all variables to only read the required variables\n* replace Jackson MessagePack object mapper by manual transformation using Zeebe's MessagePack reader/writer to reduce overhead", "committedDate": "2020-02-21T12:54:41Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzcxMzE3Mw==", "url": "https://github.com/camunda-cloud/zeebe/pull/3897#discussion_r383713173", "bodyText": "Please add missing params to doc.", "author": "deepthidevaki", "createdAt": "2020-02-25T08:07:36Z", "path": "engine/src/main/java/io/zeebe/engine/state/instance/VariablesState.java", "diffHunk": "@@ -221,6 +221,44 @@ private VariableInstance getVariableLocal(\n     return variablesColumnFamily.get(scopeKeyVariableNameKey);\n   }\n \n+  /**\n+   * Find the variable with the given name. If the variable is not present in the given scope then\n+   * it looks in the parent scope and continues until it is found.\n+   *\n+   * @param scopeKey the key of the variable scope to start from\n+   * @param name the name of the variable\n+   * @return the value of the variable, or {@code null} if it is not present in the variable scope\n+   */\n+  public DirectBuffer getVariable(final long scopeKey, final DirectBuffer name) {\n+    return getVariable(scopeKey, name, 0, name.capacity());\n+  }\n+\n+  /**\n+   * Find the variable with the given name. If the variable is not present in the given scope then\n+   * it looks in the parent scope and continues until it is found.\n+   *\n+   * @param scopeKey the key of the variable scope to start from\n+   * @param name the name of the variable\n+   * @return the value of the variable, or {@code null} if it is not present in the variable scope", "originalCommit": "fc0bab37e007d2c59624263a1727e55960bfaf1d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzczMDQyOQ==", "url": "https://github.com/camunda-cloud/zeebe/pull/3897#discussion_r383730429", "bodyText": "Do we need a new logger here? Also it is not used.", "author": "deepthidevaki", "createdAt": "2020-02-25T08:44:42Z", "path": "expression-language/src/main/java/io/zeebe/el/impl/Loggers.java", "diffHunk": "@@ -0,0 +1,15 @@\n+/*\n+ * Copyright Camunda Services GmbH and/or licensed to Camunda Services GmbH under\n+ * one or more contributor license agreements. See the NOTICE file distributed\n+ * with this work for additional information regarding copyright ownership.\n+ * Licensed under the Zeebe Community License 1.0. You may not use this file\n+ * except in compliance with the Zeebe Community License 1.0.\n+ */\n+package io.zeebe.el.impl;\n+\n+import io.zeebe.util.ZbLogger;\n+import org.slf4j.Logger;\n+\n+public final class Loggers {\n+  public static final Logger LOGGER = new ZbLogger(\"io.zeebe.expression-language\");", "originalCommit": "fc0bab37e007d2c59624263a1727e55960bfaf1d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDQ0OTQ1MQ==", "url": "https://github.com/camunda-cloud/zeebe/pull/3897#discussion_r384449451", "bodyText": "The logger is used in FeelToMessagePackTransformer.scala and MessagePackValueMapper.scala.\nCurrently, we create a class like this if we need a logger in a new module. We could also think about having all loggers defined in the util module.", "author": "saig0", "createdAt": "2020-02-26T12:02:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzczMDQyOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzc0MDU0Ng==", "url": "https://github.com/camunda-cloud/zeebe/pull/3897#discussion_r383740546", "bodyText": "Is there a reason why this class was moved from java to scala?", "author": "deepthidevaki", "createdAt": "2020-02-25T09:04:22Z", "path": "expression-language/src/main/scala/io/zeebe/el/impl/feel/FeelEvaluationResult.scala", "diffHunk": "@@ -0,0 +1,54 @@\n+/**\n+ * Copyright Camunda Services GmbH and/or licensed to Camunda Services GmbH under\n+ * one or more contributor license agreements. See the NOTICE file distributed\n+ * with this work for additional information regarding copyright ownership.\n+ * Licensed under the Zeebe Community License 1.0. You may not use this file\n+ * except in compliance with the Zeebe Community License 1.0.\n+ */\n+package io.zeebe.el.impl.feel\n+\n+import java.lang\n+\n+import io.zeebe.el.{EvaluationResult, Expression, ResultType}\n+import org.agrona.DirectBuffer\n+import org.camunda.feel.interpreter.{Val, ValBoolean, ValContext, ValList, ValNull, ValNumber, ValString}\n+\n+class FeelEvaluationResult(", "originalCommit": "fc0bab37e007d2c59624263a1727e55960bfaf1d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDQ1MDMzNA==", "url": "https://github.com/camunda-cloud/zeebe/pull/3897#discussion_r384450334", "bodyText": "Yes. Because it uses Scala types it was easier to write it in Scala than Java.", "author": "saig0", "createdAt": "2020-02-26T12:04:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzc0MDU0Ng=="}], "type": "inlineReview"}, {"oid": "e01151fb322523cc75de75da09d4fb680c2c61e4", "url": "https://github.com/camunda-cloud/zeebe/commit/e01151fb322523cc75de75da09d4fb680c2c61e4", "message": "chore(expression-language): pass variables as context\n\n* pass a context for evaluating an expression instead of all variables to only read the required variables\n* replace Jackson MessagePack object mapper by manual transformation using Zeebe's MessagePack reader/writer to reduce overhead\n* allow multi-line expressions\n* ignore Spotbugs for Scala classes", "committedDate": "2020-03-05T08:46:07Z", "type": "commit"}, {"oid": "e01151fb322523cc75de75da09d4fb680c2c61e4", "url": "https://github.com/camunda-cloud/zeebe/commit/e01151fb322523cc75de75da09d4fb680c2c61e4", "message": "chore(expression-language): pass variables as context\n\n* pass a context for evaluating an expression instead of all variables to only read the required variables\n* replace Jackson MessagePack object mapper by manual transformation using Zeebe's MessagePack reader/writer to reduce overhead\n* allow multi-line expressions\n* ignore Spotbugs for Scala classes", "committedDate": "2020-03-05T08:46:07Z", "type": "forcePushed"}]}