{"pr_number": 5190, "pr_title": "Elasticsearch exporter: limit the memory size of a bulk ", "pr_createdAt": "2020-08-18T09:33:50Z", "pr_url": "https://github.com/camunda-cloud/zeebe/pull/5190", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjEzNTI3OQ==", "url": "https://github.com/camunda-cloud/zeebe/pull/5190#discussion_r472135279", "bodyText": "is\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              2. when the batch memory size is below 10 MB\n          \n          \n            \n              2. when the batch memory size exceeds 10 MB", "author": "pihme", "createdAt": "2020-08-18T12:21:14Z", "path": "exporters/elasticsearch-exporter/README.md", "diffHunk": "@@ -38,24 +38,27 @@ it should be flushed (regardless of size) can be controlled by configuration.\n For example:\n \n ```yaml\n-...  \n+...\n   exporters:\n     elasticsearch:\n       args:\n         delay: 5\n         size: 1000\n+        memoryLimit: 10485760\n ```\n \n With the above example, the exporter would aggregate records and flush them to Elasticsearch\n either:\n   1. when it has aggregated 1000 records\n-  2. 5 seconds have elapsed since the last flush (regardless of how many records were aggregated)\n+  2. when the batch memory size is below 10 MB", "originalCommit": "2bb72f70cee77050f97b38c91254a237a8ac1c30", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjE0MDYzNw==", "url": "https://github.com/camunda-cloud/zeebe/pull/5190#discussion_r472140637", "bodyText": "(Optional) Maybe also add a lower boundary; in case someone enters 10 in the configuration thinking it will be 10 MB", "author": "pihme", "createdAt": "2020-08-18T12:30:38Z", "path": "exporters/elasticsearch-exporter/src/main/java/io/zeebe/exporter/ElasticsearchExporter.java", "diffHunk": "@@ -92,6 +95,12 @@ private void validate(final ElasticsearchExporterConfiguration configuration) {\n               \"Elasticsearch prefix must not contain underscore. Current value: %s\",\n               configuration.index.prefix));\n     }\n+\n+    if (configuration.bulk.memoryLimit > RECOMMENDED_MAX_BULK_MEMORY_LIMIT) {", "originalCommit": "2bb72f70cee77050f97b38c91254a237a8ac1c30", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjY2MzEyNQ==", "url": "https://github.com/camunda-cloud/zeebe/pull/5190#discussion_r472663125", "bodyText": "That would be an option \ud83d\udc4d  But I think it is not necessary because a lower value doesn't break anything. It is also documented and has the default value in the templates.", "author": "saig0", "createdAt": "2020-08-19T04:05:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjE0MDYzNw=="}], "type": "inlineReview"}, {"oid": "d158c91af824140b65d0179a22476d7db07702a4", "url": "https://github.com/camunda-cloud/zeebe/commit/d158c91af824140b65d0179a22476d7db07702a4", "message": "fix(exporters/elasticsearch-exporter): limit the memory size of a bulk\n\n* new configuration to limit the memory size of the bulk before flushing it, default is 10 MB\n* new metric for the bulk memory size\n* adjust documentation and configuration templates", "committedDate": "2020-08-19T04:15:20Z", "type": "commit"}, {"oid": "d158c91af824140b65d0179a22476d7db07702a4", "url": "https://github.com/camunda-cloud/zeebe/commit/d158c91af824140b65d0179a22476d7db07702a4", "message": "fix(exporters/elasticsearch-exporter): limit the memory size of a bulk\n\n* new configuration to limit the memory size of the bulk before flushing it, default is 10 MB\n* new metric for the bulk memory size\n* adjust documentation and configuration templates", "committedDate": "2020-08-19T04:15:20Z", "type": "forcePushed"}]}