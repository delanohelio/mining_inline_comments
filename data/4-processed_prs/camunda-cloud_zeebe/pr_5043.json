{"pr_number": 5043, "pr_title": "chore(ci): add test coverage report", "pr_createdAt": "2020-07-23T16:26:15Z", "pr_url": "https://github.com/camunda-cloud/zeebe/pull/5043", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDc5NTIyOA==", "url": "https://github.com/camunda-cloud/zeebe/pull/5043#discussion_r460795228", "bodyText": "Why are we not excluding all generated code, but only some generated code (e.g. all SBE *Encoder.class)?", "author": "npepinpe", "createdAt": "2020-07-27T10:27:29Z", "path": "Jenkinsfile", "diffHunk": "@@ -200,8 +200,20 @@ pipeline {\n             }\n \n             post {\n+                always {\n+                    jacoco(\n+                          execPattern: '**/*.exec',\n+                          classPattern: '**/target/classes',\n+                          sourcePattern: '**/src/main/java,**/generated-sources/protobuf/java,**/generated-sources/assertj-assertions,**/generated-sources/sbe',\n+                          exclusionPattern: '**/io/zeebe/gateway/protocol/**,'", "originalCommit": "73f2cd4ff97129c2f522cc315306bc79f652b2ec", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDgxNzgxMw==", "url": "https://github.com/camunda-cloud/zeebe/pull/5043#discussion_r460817813", "bodyText": "This is not as easy as it looks. Basically the exclusions are based on file patterns in the classes folder, not the source folders. The source folders are easy to spot, but then all classes get lumped in together.\nExclusion by packages also doesn't work, because the generated code shares packages with actual code. I had several iterations and this was what covered like 90% of generated code.", "author": "pihme", "createdAt": "2020-07-27T11:14:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDc5NTIyOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDk3NDcwNQ==", "url": "https://github.com/camunda-cloud/zeebe/pull/5043#discussion_r464974705", "bodyText": "Oh, that's disappointing, I would've expected we could just ignore specific source folders =/ Let's start with that then and if it's an issue we can look into more complex solutions", "author": "npepinpe", "createdAt": "2020-08-04T11:12:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDc5NTIyOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDc5NTQ2Mg==", "url": "https://github.com/camunda-cloud/zeebe/pull/5043#discussion_r460795462", "bodyText": "I guess this is unintended to be in this PR?", "author": "npepinpe", "createdAt": "2020-07-27T10:27:56Z", "path": "transport/src/test/java/io/zeebe/transport/impl/AtomixTransportTest.java", "diffHunk": "@@ -182,7 +182,7 @@ public void shouldRetryOnInvalidResponse() throws Exception {\n         nodeAddressSupplier, (response) -> false, new Request(\"messageABC\"), Duration.ofSeconds(3));\n \n     // then\n-    final var success = retryLatch.await(1, TimeUnit.SECONDS);\n+    final var success = retryLatch.await(2, TimeUnit.SECONDS);", "originalCommit": "73f2cd4ff97129c2f522cc315306bc79f652b2ec", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDgxODA4MQ==", "url": "https://github.com/camunda-cloud/zeebe/pull/5043#discussion_r460818081", "bodyText": "This is intentional. After activating test coverage, this test failed much more often than before.", "author": "pihme", "createdAt": "2020-07-27T11:15:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDc5NTQ2Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDc5NTQ5NQ==", "url": "https://github.com/camunda-cloud/zeebe/pull/5043#discussion_r460795495", "bodyText": "I guess this is unintended to be in this PR?", "author": "npepinpe", "createdAt": "2020-07-27T10:28:01Z", "path": "upgrade-tests/src/test/java/io/zeebe/test/RollingUpdateTest.java", "diffHunk": "@@ -199,7 +199,7 @@ private void deployProcess(final ZeebeClient client) {\n         .newDeployCommand()\n         .addWorkflowModel(PROCESS, \"process.bpmn\")\n         .send()\n-        .join(5, TimeUnit.SECONDS);\n+        .join(10, TimeUnit.SECONDS);", "originalCommit": "73f2cd4ff97129c2f522cc315306bc79f652b2ec", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDgxODExOQ==", "url": "https://github.com/camunda-cloud/zeebe/pull/5043#discussion_r460818119", "bodyText": "This is intentional. After activating test coverage, this test failed much more often than before.", "author": "pihme", "createdAt": "2020-07-27T11:15:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDc5NTQ5NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDk3NTA0NA==", "url": "https://github.com/camunda-cloud/zeebe/pull/5043#discussion_r464975044", "bodyText": "Really? It slows down the overall build that much?", "author": "npepinpe", "createdAt": "2020-08-04T11:12:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDc5NTQ5NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDk3NzQ3Mg==", "url": "https://github.com/camunda-cloud/zeebe/pull/5043#discussion_r464977472", "bodyText": "No, I just doubled it to be on the safe side", "author": "pihme", "createdAt": "2020-08-04T11:17:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDc5NTQ5NQ=="}], "type": "inlineReview"}, {"oid": "9f6be5b9c79402abd98df3d9b995236c6b147ce3", "url": "https://github.com/camunda-cloud/zeebe/commit/9f6be5b9c79402abd98df3d9b995236c6b147ce3", "message": "chore(ci): add test coverage report", "committedDate": "2020-08-03T09:27:20Z", "type": "commit"}, {"oid": "9f6be5b9c79402abd98df3d9b995236c6b147ce3", "url": "https://github.com/camunda-cloud/zeebe/commit/9f6be5b9c79402abd98df3d9b995236c6b147ce3", "message": "chore(ci): add test coverage report", "committedDate": "2020-08-03T09:27:20Z", "type": "forcePushed"}]}