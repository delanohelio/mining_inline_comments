{"pr_number": 3735, "pr_title": "Refactor gateway version command", "pr_createdAt": "2020-01-24T12:16:55Z", "pr_url": "https://github.com/camunda-cloud/zeebe/pull/3735", "timeline": [{"oid": "ff84d166c403724b29ddac669278a485fd2804ee", "url": "https://github.com/camunda-cloud/zeebe/commit/ff84d166c403724b29ddac669278a485fd2804ee", "message": "chore(clients/go): include gatewayVersion in topology cmd", "committedDate": "2020-01-24T12:58:59Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDkyMTg3MA==", "url": "https://github.com/camunda-cloud/zeebe/pull/3735#discussion_r370921870", "bodyText": "Can't we assert the correct version?", "author": "npepinpe", "createdAt": "2020-01-25T08:33:43Z", "path": "qa/integration-tests/src/test/java/io/zeebe/broker/it/clustering/topology/TopologyClusterTest.java", "diffHunk": "@@ -85,5 +85,6 @@ public void shouldExposeClusterSettings() {\n     assertThat(topology.getClusterSize()).isEqualTo(CLUSTERING_RULE.getClusterSize());\n     assertThat(topology.getPartitionsCount()).isEqualTo(CLUSTERING_RULE.getPartitionCount());\n     assertThat(topology.getReplicationFactor()).isEqualTo(CLUSTERING_RULE.getReplicationFactor());\n+    assertThat(topology.getGatewayVersion()).isNotBlank();", "originalCommit": "ff84d166c403724b29ddac669278a485fd2804ee", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTEzMDE4Ng==", "url": "https://github.com/camunda-cloud/zeebe/pull/3735#discussion_r371130186", "bodyText": "It's null when we get it in the test", "author": "MiguelPires", "createdAt": "2020-01-27T09:20:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDkyMTg3MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTEzNzU3NA==", "url": "https://github.com/camunda-cloud/zeebe/pull/3735#discussion_r371137574", "bodyText": "Hm, not very helpful to test I guess \ud83d\ude05 Is that always or just when running them from the IDE? I think the maven tests should run with the JAR itself, no? \ud83e\udd14", "author": "npepinpe", "createdAt": "2020-01-27T09:37:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDkyMTg3MA=="}], "type": "inlineReview"}, {"oid": "ff84d166c403724b29ddac669278a485fd2804ee", "url": "https://github.com/camunda-cloud/zeebe/commit/ff84d166c403724b29ddac669278a485fd2804ee", "message": "chore(clients/go): include gatewayVersion in topology cmd", "committedDate": "2020-01-24T12:58:59Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTExODUwOA==", "url": "https://github.com/camunda-cloud/zeebe/pull/3735#discussion_r371118508", "bodyText": "Any reason why we don't test the value here?", "author": "npepinpe", "createdAt": "2020-01-27T08:53:49Z", "path": "clients/go/test/integration_test.go", "diffHunk": "@@ -72,6 +71,7 @@ func (s *integrationTestSuite) TestTopology() {\n \ts.EqualValues(1, response.GetClusterSize())\n \ts.EqualValues(1, response.GetPartitionsCount())\n \ts.EqualValues(1, response.GetReplicationFactor())\n+\ts.NotEmpty(response.GetGatewayVersion())", "originalCommit": "ff84d166c403724b29ddac669278a485fd2804ee", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTEyOTAwNg==", "url": "https://github.com/camunda-cloud/zeebe/pull/3735#discussion_r371129006", "bodyText": "Is there a reasonably easy way to find out what it is?", "author": "MiguelPires", "createdAt": "2020-01-27T09:18:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTExODUwOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTEzNTUyNw==", "url": "https://github.com/camunda-cloud/zeebe/pull/3735#discussion_r371135527", "bodyText": "Hm, you mean we don't know what's the current version for this build? For release builds we have an env variable but I guess for normal builds we have nothing...Probably fine for now then.", "author": "npepinpe", "createdAt": "2020-01-27T09:32:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTExODUwOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTEyMzgzMw==", "url": "https://github.com/camunda-cloud/zeebe/pull/3735#discussion_r371123833", "bodyText": "just a nit pick, feel free to ignore, afaik if the version is blank is that that's what we set when we built the JAR, so not sure if it's all that important to check it here.", "author": "npepinpe", "createdAt": "2020-01-27T09:06:32Z", "path": "gateway/src/main/java/io/zeebe/gateway/EndpointManager.java", "diffHunk": "@@ -251,6 +249,11 @@ public void topology(\n           .setPartitionsCount(topology.getPartitionsCount())\n           .setReplicationFactor(topology.getReplicationFactor());\n \n+      final String gatewayVersion = getClass().getPackage().getImplementationVersion();", "originalCommit": "ff84d166c403724b29ddac669278a485fd2804ee", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTEyODQxMA==", "url": "https://github.com/camunda-cloud/zeebe/pull/3735#discussion_r371128410", "bodyText": "If we set the version to null, it will throw an NPE. I agree that if it's an empty string it's not serious since the clients already check and deal with that. But I thought it'd be better to include this since this way the clients don't have to deal with random whitespace, since the version will be either something or an empty string", "author": "MiguelPires", "createdAt": "2020-01-27T09:16:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTEyMzgzMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTEzNjE4MA==", "url": "https://github.com/camunda-cloud/zeebe/pull/3735#discussion_r371136180", "bodyText": "Fair enough", "author": "npepinpe", "createdAt": "2020-01-27T09:33:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTEyMzgzMw=="}], "type": "inlineReview"}, {"oid": "ff84d166c403724b29ddac669278a485fd2804ee", "url": "https://github.com/camunda-cloud/zeebe/commit/ff84d166c403724b29ddac669278a485fd2804ee", "message": "chore(clients/go): include gatewayVersion in topology cmd", "committedDate": "2020-01-24T12:58:59Z", "type": "forcePushed"}, {"oid": "bd584f26409504624e41fedd151d5c305a0bb9a4", "url": "https://github.com/camunda-cloud/zeebe/commit/bd584f26409504624e41fedd151d5c305a0bb9a4", "message": "chore(gateway): move gatewayVersion into topology RPC", "committedDate": "2020-01-27T10:34:26Z", "type": "commit"}, {"oid": "9e7c77af4059fbcab883ec17b23ce1c5140cede8", "url": "https://github.com/camunda-cloud/zeebe/commit/9e7c77af4059fbcab883ec17b23ce1c5140cede8", "message": "chore(clients/java): include gatewayVersion in topology cmd", "committedDate": "2020-01-27T10:34:26Z", "type": "commit"}, {"oid": "6fa432f818540e6b25509d85c97bf48c67323cb2", "url": "https://github.com/camunda-cloud/zeebe/commit/6fa432f818540e6b25509d85c97bf48c67323cb2", "message": "chore(clients/go): include gatewayVersion in topology cmd", "committedDate": "2020-01-27T10:34:26Z", "type": "commit"}, {"oid": "6fa432f818540e6b25509d85c97bf48c67323cb2", "url": "https://github.com/camunda-cloud/zeebe/commit/6fa432f818540e6b25509d85c97bf48c67323cb2", "message": "chore(clients/go): include gatewayVersion in topology cmd", "committedDate": "2020-01-27T10:34:26Z", "type": "forcePushed"}]}