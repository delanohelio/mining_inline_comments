{"pr_number": 5794, "pr_title": "Lower log level of broker errors in the gateway based on the error code", "pr_createdAt": "2020-11-09T11:23:21Z", "pr_url": "https://github.com/camunda-cloud/zeebe/pull/5794", "timeline": [{"oid": "f1f0bcaa168784274efcde20c83fde86fe7f2f05", "url": "https://github.com/camunda-cloud/zeebe/commit/f1f0bcaa168784274efcde20c83fde86fe7f2f05", "message": "chore(gateway): lower log level based on broker error code", "committedDate": "2020-11-09T13:43:25Z", "type": "commit"}, {"oid": "f1f0bcaa168784274efcde20c83fde86fe7f2f05", "url": "https://github.com/camunda-cloud/zeebe/commit/f1f0bcaa168784274efcde20c83fde86fe7f2f05", "message": "chore(gateway): lower log level based on broker error code", "committedDate": "2020-11-09T13:43:25Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTgyMzk4Nw==", "url": "https://github.com/camunda-cloud/zeebe/pull/5794#discussion_r519823987", "bodyText": "One thing: I thought about setting it to debug, since it may be useful sometimes to know if we have leader mismatch - however you can see that via metrics, and here, well, we don't have request context info so I'm not sure it gives any more insight.", "author": "npepinpe", "createdAt": "2020-11-09T13:44:41Z", "path": "gateway/src/main/java/io/zeebe/gateway/grpc/GrpcErrorMapper.java", "diffHunk": "@@ -113,22 +105,20 @@ private Status mapBrokerErrorToStatus(final BrokerError error) {\n         break;\n       case RESOURCE_EXHAUSTED:\n         builder.setCode(Code.RESOURCE_EXHAUSTED_VALUE);\n+        logger.trace(\"Target broker is currently overloaded: {}\", error);\n         break;\n       case PARTITION_LEADER_MISMATCH:\n         // return UNAVAILABLE to indicate to the user that retrying might solve the issue, as this\n         // is usually a transient issue\n+        logger.trace(\"Target broker was not the leader of the partition: {}\", error);", "originalCommit": "f1f0bcaa168784274efcde20c83fde86fe7f2f05", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTgyNDU1OA==", "url": "https://github.com/camunda-cloud/zeebe/pull/5794#discussion_r519824558", "bodyText": "Normally I'd prefer having all cases, but in this case the non default cases are more the exceptions where we want different behaviour, so I think it makes sense to remove all explicit cases.", "author": "npepinpe", "createdAt": "2020-11-09T13:45:30Z", "path": "gateway/src/main/java/io/zeebe/gateway/grpc/GrpcErrorMapper.java", "diffHunk": "@@ -113,22 +105,20 @@ private Status mapBrokerErrorToStatus(final BrokerError error) {\n         break;\n       case RESOURCE_EXHAUSTED:\n         builder.setCode(Code.RESOURCE_EXHAUSTED_VALUE);\n+        logger.trace(\"Target broker is currently overloaded: {}\", error);\n         break;\n       case PARTITION_LEADER_MISMATCH:\n         // return UNAVAILABLE to indicate to the user that retrying might solve the issue, as this\n         // is usually a transient issue\n+        logger.trace(\"Target broker was not the leader of the partition: {}\", error);\n         builder.setCode(Code.UNAVAILABLE_VALUE);\n         break;\n-        // all the following are not errors which retrying (with the same gateway) will solve\n-      case INVALID_MESSAGE_TEMPLATE:", "originalCommit": "f1f0bcaa168784274efcde20c83fde86fe7f2f05", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}