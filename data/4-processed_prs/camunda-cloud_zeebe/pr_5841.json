{"pr_number": 5841, "pr_title": "Move usage of maven plugins to profiles", "pr_createdAt": "2020-11-13T12:33:01Z", "pr_url": "https://github.com/camunda-cloud/zeebe/pull/5841", "timeline": [{"oid": "f49a867a47fdf7f99fd06f72494979f40b9ea031", "url": "https://github.com/camunda-cloud/zeebe/commit/f49a867a47fdf7f99fd06f72494979f40b9ea031", "message": "chore(mvn): move go-offline to profile\n\nVersion management of the maven-dependency-plugin should be handled in\nthe version management of our pom. Therefore, we should not explicitly\ncall the action from outside but use a profile. In the case of the\ngo-offline mojo, this profile actually already existed, but was not yet\nutilised to execute the plugin's mojo.", "committedDate": "2020-11-13T10:06:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjkyMjMwMg==", "url": "https://github.com/camunda-cloud/zeebe/pull/5841#discussion_r522922302", "bodyText": "This id is necessary to be able to refer to the same execution when disabling it on jdk 8 or lower.", "author": "korthout", "createdAt": "2020-11-13T12:34:28Z", "path": "parent/pom.xml", "diffHunk": "@@ -1076,6 +1076,8 @@\n           <version>${plugin.version.fmt}</version>\n           <executions>\n             <execution>\n+              <id>format</id>", "originalCommit": "3f79d2c80e16f030cb858eb618d02d6c0d2e97ee", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "cab0ab6fb02f757f3e7f74a2ff77dcbc86a20770", "url": "https://github.com/camunda-cloud/zeebe/commit/cab0ab6fb02f757f3e7f74a2ff77dcbc86a20770", "message": "chore(pom): update fmt-plugin to 2.10", "committedDate": "2020-11-13T12:35:53Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjkyMzMyNw==", "url": "https://github.com/camunda-cloud/zeebe/pull/5841#discussion_r522923327", "bodyText": "This execution makes sure that we actually \"go-offline\" when the profile is activated", "author": "korthout", "createdAt": "2020-11-13T12:36:32Z", "path": "parent/pom.xml", "diffHunk": "@@ -1428,6 +1430,13 @@\n             <groupId>org.apache.maven.plugins</groupId>\n             <artifactId>maven-dependency-plugin</artifactId>\n             <executions>\n+              <execution>\n+                <id>go-offline</id>\n+                <phase>initialize</phase>\n+                <goals>\n+                  <goal>go-offline</goal>\n+                </goals>\n+              </execution>", "originalCommit": "cab0ab6fb02f757f3e7f74a2ff77dcbc86a20770", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjkyMzQ4NQ==", "url": "https://github.com/camunda-cloud/zeebe/pull/5841#discussion_r522923485", "bodyText": "This change is due to the new fmt-plugin v 2.10", "author": "korthout", "createdAt": "2020-11-13T12:36:54Z", "path": "qa/integration-tests/src/test/java/io/zeebe/broker/it/clustering/ClusteringRule.java", "diffHunk": "@@ -552,7 +552,10 @@ public void stepDown(final Broker broker, final int partitionId) {\n     final MemberId nodeId = atomix.getMembershipService().getLocalMember().id();\n \n     final var raftPartition =\n-        atomix.getPartitionService().getPartitionGroup(AtomixFactory.GROUP_NAME).getPartitions()\n+        atomix\n+            .getPartitionService()\n+            .getPartitionGroup(AtomixFactory.GROUP_NAME)\n+            .getPartitions()", "originalCommit": "cab0ab6fb02f757f3e7f74a2ff77dcbc86a20770", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDIwNDczMQ==", "url": "https://github.com/camunda-cloud/zeebe/pull/5841#discussion_r524204731", "bodyText": "Nit: I'd argue it's to enable formatting on jdks 9 and above \ud83d\ude05", "author": "npepinpe", "createdAt": "2020-11-16T12:15:24Z", "path": "parent/pom.xml", "diffHunk": "@@ -1482,5 +1491,66 @@\n         </plugins>\n       </build>\n     </profile>\n+\n+    <!-- profile to disable the fmt-plugin on older jdks -->", "originalCommit": "cab0ab6fb02f757f3e7f74a2ff77dcbc86a20770", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDI1MDc2MQ==", "url": "https://github.com/camunda-cloud/zeebe/pull/5841#discussion_r524250761", "bodyText": "No, it's to enable formatting using v 2.10+, which is incompatible with jdks < 9. so we disable the plugin: <phase>none</phase>\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                <!-- profile to disable the fmt-plugin on older jdks -->\n          \n          \n            \n                <!-- profile to disable the fmt-plugin on unsupported jdks -->", "author": "korthout", "createdAt": "2020-11-16T13:01:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDIwNDczMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDI1MTE0Nw==", "url": "https://github.com/camunda-cloud/zeebe/pull/5841#discussion_r524251147", "bodyText": "True, I totally misread that \ud83d\ude05", "author": "npepinpe", "createdAt": "2020-11-16T13:02:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDIwNDczMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDIwNTI2MA==", "url": "https://github.com/camunda-cloud/zeebe/pull/5841#discussion_r524205260", "bodyText": "Nit: can you explain why checkstyle is not a validation check? Here I'm mostly confused by the comment, not by the profile, if that makes sense.", "author": "npepinpe", "createdAt": "2020-11-16T12:15:52Z", "path": "parent/pom.xml", "diffHunk": "@@ -1482,5 +1491,66 @@\n         </plugins>\n       </build>\n     </profile>\n+\n+    <!-- profile to disable the fmt-plugin on older jdks -->\n+    <profile>\n+      <id>fmt-plugin</id>\n+      <activation>\n+        <jdk>[,9)</jdk>\n+      </activation>\n+      <build>\n+        <plugins>\n+          <plugin>\n+            <artifactId>fmt-maven-plugin</artifactId>\n+            <groupId>com.coveo</groupId>\n+            <executions>\n+              <execution>\n+                <id>format</id>\n+                <phase>none</phase>\n+                <goals>\n+                  <goal>check</goal>\n+                  <goal>format</goal>\n+                </goals>\n+              </execution>\n+            </executions>\n+          </plugin>\n+        </plugins>\n+      </build>\n+    </profile>\n+\n+    <!-- profile to perform validation checks -->", "originalCommit": "cab0ab6fb02f757f3e7f74a2ff77dcbc86a20770", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDI0ODgzNA==", "url": "https://github.com/camunda-cloud/zeebe/pull/5841#discussion_r524248834", "bodyText": "The checkstyle validation, the license format and the googlestyle (fmt) format are all executed by default (i.e. without activating a profile). These format steps make sense to execute locally (by default), but in the ci pipeline you don't want to make changes to the code anymore, so the stricter check is used instead with this new checks profile.\nNow, if the checkstyle plugin would offer a quickfix/format goal, it would make sense to move the checkstyle check goal into the checks profile. Sadly, it doesn't.\nSo to me, the difference is that these checks are stricter than the default execution.\nTo reflect this, I could change the comment to something like:\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                <!-- profile to perform validation checks -->\n          \n          \n            \n                <!-- profile to perform strict validation checks -->\n          \n      \n    \n    \n  \n\nor we could rename it altogether to strict-checks or so. WDYT?", "author": "korthout", "createdAt": "2020-11-16T12:58:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDIwNTI2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDI1MTM4OA==", "url": "https://github.com/camunda-cloud/zeebe/pull/5841#discussion_r524251388", "bodyText": "Sounds good \ud83d\udc4d", "author": "npepinpe", "createdAt": "2020-11-16T13:02:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDIwNTI2MA=="}], "type": "inlineReview"}, {"oid": "a0b1be2d221c40eabc6d5cfc814d911e9095626c", "url": "https://github.com/camunda-cloud/zeebe/commit/a0b1be2d221c40eabc6d5cfc814d911e9095626c", "message": "chore(build): improve fmt and license checks\n\n- only activate fmt-plugin on jdk9+\n- use profiles to run checks from ci builds\n\nThe latter is necessary to make sure the version from the pom is used,\ninstead of the latest", "committedDate": "2020-11-16T13:05:55Z", "type": "commit"}, {"oid": "bb086565b3b581fd964517c1fb076803399f16ea", "url": "https://github.com/camunda-cloud/zeebe/commit/bb086565b3b581fd964517c1fb076803399f16ea", "message": "chore(pom): update fmt-plugin to 2.10", "committedDate": "2020-11-16T13:05:55Z", "type": "commit"}, {"oid": "bb086565b3b581fd964517c1fb076803399f16ea", "url": "https://github.com/camunda-cloud/zeebe/commit/bb086565b3b581fd964517c1fb076803399f16ea", "message": "chore(pom): update fmt-plugin to 2.10", "committedDate": "2020-11-16T13:05:55Z", "type": "forcePushed"}]}