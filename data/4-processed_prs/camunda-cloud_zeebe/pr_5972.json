{"pr_number": 5972, "pr_title": "fix(clients/go): print activate jobs ouput as valid json", "pr_createdAt": "2020-12-04T20:19:41Z", "pr_url": "https://github.com/camunda-cloud/zeebe/pull/5972", "timeline": [{"oid": "d525cc42aa36687717181071d5372e40efa3fdf2", "url": "https://github.com/camunda-cloud/zeebe/commit/d525cc42aa36687717181071d5372e40efa3fdf2", "message": "fix(clients/go): print activate jobs ouput as valid json", "committedDate": "2020-12-04T20:37:52Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzMwMjQ2OQ==", "url": "https://github.com/camunda-cloud/zeebe/pull/5972#discussion_r537302469", "bodyText": "This isn't obvious to me, can you elaborate? By deploying this means we spend more time in setup, so we don't have to wait for the jobs to be created?", "author": "npepinpe", "createdAt": "2020-12-07T08:06:28Z", "path": "clients/go/cmd/zbctl/main_test.go", "diffHunk": "@@ -95,10 +95,22 @@ var tests = []struct {\n \t\tgoldenFile: \"testdata/create_worker.golden\",\n \t},\n \t{\n-\t\tname:       \"activate job\",\n+\t\tname:       \"empty activate job\",\n+\t\tcmd:        \"--insecure activate jobs jobType --maxJobsToActivate 0\",\n+\t\tgoldenFile: \"testdata/empty_activate_job.golden\",\n+\t},\n+\t{\n+\t\tname:       \"single activate job\",\n \t\tsetupCmds:  []string{\"--insecure deploy testdata/job_model.bpmn\", \"--insecure create instance jobProcess\"},\n-\t\tcmd:        \"--insecure activate jobs jobType\",\n-\t\tgoldenFile: \"testdata/activate_job.golden\",\n+\t\tcmd:        \"--insecure activate jobs jobType --maxJobsToActivate 1\",\n+\t\tgoldenFile: \"testdata/single_activate_job.golden\",\n+\t},\n+\t{\n+\t\tname: \"double activate job\",\n+\t\t// we deploy on the end again to spent more time in setup phase to avoid a race condition, that we can activate more jobs then one", "originalCommit": "d525cc42aa36687717181071d5372e40efa3fdf2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzMwMzgwOA==", "url": "https://github.com/camunda-cloud/zeebe/pull/5972#discussion_r537303808", "bodyText": "If that's correct, then wouldn't setting a longer time out on activate jobs work? Or is that not possible via zbctl?", "author": "npepinpe", "createdAt": "2020-12-07T08:08:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzMwMjQ2OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODc5NTM5MA==", "url": "https://github.com/camunda-cloud/zeebe/pull/5972#discussion_r538795390", "bodyText": "Ok I tried with requestTimeout 30s, but doesn't work. The thing is that only one job exist when the activate command is send (without the second deployment). This job is immediately returned. In general this is fine because this is just the max value we are setting, but in this test we want explicitly 2 because we want to test the output. This is the reason why I added the second deployment to have more time such that the second job is available. Sleep would also be ok but I dont know where to put this, since the tests are highly parameterized.", "author": "Zelldon", "createdAt": "2020-12-08T20:49:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzMwMjQ2OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjM2MzYyMw==", "url": "https://github.com/camunda-cloud/zeebe/pull/5972#discussion_r542363623", "bodyText": "I see what you mean - there's no way for us to wait until both jobs are created before actually activating them. My main worry is this has potential to be flaky, but I wouldn't block this for now.", "author": "npepinpe", "createdAt": "2020-12-14T12:59:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzMwMjQ2OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzMwMjc2NA==", "url": "https://github.com/camunda-cloud/zeebe/pull/5972#discussion_r537302764", "bodyText": "hehe, welcome to the world of go, where all variables are a single letter \ud83d\ude02", "author": "npepinpe", "createdAt": "2020-12-07T08:06:58Z", "path": "clients/go/cmd/zbctl/main_test.go", "diffHunk": "@@ -118,16 +130,16 @@ func TestZbctlWithInsecureGateway(t *testing.T) {\n \t\t})\n }\n \n-func (s *integrationTestSuite) TestCommonCommands() {\n+func (suite *integrationTestSuite) TestCommonCommands() {", "originalCommit": "d525cc42aa36687717181071d5372e40efa3fdf2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzMxODY3NQ==", "url": "https://github.com/camunda-cloud/zeebe/pull/5972#discussion_r537318675", "bodyText": "Oh is this convention?\ud83d\ude48\ud83d\ude05 I hope not \ud83d\ude05", "author": "Zelldon", "createdAt": "2020-12-07T08:34:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzMwMjc2NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzMyMTgwMQ==", "url": "https://github.com/camunda-cloud/zeebe/pull/5972#discussion_r537321801", "bodyText": "https://github.com/golang/go/wiki/CodeReviewComments#variable-names \ud83e\udd37\u200d\u2642\ufe0f I think I made it sound worse than it is, I kind of get the reasoning, but I guess it mostly works if you're disciplined and keep your functions pretty short.", "author": "npepinpe", "createdAt": "2020-12-07T08:39:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzMwMjc2NA=="}], "type": "inlineReview"}, {"oid": "f4032853245dcb9844c5616c79911be82d511ccc", "url": "https://github.com/camunda-cloud/zeebe/commit/f4032853245dcb9844c5616c79911be82d511ccc", "message": "chore(clients/go): bring convention back", "committedDate": "2020-12-10T07:38:52Z", "type": "forcePushed"}, {"oid": "6995d6718f9f5a5de8d733d9143757be2dfb6606", "url": "https://github.com/camunda-cloud/zeebe/commit/6995d6718f9f5a5de8d733d9143757be2dfb6606", "message": "fix(clients/go): print activate jobs ouput as valid json", "committedDate": "2020-12-14T13:00:21Z", "type": "commit"}, {"oid": "6995d6718f9f5a5de8d733d9143757be2dfb6606", "url": "https://github.com/camunda-cloud/zeebe/commit/6995d6718f9f5a5de8d733d9143757be2dfb6606", "message": "fix(clients/go): print activate jobs ouput as valid json", "committedDate": "2020-12-14T13:00:21Z", "type": "forcePushed"}]}