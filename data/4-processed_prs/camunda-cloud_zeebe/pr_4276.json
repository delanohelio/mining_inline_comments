{"pr_number": 4276, "pr_title": "docs(operations): add doc for health checks", "pr_createdAt": "2020-04-08T12:33:43Z", "pr_url": "https://github.com/camunda-cloud/zeebe/pull/4276", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzg1NjY4NQ==", "url": "https://github.com/camunda-cloud/zeebe/pull/4276#discussion_r407856685", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Once it is ready it is always ready.\n          \n          \n            \n            Once it is ready it will never become unready again.\n          \n      \n    \n    \n  \n\nMaybe more like this?", "author": "Zelldon", "createdAt": "2020-04-14T04:16:33Z", "path": "docs/src/operations/health.md", "diffHunk": "@@ -0,0 +1,29 @@\n+# Health Status\n+\n+Zeebe broker exposes two http endpoints to query its health status. \n+* Ready check\n+* Health check\n+ \n+## Ready Check\n+Ready check endpoint is exposed via `http://{zeebe-broker}:{zeebe.broker.network.monitoringApi.port}/ready`.\n+This endpoint return an empty 204 response. If it is not ready, it will return a 503 error.\n+\n+A broker is ready when it has installed all necessary services to start processing in all partitions. \n+Once it is ready it is always ready.", "originalCommit": "fd3b1cad5ade88cf0429463eb7223959e7de38f4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzg1NzUzOQ==", "url": "https://github.com/camunda-cloud/zeebe/pull/4276#discussion_r407857539", "bodyText": "We accept requests already before right? But not for all partitions, maybe we add that the broker will after he is ready he can work on all his partitions, then probably we need to add that ready != leader available", "author": "Zelldon", "createdAt": "2020-04-14T04:19:59Z", "path": "docs/src/operations/health.md", "diffHunk": "@@ -0,0 +1,29 @@\n+# Health Status\n+\n+Zeebe broker exposes two http endpoints to query its health status. \n+* Ready check\n+* Health check\n+ \n+## Ready Check\n+Ready check endpoint is exposed via `http://{zeebe-broker}:{zeebe.broker.network.monitoringApi.port}/ready`.\n+This endpoint return an empty 204 response. If it is not ready, it will return a 503 error.\n+\n+A broker is ready when it has installed all necessary services to start processing in all partitions. \n+Once it is ready it is always ready.\n+\n+A ready check is useful, for example, to use as a `readinessProbe` in a kubernetes configuration to control when a pod can be restarted for rolling upgrade. \n+Depending on the cluster configuration, restarting one pod before the previous one is ready might make the system unavailable because the quorum of replicas is not available.\n+By configuring a `readinessProbe` that uses the ready check endpoint we can inform Kubernetes when it is safe to proceed with rolling update.", "originalCommit": "fd3b1cad5ade88cf0429463eb7223959e7de38f4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODAxMDkwNA==", "url": "https://github.com/camunda-cloud/zeebe/pull/4276#discussion_r408010904", "bodyText": "\ud83d\udc4d I have added that above. Please take a look.", "author": "deepthidevaki", "createdAt": "2020-04-14T09:52:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzg1NzUzOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzg1ODg3OQ==", "url": "https://github.com/camunda-cloud/zeebe/pull/4276#discussion_r407858879", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            A broker is healthy, when it can process workflows, accepts commands, and perform all its expected tasks.\n          \n          \n            \n            If it is unhealthy, then it can mean three things: it is only temporarily unhealthy (e.g. due to environmental circumstances such as temporary I/O issues), it is partially unhealthy, or it is completely dead.\n          \n          \n            \n            Partial failure could mean that one or more partitions is unhealthy, while the rest of them are able to process workflows.\n          \n          \n            \n            A broker is healthy, when it can process workflows, accepts commands, and perform all its expected tasks.\n          \n          \n            \n            If it is unhealthy, then it can mean three things:\n          \n          \n            \n             * **it is only temporarily unhealthy**, e.g. due to environmental circumstances such as temporary I/O issues\n          \n          \n            \n             * **it is partially unhealthy**, could mean that one or more partitions is unhealthy, while the rest of them are able to process workflows\n          \n          \n            \n             * **it is completely dead**", "author": "Zelldon", "createdAt": "2020-04-14T04:25:18Z", "path": "docs/src/operations/health.md", "diffHunk": "@@ -0,0 +1,29 @@\n+# Health Status\n+\n+Zeebe broker exposes two http endpoints to query its health status. \n+* Ready check\n+* Health check\n+ \n+## Ready Check\n+Ready check endpoint is exposed via `http://{zeebe-broker}:{zeebe.broker.network.monitoringApi.port}/ready`.\n+This endpoint return an empty 204 response. If it is not ready, it will return a 503 error.\n+\n+A broker is ready when it has installed all necessary services to start processing in all partitions. \n+Once it is ready it is always ready.\n+\n+A ready check is useful, for example, to use as a `readinessProbe` in a kubernetes configuration to control when a pod can be restarted for rolling upgrade. \n+Depending on the cluster configuration, restarting one pod before the previous one is ready might make the system unavailable because the quorum of replicas is not available.\n+By configuring a `readinessProbe` that uses the ready check endpoint we can inform Kubernetes when it is safe to proceed with rolling update.\n+\n+## Health Check\n+Health check endpoint is exposed via `http://{zeebe-broker}:{zeebe.broker.network.monitoringApi.port}/health`.\n+This endpoint return an empty 204 response if the broker is healthy. If it is not healthy, it will return a 503 error.\n+A broker is never healthy before it is ready. \n+Unlike ready check, a broker can become unhealthy after it is healthy.\n+Hence it gives a better status of a running broker.\n+\n+A broker is healthy, when it can process workflows, accepts commands, and perform all its expected tasks.\n+If it is unhealthy, then it can mean three things: it is only temporarily unhealthy (e.g. due to environmental circumstances such as temporary I/O issues), it is partially unhealthy, or it is completely dead.\n+Partial failure could mean that one or more partitions is unhealthy, while the rest of them are able to process workflows.", "originalCommit": "fd3b1cad5ade88cf0429463eb7223959e7de38f4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzg1OTQ2MA==", "url": "https://github.com/camunda-cloud/zeebe/pull/4276#discussion_r407859460", "bodyText": "Do we have already docs for health metrics?", "author": "Zelldon", "createdAt": "2020-04-14T04:27:35Z", "path": "docs/src/operations/health.md", "diffHunk": "@@ -0,0 +1,29 @@\n+# Health Status\n+\n+Zeebe broker exposes two http endpoints to query its health status. \n+* Ready check\n+* Health check\n+ \n+## Ready Check\n+Ready check endpoint is exposed via `http://{zeebe-broker}:{zeebe.broker.network.monitoringApi.port}/ready`.\n+This endpoint return an empty 204 response. If it is not ready, it will return a 503 error.\n+\n+A broker is ready when it has installed all necessary services to start processing in all partitions. \n+Once it is ready it is always ready.\n+\n+A ready check is useful, for example, to use as a `readinessProbe` in a kubernetes configuration to control when a pod can be restarted for rolling upgrade. \n+Depending on the cluster configuration, restarting one pod before the previous one is ready might make the system unavailable because the quorum of replicas is not available.\n+By configuring a `readinessProbe` that uses the ready check endpoint we can inform Kubernetes when it is safe to proceed with rolling update.\n+\n+## Health Check\n+Health check endpoint is exposed via `http://{zeebe-broker}:{zeebe.broker.network.monitoringApi.port}/health`.\n+This endpoint return an empty 204 response if the broker is healthy. If it is not healthy, it will return a 503 error.\n+A broker is never healthy before it is ready. \n+Unlike ready check, a broker can become unhealthy after it is healthy.\n+Hence it gives a better status of a running broker.\n+\n+A broker is healthy, when it can process workflows, accepts commands, and perform all its expected tasks.\n+If it is unhealthy, then it can mean three things: it is only temporarily unhealthy (e.g. due to environmental circumstances such as temporary I/O issues), it is partially unhealthy, or it is completely dead.\n+Partial failure could mean that one or more partitions is unhealthy, while the rest of them are able to process workflows.\n+[Metrics](/operations/metrics) give more insight into which partition is healthy or unhealthy.", "originalCommit": "fd3b1cad5ade88cf0429463eb7223959e7de38f4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "3d39a0b1b43b00f2abf1cd10c96ab70f7399489c", "url": "https://github.com/camunda-cloud/zeebe/commit/3d39a0b1b43b00f2abf1cd10c96ab70f7399489c", "message": "docs(operations): add doc for health checks", "committedDate": "2020-04-14T13:50:30Z", "type": "commit"}, {"oid": "3d39a0b1b43b00f2abf1cd10c96ab70f7399489c", "url": "https://github.com/camunda-cloud/zeebe/commit/3d39a0b1b43b00f2abf1cd10c96ab70f7399489c", "message": "docs(operations): add doc for health checks", "committedDate": "2020-04-14T13:50:30Z", "type": "forcePushed"}]}