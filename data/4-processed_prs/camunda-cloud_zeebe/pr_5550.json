{"pr_number": 5550, "pr_title": "Fix flaky CancelWorkflowInstanceConcurrentlyTest again", "pr_createdAt": "2020-10-08T13:29:49Z", "pr_url": "https://github.com/camunda-cloud/zeebe/pull/5550", "timeline": [{"oid": "31d462e78e5f3dfdd43f5628a93b377af5cfa804", "url": "https://github.com/camunda-cloud/zeebe/commit/31d462e78e5f3dfdd43f5628a93b377af5cfa804", "message": "test(engine): fix flaky test again\n\nLimiting the records to 2, filtering them and then grabbing the first\ncould still mean that only 1 of the jobs exist. This commit first\nasserts that both jobs exists and then picks the one to continue with", "committedDate": "2020-10-08T14:42:51Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjE3MDI4MQ==", "url": "https://github.com/camunda-cloud/zeebe/pull/5550#discussion_r502170281", "bodyText": "This assertion fails in the CI. Please have a look.", "author": "saig0", "createdAt": "2020-10-09T03:46:24Z", "path": "engine/src/test/java/io/zeebe/engine/processing/workflowinstance/CancelWorkflowInstanceConcurrentlyTest.java", "diffHunk": "@@ -141,10 +141,16 @@ public void init() {\n             .withElementType(BpmnElementType.SERVICE_TASK)\n             .getFirst();\n \n+    // wait for both jobs to appear\n+    assertThat(\n+            RecordingExporter.jobRecords(JobIntent.CREATED)\n+                .withWorkflowInstanceKey(workflowInstanceKey)\n+                .limit(2))\n+        .hasSize(2);", "originalCommit": "31d462e78e5f3dfdd43f5628a93b377af5cfa804", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjI2NjMzNw==", "url": "https://github.com/camunda-cloud/zeebe/pull/5550#discussion_r502266337", "bodyText": "Our assumption was wrong. Should be fixed now", "author": "korthout", "createdAt": "2020-10-09T08:20:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjE3MDI4MQ=="}], "type": "inlineReview"}, {"oid": "29c8c389bfaadf58836618ef9991bd504d4e856d", "url": "https://github.com/camunda-cloud/zeebe/commit/29c8c389bfaadf58836618ef9991bd504d4e856d", "message": "test(engine): fix flaky test again\n\nThe test has multiple scenarios, and the sequential scenario actually\nonly expects 1 job to become activatable.\n\nIn addition, in the scenarios where we expect 2 jobs to become\nactivatable, it was not enough to just limit the stream to 2 when only\ngrabbing one specific one. This because it might not be clear which job\nis created first. Therefore, the tests should always first assert that\nall expected jobs have been created and then continue.", "committedDate": "2020-10-09T08:16:15Z", "type": "commit"}, {"oid": "29c8c389bfaadf58836618ef9991bd504d4e856d", "url": "https://github.com/camunda-cloud/zeebe/commit/29c8c389bfaadf58836618ef9991bd504d4e856d", "message": "test(engine): fix flaky test again\n\nThe test has multiple scenarios, and the sequential scenario actually\nonly expects 1 job to become activatable.\n\nIn addition, in the scenarios where we expect 2 jobs to become\nactivatable, it was not enough to just limit the stream to 2 when only\ngrabbing one specific one. This because it might not be clear which job\nis created first. Therefore, the tests should always first assert that\nall expected jobs have been created and then continue.", "committedDate": "2020-10-09T08:16:15Z", "type": "forcePushed"}]}