{"pr_number": 5712, "pr_title": "Benchmark setup script", "pr_createdAt": "2020-10-28T07:12:09Z", "pr_url": "https://github.com/camunda-cloud/zeebe/pull/5712", "timeline": [{"oid": "3f441fa1031c51c63cfe5b4f4fe64788d64fc481", "url": "https://github.com/camunda-cloud/zeebe/commit/3f441fa1031c51c63cfe5b4f4fe64788d64fc481", "message": "chore(benchmark): create utils script\n\n Utils script contains OS specific sed function which can be used by other scripts", "committedDate": "2020-10-28T07:08:47Z", "type": "commit"}, {"oid": "2514b0d3ca1209ea0df45dd73413804f97f3935d", "url": "https://github.com/camunda-cloud/zeebe/commit/2514b0d3ca1209ea0df45dd73413804f97f3935d", "message": "chore(benchmarks): create new setupBenchmark script\n\n Allows to run on the root level of the project. It will compile, create the docker image, push it and create the namespace etc.", "committedDate": "2020-10-28T07:08:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI4ODU0NA==", "url": "https://github.com/camunda-cloud/zeebe/pull/5712#discussion_r513288544", "bodyText": "from the name of this script it is not entirely clear that this also starts the benchmark. Perhaps it can be something like setupAndStartBenchmark.sh", "author": "korthout", "createdAt": "2020-10-28T09:19:01Z", "path": "setupBenchmark.sh", "diffHunk": "@@ -0,0 +1,29 @@\n+#!/bin/bash\n+set -exo pipefail\n+\n+# Contains OS specific sed function\n+. benchmarks/setup/utils.sh\n+\n+if [ -z $1 ]\n+then\n+  echo \"Please provide a benchmark name! Format should be 'YOUR_NAME-TOPIC'\"\n+  exit 1\n+fi\n+benchmark=$1\n+\n+mvn clean install -DskipTests -T1C\n+\n+docker build --build-arg DISTBALL=dist/target/zeebe-distribution-*.tar.gz --build-arg APP_ENV=dev -t \"gcr.io/zeebe-io/zeebe:$benchmark\" .\n+docker push \"gcr.io/zeebe-io/zeebe:$benchmark\"\n+\n+cd benchmarks/setup/\n+\n+./newBenchmark.sh \"$benchmark\"\n+\n+cd \"$benchmark\"\n+\n+# calls OS specific sed inplace function\n+sed_inplace 's/camunda\\/zeebe/gcr.io\\/zeebe-io\\/zeebe/' zeebe-values.yaml\n+sed_inplace \"s/SNAPSHOT/$benchmark/\" zeebe-values.yaml\n+\n+make zeebe starter worker", "originalCommit": "2514b0d3ca1209ea0df45dd73413804f97f3935d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI5MTExNQ==", "url": "https://github.com/camunda-cloud/zeebe/pull/5712#discussion_r513291115", "bodyText": "I also think this script should be placed in benchmarks", "author": "korthout", "createdAt": "2020-10-28T09:22:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI4ODU0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzMxMzk2OQ==", "url": "https://github.com/camunda-cloud/zeebe/pull/5712#discussion_r513313969", "bodyText": "I can rename it. I put it on purpose on root so I don't need to change the folders etc. It is also more visible and it is easy to use. For the compiling and building the image it is also easier.", "author": "Zelldon", "createdAt": "2020-10-28T09:56:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI4ODU0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzMxNzYzNw==", "url": "https://github.com/camunda-cloud/zeebe/pull/5712#discussion_r513317637", "bodyText": "That makes sense. Just leave it in the root. Perhaps we can still find a better name.", "author": "korthout", "createdAt": "2020-10-28T10:02:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI4ODU0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzYwOTQ4MA==", "url": "https://github.com/camunda-cloud/zeebe/pull/5712#discussion_r513609480", "bodyText": "@korthout I had hoped setup would it clear enough :D but we can also write createBenchmark or buildAndRunBenchmark ? What do you think?", "author": "Zelldon", "createdAt": "2020-10-28T16:57:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI4ODU0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDE1MTA2Ng==", "url": "https://github.com/camunda-cloud/zeebe/pull/5712#discussion_r514151066", "bodyText": "@Zelldon I think I like createBenchmark the most. I feel like it implies that the benchmark is not just setup but also started.", "author": "korthout", "createdAt": "2020-10-29T10:22:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI4ODU0NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI5NTE0Mw==", "url": "https://github.com/camunda-cloud/zeebe/pull/5712#discussion_r513295143", "bodyText": "What does APP_ENV=dev achieve?", "author": "korthout", "createdAt": "2020-10-28T09:29:10Z", "path": "setupBenchmark.sh", "diffHunk": "@@ -0,0 +1,29 @@\n+#!/bin/bash\n+set -exo pipefail\n+\n+# Contains OS specific sed function\n+. benchmarks/setup/utils.sh\n+\n+if [ -z $1 ]\n+then\n+  echo \"Please provide a benchmark name! Format should be 'YOUR_NAME-TOPIC'\"\n+  exit 1\n+fi\n+benchmark=$1\n+\n+mvn clean install -DskipTests -T1C\n+\n+docker build --build-arg DISTBALL=dist/target/zeebe-distribution-*.tar.gz --build-arg APP_ENV=dev -t \"gcr.io/zeebe-io/zeebe:$benchmark\" .", "originalCommit": "2514b0d3ca1209ea0df45dd73413804f97f3935d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzMxMTYzNg==", "url": "https://github.com/camunda-cloud/zeebe/pull/5712#discussion_r513311636", "bodyText": "Uses a jdk image and installes profiler to the image. Makes it easier to debug and profile the benchmark\nhttps://github.com/zeebe-io/zeebe/blob/develop/Dockerfile#L28-L31\nI normally use this image.", "author": "Zelldon", "createdAt": "2020-10-28T09:53:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI5NTE0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzMxODA4NA==", "url": "https://github.com/camunda-cloud/zeebe/pull/5712#discussion_r513318084", "bodyText": "I which i would've known this sooner", "author": "korthout", "createdAt": "2020-10-28T10:03:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI5NTE0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzMxOTE0MA==", "url": "https://github.com/camunda-cloud/zeebe/pull/5712#discussion_r513319140", "bodyText": "I added this a while ago because it annoyed me as well quite often \ud83d\ude06 I think I have mentioned in slack \ud83d\ude05", "author": "Zelldon", "createdAt": "2020-10-28T10:04:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI5NTE0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzMyNjQxMA==", "url": "https://github.com/camunda-cloud/zeebe/pull/5712#discussion_r513326410", "bodyText": "I must have missed it, thanks though. Great addition", "author": "korthout", "createdAt": "2020-10-28T10:15:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI5NTE0Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI5NjY4MQ==", "url": "https://github.com/camunda-cloud/zeebe/pull/5712#discussion_r513296681", "bodyText": "why define this special function? Why not just turn this util script into sed-inplace.sh? And everytime you need it you just call this script?", "author": "korthout", "createdAt": "2020-10-28T09:31:30Z", "path": "benchmarks/setup/utils.sh", "diffHunk": "@@ -0,0 +1,33 @@\n+#!/bin/bash\n+\n+GO_OS=${GO_OS:-\"linux\"}\n+\n+function detect_os {\n+    # Detect the OS name\n+    case \"$(uname -s)\" in\n+      Darwin)\n+        host_os=darwin\n+        ;;\n+      Linux)\n+        host_os=linux\n+        ;;\n+      *)\n+        echo \"Unsupported host OS. Must be Linux or Mac OS X.\" >&2\n+        exit 1\n+        ;;\n+    esac\n+\n+   GO_OS=\"${host_os}\"\n+}\n+\n+\n+function sed_inplace() {", "originalCommit": "2514b0d3ca1209ea0df45dd73413804f97f3935d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzMxNjkyNw==", "url": "https://github.com/camunda-cloud/zeebe/pull/5712#discussion_r513316927", "bodyText": "Hm good question. I started with it because I thought I move more out but then it was just this. Idk I can also replace it, but does it matter? Do you have a preference for it?", "author": "Zelldon", "createdAt": "2020-10-28T10:01:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI5NjY4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzMyNzE1MQ==", "url": "https://github.com/camunda-cloud/zeebe/pull/5712#discussion_r513327151", "bodyText": "Not really, I think the only advantage on the calling side is not having to \"import\" the function. That's negligible.", "author": "korthout", "createdAt": "2020-10-28T10:17:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI5NjY4MQ=="}], "type": "inlineReview"}, {"oid": "fe6b8ea0e9802b9a76c1820107102fb0f87ad3fb", "url": "https://github.com/camunda-cloud/zeebe/commit/fe6b8ea0e9802b9a76c1820107102fb0f87ad3fb", "message": "chore(benchmark): rename benchmark script and add doc", "committedDate": "2020-10-29T10:44:51Z", "type": "commit"}]}