{"pr_number": 212, "pr_title": "[Schema Update] Add Version Support and Delta/Full Message Type", "pr_createdAt": "2020-05-23T06:17:17Z", "pr_url": "https://github.com/futurewei-cloud/alcor/pull/212", "timeline": [{"oid": "27e84d6f6c005d0abe5d691721aa98439877f407", "url": "https://github.com/futurewei-cloud/alcor/commit/27e84d6f6c005d0abe5d691721aa98439877f407", "message": "added mq_subscription_index per team discussion", "committedDate": "2020-05-23T06:11:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUxOTE1Ng==", "url": "https://github.com/futurewei-cloud/alcor/pull/212#discussion_r429519156", "bodyText": "@xieus - I didn't add the \"message version/timestamp\" at this point to handle out of order message. With multiple DPMs running for scale, out of order message could happen. Should we go ahead and add \"uint32 message_version\" for our \"GoalState\" message?", "author": "er1cthe0ne", "createdAt": "2020-05-23T06:20:59Z", "path": "schema/proto3/port.proto", "diffHunk": "@@ -28,13 +28,14 @@ message PortConfiguration {\n     ", "originalCommit": "27e84d6f6c005d0abe5d691721aa98439877f407", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU0OTk4Ng==", "url": "https://github.com/futurewei-cloud/alcor/pull/212#discussion_r429549986", "bodyText": "I would say that is the way to go. My recommendation is:\n\nuse the existing version, or rename it to \"content_version\" to track the content version of the message\nuse \"format_version\" or some better name to track the formatting version of the message (e.g. adding a new field)", "author": "xieus", "createdAt": "2020-05-23T14:18:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUxOTE1Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU2MDQ1MA==", "url": "https://github.com/futurewei-cloud/alcor/pull/212#discussion_r429560450", "bodyText": "would the content_version be on the PortConfiguration level or on the GoalState level? I can see how we would do it at the GoalState level. Putting it on GoalState level would be complicated because we can have multiple PortConfiguration in one GoalState message.", "author": "er1cthe0ne", "createdAt": "2020-05-23T16:39:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUxOTE1Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU5NzA0OQ==", "url": "https://github.com/futurewei-cloud/alcor/pull/212#discussion_r429597049", "bodyText": "I think port level is appropriate.", "author": "xieus", "createdAt": "2020-05-24T04:03:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUxOTE1Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY1Nzc5Mw==", "url": "https://github.com/futurewei-cloud/alcor/pull/212#discussion_r429657793", "bodyText": "ok, thinking about it on the route, I think we may need to use port ID and content_version as the \"key\" to determine the actual content_version since different port IDs on PortConfigurations won't conflict with each other right?\nhow do we deal with the below GoalState message which have?\n\nPortConfiguration - portID = 1, content_version = 5\nPortConfiguration - portID = 1, content_version = 7\nPortConfiguration - portID = 1, content_version = 6\n\ndo we process the PortConfiguration in the order of 5, 6, 7? Note that we have parallel processing in ACA, so maybe we cannot go parallel when we detect there are multiple PortConfigurations with the same port ID within the same GoalState message?", "author": "er1cthe0ne", "createdAt": "2020-05-24T17:26:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUxOTE1Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY5NDA5Nw==", "url": "https://github.com/futurewei-cloud/alcor/pull/212#discussion_r429694097", "bodyText": "This depends on whether the port configuration is full or delta. When comes to delta, out-of-order processing may or may not have impact to the results depending on scenarios. So it is important to identify those scenarios.\nRegarding parallel processing, the answer is related to scenarios as well.", "author": "xieus", "createdAt": "2020-05-25T00:51:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUxOTE1Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTczOTUxMA==", "url": "https://github.com/futurewei-cloud/alcor/pull/212#discussion_r429739510", "bodyText": "ok, I will think about the scenarios a bit more.", "author": "er1cthe0ne", "createdAt": "2020-05-25T05:40:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUxOTE1Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU0OTcxMQ==", "url": "https://github.com/futurewei-cloud/alcor/pull/212#discussion_r429549711", "bodyText": "This new field would work for Kafka. How about RocketMQ or Pulsar? @haboy52581 @er1cthe0ne", "author": "xieus", "createdAt": "2020-05-23T14:14:31Z", "path": "schema/proto3/port.proto", "diffHunk": "@@ -28,13 +28,14 @@ message PortConfiguration {\n     \n     NetworkType network_type = 2;\n     string project_id = 3;\n-    string network_id = 4;\n-    string id = 5;\n-    string name = 6;\n-    string network_ns = 7;\n-    string mac_address = 8;\n-    string veth_name = 9;\n-    bool admin_state_up = 10;\n+    string subnet_id = 4;\n+    uint32 mq_subscription_index = 5;", "originalCommit": "27e84d6f6c005d0abe5d691721aa98439877f407", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTQxOTQwNw==", "url": "https://github.com/futurewei-cloud/alcor/pull/212#discussion_r431419407", "bodyText": "this is the last blocking issue, I think we can merge this PR once we have answer on this.", "author": "er1cthe0ne", "createdAt": "2020-05-27T20:22:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU0OTcxMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjc5Mjk0Mw==", "url": "https://github.com/futurewei-cloud/alcor/pull/212#discussion_r432792943", "bodyText": "mq_subscription_index has been removed per discussion.", "author": "er1cthe0ne", "createdAt": "2020-05-30T00:42:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU0OTcxMQ=="}], "type": "inlineReview"}, {"oid": "346d838e872e10ab2ae29b4d5e5d253df870d2e2", "url": "https://github.com/futurewei-cloud/alcor/commit/346d838e872e10ab2ae29b4d5e5d253df870d2e2", "message": "changed to NEIGHBOR_CREATE_UPDATE OperationType per discussion", "committedDate": "2020-05-24T18:18:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTczMDQ2NA==", "url": "https://github.com/futurewei-cloud/alcor/pull/212#discussion_r429730464", "bodyText": "Should we move id up a bit?", "author": "xieus", "createdAt": "2020-05-25T04:53:19Z", "path": "schema/proto3/port.proto", "diffHunk": "@@ -28,13 +28,14 @@ message PortConfiguration {\n     \n     NetworkType network_type = 2;\n     string project_id = 3;\n-    string network_id = 4;\n-    string id = 5;\n-    string name = 6;\n-    string network_ns = 7;\n-    string mac_address = 8;\n-    string veth_name = 9;\n-    bool admin_state_up = 10;\n+    string subnet_id = 4;\n+    uint32 mq_subscription_index = 5;\n+    string id = 6;", "originalCommit": "346d838e872e10ab2ae29b4d5e5d253df870d2e2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTc0MDI2Mw==", "url": "https://github.com/futurewei-cloud/alcor/pull/212#discussion_r429740263", "bodyText": "yes, ID is one of the most important field, I will move it up.", "author": "er1cthe0ne", "createdAt": "2020-05-25T05:44:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTczMDQ2NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTczMDU4NA==", "url": "https://github.com/futurewei-cloud/alcor/pull/212#discussion_r429730584", "bodyText": "Do we need all of these fields for port given that we have better picture of OVS?", "author": "xieus", "createdAt": "2020-05-25T04:54:02Z", "path": "schema/proto3/port.proto", "diffHunk": "@@ -28,13 +28,14 @@ message PortConfiguration {\n     \n     NetworkType network_type = 2;\n     string project_id = 3;\n-    string network_id = 4;\n-    string id = 5;\n-    string name = 6;\n-    string network_ns = 7;\n-    string mac_address = 8;\n-    string veth_name = 9;\n-    bool admin_state_up = 10;\n+    string subnet_id = 4;\n+    uint32 mq_subscription_index = 5;\n+    string id = 6;\n+    string name = 7;\n+    string network_ns = 8;\n+    string mac_address = 9;\n+    string veth_name = 10;\n+    bool admin_state_up = 11;", "originalCommit": "346d838e872e10ab2ae29b4d5e5d253df870d2e2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTc0MjQ3Mw==", "url": "https://github.com/futurewei-cloud/alcor/pull/212#discussion_r429742473", "bodyText": "network_ns - was used during our previous k8s integration, we may need it for later k8s integration\nmac_address - for virtual mac\nveth_name - don't think we need that for OVS, I have moved that to mizar specific session\nadmin_state_up - neutron specific field, we want to keep it", "author": "er1cthe0ne", "createdAt": "2020-05-25T05:53:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTczMDU4NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTc0NjgzNA==", "url": "https://github.com/futurewei-cloud/alcor/pull/212#discussion_r429746834", "bodyText": "Cool thanks!", "author": "xieus", "createdAt": "2020-05-25T06:08:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTczMDU4NA=="}], "type": "inlineReview"}, {"oid": "067bbdf41613a00c0e375b06c3edcdfc7fc840c5", "url": "https://github.com/futurewei-cloud/alcor/commit/067bbdf41613a00c0e375b06c3edcdfc7fc840c5", "message": "update per PR feedback", "committedDate": "2020-05-25T05:56:49Z", "type": "commit"}, {"oid": "0f15e0e034082a5c95a92b8cb555c7c18ff5645f", "url": "https://github.com/futurewei-cloud/alcor/commit/0f15e0e034082a5c95a92b8cb555c7c18ff5645f", "message": "update per team discussion", "committedDate": "2020-05-27T20:10:56Z", "type": "commit"}, {"oid": "34cebb5d25847195cc52c7e44461291471bf996b", "url": "https://github.com/futurewei-cloud/alcor/commit/34cebb5d25847195cc52c7e44461291471bf996b", "message": "fix build issues", "committedDate": "2020-05-27T20:20:58Z", "type": "commit"}, {"oid": "0ee5ce1d18322b700cdc6b4a51cadb6bc2c30741", "url": "https://github.com/futurewei-cloud/alcor/commit/0ee5ce1d18322b700cdc6b4a51cadb6bc2c30741", "message": "update per team discussion", "committedDate": "2020-05-30T00:43:28Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjgwMDE3Mg==", "url": "https://github.com/futurewei-cloud/alcor/pull/212#discussion_r432800172", "bodyText": "Suggest to use \"revision_number\", which is used by controller APIs.", "author": "xieus", "createdAt": "2020-05-30T02:00:42Z", "path": "schema/proto3/dhcp.proto", "diffHunk": "@@ -24,12 +24,13 @@ option java_outer_classname = \"DHCP\";\n import \"common.proto\";\n \n message DHCPConfiguration {\n-    uint32 version = 1;\n+    uint32 format_version = 1;\n+    uint32 content_version = 2;", "originalCommit": "0ee5ce1d18322b700cdc6b4a51cadb6bc2c30741", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjgwMDIyOA==", "url": "https://github.com/futurewei-cloud/alcor/pull/212#discussion_r432800228", "bodyText": "\"revision_number\"", "author": "xieus", "createdAt": "2020-05-30T02:01:32Z", "path": "schema/proto3/port.proto", "diffHunk": "@@ -23,18 +23,24 @@ option java_outer_classname = \"Port\";\n \n import \"common.proto\";\n \n+enum MessageType { \n+    DELTA = 0; // the default type\n+    FULL = 1;\n+}\n+\n message PortConfiguration {\n-    uint32 version = 1;\n-    \n-    NetworkType network_type = 2;\n-    string project_id = 3;\n-    string network_id = 4;\n-    string id = 5;\n-    string name = 6;\n-    string network_ns = 7;\n-    string mac_address = 8;\n-    string veth_name = 9;\n-    bool admin_state_up = 10;\n+    uint32 format_version = 1;\n+    uint32 content_version = 2;", "originalCommit": "0ee5ce1d18322b700cdc6b4a51cadb6bc2c30741", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjgwMDMxMg==", "url": "https://github.com/futurewei-cloud/alcor/pull/212#discussion_r432800312", "bodyText": "Is network_ns used for Mizar only? If so, we could move it to the end.", "author": "xieus", "createdAt": "2020-05-30T02:02:47Z", "path": "schema/proto3/port.proto", "diffHunk": "@@ -23,18 +23,24 @@ option java_outer_classname = \"Port\";\n \n import \"common.proto\";\n \n+enum MessageType { \n+    DELTA = 0; // the default type\n+    FULL = 1;\n+}\n+\n message PortConfiguration {\n-    uint32 version = 1;\n-    \n-    NetworkType network_type = 2;\n-    string project_id = 3;\n-    string network_id = 4;\n-    string id = 5;\n-    string name = 6;\n-    string network_ns = 7;\n-    string mac_address = 8;\n-    string veth_name = 9;\n-    bool admin_state_up = 10;\n+    uint32 format_version = 1;\n+    uint32 content_version = 2;\n+    MessageType message_type = 3;\n+\n+    string id = 4;\n+    NetworkType network_type = 5;\n+    string project_id = 6;\n+    string subnet_id = 7;\n+    string name = 8;\n+    string network_ns = 9;", "originalCommit": "0ee5ce1d18322b700cdc6b4a51cadb6bc2c30741", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjg3MTE0Mg==", "url": "https://github.com/futurewei-cloud/alcor/pull/212#discussion_r432871142", "bodyText": "we will likely use it for k8s integration based on our previous design, since all the containers endpoints are under some network namespace.", "author": "er1cthe0ne", "createdAt": "2020-05-30T17:14:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjgwMDMxMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjg5NDU1Nw==", "url": "https://github.com/futurewei-cloud/alcor/pull/212#discussion_r432894557", "bodyText": "Got it.Thanks.", "author": "xieus", "createdAt": "2020-05-30T23:11:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjgwMDMxMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjgwMDM0Nw==", "url": "https://github.com/futurewei-cloud/alcor/pull/212#discussion_r432800347", "bodyText": "\"revision_number\"", "author": "xieus", "createdAt": "2020-05-30T02:03:09Z", "path": "schema/proto3/securitygroup.proto", "diffHunk": "@@ -24,12 +24,13 @@ option java_outer_classname = \"SecurityGroup\";\n import \"common.proto\";\n \n message SecurityGroupConfiguration {\n-    uint32 version = 1;\n+    uint32 format_version = 1;\n+    uint32 content_version = 2;", "originalCommit": "0ee5ce1d18322b700cdc6b4a51cadb6bc2c30741", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjgwMDQ3OQ==", "url": "https://github.com/futurewei-cloud/alcor/pull/212#discussion_r432800479", "bodyText": "\"revision_number\"", "author": "xieus", "createdAt": "2020-05-30T02:04:58Z", "path": "schema/proto3/subnet.proto", "diffHunk": "@@ -24,14 +24,15 @@ option java_outer_classname = \"Subnet\";\n import \"common.proto\";\n \n message SubnetConfiguration {\n-    uint32 version = 1;\n+    uint32 format_version = 1;\n+    uint32 content_version = 2;", "originalCommit": "0ee5ce1d18322b700cdc6b4a51cadb6bc2c30741", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjgwMDUxMg==", "url": "https://github.com/futurewei-cloud/alcor/pull/212#discussion_r432800512", "bodyText": "\"revision_number\"", "author": "xieus", "createdAt": "2020-05-30T02:05:16Z", "path": "schema/proto3/vpc.proto", "diffHunk": "@@ -24,13 +24,14 @@ option java_outer_classname = \"Vpc\";\n import \"common.proto\";\n \n message VpcConfiguration {\n-    uint32 version = 1;\n+    uint32 format_version = 1;\n+    uint32 content_version = 2;", "originalCommit": "0ee5ce1d18322b700cdc6b4a51cadb6bc2c30741", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "9331a6d19ad44dafbf8e5ac26eaa81a01089d871", "url": "https://github.com/futurewei-cloud/alcor/commit/9331a6d19ad44dafbf8e5ac26eaa81a01089d871", "message": "update to revision_number", "committedDate": "2020-05-30T17:31:28Z", "type": "commit"}, {"oid": "b719e25117a5a8b3dcb2afa1fc054cea5ea7d3f7", "url": "https://github.com/futurewei-cloud/alcor/commit/b719e25117a5a8b3dcb2afa1fc054cea5ea7d3f7", "message": "update FixedIp in PortConfiguration", "committedDate": "2020-05-31T03:36:24Z", "type": "commit"}, {"oid": "bd0f739b6628a071be82f06efe5b60f07470d433", "url": "https://github.com/futurewei-cloud/alcor/commit/bd0f739b6628a071be82f06efe5b60f07470d433", "message": "move mac_address back to top level", "committedDate": "2020-05-31T05:19:40Z", "type": "commit"}]}