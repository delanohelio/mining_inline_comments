{"pr_number": 205, "pr_title": "[Documentation] Migration Plan for OpenStack Users", "pr_createdAt": "2020-05-20T13:33:34Z", "pr_url": "https://github.com/futurewei-cloud/alcor/pull/205", "timeline": [{"oid": "410fdccf1d5ac8c85c1f1dd08f4c36376a21b480", "url": "https://github.com/futurewei-cloud/alcor/commit/410fdccf1d5ac8c85c1f1dd08f4c36376a21b480", "message": "Merge pull request #1 from futurewei-cloud/master\n\npull update from source", "committedDate": "2020-05-20T07:08:59Z", "type": "commit"}, {"oid": "5f1fc262b657299acf6da89850513fadc6aabdcf", "url": "https://github.com/futurewei-cloud/alcor/commit/5f1fc262b657299acf6da89850513fadc6aabdcf", "message": "[Document] Some design thought of migration from Neutron", "committedDate": "2020-05-20T13:28:47Z", "type": "commit"}, {"oid": "64ee5fc7bc11f5fc01575da273575af151a03203", "url": "https://github.com/futurewei-cloud/alcor/commit/64ee5fc7bc11f5fc01575da273575af151a03203", "message": "[Document] Some design thought of migration from Neutron\nSome main steps of migration:\n1) Intercept Neutron messages: save a copy and redirect them back to Neutron\n2) Transform original data: batch pull network resources from Neutron, transform those data in the form of Alcor, and processed them as bulk create operations.\n3) reprocess cached messages: reprocess those cached messages", "committedDate": "2020-05-21T03:58:42Z", "type": "commit"}, {"oid": "2ac6507a61605354f89259fe50d40964780c327d", "url": "https://github.com/futurewei-cloud/alcor/commit/2ac6507a61605354f89259fe50d40964780c327d", "message": "Merge branch 'neutron-migration' of https://github.com/Eric-Yuan/alcor into neutron-migration", "committedDate": "2020-05-21T03:59:00Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUwMTA5MQ==", "url": "https://github.com/futurewei-cloud/alcor/pull/205#discussion_r429501091", "bodyText": "Like this idea!", "author": "xieus", "createdAt": "2020-05-23T01:16:57Z", "path": "docs/design/deployment.adoc", "diffHunk": "@@ -5,7 +5,35 @@ v0.1, 2020-05-17\n \n NOTE: This document is under development\n \n-== Migration Plane from Openstack Neutron\n+== Migration Plan from Openstack Neutron\n+\n+First, the structures of Neutron models are not consistent with the Alcor's. \n+We need a tool that can transform the existing Neutron network configurations into the Alcor's, so that Alcor can process it.\n+These converted network configurations should be handled by Alcor as batch creation operation messages with all parameters specified.\n+\n+However, we still want users to be able to continue configuring on this openstack environment, \n+as we use the tool to convert the netruon network configurations to Alcors.\n+At this time, the virtual switch in compute node side should still be taken over by neutron agents, ", "originalCommit": "2ac6507a61605354f89259fe50d40964780c327d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUwMTQ2Nw==", "url": "https://github.com/futurewei-cloud/alcor/pull/205#discussion_r429501467", "bodyText": "The idea of this three-step migration plan is awesome. Let us explicit call it out.\nSuggest to use the following subtitles:\n\"=== Step 1: Active Neutron and Passive Alcor with Request Caching\"\n\"=== Step 2: Proactive Request Processing by Alcor\"\n\"=== Step 3: Seamless Transition to Active Alcor\"", "author": "xieus", "createdAt": "2020-05-23T01:21:10Z", "path": "docs/design/deployment.adoc", "diffHunk": "@@ -5,7 +5,35 @@ v0.1, 2020-05-17\n \n NOTE: This document is under development\n \n-== Migration Plane from Openstack Neutron\n+== Migration Plan from Openstack Neutron\n+", "originalCommit": "2ac6507a61605354f89259fe50d40964780c327d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUwNjM0MQ==", "url": "https://github.com/futurewei-cloud/alcor/pull/205#discussion_r429506341", "bodyText": "OK, that will be more clear.", "author": "Eric-Yuan", "createdAt": "2020-05-23T02:30:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUwMTQ2Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUwMjgzMw==", "url": "https://github.com/futurewei-cloud/alcor/pull/205#discussion_r429502833", "bodyText": "Let us talk about message forwarding and cache more :-)\nIn some regions with high QPS, the migration proxy could become the potential bottleneck and we would need careful plan for that, in terms of latency overhead and size of cached requests. Could you get a rough idea of how much requests could be processed?", "author": "xieus", "createdAt": "2020-05-23T01:39:17Z", "path": "docs/design/deployment.adoc", "diffHunk": "@@ -5,7 +5,35 @@ v0.1, 2020-05-17\n \n NOTE: This document is under development\n \n-== Migration Plane from Openstack Neutron\n+== Migration Plan from Openstack Neutron\n+\n+First, the structures of Neutron models are not consistent with the Alcor's. \n+We need a tool that can transform the existing Neutron network configurations into the Alcor's, so that Alcor can process it.\n+These converted network configurations should be handled by Alcor as batch creation operation messages with all parameters specified.\n+\n+However, we still want users to be able to continue configuring on this openstack environment, \n+as we use the tool to convert the netruon network configurations to Alcors.\n+At this time, the virtual switch in compute node side should still be taken over by neutron agents, \n+and an alcor control agent should be in a state that can normally receive configuration, \n+but does not send configuration to the virtual switch.\n+The newly generated configuration during this conversion may not be simultaneously converted to Alcor and processed, \n+therefore, we also need to intercept all the operation messages received by the Neutron during the conversion period.\n+And in addition to passing them through to the Neutron so that the Neutron can normally process the messages,\n+we also need to copy those operation messages and temporarily cache them.", "originalCommit": "2ac6507a61605354f89259fe50d40964780c327d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUwODk5Nw==", "url": "https://github.com/futurewei-cloud/alcor/pull/205#discussion_r429508997", "bodyText": "OK. We could only proxy those write queries. In a region with tens of thousands servers scale, there might be only a few QPS of write queries for network serivces in average, as the QPS of read queries for network serivces could reach to several hundreds.", "author": "Eric-Yuan", "createdAt": "2020-05-23T03:15:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUwMjgzMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUwOTY4OQ==", "url": "https://github.com/futurewei-cloud/alcor/pull/205#discussion_r429509689", "bodyText": "OK. We could only proxy those write queries.\n\nNice. If the \"upper\" API Gateway could selectively send the write quests to the new \"Neutron migration proxy\", then problem solved :-)", "author": "xieus", "createdAt": "2020-05-23T03:25:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUwMjgzMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUwMzQ2Nw==", "url": "https://github.com/futurewei-cloud/alcor/pull/205#discussion_r429503467", "bodyText": "This OpenStack CLI changes fall into one question: are we capable of asking all clients of the existing in-house OpenStack clusters upgrade with new pointer to Alcor? It might or may not.\nThe existing Neutron APIs could be called by clients in house (like Nova) and in customer's sides (like deployment scripts).\n\nEasier for the in-house clients\nAs we don't have control customer's clients, it would be very tricky here. One possible option is use to same DNS name pointing to different backend IP addresses. But need to handle with long DNS expiration.\n\nLet us have more discussion on this.", "author": "xieus", "createdAt": "2020-05-23T01:47:05Z", "path": "docs/design/deployment.adoc", "diffHunk": "@@ -5,7 +5,35 @@ v0.1, 2020-05-17\n \n NOTE: This document is under development\n \n-== Migration Plane from Openstack Neutron\n+== Migration Plan from Openstack Neutron\n+\n+First, the structures of Neutron models are not consistent with the Alcor's. \n+We need a tool that can transform the existing Neutron network configurations into the Alcor's, so that Alcor can process it.\n+These converted network configurations should be handled by Alcor as batch creation operation messages with all parameters specified.\n+\n+However, we still want users to be able to continue configuring on this openstack environment, \n+as we use the tool to convert the netruon network configurations to Alcors.\n+At this time, the virtual switch in compute node side should still be taken over by neutron agents, \n+and an alcor control agent should be in a state that can normally receive configuration, \n+but does not send configuration to the virtual switch.\n+The newly generated configuration during this conversion may not be simultaneously converted to Alcor and processed, \n+therefore, we also need to intercept all the operation messages received by the Neutron during the conversion period.\n+And in addition to passing them through to the Neutron so that the Neutron can normally process the messages,\n+we also need to copy those operation messages and temporarily cache them.\n+\n+image::images/neutron_migration_phase1.png[\"Migration Phase1\", width=1024, link=\"images/neutron_migration_phase1.png\"]\n+\n+After the conversion of the original network configurations is completed, \n+these cached operation messages should also be converted to alcor's messages and processed.\n+\n+image::images/neutron_migration_phase2.png[\"Migration Phase2\", width=1024, link=\"images/neutron_migration_phase2.png\"]\n+\n+After that, the openstack CLI can switch to send operation messages directly to Alcor.", "originalCommit": "2ac6507a61605354f89259fe50d40964780c327d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUwNjI3MQ==", "url": "https://github.com/futurewei-cloud/alcor/pull/205#discussion_r429506271", "bodyText": "In public cloud scenario, a provider is more likely to use a API gateway mechanism. And those APIs for users would be regitested there, each with a mapping from external URI to internal URI. So if there is any conversion on the internal URI side, we only need to override the mapping to the new internal URI in the API gateway. Those changes may not be awared by users, because the DNS name and URI for a API is not changed.\nFor the in-house clients, there is a similiar mechanism, but the adoption is only a suggestion, so those in-house clients might need a conversion step.", "author": "Eric-Yuan", "createdAt": "2020-05-23T02:29:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUwMzQ2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUwNzM5Nw==", "url": "https://github.com/futurewei-cloud/alcor/pull/205#discussion_r429507397", "bodyText": "In public cloud scenario, a provider is more likely to use a API gateway mechanism. And those APIs for users would be regitested there, each with a mapping from external URI to internal URI. So if there is any conversion on the internal URI side, we only need to override the mapping to the new internal URI in the API gateway. Those changes may not be awared by users, because the DNS name and URI for a API is not changed.\n\nCool. In the public cloud scenario, this means the biggest client of Alcor is likely the in-house API Gateway so transition is not a big issue then.\n\nFor the in-house clients, there is a similar mechanism, but the adoption is only a suggestion, so those in-house clients might need a conversion step.\n\nGot you.", "author": "xieus", "createdAt": "2020-05-23T02:48:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUwMzQ2Nw=="}], "type": "inlineReview"}, {"oid": "9607d43218cb7f6da4e5a49937194f8bb3cb2edd", "url": "https://github.com/futurewei-cloud/alcor/commit/9607d43218cb7f6da4e5a49937194f8bb3cb2edd", "message": "Merge pull request #2 from futurewei-cloud/master\n\nsync original repository codes", "committedDate": "2020-05-23T03:46:29Z", "type": "commit"}, {"oid": "e495791e486c5edb9eb714c93652cee45cadc663", "url": "https://github.com/futurewei-cloud/alcor/commit/e495791e486c5edb9eb714c93652cee45cadc663", "message": "adjust picture width", "committedDate": "2020-05-23T03:55:55Z", "type": "commit"}, {"oid": "904aba95322c9cad593bb14920227f760f44702f", "url": "https://github.com/futurewei-cloud/alcor/commit/904aba95322c9cad593bb14920227f760f44702f", "message": "1. update the document's position\n2. add some explain about that only need proxy write requests", "committedDate": "2020-05-23T07:25:29Z", "type": "commit"}, {"oid": "94e6beda1cd343225f0946c56d0d90a1e93caa2a", "url": "https://github.com/futurewei-cloud/alcor/commit/94e6beda1cd343225f0946c56d0d90a1e93caa2a", "message": "Merge branch 'neutron-migration' of https://github.com/Eric-Yuan/alcor into neutron-migration", "committedDate": "2020-05-23T07:29:10Z", "type": "commit"}, {"oid": "84196d5edeb11d6c2758c3d552fbb00a02755a5f", "url": "https://github.com/futurewei-cloud/alcor/commit/84196d5edeb11d6c2758c3d552fbb00a02755a5f", "message": "remove old file", "committedDate": "2020-05-23T07:30:31Z", "type": "commit"}]}