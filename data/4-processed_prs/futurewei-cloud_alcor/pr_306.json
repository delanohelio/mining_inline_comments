{"pr_number": 306, "pr_title": "[Deployment] Alcor Onebox Setup for Development and Deployment", "pr_createdAt": "2020-07-20T22:05:11Z", "pr_url": "https://github.com/futurewei-cloud/alcor/pull/306", "timeline": [{"oid": "ca247316f03c84c2be84675b960dfbdd38622a22", "url": "https://github.com/futurewei-cloud/alcor/commit/ca247316f03c84c2be84675b960dfbdd38622a22", "message": "add ignite dockerfile, deployment script and test script", "committedDate": "2020-07-20T21:58:21Z", "type": "commit"}, {"oid": "410435514cc9da4826fead98dd1fa76b8fd838b5", "url": "https://github.com/futurewei-cloud/alcor/commit/410435514cc9da4826fead98dd1fa76b8fd838b5", "message": "reorg", "committedDate": "2020-07-20T22:04:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzcyMzEzMg==", "url": "https://github.com/futurewei-cloud/alcor/pull/306#discussion_r457723132", "bodyText": "../Dockerfile point to <alcor_root>. Do we refer to <alcor_root>/scripts/Dockerfile? In that case, we will need change the relative path here.", "author": "xieus", "createdAt": "2020-07-20T22:17:37Z", "path": "scripts/startall.sh", "diffHunk": "@@ -0,0 +1,24 @@\n+#prepare build\n+apt install openjdk-11-jdk telnet bridge-utils maven -y\n+git clone https://github.com/futurewei-cloud/alcor.git\n+cd alcor\n+cp ../Dockerfile scripts/ignite.Dockerfile", "originalCommit": "410435514cc9da4826fead98dd1fa76b8fd838b5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzcyMzg1MQ==", "url": "https://github.com/futurewei-cloud/alcor/pull/306#discussion_r457723851", "bodyText": "What is the expected result from current sg implementation?", "author": "xieus", "createdAt": "2020-07-20T22:19:23Z", "path": "scripts/test1.sh", "diffHunk": "@@ -0,0 +1,5 @@\n+curl -X POST -H \"Content-Type: application/json\" --data @json/cvpc.json http://localhost:9009/project/3dda2801-d675-4688-a63f-dcda8d327f50/vpcs\n+curl -X POST -H \"Content-Type: application/json\" --data @json/csn.json http://localhost:9009/project/3dda2801-d675-4688-a63f-dcda8d327f50/subnets\n+curl -X POST -H \"Content-Type: application/json\" --data @json/node.json http://localhost:9007/v4/nodes\n+curl -X POST -H \"Content-Type: application/json\" --data @json/sg.json http://localhost:9008/v4/3dda2801-d675-4688-a63f-dcda8d327f50/security-groups", "originalCommit": "410435514cc9da4826fead98dd1fa76b8fd838b5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDMzNTUxMw==", "url": "https://github.com/futurewei-cloud/alcor/pull/306#discussion_r460335513", "bodyText": "The expected result should be this:\n{\n\"security_group\":{\n\"id\":\"3dda2801-d675-4688-a63f-dcda8d111111\",\n\"project_id\":\"3dda2801-d675-4688-a63f-dcda8d327f50\",\n\"tenant_id\":\"3dda2801-d675-4688-a63f-dcda8d327f50\",\n\"name\":\"sg1\",\n\"description\":\"string\",\n\"security_group_rules\":[\n{\n\"id\":\"6cccca44-eac5-4b1f-9bbe-02157708916a\",\n\"project_id\":null,\n\"tenant_id\":\"3dda2801-d675-4688-a63f-dcda8d327f50\",\n\"name\":null,\n\"description\":null,\n\"security_group_id\":\"3dda2801-d675-4688-a63f-dcda8d111111\",\n\"remote_group_id\":null,\n\"direction\":\"egress\",\n\"remote_ip_prefix\":null,\n\"protocol\":null,\n\"port_range_max\":null,\n\"port_range_min\":null,\n\"ether_type\":\"IPv4\"\n},\n{\n\"id\":\"0ee2b64e-1405-4964-bd23-e48b50958126\",\n\"project_id\":null,\n\"tenant_id\":\"3dda2801-d675-4688-a63f-dcda8d327f50\",\n\"name\":null,\n\"description\":null,\n\"security_group_id\":\"3dda2801-d675-4688-a63f-dcda8d111111\",\n\"remote_group_id\":null,\n\"direction\":\"egress\",\n\"remote_ip_prefix\":null,\n\"protocol\":null,\n\"port_range_max\":null,\n\"port_range_min\":null,\n\"ether_type\":\"IPv6\"\n}\n],\n\"create_at\":\"2020-07-25 00:06:28\",\n\"update_at\":\"2020-07-25 00:06:28\"\n}\n}", "author": "haboy52581", "createdAt": "2020-07-25T00:03:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzcyMzg1MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzcyNTg0OA==", "url": "https://github.com/futurewei-cloud/alcor/pull/306#discussion_r457725848", "bodyText": "For container deployment,\n\"local_ip\":\"127.0.0.1\"\n\"node_name\":\"local_node\"\n\"server_port\":50001\nI think ACA opens port 50001 for gRPC connection, right? Does DPM consume the port for now?", "author": "xieus", "createdAt": "2020-07-20T22:24:47Z", "path": "scripts/json/node.json", "diffHunk": "@@ -0,0 +1,21 @@\n+{\r\n+  \"host_info\": {\r\n+    \"local_ip\": \"10.213.43.188\",\r\n+    \"mac_address\": \"90:17:ac:c1:34:64\",\r\n+    \"node_id\": \"9192a4d4-ffff-4ece-b3f0-8d36e3d85001\",\r\n+    \"node_name\": \"node2\",\r\n+    \"server_port\": 8080,\r\n+    \"veth\": \"eth0\"\r\n+  }\r\n+}\r\n+\r\n+{\r\n+  \"host_info\": {\r\n+    \"local_ip\": \"10.213.43.166\",\r", "originalCommit": "410435514cc9da4826fead98dd1fa76b8fd838b5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODk0NDUwOA==", "url": "https://github.com/futurewei-cloud/alcor/pull/306#discussion_r458944508", "bodyText": "yes, dpm consume the port", "author": "haboy52581", "createdAt": "2020-07-22T17:00:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzcyNTg0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTg1NjEwMA==", "url": "https://github.com/futurewei-cloud/alcor/pull/306#discussion_r459856100", "bodyText": "Based on today's discussion, DPM doesn't consume this port for now and the next step for us is (1) update DPM contract to include this field (2) DPM implementation and test update. @haboy52581", "author": "xieus", "createdAt": "2020-07-24T05:18:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzcyNTg0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDMzNDc0MQ==", "url": "https://github.com/futurewei-cloud/alcor/pull/306#discussion_r460334741", "bodyText": "so do you mean we have to change the contract now or after the release", "author": "haboy52581", "createdAt": "2020-07-24T23:58:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzcyNTg0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDM0MDIzMQ==", "url": "https://github.com/futurewei-cloud/alcor/pull/306#discussion_r460340231", "bodyText": "You can create a tracking issue and address the issue in a follow-up PR.", "author": "xieus", "createdAt": "2020-07-25T00:32:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzcyNTg0OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzcyNjEzNw==", "url": "https://github.com/futurewei-cloud/alcor/pull/306#discussion_r457726137", "bodyText": "Indent here.", "author": "xieus", "createdAt": "2020-07-20T22:25:26Z", "path": "scripts/json/cp1b.json", "diffHunk": "@@ -0,0 +1,63 @@\n+{\r\n+  \"port\": {\r\n+    \"admin_state_up\": true,\r\n+    \"allowed_address_pairs\": [\r\n+      {\r\n+        \"ip_address\": \"11.11.11.1\",\r\n+        \"mac_address\": \"00-AA-BB-15-EB-3F\"\r\n+      }\r\n+    ],\r\n+\"binding:host_id\": \"9192a4d4-ffff-4ece-b3f0-8d36e3d85001\",\r", "originalCommit": "410435514cc9da4826fead98dd1fa76b8fd838b5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e3a83477906d5ee8b831d7a7d987de82ca561d1f", "url": "https://github.com/futurewei-cloud/alcor/commit/e3a83477906d5ee8b831d7a7d987de82ca561d1f", "message": "Merge branch 'master' of github.com:futurewei-cloud/alcor", "committedDate": "2020-07-22T03:01:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODUyMTcxNQ==", "url": "https://github.com/futurewei-cloud/alcor/pull/306#discussion_r458521715", "bodyText": "This is a change from other PR. It is not supposed to be here.", "author": "xieus", "createdAt": "2020-07-22T04:06:47Z", "path": "web/src/main/java/com/futurewei/alcor/web/entity/port/PortEntity.java", "diffHunk": "@@ -108,6 +109,7 @@\n     @JsonProperty(\"revision_number\")\n     private int revisionNumber;\n \n+    @JsonIgnore", "originalCommit": "8e453a8d97c22f1d78b29b45eabdb7025e2926f0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTE0MjQwMQ==", "url": "https://github.com/futurewei-cloud/alcor/pull/306#discussion_r459142401", "bodyText": "fixed in  #310", "author": "haboy52581", "createdAt": "2020-07-22T23:36:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODUyMTcxNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTg1NjY0MA==", "url": "https://github.com/futurewei-cloud/alcor/pull/306#discussion_r459856640", "bodyText": "Correct. As this file has been merged to master, it should be removed from this PR.", "author": "xieus", "createdAt": "2020-07-24T05:21:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODUyMTcxNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDMzNDYyMg==", "url": "https://github.com/futurewei-cloud/alcor/pull/306#discussion_r460334622", "bodyText": "fixed in 841a344", "author": "haboy52581", "createdAt": "2020-07-24T23:57:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODUyMTcxNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTA3NTE2MA==", "url": "https://github.com/futurewei-cloud/alcor/pull/306#discussion_r459075160", "bodyText": "@haboy52581 Xiaodong, I just tried to use this Dockerfile locally and found that it took me more than 30 minutes to complete it.\nWe might need to rely on this Dockerfile in our Onebox deployment, K8s deployment and daily CI workflow.\nPlease try a light-weighted option like CIRROS or others.", "author": "xieus", "createdAt": "2020-07-22T20:50:44Z", "path": "scripts/Dockerfile", "diffHunk": "@@ -0,0 +1,19 @@\n+FROM ubuntu", "originalCommit": "8e453a8d97c22f1d78b29b45eabdb7025e2926f0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTE0MjE4MQ==", "url": "https://github.com/futurewei-cloud/alcor/pull/306#discussion_r459142181", "bodyText": "I think it really depends on the scenario you want to use, if this file is used for internally then please let me know why the repo you want to use; if this is for outside world, then this is very fast if you are running on the normal box since that's for dockerhub connection", "author": "haboy52581", "createdAt": "2020-07-22T23:36:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTA3NTE2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTg1NjM1NQ==", "url": "https://github.com/futurewei-cloud/alcor/pull/306#discussion_r459856355", "bodyText": "Okay let us discuss various options.", "author": "xieus", "createdAt": "2020-07-24T05:19:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTA3NTE2MA=="}], "type": "inlineReview"}, {"oid": "841a344ecb10b613e807aa509c0765fd84be4722", "url": "https://github.com/futurewei-cloud/alcor/commit/841a344ecb10b613e807aa509c0765fd84be4722", "message": "address the points in pr#306", "committedDate": "2020-07-24T23:57:35Z", "type": "forcePushed"}, {"oid": "7ef7d695a5b947bc646e8d14ef547c6fc4ffaab2", "url": "https://github.com/futurewei-cloud/alcor/commit/7ef7d695a5b947bc646e8d14ef547c6fc4ffaab2", "message": "address the points in pr#306", "committedDate": "2020-07-28T22:23:30Z", "type": "forcePushed"}, {"oid": "e3a83477906d5ee8b831d7a7d987de82ca561d1f", "url": "https://github.com/futurewei-cloud/alcor/commit/e3a83477906d5ee8b831d7a7d987de82ca561d1f", "message": "Merge branch 'master' of github.com:futurewei-cloud/alcor", "committedDate": "2020-07-22T03:01:50Z", "type": "forcePushed"}, {"oid": "76b80d0ad2867fcf3bfdee152de57d928b8cac9e", "url": "https://github.com/futurewei-cloud/alcor/commit/76b80d0ad2867fcf3bfdee152de57d928b8cac9e", "message": "add eim run", "committedDate": "2020-07-28T22:30:46Z", "type": "commit"}]}