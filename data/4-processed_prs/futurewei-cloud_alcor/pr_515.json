{"pr_number": 515, "pr_title": "Correctly Handle Fields with Null Value for JSON Deserialization", "pr_createdAt": "2020-12-16T02:05:52Z", "pr_url": "https://github.com/futurewei-cloud/alcor/pull/515", "timeline": [{"oid": "711cf41f65e22a75c79b931ee8f7d4d2f782bad7", "url": "https://github.com/futurewei-cloud/alcor/commit/711cf41f65e22a75c79b931ee8f7d4d2f782bad7", "message": "Correctly handle fields whose value is null when json deserialization", "committedDate": "2020-12-16T02:05:05Z", "type": "commit"}, {"oid": "2f324f817241f201d014c4d86fd823b4040f498c", "url": "https://github.com/futurewei-cloud/alcor/commit/2f324f817241f201d014c4d86fd823b4040f498c", "message": "Get port id list by subnet id", "committedDate": "2020-12-16T10:08:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDcyNTQ2Nw==", "url": "https://github.com/futurewei-cloud/alcor/pull/515#discussion_r544725467", "bodyText": "@chenpiaoping This API just need to return # of ports in the subnet, you don't need to return their port ids. Subnet Manager will check this return value when the subnet is going to be deleted.", "author": "cj-chung", "createdAt": "2020-12-17T00:40:33Z", "path": "services/port_manager/src/main/java/com/futurewei/alcor/portmanager/service/PortServiceImpl.java", "diffHunk": "@@ -296,4 +295,9 @@ public RouterUpdateInfo updateL3Neighbors(String projectId, RouterUpdateInfo rou\n \n         return routerUpdateInfo;\n     }\n+\n+    @Override\n+    public SubnetPortIds getSubnetPorts(String projectId, String subnetId) throws Exception {\n+        return portRepository.getSubnetPortIds(subnetId);\n+    }", "originalCommit": "2f324f817241f201d014c4d86fd823b4040f498c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTA1NTI1MQ==", "url": "https://github.com/futurewei-cloud/alcor/pull/515#discussion_r545055251", "bodyText": "fixed, please review again.", "author": "chenpiaoping", "createdAt": "2020-12-17T12:33:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDcyNTQ2Nw=="}], "type": "inlineReview"}, {"oid": "8aca83a133d0c17cf9e4deaedf63e4ab594e39a3", "url": "https://github.com/futurewei-cloud/alcor/commit/8aca83a133d0c17cf9e4deaedf63e4ab594e39a3", "message": "Fix compilation errors", "committedDate": "2020-12-17T07:06:25Z", "type": "commit"}, {"oid": "5f728fa1d6de2cf5e08b75b2a02c0ab9c9e3e5df", "url": "https://github.com/futurewei-cloud/alcor/commit/5f728fa1d6de2cf5e08b75b2a02c0ab9c9e3e5df", "message": "Returns the number of non-gateway port by subnet id", "committedDate": "2020-12-17T08:02:31Z", "type": "commit"}, {"oid": "fa0cd127e0ef1aa36e12caa4873edb37cc1f09b6", "url": "https://github.com/futurewei-cloud/alcor/commit/fa0cd127e0ef1aa36e12caa4873edb37cc1f09b6", "message": "Ignore absent fields in json when deserialization", "committedDate": "2020-12-17T12:29:01Z", "type": "commit"}, {"oid": "fa0cd127e0ef1aa36e12caa4873edb37cc1f09b6", "url": "https://github.com/futurewei-cloud/alcor/commit/fa0cd127e0ef1aa36e12caa4873edb37cc1f09b6", "message": "Ignore absent fields in json when deserialization", "committedDate": "2020-12-17T12:29:01Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTM2NzQ0Ng==", "url": "https://github.com/futurewei-cloud/alcor/pull/515#discussion_r545367446", "bodyText": "@chenpiaoping Should include gateway port here and  distinguish it from a normal port? or add another field for gateway ports?", "author": "cj-chung", "createdAt": "2020-12-17T20:01:22Z", "path": "services/port_manager/src/main/java/com/futurewei/alcor/portmanager/entity/SubnetPortIds.java", "diffHunk": "@@ -0,0 +1,53 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+package com.futurewei.alcor.portmanager.entity;\n+\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+\n+import java.util.Set;\n+\n+public class SubnetPortIds {\n+    @JsonProperty(\"subnet_id\")\n+    private String subnetId;\n+\n+    @JsonProperty(\"port_ids\")\n+    private Set<String> portIds;\n+", "originalCommit": "fa0cd127e0ef1aa36e12caa4873edb37cc1f09b6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTUyMTEwNQ==", "url": "https://github.com/futurewei-cloud/alcor/pull/515#discussion_r545521105", "bodyText": "Right now portIds only contains non-gateway port.", "author": "chenpiaoping", "createdAt": "2020-12-18T01:51:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTM2NzQ0Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTUzNTAzMw==", "url": "https://github.com/futurewei-cloud/alcor/pull/515#discussion_r545535033", "bodyText": "ok", "author": "cj-chung", "createdAt": "2020-12-18T02:36:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTM2NzQ0Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTM4NzgyMw==", "url": "https://github.com/futurewei-cloud/alcor/pull/515#discussion_r545387823", "bodyText": "@chenpiaoping do you think function name getSubnetPortCount would be better? Same as the API name: subnet-port-count.", "author": "cj-chung", "createdAt": "2020-12-17T20:37:03Z", "path": "services/port_manager/src/main/java/com/futurewei/alcor/portmanager/controller/PortController.java", "diffHunk": "@@ -221,4 +221,16 @@ public RouterUpdateInfo updateL3Neighbors(@PathVariable(\"project_id\") String pro\n         checkRouterSubnetUpdateInfo(routerUpdateInfo);\n         return portService.updateL3Neighbors(projectId, routerUpdateInfo);\n     }\n+\n+    @Rbac(resource =\"port\")\n+    @GetMapping({\"/project/{project_id}/subnet-port-number/{subnet_id}\", \"v4/{project_id}/subnet-port-number/{subnet_id}\"})\n+    @DurationStatistics\n+    public int getSubnetPortNumber(@PathVariable(\"project_id\") String projectId,\n+                                             @PathVariable(\"subnet_id\") String subnetId) throws Exception {\n+        if (StringUtil.isNullOrEmpty(subnetId)) {", "originalCommit": "fa0cd127e0ef1aa36e12caa4873edb37cc1f09b6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTUxNzYwOQ==", "url": "https://github.com/futurewei-cloud/alcor/pull/515#discussion_r545517609", "bodyText": "agree", "author": "chenpiaoping", "createdAt": "2020-12-18T01:40:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTM4NzgyMw=="}], "type": "inlineReview"}, {"oid": "0d11b117c8792b2eeab8b38bbabecd367cba1a9f", "url": "https://github.com/futurewei-cloud/alcor/commit/0d11b117c8792b2eeab8b38bbabecd367cba1a9f", "message": "Rename the API name from subnet-port-number to subnet-port-count", "committedDate": "2020-12-18T01:57:43Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTUzMjk1OQ==", "url": "https://github.com/futurewei-cloud/alcor/pull/515#discussion_r545532959", "bodyText": "A constant string would be better.", "author": "xieus", "createdAt": "2020-12-18T02:29:50Z", "path": "services/port_manager/src/main/java/com/futurewei/alcor/portmanager/repo/PortRepository.java", "diffHunk": "@@ -263,6 +264,33 @@ private String getNeighborCacheName(String suffix) {\n         return NEIGHBOR_CACHE_NAME_PREFIX + suffix;\n     }\n \n+    private List<SubnetPortIds> getSubnetPortIds(List<PortEntity> portEntities) {\n+        Map<String, SubnetPortIds> subnetPortIdsMap = new HashMap<>();\n+        for (PortEntity portEntity: portEntities) {\n+            if (\"network:router_interface\".equals(portEntity.getDeviceOwner())) {", "originalCommit": "0d11b117c8792b2eeab8b38bbabecd367cba1a9f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTU0MzcwNw==", "url": "https://github.com/futurewei-cloud/alcor/pull/515#discussion_r545543707", "bodyText": "Fixed, another PR: #519", "author": "chenpiaoping", "createdAt": "2020-12-18T03:05:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTUzMjk1OQ=="}], "type": "inlineReview"}]}