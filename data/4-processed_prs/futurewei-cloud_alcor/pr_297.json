{"pr_number": 297, "pr_title": "[Ignite] Set Ignite Thin Client as the Default Client", "pr_createdAt": "2020-07-13T22:08:31Z", "pr_url": "https://github.com/futurewei-cloud/alcor/pull/297", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzk3MTMxNQ==", "url": "https://github.com/futurewei-cloud/alcor/pull/297#discussion_r453971315", "bodyText": "Let us add one deployment script for Ignite container, which will be a major usage for Ignite.", "author": "xieus", "createdAt": "2020-07-13T22:13:57Z", "path": "scripts/ignite.sh", "diffHunk": "@@ -0,0 +1,5 @@\n+kill -9 `lsof -i:10800|awk '{print $2}'|grep -v PID`\n+cd /root/git/apache-ignite-2.8.1-bin/bin/", "originalCommit": "f4221e3569c3b645e6ceb1e7c58b2468d247250e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQ5NDU0Mg==", "url": "https://github.com/futurewei-cloud/alcor/pull/297#discussion_r454494542", "bodyText": "fixed in 3bfa97f", "author": "haboy52581", "createdAt": "2020-07-14T16:43:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzk3MTMxNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzk3NTE0NQ==", "url": "https://github.com/futurewei-cloud/alcor/pull/297#discussion_r453975145", "bodyText": "For DPM, the assigned port is 9010 https://github.com/futurewei-cloud/alcor/blob/master/services/data_plane_manager/src/main/resources/application.properties.\nLet us change it to 9010:9010.", "author": "xieus", "createdAt": "2020-07-13T22:19:20Z", "path": "scripts/deploy_docker.sh", "diffHunk": "@@ -0,0 +1,27 @@\n+sh ignite.sh\n+sleep 30\n+export IGNITE_HOME=/root/git/apache-ignite-2.8.1-bin/\n+docker stop -f $(docker ps |grep -v rally|awk '{print $1}'|grep -v CON)\n+\n+docker run --rm --net=host --name mm -p 9005:9005 -v /tmp:/tmp -itd mm\n+sleep 2\n+docker run --rm --net=host --name pim -p 9004:9004 -v /tmp:/tmp -itd pim\n+sleep 2\n+docker run --rm --net=host --name rm -p 9003:9003 -v /tmp:/tmp -itd rm\n+sleep 2\n+docker run --rm --net=host --name nm -p 9007:9007 -v /tmp:/tmp -itd nm\n+sleep 2\n+docker run --rm --net=host --name sgm -p 9008:9008 -v /tmp:/tmp -itd sgm\n+sleep 2\n+docker run --rm --net=host --name sm -p 9002:9002 -v /tmp:/tmp -itd sm\n+sleep 2\n+docker run --rm --net=host --name vm -p 9001:9001 -v /tmp:/tmp -itd vm\n+sleep 2\n+docker run --rm --net=host --name dpm -p 9009:9009 -v /tmp:/tmp -itd dpm\n+sleep 2\n+sleep 10\n+docker run --rm --net=host --name pm -p 9006:9006 -v /tmp:/tmp -itd pm\n+sleep 2\n+docker run --rm --net=host --name ag -p 8080:8080  -v /tmp:/tmp -itd ag", "originalCommit": "f4221e3569c3b645e6ceb1e7c58b2468d247250e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzk4OTA1Mg==", "url": "https://github.com/futurewei-cloud/alcor/pull/297#discussion_r453989052", "bodyText": "For API gateway, the assigned port is 9009. Please change to 9009:9009.", "author": "xieus", "createdAt": "2020-07-13T22:43:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzk3NTE0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQ5NDQ2Mw==", "url": "https://github.com/futurewei-cloud/alcor/pull/297#discussion_r454494463", "bodyText": "fixed in 3bfa97f", "author": "haboy52581", "createdAt": "2020-07-14T16:43:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzk3NTE0NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzk3ODc1Mg==", "url": "https://github.com/futurewei-cloud/alcor/pull/297#discussion_r453978752", "bodyText": "For each service, we have the naming conversion, could you update the script by referencing to the doc https://github.com/xieus/alcor/blob/docs/design/docs/modules/ROOT/controller.adoc?", "author": "xieus", "createdAt": "2020-07-13T22:25:27Z", "path": "scripts/deploy_docker.sh", "diffHunk": "@@ -0,0 +1,27 @@\n+sh ignite.sh\n+sleep 30\n+export IGNITE_HOME=/root/git/apache-ignite-2.8.1-bin/\n+docker stop -f $(docker ps |grep -v rally|awk '{print $1}'|grep -v CON)\n+\n+docker run --rm --net=host --name mm -p 9005:9005 -v /tmp:/tmp -itd mm", "originalCommit": "f4221e3569c3b645e6ceb1e7c58b2468d247250e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQ5NDI2NA==", "url": "https://github.com/futurewei-cloud/alcor/pull/297#discussion_r454494264", "bodyText": "fixed in 3bfa97f", "author": "haboy52581", "createdAt": "2020-07-14T16:43:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzk3ODc1Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzk4Nzc2NQ==", "url": "https://github.com/futurewei-cloud/alcor/pull/297#discussion_r453987765", "bodyText": "Need to rename the file with a proper name, which is a basic requirement for every file to be checked in.", "author": "xieus", "createdAt": "2020-07-13T22:40:12Z", "path": "scripts/1", "diffHunk": "@@ -0,0 +1,16 @@\n+{", "originalCommit": "f6bb4a504d011c90cd34c82a890a3fb1e669314e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzk4ODE5OA==", "url": "https://github.com/futurewei-cloud/alcor/pull/297#discussion_r453988198", "bodyText": "Is this file duplicate of scripts/cvpc.json?", "author": "xieus", "createdAt": "2020-07-13T22:41:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzk4Nzc2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQ5NDA3Mg==", "url": "https://github.com/futurewei-cloud/alcor/pull/297#discussion_r454494072", "bodyText": "fixed in 3bfa97f", "author": "haboy52581", "createdAt": "2020-07-14T16:43:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzk4Nzc2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzk4OTE5MA==", "url": "https://github.com/futurewei-cloud/alcor/pull/297#discussion_r453989190", "bodyText": "8080 => 9009 as suggested above.", "author": "xieus", "createdAt": "2020-07-13T22:44:13Z", "path": "scripts/test.sh", "diffHunk": "@@ -0,0 +1,6 @@\n+curl -X POST -H \"Content-Type: application/json\" --data @cvpc.json http://10.213.43.158:8080/project/3dda2801-d675", "originalCommit": "f6bb4a504d011c90cd34c82a890a3fb1e669314e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQ5NDEzMA==", "url": "https://github.com/futurewei-cloud/alcor/pull/297#discussion_r454494130", "bodyText": "fixed in 3bfa97f", "author": "haboy52581", "createdAt": "2020-07-14T16:43:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzk4OTE5MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDU3MDQ0MA==", "url": "https://github.com/futurewei-cloud/alcor/pull/297#discussion_r454570440", "bodyText": "we would need binding host id as well.", "author": "xieus", "createdAt": "2020-07-14T18:48:48Z", "path": "scripts/cp1b.json", "diffHunk": "@@ -0,0 +1,63 @@\n+{\n+  \"port\": {\n+    \"admin_state_up\": true,\n+    \"allowed_address_pairs\": [\n+      {\n+        \"ip_address\": \"11.11.11.1\",\n+        \"mac_address\": \"00-AA-BB-15-EB-3F\"\n+      }\n+    ],\n+    \"binding:profile\": \"string\",\n+    \"binding:vif_details\": \"string\",", "originalCommit": "3bfa97f662d91ef27090a47009fea7716392dcb0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDY5OTk1MA==", "url": "https://github.com/futurewei-cloud/alcor/pull/297#discussion_r454699950", "bodyText": "fixed in ac8819a", "author": "haboy52581", "createdAt": "2020-07-14T23:20:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDU3MDQ0MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDU3MTAzOQ==", "url": "https://github.com/futurewei-cloud/alcor/pull/297#discussion_r454571039", "bodyText": "do we need \"-itd VMM\" or it doesn't matter actually?", "author": "xieus", "createdAt": "2020-07-14T18:49:53Z", "path": "scripts/deploy_docker.sh", "diffHunk": "@@ -0,0 +1,12 @@\n+docker stop -f $(docker ps |grep -v rally|awk '{print $1}'|grep -v CON)\n+docker run -tid  --name ig1 -p 47500:47500 -p 47100:47100 -p 10800:10800 -it apacheignite/ignite:latest\n+docker run --rm --net=host --name VMM -p 9005:9005 -v /tmp:/tmp -itd mm", "originalCommit": "3bfa97f662d91ef27090a47009fea7716392dcb0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDU3NTY0NA==", "url": "https://github.com/futurewei-cloud/alcor/pull/297#discussion_r454575644", "bodyText": "This script has the potential to replace https://github.com/futurewei-cloud/alcor/blob/master/scripts/deploy.sh.\nCould you provide similar features of the current deploy.sh, for example,\n\nadd Ignite deployment with the latest xml you provided\nremove existing containers if conflicted with new deployment\nUbuntu and MacOs support (MacOS is optional) you can do it later when not so busy", "author": "xieus", "createdAt": "2020-07-14T18:58:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDU3MTAzOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDY4MjE2MQ==", "url": "https://github.com/futurewei-cloud/alcor/pull/297#discussion_r454682161", "bodyText": "should we first merge this then create separate issue for replace deploy.sh", "author": "haboy52581", "createdAt": "2020-07-14T22:29:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDU3MTAzOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDY5NzY1Nw==", "url": "https://github.com/futurewei-cloud/alcor/pull/297#discussion_r454697657", "bodyText": "We could merge this PR first but these scripts can be used in a limited scenario (new env, first deployment). We are not far away from replacing deploy.sh therefore this is a good time for deploy.sh.", "author": "xieus", "createdAt": "2020-07-14T23:13:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDU3MTAzOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDY5OTY5OA==", "url": "https://github.com/futurewei-cloud/alcor/pull/297#discussion_r454699698", "bodyText": "we need that tid", "author": "haboy52581", "createdAt": "2020-07-14T23:19:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDU3MTAzOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDY5OTkzMw==", "url": "https://github.com/futurewei-cloud/alcor/pull/297#discussion_r454699933", "bodyText": "I would suggest to merge it first, since the replace work is not simple enough to be contained", "author": "haboy52581", "createdAt": "2020-07-14T23:20:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDU3MTAzOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDU3MjkwOA==", "url": "https://github.com/futurewei-cloud/alcor/pull/297#discussion_r454572908", "bodyText": "Need to register nodes if binding host id is not null.\nAlso I would suggest you to provide similar features as provided in https://github.com/futurewei-cloud/alcor/blob/master/scripts/sampleVpcTest.sh\ne.g. use json_pp to show clear json message, allow users to delete vpc/subnet/port etc.", "author": "xieus", "createdAt": "2020-07-14T18:53:18Z", "path": "scripts/test.sh", "diffHunk": "@@ -0,0 +1,6 @@\n+curl -X POST -H \"Content-Type: application/json\" --data @cvpc.json http://10.213.43.158:9009/project/3dda2801-d675\n+-4688-a63f-dcda8d327f50/vpcs\n+curl -X POST -H \"Content-Type: application/json\" --data @csn.json http://10.213.43.158:9009/project/3dda2801-d675-\n+4688-a63f-dcda8d327f50/subnets\n+curl -X POST -H \"Content-Type: application/json\" --data @cp1b.json http://10.213.43.158:9009/project/3dda2801-d675", "originalCommit": "3bfa97f662d91ef27090a47009fea7716392dcb0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDcwMDExOQ==", "url": "https://github.com/futurewei-cloud/alcor/pull/297#discussion_r454700119", "bodyText": "fixed in ac8819a for the node register, for similar feature i think we could add them in the new issue", "author": "haboy52581", "createdAt": "2020-07-14T23:21:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDU3MjkwOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjIyODAyOQ==", "url": "https://github.com/futurewei-cloud/alcor/pull/297#discussion_r456228029", "bodyText": "@haboy52581 For the scripts that are moved out from this PR, please address the remaining comments left.\nPlease check in your change to a feature branch in your folked repo, instead of the master branch. Refer to https://github.com/futurewei-cloud/alcor/blob/master/docs/README.md for development guidance.", "author": "xieus", "createdAt": "2020-07-17T05:36:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDU3MjkwOA=="}], "type": "inlineReview"}, {"oid": "7a4c530dbadace8e265f2d535a342ad3bdec94b2", "url": "https://github.com/futurewei-cloud/alcor/commit/7a4c530dbadace8e265f2d535a342ad3bdec94b2", "message": "change to use ignite thin client", "committedDate": "2020-07-17T01:19:22Z", "type": "commit"}, {"oid": "7a4c530dbadace8e265f2d535a342ad3bdec94b2", "url": "https://github.com/futurewei-cloud/alcor/commit/7a4c530dbadace8e265f2d535a342ad3bdec94b2", "message": "change to use ignite thin client", "committedDate": "2020-07-17T01:19:22Z", "type": "forcePushed"}]}