{"pr_number": 361, "pr_title": "[Microservice] Route Manager Refactor to Support Neutron Routers", "pr_createdAt": "2020-08-21T23:17:11Z", "pr_url": "https://github.com/futurewei-cloud/alcor/pull/361", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjUwMzc4Nw==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r482503787", "bodyText": "@xieus Do we need admin_state_up attribute for VPC router?\n'admin_state_up' is for neutron router actually. If we don't need it in VPC, we can put this attribute in the neutron specific attribute object which is router_extra_attributes object.", "author": "cj-chung", "createdAt": "2020-09-02T21:44:34Z", "path": "web/src/main/java/com/futurewei/alcor/web/entity/route/NeutronRouterWebRequestObject.java", "diffHunk": "@@ -0,0 +1,100 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+package com.futurewei.alcor.web.entity.route;\n+\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import com.futurewei.alcor.common.entity.CustomerResource;\n+import lombok.Data;\n+import org.springframework.data.annotation.CreatedDate;\n+import org.springframework.data.annotation.LastModifiedDate;\n+\n+import java.util.List;\n+\n+@Data\n+public class NeutronRouterWebRequestObject extends CustomerResource {\n+\n+    @JsonProperty(\"routetable\")\n+    private RouteTable routeTable;\n+\n+    // store vpc_id\n+    @JsonProperty(\"owner\")\n+    private String owner;\n+\n+    // store subnet_gateway_port_id / interface\n+    @JsonProperty(\"ports\")\n+    private List<String> ports;\n+\n+    @JsonProperty(\"tenant_id\")\n+    private String tenantId;\n+\n+    @JsonProperty(\"admin_state_up\")", "originalCommit": "06c30f4298a8ef7b8a8a7567ae5ae352173e7aa6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjUwODk4Ng==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r482508986", "bodyText": "This depends on whether users could leverage this field in the VPC scenario, and how we plan to use this field.\nThe answer to the first question could be NO as user may not have visibility to a VPC router.\nFor the second question, can admin use this field to check L3 routing status or something else?", "author": "xieus", "createdAt": "2020-09-02T21:50:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjUwMzc4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjUxNTQzOQ==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r482515439", "bodyText": "For VPC, I think the router is implicit for user, even for the admin, since one VPC can only has one router. So, admin_state or router_state for VPC is meaningless. In VPC's L3 routing, most of operations are depends on routing tables, but in Neutron's case, they are depends on router.", "author": "cj-chung", "createdAt": "2020-09-02T21:58:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjUwMzc4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzIwNjI1MA==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r483206250", "bodyText": "Combined the fields in one class could make our model cover both vpc and neutron router,  if there is no other effect", "author": "kevin-zhonghao", "createdAt": "2020-09-03T19:28:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjUwMzc4Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjU0Njc0OA==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r482546748", "bodyText": "@kevin-zhonghao There are multiple routetables for a router. It's better rename 'routetable' to 'routetables'", "author": "cj-chung", "createdAt": "2020-09-02T22:32:58Z", "path": "web/src/main/java/com/futurewei/alcor/web/entity/route/Router.java", "diffHunk": "@@ -0,0 +1,78 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+package com.futurewei.alcor.web.entity.route;\n+\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import com.futurewei.alcor.common.entity.CustomerResource;\n+import lombok.Data;\n+import org.springframework.data.annotation.CreatedDate;\n+import org.springframework.data.annotation.LastModifiedDate;\n+\n+import java.util.List;\n+\n+@Data\n+public class Router extends CustomerResource {\n+\n+    @JsonProperty(\"routetable\")", "originalCommit": "06c30f4298a8ef7b8a8a7567ae5ae352173e7aa6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzE5NjYyOQ==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r483196629", "bodyText": "Actually our vpc and subnet still use the previous APIs of route manager, is that correct?", "author": "kevin-zhonghao", "createdAt": "2020-09-03T19:08:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjU0Njc0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzIwNDI0OA==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r483204248", "bodyText": "'routetable' to 'routetables' issue has been fixed", "author": "kevin-zhonghao", "createdAt": "2020-09-03T19:23:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjU0Njc0OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjU1MjkyNw==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r482552927", "bodyText": "@kevin-zhonghao @xieus Again, we need to think about the usage of this attribute 'admin_state_up'. It's for Neutron router only, not for VPC router. Should we put this attribute in the 'router_extra_attribute'?", "author": "cj-chung", "createdAt": "2020-09-02T22:38:11Z", "path": "web/src/main/java/com/futurewei/alcor/web/entity/route/Router.java", "diffHunk": "@@ -0,0 +1,78 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+package com.futurewei.alcor.web.entity.route;\n+\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import com.futurewei.alcor.common.entity.CustomerResource;\n+import lombok.Data;\n+import org.springframework.data.annotation.CreatedDate;\n+import org.springframework.data.annotation.LastModifiedDate;\n+\n+import java.util.List;\n+\n+@Data\n+public class Router extends CustomerResource {\n+\n+    @JsonProperty(\"routetable\")\n+    private RouteTable routeTable;\n+\n+    // store vpc_id\n+    @JsonProperty(\"owner\")\n+    private String owner;\n+\n+    // store vpc_id\n+    @JsonProperty(\"router_extra_attribute_id\")\n+    private String routerExtraAttributeId;\n+\n+    // store subnet_gateway_port_id\n+    @JsonProperty(\"ports\")\n+    private List<String> ports;\n+\n+    @JsonProperty(\"tenant_id\")\n+    private String tenantId;\n+\n+    @JsonProperty(\"admin_state_up\")", "originalCommit": "06c30f4298a8ef7b8a8a7567ae5ae352173e7aa6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzEzNjYwOA==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r483136608", "bodyText": "does it hurt anything if we always assume the admin_state_up=true? In ACA, we don't have admin_state_up concept today so it is assume true.", "author": "er1cthe0ne", "createdAt": "2020-09-03T17:18:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjU1MjkyNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjU2NzQ3Mw==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r482567473", "bodyText": "@kevin-zhonghao Please make sure this call will handle atomically routing rule updating.", "author": "cj-chung", "createdAt": "2020-09-02T22:50:11Z", "path": "services/route_manager/src/main/java/com/futurewei/alcor/route/controller/NeutronRouterController.java", "diffHunk": "@@ -0,0 +1,375 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+package com.futurewei.alcor.route.controller;\n+\n+import com.futurewei.alcor.common.entity.ResponseId;\n+import com.futurewei.alcor.common.exception.ParameterNullOrEmptyException;\n+import com.futurewei.alcor.common.exception.ResourceNotFoundException;\n+import com.futurewei.alcor.common.exception.ResourceNotValidException;\n+import com.futurewei.alcor.common.stats.DurationStatistics;\n+import com.futurewei.alcor.common.utils.ControllerUtil;\n+import com.futurewei.alcor.route.exception.CanNotFindRouter;\n+import com.futurewei.alcor.route.exception.RouterHasAttachedInterfaces;\n+import com.futurewei.alcor.route.service.NeutronRouterService;\n+import com.futurewei.alcor.route.service.RouterDatabaseService;\n+import com.futurewei.alcor.route.service.RouterExtraAttributeDatabaseService;\n+import com.futurewei.alcor.route.utils.RouteManagerUtil;\n+import com.futurewei.alcor.route.utils.RestPreconditionsUtil;\n+import com.futurewei.alcor.web.entity.route.*;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.BeanUtils;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.context.annotation.ComponentScan;\n+import org.springframework.web.bind.annotation.PathVariable;\n+import org.springframework.web.bind.annotation.RequestBody;\n+import org.springframework.web.bind.annotation.RequestMapping;\n+import org.springframework.web.bind.annotation.RestController;\n+import org.thymeleaf.util.StringUtils;\n+\n+import javax.servlet.http.HttpServletRequest;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.UUID;\n+\n+import static org.springframework.web.bind.annotation.RequestMethod.*;\n+\n+@RestController\n+@ComponentScan(value = \"com.futurewei.alcor.common.stats\")\n+public class NeutronRouterController {\n+\n+    private Logger logger = LoggerFactory.getLogger(this.getClass());\n+\n+    @Autowired\n+    private RouterDatabaseService routerDatabaseService;\n+\n+    @Autowired\n+    private RouterExtraAttributeDatabaseService routerExtraAttributeDatabaseService;\n+\n+    @Autowired\n+    private NeutronRouterService neutronRouterService;\n+\n+    @Autowired\n+    private HttpServletRequest request;\n+\n+    /**\n+     * Show a Neutron router\n+     * @param routerid\n+     * @param projectid\n+     * @return\n+     * @throws Exception\n+     */\n+    @RequestMapping(\n+            method = GET,\n+            value = {\"/project/{projectid}/routers/{routerid}\"})\n+    @DurationStatistics\n+    public NeutronRouterWebJson getNeutronRouterByRouterId(@PathVariable String projectid,@PathVariable String routerid) throws Exception {\n+\n+        NeutronRouterWebRequestObject neutronRouterWebRequestObject = null;\n+\n+        try {\n+            RestPreconditionsUtil.verifyParameterNotNullorEmpty(routerid);\n+            RestPreconditionsUtil.verifyParameterNotNullorEmpty(projectid);\n+            RestPreconditionsUtil.verifyResourceFound(projectid);\n+\n+            neutronRouterWebRequestObject = this.neutronRouterService.getNeutronRouter(routerid);\n+\n+        } catch (ParameterNullOrEmptyException e) {\n+            throw e;\n+        } catch (CanNotFindRouter e) {\n+            logger.error(e.getMessage() + \" : \" + routerid);\n+            return new NeutronRouterWebJson();\n+        }\n+\n+        return new NeutronRouterWebJson(neutronRouterWebRequestObject);\n+    }\n+\n+    /**\n+     * List Neutron routers\n+     * @param projectid\n+     * @return\n+     * @throws Exception\n+     */\n+    @RequestMapping(\n+            method = GET,\n+            value = {\"/project/{projectid}/routers\"})\n+    @DurationStatistics\n+    public NeutronRoutersWebJson getNeutronRouters(@PathVariable String projectid) throws Exception {\n+\n+        List<NeutronRouterWebRequestObject> neutronRouters = new ArrayList<>();\n+\n+        Map<String, Router> routers = null;\n+        RouterExtraAttribute routerExtraAttribute = null;\n+\n+        Map<String, Object[]> queryParams =\n+                ControllerUtil.transformUrlPathParams(request.getParameterMap(), Router.class);\n+\n+        ControllerUtil.handleUserRoles(request.getHeader(ControllerUtil.TOKEN_INFO_HEADER), queryParams);\n+        try {\n+            RestPreconditionsUtil.verifyParameterNotNullorEmpty(projectid);\n+            RestPreconditionsUtil.verifyResourceFound(projectid);\n+\n+            routers = this.routerDatabaseService.getAllRouters(queryParams);\n+            if (routers == null) {\n+                return new NeutronRoutersWebJson();\n+            }\n+\n+            for (Map.Entry<String, Router> entry : routers.entrySet()) {\n+                NeutronRouterWebRequestObject neutronRouterWebRequestObject = new NeutronRouterWebRequestObject();\n+                Router router = (Router) entry.getValue();\n+                String routerExtraAttributeId = router.getRouterExtraAttributeId();\n+                if (routerExtraAttributeId != null && !routerExtraAttributeId.equals(\"\")) {\n+                    routerExtraAttribute = this.routerExtraAttributeDatabaseService.getByRouterExtraAttributeId(routerExtraAttributeId);\n+                }\n+\n+                BeanUtils.copyProperties(router, neutronRouterWebRequestObject);\n+                if (routerExtraAttribute != null) {\n+                    BeanUtils.copyProperties(routerExtraAttribute, neutronRouterWebRequestObject);\n+                }\n+\n+                neutronRouters.add(neutronRouterWebRequestObject);\n+            }\n+\n+        } catch (ParameterNullOrEmptyException e) {\n+            throw new Exception(e);\n+        } catch (ResourceNotFoundException e) {\n+            throw new Exception(e);\n+        }\n+\n+        return new NeutronRoutersWebJson(neutronRouters);\n+    }\n+\n+    /**\n+     * Create a Neutron router\n+     * @param projectid\n+     * @param resource\n+     * @return\n+     * @throws Exception\n+     */\n+    @RequestMapping(\n+            method = POST,\n+            value = {\"/project/{projectid}/routers\"})\n+    @DurationStatistics\n+    public NeutronRouterWebJson createNeutronRouters(@PathVariable String projectid, @RequestBody NeutronRouterWebJson resource) throws Exception {\n+\n+        NeutronRouterWebRequestObject neutronRouterWebRequestObject = null;\n+\n+        try {\n+            RestPreconditionsUtil.verifyParameterNotNullorEmpty(projectid);\n+\n+            // check resource\n+            if (!RouteManagerUtil.checkNeutronRouterWebResourceIsValid(resource)) {\n+                throw new ResourceNotValidException(\"request resource is invalid\");\n+            }\n+\n+            neutronRouterWebRequestObject = resource.getRouter();\n+            String id = neutronRouterWebRequestObject.getId();\n+\n+            if (id == null || StringUtils.isEmpty(id)) {\n+                UUID routerId = UUID.randomUUID();\n+                neutronRouterWebRequestObject.setId(routerId.toString());\n+            }\n+            RestPreconditionsUtil.verifyResourceNotNull(neutronRouterWebRequestObject);\n+\n+            // configure default value\n+            neutronRouterWebRequestObject = RouteManagerUtil.configureNeutronRouterParameters(neutronRouterWebRequestObject);\n+\n+            // save router and router_extra_attribute\n+            neutronRouterWebRequestObject = this.neutronRouterService.saveRouterAndRouterExtraAttribute(neutronRouterWebRequestObject);\n+\n+        } catch (Exception e) {\n+            throw e;\n+        }\n+\n+        return new NeutronRouterWebJson(neutronRouterWebRequestObject);\n+    }\n+\n+    /**\n+     * Update a Neutron router\n+     * @param projectid\n+     * @param routerid\n+     * @param resource\n+     * @return\n+     * @throws Exception\n+     */\n+    @RequestMapping(\n+            method = PUT,\n+            value = {\"/project/{projectid}/routers/{routerid}\"})\n+    @DurationStatistics\n+    public NeutronRouterWebJson updateNeutronRouterByRouterId(@PathVariable String projectid,@PathVariable String routerid, @RequestBody NeutronRouterWebJson resource) throws Exception {\n+        NeutronRouterWebRequestObject neutronRouterWebRequestObject = null;\n+\n+        try {\n+            RestPreconditionsUtil.verifyParameterNotNullorEmpty(projectid);\n+\n+            // check resource\n+            if (!RouteManagerUtil.checkNeutronRouterWebResourceIsValid(resource)) {\n+                throw new ResourceNotValidException(\"request resource is invalid\");\n+            }\n+\n+            neutronRouterWebRequestObject = resource.getRouter();\n+            NeutronRouterWebRequestObject inNeutronRouter = this.neutronRouterService.getNeutronRouter(routerid);\n+\n+            RouteManagerUtil.copyPropertiesIgnoreNull(neutronRouterWebRequestObject, inNeutronRouter);\n+\n+            // configure default value\n+            neutronRouterWebRequestObject = RouteManagerUtil.configureNeutronRouterParameters(neutronRouterWebRequestObject);", "originalCommit": "06c30f4298a8ef7b8a8a7567ae5ae352173e7aa6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzI1ODkwOQ==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r483258909", "bodyText": "Got it", "author": "kevin-zhonghao", "createdAt": "2020-09-03T21:17:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjU2NzQ3Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjU3MDc0OQ==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r482570749", "bodyText": "@kevin-zhonghao If there are gateway ports for subnets still in this router, the deletion should return error message to user.", "author": "cj-chung", "createdAt": "2020-09-02T22:52:54Z", "path": "services/route_manager/src/main/java/com/futurewei/alcor/route/controller/NeutronRouterController.java", "diffHunk": "@@ -0,0 +1,375 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+package com.futurewei.alcor.route.controller;\n+\n+import com.futurewei.alcor.common.entity.ResponseId;\n+import com.futurewei.alcor.common.exception.ParameterNullOrEmptyException;\n+import com.futurewei.alcor.common.exception.ResourceNotFoundException;\n+import com.futurewei.alcor.common.exception.ResourceNotValidException;\n+import com.futurewei.alcor.common.stats.DurationStatistics;\n+import com.futurewei.alcor.common.utils.ControllerUtil;\n+import com.futurewei.alcor.route.exception.CanNotFindRouter;\n+import com.futurewei.alcor.route.exception.RouterHasAttachedInterfaces;\n+import com.futurewei.alcor.route.service.NeutronRouterService;\n+import com.futurewei.alcor.route.service.RouterDatabaseService;\n+import com.futurewei.alcor.route.service.RouterExtraAttributeDatabaseService;\n+import com.futurewei.alcor.route.utils.RouteManagerUtil;\n+import com.futurewei.alcor.route.utils.RestPreconditionsUtil;\n+import com.futurewei.alcor.web.entity.route.*;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.BeanUtils;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.context.annotation.ComponentScan;\n+import org.springframework.web.bind.annotation.PathVariable;\n+import org.springframework.web.bind.annotation.RequestBody;\n+import org.springframework.web.bind.annotation.RequestMapping;\n+import org.springframework.web.bind.annotation.RestController;\n+import org.thymeleaf.util.StringUtils;\n+\n+import javax.servlet.http.HttpServletRequest;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.UUID;\n+\n+import static org.springframework.web.bind.annotation.RequestMethod.*;\n+\n+@RestController\n+@ComponentScan(value = \"com.futurewei.alcor.common.stats\")\n+public class NeutronRouterController {\n+\n+    private Logger logger = LoggerFactory.getLogger(this.getClass());\n+\n+    @Autowired\n+    private RouterDatabaseService routerDatabaseService;\n+\n+    @Autowired\n+    private RouterExtraAttributeDatabaseService routerExtraAttributeDatabaseService;\n+\n+    @Autowired\n+    private NeutronRouterService neutronRouterService;\n+\n+    @Autowired\n+    private HttpServletRequest request;\n+\n+    /**\n+     * Show a Neutron router\n+     * @param routerid\n+     * @param projectid\n+     * @return\n+     * @throws Exception\n+     */\n+    @RequestMapping(\n+            method = GET,\n+            value = {\"/project/{projectid}/routers/{routerid}\"})\n+    @DurationStatistics\n+    public NeutronRouterWebJson getNeutronRouterByRouterId(@PathVariable String projectid,@PathVariable String routerid) throws Exception {\n+\n+        NeutronRouterWebRequestObject neutronRouterWebRequestObject = null;\n+\n+        try {\n+            RestPreconditionsUtil.verifyParameterNotNullorEmpty(routerid);\n+            RestPreconditionsUtil.verifyParameterNotNullorEmpty(projectid);\n+            RestPreconditionsUtil.verifyResourceFound(projectid);\n+\n+            neutronRouterWebRequestObject = this.neutronRouterService.getNeutronRouter(routerid);\n+\n+        } catch (ParameterNullOrEmptyException e) {\n+            throw e;\n+        } catch (CanNotFindRouter e) {\n+            logger.error(e.getMessage() + \" : \" + routerid);\n+            return new NeutronRouterWebJson();\n+        }\n+\n+        return new NeutronRouterWebJson(neutronRouterWebRequestObject);\n+    }\n+\n+    /**\n+     * List Neutron routers\n+     * @param projectid\n+     * @return\n+     * @throws Exception\n+     */\n+    @RequestMapping(\n+            method = GET,\n+            value = {\"/project/{projectid}/routers\"})\n+    @DurationStatistics\n+    public NeutronRoutersWebJson getNeutronRouters(@PathVariable String projectid) throws Exception {\n+\n+        List<NeutronRouterWebRequestObject> neutronRouters = new ArrayList<>();\n+\n+        Map<String, Router> routers = null;\n+        RouterExtraAttribute routerExtraAttribute = null;\n+\n+        Map<String, Object[]> queryParams =\n+                ControllerUtil.transformUrlPathParams(request.getParameterMap(), Router.class);\n+\n+        ControllerUtil.handleUserRoles(request.getHeader(ControllerUtil.TOKEN_INFO_HEADER), queryParams);\n+        try {\n+            RestPreconditionsUtil.verifyParameterNotNullorEmpty(projectid);\n+            RestPreconditionsUtil.verifyResourceFound(projectid);\n+\n+            routers = this.routerDatabaseService.getAllRouters(queryParams);\n+            if (routers == null) {\n+                return new NeutronRoutersWebJson();\n+            }\n+\n+            for (Map.Entry<String, Router> entry : routers.entrySet()) {\n+                NeutronRouterWebRequestObject neutronRouterWebRequestObject = new NeutronRouterWebRequestObject();\n+                Router router = (Router) entry.getValue();\n+                String routerExtraAttributeId = router.getRouterExtraAttributeId();\n+                if (routerExtraAttributeId != null && !routerExtraAttributeId.equals(\"\")) {\n+                    routerExtraAttribute = this.routerExtraAttributeDatabaseService.getByRouterExtraAttributeId(routerExtraAttributeId);\n+                }\n+\n+                BeanUtils.copyProperties(router, neutronRouterWebRequestObject);\n+                if (routerExtraAttribute != null) {\n+                    BeanUtils.copyProperties(routerExtraAttribute, neutronRouterWebRequestObject);\n+                }\n+\n+                neutronRouters.add(neutronRouterWebRequestObject);\n+            }\n+\n+        } catch (ParameterNullOrEmptyException e) {\n+            throw new Exception(e);\n+        } catch (ResourceNotFoundException e) {\n+            throw new Exception(e);\n+        }\n+\n+        return new NeutronRoutersWebJson(neutronRouters);\n+    }\n+\n+    /**\n+     * Create a Neutron router\n+     * @param projectid\n+     * @param resource\n+     * @return\n+     * @throws Exception\n+     */\n+    @RequestMapping(\n+            method = POST,\n+            value = {\"/project/{projectid}/routers\"})\n+    @DurationStatistics\n+    public NeutronRouterWebJson createNeutronRouters(@PathVariable String projectid, @RequestBody NeutronRouterWebJson resource) throws Exception {\n+\n+        NeutronRouterWebRequestObject neutronRouterWebRequestObject = null;\n+\n+        try {\n+            RestPreconditionsUtil.verifyParameterNotNullorEmpty(projectid);\n+\n+            // check resource\n+            if (!RouteManagerUtil.checkNeutronRouterWebResourceIsValid(resource)) {\n+                throw new ResourceNotValidException(\"request resource is invalid\");\n+            }\n+\n+            neutronRouterWebRequestObject = resource.getRouter();\n+            String id = neutronRouterWebRequestObject.getId();\n+\n+            if (id == null || StringUtils.isEmpty(id)) {\n+                UUID routerId = UUID.randomUUID();\n+                neutronRouterWebRequestObject.setId(routerId.toString());\n+            }\n+            RestPreconditionsUtil.verifyResourceNotNull(neutronRouterWebRequestObject);\n+\n+            // configure default value\n+            neutronRouterWebRequestObject = RouteManagerUtil.configureNeutronRouterParameters(neutronRouterWebRequestObject);\n+\n+            // save router and router_extra_attribute\n+            neutronRouterWebRequestObject = this.neutronRouterService.saveRouterAndRouterExtraAttribute(neutronRouterWebRequestObject);\n+\n+        } catch (Exception e) {\n+            throw e;\n+        }\n+\n+        return new NeutronRouterWebJson(neutronRouterWebRequestObject);\n+    }\n+\n+    /**\n+     * Update a Neutron router\n+     * @param projectid\n+     * @param routerid\n+     * @param resource\n+     * @return\n+     * @throws Exception\n+     */\n+    @RequestMapping(\n+            method = PUT,\n+            value = {\"/project/{projectid}/routers/{routerid}\"})\n+    @DurationStatistics\n+    public NeutronRouterWebJson updateNeutronRouterByRouterId(@PathVariable String projectid,@PathVariable String routerid, @RequestBody NeutronRouterWebJson resource) throws Exception {\n+        NeutronRouterWebRequestObject neutronRouterWebRequestObject = null;\n+\n+        try {\n+            RestPreconditionsUtil.verifyParameterNotNullorEmpty(projectid);\n+\n+            // check resource\n+            if (!RouteManagerUtil.checkNeutronRouterWebResourceIsValid(resource)) {\n+                throw new ResourceNotValidException(\"request resource is invalid\");\n+            }\n+\n+            neutronRouterWebRequestObject = resource.getRouter();\n+            NeutronRouterWebRequestObject inNeutronRouter = this.neutronRouterService.getNeutronRouter(routerid);\n+\n+            RouteManagerUtil.copyPropertiesIgnoreNull(neutronRouterWebRequestObject, inNeutronRouter);\n+\n+            // configure default value\n+            neutronRouterWebRequestObject = RouteManagerUtil.configureNeutronRouterParameters(neutronRouterWebRequestObject);\n+\n+        } catch (ParameterNullOrEmptyException e) {\n+            throw e;\n+        } catch (CanNotFindRouter e) {\n+            throw e;\n+        }\n+\n+        return new NeutronRouterWebJson(neutronRouterWebRequestObject);\n+    }\n+\n+    @RequestMapping(\n+            method = DELETE,\n+            value = {\"/project/{projectid}/routers/{routerid}\"})\n+    @DurationStatistics\n+    public ResponseId deleteNeutronRouterByRouterId(@PathVariable String projectid, @PathVariable String routerid) throws Exception {\n+\n+        RestPreconditionsUtil.verifyParameterNotNullorEmpty(projectid);\n+        RestPreconditionsUtil.verifyParameterNotNullorEmpty(routerid);\n+        RestPreconditionsUtil.verifyResourceFound(projectid);\n+\n+        Router router = this.routerDatabaseService.getByRouterId(routerid);\n+        if (router == null) {\n+            return new ResponseId();\n+        }\n+        List<String> ports = router.getPorts();\n+        if (ports != null && ports.size() != 0) {\n+            throw new RouterHasAttachedInterfaces();\n+        }\n+        this.routerDatabaseService.deleteRouter(routerid);", "originalCommit": "06c30f4298a8ef7b8a8a7567ae5ae352173e7aa6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzI3OTQ3MA==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r483279470", "bodyText": "left the comment for future already", "author": "kevin-zhonghao", "createdAt": "2020-09-03T22:07:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjU3MDc0OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjczNDcyNw==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r482734727", "bodyText": "@kevin-zhonghao We need to maintain the mapping for new added port and it's subnet in the Route Manager, did you maintain this mapping in this function?", "author": "cj-chung", "createdAt": "2020-09-03T06:33:06Z", "path": "services/route_manager/src/main/java/com/futurewei/alcor/route/service/Impl/NeutronRouterServiceImpl.java", "diffHunk": "@@ -0,0 +1,484 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+package com.futurewei.alcor.route.service.Impl;\n+\n+import com.futurewei.alcor.common.enumClass.RouteTableType;\n+import com.futurewei.alcor.common.exception.DatabasePersistenceException;\n+import com.futurewei.alcor.common.exception.ResourceNotFoundException;\n+import com.futurewei.alcor.common.exception.ResourcePersistenceException;\n+import com.futurewei.alcor.route.exception.*;\n+import com.futurewei.alcor.route.service.NeutronRouterService;\n+import com.futurewei.alcor.route.service.NeutronRouterToSubnetService;\n+import com.futurewei.alcor.route.service.RouterDatabaseService;\n+import com.futurewei.alcor.route.service.RouterExtraAttributeDatabaseService;\n+import com.futurewei.alcor.web.entity.port.PortEntity;\n+import com.futurewei.alcor.web.entity.route.*;\n+import com.futurewei.alcor.web.entity.subnet.SubnetEntity;\n+import com.futurewei.alcor.web.entity.subnet.SubnetWebJson;\n+import com.futurewei.alcor.web.entity.subnet.SubnetsWebJson;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.BeanUtils;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.stereotype.Service;\n+\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.UUID;\n+\n+@Service\n+public class NeutronRouterServiceImpl implements NeutronRouterService {\n+\n+    private Logger logger = LoggerFactory.getLogger(this.getClass());\n+\n+    @Autowired\n+    private NeutronRouterToSubnetService routerToSubnetService;\n+\n+    @Autowired\n+    private RouterDatabaseService routerDatabaseService;\n+\n+    @Autowired\n+    private RouterExtraAttributeDatabaseService routerExtraAttributeDatabaseService;\n+\n+    @Override\n+    public NeutronRouterWebRequestObject getNeutronRouter(String routerId) throws ResourceNotFoundException, ResourcePersistenceException, CanNotFindRouter {\n+        NeutronRouterWebRequestObject neutronRouterWebRequestObject = new NeutronRouterWebRequestObject();\n+\n+        Router router = this.routerDatabaseService.getByRouterId(routerId);\n+        if (router == null) {\n+            throw new CanNotFindRouter();\n+        }\n+\n+        RouterExtraAttribute routerExtraAttribute = this.routerExtraAttributeDatabaseService.getByRouterExtraAttributeId(router.getRouterExtraAttributeId());\n+\n+        BeanUtils.copyProperties(router, neutronRouterWebRequestObject);\n+        RouteTable routeTable = router.getRouteTable();\n+        neutronRouterWebRequestObject.setRouteTable(routeTable);\n+        if (routerExtraAttribute != null) {\n+            BeanUtils.copyProperties(routerExtraAttribute, neutronRouterWebRequestObject);\n+            neutronRouterWebRequestObject.setId(routerId);\n+        }\n+        return neutronRouterWebRequestObject;\n+    }\n+\n+    @Override\n+    public NeutronRouterWebRequestObject saveRouterAndRouterExtraAttribute(NeutronRouterWebRequestObject neutronRouter) throws NeutronRouterIsNull, DatabasePersistenceException {\n+        if (neutronRouter == null) {\n+            throw new NeutronRouterIsNull();\n+        }\n+        NeutronRouterWebRequestObject inNeutronRouter = new NeutronRouterWebRequestObject();\n+        BeanUtils.copyProperties(neutronRouter, inNeutronRouter);\n+\n+        String attachedRouterExtraAttributeId = UUID.randomUUID().toString();\n+\n+        Router router = new Router();\n+        RouterExtraAttribute routerExtraAttribute = new RouterExtraAttribute();\n+\n+        BeanUtils.copyProperties(neutronRouter, router);\n+        BeanUtils.copyProperties(neutronRouter, routerExtraAttribute);\n+        routerExtraAttribute.setId(attachedRouterExtraAttributeId);\n+        RouteTable routeTable = neutronRouter.getRouteTable();\n+        if (routeTable == null) {\n+            routeTable = new RouteTable();\n+            List<RouteEntry> routeEntities = new ArrayList<>();\n+            String routeTableId = UUID.randomUUID().toString();\n+            routeTable.setId(routeTableId);\n+            routeTable.setRouteEntities(routeEntities);\n+            routeTable.setRouteTableType(RouteTableType.NEUTRON);\n+        }\n+        router.setRouteTable(routeTable);\n+        router.setRouterExtraAttributeId(attachedRouterExtraAttributeId);\n+        inNeutronRouter.setRouteTable(routeTable);\n+\n+        this.routerDatabaseService.addRouter(router);\n+        this.routerExtraAttributeDatabaseService.addRouterExtraAttribute(routerExtraAttribute);\n+\n+\n+        return inNeutronRouter;\n+\n+    }\n+\n+    @Override\n+    public RouterInterfaceResponse addAnInterfaceToNeutronRouter(String projectid, String portId, String subnetId, String routerId) throws SpecifyBothSubnetIDAndPortID, ResourceNotFoundException, ResourcePersistenceException, CanNotFindRouter, DatabasePersistenceException, PortIDIsAlreadyExist, PortIsAlreadyInUse, SubnetNotBindUniquePortId {\n+        if (portId != null && subnetId != null) {\n+            throw new SpecifyBothSubnetIDAndPortID();\n+        }\n+\n+        SubnetEntity subnet = null;\n+        String subnetid = null;\n+        String projectId = null;\n+        String attachedRouterId = null;\n+\n+        // Only pass in the value of the port\n+        if (portId != null && subnetId == null) {\n+\n+            // get subnet by port id\n+            SubnetsWebJson subnetsWebJson = this.routerToSubnetService.getSubnetsByPortId(projectid, portId);\n+            if (subnetsWebJson == null) {\n+                return new RouterInterfaceResponse();\n+            }\n+            ArrayList<SubnetEntity> subnets = subnetsWebJson.getSubnets();\n+            if (subnets.size() == 0) {\n+                return new RouterInterfaceResponse();\n+            }\n+            if (subnets.size() != 1) {\n+                throw new SubnetNotBindUniquePortId();\n+            }\n+            subnet = subnets.get(0);\n+            subnetid = subnet.getId();\n+        }\n+        // Only pass in the value of the subnet\n+        else if (portId == null && subnetId != null) {\n+\n+            // get subnet by subnet id\n+            SubnetWebJson subnetWebJson = this.routerToSubnetService.getSubnet(projectid, subnetId);\n+            subnet = subnetWebJson.getSubnet();\n+            if (subnet == null) {\n+                logger.warn(\"can not find subnet by subnet id :\" + subnetId);\n+                return new RouterInterfaceResponse();\n+            }\n+            subnetid = subnetId;\n+        } else {\n+            return new RouterInterfaceResponse();\n+        }\n+        projectId = subnet.getProjectId();\n+        portId = subnet.getGatewayPortId();\n+        attachedRouterId = subnet.getAttachedRouterId();\n+\n+        // check if port_id is used by other router\n+        if (attachedRouterId != null && !attachedRouterId.equals(\"\")) {\n+            throw new PortIsAlreadyInUse();\n+        }\n+        subnet.setAttachedRouterId(routerId);\n+\n+        // update device_id and device_owner\n+        PortEntity portEntity = new PortEntity();\n+        portEntity.setDeviceId(routerId);\n+        portEntity.setDeviceOwner(\"network:router_interface\");\n+        subnet.setPort(portEntity);\n+\n+        // update subnet\n+        this.routerToSubnetService.updateSubnet(projectId, subnetid, subnet);\n+", "originalCommit": "06c30f4298a8ef7b8a8a7567ae5ae352173e7aa6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzI3MDg4MA==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r483270880", "bodyText": "I could modify this in the next PR as we talked about", "author": "kevin-zhonghao", "createdAt": "2020-09-03T21:45:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjczNDcyNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjczODM1NQ==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r482738355", "bodyText": "@kevin-zhonghao After successfully attached interface to router, we also need to return all connected subnet-ids to Port Manager. The algorithm as follow:\n\nget ports array from the router.\nget subnet-ids from the mapping table of port-subnet for all ports.\ncall Port Manager's /project/{project_id}/update-l3-neighbors/{new_subnet_id} with BODY {operation_type, vpcid, [old_subnet_ids]}.", "author": "cj-chung", "createdAt": "2020-09-03T06:40:08Z", "path": "services/route_manager/src/main/java/com/futurewei/alcor/route/controller/NeutronRouterController.java", "diffHunk": "@@ -0,0 +1,375 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+package com.futurewei.alcor.route.controller;\n+\n+import com.futurewei.alcor.common.entity.ResponseId;\n+import com.futurewei.alcor.common.exception.ParameterNullOrEmptyException;\n+import com.futurewei.alcor.common.exception.ResourceNotFoundException;\n+import com.futurewei.alcor.common.exception.ResourceNotValidException;\n+import com.futurewei.alcor.common.stats.DurationStatistics;\n+import com.futurewei.alcor.common.utils.ControllerUtil;\n+import com.futurewei.alcor.route.exception.CanNotFindRouter;\n+import com.futurewei.alcor.route.exception.RouterHasAttachedInterfaces;\n+import com.futurewei.alcor.route.service.NeutronRouterService;\n+import com.futurewei.alcor.route.service.RouterDatabaseService;\n+import com.futurewei.alcor.route.service.RouterExtraAttributeDatabaseService;\n+import com.futurewei.alcor.route.utils.RouteManagerUtil;\n+import com.futurewei.alcor.route.utils.RestPreconditionsUtil;\n+import com.futurewei.alcor.web.entity.route.*;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.BeanUtils;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.context.annotation.ComponentScan;\n+import org.springframework.web.bind.annotation.PathVariable;\n+import org.springframework.web.bind.annotation.RequestBody;\n+import org.springframework.web.bind.annotation.RequestMapping;\n+import org.springframework.web.bind.annotation.RestController;\n+import org.thymeleaf.util.StringUtils;\n+\n+import javax.servlet.http.HttpServletRequest;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.UUID;\n+\n+import static org.springframework.web.bind.annotation.RequestMethod.*;\n+\n+@RestController\n+@ComponentScan(value = \"com.futurewei.alcor.common.stats\")\n+public class NeutronRouterController {\n+\n+    private Logger logger = LoggerFactory.getLogger(this.getClass());\n+\n+    @Autowired\n+    private RouterDatabaseService routerDatabaseService;\n+\n+    @Autowired\n+    private RouterExtraAttributeDatabaseService routerExtraAttributeDatabaseService;\n+\n+    @Autowired\n+    private NeutronRouterService neutronRouterService;\n+\n+    @Autowired\n+    private HttpServletRequest request;\n+\n+    /**\n+     * Show a Neutron router\n+     * @param routerid\n+     * @param projectid\n+     * @return\n+     * @throws Exception\n+     */\n+    @RequestMapping(\n+            method = GET,\n+            value = {\"/project/{projectid}/routers/{routerid}\"})\n+    @DurationStatistics\n+    public NeutronRouterWebJson getNeutronRouterByRouterId(@PathVariable String projectid,@PathVariable String routerid) throws Exception {\n+\n+        NeutronRouterWebRequestObject neutronRouterWebRequestObject = null;\n+\n+        try {\n+            RestPreconditionsUtil.verifyParameterNotNullorEmpty(routerid);\n+            RestPreconditionsUtil.verifyParameterNotNullorEmpty(projectid);\n+            RestPreconditionsUtil.verifyResourceFound(projectid);\n+\n+            neutronRouterWebRequestObject = this.neutronRouterService.getNeutronRouter(routerid);\n+\n+        } catch (ParameterNullOrEmptyException e) {\n+            throw e;\n+        } catch (CanNotFindRouter e) {\n+            logger.error(e.getMessage() + \" : \" + routerid);\n+            return new NeutronRouterWebJson();\n+        }\n+\n+        return new NeutronRouterWebJson(neutronRouterWebRequestObject);\n+    }\n+\n+    /**\n+     * List Neutron routers\n+     * @param projectid\n+     * @return\n+     * @throws Exception\n+     */\n+    @RequestMapping(\n+            method = GET,\n+            value = {\"/project/{projectid}/routers\"})\n+    @DurationStatistics\n+    public NeutronRoutersWebJson getNeutronRouters(@PathVariable String projectid) throws Exception {\n+\n+        List<NeutronRouterWebRequestObject> neutronRouters = new ArrayList<>();\n+\n+        Map<String, Router> routers = null;\n+        RouterExtraAttribute routerExtraAttribute = null;\n+\n+        Map<String, Object[]> queryParams =\n+                ControllerUtil.transformUrlPathParams(request.getParameterMap(), Router.class);\n+\n+        ControllerUtil.handleUserRoles(request.getHeader(ControllerUtil.TOKEN_INFO_HEADER), queryParams);\n+        try {\n+            RestPreconditionsUtil.verifyParameterNotNullorEmpty(projectid);\n+            RestPreconditionsUtil.verifyResourceFound(projectid);\n+\n+            routers = this.routerDatabaseService.getAllRouters(queryParams);\n+            if (routers == null) {\n+                return new NeutronRoutersWebJson();\n+            }\n+\n+            for (Map.Entry<String, Router> entry : routers.entrySet()) {\n+                NeutronRouterWebRequestObject neutronRouterWebRequestObject = new NeutronRouterWebRequestObject();\n+                Router router = (Router) entry.getValue();\n+                String routerExtraAttributeId = router.getRouterExtraAttributeId();\n+                if (routerExtraAttributeId != null && !routerExtraAttributeId.equals(\"\")) {\n+                    routerExtraAttribute = this.routerExtraAttributeDatabaseService.getByRouterExtraAttributeId(routerExtraAttributeId);\n+                }\n+\n+                BeanUtils.copyProperties(router, neutronRouterWebRequestObject);\n+                if (routerExtraAttribute != null) {\n+                    BeanUtils.copyProperties(routerExtraAttribute, neutronRouterWebRequestObject);\n+                }\n+\n+                neutronRouters.add(neutronRouterWebRequestObject);\n+            }\n+\n+        } catch (ParameterNullOrEmptyException e) {\n+            throw new Exception(e);\n+        } catch (ResourceNotFoundException e) {\n+            throw new Exception(e);\n+        }\n+\n+        return new NeutronRoutersWebJson(neutronRouters);\n+    }\n+\n+    /**\n+     * Create a Neutron router\n+     * @param projectid\n+     * @param resource\n+     * @return\n+     * @throws Exception\n+     */\n+    @RequestMapping(\n+            method = POST,\n+            value = {\"/project/{projectid}/routers\"})\n+    @DurationStatistics\n+    public NeutronRouterWebJson createNeutronRouters(@PathVariable String projectid, @RequestBody NeutronRouterWebJson resource) throws Exception {\n+\n+        NeutronRouterWebRequestObject neutronRouterWebRequestObject = null;\n+\n+        try {\n+            RestPreconditionsUtil.verifyParameterNotNullorEmpty(projectid);\n+\n+            // check resource\n+            if (!RouteManagerUtil.checkNeutronRouterWebResourceIsValid(resource)) {\n+                throw new ResourceNotValidException(\"request resource is invalid\");\n+            }\n+\n+            neutronRouterWebRequestObject = resource.getRouter();\n+            String id = neutronRouterWebRequestObject.getId();\n+\n+            if (id == null || StringUtils.isEmpty(id)) {\n+                UUID routerId = UUID.randomUUID();\n+                neutronRouterWebRequestObject.setId(routerId.toString());\n+            }\n+            RestPreconditionsUtil.verifyResourceNotNull(neutronRouterWebRequestObject);\n+\n+            // configure default value\n+            neutronRouterWebRequestObject = RouteManagerUtil.configureNeutronRouterParameters(neutronRouterWebRequestObject);\n+\n+            // save router and router_extra_attribute\n+            neutronRouterWebRequestObject = this.neutronRouterService.saveRouterAndRouterExtraAttribute(neutronRouterWebRequestObject);\n+\n+        } catch (Exception e) {\n+            throw e;\n+        }\n+\n+        return new NeutronRouterWebJson(neutronRouterWebRequestObject);\n+    }\n+\n+    /**\n+     * Update a Neutron router\n+     * @param projectid\n+     * @param routerid\n+     * @param resource\n+     * @return\n+     * @throws Exception\n+     */\n+    @RequestMapping(\n+            method = PUT,\n+            value = {\"/project/{projectid}/routers/{routerid}\"})\n+    @DurationStatistics\n+    public NeutronRouterWebJson updateNeutronRouterByRouterId(@PathVariable String projectid,@PathVariable String routerid, @RequestBody NeutronRouterWebJson resource) throws Exception {\n+        NeutronRouterWebRequestObject neutronRouterWebRequestObject = null;\n+\n+        try {\n+            RestPreconditionsUtil.verifyParameterNotNullorEmpty(projectid);\n+\n+            // check resource\n+            if (!RouteManagerUtil.checkNeutronRouterWebResourceIsValid(resource)) {\n+                throw new ResourceNotValidException(\"request resource is invalid\");\n+            }\n+\n+            neutronRouterWebRequestObject = resource.getRouter();\n+            NeutronRouterWebRequestObject inNeutronRouter = this.neutronRouterService.getNeutronRouter(routerid);\n+\n+            RouteManagerUtil.copyPropertiesIgnoreNull(neutronRouterWebRequestObject, inNeutronRouter);\n+\n+            // configure default value\n+            neutronRouterWebRequestObject = RouteManagerUtil.configureNeutronRouterParameters(neutronRouterWebRequestObject);\n+\n+        } catch (ParameterNullOrEmptyException e) {\n+            throw e;\n+        } catch (CanNotFindRouter e) {\n+            throw e;\n+        }\n+\n+        return new NeutronRouterWebJson(neutronRouterWebRequestObject);\n+    }\n+\n+    @RequestMapping(\n+            method = DELETE,\n+            value = {\"/project/{projectid}/routers/{routerid}\"})\n+    @DurationStatistics\n+    public ResponseId deleteNeutronRouterByRouterId(@PathVariable String projectid, @PathVariable String routerid) throws Exception {\n+\n+        RestPreconditionsUtil.verifyParameterNotNullorEmpty(projectid);\n+        RestPreconditionsUtil.verifyParameterNotNullorEmpty(routerid);\n+        RestPreconditionsUtil.verifyResourceFound(projectid);\n+\n+        Router router = this.routerDatabaseService.getByRouterId(routerid);\n+        if (router == null) {\n+            return new ResponseId();\n+        }\n+        List<String> ports = router.getPorts();\n+        if (ports != null && ports.size() != 0) {\n+            throw new RouterHasAttachedInterfaces();\n+        }\n+        this.routerDatabaseService.deleteRouter(routerid);\n+\n+        RouterExtraAttribute routerExtraAttribute = this.routerExtraAttributeDatabaseService.getByRouterExtraAttributeId(router.getRouterExtraAttributeId());\n+        if (routerExtraAttribute == null) {\n+            return new ResponseId();\n+        }\n+        this.routerExtraAttributeDatabaseService.deleteRouterExtraAttribute(routerExtraAttribute.getId());\n+\n+        return new ResponseId(routerid);\n+\n+    }\n+\n+    @RequestMapping(\n+            method = PUT,\n+            value = {\"/project/{projectid}/routers/{routerid}/add_router_interface\"})\n+    @DurationStatistics\n+    public RouterInterfaceResponse addInterfaceToNeutronRouter(@PathVariable String projectid, @PathVariable String routerid, @RequestBody RouterInterfaceRequest resource) throws Exception {\n+\n+        RestPreconditionsUtil.verifyParameterNotNullorEmpty(projectid);\n+        RestPreconditionsUtil.verifyParameterNotNullorEmpty(routerid);\n+        RestPreconditionsUtil.verifyResourceFound(projectid);\n+\n+        String portId = resource.getPortId();\n+        String subnetId = resource.getSubnetId();\n+\n+        RouterInterfaceResponse routerInterfaceResponse = this.neutronRouterService.addAnInterfaceToNeutronRouter(projectid, portId, subnetId, routerid);\n+", "originalCommit": "06c30f4298a8ef7b8a8a7567ae5ae352173e7aa6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mjc2NTUxMA==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r482765510", "bodyText": "@kevin-zhonghao BTW, we need to check if there is only one gateway port exists in the current router, we don't need to request PM for update-l3-neighbors. This operation only happen when there are more than 2 ports exist in the router.", "author": "cj-chung", "createdAt": "2020-09-03T07:29:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjczODM1NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzI4NzE3NA==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r483287174", "bodyText": "Got it ~ have marked already", "author": "kevin-zhonghao", "createdAt": "2020-09-03T22:29:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjczODM1NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mjc2ODg2NQ==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r482768865", "bodyText": "@kevin-zhonghao We also need to update the port-subnet mapping table in the Route Manager.", "author": "cj-chung", "createdAt": "2020-09-03T07:35:36Z", "path": "services/route_manager/src/main/java/com/futurewei/alcor/route/service/Impl/NeutronRouterServiceImpl.java", "diffHunk": "@@ -0,0 +1,484 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+package com.futurewei.alcor.route.service.Impl;\n+\n+import com.futurewei.alcor.common.enumClass.RouteTableType;\n+import com.futurewei.alcor.common.exception.DatabasePersistenceException;\n+import com.futurewei.alcor.common.exception.ResourceNotFoundException;\n+import com.futurewei.alcor.common.exception.ResourcePersistenceException;\n+import com.futurewei.alcor.route.exception.*;\n+import com.futurewei.alcor.route.service.NeutronRouterService;\n+import com.futurewei.alcor.route.service.NeutronRouterToSubnetService;\n+import com.futurewei.alcor.route.service.RouterDatabaseService;\n+import com.futurewei.alcor.route.service.RouterExtraAttributeDatabaseService;\n+import com.futurewei.alcor.web.entity.port.PortEntity;\n+import com.futurewei.alcor.web.entity.route.*;\n+import com.futurewei.alcor.web.entity.subnet.SubnetEntity;\n+import com.futurewei.alcor.web.entity.subnet.SubnetWebJson;\n+import com.futurewei.alcor.web.entity.subnet.SubnetsWebJson;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.BeanUtils;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.stereotype.Service;\n+\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.UUID;\n+\n+@Service\n+public class NeutronRouterServiceImpl implements NeutronRouterService {\n+\n+    private Logger logger = LoggerFactory.getLogger(this.getClass());\n+\n+    @Autowired\n+    private NeutronRouterToSubnetService routerToSubnetService;\n+\n+    @Autowired\n+    private RouterDatabaseService routerDatabaseService;\n+\n+    @Autowired\n+    private RouterExtraAttributeDatabaseService routerExtraAttributeDatabaseService;\n+\n+    @Override\n+    public NeutronRouterWebRequestObject getNeutronRouter(String routerId) throws ResourceNotFoundException, ResourcePersistenceException, CanNotFindRouter {\n+        NeutronRouterWebRequestObject neutronRouterWebRequestObject = new NeutronRouterWebRequestObject();\n+\n+        Router router = this.routerDatabaseService.getByRouterId(routerId);\n+        if (router == null) {\n+            throw new CanNotFindRouter();\n+        }\n+\n+        RouterExtraAttribute routerExtraAttribute = this.routerExtraAttributeDatabaseService.getByRouterExtraAttributeId(router.getRouterExtraAttributeId());\n+\n+        BeanUtils.copyProperties(router, neutronRouterWebRequestObject);\n+        RouteTable routeTable = router.getRouteTable();\n+        neutronRouterWebRequestObject.setRouteTable(routeTable);\n+        if (routerExtraAttribute != null) {\n+            BeanUtils.copyProperties(routerExtraAttribute, neutronRouterWebRequestObject);\n+            neutronRouterWebRequestObject.setId(routerId);\n+        }\n+        return neutronRouterWebRequestObject;\n+    }\n+\n+    @Override\n+    public NeutronRouterWebRequestObject saveRouterAndRouterExtraAttribute(NeutronRouterWebRequestObject neutronRouter) throws NeutronRouterIsNull, DatabasePersistenceException {\n+        if (neutronRouter == null) {\n+            throw new NeutronRouterIsNull();\n+        }\n+        NeutronRouterWebRequestObject inNeutronRouter = new NeutronRouterWebRequestObject();\n+        BeanUtils.copyProperties(neutronRouter, inNeutronRouter);\n+\n+        String attachedRouterExtraAttributeId = UUID.randomUUID().toString();\n+\n+        Router router = new Router();\n+        RouterExtraAttribute routerExtraAttribute = new RouterExtraAttribute();\n+\n+        BeanUtils.copyProperties(neutronRouter, router);\n+        BeanUtils.copyProperties(neutronRouter, routerExtraAttribute);\n+        routerExtraAttribute.setId(attachedRouterExtraAttributeId);\n+        RouteTable routeTable = neutronRouter.getRouteTable();\n+        if (routeTable == null) {\n+            routeTable = new RouteTable();\n+            List<RouteEntry> routeEntities = new ArrayList<>();\n+            String routeTableId = UUID.randomUUID().toString();\n+            routeTable.setId(routeTableId);\n+            routeTable.setRouteEntities(routeEntities);\n+            routeTable.setRouteTableType(RouteTableType.NEUTRON);\n+        }\n+        router.setRouteTable(routeTable);\n+        router.setRouterExtraAttributeId(attachedRouterExtraAttributeId);\n+        inNeutronRouter.setRouteTable(routeTable);\n+\n+        this.routerDatabaseService.addRouter(router);\n+        this.routerExtraAttributeDatabaseService.addRouterExtraAttribute(routerExtraAttribute);\n+\n+\n+        return inNeutronRouter;\n+\n+    }\n+\n+    @Override\n+    public RouterInterfaceResponse addAnInterfaceToNeutronRouter(String projectid, String portId, String subnetId, String routerId) throws SpecifyBothSubnetIDAndPortID, ResourceNotFoundException, ResourcePersistenceException, CanNotFindRouter, DatabasePersistenceException, PortIDIsAlreadyExist, PortIsAlreadyInUse, SubnetNotBindUniquePortId {\n+        if (portId != null && subnetId != null) {\n+            throw new SpecifyBothSubnetIDAndPortID();\n+        }\n+\n+        SubnetEntity subnet = null;\n+        String subnetid = null;\n+        String projectId = null;\n+        String attachedRouterId = null;\n+\n+        // Only pass in the value of the port\n+        if (portId != null && subnetId == null) {\n+\n+            // get subnet by port id\n+            SubnetsWebJson subnetsWebJson = this.routerToSubnetService.getSubnetsByPortId(projectid, portId);\n+            if (subnetsWebJson == null) {\n+                return new RouterInterfaceResponse();\n+            }\n+            ArrayList<SubnetEntity> subnets = subnetsWebJson.getSubnets();\n+            if (subnets.size() == 0) {\n+                return new RouterInterfaceResponse();\n+            }\n+            if (subnets.size() != 1) {\n+                throw new SubnetNotBindUniquePortId();\n+            }\n+            subnet = subnets.get(0);\n+            subnetid = subnet.getId();\n+        }\n+        // Only pass in the value of the subnet\n+        else if (portId == null && subnetId != null) {\n+\n+            // get subnet by subnet id\n+            SubnetWebJson subnetWebJson = this.routerToSubnetService.getSubnet(projectid, subnetId);\n+            subnet = subnetWebJson.getSubnet();\n+            if (subnet == null) {\n+                logger.warn(\"can not find subnet by subnet id :\" + subnetId);\n+                return new RouterInterfaceResponse();\n+            }\n+            subnetid = subnetId;\n+        } else {\n+            return new RouterInterfaceResponse();\n+        }\n+        projectId = subnet.getProjectId();\n+        portId = subnet.getGatewayPortId();\n+        attachedRouterId = subnet.getAttachedRouterId();\n+\n+        // check if port_id is used by other router\n+        if (attachedRouterId != null && !attachedRouterId.equals(\"\")) {\n+            throw new PortIsAlreadyInUse();\n+        }\n+        subnet.setAttachedRouterId(routerId);\n+\n+        // update device_id and device_owner\n+        PortEntity portEntity = new PortEntity();\n+        portEntity.setDeviceId(routerId);\n+        portEntity.setDeviceOwner(\"network:router_interface\");\n+        subnet.setPort(portEntity);\n+\n+        // update subnet\n+        this.routerToSubnetService.updateSubnet(projectId, subnetid, subnet);\n+\n+        Router router = this.routerDatabaseService.getByRouterId(routerId);\n+        if (router == null) {\n+            throw new CanNotFindRouter();\n+        }\n+        List<String> ports = router.getPorts();\n+        if (ports == null){\n+            ports = new ArrayList<>();\n+        }\n+\n+        if (ports.contains(portId)) {\n+            throw new PortIDIsAlreadyExist();\n+        }\n+        ports.add(portId);\n+        router.setPorts(ports);\n+        this.routerDatabaseService.addRouter(router);\n+\n+        // Construct response\n+        List<String> subnetIds = new ArrayList<>(){};\n+        subnetIds.add(subnetid);\n+        return new RouterInterfaceResponse(routerId, subnet.getVpcId(), portId, subnetid, subnetIds, projectId, projectId, subnet.getTags());\n+    }\n+\n+    @Override\n+    public RouterInterfaceResponse removeAnInterfaceToNeutronRouter(String projectid, String portId, String subnetId, String routerId) throws ResourceNotFoundException, ResourcePersistenceException, RouterOrSubnetAndPortNotExistOrNotVisible, AttachedPortsNotMatchPortId, RouterTableNotExist, RouterInterfaceAreUsedByRoutes, SubnetNotBindUniquePortId, DatabasePersistenceException {\n+        SubnetEntity subnet = null;\n+        String projectId = null;\n+        String subnetid = null;\n+        String attachedPort = null;\n+        String attachedRouterId = null;\n+\n+        // if pass in both port_id and subnet_id, check conflict\n+        if (portId != null && subnetId != null) {\n+            SubnetWebJson subnetWebJson = this.routerToSubnetService.getSubnet(projectid, subnetId);\n+            subnet = subnetWebJson.getSubnet();\n+            if (subnet == null) {\n+                logger.warn(\"can not find subnet by subnet id :\" + subnetId);\n+                return new RouterInterfaceResponse();\n+            }\n+            attachedPort = subnet.getGatewayPortId();\n+            if (attachedPort != null) {\n+                if (!attachedPort.equals(portId)) {\n+                    throw new AttachedPortsNotMatchPortId();\n+                }\n+            } else {\n+                logger.warn(\"There is no IP address on the port\");\n+                return new RouterInterfaceResponse();\n+            }\n+            subnetid = subnetId;\n+\n+        }else if (portId != null && subnetId == null) {\n+            // get subnet by port id\n+            SubnetsWebJson subnetsWebJson = this.routerToSubnetService.getSubnetsByPortId(projectid, portId);\n+            if (subnetsWebJson == null) {\n+                return new RouterInterfaceResponse();\n+            }\n+            ArrayList<SubnetEntity> subnets = subnetsWebJson.getSubnets();\n+            if (subnets.size() == 0) {\n+                return new RouterInterfaceResponse();\n+            }\n+            if (subnets.size() != 1) {\n+                throw new SubnetNotBindUniquePortId();\n+            }\n+            subnet = subnets.get(0);\n+            subnetid = subnet.getId();\n+        }else if (portId == null && subnetId != null) {\n+            // get subnet by subnet id\n+            SubnetWebJson subnetWebJson = this.routerToSubnetService.getSubnet(projectid, subnetId);\n+            subnet = subnetWebJson.getSubnet();\n+            if (subnet == null) {\n+                logger.warn(\"can not find subnet by subnet id :\" + subnetId);\n+                return new RouterInterfaceResponse();\n+            }\n+            subnetid = subnetId;\n+        }else {\n+            return new RouterInterfaceResponse();\n+        }\n+\n+        // check if the router or the subnet and port do not exist or are not visible\n+        Router router = this.routerDatabaseService.getByRouterId(routerId);\n+        if (router == null) {\n+            throw new RouterOrSubnetAndPortNotExistOrNotVisible();\n+        }\n+\n+        // check if you try to delete the router interface for subnets that are used by one or more route\n+        projectId = subnet.getProjectId();\n+        attachedRouterId = subnet.getAttachedRouterId();\n+        String gatewayIp = subnet.getGatewayIp();\n+        if (gatewayIp != null) {\n+            RouteTable routeTable = router.getRouteTable();\n+            if (routeTable == null) {\n+                throw new RouterTableNotExist();\n+            }\n+\n+            List<RouteEntry> routeEntities = routeTable.getRouteEntities();\n+            for (RouteEntry routeEntry : routeEntities) {\n+                String nextHop = routeEntry.getNexthop();\n+                if (gatewayIp.equals(nextHop)) {\n+                    throw new RouterInterfaceAreUsedByRoutes();\n+                }\n+            }\n+\n+        }\n+\n+        // remove interface\n+        subnet.setAttachedRouterId(\"\");\n+\n+        List<String> ports = router.getPorts();\n+        if (ports == null){\n+            return new RouterInterfaceResponse();\n+        }\n+\n+        if (ports.contains(portId)) {\n+            ports.remove(portId);\n+        }\n+        router.setPorts(ports);\n+        this.routerDatabaseService.addRouter(router);\n+\n+        // update device_id and device_owner\n+        PortEntity portEntity = new PortEntity();\n+        portEntity.setDeviceId(null);\n+        portEntity.setDeviceOwner(null);\n+        subnet.setPort(portEntity);\n+\n+        // update subnet\n+        this.routerToSubnetService.updateSubnet(projectId, subnetid, subnet);\n+", "originalCommit": "06c30f4298a8ef7b8a8a7567ae5ae352173e7aa6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzI3OTgxMQ==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r483279811", "bodyText": "leave it for next PR", "author": "kevin-zhonghao", "createdAt": "2020-09-03T22:08:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mjc2ODg2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mjc3MjQyNA==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r482772424", "bodyText": "@kevin-zhonghao Here has two for-loops for matching rules, it takes O(n^2). Do we have better algorithm reducing it to linear time O(n)? Such as using destination as index or key for RouteEntry.", "author": "cj-chung", "createdAt": "2020-09-03T07:41:21Z", "path": "services/route_manager/src/main/java/com/futurewei/alcor/route/service/Impl/NeutronRouterServiceImpl.java", "diffHunk": "@@ -0,0 +1,484 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+package com.futurewei.alcor.route.service.Impl;\n+\n+import com.futurewei.alcor.common.enumClass.RouteTableType;\n+import com.futurewei.alcor.common.exception.DatabasePersistenceException;\n+import com.futurewei.alcor.common.exception.ResourceNotFoundException;\n+import com.futurewei.alcor.common.exception.ResourcePersistenceException;\n+import com.futurewei.alcor.route.exception.*;\n+import com.futurewei.alcor.route.service.NeutronRouterService;\n+import com.futurewei.alcor.route.service.NeutronRouterToSubnetService;\n+import com.futurewei.alcor.route.service.RouterDatabaseService;\n+import com.futurewei.alcor.route.service.RouterExtraAttributeDatabaseService;\n+import com.futurewei.alcor.web.entity.port.PortEntity;\n+import com.futurewei.alcor.web.entity.route.*;\n+import com.futurewei.alcor.web.entity.subnet.SubnetEntity;\n+import com.futurewei.alcor.web.entity.subnet.SubnetWebJson;\n+import com.futurewei.alcor.web.entity.subnet.SubnetsWebJson;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.BeanUtils;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.stereotype.Service;\n+\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.UUID;\n+\n+@Service\n+public class NeutronRouterServiceImpl implements NeutronRouterService {\n+\n+    private Logger logger = LoggerFactory.getLogger(this.getClass());\n+\n+    @Autowired\n+    private NeutronRouterToSubnetService routerToSubnetService;\n+\n+    @Autowired\n+    private RouterDatabaseService routerDatabaseService;\n+\n+    @Autowired\n+    private RouterExtraAttributeDatabaseService routerExtraAttributeDatabaseService;\n+\n+    @Override\n+    public NeutronRouterWebRequestObject getNeutronRouter(String routerId) throws ResourceNotFoundException, ResourcePersistenceException, CanNotFindRouter {\n+        NeutronRouterWebRequestObject neutronRouterWebRequestObject = new NeutronRouterWebRequestObject();\n+\n+        Router router = this.routerDatabaseService.getByRouterId(routerId);\n+        if (router == null) {\n+            throw new CanNotFindRouter();\n+        }\n+\n+        RouterExtraAttribute routerExtraAttribute = this.routerExtraAttributeDatabaseService.getByRouterExtraAttributeId(router.getRouterExtraAttributeId());\n+\n+        BeanUtils.copyProperties(router, neutronRouterWebRequestObject);\n+        RouteTable routeTable = router.getRouteTable();\n+        neutronRouterWebRequestObject.setRouteTable(routeTable);\n+        if (routerExtraAttribute != null) {\n+            BeanUtils.copyProperties(routerExtraAttribute, neutronRouterWebRequestObject);\n+            neutronRouterWebRequestObject.setId(routerId);\n+        }\n+        return neutronRouterWebRequestObject;\n+    }\n+\n+    @Override\n+    public NeutronRouterWebRequestObject saveRouterAndRouterExtraAttribute(NeutronRouterWebRequestObject neutronRouter) throws NeutronRouterIsNull, DatabasePersistenceException {\n+        if (neutronRouter == null) {\n+            throw new NeutronRouterIsNull();\n+        }\n+        NeutronRouterWebRequestObject inNeutronRouter = new NeutronRouterWebRequestObject();\n+        BeanUtils.copyProperties(neutronRouter, inNeutronRouter);\n+\n+        String attachedRouterExtraAttributeId = UUID.randomUUID().toString();\n+\n+        Router router = new Router();\n+        RouterExtraAttribute routerExtraAttribute = new RouterExtraAttribute();\n+\n+        BeanUtils.copyProperties(neutronRouter, router);\n+        BeanUtils.copyProperties(neutronRouter, routerExtraAttribute);\n+        routerExtraAttribute.setId(attachedRouterExtraAttributeId);\n+        RouteTable routeTable = neutronRouter.getRouteTable();\n+        if (routeTable == null) {\n+            routeTable = new RouteTable();\n+            List<RouteEntry> routeEntities = new ArrayList<>();\n+            String routeTableId = UUID.randomUUID().toString();\n+            routeTable.setId(routeTableId);\n+            routeTable.setRouteEntities(routeEntities);\n+            routeTable.setRouteTableType(RouteTableType.NEUTRON);\n+        }\n+        router.setRouteTable(routeTable);\n+        router.setRouterExtraAttributeId(attachedRouterExtraAttributeId);\n+        inNeutronRouter.setRouteTable(routeTable);\n+\n+        this.routerDatabaseService.addRouter(router);\n+        this.routerExtraAttributeDatabaseService.addRouterExtraAttribute(routerExtraAttribute);\n+\n+\n+        return inNeutronRouter;\n+\n+    }\n+\n+    @Override\n+    public RouterInterfaceResponse addAnInterfaceToNeutronRouter(String projectid, String portId, String subnetId, String routerId) throws SpecifyBothSubnetIDAndPortID, ResourceNotFoundException, ResourcePersistenceException, CanNotFindRouter, DatabasePersistenceException, PortIDIsAlreadyExist, PortIsAlreadyInUse, SubnetNotBindUniquePortId {\n+        if (portId != null && subnetId != null) {\n+            throw new SpecifyBothSubnetIDAndPortID();\n+        }\n+\n+        SubnetEntity subnet = null;\n+        String subnetid = null;\n+        String projectId = null;\n+        String attachedRouterId = null;\n+\n+        // Only pass in the value of the port\n+        if (portId != null && subnetId == null) {\n+\n+            // get subnet by port id\n+            SubnetsWebJson subnetsWebJson = this.routerToSubnetService.getSubnetsByPortId(projectid, portId);\n+            if (subnetsWebJson == null) {\n+                return new RouterInterfaceResponse();\n+            }\n+            ArrayList<SubnetEntity> subnets = subnetsWebJson.getSubnets();\n+            if (subnets.size() == 0) {\n+                return new RouterInterfaceResponse();\n+            }\n+            if (subnets.size() != 1) {\n+                throw new SubnetNotBindUniquePortId();\n+            }\n+            subnet = subnets.get(0);\n+            subnetid = subnet.getId();\n+        }\n+        // Only pass in the value of the subnet\n+        else if (portId == null && subnetId != null) {\n+\n+            // get subnet by subnet id\n+            SubnetWebJson subnetWebJson = this.routerToSubnetService.getSubnet(projectid, subnetId);\n+            subnet = subnetWebJson.getSubnet();\n+            if (subnet == null) {\n+                logger.warn(\"can not find subnet by subnet id :\" + subnetId);\n+                return new RouterInterfaceResponse();\n+            }\n+            subnetid = subnetId;\n+        } else {\n+            return new RouterInterfaceResponse();\n+        }\n+        projectId = subnet.getProjectId();\n+        portId = subnet.getGatewayPortId();\n+        attachedRouterId = subnet.getAttachedRouterId();\n+\n+        // check if port_id is used by other router\n+        if (attachedRouterId != null && !attachedRouterId.equals(\"\")) {\n+            throw new PortIsAlreadyInUse();\n+        }\n+        subnet.setAttachedRouterId(routerId);\n+\n+        // update device_id and device_owner\n+        PortEntity portEntity = new PortEntity();\n+        portEntity.setDeviceId(routerId);\n+        portEntity.setDeviceOwner(\"network:router_interface\");\n+        subnet.setPort(portEntity);\n+\n+        // update subnet\n+        this.routerToSubnetService.updateSubnet(projectId, subnetid, subnet);\n+\n+        Router router = this.routerDatabaseService.getByRouterId(routerId);\n+        if (router == null) {\n+            throw new CanNotFindRouter();\n+        }\n+        List<String> ports = router.getPorts();\n+        if (ports == null){\n+            ports = new ArrayList<>();\n+        }\n+\n+        if (ports.contains(portId)) {\n+            throw new PortIDIsAlreadyExist();\n+        }\n+        ports.add(portId);\n+        router.setPorts(ports);\n+        this.routerDatabaseService.addRouter(router);\n+\n+        // Construct response\n+        List<String> subnetIds = new ArrayList<>(){};\n+        subnetIds.add(subnetid);\n+        return new RouterInterfaceResponse(routerId, subnet.getVpcId(), portId, subnetid, subnetIds, projectId, projectId, subnet.getTags());\n+    }\n+\n+    @Override\n+    public RouterInterfaceResponse removeAnInterfaceToNeutronRouter(String projectid, String portId, String subnetId, String routerId) throws ResourceNotFoundException, ResourcePersistenceException, RouterOrSubnetAndPortNotExistOrNotVisible, AttachedPortsNotMatchPortId, RouterTableNotExist, RouterInterfaceAreUsedByRoutes, SubnetNotBindUniquePortId, DatabasePersistenceException {\n+        SubnetEntity subnet = null;\n+        String projectId = null;\n+        String subnetid = null;\n+        String attachedPort = null;\n+        String attachedRouterId = null;\n+\n+        // if pass in both port_id and subnet_id, check conflict\n+        if (portId != null && subnetId != null) {\n+            SubnetWebJson subnetWebJson = this.routerToSubnetService.getSubnet(projectid, subnetId);\n+            subnet = subnetWebJson.getSubnet();\n+            if (subnet == null) {\n+                logger.warn(\"can not find subnet by subnet id :\" + subnetId);\n+                return new RouterInterfaceResponse();\n+            }\n+            attachedPort = subnet.getGatewayPortId();\n+            if (attachedPort != null) {\n+                if (!attachedPort.equals(portId)) {\n+                    throw new AttachedPortsNotMatchPortId();\n+                }\n+            } else {\n+                logger.warn(\"There is no IP address on the port\");\n+                return new RouterInterfaceResponse();\n+            }\n+            subnetid = subnetId;\n+\n+        }else if (portId != null && subnetId == null) {\n+            // get subnet by port id\n+            SubnetsWebJson subnetsWebJson = this.routerToSubnetService.getSubnetsByPortId(projectid, portId);\n+            if (subnetsWebJson == null) {\n+                return new RouterInterfaceResponse();\n+            }\n+            ArrayList<SubnetEntity> subnets = subnetsWebJson.getSubnets();\n+            if (subnets.size() == 0) {\n+                return new RouterInterfaceResponse();\n+            }\n+            if (subnets.size() != 1) {\n+                throw new SubnetNotBindUniquePortId();\n+            }\n+            subnet = subnets.get(0);\n+            subnetid = subnet.getId();\n+        }else if (portId == null && subnetId != null) {\n+            // get subnet by subnet id\n+            SubnetWebJson subnetWebJson = this.routerToSubnetService.getSubnet(projectid, subnetId);\n+            subnet = subnetWebJson.getSubnet();\n+            if (subnet == null) {\n+                logger.warn(\"can not find subnet by subnet id :\" + subnetId);\n+                return new RouterInterfaceResponse();\n+            }\n+            subnetid = subnetId;\n+        }else {\n+            return new RouterInterfaceResponse();\n+        }\n+\n+        // check if the router or the subnet and port do not exist or are not visible\n+        Router router = this.routerDatabaseService.getByRouterId(routerId);\n+        if (router == null) {\n+            throw new RouterOrSubnetAndPortNotExistOrNotVisible();\n+        }\n+\n+        // check if you try to delete the router interface for subnets that are used by one or more route\n+        projectId = subnet.getProjectId();\n+        attachedRouterId = subnet.getAttachedRouterId();\n+        String gatewayIp = subnet.getGatewayIp();\n+        if (gatewayIp != null) {\n+            RouteTable routeTable = router.getRouteTable();\n+            if (routeTable == null) {\n+                throw new RouterTableNotExist();\n+            }\n+\n+            List<RouteEntry> routeEntities = routeTable.getRouteEntities();\n+            for (RouteEntry routeEntry : routeEntities) {\n+                String nextHop = routeEntry.getNexthop();\n+                if (gatewayIp.equals(nextHop)) {\n+                    throw new RouterInterfaceAreUsedByRoutes();\n+                }\n+            }\n+\n+        }\n+\n+        // remove interface\n+        subnet.setAttachedRouterId(\"\");\n+\n+        List<String> ports = router.getPorts();\n+        if (ports == null){\n+            return new RouterInterfaceResponse();\n+        }\n+\n+        if (ports.contains(portId)) {\n+            ports.remove(portId);\n+        }\n+        router.setPorts(ports);\n+        this.routerDatabaseService.addRouter(router);\n+\n+        // update device_id and device_owner\n+        PortEntity portEntity = new PortEntity();\n+        portEntity.setDeviceId(null);\n+        portEntity.setDeviceOwner(null);\n+        subnet.setPort(portEntity);\n+\n+        // update subnet\n+        this.routerToSubnetService.updateSubnet(projectId, subnetid, subnet);\n+\n+        // Construct response\n+        List<String> subnetIds = new ArrayList<>(){};\n+        subnetIds.add(subnetid);\n+        return new RouterInterfaceResponse(routerId, subnet.getVpcId(), portId, subnetid, subnetIds, projectId, projectId, subnet.getTags());\n+\n+    }\n+\n+    @Override\n+    public RoutesToNeutronWebResponse addRoutesToNeutronRouter(String routerid, RoutesToNeutronRouterRequestObject requestRouter) throws ResourceNotFoundException, ResourcePersistenceException, RouterOrSubnetAndPortNotExistOrNotVisible, DatabasePersistenceException, DestinationOrNexthopCanNotBeNull {\n+        RoutesToNeutronRouterResponseObject responseRouter = new RoutesToNeutronRouterResponseObject();\n+        List<RoutesToNeutronRouteObject> responseRoutes = new ArrayList<>();\n+\n+        Router router = this.routerDatabaseService.getByRouterId(routerid);\n+        if (router == null) {\n+            throw new RouterOrSubnetAndPortNotExistOrNotVisible();\n+        }\n+        RouteTable routeTable = router.getRouteTable();\n+        List<RouteEntry> routeEntities = routeTable.getRouteEntities();\n+\n+\n+        List<RoutesToNeutronRouteObject> requestRoutes = requestRouter.getRoutes();\n+        for (RoutesToNeutronRouteObject requestRoute : requestRoutes) {\n+            boolean isExit = false;\n+            String requestDestination = requestRoute.getDestination();\n+            String requestNexthop = requestRoute.getNexthop();\n+\n+            if (requestDestination == null || requestNexthop == null) {\n+                throw new DestinationOrNexthopCanNotBeNull();\n+            }\n+\n+            for (RouteEntry routeEntry : routeEntities) {\n+                String destination = routeEntry.getDestination();\n+                String nexthop = routeEntry.getNexthop();\n+                if (destination.equals(requestDestination) && nexthop.equals(requestNexthop)) {\n+                    isExit = true;\n+                    break;\n+                }", "originalCommit": "06c30f4298a8ef7b8a8a7567ae5ae352173e7aa6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzI4NDU5NA==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r483284594", "bodyText": "If we use destination as index or key for RouteEntry, we may not guarantee the uniqueness of the RouteEntry key. Although here is two for-loops, but one of the n depends on requestbody, so the time complexity should be O(m * n), and m may not be very large, right?", "author": "kevin-zhonghao", "createdAt": "2020-09-03T22:21:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mjc3MjQyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMyMDE5NA==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r483320194", "bodyText": "Agree. we can leave current design and implementation for now. We can wait until it hits performance issue when we doing perf-test.", "author": "cj-chung", "createdAt": "2020-09-04T00:23:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mjc3MjQyNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzEyODkzOA==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r483128938", "bodyText": "@kevin-zhonghao we need to add a function call here for l3-neighbors-updating. It should be the function call to PM same as the previous one /project/{project_id}/update-l3-neighbors/{new_subnet_id}, but the detail contract is not confirm yet.  We can wait until the contract is confirmed.", "author": "cj-chung", "createdAt": "2020-09-03T17:04:50Z", "path": "services/route_manager/src/main/java/com/futurewei/alcor/route/controller/NeutronRouterController.java", "diffHunk": "@@ -0,0 +1,375 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+package com.futurewei.alcor.route.controller;\n+\n+import com.futurewei.alcor.common.entity.ResponseId;\n+import com.futurewei.alcor.common.exception.ParameterNullOrEmptyException;\n+import com.futurewei.alcor.common.exception.ResourceNotFoundException;\n+import com.futurewei.alcor.common.exception.ResourceNotValidException;\n+import com.futurewei.alcor.common.stats.DurationStatistics;\n+import com.futurewei.alcor.common.utils.ControllerUtil;\n+import com.futurewei.alcor.route.exception.CanNotFindRouter;\n+import com.futurewei.alcor.route.exception.RouterHasAttachedInterfaces;\n+import com.futurewei.alcor.route.service.NeutronRouterService;\n+import com.futurewei.alcor.route.service.RouterDatabaseService;\n+import com.futurewei.alcor.route.service.RouterExtraAttributeDatabaseService;\n+import com.futurewei.alcor.route.utils.RouteManagerUtil;\n+import com.futurewei.alcor.route.utils.RestPreconditionsUtil;\n+import com.futurewei.alcor.web.entity.route.*;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.BeanUtils;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.context.annotation.ComponentScan;\n+import org.springframework.web.bind.annotation.PathVariable;\n+import org.springframework.web.bind.annotation.RequestBody;\n+import org.springframework.web.bind.annotation.RequestMapping;\n+import org.springframework.web.bind.annotation.RestController;\n+import org.thymeleaf.util.StringUtils;\n+\n+import javax.servlet.http.HttpServletRequest;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.UUID;\n+\n+import static org.springframework.web.bind.annotation.RequestMethod.*;\n+\n+@RestController\n+@ComponentScan(value = \"com.futurewei.alcor.common.stats\")\n+public class NeutronRouterController {\n+\n+    private Logger logger = LoggerFactory.getLogger(this.getClass());\n+\n+    @Autowired\n+    private RouterDatabaseService routerDatabaseService;\n+\n+    @Autowired\n+    private RouterExtraAttributeDatabaseService routerExtraAttributeDatabaseService;\n+\n+    @Autowired\n+    private NeutronRouterService neutronRouterService;\n+\n+    @Autowired\n+    private HttpServletRequest request;\n+\n+    /**\n+     * Show a Neutron router\n+     * @param routerid\n+     * @param projectid\n+     * @return\n+     * @throws Exception\n+     */\n+    @RequestMapping(\n+            method = GET,\n+            value = {\"/project/{projectid}/routers/{routerid}\"})\n+    @DurationStatistics\n+    public NeutronRouterWebJson getNeutronRouterByRouterId(@PathVariable String projectid,@PathVariable String routerid) throws Exception {\n+\n+        NeutronRouterWebRequestObject neutronRouterWebRequestObject = null;\n+\n+        try {\n+            RestPreconditionsUtil.verifyParameterNotNullorEmpty(routerid);\n+            RestPreconditionsUtil.verifyParameterNotNullorEmpty(projectid);\n+            RestPreconditionsUtil.verifyResourceFound(projectid);\n+\n+            neutronRouterWebRequestObject = this.neutronRouterService.getNeutronRouter(routerid);\n+\n+        } catch (ParameterNullOrEmptyException e) {\n+            throw e;\n+        } catch (CanNotFindRouter e) {\n+            logger.error(e.getMessage() + \" : \" + routerid);\n+            return new NeutronRouterWebJson();\n+        }\n+\n+        return new NeutronRouterWebJson(neutronRouterWebRequestObject);\n+    }\n+\n+    /**\n+     * List Neutron routers\n+     * @param projectid\n+     * @return\n+     * @throws Exception\n+     */\n+    @RequestMapping(\n+            method = GET,\n+            value = {\"/project/{projectid}/routers\"})\n+    @DurationStatistics\n+    public NeutronRoutersWebJson getNeutronRouters(@PathVariable String projectid) throws Exception {\n+\n+        List<NeutronRouterWebRequestObject> neutronRouters = new ArrayList<>();\n+\n+        Map<String, Router> routers = null;\n+        RouterExtraAttribute routerExtraAttribute = null;\n+\n+        Map<String, Object[]> queryParams =\n+                ControllerUtil.transformUrlPathParams(request.getParameterMap(), Router.class);\n+\n+        ControllerUtil.handleUserRoles(request.getHeader(ControllerUtil.TOKEN_INFO_HEADER), queryParams);\n+        try {\n+            RestPreconditionsUtil.verifyParameterNotNullorEmpty(projectid);\n+            RestPreconditionsUtil.verifyResourceFound(projectid);\n+\n+            routers = this.routerDatabaseService.getAllRouters(queryParams);\n+            if (routers == null) {\n+                return new NeutronRoutersWebJson();\n+            }\n+\n+            for (Map.Entry<String, Router> entry : routers.entrySet()) {\n+                NeutronRouterWebRequestObject neutronRouterWebRequestObject = new NeutronRouterWebRequestObject();\n+                Router router = (Router) entry.getValue();\n+                String routerExtraAttributeId = router.getRouterExtraAttributeId();\n+                if (routerExtraAttributeId != null && !routerExtraAttributeId.equals(\"\")) {\n+                    routerExtraAttribute = this.routerExtraAttributeDatabaseService.getByRouterExtraAttributeId(routerExtraAttributeId);\n+                }\n+\n+                BeanUtils.copyProperties(router, neutronRouterWebRequestObject);\n+                if (routerExtraAttribute != null) {\n+                    BeanUtils.copyProperties(routerExtraAttribute, neutronRouterWebRequestObject);\n+                }\n+\n+                neutronRouters.add(neutronRouterWebRequestObject);\n+            }\n+\n+        } catch (ParameterNullOrEmptyException e) {\n+            throw new Exception(e);\n+        } catch (ResourceNotFoundException e) {\n+            throw new Exception(e);\n+        }\n+\n+        return new NeutronRoutersWebJson(neutronRouters);\n+    }\n+\n+    /**\n+     * Create a Neutron router\n+     * @param projectid\n+     * @param resource\n+     * @return\n+     * @throws Exception\n+     */\n+    @RequestMapping(\n+            method = POST,\n+            value = {\"/project/{projectid}/routers\"})\n+    @DurationStatistics\n+    public NeutronRouterWebJson createNeutronRouters(@PathVariable String projectid, @RequestBody NeutronRouterWebJson resource) throws Exception {\n+\n+        NeutronRouterWebRequestObject neutronRouterWebRequestObject = null;\n+\n+        try {\n+            RestPreconditionsUtil.verifyParameterNotNullorEmpty(projectid);\n+\n+            // check resource\n+            if (!RouteManagerUtil.checkNeutronRouterWebResourceIsValid(resource)) {\n+                throw new ResourceNotValidException(\"request resource is invalid\");\n+            }\n+\n+            neutronRouterWebRequestObject = resource.getRouter();\n+            String id = neutronRouterWebRequestObject.getId();\n+\n+            if (id == null || StringUtils.isEmpty(id)) {\n+                UUID routerId = UUID.randomUUID();\n+                neutronRouterWebRequestObject.setId(routerId.toString());\n+            }\n+            RestPreconditionsUtil.verifyResourceNotNull(neutronRouterWebRequestObject);\n+\n+            // configure default value\n+            neutronRouterWebRequestObject = RouteManagerUtil.configureNeutronRouterParameters(neutronRouterWebRequestObject);\n+\n+            // save router and router_extra_attribute\n+            neutronRouterWebRequestObject = this.neutronRouterService.saveRouterAndRouterExtraAttribute(neutronRouterWebRequestObject);\n+\n+        } catch (Exception e) {\n+            throw e;\n+        }\n+\n+        return new NeutronRouterWebJson(neutronRouterWebRequestObject);\n+    }\n+\n+    /**\n+     * Update a Neutron router\n+     * @param projectid\n+     * @param routerid\n+     * @param resource\n+     * @return\n+     * @throws Exception\n+     */\n+    @RequestMapping(\n+            method = PUT,\n+            value = {\"/project/{projectid}/routers/{routerid}\"})\n+    @DurationStatistics\n+    public NeutronRouterWebJson updateNeutronRouterByRouterId(@PathVariable String projectid,@PathVariable String routerid, @RequestBody NeutronRouterWebJson resource) throws Exception {\n+        NeutronRouterWebRequestObject neutronRouterWebRequestObject = null;\n+\n+        try {\n+            RestPreconditionsUtil.verifyParameterNotNullorEmpty(projectid);\n+\n+            // check resource\n+            if (!RouteManagerUtil.checkNeutronRouterWebResourceIsValid(resource)) {\n+                throw new ResourceNotValidException(\"request resource is invalid\");\n+            }\n+\n+            neutronRouterWebRequestObject = resource.getRouter();\n+            NeutronRouterWebRequestObject inNeutronRouter = this.neutronRouterService.getNeutronRouter(routerid);\n+\n+            RouteManagerUtil.copyPropertiesIgnoreNull(neutronRouterWebRequestObject, inNeutronRouter);\n+\n+            // configure default value\n+            neutronRouterWebRequestObject = RouteManagerUtil.configureNeutronRouterParameters(neutronRouterWebRequestObject);\n+\n+        } catch (ParameterNullOrEmptyException e) {\n+            throw e;\n+        } catch (CanNotFindRouter e) {\n+            throw e;\n+        }\n+\n+        return new NeutronRouterWebJson(neutronRouterWebRequestObject);\n+    }\n+\n+    @RequestMapping(\n+            method = DELETE,\n+            value = {\"/project/{projectid}/routers/{routerid}\"})\n+    @DurationStatistics\n+    public ResponseId deleteNeutronRouterByRouterId(@PathVariable String projectid, @PathVariable String routerid) throws Exception {\n+\n+        RestPreconditionsUtil.verifyParameterNotNullorEmpty(projectid);\n+        RestPreconditionsUtil.verifyParameterNotNullorEmpty(routerid);\n+        RestPreconditionsUtil.verifyResourceFound(projectid);\n+\n+        Router router = this.routerDatabaseService.getByRouterId(routerid);\n+        if (router == null) {\n+            return new ResponseId();\n+        }\n+        List<String> ports = router.getPorts();\n+        if (ports != null && ports.size() != 0) {\n+            throw new RouterHasAttachedInterfaces();\n+        }\n+        this.routerDatabaseService.deleteRouter(routerid);\n+\n+        RouterExtraAttribute routerExtraAttribute = this.routerExtraAttributeDatabaseService.getByRouterExtraAttributeId(router.getRouterExtraAttributeId());\n+        if (routerExtraAttribute == null) {\n+            return new ResponseId();\n+        }\n+        this.routerExtraAttributeDatabaseService.deleteRouterExtraAttribute(routerExtraAttribute.getId());\n+\n+        return new ResponseId(routerid);\n+\n+    }\n+\n+    @RequestMapping(\n+            method = PUT,\n+            value = {\"/project/{projectid}/routers/{routerid}/add_router_interface\"})\n+    @DurationStatistics\n+    public RouterInterfaceResponse addInterfaceToNeutronRouter(@PathVariable String projectid, @PathVariable String routerid, @RequestBody RouterInterfaceRequest resource) throws Exception {\n+\n+        RestPreconditionsUtil.verifyParameterNotNullorEmpty(projectid);\n+        RestPreconditionsUtil.verifyParameterNotNullorEmpty(routerid);\n+        RestPreconditionsUtil.verifyResourceFound(projectid);\n+\n+        String portId = resource.getPortId();\n+        String subnetId = resource.getSubnetId();\n+\n+        RouterInterfaceResponse routerInterfaceResponse = this.neutronRouterService.addAnInterfaceToNeutronRouter(projectid, portId, subnetId, routerid);\n+\n+        return routerInterfaceResponse;\n+\n+    }\n+\n+    @RequestMapping(\n+            method = PUT,\n+            value = {\"/project/{projectid}/routers/{routerid}/remove_router_interface\"})\n+    @DurationStatistics\n+    public RouterInterfaceResponse removeInterfaceToNeutronRouter(@PathVariable String projectid, @PathVariable String routerid, @RequestBody RouterInterfaceRequest resource) throws Exception {\n+\n+        RestPreconditionsUtil.verifyParameterNotNullorEmpty(projectid);\n+        RestPreconditionsUtil.verifyParameterNotNullorEmpty(routerid);\n+        RestPreconditionsUtil.verifyResourceFound(projectid);\n+\n+        String portId = resource.getPortId();\n+        String subnetId = resource.getSubnetId();\n+\n+        RouterInterfaceResponse routerInterfaceResponse = this.neutronRouterService.removeAnInterfaceToNeutronRouter(projectid, portId, subnetId, routerid);\n+\n+        return routerInterfaceResponse;\n+\n+    }\n+\n+    @RequestMapping(\n+            method = PUT,\n+            value = {\"/project/{projectid}/routers/{routerid}/add_extra_routes\"})\n+    @DurationStatistics\n+    public RoutesToNeutronWebResponse addRoutesToNeutronRouter(@PathVariable String projectid, @PathVariable String routerid, @RequestBody RoutesToNeutronWebRequest resource) throws Exception {\n+\n+        RestPreconditionsUtil.verifyParameterNotNullorEmpty(projectid);\n+        RestPreconditionsUtil.verifyParameterNotNullorEmpty(routerid);\n+        RestPreconditionsUtil.verifyResourceFound(projectid);\n+\n+        RoutesToNeutronRouterRequestObject router = resource.getRouter();\n+        if (router == null) {\n+            return new RoutesToNeutronWebResponse();\n+        }\n+\n+        RoutesToNeutronWebResponse routesToNeutronWebResponse = this.neutronRouterService.addRoutesToNeutronRouter(routerid, router);\n+", "originalCommit": "06c30f4298a8ef7b8a8a7567ae5ae352173e7aa6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzI4MTk0MQ==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r483281941", "bodyText": "Sure ~ left the comments already", "author": "kevin-zhonghao", "createdAt": "2020-09-03T22:14:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzEyODkzOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzEyOTM1OA==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r483129358", "bodyText": "@kevin-zhonghao Reserve the place to call PM for routing rule updating.", "author": "cj-chung", "createdAt": "2020-09-03T17:05:32Z", "path": "services/route_manager/src/main/java/com/futurewei/alcor/route/controller/NeutronRouterController.java", "diffHunk": "@@ -0,0 +1,375 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+package com.futurewei.alcor.route.controller;\n+\n+import com.futurewei.alcor.common.entity.ResponseId;\n+import com.futurewei.alcor.common.exception.ParameterNullOrEmptyException;\n+import com.futurewei.alcor.common.exception.ResourceNotFoundException;\n+import com.futurewei.alcor.common.exception.ResourceNotValidException;\n+import com.futurewei.alcor.common.stats.DurationStatistics;\n+import com.futurewei.alcor.common.utils.ControllerUtil;\n+import com.futurewei.alcor.route.exception.CanNotFindRouter;\n+import com.futurewei.alcor.route.exception.RouterHasAttachedInterfaces;\n+import com.futurewei.alcor.route.service.NeutronRouterService;\n+import com.futurewei.alcor.route.service.RouterDatabaseService;\n+import com.futurewei.alcor.route.service.RouterExtraAttributeDatabaseService;\n+import com.futurewei.alcor.route.utils.RouteManagerUtil;\n+import com.futurewei.alcor.route.utils.RestPreconditionsUtil;\n+import com.futurewei.alcor.web.entity.route.*;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.BeanUtils;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.context.annotation.ComponentScan;\n+import org.springframework.web.bind.annotation.PathVariable;\n+import org.springframework.web.bind.annotation.RequestBody;\n+import org.springframework.web.bind.annotation.RequestMapping;\n+import org.springframework.web.bind.annotation.RestController;\n+import org.thymeleaf.util.StringUtils;\n+\n+import javax.servlet.http.HttpServletRequest;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.UUID;\n+\n+import static org.springframework.web.bind.annotation.RequestMethod.*;\n+\n+@RestController\n+@ComponentScan(value = \"com.futurewei.alcor.common.stats\")\n+public class NeutronRouterController {\n+\n+    private Logger logger = LoggerFactory.getLogger(this.getClass());\n+\n+    @Autowired\n+    private RouterDatabaseService routerDatabaseService;\n+\n+    @Autowired\n+    private RouterExtraAttributeDatabaseService routerExtraAttributeDatabaseService;\n+\n+    @Autowired\n+    private NeutronRouterService neutronRouterService;\n+\n+    @Autowired\n+    private HttpServletRequest request;\n+\n+    /**\n+     * Show a Neutron router\n+     * @param routerid\n+     * @param projectid\n+     * @return\n+     * @throws Exception\n+     */\n+    @RequestMapping(\n+            method = GET,\n+            value = {\"/project/{projectid}/routers/{routerid}\"})\n+    @DurationStatistics\n+    public NeutronRouterWebJson getNeutronRouterByRouterId(@PathVariable String projectid,@PathVariable String routerid) throws Exception {\n+\n+        NeutronRouterWebRequestObject neutronRouterWebRequestObject = null;\n+\n+        try {\n+            RestPreconditionsUtil.verifyParameterNotNullorEmpty(routerid);\n+            RestPreconditionsUtil.verifyParameterNotNullorEmpty(projectid);\n+            RestPreconditionsUtil.verifyResourceFound(projectid);\n+\n+            neutronRouterWebRequestObject = this.neutronRouterService.getNeutronRouter(routerid);\n+\n+        } catch (ParameterNullOrEmptyException e) {\n+            throw e;\n+        } catch (CanNotFindRouter e) {\n+            logger.error(e.getMessage() + \" : \" + routerid);\n+            return new NeutronRouterWebJson();\n+        }\n+\n+        return new NeutronRouterWebJson(neutronRouterWebRequestObject);\n+    }\n+\n+    /**\n+     * List Neutron routers\n+     * @param projectid\n+     * @return\n+     * @throws Exception\n+     */\n+    @RequestMapping(\n+            method = GET,\n+            value = {\"/project/{projectid}/routers\"})\n+    @DurationStatistics\n+    public NeutronRoutersWebJson getNeutronRouters(@PathVariable String projectid) throws Exception {\n+\n+        List<NeutronRouterWebRequestObject> neutronRouters = new ArrayList<>();\n+\n+        Map<String, Router> routers = null;\n+        RouterExtraAttribute routerExtraAttribute = null;\n+\n+        Map<String, Object[]> queryParams =\n+                ControllerUtil.transformUrlPathParams(request.getParameterMap(), Router.class);\n+\n+        ControllerUtil.handleUserRoles(request.getHeader(ControllerUtil.TOKEN_INFO_HEADER), queryParams);\n+        try {\n+            RestPreconditionsUtil.verifyParameterNotNullorEmpty(projectid);\n+            RestPreconditionsUtil.verifyResourceFound(projectid);\n+\n+            routers = this.routerDatabaseService.getAllRouters(queryParams);\n+            if (routers == null) {\n+                return new NeutronRoutersWebJson();\n+            }\n+\n+            for (Map.Entry<String, Router> entry : routers.entrySet()) {\n+                NeutronRouterWebRequestObject neutronRouterWebRequestObject = new NeutronRouterWebRequestObject();\n+                Router router = (Router) entry.getValue();\n+                String routerExtraAttributeId = router.getRouterExtraAttributeId();\n+                if (routerExtraAttributeId != null && !routerExtraAttributeId.equals(\"\")) {\n+                    routerExtraAttribute = this.routerExtraAttributeDatabaseService.getByRouterExtraAttributeId(routerExtraAttributeId);\n+                }\n+\n+                BeanUtils.copyProperties(router, neutronRouterWebRequestObject);\n+                if (routerExtraAttribute != null) {\n+                    BeanUtils.copyProperties(routerExtraAttribute, neutronRouterWebRequestObject);\n+                }\n+\n+                neutronRouters.add(neutronRouterWebRequestObject);\n+            }\n+\n+        } catch (ParameterNullOrEmptyException e) {\n+            throw new Exception(e);\n+        } catch (ResourceNotFoundException e) {\n+            throw new Exception(e);\n+        }\n+\n+        return new NeutronRoutersWebJson(neutronRouters);\n+    }\n+\n+    /**\n+     * Create a Neutron router\n+     * @param projectid\n+     * @param resource\n+     * @return\n+     * @throws Exception\n+     */\n+    @RequestMapping(\n+            method = POST,\n+            value = {\"/project/{projectid}/routers\"})\n+    @DurationStatistics\n+    public NeutronRouterWebJson createNeutronRouters(@PathVariable String projectid, @RequestBody NeutronRouterWebJson resource) throws Exception {\n+\n+        NeutronRouterWebRequestObject neutronRouterWebRequestObject = null;\n+\n+        try {\n+            RestPreconditionsUtil.verifyParameterNotNullorEmpty(projectid);\n+\n+            // check resource\n+            if (!RouteManagerUtil.checkNeutronRouterWebResourceIsValid(resource)) {\n+                throw new ResourceNotValidException(\"request resource is invalid\");\n+            }\n+\n+            neutronRouterWebRequestObject = resource.getRouter();\n+            String id = neutronRouterWebRequestObject.getId();\n+\n+            if (id == null || StringUtils.isEmpty(id)) {\n+                UUID routerId = UUID.randomUUID();\n+                neutronRouterWebRequestObject.setId(routerId.toString());\n+            }\n+            RestPreconditionsUtil.verifyResourceNotNull(neutronRouterWebRequestObject);\n+\n+            // configure default value\n+            neutronRouterWebRequestObject = RouteManagerUtil.configureNeutronRouterParameters(neutronRouterWebRequestObject);\n+\n+            // save router and router_extra_attribute\n+            neutronRouterWebRequestObject = this.neutronRouterService.saveRouterAndRouterExtraAttribute(neutronRouterWebRequestObject);\n+\n+        } catch (Exception e) {\n+            throw e;\n+        }\n+\n+        return new NeutronRouterWebJson(neutronRouterWebRequestObject);\n+    }\n+\n+    /**\n+     * Update a Neutron router\n+     * @param projectid\n+     * @param routerid\n+     * @param resource\n+     * @return\n+     * @throws Exception\n+     */\n+    @RequestMapping(\n+            method = PUT,\n+            value = {\"/project/{projectid}/routers/{routerid}\"})\n+    @DurationStatistics\n+    public NeutronRouterWebJson updateNeutronRouterByRouterId(@PathVariable String projectid,@PathVariable String routerid, @RequestBody NeutronRouterWebJson resource) throws Exception {\n+        NeutronRouterWebRequestObject neutronRouterWebRequestObject = null;\n+\n+        try {\n+            RestPreconditionsUtil.verifyParameterNotNullorEmpty(projectid);\n+\n+            // check resource\n+            if (!RouteManagerUtil.checkNeutronRouterWebResourceIsValid(resource)) {\n+                throw new ResourceNotValidException(\"request resource is invalid\");\n+            }\n+\n+            neutronRouterWebRequestObject = resource.getRouter();\n+            NeutronRouterWebRequestObject inNeutronRouter = this.neutronRouterService.getNeutronRouter(routerid);\n+\n+            RouteManagerUtil.copyPropertiesIgnoreNull(neutronRouterWebRequestObject, inNeutronRouter);\n+\n+            // configure default value\n+            neutronRouterWebRequestObject = RouteManagerUtil.configureNeutronRouterParameters(neutronRouterWebRequestObject);\n+\n+        } catch (ParameterNullOrEmptyException e) {\n+            throw e;\n+        } catch (CanNotFindRouter e) {\n+            throw e;\n+        }\n+\n+        return new NeutronRouterWebJson(neutronRouterWebRequestObject);\n+    }\n+\n+    @RequestMapping(\n+            method = DELETE,\n+            value = {\"/project/{projectid}/routers/{routerid}\"})\n+    @DurationStatistics\n+    public ResponseId deleteNeutronRouterByRouterId(@PathVariable String projectid, @PathVariable String routerid) throws Exception {\n+\n+        RestPreconditionsUtil.verifyParameterNotNullorEmpty(projectid);\n+        RestPreconditionsUtil.verifyParameterNotNullorEmpty(routerid);\n+        RestPreconditionsUtil.verifyResourceFound(projectid);\n+\n+        Router router = this.routerDatabaseService.getByRouterId(routerid);\n+        if (router == null) {\n+            return new ResponseId();\n+        }\n+        List<String> ports = router.getPorts();\n+        if (ports != null && ports.size() != 0) {\n+            throw new RouterHasAttachedInterfaces();\n+        }\n+        this.routerDatabaseService.deleteRouter(routerid);\n+\n+        RouterExtraAttribute routerExtraAttribute = this.routerExtraAttributeDatabaseService.getByRouterExtraAttributeId(router.getRouterExtraAttributeId());\n+        if (routerExtraAttribute == null) {\n+            return new ResponseId();\n+        }\n+        this.routerExtraAttributeDatabaseService.deleteRouterExtraAttribute(routerExtraAttribute.getId());\n+\n+        return new ResponseId(routerid);\n+\n+    }\n+\n+    @RequestMapping(\n+            method = PUT,\n+            value = {\"/project/{projectid}/routers/{routerid}/add_router_interface\"})\n+    @DurationStatistics\n+    public RouterInterfaceResponse addInterfaceToNeutronRouter(@PathVariable String projectid, @PathVariable String routerid, @RequestBody RouterInterfaceRequest resource) throws Exception {\n+\n+        RestPreconditionsUtil.verifyParameterNotNullorEmpty(projectid);\n+        RestPreconditionsUtil.verifyParameterNotNullorEmpty(routerid);\n+        RestPreconditionsUtil.verifyResourceFound(projectid);\n+\n+        String portId = resource.getPortId();\n+        String subnetId = resource.getSubnetId();\n+\n+        RouterInterfaceResponse routerInterfaceResponse = this.neutronRouterService.addAnInterfaceToNeutronRouter(projectid, portId, subnetId, routerid);\n+\n+        return routerInterfaceResponse;\n+\n+    }\n+\n+    @RequestMapping(\n+            method = PUT,\n+            value = {\"/project/{projectid}/routers/{routerid}/remove_router_interface\"})\n+    @DurationStatistics\n+    public RouterInterfaceResponse removeInterfaceToNeutronRouter(@PathVariable String projectid, @PathVariable String routerid, @RequestBody RouterInterfaceRequest resource) throws Exception {\n+\n+        RestPreconditionsUtil.verifyParameterNotNullorEmpty(projectid);\n+        RestPreconditionsUtil.verifyParameterNotNullorEmpty(routerid);\n+        RestPreconditionsUtil.verifyResourceFound(projectid);\n+\n+        String portId = resource.getPortId();\n+        String subnetId = resource.getSubnetId();\n+\n+        RouterInterfaceResponse routerInterfaceResponse = this.neutronRouterService.removeAnInterfaceToNeutronRouter(projectid, portId, subnetId, routerid);\n+\n+        return routerInterfaceResponse;\n+\n+    }\n+\n+    @RequestMapping(\n+            method = PUT,\n+            value = {\"/project/{projectid}/routers/{routerid}/add_extra_routes\"})\n+    @DurationStatistics\n+    public RoutesToNeutronWebResponse addRoutesToNeutronRouter(@PathVariable String projectid, @PathVariable String routerid, @RequestBody RoutesToNeutronWebRequest resource) throws Exception {\n+\n+        RestPreconditionsUtil.verifyParameterNotNullorEmpty(projectid);\n+        RestPreconditionsUtil.verifyParameterNotNullorEmpty(routerid);\n+        RestPreconditionsUtil.verifyResourceFound(projectid);\n+\n+        RoutesToNeutronRouterRequestObject router = resource.getRouter();\n+        if (router == null) {\n+            return new RoutesToNeutronWebResponse();\n+        }\n+\n+        RoutesToNeutronWebResponse routesToNeutronWebResponse = this.neutronRouterService.addRoutesToNeutronRouter(routerid, router);\n+\n+        return routesToNeutronWebResponse;\n+\n+    }\n+\n+    @RequestMapping(\n+            method = PUT,\n+            value = {\"/project/{projectid}/routers/{routerid}/remove_extra_routes\"})\n+    @DurationStatistics\n+    public RoutesToNeutronWebResponse removeRoutesToNeutronRouter(@PathVariable String projectid, @PathVariable String routerid, @RequestBody RoutesToNeutronWebRequest resource) throws Exception {\n+\n+        RestPreconditionsUtil.verifyParameterNotNullorEmpty(projectid);\n+        RestPreconditionsUtil.verifyParameterNotNullorEmpty(routerid);\n+        RestPreconditionsUtil.verifyResourceFound(projectid);\n+\n+        RoutesToNeutronRouterRequestObject router = resource.getRouter();\n+        if (router == null) {\n+            return new RoutesToNeutronWebResponse();\n+        }\n+\n+        RoutesToNeutronWebResponse routesToNeutronWebResponse = this.neutronRouterService.removeRoutesToNeutronRouter(routerid, router);\n+", "originalCommit": "06c30f4298a8ef7b8a8a7567ae5ae352173e7aa6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzI4MTE1MA==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r483281150", "bodyText": "Sure", "author": "kevin-zhonghao", "createdAt": "2020-09-03T22:11:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzEyOTM1OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzE1Mjg4Mw==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r483152883", "bodyText": "@kevin-zhonghao We need to maintain subnet-port mapping in Route Manager instead of query the mapping from Subnet Manager.", "author": "cj-chung", "createdAt": "2020-09-03T17:48:36Z", "path": "services/route_manager/src/main/java/com/futurewei/alcor/route/service/Impl/NeutronRouterServiceImpl.java", "diffHunk": "@@ -0,0 +1,484 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+package com.futurewei.alcor.route.service.Impl;\n+\n+import com.futurewei.alcor.common.enumClass.RouteTableType;\n+import com.futurewei.alcor.common.exception.DatabasePersistenceException;\n+import com.futurewei.alcor.common.exception.ResourceNotFoundException;\n+import com.futurewei.alcor.common.exception.ResourcePersistenceException;\n+import com.futurewei.alcor.route.exception.*;\n+import com.futurewei.alcor.route.service.NeutronRouterService;\n+import com.futurewei.alcor.route.service.NeutronRouterToSubnetService;\n+import com.futurewei.alcor.route.service.RouterDatabaseService;\n+import com.futurewei.alcor.route.service.RouterExtraAttributeDatabaseService;\n+import com.futurewei.alcor.web.entity.port.PortEntity;\n+import com.futurewei.alcor.web.entity.route.*;\n+import com.futurewei.alcor.web.entity.subnet.SubnetEntity;\n+import com.futurewei.alcor.web.entity.subnet.SubnetWebJson;\n+import com.futurewei.alcor.web.entity.subnet.SubnetsWebJson;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.BeanUtils;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.stereotype.Service;\n+\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.UUID;\n+\n+@Service\n+public class NeutronRouterServiceImpl implements NeutronRouterService {\n+\n+    private Logger logger = LoggerFactory.getLogger(this.getClass());\n+\n+    @Autowired\n+    private NeutronRouterToSubnetService routerToSubnetService;\n+\n+    @Autowired\n+    private RouterDatabaseService routerDatabaseService;\n+\n+    @Autowired\n+    private RouterExtraAttributeDatabaseService routerExtraAttributeDatabaseService;\n+\n+    @Override\n+    public NeutronRouterWebRequestObject getNeutronRouter(String routerId) throws ResourceNotFoundException, ResourcePersistenceException, CanNotFindRouter {\n+        NeutronRouterWebRequestObject neutronRouterWebRequestObject = new NeutronRouterWebRequestObject();\n+\n+        Router router = this.routerDatabaseService.getByRouterId(routerId);\n+        if (router == null) {\n+            throw new CanNotFindRouter();\n+        }\n+\n+        RouterExtraAttribute routerExtraAttribute = this.routerExtraAttributeDatabaseService.getByRouterExtraAttributeId(router.getRouterExtraAttributeId());\n+\n+        BeanUtils.copyProperties(router, neutronRouterWebRequestObject);\n+        RouteTable routeTable = router.getRouteTable();\n+        neutronRouterWebRequestObject.setRouteTable(routeTable);\n+        if (routerExtraAttribute != null) {\n+            BeanUtils.copyProperties(routerExtraAttribute, neutronRouterWebRequestObject);\n+            neutronRouterWebRequestObject.setId(routerId);\n+        }\n+        return neutronRouterWebRequestObject;\n+    }\n+\n+    @Override\n+    public NeutronRouterWebRequestObject saveRouterAndRouterExtraAttribute(NeutronRouterWebRequestObject neutronRouter) throws NeutronRouterIsNull, DatabasePersistenceException {\n+        if (neutronRouter == null) {\n+            throw new NeutronRouterIsNull();\n+        }\n+        NeutronRouterWebRequestObject inNeutronRouter = new NeutronRouterWebRequestObject();\n+        BeanUtils.copyProperties(neutronRouter, inNeutronRouter);\n+\n+        String attachedRouterExtraAttributeId = UUID.randomUUID().toString();\n+\n+        Router router = new Router();\n+        RouterExtraAttribute routerExtraAttribute = new RouterExtraAttribute();\n+\n+        BeanUtils.copyProperties(neutronRouter, router);\n+        BeanUtils.copyProperties(neutronRouter, routerExtraAttribute);\n+        routerExtraAttribute.setId(attachedRouterExtraAttributeId);\n+        RouteTable routeTable = neutronRouter.getRouteTable();\n+        if (routeTable == null) {\n+            routeTable = new RouteTable();\n+            List<RouteEntry> routeEntities = new ArrayList<>();\n+            String routeTableId = UUID.randomUUID().toString();\n+            routeTable.setId(routeTableId);\n+            routeTable.setRouteEntities(routeEntities);\n+            routeTable.setRouteTableType(RouteTableType.NEUTRON);\n+        }\n+        router.setRouteTable(routeTable);\n+        router.setRouterExtraAttributeId(attachedRouterExtraAttributeId);\n+        inNeutronRouter.setRouteTable(routeTable);\n+\n+        this.routerDatabaseService.addRouter(router);\n+        this.routerExtraAttributeDatabaseService.addRouterExtraAttribute(routerExtraAttribute);\n+\n+\n+        return inNeutronRouter;\n+\n+    }\n+\n+    @Override\n+    public RouterInterfaceResponse addAnInterfaceToNeutronRouter(String projectid, String portId, String subnetId, String routerId) throws SpecifyBothSubnetIDAndPortID, ResourceNotFoundException, ResourcePersistenceException, CanNotFindRouter, DatabasePersistenceException, PortIDIsAlreadyExist, PortIsAlreadyInUse, SubnetNotBindUniquePortId {\n+        if (portId != null && subnetId != null) {\n+            throw new SpecifyBothSubnetIDAndPortID();\n+        }\n+\n+        SubnetEntity subnet = null;\n+        String subnetid = null;\n+        String projectId = null;\n+        String attachedRouterId = null;\n+\n+        // Only pass in the value of the port\n+        if (portId != null && subnetId == null) {\n+\n+            // get subnet by port id\n+            SubnetsWebJson subnetsWebJson = this.routerToSubnetService.getSubnetsByPortId(projectid, portId);\n+            if (subnetsWebJson == null) {\n+                return new RouterInterfaceResponse();\n+            }\n+            ArrayList<SubnetEntity> subnets = subnetsWebJson.getSubnets();\n+            if (subnets.size() == 0) {\n+                return new RouterInterfaceResponse();\n+            }\n+            if (subnets.size() != 1) {\n+                throw new SubnetNotBindUniquePortId();\n+            }\n+            subnet = subnets.get(0);\n+            subnetid = subnet.getId();\n+        }\n+        // Only pass in the value of the subnet\n+        else if (portId == null && subnetId != null) {\n+\n+            // get subnet by subnet id\n+            SubnetWebJson subnetWebJson = this.routerToSubnetService.getSubnet(projectid, subnetId);\n+            subnet = subnetWebJson.getSubnet();\n+            if (subnet == null) {\n+                logger.warn(\"can not find subnet by subnet id :\" + subnetId);\n+                return new RouterInterfaceResponse();\n+            }\n+            subnetid = subnetId;\n+        } else {\n+            return new RouterInterfaceResponse();\n+        }\n+        projectId = subnet.getProjectId();\n+        portId = subnet.getGatewayPortId();\n+        attachedRouterId = subnet.getAttachedRouterId();\n+\n+        // check if port_id is used by other router\n+        if (attachedRouterId != null && !attachedRouterId.equals(\"\")) {\n+            throw new PortIsAlreadyInUse();\n+        }\n+        subnet.setAttachedRouterId(routerId);\n+\n+        // update device_id and device_owner\n+        PortEntity portEntity = new PortEntity();\n+        portEntity.setDeviceId(routerId);\n+        portEntity.setDeviceOwner(\"network:router_interface\");\n+        subnet.setPort(portEntity);\n+\n+        // update subnet\n+        this.routerToSubnetService.updateSubnet(projectId, subnetid, subnet);\n+\n+        Router router = this.routerDatabaseService.getByRouterId(routerId);\n+        if (router == null) {\n+            throw new CanNotFindRouter();\n+        }\n+        List<String> ports = router.getPorts();\n+        if (ports == null){\n+            ports = new ArrayList<>();\n+        }\n+\n+        if (ports.contains(portId)) {\n+            throw new PortIDIsAlreadyExist();\n+        }\n+        ports.add(portId);\n+        router.setPorts(ports);\n+        this.routerDatabaseService.addRouter(router);\n+\n+        // Construct response\n+        List<String> subnetIds = new ArrayList<>(){};\n+        subnetIds.add(subnetid);\n+        return new RouterInterfaceResponse(routerId, subnet.getVpcId(), portId, subnetid, subnetIds, projectId, projectId, subnet.getTags());\n+    }\n+\n+    @Override\n+    public RouterInterfaceResponse removeAnInterfaceToNeutronRouter(String projectid, String portId, String subnetId, String routerId) throws ResourceNotFoundException, ResourcePersistenceException, RouterOrSubnetAndPortNotExistOrNotVisible, AttachedPortsNotMatchPortId, RouterTableNotExist, RouterInterfaceAreUsedByRoutes, SubnetNotBindUniquePortId, DatabasePersistenceException {\n+        SubnetEntity subnet = null;\n+        String projectId = null;\n+        String subnetid = null;\n+        String attachedPort = null;\n+        String attachedRouterId = null;\n+\n+        // if pass in both port_id and subnet_id, check conflict\n+        if (portId != null && subnetId != null) {\n+            SubnetWebJson subnetWebJson = this.routerToSubnetService.getSubnet(projectid, subnetId);\n+            subnet = subnetWebJson.getSubnet();\n+            if (subnet == null) {\n+                logger.warn(\"can not find subnet by subnet id :\" + subnetId);\n+                return new RouterInterfaceResponse();\n+            }\n+            attachedPort = subnet.getGatewayPortId();\n+            if (attachedPort != null) {\n+                if (!attachedPort.equals(portId)) {\n+                    throw new AttachedPortsNotMatchPortId();\n+                }\n+            } else {\n+                logger.warn(\"There is no IP address on the port\");\n+                return new RouterInterfaceResponse();\n+            }\n+            subnetid = subnetId;\n+\n+        }else if (portId != null && subnetId == null) {\n+            // get subnet by port id\n+            SubnetsWebJson subnetsWebJson = this.routerToSubnetService.getSubnetsByPortId(projectid, portId);\n+            if (subnetsWebJson == null) {\n+                return new RouterInterfaceResponse();\n+            }\n+            ArrayList<SubnetEntity> subnets = subnetsWebJson.getSubnets();\n+            if (subnets.size() == 0) {\n+                return new RouterInterfaceResponse();\n+            }\n+            if (subnets.size() != 1) {\n+                throw new SubnetNotBindUniquePortId();\n+            }\n+            subnet = subnets.get(0);\n+            subnetid = subnet.getId();\n+        }else if (portId == null && subnetId != null) {\n+            // get subnet by subnet id\n+            SubnetWebJson subnetWebJson = this.routerToSubnetService.getSubnet(projectid, subnetId);\n+            subnet = subnetWebJson.getSubnet();\n+            if (subnet == null) {\n+                logger.warn(\"can not find subnet by subnet id :\" + subnetId);\n+                return new RouterInterfaceResponse();\n+            }\n+            subnetid = subnetId;\n+        }else {\n+            return new RouterInterfaceResponse();\n+        }\n+\n+        // check if the router or the subnet and port do not exist or are not visible\n+        Router router = this.routerDatabaseService.getByRouterId(routerId);\n+        if (router == null) {\n+            throw new RouterOrSubnetAndPortNotExistOrNotVisible();\n+        }\n+\n+        // check if you try to delete the router interface for subnets that are used by one or more route\n+        projectId = subnet.getProjectId();\n+        attachedRouterId = subnet.getAttachedRouterId();\n+        String gatewayIp = subnet.getGatewayIp();\n+        if (gatewayIp != null) {\n+            RouteTable routeTable = router.getRouteTable();\n+            if (routeTable == null) {\n+                throw new RouterTableNotExist();\n+            }\n+\n+            List<RouteEntry> routeEntities = routeTable.getRouteEntities();\n+            for (RouteEntry routeEntry : routeEntities) {\n+                String nextHop = routeEntry.getNexthop();\n+                if (gatewayIp.equals(nextHop)) {\n+                    throw new RouterInterfaceAreUsedByRoutes();\n+                }\n+            }\n+\n+        }\n+\n+        // remove interface\n+        subnet.setAttachedRouterId(\"\");\n+\n+        List<String> ports = router.getPorts();\n+        if (ports == null){\n+            return new RouterInterfaceResponse();\n+        }\n+\n+        if (ports.contains(portId)) {\n+            ports.remove(portId);\n+        }\n+        router.setPorts(ports);\n+        this.routerDatabaseService.addRouter(router);\n+\n+        // update device_id and device_owner\n+        PortEntity portEntity = new PortEntity();\n+        portEntity.setDeviceId(null);\n+        portEntity.setDeviceOwner(null);\n+        subnet.setPort(portEntity);\n+\n+        // update subnet\n+        this.routerToSubnetService.updateSubnet(projectId, subnetid, subnet);\n+\n+        // Construct response\n+        List<String> subnetIds = new ArrayList<>(){};\n+        subnetIds.add(subnetid);\n+        return new RouterInterfaceResponse(routerId, subnet.getVpcId(), portId, subnetid, subnetIds, projectId, projectId, subnet.getTags());\n+\n+    }\n+\n+    @Override\n+    public RoutesToNeutronWebResponse addRoutesToNeutronRouter(String routerid, RoutesToNeutronRouterRequestObject requestRouter) throws ResourceNotFoundException, ResourcePersistenceException, RouterOrSubnetAndPortNotExistOrNotVisible, DatabasePersistenceException, DestinationOrNexthopCanNotBeNull {\n+        RoutesToNeutronRouterResponseObject responseRouter = new RoutesToNeutronRouterResponseObject();\n+        List<RoutesToNeutronRouteObject> responseRoutes = new ArrayList<>();\n+\n+        Router router = this.routerDatabaseService.getByRouterId(routerid);\n+        if (router == null) {\n+            throw new RouterOrSubnetAndPortNotExistOrNotVisible();\n+        }\n+        RouteTable routeTable = router.getRouteTable();\n+        List<RouteEntry> routeEntities = routeTable.getRouteEntities();\n+\n+\n+        List<RoutesToNeutronRouteObject> requestRoutes = requestRouter.getRoutes();\n+        for (RoutesToNeutronRouteObject requestRoute : requestRoutes) {\n+            boolean isExit = false;\n+            String requestDestination = requestRoute.getDestination();\n+            String requestNexthop = requestRoute.getNexthop();\n+\n+            if (requestDestination == null || requestNexthop == null) {\n+                throw new DestinationOrNexthopCanNotBeNull();\n+            }\n+\n+            for (RouteEntry routeEntry : routeEntities) {\n+                String destination = routeEntry.getDestination();\n+                String nexthop = routeEntry.getNexthop();\n+                if (destination.equals(requestDestination) && nexthop.equals(requestNexthop)) {\n+                    isExit = true;\n+                    break;\n+                }\n+            }\n+            if (!isExit) {\n+                RouteEntry routeEntry = new RouteEntry();\n+                routeEntry.setDestination(requestDestination);\n+                routeEntry.setNexthop(requestNexthop);\n+                routeEntities.add(routeEntry);\n+\n+                RoutesToNeutronRouteObject routesToNeutronRouteObject = new RoutesToNeutronRouteObject(requestDestination, requestNexthop);\n+                responseRoutes.add(routesToNeutronRouteObject);\n+            }\n+        }\n+        routeTable.setRouteEntities(routeEntities);\n+        router.setRouteTable(routeTable);\n+        this.routerDatabaseService.addRouter(router);\n+\n+        // Construct response\n+        for (RouteEntry routeEntry : routeEntities) {\n+            String destination = routeEntry.getDestination();\n+            String nexthop = routeEntry.getNexthop();\n+            RoutesToNeutronRouteObject routesToNeutronRouteObject = new RoutesToNeutronRouteObject(destination, nexthop);\n+            responseRoutes.add(routesToNeutronRouteObject);\n+        }\n+        responseRouter.setId(routerid);\n+        responseRouter.setName(router.getName());\n+        responseRouter.setRoutes(responseRoutes);\n+\n+        return new RoutesToNeutronWebResponse(responseRouter);\n+    }\n+\n+    @Override\n+    public RoutesToNeutronWebResponse removeRoutesToNeutronRouter(String routerid, RoutesToNeutronRouterRequestObject requestRouter) throws RouterOrSubnetAndPortNotExistOrNotVisible, ResourceNotFoundException, ResourcePersistenceException, DestinationOrNexthopCanNotBeNull, DatabasePersistenceException {\n+        RoutesToNeutronRouterResponseObject responseRouter = new RoutesToNeutronRouterResponseObject();\n+        List<RoutesToNeutronRouteObject> responseRoutes = new ArrayList<>();\n+\n+        Router router = this.routerDatabaseService.getByRouterId(routerid);\n+        if (router == null) {\n+            throw new RouterOrSubnetAndPortNotExistOrNotVisible();\n+        }\n+        RouteTable routeTable = router.getRouteTable();\n+        List<RouteEntry> routeEntities = routeTable.getRouteEntities();\n+\n+        List<RoutesToNeutronRouteObject> requestRoutes = requestRouter.getRoutes();\n+        for (RoutesToNeutronRouteObject requestRoute : requestRoutes) {\n+            String requestDestination = requestRoute.getDestination();\n+            String requestNexthop = requestRoute.getNexthop();\n+\n+            if (requestDestination == null || requestNexthop == null) {\n+                throw new DestinationOrNexthopCanNotBeNull();\n+            }\n+\n+            for (int i = 0; i < routeEntities.size(); i ++) {\n+                RouteEntry routeEntry = routeEntities.get(i);\n+                String destination = routeEntry.getDestination();\n+                String nexthop = routeEntry.getNexthop();\n+                if (destination.equals(requestDestination) && nexthop.equals(requestNexthop)) {\n+                    routeEntities.remove(i);\n+                    break;\n+                }\n+            }\n+        }\n+        routeTable.setRouteEntities(routeEntities);\n+        router.setRouteTable(routeTable);\n+        this.routerDatabaseService.addRouter(router);\n+\n+        // Construct response\n+        for (RouteEntry routeEntry : routeEntities) {\n+            String destination = routeEntry.getDestination();\n+            String nexthop = routeEntry.getNexthop();\n+            RoutesToNeutronRouteObject routesToNeutronRouteObject = new RoutesToNeutronRouteObject(destination, nexthop);\n+            responseRoutes.add(routesToNeutronRouteObject);\n+        }\n+        responseRouter.setId(routerid);\n+        responseRouter.setName(router.getName());\n+        responseRouter.setRoutes(responseRoutes);\n+\n+        return new RoutesToNeutronWebResponse(responseRouter);\n+    }\n+\n+    @Override\n+    public ConnectedSubnetsWebResponse getConnectedSubnets(String projectId, String vpcId, String subnetId) throws ResourceNotFoundException, ResourcePersistenceException, SubnetNotBindUniquePortId {\n+        List<String> subnetIds = new ArrayList<>();\n+\n+        // get subnet\n+        SubnetWebJson subnetWebJson = this.routerToSubnetService.getSubnet(projectId, subnetId);\n+        SubnetEntity subnet = subnetWebJson.getSubnet();\n+        if (subnet == null) {\n+            logger.warn(\"can not find subnet by subnet id :\" + subnetId);\n+            return null;\n+        }\n+\n+        // get subnet's route table type\n+        String attachedRouterId = subnet.getAttachedRouterId();\n+        if (attachedRouterId == null) {\n+            return null;\n+        }\n+\n+        Router router = this.routerDatabaseService.getByRouterId(attachedRouterId);\n+        if (router == null) {\n+            return null;\n+        }\n+        RouteTable routeTable = router.getRouteTable();\n+        if (routeTable == null) {\n+            return null;\n+        }\n+        RouteTableType routeTableType = routeTable.getRouteTableType();\n+\n+        if (routeTableType == null) {\n+            return null;\n+        } else if(routeTableType.getRouteTableType().equals(\"neutron\")){\n+            List<String> ports = router.getPorts();\n+            // check ports\n+            if (ports == null || ports.size() <= 1) {\n+                return null;\n+            }\n+            for (String portId : ports) {\n+                // get subnet by port id\n+                SubnetsWebJson subnetsWebJson = this.routerToSubnetService.getSubnetsByPortId(projectId, portId);\n+                if (subnetsWebJson == null) {", "originalCommit": "06c30f4298a8ef7b8a8a7567ae5ae352173e7aa6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzI4MTAwMQ==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r483281001", "bodyText": "okay ~ left the TODO comments for next PR", "author": "kevin-zhonghao", "createdAt": "2020-09-03T22:11:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzE1Mjg4Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzE1MzQ4MQ==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r483153481", "bodyText": "@kevin-zhonghao Does this router contains routing rules?", "author": "cj-chung", "createdAt": "2020-09-03T17:49:38Z", "path": "services/route_manager/src/main/java/com/futurewei/alcor/route/service/Impl/NeutronRouterServiceImpl.java", "diffHunk": "@@ -0,0 +1,484 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+package com.futurewei.alcor.route.service.Impl;\n+\n+import com.futurewei.alcor.common.enumClass.RouteTableType;\n+import com.futurewei.alcor.common.exception.DatabasePersistenceException;\n+import com.futurewei.alcor.common.exception.ResourceNotFoundException;\n+import com.futurewei.alcor.common.exception.ResourcePersistenceException;\n+import com.futurewei.alcor.route.exception.*;\n+import com.futurewei.alcor.route.service.NeutronRouterService;\n+import com.futurewei.alcor.route.service.NeutronRouterToSubnetService;\n+import com.futurewei.alcor.route.service.RouterDatabaseService;\n+import com.futurewei.alcor.route.service.RouterExtraAttributeDatabaseService;\n+import com.futurewei.alcor.web.entity.port.PortEntity;\n+import com.futurewei.alcor.web.entity.route.*;\n+import com.futurewei.alcor.web.entity.subnet.SubnetEntity;\n+import com.futurewei.alcor.web.entity.subnet.SubnetWebJson;\n+import com.futurewei.alcor.web.entity.subnet.SubnetsWebJson;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.BeanUtils;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.stereotype.Service;\n+\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.UUID;\n+\n+@Service\n+public class NeutronRouterServiceImpl implements NeutronRouterService {\n+\n+    private Logger logger = LoggerFactory.getLogger(this.getClass());\n+\n+    @Autowired\n+    private NeutronRouterToSubnetService routerToSubnetService;\n+\n+    @Autowired\n+    private RouterDatabaseService routerDatabaseService;\n+\n+    @Autowired\n+    private RouterExtraAttributeDatabaseService routerExtraAttributeDatabaseService;\n+\n+    @Override\n+    public NeutronRouterWebRequestObject getNeutronRouter(String routerId) throws ResourceNotFoundException, ResourcePersistenceException, CanNotFindRouter {\n+        NeutronRouterWebRequestObject neutronRouterWebRequestObject = new NeutronRouterWebRequestObject();\n+\n+        Router router = this.routerDatabaseService.getByRouterId(routerId);\n+        if (router == null) {\n+            throw new CanNotFindRouter();\n+        }\n+\n+        RouterExtraAttribute routerExtraAttribute = this.routerExtraAttributeDatabaseService.getByRouterExtraAttributeId(router.getRouterExtraAttributeId());\n+\n+        BeanUtils.copyProperties(router, neutronRouterWebRequestObject);\n+        RouteTable routeTable = router.getRouteTable();\n+        neutronRouterWebRequestObject.setRouteTable(routeTable);\n+        if (routerExtraAttribute != null) {\n+            BeanUtils.copyProperties(routerExtraAttribute, neutronRouterWebRequestObject);\n+            neutronRouterWebRequestObject.setId(routerId);\n+        }\n+        return neutronRouterWebRequestObject;\n+    }\n+\n+    @Override\n+    public NeutronRouterWebRequestObject saveRouterAndRouterExtraAttribute(NeutronRouterWebRequestObject neutronRouter) throws NeutronRouterIsNull, DatabasePersistenceException {\n+        if (neutronRouter == null) {\n+            throw new NeutronRouterIsNull();\n+        }\n+        NeutronRouterWebRequestObject inNeutronRouter = new NeutronRouterWebRequestObject();\n+        BeanUtils.copyProperties(neutronRouter, inNeutronRouter);\n+\n+        String attachedRouterExtraAttributeId = UUID.randomUUID().toString();\n+\n+        Router router = new Router();\n+        RouterExtraAttribute routerExtraAttribute = new RouterExtraAttribute();\n+\n+        BeanUtils.copyProperties(neutronRouter, router);\n+        BeanUtils.copyProperties(neutronRouter, routerExtraAttribute);\n+        routerExtraAttribute.setId(attachedRouterExtraAttributeId);\n+        RouteTable routeTable = neutronRouter.getRouteTable();\n+        if (routeTable == null) {\n+            routeTable = new RouteTable();\n+            List<RouteEntry> routeEntities = new ArrayList<>();\n+            String routeTableId = UUID.randomUUID().toString();\n+            routeTable.setId(routeTableId);\n+            routeTable.setRouteEntities(routeEntities);\n+            routeTable.setRouteTableType(RouteTableType.NEUTRON);\n+        }\n+        router.setRouteTable(routeTable);\n+        router.setRouterExtraAttributeId(attachedRouterExtraAttributeId);\n+        inNeutronRouter.setRouteTable(routeTable);\n+\n+        this.routerDatabaseService.addRouter(router);\n+        this.routerExtraAttributeDatabaseService.addRouterExtraAttribute(routerExtraAttribute);\n+\n+\n+        return inNeutronRouter;\n+\n+    }\n+\n+    @Override\n+    public RouterInterfaceResponse addAnInterfaceToNeutronRouter(String projectid, String portId, String subnetId, String routerId) throws SpecifyBothSubnetIDAndPortID, ResourceNotFoundException, ResourcePersistenceException, CanNotFindRouter, DatabasePersistenceException, PortIDIsAlreadyExist, PortIsAlreadyInUse, SubnetNotBindUniquePortId {\n+        if (portId != null && subnetId != null) {\n+            throw new SpecifyBothSubnetIDAndPortID();\n+        }\n+\n+        SubnetEntity subnet = null;\n+        String subnetid = null;\n+        String projectId = null;\n+        String attachedRouterId = null;\n+\n+        // Only pass in the value of the port\n+        if (portId != null && subnetId == null) {\n+\n+            // get subnet by port id\n+            SubnetsWebJson subnetsWebJson = this.routerToSubnetService.getSubnetsByPortId(projectid, portId);\n+            if (subnetsWebJson == null) {\n+                return new RouterInterfaceResponse();\n+            }\n+            ArrayList<SubnetEntity> subnets = subnetsWebJson.getSubnets();\n+            if (subnets.size() == 0) {\n+                return new RouterInterfaceResponse();\n+            }\n+            if (subnets.size() != 1) {\n+                throw new SubnetNotBindUniquePortId();\n+            }\n+            subnet = subnets.get(0);\n+            subnetid = subnet.getId();\n+        }\n+        // Only pass in the value of the subnet\n+        else if (portId == null && subnetId != null) {\n+\n+            // get subnet by subnet id\n+            SubnetWebJson subnetWebJson = this.routerToSubnetService.getSubnet(projectid, subnetId);\n+            subnet = subnetWebJson.getSubnet();\n+            if (subnet == null) {\n+                logger.warn(\"can not find subnet by subnet id :\" + subnetId);\n+                return new RouterInterfaceResponse();\n+            }\n+            subnetid = subnetId;\n+        } else {\n+            return new RouterInterfaceResponse();\n+        }\n+        projectId = subnet.getProjectId();\n+        portId = subnet.getGatewayPortId();\n+        attachedRouterId = subnet.getAttachedRouterId();\n+\n+        // check if port_id is used by other router\n+        if (attachedRouterId != null && !attachedRouterId.equals(\"\")) {\n+            throw new PortIsAlreadyInUse();\n+        }\n+        subnet.setAttachedRouterId(routerId);\n+\n+        // update device_id and device_owner\n+        PortEntity portEntity = new PortEntity();\n+        portEntity.setDeviceId(routerId);\n+        portEntity.setDeviceOwner(\"network:router_interface\");\n+        subnet.setPort(portEntity);\n+\n+        // update subnet\n+        this.routerToSubnetService.updateSubnet(projectId, subnetid, subnet);\n+\n+        Router router = this.routerDatabaseService.getByRouterId(routerId);\n+        if (router == null) {\n+            throw new CanNotFindRouter();\n+        }\n+        List<String> ports = router.getPorts();\n+        if (ports == null){\n+            ports = new ArrayList<>();\n+        }\n+\n+        if (ports.contains(portId)) {\n+            throw new PortIDIsAlreadyExist();\n+        }\n+        ports.add(portId);\n+        router.setPorts(ports);\n+        this.routerDatabaseService.addRouter(router);\n+\n+        // Construct response\n+        List<String> subnetIds = new ArrayList<>(){};\n+        subnetIds.add(subnetid);\n+        return new RouterInterfaceResponse(routerId, subnet.getVpcId(), portId, subnetid, subnetIds, projectId, projectId, subnet.getTags());\n+    }\n+\n+    @Override\n+    public RouterInterfaceResponse removeAnInterfaceToNeutronRouter(String projectid, String portId, String subnetId, String routerId) throws ResourceNotFoundException, ResourcePersistenceException, RouterOrSubnetAndPortNotExistOrNotVisible, AttachedPortsNotMatchPortId, RouterTableNotExist, RouterInterfaceAreUsedByRoutes, SubnetNotBindUniquePortId, DatabasePersistenceException {\n+        SubnetEntity subnet = null;\n+        String projectId = null;\n+        String subnetid = null;\n+        String attachedPort = null;\n+        String attachedRouterId = null;\n+\n+        // if pass in both port_id and subnet_id, check conflict\n+        if (portId != null && subnetId != null) {\n+            SubnetWebJson subnetWebJson = this.routerToSubnetService.getSubnet(projectid, subnetId);\n+            subnet = subnetWebJson.getSubnet();\n+            if (subnet == null) {\n+                logger.warn(\"can not find subnet by subnet id :\" + subnetId);\n+                return new RouterInterfaceResponse();\n+            }\n+            attachedPort = subnet.getGatewayPortId();\n+            if (attachedPort != null) {\n+                if (!attachedPort.equals(portId)) {\n+                    throw new AttachedPortsNotMatchPortId();\n+                }\n+            } else {\n+                logger.warn(\"There is no IP address on the port\");\n+                return new RouterInterfaceResponse();\n+            }\n+            subnetid = subnetId;\n+\n+        }else if (portId != null && subnetId == null) {\n+            // get subnet by port id\n+            SubnetsWebJson subnetsWebJson = this.routerToSubnetService.getSubnetsByPortId(projectid, portId);\n+            if (subnetsWebJson == null) {\n+                return new RouterInterfaceResponse();\n+            }\n+            ArrayList<SubnetEntity> subnets = subnetsWebJson.getSubnets();\n+            if (subnets.size() == 0) {\n+                return new RouterInterfaceResponse();\n+            }\n+            if (subnets.size() != 1) {\n+                throw new SubnetNotBindUniquePortId();\n+            }\n+            subnet = subnets.get(0);\n+            subnetid = subnet.getId();\n+        }else if (portId == null && subnetId != null) {\n+            // get subnet by subnet id\n+            SubnetWebJson subnetWebJson = this.routerToSubnetService.getSubnet(projectid, subnetId);\n+            subnet = subnetWebJson.getSubnet();\n+            if (subnet == null) {\n+                logger.warn(\"can not find subnet by subnet id :\" + subnetId);\n+                return new RouterInterfaceResponse();\n+            }\n+            subnetid = subnetId;\n+        }else {\n+            return new RouterInterfaceResponse();\n+        }\n+\n+        // check if the router or the subnet and port do not exist or are not visible\n+        Router router = this.routerDatabaseService.getByRouterId(routerId);\n+        if (router == null) {\n+            throw new RouterOrSubnetAndPortNotExistOrNotVisible();\n+        }\n+\n+        // check if you try to delete the router interface for subnets that are used by one or more route\n+        projectId = subnet.getProjectId();\n+        attachedRouterId = subnet.getAttachedRouterId();\n+        String gatewayIp = subnet.getGatewayIp();\n+        if (gatewayIp != null) {\n+            RouteTable routeTable = router.getRouteTable();\n+            if (routeTable == null) {\n+                throw new RouterTableNotExist();\n+            }\n+\n+            List<RouteEntry> routeEntities = routeTable.getRouteEntities();\n+            for (RouteEntry routeEntry : routeEntities) {\n+                String nextHop = routeEntry.getNexthop();\n+                if (gatewayIp.equals(nextHop)) {\n+                    throw new RouterInterfaceAreUsedByRoutes();\n+                }\n+            }\n+\n+        }\n+\n+        // remove interface\n+        subnet.setAttachedRouterId(\"\");\n+\n+        List<String> ports = router.getPorts();\n+        if (ports == null){\n+            return new RouterInterfaceResponse();\n+        }\n+\n+        if (ports.contains(portId)) {\n+            ports.remove(portId);\n+        }\n+        router.setPorts(ports);\n+        this.routerDatabaseService.addRouter(router);\n+\n+        // update device_id and device_owner\n+        PortEntity portEntity = new PortEntity();\n+        portEntity.setDeviceId(null);\n+        portEntity.setDeviceOwner(null);\n+        subnet.setPort(portEntity);\n+\n+        // update subnet\n+        this.routerToSubnetService.updateSubnet(projectId, subnetid, subnet);\n+\n+        // Construct response\n+        List<String> subnetIds = new ArrayList<>(){};\n+        subnetIds.add(subnetid);\n+        return new RouterInterfaceResponse(routerId, subnet.getVpcId(), portId, subnetid, subnetIds, projectId, projectId, subnet.getTags());\n+\n+    }\n+\n+    @Override\n+    public RoutesToNeutronWebResponse addRoutesToNeutronRouter(String routerid, RoutesToNeutronRouterRequestObject requestRouter) throws ResourceNotFoundException, ResourcePersistenceException, RouterOrSubnetAndPortNotExistOrNotVisible, DatabasePersistenceException, DestinationOrNexthopCanNotBeNull {\n+        RoutesToNeutronRouterResponseObject responseRouter = new RoutesToNeutronRouterResponseObject();\n+        List<RoutesToNeutronRouteObject> responseRoutes = new ArrayList<>();\n+\n+        Router router = this.routerDatabaseService.getByRouterId(routerid);\n+        if (router == null) {\n+            throw new RouterOrSubnetAndPortNotExistOrNotVisible();\n+        }\n+        RouteTable routeTable = router.getRouteTable();\n+        List<RouteEntry> routeEntities = routeTable.getRouteEntities();\n+\n+\n+        List<RoutesToNeutronRouteObject> requestRoutes = requestRouter.getRoutes();\n+        for (RoutesToNeutronRouteObject requestRoute : requestRoutes) {\n+            boolean isExit = false;\n+            String requestDestination = requestRoute.getDestination();\n+            String requestNexthop = requestRoute.getNexthop();\n+\n+            if (requestDestination == null || requestNexthop == null) {\n+                throw new DestinationOrNexthopCanNotBeNull();\n+            }\n+\n+            for (RouteEntry routeEntry : routeEntities) {\n+                String destination = routeEntry.getDestination();\n+                String nexthop = routeEntry.getNexthop();\n+                if (destination.equals(requestDestination) && nexthop.equals(requestNexthop)) {\n+                    isExit = true;\n+                    break;\n+                }\n+            }\n+            if (!isExit) {\n+                RouteEntry routeEntry = new RouteEntry();\n+                routeEntry.setDestination(requestDestination);\n+                routeEntry.setNexthop(requestNexthop);\n+                routeEntities.add(routeEntry);\n+\n+                RoutesToNeutronRouteObject routesToNeutronRouteObject = new RoutesToNeutronRouteObject(requestDestination, requestNexthop);\n+                responseRoutes.add(routesToNeutronRouteObject);\n+            }\n+        }\n+        routeTable.setRouteEntities(routeEntities);\n+        router.setRouteTable(routeTable);\n+        this.routerDatabaseService.addRouter(router);\n+\n+        // Construct response\n+        for (RouteEntry routeEntry : routeEntities) {\n+            String destination = routeEntry.getDestination();\n+            String nexthop = routeEntry.getNexthop();\n+            RoutesToNeutronRouteObject routesToNeutronRouteObject = new RoutesToNeutronRouteObject(destination, nexthop);\n+            responseRoutes.add(routesToNeutronRouteObject);\n+        }\n+        responseRouter.setId(routerid);\n+        responseRouter.setName(router.getName());\n+        responseRouter.setRoutes(responseRoutes);\n+\n+        return new RoutesToNeutronWebResponse(responseRouter);\n+    }\n+\n+    @Override\n+    public RoutesToNeutronWebResponse removeRoutesToNeutronRouter(String routerid, RoutesToNeutronRouterRequestObject requestRouter) throws RouterOrSubnetAndPortNotExistOrNotVisible, ResourceNotFoundException, ResourcePersistenceException, DestinationOrNexthopCanNotBeNull, DatabasePersistenceException {\n+        RoutesToNeutronRouterResponseObject responseRouter = new RoutesToNeutronRouterResponseObject();\n+        List<RoutesToNeutronRouteObject> responseRoutes = new ArrayList<>();\n+\n+        Router router = this.routerDatabaseService.getByRouterId(routerid);\n+        if (router == null) {\n+            throw new RouterOrSubnetAndPortNotExistOrNotVisible();\n+        }\n+        RouteTable routeTable = router.getRouteTable();\n+        List<RouteEntry> routeEntities = routeTable.getRouteEntities();\n+\n+        List<RoutesToNeutronRouteObject> requestRoutes = requestRouter.getRoutes();\n+        for (RoutesToNeutronRouteObject requestRoute : requestRoutes) {\n+            String requestDestination = requestRoute.getDestination();\n+            String requestNexthop = requestRoute.getNexthop();\n+\n+            if (requestDestination == null || requestNexthop == null) {\n+                throw new DestinationOrNexthopCanNotBeNull();\n+            }\n+\n+            for (int i = 0; i < routeEntities.size(); i ++) {\n+                RouteEntry routeEntry = routeEntities.get(i);\n+                String destination = routeEntry.getDestination();\n+                String nexthop = routeEntry.getNexthop();\n+                if (destination.equals(requestDestination) && nexthop.equals(requestNexthop)) {\n+                    routeEntities.remove(i);\n+                    break;\n+                }\n+            }\n+        }\n+        routeTable.setRouteEntities(routeEntities);\n+        router.setRouteTable(routeTable);\n+        this.routerDatabaseService.addRouter(router);\n+\n+        // Construct response\n+        for (RouteEntry routeEntry : routeEntities) {\n+            String destination = routeEntry.getDestination();\n+            String nexthop = routeEntry.getNexthop();\n+            RoutesToNeutronRouteObject routesToNeutronRouteObject = new RoutesToNeutronRouteObject(destination, nexthop);\n+            responseRoutes.add(routesToNeutronRouteObject);\n+        }\n+        responseRouter.setId(routerid);\n+        responseRouter.setName(router.getName());\n+        responseRouter.setRoutes(responseRoutes);\n+\n+        return new RoutesToNeutronWebResponse(responseRouter);\n+    }\n+\n+    @Override\n+    public ConnectedSubnetsWebResponse getConnectedSubnets(String projectId, String vpcId, String subnetId) throws ResourceNotFoundException, ResourcePersistenceException, SubnetNotBindUniquePortId {\n+        List<String> subnetIds = new ArrayList<>();\n+\n+        // get subnet\n+        SubnetWebJson subnetWebJson = this.routerToSubnetService.getSubnet(projectId, subnetId);\n+        SubnetEntity subnet = subnetWebJson.getSubnet();\n+        if (subnet == null) {\n+            logger.warn(\"can not find subnet by subnet id :\" + subnetId);\n+            return null;\n+        }\n+\n+        // get subnet's route table type\n+        String attachedRouterId = subnet.getAttachedRouterId();\n+        if (attachedRouterId == null) {\n+            return null;\n+        }\n+\n+        Router router = this.routerDatabaseService.getByRouterId(attachedRouterId);\n+        if (router == null) {\n+            return null;\n+        }\n+        RouteTable routeTable = router.getRouteTable();\n+        if (routeTable == null) {\n+            return null;\n+        }\n+        RouteTableType routeTableType = routeTable.getRouteTableType();\n+\n+        if (routeTableType == null) {\n+            return null;\n+        } else if(routeTableType.getRouteTableType().equals(\"neutron\")){\n+            List<String> ports = router.getPorts();\n+            // check ports\n+            if (ports == null || ports.size() <= 1) {\n+                return null;\n+            }\n+            for (String portId : ports) {\n+                // get subnet by port id\n+                SubnetsWebJson subnetsWebJson = this.routerToSubnetService.getSubnetsByPortId(projectId, portId);\n+                if (subnetsWebJson == null) {\n+                    return null;\n+                }\n+                ArrayList<SubnetEntity> subnets = subnetsWebJson.getSubnets();\n+                if (subnets.size() == 0) {\n+                    return null;\n+                }\n+                if (subnets.size() != 1) {\n+                    throw new SubnetNotBindUniquePortId();\n+                }\n+                subnet = subnets.get(0);\n+                subnetIds.add(subnet.getId());\n+            }\n+\n+        } else {\n+            // TODO: vpc route operation\n+            return null;\n+        }\n+\n+        // construct result\n+        ConnectedSubnetsWebResponse connectedSubnetsWebResponse = new ConnectedSubnetsWebResponse();\n+        connectedSubnetsWebResponse.setRouter(router);", "originalCommit": "06c30f4298a8ef7b8a8a7567ae5ae352173e7aa6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzI4MDMyNQ==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r483280325", "bodyText": "Yes", "author": "kevin-zhonghao", "createdAt": "2020-09-03T22:09:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzE1MzQ4MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzE1NDg5Mw==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r483154893", "bodyText": "@kevin-zhonghao For VPC, it's simpler than Neutron. We just need to do the following tasks:\n\nget router by VPC:id\nget routetables from the router\nget subnet-ids from each routetable\nreturn all subnet-ids and router info", "author": "cj-chung", "createdAt": "2020-09-03T17:52:12Z", "path": "services/route_manager/src/main/java/com/futurewei/alcor/route/service/Impl/NeutronRouterServiceImpl.java", "diffHunk": "@@ -0,0 +1,484 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+package com.futurewei.alcor.route.service.Impl;\n+\n+import com.futurewei.alcor.common.enumClass.RouteTableType;\n+import com.futurewei.alcor.common.exception.DatabasePersistenceException;\n+import com.futurewei.alcor.common.exception.ResourceNotFoundException;\n+import com.futurewei.alcor.common.exception.ResourcePersistenceException;\n+import com.futurewei.alcor.route.exception.*;\n+import com.futurewei.alcor.route.service.NeutronRouterService;\n+import com.futurewei.alcor.route.service.NeutronRouterToSubnetService;\n+import com.futurewei.alcor.route.service.RouterDatabaseService;\n+import com.futurewei.alcor.route.service.RouterExtraAttributeDatabaseService;\n+import com.futurewei.alcor.web.entity.port.PortEntity;\n+import com.futurewei.alcor.web.entity.route.*;\n+import com.futurewei.alcor.web.entity.subnet.SubnetEntity;\n+import com.futurewei.alcor.web.entity.subnet.SubnetWebJson;\n+import com.futurewei.alcor.web.entity.subnet.SubnetsWebJson;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.BeanUtils;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.stereotype.Service;\n+\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.UUID;\n+\n+@Service\n+public class NeutronRouterServiceImpl implements NeutronRouterService {\n+\n+    private Logger logger = LoggerFactory.getLogger(this.getClass());\n+\n+    @Autowired\n+    private NeutronRouterToSubnetService routerToSubnetService;\n+\n+    @Autowired\n+    private RouterDatabaseService routerDatabaseService;\n+\n+    @Autowired\n+    private RouterExtraAttributeDatabaseService routerExtraAttributeDatabaseService;\n+\n+    @Override\n+    public NeutronRouterWebRequestObject getNeutronRouter(String routerId) throws ResourceNotFoundException, ResourcePersistenceException, CanNotFindRouter {\n+        NeutronRouterWebRequestObject neutronRouterWebRequestObject = new NeutronRouterWebRequestObject();\n+\n+        Router router = this.routerDatabaseService.getByRouterId(routerId);\n+        if (router == null) {\n+            throw new CanNotFindRouter();\n+        }\n+\n+        RouterExtraAttribute routerExtraAttribute = this.routerExtraAttributeDatabaseService.getByRouterExtraAttributeId(router.getRouterExtraAttributeId());\n+\n+        BeanUtils.copyProperties(router, neutronRouterWebRequestObject);\n+        RouteTable routeTable = router.getRouteTable();\n+        neutronRouterWebRequestObject.setRouteTable(routeTable);\n+        if (routerExtraAttribute != null) {\n+            BeanUtils.copyProperties(routerExtraAttribute, neutronRouterWebRequestObject);\n+            neutronRouterWebRequestObject.setId(routerId);\n+        }\n+        return neutronRouterWebRequestObject;\n+    }\n+\n+    @Override\n+    public NeutronRouterWebRequestObject saveRouterAndRouterExtraAttribute(NeutronRouterWebRequestObject neutronRouter) throws NeutronRouterIsNull, DatabasePersistenceException {\n+        if (neutronRouter == null) {\n+            throw new NeutronRouterIsNull();\n+        }\n+        NeutronRouterWebRequestObject inNeutronRouter = new NeutronRouterWebRequestObject();\n+        BeanUtils.copyProperties(neutronRouter, inNeutronRouter);\n+\n+        String attachedRouterExtraAttributeId = UUID.randomUUID().toString();\n+\n+        Router router = new Router();\n+        RouterExtraAttribute routerExtraAttribute = new RouterExtraAttribute();\n+\n+        BeanUtils.copyProperties(neutronRouter, router);\n+        BeanUtils.copyProperties(neutronRouter, routerExtraAttribute);\n+        routerExtraAttribute.setId(attachedRouterExtraAttributeId);\n+        RouteTable routeTable = neutronRouter.getRouteTable();\n+        if (routeTable == null) {\n+            routeTable = new RouteTable();\n+            List<RouteEntry> routeEntities = new ArrayList<>();\n+            String routeTableId = UUID.randomUUID().toString();\n+            routeTable.setId(routeTableId);\n+            routeTable.setRouteEntities(routeEntities);\n+            routeTable.setRouteTableType(RouteTableType.NEUTRON);\n+        }\n+        router.setRouteTable(routeTable);\n+        router.setRouterExtraAttributeId(attachedRouterExtraAttributeId);\n+        inNeutronRouter.setRouteTable(routeTable);\n+\n+        this.routerDatabaseService.addRouter(router);\n+        this.routerExtraAttributeDatabaseService.addRouterExtraAttribute(routerExtraAttribute);\n+\n+\n+        return inNeutronRouter;\n+\n+    }\n+\n+    @Override\n+    public RouterInterfaceResponse addAnInterfaceToNeutronRouter(String projectid, String portId, String subnetId, String routerId) throws SpecifyBothSubnetIDAndPortID, ResourceNotFoundException, ResourcePersistenceException, CanNotFindRouter, DatabasePersistenceException, PortIDIsAlreadyExist, PortIsAlreadyInUse, SubnetNotBindUniquePortId {\n+        if (portId != null && subnetId != null) {\n+            throw new SpecifyBothSubnetIDAndPortID();\n+        }\n+\n+        SubnetEntity subnet = null;\n+        String subnetid = null;\n+        String projectId = null;\n+        String attachedRouterId = null;\n+\n+        // Only pass in the value of the port\n+        if (portId != null && subnetId == null) {\n+\n+            // get subnet by port id\n+            SubnetsWebJson subnetsWebJson = this.routerToSubnetService.getSubnetsByPortId(projectid, portId);\n+            if (subnetsWebJson == null) {\n+                return new RouterInterfaceResponse();\n+            }\n+            ArrayList<SubnetEntity> subnets = subnetsWebJson.getSubnets();\n+            if (subnets.size() == 0) {\n+                return new RouterInterfaceResponse();\n+            }\n+            if (subnets.size() != 1) {\n+                throw new SubnetNotBindUniquePortId();\n+            }\n+            subnet = subnets.get(0);\n+            subnetid = subnet.getId();\n+        }\n+        // Only pass in the value of the subnet\n+        else if (portId == null && subnetId != null) {\n+\n+            // get subnet by subnet id\n+            SubnetWebJson subnetWebJson = this.routerToSubnetService.getSubnet(projectid, subnetId);\n+            subnet = subnetWebJson.getSubnet();\n+            if (subnet == null) {\n+                logger.warn(\"can not find subnet by subnet id :\" + subnetId);\n+                return new RouterInterfaceResponse();\n+            }\n+            subnetid = subnetId;\n+        } else {\n+            return new RouterInterfaceResponse();\n+        }\n+        projectId = subnet.getProjectId();\n+        portId = subnet.getGatewayPortId();\n+        attachedRouterId = subnet.getAttachedRouterId();\n+\n+        // check if port_id is used by other router\n+        if (attachedRouterId != null && !attachedRouterId.equals(\"\")) {\n+            throw new PortIsAlreadyInUse();\n+        }\n+        subnet.setAttachedRouterId(routerId);\n+\n+        // update device_id and device_owner\n+        PortEntity portEntity = new PortEntity();\n+        portEntity.setDeviceId(routerId);\n+        portEntity.setDeviceOwner(\"network:router_interface\");\n+        subnet.setPort(portEntity);\n+\n+        // update subnet\n+        this.routerToSubnetService.updateSubnet(projectId, subnetid, subnet);\n+\n+        Router router = this.routerDatabaseService.getByRouterId(routerId);\n+        if (router == null) {\n+            throw new CanNotFindRouter();\n+        }\n+        List<String> ports = router.getPorts();\n+        if (ports == null){\n+            ports = new ArrayList<>();\n+        }\n+\n+        if (ports.contains(portId)) {\n+            throw new PortIDIsAlreadyExist();\n+        }\n+        ports.add(portId);\n+        router.setPorts(ports);\n+        this.routerDatabaseService.addRouter(router);\n+\n+        // Construct response\n+        List<String> subnetIds = new ArrayList<>(){};\n+        subnetIds.add(subnetid);\n+        return new RouterInterfaceResponse(routerId, subnet.getVpcId(), portId, subnetid, subnetIds, projectId, projectId, subnet.getTags());\n+    }\n+\n+    @Override\n+    public RouterInterfaceResponse removeAnInterfaceToNeutronRouter(String projectid, String portId, String subnetId, String routerId) throws ResourceNotFoundException, ResourcePersistenceException, RouterOrSubnetAndPortNotExistOrNotVisible, AttachedPortsNotMatchPortId, RouterTableNotExist, RouterInterfaceAreUsedByRoutes, SubnetNotBindUniquePortId, DatabasePersistenceException {\n+        SubnetEntity subnet = null;\n+        String projectId = null;\n+        String subnetid = null;\n+        String attachedPort = null;\n+        String attachedRouterId = null;\n+\n+        // if pass in both port_id and subnet_id, check conflict\n+        if (portId != null && subnetId != null) {\n+            SubnetWebJson subnetWebJson = this.routerToSubnetService.getSubnet(projectid, subnetId);\n+            subnet = subnetWebJson.getSubnet();\n+            if (subnet == null) {\n+                logger.warn(\"can not find subnet by subnet id :\" + subnetId);\n+                return new RouterInterfaceResponse();\n+            }\n+            attachedPort = subnet.getGatewayPortId();\n+            if (attachedPort != null) {\n+                if (!attachedPort.equals(portId)) {\n+                    throw new AttachedPortsNotMatchPortId();\n+                }\n+            } else {\n+                logger.warn(\"There is no IP address on the port\");\n+                return new RouterInterfaceResponse();\n+            }\n+            subnetid = subnetId;\n+\n+        }else if (portId != null && subnetId == null) {\n+            // get subnet by port id\n+            SubnetsWebJson subnetsWebJson = this.routerToSubnetService.getSubnetsByPortId(projectid, portId);\n+            if (subnetsWebJson == null) {\n+                return new RouterInterfaceResponse();\n+            }\n+            ArrayList<SubnetEntity> subnets = subnetsWebJson.getSubnets();\n+            if (subnets.size() == 0) {\n+                return new RouterInterfaceResponse();\n+            }\n+            if (subnets.size() != 1) {\n+                throw new SubnetNotBindUniquePortId();\n+            }\n+            subnet = subnets.get(0);\n+            subnetid = subnet.getId();\n+        }else if (portId == null && subnetId != null) {\n+            // get subnet by subnet id\n+            SubnetWebJson subnetWebJson = this.routerToSubnetService.getSubnet(projectid, subnetId);\n+            subnet = subnetWebJson.getSubnet();\n+            if (subnet == null) {\n+                logger.warn(\"can not find subnet by subnet id :\" + subnetId);\n+                return new RouterInterfaceResponse();\n+            }\n+            subnetid = subnetId;\n+        }else {\n+            return new RouterInterfaceResponse();\n+        }\n+\n+        // check if the router or the subnet and port do not exist or are not visible\n+        Router router = this.routerDatabaseService.getByRouterId(routerId);\n+        if (router == null) {\n+            throw new RouterOrSubnetAndPortNotExistOrNotVisible();\n+        }\n+\n+        // check if you try to delete the router interface for subnets that are used by one or more route\n+        projectId = subnet.getProjectId();\n+        attachedRouterId = subnet.getAttachedRouterId();\n+        String gatewayIp = subnet.getGatewayIp();\n+        if (gatewayIp != null) {\n+            RouteTable routeTable = router.getRouteTable();\n+            if (routeTable == null) {\n+                throw new RouterTableNotExist();\n+            }\n+\n+            List<RouteEntry> routeEntities = routeTable.getRouteEntities();\n+            for (RouteEntry routeEntry : routeEntities) {\n+                String nextHop = routeEntry.getNexthop();\n+                if (gatewayIp.equals(nextHop)) {\n+                    throw new RouterInterfaceAreUsedByRoutes();\n+                }\n+            }\n+\n+        }\n+\n+        // remove interface\n+        subnet.setAttachedRouterId(\"\");\n+\n+        List<String> ports = router.getPorts();\n+        if (ports == null){\n+            return new RouterInterfaceResponse();\n+        }\n+\n+        if (ports.contains(portId)) {\n+            ports.remove(portId);\n+        }\n+        router.setPorts(ports);\n+        this.routerDatabaseService.addRouter(router);\n+\n+        // update device_id and device_owner\n+        PortEntity portEntity = new PortEntity();\n+        portEntity.setDeviceId(null);\n+        portEntity.setDeviceOwner(null);\n+        subnet.setPort(portEntity);\n+\n+        // update subnet\n+        this.routerToSubnetService.updateSubnet(projectId, subnetid, subnet);\n+\n+        // Construct response\n+        List<String> subnetIds = new ArrayList<>(){};\n+        subnetIds.add(subnetid);\n+        return new RouterInterfaceResponse(routerId, subnet.getVpcId(), portId, subnetid, subnetIds, projectId, projectId, subnet.getTags());\n+\n+    }\n+\n+    @Override\n+    public RoutesToNeutronWebResponse addRoutesToNeutronRouter(String routerid, RoutesToNeutronRouterRequestObject requestRouter) throws ResourceNotFoundException, ResourcePersistenceException, RouterOrSubnetAndPortNotExistOrNotVisible, DatabasePersistenceException, DestinationOrNexthopCanNotBeNull {\n+        RoutesToNeutronRouterResponseObject responseRouter = new RoutesToNeutronRouterResponseObject();\n+        List<RoutesToNeutronRouteObject> responseRoutes = new ArrayList<>();\n+\n+        Router router = this.routerDatabaseService.getByRouterId(routerid);\n+        if (router == null) {\n+            throw new RouterOrSubnetAndPortNotExistOrNotVisible();\n+        }\n+        RouteTable routeTable = router.getRouteTable();\n+        List<RouteEntry> routeEntities = routeTable.getRouteEntities();\n+\n+\n+        List<RoutesToNeutronRouteObject> requestRoutes = requestRouter.getRoutes();\n+        for (RoutesToNeutronRouteObject requestRoute : requestRoutes) {\n+            boolean isExit = false;\n+            String requestDestination = requestRoute.getDestination();\n+            String requestNexthop = requestRoute.getNexthop();\n+\n+            if (requestDestination == null || requestNexthop == null) {\n+                throw new DestinationOrNexthopCanNotBeNull();\n+            }\n+\n+            for (RouteEntry routeEntry : routeEntities) {\n+                String destination = routeEntry.getDestination();\n+                String nexthop = routeEntry.getNexthop();\n+                if (destination.equals(requestDestination) && nexthop.equals(requestNexthop)) {\n+                    isExit = true;\n+                    break;\n+                }\n+            }\n+            if (!isExit) {\n+                RouteEntry routeEntry = new RouteEntry();\n+                routeEntry.setDestination(requestDestination);\n+                routeEntry.setNexthop(requestNexthop);\n+                routeEntities.add(routeEntry);\n+\n+                RoutesToNeutronRouteObject routesToNeutronRouteObject = new RoutesToNeutronRouteObject(requestDestination, requestNexthop);\n+                responseRoutes.add(routesToNeutronRouteObject);\n+            }\n+        }\n+        routeTable.setRouteEntities(routeEntities);\n+        router.setRouteTable(routeTable);\n+        this.routerDatabaseService.addRouter(router);\n+\n+        // Construct response\n+        for (RouteEntry routeEntry : routeEntities) {\n+            String destination = routeEntry.getDestination();\n+            String nexthop = routeEntry.getNexthop();\n+            RoutesToNeutronRouteObject routesToNeutronRouteObject = new RoutesToNeutronRouteObject(destination, nexthop);\n+            responseRoutes.add(routesToNeutronRouteObject);\n+        }\n+        responseRouter.setId(routerid);\n+        responseRouter.setName(router.getName());\n+        responseRouter.setRoutes(responseRoutes);\n+\n+        return new RoutesToNeutronWebResponse(responseRouter);\n+    }\n+\n+    @Override\n+    public RoutesToNeutronWebResponse removeRoutesToNeutronRouter(String routerid, RoutesToNeutronRouterRequestObject requestRouter) throws RouterOrSubnetAndPortNotExistOrNotVisible, ResourceNotFoundException, ResourcePersistenceException, DestinationOrNexthopCanNotBeNull, DatabasePersistenceException {\n+        RoutesToNeutronRouterResponseObject responseRouter = new RoutesToNeutronRouterResponseObject();\n+        List<RoutesToNeutronRouteObject> responseRoutes = new ArrayList<>();\n+\n+        Router router = this.routerDatabaseService.getByRouterId(routerid);\n+        if (router == null) {\n+            throw new RouterOrSubnetAndPortNotExistOrNotVisible();\n+        }\n+        RouteTable routeTable = router.getRouteTable();\n+        List<RouteEntry> routeEntities = routeTable.getRouteEntities();\n+\n+        List<RoutesToNeutronRouteObject> requestRoutes = requestRouter.getRoutes();\n+        for (RoutesToNeutronRouteObject requestRoute : requestRoutes) {\n+            String requestDestination = requestRoute.getDestination();\n+            String requestNexthop = requestRoute.getNexthop();\n+\n+            if (requestDestination == null || requestNexthop == null) {\n+                throw new DestinationOrNexthopCanNotBeNull();\n+            }\n+\n+            for (int i = 0; i < routeEntities.size(); i ++) {\n+                RouteEntry routeEntry = routeEntities.get(i);\n+                String destination = routeEntry.getDestination();\n+                String nexthop = routeEntry.getNexthop();\n+                if (destination.equals(requestDestination) && nexthop.equals(requestNexthop)) {\n+                    routeEntities.remove(i);\n+                    break;\n+                }\n+            }\n+        }\n+        routeTable.setRouteEntities(routeEntities);\n+        router.setRouteTable(routeTable);\n+        this.routerDatabaseService.addRouter(router);\n+\n+        // Construct response\n+        for (RouteEntry routeEntry : routeEntities) {\n+            String destination = routeEntry.getDestination();\n+            String nexthop = routeEntry.getNexthop();\n+            RoutesToNeutronRouteObject routesToNeutronRouteObject = new RoutesToNeutronRouteObject(destination, nexthop);\n+            responseRoutes.add(routesToNeutronRouteObject);\n+        }\n+        responseRouter.setId(routerid);\n+        responseRouter.setName(router.getName());\n+        responseRouter.setRoutes(responseRoutes);\n+\n+        return new RoutesToNeutronWebResponse(responseRouter);\n+    }\n+\n+    @Override\n+    public ConnectedSubnetsWebResponse getConnectedSubnets(String projectId, String vpcId, String subnetId) throws ResourceNotFoundException, ResourcePersistenceException, SubnetNotBindUniquePortId {\n+        List<String> subnetIds = new ArrayList<>();\n+\n+        // get subnet\n+        SubnetWebJson subnetWebJson = this.routerToSubnetService.getSubnet(projectId, subnetId);\n+        SubnetEntity subnet = subnetWebJson.getSubnet();\n+        if (subnet == null) {\n+            logger.warn(\"can not find subnet by subnet id :\" + subnetId);\n+            return null;\n+        }\n+\n+        // get subnet's route table type\n+        String attachedRouterId = subnet.getAttachedRouterId();\n+        if (attachedRouterId == null) {\n+            return null;\n+        }\n+\n+        Router router = this.routerDatabaseService.getByRouterId(attachedRouterId);\n+        if (router == null) {\n+            return null;\n+        }\n+        RouteTable routeTable = router.getRouteTable();\n+        if (routeTable == null) {\n+            return null;\n+        }\n+        RouteTableType routeTableType = routeTable.getRouteTableType();\n+\n+        if (routeTableType == null) {\n+            return null;\n+        } else if(routeTableType.getRouteTableType().equals(\"neutron\")){\n+            List<String> ports = router.getPorts();\n+            // check ports\n+            if (ports == null || ports.size() <= 1) {\n+                return null;\n+            }\n+            for (String portId : ports) {\n+                // get subnet by port id\n+                SubnetsWebJson subnetsWebJson = this.routerToSubnetService.getSubnetsByPortId(projectId, portId);\n+                if (subnetsWebJson == null) {\n+                    return null;\n+                }\n+                ArrayList<SubnetEntity> subnets = subnetsWebJson.getSubnets();\n+                if (subnets.size() == 0) {\n+                    return null;\n+                }\n+                if (subnets.size() != 1) {\n+                    throw new SubnetNotBindUniquePortId();\n+                }\n+                subnet = subnets.get(0);\n+                subnetIds.add(subnet.getId());\n+            }\n+\n+        } else {\n+            // TODO: vpc route operation\n+            return null;", "originalCommit": "06c30f4298a8ef7b8a8a7567ae5ae352173e7aa6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "1c59b868d43b27c09a84b63248e316c38fabca3b", "url": "https://github.com/futurewei-cloud/alcor/commit/1c59b868d43b27c09a84b63248e316c38fabca3b", "message": "fix comments", "committedDate": "2020-09-03T22:47:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzg2Njg4OA==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r483866888", "bodyText": "Really like the comprehensive set of tests in this file \ud83d\udcaf", "author": "xieus", "createdAt": "2020-09-04T22:22:42Z", "path": "services/route_manager/src/test/java/com/futurewei/alcor/route/NeutronRouterTests.java", "diffHunk": "@@ -0,0 +1,561 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+package com.futurewei.alcor.route;\n+\n+import static org.mockito.ArgumentMatchers.*;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.*;\n+import static org.springframework.test.web.servlet.result.MockMvcResultHandlers.print;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;\n+import static org.junit.Assert.*;\n+\n+import com.futurewei.alcor.common.enumClass.RouteTableType;\n+import com.futurewei.alcor.route.config.UnitTestConfig;\n+import com.futurewei.alcor.route.service.NeutronRouterToSubnetService;\n+import com.futurewei.alcor.route.service.RouterDatabaseService;\n+import com.futurewei.alcor.route.service.RouterExtraAttributeDatabaseService;\n+import com.futurewei.alcor.web.entity.route.RouteTable;\n+import com.futurewei.alcor.web.entity.route.Router;\n+import com.futurewei.alcor.web.entity.route.RouterExtraAttribute;\n+import com.futurewei.alcor.web.entity.subnet.SubnetEntity;\n+import com.futurewei.alcor.web.entity.subnet.SubnetWebJson;\n+import com.futurewei.alcor.web.entity.subnet.SubnetsWebJson;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.mockito.Mockito;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;\n+import org.springframework.boot.test.context.SpringBootTest;\n+import org.springframework.boot.test.mock.mockito.MockBean;\n+import org.springframework.context.annotation.ComponentScan;\n+import org.springframework.http.MediaType;\n+import org.springframework.test.context.junit4.SpringRunner;\n+import org.springframework.test.web.servlet.MockMvc;\n+import org.springframework.test.web.servlet.result.MockMvcResultMatchers;\n+\n+import java.util.ArrayList;\n+\n+@ComponentScan(value = \"com.futurewei.alcor.common.test.config\")\n+@RunWith(SpringRunner.class)\n+@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT,\n+        properties = {\"httpbin=http://localhost:${wiremock.server.port}\"})\n+@AutoConfigureMockMvc\n+public class NeutronRouterTests {\n+\n+    @Autowired\n+    private MockMvc mockMvc;\n+\n+    @MockBean\n+    private NeutronRouterToSubnetService routerToSubnetService;\n+\n+    @MockBean\n+    private RouterDatabaseService routerDatabaseService;\n+\n+    @MockBean\n+    private RouterExtraAttributeDatabaseService routerExtraAttributeDatabaseService;\n+\n+    private String getNeutronRouterByRouterIdUri = \"/project/\" + UnitTestConfig.projectId + \"/routers/\" + UnitTestConfig.routerId;\n+    private String createNeutronRoutersUri = \"/project/\" + UnitTestConfig.projectId + \"/routers\";\n+    private String updateNeutronRouterByRouterIdUri = \"/project/\" + UnitTestConfig.projectId + \"/routers/\" + UnitTestConfig.routerId;\n+    private String deleteNeutronRouterByRouterIdUri = \"/project/\" + UnitTestConfig.projectId + \"/routers/\" + UnitTestConfig.routerId;\n+    private String addInterfaceToNeutronRouterUri = \"/project/\" + UnitTestConfig.projectId + \"/routers/\" + UnitTestConfig.routerId + \"/add_router_interface\";\n+    private String removeInterfaceToNeutronRouterUri = \"/project/\" + UnitTestConfig.projectId + \"/routers/\" + UnitTestConfig.routerId + \"/remove_router_interface\";\n+    private String addRoutesToNeutronRouterUri = \"/project/\" + UnitTestConfig.projectId + \"/routers/\" + UnitTestConfig.routerId + \"/add_extra_routes\";\n+    private String removeRoutesToNeutronRouterUri = \"/project/\" + UnitTestConfig.projectId + \"/routers/\" + UnitTestConfig.routerId + \"/remove_extra_routes\";\n+    private String getConnectedSubnets = \"/project/\" + UnitTestConfig.projectId + \"/vpcs/\" + UnitTestConfig.vpcId + \"/subnets/\" + UnitTestConfig.subnetId + \"/connected-subnets\";\n+\n+    @Test\n+    public void getNeutronRouterById_pass () throws Exception {\n+        Mockito.when(routerDatabaseService.getByRouterId(UnitTestConfig.routerId))\n+                .thenReturn(new Router(){{setId(UnitTestConfig.routerId);}});\n+        Mockito.when(routerExtraAttributeDatabaseService.getByRouterExtraAttributeId(anyString()))\n+                .thenReturn(new RouterExtraAttribute(){{setId(UnitTestConfig.routerExtraAttributeId);}});\n+        this.mockMvc.perform(get(getNeutronRouterByRouterIdUri))\n+                .andDo(print())\n+                .andExpect(status().isOk())\n+                .andExpect(MockMvcResultMatchers.jsonPath(\"$.router.id\").value(UnitTestConfig.routerId));\n+    }\n+\n+    @Test\n+    public void getNeutronRouterById_canNotFindRouter_notPass () throws Exception {\n+        Mockito.when(routerDatabaseService.getByRouterId(UnitTestConfig.routerId))\n+                .thenReturn(null);\n+        Mockito.when(routerExtraAttributeDatabaseService.getByRouterExtraAttributeId(anyString()))\n+                .thenReturn(new RouterExtraAttribute(){{setId(UnitTestConfig.routerExtraAttributeId);}});\n+        try {\n+            String response = this.mockMvc.perform(get(getNeutronRouterByRouterIdUri))\n+                    .andDo(print())\n+                    .andExpect(status().isOk())\n+                    .andReturn().getResponse().getContentAsString();\n+            assertEquals(\"{\\\"router\\\":null}\", response);\n+        }catch (Exception e) {\n+            System.out.println(\"-----json returned =\" + e.getMessage());\n+            throw e;\n+        }\n+    }\n+\n+    @Test\n+    public void createNeutronRouters_pass () throws Exception {\n+        try {\n+            this.mockMvc.perform(post(createNeutronRoutersUri).contentType(MediaType.APPLICATION_JSON)\n+                    .content(UnitTestConfig.neutronRouterResource))\n+                    .andDo(print())\n+                    .andExpect(status().isOk())\n+                    .andExpect(MockMvcResultMatchers.jsonPath(\"$.router.id\").value(UnitTestConfig.routerId));\n+        } catch (Exception e) {\n+            throw e;\n+        }\n+    }\n+\n+    @Test\n+    public void updateNeutronRouter_pass () throws Exception {\n+        Mockito.when(routerDatabaseService.getByRouterId(UnitTestConfig.routerId))\n+                .thenReturn(new Router(){{setId(UnitTestConfig.routerId);}});\n+        Mockito.when(routerExtraAttributeDatabaseService.getByRouterExtraAttributeId(anyString()))\n+                .thenReturn(new RouterExtraAttribute(){{setId(UnitTestConfig.routerExtraAttributeId);}});\n+\n+        try {\n+            this.mockMvc.perform(put(updateNeutronRouterByRouterIdUri).contentType(MediaType.APPLICATION_JSON)\n+                    .content(UnitTestConfig.neutronRouterUpdateResource))\n+                    .andDo(print())\n+                    .andExpect(status().isOk())\n+                    .andExpect(MockMvcResultMatchers.jsonPath(\"$.router.id\").value(UnitTestConfig.updateRouterId));\n+        } catch (Exception e) {\n+            throw e;\n+        }\n+    }\n+\n+    @Test\n+    public void updateNeutronRouter_canNotFindRouter_notPass () throws Exception {\n+        Mockito.when(routerDatabaseService.getByRouterId(UnitTestConfig.routerId))\n+                .thenReturn(null);\n+        Mockito.when(routerExtraAttributeDatabaseService.getByRouterExtraAttributeId(anyString()))\n+                .thenReturn(new RouterExtraAttribute(){{setId(UnitTestConfig.routerExtraAttributeId);}});\n+        try {\n+            String response = this.mockMvc.perform(get(getNeutronRouterByRouterIdUri))\n+                    .andDo(print())\n+                    .andExpect(status().isOk())\n+                    .andReturn().getResponse().getContentAsString();\n+            assertEquals(\"{\\\"router\\\":null}\", response);\n+        }catch (Exception e) {\n+            System.out.println(\"-----json returned =\" + e.getMessage());\n+            throw e;\n+        }\n+    }\n+\n+    @Test\n+    public void deleteNeutronRouter_pass () throws Exception {\n+        Mockito.when(routerDatabaseService.getByRouterId(UnitTestConfig.routerId))\n+                .thenReturn(new Router(){{setId(UnitTestConfig.routerId);setRouterExtraAttributeId(UnitTestConfig.routerExtraAttributeId);}});\n+        Mockito.when(routerExtraAttributeDatabaseService.getByRouterExtraAttributeId(anyString()))\n+                .thenReturn(new RouterExtraAttribute(){{setId(UnitTestConfig.routerExtraAttributeId);}});\n+        try {\n+            this.mockMvc.perform(delete(deleteNeutronRouterByRouterIdUri))\n+                    .andDo(print())\n+                    .andExpect(status().isOk())\n+                    .andExpect(MockMvcResultMatchers.jsonPath(\"$.id\").value(UnitTestConfig.routerId));\n+        } catch (Exception e) {\n+            throw e;\n+        }\n+    }\n+\n+    @Test\n+    public void deleteNeutronRouter_canNotFindRouter_notPass () throws Exception {\n+        Mockito.when(routerDatabaseService.getByRouterId(UnitTestConfig.routerId))\n+                .thenReturn(null);\n+        Mockito.when(routerExtraAttributeDatabaseService.getByRouterExtraAttributeId(anyString()))\n+                .thenReturn(new RouterExtraAttribute(){{setId(UnitTestConfig.routerExtraAttributeId);}});\n+        try {\n+            String response = this.mockMvc.perform(delete(deleteNeutronRouterByRouterIdUri))\n+                    .andDo(print())\n+                    .andExpect(status().isOk())\n+                    .andReturn().getResponse().getContentAsString();\n+            assertEquals(\"{\\\"id\\\":null}\", response);\n+        } catch (Exception e) {\n+            throw e;\n+        }\n+    }\n+\n+    @Test\n+    public void deleteNeutronRouter_canNotFindRouterExtraAttribute_notPass () throws Exception {\n+        Mockito.when(routerDatabaseService.getByRouterId(UnitTestConfig.routerId))\n+                .thenReturn(new Router(){{setId(UnitTestConfig.routerId);setRouterExtraAttributeId(UnitTestConfig.routerExtraAttributeId);}});\n+        Mockito.when(routerExtraAttributeDatabaseService.getByRouterExtraAttributeId(anyString()))\n+                .thenReturn(null);\n+        try {\n+            String response = this.mockMvc.perform(delete(deleteNeutronRouterByRouterIdUri))\n+                    .andDo(print())\n+                    .andExpect(status().isOk())\n+                    .andReturn().getResponse().getContentAsString();\n+            assertEquals(\"{\\\"id\\\":null}\", response);\n+        } catch (Exception e) {\n+            throw e;\n+        }\n+    }\n+\n+    @Test\n+    public void addInterfaceToNeutronRouter_onlyPassInPortId_pass () throws Exception {\n+        Mockito.when(routerDatabaseService.getByRouterId(UnitTestConfig.routerId))\n+                .thenReturn(new Router(){{setId(UnitTestConfig.routerId);}});\n+        Mockito.when(routerToSubnetService.getSubnetsByPortId(anyString(), anyString()))\n+                .thenReturn(new SubnetsWebJson(){{setSubnets(new ArrayList<SubnetEntity>(){{add(new SubnetEntity(){{setId(UnitTestConfig.subnetId);setGatewayPortId(UnitTestConfig.portId);}});}});}});\n+        Mockito.when(routerToSubnetService.getSubnet(anyString(), anyString()))\n+                .thenReturn(new SubnetWebJson(){{setSubnet(new SubnetEntity());}});\n+\n+        try {\n+            this.mockMvc.perform(put(addInterfaceToNeutronRouterUri).contentType(MediaType.APPLICATION_JSON)\n+                    .content(UnitTestConfig.routerInterfaceRequest_port))\n+                    .andDo(print())\n+                    .andExpect(status().isOk())\n+                    .andExpect(MockMvcResultMatchers.jsonPath(\"$.port_id\").value(UnitTestConfig.portId));\n+        } catch (Exception e) {\n+            throw e;\n+        }\n+\n+    }\n+\n+    @Test\n+    public void addInterfaceToNeutronRouter_onlyPassInSubnetId_pass () throws Exception {\n+        Mockito.when(routerDatabaseService.getByRouterId(UnitTestConfig.routerId))\n+                .thenReturn(new Router(){{setId(UnitTestConfig.routerId);}});\n+        Mockito.when(routerToSubnetService.getSubnetsByPortId(anyString(), anyString()))\n+                .thenReturn(new SubnetsWebJson(){{setSubnets(new ArrayList<SubnetEntity>(){{add(new SubnetEntity(){{setId(UnitTestConfig.subnetId);setGatewayPortId(UnitTestConfig.portId);}});}});}});\n+        Mockito.when(routerToSubnetService.getSubnet(anyString(), anyString()))\n+                .thenReturn(new SubnetWebJson(){{setSubnet(new SubnetEntity(){{setId(UnitTestConfig.subnetId);setGatewayPortId(UnitTestConfig.portId);}});}});\n+\n+        try {\n+            this.mockMvc.perform(put(addInterfaceToNeutronRouterUri).contentType(MediaType.APPLICATION_JSON)\n+                    .content(UnitTestConfig.routerInterfaceRequest_subnet))\n+                    .andDo(print())\n+                    .andExpect(status().isOk())\n+                    .andExpect(MockMvcResultMatchers.jsonPath(\"$.subnet_id\").value(UnitTestConfig.subnetId));\n+        } catch (Exception e) {\n+            throw e;\n+        }\n+\n+    }\n+\n+    @Test\n+    public void addInterfaceToNeutronRouter_passInBothSubnetIdAndPortId_notPass () throws Exception {\n+        Mockito.when(routerDatabaseService.getByRouterId(UnitTestConfig.routerId))\n+                .thenReturn(new Router(){{setId(UnitTestConfig.routerId);}});\n+        Mockito.when(routerToSubnetService.getSubnetsByPortId(anyString(), anyString()))\n+                .thenReturn(new SubnetsWebJson(){{setSubnets(new ArrayList<SubnetEntity>(){{add(new SubnetEntity(){{setId(UnitTestConfig.subnetId);setGatewayPortId(UnitTestConfig.portId);}});}});}});\n+        Mockito.when(routerToSubnetService.getSubnet(anyString(), anyString()))\n+                .thenReturn(new SubnetWebJson(){{setSubnet(new SubnetEntity(){{setId(UnitTestConfig.subnetId);setGatewayPortId(UnitTestConfig.portId);}});}});\n+\n+        try {\n+            this.mockMvc.perform(put(addInterfaceToNeutronRouterUri).contentType(MediaType.APPLICATION_JSON)\n+                    .content(UnitTestConfig.routerInterfaceRequest_subnetAndPort))\n+                    .andDo(print())\n+                    .andExpect(status().is(400));\n+        } catch (Exception e) {\n+            System.out.println(\"-----json returned =\" + e.getMessage());\n+            throw e;\n+        }\n+\n+    }\n+\n+    @Test\n+    public void addInterfaceToNeutronRouter_onlyPassInPortId_SubnetNotBindUniquePortId_notPass () throws Exception {\n+        Mockito.when(routerDatabaseService.getByRouterId(UnitTestConfig.routerId))\n+                .thenReturn(new Router(){{setId(UnitTestConfig.routerId);}});\n+        Mockito.when(routerToSubnetService.getSubnetsByPortId(anyString(), anyString()))\n+                .thenReturn(new SubnetsWebJson(){{setSubnets(new ArrayList<SubnetEntity>(){{add(new SubnetEntity(){{setId(UnitTestConfig.subnetId);setGatewayPortId(UnitTestConfig.portId);}});add(new SubnetEntity());}});}});\n+        Mockito.when(routerToSubnetService.getSubnet(anyString(), anyString()))\n+                .thenReturn(new SubnetWebJson(){{setSubnet(new SubnetEntity());}});\n+\n+        try {\n+            this.mockMvc.perform(put(addInterfaceToNeutronRouterUri).contentType(MediaType.APPLICATION_JSON)\n+                    .content(UnitTestConfig.routerInterfaceRequest_port))\n+                    .andDo(print())\n+                    .andExpect(status().is(409));\n+        } catch (Exception e) {\n+            throw e;\n+        }\n+\n+    }\n+\n+    @Test\n+    public void addInterfaceToNeutronRouter_onlyPassInPortId_PortIsAlreadyInUse_notPass () throws Exception {\n+        Mockito.when(routerDatabaseService.getByRouterId(UnitTestConfig.routerId))\n+                .thenReturn(new Router(){{setId(UnitTestConfig.routerId);}});\n+        Mockito.when(routerToSubnetService.getSubnetsByPortId(anyString(), anyString()))\n+                .thenReturn(new SubnetsWebJson(){{setSubnets(new ArrayList<SubnetEntity>(){{add(new SubnetEntity(){{setId(UnitTestConfig.subnetId);setGatewayPortId(UnitTestConfig.portId);setAttachedRouterId(UnitTestConfig.routerId);}});}});}});\n+        Mockito.when(routerToSubnetService.getSubnet(anyString(), anyString()))\n+                .thenReturn(new SubnetWebJson(){{setSubnet(new SubnetEntity());}});\n+\n+        try {\n+            this.mockMvc.perform(put(addInterfaceToNeutronRouterUri).contentType(MediaType.APPLICATION_JSON)\n+                    .content(UnitTestConfig.routerInterfaceRequest_port))\n+                    .andDo(print())\n+                    .andExpect(status().is(409));\n+        } catch (Exception e) {\n+            throw e;\n+        }\n+\n+    }\n+\n+    @Test\n+    public void addInterfaceToNeutronRouter_onlyPassInPortId_CanNotFindRouter_notPass () throws Exception {\n+        Mockito.when(routerDatabaseService.getByRouterId(UnitTestConfig.routerId))\n+                .thenReturn(null);\n+        Mockito.when(routerToSubnetService.getSubnetsByPortId(anyString(), anyString()))\n+                .thenReturn(new SubnetsWebJson(){{setSubnets(new ArrayList<SubnetEntity>(){{add(new SubnetEntity(){{setId(UnitTestConfig.subnetId);setGatewayPortId(UnitTestConfig.portId);}});}});}});\n+        Mockito.when(routerToSubnetService.getSubnet(anyString(), anyString()))\n+                .thenReturn(new SubnetWebJson(){{setSubnet(new SubnetEntity());}});\n+\n+        try {\n+            this.mockMvc.perform(put(addInterfaceToNeutronRouterUri).contentType(MediaType.APPLICATION_JSON)\n+                    .content(UnitTestConfig.routerInterfaceRequest_port))\n+                    .andDo(print())\n+                    .andExpect(status().is(500));\n+        } catch (Exception e) {\n+            throw e;\n+        }\n+\n+    }\n+\n+    @Test\n+    public void removeInterfaceToNeutronRouter_onlyPassInPortId_pass () throws Exception {\n+        Mockito.when(routerDatabaseService.getByRouterId(UnitTestConfig.routerId))\n+                .thenReturn(new Router(){{setId(UnitTestConfig.routerId);setPorts(new ArrayList<>());\n+                    setNeutronRouteTable(new RouteTable(){{setRouteEntities(new ArrayList<>());}});}});\n+        Mockito.when(routerToSubnetService.getSubnetsByPortId(anyString(), anyString()))\n+                .thenReturn(new SubnetsWebJson(){{setSubnets(new ArrayList<SubnetEntity>(){{add(new SubnetEntity(){{setId(UnitTestConfig.subnetId);setGatewayPortId(UnitTestConfig.portId);}});}});}});\n+        Mockito.when(routerToSubnetService.getSubnet(anyString(), anyString()))\n+                .thenReturn(new SubnetWebJson(){{setSubnet(new SubnetEntity(){{setId(UnitTestConfig.subnetId);setGatewayPortId(UnitTestConfig.portId);}});}});\n+\n+        try {\n+            this.mockMvc.perform(put(removeInterfaceToNeutronRouterUri).contentType(MediaType.APPLICATION_JSON)\n+                    .content(UnitTestConfig.routerInterfaceRequest_port))\n+                    .andDo(print())\n+                    .andExpect(status().isOk())\n+                    .andExpect(MockMvcResultMatchers.jsonPath(\"$.port_id\").value(UnitTestConfig.portId));\n+        } catch (Exception e) {\n+            throw e;\n+        }\n+\n+    }\n+\n+    @Test\n+    public void removeInterfaceToNeutronRouter_onlyPassInSubnetId_pass () throws Exception {\n+        Mockito.when(routerDatabaseService.getByRouterId(UnitTestConfig.routerId))\n+                .thenReturn(new Router(){{setId(UnitTestConfig.routerId);setPorts(new ArrayList<>());\n+                    setNeutronRouteTable(new RouteTable(){{setRouteEntities(new ArrayList<>());}});}});\n+        Mockito.when(routerToSubnetService.getSubnetsByPortId(anyString(), anyString()))\n+                .thenReturn(new SubnetsWebJson(){{setSubnets(new ArrayList<SubnetEntity>(){{add(new SubnetEntity(){{setId(UnitTestConfig.subnetId);setGatewayPortId(UnitTestConfig.portId);}});}});}});\n+        Mockito.when(routerToSubnetService.getSubnet(anyString(), anyString()))\n+                .thenReturn(new SubnetWebJson(){{setSubnet(new SubnetEntity(){{setId(UnitTestConfig.subnetId);setGatewayPortId(UnitTestConfig.portId);}});}});\n+\n+        try {\n+            this.mockMvc.perform(put(removeInterfaceToNeutronRouterUri).contentType(MediaType.APPLICATION_JSON)\n+                    .content(UnitTestConfig.routerInterfaceRequest_subnet))\n+                    .andDo(print())\n+                    .andExpect(status().isOk())\n+                    .andExpect(MockMvcResultMatchers.jsonPath(\"$.subnet_id\").value(UnitTestConfig.subnetId));\n+        } catch (Exception e) {\n+            throw e;\n+        }\n+\n+    }\n+\n+    @Test\n+    public void removeInterfaceToNeutronRouter_passInBothSubnetIdAndPortId_pass () throws Exception {\n+        Mockito.when(routerDatabaseService.getByRouterId(UnitTestConfig.routerId))\n+                .thenReturn(new Router(){{setId(UnitTestConfig.routerId);setPorts(new ArrayList<>());\n+                    setNeutronRouteTable(new RouteTable(){{setRouteEntities(new ArrayList<>());}});}});\n+        Mockito.when(routerToSubnetService.getSubnetsByPortId(anyString(), anyString()))\n+                .thenReturn(new SubnetsWebJson(){{setSubnets(new ArrayList<SubnetEntity>(){{add(new SubnetEntity(){{setId(UnitTestConfig.subnetId);setGatewayPortId(UnitTestConfig.portId);}});}});}});\n+        Mockito.when(routerToSubnetService.getSubnet(anyString(), anyString()))\n+                .thenReturn(new SubnetWebJson(){{setSubnet(new SubnetEntity(){{setId(UnitTestConfig.subnetId);setGatewayPortId(UnitTestConfig.portId);}});}});\n+\n+        try {\n+            this.mockMvc.perform(put(removeInterfaceToNeutronRouterUri).contentType(MediaType.APPLICATION_JSON)\n+                    .content(UnitTestConfig.routerInterfaceRequest_subnetAndPort))\n+                    .andDo(print())\n+                    .andExpect(status().isOk())\n+                    .andExpect(MockMvcResultMatchers.jsonPath(\"$.subnet_id\").value(UnitTestConfig.subnetId));\n+        } catch (Exception e) {\n+            throw e;\n+        }\n+\n+    }\n+\n+    @Test\n+    public void removeInterfaceToNeutronRouter_passInBothSubnetIdAndPortId_SubnetNotBindUniquePortId_notPass () throws Exception {\n+        Mockito.when(routerDatabaseService.getByRouterId(UnitTestConfig.routerId))\n+                .thenReturn(new Router(){{setId(UnitTestConfig.routerId);setPorts(new ArrayList<>());\n+                    setNeutronRouteTable(new RouteTable(){{setRouteEntities(new ArrayList<>());}});}});\n+        Mockito.when(routerToSubnetService.getSubnetsByPortId(anyString(), anyString()))\n+                .thenReturn(new SubnetsWebJson(){{setSubnets(new ArrayList<SubnetEntity>(){{add(new SubnetEntity(){{setId(UnitTestConfig.subnetId);setGatewayPortId(UnitTestConfig.portId);}});add(new SubnetEntity());}});}});\n+        Mockito.when(routerToSubnetService.getSubnet(anyString(), anyString()))\n+                .thenReturn(new SubnetWebJson(){{setSubnet(new SubnetEntity(){{setId(UnitTestConfig.subnetId);setGatewayPortId(UnitTestConfig.diffPortId);}});}});\n+\n+        try {\n+            this.mockMvc.perform(put(removeInterfaceToNeutronRouterUri).contentType(MediaType.APPLICATION_JSON)\n+                    .content(UnitTestConfig.routerInterfaceRequest_subnetAndPort))\n+                    .andDo(print())\n+                    .andExpect(status().is(409));\n+        } catch (Exception e) {\n+            throw e;\n+        }\n+\n+    }\n+\n+    @Test\n+    public void removeInterfaceToNeutronRouter_passInBothSubnetIdAndPortId_AttachedPortsNotMatchPortId_notPass () throws Exception {\n+        Mockito.when(routerDatabaseService.getByRouterId(UnitTestConfig.routerId))\n+                .thenReturn(new Router(){{setId(UnitTestConfig.routerId);setPorts(new ArrayList<>());\n+                    setNeutronRouteTable(new RouteTable(){{setRouteEntities(new ArrayList<>());}});}});\n+        Mockito.when(routerToSubnetService.getSubnetsByPortId(anyString(), anyString()))\n+                .thenReturn(new SubnetsWebJson(){{setSubnets(new ArrayList<SubnetEntity>(){{add(new SubnetEntity(){{setId(UnitTestConfig.subnetId);setGatewayPortId(UnitTestConfig.portId);}});}});}});\n+        Mockito.when(routerToSubnetService.getSubnet(anyString(), anyString()))\n+                .thenReturn(new SubnetWebJson(){{setSubnet(new SubnetEntity(){{setId(UnitTestConfig.subnetId);setGatewayPortId(UnitTestConfig.diffPortId);}});}});\n+\n+        try {\n+            this.mockMvc.perform(put(removeInterfaceToNeutronRouterUri).contentType(MediaType.APPLICATION_JSON)\n+                    .content(UnitTestConfig.routerInterfaceRequest_subnetAndPort))\n+                    .andDo(print())\n+                    .andExpect(status().is(409));\n+        } catch (Exception e) {\n+            throw e;\n+        }\n+\n+    }\n+\n+    @Test\n+    public void removeInterfaceToNeutronRouter_passInBothSubnetIdAndPortId_RouterOrSubnetAndPortNotExistOrNotVisible_notPass () throws Exception {\n+        Mockito.when(routerDatabaseService.getByRouterId(UnitTestConfig.routerId))\n+                .thenReturn(null);\n+        Mockito.when(routerToSubnetService.getSubnetsByPortId(anyString(), anyString()))\n+                .thenReturn(new SubnetsWebJson(){{setSubnets(new ArrayList<SubnetEntity>(){{add(new SubnetEntity(){{setId(UnitTestConfig.subnetId);setGatewayPortId(UnitTestConfig.portId);}});}});}});\n+        Mockito.when(routerToSubnetService.getSubnet(anyString(), anyString()))\n+                .thenReturn(new SubnetWebJson(){{setSubnet(new SubnetEntity(){{setId(UnitTestConfig.subnetId);setGatewayPortId(UnitTestConfig.portId);}});}});\n+\n+        try {\n+            this.mockMvc.perform(put(removeInterfaceToNeutronRouterUri).contentType(MediaType.APPLICATION_JSON)\n+                    .content(UnitTestConfig.routerInterfaceRequest_subnetAndPort))\n+                    .andDo(print())\n+                    .andExpect(status().is(404));\n+        } catch (Exception e) {\n+            throw e;\n+        }\n+\n+    }\n+\n+    @Test\n+    public void addRoutesToNeutronRouter_pass () throws Exception {\n+        Mockito.when(routerDatabaseService.getByRouterId(UnitTestConfig.routerId))\n+                .thenReturn(new Router(){{setId(UnitTestConfig.routerId);setPorts(new ArrayList<>());\n+                    setNeutronRouteTable(new RouteTable(){{setRouteEntities(new ArrayList<>());}});}});\n+        Mockito.when(routerToSubnetService.getSubnetsByPortId(anyString(), anyString()))\n+                .thenReturn(new SubnetsWebJson(){{setSubnets(new ArrayList<SubnetEntity>(){{add(new SubnetEntity(){{setId(UnitTestConfig.subnetId);setGatewayPortId(UnitTestConfig.portId);}});}});}});\n+        Mockito.when(routerToSubnetService.getSubnet(anyString(), anyString()))\n+                .thenReturn(new SubnetWebJson(){{setSubnet(new SubnetEntity(){{setId(UnitTestConfig.subnetId);setGatewayPortId(UnitTestConfig.portId);}});}});\n+\n+        try {\n+            this.mockMvc.perform(put(addRoutesToNeutronRouterUri).contentType(MediaType.APPLICATION_JSON)\n+                    .content(UnitTestConfig.routesToNeutronRouterRequest))\n+                    .andDo(print())\n+                    .andExpect(status().isOk());\n+        } catch (Exception e) {\n+            throw e;\n+        }\n+\n+    }\n+\n+    @Test\n+    public void addRoutesToNeutronRouter_RouterOrSubnetAndPortNotExistOrNotVisible_notPass () throws Exception {\n+        Mockito.when(routerDatabaseService.getByRouterId(UnitTestConfig.routerId))\n+                .thenReturn(null);\n+        Mockito.when(routerToSubnetService.getSubnetsByPortId(anyString(), anyString()))\n+                .thenReturn(new SubnetsWebJson(){{setSubnets(new ArrayList<SubnetEntity>(){{add(new SubnetEntity(){{setId(UnitTestConfig.subnetId);setGatewayPortId(UnitTestConfig.portId);}});}});}});\n+        Mockito.when(routerToSubnetService.getSubnet(anyString(), anyString()))\n+                .thenReturn(new SubnetWebJson(){{setSubnet(new SubnetEntity(){{setId(UnitTestConfig.subnetId);setGatewayPortId(UnitTestConfig.portId);}});}});\n+\n+        try {\n+            this.mockMvc.perform(put(addRoutesToNeutronRouterUri).contentType(MediaType.APPLICATION_JSON)\n+                    .content(UnitTestConfig.routesToNeutronRouterRequest))\n+                    .andDo(print())\n+                    .andExpect(status().is(404));\n+        } catch (Exception e) {\n+            throw e;\n+        }\n+\n+    }\n+\n+    @Test\n+    public void removeRoutesToNeutronRouter_pass () throws Exception {\n+        Mockito.when(routerDatabaseService.getByRouterId(UnitTestConfig.routerId))\n+                .thenReturn(new Router(){{setId(UnitTestConfig.routerId);setPorts(new ArrayList<>());\n+                    setNeutronRouteTable(new RouteTable(){{setRouteEntities(new ArrayList<>());}});}});\n+        Mockito.when(routerToSubnetService.getSubnetsByPortId(anyString(), anyString()))\n+                .thenReturn(new SubnetsWebJson(){{setSubnets(new ArrayList<SubnetEntity>(){{add(new SubnetEntity(){{setId(UnitTestConfig.subnetId);setGatewayPortId(UnitTestConfig.portId);}});}});}});\n+        Mockito.when(routerToSubnetService.getSubnet(anyString(), anyString()))\n+                .thenReturn(new SubnetWebJson(){{setSubnet(new SubnetEntity(){{setId(UnitTestConfig.subnetId);setGatewayPortId(UnitTestConfig.portId);}});}});\n+\n+        try {\n+            this.mockMvc.perform(put(removeRoutesToNeutronRouterUri).contentType(MediaType.APPLICATION_JSON)\n+                    .content(UnitTestConfig.routesToNeutronRouterRequest))\n+                    .andDo(print())\n+                    .andExpect(status().isOk());\n+        } catch (Exception e) {\n+            throw e;\n+        }\n+\n+    }\n+\n+    @Test\n+    public void removeRoutesToNeutronRouter_RouterOrSubnetAndPortNotExistOrNotVisible_notPass () throws Exception {\n+        Mockito.when(routerDatabaseService.getByRouterId(UnitTestConfig.routerId))\n+                .thenReturn(null);\n+        Mockito.when(routerToSubnetService.getSubnetsByPortId(anyString(), anyString()))\n+                .thenReturn(new SubnetsWebJson(){{setSubnets(new ArrayList<SubnetEntity>(){{add(new SubnetEntity(){{setId(UnitTestConfig.subnetId);setGatewayPortId(UnitTestConfig.portId);}});}});}});\n+        Mockito.when(routerToSubnetService.getSubnet(anyString(), anyString()))\n+                .thenReturn(new SubnetWebJson(){{setSubnet(new SubnetEntity(){{setId(UnitTestConfig.subnetId);setGatewayPortId(UnitTestConfig.portId);}});}});\n+\n+        try {\n+            this.mockMvc.perform(put(removeRoutesToNeutronRouterUri).contentType(MediaType.APPLICATION_JSON)\n+                    .content(UnitTestConfig.routesToNeutronRouterRequest))\n+                    .andDo(print())\n+                    .andExpect(status().is(404));\n+        } catch (Exception e) {\n+            throw e;\n+        }\n+\n+    }\n+\n+    @Test\n+    public void getConnectedSubnets_pass () throws Exception {", "originalCommit": "1c59b868d43b27c09a84b63248e316c38fabca3b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "cdd80c501f24f830b5a2cb5adbca26a427b76621", "url": "https://github.com/futurewei-cloud/alcor/commit/cdd80c501f24f830b5a2cb5adbca26a427b76621", "message": "Add vpc/subnet pumls", "committedDate": "2020-05-04T00:01:32Z", "type": "commit"}, {"oid": "af326f99a5440277b980c53e19823ed6ea0a838f", "url": "https://github.com/futurewei-cloud/alcor/commit/af326f99a5440277b980c53e19823ed6ea0a838f", "message": "Merge branch 'master' into docs/design", "committedDate": "2020-05-04T00:26:12Z", "type": "commit"}, {"oid": "62f6e39f50159b544953c567411ca7977a90eab3", "url": "https://github.com/futurewei-cloud/alcor/commit/62f6e39f50159b544953c567411ca7977a90eab3", "message": "update vpc puml and system flow adoc", "committedDate": "2020-05-04T18:44:36Z", "type": "commit"}, {"oid": "ef2d71766150bf3870ee763d3485fa6e519d09f0", "url": "https://github.com/futurewei-cloud/alcor/commit/ef2d71766150bf3870ee763d3485fa6e519d09f0", "message": "Add vm/vpc workflows and puml template", "committedDate": "2020-05-07T06:18:33Z", "type": "commit"}, {"oid": "ad7fd056e2afb4ea7527865b97e02188e27cc4a0", "url": "https://github.com/futurewei-cloud/alcor/commit/ad7fd056e2afb4ea7527865b97e02188e27cc4a0", "message": "Merge from xieus/master", "committedDate": "2020-05-08T23:09:55Z", "type": "commit"}, {"oid": "f58577c232e8b996d62730971ad05db136017ad4", "url": "https://github.com/futurewei-cloud/alcor/commit/f58577c232e8b996d62730971ad05db136017ad4", "message": "Squashed commit of the following:\n\ncommit dec9dd9a7a80aabc9cb801b244d20e840b5ed206\nAuthor: kaidong <shikaidong@126.com>\nDate:   Sat May 9 12:06:38 2020 +0800\n\n    [Alcor Tools] Set up a Swagger UI (#187)", "committedDate": "2020-05-09T04:25:47Z", "type": "commit"}, {"oid": "592bdd0d0d0faf7526d97f5fa22a998ccd2bf49e", "url": "https://github.com/futurewei-cloud/alcor/commit/592bdd0d0d0faf7526d97f5fa22a998ccd2bf49e", "message": "Add a set of new workflows and start services docs", "committedDate": "2020-05-14T15:49:39Z", "type": "commit"}, {"oid": "1804923b6ea2134d89b13e5267069ab804179c74", "url": "https://github.com/futurewei-cloud/alcor/commit/1804923b6ea2134d89b13e5267069ab804179c74", "message": "Clean node manager pom.xml and modify docker file", "committedDate": "2020-05-14T20:46:39Z", "type": "commit"}, {"oid": "c3fd4b583c2f30434e3fedcf05f99eec34c8c3b2", "url": "https://github.com/futurewei-cloud/alcor/commit/c3fd4b583c2f30434e3fedcf05f99eec34c8c3b2", "message": "Clean mac manager pom.xml and modify docker file", "committedDate": "2020-05-14T20:57:50Z", "type": "commit"}, {"oid": "584e38ac59f84b0381519fac4e4b694d4b71e591", "url": "https://github.com/futurewei-cloud/alcor/commit/584e38ac59f84b0381519fac4e4b694d4b71e591", "message": "Clean port manager pom.xml and modify docker file", "committedDate": "2020-05-14T21:08:35Z", "type": "commit"}, {"oid": "c58eaf795036ba2ff35cd4363114f8d6713b3f81", "url": "https://github.com/futurewei-cloud/alcor/commit/c58eaf795036ba2ff35cd4363114f8d6713b3f81", "message": "Clean ip manager pom.xml and modify docker file", "committedDate": "2020-05-14T21:19:10Z", "type": "commit"}, {"oid": "c1775e024d5837afab979288c41c882692bc1f51", "url": "https://github.com/futurewei-cloud/alcor/commit/c1775e024d5837afab979288c41c882692bc1f51", "message": "Clean route manager pom.xml and modify docker file", "committedDate": "2020-05-14T21:54:32Z", "type": "commit"}, {"oid": "ad76d8c84f81cd98d32853d60f8c551c7a34bb2a", "url": "https://github.com/futurewei-cloud/alcor/commit/ad76d8c84f81cd98d32853d60f8c551c7a34bb2a", "message": "Add maven compile plugin to route pom", "committedDate": "2020-05-15T05:30:15Z", "type": "commit"}, {"oid": "fc7961b7897d8dd68410a5296746fd78b701aefc", "url": "https://github.com/futurewei-cloud/alcor/commit/fc7961b7897d8dd68410a5296746fd78b701aefc", "message": "Clean subnet manager pom.xml and modify docker file", "committedDate": "2020-05-15T05:43:09Z", "type": "commit"}, {"oid": "a532098b5683f02c5d010092569b2f6411df840a", "url": "https://github.com/futurewei-cloud/alcor/commit/a532098b5683f02c5d010092569b2f6411df840a", "message": "Clean vpc manager pom.xml and modify docker file", "committedDate": "2020-05-15T05:52:24Z", "type": "commit"}, {"oid": "d7082249e149011e4a66bb61dd63e996074d2d27", "url": "https://github.com/futurewei-cloud/alcor/commit/d7082249e149011e4a66bb61dd63e996074d2d27", "message": "Clean API gateway pom.xml and modify docker file", "committedDate": "2020-05-15T06:07:19Z", "type": "commit"}, {"oid": "1647924aa1ff875b71e905a5547da7e9ace9bd66", "url": "https://github.com/futurewei-cloud/alcor/commit/1647924aa1ff875b71e905a5547da7e9ace9bd66", "message": "Update pom for lib, web and all other services", "committedDate": "2020-05-15T06:27:20Z", "type": "commit"}, {"oid": "19674f040e1c2961633528bfd6cc35e11aa8412c", "url": "https://github.com/futurewei-cloud/alcor/commit/19674f040e1c2961633528bfd6cc35e11aa8412c", "message": "Update main pom file", "committedDate": "2020-05-15T06:33:46Z", "type": "commit"}, {"oid": "f257f57eb0d3e5261cd63cc037e2654a13fcb196", "url": "https://github.com/futurewei-cloud/alcor/commit/f257f57eb0d3e5261cd63cc037e2654a13fcb196", "message": "Update schema pom files and add dependencies to all service pom", "committedDate": "2020-05-15T06:44:09Z", "type": "commit"}, {"oid": "c19ce7d44edec66d973d8a90beebb272e6406c84", "url": "https://github.com/futurewei-cloud/alcor/commit/c19ce7d44edec66d973d8a90beebb272e6406c84", "message": "Merge branch 'master' of https://github.com/futurewei-cloud/alcor", "committedDate": "2020-05-15T21:22:42Z", "type": "commit"}, {"oid": "eb3877f158cfffe66540b4974c06a94134fbac5d", "url": "https://github.com/futurewei-cloud/alcor/commit/eb3877f158cfffe66540b4974c06a94134fbac5d", "message": "Temp disable mac manager UTs for further investigation", "committedDate": "2020-05-16T13:04:55Z", "type": "commit"}, {"oid": "5ae43cdf94d8ecfaadf9f075b93f5bf9b106c163", "url": "https://github.com/futurewei-cloud/alcor/commit/5ae43cdf94d8ecfaadf9f075b93f5bf9b106c163", "message": "Merge branch 'master' of https://github.com/futurewei-cloud/alcor", "committedDate": "2020-05-16T13:20:39Z", "type": "commit"}, {"oid": "7912c8d664226f79ece168959eb51ff98e975f0d", "url": "https://github.com/futurewei-cloud/alcor/commit/7912c8d664226f79ece168959eb51ff98e975f0d", "message": "Merge from master", "committedDate": "2020-05-16T13:28:26Z", "type": "commit"}, {"oid": "a566f2fbdaa179dc120e53cbb60ce6d3f61f6f03", "url": "https://github.com/futurewei-cloud/alcor/commit/a566f2fbdaa179dc120e53cbb60ce6d3f61f6f03", "message": "Outline design doc for dpm,mq,nhm,nmm, update controller and toc docs", "committedDate": "2020-05-18T05:28:15Z", "type": "commit"}, {"oid": "8c0052bcd12e90a2aaefe166cd6d8029b1af7481", "url": "https://github.com/futurewei-cloud/alcor/commit/8c0052bcd12e90a2aaefe166cd6d8029b1af7481", "message": "Add nova integration doc", "committedDate": "2020-05-18T06:25:01Z", "type": "commit"}, {"oid": "e6fdcd1a75f2c184b8299363bfa7c82e20f929d4", "url": "https://github.com/futurewei-cloud/alcor/commit/e6fdcd1a75f2c184b8299363bfa7c82e20f929d4", "message": "Update openstack workflow link", "committedDate": "2020-05-18T06:29:58Z", "type": "commit"}, {"oid": "9158ce312ef1432f339463e5f0860bbe89790c24", "url": "https://github.com/futurewei-cloud/alcor/commit/9158ce312ef1432f339463e5f0860bbe89790c24", "message": "update link", "committedDate": "2020-05-18T06:32:04Z", "type": "commit"}, {"oid": "105a37dda47a6d9328e2825b256731da5fe5f607", "url": "https://github.com/futurewei-cloud/alcor/commit/105a37dda47a6d9328e2825b256731da5fe5f607", "message": "update puml file link", "committedDate": "2020-05-18T06:43:02Z", "type": "commit"}, {"oid": "f3da89dd7b333893240d37e40c421a6fa573d6d1", "url": "https://github.com/futurewei-cloud/alcor/commit/f3da89dd7b333893240d37e40c421a6fa573d6d1", "message": "add a temp vm_create puml under design and update puml file link in nova doc", "committedDate": "2020-05-18T06:44:47Z", "type": "commit"}, {"oid": "7ea3c7ba629dd1d866bbf2be882c27e76d0b1111", "url": "https://github.com/futurewei-cloud/alcor/commit/7ea3c7ba629dd1d866bbf2be882c27e76d0b1111", "message": "update puml file link", "committedDate": "2020-05-18T06:51:42Z", "type": "commit"}, {"oid": "b8afc29cc70d9e88d0e8314e34282fddc2638a23", "url": "https://github.com/futurewei-cloud/alcor/commit/b8afc29cc70d9e88d0e8314e34282fddc2638a23", "message": "update puml file link", "committedDate": "2020-05-18T07:01:18Z", "type": "commit"}, {"oid": "16658012d802dc45fca32d1f7d567ace9bbb8f34", "url": "https://github.com/futurewei-cloud/alcor/commit/16658012d802dc45fca32d1f7d567ace9bbb8f34", "message": "update puml file link", "committedDate": "2020-05-18T07:08:28Z", "type": "commit"}, {"oid": "a8f1ce36053138154832101c687528f06dab9ad1", "url": "https://github.com/futurewei-cloud/alcor/commit/a8f1ce36053138154832101c687528f06dab9ad1", "message": "Clean mac manager pom.xml and modify docker file", "committedDate": "2020-05-18T07:26:58Z", "type": "commit"}, {"oid": "5094345e0d61b676819fba07b949c0957e7ea776", "url": "https://github.com/futurewei-cloud/alcor/commit/5094345e0d61b676819fba07b949c0957e7ea776", "message": "Clean vpc manager pom.xml and modify docker file", "committedDate": "2020-05-18T07:31:28Z", "type": "commit"}, {"oid": "67cdfc92d7a5cb370aa5ae7531d4f769ee4b67df", "url": "https://github.com/futurewei-cloud/alcor/commit/67cdfc92d7a5cb370aa5ae7531d4f769ee4b67df", "message": "Update pom for lib, web and all other services", "committedDate": "2020-05-18T07:36:23Z", "type": "commit"}, {"oid": "8b47084799d9f925511761285d9a443f961fdf83", "url": "https://github.com/futurewei-cloud/alcor/commit/8b47084799d9f925511761285d9a443f961fdf83", "message": "Update schema pom files and add dependencies to all service pom", "committedDate": "2020-05-18T07:37:00Z", "type": "commit"}, {"oid": "3bca77c7269c34316078510ec05c3f5b37d80d17", "url": "https://github.com/futurewei-cloud/alcor/commit/3bca77c7269c34316078510ec05c3f5b37d80d17", "message": "Temp disable mac manager UTs for further investigation", "committedDate": "2020-05-18T07:37:00Z", "type": "commit"}, {"oid": "2709c68cb3c9570309f3cf311ff4455b6b3777a6", "url": "https://github.com/futurewei-cloud/alcor/commit/2709c68cb3c9570309f3cf311ff4455b6b3777a6", "message": "Merge branch 'master' of https://github.com/xieus/alcor", "committedDate": "2020-05-18T07:37:22Z", "type": "commit"}, {"oid": "b2446b1298068226cdd40de25f5a19436e1dc1b2", "url": "https://github.com/futurewei-cloud/alcor/commit/b2446b1298068226cdd40de25f5a19436e1dc1b2", "message": "Merge branch 'upstream_master' into docs/design", "committedDate": "2020-05-18T20:41:46Z", "type": "commit"}, {"oid": "f01530339a016aeb06352f7f2daf00b4713bb01c", "url": "https://github.com/futurewei-cloud/alcor/commit/f01530339a016aeb06352f7f2daf00b4713bb01c", "message": "Reorg design docs into an Antora-supported structure", "committedDate": "2020-05-20T03:48:40Z", "type": "commit"}, {"oid": "77ef00fce2aa59c2d258aa73836af3888092b058", "url": "https://github.com/futurewei-cloud/alcor/commit/77ef00fce2aa59c2d258aa73836af3888092b058", "message": "update antora.yml and rename toc to index", "committedDate": "2020-05-20T04:13:30Z", "type": "commit"}, {"oid": "466a23736d6ed95acf1950a0e70fd9117afe00fa", "url": "https://github.com/futurewei-cloud/alcor/commit/466a23736d6ed95acf1950a0e70fd9117afe00fa", "message": "Add playbook yml", "committedDate": "2020-05-20T05:05:19Z", "type": "commit"}, {"oid": "b895a4dbdd5b425f1987ca8d2193263000dcd687", "url": "https://github.com/futurewei-cloud/alcor/commit/b895a4dbdd5b425f1987ca8d2193263000dcd687", "message": "add nav adoc", "committedDate": "2020-05-22T04:25:43Z", "type": "commit"}, {"oid": "67def70c07d33b72ad8704b3493fad20d74a336c", "url": "https://github.com/futurewei-cloud/alcor/commit/67def70c07d33b72ad8704b3493fad20d74a336c", "message": "update antora.yml", "committedDate": "2020-05-22T04:37:18Z", "type": "commit"}, {"oid": "e7dd1799661ebe96b32e8cd5698b41ae9e618db9", "url": "https://github.com/futurewei-cloud/alcor/commit/e7dd1799661ebe96b32e8cd5698b41ae9e618db9", "message": "update antora.yml format", "committedDate": "2020-05-22T04:38:26Z", "type": "commit"}, {"oid": "7794ff04d34c004c639b7589cfc273cf26b16852", "url": "https://github.com/futurewei-cloud/alcor/commit/7794ff04d34c004c639b7589cfc273cf26b16852", "message": "Merge pull request #2 from xieus/docs/design\n\nDocs/design", "committedDate": "2020-05-22T04:47:49Z", "type": "commit"}, {"oid": "44e57fd6d7778dd47bc711df05cce044ee113bc7", "url": "https://github.com/futurewei-cloud/alcor/commit/44e57fd6d7778dd47bc711df05cce044ee113bc7", "message": "Move adoc files under pages folder", "committedDate": "2020-05-22T05:41:09Z", "type": "commit"}, {"oid": "622ad96e2ecfd695cea2d94aaad05392707a1d04", "url": "https://github.com/futurewei-cloud/alcor/commit/622ad96e2ecfd695cea2d94aaad05392707a1d04", "message": "update antora playbook", "committedDate": "2020-05-22T18:47:06Z", "type": "commit"}, {"oid": "e9de51011a6d2ad63ffae4d2e9822f90be1f4e1e", "url": "https://github.com/futurewei-cloud/alcor/commit/e9de51011a6d2ad63ffae4d2e9822f90be1f4e1e", "message": "update links in README", "committedDate": "2020-05-22T19:00:10Z", "type": "commit"}, {"oid": "17fbbca02794392f339b93684ce8abc315ce084d", "url": "https://github.com/futurewei-cloud/alcor/commit/17fbbca02794392f339b93684ce8abc315ce084d", "message": "move image and workflow up to ROOT", "committedDate": "2020-05-22T19:19:04Z", "type": "commit"}, {"oid": "a55ff88f509492b40e4796d96ae1cbe291ac2924", "url": "https://github.com/futurewei-cloud/alcor/commit/a55ff88f509492b40e4796d96ae1cbe291ac2924", "message": "update links in affected docs", "committedDate": "2020-05-22T19:19:47Z", "type": "commit"}, {"oid": "c15dc8513262a277de2d066776407449acc1668b", "url": "https://github.com/futurewei-cloud/alcor/commit/c15dc8513262a277de2d066776407449acc1668b", "message": "Merge from alcor/master", "committedDate": "2020-05-22T19:24:51Z", "type": "commit"}, {"oid": "5085ddf22df64db3eb7f2b6fbb2b60e37a13abd3", "url": "https://github.com/futurewei-cloud/alcor/commit/5085ddf22df64db3eb7f2b6fbb2b60e37a13abd3", "message": "sync up", "committedDate": "2020-07-02T19:19:09Z", "type": "commit"}, {"oid": "98a447c223acc90eb9e22bec60ce85dfb194da34", "url": "https://github.com/futurewei-cloud/alcor/commit/98a447c223acc90eb9e22bec60ce85dfb194da34", "message": "Merge remote-tracking branch 'remotes/upstream/master' into new_master\n\n# Conflicts:\n#\tREADME.md\n#\tdocs/modules/ROOT/pages/comm_protocol/fast_path.adoc\n#\tdocs/modules/ROOT/pages/comm_protocol/rescue_path.adoc\n#\tdocs/modules/ROOT/pages/controller.adoc\n#\tdocs/modules/ROOT/pages/db_services/data_store.adoc\n#\tdocs/modules/ROOT/pages/deploy_related/deployment.adoc\n#\tdocs/modules/ROOT/pages/deploy_related/integration_nova.adoc\n#\tdocs/modules/ROOT/pages/high_level/system_flow.adoc\n#\tdocs/modules/ROOT/pages/mgmt_services/private_ip_manager.adoc\n#\tdocs/modules/ROOT/pages/mgmt_services/security_group_manager.adoc\n#\tdocs/modules/ROOT/pages/mgmt_services/virtual_mac_manager.adoc\n#\tdocs/modules/ROOT/pages/mgmt_services/vpc_manager.adoc\n#\tdocs/modules/ROOT/pages/sys_monitoring/monitoring.adoc", "committedDate": "2020-07-02T19:56:24Z", "type": "commit"}, {"oid": "f6d42f243e6239ec644eccd9d9e3ddc0f0f2c00a", "url": "https://github.com/futurewei-cloud/alcor/commit/f6d42f243e6239ec644eccd9d9e3ddc0f0f2c00a", "message": "Merge branch 'master' of https://github.com/futurewei-cloud/alcor into new_master", "committedDate": "2020-07-02T22:08:20Z", "type": "commit"}, {"oid": "ee965e7414da815da766c51c93d24aebe9c2757a", "url": "https://github.com/futurewei-cloud/alcor/commit/ee965e7414da815da766c51c93d24aebe9c2757a", "message": "sync up", "committedDate": "2020-07-07T18:09:11Z", "type": "commit"}, {"oid": "3f811965a191ef019d422da05c8f715a439e4fad", "url": "https://github.com/futurewei-cloud/alcor/commit/3f811965a191ef019d422da05c8f715a439e4fad", "message": "Merge branch 'master' of https://github.com/futurewei-cloud/alcor into new_master", "committedDate": "2020-07-07T18:09:47Z", "type": "commit"}, {"oid": "df99b38bb5153d6c53ab9a5fde2a7fb28fb7f789", "url": "https://github.com/futurewei-cloud/alcor/commit/df99b38bb5153d6c53ab9a5fde2a7fb28fb7f789", "message": "Merge branch 'master' of https://github.com/futurewei-cloud/alcor into new_master", "committedDate": "2020-07-08T17:50:29Z", "type": "commit"}, {"oid": "d8b23d4d602105b10c1360b2ad128e549efc0473", "url": "https://github.com/futurewei-cloud/alcor/commit/d8b23d4d602105b10c1360b2ad128e549efc0473", "message": "Merge branch 'master' of https://github.com/futurewei-cloud/alcor into new_master", "committedDate": "2020-07-09T15:51:35Z", "type": "commit"}, {"oid": "af3a28c764aed051d184ab56dbe37d035baad59c", "url": "https://github.com/futurewei-cloud/alcor/commit/af3a28c764aed051d184ab56dbe37d035baad59c", "message": "Merge branch 'master' of https://github.com/futurewei-cloud/alcor into new_master", "committedDate": "2020-07-16T22:56:12Z", "type": "commit"}, {"oid": "2d8cf02f301e200cd07ac3e91b9803eddd139906", "url": "https://github.com/futurewei-cloud/alcor/commit/2d8cf02f301e200cd07ac3e91b9803eddd139906", "message": "Merge branch 'master' of https://github.com/futurewei-cloud/alcor into new_master", "committedDate": "2020-07-17T18:03:02Z", "type": "commit"}, {"oid": "95d4e011f42dfa269b4264ebbb0d0da1ec2ea62a", "url": "https://github.com/futurewei-cloud/alcor/commit/95d4e011f42dfa269b4264ebbb0d0da1ec2ea62a", "message": "Merge branch 'master' of https://github.com/futurewei-cloud/alcor into new_master", "committedDate": "2020-07-20T21:43:50Z", "type": "commit"}, {"oid": "a2c6e9552ff119b5418ee0c8c7db22ab31bc93ff", "url": "https://github.com/futurewei-cloud/alcor/commit/a2c6e9552ff119b5418ee0c8c7db22ab31bc93ff", "message": ":Merge branch 'master' of https://github.com/futurewei-cloud/alcor into new_master", "committedDate": "2020-07-28T01:13:44Z", "type": "commit"}, {"oid": "8731f2388a6aed46dff689d40c998c8810a7595d", "url": "https://github.com/futurewei-cloud/alcor/commit/8731f2388a6aed46dff689d40c998c8810a7595d", "message": "Merge branch 'master' of https://github.com/futurewei-cloud/alcor into new_master", "committedDate": "2020-07-29T18:08:49Z", "type": "commit"}, {"oid": "a54029e3a0c7cf2a79771e8133b82aa5984771b2", "url": "https://github.com/futurewei-cloud/alcor/commit/a54029e3a0c7cf2a79771e8133b82aa5984771b2", "message": "Merge branch 'master' of https://github.com/futurewei-cloud/alcor into new_master", "committedDate": "2020-07-30T05:07:37Z", "type": "commit"}, {"oid": "fc4af489afb7bab2e571e776f12be1b2d2c7f92b", "url": "https://github.com/futurewei-cloud/alcor/commit/fc4af489afb7bab2e571e776f12be1b2d2c7f92b", "message": "Merge branch 'master' of https://github.com/futurewei-cloud/alcor into new_master", "committedDate": "2020-07-31T21:19:16Z", "type": "commit"}, {"oid": "56f75e48b3cf79e76e0fe693ed7a3cc3d05b53b0", "url": "https://github.com/futurewei-cloud/alcor/commit/56f75e48b3cf79e76e0fe693ed7a3cc3d05b53b0", "message": "Merge branch 'master' of https://github.com/futurewei-cloud/alcor into new_master", "committedDate": "2020-08-04T21:12:35Z", "type": "commit"}, {"oid": "b969fa4db254b05f5a1f434684dc8a4d63511e46", "url": "https://github.com/futurewei-cloud/alcor/commit/b969fa4db254b05f5a1f434684dc8a4d63511e46", "message": "Merge branch 'master' of https://github.com/futurewei-cloud/alcor into new_master", "committedDate": "2020-08-05T17:18:41Z", "type": "commit"}, {"oid": "55451d842f65429c1b888a363fccd0f1b5dc6bc6", "url": "https://github.com/futurewei-cloud/alcor/commit/55451d842f65429c1b888a363fccd0f1b5dc6bc6", "message": "Merge branch 'master' of https://github.com/futurewei-cloud/alcor into new_master", "committedDate": "2020-08-11T17:44:06Z", "type": "commit"}, {"oid": "04b612d24dcfc8afdb80654388203772e59de081", "url": "https://github.com/futurewei-cloud/alcor/commit/04b612d24dcfc8afdb80654388203772e59de081", "message": "Merge branch 'master' of https://github.com/futurewei-cloud/alcor into new_master", "committedDate": "2020-08-12T17:44:30Z", "type": "commit"}, {"oid": "4c46856b56799c1f22cbbba538cd511bc0349094", "url": "https://github.com/futurewei-cloud/alcor/commit/4c46856b56799c1f22cbbba538cd511bc0349094", "message": "Merge branch 'master' of https://github.com/futurewei-cloud/alcor into new_master", "committedDate": "2020-08-14T18:11:28Z", "type": "commit"}, {"oid": "dbe2be74eacabbfddefc02bd000e48f21d9f66b2", "url": "https://github.com/futurewei-cloud/alcor/commit/dbe2be74eacabbfddefc02bd000e48f21d9f66b2", "message": "Merge branch 'master' of https://github.com/futurewei-cloud/alcor into new_master", "committedDate": "2020-08-17T23:57:02Z", "type": "commit"}, {"oid": "a3934053afb2e72a83edeb16c6e7ef1f2563d1b2", "url": "https://github.com/futurewei-cloud/alcor/commit/a3934053afb2e72a83edeb16c6e7ef1f2563d1b2", "message": "Merge branch 'master' of https://github.com/futurewei-cloud/alcor into new_master", "committedDate": "2020-08-18T17:55:51Z", "type": "commit"}, {"oid": "c6b43a4c8bec4fd5e7331c4af40a712405dee714", "url": "https://github.com/futurewei-cloud/alcor/commit/c6b43a4c8bec4fd5e7331c4af40a712405dee714", "message": "update", "committedDate": "2020-08-19T00:17:45Z", "type": "commit"}, {"oid": "eabd2005e4a47445db6c3cc275a2e5db8ac57ea8", "url": "https://github.com/futurewei-cloud/alcor/commit/eabd2005e4a47445db6c3cc275a2e5db8ac57ea8", "message": "Merge branch 'master' of https://github.com/futurewei-cloud/alcor into new_master", "committedDate": "2020-08-19T16:40:01Z", "type": "commit"}, {"oid": "c022fac24faa3b9d18572796dc51d121b824af17", "url": "https://github.com/futurewei-cloud/alcor/commit/c022fac24faa3b9d18572796dc51d121b824af17", "message": "update", "committedDate": "2020-08-19T21:15:05Z", "type": "commit"}, {"oid": "ae533091c5f21dc11b196e05f1b3b971c547b388", "url": "https://github.com/futurewei-cloud/alcor/commit/ae533091c5f21dc11b196e05f1b3b971c547b388", "message": "update", "committedDate": "2020-08-21T17:35:12Z", "type": "commit"}, {"oid": "b3eec6580983ad9b25623159c8bd488e679c0fe3", "url": "https://github.com/futurewei-cloud/alcor/commit/b3eec6580983ad9b25623159c8bd488e679c0fe3", "message": "Merge branch 'master' of https://github.com/futurewei-cloud/alcor into new_master", "committedDate": "2020-08-21T17:36:23Z", "type": "commit"}, {"oid": "05b03ba017731647f29f5a141512b99de48234dd", "url": "https://github.com/futurewei-cloud/alcor/commit/05b03ba017731647f29f5a141512b99de48234dd", "message": "Merge branch 'new_master' into feature/refactor_route_manager\n\n# Conflicts:\n#\tservices/vpc_manager/src/main/java/com/futurewei/alcor/vpcmanager/controller/VpcController.java\n#\tservices/vpc_manager/src/main/resources/application.properties\n#\tweb/src/main/java/com/futurewei/alcor/web/entity/vpc/VpcEntity.java", "committedDate": "2020-08-21T19:21:19Z", "type": "commit"}, {"oid": "a237ddcb08ef70df25397efb0541ecab2b040628", "url": "https://github.com/futurewei-cloud/alcor/commit/a237ddcb08ef70df25397efb0541ecab2b040628", "message": "update", "committedDate": "2020-08-21T19:22:06Z", "type": "commit"}, {"oid": "27a4c657f12902fed4a34f701002c277345f858b", "url": "https://github.com/futurewei-cloud/alcor/commit/27a4c657f12902fed4a34f701002c277345f858b", "message": "update", "committedDate": "2020-08-21T23:07:49Z", "type": "commit"}, {"oid": "6950e7a80d08a6942805decbbfa1114643e04a0a", "url": "https://github.com/futurewei-cloud/alcor/commit/6950e7a80d08a6942805decbbfa1114643e04a0a", "message": "update", "committedDate": "2020-08-21T23:15:54Z", "type": "commit"}, {"oid": "25524101ebdcf3bb0907fdf8df2442f8f9a69b3f", "url": "https://github.com/futurewei-cloud/alcor/commit/25524101ebdcf3bb0907fdf8df2442f8f9a69b3f", "message": "update", "committedDate": "2020-08-21T23:30:32Z", "type": "commit"}, {"oid": "86c213f8c0e988798027f837c920fa5260f831c0", "url": "https://github.com/futurewei-cloud/alcor/commit/86c213f8c0e988798027f837c920fa5260f831c0", "message": "update", "committedDate": "2020-08-22T00:26:47Z", "type": "commit"}, {"oid": "3695cd10c2a61b52d19ba2e5c62cac1bd9d957a0", "url": "https://github.com/futurewei-cloud/alcor/commit/3695cd10c2a61b52d19ba2e5c62cac1bd9d957a0", "message": "update", "committedDate": "2020-08-24T17:45:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTkyMDgwMg==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r475920802", "bodyText": "FixedIp is also defined in PortEntity \n  \n    \n      alcor/web/src/main/java/com/futurewei/alcor/web/entity/port/PortEntity.java\n    \n    \n         Line 251\n      in\n      d823316\n    \n    \n    \n    \n\n        \n          \n           public static class FixedIp { \n        \n    \n  \n\n\nCould you check if we could reuse it?", "author": "xieus", "createdAt": "2020-08-24T22:05:24Z", "path": "web/src/main/java/com/futurewei/alcor/web/entity/route/FixedIp.java", "diffHunk": "@@ -0,0 +1,77 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+package com.futurewei.alcor.web.entity.route;\n+\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import com.futurewei.alcor.web.entity.port.PortEntity;\n+\n+public class FixedIp {", "originalCommit": "3695cd10c2a61b52d19ba2e5c62cac1bd9d957a0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Njc1NDY4OQ==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r476754689", "bodyText": "Yes ~ I see the FixedIp is the internal class in PortEntity, could we move the entity to the general directory? Because some other class also need it", "author": "kevin-zhonghao", "createdAt": "2020-08-25T21:31:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTkyMDgwMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTkyMTQ1OQ==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r475921459", "bodyText": "Do we need this import?", "author": "xieus", "createdAt": "2020-08-24T22:07:08Z", "path": "web/src/main/java/com/futurewei/alcor/web/entity/route/RouteEntity.java", "diffHunk": "@@ -17,6 +17,7 @@\n package com.futurewei.alcor.web.entity.route;\n \n import com.futurewei.alcor.common.entity.CustomerResource;\n+import com.futurewei.alcor.common.enumClass.RouteTableType;", "originalCommit": "3695cd10c2a61b52d19ba2e5c62cac1bd9d957a0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Njc1NjA5NQ==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r476756095", "bodyText": "No I will remove it", "author": "kevin-zhonghao", "createdAt": "2020-08-25T21:32:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTkyMTQ1OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTkyMTk1NA==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r475921954", "bodyText": "I found there are two files, both named RouteEntity in this PR. Very unusual. Could you pls double check?", "author": "xieus", "createdAt": "2020-08-24T22:08:28Z", "path": "web/src/main/java/com/futurewei/alcor/web/entity/route/RouteEntry.java", "diffHunk": "@@ -0,0 +1,54 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+\n+package com.futurewei.alcor.web.entity.route;\n+\n+import com.futurewei.alcor.common.entity.CustomerResource;\n+import lombok.Data;\n+import org.jetbrains.annotations.NotNull;\n+\n+@Data\n+public class RouteEntry extends CustomerResource {", "originalCommit": "3695cd10c2a61b52d19ba2e5c62cac1bd9d957a0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Njc1NzMyMA==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r476757320", "bodyText": "One is the RouteEntity, it's used for our previous version of route manager; the other one is RouteEntry, it's used for our new version.", "author": "kevin-zhonghao", "createdAt": "2020-08-25T21:34:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTkyMTk1NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA2MTY2Mw==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r477061663", "bodyText": "Got it. Looked so similar, time to upgrade my glass :-)", "author": "xieus", "createdAt": "2020-08-26T06:25:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTkyMTk1NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjU0MjU0Mg==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r482542542", "bodyText": "@kevin-zhonghao @xieus Should we remove the previous version of APIs from this PR if we don't need it?", "author": "cj-chung", "createdAt": "2020-09-02T22:29:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTkyMTk1NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTkyMjI5Nw==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r475922297", "bodyText": "[Minor]: subnet_id and vpc_id?", "author": "xieus", "createdAt": "2020-08-24T22:09:26Z", "path": "web/src/main/java/com/futurewei/alcor/web/entity/route/RouteTable.java", "diffHunk": "@@ -0,0 +1,46 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+package com.futurewei.alcor.web.entity.route;\n+\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import com.futurewei.alcor.common.entity.CustomerResource;\n+import com.futurewei.alcor.common.enumClass.RouteTableType;\n+import lombok.Data;\n+\n+import java.util.List;\n+\n+@Data\n+public class RouteTable extends CustomerResource {\n+\n+    @JsonProperty(\"routes\")\n+    private List<RouteEntry> routeEntities;\n+\n+    @JsonProperty(\"route_table_type\")\n+    private RouteTableType routeTableType;\n+\n+    // store subnet_id", "originalCommit": "3695cd10c2a61b52d19ba2e5c62cac1bd9d957a0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Njc1Nzg4Ng==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r476757886", "bodyText": "Sure", "author": "kevin-zhonghao", "createdAt": "2020-08-25T21:35:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTkyMjI5Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTkyMzc1Mg==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r475923752", "bodyText": "created_at and updated_at are included in CustomerResource, right?", "author": "xieus", "createdAt": "2020-08-24T22:13:11Z", "path": "web/src/main/java/com/futurewei/alcor/web/entity/route/Router.java", "diffHunk": "@@ -0,0 +1,78 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+package com.futurewei.alcor.web.entity.route;\n+\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import com.futurewei.alcor.common.entity.CustomerResource;\n+import lombok.Data;\n+import org.springframework.data.annotation.CreatedDate;\n+import org.springframework.data.annotation.LastModifiedDate;\n+\n+import java.util.List;\n+\n+@Data\n+public class Router extends CustomerResource {\n+\n+    @JsonProperty(\"routetable\")\n+    private List<RouteTable> routeTables;\n+\n+    // store vpc_id\n+    @JsonProperty(\"owner\")\n+    private String owner;\n+\n+    // store vpc_id\n+    @JsonProperty(\"router_extra_attribute_id\")\n+    private String routerExtraAttributeId;\n+\n+    // store subnet_gateway_port_id\n+    @JsonProperty(\"ports\")\n+    private List<String> ports;\n+\n+    @JsonProperty(\"tenant_id\")\n+    private String tenantId;\n+\n+    @JsonProperty(\"admin_state_up\")\n+    private boolean adminStateUp;\n+\n+    @JsonProperty(\"status\")\n+    private String status;\n+\n+    @CreatedDate", "originalCommit": "3695cd10c2a61b52d19ba2e5c62cac1bd9d957a0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Njc1ODUxNw==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r476758517", "bodyText": "Not included in CustomerResource, so we have to add them", "author": "kevin-zhonghao", "createdAt": "2020-08-25T21:35:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTkyMzc1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA2MTE1Ng==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r477061156", "bodyText": "Got it.", "author": "xieus", "createdAt": "2020-08-26T06:23:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTkyMzc1Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTkyNDQ0NA==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r475924444", "bodyText": "@kevin-zhonghao Forgot to mention this to you earlier. Going forward, let us not use lombok.Data, instead, let us write setter and getter explicitly.", "author": "xieus", "createdAt": "2020-08-24T22:14:59Z", "path": "web/src/main/java/com/futurewei/alcor/web/entity/route/RouterWebRequestJson.java", "diffHunk": "@@ -15,18 +15,16 @@\n */\n package com.futurewei.alcor.web.entity.route;\n \n-public class RouterState {\n-    private String tenantId;\n+import lombok.Data;", "originalCommit": "3695cd10c2a61b52d19ba2e5c62cac1bd9d957a0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Njc2MDEzOA==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r476760138", "bodyText": "NP ~ I will remember that and use setter and getter directorly, but in this PR, most of web class used @DaTa. Should I fix them all?", "author": "kevin-zhonghao", "createdAt": "2020-08-25T21:37:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTkyNDQ0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzg2NDExOQ==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r483864119", "bodyText": "@kevin-zhonghao It is okay. Plan to change it when you get bored :-)", "author": "xieus", "createdAt": "2020-09-04T22:10:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTkyNDQ0NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTkyNTk2NA==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r475925964", "bodyText": "@kevin-zhonghao @cj-chung\nFor VPCEntity, could use extract the common fields of VPCEntity and NetworkEntity (not existed yet) to a common class? VPCEntity and NetworkEntity could inherit this common class. This way, we could clearly see the differences in two different scenarios.\nNot high priority for this PR. We could discuss and plan in next PR.", "author": "xieus", "createdAt": "2020-08-24T22:19:03Z", "path": "web/src/main/java/com/futurewei/alcor/web/entity/vpc/VpcEntity.java", "diffHunk": "@@ -19,6 +20,9 @@\n     @JsonProperty(\"routes\")\n     private List<RouteEntity> routeEntities;\n \n+    @JsonProperty(\"router\")", "originalCommit": "3695cd10c2a61b52d19ba2e5c62cac1bd9d957a0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Njc2MDkwMg==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r476760902", "bodyText": "That's a good idea ~ we could discuss later", "author": "kevin-zhonghao", "createdAt": "2020-08-25T21:38:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTkyNTk2NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjU2MTUzMg==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r482561532", "bodyText": "@kevin-zhonghao @xieus Agree, this is a fundamental change, we should wait until next PR.", "author": "cj-chung", "createdAt": "2020-09-02T22:45:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTkyNTk2NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTkyNjU0NA==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r475926544", "bodyText": "created_at and updated_at.", "author": "xieus", "createdAt": "2020-08-24T22:20:30Z", "path": "web/src/main/java/com/futurewei/alcor/web/entity/route/NeutronRouterWebRequestObject.java", "diffHunk": "@@ -0,0 +1,110 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+package com.futurewei.alcor.web.entity.route;\n+\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import com.futurewei.alcor.common.entity.CustomerResource;\n+import lombok.Data;\n+import org.springframework.data.annotation.CreatedDate;\n+import org.springframework.data.annotation.LastModifiedDate;\n+\n+import java.util.List;\n+\n+@Data\n+public class NeutronRouterWebRequestObject extends CustomerResource {\n+\n+    @JsonProperty(\"routetable\")\n+    private List<RouteTable> routeTables;\n+\n+    // store vpc_id\n+    @JsonProperty(\"owner\")\n+    private String owner;\n+\n+    // store subnet_gateway_port_id\n+    @JsonProperty(\"ports\")\n+    private List<String> ports;\n+\n+    @JsonProperty(\"tenant_id\")\n+    private String tenantId;\n+\n+    @JsonProperty(\"admin_state_up\")\n+    private boolean adminStateUp;\n+\n+    @JsonProperty(\"status\")\n+    private String status;\n+\n+    @JsonProperty(\"external_gateway_info\")\n+    private ExternalGateway external_gateway_info;\n+\n+    @JsonProperty(\"revision_number\")\n+    private Integer revisionNumber;\n+\n+    @JsonProperty(\"distributed\")\n+    private boolean distributed;\n+\n+    @JsonProperty(\"ha\")\n+    private boolean ha;\n+\n+    @JsonProperty(\"availability_zone_hints\")\n+    private List<String> availabilityZoneHints;\n+\n+    @JsonProperty(\"availability_zones\")\n+    private List<String> availabilityZones;\n+\n+    @JsonProperty(\"service_type_id\")\n+    private String serviceTypeId;\n+\n+    @JsonProperty(\"flavor_id\")\n+    private String flavorId;\n+\n+    @JsonProperty(\"tags\")\n+    private List<String> tags;\n+\n+    @JsonProperty(\"conntrack_helpers\")\n+    private List<String> conntrackHelpers;\n+\n+    @CreatedDate", "originalCommit": "3695cd10c2a61b52d19ba2e5c62cac1bd9d957a0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Njc2MTgyOQ==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r476761829", "bodyText": "Tha's right. Removed them", "author": "kevin-zhonghao", "createdAt": "2020-08-25T21:39:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTkyNjU0NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTkzNTIzNg==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r475935236", "bodyText": "what is getRoute_test for? Something like \"_test\" is usually not recommended in the interface.", "author": "xieus", "createdAt": "2020-08-24T22:45:22Z", "path": "services/vpc_manager/src/main/java/com/futurewei/alcor/vpcmanager/service/VpcService.java", "diffHunk": "@@ -2,12 +2,15 @@\n \n import com.futurewei.alcor.vpcmanager.exception.SubnetsNotEmptyException;\n import com.futurewei.alcor.web.entity.route.RouteWebJson;\n+import com.futurewei.alcor.web.entity.route.RouterWebJson;\n import com.futurewei.alcor.web.entity.vpc.VpcEntity;\n \n public interface VpcService {\n \n     public RouteWebJson getRoute (String vpcId, VpcEntity vpcState);\n \n+    public RouterWebJson getRoute_test (String routerId, String routeTableId, VpcEntity vpcState);", "originalCommit": "3695cd10c2a61b52d19ba2e5c62cac1bd9d957a0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Njc2MzYxNA==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r476763614", "bodyText": "Actually this is for the test of new version of route manager, I will remove it", "author": "kevin-zhonghao", "createdAt": "2020-08-25T21:41:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTkzNTIzNg=="}], "type": "inlineReview"}, {"oid": "22c32ce25cf2218ec570c29a2640cbcbd14811db", "url": "https://github.com/futurewei-cloud/alcor/commit/22c32ce25cf2218ec570c29a2640cbcbd14811db", "message": "update", "committedDate": "2020-08-25T21:41:04Z", "type": "commit"}, {"oid": "3159e8e66a96392eee0679fede1402d1ea84abdc", "url": "https://github.com/futurewei-cloud/alcor/commit/3159e8e66a96392eee0679fede1402d1ea84abdc", "message": "update", "committedDate": "2020-08-25T22:15:12Z", "type": "commit"}, {"oid": "b38726012f58999cd97179b84c933525a69e94f3", "url": "https://github.com/futurewei-cloud/alcor/commit/b38726012f58999cd97179b84c933525a69e94f3", "message": "update", "committedDate": "2020-08-25T23:18:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA0ODg0OQ==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r477048849", "bodyText": "Could we switch to Alcor logger instead of slf4j logger?", "author": "xieus", "createdAt": "2020-08-26T05:49:08Z", "path": "services/route_manager/src/main/java/com/futurewei/alcor/route/controller/NeutronRouterController.java", "diffHunk": "@@ -0,0 +1,363 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+package com.futurewei.alcor.route.controller;\n+\n+import com.futurewei.alcor.common.entity.ResponseId;\n+import com.futurewei.alcor.common.exception.ParameterNullOrEmptyException;\n+import com.futurewei.alcor.common.exception.ResourceNotFoundException;\n+import com.futurewei.alcor.common.exception.ResourceNotValidException;\n+import com.futurewei.alcor.common.stats.DurationStatistics;\n+import com.futurewei.alcor.common.utils.ControllerUtil;\n+import com.futurewei.alcor.route.exception.CanNotFindRouter;\n+import com.futurewei.alcor.route.exception.RouterHasAttachedInterfaces;\n+import com.futurewei.alcor.route.service.NeutronRouterService;\n+import com.futurewei.alcor.route.service.RouterDatabaseService;\n+import com.futurewei.alcor.route.service.RouterExtraAttributeDatabaseService;\n+import com.futurewei.alcor.route.utils.RouteManagerUtil;\n+import com.futurewei.alcor.route.utils.RestPreconditionsUtil;\n+import com.futurewei.alcor.web.entity.route.*;\n+import org.slf4j.Logger;", "originalCommit": "b38726012f58999cd97179b84c933525a69e94f3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjIxNzUxNw==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r482217517", "bodyText": "@kevin-zhonghao ping on this comment.", "author": "xieus", "createdAt": "2020-09-02T16:51:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA0ODg0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjU3NTM1Mw==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r482575353", "bodyText": "Done", "author": "kevin-zhonghao", "createdAt": "2020-09-02T22:56:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA0ODg0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzI5MjAwMg==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r483292002", "bodyText": "Sure", "author": "kevin-zhonghao", "createdAt": "2020-09-03T22:44:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA0ODg0OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA0OTA3MQ==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r477049071", "bodyText": "Remove commented lines, as always :-)", "author": "xieus", "createdAt": "2020-08-26T05:49:45Z", "path": "services/route_manager/src/main/java/com/futurewei/alcor/route/controller/NeutronRouterController.java", "diffHunk": "@@ -0,0 +1,363 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+package com.futurewei.alcor.route.controller;\n+\n+import com.futurewei.alcor.common.entity.ResponseId;\n+import com.futurewei.alcor.common.exception.ParameterNullOrEmptyException;\n+import com.futurewei.alcor.common.exception.ResourceNotFoundException;\n+import com.futurewei.alcor.common.exception.ResourceNotValidException;\n+import com.futurewei.alcor.common.stats.DurationStatistics;\n+import com.futurewei.alcor.common.utils.ControllerUtil;\n+import com.futurewei.alcor.route.exception.CanNotFindRouter;\n+import com.futurewei.alcor.route.exception.RouterHasAttachedInterfaces;\n+import com.futurewei.alcor.route.service.NeutronRouterService;\n+import com.futurewei.alcor.route.service.RouterDatabaseService;\n+import com.futurewei.alcor.route.service.RouterExtraAttributeDatabaseService;\n+import com.futurewei.alcor.route.utils.RouteManagerUtil;\n+import com.futurewei.alcor.route.utils.RestPreconditionsUtil;\n+import com.futurewei.alcor.web.entity.route.*;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.BeanUtils;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.context.annotation.ComponentScan;\n+import org.springframework.web.bind.annotation.PathVariable;\n+import org.springframework.web.bind.annotation.RequestBody;\n+import org.springframework.web.bind.annotation.RequestMapping;\n+import org.springframework.web.bind.annotation.RestController;\n+import org.thymeleaf.util.StringUtils;\n+\n+import javax.servlet.http.HttpServletRequest;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.UUID;\n+\n+import static org.springframework.web.bind.annotation.RequestMethod.*;\n+\n+@RestController\n+@ComponentScan(value = \"com.futurewei.alcor.common.stats\")\n+public class NeutronRouterController {\n+\n+    private Logger logger = LoggerFactory.getLogger(this.getClass());\n+\n+    @Autowired\n+    private RouterDatabaseService routerDatabaseService;\n+\n+    @Autowired\n+    private RouterExtraAttributeDatabaseService routerExtraAttributeDatabaseService;\n+\n+    @Autowired\n+    private NeutronRouterService neutronRouterService;\n+\n+    @Autowired\n+    private HttpServletRequest request;\n+\n+    /**\n+     * Show a Neutron router\n+     * @param routerid\n+     * @param projectid\n+     * @return\n+     * @throws Exception\n+     */\n+    @RequestMapping(\n+            method = GET,\n+            value = {\"/project/{projectid}/routers/{routerid}\"})\n+    @DurationStatistics\n+    public NeutronRouterWebJson getNeutronRouterByRouterId(@PathVariable String projectid,@PathVariable String routerid) throws Exception {\n+\n+        NeutronRouterWebRequestObject neutronRouterWebRequestObject = null;\n+\n+//        Router router = null;", "originalCommit": "b38726012f58999cd97179b84c933525a69e94f3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTUwNTI1NQ==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r479505255", "bodyText": "Sure", "author": "kevin-zhonghao", "createdAt": "2020-08-28T19:51:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA0OTA3MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA0OTI4NA==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r477049284", "bodyText": "@kevin-zhonghao maybe it is time to start thinking about a generic validator for all microservices.", "author": "xieus", "createdAt": "2020-08-26T05:50:24Z", "path": "services/route_manager/src/main/java/com/futurewei/alcor/route/controller/NeutronRouterController.java", "diffHunk": "@@ -0,0 +1,363 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+package com.futurewei.alcor.route.controller;\n+\n+import com.futurewei.alcor.common.entity.ResponseId;\n+import com.futurewei.alcor.common.exception.ParameterNullOrEmptyException;\n+import com.futurewei.alcor.common.exception.ResourceNotFoundException;\n+import com.futurewei.alcor.common.exception.ResourceNotValidException;\n+import com.futurewei.alcor.common.stats.DurationStatistics;\n+import com.futurewei.alcor.common.utils.ControllerUtil;\n+import com.futurewei.alcor.route.exception.CanNotFindRouter;\n+import com.futurewei.alcor.route.exception.RouterHasAttachedInterfaces;\n+import com.futurewei.alcor.route.service.NeutronRouterService;\n+import com.futurewei.alcor.route.service.RouterDatabaseService;\n+import com.futurewei.alcor.route.service.RouterExtraAttributeDatabaseService;\n+import com.futurewei.alcor.route.utils.RouteManagerUtil;\n+import com.futurewei.alcor.route.utils.RestPreconditionsUtil;\n+import com.futurewei.alcor.web.entity.route.*;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.BeanUtils;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.context.annotation.ComponentScan;\n+import org.springframework.web.bind.annotation.PathVariable;\n+import org.springframework.web.bind.annotation.RequestBody;\n+import org.springframework.web.bind.annotation.RequestMapping;\n+import org.springframework.web.bind.annotation.RestController;\n+import org.thymeleaf.util.StringUtils;\n+\n+import javax.servlet.http.HttpServletRequest;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.UUID;\n+\n+import static org.springframework.web.bind.annotation.RequestMethod.*;\n+\n+@RestController\n+@ComponentScan(value = \"com.futurewei.alcor.common.stats\")\n+public class NeutronRouterController {\n+\n+    private Logger logger = LoggerFactory.getLogger(this.getClass());\n+\n+    @Autowired\n+    private RouterDatabaseService routerDatabaseService;\n+\n+    @Autowired\n+    private RouterExtraAttributeDatabaseService routerExtraAttributeDatabaseService;\n+\n+    @Autowired\n+    private NeutronRouterService neutronRouterService;\n+\n+    @Autowired\n+    private HttpServletRequest request;\n+\n+    /**\n+     * Show a Neutron router\n+     * @param routerid\n+     * @param projectid\n+     * @return\n+     * @throws Exception\n+     */\n+    @RequestMapping(\n+            method = GET,\n+            value = {\"/project/{projectid}/routers/{routerid}\"})\n+    @DurationStatistics\n+    public NeutronRouterWebJson getNeutronRouterByRouterId(@PathVariable String projectid,@PathVariable String routerid) throws Exception {\n+\n+        NeutronRouterWebRequestObject neutronRouterWebRequestObject = null;\n+\n+//        Router router = null;\n+//        RouterExtraAttribute routerExtraAttribute = null;\n+\n+        try {\n+            RestPreconditionsUtil.verifyParameterNotNullorEmpty(routerid);", "originalCommit": "b38726012f58999cd97179b84c933525a69e94f3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTUxMDUzMQ==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r479510531", "bodyText": "Yes I think so", "author": "kevin-zhonghao", "createdAt": "2020-08-28T20:04:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA0OTI4NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTUxMTEyNg==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r479511126", "bodyText": "we could put all validator of microservices into one Util class", "author": "kevin-zhonghao", "createdAt": "2020-08-28T20:05:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA0OTI4NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjIyMDgyNA==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r482220824", "bodyText": "Correct. @kevin-zhonghao\nThat is one way - putting all the util methods together in a utii class, and those methods are set as static methods.\nAlternative is to use OOD for validator - a base validator class defining the validate() interface, and a few more child classes inheriting from the base and implement the actual validate method.\nEach child class is responsible of one specific class that it wants to validate.", "author": "xieus", "createdAt": "2020-09-02T16:56:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA0OTI4NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzI5MTk0Mw==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r483291943", "bodyText": "Yes ~ could we do this in next PR?", "author": "kevin-zhonghao", "createdAt": "2020-09-03T22:44:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA0OTI4NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzg2NTQ5MQ==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r483865491", "bodyText": "@kevin-zhonghao This is not urgent. Instead, we will need design the validator for the ground up and apply it to the web layers of all microservices (of course, starting with small, e.g., from vpc mgr).\nTracking the item in an issue #374 and assign to you and me :-)", "author": "xieus", "createdAt": "2020-09-04T22:16:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA0OTI4NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA0OTc4MA==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r477049780", "bodyText": "Just would like to make sure this is the Neutron behavior as well - returning an empty json instead of an error code.", "author": "xieus", "createdAt": "2020-08-26T05:51:53Z", "path": "services/route_manager/src/main/java/com/futurewei/alcor/route/controller/NeutronRouterController.java", "diffHunk": "@@ -0,0 +1,363 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+package com.futurewei.alcor.route.controller;\n+\n+import com.futurewei.alcor.common.entity.ResponseId;\n+import com.futurewei.alcor.common.exception.ParameterNullOrEmptyException;\n+import com.futurewei.alcor.common.exception.ResourceNotFoundException;\n+import com.futurewei.alcor.common.exception.ResourceNotValidException;\n+import com.futurewei.alcor.common.stats.DurationStatistics;\n+import com.futurewei.alcor.common.utils.ControllerUtil;\n+import com.futurewei.alcor.route.exception.CanNotFindRouter;\n+import com.futurewei.alcor.route.exception.RouterHasAttachedInterfaces;\n+import com.futurewei.alcor.route.service.NeutronRouterService;\n+import com.futurewei.alcor.route.service.RouterDatabaseService;\n+import com.futurewei.alcor.route.service.RouterExtraAttributeDatabaseService;\n+import com.futurewei.alcor.route.utils.RouteManagerUtil;\n+import com.futurewei.alcor.route.utils.RestPreconditionsUtil;\n+import com.futurewei.alcor.web.entity.route.*;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.BeanUtils;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.context.annotation.ComponentScan;\n+import org.springframework.web.bind.annotation.PathVariable;\n+import org.springframework.web.bind.annotation.RequestBody;\n+import org.springframework.web.bind.annotation.RequestMapping;\n+import org.springframework.web.bind.annotation.RestController;\n+import org.thymeleaf.util.StringUtils;\n+\n+import javax.servlet.http.HttpServletRequest;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.UUID;\n+\n+import static org.springframework.web.bind.annotation.RequestMethod.*;\n+\n+@RestController\n+@ComponentScan(value = \"com.futurewei.alcor.common.stats\")\n+public class NeutronRouterController {\n+\n+    private Logger logger = LoggerFactory.getLogger(this.getClass());\n+\n+    @Autowired\n+    private RouterDatabaseService routerDatabaseService;\n+\n+    @Autowired\n+    private RouterExtraAttributeDatabaseService routerExtraAttributeDatabaseService;\n+\n+    @Autowired\n+    private NeutronRouterService neutronRouterService;\n+\n+    @Autowired\n+    private HttpServletRequest request;\n+\n+    /**\n+     * Show a Neutron router\n+     * @param routerid\n+     * @param projectid\n+     * @return\n+     * @throws Exception\n+     */\n+    @RequestMapping(\n+            method = GET,\n+            value = {\"/project/{projectid}/routers/{routerid}\"})\n+    @DurationStatistics\n+    public NeutronRouterWebJson getNeutronRouterByRouterId(@PathVariable String projectid,@PathVariable String routerid) throws Exception {\n+\n+        NeutronRouterWebRequestObject neutronRouterWebRequestObject = null;\n+\n+//        Router router = null;\n+//        RouterExtraAttribute routerExtraAttribute = null;\n+\n+        try {\n+            RestPreconditionsUtil.verifyParameterNotNullorEmpty(routerid);\n+            RestPreconditionsUtil.verifyParameterNotNullorEmpty(projectid);\n+            RestPreconditionsUtil.verifyResourceFound(projectid);\n+\n+            neutronRouterWebRequestObject = this.neutronRouterService.getNeutronRouter(routerid);\n+\n+//            router = this.routerDatabaseService.getByRouterId(routerId);\n+//            if (router == null) {\n+//                return new NeutronRouterWebJson();\n+//            }\n+//\n+//            routerExtraAttribute = this.routerExtraAttributeDatabaseService.getByRouterExtraAttributeId(router.getRouterExtraAttributeId());\n+//\n+//            BeanUtils.copyProperties(router, neutronRouterWebRequestObject);\n+//            if (routerExtraAttribute != null) {\n+//                BeanUtils.copyProperties(routerExtraAttribute, neutronRouterWebRequestObject);\n+//            }\n+\n+        } catch (ParameterNullOrEmptyException e) {\n+            throw e;\n+        } catch (CanNotFindRouter e) {\n+            logger.error(e.getMessage() + \" : \" + routerid);\n+            return new NeutronRouterWebJson();", "originalCommit": "b38726012f58999cd97179b84c933525a69e94f3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTUxMDczNw==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r479510737", "bodyText": "Yes", "author": "kevin-zhonghao", "createdAt": "2020-08-28T20:04:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA0OTc4MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA1MTg4MA==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r477051880", "bodyText": "router.getRouterExtraAttributeId() could be null or empty if this router is a vpc router. It might be a good idea to add validation before proceeding to query an addition table.", "author": "xieus", "createdAt": "2020-08-26T05:58:11Z", "path": "services/route_manager/src/main/java/com/futurewei/alcor/route/controller/NeutronRouterController.java", "diffHunk": "@@ -0,0 +1,363 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+package com.futurewei.alcor.route.controller;\n+\n+import com.futurewei.alcor.common.entity.ResponseId;\n+import com.futurewei.alcor.common.exception.ParameterNullOrEmptyException;\n+import com.futurewei.alcor.common.exception.ResourceNotFoundException;\n+import com.futurewei.alcor.common.exception.ResourceNotValidException;\n+import com.futurewei.alcor.common.stats.DurationStatistics;\n+import com.futurewei.alcor.common.utils.ControllerUtil;\n+import com.futurewei.alcor.route.exception.CanNotFindRouter;\n+import com.futurewei.alcor.route.exception.RouterHasAttachedInterfaces;\n+import com.futurewei.alcor.route.service.NeutronRouterService;\n+import com.futurewei.alcor.route.service.RouterDatabaseService;\n+import com.futurewei.alcor.route.service.RouterExtraAttributeDatabaseService;\n+import com.futurewei.alcor.route.utils.RouteManagerUtil;\n+import com.futurewei.alcor.route.utils.RestPreconditionsUtil;\n+import com.futurewei.alcor.web.entity.route.*;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.BeanUtils;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.context.annotation.ComponentScan;\n+import org.springframework.web.bind.annotation.PathVariable;\n+import org.springframework.web.bind.annotation.RequestBody;\n+import org.springframework.web.bind.annotation.RequestMapping;\n+import org.springframework.web.bind.annotation.RestController;\n+import org.thymeleaf.util.StringUtils;\n+\n+import javax.servlet.http.HttpServletRequest;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.UUID;\n+\n+import static org.springframework.web.bind.annotation.RequestMethod.*;\n+\n+@RestController\n+@ComponentScan(value = \"com.futurewei.alcor.common.stats\")\n+public class NeutronRouterController {\n+\n+    private Logger logger = LoggerFactory.getLogger(this.getClass());\n+\n+    @Autowired\n+    private RouterDatabaseService routerDatabaseService;\n+\n+    @Autowired\n+    private RouterExtraAttributeDatabaseService routerExtraAttributeDatabaseService;\n+\n+    @Autowired\n+    private NeutronRouterService neutronRouterService;\n+\n+    @Autowired\n+    private HttpServletRequest request;\n+\n+    /**\n+     * Show a Neutron router\n+     * @param routerid\n+     * @param projectid\n+     * @return\n+     * @throws Exception\n+     */\n+    @RequestMapping(\n+            method = GET,\n+            value = {\"/project/{projectid}/routers/{routerid}\"})\n+    @DurationStatistics\n+    public NeutronRouterWebJson getNeutronRouterByRouterId(@PathVariable String projectid,@PathVariable String routerid) throws Exception {\n+\n+        NeutronRouterWebRequestObject neutronRouterWebRequestObject = null;\n+\n+//        Router router = null;\n+//        RouterExtraAttribute routerExtraAttribute = null;\n+\n+        try {\n+            RestPreconditionsUtil.verifyParameterNotNullorEmpty(routerid);\n+            RestPreconditionsUtil.verifyParameterNotNullorEmpty(projectid);\n+            RestPreconditionsUtil.verifyResourceFound(projectid);\n+\n+            neutronRouterWebRequestObject = this.neutronRouterService.getNeutronRouter(routerid);\n+\n+//            router = this.routerDatabaseService.getByRouterId(routerId);\n+//            if (router == null) {\n+//                return new NeutronRouterWebJson();\n+//            }\n+//\n+//            routerExtraAttribute = this.routerExtraAttributeDatabaseService.getByRouterExtraAttributeId(router.getRouterExtraAttributeId());\n+//\n+//            BeanUtils.copyProperties(router, neutronRouterWebRequestObject);\n+//            if (routerExtraAttribute != null) {\n+//                BeanUtils.copyProperties(routerExtraAttribute, neutronRouterWebRequestObject);\n+//            }\n+\n+        } catch (ParameterNullOrEmptyException e) {\n+            throw e;\n+        } catch (CanNotFindRouter e) {\n+            logger.error(e.getMessage() + \" : \" + routerid);\n+            return new NeutronRouterWebJson();\n+        }\n+\n+        return new NeutronRouterWebJson(neutronRouterWebRequestObject);\n+    }\n+\n+    /**\n+     * List Neutron routers\n+     * @param projectid\n+     * @return\n+     * @throws Exception\n+     */\n+    @RequestMapping(\n+            method = GET,\n+            value = {\"/project/{projectid}/routers\"})\n+    @DurationStatistics\n+    public NeutronRoutersWebJson getNeutronRouters(@PathVariable String projectid) throws Exception {\n+\n+        List<NeutronRouterWebRequestObject> neutronRouters = new ArrayList<>();\n+\n+        Map<String, Router> routers = null;\n+        RouterExtraAttribute routerExtraAttribute = null;\n+\n+        Map<String, Object[]> queryParams =\n+                ControllerUtil.transformUrlPathParams(request.getParameterMap(), Router.class);\n+\n+        ControllerUtil.handleUserRoles(request.getHeader(ControllerUtil.TOKEN_INFO_HEADER), queryParams);\n+        try {\n+            RestPreconditionsUtil.verifyParameterNotNullorEmpty(projectid);\n+            RestPreconditionsUtil.verifyResourceFound(projectid);\n+\n+            routers = this.routerDatabaseService.getAllRouters(queryParams);\n+            if (routers == null) {\n+                return new NeutronRoutersWebJson();\n+            }\n+\n+            for (Map.Entry<String, Router> entry : routers.entrySet()) {\n+                NeutronRouterWebRequestObject neutronRouterWebRequestObject = new NeutronRouterWebRequestObject();\n+                Router router = (Router) entry.getValue();\n+                routerExtraAttribute = this.routerExtraAttributeDatabaseService.getByRouterExtraAttributeId(router.getRouterExtraAttributeId());", "originalCommit": "b38726012f58999cd97179b84c933525a69e94f3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTUzNTY4OQ==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r479535689", "bodyText": "Add it", "author": "kevin-zhonghao", "createdAt": "2020-08-28T21:09:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA1MTg4MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA1NDUxNA==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r477054514", "bodyText": "Could we consolidate the validation into one?", "author": "xieus", "createdAt": "2020-08-26T06:05:50Z", "path": "services/route_manager/src/main/java/com/futurewei/alcor/route/controller/NeutronRouterController.java", "diffHunk": "@@ -0,0 +1,363 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+package com.futurewei.alcor.route.controller;\n+\n+import com.futurewei.alcor.common.entity.ResponseId;\n+import com.futurewei.alcor.common.exception.ParameterNullOrEmptyException;\n+import com.futurewei.alcor.common.exception.ResourceNotFoundException;\n+import com.futurewei.alcor.common.exception.ResourceNotValidException;\n+import com.futurewei.alcor.common.stats.DurationStatistics;\n+import com.futurewei.alcor.common.utils.ControllerUtil;\n+import com.futurewei.alcor.route.exception.CanNotFindRouter;\n+import com.futurewei.alcor.route.exception.RouterHasAttachedInterfaces;\n+import com.futurewei.alcor.route.service.NeutronRouterService;\n+import com.futurewei.alcor.route.service.RouterDatabaseService;\n+import com.futurewei.alcor.route.service.RouterExtraAttributeDatabaseService;\n+import com.futurewei.alcor.route.utils.RouteManagerUtil;\n+import com.futurewei.alcor.route.utils.RestPreconditionsUtil;\n+import com.futurewei.alcor.web.entity.route.*;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.BeanUtils;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.context.annotation.ComponentScan;\n+import org.springframework.web.bind.annotation.PathVariable;\n+import org.springframework.web.bind.annotation.RequestBody;\n+import org.springframework.web.bind.annotation.RequestMapping;\n+import org.springframework.web.bind.annotation.RestController;\n+import org.thymeleaf.util.StringUtils;\n+\n+import javax.servlet.http.HttpServletRequest;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.UUID;\n+\n+import static org.springframework.web.bind.annotation.RequestMethod.*;\n+\n+@RestController\n+@ComponentScan(value = \"com.futurewei.alcor.common.stats\")\n+public class NeutronRouterController {\n+\n+    private Logger logger = LoggerFactory.getLogger(this.getClass());\n+\n+    @Autowired\n+    private RouterDatabaseService routerDatabaseService;\n+\n+    @Autowired\n+    private RouterExtraAttributeDatabaseService routerExtraAttributeDatabaseService;\n+\n+    @Autowired\n+    private NeutronRouterService neutronRouterService;\n+\n+    @Autowired\n+    private HttpServletRequest request;\n+\n+    /**\n+     * Show a Neutron router\n+     * @param routerid\n+     * @param projectid\n+     * @return\n+     * @throws Exception\n+     */\n+    @RequestMapping(\n+            method = GET,\n+            value = {\"/project/{projectid}/routers/{routerid}\"})\n+    @DurationStatistics\n+    public NeutronRouterWebJson getNeutronRouterByRouterId(@PathVariable String projectid,@PathVariable String routerid) throws Exception {\n+\n+        NeutronRouterWebRequestObject neutronRouterWebRequestObject = null;\n+\n+//        Router router = null;\n+//        RouterExtraAttribute routerExtraAttribute = null;\n+\n+        try {\n+            RestPreconditionsUtil.verifyParameterNotNullorEmpty(routerid);\n+            RestPreconditionsUtil.verifyParameterNotNullorEmpty(projectid);\n+            RestPreconditionsUtil.verifyResourceFound(projectid);\n+\n+            neutronRouterWebRequestObject = this.neutronRouterService.getNeutronRouter(routerid);\n+\n+//            router = this.routerDatabaseService.getByRouterId(routerId);\n+//            if (router == null) {\n+//                return new NeutronRouterWebJson();\n+//            }\n+//\n+//            routerExtraAttribute = this.routerExtraAttributeDatabaseService.getByRouterExtraAttributeId(router.getRouterExtraAttributeId());\n+//\n+//            BeanUtils.copyProperties(router, neutronRouterWebRequestObject);\n+//            if (routerExtraAttribute != null) {\n+//                BeanUtils.copyProperties(routerExtraAttribute, neutronRouterWebRequestObject);\n+//            }\n+\n+        } catch (ParameterNullOrEmptyException e) {\n+            throw e;\n+        } catch (CanNotFindRouter e) {\n+            logger.error(e.getMessage() + \" : \" + routerid);\n+            return new NeutronRouterWebJson();\n+        }\n+\n+        return new NeutronRouterWebJson(neutronRouterWebRequestObject);\n+    }\n+\n+    /**\n+     * List Neutron routers\n+     * @param projectid\n+     * @return\n+     * @throws Exception\n+     */\n+    @RequestMapping(\n+            method = GET,\n+            value = {\"/project/{projectid}/routers\"})\n+    @DurationStatistics\n+    public NeutronRoutersWebJson getNeutronRouters(@PathVariable String projectid) throws Exception {\n+\n+        List<NeutronRouterWebRequestObject> neutronRouters = new ArrayList<>();\n+\n+        Map<String, Router> routers = null;\n+        RouterExtraAttribute routerExtraAttribute = null;\n+\n+        Map<String, Object[]> queryParams =\n+                ControllerUtil.transformUrlPathParams(request.getParameterMap(), Router.class);\n+\n+        ControllerUtil.handleUserRoles(request.getHeader(ControllerUtil.TOKEN_INFO_HEADER), queryParams);\n+        try {\n+            RestPreconditionsUtil.verifyParameterNotNullorEmpty(projectid);\n+            RestPreconditionsUtil.verifyResourceFound(projectid);\n+\n+            routers = this.routerDatabaseService.getAllRouters(queryParams);\n+            if (routers == null) {\n+                return new NeutronRoutersWebJson();\n+            }\n+\n+            for (Map.Entry<String, Router> entry : routers.entrySet()) {\n+                NeutronRouterWebRequestObject neutronRouterWebRequestObject = new NeutronRouterWebRequestObject();\n+                Router router = (Router) entry.getValue();\n+                routerExtraAttribute = this.routerExtraAttributeDatabaseService.getByRouterExtraAttributeId(router.getRouterExtraAttributeId());\n+\n+                BeanUtils.copyProperties(router, neutronRouterWebRequestObject);\n+                if (routerExtraAttribute != null) {\n+                    BeanUtils.copyProperties(routerExtraAttribute, neutronRouterWebRequestObject);\n+                }\n+\n+                neutronRouters.add(neutronRouterWebRequestObject);\n+            }\n+\n+        } catch (ParameterNullOrEmptyException e) {\n+            throw new Exception(e);\n+        } catch (ResourceNotFoundException e) {\n+            throw new Exception(e);\n+        }\n+\n+        return new NeutronRoutersWebJson(neutronRouters);\n+    }\n+\n+    /**\n+     * Create a Neutron router\n+     * @param projectid\n+     * @param resource\n+     * @return\n+     * @throws Exception\n+     */\n+    @RequestMapping(\n+            method = POST,\n+            value = {\"/project/{projectid}/routers\"})\n+    @DurationStatistics\n+    public NeutronRouterWebJson createNeutronRouters(@PathVariable String projectid, @RequestBody NeutronRouterWebJson resource) throws Exception {\n+\n+        NeutronRouterWebRequestObject neutronRouterWebRequestObject = null;\n+\n+        try {\n+            RestPreconditionsUtil.verifyParameterNotNullorEmpty(projectid);\n+\n+            // check resource\n+            if (!RouteManagerUtil.checkNeutronRouterWebResourceIsValid(resource)) {\n+                throw new ResourceNotValidException(\"request resource is invalid\");\n+            }\n+\n+            neutronRouterWebRequestObject = resource.getRouter();\n+            String id = neutronRouterWebRequestObject.getId();\n+\n+            if (id == null || StringUtils.isEmpty(id)) {", "originalCommit": "b38726012f58999cd97179b84c933525a69e94f3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzI5MTg1Mw==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r483291853", "bodyText": "we may do this in next PR", "author": "kevin-zhonghao", "createdAt": "2020-09-03T22:44:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA1NDUxNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA1NTM4Mw==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r477055383", "bodyText": "Like the controller, pretty concise!", "author": "xieus", "createdAt": "2020-08-26T06:08:18Z", "path": "services/route_manager/src/main/java/com/futurewei/alcor/route/controller/NeutronRouterController.java", "diffHunk": "@@ -0,0 +1,363 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+package com.futurewei.alcor.route.controller;\n+\n+import com.futurewei.alcor.common.entity.ResponseId;\n+import com.futurewei.alcor.common.exception.ParameterNullOrEmptyException;\n+import com.futurewei.alcor.common.exception.ResourceNotFoundException;\n+import com.futurewei.alcor.common.exception.ResourceNotValidException;\n+import com.futurewei.alcor.common.stats.DurationStatistics;\n+import com.futurewei.alcor.common.utils.ControllerUtil;\n+import com.futurewei.alcor.route.exception.CanNotFindRouter;\n+import com.futurewei.alcor.route.exception.RouterHasAttachedInterfaces;\n+import com.futurewei.alcor.route.service.NeutronRouterService;\n+import com.futurewei.alcor.route.service.RouterDatabaseService;\n+import com.futurewei.alcor.route.service.RouterExtraAttributeDatabaseService;\n+import com.futurewei.alcor.route.utils.RouteManagerUtil;\n+import com.futurewei.alcor.route.utils.RestPreconditionsUtil;\n+import com.futurewei.alcor.web.entity.route.*;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.BeanUtils;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.context.annotation.ComponentScan;\n+import org.springframework.web.bind.annotation.PathVariable;\n+import org.springframework.web.bind.annotation.RequestBody;\n+import org.springframework.web.bind.annotation.RequestMapping;\n+import org.springframework.web.bind.annotation.RestController;\n+import org.thymeleaf.util.StringUtils;\n+\n+import javax.servlet.http.HttpServletRequest;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.UUID;\n+\n+import static org.springframework.web.bind.annotation.RequestMethod.*;\n+\n+@RestController\n+@ComponentScan(value = \"com.futurewei.alcor.common.stats\")\n+public class NeutronRouterController {\n+\n+    private Logger logger = LoggerFactory.getLogger(this.getClass());\n+\n+    @Autowired\n+    private RouterDatabaseService routerDatabaseService;\n+\n+    @Autowired\n+    private RouterExtraAttributeDatabaseService routerExtraAttributeDatabaseService;\n+\n+    @Autowired\n+    private NeutronRouterService neutronRouterService;\n+\n+    @Autowired\n+    private HttpServletRequest request;\n+\n+    /**\n+     * Show a Neutron router\n+     * @param routerid\n+     * @param projectid\n+     * @return\n+     * @throws Exception\n+     */\n+    @RequestMapping(\n+            method = GET,\n+            value = {\"/project/{projectid}/routers/{routerid}\"})\n+    @DurationStatistics\n+    public NeutronRouterWebJson getNeutronRouterByRouterId(@PathVariable String projectid,@PathVariable String routerid) throws Exception {\n+\n+        NeutronRouterWebRequestObject neutronRouterWebRequestObject = null;\n+\n+//        Router router = null;\n+//        RouterExtraAttribute routerExtraAttribute = null;\n+\n+        try {\n+            RestPreconditionsUtil.verifyParameterNotNullorEmpty(routerid);\n+            RestPreconditionsUtil.verifyParameterNotNullorEmpty(projectid);\n+            RestPreconditionsUtil.verifyResourceFound(projectid);\n+\n+            neutronRouterWebRequestObject = this.neutronRouterService.getNeutronRouter(routerid);\n+\n+//            router = this.routerDatabaseService.getByRouterId(routerId);\n+//            if (router == null) {\n+//                return new NeutronRouterWebJson();\n+//            }\n+//\n+//            routerExtraAttribute = this.routerExtraAttributeDatabaseService.getByRouterExtraAttributeId(router.getRouterExtraAttributeId());\n+//\n+//            BeanUtils.copyProperties(router, neutronRouterWebRequestObject);\n+//            if (routerExtraAttribute != null) {\n+//                BeanUtils.copyProperties(routerExtraAttribute, neutronRouterWebRequestObject);\n+//            }\n+\n+        } catch (ParameterNullOrEmptyException e) {\n+            throw e;\n+        } catch (CanNotFindRouter e) {\n+            logger.error(e.getMessage() + \" : \" + routerid);\n+            return new NeutronRouterWebJson();\n+        }\n+\n+        return new NeutronRouterWebJson(neutronRouterWebRequestObject);\n+    }\n+\n+    /**\n+     * List Neutron routers\n+     * @param projectid\n+     * @return\n+     * @throws Exception\n+     */\n+    @RequestMapping(\n+            method = GET,\n+            value = {\"/project/{projectid}/routers\"})\n+    @DurationStatistics\n+    public NeutronRoutersWebJson getNeutronRouters(@PathVariable String projectid) throws Exception {\n+\n+        List<NeutronRouterWebRequestObject> neutronRouters = new ArrayList<>();\n+\n+        Map<String, Router> routers = null;\n+        RouterExtraAttribute routerExtraAttribute = null;\n+\n+        Map<String, Object[]> queryParams =\n+                ControllerUtil.transformUrlPathParams(request.getParameterMap(), Router.class);\n+\n+        ControllerUtil.handleUserRoles(request.getHeader(ControllerUtil.TOKEN_INFO_HEADER), queryParams);\n+        try {\n+            RestPreconditionsUtil.verifyParameterNotNullorEmpty(projectid);\n+            RestPreconditionsUtil.verifyResourceFound(projectid);\n+\n+            routers = this.routerDatabaseService.getAllRouters(queryParams);\n+            if (routers == null) {\n+                return new NeutronRoutersWebJson();\n+            }\n+\n+            for (Map.Entry<String, Router> entry : routers.entrySet()) {\n+                NeutronRouterWebRequestObject neutronRouterWebRequestObject = new NeutronRouterWebRequestObject();\n+                Router router = (Router) entry.getValue();\n+                routerExtraAttribute = this.routerExtraAttributeDatabaseService.getByRouterExtraAttributeId(router.getRouterExtraAttributeId());\n+\n+                BeanUtils.copyProperties(router, neutronRouterWebRequestObject);\n+                if (routerExtraAttribute != null) {\n+                    BeanUtils.copyProperties(routerExtraAttribute, neutronRouterWebRequestObject);\n+                }\n+\n+                neutronRouters.add(neutronRouterWebRequestObject);\n+            }\n+\n+        } catch (ParameterNullOrEmptyException e) {\n+            throw new Exception(e);\n+        } catch (ResourceNotFoundException e) {\n+            throw new Exception(e);\n+        }\n+\n+        return new NeutronRoutersWebJson(neutronRouters);\n+    }\n+\n+    /**\n+     * Create a Neutron router\n+     * @param projectid\n+     * @param resource\n+     * @return\n+     * @throws Exception\n+     */\n+    @RequestMapping(\n+            method = POST,\n+            value = {\"/project/{projectid}/routers\"})\n+    @DurationStatistics\n+    public NeutronRouterWebJson createNeutronRouters(@PathVariable String projectid, @RequestBody NeutronRouterWebJson resource) throws Exception {\n+\n+        NeutronRouterWebRequestObject neutronRouterWebRequestObject = null;\n+\n+        try {\n+            RestPreconditionsUtil.verifyParameterNotNullorEmpty(projectid);\n+\n+            // check resource\n+            if (!RouteManagerUtil.checkNeutronRouterWebResourceIsValid(resource)) {\n+                throw new ResourceNotValidException(\"request resource is invalid\");\n+            }\n+\n+            neutronRouterWebRequestObject = resource.getRouter();\n+            String id = neutronRouterWebRequestObject.getId();\n+\n+            if (id == null || StringUtils.isEmpty(id)) {\n+                UUID vpcId = UUID.randomUUID();\n+                neutronRouterWebRequestObject.setId(vpcId.toString());\n+            }\n+            RestPreconditionsUtil.verifyResourceNotNull(neutronRouterWebRequestObject);\n+\n+            // configure default value\n+            neutronRouterWebRequestObject = RouteManagerUtil.configureNeutronRouterParameters(neutronRouterWebRequestObject);\n+\n+            // save router and router_extra_attribute\n+            this.neutronRouterService.saveRouterAndRouterExtraAttribute(neutronRouterWebRequestObject);", "originalCommit": "b38726012f58999cd97179b84c933525a69e94f3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA1NjMwNQ==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r477056305", "bodyText": "what if the resource.getid() != routerid?", "author": "xieus", "createdAt": "2020-08-26T06:10:52Z", "path": "services/route_manager/src/main/java/com/futurewei/alcor/route/controller/NeutronRouterController.java", "diffHunk": "@@ -0,0 +1,363 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+package com.futurewei.alcor.route.controller;\n+\n+import com.futurewei.alcor.common.entity.ResponseId;\n+import com.futurewei.alcor.common.exception.ParameterNullOrEmptyException;\n+import com.futurewei.alcor.common.exception.ResourceNotFoundException;\n+import com.futurewei.alcor.common.exception.ResourceNotValidException;\n+import com.futurewei.alcor.common.stats.DurationStatistics;\n+import com.futurewei.alcor.common.utils.ControllerUtil;\n+import com.futurewei.alcor.route.exception.CanNotFindRouter;\n+import com.futurewei.alcor.route.exception.RouterHasAttachedInterfaces;\n+import com.futurewei.alcor.route.service.NeutronRouterService;\n+import com.futurewei.alcor.route.service.RouterDatabaseService;\n+import com.futurewei.alcor.route.service.RouterExtraAttributeDatabaseService;\n+import com.futurewei.alcor.route.utils.RouteManagerUtil;\n+import com.futurewei.alcor.route.utils.RestPreconditionsUtil;\n+import com.futurewei.alcor.web.entity.route.*;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.BeanUtils;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.context.annotation.ComponentScan;\n+import org.springframework.web.bind.annotation.PathVariable;\n+import org.springframework.web.bind.annotation.RequestBody;\n+import org.springframework.web.bind.annotation.RequestMapping;\n+import org.springframework.web.bind.annotation.RestController;\n+import org.thymeleaf.util.StringUtils;\n+\n+import javax.servlet.http.HttpServletRequest;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.UUID;\n+\n+import static org.springframework.web.bind.annotation.RequestMethod.*;\n+\n+@RestController\n+@ComponentScan(value = \"com.futurewei.alcor.common.stats\")\n+public class NeutronRouterController {\n+\n+    private Logger logger = LoggerFactory.getLogger(this.getClass());\n+\n+    @Autowired\n+    private RouterDatabaseService routerDatabaseService;\n+\n+    @Autowired\n+    private RouterExtraAttributeDatabaseService routerExtraAttributeDatabaseService;\n+\n+    @Autowired\n+    private NeutronRouterService neutronRouterService;\n+\n+    @Autowired\n+    private HttpServletRequest request;\n+\n+    /**\n+     * Show a Neutron router\n+     * @param routerid\n+     * @param projectid\n+     * @return\n+     * @throws Exception\n+     */\n+    @RequestMapping(\n+            method = GET,\n+            value = {\"/project/{projectid}/routers/{routerid}\"})\n+    @DurationStatistics\n+    public NeutronRouterWebJson getNeutronRouterByRouterId(@PathVariable String projectid,@PathVariable String routerid) throws Exception {\n+\n+        NeutronRouterWebRequestObject neutronRouterWebRequestObject = null;\n+\n+//        Router router = null;\n+//        RouterExtraAttribute routerExtraAttribute = null;\n+\n+        try {\n+            RestPreconditionsUtil.verifyParameterNotNullorEmpty(routerid);\n+            RestPreconditionsUtil.verifyParameterNotNullorEmpty(projectid);\n+            RestPreconditionsUtil.verifyResourceFound(projectid);\n+\n+            neutronRouterWebRequestObject = this.neutronRouterService.getNeutronRouter(routerid);\n+\n+//            router = this.routerDatabaseService.getByRouterId(routerId);\n+//            if (router == null) {\n+//                return new NeutronRouterWebJson();\n+//            }\n+//\n+//            routerExtraAttribute = this.routerExtraAttributeDatabaseService.getByRouterExtraAttributeId(router.getRouterExtraAttributeId());\n+//\n+//            BeanUtils.copyProperties(router, neutronRouterWebRequestObject);\n+//            if (routerExtraAttribute != null) {\n+//                BeanUtils.copyProperties(routerExtraAttribute, neutronRouterWebRequestObject);\n+//            }\n+\n+        } catch (ParameterNullOrEmptyException e) {\n+            throw e;\n+        } catch (CanNotFindRouter e) {\n+            logger.error(e.getMessage() + \" : \" + routerid);\n+            return new NeutronRouterWebJson();\n+        }\n+\n+        return new NeutronRouterWebJson(neutronRouterWebRequestObject);\n+    }\n+\n+    /**\n+     * List Neutron routers\n+     * @param projectid\n+     * @return\n+     * @throws Exception\n+     */\n+    @RequestMapping(\n+            method = GET,\n+            value = {\"/project/{projectid}/routers\"})\n+    @DurationStatistics\n+    public NeutronRoutersWebJson getNeutronRouters(@PathVariable String projectid) throws Exception {\n+\n+        List<NeutronRouterWebRequestObject> neutronRouters = new ArrayList<>();\n+\n+        Map<String, Router> routers = null;\n+        RouterExtraAttribute routerExtraAttribute = null;\n+\n+        Map<String, Object[]> queryParams =\n+                ControllerUtil.transformUrlPathParams(request.getParameterMap(), Router.class);\n+\n+        ControllerUtil.handleUserRoles(request.getHeader(ControllerUtil.TOKEN_INFO_HEADER), queryParams);\n+        try {\n+            RestPreconditionsUtil.verifyParameterNotNullorEmpty(projectid);\n+            RestPreconditionsUtil.verifyResourceFound(projectid);\n+\n+            routers = this.routerDatabaseService.getAllRouters(queryParams);\n+            if (routers == null) {\n+                return new NeutronRoutersWebJson();\n+            }\n+\n+            for (Map.Entry<String, Router> entry : routers.entrySet()) {\n+                NeutronRouterWebRequestObject neutronRouterWebRequestObject = new NeutronRouterWebRequestObject();\n+                Router router = (Router) entry.getValue();\n+                routerExtraAttribute = this.routerExtraAttributeDatabaseService.getByRouterExtraAttributeId(router.getRouterExtraAttributeId());\n+\n+                BeanUtils.copyProperties(router, neutronRouterWebRequestObject);\n+                if (routerExtraAttribute != null) {\n+                    BeanUtils.copyProperties(routerExtraAttribute, neutronRouterWebRequestObject);\n+                }\n+\n+                neutronRouters.add(neutronRouterWebRequestObject);\n+            }\n+\n+        } catch (ParameterNullOrEmptyException e) {\n+            throw new Exception(e);\n+        } catch (ResourceNotFoundException e) {\n+            throw new Exception(e);\n+        }\n+\n+        return new NeutronRoutersWebJson(neutronRouters);\n+    }\n+\n+    /**\n+     * Create a Neutron router\n+     * @param projectid\n+     * @param resource\n+     * @return\n+     * @throws Exception\n+     */\n+    @RequestMapping(\n+            method = POST,\n+            value = {\"/project/{projectid}/routers\"})\n+    @DurationStatistics\n+    public NeutronRouterWebJson createNeutronRouters(@PathVariable String projectid, @RequestBody NeutronRouterWebJson resource) throws Exception {\n+\n+        NeutronRouterWebRequestObject neutronRouterWebRequestObject = null;\n+\n+        try {\n+            RestPreconditionsUtil.verifyParameterNotNullorEmpty(projectid);\n+\n+            // check resource\n+            if (!RouteManagerUtil.checkNeutronRouterWebResourceIsValid(resource)) {\n+                throw new ResourceNotValidException(\"request resource is invalid\");\n+            }\n+\n+            neutronRouterWebRequestObject = resource.getRouter();\n+            String id = neutronRouterWebRequestObject.getId();\n+\n+            if (id == null || StringUtils.isEmpty(id)) {\n+                UUID vpcId = UUID.randomUUID();\n+                neutronRouterWebRequestObject.setId(vpcId.toString());\n+            }\n+            RestPreconditionsUtil.verifyResourceNotNull(neutronRouterWebRequestObject);\n+\n+            // configure default value\n+            neutronRouterWebRequestObject = RouteManagerUtil.configureNeutronRouterParameters(neutronRouterWebRequestObject);\n+\n+            // save router and router_extra_attribute\n+            this.neutronRouterService.saveRouterAndRouterExtraAttribute(neutronRouterWebRequestObject);\n+\n+        } catch (Exception e) {\n+            throw e;\n+        }\n+\n+        return new NeutronRouterWebJson(neutronRouterWebRequestObject);\n+    }\n+\n+    /**\n+     * Update a Neutron router\n+     * @param projectid\n+     * @param routerid\n+     * @param resource\n+     * @return\n+     * @throws Exception\n+     */\n+    @RequestMapping(\n+            method = PUT,\n+            value = {\"/project/{projectid}/routers/{routerid}\"})\n+    @DurationStatistics\n+    public NeutronRouterWebJson updateNeutronRouterByRouterId(@PathVariable String projectid,@PathVariable String routerid, @RequestBody NeutronRouterWebJson resource) throws Exception {\n+        NeutronRouterWebRequestObject neutronRouterWebRequestObject = null;\n+\n+        try {\n+            RestPreconditionsUtil.verifyParameterNotNullorEmpty(projectid);\n+\n+            // check resource\n+            if (!RouteManagerUtil.checkNeutronRouterWebResourceIsValid(resource)) {", "originalCommit": "b38726012f58999cd97179b84c933525a69e94f3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTUzNjkzMg==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r479536932", "bodyText": "User are not allowed to change the router_id", "author": "kevin-zhonghao", "createdAt": "2020-08-28T21:12:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA1NjMwNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA1OTA5NA==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r477059094", "bodyText": "Yes, I think you've introduced port_detail in the SubnetEntity.\nHow about removing the old gw_port_ip and gw_port_mac? I would recommend to keep them for now unless PM and other relevant managers switch to the new contract, and then we remove the old fields. Therefore it might be worth putting a @Legacy annotation on those fields.", "author": "xieus", "createdAt": "2020-08-26T06:18:27Z", "path": "web/src/main/java/com/futurewei/alcor/web/entity/subnet/SubnetEntity.java", "diffHunk": "@@ -36,9 +37,19 @@\n     @JsonProperty(\"availability_zone\")\n     private String availabilityZone;\n \n+    // TODO: considering to put into port", "originalCommit": "b38726012f58999cd97179b84c933525a69e94f3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzE2MDYxMw==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r483160613", "bodyText": "Yes ~ I think so", "author": "kevin-zhonghao", "createdAt": "2020-09-03T18:02:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA1OTA5NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzI5MTcyNA==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r483291724", "bodyText": "we could do this in future~", "author": "kevin-zhonghao", "createdAt": "2020-09-03T22:43:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA1OTA5NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA2MTg3OA==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r477061878", "bodyText": "Do we need this?", "author": "xieus", "createdAt": "2020-08-26T06:25:43Z", "path": "services/vpc_manager/src/main/java/com/futurewei/alcor/vpcmanager/service/VpcService.java", "diffHunk": "@@ -2,6 +2,7 @@\n \n import com.futurewei.alcor.vpcmanager.exception.SubnetsNotEmptyException;\n import com.futurewei.alcor.web.entity.route.RouteWebJson;\n+import com.futurewei.alcor.web.entity.route.RouterWebJson;", "originalCommit": "b38726012f58999cd97179b84c933525a69e94f3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTUzNzM0OA==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r479537348", "bodyText": "Already remove it", "author": "kevin-zhonghao", "createdAt": "2020-08-28T21:14:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA2MTg3OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA2MjAwNA==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r477062004", "bodyText": "Do we need them?", "author": "xieus", "createdAt": "2020-08-26T06:26:00Z", "path": "services/vpc_manager/src/main/java/com/futurewei/alcor/vpcmanager/controller/VpcController.java", "diffHunk": "@@ -29,6 +29,9 @@\n import com.futurewei.alcor.web.entity.route.RouteWebJson;\n import com.futurewei.alcor.web.entity.route.RouteEntity;\n import com.futurewei.alcor.web.entity.vpc.SegmentInfoInVpc;\n+import com.futurewei.alcor.web.entity.route.Router;", "originalCommit": "b38726012f58999cd97179b84c933525a69e94f3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTUzNzMwMQ==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r479537301", "bodyText": "Already remove it", "author": "kevin-zhonghao", "createdAt": "2020-08-28T21:13:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA2MjAwNA=="}], "type": "inlineReview"}, {"oid": "3783756ba7517f80b3ed11501351b7e02c840976", "url": "https://github.com/futurewei-cloud/alcor/commit/3783756ba7517f80b3ed11501351b7e02c840976", "message": "update", "committedDate": "2020-08-28T00:16:47Z", "type": "commit"}, {"oid": "88b02b7823fac516ff5a2ef18dcef9c154397267", "url": "https://github.com/futurewei-cloud/alcor/commit/88b02b7823fac516ff5a2ef18dcef9c154397267", "message": "Merge branch 'master' of https://github.com/futurewei-cloud/alcor into new_master", "committedDate": "2020-08-28T02:46:04Z", "type": "commit"}, {"oid": "b4c259f56d20e9e1fb55026d0b79daf0431936ae", "url": "https://github.com/futurewei-cloud/alcor/commit/b4c259f56d20e9e1fb55026d0b79daf0431936ae", "message": "Merge branch 'new_master' into feature/refactor_route_manager\n\n# Conflicts:\n#\tservices/vpc_manager/src/main/java/com/futurewei/alcor/vpcmanager/controller/VpcController.java", "committedDate": "2020-08-28T17:44:44Z", "type": "commit"}, {"oid": "0cedccb3022628b1545e35a90a7f369c0b249dbd", "url": "https://github.com/futurewei-cloud/alcor/commit/0cedccb3022628b1545e35a90a7f369c0b249dbd", "message": "update UTs and fix comments", "committedDate": "2020-08-28T21:11:12Z", "type": "commit"}, {"oid": "a909f88b75de093f6fe54287ea00b7a8c4677b56", "url": "https://github.com/futurewei-cloud/alcor/commit/a909f88b75de093f6fe54287ea00b7a8c4677b56", "message": "new API", "committedDate": "2020-08-31T23:51:21Z", "type": "commit"}, {"oid": "06c30f4298a8ef7b8a8a7567ae5ae352173e7aa6", "url": "https://github.com/futurewei-cloud/alcor/commit/06c30f4298a8ef7b8a8a7567ae5ae352173e7aa6", "message": "update", "committedDate": "2020-09-01T21:16:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjIyMTk2OQ==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r482221969", "bodyText": "Do we need to persist here?", "author": "xieus", "createdAt": "2020-09-02T16:57:52Z", "path": "services/route_manager/src/main/java/com/futurewei/alcor/route/controller/RouteController.java", "diffHunk": "@@ -252,4 +251,43 @@ public ResponseId deleteRuleWithSubnetId(@PathVariable String subnetId, @PathVar\n         return new ResponseId(routeId);\n         \n     }\n+\n+    @RequestMapping(\n+            method = POST,\n+            value = {\"/routers/{routerId}/routetable/{routeTableId}\"})\n+    @ResponseStatus(HttpStatus.CREATED)\n+    @DurationStatistics\n+    public RouterWebJson createDefaultRouterForVpc(@PathVariable String routerId, @PathVariable String routeTableId, @RequestBody VpcWebJson resource) throws Exception {\n+        RouteEntry routeEntry = null;\n+        RouteTable routeTable = null;\n+        Router router = null;\n+\n+        try {\n+            RestPreconditionsUtil.verifyParameterNotNullorEmpty(routerId);\n+            RestPreconditionsUtil.verifyParameterNotNullorEmpty(routeTableId);\n+            VpcEntity vpcEntity = resource.getNetwork();\n+            RestPreconditionsUtil.verifyResourceNotNull(vpcEntity);\n+\n+            String id = UUID.randomUUID().toString();\n+            String projectId = vpcEntity.getProjectId();\n+            String destination = vpcEntity.getCidr();\n+            String vpcId = vpcEntity.getId();\n+\n+            routeEntry = new RouteEntry(projectId, id, \"default_route_rule\", \"\",\n+                    destination, RouteConstant.DEFAULT_TARGET, RouteConstant.DEFAULT_PRIORITY, routeTableId, null);\n+            List<RouteEntry> routeEntries = new ArrayList<>();\n+            routeEntries.add(routeEntry);\n+            routeTable = new RouteTable(projectId, routerId, \"default_route_table\", \"\",routeEntries, RouteConstant.DEFAULT_ROUTE_TABLE_TYPE,vpcId);\n+\n+            router = new Router(projectId, routeTableId, \"default_router\", \"\", routeTable);\n+\n+            //this.routeDatabaseService.addRoute(routeEntity);", "originalCommit": "06c30f4298a8ef7b8a8a7567ae5ae352173e7aa6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzE2NDQ0OA==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r483164448", "bodyText": "No ~ this is an API for previous test, which need to be deleted", "author": "kevin-zhonghao", "createdAt": "2020-09-03T18:10:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjIyMTk2OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjIyMjI2MA==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r482222260", "bodyText": "Use alcor logger.", "author": "xieus", "createdAt": "2020-09-02T16:58:17Z", "path": "services/route_manager/src/main/java/com/futurewei/alcor/route/controller/RouteEntryController.java", "diffHunk": "@@ -0,0 +1,29 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+package com.futurewei.alcor.route.controller;\n+\n+import org.slf4j.Logger;", "originalCommit": "06c30f4298a8ef7b8a8a7567ae5ae352173e7aa6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjIyMjk1OA==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r482222958", "bodyText": "btw, doesn't find APIs in RouteEntryController and RouteTableController. Do we still need these new controllers?", "author": "xieus", "createdAt": "2020-09-02T16:59:25Z", "path": "services/route_manager/src/main/java/com/futurewei/alcor/route/controller/RouteEntryController.java", "diffHunk": "@@ -0,0 +1,29 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+package com.futurewei.alcor.route.controller;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.context.annotation.ComponentScan;\n+import org.springframework.web.bind.annotation.RestController;\n+\n+@RestController\n+@ComponentScan(value = \"com.futurewei.alcor.common.stats\")\n+public class RouteEntryController {", "originalCommit": "06c30f4298a8ef7b8a8a7567ae5ae352173e7aa6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzE2NDgyMw==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r483164823", "bodyText": "RouteEntryController is removed and RouteTableController is empty", "author": "kevin-zhonghao", "createdAt": "2020-09-03T18:10:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjIyMjk1OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjQ4NDY1Nw==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r482484657", "bodyText": "Why you need to set routerID when routerExtraAttribute != null?\nThe routerID should be set when the router has or has not extra attribute.", "author": "cj-chung", "createdAt": "2020-09-02T21:21:51Z", "path": "services/route_manager/src/main/java/com/futurewei/alcor/route/service/Impl/NeutronRouterServiceImpl.java", "diffHunk": "@@ -0,0 +1,484 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+package com.futurewei.alcor.route.service.Impl;\n+\n+import com.futurewei.alcor.common.enumClass.RouteTableType;\n+import com.futurewei.alcor.common.exception.DatabasePersistenceException;\n+import com.futurewei.alcor.common.exception.ResourceNotFoundException;\n+import com.futurewei.alcor.common.exception.ResourcePersistenceException;\n+import com.futurewei.alcor.route.exception.*;\n+import com.futurewei.alcor.route.service.NeutronRouterService;\n+import com.futurewei.alcor.route.service.NeutronRouterToSubnetService;\n+import com.futurewei.alcor.route.service.RouterDatabaseService;\n+import com.futurewei.alcor.route.service.RouterExtraAttributeDatabaseService;\n+import com.futurewei.alcor.web.entity.port.PortEntity;\n+import com.futurewei.alcor.web.entity.route.*;\n+import com.futurewei.alcor.web.entity.subnet.SubnetEntity;\n+import com.futurewei.alcor.web.entity.subnet.SubnetWebJson;\n+import com.futurewei.alcor.web.entity.subnet.SubnetsWebJson;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.BeanUtils;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.stereotype.Service;\n+\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.UUID;\n+\n+@Service\n+public class NeutronRouterServiceImpl implements NeutronRouterService {\n+\n+    private Logger logger = LoggerFactory.getLogger(this.getClass());\n+\n+    @Autowired\n+    private NeutronRouterToSubnetService routerToSubnetService;\n+\n+    @Autowired\n+    private RouterDatabaseService routerDatabaseService;\n+\n+    @Autowired\n+    private RouterExtraAttributeDatabaseService routerExtraAttributeDatabaseService;\n+\n+    @Override\n+    public NeutronRouterWebRequestObject getNeutronRouter(String routerId) throws ResourceNotFoundException, ResourcePersistenceException, CanNotFindRouter {\n+        NeutronRouterWebRequestObject neutronRouterWebRequestObject = new NeutronRouterWebRequestObject();\n+\n+        Router router = this.routerDatabaseService.getByRouterId(routerId);\n+        if (router == null) {\n+            throw new CanNotFindRouter();\n+        }\n+\n+        RouterExtraAttribute routerExtraAttribute = this.routerExtraAttributeDatabaseService.getByRouterExtraAttributeId(router.getRouterExtraAttributeId());\n+\n+        BeanUtils.copyProperties(router, neutronRouterWebRequestObject);\n+        RouteTable routeTable = router.getRouteTable();\n+        neutronRouterWebRequestObject.setRouteTable(routeTable);\n+        if (routerExtraAttribute != null) {\n+            BeanUtils.copyProperties(routerExtraAttribute, neutronRouterWebRequestObject);\n+            neutronRouterWebRequestObject.setId(routerId);\n+        }", "originalCommit": "06c30f4298a8ef7b8a8a7567ae5ae352173e7aa6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzE4MjMwMw==", "url": "https://github.com/futurewei-cloud/alcor/pull/361#discussion_r483182303", "bodyText": "The ID of NeutronRouterWebRequestObject should be router_id, but I used the BeanUtils.copyProperties method twice. The first time I used it, NeutronRouterWebRequestObject_id = router_id; But the second time I used it, route_extra_attribute_id would overwrite the previous value, so I had to change it set back", "author": "kevin-zhonghao", "createdAt": "2020-09-03T18:40:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjQ4NDY1Nw=="}], "type": "inlineReview"}, {"oid": "d745b478545745a95b502158cf07d0037b3cf241", "url": "https://github.com/futurewei-cloud/alcor/commit/d745b478545745a95b502158cf07d0037b3cf241", "message": "Update design documents and table of content", "committedDate": "2019-10-01T01:24:32Z", "type": "commit"}, {"oid": "1fc253ec962a7f0b4e60d095009ceecadf7dab77", "url": "https://github.com/futurewei-cloud/alcor/commit/1fc253ec962a7f0b4e60d095009ceecadf7dab77", "message": "Update README.md", "committedDate": "2019-10-02T08:28:06Z", "type": "commit"}, {"oid": "9b0efb64a961e93b07ce9413ea7ddecc360703d6", "url": "https://github.com/futurewei-cloud/alcor/commit/9b0efb64a961e93b07ce9413ea7ddecc360703d6", "message": "Add cloud-native key word", "committedDate": "2019-10-02T09:03:47Z", "type": "commit"}, {"oid": "db0a6990b01f2715002377cf551095253f16ca50", "url": "https://github.com/futurewei-cloud/alcor/commit/db0a6990b01f2715002377cf551095253f16ca50", "message": "Merge branch 'docs/design' of https://github.com/futurewei-cloud/AliothController into docs/design", "committedDate": "2019-10-02T17:09:04Z", "type": "commit"}, {"oid": "424dd5b140784fa974e7cc61766a005ffa720a9a", "url": "https://github.com/futurewei-cloud/alcor/commit/424dd5b140784fa974e7cc61766a005ffa720a9a", "message": "Start docs for comm and controller", "committedDate": "2019-10-02T17:12:00Z", "type": "commit"}, {"oid": "b41edb9be73f2ab9f6a19ce4ca10e85b07281aee", "url": "https://github.com/futurewei-cloud/alcor/commit/b41edb9be73f2ab9f6a19ce4ca10e85b07281aee", "message": "Add design sketch", "committedDate": "2019-10-08T18:54:10Z", "type": "commit"}, {"oid": "3e54c578a01355d6286175bb87a7612df1f37b93", "url": "https://github.com/futurewei-cloud/alcor/commit/3e54c578a01355d6286175bb87a7612df1f37b93", "message": "Design spec round 1", "committedDate": "2019-10-19T18:09:59Z", "type": "commit"}, {"oid": "d7d8ad9a143d2622e54d45d3523ea18b9496f6fe", "url": "https://github.com/futurewei-cloud/alcor/commit/d7d8ad9a143d2622e54d45d3523ea18b9496f6fe", "message": "Rename fast path file and start feature comparison", "committedDate": "2019-10-20T18:52:59Z", "type": "commit"}, {"oid": "4c6588e9cddbc1340254665fff874e495159c58d", "url": "https://github.com/futurewei-cloud/alcor/commit/4c6588e9cddbc1340254665fff874e495159c58d", "message": "Update rescue path doc [DRAFT]", "committedDate": "2019-10-24T01:08:42Z", "type": "commit"}, {"oid": "cceaa68d2838fcbac5b2bd2d0737fd01e432d3fa", "url": "https://github.com/futurewei-cloud/alcor/commit/cceaa68d2838fcbac5b2bd2d0737fd01e432d3fa", "message": "upload rescue_path.GIF", "committedDate": "2019-10-24T01:12:52Z", "type": "commit"}, {"oid": "978565619e33c5cc44a406fdc7d361f67eb46c7c", "url": "https://github.com/futurewei-cloud/alcor/commit/978565619e33c5cc44a406fdc7d361f67eb46c7c", "message": "update rescue path needed change table", "committedDate": "2019-10-24T01:18:15Z", "type": "commit"}, {"oid": "3e2b63ef9dbdab9de7b3879732430d7400ea1325", "url": "https://github.com/futurewei-cloud/alcor/commit/3e2b63ef9dbdab9de7b3879732430d7400ea1325", "message": "rescue_path.GIF", "committedDate": "2019-10-25T16:51:22Z", "type": "commit"}, {"oid": "f8fc472b93a1c5211f1d821fb6c4518d2a93e226", "url": "https://github.com/futurewei-cloud/alcor/commit/f8fc472b93a1c5211f1d821fb6c4518d2a93e226", "message": "rescue_path.adoc", "committedDate": "2019-10-25T21:48:30Z", "type": "commit"}, {"oid": "2480dd186fdac3ea59d1663439bc126aec67758e", "url": "https://github.com/futurewei-cloud/alcor/commit/2480dd186fdac3ea59d1663439bc126aec67758e", "message": "Design spec round 2", "committedDate": "2019-10-25T22:14:01Z", "type": "commit"}, {"oid": "68eda0bf67ff271cb833fc12b19655abed2739e8", "url": "https://github.com/futurewei-cloud/alcor/commit/68eda0bf67ff271cb833fc12b19655abed2739e8", "message": "Monitoring design outline", "committedDate": "2019-10-26T06:08:35Z", "type": "commit"}, {"oid": "c1c9cc7bccfaf86cb118c291ad375dfe5afe7d2f", "url": "https://github.com/futurewei-cloud/alcor/commit/c1c9cc7bccfaf86cb118c291ad375dfe5afe7d2f", "message": "Update comm docs", "committedDate": "2019-10-26T06:29:57Z", "type": "commit"}, {"oid": "79e91fef8cd18e945ff737d61c661fe0870b3387", "url": "https://github.com/futurewei-cloud/alcor/commit/79e91fef8cd18e945ff737d61c661fe0870b3387", "message": "Update data storage design", "committedDate": "2019-10-26T19:12:06Z", "type": "commit"}, {"oid": "ca69892a7e60866df3f8b21ef783681ebcc8b0d5", "url": "https://github.com/futurewei-cloud/alcor/commit/ca69892a7e60866df3f8b21ef783681ebcc8b0d5", "message": "Merge branch 'docs/design' of https://github.com/futurewei-cloud/AliothController into docs/design", "committedDate": "2019-10-26T19:12:18Z", "type": "commit"}, {"oid": "8b154ab0b4f4ba863aa65c0718b0fe2c345d7c2d", "url": "https://github.com/futurewei-cloud/alcor/commit/8b154ab0b4f4ba863aa65c0718b0fe2c345d7c2d", "message": "Update data store", "committedDate": "2019-10-28T15:55:14Z", "type": "commit"}, {"oid": "4561d1eb71805b1db4d0240f7c2a2b9dfd48181b", "url": "https://github.com/futurewei-cloud/alcor/commit/4561d1eb71805b1db4d0240f7c2a2b9dfd48181b", "message": "Complete review of existing dbs", "committedDate": "2019-10-29T00:10:31Z", "type": "commit"}, {"oid": "ca4610e5a5431d989e0f76d57fbe77c4d9427c60", "url": "https://github.com/futurewei-cloud/alcor/commit/ca4610e5a5431d989e0f76d57fbe77c4d9427c60", "message": "Update review table", "committedDate": "2019-10-29T00:12:52Z", "type": "commit"}, {"oid": "24b4a365811ffd398134f09a4f4320f242c4c09e", "url": "https://github.com/futurewei-cloud/alcor/commit/24b4a365811ffd398134f09a4f4320f242c4c09e", "message": "Adjust table column width", "committedDate": "2019-10-29T00:19:56Z", "type": "commit"}, {"oid": "45774dafcd131273a3ba9cfac8e8e9bb911252b4", "url": "https://github.com/futurewei-cloud/alcor/commit/45774dafcd131273a3ba9cfac8e8e9bb911252b4", "message": "Update feature comparsion table", "committedDate": "2019-10-29T15:09:20Z", "type": "commit"}, {"oid": "18e500c5f9e3d6702299f534ac9e609eb59c033d", "url": "https://github.com/futurewei-cloud/alcor/commit/18e500c5f9e3d6702299f534ac9e609eb59c033d", "message": "Finalize review section in data store", "committedDate": "2019-10-29T23:04:43Z", "type": "commit"}, {"oid": "cc99d1454b188d516a309fa19783d20285f0f8d5", "url": "https://github.com/futurewei-cloud/alcor/commit/cc99d1454b188d516a309fa19783d20285f0f8d5", "message": "Add design diagram", "committedDate": "2019-10-30T18:42:14Z", "type": "commit"}, {"oid": "a9c82327fa2cc2a20e8a9595e9ed0535de7eb8ec", "url": "https://github.com/futurewei-cloud/alcor/commit/a9c82327fa2cc2a20e8a9595e9ed0535de7eb8ec", "message": "Add a design diagram", "committedDate": "2019-10-30T19:49:41Z", "type": "commit"}, {"oid": "2823921cbf3c75cb048163beec45672807e55ee4", "url": "https://github.com/futurewei-cloud/alcor/commit/2823921cbf3c75cb048163beec45672807e55ee4", "message": "Add files via upload", "committedDate": "2019-10-30T21:29:45Z", "type": "commit"}, {"oid": "47b7e452f0f946671211a775713d97717f99e848", "url": "https://github.com/futurewei-cloud/alcor/commit/47b7e452f0f946671211a775713d97717f99e848", "message": "fix \"design\" session level", "committedDate": "2019-10-30T21:43:08Z", "type": "commit"}, {"oid": "8c9c004d8af7eff0aba83732bd57617faa1f8321", "url": "https://github.com/futurewei-cloud/alcor/commit/8c9c004d8af7eff0aba83732bd57617faa1f8321", "message": "Update monitoring.adoc", "committedDate": "2019-10-30T21:45:22Z", "type": "commit"}, {"oid": "41804505b2625ccdb789e0e4f2251beca0506327", "url": "https://github.com/futurewei-cloud/alcor/commit/41804505b2625ccdb789e0e4f2251beca0506327", "message": "Update monitoring.adoc", "committedDate": "2019-10-30T22:51:18Z", "type": "commit"}, {"oid": "dc3958943753c8e6e86f31268f1c45534077e5b8", "url": "https://github.com/futurewei-cloud/alcor/commit/dc3958943753c8e6e86f31268f1c45534077e5b8", "message": "Add architectural design discussion", "committedDate": "2019-10-30T23:51:12Z", "type": "commit"}, {"oid": "847900e5b28fc711f2317fc48da2bcbbb5d4cd00", "url": "https://github.com/futurewei-cloud/alcor/commit/847900e5b28fc711f2317fc48da2bcbbb5d4cd00", "message": "Merge branch 'docs/design' of https://github.com/futurewei-cloud/AliothController into docs/design", "committedDate": "2019-10-30T23:51:43Z", "type": "commit"}, {"oid": "088feffee3e81b3c21122b3c8893d047517424b7", "url": "https://github.com/futurewei-cloud/alcor/commit/088feffee3e81b3c21122b3c8893d047517424b7", "message": "Update architecture image link", "committedDate": "2019-10-31T00:57:48Z", "type": "commit"}, {"oid": "a16e184d3e255452012a3519fd08b33489b3778b", "url": "https://github.com/futurewei-cloud/alcor/commit/a16e184d3e255452012a3519fd08b33489b3778b", "message": "Finalize storage design", "committedDate": "2019-10-31T07:43:22Z", "type": "commit"}, {"oid": "041b203e62657ec985bbeabff6f2f5657adc8be0", "url": "https://github.com/futurewei-cloud/alcor/commit/041b203e62657ec985bbeabff6f2f5657adc8be0", "message": "Update a few subtitles", "committedDate": "2019-10-31T07:52:06Z", "type": "commit"}, {"oid": "359463e72ac61fbafd75bfd46d07c45adce1a8d0", "url": "https://github.com/futurewei-cloud/alcor/commit/359463e72ac61fbafd75bfd46d07c45adce1a8d0", "message": "Minor grammar fixes", "committedDate": "2019-10-31T08:42:54Z", "type": "commit"}, {"oid": "5d178e49281143f6c1c7f5cfafb260e304457582", "url": "https://github.com/futurewei-cloud/alcor/commit/5d178e49281143f6c1c7f5cfafb260e304457582", "message": "Add controller architecture diagram", "committedDate": "2019-11-02T07:56:02Z", "type": "commit"}, {"oid": "ca474b040686d3a4acf5cad99f400a801c10b656", "url": "https://github.com/futurewei-cloud/alcor/commit/ca474b040686d3a4acf5cad99f400a801c10b656", "message": "Update node_monitoring.adoc", "committedDate": "2019-11-04T18:04:46Z", "type": "commit"}, {"oid": "35a4ce354775cc1807ab93b3f1124c6fb72ed046", "url": "https://github.com/futurewei-cloud/alcor/commit/35a4ce354775cc1807ab93b3f1124c6fb72ed046", "message": "Update monitoring.adoc", "committedDate": "2019-11-04T18:07:22Z", "type": "commit"}, {"oid": "4b97cfe3d18e9fcf8b92155d570f1e93f0ede3ff", "url": "https://github.com/futurewei-cloud/alcor/commit/4b97cfe3d18e9fcf8b92155d570f1e93f0ede3ff", "message": "Update monitoring.adoc", "committedDate": "2019-11-04T19:44:47Z", "type": "commit"}, {"oid": "0df003abc20ac49c23db3acc4bcf7f3a973aaecd", "url": "https://github.com/futurewei-cloud/alcor/commit/0df003abc20ac49c23db3acc4bcf7f3a973aaecd", "message": "Update node_monitoring.adoc", "committedDate": "2019-11-04T19:49:40Z", "type": "commit"}, {"oid": "72916af2b9100eddce5fcca3b16b28a13b8d7349", "url": "https://github.com/futurewei-cloud/alcor/commit/72916af2b9100eddce5fcca3b16b28a13b8d7349", "message": "Update monitoring.adoc", "committedDate": "2019-11-04T22:59:12Z", "type": "commit"}, {"oid": "db7c3ee998a6afad91c270345c1985e114155174", "url": "https://github.com/futurewei-cloud/alcor/commit/db7c3ee998a6afad91c270345c1985e114155174", "message": "Minor fixes for adoc file", "committedDate": "2019-11-05T00:08:12Z", "type": "commit"}, {"oid": "ed033951d5ec12a24ab39e525f7a9d691677d245", "url": "https://github.com/futurewei-cloud/alcor/commit/ed033951d5ec12a24ab39e525f7a9d691677d245", "message": "Update monitoring.adoc", "committedDate": "2019-11-05T00:15:22Z", "type": "commit"}, {"oid": "6e9944d6ee27dc6697ce20136ba38aeb5b60e906", "url": "https://github.com/futurewei-cloud/alcor/commit/6e9944d6ee27dc6697ce20136ba38aeb5b60e906", "message": "Fix references in monitoring doc", "committedDate": "2019-11-05T00:15:46Z", "type": "commit"}, {"oid": "c0723c03ce042bb0f57ba6d6be8010b1af598c65", "url": "https://github.com/futurewei-cloud/alcor/commit/c0723c03ce042bb0f57ba6d6be8010b1af598c65", "message": "Merge branch 'docs/design' of https://github.com/futurewei-cloud/AliothController into docs/design", "committedDate": "2019-11-05T00:18:42Z", "type": "commit"}, {"oid": "9a41b55283e85b9d465da904b9be0bf7f7510a76", "url": "https://github.com/futurewei-cloud/alcor/commit/9a41b55283e85b9d465da904b9be0bf7f7510a76", "message": "Update monitoring.adoc", "committedDate": "2019-11-05T00:29:25Z", "type": "commit"}, {"oid": "24dddf8e4ee519195b9613641ffdfd48e2e8907a", "url": "https://github.com/futurewei-cloud/alcor/commit/24dddf8e4ee519195b9613641ffdfd48e2e8907a", "message": "Update monitoring.adoc", "committedDate": "2019-11-05T00:31:24Z", "type": "commit"}, {"oid": "daf7f5560fa0706e89988f74cd8226f2e51c22a5", "url": "https://github.com/futurewei-cloud/alcor/commit/daf7f5560fa0706e89988f74cd8226f2e51c22a5", "message": "Add details based on disucssion", "committedDate": "2019-11-05T01:23:53Z", "type": "commit"}, {"oid": "f4bae19a9c4806d1e72f769ff401b33012c4aa34", "url": "https://github.com/futurewei-cloud/alcor/commit/f4bae19a9c4806d1e72f769ff401b33012c4aa34", "message": "Add a table of content", "committedDate": "2019-11-05T01:25:55Z", "type": "commit"}, {"oid": "f20d71f62700f3929a890487c7c084518406afa0", "url": "https://github.com/futurewei-cloud/alcor/commit/f20d71f62700f3929a890487c7c084518406afa0", "message": "Update monitoring.adoc", "committedDate": "2019-11-05T06:50:08Z", "type": "commit"}, {"oid": "a7530359c97a15750cb4fa1e7858947fc9a195b2", "url": "https://github.com/futurewei-cloud/alcor/commit/a7530359c97a15750cb4fa1e7858947fc9a195b2", "message": "Update node_monitoring.adoc", "committedDate": "2019-11-05T07:04:49Z", "type": "commit"}, {"oid": "691d65869fd7e84c1528b998752f530c4ce2bbec", "url": "https://github.com/futurewei-cloud/alcor/commit/691d65869fd7e84c1528b998752f530c4ce2bbec", "message": "Update monitoring.adoc", "committedDate": "2019-11-05T07:05:16Z", "type": "commit"}, {"oid": "310b51d6b4320737319b30cd7e96d1e281751773", "url": "https://github.com/futurewei-cloud/alcor/commit/310b51d6b4320737319b30cd7e96d1e281751773", "message": "Add one item for node monitoring", "committedDate": "2019-11-05T18:26:50Z", "type": "commit"}, {"oid": "b414287a5ffe83ac0f6cf9ee1bf9bc9bd2afc12b", "url": "https://github.com/futurewei-cloud/alcor/commit/b414287a5ffe83ac0f6cf9ee1bf9bc9bd2afc12b", "message": "Update node_monitoring.adoc", "committedDate": "2019-11-05T23:57:28Z", "type": "commit"}, {"oid": "5c8c86e628111807ff930b6c37f1e559edebfe0f", "url": "https://github.com/futurewei-cloud/alcor/commit/5c8c86e628111807ff930b6c37f1e559edebfe0f", "message": "Reorganize monitoring doc and update design doc metadata format", "committedDate": "2019-11-06T18:28:45Z", "type": "commit"}, {"oid": "1d0606e9cbae9151dfb7469822dd5c6ec79b583d", "url": "https://github.com/futurewei-cloud/alcor/commit/1d0606e9cbae9151dfb7469822dd5c6ec79b583d", "message": "Update rescue_path.adoc\n\nfix typos", "committedDate": "2019-11-08T21:39:14Z", "type": "commit"}, {"oid": "a632e484bf6456678dfcc3b6c748418e8dfaad1b", "url": "https://github.com/futurewei-cloud/alcor/commit/a632e484bf6456678dfcc3b6c748418e8dfaad1b", "message": "Add benchmark results", "committedDate": "2019-11-12T20:14:15Z", "type": "commit"}, {"oid": "fd3762db077af5568e8617f59ef2a3dd1037ea97", "url": "https://github.com/futurewei-cloud/alcor/commit/fd3762db077af5568e8617f59ef2a3dd1037ea97", "message": "Update rescue_path.adoc", "committedDate": "2019-11-20T23:54:43Z", "type": "commit"}, {"oid": "769f5455c972becaa2e30a64fc963ba8ff1546a0", "url": "https://github.com/futurewei-cloud/alcor/commit/769f5455c972becaa2e30a64fc963ba8ff1546a0", "message": "Update monitoring.adoc", "committedDate": "2019-11-21T00:12:54Z", "type": "commit"}, {"oid": "de441c39e008cea205bf1a1a2cb7953d37adc199", "url": "https://github.com/futurewei-cloud/alcor/commit/de441c39e008cea205bf1a1a2cb7953d37adc199", "message": "Update data model doc", "committedDate": "2020-02-05T16:16:14Z", "type": "commit"}, {"oid": "eebe7005176ddd004434e6aa6ea06d2a8e905de8", "url": "https://github.com/futurewei-cloud/alcor/commit/eebe7005176ddd004434e6aa6ea06d2a8e905de8", "message": "Merge from master", "committedDate": "2020-02-24T02:10:42Z", "type": "commit"}, {"oid": "4cbd99aebede3473651a64ee84853ce7ba335ca3", "url": "https://github.com/futurewei-cloud/alcor/commit/4cbd99aebede3473651a64ee84853ce7ba335ca3", "message": "Add API workflow chart for creation of vpc, subnet and port", "committedDate": "2020-02-27T01:27:40Z", "type": "commit"}, {"oid": "46215bfe3d2d6cd78a74c906a030d32d80872c59", "url": "https://github.com/futurewei-cloud/alcor/commit/46215bfe3d2d6cd78a74c906a030d32d80872c59", "message": "Update Create workflow chart", "committedDate": "2020-02-27T17:04:37Z", "type": "commit"}, {"oid": "9b1fbecd2ce9a70db1dc26a52a19e368047bb7c4", "url": "https://github.com/futurewei-cloud/alcor/commit/9b1fbecd2ce9a70db1dc26a52a19e368047bb7c4", "message": "Create dataplane_abstraction.adoc", "committedDate": "2020-03-02T06:26:41Z", "type": "commit"}, {"oid": "62ad9f4c76d8b28d8cb1863b8c48e165c7de8717", "url": "https://github.com/futurewei-cloud/alcor/commit/62ad9f4c76d8b28d8cb1863b8c48e165c7de8717", "message": "Update dataplane_abstraction.adoc", "committedDate": "2020-03-02T07:19:43Z", "type": "commit"}, {"oid": "9e52e6c93e3c51da6ea1d37d7ae1804939009612", "url": "https://github.com/futurewei-cloud/alcor/commit/9e52e6c93e3c51da6ea1d37d7ae1804939009612", "message": "Update dataplane_abstraction.adoc", "committedDate": "2020-03-02T17:26:39Z", "type": "commit"}, {"oid": "6b7975e7dde2edd461a6563f3bd60458b38ea5f8", "url": "https://github.com/futurewei-cloud/alcor/commit/6b7975e7dde2edd461a6563f3bd60458b38ea5f8", "message": "Update dataplane_abstraction.adoc", "committedDate": "2020-03-02T17:46:46Z", "type": "commit"}, {"oid": "ea356aeeafdd9576716558be137dac5f3df786b9", "url": "https://github.com/futurewei-cloud/alcor/commit/ea356aeeafdd9576716558be137dac5f3df786b9", "message": "Update dataplane_abstraction.adoc", "committedDate": "2020-03-02T20:18:03Z", "type": "commit"}, {"oid": "b9c563aedaa600f04d21c3dbce0b3a7c4814cba3", "url": "https://github.com/futurewei-cloud/alcor/commit/b9c563aedaa600f04d21c3dbce0b3a7c4814cba3", "message": "Update dataplane_abstraction.adoc", "committedDate": "2020-03-02T23:16:05Z", "type": "commit"}, {"oid": "6c071a0569c8ac30813e224a8ae5521f0b98e206", "url": "https://github.com/futurewei-cloud/alcor/commit/6c071a0569c8ac30813e224a8ae5521f0b98e206", "message": "Update dataplane_abstraction.adoc", "committedDate": "2020-03-10T00:00:32Z", "type": "commit"}, {"oid": "972869504ed928c8eda1d139f7e1d680dde454fb", "url": "https://github.com/futurewei-cloud/alcor/commit/972869504ed928c8eda1d139f7e1d680dde454fb", "message": "Update dataplane_abstraction.adoc", "committedDate": "2020-03-10T00:04:48Z", "type": "commit"}, {"oid": "a915d5b743e134e4b17f168f5cdcf19fd509e2c3", "url": "https://github.com/futurewei-cloud/alcor/commit/a915d5b743e134e4b17f168f5cdcf19fd509e2c3", "message": "Add workflow option 2", "committedDate": "2020-03-12T16:54:46Z", "type": "commit"}, {"oid": "ad49c7cda0dcbb01fda95cd5123068801582814d", "url": "https://github.com/futurewei-cloud/alcor/commit/ad49c7cda0dcbb01fda95cd5123068801582814d", "message": "Update system_flow.adoc", "committedDate": "2020-03-18T22:32:04Z", "type": "commit"}, {"oid": "c93da513f629a51a66fbe89298eba6e94d063901", "url": "https://github.com/futurewei-cloud/alcor/commit/c93da513f629a51a66fbe89298eba6e94d063901", "message": "added - Reference: Neutron High Level Flow", "committedDate": "2020-03-19T01:07:34Z", "type": "commit"}, {"oid": "7feebf8b1c2d4ef619cd911b212df2a54fd6d9e4", "url": "https://github.com/futurewei-cloud/alcor/commit/7feebf8b1c2d4ef619cd911b212df2a54fd6d9e4", "message": "Update system_flow.adoc", "committedDate": "2020-03-19T05:28:15Z", "type": "commit"}, {"oid": "7dc4d4b9f099ea84a4a36d162cdb28ae954cb926", "url": "https://github.com/futurewei-cloud/alcor/commit/7dc4d4b9f099ea84a4a36d162cdb28ae954cb926", "message": "Update creation workflow", "committedDate": "2020-03-19T16:57:27Z", "type": "commit"}, {"oid": "45ba64e9a77acf44cca397c9aa228e79fa5bc95b", "url": "https://github.com/futurewei-cloud/alcor/commit/45ba64e9a77acf44cca397c9aa228e79fa5bc95b", "message": "Update system_flow.adoc", "committedDate": "2020-03-19T21:28:52Z", "type": "commit"}, {"oid": "68b05532a943451f2bba05a01d0d6779efce59a4", "url": "https://github.com/futurewei-cloud/alcor/commit/68b05532a943451f2bba05a01d0d6779efce59a4", "message": "check permission", "committedDate": "2020-03-24T06:53:01Z", "type": "commit"}, {"oid": "0c0faa6270f07bfe3ef78862c74855ebe2cf7478", "url": "https://github.com/futurewei-cloud/alcor/commit/0c0faa6270f07bfe3ef78862c74855ebe2cf7478", "message": "api gateway draft", "committedDate": "2020-03-27T04:41:03Z", "type": "commit"}, {"oid": "4dcd9f510511d7d73085722e295617aaa3d589fc", "url": "https://github.com/futurewei-cloud/alcor/commit/4dcd9f510511d7d73085722e295617aaa3d589fc", "message": "Merge branch 'master' into docs/design", "committedDate": "2020-04-02T15:33:02Z", "type": "commit"}, {"oid": "ec05e706e79744bbb566b05bafcc9347401e83bd", "url": "https://github.com/futurewei-cloud/alcor/commit/ec05e706e79744bbb566b05bafcc9347401e83bd", "message": "update controller doc", "committedDate": "2020-04-03T04:52:10Z", "type": "commit"}, {"oid": "7b53131f46cdc4a97bd433fa546fc645ac2b3784", "url": "https://github.com/futurewei-cloud/alcor/commit/7b53131f46cdc4a97bd433fa546fc645ac2b3784", "message": "Merge branch 'master' into docs/design", "committedDate": "2020-04-04T01:24:13Z", "type": "commit"}, {"oid": "f0622e24c9a2cbece6cf009cf40ff65ff3a6282a", "url": "https://github.com/futurewei-cloud/alcor/commit/f0622e24c9a2cbece6cf009cf40ff65ff3a6282a", "message": "Update ToC with microservice doc link", "committedDate": "2020-04-07T17:57:56Z", "type": "commit"}, {"oid": "ab9736e04e8169db16a0e86f356eace84c6b0ff4", "url": "https://github.com/futurewei-cloud/alcor/commit/ab9736e04e8169db16a0e86f356eace84c6b0ff4", "message": "Update ToC and add vpc/mac manager design files", "committedDate": "2020-04-07T19:07:51Z", "type": "commit"}, {"oid": "f5a515446d1395cbc12d29528b686aa9274c1e83", "url": "https://github.com/futurewei-cloud/alcor/commit/f5a515446d1395cbc12d29528b686aa9274c1e83", "message": "Add key difference file", "committedDate": "2020-04-07T20:09:48Z", "type": "commit"}, {"oid": "a102fb184aabea76c8e655ba7e55c05a09889506", "url": "https://github.com/futurewei-cloud/alcor/commit/a102fb184aabea76c8e655ba7e55c05a09889506", "message": "Merge branch 'master' into docs/design", "committedDate": "2020-04-09T05:03:11Z", "type": "commit"}, {"oid": "ac115c62d164618771668134a50988a6a6652d3a", "url": "https://github.com/futurewei-cloud/alcor/commit/ac115c62d164618771668134a50988a6a6652d3a", "message": "Minor updates in system flow", "committedDate": "2020-04-09T21:45:31Z", "type": "commit"}, {"oid": "80b4a4d6005db7bd89fa86ef6a62d77ac5f713a5", "url": "https://github.com/futurewei-cloud/alcor/commit/80b4a4d6005db7bd89fa86ef6a62d77ac5f713a5", "message": "Add microservice snapshot table", "committedDate": "2020-04-09T23:35:04Z", "type": "commit"}, {"oid": "669c1e4e2e00c0bef3d2726775a63c3ea767e9d5", "url": "https://github.com/futurewei-cloud/alcor/commit/669c1e4e2e00c0bef3d2726775a63c3ea767e9d5", "message": "Add concurrency handling", "committedDate": "2020-04-10T00:43:25Z", "type": "commit"}, {"oid": "cb72f12952643062aef40aff34ef3d52dfbf2c84", "url": "https://github.com/futurewei-cloud/alcor/commit/cb72f12952643062aef40aff34ef3d52dfbf2c84", "message": "Update controller design doc", "committedDate": "2020-04-10T04:44:32Z", "type": "commit"}, {"oid": "516a4f2622e654de7bf1982bf73ff9023f64acce", "url": "https://github.com/futurewei-cloud/alcor/commit/516a4f2622e654de7bf1982bf73ff9023f64acce", "message": "update api_gateway file name", "committedDate": "2020-04-10T04:47:07Z", "type": "commit"}, {"oid": "8a63380c2aa198d5f265598b17605e402933c58e", "url": "https://github.com/futurewei-cloud/alcor/commit/8a63380c2aa198d5f265598b17605e402933c58e", "message": "update file names", "committedDate": "2020-04-10T04:49:38Z", "type": "commit"}, {"oid": "22b1e640c5901c3b381e020b39f6b1469fb392a1", "url": "https://github.com/futurewei-cloud/alcor/commit/22b1e640c5901c3b381e020b39f6b1469fb392a1", "message": "Merge mac manager design spec from eunju:feature/macmanager", "committedDate": "2020-04-10T05:23:09Z", "type": "commit"}, {"oid": "bdcb7c3bb580b7cb773b865b7db4ed4e38f63164", "url": "https://github.com/futurewei-cloud/alcor/commit/bdcb7c3bb580b7cb773b865b7db4ed4e38f63164", "message": "Merge from master", "committedDate": "2020-04-19T22:19:56Z", "type": "commit"}, {"oid": "83e691b73b5e2bb151aef85f4949fac5d9d31630", "url": "https://github.com/futurewei-cloud/alcor/commit/83e691b73b5e2bb151aef85f4949fac5d9d31630", "message": "Add API completeness doc", "committedDate": "2020-04-20T06:36:48Z", "type": "commit"}, {"oid": "ef6a1a8445bbc7e774bd6e540cca9f80621c0063", "url": "https://github.com/futurewei-cloud/alcor/commit/ef6a1a8445bbc7e774bd6e540cca9f80621c0063", "message": "Updtate api_completeness table", "committedDate": "2020-04-21T17:00:03Z", "type": "commit"}, {"oid": "057c314450e772422dba875b1d0a08d4dc544d5e", "url": "https://github.com/futurewei-cloud/alcor/commit/057c314450e772422dba875b1d0a08d4dc544d5e", "message": "Add API count", "committedDate": "2020-04-21T18:16:19Z", "type": "commit"}, {"oid": "66743d2c7c953a21fc725a081f018c4a1053c4d3", "url": "https://github.com/futurewei-cloud/alcor/commit/66743d2c7c953a21fc725a081f018c4a1053c4d3", "message": "Add references for OpenStack and Alcor", "committedDate": "2020-04-21T20:06:14Z", "type": "commit"}, {"oid": "fb74537fa01bb6509ab1e3bb0d2c4777808175d1", "url": "https://github.com/futurewei-cloud/alcor/commit/fb74537fa01bb6509ab1e3bb0d2c4777808175d1", "message": "Merge branch 'master' into docs/design", "committedDate": "2020-04-26T00:24:26Z", "type": "commit"}]}