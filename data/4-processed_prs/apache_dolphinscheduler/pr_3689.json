{"pr_number": 3689, "pr_title": "fix #3688, Optimization of table building statements", "pr_createdAt": "2020-09-08T03:26:22Z", "pr_url": "https://github.com/apache/dolphinscheduler/pull/3689", "timeline": [{"oid": "dc45490d02e1e641e7d75ab12ea66bcdc5b40527", "url": "https://github.com/apache/dolphinscheduler/commit/dc45490d02e1e641e7d75ab12ea66bcdc5b40527", "message": "fix #3688, Optimization of table building statements", "committedDate": "2020-09-08T03:03:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTAyOTMzNQ==", "url": "https://github.com/apache/dolphinscheduler/pull/3689#discussion_r485029335", "bodyText": "Why need to use utf8 to replace utd8mb4?", "author": "yangyichao-mango", "createdAt": "2020-09-08T15:56:57Z", "path": "sql/dolphinscheduler_mysql.sql", "diffHunk": "@@ -248,7 +248,7 @@ CREATE TABLE `QRTZ_TRIGGERS` (\n   KEY `IDX_QRTZ_T_NFT_ST_MISFIRE` (`SCHED_NAME`,`MISFIRE_INSTR`,`NEXT_FIRE_TIME`,`TRIGGER_STATE`),\n   KEY `IDX_QRTZ_T_NFT_ST_MISFIRE_GRP` (`SCHED_NAME`,`MISFIRE_INSTR`,`NEXT_FIRE_TIME`,`TRIGGER_GROUP`,`TRIGGER_STATE`),\n   CONSTRAINT `QRTZ_TRIGGERS_ibfk_1` FOREIGN KEY (`SCHED_NAME`, `JOB_NAME`, `JOB_GROUP`) REFERENCES `QRTZ_JOB_DETAILS` (`SCHED_NAME`, `JOB_NAME`, `JOB_GROUP`)\n-) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\n+) ENGINE=InnoDB DEFAULT CHARSET=utf8;", "originalCommit": "dc45490d02e1e641e7d75ab12ea66bcdc5b40527", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTI5NzU2MA==", "url": "https://github.com/apache/dolphinscheduler/pull/3689#discussion_r485297560", "bodyText": "https://www.cnblogs.com/cuiqq/p/11045487.html\nI read this post and didn't quite understand the need to change the coding format.", "author": "felix-thinkingdata", "createdAt": "2020-09-09T02:17:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTAyOTMzNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTMwMjY5Mw==", "url": "https://github.com/apache/dolphinscheduler/pull/3689#discussion_r485302693", "bodyText": "I checked the qrtz related tables and will not write 4-byte Unicode. Utf8mb4 encoding will cause the index of qrtz related tables to exceed the default value of MySQL, which will cause many users to fail to create tables.", "author": "JinyLeeChina", "createdAt": "2020-09-09T02:37:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTAyOTMzNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTMzNzcyNA==", "url": "https://github.com/apache/dolphinscheduler/pull/3689#discussion_r485337724", "bodyText": "I checked the qrtz related tables and will not write 4-byte Unicode. Utf8mb4 encoding will cause the index of qrtz related tables to exceed the default value of MySQL, which will cause many users to fail to create tables.\n\n\nWhich version of your mysql?", "author": "yangyichao-mango", "createdAt": "2020-09-09T04:56:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTAyOTMzNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTU2NzAwNQ==", "url": "https://github.com/apache/dolphinscheduler/pull/3689#discussion_r485567005", "bodyText": "Version 5.6, I think there are many users of this version of MySQL, we should be compatible", "author": "JinyLeeChina", "createdAt": "2020-09-09T12:21:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTAyOTMzNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQ1Nzg0NQ==", "url": "https://github.com/apache/dolphinscheduler/pull/3689#discussion_r496457845", "bodyText": "Hi,we should discuss first,the utf8mb4 is suggested to use in mysql.You can see the article below.\nhttps://medium.com/@adamhooper/in-mysql-never-use-utf8-use-utf8mb4-11761243e434\nI saw the error you pointed Index column size too large. The maximum column size is 767 bytes.The another article give a method to resolve it.\nhttps://www.jianshu.com/p/5c0cce24189b", "author": "lgcareer", "createdAt": "2020-09-29T06:54:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTAyOTMzNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQ1ODg4Ng==", "url": "https://github.com/apache/dolphinscheduler/pull/3689#discussion_r496458886", "bodyText": "I will send a email in the dev list,we can discuss it which charset we need to choose.", "author": "lgcareer", "createdAt": "2020-09-29T06:56:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTAyOTMzNQ=="}], "type": "inlineReview"}]}