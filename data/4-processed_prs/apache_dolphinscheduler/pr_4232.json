{"pr_number": 4232, "pr_title": "[Fix#4222][Master]Add the priority queue to ensure that tasks are submitted according to priority.", "pr_createdAt": "2020-12-15T10:00:41Z", "pr_url": "https://github.com/apache/dolphinscheduler/pull/4232", "timeline": [{"oid": "c5bb72c6e3b1750bfcef90ecda31df219729422d", "url": "https://github.com/apache/dolphinscheduler/commit/c5bb72c6e3b1750bfcef90ecda31df219729422d", "message": "[Fix-4222][Master]Add the priority queue to ensure that tasks are submitted according to priority.", "committedDate": "2020-12-15T09:54:48Z", "type": "commit"}, {"oid": "bd7db688b6b1990e3ae40b18b61b0832be9cd8bb", "url": "https://github.com/apache/dolphinscheduler/commit/bd7db688b6b1990e3ae40b18b61b0832be9cd8bb", "message": "Merge remote-tracking branch 'remotes/upstream/1.3.4-prepare' into 1.3.4-prepare-feature-3878", "committedDate": "2020-12-15T09:55:03Z", "type": "commit"}, {"oid": "4cd1e7e5179afa14ba9670074107845854b998e1", "url": "https://github.com/apache/dolphinscheduler/commit/4cd1e7e5179afa14ba9670074107845854b998e1", "message": "[Fix-4222][Master]Add the priority queue to ensure that tasks are submitted according to priority.", "committedDate": "2020-12-15T10:18:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzIzMzUyNg==", "url": "https://github.com/apache/dolphinscheduler/pull/4232#discussion_r543233526", "bodyText": "Should use logger.error...", "author": "CalvinKirs", "createdAt": "2020-12-15T10:40:54Z", "path": "dolphinscheduler-server/src/main/java/org/apache/dolphinscheduler/server/master/runner/MasterExecThread.java", "diffHunk": "@@ -996,20 +1002,26 @@ private boolean retryTaskIntervalOverTime(TaskInstance taskInstance){\n      * handling the list of tasks to be submitted\n      */\n     private void submitStandByTask(){\n-        for(Map.Entry<String, TaskInstance> entry: readyToSubmitTaskList.entrySet()) {\n-            TaskInstance task = entry.getValue();\n-            DependResult dependResult = getDependResultForTask(task);\n-            if(DependResult.SUCCESS == dependResult){\n-                if(retryTaskIntervalOverTime(task)){\n-                    submitTaskExec(task);\n+\n+        try {\n+            int length = readyToSubmitTaskQueue.size();\n+            for (int i=0;i<length;i++) {\n+                TaskInstance task = readyToSubmitTaskQueue.peek();\n+                DependResult dependResult = getDependResultForTask(task);\n+                if(DependResult.SUCCESS == dependResult){\n+                    if(retryTaskIntervalOverTime(task)){\n+                        submitTaskExec(task);\n+                        removeTaskFromStandbyList(task);\n+                    }\n+                }else if(DependResult.FAILED == dependResult){\n+                    // if the dependency fails, the current node is not submitted and the state changes to failure.\n+                    dependFailedTask.put(task.getName(), task);\n                     removeTaskFromStandbyList(task);\n+                    logger.info(\"task {},id:{} depend result : {}\",task.getName(), task.getId(), dependResult);\n                 }\n-            }else if(DependResult.FAILED == dependResult){\n-                // if the dependency fails, the current node is not submitted and the state changes to failure.\n-                dependFailedTask.put(entry.getKey(), task);\n-                removeTaskFromStandbyList(task);\n-                logger.info(\"task {},id:{} depend result : {}\",task.getName(), task.getId(), dependResult);\n             }\n+        } catch (Exception e) {\n+            e.printStackTrace();", "originalCommit": "4cd1e7e5179afa14ba9670074107845854b998e1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "a6558bfcd7cc6f7970574d9a6f8c6a4a17dce664", "url": "https://github.com/apache/dolphinscheduler/commit/a6558bfcd7cc6f7970574d9a6f8c6a4a17dce664", "message": "[Fix-4222][Master]update print log.", "committedDate": "2020-12-15T11:24:10Z", "type": "commit"}]}