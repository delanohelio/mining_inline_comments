{"pr_number": 3215, "pr_title": "fix and update k8s deploy", "pr_createdAt": "2020-07-15T04:09:42Z", "pr_url": "https://github.com/apache/dolphinscheduler/pull/3215", "timeline": [{"oid": "72198cc761db4e73b0e6e6994c9c7a24a06721f5", "url": "https://github.com/apache/dolphinscheduler/commit/72198cc761db4e73b0e6e6994c9c7a24a06721f5", "message": "Modify the AWS S3 request encryption method to V4.", "committedDate": "2020-07-10T11:49:41Z", "type": "commit"}, {"oid": "2f9beb29049cd8f6184fa1fde0fa924c891907f3", "url": "https://github.com/apache/dolphinscheduler/commit/2f9beb29049cd8f6184fa1fde0fa924c891907f3", "message": "Merge branch 'dev' into rockxsj-dev", "committedDate": "2020-07-13T06:55:17Z", "type": "commit"}, {"oid": "3c35a6b4b9655163316af9a497c8e6a9fef7005c", "url": "https://github.com/apache/dolphinscheduler/commit/3c35a6b4b9655163316af9a497c8e6a9fef7005c", "message": "* update Dockerfile to add mysql-client for mysql database service test\n* update wechat alert config replace placeholder from  to {xx} because of the  will be treat as env variable\n* fix unit test of EnterpriseWeChatUtilsTest\n* update values.yaml default config for helm deploy DS cluster\n* update values.yaml default config for custom install\n* update templates of helm for custom install\n* update some name of env varibale, for example change from POSTGRESQL_HOST to DATABASE_HOST\n* delele the redundancy requirements.yaml for heml\n* update README* in the docker dir and subdir\n* update startup scripts for support mysql as backend database", "committedDate": "2020-07-14T06:46:12Z", "type": "commit"}, {"oid": "3a8c47cec70abed53b909daeebe5e1b4b5fd4b00", "url": "https://github.com/apache/dolphinscheduler/commit/3a8c47cec70abed53b909daeebe5e1b4b5fd4b00", "message": "Merge branch 'dev' into rockxsj-dev", "committedDate": "2020-07-14T06:46:20Z", "type": "commit"}, {"oid": "d08a3a794dbbcb7ebdd7667f6423aff3e8580e14", "url": "https://github.com/apache/dolphinscheduler/commit/d08a3a794dbbcb7ebdd7667f6423aff3e8580e14", "message": "Merge branch 'dev' into rockxsj-dev", "committedDate": "2020-07-15T01:17:23Z", "type": "commit"}, {"oid": "bc213f0a443f3d2b548f0b16089b67293e13b9d5", "url": "https://github.com/apache/dolphinscheduler/commit/bc213f0a443f3d2b548f0b16089b67293e13b9d5", "message": "* fix the ENV name wrong in docker-compose.yml and docker-stack.yml\n* remove the didn't need port mapping in postgresql & zookeeper & dolphinscheduler-api", "committedDate": "2020-07-15T01:22:59Z", "type": "commit"}, {"oid": "ddc38930272a9212f6ab4e73c5d9e98104f66abc", "url": "https://github.com/apache/dolphinscheduler/commit/ddc38930272a9212f6ab4e73c5d9e98104f66abc", "message": "* keep expose the port of postgresql & zk & api because of unit test needed", "committedDate": "2020-07-15T04:07:43Z", "type": "commit"}, {"oid": "822fcd30ceb16eb4c1e29f4e5fcf42221283cedd", "url": "https://github.com/apache/dolphinscheduler/commit/822fcd30ceb16eb4c1e29f4e5fcf42221283cedd", "message": "Merge branch 'dev' into rockxsj-dev", "committedDate": "2020-07-15T04:07:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTQ4NTEzNA==", "url": "https://github.com/apache/dolphinscheduler/pull/3215#discussion_r455485134", "bodyText": "mysql's license can not meet the requirements of apache, pls remove it", "author": "khadgarmage", "createdAt": "2020-07-16T03:17:22Z", "path": "docker/build/Dockerfile", "diffHunk": "@@ -42,8 +42,8 @@ ADD ./apache-dolphinscheduler-incubating-${VERSION}-dolphinscheduler-bin.tar.gz\n RUN mv /opt/apache-dolphinscheduler-incubating-${VERSION}-dolphinscheduler-bin/ /opt/dolphinscheduler/\n ENV DOLPHINSCHEDULER_HOME /opt/dolphinscheduler\n \n-#4. install pg\n-RUN apk add postgresql postgresql-contrib\n+#4. install database\n+RUN apk add postgresql postgresql-contrib mysql-client", "originalCommit": "822fcd30ceb16eb4c1e29f4e5fcf42221283cedd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTUyMDY3NQ==", "url": "https://github.com/apache/dolphinscheduler/pull/3215#discussion_r455520675", "bodyText": "+1", "author": "liwenhe1993", "createdAt": "2020-07-16T05:36:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTQ4NTEzNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTQ4NjE0OQ==", "url": "https://github.com/apache/dolphinscheduler/pull/3215#discussion_r455486149", "bodyText": "license problem", "author": "khadgarmage", "createdAt": "2020-07-16T03:21:13Z", "path": "docker/build/startup.sh", "diffHunk": "@@ -22,24 +22,32 @@ DOLPHINSCHEDULER_BIN=${DOLPHINSCHEDULER_HOME}/bin\n DOLPHINSCHEDULER_SCRIPT=${DOLPHINSCHEDULER_HOME}/script\n DOLPHINSCHEDULER_LOGS=${DOLPHINSCHEDULER_HOME}/logs\n \n-# start postgresql\n-initPostgreSQL() {\n-    echo \"test postgresql service\"\n-    while ! nc -z ${POSTGRESQL_HOST} ${POSTGRESQL_PORT}; do\n+# start database\n+initDatabase() {\n+    echo \"test ${DATABASE_TYPE} service\"\n+    while ! nc -z ${DATABASE_HOST} ${DATABASE_PORT}; do\n         counter=$((counter+1))\n         if [ $counter == 30 ]; then\n-            echo \"Error: Couldn't connect to postgresql.\"\n+            echo \"Error: Couldn't connect to ${DATABASE_TYPE}.\"\n             exit 1\n         fi\n-        echo \"Trying to connect to postgresql at ${POSTGRESQL_HOST}:${POSTGRESQL_PORT}. Attempt $counter.\"\n+        echo \"Trying to connect to ${DATABASE_TYPE} at ${DATABASE_HOST}:${DATABASE_PORT}. Attempt $counter.\"\n         sleep 5\n     done\n \n-    echo \"connect postgresql service\"\n-    v=$(sudo -u postgres PGPASSWORD=${POSTGRESQL_PASSWORD} psql -h ${POSTGRESQL_HOST} -p ${POSTGRESQL_PORT} -U ${POSTGRESQL_USERNAME} -d dolphinscheduler -tAc \"select 1\")\n-    if [ \"$(echo '${v}' | grep 'FATAL' | wc -l)\" -eq 1 ]; then\n-        echo \"Error: Can't connect to database...${v}\"\n-        exit 1\n+    echo \"connect ${DATABASE_TYPE} service\"\n+    if [ ${DATABASE_TYPE} = \"mysql\" ]; then", "originalCommit": "822fcd30ceb16eb4c1e29f4e5fcf42221283cedd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "bb6836627f840e85d350c9418f8c8bda76323ee0", "url": "https://github.com/apache/dolphinscheduler/commit/bb6836627f840e85d350c9418f8c8bda76323ee0", "message": "* remove mysql-client package from dockerfile", "committedDate": "2020-07-16T06:36:49Z", "type": "commit"}]}