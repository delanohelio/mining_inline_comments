{"pr_number": 3582, "pr_title": "[Feature][API] process definition delete api add check process instance is already running. #3581", "pr_createdAt": "2020-08-24T10:45:27Z", "pr_url": "https://github.com/apache/dolphinscheduler/pull/3582", "timeline": [{"oid": "97397b40fa00424adb72b26dae006a64d735952f", "url": "https://github.com/apache/dolphinscheduler/commit/97397b40fa00424adb72b26dae006a64d735952f", "message": "process definition delete api add check process instance is already running.", "committedDate": "2020-08-24T05:25:30Z", "type": "commit"}, {"oid": "2aaac4b3d297f7a5f7b73a133e1dfde978c64530", "url": "https://github.com/apache/dolphinscheduler/commit/2aaac4b3d297f7a5f7b73a133e1dfde978c64530", "message": "add checkstyle.", "committedDate": "2020-08-25T01:38:54Z", "type": "commit"}, {"oid": "2f927f0fac150f822d5e9bd219db3284b99373ed", "url": "https://github.com/apache/dolphinscheduler/commit/2f927f0fac150f822d5e9bd219db3284b99373ed", "message": "update.", "committedDate": "2020-08-25T03:10:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzMyMTE4NQ==", "url": "https://github.com/apache/dolphinscheduler/pull/3582#discussion_r477321185", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    List<ProcessInstance> processInstances =  processInstanceMapper.queryByProcessDefineIdAndStatus(processDefinitionId, Constants.NOT_TERMINATED_STATES);\n          \n          \n            \n                    if (CollectionUtils.isNotEmpty(processInstances)) {\n          \n          \n            \n                        putMsg(result, Status.DELETE_PROCESS_DEFINITION_BY_ID_FAIL,processInstances.size());\n          \n          \n            \n                        return result;\n          \n          \n            \n                    }\n          \n          \n            \n                    List<ProcessInstance> processInstances =  processInstanceService.queryByProcessDefineIdAndStatus(processDefinitionId, Constants.NOT_TERMINATED_STATES);\n          \n          \n            \n                    if (CollectionUtils.isNotEmpty(processInstances)) {\n          \n          \n            \n                        putMsg(result, Status.DELETE_PROCESS_DEFINITION_BY_ID_FAIL,processInstances.size());\n          \n          \n            \n                        return result;\n          \n          \n            \n                    }\n          \n      \n    \n    \n  \n\nHi,\nIn processDefinitionService service layer, it is not recommended straightly use processInstanceMapper dao layer, this part should be in processInstanceService, use processInstanceService here.", "author": "yangyichao-mango", "createdAt": "2020-08-26T13:56:42Z", "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/impl/ProcessDefinitionServiceImpl.java", "diffHunk": "@@ -488,6 +488,12 @@ private String getResourceIds(ProcessData processData) {\n             putMsg(result, Status.PROCESS_DEFINE_STATE_ONLINE, processDefinitionId);\n             return result;\n         }\n+        // check process instances is already running\n+        List<ProcessInstance> processInstances =  processInstanceMapper.queryByProcessDefineIdAndStatus(processDefinitionId, Constants.NOT_TERMINATED_STATES);\n+        if (CollectionUtils.isNotEmpty(processInstances)) {\n+            putMsg(result, Status.DELETE_PROCESS_DEFINITION_BY_ID_FAIL,processInstances.size());\n+            return result;\n+        }", "originalCommit": "2f927f0fac150f822d5e9bd219db3284b99373ed", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODIzNDYxMw==", "url": "https://github.com/apache/dolphinscheduler/pull/3582#discussion_r478234613", "bodyText": "Processinstanceservice has been used. Processinstanceservice should implement the interface. There are contributors who have submitted branches. I have not changed this.\n\n\u5df2\u4f7f\u7528processInstanceService \uff0cprocessInstanceService \u5e94\u8be5\u5b9e\u73b0\u63a5\u53e3\uff0c\u5df2\u7ecf\u6709\u8d21\u732e\u8005\u63d0\u4ea4\u5206\u652f\uff0c\u8fd9\u5757\u6211\u6ca1\u6709\u6539.", "author": "zhuangchong", "createdAt": "2020-08-27T08:07:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzMyMTE4NQ=="}], "type": "inlineReview"}, {"oid": "2d73b9ab248dcc53f230225b39f6a6961f4c0f50", "url": "https://github.com/apache/dolphinscheduler/commit/2d73b9ab248dcc53f230225b39f6a6961f4c0f50", "message": "processinstancemapper replaces processinstanceservice.", "committedDate": "2020-08-27T07:20:51Z", "type": "commit"}, {"oid": "772c7f2eec59a8c25286703e3f3da5d33f096f81", "url": "https://github.com/apache/dolphinscheduler/commit/772c7f2eec59a8c25286703e3f3da5d33f096f81", "message": "processinstancemapper replaces processinstanceservice.", "committedDate": "2020-08-27T07:48:04Z", "type": "commit"}]}