{"pr_number": 2073, "pr_title": "HADOOP-16998 WASB : NativeAzureFsOutputStream#close() throwing java.l\u2026", "pr_createdAt": "2020-06-13T17:50:40Z", "pr_url": "https://github.com/apache/hadoop/pull/2073", "timeline": [{"oid": "717c8702bf7090f119c82be1b0461a6dd8a70382", "url": "https://github.com/apache/hadoop/commit/717c8702bf7090f119c82be1b0461a6dd8a70382", "message": "HADOOP-16998 WASB : NativeAzureFsOutputStream#close() throwing java.lang.IllegalArgumentException instead of IOE which causes HBase RS to get aborted.", "committedDate": "2020-06-13T17:49:38Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTU1OTgyNg==", "url": "https://github.com/apache/hadoop/pull/2073#discussion_r441559826", "bodyText": "put in an import block just above the org.apache one. I know a lot of classes don't do that -but that is because the move from o.a.commons.logging to SLF4J was done with 'sed'", "author": "steveloughran", "createdAt": "2020-06-17T13:49:31Z", "path": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azure/SyncableDataOutputStream.java", "diffHunk": "@@ -24,6 +24,8 @@\n \n import org.apache.hadoop.fs.StreamCapabilities;\n import org.apache.hadoop.fs.Syncable;\n+import org.slf4j.Logger;", "originalCommit": "717c8702bf7090f119c82be1b0461a6dd8a70382", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE4NDA5OA==", "url": "https://github.com/apache/hadoop/pull/2073#discussion_r443184098", "bodyText": "Done.\norg.apache.hadoop.classification.InterfaceAudience was wrongly placed.  Corrected it now.", "author": "anoopsjohn", "createdAt": "2020-06-21T05:42:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTU1OTgyNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzU0MDgxNg==", "url": "https://github.com/apache/hadoop/pull/2073#discussion_r443540816", "bodyText": "sorry, i meant \"org.slf4j to go into a block above the org.apache one\", below the java. one...its where we like  keep the non-apache, non-static imports", "author": "steveloughran", "createdAt": "2020-06-22T13:01:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTU1OTgyNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTU2MDM2MA==", "url": "https://github.com/apache/hadoop/pull/2073#discussion_r441560360", "bodyText": "at bottom of imports, please", "author": "steveloughran", "createdAt": "2020-06-17T13:50:13Z", "path": "hadoop-tools/hadoop-azure/src/test/java/org/apache/hadoop/fs/azure/TestSyncableDataOutputStream.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.hadoop.fs.azure;\n+\n+import static org.junit.Assert.fail;", "originalCommit": "717c8702bf7090f119c82be1b0461a6dd8a70382", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTU2MDU2MA==", "url": "https://github.com/apache/hadoop/pull/2073#discussion_r441560560", "bodyText": "use LambdaTestUtils.intercept", "author": "steveloughran", "createdAt": "2020-06-17T13:50:32Z", "path": "hadoop-tools/hadoop-azure/src/test/java/org/apache/hadoop/fs/azure/TestSyncableDataOutputStream.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.hadoop.fs.azure;\n+\n+import static org.junit.Assert.fail;\n+\n+import java.io.IOException;\n+import java.io.OutputStream;\n+\n+import org.junit.Test;\n+\n+public class TestSyncableDataOutputStream {\n+\n+  @Test\n+  public void testCloseWhenFlushThrowingIOException() throws Exception {\n+    MockOutputStream out = new MockOutputStream();\n+    SyncableDataOutputStream sdos = new SyncableDataOutputStream(out);\n+    out.flushThrowIOE = true;\n+    try {", "originalCommit": "717c8702bf7090f119c82be1b0461a6dd8a70382", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE4NDIwNw==", "url": "https://github.com/apache/hadoop/pull/2073#discussion_r443184207", "bodyText": "Done.  Also added try with resource statement also in the test using LambdaTestUtils.", "author": "anoopsjohn", "createdAt": "2020-06-21T05:44:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTU2MDU2MA=="}], "type": "inlineReview"}, {"oid": "b0218799109f8a1ed6b1577e6b26b2896206fca3", "url": "https://github.com/apache/hadoop/commit/b0218799109f8a1ed6b1577e6b26b2896206fca3", "message": "HADOOP-16998 WASB : NativeAzureFsOutputStream#close() throwing java.lang.IllegalArgumentException instead of IOE which causes HBase RS to get aborted.", "committedDate": "2020-06-21T05:40:47Z", "type": "commit"}, {"oid": "570eca11f1e907be186364247a7bcee6ab7ed46f", "url": "https://github.com/apache/hadoop/commit/570eca11f1e907be186364247a7bcee6ab7ed46f", "message": "HADOOP-16998 WASB : NativeAzureFsOutputStream#close() throwing java.lang.IllegalArgumentException instead of IOE which causes HBase RS to get aborted.", "committedDate": "2020-06-21T12:18:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzU0MTU0Mw==", "url": "https://github.com/apache/hadoop/pull/2073#discussion_r443541543", "bodyText": "again, org.junit to a (new) \"non org.apache imports' block", "author": "steveloughran", "createdAt": "2020-06-22T13:02:42Z", "path": "hadoop-tools/hadoop-azure/src/test/java/org/apache/hadoop/fs/azure/TestSyncableDataOutputStream.java", "diffHunk": "@@ -0,0 +1,67 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.hadoop.fs.azure;\n+\n+import java.io.IOException;\n+import java.io.OutputStream;\n+\n+import org.apache.hadoop.test.LambdaTestUtils;\n+import org.junit.Test;", "originalCommit": "570eca11f1e907be186364247a7bcee6ab7ed46f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzY2MzAxNg==", "url": "https://github.com/apache/hadoop/pull/2073#discussion_r443663016", "bodyText": "Thanks Steve for explaining..\nSorry I did the organize import at eclipse level and just used the same import formatter what using for hbase.\nDid the 2 import order changes as u suggested and pushed.", "author": "anoopsjohn", "createdAt": "2020-06-22T15:57:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzU0MTU0Mw=="}], "type": "inlineReview"}, {"oid": "fa29d02edcfb4db83956294825474ab5ae1d7aa8", "url": "https://github.com/apache/hadoop/commit/fa29d02edcfb4db83956294825474ab5ae1d7aa8", "message": "HADOOP-16998 WASB : NativeAzureFsOutputStream#close() throwing java.lang.IllegalArgumentException instead of IOE which causes HBase RS to get aborted.", "committedDate": "2020-06-22T15:51:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDIyNDk0NQ==", "url": "https://github.com/apache/hadoop/pull/2073#discussion_r444224945", "bodyText": "we are getting so close here. Now move this up to L28.", "author": "steveloughran", "createdAt": "2020-06-23T13:30:48Z", "path": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azure/SyncableDataOutputStream.java", "diffHunk": "@@ -22,12 +22,13 @@\n import java.io.IOException;\n import java.io.OutputStream;\n \n-import org.apache.hadoop.classification.InterfaceAudience;\n-import org.apache.hadoop.fs.StreamCapabilities;\n-import org.apache.hadoop.fs.Syncable;\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n \n+import org.apache.hadoop.fs.StreamCapabilities;\n+import org.apache.hadoop.fs.Syncable;\n+import org.apache.hadoop.classification.InterfaceAudience;", "originalCommit": "fa29d02edcfb4db83956294825474ab5ae1d7aa8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDM2NzMyMw==", "url": "https://github.com/apache/hadoop/pull/2073#discussion_r444367323", "bodyText": "You mean move to L27 so that org.slf4j and org.apche are single block?", "author": "anoopsjohn", "createdAt": "2020-06-23T16:50:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDIyNDk0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ4NjA5NQ==", "url": "https://github.com/apache/hadoop/pull/2073#discussion_r446486095", "bodyText": "sorry Steve am not getting fully.\nSo you say move this entire org.apache block to L27 (So that new new line between org.slf4j and org.apache block)\nOr u want to move import org.apache.hadoop.classification.InterfaceAudience; (In L30) to L28 so that within org.apache block things are properly imported in order and still keep this org.apache and org.slf as 2 blocks.", "author": "anoopsjohn", "createdAt": "2020-06-27T05:07:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDIyNDk0NQ=="}], "type": "inlineReview"}, {"oid": "d72aa7e3e51b656c372c77476551c33ac72c83d3", "url": "https://github.com/apache/hadoop/commit/d72aa7e3e51b656c372c77476551c33ac72c83d3", "message": "HADOOP-16998 WASB : NativeAzureFsOutputStream#close() throwing java.lang.IllegalArgumentException instead of IOE which causes HBase RS to get aborted.", "committedDate": "2020-07-07T05:20:27Z", "type": "commit"}, {"oid": "e0a8551a17dd552b46230a128bcd84eae6b00f7f", "url": "https://github.com/apache/hadoop/commit/e0a8551a17dd552b46230a128bcd84eae6b00f7f", "message": "Update TestSyncableDataOutputStream.java\n\nswapped the final two import blocks", "committedDate": "2020-07-14T13:04:32Z", "type": "commit"}]}