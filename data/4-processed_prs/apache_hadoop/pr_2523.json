{"pr_number": 2523, "pr_title": "HDFS-15712. Upgrade googletest to 1.10.0", "pr_createdAt": "2020-12-05T16:41:38Z", "pr_url": "https://github.com/apache/hadoop/pull/2523", "timeline": [{"oid": "9efbc0ef172e1071f1a9a66ee03194f77d602751", "url": "https://github.com/apache/hadoop/commit/9efbc0ef172e1071f1a9a66ee03194f77d602751", "message": "HDFS-15712. Upgrade googletest to 1.10.0\n\n* Upgrading the googletest library to\n  1.10.0.\n* Removing the older, checked-in gmock\n  from third_party.", "committedDate": "2020-12-05T16:37:25Z", "type": "commit"}, {"oid": "5f701bc0e77ec3f20a507153e0ea05a6144b4cd8", "url": "https://github.com/apache/hadoop/commit/5f701bc0e77ec3f20a507153e0ea05a6144b4cd8", "message": "Add Apache license\n\n* Added Apache license for\n  CMakeLists-gtest.txt.in.", "committedDate": "2020-12-06T03:31:41Z", "type": "commit"}, {"oid": "5f701bc0e77ec3f20a507153e0ea05a6144b4cd8", "url": "https://github.com/apache/hadoop/commit/5f701bc0e77ec3f20a507153e0ea05a6144b4cd8", "message": "Add Apache license\n\n* Added Apache license for\n  CMakeLists-gtest.txt.in.", "committedDate": "2020-12-06T03:31:41Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzI3NTEwNw==", "url": "https://github.com/apache/hadoop/pull/2523#discussion_r537275107", "bodyText": "In Apache Hadoop, the CMake version is >= 3.1. Therefore the code can be removed.\nhttps://issues.apache.org/jira/browse/HADOOP-14670", "author": "aajisaka", "createdAt": "2020-12-07T07:08:12Z", "path": "hadoop-hdfs-project/hadoop-hdfs-native-client/src/main/native/libhdfspp/CMakeLists.txt", "diffHunk": "@@ -51,6 +54,38 @@ find_package(Threads)\n \n include(CheckCXXSourceCompiles)\n \n+# Download and build gtest\n+configure_file(CMakeLists-gtest.txt.in googletest-download/CMakeLists.txt)\n+execute_process(COMMAND ${CMAKE_COMMAND} -G \"${CMAKE_GENERATOR}\" .\n+  RESULT_VARIABLE result\n+  WORKING_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR}/googletest-download)\n+if(result)\n+  message(FATAL_ERROR \"CMake step for googletest failed: ${result}\")\n+endif()\n+execute_process(COMMAND ${CMAKE_COMMAND} --build .\n+  RESULT_VARIABLE result\n+  WORKING_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR}/googletest-download)\n+if(result)\n+  message(FATAL_ERROR \"Build step for googletest failed: ${result}\")\n+endif()\n+\n+# Prevent overriding the parent project's compiler/linker\n+# settings on Windows\n+set(gtest_force_shared_crt ON CACHE BOOL \"\" FORCE)\n+\n+# Add googletest directly to our build. This defines\n+# the gtest and gtest_main targets.\n+add_subdirectory(${CMAKE_CURRENT_BINARY_DIR}/googletest-src\n+                 ${CMAKE_CURRENT_BINARY_DIR}/googletest-build\n+                 EXCLUDE_FROM_ALL)\n+\n+# The gtest/gtest_main targets carry header search path\n+# dependencies automatically when using CMake 2.8.11 or\n+# later. Otherwise we have to add them here ourselves.\n+if (CMAKE_VERSION VERSION_LESS 2.8.11)\n+  include_directories(\"${gtest_SOURCE_DIR}/include\" \"${gmock_SOURCE_DIR}/include\")\n+endif()", "originalCommit": "5f701bc0e77ec3f20a507153e0ea05a6144b4cd8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzI5NTQ2Mw==", "url": "https://github.com/apache/hadoop/pull/2523#discussion_r537295463", "bodyText": "Done. Thanks.", "author": "GauthamBanasandra", "createdAt": "2020-12-07T07:52:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzI3NTEwNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzI3NTI4NQ==", "url": "https://github.com/apache/hadoop/pull/2523#discussion_r537275285", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            cmake_minimum_required(VERSION 2.8.2)\n          \n          \n            \n            cmake_minimum_required(VERSION 3.1 FATAL_ERROR)", "author": "aajisaka", "createdAt": "2020-12-07T07:08:43Z", "path": "hadoop-hdfs-project/hadoop-hdfs-native-client/src/main/native/libhdfspp/CMakeLists-gtest.txt.in", "diffHunk": "@@ -16,6 +19,18 @@\n # limitations under the License.\n #\n \n-set(CMAKE_CXX_FLAGS \"${CMAKE_CXX_FLAGS} -Wno-missing-field-initializers -Wno-unused-const-variable\")\n-add_library(gmock_main_obj OBJECT gmock-gtest-all.cc gmock_main.cc)\n-add_library(gmock_main $<TARGET_OBJECTS:gmock_main_obj>)\n+cmake_minimum_required(VERSION 2.8.2)", "originalCommit": "5f701bc0e77ec3f20a507153e0ea05a6144b4cd8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "99e6e7d261a05de86903022e231c15b2f91eb8da", "url": "https://github.com/apache/hadoop/commit/99e6e7d261a05de86903022e231c15b2f91eb8da", "message": "Upgrade CMake version for gtest\r\n\r\n* Upgrading the CMake minimum\r\n   required version to 3.1 as that's\r\n   what's Hadoop's using.\n\nCo-authored-by: Akira Ajisaka <aajisaka@apache.org>", "committedDate": "2020-12-07T07:45:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzI5MjIzNQ==", "url": "https://github.com/apache/hadoop/pull/2523#discussion_r537292235", "bodyText": "We don't have to add the header here because the header is already included in ./licenses/LICENSE-gtest.txt and ./licenses-binary/LICENSE-gtest.txt.", "author": "aajisaka", "createdAt": "2020-12-07T07:46:15Z", "path": "hadoop-hdfs-project/hadoop-hdfs-native-client/src/main/native/libhdfspp/CMakeLists-gtest.txt.in", "diffHunk": "@@ -1,3 +1,6 @@\n+# Copyright 2008, Google Inc.\n+# All rights reserved.\n+", "originalCommit": "5f701bc0e77ec3f20a507153e0ea05a6144b4cd8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzI5NTU4Nw==", "url": "https://github.com/apache/hadoop/pull/2523#discussion_r537295587", "bodyText": "Done. Thanks.", "author": "GauthamBanasandra", "createdAt": "2020-12-07T07:52:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzI5MjIzNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzI5MjQyMw==", "url": "https://github.com/apache/hadoop/pull/2523#discussion_r537292423", "bodyText": "Can be removed.", "author": "aajisaka", "createdAt": "2020-12-07T07:46:35Z", "path": "hadoop-hdfs-project/hadoop-hdfs-native-client/src/main/native/libhdfspp/CMakeLists.txt", "diffHunk": "@@ -1,3 +1,6 @@\n+# Copyright 2008, Google Inc.\n+# All rights reserved.\n+", "originalCommit": "5f701bc0e77ec3f20a507153e0ea05a6144b4cd8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzI5NTY2MA==", "url": "https://github.com/apache/hadoop/pull/2523#discussion_r537295660", "bodyText": "Done. Thanks.", "author": "GauthamBanasandra", "createdAt": "2020-12-07T07:53:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzI5MjQyMw=="}], "type": "inlineReview"}, {"oid": "73d70b63e12f922e2c42eae76ece9b3823391aee", "url": "https://github.com/apache/hadoop/commit/73d70b63e12f922e2c42eae76ece9b3823391aee", "message": "Remove redundant license headers\n\n* Removing the redundant headers\n  for license as they've already\n  been attributed in\n  ./licenses/LICENSE-gtest.txt\n  and\n  ./licenses-binary/LICENSE-gtest.txt.", "committedDate": "2020-12-07T07:48:21Z", "type": "commit"}, {"oid": "3b45e0a9feca54c8b740b980a2d2d69a831de3f3", "url": "https://github.com/apache/hadoop/commit/3b45e0a9feca54c8b740b980a2d2d69a831de3f3", "message": "Do not handle CMake 2.8 limitations\n\n* Removing CMake 2.8 related\n  workarounds as Hadoop currently\n  uses CMake 3.1.", "committedDate": "2020-12-07T07:51:04Z", "type": "commit"}]}