{"pr_number": 2387, "pr_title": "HADOOP-17306. RawLocalFileSystem's lastModifiedTime() looses milli seconds in JDK < 10.b09", "pr_createdAt": "2020-10-15T06:47:36Z", "pr_url": "https://github.com/apache/hadoop/pull/2387", "timeline": [{"oid": "508a604144ac2b5511dfb82795567656c38846c7", "url": "https://github.com/apache/hadoop/commit/508a604144ac2b5511dfb82795567656c38846c7", "message": "HADOOP-17306. RawLocalFileSystem's lastModifiedTime() looses milli seconds in JDK < 10.b09", "committedDate": "2020-10-15T06:44:26Z", "type": "commit"}, {"oid": "af1d2cc5ff8c7c0d7171d40016df19d325f3cc1c", "url": "https://github.com/apache/hadoop/commit/af1d2cc5ff8c7c0d7171d40016df19d325f3cc1c", "message": "Exclude assertion for MAC", "committedDate": "2020-10-15T12:24:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzQ3MzQ1MA==", "url": "https://github.com/apache/hadoop/pull/2387#discussion_r507473450", "bodyText": "HFS+ does not support milliseconds for mtime, so I agreed to skip this in MacOS. In contrast, APFS supports nanoseconds and JDK-8177809 is fixed if the filesystem is APFS.\n\u279c  hadoop git:(trunk) uname -a\nDarwin <snip> 19.6.0 Darwin Kernel Version 19.6.0: Mon Aug 31 22:12:52 PDT 2020; root:xnu-6153.141.2~1/RELEASE_X86_64 x86_64\n\u279c  hadoop git:(trunk) jshell                                          \n|  Welcome to JShell -- Version 11.0.8\n|  For an introduction type: /help intro\n\njshell> Files.getLastModifiedTime(Paths.get(\"./pom.xml\"))\n$1 ==> 2020-10-19T04:51:58.69531Z\n\njshell> new File(\"./pom.xml\").lastModified()\n$1 ==> 1603083118695\n\nWould you update the comment like \"Skip MacOS because HFS+ does not support milliseconds for mtime.\" ?", "author": "aajisaka", "createdAt": "2020-10-19T05:25:19Z", "path": "hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/fs/TestRawLocalFileSystemContract.java", "diffHunk": "@@ -203,4 +203,27 @@ public void testPermission() throws Exception {\n     }\n   }\n \n+  @Test\n+  public void testMTimeAtime() throws IOException {\n+    RawLocalFileSystem.setUseDeprecatedFileStatus(true);\n+    try {\n+      Path testDir = getTestBaseDir();\n+      String testFilename = \"testmtime\";\n+      Path path = new Path(testDir, testFilename);\n+      Path file = new Path(path, \"file\");\n+      fs.create(file);\n+      long now = System.currentTimeMillis();\n+      long mtime = (now % 1000 == 0) ? now + 1 : now;\n+      long atime = (now % 1000 == 0) ? now + 2 : now;\n+      fs.setTimes(file, mtime, atime);\n+      FileStatus fileStatus = fs.getFileStatus(file);\n+      if (!Shell.MAC) {\n+        //HADOOP-17306 ; JDK-8177809 not fixed in MacOs\n+        assertEquals(mtime, fileStatus.getModificationTime());", "originalCommit": "af1d2cc5ff8c7c0d7171d40016df19d325f3cc1c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzQ3NTQ2OA==", "url": "https://github.com/apache/hadoop/pull/2387#discussion_r507475468", "bodyText": "Sure. Thanks for details @aajisaka", "author": "vinayakumarb", "createdAt": "2020-10-19T05:30:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzQ3MzQ1MA=="}], "type": "inlineReview"}, {"oid": "5d8c456f294edc5d6b22f05ad77f6f31215b9da8", "url": "https://github.com/apache/hadoop/commit/5d8c456f294edc5d6b22f05ad77f6f31215b9da8", "message": "Updated skip comment for MacOs", "committedDate": "2020-10-19T05:34:44Z", "type": "commit"}, {"oid": "4e558115fe0a4da56f9bb105eb78fc73baf644d2", "url": "https://github.com/apache/hadoop/commit/4e558115fe0a4da56f9bb105eb78fc73baf644d2", "message": "Checkstyle fix.", "committedDate": "2020-10-19T05:41:16Z", "type": "commit"}]}