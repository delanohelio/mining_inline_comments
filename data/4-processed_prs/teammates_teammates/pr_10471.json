{"pr_number": 10471, "pr_title": "[#10455] Add a redirect banner for users to switch versions", "pr_createdAt": "2020-07-27T03:09:12Z", "pr_url": "https://github.com/TEAMMATES/teammates/pull/10471", "timeline": [{"oid": "4e1f0170811889feca453ed75b61dd34df6ef2d1", "url": "https://github.com/TEAMMATES/teammates/commit/4e1f0170811889feca453ed75b61dd34df6ef2d1", "message": "Add redirect-banner.component.ts", "committedDate": "2020-07-27T03:06:01Z", "type": "commit"}, {"oid": "38f6f94d1187b5b3d4d2a78521073a267b587417", "url": "https://github.com/TEAMMATES/teammates/commit/38f6f94d1187b5b3d4d2a78521073a267b587417", "message": "Change info message and fix lint", "committedDate": "2020-07-27T04:39:40Z", "type": "commit"}, {"oid": "c9d63b4fe5159d49a80fc3ce0ec69c5c5fd42cab", "url": "https://github.com/TEAMMATES/teammates/commit/c9d63b4fe5159d49a80fc3ce0ec69c5c5fd42cab", "message": "Merge branch 'master' into 10455-redirect\n\n# Conflicts:\n#\tsrc/web/app/pages-instructor/instructor-home-page/instructor-home-page.module.ts", "committedDate": "2020-07-28T02:46:55Z", "type": "commit"}, {"oid": "d0d25807a87b31c4401edadaca316579455c6b68", "url": "https://github.com/TEAMMATES/teammates/commit/d0d25807a87b31c4401edadaca316579455c6b68", "message": "Add support email and change banner message", "committedDate": "2020-07-28T07:29:23Z", "type": "commit"}, {"oid": "d0d25807a87b31c4401edadaca316579455c6b68", "url": "https://github.com/TEAMMATES/teammates/commit/d0d25807a87b31c4401edadaca316579455c6b68", "message": "Add support email and change banner message", "committedDate": "2020-07-28T07:29:23Z", "type": "forcePushed"}, {"oid": "fa4f509df1f7633443cc0739bfdf0ca911f584be", "url": "https://github.com/TEAMMATES/teammates/commit/fa4f509df1f7633443cc0739bfdf0ca911f584be", "message": "Update snapshot with config points set to null", "committedDate": "2020-07-28T07:34:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTQ2NTYwOA==", "url": "https://github.com/TEAMMATES/teammates/pull/10471#discussion_r461465608", "bodyText": "Don't need this. It is reasonable to assume that environment.supportEmail will always be set.", "author": "wkurniawan07", "createdAt": "2020-07-28T10:00:44Z", "path": "src/web/app/components/redirect-banner/redirect-banner.component.ts", "diffHunk": "@@ -0,0 +1,26 @@\n+import { Component } from '@angular/core';\n+import { DomSanitizer, SafeResourceUrl } from '@angular/platform-browser';\n+import { environment } from '../../../environments/environment';\n+\n+/**\n+ * Version redirect banner.\n+ */\n+@Component({\n+  selector: 'tm-redirect-banner',\n+  templateUrl: './redirect-banner.component.html',\n+  styleUrls: ['./redirect-banner.component.scss'],\n+})\n+export class RedirectBannerComponent {\n+\n+  redirectUrl: SafeResourceUrl | null;\n+  supportEmail: SafeResourceUrl | null;\n+\n+  constructor(private sanitizer: DomSanitizer) {\n+    this.redirectUrl = environment.redirectUrl\n+        ? this.sanitizer.bypassSecurityTrustResourceUrl(environment.redirectUrl)\n+        : null;\n+    this.supportEmail = environment.supportEmail", "originalCommit": "fa4f509df1f7633443cc0739bfdf0ca911f584be", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTQ2NTk1MQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10471#discussion_r461465951", "bodyText": "A config point should not be dependent of this kind of specific component name.", "author": "wkurniawan07", "createdAt": "2020-07-28T10:01:26Z", "path": "src/web/environments/config.template.ts", "diffHunk": "@@ -23,4 +23,9 @@ export const config: any = {\n    * e.g. \"6LeIxAcTAAAAAJcZVRqyHh71UMIEGNQ_MXjiZKhI\" is a site key for test environments.\n    */\n   captchaSiteKey: '',\n+\n+  /**\n+   * This is the URL address that will show in the {@link RedirectBannerComponent}.", "originalCommit": "fa4f509df1f7633443cc0739bfdf0ca911f584be", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "847fbe84c1db0f0df57eba2a52107ea91b30bf5e", "url": "https://github.com/TEAMMATES/teammates/commit/847fbe84c1db0f0df57eba2a52107ea91b30bf5e", "message": "Change comment description and support email assignment", "committedDate": "2020-07-28T15:23:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTc5NzE1NA==", "url": "https://github.com/TEAMMATES/teammates/pull/10471#discussion_r461797154", "bodyText": "Why not just make supportEmail a string and put mailto into the HTML template? That way you don't need this entire line. There are plenty of examples of this kind of code throughout.", "author": "wkurniawan07", "createdAt": "2020-07-28T18:48:06Z", "path": "src/web/app/components/redirect-banner/redirect-banner.component.ts", "diffHunk": "@@ -0,0 +1,24 @@\n+import { Component } from '@angular/core';\n+import { DomSanitizer, SafeResourceUrl } from '@angular/platform-browser';\n+import { environment } from '../../../environments/environment';\n+\n+/**\n+ * Version redirect banner.\n+ */\n+@Component({\n+  selector: 'tm-redirect-banner',\n+  templateUrl: './redirect-banner.component.html',\n+  styleUrls: ['./redirect-banner.component.scss'],\n+})\n+export class RedirectBannerComponent {\n+\n+  redirectUrl: SafeResourceUrl | null;\n+  supportEmail: SafeResourceUrl | null;\n+\n+  constructor(private sanitizer: DomSanitizer) {\n+    this.redirectUrl = environment.redirectUrl\n+        ? this.sanitizer.bypassSecurityTrustResourceUrl(environment.redirectUrl)\n+        : null;\n+    this.supportEmail = this.sanitizer.bypassSecurityTrustResourceUrl(`mailto:${environment.supportEmail}`);", "originalCommit": "847fbe84c1db0f0df57eba2a52107ea91b30bf5e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTc5NzUyOA==", "url": "https://github.com/TEAMMATES/teammates/pull/10471#discussion_r461797528", "bodyText": "Actually why do we even need this bypassSecurityTrustResourceUrl?", "author": "wkurniawan07", "createdAt": "2020-07-28T18:48:48Z", "path": "src/web/app/components/redirect-banner/redirect-banner.component.ts", "diffHunk": "@@ -0,0 +1,24 @@\n+import { Component } from '@angular/core';\n+import { DomSanitizer, SafeResourceUrl } from '@angular/platform-browser';\n+import { environment } from '../../../environments/environment';\n+\n+/**\n+ * Version redirect banner.\n+ */\n+@Component({\n+  selector: 'tm-redirect-banner',\n+  templateUrl: './redirect-banner.component.html',\n+  styleUrls: ['./redirect-banner.component.scss'],\n+})\n+export class RedirectBannerComponent {\n+\n+  redirectUrl: SafeResourceUrl | null;\n+  supportEmail: SafeResourceUrl | null;\n+\n+  constructor(private sanitizer: DomSanitizer) {\n+    this.redirectUrl = environment.redirectUrl\n+        ? this.sanitizer.bypassSecurityTrustResourceUrl(environment.redirectUrl)", "originalCommit": "847fbe84c1db0f0df57eba2a52107ea91b30bf5e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjExODU2MA==", "url": "https://github.com/TEAMMATES/teammates/pull/10471#discussion_r462118560", "bodyText": "I have no idea either. I'm just following the example of the accountRequestFormUrl\n\n  \n    \n      teammates/src/web/app/pages-static/request-page/request-page.component.ts\n    \n    \n        Lines 18 to 20\n      in\n      e2eb385\n    \n    \n    \n    \n\n        \n          \n           this.accountRequestFormUrl = environment.accountRequestFormUrl \n        \n\n        \n          \n               ? this.sanitizer.bypassSecurityTrustResourceUrl(environment.accountRequestFormUrl) \n        \n\n        \n          \n               : null; \n        \n    \n  \n\n\nI really don't think it's necessary since we're not producing javascript (See: https://angular.io/api/platform-browser/DomSanitizer) but figured it was better to be consistent.", "author": "madanalogy", "createdAt": "2020-07-29T08:11:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTc5NzUyOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjEyNTg3NA==", "url": "https://github.com/TEAMMATES/teammates/pull/10471#discussion_r462125874", "bodyText": "That URL is used to load an iframe, so it's a legitimate security concern if not bypassed. It's not the case here.", "author": "wkurniawan07", "createdAt": "2020-07-29T08:23:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTc5NzUyOA=="}], "type": "inlineReview"}, {"oid": "f0761bfcae902366798c8530d0668683e7d8b531", "url": "https://github.com/TEAMMATES/teammates/commit/f0761bfcae902366798c8530d0668683e7d8b531", "message": "Change supportEmail to be string", "committedDate": "2020-07-29T08:17:14Z", "type": "commit"}, {"oid": "ff0817dcacf27a083640edabe7595d196409e3ac", "url": "https://github.com/TEAMMATES/teammates/commit/ff0817dcacf27a083640edabe7595d196409e3ac", "message": "Change redirectUrl to be string", "committedDate": "2020-07-29T08:27:11Z", "type": "commit"}, {"oid": "776ff0e53b1cfa9d9792f6e140e490c64d669d0e", "url": "https://github.com/TEAMMATES/teammates/commit/776ff0e53b1cfa9d9792f6e140e490c64d669d0e", "message": "Merge branch 'master' into 10455-redirect", "committedDate": "2020-07-29T13:38:18Z", "type": "commit"}]}