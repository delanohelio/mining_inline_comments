{"pr_number": 10266, "pr_title": "[#10263] Clean up endpoint access control", "pr_createdAt": "2020-06-30T12:53:06Z", "pr_url": "https://github.com/TEAMMATES/teammates/pull/10266", "timeline": [{"oid": "d44add20486f2fcfa2a4031e42aaef3c6b376060", "url": "https://github.com/TEAMMATES/teammates/commit/d44add20486f2fcfa2a4031e42aaef3c6b376060", "message": "Clean up endpoint access control", "committedDate": "2020-06-30T12:50:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODA5OTcwNg==", "url": "https://github.com/TEAMMATES/teammates/pull/10266#discussion_r448099706", "bodyText": "\ud83d\udc4d", "author": "xpdavid", "createdAt": "2020-07-01T03:50:05Z", "path": "src/main/java/teammates/ui/webapi/action/DeleteStudentAction.java", "diffHunk": "@@ -23,14 +23,14 @@ public void checkSpecificAccessControl() {\n             return;\n         }\n \n-        if (userInfo.isInstructor) {\n-            String courseId = getNonNullRequestParamValue(Const.ParamsNames.COURSE_ID);\n-            InstructorAttributes instructor = logic.getInstructorForGoogleId(courseId, userInfo.id);\n-            gateKeeper.verifyAccessible(\n-                    instructor, logic.getCourse(courseId), Const.ParamsNames.INSTRUCTOR_PERMISSION_MODIFY_STUDENT);\n-            return;\n+        if (!userInfo.isInstructor) {", "originalCommit": "d44add20486f2fcfa2a4031e42aaef3c6b376060", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODEwMDA4Mw==", "url": "https://github.com/TEAMMATES/teammates/pull/10266#discussion_r448100083", "bodyText": "Although admin is allowed here, it is actually meaningless as the execute() process need the corresponding instructor info.", "author": "xpdavid", "createdAt": "2020-07-01T03:51:54Z", "path": "src/main/java/teammates/ui/webapi/action/SearchCommentsAction.java", "diffHunk": "@@ -20,8 +20,8 @@ protected AuthType getMinAuthLevel() {\n \n     @Override\n     public void checkSpecificAccessControl() {\n-        // Only instructors can search for comments\n-        if (!userInfo.isInstructor) {\n+        // Only instructors and admins can search for comments\n+        if (!userInfo.isInstructor && !userInfo.isAdmin) {", "originalCommit": "d44add20486f2fcfa2a4031e42aaef3c6b376060", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODEwMDczMg==", "url": "https://github.com/TEAMMATES/teammates/pull/10266#discussion_r448100732", "bodyText": "I just wanted to be consistent with student search actually since they\u2019re both accessed from the same page. Any issues if I change both to instructor only?", "author": "madanalogy", "createdAt": "2020-07-01T03:55:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODEwMDA4Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODEwMTAwMQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10266#discussion_r448101001", "bodyText": "Up to you. Just pass down the information to you. \ud83d\udc4d", "author": "xpdavid", "createdAt": "2020-07-01T03:56:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODEwMDA4Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODEwNTYxNg==", "url": "https://github.com/TEAMMATES/teammates/pull/10266#discussion_r448105616", "bodyText": "Those are not the same:\n\nSearch students can be accessed through both instructor search page (instructor access) and admin search page (admin access). In fact, depending on where the API is accessed from, the result needs to be different. I put this as one of UAT round 2 issues.\nSearch comments is only accessible from instructor search page and thus is only for instructor access.", "author": "wkurniawan07", "createdAt": "2020-07-01T04:17:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODEwMDA4Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODE4ODUyNQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10266#discussion_r448188525", "bodyText": "Alright, I'll revert this to the previous instructor only access then and update the access control comment", "author": "madanalogy", "createdAt": "2020-07-01T08:04:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODEwMDA4Mw=="}], "type": "inlineReview"}, {"oid": "97121cd6b3b50c5586802cdbe1a488ae8b2209b2", "url": "https://github.com/TEAMMATES/teammates/commit/97121cd6b3b50c5586802cdbe1a488ae8b2209b2", "message": "Set search comments access to only instructors", "committedDate": "2020-07-01T08:06:59Z", "type": "commit"}, {"oid": "ae5c20bea8d90d64fc664978395b0d8ae9073f0a", "url": "https://github.com/TEAMMATES/teammates/commit/ae5c20bea8d90d64fc664978395b0d8ae9073f0a", "message": "Merge branch 'master' into 10263-endpoint", "committedDate": "2020-07-01T08:17:33Z", "type": "commit"}]}