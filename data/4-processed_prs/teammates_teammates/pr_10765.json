{"pr_number": 10765, "pr_title": "[#10678] Complete removal of respondingInstructorList and respondingStudentList in FeedbackSessionAttributes", "pr_createdAt": "2020-10-06T00:40:32Z", "pr_url": "https://github.com/TEAMMATES/teammates/pull/10765", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDEyMzM0MQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10765#discussion_r500123341", "bodyText": "\ud83d\udc4d this is a major bug in the testing infrastructure, but it seems to be a major widespread change if this is changed now. Let's revert this first and think about what to do to achieve this method's removal.", "author": "wkurniawan07", "createdAt": "2020-10-06T09:10:01Z", "path": "src/main/java/teammates/logic/core/DataBundleLogic.java", "diffHunk": "@@ -409,37 +311,10 @@ private void populateNullSection(StudentAttributes student) {\n         student.section = student.section == null ? \"None\" : student.section;\n     }\n \n-    private AccountAttributes makeAccount(InstructorAttributes instructor) {", "originalCommit": "8414b2d36c3af1dd18af9e327417c7f80f14a4c8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "0c0e721aa47e51917061c7c807e0663e5ee5d6e8", "url": "https://github.com/TEAMMATES/teammates/commit/0c0e721aa47e51917061c7c807e0663e5ee5d6e8", "message": "update unit tests", "committedDate": "2020-10-07T00:22:12Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDkyNTgxOA==", "url": "https://github.com/TEAMMATES/teammates/pull/10765#discussion_r500925818", "bodyText": "I think we need a distinction between \"completed\" and \"attempted\".", "author": "wkurniawan07", "createdAt": "2020-10-07T11:06:50Z", "path": "src/main/java/teammates/logic/api/Logic.java", "diffHunk": "@@ -719,13 +719,23 @@ public StudentAttributes joinCourseForStudent(String key, String googleId)\n         return studentsLogic.getUnregisteredStudentsForCourse(courseId);\n     }\n \n+    /**\n+     * Checks whether an instructor has completed a feedback session.", "originalCommit": "0c0e721aa47e51917061c7c807e0663e5ee5d6e8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "b296769c7531374276980a6cd5d72483d2c3d692", "url": "https://github.com/TEAMMATES/teammates/commit/b296769c7531374276980a6cd5d72483d2c3d692", "message": "update unit tests", "committedDate": "2020-10-09T00:58:18Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDIwMTQ2Mw==", "url": "https://github.com/TEAMMATES/teammates/pull/10765#discussion_r510201463", "bodyText": "Can this be extended to also check for student's team name? I don't think this was done before so this can be a future improvement.", "author": "wkurniawan07", "createdAt": "2020-10-22T14:20:15Z", "path": "src/main/java/teammates/logic/core/FeedbackSessionsLogic.java", "diffHunk": "@@ -228,8 +227,13 @@ public boolean isFeedbackSessionHasQuestionForStudents(\n         return !allQuestions.isEmpty();\n     }\n \n+    /**\n+     * Checks whether a student has completed a feedback session.\n+     *\n+     * <p> If there is no question for students, the feedback session is completed</p>\n+     */\n     public boolean isFeedbackSessionCompletedByStudent(FeedbackSessionAttributes fsa, String userEmail) {\n-        if (fsa.getRespondingStudentList().contains(userEmail)) {\n+        if (frLogic.hasGiverRespondedForSession(userEmail, fsa.getFeedbackSessionName(), fsa.getCourseId())) {", "originalCommit": "b296769c7531374276980a6cd5d72483d2c3d692", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTUxNzI1NA==", "url": "https://github.com/TEAMMATES/teammates/pull/10765#discussion_r511517254", "bodyText": "The function is able to check as we can set the team name to be userEmail.", "author": "xpdavid", "createdAt": "2020-10-24T21:40:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDIwMTQ2Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDIwMzM1Mw==", "url": "https://github.com/TEAMMATES/teammates/pull/10765#discussion_r510203353", "bodyText": "I think this is still a valid test though? Just that the last part should check for giver set instead of the removed field.", "author": "wkurniawan07", "createdAt": "2020-10-22T14:22:38Z", "path": "src/test/java/teammates/logic/core/FeedbackQuestionsLogicTest.java", "diffHunk": "@@ -601,35 +600,6 @@ public void testDeleteFeedbackQuestionCascade_nonExistentQuestion_shouldFailSile\n         assertNotNull(getQuestionFromDatastore(\"qn3InSession1InCourse1\"));\n     }\n \n-    @Test\n-    public void testDeleteFeedbackQuestionCascade_cascadeDeleteResponseOfStudent_shouldUpdateRespondents() throws Exception {", "originalCommit": "b296769c7531374276980a6cd5d72483d2c3d692", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzg5NTIyNg==", "url": "https://github.com/TEAMMATES/teammates/pull/10765#discussion_r513895226", "bodyText": "Yup. Added back.", "author": "xpdavid", "createdAt": "2020-10-29T02:43:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDIwMzM1Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDIwMzc1Nw==", "url": "https://github.com/TEAMMATES/teammates/pull/10765#discussion_r510203757", "bodyText": "I don't think this is necessary anymore. See if removing this line entirely affects anything.", "author": "wkurniawan07", "createdAt": "2020-10-22T14:23:08Z", "path": "src/test/java/teammates/ui/webapi/FeedbackSessionRemindEmailWorkerActionTest.java", "diffHunk": "@@ -47,7 +47,7 @@ public void testExecute() throws Exception {\n         FeedbackSessionAttributes session1 = typicalBundle.feedbackSessions.get(\"session1InCourse1\");\n         InstructorAttributes instructor1 = typicalBundle.instructors.get(\"instructor1OfCourse1\");\n \n-        // re-read from Datastore to update the respondents list\n+        // re-read from Datastore to get updated attributes\n         session1 = logic.getFeedbackSession(session1.getFeedbackSessionName(), session1.getCourseId());", "originalCommit": "b296769c7531374276980a6cd5d72483d2c3d692", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDIwNzExMg==", "url": "https://github.com/TEAMMATES/teammates/pull/10765#discussion_r510207112", "bodyText": "Similarly, this is still a valid test? Just need to change the assertion step.", "author": "wkurniawan07", "createdAt": "2020-10-22T14:27:21Z", "path": "src/test/java/teammates/logic/core/FeedbackResponsesLogicTest.java", "diffHunk": "@@ -836,103 +798,6 @@ public void testDeleteFeedbackResponsesInvolvedTeamOfCourseCascade_shouldDeleteR\n         assertTrue(frcLogic.getFeedbackResponseCommentForResponse(fra2GivenByTeam.getId()).isEmpty());\n     }\n \n-    @Test\n-    public void testDeleteFeedbackResponsesInvolvedTeamOfCourseCascade_shouldUpdateInstructorRespondentsCorrectly()", "originalCommit": "b296769c7531374276980a6cd5d72483d2c3d692", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzg5ODg0Nw==", "url": "https://github.com/TEAMMATES/teammates/pull/10765#discussion_r513898847", "bodyText": "Method deleteFeedbackResponsesInvolvedTeamOfCourseCascade, deleteFeedbackResponsesInvolvedStudentOfCourseCascade  and deleteFeedbackResponsesInvolvedInstructorOfCourseCascade  are combined to deleteFeedbackResponsesInvolvedEntityOfCourseCascade . Previously the main logic of them are the same except for respondent lists update.\nSo I just make sure we have all test case covered for deleteFeedbackResponsesInvolvedEntityOfCourseCascade", "author": "xpdavid", "createdAt": "2020-10-29T02:50:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDIwNzExMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDIwNzQ2Mw==", "url": "https://github.com/TEAMMATES/teammates/pull/10765#discussion_r510207463", "bodyText": "Similarly here", "author": "wkurniawan07", "createdAt": "2020-10-22T14:27:43Z", "path": "src/test/java/teammates/logic/core/FeedbackResponsesLogicTest.java", "diffHunk": "@@ -836,103 +798,6 @@ public void testDeleteFeedbackResponsesInvolvedTeamOfCourseCascade_shouldDeleteR\n         assertTrue(frcLogic.getFeedbackResponseCommentForResponse(fra2GivenByTeam.getId()).isEmpty());\n     }\n \n-    @Test\n-    public void testDeleteFeedbackResponsesInvolvedTeamOfCourseCascade_shouldUpdateInstructorRespondentsCorrectly()\n-            throws Exception {\n-        String teamName = \"Team 2.1\";\n-        FeedbackResponseAttributes fra = getResponseFromDatastore(\"response1ForQ1S1C2\");\n-        InstructorAttributes instructor1OfCourse2 = dataBundle.instructors.get(\"instructor1OfCourse2\");\n-        // giver is instructor\n-        assertEquals(FeedbackParticipantType.INSTRUCTORS,\n-                fqLogic.getFeedbackQuestion(fra.getFeedbackQuestionId()).getGiverType());\n-        assertEquals(fra.getGiver(), instructor1OfCourse2.getEmail());\n-        // team is the recipient\n-        assertEquals(fra.getRecipient(), teamName);\n-\n-        // this is the only response the giver has given for the session\n-        assertEquals(1, frLogic.getFeedbackResponsesFromGiverForCourse(fra.getCourseId(), fra.getGiver()).stream()\n-                .filter(response -> response.getFeedbackSessionName().equals(fra.getFeedbackSessionName()))\n-                .count());\n-        // suppose the instructor is in the respondent list\n-        fsLogic.addInstructorRespondent(fra.getGiver(), fra.getFeedbackSessionName(), fra.getCourseId());\n-        assertTrue(\n-                fsLogic.getFeedbackSession(fra.getFeedbackSessionName(), fra.getCourseId())\n-                        .getRespondingInstructorList().contains(fra.getGiver()));\n-\n-        Set<String> studentRespondentsBefore =\n-                fsLogic.getFeedbackSession(fra.getFeedbackSessionName(), fra.getCourseId()).getRespondingStudentList();\n-\n-        // after the team's responses are deleted\n-        frLogic.deleteFeedbackResponsesInvolvedTeamOfCourseCascade(instructor1OfCourse2.getCourseId(), teamName);\n-\n-        Set<String> studentRespondentsAfter =\n-                fsLogic.getFeedbackSession(fra.getFeedbackSessionName(), fra.getCourseId()).getRespondingStudentList();\n-        Set<String> instructorRespondentsAfter =\n-                fsLogic.getFeedbackSession(fra.getFeedbackSessionName(), fra.getCourseId()).getRespondingInstructorList();\n-        // student respondents not change\n-        assertEquals(studentRespondentsBefore, studentRespondentsAfter);\n-        // there is no instructor1OfCourse2 in instructor respondents\n-        assertFalse(instructorRespondentsAfter.contains(fra.getGiver()));\n-    }\n-\n-    @Test\n-    public void testDeleteFeedbackResponsesInvolvedInstructorOfCourseCascade_shouldDeleteRelevantResponses()", "originalCommit": "b296769c7531374276980a6cd5d72483d2c3d692", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "528ae3275e0991e88f8eee65166f2002fc1f5476", "url": "https://github.com/TEAMMATES/teammates/commit/528ae3275e0991e88f8eee65166f2002fc1f5476", "message": "remove respondents list from production code", "committedDate": "2020-10-29T02:38:46Z", "type": "commit"}, {"oid": "707afec2ae6f4b2164d56b03bf35f11840ae4777", "url": "https://github.com/TEAMMATES/teammates/commit/707afec2ae6f4b2164d56b03bf35f11840ae4777", "message": "update unit tests", "committedDate": "2020-10-29T02:53:54Z", "type": "commit"}, {"oid": "707afec2ae6f4b2164d56b03bf35f11840ae4777", "url": "https://github.com/TEAMMATES/teammates/commit/707afec2ae6f4b2164d56b03bf35f11840ae4777", "message": "update unit tests", "committedDate": "2020-10-29T02:53:54Z", "type": "forcePushed"}, {"oid": "9e85090bd920c0a7b343357e92a9afd69b608db7", "url": "https://github.com/TEAMMATES/teammates/commit/9e85090bd920c0a7b343357e92a9afd69b608db7", "message": "Merge branch 'master' into removal_respondents_list", "committedDate": "2020-10-31T13:30:12Z", "type": "commit"}]}