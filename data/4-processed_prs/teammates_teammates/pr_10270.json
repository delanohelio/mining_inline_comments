{"pr_number": 10270, "pr_title": "[#10245] Add send email feature for admin search", "pr_createdAt": "2020-07-01T10:26:50Z", "pr_url": "https://github.com/TEAMMATES/teammates/pull/10270", "timeline": [{"oid": "ecdfc394048fbbce1e22dfca41dfd6284833073a", "url": "https://github.com/TEAMMATES/teammates/commit/ecdfc394048fbbce1e22dfca41dfd6284833073a", "message": "Test fix", "committedDate": "2020-07-01T15:42:48Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQ3MzQ5NA==", "url": "https://github.com/TEAMMATES/teammates/pull/10270#discussion_r448473494", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    return AuthType.PUBLIC;\n          \n          \n            \n                    return AuthType.LOGGED_IN;", "author": "madanalogy", "createdAt": "2020-07-01T16:16:31Z", "path": "src/main/java/teammates/ui/webapi/action/GenerateEmailAction.java", "diffHunk": "@@ -0,0 +1,60 @@\n+package teammates.ui.webapi.action;\n+\n+import teammates.common.datatransfer.attributes.CourseAttributes;\n+import teammates.common.datatransfer.attributes.FeedbackSessionAttributes;\n+import teammates.common.datatransfer.attributes.StudentAttributes;\n+import teammates.common.exception.InvalidHttpParameterException;\n+import teammates.common.exception.UnauthorizedAccessException;\n+import teammates.common.util.Assumption;\n+import teammates.common.util.Const;\n+import teammates.common.util.EmailType;\n+import teammates.common.util.EmailWrapper;\n+import teammates.ui.webapi.output.GenerateEmailData;\n+\n+/**\n+ * Generate email content.\n+ */\n+public class GenerateEmailAction extends Action {\n+\n+    @Override\n+    protected AuthType getMinAuthLevel() {\n+        return AuthType.PUBLIC;", "originalCommit": "ecdfc394048fbbce1e22dfca41dfd6284833073a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQ3NTQxNg==", "url": "https://github.com/TEAMMATES/teammates/pull/10270#discussion_r448475416", "bodyText": "I'm thinking /email might be more appropriate. Worthwhile getting more input on this from senior devs.", "author": "madanalogy", "createdAt": "2020-07-01T16:19:45Z", "path": "src/main/java/teammates/common/util/Const.java", "diffHunk": "@@ -704,6 +706,7 @@ private Const() {\n         public static final String LOCAL_DATE_TIME = \"/localdatetime\";\n         public static final String SESSION_LINKS_RECOVERY = \"/sessionlinksrecovery\";\n         public static final String NATIONALITIES = \"/nationalities\";\n+        public static final String GENERATE_EMAIL = \"/generateemail\";", "originalCommit": "ecdfc394048fbbce1e22dfca41dfd6284833073a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODYxNTg1NA==", "url": "https://github.com/TEAMMATES/teammates/pull/10270#discussion_r448615854", "bodyText": "email is better. In REST, you are dealing with Resource not RPC.", "author": "xpdavid", "createdAt": "2020-07-01T21:05:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQ3NTQxNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODYxNDkyMw==", "url": "https://github.com/TEAMMATES/teammates/pull/10270#discussion_r448614923", "bodyText": "Is this the same as the method above? generateFeedbackSessionReminderEmails ?", "author": "xpdavid", "createdAt": "2020-07-01T21:03:25Z", "path": "src/main/java/teammates/logic/api/EmailGenerator.java", "diffHunk": "@@ -108,6 +108,21 @@\n         return emails;\n     }\n \n+    /**\n+     * Generates the feedback session reminder emails for the given {@code student}.\n+     */\n+    public EmailWrapper generateFeedbackSessionStudentReminderEmail(", "originalCommit": "ecdfc394048fbbce1e22dfca41dfd6284833073a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODcyNjU4Mg==", "url": "https://github.com/TEAMMATES/teammates/pull/10270#discussion_r448726582", "bodyText": "No. This is only for a particular student. The method above generates for all students and instructors.", "author": "ccyccyccy", "createdAt": "2020-07-02T03:22:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODYxNDkyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODcyNzY0Ng==", "url": "https://github.com/TEAMMATES/teammates/pull/10270#discussion_r448727646", "bodyText": "But the code is duplicated (almost the same?); By right, generateFeedbackSessionReminderEmails should be able to do generateFeedbackSessionReminderEmails can do.", "author": "xpdavid", "createdAt": "2020-07-02T03:27:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODYxNDkyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODczMDg0OQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10270#discussion_r448730849", "bodyText": "Yes generateFeedbackSessionReminderEmails can do what generateFeedbackSessionStudentReminderEmail does. But I didn't want to generate emails for everyone even though we only need one of them. Seems quite wasteful.\nI think it's more like generateFeedbackSessionReminderEmails can reuse generateFeedbackSessionStudentReminderEmail? I could refactor that.", "author": "ccyccyccy", "createdAt": "2020-07-02T03:41:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODYxNDkyMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODcyNzc3Ng==", "url": "https://github.com/TEAMMATES/teammates/pull/10270#discussion_r448727776", "bodyText": "Not sure if I can link STUDENT_COURSE_JOIN to the backend, without hardcoding it here. How do I get the enum EmailType to show up in the frontend? Do I add a new class to src/main/java/teammates/ui/webapi/request?", "author": "ccyccyccy", "createdAt": "2020-07-02T03:27:56Z", "path": "src/web/app/pages-admin/admin-search-page/admin-search-page.component.html", "diffHunk": "@@ -149,18 +149,22 @@\n                 </li>\n                 <li class=\"list-group-item list-group-item-info\">\n                   <strong>Course Join Link</strong>\n+                  <button type=\"button\" class=\"btn btn-primary margin-left-5px btn-sm\" (click)=\"openEmail(student.courseId, student.email, 'STUDENT_COURSE_JOIN')\">Send mail</button>", "originalCommit": "ecdfc394048fbbce1e22dfca41dfd6284833073a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODcyODkxOA==", "url": "https://github.com/TEAMMATES/teammates/pull/10270#discussion_r448728918", "bodyText": "You can add src/main/java/teammates/common/util/EmailType.java to the classPatterns of Gradle task generateApiRequestFormat", "author": "xpdavid", "createdAt": "2020-07-02T03:33:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODcyNzc3Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODczNDI4MA==", "url": "https://github.com/TEAMMATES/teammates/pull/10270#discussion_r448734280", "bodyText": "Wow thanks!", "author": "ccyccyccy", "createdAt": "2020-07-02T03:56:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODcyNzc3Ng=="}], "type": "inlineReview"}, {"oid": "0b1a7738b7ba88cce99dc350b23d8bffd13103ad", "url": "https://github.com/TEAMMATES/teammates/commit/0b1a7738b7ba88cce99dc350b23d8bffd13103ad", "message": "Rename generateemail endpoint to email", "committedDate": "2020-07-02T03:44:04Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTMyMzkzMA==", "url": "https://github.com/TEAMMATES/teammates/pull/10270#discussion_r449323930", "bodyText": "Instead of queryParams for the method parameter, why not just put all the individual courseId, studentEmail, etc. as the method parameters?", "author": "wkurniawan07", "createdAt": "2020-07-03T00:40:35Z", "path": "src/web/services/email-generation.service.ts", "diffHunk": "@@ -0,0 +1,31 @@\n+import { Injectable } from '@angular/core';\n+import { Observable } from 'rxjs';\n+import { ResourceEndpoints } from '../types/api-endpoints';\n+import { Email } from '../types/api-output';\n+import { HttpRequestService } from './http-request.service';\n+\n+/**\n+ * Handles email generation.\n+ */\n+@Injectable({\n+  providedIn: 'root',\n+})\n+export class EmailGenerationService {\n+\n+  constructor(private httpRequestService: HttpRequestService) { }\n+\n+  /**\n+   * Get email contents by calling API.\n+   */\n+  getEmail(queryParams: {\n+    courseId: string, studentemail: string, emailtype: string, fsname?: string,", "originalCommit": "3e30cf09b6a41ceb9cbc86de4934580c48a53a78", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTMyNTU4Mg==", "url": "https://github.com/TEAMMATES/teammates/pull/10270#discussion_r449325582", "bodyText": "Do we really need sessionLinkToSessionName function? There might be something already usable in openFs.", "author": "wkurniawan07", "createdAt": "2020-07-03T00:49:14Z", "path": "src/web/app/pages-admin/admin-search-page/admin-search-page.component.html", "diffHunk": "@@ -149,18 +149,22 @@\n                 </li>\n                 <li class=\"list-group-item list-group-item-info\">\n                   <strong>Course Join Link</strong>\n+                  <button type=\"button\" class=\"btn btn-primary margin-left-5px btn-sm\" (click)=\"openEmail(student.courseId, student.email, EmailType.STUDENT_COURSE_JOIN)\">Send mail</button>\n                   <input [value]=\"student.courseJoinLink\" readonly class=\"form-control\">\n                 </li>\n                 <li class=\"list-group-item list-group-item-warning\" *ngFor=\"let openFs of student.openSessions | keyvalue\">\n                   <strong>{{ openFs.key }}</strong>\n+                  <button type=\"button\" class=\"btn btn-primary margin-left-5px btn-sm\" (click)=\"openEmail(student.courseId, student.email, EmailType.FEEDBACK_SESSION_REMINDER, sessionLinkToSessionName(openFs.value))\">Send mail</button>", "originalCommit": "3e30cf09b6a41ceb9cbc86de4934580c48a53a78", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTM4NDkwNQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10270#discussion_r449384905", "bodyText": "I think we need it.\nopenFs.key is something like s2 Sun, 01 Apr yyyy, 11:59 PM +08:00-Sat, 09 Apr yyyy, 11:59 PM +08:00\nopenFs.value is http://localhost:4200/web/sessions/submission?courseid=c1&key=8A005B3F3B25C093B205568073DC29A394871A2B4E4D2B30C5725D92FA70F5689F5DB03F086A69415AA0B122AE5F7A05&studentemail=charles%40example.com&fsname=s2\nEither way we'll have to extract it from either of them. I think the URL is safer?", "author": "ccyccyccy", "createdAt": "2020-07-03T05:38:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTMyNTU4Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTQ2NjI3Ng==", "url": "https://github.com/TEAMMATES/teammates/pull/10270#discussion_r449466276", "bodyText": "I just checked code again. Let's take this time to also improve the implementation of this part; key being something like that is not exactly the best way. Better way would be the feedback session (name, open time, close time) to be accessible and the HTML file just needs to call one of those fields as needed.\nAlso, that yyyy is supposed to be the year. That needs to be fixed.", "author": "wkurniawan07", "createdAt": "2020-07-03T08:59:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTMyNTU4Mg=="}], "type": "inlineReview"}, {"oid": "cd1ddbebe5db7242dc1f3799c7ee74b3524c8dcd", "url": "https://github.com/TEAMMATES/teammates/commit/cd1ddbebe5db7242dc1f3799c7ee74b3524c8dcd", "message": "Add API for email request", "committedDate": "2020-07-06T02:41:58Z", "type": "commit"}, {"oid": "16cb0394993556d74ba4d39ebe6aaddf4aed9014", "url": "https://github.com/TEAMMATES/teammates/commit/16cb0394993556d74ba4d39ebe6aaddf4aed9014", "message": "Add frontend buttons for email feature", "committedDate": "2020-07-06T02:44:11Z", "type": "commit"}, {"oid": "99a2ac40f78ee922ca5a3a9d1525fa9aa90020e1", "url": "https://github.com/TEAMMATES/teammates/commit/99a2ac40f78ee922ca5a3a9d1525fa9aa90020e1", "message": "Test fix", "committedDate": "2020-07-06T02:44:12Z", "type": "commit"}, {"oid": "a4a044245d39957ab2ac2673cf83d6174e8742d8", "url": "https://github.com/TEAMMATES/teammates/commit/a4a044245d39957ab2ac2673cf83d6174e8742d8", "message": "Rename generateemail endpoint to email", "committedDate": "2020-07-06T02:44:12Z", "type": "commit"}, {"oid": "0e33ea93f509538a8044ee76c285e49cbcdea6df", "url": "https://github.com/TEAMMATES/teammates/commit/0e33ea93f509538a8044ee76c285e49cbcdea6df", "message": "Change auth type\n\nCo-authored-by: Ahmed Bahajjaj <Ahmed_Bahajjaj@u.nus.edu>", "committedDate": "2020-07-06T02:44:12Z", "type": "commit"}, {"oid": "bbd4d819dc6cd5bac56cf364974c4d7878f0f5a8", "url": "https://github.com/TEAMMATES/teammates/commit/bbd4d819dc6cd5bac56cf364974c4d7878f0f5a8", "message": "Link EmailType from backend to frontend", "committedDate": "2020-07-06T02:44:12Z", "type": "commit"}, {"oid": "c46fcb6762c92a12dc56dc984d2929f3cba4c799", "url": "https://github.com/TEAMMATES/teammates/commit/c46fcb6762c92a12dc56dc984d2929f3cba4c799", "message": "Change params of getEmail", "committedDate": "2020-07-06T02:44:12Z", "type": "commit"}, {"oid": "f9683c9e5b542fa7f19dfdee462c09269351702d", "url": "https://github.com/TEAMMATES/teammates/commit/f9683c9e5b542fa7f19dfdee462c09269351702d", "message": "Fix year not showing", "committedDate": "2020-07-06T03:28:59Z", "type": "commit"}, {"oid": "f9c51705a1b8fb554c39ffea0fc2f9ba7abf1221", "url": "https://github.com/TEAMMATES/teammates/commit/f9c51705a1b8fb554c39ffea0fc2f9ba7abf1221", "message": "Refactor data shape returned by generating strings to display", "committedDate": "2020-07-06T05:10:56Z", "type": "forcePushed"}, {"oid": "d0ddb5e899db92d586c1368ff3fabb881f867484", "url": "https://github.com/TEAMMATES/teammates/commit/d0ddb5e899db92d586c1368ff3fabb881f867484", "message": "Refactor data shape returned by generating strings to display", "committedDate": "2020-07-06T06:01:46Z", "type": "commit"}, {"oid": "d0ddb5e899db92d586c1368ff3fabb881f867484", "url": "https://github.com/TEAMMATES/teammates/commit/d0ddb5e899db92d586c1368ff3fabb881f867484", "message": "Refactor data shape returned by generating strings to display", "committedDate": "2020-07-06T06:01:46Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDAwOTQxOA==", "url": "https://github.com/TEAMMATES/teammates/pull/10270#discussion_r450009418", "bodyText": "This comment is not necessary. It is implied by the fact that there is no export preceding the interfaces.", "author": "wkurniawan07", "createdAt": "2020-07-06T06:32:46Z", "path": "src/web/services/search.service.ts", "diffHunk": "@@ -505,16 +514,24 @@ export interface StudentAccountSearchResult extends InstructorAccountSearchResul\n   team: string;\n   comments: string;\n   recordsPageLink: string;\n-  openSessions: { [index: string]: string };\n-  notOpenSessions: { [index: string]: string };\n-  publishedSessions: { [index: string]: string };\n+  openSessions: FeedbackSessionsGroup;\n+  notOpenSessions: FeedbackSessionsGroup;\n+  publishedSessions: FeedbackSessionsGroup;\n }\n \n-// Private interfaces\n-interface FeedbackSessionsGroup {\n-  [key: string]: string;\n+/**\n+ * Feedback session inforamtion for search result.\n+ */\n+export interface FeedbackSessionsGroup {\n+  [name: string]: {\n+    startTime: string;\n+    endTime: string;\n+    feedbackSessionUrl: string;\n+  };\n }\n \n+// Private interfaces", "originalCommit": "d0ddb5e899db92d586c1368ff3fabb881f867484", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDAwOTgzOA==", "url": "https://github.com/TEAMMATES/teammates/pull/10270#discussion_r450009838", "bodyText": "It looks like the only usage for this is in search-service.ts, and the method is very use case-specific. Let's move this method there instead.", "author": "wkurniawan07", "createdAt": "2020-07-06T06:34:05Z", "path": "src/web/services/feedback-sessions.service.ts", "diffHunk": "@@ -413,14 +413,14 @@ export class FeedbackSessionsService {\n   }\n \n   /**\n-   * Generates the name fragment of a feedbackSession for display on the frontend.\n+   * Generates formatted properties of a feedbackSession for display on the frontend.\n    */\n-  generateNameFragment(feedbackSession: FeedbackSession): string {\n-    const DATE_FORMAT_WITH_ZONE_INFO: string = 'ddd, DD MMM yyyy, hh:mm A Z';\n+  formatProperties(feedbackSession: FeedbackSession): { startTime: string, endTime: string } {", "originalCommit": "d0ddb5e899db92d586c1368ff3fabb881f867484", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDExNzc0MQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10270#discussion_r450117741", "bodyText": "Unknown is not exactly accurate because some other types (e.g. INSTRUCTOR_COURSE_JOIN, NEW_INSTRUCTOR_ACCOUNT) are known but we just don't cater for them, maybe not now, maybe never. Email type ... is not accepted. is more accurate.", "author": "wkurniawan07", "createdAt": "2020-07-06T10:03:30Z", "path": "src/main/java/teammates/ui/webapi/action/GenerateEmailAction.java", "diffHunk": "@@ -0,0 +1,60 @@\n+package teammates.ui.webapi.action;\n+\n+import teammates.common.datatransfer.attributes.CourseAttributes;\n+import teammates.common.datatransfer.attributes.FeedbackSessionAttributes;\n+import teammates.common.datatransfer.attributes.StudentAttributes;\n+import teammates.common.exception.InvalidHttpParameterException;\n+import teammates.common.exception.UnauthorizedAccessException;\n+import teammates.common.util.Assumption;\n+import teammates.common.util.Const;\n+import teammates.common.util.EmailType;\n+import teammates.common.util.EmailWrapper;\n+import teammates.ui.webapi.output.EmailData;\n+\n+/**\n+ * Generate email content.\n+ */\n+public class GenerateEmailAction extends Action {\n+\n+    @Override\n+    protected AuthType getMinAuthLevel() {\n+        return AuthType.LOGGED_IN;\n+    }\n+\n+    @Override\n+    public void checkSpecificAccessControl() {\n+        if (!userInfo.isAdmin) {\n+            throw new UnauthorizedAccessException(\"Admin privilege is required to access this resource.\");\n+        }\n+    }\n+\n+    @Override\n+    public ActionResult execute() {\n+        String courseId = getNonNullRequestParamValue(Const.ParamsNames.COURSE_ID);\n+        String studentEmail = getNonNullRequestParamValue(Const.ParamsNames.STUDENT_EMAIL);\n+        String emailType = getNonNullRequestParamValue(Const.ParamsNames.EMAIL_TYPE);\n+        String feedbackSessionName = getRequestParamValue(Const.ParamsNames.FEEDBACK_SESSION_NAME);\n+\n+        CourseAttributes course = logic.getCourse(courseId);\n+        Assumption.assertNotNull(course);\n+\n+        StudentAttributes student = logic.getStudentForEmail(courseId, studentEmail);\n+        Assumption.assertNotNull(student);\n+\n+        EmailWrapper email;\n+\n+        if (emailType.equals(EmailType.STUDENT_COURSE_JOIN.name())) {\n+            email = emailGenerator.generateStudentCourseJoinEmail(course, student);\n+        } else if (emailType.equals(EmailType.FEEDBACK_SESSION_REMINDER.name())) {\n+            if (feedbackSessionName == null) {\n+                throw new InvalidHttpParameterException(\"Feedback session name not specified\");\n+            }\n+            FeedbackSessionAttributes feedbackSession = logic.getFeedbackSession(feedbackSessionName, courseId);\n+            email = emailGenerator.generateFeedbackSessionStudentReminderEmail(feedbackSession, student);\n+        } else {\n+            throw new InvalidHttpParameterException(\"Unknown emailType \" + emailType);", "originalCommit": "d0ddb5e899db92d586c1368ff3fabb881f867484", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDE4Mzg0Mg==", "url": "https://github.com/TEAMMATES/teammates/pull/10270#discussion_r450183842", "bodyText": "I would even go this far and say that LinkService should be deprecated as this class is the only user, but you don't need to change this now.", "author": "wkurniawan07", "createdAt": "2020-07-06T12:23:59Z", "path": "src/web/services/search.service.ts", "diffHunk": "@@ -342,16 +342,25 @@ export class SearchService {\n     };\n     for (const feedbackSession of feedbackSessions.feedbackSessions) {\n       if (this.feedbackSessionService.isFeedbackSessionOpen(feedbackSession)) {\n-        feedbackSessionLinks.openSessions[this.feedbackSessionService.generateNameFragment(feedbackSession).toString()]\n-          = this.linkService.generateSubmitUrl(student, feedbackSession.feedbackSessionName);\n+        feedbackSessionLinks.openSessions[feedbackSession.feedbackSessionName]\n+            = {\n+              ...this.feedbackSessionService.formatProperties(feedbackSession),\n+              feedbackSessionUrl: this.linkService.generateSubmitUrl(student, feedbackSession.feedbackSessionName),", "originalCommit": "d0ddb5e899db92d586c1368ff3fabb881f867484", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDE4NTA5Mw==", "url": "https://github.com/TEAMMATES/teammates/pull/10270#discussion_r450185093", "bodyText": "It's ok for the = { to be on the previous line, i.e.\nfeedbackSessionLinks.openSessions[feedbackSession.feedbackSessionName] = {\n  // ...\n};\nIt saves some levels of indentation.", "author": "wkurniawan07", "createdAt": "2020-07-06T12:26:17Z", "path": "src/web/services/search.service.ts", "diffHunk": "@@ -342,16 +342,25 @@ export class SearchService {\n     };\n     for (const feedbackSession of feedbackSessions.feedbackSessions) {\n       if (this.feedbackSessionService.isFeedbackSessionOpen(feedbackSession)) {\n-        feedbackSessionLinks.openSessions[this.feedbackSessionService.generateNameFragment(feedbackSession).toString()]\n-          = this.linkService.generateSubmitUrl(student, feedbackSession.feedbackSessionName);\n+        feedbackSessionLinks.openSessions[feedbackSession.feedbackSessionName]\n+            = {", "originalCommit": "d0ddb5e899db92d586c1368ff3fabb881f867484", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDE4NTMzNw==", "url": "https://github.com/TEAMMATES/teammates/pull/10270#discussion_r450185337", "bodyText": "\ud83d\udcaf", "author": "wkurniawan07", "createdAt": "2020-07-06T12:26:41Z", "path": "src/web/app/pages-admin/admin-search-page/admin-search-page.component.html", "diffHunk": "@@ -149,19 +149,23 @@\n                 </li>\n                 <li class=\"list-group-item list-group-item-info\">\n                   <strong>Course Join Link</strong>\n+                  <button type=\"button\" class=\"btn btn-primary margin-left-5px btn-sm\" (click)=\"openEmail(student.courseId, student.email, EmailType.STUDENT_COURSE_JOIN)\">Send mail</button>\n                   <input [value]=\"student.courseJoinLink\" readonly class=\"form-control\">\n                 </li>\n                 <li class=\"list-group-item list-group-item-warning\" *ngFor=\"let openFs of student.openSessions | keyvalue\">\n-                  <strong>{{ openFs.key }}</strong>\n-                  <input [value]=\"openFs.value\" readonly class=\"form-control\">\n+                  <strong>{{ openFs.key + ' ' + openFs.value.startTime + ' - ' + openFs.value.endTime }}</strong>", "originalCommit": "d0ddb5e899db92d586c1368ff3fabb881f867484", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDE4NzAxNw==", "url": "https://github.com/TEAMMATES/teammates/pull/10270#discussion_r450187017", "bodyText": "Although it works, it's not exactly the best way to generalize this method for all email types. Why not create a few different methods for different email types? i.e.\ngetCourseJoinEmail(courseId: string, studentEmail: string): Observable<Email> {\n  ...\n}\n\ngetFeedbackSessionReminderEmail(courseId: string, studentEmail: string): Observable<Email> {\n  ...\n}\nThis way you can also hide some implementation details (e.g. the EmailType) from the service callers.", "author": "wkurniawan07", "createdAt": "2020-07-06T12:29:58Z", "path": "src/web/services/email-generation.service.ts", "diffHunk": "@@ -0,0 +1,29 @@\n+import { Injectable } from '@angular/core';\n+import { Observable } from 'rxjs';\n+import { ResourceEndpoints } from '../types/api-endpoints';\n+import { Email } from '../types/api-output';\n+import { HttpRequestService } from './http-request.service';\n+\n+/**\n+ * Handles email generation.\n+ */\n+@Injectable({\n+  providedIn: 'root',\n+})\n+export class EmailGenerationService {\n+\n+  constructor(private httpRequestService: HttpRequestService) { }\n+\n+  /**\n+   * Get email contents by calling API.\n+   */\n+  getEmail(courseId: string, studentemail: string, emailtype: string, fsname?: string): Observable<Email> {", "originalCommit": "d0ddb5e899db92d586c1368ff3fabb881f867484", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "233ee124e3683e4ccf3e42db2195cfe01388067e", "url": "https://github.com/TEAMMATES/teammates/commit/233ee124e3683e4ccf3e42db2195cfe01388067e", "message": "Remove comment", "committedDate": "2020-07-06T13:39:22Z", "type": "commit"}, {"oid": "acfe8f3b04473e5bc5343a2c4bb4e0b6f04e4f91", "url": "https://github.com/TEAMMATES/teammates/commit/acfe8f3b04473e5bc5343a2c4bb4e0b6f04e4f91", "message": "Move formatProperties to searchservice.ts", "committedDate": "2020-07-06T14:19:36Z", "type": "commit"}, {"oid": "a5554ffaa916cdd2955b6d0e05ef7ecf7f9f8dc1", "url": "https://github.com/TEAMMATES/teammates/commit/a5554ffaa916cdd2955b6d0e05ef7ecf7f9f8dc1", "message": "Change error message for unaccepted email type", "committedDate": "2020-07-06T14:20:47Z", "type": "commit"}, {"oid": "e2739b966f363c5fe8e14c65bc45036137091950", "url": "https://github.com/TEAMMATES/teammates/commit/e2739b966f363c5fe8e14c65bc45036137091950", "message": "Abstration for email opening link", "committedDate": "2020-07-06T14:41:09Z", "type": "commit"}, {"oid": "83f8794002fe02ba7bf91aafa37064afb5a6e377", "url": "https://github.com/TEAMMATES/teammates/commit/83f8794002fe02ba7bf91aafa37064afb5a6e377", "message": "Lint fix", "committedDate": "2020-07-06T15:35:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTI4MjI3OQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10270#discussion_r451282279", "bodyText": "I believe you don't need this anymore", "author": "wkurniawan07", "createdAt": "2020-07-08T04:54:31Z", "path": "src/web/app/pages-admin/admin-search-page/admin-search-page.component.ts", "diffHunk": "@@ -28,6 +27,9 @@ import {\n })\n export class AdminSearchPageComponent {\n \n+  // enum\n+  EmailType: typeof EmailType = EmailType;", "originalCommit": "83f8794002fe02ba7bf91aafa37064afb5a6e377", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTI4MjU4MA==", "url": "https://github.com/TEAMMATES/teammates/pull/10270#discussion_r451282580", "bodyText": "The body of these two methods are identical other than the method being called in the service class. Can they be abstracted out?", "author": "wkurniawan07", "createdAt": "2020-07-08T04:55:36Z", "path": "src/web/app/pages-admin/admin-search-page/admin-search-page.component.ts", "diffHunk": "@@ -189,4 +192,32 @@ export class AdminSearchPageComponent {\n     return link.replace(regex, `$1${newVal}`);\n   }\n \n+  /**\n+   * Open up an email populated with content for course join invitation.\n+   */\n+  openCourseJoinEmail(courseId: string, studentemail: string): void {\n+    this.emailGenerationService.getCourseJoinEmail(courseId, studentemail)\n+        .subscribe((email: Email) => {\n+          window.location.href = `mailto:${email.recipient}`\n+              + `?Subject=${email.subject}`\n+              + `&body=${email.content}`;\n+        }, (err: ErrorMessageOutput) => {\n+          this.statusMessageService.showErrorToast(err.error.message);\n+        });\n+  }\n+\n+  /**\n+   * Open up an email populated with content for feedback session reminder.\n+   */\n+  openFeedbackSessionReminderEmail(courseId: string, studentemail: string, fsname: string): void {\n+    this.emailGenerationService.getFeedbackSessionReminderEmail(courseId, studentemail, fsname)\n+        .subscribe((email: Email) => {\n+          window.location.href = `mailto:${email.recipient}`\n+              + `?Subject=${email.subject}`\n+              + `&body=${email.content}`;\n+        }, (err: ErrorMessageOutput) => {\n+          this.statusMessageService.showErrorToast(err.error.message);\n+        });", "originalCommit": "83f8794002fe02ba7bf91aafa37064afb5a6e377", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTM2MTM3OQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10270#discussion_r451361379", "bodyText": "Don't think it's a good idea to refactor this. The function parameters could always change to require even more arguments, and these methods might not share similar parameters at all. The only repeated code I see here is this portion\nwindow.location.href = `mailto:${email.recipient}`\n              + `?Subject=${email.subject}`\n              + `&body=${email.content}`;\n\nwhere it is already very self descriptive. Could be worth refactoring if we further add similar methods?", "author": "ccyccyccy", "createdAt": "2020-07-08T08:09:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTI4MjU4MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTUzOTUzNA==", "url": "https://github.com/TEAMMATES/teammates/pull/10270#discussion_r451539534", "bodyText": "What I'm suggesting is a function that takes in Observable<Email>, so it shouldn't matter how many parameter it takes or whether the parameters change or not.\nSince this is repeated just twice, it is fine to let this be for now.", "author": "wkurniawan07", "createdAt": "2020-07-08T13:22:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTI4MjU4MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTI4Mjc3MQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10270#discussion_r451282771", "bodyText": "This can be private, I believe", "author": "wkurniawan07", "createdAt": "2020-07-08T04:56:23Z", "path": "src/web/services/search.service.ts", "diffHunk": "@@ -463,6 +471,15 @@ export class SearchService {\n       }),\n     );\n   }\n+\n+  formatProperties(feedbackSession: FeedbackSession): { startTime: string, endTime: string } {", "originalCommit": "83f8794002fe02ba7bf91aafa37064afb5a6e377", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "d47ce941601fc6d87568a5a0203b5ad8cca8a0a1", "url": "https://github.com/TEAMMATES/teammates/commit/d47ce941601fc6d87568a5a0203b5ad8cca8a0a1", "message": "Fix bad merge", "committedDate": "2020-07-08T08:00:20Z", "type": "commit"}, {"oid": "51e4ead529251ee014ce4524a7cef2af0583df89", "url": "https://github.com/TEAMMATES/teammates/commit/51e4ead529251ee014ce4524a7cef2af0583df89", "message": "Remove useless enum", "committedDate": "2020-07-08T08:11:50Z", "type": "commit"}, {"oid": "208c71b215e9372c060d1508b807ebe53193fd9f", "url": "https://github.com/TEAMMATES/teammates/commit/208c71b215e9372c060d1508b807ebe53193fd9f", "message": "Merge branch 'master' into 10245-email-feature", "committedDate": "2020-07-08T13:28:44Z", "type": "commit"}]}