{"pr_number": 10045, "pr_title": "[#9536] Instructor Course Edit Page E2E Test ", "pr_createdAt": "2020-05-12T14:15:55Z", "pr_url": "https://github.com/TEAMMATES/teammates/pull/10045", "timeline": [{"oid": "721339e6efd72ceccebc0ed7fa3c8f4ccb79f37b", "url": "https://github.com/TEAMMATES/teammates/commit/721339e6efd72ceccebc0ed7fa3c8f4ccb79f37b", "message": "Update InstructorCourseEditPageE2ETest", "committedDate": "2020-05-06T07:54:32Z", "type": "commit"}, {"oid": "72e527e07fc98cb259953d432fb5a3acb33f1cef", "url": "https://github.com/TEAMMATES/teammates/commit/72e527e07fc98cb259953d432fb5a3acb33f1cef", "message": "Merge branch 'master' of https://github.com/jtankw3/teammates into instructor-course-edit-e2e", "committedDate": "2020-05-12T12:47:34Z", "type": "commit"}, {"oid": "1d669b67ab833ae15d25bd225ef1fc1874282a61", "url": "https://github.com/TEAMMATES/teammates/commit/1d669b67ab833ae15d25bd225ef1fc1874282a61", "message": "Fix bugs and linting", "committedDate": "2020-05-12T15:24:16Z", "type": "forcePushed"}, {"oid": "9996ea593276c862e3cc6f02b847242b27c5ffe9", "url": "https://github.com/TEAMMATES/teammates/commit/9996ea593276c862e3cc6f02b847242b27c5ffe9", "message": "Fix bugs and linting", "committedDate": "2020-05-12T16:12:45Z", "type": "commit"}, {"oid": "9996ea593276c862e3cc6f02b847242b27c5ffe9", "url": "https://github.com/TEAMMATES/teammates/commit/9996ea593276c862e3cc6f02b847242b27c5ffe9", "message": "Fix bugs and linting", "committedDate": "2020-05-12T16:12:45Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQ3NjY4Mg==", "url": "https://github.com/TEAMMATES/teammates/pull/10045#discussion_r426476682", "bodyText": "Why is this status message hardcoded? I think it should be programatically derived.\nIf not, the test is brittle and any small change in the message (an extra space etc.) will break the E2E tests.\nThe same applies to the other status messages.", "author": "rrtheonlyone", "createdAt": "2020-05-18T09:05:19Z", "path": "src/e2e/java/teammates/e2e/cases/e2e/InstructorCourseEditPageE2ETest.java", "diffHunk": "@@ -0,0 +1,122 @@\n+package teammates.e2e.cases.e2e;\n+\n+import java.time.ZoneId;\n+\n+import org.testng.annotations.Test;\n+\n+import teammates.common.datatransfer.attributes.CourseAttributes;\n+import teammates.common.datatransfer.attributes.InstructorAttributes;\n+import teammates.common.util.AppUrl;\n+import teammates.common.util.Const;\n+import teammates.e2e.pageobjects.AppPage;\n+import teammates.e2e.pageobjects.InstructorCourseEditPage;\n+import teammates.e2e.pageobjects.InstructorHomePage;\n+\n+/**\n+ * SUT: {@link Const.WebPageURIs#INSTRUCTOR_COURSE_EDIT_PAGE}.\n+ */\n+public class InstructorCourseEditPageE2ETest extends BaseE2ETestCase {\n+    CourseAttributes course;\n+    InstructorAttributes[] instructors = new InstructorAttributes[5];\n+\n+    @Override\n+    protected void prepareTestData() {\n+        testData = loadDataBundle(\"/InstructorCourseEditPageE2ETest.json\");\n+        removeAndRestoreDataBundle(testData);\n+\n+        course = testData.courses.get(\"InsCrsEdit.CS2104\");\n+        instructors[0] = testData.instructors.get(\"InsCrsEdit.helper\");\n+        instructors[1] = testData.instructors.get(\"InsCrsEdit.manager\");\n+        instructors[2] = testData.instructors.get(\"InsCrsEdit.observer\");\n+        instructors[3] = testData.instructors.get(\"InsCrsEdit.coowner\");\n+        instructors[4] = testData.instructors.get(\"InsCrsEdit.tutor\");\n+    }\n+\n+    @Test\n+    public void testAll() {\n+        ______TS(\"verify cannot edit without privilege\");\n+        // log in as instructor with no edit privilege\n+        AppUrl url = createUrl(Const.WebPageURIs.INSTRUCTOR_COURSE_EDIT_PAGE)\n+                .withUserId(instructors[2].googleId)\n+                .withCourseId(course.getId());\n+        loginAdminToPage(url, InstructorHomePage.class);\n+        InstructorCourseEditPage editPage = AppPage.getNewPageInstance(browser, url, InstructorCourseEditPage.class);\n+\n+        editPage.verifyCourseNotEditable();\n+        editPage.verifyInstructorsNotEditable();\n+        editPage.verifyAddInstructorNotAllowed();\n+\n+        ______TS(\"verify loaded data\");\n+        // re-log in as instructor with edit privilege\n+        url = createUrl(Const.WebPageURIs.INSTRUCTOR_COURSE_EDIT_PAGE)\n+                .withUserId(instructors[3].googleId)\n+                .withCourseId(course.getId());\n+        editPage = AppPage.getNewPageInstance(browser, url, InstructorCourseEditPage.class);\n+\n+        editPage.verifyCourseDetails(course);\n+\n+        editPage.verifyInstructorDetails(1, instructors[0]);\n+        editPage.verifyInstructorDetails(2, instructors[1]);\n+        editPage.verifyInstructorDetails(3, instructors[2]);\n+        editPage.verifyInstructorDetails(4, instructors[3]);\n+        editPage.verifyInstructorDetails(5, instructors[4]);\n+\n+        ______TS(\"add instructor\");\n+        InstructorAttributes newInstructor = InstructorAttributes\n+                .builder(course.getId(), \"InsCrsEdit.test@gmail.tmt\")\n+                .withName(\"Teammates Test\")\n+                .withIsDisplayedToStudents(true)\n+                .withDisplayedName(\"Instructor\")\n+                .withRole(\"Tutor\")\n+                .build();\n+\n+        editPage.addInstructor(newInstructor);\n+        editPage.verifyStatusMessage(\"\\\"The instructor Teammates Test has been added successfully. \"", "originalCommit": "9996ea593276c862e3cc6f02b847242b27c5ffe9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjU3MTkwNg==", "url": "https://github.com/TEAMMATES/teammates/pull/10045#discussion_r426571906", "bodyText": "This is actually a grey area. On one hand, what you said is of course true. However, on the other hand, this is a black-box test, meaning that the test code should not actually know that there exists some constant in the code that holds that string.\nEither way is acceptable.", "author": "wkurniawan07", "createdAt": "2020-05-18T11:57:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQ3NjY4Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODE2MjY5NQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10045#discussion_r428162695", "bodyText": "I did not use the Const values as they are Deprecated. I have added tried to use variables instead for names, emails etc in the status message instead to try to make is slightly less brittle.", "author": "jtankw3", "createdAt": "2020-05-20T16:50:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQ3NjY4Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQ3NzcwMg==", "url": "https://github.com/TEAMMATES/teammates/pull/10045#discussion_r426477702", "bodyText": "In this test case, we add a new instructor and verify that the frontend has the instructor's details. However, the backend is not verified right? We should also check that the database has the new instructor in this course.", "author": "rrtheonlyone", "createdAt": "2020-05-18T09:06:52Z", "path": "src/e2e/java/teammates/e2e/cases/e2e/InstructorCourseEditPageE2ETest.java", "diffHunk": "@@ -0,0 +1,122 @@\n+package teammates.e2e.cases.e2e;\n+\n+import java.time.ZoneId;\n+\n+import org.testng.annotations.Test;\n+\n+import teammates.common.datatransfer.attributes.CourseAttributes;\n+import teammates.common.datatransfer.attributes.InstructorAttributes;\n+import teammates.common.util.AppUrl;\n+import teammates.common.util.Const;\n+import teammates.e2e.pageobjects.AppPage;\n+import teammates.e2e.pageobjects.InstructorCourseEditPage;\n+import teammates.e2e.pageobjects.InstructorHomePage;\n+\n+/**\n+ * SUT: {@link Const.WebPageURIs#INSTRUCTOR_COURSE_EDIT_PAGE}.\n+ */\n+public class InstructorCourseEditPageE2ETest extends BaseE2ETestCase {\n+    CourseAttributes course;\n+    InstructorAttributes[] instructors = new InstructorAttributes[5];\n+\n+    @Override\n+    protected void prepareTestData() {\n+        testData = loadDataBundle(\"/InstructorCourseEditPageE2ETest.json\");\n+        removeAndRestoreDataBundle(testData);\n+\n+        course = testData.courses.get(\"InsCrsEdit.CS2104\");\n+        instructors[0] = testData.instructors.get(\"InsCrsEdit.helper\");\n+        instructors[1] = testData.instructors.get(\"InsCrsEdit.manager\");\n+        instructors[2] = testData.instructors.get(\"InsCrsEdit.observer\");\n+        instructors[3] = testData.instructors.get(\"InsCrsEdit.coowner\");\n+        instructors[4] = testData.instructors.get(\"InsCrsEdit.tutor\");\n+    }\n+\n+    @Test\n+    public void testAll() {\n+        ______TS(\"verify cannot edit without privilege\");\n+        // log in as instructor with no edit privilege\n+        AppUrl url = createUrl(Const.WebPageURIs.INSTRUCTOR_COURSE_EDIT_PAGE)\n+                .withUserId(instructors[2].googleId)\n+                .withCourseId(course.getId());\n+        loginAdminToPage(url, InstructorHomePage.class);\n+        InstructorCourseEditPage editPage = AppPage.getNewPageInstance(browser, url, InstructorCourseEditPage.class);\n+\n+        editPage.verifyCourseNotEditable();\n+        editPage.verifyInstructorsNotEditable();\n+        editPage.verifyAddInstructorNotAllowed();\n+\n+        ______TS(\"verify loaded data\");\n+        // re-log in as instructor with edit privilege\n+        url = createUrl(Const.WebPageURIs.INSTRUCTOR_COURSE_EDIT_PAGE)\n+                .withUserId(instructors[3].googleId)\n+                .withCourseId(course.getId());\n+        editPage = AppPage.getNewPageInstance(browser, url, InstructorCourseEditPage.class);\n+\n+        editPage.verifyCourseDetails(course);\n+\n+        editPage.verifyInstructorDetails(1, instructors[0]);\n+        editPage.verifyInstructorDetails(2, instructors[1]);\n+        editPage.verifyInstructorDetails(3, instructors[2]);\n+        editPage.verifyInstructorDetails(4, instructors[3]);\n+        editPage.verifyInstructorDetails(5, instructors[4]);\n+\n+        ______TS(\"add instructor\");", "originalCommit": "9996ea593276c862e3cc6f02b847242b27c5ffe9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODE2Mjk4NQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10045#discussion_r428162985", "bodyText": "Added some methods with Backdoor to do some verification for backend", "author": "jtankw3", "createdAt": "2020-05-20T16:51:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQ3NzcwMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQ3ODE0MQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10045#discussion_r426478141", "bodyText": "Same for this test case. The backend is not verified. Actually this point holds throughout for the other test cases!", "author": "rrtheonlyone", "createdAt": "2020-05-18T09:07:34Z", "path": "src/e2e/java/teammates/e2e/cases/e2e/InstructorCourseEditPageE2ETest.java", "diffHunk": "@@ -0,0 +1,122 @@\n+package teammates.e2e.cases.e2e;\n+\n+import java.time.ZoneId;\n+\n+import org.testng.annotations.Test;\n+\n+import teammates.common.datatransfer.attributes.CourseAttributes;\n+import teammates.common.datatransfer.attributes.InstructorAttributes;\n+import teammates.common.util.AppUrl;\n+import teammates.common.util.Const;\n+import teammates.e2e.pageobjects.AppPage;\n+import teammates.e2e.pageobjects.InstructorCourseEditPage;\n+import teammates.e2e.pageobjects.InstructorHomePage;\n+\n+/**\n+ * SUT: {@link Const.WebPageURIs#INSTRUCTOR_COURSE_EDIT_PAGE}.\n+ */\n+public class InstructorCourseEditPageE2ETest extends BaseE2ETestCase {\n+    CourseAttributes course;\n+    InstructorAttributes[] instructors = new InstructorAttributes[5];\n+\n+    @Override\n+    protected void prepareTestData() {\n+        testData = loadDataBundle(\"/InstructorCourseEditPageE2ETest.json\");\n+        removeAndRestoreDataBundle(testData);\n+\n+        course = testData.courses.get(\"InsCrsEdit.CS2104\");\n+        instructors[0] = testData.instructors.get(\"InsCrsEdit.helper\");\n+        instructors[1] = testData.instructors.get(\"InsCrsEdit.manager\");\n+        instructors[2] = testData.instructors.get(\"InsCrsEdit.observer\");\n+        instructors[3] = testData.instructors.get(\"InsCrsEdit.coowner\");\n+        instructors[4] = testData.instructors.get(\"InsCrsEdit.tutor\");\n+    }\n+\n+    @Test\n+    public void testAll() {\n+        ______TS(\"verify cannot edit without privilege\");\n+        // log in as instructor with no edit privilege\n+        AppUrl url = createUrl(Const.WebPageURIs.INSTRUCTOR_COURSE_EDIT_PAGE)\n+                .withUserId(instructors[2].googleId)\n+                .withCourseId(course.getId());\n+        loginAdminToPage(url, InstructorHomePage.class);\n+        InstructorCourseEditPage editPage = AppPage.getNewPageInstance(browser, url, InstructorCourseEditPage.class);\n+\n+        editPage.verifyCourseNotEditable();\n+        editPage.verifyInstructorsNotEditable();\n+        editPage.verifyAddInstructorNotAllowed();\n+\n+        ______TS(\"verify loaded data\");\n+        // re-log in as instructor with edit privilege\n+        url = createUrl(Const.WebPageURIs.INSTRUCTOR_COURSE_EDIT_PAGE)\n+                .withUserId(instructors[3].googleId)\n+                .withCourseId(course.getId());\n+        editPage = AppPage.getNewPageInstance(browser, url, InstructorCourseEditPage.class);\n+\n+        editPage.verifyCourseDetails(course);\n+\n+        editPage.verifyInstructorDetails(1, instructors[0]);\n+        editPage.verifyInstructorDetails(2, instructors[1]);\n+        editPage.verifyInstructorDetails(3, instructors[2]);\n+        editPage.verifyInstructorDetails(4, instructors[3]);\n+        editPage.verifyInstructorDetails(5, instructors[4]);\n+\n+        ______TS(\"add instructor\");\n+        InstructorAttributes newInstructor = InstructorAttributes\n+                .builder(course.getId(), \"InsCrsEdit.test@gmail.tmt\")\n+                .withName(\"Teammates Test\")\n+                .withIsDisplayedToStudents(true)\n+                .withDisplayedName(\"Instructor\")\n+                .withRole(\"Tutor\")\n+                .build();\n+\n+        editPage.addInstructor(newInstructor);\n+        editPage.verifyStatusMessage(\"\\\"The instructor Teammates Test has been added successfully. \"\n+                + \"An email containing how to 'join' this course will be sent to InsCrsEdit.test@gmail.tmt\"\n+                + \" in a few minutes.\\\"\");\n+        editPage.verifyInstructorDetails(6, newInstructor);\n+\n+        ______TS(\"resend invite\");\n+        editPage.resendInstructorInvite(6);\n+        editPage.verifyStatusMessage(\"An email has been sent to InsCrsEdit.test@gmail.tmt\");\n+\n+        ______TS(\"edit instructor\");", "originalCommit": "9996ea593276c862e3cc6f02b847242b27c5ffe9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "8f7d858bcd4a4f9618f1b60c05e60e4da47a3174", "url": "https://github.com/TEAMMATES/teammates/commit/8f7d858bcd4a4f9618f1b60c05e60e4da47a3174", "message": "Add some methods to BackDoor to facilitate checking datastore", "committedDate": "2020-05-20T14:30:28Z", "type": "commit"}, {"oid": "f9f9f3307b2fb616a746ab812de64d5f12322b1a", "url": "https://github.com/TEAMMATES/teammates/commit/f9f9f3307b2fb616a746ab812de64d5f12322b1a", "message": "Add extra checks to InstructorCourseEditPageE2ETest to account for backend", "committedDate": "2020-05-20T14:31:45Z", "type": "commit"}, {"oid": "b966494008e4bd4ec54bb325ac19d11008f03a21", "url": "https://github.com/TEAMMATES/teammates/commit/b966494008e4bd4ec54bb325ac19d11008f03a21", "message": "Some changes to InstructorCourseEditPage to reduce intermittent failing", "committedDate": "2020-05-20T14:32:50Z", "type": "commit"}, {"oid": "3b16ec5f3591a22bc84df3e806372f501e4e3e0b", "url": "https://github.com/TEAMMATES/teammates/commit/3b16ec5f3591a22bc84df3e806372f501e4e3e0b", "message": "Merge branch 'master' of https://github.com/TEAMMATES/teammates into instructor-course-edit-e2e\n\n# Conflicts:\n#\tsrc/web/app/pages-instructor/instructor-course-edit-page/instructor-course-edit-page.component.html\n#\tsrc/web/app/pages-instructor/instructor-course-edit-page/instructor-edit-panel/instructor-edit-panel.component.html", "committedDate": "2020-05-20T14:48:35Z", "type": "commit"}, {"oid": "3b16ec5f3591a22bc84df3e806372f501e4e3e0b", "url": "https://github.com/TEAMMATES/teammates/commit/3b16ec5f3591a22bc84df3e806372f501e4e3e0b", "message": "Merge branch 'master' of https://github.com/TEAMMATES/teammates into instructor-course-edit-e2e\n\n# Conflicts:\n#\tsrc/web/app/pages-instructor/instructor-course-edit-page/instructor-course-edit-page.component.html\n#\tsrc/web/app/pages-instructor/instructor-course-edit-page/instructor-edit-panel/instructor-edit-panel.component.html", "committedDate": "2020-05-20T14:48:35Z", "type": "forcePushed"}, {"oid": "a2b52e81e540627d74ff2344e0cf51120b3b8ea1", "url": "https://github.com/TEAMMATES/teammates/commit/a2b52e81e540627d74ff2344e0cf51120b3b8ea1", "message": "Add extra wait", "committedDate": "2020-05-20T16:04:35Z", "type": "commit"}, {"oid": "957ea53fdd6de5d85d44ca3b131ff98feee549aa", "url": "https://github.com/TEAMMATES/teammates/commit/957ea53fdd6de5d85d44ca3b131ff98feee549aa", "message": "Merge branch 'master' into instructor-course-edit-e2e", "committedDate": "2020-05-20T16:51:25Z", "type": "commit"}, {"oid": "9f2e317b41caa486b1bc3b60f2ae33f7452a08c2", "url": "https://github.com/TEAMMATES/teammates/commit/9f2e317b41caa486b1bc3b60f2ae33f7452a08c2", "message": "Remove wait from AppPage that causes timeouts", "committedDate": "2020-05-21T14:16:40Z", "type": "commit"}, {"oid": "8a936e97250248b39a71bc26d8661e36da11a36a", "url": "https://github.com/TEAMMATES/teammates/commit/8a936e97250248b39a71bc26d8661e36da11a36a", "message": "Merge branch 'instructor-course-edit-e2e' of https://github.com/jtankw3/teammates into instructor-course-edit-e2e", "committedDate": "2020-05-21T14:16:51Z", "type": "commit"}, {"oid": "6d361a8ed4430dc10278fc5a2d2662358e4baeaa", "url": "https://github.com/TEAMMATES/teammates/commit/6d361a8ed4430dc10278fc5a2d2662358e4baeaa", "message": "Merge branch 'master' of https://github.com/TEAMMATES/teammates into instructor-course-edit-e2e", "committedDate": "2020-05-21T14:17:02Z", "type": "commit"}, {"oid": "ecc79278a8d773dec0bfce373a666a645bbdf6bc", "url": "https://github.com/TEAMMATES/teammates/commit/ecc79278a8d773dec0bfce373a666a645bbdf6bc", "message": "Merge branch 'instructor-course-edit-e2e' of https://github.com/jtankw3/teammates into edit-course-e2e", "committedDate": "2020-05-24T09:15:03Z", "type": "commit"}, {"oid": "1e4a00f6346446bd3a5c07132808203baa130021", "url": "https://github.com/TEAMMATES/teammates/commit/1e4a00f6346446bd3a5c07132808203baa130021", "message": "Delete old files", "committedDate": "2020-05-24T09:47:01Z", "type": "commit"}, {"oid": "c0fbecd43a4b93807a2f27d0af0068a0f8bd67ff", "url": "https://github.com/TEAMMATES/teammates/commit/c0fbecd43a4b93807a2f27d0af0068a0f8bd67ff", "message": "Remove wait", "committedDate": "2020-05-24T10:16:49Z", "type": "commit"}, {"oid": "37c26c64014b4749293998a8d342e016d6314fbb", "url": "https://github.com/TEAMMATES/teammates/commit/37c26c64014b4749293998a8d342e016d6314fbb", "message": "Merge branch 'master' into instructor-course-edit-e2e", "committedDate": "2020-05-27T04:36:45Z", "type": "commit"}, {"oid": "5bab1777ebef8b5bc3a503ee9adffea7b3fd0e76", "url": "https://github.com/TEAMMATES/teammates/commit/5bab1777ebef8b5bc3a503ee9adffea7b3fd0e76", "message": "Merge branch 'master' into instructor-course-edit-e2e", "committedDate": "2020-05-28T03:08:12Z", "type": "commit"}, {"oid": "29f2d563108d3a323b8b9af7185e99a6eb09644c", "url": "https://github.com/TEAMMATES/teammates/commit/29f2d563108d3a323b8b9af7185e99a6eb09644c", "message": "Change import order", "committedDate": "2020-05-28T03:26:38Z", "type": "commit"}, {"oid": "013cc1749c8e2c3c33db8013a000d3344275e086", "url": "https://github.com/TEAMMATES/teammates/commit/013cc1749c8e2c3c33db8013a000d3344275e086", "message": "Use existing verify datastore methods", "committedDate": "2020-05-28T03:27:06Z", "type": "commit"}]}