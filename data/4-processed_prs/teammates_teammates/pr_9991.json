{"pr_number": 9991, "pr_title": "[#9946] Add additional fields for Instructor Search Migration ", "pr_createdAt": "2020-03-17T07:23:59Z", "pr_url": "https://github.com/TEAMMATES/teammates/pull/9991", "timeline": [{"oid": "0a498e2d5653406745d654904852e8a5de206406", "url": "https://github.com/TEAMMATES/teammates/commit/0a498e2d5653406745d654904852e8a5de206406", "message": "Refactor code\n\nCo-authored-by: Daryl Chan <6095637+dvrylc@users.noreply.github.com>", "committedDate": "2020-03-20T13:18:02Z", "type": "forcePushed"}, {"oid": "29a57a4141aa7e2ecbe7bdc0f22f9030e7e2e8e7", "url": "https://github.com/TEAMMATES/teammates/commit/29a57a4141aa7e2ecbe7bdc0f22f9030e7e2e8e7", "message": "Refactor code\n\nCo-authored-by: Daryl Chan <6095637+dvrylc@users.noreply.github.com>", "committedDate": "2020-03-21T14:36:36Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njg1MzQwNw==", "url": "https://github.com/TEAMMATES/teammates/pull/9991#discussion_r396853407", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            .forEach((InstructorData data) -> {\n          \n          \n            \n                            .forEach((InstructorData instructor) -> {\n          \n      \n    \n    \n  \n\ndata is too general.", "author": "xpdavid", "createdAt": "2020-03-24T01:27:00Z", "path": "src/main/java/teammates/ui/webapi/action/SearchInstructorsAction.java", "diffHunk": "@@ -26,13 +29,34 @@ public void checkSpecificAccessControl() {\n         }\n     }\n \n+    private void addAdditionalSearchFields(InstructorsData instructorsData, List<InstructorAttributes> instructors) {\n+        instructorsData.getInstructors()\n+                .forEach((InstructorData data) -> {", "originalCommit": "29a57a4141aa7e2ecbe7bdc0f22f9030e7e2e8e7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzk0Njg1Nw==", "url": "https://github.com/TEAMMATES/teammates/pull/9991#discussion_r397946857", "bodyText": "fixed", "author": "hcwong", "createdAt": "2020-03-25T15:29:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njg1MzQwNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njg1Mzc2Mg==", "url": "https://github.com/TEAMMATES/teammates/pull/9991#discussion_r396853762", "bodyText": "I think you should put the logic inside the construction of InstructorData.", "author": "xpdavid", "createdAt": "2020-03-24T01:28:16Z", "path": "src/main/java/teammates/ui/webapi/action/SearchInstructorsAction.java", "diffHunk": "@@ -26,13 +29,34 @@ public void checkSpecificAccessControl() {\n         }\n     }\n \n+    private void addAdditionalSearchFields(InstructorsData instructorsData, List<InstructorAttributes> instructors) {\n+        instructorsData.getInstructors()\n+                .forEach((InstructorData data) -> {\n+                    AccountAttributes account = logic.getAccount(data.getGoogleId());\n+                    if (account != null) {\n+                        String institute = StringHelper.isEmpty(account.institute) ? \"None\" : account.institute;\n+                        data.setInstitute(institute);\n+                    }\n+\n+                    // Add registration key", "originalCommit": "29a57a4141aa7e2ecbe7bdc0f22f9030e7e2e8e7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzk0Njk3Mg==", "url": "https://github.com/TEAMMATES/teammates/pull/9991#discussion_r397946972", "bodyText": "fixed. thanks!", "author": "hcwong", "createdAt": "2020-03-25T15:29:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njg1Mzc2Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njg1MzgxOA==", "url": "https://github.com/TEAMMATES/teammates/pull/9991#discussion_r396853818", "bodyText": "Remember to write a test for it.", "author": "xpdavid", "createdAt": "2020-03-24T01:28:33Z", "path": "src/main/java/teammates/ui/webapi/action/SearchInstructorsAction.java", "diffHunk": "@@ -26,13 +29,34 @@ public void checkSpecificAccessControl() {\n         }\n     }\n \n+    private void addAdditionalSearchFields(InstructorsData instructorsData, List<InstructorAttributes> instructors) {", "originalCommit": "29a57a4141aa7e2ecbe7bdc0f22f9030e7e2e8e7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzk0NzI1MA==", "url": "https://github.com/TEAMMATES/teammates/pull/9991#discussion_r397947250", "bodyText": "it's a private method so i checked for it in the existing classes if thats ok", "author": "hcwong", "createdAt": "2020-03-25T15:30:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njg1MzgxOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA4MjYzMg==", "url": "https://github.com/TEAMMATES/teammates/pull/9991#discussion_r398082632", "bodyText": "Of course, you are writing action-level test NOT unit-level test.", "author": "xpdavid", "createdAt": "2020-03-25T18:35:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njg1MzgxOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTc2NTkyMA==", "url": "https://github.com/TEAMMATES/teammates/pull/9991#discussion_r399765920", "bodyText": "Also, if you are adding institute, just call the method as addInstitueField", "author": "xpdavid", "createdAt": "2020-03-29T08:42:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njg1MzgxOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTc2NTk3MA==", "url": "https://github.com/TEAMMATES/teammates/pull/9991#discussion_r399765970", "bodyText": "Same as #9990 (comment)\nCan we improve this?", "author": "xpdavid", "createdAt": "2020-03-29T08:43:09Z", "path": "src/main/java/teammates/ui/webapi/output/InstructorData.java", "diffHunk": "@@ -85,6 +93,25 @@ public void setJoinState(JoinState joinState) {\n         this.joinState = joinState;\n     }\n \n+    public String getKey() {\n+        return key;\n+    }\n+\n+    public void setKey(List<InstructorAttributes> instructorAttributes) {\n+        this.key = StringHelper.encrypt(instructorAttributes.stream()\n+                .filter((InstructorAttributes instructorAttribute)", "originalCommit": "7bde3562c074896ab2fc90337d322d124a87bb6e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTgwNjk1Mw==", "url": "https://github.com/TEAMMATES/teammates/pull/9991#discussion_r399806953", "bodyText": "Same comment but I copy pasted herre for ease of reference\nHey Xiao Pu,\nI think there were two alternatives I considered when doing this.\nFirst, is to put the key generation inside the constructor. However, this will place the burden of hiding the key on the developer. Since Teammates has many contributors, I opted not to do this as people who use StudentsData in the future may not be aware of this and thus send the key.\nYea, theres a runtime issue, but I think this should be fine as its Java, so it should run faster and because the performance bottleneck is at the frontend side.\nWhat do you think?", "author": "hcwong", "createdAt": "2020-03-29T14:39:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTc2NTk3MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzY0ODE2NQ==", "url": "https://github.com/TEAMMATES/teammates/pull/9991#discussion_r403648165", "bodyText": "I think we should put this logic and the one for setting the key together since both manipulate the InstructorData object.", "author": "dvrylc", "createdAt": "2020-04-05T04:40:25Z", "path": "src/main/java/teammates/ui/webapi/action/SearchInstructorsAction.java", "diffHunk": "@@ -26,13 +29,40 @@ public void checkSpecificAccessControl() {\n         }\n     }\n \n+    private void addAdditionalSearchFields(InstructorsData instructorsData) {\n+        instructorsData.getInstructors()\n+                .forEach((InstructorData instructor) -> {\n+                    if (instructor.getGoogleId() != null) {\n+                        AccountAttributes account = logic.getAccount(instructor.getGoogleId());\n+                        if (account != null) {\n+                            String institute = StringHelper.isEmpty(account.institute) ? \"None\" : account.institute;\n+                            instructor.setInstitute(institute);\n+                        }\n+                    }", "originalCommit": "dda3a0cfecac5435f0a5d9fef158ba3c9cf568b2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzY0ODI3Mg==", "url": "https://github.com/TEAMMATES/teammates/pull/9991#discussion_r403648272", "bodyText": "Since this method is named add..., it's probably not a good idea to be hiding (removing) things here. We could either change this method's name or leave the hiding call in the main execute() method.", "author": "dvrylc", "createdAt": "2020-04-05T04:42:25Z", "path": "src/main/java/teammates/ui/webapi/action/SearchInstructorsAction.java", "diffHunk": "@@ -26,13 +29,40 @@ public void checkSpecificAccessControl() {\n         }\n     }\n \n+    private void addAdditionalSearchFields(InstructorsData instructorsData) {\n+        instructorsData.getInstructors()\n+                .forEach((InstructorData instructor) -> {\n+                    if (instructor.getGoogleId() != null) {\n+                        AccountAttributes account = logic.getAccount(instructor.getGoogleId());\n+                        if (account != null) {\n+                            String institute = StringHelper.isEmpty(account.institute) ? \"None\" : account.institute;\n+                            instructor.setInstitute(institute);\n+                        }\n+                    }\n+                    // Hide information\n+                    instructor.hideInformationForSearch();", "originalCommit": "dda3a0cfecac5435f0a5d9fef158ba3c9cf568b2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzcxNTU5OA==", "url": "https://github.com/TEAMMATES/teammates/pull/9991#discussion_r403715598", "bodyText": "ah trudat", "author": "hcwong", "createdAt": "2020-04-05T15:16:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzY0ODI3Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzY0ODczMQ==", "url": "https://github.com/TEAMMATES/teammates/pull/9991#discussion_r403648731", "bodyText": "Similar comments to https://github.com/TEAMMATES/teammates/pull/9990/files#r403644820", "author": "dvrylc", "createdAt": "2020-04-05T04:49:08Z", "path": "src/main/java/teammates/ui/webapi/output/InstructorsData.java", "diffHunk": "@@ -10,7 +10,11 @@\n  */\n public class InstructorsData extends ApiOutput {\n \n-    private final List<InstructorData> instructors;\n+    private List<InstructorData> instructors;\n+\n+    public InstructorsData() {\n+        // Use this constructor if InstructorData should be sent with the key\n+    }", "originalCommit": "dda3a0cfecac5435f0a5d9fef158ba3c9cf568b2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "8c39da06cc753cf5d0520386bf962a4aee7f1638", "url": "https://github.com/TEAMMATES/teammates/commit/8c39da06cc753cf5d0520386bf962a4aee7f1638", "message": "Add institute and key to InstructorData", "committedDate": "2020-04-05T15:17:15Z", "type": "commit"}, {"oid": "10098bdc74044912b5ba832fe3a8f303e68b371a", "url": "https://github.com/TEAMMATES/teammates/commit/10098bdc74044912b5ba832fe3a8f303e68b371a", "message": "Fix logic", "committedDate": "2020-04-05T15:17:15Z", "type": "commit"}, {"oid": "d2c5721fb86303464bd7f7c71e9ebbf68c4e674a", "url": "https://github.com/TEAMMATES/teammates/commit/d2c5721fb86303464bd7f7c71e9ebbf68c4e674a", "message": "Make institute nullable", "committedDate": "2020-04-05T15:17:15Z", "type": "commit"}, {"oid": "ae049436ce6482185aec47a4b1e0e7c64e5c7eca", "url": "https://github.com/TEAMMATES/teammates/commit/ae049436ce6482185aec47a4b1e0e7c64e5c7eca", "message": "Neaten code", "committedDate": "2020-04-05T15:17:15Z", "type": "commit"}, {"oid": "87a32c9d2d965a9e9ea169fa0004b6b49dfcf0ce", "url": "https://github.com/TEAMMATES/teammates/commit/87a32c9d2d965a9e9ea169fa0004b6b49dfcf0ce", "message": "Refactor code\n\nCo-authored-by: Daryl Chan <6095637+dvrylc@users.noreply.github.com>", "committedDate": "2020-04-05T15:17:15Z", "type": "commit"}, {"oid": "de486226215c8a2d3a80bd68e77fa243de2dd313", "url": "https://github.com/TEAMMATES/teammates/commit/de486226215c8a2d3a80bd68e77fa243de2dd313", "message": "Fix comments", "committedDate": "2020-04-05T15:17:15Z", "type": "commit"}, {"oid": "aa024b83b02c5584546a9a34a7f963877f451ac1", "url": "https://github.com/TEAMMATES/teammates/commit/aa024b83b02c5584546a9a34a7f963877f451ac1", "message": "Remove O(n^2) calls", "committedDate": "2020-04-05T15:17:15Z", "type": "commit"}, {"oid": "475aa13c36eeec4a7136fceca80241b83511b0d2", "url": "https://github.com/TEAMMATES/teammates/commit/475aa13c36eeec4a7136fceca80241b83511b0d2", "message": "Add comment on key", "committedDate": "2020-04-05T15:17:15Z", "type": "commit"}, {"oid": "2066722ecf2ea178d2f578efde32d260a575eb3f", "url": "https://github.com/TEAMMATES/teammates/commit/2066722ecf2ea178d2f578efde32d260a575eb3f", "message": "Fix comments", "committedDate": "2020-04-05T15:41:18Z", "type": "commit"}, {"oid": "2066722ecf2ea178d2f578efde32d260a575eb3f", "url": "https://github.com/TEAMMATES/teammates/commit/2066722ecf2ea178d2f578efde32d260a575eb3f", "message": "Fix comments", "committedDate": "2020-04-05T15:41:18Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDUxNDQ0NA==", "url": "https://github.com/TEAMMATES/teammates/pull/9991#discussion_r404514444", "bodyText": "Can we standardize one the information hiding? Either we want to do it in this way or use the convention hideInformationForXXX.", "author": "xpdavid", "createdAt": "2020-04-07T03:29:15Z", "path": "src/main/java/teammates/ui/webapi/action/SearchInstructorsAction.java", "diffHunk": "@@ -30,9 +33,28 @@ public void checkSpecificAccessControl() {\n     public ActionResult execute() {\n         String searchKey = getNonNullRequestParamValue(Const.ParamsNames.ADMIN_SEARCH_KEY);\n         List<InstructorAttributes> instructors = logic.searchInstructorsInWholeSystem(searchKey).instructorList;\n-        InstructorsData instructorsData = new InstructorsData(instructors);\n-        // Hide information\n+\n+        List<InstructorData> instructorDataList = new ArrayList<>();\n+        for (InstructorAttributes instructor : instructors) {\n+            InstructorData instructorData = new InstructorData(instructor);\n+            // Only admin will be able to access this page, so we can go ahead and set the key\n+            instructorData.setKey(StringHelper.encrypt(instructor.getKey()));", "originalCommit": "2066722ecf2ea178d2f578efde32d260a575eb3f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDUzMDc4Ng==", "url": "https://github.com/TEAMMATES/teammates/pull/9991#discussion_r404530786", "bodyText": "Cool, I've created a corresponding addAdditionalInformationAsXXX", "author": "hcwong", "createdAt": "2020-04-07T04:40:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDUxNDQ0NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDUxNDY3Mg==", "url": "https://github.com/TEAMMATES/teammates/pull/9991#discussion_r404514672", "bodyText": "I think there is no need to mention this.", "author": "xpdavid", "createdAt": "2020-04-07T03:30:12Z", "path": "src/main/java/teammates/ui/webapi/output/InstructorsData.java", "diffHunk": "@@ -10,7 +11,13 @@\n  */\n public class InstructorsData extends ApiOutput {\n \n-    private final List<InstructorData> instructors;\n+    private List<InstructorData> instructors;\n+\n+    public InstructorsData() {\n+        // Only use this constructor for SearchInstructorsAction,", "originalCommit": "2066722ecf2ea178d2f578efde32d260a575eb3f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "bc20dba5d4b1e57be30be27000b81ccba6c0c745", "url": "https://github.com/TEAMMATES/teammates/commit/bc20dba5d4b1e57be30be27000b81ccba6c0c745", "message": "Fix comment", "committedDate": "2020-04-07T04:28:05Z", "type": "commit"}, {"oid": "0f05113dd86358e5f8d1e7b94597d0f5079ec051", "url": "https://github.com/TEAMMATES/teammates/commit/0f05113dd86358e5f8d1e7b94597d0f5079ec051", "message": "Fix comments", "committedDate": "2020-04-07T05:57:37Z", "type": "commit"}, {"oid": "0f05113dd86358e5f8d1e7b94597d0f5079ec051", "url": "https://github.com/TEAMMATES/teammates/commit/0f05113dd86358e5f8d1e7b94597d0f5079ec051", "message": "Fix comments", "committedDate": "2020-04-07T05:57:37Z", "type": "forcePushed"}, {"oid": "714d07192e01b3545183571166fedaa6e330d651", "url": "https://github.com/TEAMMATES/teammates/commit/714d07192e01b3545183571166fedaa6e330d651", "message": "Retrigger travis", "committedDate": "2020-04-07T09:06:56Z", "type": "commit"}, {"oid": "714d07192e01b3545183571166fedaa6e330d651", "url": "https://github.com/TEAMMATES/teammates/commit/714d07192e01b3545183571166fedaa6e330d651", "message": "Retrigger travis", "committedDate": "2020-04-07T09:06:56Z", "type": "forcePushed"}, {"oid": "0f4aae22d7b17b40320b81c0a3907b754c8c1c26", "url": "https://github.com/TEAMMATES/teammates/commit/0f4aae22d7b17b40320b81c0a3907b754c8c1c26", "message": "retrigger travis again again", "committedDate": "2020-04-07T09:34:39Z", "type": "commit"}, {"oid": "b7f4935ad9808ae196fa34a0d62d094488c9dc83", "url": "https://github.com/TEAMMATES/teammates/commit/b7f4935ad9808ae196fa34a0d62d094488c9dc83", "message": "Retrigger travis x3", "committedDate": "2020-04-07T09:50:15Z", "type": "commit"}]}