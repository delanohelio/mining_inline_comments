{"pr_number": 10120, "pr_title": "[#10102] Add participant comment to student session result", "pr_createdAt": "2020-05-26T09:57:01Z", "pr_url": "https://github.com/TEAMMATES/teammates/pull/10120", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQyMTY1OQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10120#discussion_r430421659", "bodyText": "Is it possible to move this to the ts file instead? Genuine question, I'm not that familiar with Angular haha", "author": "madanalogy", "createdAt": "2020-05-26T13:42:54Z", "path": "src/web/app/components/question-responses/student-view-responses/student-view-responses.component.html", "diffHunk": "@@ -16,6 +16,35 @@\n               <tm-single-response [responseDetails]=\"response.responseDetails\" [questionDetails]=\"questionDetails\" [isStudentPage]=\"true\"></tm-single-response>\n             </td>\n           </tr>\n+          <tr *ngIf=\"response.participantComment\">\n+            <td>\n+              <tm-comment-row\n+                              [mode]=\"CommentRowMode.EDIT\"\n+                              [isVisibilityOptionEnabled]=\"false\"\n+                              [isDisabled]=\"true\"\n+                              [shouldHideSavingButton]=\"true\"\n+                              [shouldHideClosingButton]=\"true\"\n+                              [shouldHideEditButton]=\"true\"\n+                              [shouldHideDeleteButton]=\"true\"\n+                              [isFeedbackParticipantComment]=\"true\"\n+                              [response]=\"response\"\n+                              [questionShowResponsesTo]=\"[]\"\n+                              [model]=\"\n+                                {\n+                                  commentEditFormModel: {\n+                                    commentText: response.participantComment.commentText,\n+                                    isUsingCustomVisibilities: false,\n+                                    showCommentTo: response.participantComment.showCommentTo,\n+                                    showGiverNameTo: response.participantComment.showGiverNameTo\n+                                  },\n+                                  originalComment: response.participantComment,\n+                                  isEditing: false,\n+                                  commentGiverName: response.participantComment.commentGiverName,\n+                                  lastEditorName: response.participantComment.lastEditorName\n+                                }\"", "originalCommit": "55b852f39a931c24cc8953288e063d669ec2a2a5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQzMzg2MA==", "url": "https://github.com/TEAMMATES/teammates/pull/10120#discussion_r430433860", "bodyText": "I'm also not that familiar with Angular :)\nI wanted to do that as well, but the data is in the loop *ngFor=\"let response of responses. I will have to do a map on responses to add a new attribute model to each response and reference it here.\nFeel that writing it in the template file is much clearer, unless there is a better way to do it.", "author": "ccyccyccy", "createdAt": "2020-05-26T13:59:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQyMTY1OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQzNTI3OA==", "url": "https://github.com/TEAMMATES/teammates/pull/10120#discussion_r430435278", "bodyText": "Gotcha will ask senior devs for input on this", "author": "madanalogy", "createdAt": "2020-05-26T14:01:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQyMTY1OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDY0NDc5Mw==", "url": "https://github.com/TEAMMATES/teammates/pull/10120#discussion_r430644793", "bodyText": "Searching for examples in code base is something a good option:\n\n  \n    \n      teammates/src/web/app/components/question-responses/grouped-responses/grouped-responses.component.html\n    \n    \n        Lines 22 to 30\n      in\n      0e16875\n    \n    \n    \n    \n\n        \n          \n           <tm-comment-row *ngIf=\"response.allResponses[0].participantComment\" \n        \n\n        \n          \n                           [model]=\"transformParticipantCommentToCommandRowModel(response.allResponses[0].participantComment)\" \n        \n\n        \n          \n                           [questionShowResponsesTo]=\"response.feedbackQuestion.showResponsesTo\" \n        \n\n        \n          \n                           [isDisabled]=\"true\" [isVisibilityOptionEnabled]=\"false\" \n        \n\n        \n          \n                           [mode]=\"CommentRowMode.EDIT\" \n        \n\n        \n          \n                           [isFeedbackParticipantComment]=\"true\" \n        \n\n        \n          \n                           [shouldHideDeleteButton]=\"true\" \n        \n\n        \n          \n                           [shouldHideEditButton]=\"true\" \n        \n\n        \n          \n           ></tm-comment-row>", "author": "xpdavid", "createdAt": "2020-05-26T19:11:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQyMTY1OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDg2MDc2MQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10120#discussion_r430860761", "bodyText": "Thanks for the suggestion! However, I realise that the same function is ran multiple times whenever I do something on the page, like clicking on anything on the page. Most likely something to do with Angular's change detection mechanism.\nDo you think it's worth optimizing this, like using a pure pipe instead of simply calling a function in the template?", "author": "ccyccyccy", "createdAt": "2020-05-27T05:12:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQyMTY1OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDg2MTI1OQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10120#discussion_r430861259", "bodyText": "Just clicking non-clickable thing?", "author": "xpdavid", "createdAt": "2020-05-27T05:14:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQyMTY1OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDg2MTcxMA==", "url": "https://github.com/TEAMMATES/teammates/pull/10120#discussion_r430861710", "bodyText": "Yup just clicking anywhere on the page, clickable or not. Tested this by adding a console log to the function.", "author": "ccyccyccy", "createdAt": "2020-05-27T05:16:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQyMTY1OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDg2MzI5Mw==", "url": "https://github.com/TEAMMATES/teammates/pull/10120#discussion_r430863293", "bodyText": "Let's just be clear.\nIf you make a method like transformParticipantCommentToCommandRowModel, then you are saying that when you do something on the page, the method gets called multiple time.  How do you know that the method is ran multiple times (by adding console.log?)", "author": "xpdavid", "createdAt": "2020-05-27T05:23:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQyMTY1OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDg3MDIzMg==", "url": "https://github.com/TEAMMATES/teammates/pull/10120#discussion_r430870232", "bodyText": "If you make a method like transformParticipantCommentToCommandRowModel, then you are saying that when you do something on the page, the method gets called multiple time.\n\nYes. Actually the current transformParticipantCommentToCommandRowModel function on the master branch also suffers from the same problem.\n\nHow do you know that the method is ran multiple times (by adding console.log?)\n\nTo reproduce:\n\nAdd a console.log(\"calling transform\"); to the current transformParticipantCommentToCommandRowModel function\n\ntransformParticipantCommentToCommandRowModel(participantComment: CommentOutput): CommentRowModel {\n    console.log(\"calling transform\");\n    return {\n      originalComment: participantComment,\n      timezone: this.session.timeZone,\n      commentGiverName: participantComment.commentGiverName,\n      lastEditorName: participantComment.lastEditorName,\n      commentEditFormModel: {\n        commentText: participantComment.commentText,\n        isUsingCustomVisibilities: false,\n        showCommentTo: [],\n        showGiverNameTo: [],\n      },\n      isEditing: false,\n    };\n  }\n\n\nNavigate to a page that uses `GroupedResponsesComponent such as the instructor session result page.\nEnsure that it has participant comments and the responses are grouped by GRQ or RGQ\nClick anywhere on the page.", "author": "ccyccyccy", "createdAt": "2020-05-27T05:46:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQyMTY1OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDg3NTQ4MQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10120#discussion_r430875481", "bodyText": "https://medium.com/showpad-engineering/why-you-should-never-use-function-calls-in-angular-template-expressions-e1a50f9c0496\nGood catching \ud83d\udcaf\nSo if we construct the object in the template file, can we avoid this?", "author": "xpdavid", "createdAt": "2020-05-27T06:02:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQyMTY1OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDg4NDM0MQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10120#discussion_r430884341", "bodyText": "That's what I hoped... But I can't find any mention of this strategy anywhere, and I'm not sure on how to test it as well.\nPersonally think that pure pipe is better, since we can facilitate code reuse while resolving this issue, as long as the input participantComment: CommentOutput is immutable.", "author": "ccyccyccy", "createdAt": "2020-05-27T06:27:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQyMTY1OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDg5OTY5MQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10120#discussion_r430899691", "bodyText": "I think we can try pipe. You can add one in comment-box module.", "author": "xpdavid", "createdAt": "2020-05-27T07:05:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQyMTY1OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDkxOTg3Mw==", "url": "https://github.com/TEAMMATES/teammates/pull/10120#discussion_r430919873", "bodyText": "Got it. Will do.", "author": "ccyccyccy", "createdAt": "2020-05-27T07:45:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQyMTY1OQ=="}], "type": "inlineReview"}, {"oid": "e6079aaf3bc1d261f34fe5ff341fcb3db3f0d57f", "url": "https://github.com/TEAMMATES/teammates/commit/e6079aaf3bc1d261f34fe5ff341fcb3db3f0d57f", "message": "Convert to use pipes", "committedDate": "2020-05-27T08:48:15Z", "type": "forcePushed"}, {"oid": "82a13944710b561be2f8ed588310e90afbd7a017", "url": "https://github.com/TEAMMATES/teammates/commit/82a13944710b561be2f8ed588310e90afbd7a017", "message": "Add participant comment to student session result", "committedDate": "2020-05-28T03:51:09Z", "type": "commit"}, {"oid": "31abf1290c9c4ef01ccb28a880a695ede5fce623", "url": "https://github.com/TEAMMATES/teammates/commit/31abf1290c9c4ef01ccb28a880a695ede5fce623", "message": "Fix test", "committedDate": "2020-05-28T03:51:09Z", "type": "commit"}, {"oid": "520984830897fd617dd92d60dcf3fdc1f4e1b748", "url": "https://github.com/TEAMMATES/teammates/commit/520984830897fd617dd92d60dcf3fdc1f4e1b748", "message": "Convert to use pipes", "committedDate": "2020-05-28T03:51:09Z", "type": "commit"}, {"oid": "8293acb07ee7546bb5968f65a0f46bfa78a130be", "url": "https://github.com/TEAMMATES/teammates/commit/8293acb07ee7546bb5968f65a0f46bfa78a130be", "message": "Add visibility for comments", "committedDate": "2020-05-28T03:51:09Z", "type": "commit"}, {"oid": "8293acb07ee7546bb5968f65a0f46bfa78a130be", "url": "https://github.com/TEAMMATES/teammates/commit/8293acb07ee7546bb5968f65a0f46bfa78a130be", "message": "Add visibility for comments", "committedDate": "2020-05-28T03:51:09Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTU4NDE1Mw==", "url": "https://github.com/TEAMMATES/teammates/pull/10120#discussion_r431584153", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              CommentRowMode: typeof CommentRowMode = CommentRowMode;\n          \n          \n            \n              // enum\n          \n          \n            \n              CommentRowMode: typeof CommentRowMode = CommentRowMode;", "author": "xpdavid", "createdAt": "2020-05-28T05:09:05Z", "path": "src/web/app/components/question-responses/student-view-responses/student-view-responses.component.ts", "diffHunk": "@@ -10,11 +11,9 @@ import { FeedbackQuestionDetails, FeedbackQuestionType, ResponseOutput } from '.\n   styleUrls: ['./student-view-responses.component.scss'],\n })\n export class StudentViewResponsesComponent implements OnInit {\n+  CommentRowMode: typeof CommentRowMode = CommentRowMode;", "originalCommit": "8293acb07ee7546bb5968f65a0f46bfa78a130be", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTU4NDI5NA==", "url": "https://github.com/TEAMMATES/teammates/pull/10120#discussion_r431584294", "bodyText": "I can we avoid using !?", "author": "xpdavid", "createdAt": "2020-05-28T05:09:42Z", "path": "src/web/app/components/question-responses/student-view-responses/student-view-responses.component.ts", "diffHunk": "@@ -10,11 +11,9 @@ import { FeedbackQuestionDetails, FeedbackQuestionType, ResponseOutput } from '.\n   styleUrls: ['./student-view-responses.component.scss'],\n })\n export class StudentViewResponsesComponent implements OnInit {\n+  CommentRowMode: typeof CommentRowMode = CommentRowMode;\n \n-  @Input() questionDetails: FeedbackQuestionDetails = {\n-    questionType: FeedbackQuestionType.TEXT,\n-    questionText: '',\n-  };\n+  @Input() feedbackQuestion!: FeedbackQuestion;", "originalCommit": "8293acb07ee7546bb5968f65a0f46bfa78a130be", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTU4NDM5NA==", "url": "https://github.com/TEAMMATES/teammates/pull/10120#discussion_r431584394", "bodyText": "Technically this should be true", "author": "xpdavid", "createdAt": "2020-05-28T05:10:06Z", "path": "src/web/app/components/question-responses/student-view-responses/student-view-responses.component.html", "diffHunk": "@@ -13,7 +13,24 @@\n           </tr>\n           <tr>\n             <td>\n-              <tm-single-response [responseDetails]=\"response.responseDetails\" [questionDetails]=\"questionDetails\" [isStudentPage]=\"true\"></tm-single-response>\n+              <tm-single-response [responseDetails]=\"response.responseDetails\" [questionDetails]=\"feedbackQuestion.questionDetails\" [isStudentPage]=\"true\"></tm-single-response>\n+            </td>\n+          </tr>\n+          <tr *ngIf=\"response.participantComment\">\n+            <td>\n+              <tm-comment-row\n+                              [mode]=\"CommentRowMode.EDIT\"\n+                              [isVisibilityOptionEnabled]=\"false\"\n+                              [isDisabled]=\"false\"", "originalCommit": "8293acb07ee7546bb5968f65a0f46bfa78a130be", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "4c45723af0c168b07093d0d7740d1a8edcb68bed", "url": "https://github.com/TEAMMATES/teammates/commit/4c45723af0c168b07093d0d7740d1a8edcb68bed", "message": "Fix issues raised by review", "committedDate": "2020-05-28T05:17:24Z", "type": "commit"}, {"oid": "aa38a4ab979a1763da6922ad86c1cb6cae8ace45", "url": "https://github.com/TEAMMATES/teammates/commit/aa38a4ab979a1763da6922ad86c1cb6cae8ace45", "message": "Fix lint", "committedDate": "2020-05-28T05:23:38Z", "type": "commit"}]}