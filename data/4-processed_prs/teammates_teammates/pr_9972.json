{"pr_number": 9972, "pr_title": "[#9940] Instructor module: standardize API endpoints, remove HttpRequestService", "pr_createdAt": "2020-02-27T15:29:37Z", "pr_url": "https://github.com/TEAMMATES/teammates/pull/9972", "timeline": [{"oid": "de3f50974853e5e870b495208ad972b544dd020e", "url": "https://github.com/TEAMMATES/teammates/commit/de3f50974853e5e870b495208ad972b544dd020e", "message": "Create unpublishFeedbackSession in feedback session service", "committedDate": "2020-02-27T15:05:11Z", "type": "commit"}, {"oid": "33e76124d58df327c762f3f16938c25f8db5a32f", "url": "https://github.com/TEAMMATES/teammates/commit/33e76124d58df327c762f3f16938c25f8db5a32f", "message": "Refactor URI string literals", "committedDate": "2020-02-27T15:05:11Z", "type": "commit"}, {"oid": "525ac8bb64472956faec84ad12a528fc26f92de8", "url": "https://github.com/TEAMMATES/teammates/commit/525ac8bb64472956faec84ad12a528fc26f92de8", "message": "Add all API endpoints", "committedDate": "2020-02-27T15:05:11Z", "type": "commit"}, {"oid": "d12e74c6c0c85863b4a04e6800e51b8b7e2811cd", "url": "https://github.com/TEAMMATES/teammates/commit/d12e74c6c0c85863b4a04e6800e51b8b7e2811cd", "message": "Remove HttpRequestService from instructor-student-list-page", "committedDate": "2020-02-27T15:05:11Z", "type": "commit"}, {"oid": "f8457142581bed18024f6382c13f42e654cda6e0", "url": "https://github.com/TEAMMATES/teammates/commit/f8457142581bed18024f6382c13f42e654cda6e0", "message": "Refactor load instructor privilege", "committedDate": "2020-02-27T15:05:11Z", "type": "commit"}, {"oid": "8558bae08de3cc1b81b793a277405369bc789d1f", "url": "https://github.com/TEAMMATES/teammates/commit/8558bae08de3cc1b81b793a277405369bc789d1f", "message": "Remove HttpRequestService from instructor-session-base-page", "committedDate": "2020-02-27T15:05:11Z", "type": "commit"}, {"oid": "45c9c2d13da930d167480bae3f08aa22a2859c24", "url": "https://github.com/TEAMMATES/teammates/commit/45c9c2d13da930d167480bae3f08aa22a2859c24", "message": "Remove HttpRequestService from instructor sessions", "committedDate": "2020-02-27T15:05:11Z", "type": "commit"}, {"oid": "cf57766bbc67113814c632ce78a84259834862c7", "url": "https://github.com/TEAMMATES/teammates/commit/cf57766bbc67113814c632ce78a84259834862c7", "message": "Add tests for course and questions service", "committedDate": "2020-02-27T15:05:11Z", "type": "commit"}, {"oid": "88dfaa0207b6d873999dc7caa333a51adc6f1c7b", "url": "https://github.com/TEAMMATES/teammates/commit/88dfaa0207b6d873999dc7caa333a51adc6f1c7b", "message": "Add sessions and instructor tests", "committedDate": "2020-02-27T15:25:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTU0ODAwMQ==", "url": "https://github.com/TEAMMATES/teammates/pull/9972#discussion_r385548001", "bodyText": "The cron job's URL should not be exposed right?", "author": "xpdavid", "createdAt": "2020-02-28T07:42:48Z", "path": "src/main/java/teammates/ui/webapi/endpoints/CronJobEndpoints.java", "diffHunk": "@@ -0,0 +1,31 @@\n+package teammates.ui.webapi.endpoints;\n+\n+import com.fasterxml.jackson.annotation.JsonValue;\n+\n+import teammates.common.util.Const.CronJobURIs;\n+\n+/**\n+ * API endpoints for cron jobs.\n+ */\n+public enum CronJobEndpoints {", "originalCommit": "88dfaa0207b6d873999dc7caa333a51adc6f1c7b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTU1MDQyNg==", "url": "https://github.com/TEAMMATES/teammates/pull/9972#discussion_r385550426", "bodyText": "I created the endpoints because I wasn't too sure if we might need it, but since it's unnecessary I will remove it.", "author": "tiuweehan", "createdAt": "2020-02-28T07:50:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTU0ODAwMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTU1MDcyMw==", "url": "https://github.com/TEAMMATES/teammates/pull/9972#discussion_r385550723", "bodyText": "Both should not be exposed if you take a careful look at what they do.", "author": "xpdavid", "createdAt": "2020-02-28T07:51:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTU0ODAwMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTU1NDIyMg==", "url": "https://github.com/TEAMMATES/teammates/pull/9972#discussion_r385554222", "bodyText": "Yup the cron's URLs are used only in the backend so I understand why we don't need it. I'm not too sure about  the legacy URLs, but I suppose since it's legacy we're trying to avoid using them.\nI have removed both from my PR. Is there anything else I need to add/change? Otherwise I think this PR is ready. (There are more instructor modules with HttpRequestService, but this PR might become very large if I refactored them too, so I'm planning to do them in another PR)", "author": "tiuweehan", "createdAt": "2020-02-28T08:01:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTU0ODAwMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTU0ODA4MQ==", "url": "https://github.com/TEAMMATES/teammates/pull/9972#discussion_r385548081", "bodyText": "I don't think this one should be exposed either.", "author": "xpdavid", "createdAt": "2020-02-28T07:43:06Z", "path": "src/main/java/teammates/ui/webapi/endpoints/LegacyEndpoints.java", "diffHunk": "@@ -0,0 +1,31 @@\n+package teammates.ui.webapi.endpoints;\n+\n+import com.fasterxml.jackson.annotation.JsonValue;\n+\n+import teammates.common.util.Const.LegacyURIs;\n+\n+/**\n+ * Legacy API endpoints.\n+ */\n+public enum LegacyEndpoints {", "originalCommit": "88dfaa0207b6d873999dc7caa333a51adc6f1c7b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "2aaf6a8227842855398c5b240c91aa48880c97cc", "url": "https://github.com/TEAMMATES/teammates/commit/2aaf6a8227842855398c5b240c91aa48880c97cc", "message": "Remove Cron job and Legacy API endpoints", "committedDate": "2020-02-28T07:51:16Z", "type": "commit"}, {"oid": "addd29d18f9e3cfd6657967fa51b59b0eb61bb6b", "url": "https://github.com/TEAMMATES/teammates/commit/addd29d18f9e3cfd6657967fa51b59b0eb61bb6b", "message": "Merge branch 'master' into 9940-standardize-instructor-api-endpoints\n\n* master:\n  [#9382] Add MasqueradeModeService Tests (#9955)\n  [#9302] Support rich text for MCQ option text (#9944)\n  [#9642] Feedback sessions with # or ? in their name can't be edited. (#9925)\n  [#9970] Fix failing Travis build (#9971)", "committedDate": "2020-02-28T12:47:52Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjEzNjg2OQ==", "url": "https://github.com/TEAMMATES/teammates/pull/9972#discussion_r386136869", "bodyText": "Question: Is this a good design? (i.e. let the backend to decide what the frontend URL should be). Looks like it should be other way around. the control of frontend URL should be in the frontend rather than the backend.", "author": "xpdavid", "createdAt": "2020-03-01T20:13:17Z", "path": "src/main/java/teammates/ui/webapi/endpoints/WebPageEndpoints.java", "diffHunk": "@@ -0,0 +1,51 @@\n+package teammates.ui.webapi.endpoints;\n+\n+import com.fasterxml.jackson.annotation.JsonValue;\n+\n+import teammates.common.util.Const.WebPageURIs;\n+\n+/**\n+ * API endpoints for web pages.\n+ */\n+public enum WebPageEndpoints {", "originalCommit": "addd29d18f9e3cfd6657967fa51b59b0eb61bb6b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjIwNDgwOQ==", "url": "https://github.com/TEAMMATES/teammates/pull/9972#discussion_r386204809", "bodyText": "Isn't this the current design implementation as well? The URLs are defined in the Const.java file, and are matched by the frontend string literals.\nI'm not sure if there are any gradle plugins that can convert TypeScript enums to Java enums, but I'll look into it.", "author": "tiuweehan", "createdAt": "2020-03-02T05:38:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjEzNjg2OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjIwNTc0NA==", "url": "https://github.com/TEAMMATES/teammates/pull/9972#discussion_r386205744", "bodyText": "Isn't this the current design implementation as well?\n\nYou are syncing this file WebPageEndpoints.java to the frontend right? In what situation will the frontend use this file? You might argue that this file can be used for any redirections in the frontend. But my question is, if one days the redirection changes, you should also modify the file in the backend which is a bit weired.", "author": "xpdavid", "createdAt": "2020-03-02T05:43:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjEzNjg2OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjIyMDMzMQ==", "url": "https://github.com/TEAMMATES/teammates/pull/9972#discussion_r386220331", "bodyText": "I see what you mean. My intention was to sync both endpoints on the frontend and backend, so I thought it would be best to use a single source of truth in Const.java.\nIf that's the case, should I just remove WebPageEndpoints.java entirely?", "author": "tiuweehan", "createdAt": "2020-03-02T06:49:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjEzNjg2OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjEzNjkzOA==", "url": "https://github.com/TEAMMATES/teammates/pull/9972#discussion_r386136938", "bodyText": "undefined?", "author": "xpdavid", "createdAt": "2020-03-01T20:14:15Z", "path": "src/web/app/pages-instructor/instructor-session-base-page.component.ts", "diffHunk": "@@ -152,10 +152,11 @@ export abstract class InstructorSessionBasePageComponent {\n    * Updates the instructor privilege in {@code SessionsTableRowModel}.\n    */\n   protected updateInstructorPrivilege(model: SessionsTableRowModel): void {\n-    this.httpRequestService.get('/instructor/privilege', {\n-      courseid: model.feedbackSession.courseId,\n-      fsname: model.feedbackSession.feedbackSessionName,\n-    }).subscribe((instructorPrivilege: InstructorPrivilege) => {\n+    this.instructorService.loadInstructorPrivilege(\n+        model.feedbackSession.courseId,\n+        undefined,", "originalCommit": "addd29d18f9e3cfd6657967fa51b59b0eb61bb6b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjIwMjYyMg==", "url": "https://github.com/TEAMMATES/teammates/pull/9972#discussion_r386202622", "bodyText": "This method has multiple optional parameters, so I am using undefined to skip parameters\nhttps://stackoverflow.com/questions/8356227/skipping-optional-function-parameters-in-javascript", "author": "tiuweehan", "createdAt": "2020-03-02T05:26:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjEzNjkzOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjIwMjc5Mw==", "url": "https://github.com/TEAMMATES/teammates/pull/9972#discussion_r386202793", "bodyText": "Is it a good design of API?", "author": "xpdavid", "createdAt": "2020-03-02T05:27:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjEzNjkzOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjIwNDE3MQ==", "url": "https://github.com/TEAMMATES/teammates/pull/9972#discussion_r386204171", "bodyText": "The other option would be to pass the paramMap object, but I didn't think it was a good idea since { [key:string]: string } can contain other key-value pairs.\nThe other option is to create custom types for the function arguments. Would that be a better option?", "author": "tiuweehan", "createdAt": "2020-03-02T05:34:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjEzNjkzOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjIwNDM5Ng==", "url": "https://github.com/TEAMMATES/teammates/pull/9972#discussion_r386204396", "bodyText": "You have Typescript :P Try search typescript optional parameters", "author": "xpdavid", "createdAt": "2020-03-02T05:36:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjEzNjkzOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjIxOTYxNg==", "url": "https://github.com/TEAMMATES/teammates/pull/9972#discussion_r386219616", "bodyText": "Haha the method that I'm calling has 2 typescript optional parameters (i.e. method signature is  loadInstructorPrivilege(courseId: string, sectionName?: string, feedbackSessionName?: string)). In this case, the only optional parameter that I am using is feedbackSessionName, so based on TypeScript's documentation I should use undefined for the second parameter. Please correct me if I'm wrong \ud83d\ude05", "author": "tiuweehan", "createdAt": "2020-03-02T06:46:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjEzNjkzOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTIzNDk0Ng==", "url": "https://github.com/TEAMMATES/teammates/pull/9972#discussion_r389234946", "bodyText": "I think you can also try to define the interface on the fly:\nloadInstructorPrivilege(param: { courseId: string, sectionName?: string, feedbackSessionName?: string })", "author": "xpdavid", "createdAt": "2020-03-07T07:20:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjEzNjkzOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjEzNjk4OQ==", "url": "https://github.com/TEAMMATES/teammates/pull/9972#discussion_r386136989", "bodyText": "Where does this line goes?", "author": "xpdavid", "createdAt": "2020-03-01T20:15:14Z", "path": "src/web/app/pages-instructor/instructor-session-base-page.component.ts", "diffHunk": "@@ -166,15 +167,11 @@ export abstract class InstructorSessionBasePageComponent {\n    * Loads response rate of a feedback session.\n    */\n   loadResponseRate(model: SessionsTableRowModel): void {\n-    model.isLoadingResponseRate = true;", "originalCommit": "addd29d18f9e3cfd6657967fa51b59b0eb61bb6b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjEzNzA3OQ==", "url": "https://github.com/TEAMMATES/teammates/pull/9972#discussion_r386137079", "bodyText": "I don't think it is a good practice to pass the whole model into the service. The service should only get what are necessary.", "author": "xpdavid", "createdAt": "2020-03-01T20:16:22Z", "path": "src/web/app/pages-instructor/instructor-session-base-page.component.ts", "diffHunk": "@@ -166,15 +167,11 @@ export abstract class InstructorSessionBasePageComponent {\n    * Loads response rate of a feedback session.\n    */\n   loadResponseRate(model: SessionsTableRowModel): void {\n-    model.isLoadingResponseRate = true;\n-    const paramMap: { [key: string]: string } = {\n-      courseid: model.feedbackSession.courseId,\n-      fsname: model.feedbackSession.feedbackSessionName,\n-    };\n-    this.httpRequestService.get('/session/stats', paramMap).subscribe((resp: FeedbackSessionStats) => {\n-      model.isLoadingResponseRate = false;\n-      model.responseRate = `${resp.submittedTotal} / ${resp.expectedTotal}`;\n-    }, (resp: ErrorMessageOutput) => { this.statusMessageService.showErrorMessage(resp.error.message); });\n+    this.feedbackSessionsService.loadSessionStatistics(model)", "originalCommit": "addd29d18f9e3cfd6657967fa51b59b0eb61bb6b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjEzNzA5Nw==", "url": "https://github.com/TEAMMATES/teammates/pull/9972#discussion_r386137097", "bodyText": "Same here.", "author": "xpdavid", "createdAt": "2020-03-01T20:16:39Z", "path": "src/web/app/pages-instructor/instructor-session-base-page.component.ts", "diffHunk": "@@ -225,12 +222,8 @@ export abstract class InstructorSessionBasePageComponent {\n    * Publishes a feedback session.\n    */\n   publishSession(model: SessionsTableRowModel): void {\n-    const paramMap: { [key: string]: string } = {\n-      courseid: model.feedbackSession.courseId,\n-      fsname: model.feedbackSession.feedbackSessionName,\n-    };\n \n-    this.httpRequestService.post('/session/publish', paramMap)\n+    this.feedbackSessionsService.publishFeedbackSession(model)", "originalCommit": "addd29d18f9e3cfd6657967fa51b59b0eb61bb6b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjEzNzEyMA==", "url": "https://github.com/TEAMMATES/teammates/pull/9972#discussion_r386137120", "bodyText": "Same here.", "author": "xpdavid", "createdAt": "2020-03-01T20:16:47Z", "path": "src/web/app/pages-instructor/instructor-session-base-page.component.ts", "diffHunk": "@@ -244,12 +237,7 @@ export abstract class InstructorSessionBasePageComponent {\n    * Unpublishes a feedback session.\n    */\n   unpublishSession(model: SessionsTableRowModel): void {\n-    const paramMap: { [key: string]: string } = {\n-      courseid: model.feedbackSession.courseId,\n-      fsname: model.feedbackSession.feedbackSessionName,\n-    };\n-\n-    this.httpRequestService.delete('/session/publish', paramMap)\n+    this.feedbackSessionsService.unpublishFeedbackSession(model)", "originalCommit": "addd29d18f9e3cfd6657967fa51b59b0eb61bb6b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "53362c181dcf1e5a806f93877b2a213feefa7862", "url": "https://github.com/TEAMMATES/teammates/commit/53362c181dcf1e5a806f93877b2a213feefa7862", "message": "Refactor to not pass model as parameter", "committedDate": "2020-03-07T05:34:58Z", "type": "commit"}, {"oid": "c5b7c42f56e54fe3c391fdf5485f9ec1074e26a8", "url": "https://github.com/TEAMMATES/teammates/commit/c5b7c42f56e54fe3c391fdf5485f9ec1074e26a8", "message": "Remove WebPageEndpoints", "committedDate": "2020-03-07T05:36:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTIzMTY3MA==", "url": "https://github.com/TEAMMATES/teammates/pull/9972#discussion_r389231670", "bodyText": "ActionURIs is deprecated? Why bother sync it to the frontend?", "author": "xpdavid", "createdAt": "2020-03-07T06:01:29Z", "path": "src/main/java/teammates/ui/webapi/endpoints/ActionEndpoints.java", "diffHunk": "@@ -0,0 +1,34 @@\n+package teammates.ui.webapi.endpoints;\n+\n+import com.fasterxml.jackson.annotation.JsonValue;\n+\n+import teammates.common.util.Const.ActionURIs;", "originalCommit": "c5b7c42f56e54fe3c391fdf5485f9ec1074e26a8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e278a99b4ba0eb683c75e969cbc3f6fe7d84a358", "url": "https://github.com/TEAMMATES/teammates/commit/e278a99b4ba0eb683c75e969cbc3f6fe7d84a358", "message": "Move optionals to an object parameter", "committedDate": "2020-03-07T07:47:58Z", "type": "commit"}]}