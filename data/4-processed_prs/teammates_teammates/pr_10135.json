{"pr_number": 10135, "pr_title": "[#10146] Refactor get session result logic in the backend", "pr_createdAt": "2020-05-29T04:13:13Z", "pr_url": "https://github.com/TEAMMATES/teammates/pull/10135", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI3MTc2MA==", "url": "https://github.com/TEAMMATES/teammates/pull/10135#discussion_r432271760", "bodyText": "Apply SLAP principle here: extract this block to a private method, no matter how simple it is.", "author": "wkurniawan07", "createdAt": "2020-05-29T06:01:10Z", "path": "src/main/java/teammates/common/datatransfer/CourseRoster.java", "diffHunk": "@@ -15,12 +16,24 @@\n  */\n public class CourseRoster {\n \n-    Map<String, StudentAttributes> studentListByEmail = new HashMap<>();\n-    Map<String, InstructorAttributes> instructorListByEmail = new HashMap<>();\n+    // The name for each index of the result returned by {@link CourseRoster#getInfoForIdentifier(String)}\n+    public static final int INFO_NAME = 0;\n+    public static final int INFO_TEAM_NAME = 1;\n+    public static final int INFO_SECTION_NAME = 2;\n+\n+    private final Map<String, StudentAttributes> studentListByEmail = new HashMap<>();\n+    private final Map<String, InstructorAttributes> instructorListByEmail = new HashMap<>();\n+    private final Map<String, List<StudentAttributes>> teamToMembersTable = new HashMap<>();\n \n     public CourseRoster(List<StudentAttributes> students, List<InstructorAttributes> instructors) {\n         populateStudentListByEmail(students);\n         populateInstructorListByEmail(instructors);\n+\n+        // group students by team\n+        for (StudentAttributes studentAttributes : this.getStudents()) {", "originalCommit": "833c1948bb833e14c660a0fedb83e6ae6fff149d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI3MjAyOA==", "url": "https://github.com/TEAMMATES/teammates/pull/10135#discussion_r432272028", "bodyText": "While this works, we can just define another small data structure with 3 fields for this. That way we also don't need the INFO_* variables.", "author": "wkurniawan07", "createdAt": "2020-05-29T06:02:00Z", "path": "src/main/java/teammates/common/datatransfer/CourseRoster.java", "diffHunk": "@@ -104,4 +128,42 @@ private void populateInstructorListByEmail(List<InstructorAttributes> instructor\n             instructorListByEmail.put(i.email, i);\n         }\n     }\n+\n+    /**\n+     * Gets the info of a participant associated with the identifier in the course.\n+     *\n+     * @see CourseRoster#INFO_NAME\n+     * @see CourseRoster#INFO_TEAM_NAME\n+     * @see CourseRoster#INFO_SECTION_NAME\n+     */\n+    public String[] getInfoForIdentifier(String identifier) {\n+        String name = Const.USER_NOBODY_TEXT;\n+        String teamName = Const.USER_NOBODY_TEXT;\n+        String sectionName = Const.DEFAULT_SECTION;\n+\n+        boolean isStudent = this.getStudentForEmail(identifier) != null;\n+        boolean isInstructor = this.getInstructorForEmail(identifier) != null;\n+        boolean isTeam = this.getTeamToMembersTable().containsKey(identifier);\n+        if (isStudent) {\n+            StudentAttributes student = this.getStudentForEmail(identifier);\n+\n+            name = student.getName();\n+            teamName = student.getTeam();\n+            sectionName = student.getSection();\n+        } else if (isInstructor) {\n+            InstructorAttributes instructor = this.getInstructorForEmail(identifier);\n+\n+            name = instructor.getName();\n+            teamName = Const.USER_TEAM_FOR_INSTRUCTOR;\n+            sectionName = Const.DEFAULT_SECTION;\n+        } else if (isTeam) {\n+            StudentAttributes teamMember = this.getTeamToMembersTable().get(identifier).iterator().next();\n+\n+            name = identifier;\n+            teamName = identifier;\n+            sectionName = teamMember.getSection();\n+        }\n+\n+        return new String[] { name, teamName, sectionName };", "originalCommit": "833c1948bb833e14c660a0fedb83e6ae6fff149d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI3Mjk0Mw==", "url": "https://github.com/TEAMMATES/teammates/pull/10135#discussion_r432272943", "bodyText": "We don't normally put @Nullable annotation at this layer. What's the advantage here?", "author": "wkurniawan07", "createdAt": "2020-05-29T06:05:00Z", "path": "src/main/java/teammates/logic/api/Logic.java", "diffHunk": "@@ -1678,83 +1434,20 @@ public FeedbackSessionResultsBundle getFeedbackSessionResultsForInstructorToSect\n     }\n \n     /**\n-     * Gets a question+response bundle for questions with responses that\n-     * is visible to the instructor for a feedback session from a given question number\n-     * This will not retrieve the list of comments for this question\n-     * Preconditions: <br>\n-     * * All parameters are non-null.\n-     */\n-    public FeedbackSessionResultsBundle getFeedbackSessionResultsForInstructorFromQuestion(\n-            String feedbackSessionName, String courseId, String userEmail, String questionId)\n-            throws EntityDoesNotExistException {\n-\n-        Assumption.assertNotNull(feedbackSessionName);\n-        Assumption.assertNotNull(courseId);\n-        Assumption.assertNotNull(userEmail);\n-\n-        return feedbackSessionsLogic.getFeedbackSessionResultsForInstructorFromQuestion(feedbackSessionName, courseId,\n-                                                                                        userEmail, questionId);\n-    }\n-\n-    /**\n-     * Gets a question+response bundle for questions with responses that\n-     * is visible to the instructor for a feedback session from a given question number\n-     * in a given section.\n-     * This will not retrieve the list of comments for this question\n-     * Preconditions: <br>\n-     * * All parameters are non-null.\n-     */\n-    public FeedbackSessionResultsBundle getFeedbackSessionResultsForInstructorFromQuestionInSection(\n-                                    String feedbackSessionName, String courseId, String userEmail,\n-                                    String questionId, String selectedSection, SectionDetail selectedSectionDetail)\n-            throws EntityDoesNotExistException {\n-\n-        Assumption.assertNotNull(feedbackSessionName);\n-        Assumption.assertNotNull(courseId);\n-        Assumption.assertNotNull(userEmail);\n-        Assumption.assertNotNull(selectedSection);\n-        Assumption.assertNotNull(selectedSectionDetail);\n-\n-        return feedbackSessionsLogic.getFeedbackSessionResultsForInstructorFromQuestionInSection(\n-                                            feedbackSessionName, courseId, userEmail,\n-                                            questionId, selectedSection, selectedSectionDetail);\n-    }\n-\n-    /**\n-     * Gets a question+response bundle for questions with responses that\n-     * is visible to the instructor for a feedback session.\n-     * Preconditions: <br>\n-     * * All parameters are non-null.\n-     */\n-    public FeedbackSessionResultsBundle getFeedbackSessionResultsForInstructor(\n-            String feedbackSessionName, String courseId, String userEmail)\n-            throws EntityDoesNotExistException {\n-\n-        Assumption.assertNotNull(feedbackSessionName);\n-        Assumption.assertNotNull(courseId);\n-        Assumption.assertNotNull(userEmail);\n-\n-        return feedbackSessionsLogic.getFeedbackSessionResultsForInstructor(feedbackSessionName, courseId, userEmail);\n-    }\n-\n-    /**\n-     * Gets a question+response bundle for questions with responses that\n-     * is visible to the instructor for a feedback session in a specific section.\n-     * Preconditions: <br>\n-     * * All parameters are non-null.\n+     * Get the session result for a feedback session.\n+     *\n+     * @see FeedbackSessionsLogic#getSessionResultsForUser(String, String, String, UserRole, String, String)\n      */\n-    public FeedbackSessionResultsBundle getFeedbackSessionResultsForInstructorInSection(String feedbackSessionName,\n-            String courseId, String userEmail, String section, SectionDetail sectionDetail)\n-            throws EntityDoesNotExistException {\n-\n+    public SessionResultsBundle getSessionResultsForUser(\n+            String feedbackSessionName, String courseId, String userEmail, UserRole role,\n+            @Nullable String questionId, @Nullable String section) {", "originalCommit": "833c1948bb833e14c660a0fedb83e6ae6fff149d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI4MzE0Mw==", "url": "https://github.com/TEAMMATES/teammates/pull/10135#discussion_r432283143", "bodyText": "More explicitly indicates that the variables can be null.\nFor consistency with the code base, I can also put them in the Javadoc.", "author": "xpdavid", "createdAt": "2020-05-29T06:37:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI3Mjk0Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI3NDU2Mw==", "url": "https://github.com/TEAMMATES/teammates/pull/10135#discussion_r432274563", "bodyText": "Why is this removed?\nEdit: Just read the explanation. While it may be true, I don't suggest doing it here in this PR until we know exactly how to do it in the front-end.", "author": "wkurniawan07", "createdAt": "2020-05-29T06:10:46Z", "path": "src/main/java/teammates/ui/webapi/action/ActionFactory.java", "diffHunk": "@@ -63,7 +63,6 @@\n         map(ResourceURIs.RESPONSE_COMMENT, PUT, UpdateFeedbackResponseCommentAction.class);\n         map(ResourceURIs.RESPONSE_COMMENT, DELETE, DeleteFeedbackResponseCommentAction.class);\n         map(ResourceURIs.RESULT, GET, GetSessionResultsAction.class);\n-        map(ResourceURIs.RESULT_CSV, GET, GetSessionResultsAsCsvAction.class);", "originalCommit": "833c1948bb833e14c660a0fedb83e6ae6fff149d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjczOTE5Ng==", "url": "https://github.com/TEAMMATES/teammates/pull/10135#discussion_r432739196", "bodyText": "Here are my investigations after trying to bring back the function:\nI think we only have two options here because of the couplings:\nKeep the second commit:\n\nNeed to rewrite the CSV generation in the backend.\nOr write a new function in the frontend for CSV generation.\n\nPersonally, I think the CSV generation should be in the frontend where we care about the data presentation (Actually the current refactor is targeted to make this happened in the frontend to minimized the code duplication (e.g., missing response generation)).\nI have done some initial attempts and I would say it requires the same efforts to do either. After all, the CSV view is just a non-interactive version of the per question view in the frontend.\nRemove the second commit:\n\nThis will always work as commits are independent.\nWe will remove other functions later. Not sure when though.\n\nPersonally, I would like to be ambitious and do it in frontend with the interns :P", "author": "xpdavid", "createdAt": "2020-05-29T21:15:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI3NDU2Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI3NTk2NA==", "url": "https://github.com/TEAMMATES/teammates/pull/10135#discussion_r432275964", "bodyText": "You can remove this method and the field sc of this class as well. Also you can remove the httpunit test dependency in build.gradle.", "author": "wkurniawan07", "createdAt": "2020-05-29T06:15:28Z", "path": "src/test/java/teammates/test/driver/GaeSimulation.java", "diffHunk": "@@ -183,24 +182,6 @@ public void loginAsStudentInstructor(String userId) {\n         assertFalse(user.isAdmin);\n     }\n \n-    /**\n-     * Returns an {@link teammates.ui.controller.Action} object that matches the parameters given.\n-     *\n-     * @param parameters Parameters that appear in a HttpServletRequest received by the app.\n-     */\n-    public teammates.ui.controller.Action getLegacyActionObject(String uri, String... parameters) {\n-        InvocationContext ic = invokeWebRequest(uri, parameters);", "originalCommit": "833c1948bb833e14c660a0fedb83e6ae6fff149d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjM2ODMyNQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10135#discussion_r432368325", "bodyText": "Probably we can be consistent with the use of this. here?", "author": "Derek-Hardy", "createdAt": "2020-05-29T09:32:36Z", "path": "src/main/java/teammates/common/datatransfer/SessionResultsBundle.java", "diffHunk": "@@ -0,0 +1,148 @@\n+package teammates.common.datatransfer;\n+\n+import java.util.ArrayList;\n+import java.util.LinkedHashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import teammates.common.datatransfer.attributes.FeedbackQuestionAttributes;\n+import teammates.common.datatransfer.attributes.FeedbackResponseAttributes;\n+import teammates.common.datatransfer.attributes.FeedbackResponseCommentAttributes;\n+import teammates.common.datatransfer.attributes.FeedbackSessionAttributes;\n+import teammates.common.util.Const;\n+import teammates.common.util.StringHelper;\n+\n+/**\n+ * Represents detailed results for a feedback session.\n+ */\n+public class SessionResultsBundle {\n+\n+    private final FeedbackSessionAttributes feedbackSession;\n+    private final Map<String, FeedbackQuestionAttributes> questionsMap;\n+    private final Map<String, List<FeedbackResponseAttributes>> questionResponseMap;\n+    private final Map<String, List<FeedbackResponseCommentAttributes>> responseCommentsMap;\n+    private final Map<String, boolean[]> responseVisibilityTable;\n+    private final Map<Long, boolean[]> commentVisibilityTable;\n+    private final CourseRoster roster;\n+\n+    public SessionResultsBundle(FeedbackSessionAttributes feedbackSession,\n+                                Map<String, FeedbackQuestionAttributes> questionsMap,\n+                                List<FeedbackResponseAttributes> responses,\n+                                Map<String, boolean[]> responseVisibilityTable,\n+                                Map<String, List<FeedbackResponseCommentAttributes>> responseCommentsMap,\n+                                Map<Long, boolean[]> commentVisibilityTable,\n+                                CourseRoster roster) {\n+\n+        this.feedbackSession = feedbackSession;\n+        this.questionsMap = questionsMap;\n+        this.responseCommentsMap = responseCommentsMap;\n+        this.responseVisibilityTable = responseVisibilityTable;\n+        this.commentVisibilityTable = commentVisibilityTable;\n+        this.roster = roster;\n+\n+        // build question to response map\n+        questionResponseMap = new LinkedHashMap<>();", "originalCommit": "833c1948bb833e14c660a0fedb83e6ae6fff149d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjM3MTYxNw==", "url": "https://github.com/TEAMMATES/teammates/pull/10135#discussion_r432371617", "bodyText": "How about refactor out a private builder method for questionResponseMap?", "author": "Derek-Hardy", "createdAt": "2020-05-29T09:38:53Z", "path": "src/main/java/teammates/common/datatransfer/SessionResultsBundle.java", "diffHunk": "@@ -0,0 +1,148 @@\n+package teammates.common.datatransfer;\n+\n+import java.util.ArrayList;\n+import java.util.LinkedHashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import teammates.common.datatransfer.attributes.FeedbackQuestionAttributes;\n+import teammates.common.datatransfer.attributes.FeedbackResponseAttributes;\n+import teammates.common.datatransfer.attributes.FeedbackResponseCommentAttributes;\n+import teammates.common.datatransfer.attributes.FeedbackSessionAttributes;\n+import teammates.common.util.Const;\n+import teammates.common.util.StringHelper;\n+\n+/**\n+ * Represents detailed results for a feedback session.\n+ */\n+public class SessionResultsBundle {\n+\n+    private final FeedbackSessionAttributes feedbackSession;\n+    private final Map<String, FeedbackQuestionAttributes> questionsMap;\n+    private final Map<String, List<FeedbackResponseAttributes>> questionResponseMap;\n+    private final Map<String, List<FeedbackResponseCommentAttributes>> responseCommentsMap;\n+    private final Map<String, boolean[]> responseVisibilityTable;\n+    private final Map<Long, boolean[]> commentVisibilityTable;\n+    private final CourseRoster roster;\n+\n+    public SessionResultsBundle(FeedbackSessionAttributes feedbackSession,\n+                                Map<String, FeedbackQuestionAttributes> questionsMap,\n+                                List<FeedbackResponseAttributes> responses,\n+                                Map<String, boolean[]> responseVisibilityTable,\n+                                Map<String, List<FeedbackResponseCommentAttributes>> responseCommentsMap,\n+                                Map<Long, boolean[]> commentVisibilityTable,\n+                                CourseRoster roster) {\n+\n+        this.feedbackSession = feedbackSession;\n+        this.questionsMap = questionsMap;\n+        this.responseCommentsMap = responseCommentsMap;\n+        this.responseVisibilityTable = responseVisibilityTable;\n+        this.commentVisibilityTable = commentVisibilityTable;\n+        this.roster = roster;\n+\n+        // build question to response map\n+        questionResponseMap = new LinkedHashMap<>();\n+        List<FeedbackQuestionAttributes> questions = new ArrayList<>(questionsMap.values());\n+        for (FeedbackQuestionAttributes question : questions) {\n+            questionResponseMap.put(question.getId(), new ArrayList<>());\n+        }", "originalCommit": "833c1948bb833e14c660a0fedb83e6ae6fff149d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjM3OTE1NQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10135#discussion_r432379155", "bodyText": "Instead of prefixing the name of 2 lists as first, second, we can give more meaningful prefixes such as giver, receiver, which is the true intention here.", "author": "Derek-Hardy", "createdAt": "2020-05-29T09:52:51Z", "path": "src/main/java/teammates/storage/api/FeedbackResponseCommentsDb.java", "diffHunk": "@@ -395,6 +415,38 @@ private FeedbackResponseComment getFeedbackResponseCommentEntitiesForResponseFro\n                 .list();\n     }\n \n+    private Collection<FeedbackResponseComment> getFeedbackResponseCommentEntitiesForQuestion(String questionId) {\n+        return load()\n+                .filter(\"feedbackQuestionId =\", questionId)\n+                .list();\n+    }\n+\n+    private Collection<FeedbackResponseComment> getFeedbackResponseCommentEntitiesForQuestionInSection(\n+            String questionId, String section) {\n+        // creating map to remove duplicates\n+        Map<Long, FeedbackResponseComment> comments = new HashMap<>();\n+\n+        List<FeedbackResponseComment> firstQueryResponseComments = load()\n+                .filter(\"feedbackQuestionId =\", questionId)\n+                .filter(\"giverSection =\", section)\n+                .list();\n+\n+        for (FeedbackResponseComment comment : firstQueryResponseComments) {\n+            comments.put(comment.getFeedbackResponseCommentId(), comment);\n+        }\n+\n+        List<FeedbackResponseComment> secondQueryResponseComments = load()\n+                .filter(\"feedbackQuestionId =\", questionId)\n+                .filter(\"receiverSection =\", section)\n+                .list();", "originalCommit": "833c1948bb833e14c660a0fedb83e6ae6fff149d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjM4MTIzOQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10135#discussion_r432381239", "bodyText": "The variable naming would be better to be consistent with the underlying data structure, such as respondingStudentSet .", "author": "Derek-Hardy", "createdAt": "2020-05-29T09:56:59Z", "path": "src/test/java/teammates/test/cases/automated/FeedbackSessionUpdateRespondentWorkerActionTest.java", "diffHunk": "@@ -103,22 +101,32 @@ public void allTests() throws EntityDoesNotExistException {\n     }\n \n     private void verifyRespondentInSessionRespondentsList(FeedbackSessionAttributes session, String respondentEmail,\n-            boolean isInstructor) throws EntityDoesNotExistException {\n-        FeedbackSessionResponseStatus responseStatus =\n-                fsLogic.getFeedbackSessionResponseStatus(session.getFeedbackSessionName(), session.getCourseId());\n-        assertFalse(responseStatus.getStudentsWhoDidNotRespond().contains(respondentEmail));\n-        if (!isInstructor) {\n-            assertTrue(responseStatus.getStudentsWhoResponded().contains(respondentEmail));\n+            boolean isInstructor) {\n+        FeedbackSessionAttributes sessionInDb =\n+                logic.getFeedbackSession(session.getFeedbackSessionName(), session.getCourseId());\n+\n+        Set<String> respondingStudentList = sessionInDb.getRespondingStudentList();\n+        Set<String> respondingInstructorList = sessionInDb.getRespondingInstructorList();", "originalCommit": "833c1948bb833e14c660a0fedb83e6ae6fff149d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjM4MzcxOA==", "url": "https://github.com/TEAMMATES/teammates/pull/10135#discussion_r432383718", "bodyText": "Actually the method itself also named as get...List but in fact return a set.", "author": "Derek-Hardy", "createdAt": "2020-05-29T10:01:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjM4MTIzOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjcxMjA0OA==", "url": "https://github.com/TEAMMATES/teammates/pull/10135#discussion_r432712048", "bodyText": "The method names are for legacy reason. Let not refactor them in this PR.", "author": "xpdavid", "createdAt": "2020-05-29T20:10:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjM4MTIzOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjM4MzkyNA==", "url": "https://github.com/TEAMMATES/teammates/pull/10135#discussion_r432383924", "bodyText": "Similarly here", "author": "Derek-Hardy", "createdAt": "2020-05-29T10:02:14Z", "path": "src/test/java/teammates/test/cases/automated/FeedbackSessionUpdateRespondentWorkerActionTest.java", "diffHunk": "@@ -103,22 +101,32 @@ public void allTests() throws EntityDoesNotExistException {\n     }\n \n     private void verifyRespondentInSessionRespondentsList(FeedbackSessionAttributes session, String respondentEmail,\n-            boolean isInstructor) throws EntityDoesNotExistException {\n-        FeedbackSessionResponseStatus responseStatus =\n-                fsLogic.getFeedbackSessionResponseStatus(session.getFeedbackSessionName(), session.getCourseId());\n-        assertFalse(responseStatus.getStudentsWhoDidNotRespond().contains(respondentEmail));\n-        if (!isInstructor) {\n-            assertTrue(responseStatus.getStudentsWhoResponded().contains(respondentEmail));\n+            boolean isInstructor) {\n+        FeedbackSessionAttributes sessionInDb =\n+                logic.getFeedbackSession(session.getFeedbackSessionName(), session.getCourseId());\n+\n+        Set<String> respondingStudentList = sessionInDb.getRespondingStudentList();\n+        Set<String> respondingInstructorList = sessionInDb.getRespondingInstructorList();\n+        if (isInstructor) {\n+            assertFalse(respondingStudentList.contains(respondentEmail));\n+            assertTrue(respondingInstructorList.contains(respondentEmail));\n+        } else {\n+            assertTrue(respondingStudentList.contains(respondentEmail));\n+            assertFalse(respondingInstructorList.contains(respondentEmail));\n         }\n     }\n \n     private void verifyRespondentNotInSessionRespondentsList(FeedbackSessionAttributes session, String respondentEmail,\n-            boolean isInstructor) throws EntityDoesNotExistException {\n-        FeedbackSessionResponseStatus responseStatus =\n-                fsLogic.getFeedbackSessionResponseStatus(session.getFeedbackSessionName(), session.getCourseId());\n-        assertTrue(responseStatus.getStudentsWhoDidNotRespond().contains(respondentEmail));\n-        if (!isInstructor) {\n-            assertFalse(responseStatus.getStudentsWhoResponded().contains(respondentEmail));\n+            boolean isInstructor) {\n+        FeedbackSessionAttributes sessionInDb =\n+                logic.getFeedbackSession(session.getFeedbackSessionName(), session.getCourseId());\n+\n+        Set<String> respondingStudentList = sessionInDb.getRespondingStudentList();\n+        Set<String> respondingInstructorList = sessionInDb.getRespondingInstructorList();", "originalCommit": "833c1948bb833e14c660a0fedb83e6ae6fff149d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjM4NjM2OQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10135#discussion_r432386369", "bodyText": "Although it is just a test class, I think it is still good to name each element in the pair within the for loop for better understanding.\nLike studentTeam = studentData[i], studentEmail = studentData[i + 1].", "author": "Derek-Hardy", "createdAt": "2020-05-29T10:07:15Z", "path": "src/test/java/teammates/test/cases/datatransfer/CourseRosterTest.java", "diffHunk": "@@ -104,15 +105,96 @@ public void testGetEmailToNameTableFromRoster() {\n         assertEquals(emailToNameTableExpected, emailToNameTableActual);\n     }\n \n+    @Test\n+    public void testGetTeamToMembersTable_typicalCase_shouldGroupTeamCorrectly() {\n+        CourseRoster roster = new CourseRoster(\n+                createStudentList(\n+                        \"team 1\", \"s1@gmail.com\",\n+                        \"team 1\", \"s2@gmail.com\",\n+                        \"team 2\", \"s3@gmail.com\"),\n+                createInstructorList(\n+                        \"John\", \"ins1@email.com\",\n+                        \"Jean\", \"ins2@email.com\"));\n+\n+        assertEquals(2, roster.getTeamToMembersTable().size());\n+        assertEquals(2, roster.getTeamToMembersTable().get(\"team 1\").size());\n+        assertEquals(1, roster.getTeamToMembersTable().get(\"team 2\").size());\n+        assertEquals(\"s3@gmail.com\", roster.getTeamToMembersTable().get(\"team 2\").iterator().next().getEmail());\n+    }\n+\n+    @Test\n+    public void testGetInfoForIdentifier_studentCase_shouldShowCorrectInfo() {\n+        CourseRoster roster = new CourseRoster(\n+                createStudentList(\n+                        \"John\", \"john@gmail.com\",\n+                        \"s2\", \"s2@gmail.com\",\n+                        \"s3\", \"s3@gmail.com\"),\n+                createInstructorList(\n+                        \"John\", \"john@email.com\",\n+                        \"Jean\", \"ins2@email.com\"));\n+        String[] info = roster.getInfoForIdentifier(\"john@gmail.com\");\n+        assertEquals(\"John\", info[CourseRoster.INFO_NAME]);\n+        assertEquals(\"John\", info[CourseRoster.INFO_TEAM_NAME]);\n+        assertEquals(\"John's Section\", info[CourseRoster.INFO_SECTION_NAME]);\n+    }\n+\n+    @Test\n+    public void testGetInfoForIdentifier_instructorCase_shouldShowCorrectInfo() {\n+        CourseRoster roster = new CourseRoster(\n+                createStudentList(\n+                        \"s1\", \"s1@gmail.com\",\n+                        \"s2\", \"s2@gmail.com\",\n+                        \"s3\", \"s3@gmail.com\"),\n+                createInstructorList(\n+                        \"John\", \"john@email.com\",\n+                        \"Jean\", \"ins2@email.com\"));\n+        String[] info = roster.getInfoForIdentifier(\"john@email.com\");\n+        assertEquals(\"John\", info[CourseRoster.INFO_NAME]);\n+        assertEquals(Const.USER_TEAM_FOR_INSTRUCTOR, info[CourseRoster.INFO_TEAM_NAME]);\n+        assertEquals(Const.DEFAULT_SECTION, info[CourseRoster.INFO_SECTION_NAME]);\n+    }\n+\n+    @Test\n+    public void testGetInfoForIdentifier_teamCase_shouldShowCorrectInfo() {\n+        CourseRoster roster = new CourseRoster(\n+                createStudentList(\n+                        \"s1\", \"s1@gmail.com\",\n+                        \"s2\", \"s2@gmail.com\",\n+                        \"s3\", \"s3@gmail.com\"),\n+                createInstructorList(\n+                        \"John\", \"john@email.com\",\n+                        \"Jean\", \"ins2@email.com\"));\n+        String[] info = roster.getInfoForIdentifier(\"s1\");\n+        assertEquals(\"s1\", info[CourseRoster.INFO_NAME]);\n+        assertEquals(\"s1\", info[CourseRoster.INFO_TEAM_NAME]);\n+        assertEquals(\"s1's Section\", info[CourseRoster.INFO_SECTION_NAME]);\n+    }\n+\n+    @Test\n+    public void testGetInfoForIdentifier_unknownCase_shouldShowCorrectInfo() {\n+        CourseRoster roster = new CourseRoster(\n+                createStudentList(\n+                        \"s1\", \"s1@gmail.com\",\n+                        \"s2\", \"s2@gmail.com\",\n+                        \"s3\", \"s3@gmail.com\"),\n+                createInstructorList(\n+                        \"John\", \"john@email.com\",\n+                        \"Jean\", \"ins2@email.com\"));\n+        String[] info = roster.getInfoForIdentifier(\"random\");\n+        assertEquals(Const.USER_NOBODY_TEXT, info[CourseRoster.INFO_NAME]);\n+        assertEquals(Const.USER_NOBODY_TEXT, info[CourseRoster.INFO_TEAM_NAME]);\n+        assertEquals(Const.DEFAULT_SECTION, info[CourseRoster.INFO_SECTION_NAME]);\n+    }\n+\n     private List<StudentAttributes> createStudentList(String... studentData) {\n         List<StudentAttributes> students = new ArrayList<>();\n         for (int i = 0; i < studentData.length; i += 2) {\n             StudentAttributes student = StudentAttributes\n-                    .builder(\"\", \"\")\n-                    .withName(\"\")\n+                    .builder(\"\", studentData[i + 1])\n+                    .withName(studentData[i])\n+                    .withTeamName(studentData[i])\n+                    .withSectionName(studentData[i] + \"'s Section\")", "originalCommit": "833c1948bb833e14c660a0fedb83e6ae6fff149d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjcxMjgyNw==", "url": "https://github.com/TEAMMATES/teammates/pull/10135#discussion_r432712827", "bodyText": "The names are implicitly specified by the builder pattern?", "author": "xpdavid", "createdAt": "2020-05-29T20:12:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjM4NjM2OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjkwMTU1NA==", "url": "https://github.com/TEAMMATES/teammates/pull/10135#discussion_r432901554", "bodyText": "There's no indication what studentData[i + 1] is when instantiating the builder.", "author": "Derek-Hardy", "createdAt": "2020-05-31T01:45:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjM4NjM2OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjM5NDI4OQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10135#discussion_r432394289", "bodyText": "So, decided to pass in null and remove if-else check? :)", "author": "Derek-Hardy", "createdAt": "2020-05-29T10:23:50Z", "path": "src/main/java/teammates/ui/webapi/output/SessionResultsData.java", "diffHunk": "@@ -371,18 +437,24 @@ public CommentOutput getParticipantComment() {\n         @Nullable\n         private final String lastEditorName;\n \n-        public CommentOutput(FeedbackResponseCommentAttributes frc, String commentGiverName, String lastEditorName) {\n+        public CommentOutput(FeedbackResponseCommentAttributes frc,\n+                             String commentGiver, String commentGiverName,\n+                             String lastEditorEmail, String lastEditorName) {\n             super(frc);\n+            this.commentGiver = commentGiver;\n+            this.commentGiverName = commentGiverName;\n+            this.lastEditorEmail = lastEditorEmail;\n+            this.lastEditorName = lastEditorName;\n+        }\n ", "originalCommit": "833c1948bb833e14c660a0fedb83e6ae6fff149d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjk4MzQzNQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10135#discussion_r432983435", "bodyText": "Applied builder pattern instead \ud83d\udc4d", "author": "xpdavid", "createdAt": "2020-05-31T20:56:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjM5NDI4OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzAwMzk3OQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10135#discussion_r433003979", "bodyText": "Looks great!", "author": "Derek-Hardy", "createdAt": "2020-06-01T00:56:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjM5NDI4OQ=="}], "type": "inlineReview"}, {"oid": "c85627bba356c237a1399e5af5b85d5e447b7335", "url": "https://github.com/TEAMMATES/teammates/commit/c85627bba356c237a1399e5af5b85d5e447b7335", "message": "fix code inconsistency for question stats", "committedDate": "2020-05-31T17:09:57Z", "type": "commit"}, {"oid": "eb8d5bd93b86588ea90d869e88ebbea98f2fc0ba", "url": "https://github.com/TEAMMATES/teammates/commit/eb8d5bd93b86588ea90d869e88ebbea98f2fc0ba", "message": "rewrite the get result logic", "committedDate": "2020-05-31T17:45:22Z", "type": "forcePushed"}, {"oid": "d27410301f1e6ff927016ee1b0c96f2ff218c846", "url": "https://github.com/TEAMMATES/teammates/commit/d27410301f1e6ff927016ee1b0c96f2ff218c846", "message": "rewrite the get session result logic", "committedDate": "2020-05-31T20:34:44Z", "type": "forcePushed"}, {"oid": "57f65b63ffd44e03c09283c258846e521a8b0a00", "url": "https://github.com/TEAMMATES/teammates/commit/57f65b63ffd44e03c09283c258846e521a8b0a00", "message": "fix two data inconsistency in typical data bundle about comments", "committedDate": "2020-05-31T21:05:22Z", "type": "commit"}, {"oid": "7da52fd3d7a940fd7765b0c89fbde824ed1c7816", "url": "https://github.com/TEAMMATES/teammates/commit/7da52fd3d7a940fd7765b0c89fbde824ed1c7816", "message": "rewrite the get session result logic", "committedDate": "2020-05-31T21:05:22Z", "type": "forcePushed"}, {"oid": "a05caaaabcbc5949cee71899de421c783eccfb49", "url": "https://github.com/TEAMMATES/teammates/commit/a05caaaabcbc5949cee71899de421c783eccfb49", "message": "rewrite the get session result logic", "committedDate": "2020-06-01T02:55:56Z", "type": "commit"}, {"oid": "a05caaaabcbc5949cee71899de421c783eccfb49", "url": "https://github.com/TEAMMATES/teammates/commit/a05caaaabcbc5949cee71899de421c783eccfb49", "message": "rewrite the get session result logic", "committedDate": "2020-06-01T02:55:56Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDAxNTk4Ng==", "url": "https://github.com/TEAMMATES/teammates/pull/10135#discussion_r434015986", "bodyText": "Nitpicking, but this is Java so this is not exactly necessary.", "author": "wkurniawan07", "createdAt": "2020-06-02T16:34:00Z", "path": "src/main/java/teammates/common/datatransfer/CourseRoster.java", "diffHunk": "@@ -104,4 +118,76 @@ private void populateInstructorListByEmail(List<InstructorAttributes> instructor\n             instructorListByEmail.put(i.email, i);\n         }\n     }\n+\n+    private void buildTeamToMembersTable() {\n+        // group students by team\n+        for (StudentAttributes studentAttributes : this.getStudents()) {\n+            teamToMembersTable.computeIfAbsent(studentAttributes.getTeam(), key -> new ArrayList<>())\n+                    .add(studentAttributes);\n+        }\n+    }\n+\n+    /**\n+     * Gets info of a participant associated with an identifier in the course.\n+     *\n+     * @return an object {@link ParticipantInfo} containing the name, teamName and the sectionName.\n+     */\n+    public ParticipantInfo getInfoForIdentifier(String identifier) {\n+        String name = Const.USER_NOBODY_TEXT;\n+        String teamName = Const.USER_NOBODY_TEXT;\n+        String sectionName = Const.DEFAULT_SECTION;\n+\n+        boolean isStudent = this.getStudentForEmail(identifier) != null;", "originalCommit": "a05caaaabcbc5949cee71899de421c783eccfb49", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "1711184c679cf1743602d8537791701cb92cde8e", "url": "https://github.com/TEAMMATES/teammates/commit/1711184c679cf1743602d8537791701cb92cde8e", "message": "remove redundant this keyword in CourseRoster", "committedDate": "2020-06-02T19:18:27Z", "type": "commit"}, {"oid": "72afb06f59397409b0caec4d5162bdaba663a30a", "url": "https://github.com/TEAMMATES/teammates/commit/72afb06f59397409b0caec4d5162bdaba663a30a", "message": "Merge branch 'master' into 9382-refactor-result-logic", "committedDate": "2020-06-02T19:19:25Z", "type": "commit"}]}