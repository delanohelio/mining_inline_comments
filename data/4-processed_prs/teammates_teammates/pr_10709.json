{"pr_number": 10709, "pr_title": "[#10315] Refactor search result for instructor search", "pr_createdAt": "2020-09-13T14:15:22Z", "pr_url": "https://github.com/TEAMMATES/teammates/pull/10709", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTEwODE2MA==", "url": "https://github.com/TEAMMATES/teammates/pull/10709#discussion_r489108160", "bodyText": "But right now we loss the type information by doing this?", "author": "xpdavid", "createdAt": "2020-09-16T01:30:17Z", "path": "src/web/services/search.service.ts", "diffHunk": "@@ -473,11 +459,10 @@ export class SearchService {\n }\n \n /**\n- * The typings for the response object returned by the instructor search service.\n+ * Generic search result type.\n  */\n-export interface InstructorSearchResult {\n-  searchStudentsTables: SearchStudentsListRowTable[];\n-  searchCommentsTables: SearchCommentsTable[];\n+export interface SearchResult {\n+  searchResult: any;", "originalCommit": "121c3c39e77be366ddc759c654c0949c7da3c5b3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTEwODUxNA==", "url": "https://github.com/TEAMMATES/teammates/pull/10709#discussion_r489108514", "bodyText": "Why can't this just be comments: CommentSearchResult[]?", "author": "xpdavid", "createdAt": "2020-09-16T01:31:43Z", "path": "src/web/services/search.service.ts", "diffHunk": "@@ -473,11 +459,10 @@ export class SearchService {\n }\n \n /**\n- * The typings for the response object returned by the instructor search service.\n+ * Generic search result type.\n  */\n-export interface InstructorSearchResult {\n-  searchStudentsTables: SearchStudentsListRowTable[];\n-  searchCommentsTables: SearchCommentsTable[];", "originalCommit": "121c3c39e77be366ddc759c654c0949c7da3c5b3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTEwODU2NQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10709#discussion_r489108565", "bodyText": "And similar here", "author": "xpdavid", "createdAt": "2020-09-16T01:31:49Z", "path": "src/web/services/search.service.ts", "diffHunk": "@@ -473,11 +459,10 @@ export class SearchService {\n }\n \n /**\n- * The typings for the response object returned by the instructor search service.\n+ * Generic search result type.\n  */\n-export interface InstructorSearchResult {\n-  searchStudentsTables: SearchStudentsListRowTable[];", "originalCommit": "121c3c39e77be366ddc759c654c0949c7da3c5b3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "b6c932272f44001e515b7ecb2303c432374f655e", "url": "https://github.com/TEAMMATES/teammates/commit/b6c932272f44001e515b7ecb2303c432374f655e", "message": "Refactor search result for instructor search", "committedDate": "2020-09-16T03:10:18Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDA2OTQ5OA==", "url": "https://github.com/TEAMMATES/teammates/pull/10709#discussion_r490069498", "bodyText": "unnecessary changes? u can disable angular analytics globally with  ng analytics off so you don't get these changes", "author": "t-cheepeng", "createdAt": "2020-09-17T08:35:55Z", "path": "angular.json", "diffHunk": "@@ -158,5 +158,8 @@\n       }\n     }\n   },\n-  \"defaultProject\": \"teammates\"\n-}\n+  \"defaultProject\": \"teammates\",\n+  \"cli\": {\n+    \"analytics\": false\n+  }\n+}", "originalCommit": "b6c932272f44001e515b7ecb2303c432374f655e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDA3MTQ1OA==", "url": "https://github.com/TEAMMATES/teammates/pull/10709#discussion_r490071458", "bodyText": "\ud83d\udc4d . Yup this is what we were looking for with the refactoring!", "author": "t-cheepeng", "createdAt": "2020-09-17T08:39:02Z", "path": "src/web/app/pages-instructor/instructor-search-page/instructor-search-page.component.ts", "diffHunk": "@@ -84,4 +106,85 @@ export class InstructorSearchPageComponent implements OnInit {\n       this.statusMessageService.showErrorToast(resp.error.message);\n     });\n   }\n+\n+  private getSearchCommentsTable(searchResults: CommentSearchResult[]): SearchCommentsTable[] {\n+    return searchResults.map((res: CommentSearchResult) => ({\n+      feedbackSession: res.feedbackSession,\n+      questions: res.questions,\n+    }));\n+  }\n+\n+  private getCoursesWithStudents(students: Student[]): SearchStudentsListRowTable[] {\n+    const distinctCourses: string[] = Array.from(\n+        new Set(students.map((s: Student) => s.courseId)),\n+    );\n+    const coursesWithStudents: SearchStudentsListRowTable[] = distinctCourses.map(\n+        (courseId: string) => ({\n+          courseId,\n+          students: Array.from(\n+              new Set(\n+                  students\n+                      .filter((s: Student) => s.courseId === courseId),\n+              ),\n+          ).map((s: Student) => ({", "originalCommit": "b6c932272f44001e515b7ecb2303c432374f655e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDA3Nzk0Ng==", "url": "https://github.com/TEAMMATES/teammates/pull/10709#discussion_r490077946", "bodyText": "Got it. Could I just remove the tests for the functions removed? Or do I port them over to the components that are using them?", "author": "moziliar", "createdAt": "2020-09-17T08:49:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDA3MTQ1OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDA4MzkyMw==", "url": "https://github.com/TEAMMATES/teammates/pull/10709#discussion_r490083923", "bodyText": "If you could port them over in this PR, it would be great", "author": "t-cheepeng", "createdAt": "2020-09-17T08:57:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDA3MTQ1OA=="}], "type": "inlineReview"}, {"oid": "376a294384aabca062246221dd08a4c213652b2d", "url": "https://github.com/TEAMMATES/teammates/commit/376a294384aabca062246221dd08a4c213652b2d", "message": "Refactor search result for instructor search", "committedDate": "2020-09-17T08:44:04Z", "type": "forcePushed"}, {"oid": "92b780d15582f09c419bce79e16783e9bc02c900", "url": "https://github.com/TEAMMATES/teammates/commit/92b780d15582f09c419bce79e16783e9bc02c900", "message": "Migrate tests to instructor search component from search service", "committedDate": "2020-09-18T04:07:13Z", "type": "forcePushed"}, {"oid": "71d6e6ac9ca4e660c3804f0b1d61feda93ad9fb2", "url": "https://github.com/TEAMMATES/teammates/commit/71d6e6ac9ca4e660c3804f0b1d61feda93ad9fb2", "message": "Refactor search result for instructor search", "committedDate": "2020-09-19T09:59:23Z", "type": "commit"}, {"oid": "5ac12a8c69ae8b37f14696a9065b1e83fd2f5735", "url": "https://github.com/TEAMMATES/teammates/commit/5ac12a8c69ae8b37f14696a9065b1e83fd2f5735", "message": "Migrate tests to instructor search component from search service", "committedDate": "2020-09-19T09:59:23Z", "type": "commit"}, {"oid": "5ac12a8c69ae8b37f14696a9065b1e83fd2f5735", "url": "https://github.com/TEAMMATES/teammates/commit/5ac12a8c69ae8b37f14696a9065b1e83fd2f5735", "message": "Migrate tests to instructor search component from search service", "committedDate": "2020-09-19T09:59:23Z", "type": "forcePushed"}, {"oid": "84ccac6f84e238bff1c9bae3d36037dd99ddc265", "url": "https://github.com/TEAMMATES/teammates/commit/84ccac6f84e238bff1c9bae3d36037dd99ddc265", "message": "Fix test", "committedDate": "2020-09-19T10:16:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mzg2NDkxNQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10709#discussion_r493864915", "bodyText": "You can just call the method directly.\n\nThere is no need to use search service as a proxy\nThe naming is also a bit misleading as we are not searching instructor privilege.", "author": "xpdavid", "createdAt": "2020-09-23T20:08:57Z", "path": "src/web/services/search.service.ts", "diffHunk": "@@ -120,87 +116,10 @@ export class SearchService {\n     return this.httpRequestService.get(ResourceEndpoints.SEARCH_COMMENTS, paramMap);\n   }\n \n-  getCoursesWithStudents(studentsRes: Students): SearchStudentsListRowTable[] {\n-    const { students }: { students: Student[] } = studentsRes;\n-\n-    const distinctCourses: string[] = Array.from(\n-      new Set(students.map((s: Student) => s.courseId)),\n+  searchInstructorPrivilege(courseId: string, sectionName: string): Observable<InstructorPrivilege> {\n+    return this.instructorService.loadInstructorPrivilege(", "originalCommit": "84ccac6f84e238bff1c9bae3d36037dd99ddc265", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "093f9809341e06f966d157623d5859eb03a0f82d", "url": "https://github.com/TEAMMATES/teammates/commit/093f9809341e06f966d157623d5859eb03a0f82d", "message": "Merge branch 'master' into 10315-refactor-search-result-type", "committedDate": "2020-10-02T15:53:41Z", "type": "commit"}]}