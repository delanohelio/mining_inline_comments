{"pr_number": 10543, "pr_title": "[#10509] [#10524] [#10525] [#10535] Add loading indicators when fetching data", "pr_createdAt": "2020-08-03T13:41:24Z", "pr_url": "https://github.com/TEAMMATES/teammates/pull/10543", "timeline": [{"oid": "15e08a8c885381ce7a394b885f540cbcfdf97986", "url": "https://github.com/TEAMMATES/teammates/commit/15e08a8c885381ce7a394b885f540cbcfdf97986", "message": "Add loading spinner to instructor-sessions-page.component (#10509)", "committedDate": "2020-08-03T12:21:02Z", "type": "commit"}, {"oid": "46b8b67254da20b588feb17d80f8d79d089221bc", "url": "https://github.com/TEAMMATES/teammates/commit/46b8b67254da20b588feb17d80f8d79d089221bc", "message": "Add loading spinner to session-submission-page.component (#10524, #10535)", "committedDate": "2020-08-03T12:31:28Z", "type": "commit"}, {"oid": "882717eb8d29c466ae7125e399d03a7ae65c553a", "url": "https://github.com/TEAMMATES/teammates/commit/882717eb8d29c466ae7125e399d03a7ae65c553a", "message": "Add loading spinner to instructor-session-edit-page (#10525)", "committedDate": "2020-08-03T13:26:30Z", "type": "commit"}, {"oid": "9363f8165b32227af986d880f6c1691ae007aa3e", "url": "https://github.com/TEAMMATES/teammates/commit/9363f8165b32227af986d880f6c1691ae007aa3e", "message": "Fix lint", "committedDate": "2020-08-03T13:38:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDg4MTQ1MQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10543#discussion_r464881451", "bodyText": "Just a minor thing:\nWould isFeedbackSessionLoading be a better name? When i did the indicators, the variable naming for loading i adopted was isSomethingLoading since the directive is tmIsLoading", "author": "t-cheepeng", "createdAt": "2020-08-04T08:19:41Z", "path": "src/web/app/pages-session/session-submission-page/session-submission-page.component.ts", "diffHunk": "@@ -251,65 +254,66 @@ export class SessionSubmissionPageComponent implements OnInit, AfterViewInit {\n       key: this.regKey,\n       moderatedPerson: this.moderatedPerson,\n       previewAs: this.previewAsPerson,\n-    }).subscribe((feedbackSession: FeedbackSession) => {\n-      this.feedbackSessionInstructions = feedbackSession.instructions;\n-      this.formattedSessionOpeningTime = this.timezoneService\n+    }).pipe(finalize(() => this.hasFeedbackSessionLoaded = true))", "originalCommit": "9363f8165b32227af986d880f6c1691ae007aa3e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "bf43b338267fe1101344a21541def009b0722cfd", "url": "https://github.com/TEAMMATES/teammates/commit/bf43b338267fe1101344a21541def009b0722cfd", "message": "Refactor hasLoaded to isLoading", "committedDate": "2020-08-04T13:15:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTQ2MTA3Mw==", "url": "https://github.com/TEAMMATES/teammates/pull/10543#discussion_r465461073", "bodyText": "Why isCopyingQuestion is set only when there is error message?", "author": "xpdavid", "createdAt": "2020-08-05T04:12:59Z", "path": "src/web/app/pages-instructor/instructor-session-edit-page/instructor-session-edit-page.component.ts", "diffHunk": "@@ -887,6 +888,7 @@ export class InstructorSessionEditPageComponent extends InstructorSessionBasePag\n     ).subscribe((questionToCopyCandidate: QuestionToCopyCandidate[]) => {\n       questionToCopyCandidates.push(...questionToCopyCandidate);\n     }, (resp: ErrorMessageOutput) => { this.statusMessageService.showErrorToast(resp.error.message); }, () => {\n+      this.isCopyingQuestion = false;", "originalCommit": "33f2a1071d9d16cb7e9d2385979c7d209c4bfe6b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTUwMzU3OA==", "url": "https://github.com/TEAMMATES/teammates/pull/10543#discussion_r465503578", "bodyText": "It's not the error callback, it's in the complete callback. See https://angular.io/guide/observables#defining-observers", "author": "madanalogy", "createdAt": "2020-08-05T06:34:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTQ2MTA3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTY0Njc4Nw==", "url": "https://github.com/TEAMMATES/teammates/pull/10543#discussion_r465646787", "bodyText": "I don't think complete will be called after error? https://stackoverflow.com/questions/33783967/rxjs-observable-doesnt-complete-when-an-error-occurs\nThink finalize is better.", "author": "ccyccyccy", "createdAt": "2020-08-05T11:06:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTQ2MTA3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTcyNDM5MA==", "url": "https://github.com/TEAMMATES/teammates/pull/10543#discussion_r465724390", "bodyText": "But then we run into the problem you raised previously about there being additional loading before the modal pops up. That loading is the copying within the subscription and finalise is called at the end of the pipe instead of at the end of the subscription operation.\nEDIT: I was wrong about the behaviour of finalize described earlier sorry. It's just that there is no other operation before the modal is opened on complete so I moved the boolean toggling there. I am unable to replicate the additional delay.\nYou're also right though that complete won't be called on error, so I'll put in the toggle into the error block as well.", "author": "madanalogy", "createdAt": "2020-08-05T13:25:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTQ2MTA3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTc4MTg0Nw==", "url": "https://github.com/TEAMMATES/teammates/pull/10543#discussion_r465781847", "bodyText": "The additional loading I mentioned was due to the fetching of the intents. Your old implementation works, just that you need to put the finalize after flatMap. See https://stackoverflow.com/questions/54567073/finalize-with-flatmap-in-angular.", "author": "ccyccyccy", "createdAt": "2020-08-05T14:46:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTQ2MTA3Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTQ2MTc5Mg==", "url": "https://github.com/TEAMMATES/teammates/pull/10543#discussion_r465461792", "bodyText": "You should set isFeedbackSessionQuestionResponsesLoading to true somewhere?", "author": "xpdavid", "createdAt": "2020-08-05T04:16:07Z", "path": "src/web/app/pages-session/session-submission-page/session-submission-page.component.ts", "diffHunk": "@@ -391,6 +396,7 @@ export class SessionSubmissionPageComponent implements OnInit, AfterViewInit {\n             responseId: '',\n           });\n         });\n+        this.isFeedbackSessionQuestionResponsesLoading = false;", "originalCommit": "33f2a1071d9d16cb7e9d2385979c7d209c4bfe6b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTUwNDU2MQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10543#discussion_r465504561", "bodyText": "It's initialised as true", "author": "madanalogy", "createdAt": "2020-08-05T06:36:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTQ2MTc5Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAyOTY4OQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10543#discussion_r466029689", "bodyText": "We should not depends on the initial values of component. true need to set properly when the loading actually begins.", "author": "xpdavid", "createdAt": "2020-08-05T22:02:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTQ2MTc5Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTQ2MTkxNg==", "url": "https://github.com/TEAMMATES/teammates/pull/10543#discussion_r465461916", "bodyText": "Why it is set when the length is zero?", "author": "xpdavid", "createdAt": "2020-08-05T04:16:39Z", "path": "src/web/app/pages-session/session-submission-page/session-submission-page.component.ts", "diffHunk": "@@ -320,6 +324,7 @@ export class SessionSubmissionPageComponent implements OnInit, AfterViewInit {\n       previewAs: this.previewAsPerson,\n     }).pipe(finalize(() => this.isFeedbackSessionQuestionsLoading = false))\n         .subscribe((response: FeedbackQuestionsResponse) => {\n+          if (response.questions.length === 0) { this.isFeedbackSessionQuestionResponsesLoading = false; }", "originalCommit": "33f2a1071d9d16cb7e9d2385979c7d209c4bfe6b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTUwNDE2OA==", "url": "https://github.com/TEAMMATES/teammates/pull/10543#discussion_r465504168", "bodyText": "Because then this.loadFeedbackQuestionRecipientsForQuestion() is never called", "author": "madanalogy", "createdAt": "2020-08-05T06:35:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTQ2MTkxNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTQ2MTk3Nw==", "url": "https://github.com/TEAMMATES/teammates/pull/10543#discussion_r465461977", "bodyText": "Why isCopyingQuestion is set only when there is error message?", "author": "xpdavid", "createdAt": "2020-08-05T04:16:56Z", "path": "src/web/app/pages-instructor/instructor-session-edit-page/instructor-session-edit-page.component.ts", "diffHunk": "@@ -887,6 +888,7 @@ export class InstructorSessionEditPageComponent extends InstructorSessionBasePag\n     ).subscribe((questionToCopyCandidate: QuestionToCopyCandidate[]) => {\n       questionToCopyCandidates.push(...questionToCopyCandidate);\n     }, (resp: ErrorMessageOutput) => { this.statusMessageService.showErrorToast(resp.error.message); }, () => {\n+      this.isCopyingQuestion = false;", "originalCommit": "33f2a1071d9d16cb7e9d2385979c7d209c4bfe6b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "68cef931b7277671cd68bb88170cb72c4c013e88", "url": "https://github.com/TEAMMATES/teammates/commit/68cef931b7277671cd68bb88170cb72c4c013e88", "message": "Move isCopyingQuestion into complete and error callbacks", "committedDate": "2020-08-05T13:46:13Z", "type": "forcePushed"}, {"oid": "3305affb8280bd9bb49fca71977bb3972117d095", "url": "https://github.com/TEAMMATES/teammates/commit/3305affb8280bd9bb49fca71977bb3972117d095", "message": "Move isCopyingQuestion finalize callback", "committedDate": "2020-08-05T14:50:48Z", "type": "commit"}, {"oid": "3305affb8280bd9bb49fca71977bb3972117d095", "url": "https://github.com/TEAMMATES/teammates/commit/3305affb8280bd9bb49fca71977bb3972117d095", "message": "Move isCopyingQuestion finalize callback", "committedDate": "2020-08-05T14:50:48Z", "type": "forcePushed"}, {"oid": "8bcf5f90ec08dd3d5d042069717597b126bbfa47", "url": "https://github.com/TEAMMATES/teammates/commit/8bcf5f90ec08dd3d5d042069717597b126bbfa47", "message": "Explicitly set isFeedbackSessionQuestionResponsesLoading", "committedDate": "2020-08-06T02:22:29Z", "type": "commit"}, {"oid": "db0398fe30388e4f48da7a88e912f1fec708c059", "url": "https://github.com/TEAMMATES/teammates/commit/db0398fe30388e4f48da7a88e912f1fec708c059", "message": "Merge branch 'master' into 10509-10524-10525-10535", "committedDate": "2020-08-06T15:31:01Z", "type": "commit"}]}