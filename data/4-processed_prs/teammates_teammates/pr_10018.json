{"pr_number": 10018, "pr_title": "[#9946] Migrate to new admin search endpoint", "pr_createdAt": "2020-04-12T14:37:16Z", "pr_url": "https://github.com/TEAMMATES/teammates/pull/10018", "timeline": [{"oid": "28fa8a2c9243b1318b8166df399e314ee1cf0c0a", "url": "https://github.com/TEAMMATES/teammates/commit/28fa8a2c9243b1318b8166df399e314ee1cf0c0a", "message": "test", "committedDate": "2020-04-13T14:15:06Z", "type": "forcePushed"}, {"oid": "4effd646fffd8d2630de6f93ccf57ce3ea7c90f8", "url": "https://github.com/TEAMMATES/teammates/commit/4effd646fffd8d2630de6f93ccf57ce3ea7c90f8", "message": "fix", "committedDate": "2020-04-13T14:58:15Z", "type": "forcePushed"}, {"oid": "05b4d1bfa5d745d1825f3fa9d3070b1787e3391f", "url": "https://github.com/TEAMMATES/teammates/commit/05b4d1bfa5d745d1825f3fa9d3070b1787e3391f", "message": "Test", "committedDate": "2020-04-14T04:44:07Z", "type": "forcePushed"}, {"oid": "9e25ee3ad0e170800eb3cd69735151a6daea50af", "url": "https://github.com/TEAMMATES/teammates/commit/9e25ee3ad0e170800eb3cd69735151a6daea50af", "message": "Fix", "committedDate": "2020-04-14T09:30:43Z", "type": "forcePushed"}, {"oid": "c51c632e94f07c84f6ae734f249d3c1a09aefe3b", "url": "https://github.com/TEAMMATES/teammates/commit/c51c632e94f07c84f6ae734f249d3c1a09aefe3b", "message": "FINALLY", "committedDate": "2020-04-14T12:01:58Z", "type": "forcePushed"}, {"oid": "83cf947f624350a9d08cee91b32c5e20e5d8e97c", "url": "https://github.com/TEAMMATES/teammates/commit/83cf947f624350a9d08cee91b32c5e20e5d8e97c", "message": "Migrate to the new admin search point and update E2E tests", "committedDate": "2020-04-17T03:58:20Z", "type": "forcePushed"}, {"oid": "2d4afeb284c10cdbb04fd6bcd4d4b6854ae211e8", "url": "https://github.com/TEAMMATES/teammates/commit/2d4afeb284c10cdbb04fd6bcd4d4b6854ae211e8", "message": "Migrate to the new admin search point and update E2E tests", "committedDate": "2020-04-17T04:00:05Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDY1NjkzNg==", "url": "https://github.com/TEAMMATES/teammates/pull/10018#discussion_r410656936", "bodyText": "Can we use empty string instead of undefined? Why the undefined is there in the first place?", "author": "xpdavid", "createdAt": "2020-04-18T06:33:31Z", "path": "src/e2e/java/teammates/e2e/cases/e2e/AdminSearchPageE2ETest.java", "diffHunk": "@@ -177,17 +178,17 @@ private void verifyInstructorRowContent(InstructorAttributes instructor, Account\n     }\n \n     private String getExpectedInstructorHomePageLink(InstructorAttributes instructor) {\n-        return instructor.isRegistered() ? createUrl(Const.WebPageURIs.INSTRUCTOR_HOME_PAGE)\n-                .withUserId(instructor.googleId)\n-                .toAbsoluteString()\n-                : \"\";\n+        String googleId = instructor.isRegistered() ? instructor.googleId : \"undefined\";", "originalCommit": "2d4afeb284c10cdbb04fd6bcd4d4b6854ae211e8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDY3MjU0Mw==", "url": "https://github.com/TEAMMATES/teammates/pull/10018#discussion_r410672543", "bodyText": "Yep, we can, we can even remove the param if its value its an empty string, which I use another function in link.service.ts to fix", "author": "hcwong", "createdAt": "2020-04-18T09:10:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDY1NjkzNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDY1Njk1NA==", "url": "https://github.com/TEAMMATES/teammates/pull/10018#discussion_r410656954", "bodyText": "Same here", "author": "xpdavid", "createdAt": "2020-04-18T06:33:39Z", "path": "src/e2e/java/teammates/e2e/cases/e2e/AdminSearchPageE2ETest.java", "diffHunk": "@@ -177,17 +178,17 @@ private void verifyInstructorRowContent(InstructorAttributes instructor, Account\n     }\n \n     private String getExpectedInstructorHomePageLink(InstructorAttributes instructor) {\n-        return instructor.isRegistered() ? createUrl(Const.WebPageURIs.INSTRUCTOR_HOME_PAGE)\n-                .withUserId(instructor.googleId)\n-                .toAbsoluteString()\n-                : \"\";\n+        String googleId = instructor.isRegistered() ? instructor.googleId : \"undefined\";\n+        return createUrl(Const.WebPageURIs.INSTRUCTOR_HOME_PAGE)\n+                .withUserId(googleId)\n+                .toAbsoluteString();\n     }\n \n     private String getExpectedInstructorManageAccountLink(InstructorAttributes instructor) {\n-        return instructor.isRegistered() ? createUrl(Const.WebPageURIs.ADMIN_ACCOUNTS_PAGE)\n-                .withInstructorId(instructor.googleId)\n-                .toAbsoluteString()\n-                : \"\";\n+        String googleId = instructor.isRegistered() ? instructor.googleId : \"undefined\";", "originalCommit": "2d4afeb284c10cdbb04fd6bcd4d4b6854ae211e8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDY3MjYzNg==", "url": "https://github.com/TEAMMATES/teammates/pull/10018#discussion_r410672636", "bodyText": "Yep, I just didn't add a destructuring default value, so adding a default value prevents the stringified form of undefined from appearing, fixed", "author": "hcwong", "createdAt": "2020-04-18T09:11:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDY1Njk1NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDY1NzA1OA==", "url": "https://github.com/TEAMMATES/teammates/pull/10018#discussion_r410657058", "bodyText": "So it should be change to verifyAccessibleForAdmin?", "author": "xpdavid", "createdAt": "2020-04-18T06:34:34Z", "path": "src/test/java/teammates/test/cases/webapi/GetCourseActionTest.java", "diffHunk": "@@ -178,7 +178,6 @@ protected void testAccessControl_testStudentAccess_shouldPass() {\n         verifyInaccessibleWithoutLogin(submissionParams);\n         verifyInaccessibleForUnregisteredUsers(submissionParams);\n         verifyInaccessibleForInstructors(submissionParams);\n-        verifyInaccessibleForAdmin(submissionParams);", "originalCommit": "2d4afeb284c10cdbb04fd6bcd4d4b6854ae211e8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDY3MjY3NQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10018#discussion_r410672675", "bodyText": "Yea, should have done this welp thanks, fixed!", "author": "hcwong", "createdAt": "2020-04-18T09:11:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDY1NzA1OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDY1NzA2OA==", "url": "https://github.com/TEAMMATES/teammates/pull/10018#discussion_r410657068", "bodyText": "Same here", "author": "xpdavid", "createdAt": "2020-04-18T06:34:40Z", "path": "src/test/java/teammates/test/cases/webapi/GetFeedbackSessionsActionTest.java", "diffHunk": "@@ -269,11 +269,6 @@ protected void testAccessControl() throws Exception {\n         loginAsStudentInstructor(instructor1OfCourse1.googleId);\n         verifyCanAccess(courseParam);\n \n-        String[] adminEntityParam = {\n-                Const.ParamsNames.ENTITY_TYPE, Const.EntityType.ADMIN,\n-        };\n-\n-        verifyInaccessibleForAdmin(adminEntityParam);", "originalCommit": "2d4afeb284c10cdbb04fd6bcd4d4b6854ae211e8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDY1NzA3Mw==", "url": "https://github.com/TEAMMATES/teammates/pull/10018#discussion_r410657073", "bodyText": "Same here", "author": "xpdavid", "createdAt": "2020-04-18T06:34:45Z", "path": "src/test/java/teammates/test/cases/webapi/GetInstructorPrivilegeActionTest.java", "diffHunk": "@@ -410,7 +410,6 @@ protected void testAccessControl() throws Exception {\n         verifyInaccessibleWithoutLogin(submissionParams);\n         verifyInaccessibleForUnregisteredUsers(submissionParams);\n         verifyInaccessibleForStudents(submissionParams);\n-        verifyInaccessibleForAdmin(submissionParams);", "originalCommit": "2d4afeb284c10cdbb04fd6bcd4d4b6854ae211e8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDY1NzM3Mw==", "url": "https://github.com/TEAMMATES/teammates/pull/10018#discussion_r410657373", "bodyText": "The alignment is not correct?", "author": "xpdavid", "createdAt": "2020-04-18T06:37:33Z", "path": "src/web/services/search.service.ts", "diffHunk": "@@ -359,19 +362,21 @@ export class SearchService {\n     const distinctCourseIds: string[] = Object.keys(distinctInstructorsMap);\n     const instructorsArray: Instructors[] = Object.values(distinctInstructorsMap);\n     return forkJoin(\n-      of(distinctCourseIds),\n-      forkJoin(instructorsArray.map((instructors: Instructors) => {\n-        return forkJoin(\n-          instructors.instructors.map(\n-            (instructor: Instructor) => this.instructorService.loadInstructorPrivilege(\n-              {\n-                courseId: instructor.courseId,\n-                instructorId: instructor.googleId,\n-              },\n-            ),\n-          ),\n-        );\n-      })),\n+      instructorsArray.length === 0\n+        ? of([])\n+        : of(distinctCourseIds),\n+          forkJoin(instructorsArray.map((instructors: Instructors) => {", "originalCommit": "2d4afeb284c10cdbb04fd6bcd4d4b6854ae211e8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDY3MjQ3OA==", "url": "https://github.com/TEAMMATES/teammates/pull/10018#discussion_r410672478", "bodyText": "\ud83d\udc40 sorry mistakenly committed this code, this should not be there, removed it thanks", "author": "hcwong", "createdAt": "2020-04-18T09:09:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDY1NzM3Mw=="}], "type": "inlineReview"}, {"oid": "a478dc3783e92c561cfaa3d507285d3bfe528c9f", "url": "https://github.com/TEAMMATES/teammates/commit/a478dc3783e92c561cfaa3d507285d3bfe528c9f", "message": "Migrate to the new admin search point and update E2E tests", "committedDate": "2020-04-20T16:46:05Z", "type": "commit"}, {"oid": "7aaab4b46b8ccfac3fe4522036d08ae8e570203f", "url": "https://github.com/TEAMMATES/teammates/commit/7aaab4b46b8ccfac3fe4522036d08ae8e570203f", "message": "Fix comments", "committedDate": "2020-04-20T16:46:05Z", "type": "commit"}, {"oid": "eac5eb51e09137eff0d04f8c52729f400a011ee3", "url": "https://github.com/TEAMMATES/teammates/commit/eac5eb51e09137eff0d04f8c52729f400a011ee3", "message": "Fix link service to remove empty param values", "committedDate": "2020-04-20T16:46:05Z", "type": "commit"}, {"oid": "94e8aa71b30e37bb8fdc9a41defb9141e316a033", "url": "https://github.com/TEAMMATES/teammates/commit/94e8aa71b30e37bb8fdc9a41defb9141e316a033", "message": "Fix linting", "committedDate": "2020-04-20T16:46:05Z", "type": "commit"}, {"oid": "e43369c29a5622196561ee97121a68a1900dae60", "url": "https://github.com/TEAMMATES/teammates/commit/e43369c29a5622196561ee97121a68a1900dae60", "message": "remove line", "committedDate": "2020-04-20T16:46:05Z", "type": "commit"}, {"oid": "0294d0e9e4bc6aad81d7871b654465d3f3c4e9a1", "url": "https://github.com/TEAMMATES/teammates/commit/0294d0e9e4bc6aad81d7871b654465d3f3c4e9a1", "message": "Fix indentation", "committedDate": "2020-04-20T16:46:05Z", "type": "commit"}, {"oid": "0294d0e9e4bc6aad81d7871b654465d3f3c4e9a1", "url": "https://github.com/TEAMMATES/teammates/commit/0294d0e9e4bc6aad81d7871b654465d3f3c4e9a1", "message": "Fix indentation", "committedDate": "2020-04-20T16:46:05Z", "type": "forcePushed"}, {"oid": "64fe9759b608f91f3c146f5daeb747f061be60f8", "url": "https://github.com/TEAMMATES/teammates/commit/64fe9759b608f91f3c146f5daeb747f061be60f8", "message": "Refactor filterEmptyParam to navigationService", "committedDate": "2020-04-20T17:05:53Z", "type": "commit"}, {"oid": "8f1efd47c7f0e6ca004ecba27be9e80b5a8b1d38", "url": "https://github.com/TEAMMATES/teammates/commit/8f1efd47c7f0e6ca004ecba27be9e80b5a8b1d38", "message": "fix linter errors", "committedDate": "2020-04-20T17:12:13Z", "type": "commit"}, {"oid": "20a6aa51c90ce430a70c07884eefc8cf1a22fc85", "url": "https://github.com/TEAMMATES/teammates/commit/20a6aa51c90ce430a70c07884eefc8cf1a22fc85", "message": "remove unnecessary empty line", "committedDate": "2020-04-20T17:13:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTc4MjI1Nw==", "url": "https://github.com/TEAMMATES/teammates/pull/10018#discussion_r411782257", "bodyText": "What if we want to pass an argument with an empty string?\nI don't think we have the case but we should not hide the removing logic in src/web/services/navigation.service.ts. I think if you don't want the empty string, it should not be passed into the service in the first place.\nThe empty string and undefined value is too different case.\nIs there any engineering difficulties that make you do this?", "author": "xpdavid", "createdAt": "2020-04-21T00:28:52Z", "path": "src/web/services/navigation.service.ts", "diffHunk": "@@ -24,6 +24,17 @@ export class NavigationService {\n       .join('&')}`;\n   }\n \n+  /**\n+   * Removes params keys whose values are the empty string\n+   */\n+  filterEmptyParams(params: {[key: string]: string}): void {", "originalCommit": "20a6aa51c90ce430a70c07884eefc8cf1a22fc85", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTc5MDk0NA==", "url": "https://github.com/TEAMMATES/teammates/pull/10018#discussion_r411790944", "bodyText": "Hey Xiao Pu, this was created in order to replicate the current behaviour in AppUrl.java, which removes empty params when generating the links.  I thought that I should change it to match the current format. Let me know if I can change the format.\nThis function is also not called on encodeParams by default, so the case of passing empty string is still allowed\nI could move this logic back to link.service to make it clear that it's a link issue. What do you think?", "author": "hcwong", "createdAt": "2020-04-21T00:54:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTc4MjI1Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTc5MTgyNw==", "url": "https://github.com/TEAMMATES/teammates/pull/10018#discussion_r411791827", "bodyText": "I think link.service is better.", "author": "xpdavid", "createdAt": "2020-04-21T00:57:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTc4MjI1Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTc5NjYwMg==", "url": "https://github.com/TEAMMATES/teammates/pull/10018#discussion_r411796602", "bodyText": "Cool, fixed!", "author": "hcwong", "createdAt": "2020-04-21T01:11:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTc4MjI1Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTc4MzMyMw==", "url": "https://github.com/TEAMMATES/teammates/pull/10018#discussion_r411783323", "bodyText": "The change is for?\nThe url param should all be in lower case?", "author": "xpdavid", "createdAt": "2020-04-21T00:32:08Z", "path": "src/web/services/instructor.service.ts", "diffHunk": "@@ -122,11 +122,11 @@ export class InstructorService {\n     }\n \n     if (queryParams.instructorRole) {\n-      paramMap.sectionname = queryParams.instructorRole;\n+      paramMap.instructorrole = queryParams.instructorRole;", "originalCommit": "20a6aa51c90ce430a70c07884eefc8cf1a22fc85", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTc4ODQ2Mw==", "url": "https://github.com/TEAMMATES/teammates/pull/10018#discussion_r411788463", "bodyText": "This change is a typo in the current code.\nThe line above already (lines 120-122) handles the sectionname case\n if (queryParams.sectionName) {\n      paramMap.sectionname = queryParams.sectionName;\n }", "author": "hcwong", "createdAt": "2020-04-21T00:47:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTc4MzMyMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTc4MzM3NQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10018#discussion_r411783375", "bodyText": "Same here?", "author": "xpdavid", "createdAt": "2020-04-21T00:32:18Z", "path": "src/web/services/instructor.service.ts", "diffHunk": "@@ -122,11 +122,11 @@ export class InstructorService {\n     }\n \n     if (queryParams.instructorRole) {\n-      paramMap.sectionname = queryParams.instructorRole;\n+      paramMap.instructorrole = queryParams.instructorRole;\n     }\n \n     if (queryParams.instructorEmail) {\n-      paramMap.instructorEmail = queryParams.instructorEmail;\n+      paramMap.instructoremail = queryParams.instructorEmail;", "originalCommit": "20a6aa51c90ce430a70c07884eefc8cf1a22fc85", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTc4OTEwNg==", "url": "https://github.com/TEAMMATES/teammates/pull/10018#discussion_r411789106", "bodyText": "This change is also due to a typo in the current code.\nBackend expects the param name Const.ParamNames.INSTRUCTOR_EMAIL to be the lower case instructoremail", "author": "hcwong", "createdAt": "2020-04-21T00:49:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTc4MzM3NQ=="}], "type": "inlineReview"}, {"oid": "a1de0c7f334df1a4f49a80c80b82f0f2f404f642", "url": "https://github.com/TEAMMATES/teammates/commit/a1de0c7f334df1a4f49a80c80b82f0f2f404f642", "message": "Move filterEmptyParam logic back to link service", "committedDate": "2020-04-21T01:10:38Z", "type": "commit"}]}