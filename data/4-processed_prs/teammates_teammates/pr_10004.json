{"pr_number": 10004, "pr_title": "[#9940] Refactor Admin Endpoints", "pr_createdAt": "2020-03-31T15:53:05Z", "pr_url": "https://github.com/TEAMMATES/teammates/pull/10004", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQ3ODE3OQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10004#discussion_r402478179", "bodyText": "Might be worthwhile to have dummy values instead of blank strings", "author": "madanalogy", "createdAt": "2020-04-02T17:17:31Z", "path": "src/web/services/error-report.service.spec.ts", "diffHunk": "@@ -0,0 +1,44 @@\n+import { TestBed } from '@angular/core/testing';\n+\n+import { HttpClientTestingModule } from '@angular/common/http/testing';\n+import { ResourceEndpoints } from '../types/api-endpoints';\n+import { ErrorReportRequest } from '../types/api-request';\n+import { ErrorReportService } from './error-report.service';\n+import { HttpRequestService } from './http-request.service';\n+\n+describe('ErrorReportService', () => {\n+  let spyHttpRequestService: any;\n+  let service: ErrorReportService;\n+\n+  beforeEach(() => {\n+    spyHttpRequestService = {\n+      get: jest.fn(),\n+      post: jest.fn(),\n+      put: jest.fn(),\n+      delete: jest.fn(),\n+    };\n+    TestBed.configureTestingModule({\n+      imports: [\n+        HttpClientTestingModule,\n+      ],\n+      providers: [\n+        { provide: HttpRequestService, useValue: spyHttpRequestService },\n+      ],\n+    });\n+    service = TestBed.get(ErrorReportService);\n+  });\n+\n+  it('should be created', () => {\n+    expect(service).toBeTruthy();\n+  });\n+\n+  it('should execute POST when sending an error report', () => {\n+    const request: ErrorReportRequest = {\n+      requestId: '',\n+      subject: '',\n+      content: '',", "originalCommit": "885f534f2ad3758ff97478fcaeb0b02bd1d71358", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "47674529b4d08034016ac21c075c4752ae7e0605", "url": "https://github.com/TEAMMATES/teammates/commit/47674529b4d08034016ac21c075c4752ae7e0605", "message": "Refactor admin endpoints for sessions page", "committedDate": "2020-04-03T21:00:50Z", "type": "commit"}, {"oid": "7bf3c4d251ed6950d17b6ce4b53c1191d626abb3", "url": "https://github.com/TEAMMATES/teammates/commit/7bf3c4d251ed6950d17b6ce4b53c1191d626abb3", "message": "Refactor admin endpoints for submissions page", "committedDate": "2020-04-03T21:00:50Z", "type": "commit"}, {"oid": "4178ebe12ab746949d862851dd786de9e7d358de", "url": "https://github.com/TEAMMATES/teammates/commit/4178ebe12ab746949d862851dd786de9e7d358de", "message": "Add Error reporting service", "committedDate": "2020-04-03T21:00:50Z", "type": "commit"}, {"oid": "9f9a62f092a676d09f755917afb5058aefbb8caf", "url": "https://github.com/TEAMMATES/teammates/commit/9f9a62f092a676d09f755917afb5058aefbb8caf", "message": "Refactor admin endpoints for recovery and submissions page", "committedDate": "2020-04-03T21:00:50Z", "type": "commit"}, {"oid": "8e8a142af22ca611ba36aa6795cd48e30d596121", "url": "https://github.com/TEAMMATES/teammates/commit/8e8a142af22ca611ba36aa6795cd48e30d596121", "message": "Refactor admin DELETE endpoints", "committedDate": "2020-04-03T21:00:50Z", "type": "commit"}, {"oid": "bf572725de0b7c63d3fb126e86b85c17c93e4541", "url": "https://github.com/TEAMMATES/teammates/commit/bf572725de0b7c63d3fb126e86b85c17c93e4541", "message": "Add dummy value to test", "committedDate": "2020-04-03T21:00:50Z", "type": "commit"}, {"oid": "bf572725de0b7c63d3fb126e86b85c17c93e4541", "url": "https://github.com/TEAMMATES/teammates/commit/bf572725de0b7c63d3fb126e86b85c17c93e4541", "message": "Add dummy value to test", "committedDate": "2020-04-03T21:00:50Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzQ0MjEyMA==", "url": "https://github.com/TEAMMATES/teammates/pull/10004#discussion_r403442120", "bodyText": "Nitpicking I guess, but maybe ES6 destructuring can come into handy here, so that you can just do\n// do destructuring here\n// then can simplify this part\nconst paramMap: { [key: string]: string } = {\n   questionid \n   intent,\n   key,\n   moderatedperson\n}", "author": "hcwong", "createdAt": "2020-04-04T08:19:21Z", "path": "src/web/services/feedback-responses.service.ts", "diffHunk": "@@ -119,6 +122,24 @@ export class FeedbackResponsesService {\n     }\n   }\n \n+  /**\n+   * Retrieves a feedback response by calling API.\n+   */\n+  getFeedbackResponse(queryParams: {\n+    questionId: string,\n+    intent: Intent,\n+    key: string,\n+    moderatedPerson: string,\n+  }): Observable<FeedbackResponsesResponse> {\n+    const paramMap: { [key: string]: string } = {\n+      questionid: queryParams.questionId,\n+      intent: queryParams.intent,", "originalCommit": "bf572725de0b7c63d3fb126e86b85c17c93e4541", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzQ0NDQ1NQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10004#discussion_r403444455", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  googleId: id,\n          \n          \n            \n                  googleId: this.accountInfo.googleId,\n          \n      \n    \n    \n  \n\nCan it be this instead? Then we can get rid of the id local variable since it isn't used anywhere else.", "author": "dvrylc", "createdAt": "2020-04-04T08:46:37Z", "path": "src/web/app/pages-admin/admin-accounts-page/admin-accounts-page.component.ts", "diffHunk": "@@ -97,11 +103,10 @@ export class AdminAccountsPageComponent implements OnInit {\n    */\n   removeStudentFromCourse(courseId: string): void {\n     const id: string = this.accountInfo.googleId;\n-    const paramMap: { [key: string]: string } = {\n-      googleid: id,\n-      courseid: courseId,\n-    };\n-    this.httpRequestService.delete('/student', paramMap).subscribe(() => {\n+    this.studentService.deleteStudent({\n+      courseId,\n+      googleId: id,", "originalCommit": "bf572725de0b7c63d3fb126e86b85c17c93e4541", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzQ0NDkxMA==", "url": "https://github.com/TEAMMATES/teammates/pull/10004#discussion_r403444910", "bodyText": "Same as above", "author": "dvrylc", "createdAt": "2020-04-04T08:51:32Z", "path": "src/web/app/pages-admin/admin-accounts-page/admin-accounts-page.component.ts", "diffHunk": "@@ -114,11 +119,10 @@ export class AdminAccountsPageComponent implements OnInit {\n    */\n   removeInstructorFromCourse(courseId: string): void {\n     const id: string = this.accountInfo.googleId;\n-    const paramMap: { [key: string]: string } = {\n-      instructorid: id,\n-      courseid: courseId,\n-    };\n-    this.httpRequestService.delete('/instructor', paramMap).subscribe(() => {\n+    this.instructorService.deleteInstructor({\n+      courseId,\n+      instructorId: id,", "originalCommit": "bf572725de0b7c63d3fb126e86b85c17c93e4541", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzQ0NTE1NQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10004#discussion_r403445155", "bodyText": "Since courseid and fsname are used twice in this function, consider destructuring queryParams as { courseid: courseId, fsname: feedbackSessionName } so that this object and the one below can be simplified?", "author": "dvrylc", "createdAt": "2020-04-04T08:53:55Z", "path": "src/web/app/pages-session/session-result-page/session-result-page.component.ts", "diffHunk": "@@ -27,26 +23,29 @@ export class SessionResultPageComponent implements OnInit {\n   formattedSessionOpeningTime: string = '';\n   formattedSessionClosingTime: string = '';\n \n-  constructor(private httpRequestService: HttpRequestService, private route: ActivatedRoute,\n+  constructor(private feedbackSessionsService: FeedbackSessionsService, private route: ActivatedRoute,\n       private timezoneService: TimezoneService, private statusMessageService: StatusMessageService) {\n     this.timezoneService.getTzVersion(); // import timezone service to load timezone data\n   }\n \n   ngOnInit(): void {\n     this.route.queryParams.subscribe((queryParams: any) => {\n-      const paramMap: { [key: string]: string } = {\n-        courseid: queryParams.courseid,\n-        fsname: queryParams.fsname,\n+      this.feedbackSessionsService.getFeedbackSession({\n+        courseId: queryParams.courseid,\n+        feedbackSessionName: queryParams.fsname,", "originalCommit": "bf572725de0b7c63d3fb126e86b85c17c93e4541", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "86d85fb7c734458f96f2ae1f4fe8e785aaf5d3c6", "url": "https://github.com/TEAMMATES/teammates/commit/86d85fb7c734458f96f2ae1f4fe8e785aaf5d3c6", "message": "Fix minor syntax issues", "committedDate": "2020-04-04T16:20:54Z", "type": "commit"}]}