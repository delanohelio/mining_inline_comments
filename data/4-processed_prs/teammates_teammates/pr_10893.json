{"pr_number": 10893, "pr_title": "[#10682] Instructor copying sessions: show spinner while copying is in progress", "pr_createdAt": "2020-12-24T11:48:31Z", "pr_url": "https://github.com/TEAMMATES/teammates/pull/10893", "timeline": [{"oid": "2ceef5f1cf103e3b541f8f84e6782c6dd279d44d", "url": "https://github.com/TEAMMATES/teammates/commit/2ceef5f1cf103e3b541f8f84e6782c6dd279d44d", "message": "Add spinner for copy button", "committedDate": "2020-12-24T11:38:01Z", "type": "commit"}, {"oid": "1c818beec236e08a3635f722bd3ddc5fe4061ff8", "url": "https://github.com/TEAMMATES/teammates/commit/1c818beec236e08a3635f722bd3ddc5fe4061ff8", "message": "Merge branch 'master' into 10682-add-spinner-for-copying-sessions", "committedDate": "2020-12-24T11:53:45Z", "type": "commit"}, {"oid": "f9862805c637b5b516bd2d91bb715915a8578041", "url": "https://github.com/TEAMMATES/teammates/commit/f9862805c637b5b516bd2d91bb715915a8578041", "message": "Fix syntax error", "committedDate": "2020-12-24T12:31:45Z", "type": "commit"}, {"oid": "c35e41149c54f8ca4ec1c22d0912044514392cc1", "url": "https://github.com/TEAMMATES/teammates/commit/c35e41149c54f8ca4ec1c22d0912044514392cc1", "message": "Merge branch '10682-add-spinner-for-copying-sessions' of https://github.com/hhdqirui/teammates into 10682-add-spinner-for-copying-sessions", "committedDate": "2020-12-24T12:33:21Z", "type": "commit"}, {"oid": "4eeee8b235f886962d2f10fbd9b86a43a8703ce1", "url": "https://github.com/TEAMMATES/teammates/commit/4eeee8b235f886962d2f10fbd9b86a43a8703ce1", "message": "Merge branch 'master' into 10682-add-spinner-for-copying-sessions", "committedDate": "2020-12-25T08:32:45Z", "type": "commit"}, {"oid": "64ef0c21db8423be26221e202e9e8daccabfc30a", "url": "https://github.com/TEAMMATES/teammates/commit/64ef0c21db8423be26221e202e9e8daccabfc30a", "message": "Merge branch 'master' into 10682-add-spinner-for-copying-sessions", "committedDate": "2020-12-26T06:27:51Z", "type": "commit"}, {"oid": "0fbbc036bdb1a7e800b52c220a50f7df9425bdcb", "url": "https://github.com/TEAMMATES/teammates/commit/0fbbc036bdb1a7e800b52c220a50f7df9425bdcb", "message": "Change finish time of loading spinner and its style", "committedDate": "2020-12-27T07:54:02Z", "type": "commit"}, {"oid": "428baff1e294991935a1fdb5685d53659bb94d85", "url": "https://github.com/TEAMMATES/teammates/commit/428baff1e294991935a1fdb5685d53659bb94d85", "message": "Move loading spinner in front of icon in copy button", "committedDate": "2020-12-27T09:24:18Z", "type": "commit"}, {"oid": "8b3a9da70fcedef57ccca690110da2d4d1250cdb", "url": "https://github.com/TEAMMATES/teammates/commit/8b3a9da70fcedef57ccca690110da2d4d1250cdb", "message": "Remove redundant attribute for loading spinner", "committedDate": "2020-12-27T09:26:20Z", "type": "commit"}, {"oid": "a0c7da3c553ec91b0ab8feba458474295401cf95", "url": "https://github.com/TEAMMATES/teammates/commit/a0c7da3c553ec91b0ab8feba458474295401cf95", "message": "Merge branch 'master' into 10682-add-spinner-for-copying-sessions", "committedDate": "2020-12-28T05:06:38Z", "type": "commit"}, {"oid": "9db1a8b726297ed9fe3c10bc5d417322aaec50c2", "url": "https://github.com/TEAMMATES/teammates/commit/9db1a8b726297ed9fe3c10bc5d417322aaec50c2", "message": "Attempt to fix check problem", "committedDate": "2020-12-28T06:07:22Z", "type": "commit"}, {"oid": "e84c9034c3e169d0ae50f4c8626e297ea5213d5f", "url": "https://github.com/TEAMMATES/teammates/commit/e84c9034c3e169d0ae50f4c8626e297ea5213d5f", "message": "Attempt to fix check problem", "committedDate": "2020-12-28T06:07:37Z", "type": "commit"}, {"oid": "9b89fc49b98b50130f05ef211298abb88da4b996", "url": "https://github.com/TEAMMATES/teammates/commit/9b89fc49b98b50130f05ef211298abb88da4b996", "message": "Attempt to fix travis error", "committedDate": "2020-12-28T06:57:46Z", "type": "commit"}, {"oid": "87806891330337179fb83ce2d10a25561a4e0a60", "url": "https://github.com/TEAMMATES/teammates/commit/87806891330337179fb83ce2d10a25561a4e0a60", "message": "Attempt to fix travis error", "committedDate": "2020-12-28T06:57:59Z", "type": "commit"}, {"oid": "87806891330337179fb83ce2d10a25561a4e0a60", "url": "https://github.com/TEAMMATES/teammates/commit/87806891330337179fb83ce2d10a25561a4e0a60", "message": "Attempt to fix travis error", "committedDate": "2020-12-28T06:57:59Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTMyMDAwNg==", "url": "https://github.com/TEAMMATES/teammates/pull/10893#discussion_r559320006", "bodyText": "Why not use .pipe(finalize(...)). That way, you only need to set the isCopying in one place. See the other places with the loading spinner", "author": "t-cheepeng", "createdAt": "2021-01-18T05:09:29Z", "path": "src/web/app/pages-instructor/instructor-session-edit-page/instructor-session-edit-page.component.ts", "diffHunk": "@@ -263,7 +265,9 @@ export class InstructorSessionEditPageComponent extends InstructorSessionBasePag\n             this.showCopyStatusMessage();\n           });\n         }\n-      }, (resp: ErrorMessageOutput) => { this.statusMessageService.showErrorToast(resp.error.message); });\n+        this.sessionEditFormModel.isCopying = false;\n+      }, (resp: ErrorMessageOutput) => { this.statusMessageService.showErrorToast(resp.error.message); })\n+      .catch(() => this.sessionEditFormModel.isCopying = false);", "originalCommit": "87806891330337179fb83ce2d10a25561a4e0a60", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTcxNjkxOQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10893#discussion_r559716919", "bodyText": "I tried to use .pipe(finalize(...)) but I cannot find a place to use it. Property 'pipe' does not exist on type 'Promise' or 'Subscription'.", "author": "hhdqirui", "createdAt": "2021-01-18T17:33:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTMyMDAwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0MjQ3MjQ5Mw==", "url": "https://github.com/TEAMMATES/teammates/pull/10893#discussion_r642472493", "bodyText": "The Promise's equivalence of finalize is .finally(). You can try .finally(() => this.sessionEditFormModel.isCopying = false), instead of repeating the same code in 3 places.", "author": "ccyccyccy", "createdAt": "2021-05-31T13:01:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTMyMDAwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1Njg5Njc4OQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10893#discussion_r656896789", "bodyText": "I tried using finally and remove the repeated code, but doing so will make the spinner to stop prematurely while the backend is still copying.\nmodalRef.result.then((result: CopySessionModalResult) => {\n        this.failedToCopySessions = {};\n        const requestList: Observable<FeedbackSession>[] = this.createSessionCopyRequestsFromModal(\n            result, this.courseId, this.feedbackSessionName);\n        if (requestList.length === 1) {\n          requestList[0].subscribe((createdSession: FeedbackSession) => {\n            if (Object.keys(this.failedToCopySessions).length === 0) {\n              this.navigationService.navigateWithSuccessMessage(this.router,\n                  '/web/instructor/sessions/edit',\n                  'The feedback session has been copied. Please modify settings/questions as necessary.',\n                  { courseid: createdSession.courseId, fsname: createdSession.feedbackSessionName });\n            } else {\n              this.statusMessageService.showErrorToast(this.getCopyErrorMessage());\n            }\n          }, (resp: ErrorMessageOutput) => { this.statusMessageService.showErrorToast(resp.error.message); });\n        }\n        if (requestList.length > 1) {\n          forkJoin(requestList)\n           .subscribe(() => {\n             this.showCopyStatusMessage();\n           });\n        }\n      }, (resp: ErrorMessageOutput) => { this.statusMessageService.showErrorToast(resp.error.message); })\n      .finally(() => this.sessionEditFormModel.isCopying = false);\n\nThe result of such changes looks like this", "author": "hhdqirui", "createdAt": "2021-06-23T08:55:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTMyMDAwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1NzE1MDMwNQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10893#discussion_r657150305", "bodyText": "Yeah I don't think there's an easy way to do it all in one place for now, since the modal closes before the request returns.", "author": "ccyccyccy", "createdAt": "2021-06-23T14:19:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTMyMDAwNg=="}], "type": "inlineReview"}, {"oid": "32a5ce37632530b928382e10663cabdb4083da80", "url": "https://github.com/TEAMMATES/teammates/commit/32a5ce37632530b928382e10663cabdb4083da80", "message": "Last time testing", "committedDate": "2021-05-09T14:27:29Z", "type": "commit"}, {"oid": "020a7424307e5e7e5ac9466e79b62eb8936c0dee", "url": "https://github.com/TEAMMATES/teammates/commit/020a7424307e5e7e5ac9466e79b62eb8936c0dee", "message": "Merge with master and resolve conflicts later", "committedDate": "2021-05-18T09:26:23Z", "type": "commit"}, {"oid": "819c710cf42969be4abf7ddaa72bde475347679f", "url": "https://github.com/TEAMMATES/teammates/commit/819c710cf42969be4abf7ddaa72bde475347679f", "message": "Resolve merge conflicts", "committedDate": "2021-05-19T03:24:36Z", "type": "commit"}, {"oid": "52a1437131c980c0181860da9b74ea24ad4bbe9a", "url": "https://github.com/TEAMMATES/teammates/commit/52a1437131c980c0181860da9b74ea24ad4bbe9a", "message": "Fix spinner is still spinning after error and exiting copying", "committedDate": "2021-05-19T06:19:25Z", "type": "commit"}, {"oid": "1dceed4df909a8f6cbc0b3b1d01edbe9301c15f5", "url": "https://github.com/TEAMMATES/teammates/commit/1dceed4df909a8f6cbc0b3b1d01edbe9301c15f5", "message": "Fix checkstyle problem", "committedDate": "2021-05-19T06:51:16Z", "type": "commit"}, {"oid": "075ccd930f65ff05f4e4be05eea0217074ffb2db", "url": "https://github.com/TEAMMATES/teammates/commit/075ccd930f65ff05f4e4be05eea0217074ffb2db", "message": "Merge branch 'master' into 10682-add-spinner-for-copying-sessions", "committedDate": "2021-05-24T01:33:50Z", "type": "commit"}, {"oid": "53b8163ff78028528bbec47a83979890be47ccb1", "url": "https://github.com/TEAMMATES/teammates/commit/53b8163ff78028528bbec47a83979890be47ccb1", "message": "Merge branch 'master' into 10682-add-spinner-for-copying-sessions", "committedDate": "2021-05-29T10:17:43Z", "type": "commit"}, {"oid": "3fcfee465de40d41b5dd926ce11aaa1b23a2d0b0", "url": "https://github.com/TEAMMATES/teammates/commit/3fcfee465de40d41b5dd926ce11aaa1b23a2d0b0", "message": "Merge branch 'master' into 10682-add-spinner-for-copying-sessions", "committedDate": "2021-05-31T07:04:35Z", "type": "commit"}, {"oid": "6029cc6b340ed60efdd1e50e093e56cf19c2a589", "url": "https://github.com/TEAMMATES/teammates/commit/6029cc6b340ed60efdd1e50e093e56cf19c2a589", "message": "Merge branch 'master' into 10682-add-spinner-for-copying-sessions", "committedDate": "2021-06-07T01:10:25Z", "type": "commit"}, {"oid": "07a3b9e5ff90abb04d227e289dc2ee2f7690194d", "url": "https://github.com/TEAMMATES/teammates/commit/07a3b9e5ff90abb04d227e289dc2ee2f7690194d", "message": "Merge branch 'master' into 10682-add-spinner-for-copying-sessions", "committedDate": "2021-06-14T07:24:04Z", "type": "commit"}, {"oid": "b2b9f1f2e04664407d2cd897b288c90ea0f01e7f", "url": "https://github.com/TEAMMATES/teammates/commit/b2b9f1f2e04664407d2cd897b288c90ea0f01e7f", "message": "Merge branch 'master' into 10682-add-spinner-for-copying-sessions", "committedDate": "2021-06-21T03:27:54Z", "type": "commit"}, {"oid": "2620c84bf21a407ecef4be77776fdc8710f278ab", "url": "https://github.com/TEAMMATES/teammates/commit/2620c84bf21a407ecef4be77776fdc8710f278ab", "message": "Merge branch 'master' into 10682-add-spinner-for-copying-sessions", "committedDate": "2021-06-23T07:45:16Z", "type": "commit"}, {"oid": "3a6f29e53f34b1a334eaa47c2403496c36804d2f", "url": "https://github.com/TEAMMATES/teammates/commit/3a6f29e53f34b1a334eaa47c2403496c36804d2f", "message": "Merge branch 'master' into 10682-add-spinner-for-copying-sessions", "committedDate": "2021-06-26T01:20:39Z", "type": "commit"}]}