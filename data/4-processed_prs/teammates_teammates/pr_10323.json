{"pr_number": 10323, "pr_title": "[#10322] Rich text editor breaks when moved during reorder ", "pr_createdAt": "2020-07-17T10:28:18Z", "pr_url": "https://github.com/TEAMMATES/teammates/pull/10323", "timeline": [{"oid": "69a8b5de6c3234b9ddbf7dcecbe54ea69092861d", "url": "https://github.com/TEAMMATES/teammates/commit/69a8b5de6c3234b9ddbf7dcecbe54ea69092861d", "message": "Change from moving questionForms to reloading on reorder", "committedDate": "2020-07-17T10:11:44Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjYxODg5OQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10323#discussion_r456618899", "bodyText": "I think we need to explain the workaround a bit as this violate our design in frontend where we want to minimize the unnecessary communication.", "author": "xpdavid", "createdAt": "2020-07-17T18:54:18Z", "path": "src/web/app/pages-instructor/instructor-session-edit-page/instructor-session-edit-page.component.ts", "diffHunk": "@@ -538,24 +538,21 @@ export class InstructorSessionEditPageComponent extends InstructorSessionBasePag\n           this.feedbackQuestionModels.set(updatedQuestion.feedbackQuestionId, updatedQuestion);\n           this.loadResponseStatusForQuestion(this.questionEditFormModels[index]);\n \n-          // shift question if needed\n+          // reload questions in new order if needed\n           if (originalQuestionNumber !== updatedQuestion.questionNumber) {\n-            // move question form\n-            this.moveQuestionForm(\n-                originalQuestionNumber - 1, updatedQuestion.questionNumber - 1);\n-            this.normalizeQuestionNumberInQuestionForms();\n+            this.reloadQuestionForms();\n           }\n \n           this.statusMessageService.showSuccessToast('The changes to the question have been updated.');\n         }, (resp: ErrorMessageOutput) => { this.statusMessageService.showErrorToast(resp.error.message); });\n   }\n \n   /**\n-   * Moves question edit form from the original position to the new position.\n+   * Reloads feedback questions.", "originalCommit": "69a8b5de6c3234b9ddbf7dcecbe54ea69092861d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "452fc0ef0fb3e68a1225213ef23950695ddb071f", "url": "https://github.com/TEAMMATES/teammates/commit/452fc0ef0fb3e68a1225213ef23950695ddb071f", "message": "Merge branch 'master' of https://github.com/TEAMMATES/teammates into fix-reorder", "committedDate": "2020-07-19T03:47:02Z", "type": "commit"}, {"oid": "99fc7e0fd86e8d330b5494d899293144be058321", "url": "https://github.com/TEAMMATES/teammates/commit/99fc7e0fd86e8d330b5494d899293144be058321", "message": "Change from reloading to re-expanding moved questions", "committedDate": "2020-07-19T07:22:28Z", "type": "commit"}, {"oid": "170f86db36689694f7133576b165158dfea0e6d6", "url": "https://github.com/TEAMMATES/teammates/commit/170f86db36689694f7133576b165158dfea0e6d6", "message": "Merge branch 'master' into fix-reorder", "committedDate": "2020-07-19T07:23:43Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjkxOTg4Ng==", "url": "https://github.com/TEAMMATES/teammates/pull/10323#discussion_r456919886", "bodyText": "This will make all modals previously collapsed to be expanded. Only those which are previously expanded should be re-expanded.", "author": "wkurniawan07", "createdAt": "2020-07-19T15:08:13Z", "path": "src/web/app/pages-instructor/instructor-session-edit-page/instructor-session-edit-page.component.ts", "diffHunk": "@@ -556,6 +557,15 @@ export class InstructorSessionEditPageComponent extends InstructorSessionBasePag\n   private moveQuestionForm(originalPosition: number, newPosition: number): void {\n     this.questionEditFormModels.splice(newPosition, 0,\n         this.questionEditFormModels.splice(originalPosition, 1)[0]);\n+\n+    // all expanded questions that were moved upwards must be re-expanded to reload rich text editor\n+    const start: number = Math.min(originalPosition, newPosition);\n+    const movedExpandedQuestions: QuestionEditFormModel[] = this.questionEditFormModels\n+      .slice(start, newPosition + 1)\n+      .filter((model: QuestionEditFormModel) => !model.isCollapsed);\n+    movedExpandedQuestions.forEach((model: QuestionEditFormModel) => model.isCollapsed = true);\n+    this.changeDetectorRef.detectChanges();\n+    movedExpandedQuestions.forEach((model: QuestionEditFormModel) => model.isCollapsed = false);", "originalCommit": "170f86db36689694f7133576b165158dfea0e6d6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjkyMDgyMA==", "url": "https://github.com/TEAMMATES/teammates/pull/10323#discussion_r456920820", "bodyText": "@wkurniawan07  I have filtered to only those that are not collapsed so those that are originally collapsed will not be affected. (line 565)", "author": "jtankw3", "createdAt": "2020-07-19T15:16:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjkxOTg4Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjkyMjU5Mw==", "url": "https://github.com/TEAMMATES/teammates/pull/10323#discussion_r456922593", "bodyText": "Ah right, I missed that.", "author": "wkurniawan07", "createdAt": "2020-07-19T15:33:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjkxOTg4Ng=="}], "type": "inlineReview"}]}