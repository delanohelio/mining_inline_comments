{"pr_number": 10895, "pr_title": "[#8918] Instructor: view results: questions for ranking: show rank within team", "pr_createdAt": "2020-12-25T21:23:05Z", "pr_url": "https://github.com/TEAMMATES/teammates/pull/10895", "timeline": [{"oid": "c681f97c6ebf606d84d860f11acfdf3c3284db04", "url": "https://github.com/TEAMMATES/teammates/commit/c681f97c6ebf606d84d860f11acfdf3c3284db04", "message": "Add team rank and team rank excluding self", "committedDate": "2020-12-25T14:42:01Z", "type": "commit"}, {"oid": "2635a5e4841b084ae8218fc74fa67e8ecd3a5f8e", "url": "https://github.com/TEAMMATES/teammates/commit/2635a5e4841b084ae8218fc74fa67e8ecd3a5f8e", "message": "Add test for team rank", "committedDate": "2020-12-25T19:10:36Z", "type": "commit"}, {"oid": "ca8146dacf85b942e052b71302857ef1c715fd03", "url": "https://github.com/TEAMMATES/teammates/commit/ca8146dacf85b942e052b71302857ef1c715fd03", "message": "Update snapshots", "committedDate": "2020-12-25T20:36:17Z", "type": "commit"}, {"oid": "7268d9bb79821579cd29864a9f0811d13a6d4765", "url": "https://github.com/TEAMMATES/teammates/commit/7268d9bb79821579cd29864a9f0811d13a6d4765", "message": "Fix lint errors", "committedDate": "2020-12-25T21:03:50Z", "type": "commit"}, {"oid": "a41dec99db76bed2f5ac65eae94315e07787cf95", "url": "https://github.com/TEAMMATES/teammates/commit/a41dec99db76bed2f5ac65eae94315e07787cf95", "message": "Merge branch 'master' into 8918-show-rank-within-team", "committedDate": "2021-01-09T06:29:15Z", "type": "commit"}, {"oid": "d1b9cc76b6a53f660249689702fa63812cd4860e", "url": "https://github.com/TEAMMATES/teammates/commit/d1b9cc76b6a53f660249689702fa63812cd4860e", "message": "Add recipient type check for team rank calculation", "committedDate": "2021-01-09T08:17:11Z", "type": "commit"}, {"oid": "872a814073e853370df5c49442278f625a3ec9cd", "url": "https://github.com/TEAMMATES/teammates/commit/872a814073e853370df5c49442278f625a3ec9cd", "message": "Trigger re-run of e2e tests", "committedDate": "2021-01-09T10:11:13Z", "type": "commit"}, {"oid": "7fdaeecfe3bcb6cc5edcfd4ed9565cf4fd4d26c0", "url": "https://github.com/TEAMMATES/teammates/commit/7fdaeecfe3bcb6cc5edcfd4ed9565cf4fd4d26c0", "message": "Merge branch 'master' into 8918-show-rank-within-team", "committedDate": "2021-01-17T14:08:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTE5ODcyNw==", "url": "https://github.com/TEAMMATES/teammates/pull/10895#discussion_r559198727", "bodyText": "we can add more test cases here:\n\nteam rank not calculated depending on recipient type\ncheck team vs team excluding self is correct", "author": "rrtheonlyone", "createdAt": "2021-01-17T15:42:45Z", "path": "src/web/app/components/question-types/question-statistics/rank-recipients-question-statistics.component.spec.ts", "diffHunk": "@@ -24,4 +33,21 @@ describe('RankRecipientsQuestionStatisticsComponent', () => {\n   it('should create', () => {\n     expect(component).toBeTruthy();\n   });\n+\n+  it('should rank correctly within team', () => {", "originalCommit": "7fdaeecfe3bcb6cc5edcfd4ed9565cf4fd4d26c0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTIwMTUyNQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10895#discussion_r559201525", "bodyText": "the naming here is a little confusing - we are referring to recipient but the variable names all somehow say option.\nI think we might be able to streamline this entire statistic calculation with a combination of map, filter and reduce (in a functional manner without for loops).  However, this I leave it up to you: as long as it's readable I am okay.", "author": "rrtheonlyone", "createdAt": "2021-01-17T16:04:49Z", "path": "src/web/app/components/question-types/question-statistics/question-statistics-calculation/rank-recipients-question-statistics-calculation.ts", "diffHunk": "@@ -57,13 +66,26 @@ export class RankRecipientsQuestionStatisticsCalculation\n       if (!this.emailToName[identifier]) {\n         this.emailToName[identifier] = response.recipient;\n       }\n+\n+      optionsPerTeam[response.recipientTeam] = optionsPerTeam[response.recipientTeam] || [];", "originalCommit": "7fdaeecfe3bcb6cc5edcfd4ed9565cf4fd4d26c0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f63610b107152a644c241cc4609f5432ba387435", "url": "https://github.com/TEAMMATES/teammates/commit/f63610b107152a644c241cc4609f5432ba387435", "message": "Add help page and declerative methods", "committedDate": "2021-01-18T16:04:57Z", "type": "commit"}, {"oid": "66813794a28b475c99e3a0b0d304d23f060aad19", "url": "https://github.com/TEAMMATES/teammates/commit/66813794a28b475c99e3a0b0d304d23f060aad19", "message": "Merge branch 'master' into 8918-show-rank-within-team", "committedDate": "2021-02-07T11:26:58Z", "type": "commit"}, {"oid": "321239aa61b1e82975ac22374eb1b05fabe60e79", "url": "https://github.com/TEAMMATES/teammates/commit/321239aa61b1e82975ac22374eb1b05fabe60e79", "message": "Merge branch 'master' into 8918-show-rank-within-team", "committedDate": "2021-02-21T15:38:43Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3OTk2MjM5OQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10895#discussion_r579962399", "bodyText": "Shouldn't this be indented? But okay not a big deal since the lint check passes", "author": "madanalogy", "createdAt": "2021-02-22T03:23:28Z", "path": "src/web/app/components/question-types/question-statistics/rank-recipients-question-statistics.component.spec.ts", "diffHunk": "@@ -1,8 +1,17 @@\n import { async, ComponentFixture, TestBed } from '@angular/core/testing';\n-\n+import { FeedbackParticipantType, FeedbackRankRecipientsResponseDetails } from '../../../../types/api-output';\n import { SortableTableModule } from '../../sortable-table/sortable-table.module';\n+import { Response } from './question-statistics';\n import { RankRecipientsQuestionStatisticsComponent } from './rank-recipients-question-statistics.component';\n \n+/**\n+ * Loads data for testing.\n+ */\n+const loadTestData: (filename: string) => Response<FeedbackRankRecipientsResponseDetails>[] =\n+(filename: string): Response<FeedbackRankRecipientsResponseDetails>[] => {", "originalCommit": "321239aa61b1e82975ac22374eb1b05fabe60e79", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3OTk2MzA1MA==", "url": "https://github.com/TEAMMATES/teammates/pull/10895#discussion_r579963050", "bodyText": "Brackets not needed", "author": "madanalogy", "createdAt": "2021-02-22T03:26:11Z", "path": "src/web/app/pages-help/instructor-help-page/instructor-help-questions-section/instructor-help-questions-section.component.html", "diffHunk": "@@ -658,6 +658,9 @@ <h4 *ngIf=\"displaySubsection(0, 10)\">Setting Up Questions</h4>\n       <li>\n         <b>Overall rank</b>: the recipient's rank relative to other recipients, as computed by TEAMMATES.\n       </li>\n+      <li>\n+        <b>Team rank</b>: the recipient's rank relative to other recipients within their own team only. (Applicable only if students rank their teammates)", "originalCommit": "321239aa61b1e82975ac22374eb1b05fabe60e79", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3OTk2NDgyMA==", "url": "https://github.com/TEAMMATES/teammates/pull/10895#discussion_r579964820", "bodyText": "Any particular reason why test data is stored in a separate file? I'm not entirely against the approach don't get me wrong, just that our frontend tests so far all have their data embedded in the spec.ts file so I'm wondering if you had any particular reason for the extraction of data.\nI can understand the extraction if the same data is being used by other test components but this doesn't seem to be the case. Would be better for now to just have the data as a constant variable as in other frontend tests for consistency (e.g. instructor-home-page.component.spec.ts)", "author": "madanalogy", "createdAt": "2021-02-22T03:33:44Z", "path": "src/web/app/components/question-types/question-statistics/rank-recipients-question-statistics.component.spec.ts", "diffHunk": "@@ -1,8 +1,17 @@\n import { async, ComponentFixture, TestBed } from '@angular/core/testing';\n-\n+import { FeedbackParticipantType, FeedbackRankRecipientsResponseDetails } from '../../../../types/api-output';\n import { SortableTableModule } from '../../sortable-table/sortable-table.module';\n+import { Response } from './question-statistics';\n import { RankRecipientsQuestionStatisticsComponent } from './rank-recipients-question-statistics.component';\n \n+/**\n+ * Loads data for testing.\n+ */\n+const loadTestData: (filename: string) => Response<FeedbackRankRecipientsResponseDetails>[] =\n+(filename: string): Response<FeedbackRankRecipientsResponseDetails>[] => {\n+  return require(`./test-data/${filename}`);", "originalCommit": "321239aa61b1e82975ac22374eb1b05fabe60e79", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4MDE3MjE2Ng==", "url": "https://github.com/TEAMMATES/teammates/pull/10895#discussion_r580172166", "bodyText": "Just felt that the code looked bad cosmetically with sample data and decided to put it in a JSON. Reverted", "author": "AdithyaNarayan", "createdAt": "2021-02-22T11:20:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3OTk2NDgyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4MDE3MzU0NQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10895#discussion_r580173545", "bodyText": "You could consider putting up an issue for this actually, I remember it was something I wanted to raise but didn't have the time to. That is to say, refactor frontend test data into a dedicated resource folder for reusability instead of having it nested within the spec.ts files. We can have a community discussion about this, and if the idea is adopted start taking the approach as an epic/task.", "author": "madanalogy", "createdAt": "2021-02-22T11:22:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3OTk2NDgyMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3OTk2NTM1NA==", "url": "https://github.com/TEAMMATES/teammates/pull/10895#discussion_r579965354", "bodyText": "Typo in the sentence, I'm assuming the period at the end of \"team\" was unintended", "author": "madanalogy", "createdAt": "2021-02-22T03:36:03Z", "path": "src/web/app/pages-help/instructor-help-page/instructor-help-questions-section/instructor-help-questions-section.component.html", "diffHunk": "@@ -672,6 +675,12 @@ <h4 *ngIf=\"displaySubsection(0, 10)\">Setting Up Questions</h4>\n           The <b>Overall Rank</b> ranks the average rank each recipient receives.\n           For example, if recipient A received the ranks <code>(1, 2)</code> and recipient B received the ranks <code>(2, 4, 6)</code>, then recipient A and recipient B's average ranks are 1.5 and 4 respectively. By ranking these two averages, recipient A and B will get an <b>Overall Rank</b> of 1 and 2 respectively.\n         </li>\n+        <li>\n+          The <b>Team Rank</b> works in a similar way to <b>Overall Rank</b> as it uses the average rank received to calculate the rank within the team. to the average rank each recipient receives. However, the average rank of the members are only compared to their own team members.", "originalCommit": "321239aa61b1e82975ac22374eb1b05fabe60e79", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3OTk2NTQyMg==", "url": "https://github.com/TEAMMATES/teammates/pull/10895#discussion_r579965422", "bodyText": "Unnecessary starting And, can be removed", "author": "madanalogy", "createdAt": "2021-02-22T03:36:24Z", "path": "src/web/app/pages-help/instructor-help-page/instructor-help-questions-section/instructor-help-questions-section.component.html", "diffHunk": "@@ -672,6 +675,12 @@ <h4 *ngIf=\"displaySubsection(0, 10)\">Setting Up Questions</h4>\n           The <b>Overall Rank</b> ranks the average rank each recipient receives.\n           For example, if recipient A received the ranks <code>(1, 2)</code> and recipient B received the ranks <code>(2, 4, 6)</code>, then recipient A and recipient B's average ranks are 1.5 and 4 respectively. By ranking these two averages, recipient A and B will get an <b>Overall Rank</b> of 1 and 2 respectively.\n         </li>\n+        <li>\n+          The <b>Team Rank</b> works in a similar way to <b>Overall Rank</b> as it uses the average rank received to calculate the rank within the team. to the average rank each recipient receives. However, the average rank of the members are only compared to their own team members.\n+          For example, if recipient A (who is a part of team X) received the ranks <code>(1, 2)</code> and recipient B (who is a part of team X) received the ranks <code>(2, 4, 6)</code>, then recipient A and recipient B's average ranks are 1.5 and 4 respectively. By ranking these two averages, recipient A and B will get a <b>Team Rank</b> of 1 and 2 respectively.\n+          And if recipient C (who is a part of team Y) received the ranks <code>(1, 1)</code> and recipient D (who is a part of team Y) received the ranks <code>(1, 2)</code>, then recipient C and recipient D's average ranks are 1 and 1.5 respectively. By ranking these two averages, recipient C and D will get a <b>Team Rank</b> of 1 and 2 respectively.", "originalCommit": "321239aa61b1e82975ac22374eb1b05fabe60e79", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "dbd59f8168e2416d836ce3a4c4481da15c534062", "url": "https://github.com/TEAMMATES/teammates/commit/dbd59f8168e2416d836ce3a4c4481da15c534062", "message": "Move test-data from json into spec.ts file", "committedDate": "2021-02-22T11:17:51Z", "type": "commit"}, {"oid": "e9bc1999ef895c392d9fd7abee382ffc2bc4d903", "url": "https://github.com/TEAMMATES/teammates/commit/e9bc1999ef895c392d9fd7abee382ffc2bc4d903", "message": "Merge branch 'master' into 8918-show-rank-within-team", "committedDate": "2021-02-22T11:23:59Z", "type": "commit"}]}