{"pr_number": 10183, "pr_title": "[#10182] Add custom component for sortable table, with contribution statistics using it", "pr_createdAt": "2020-06-11T14:08:44Z", "pr_url": "https://github.com/TEAMMATES/teammates/pull/10183", "timeline": [{"oid": "9235f9c4e8f6a0033212a7586023541809332f58", "url": "https://github.com/TEAMMATES/teammates/commit/9235f9c4e8f6a0033212a7586023541809332f58", "message": "Modify sortable table to accept custom components to render within the table cell", "committedDate": "2020-06-11T11:52:01Z", "type": "commit"}, {"oid": "844dd5d8303ed38c2e20a79b952553777c137dd2", "url": "https://github.com/TEAMMATES/teammates/commit/844dd5d8303ed38c2e20a79b952553777c137dd2", "message": "Add sortable table for contribution statistics", "committedDate": "2020-06-11T11:53:36Z", "type": "commit"}, {"oid": "88b530e6d6147f5c6e341010b105a880663e92e9", "url": "https://github.com/TEAMMATES/teammates/commit/88b530e6d6147f5c6e341010b105a880663e92e9", "message": "Lint and test fix", "committedDate": "2020-06-11T13:36:15Z", "type": "commit"}, {"oid": "50d066697cacdb773477b79e69b846df07814472", "url": "https://github.com/TEAMMATES/teammates/commit/50d066697cacdb773477b79e69b846df07814472", "message": "Remove original table, add tooltips", "committedDate": "2020-06-11T13:58:49Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODg4ODg4OA==", "url": "https://github.com/TEAMMATES/teammates/pull/10183#discussion_r438888888", "bodyText": "I think essentially the PR wants to distinguish the data presentation from the data itself in the sortable table. Therefore, you may not want the rows to by of type any[]. Instead, we can define a new interface\nexport interface TableRow {\n    value: any, // value used for sorting with sortBy provided in ColumnData\n    displayableValue?: any; // displayable value \n    componentInput?: Record<string, any>; // @Input values for customized component if specified in ColumnData\n}\n\nBy doing this, the data presentation (use dynamic component or just plain-string displayable value) is separated from the data (value) itself.\nI think the current type definition any[][] | CustomTableCellData[][] is a bit confusing as it will enforce nothing since we have any.", "author": "xpdavid", "createdAt": "2020-06-11T15:48:09Z", "path": "src/web/app/components/sortable-table/sortable-table.component.ts", "diffHunk": "@@ -9,6 +9,16 @@ export interface ColumnData {\n   header: string;\n   headerToolTip?: string;\n   sortBy?: SortBy; // optional if the column is not sortable\n+  component?: Type<any>; // Must use in conjunction with CustomTableCellData in rows\n+}\n+\n+/**\n+ * Data provided for custom component used in table cell\n+ * Must use in conjunction with component in ColumnData\n+ */\n+export interface CustomTableCellData {", "originalCommit": "50d066697cacdb773477b79e69b846df07814472", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTIxMDE5MA==", "url": "https://github.com/TEAMMATES/teammates/pull/10183#discussion_r439210190", "bodyText": "Yeah I agree. It was quite awkward writing any[][] | CustomTableCellData[][].\nAnother question I have is whether I should provide the component every time in the individual cell data, or to specify it once in the column itself.\nexport interface TableRow {\n    value: any, // value used for sorting with sortBy provided in ColumnData\n    displayableValue?: any; // displayable value \n    component: Type<any>; // <-- Do I put this here?\n    componentInput?: Record<string, any>; // @Input values for customized component if specified in ColumnData\n}\n\nFeels like it would introduce a stronger relationship between the component and the componentInput, which would make more sense?", "author": "ccyccyccy", "createdAt": "2020-06-12T05:13:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODg4ODg4OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTIxMzI0Mg==", "url": "https://github.com/TEAMMATES/teammates/pull/10183#discussion_r439213242", "bodyText": "Let's keep it simple. Personally I do not foresee any possibility that we will use different components for different cells that belong to the same column.", "author": "xpdavid", "createdAt": "2020-06-12T05:25:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODg4ODg4OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTIxNTQ0Mg==", "url": "https://github.com/TEAMMATES/teammates/pull/10183#discussion_r439215442", "bodyText": "Actually I wasn't worrying about that.\nI felt that the relationship between the column and the row might not be clear enough to the caller. As you can see, I had to put a lot of comments to highlight to the user that the row and the column must be aligned, and the user must remember which cells uses which component from which column. Putting them in the same object structure would get rid of all these ambiguity", "author": "ccyccyccy", "createdAt": "2020-06-12T05:34:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODg4ODg4OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTIxNTc1Ng==", "url": "https://github.com/TEAMMATES/teammates/pull/10183#discussion_r439215756", "bodyText": "Sure. We can also got for this solution.", "author": "xpdavid", "createdAt": "2020-06-12T05:35:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODg4ODg4OA=="}], "type": "inlineReview"}, {"oid": "01ae9aea42db5e93334826635fcef6101d10f1a4", "url": "https://github.com/TEAMMATES/teammates/commit/01ae9aea42db5e93334826635fcef6101d10f1a4", "message": "Convert sortable table to accept a single interface type", "committedDate": "2020-06-12T11:02:08Z", "type": "commit"}, {"oid": "f1771db5c1bcd3113def87c7d0a62c0403b7b1cc", "url": "https://github.com/TEAMMATES/teammates/commit/f1771db5c1bcd3113def87c7d0a62c0403b7b1cc", "message": "Convert rest of statistics to use new API", "committedDate": "2020-06-12T11:32:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTYyNjk1OA==", "url": "https://github.com/TEAMMATES/teammates/pull/10183#discussion_r439626958", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            export interface CustomTableCellData {\n          \n          \n            \n            export interface SortableTableCellData {\n          \n      \n    \n    \n  \n\nThe model should somehow be consistent with the component.", "author": "xpdavid", "createdAt": "2020-06-12T20:25:41Z", "path": "src/web/app/components/sortable-table/sortable-table.component.ts", "diffHunk": "@@ -11,6 +11,22 @@ export interface ColumnData {\n   sortBy?: SortBy; // optional if the column is not sortable\n }\n \n+/**\n+ * Data provided for each table cell\n+ * Priority of display\n+ * 1. customComponent\n+ * 2. displayValue\n+ * 3. value\n+ */\n+export interface CustomTableCellData {", "originalCommit": "f1771db5c1bcd3113def87c7d0a62c0403b7b1cc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTcxNjk2Mg==", "url": "https://github.com/TEAMMATES/teammates/pull/10183#discussion_r439716962", "bodyText": "Sorry forgot to cleanup from the changes made.", "author": "ccyccyccy", "createdAt": "2020-06-13T07:15:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTYyNjk1OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTYyODIxMA==", "url": "https://github.com/TEAMMATES/teammates/pull/10183#discussion_r439628210", "bodyText": "Is the comment necessary?\n\nDefault to use supplied value for both sorting and displaying\n\nWhat is supplied value?", "author": "xpdavid", "createdAt": "2020-06-12T20:28:52Z", "path": "src/web/app/components/sortable-table/sortable-table.component.ts", "diffHunk": "@@ -29,12 +45,14 @@ export class SortableTableComponent implements OnInit {\n   @Input()\n   columns: ColumnData[] = [];\n \n+  // Default to use supplied value for both sorting and displaying\n+  // Use CustomTableCellData if value used for sorting is different from displaying", "originalCommit": "f1771db5c1bcd3113def87c7d0a62c0403b7b1cc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTcxNjk4MQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10183#discussion_r439716981", "bodyText": "Same here", "author": "ccyccyccy", "createdAt": "2020-06-13T07:15:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTYyODIxMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTYyODc5OA==", "url": "https://github.com/TEAMMATES/teammates/pull/10183#discussion_r439628798", "bodyText": "The value should not be optional?", "author": "xpdavid", "createdAt": "2020-06-12T20:30:17Z", "path": "src/web/app/components/sortable-table/sortable-table.component.ts", "diffHunk": "@@ -11,6 +11,22 @@ export interface ColumnData {\n   sortBy?: SortBy; // optional if the column is not sortable\n }\n \n+/**\n+ * Data provided for each table cell\n+ * Priority of display\n+ * 1. customComponent\n+ * 2. displayValue\n+ * 3. value\n+ */\n+export interface CustomTableCellData {\n+  value?: any; // Optional value used for sorting with sortBy provided in ColumnData", "originalCommit": "f1771db5c1bcd3113def87c7d0a62c0403b7b1cc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTcxNjgzMg==", "url": "https://github.com/TEAMMATES/teammates/pull/10183#discussion_r439716832", "bodyText": "Some custom components are not sortable, e.g. last column of contribution-question-statistic. Should only need to input customComponent without value.", "author": "ccyccyccy", "createdAt": "2020-06-13T07:13:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTYyODc5OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTYzMDA5Nw==", "url": "https://github.com/TEAMMATES/teammates/pull/10183#discussion_r439630097", "bodyText": "Is defining the module really necessary?", "author": "xpdavid", "createdAt": "2020-06-12T20:33:41Z", "path": "src/web/app/components/question-types/question-statistics/contribution-question-statistics/contribution-question-statistics.module.ts", "diffHunk": "@@ -0,0 +1,19 @@\n+import { CommonModule } from '@angular/common';\n+import { NgModule } from '@angular/core';\n+import { NgbModule } from '@ng-bootstrap/ng-bootstrap';\n+import { ContributionRatingsListComponent } from './contribution-ratings-list.component';\n+import { ContributionComponent } from './contribution.component';\n+\n+/**\n+ * Module for displaying data in a sortable table\n+ */\n+@NgModule({\n+  declarations: [ContributionComponent, ContributionRatingsListComponent],\n+  imports: [\n+    NgbModule, CommonModule,\n+  ],\n+  exports: [\n+    ContributionComponent, ContributionRatingsListComponent,\n+  ],\n+})\n+export class ContributionQuestionStatisticsModule { }", "originalCommit": "f1771db5c1bcd3113def87c7d0a62c0403b7b1cc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTcxNzEzMQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10183#discussion_r439717131", "bodyText": "Not really necessary, but I think it helps make the code more organized. Especially since I added a new ContributionRatingsListComponent. Now's there's 3 components used by the contribution statistics. Grouping them together would be nice.", "author": "ccyccyccy", "createdAt": "2020-06-13T07:18:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTYzMDA5Nw=="}], "type": "inlineReview"}, {"oid": "9ec5e081d5d21518391044503794c878660fb9a7", "url": "https://github.com/TEAMMATES/teammates/commit/9ec5e081d5d21518391044503794c878660fb9a7", "message": "Cleanup after refactoring sortable table row structure", "committedDate": "2020-06-13T07:19:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTcxNzM5OA==", "url": "https://github.com/TEAMMATES/teammates/pull/10183#discussion_r439717398", "bodyText": "Tooltips weren't working previous. Added a fix in here", "author": "ccyccyccy", "createdAt": "2020-06-13T07:23:22Z", "path": "src/web/app/components/question-types/question-statistics/contribution-question-statistics/contribution.component.html", "diffHunk": "@@ -2,11 +2,11 @@\n   <span class=\"positive\" *ngIf=\"value > 0\">+{{ value }}%</span>\n   <span class=\"neutral\" *ngIf=\"value === 0\">0</span>\n   <span class=\"negative\" *ngIf=\"value < 0 && value >= -100\">{{ value }}%</span>\n-  <span class=\"neutral\" ngbTooltip=\"Not Available: There is no data for this or the data is not enough\" *ngIf=\"value === -999 || value === -9999\">N/A</span>\n+  <span class=\"neutral\" container=\"body\" ngbTooltip=\"Not Available: There is no data for this or the data is not enough\" *ngIf=\"value === -999 || value === -9999\">N/A</span>", "originalCommit": "9ec5e081d5d21518391044503794c878660fb9a7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTcxNzczNQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10183#discussion_r439717735", "bodyText": "One annoying thing is that the caller must remember to register their dynamic component here. Maybe should document this somewhere?\nFrom the docs here, it seems like this step can be skipped if we upgrade to Angular 9, but since we are at Angular 8, we are using this doc instead, which requires the registration of these components.\nWill open issue to track this as a reminder if we ever upgrade to Angular 9.", "author": "ccyccyccy", "createdAt": "2020-06-13T07:29:36Z", "path": "src/web/app/components/sortable-table/sortable-table.module.ts", "diffHunk": "@@ -11,6 +18,8 @@ import { SortableTableComponent } from './sortable-table.component';\n   imports: [\n     CommonModule,\n     NgbModule,\n+    ContributionQuestionStatisticsModule,\n+    DynamicModule.withComponents([ContributionComponent, ContributionRatingsListComponent]),", "originalCommit": "9ec5e081d5d21518391044503794c878660fb9a7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc1NjI4NQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10183#discussion_r439756285", "bodyText": "Will open issue to track this as a reminder if we ever upgrade to Angular 9.\n\nWe will do soon.", "author": "xpdavid", "createdAt": "2020-06-13T17:48:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTcxNzczNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjU3OTIyMQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10183#discussion_r446579221", "bodyText": "Done d4934e3", "author": "xpdavid", "createdAt": "2020-06-27T23:38:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTcxNzczNQ=="}], "type": "inlineReview"}, {"oid": "137bec54079fdc9a4905d6ebfb1e8812713661a6", "url": "https://github.com/TEAMMATES/teammates/commit/137bec54079fdc9a4905d6ebfb1e8812713661a6", "message": "Add reminder to register new dynamic components", "committedDate": "2020-06-13T07:36:46Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc1NjU0OA==", "url": "https://github.com/TEAMMATES/teammates/pull/10183#discussion_r439756548", "bodyText": "We should describe the function of the module other than where the module is used.", "author": "xpdavid", "createdAt": "2020-06-13T17:52:58Z", "path": "src/web/app/components/question-types/question-statistics/contribution-question-statistics/contribution-question-statistics.module.ts", "diffHunk": "@@ -0,0 +1,19 @@\n+import { CommonModule } from '@angular/common';\n+import { NgModule } from '@angular/core';\n+import { NgbModule } from '@ng-bootstrap/ng-bootstrap';\n+import { ContributionRatingsListComponent } from './contribution-ratings-list.component';\n+import { ContributionComponent } from './contribution.component';\n+\n+/**\n+ * Module for displaying data in a sortable table", "originalCommit": "137bec54079fdc9a4905d6ebfb1e8812713661a6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTgwNTM4Nw==", "url": "https://github.com/TEAMMATES/teammates/pull/10183#discussion_r439805387", "bodyText": "Actually I put it under sortable-table.component.ts file.\n/**\n * Displays a sortable table, sorting by clicking on the header\n * Optional sortBy option provided for each column\n * Columns and rows provided must be aligned\n * Remember to register new dynamic components using the withComponents method under sortable-table-module\n */\n\nShould I move it or copy it over to the module file?", "author": "ccyccyccy", "createdAt": "2020-06-14T08:32:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc1NjU0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTgwNjY1NQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10183#discussion_r439806655", "bodyText": "The module itself does not contains any sortable table components so the documentation should not mention it (e.g., consider the case where the module is used in places other than sortable table. It is still suitable to write Module for displaying data in a sortable table?).", "author": "xpdavid", "createdAt": "2020-06-14T08:49:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc1NjU0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTgxMzkxNQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10183#discussion_r439813915", "bodyText": "Hmm sorry I'm not too clear about the distinction between Angular components and modules. So what kind of information should I include here? Because I don't see a use case for importing this module without using the sortable table component.", "author": "ccyccyccy", "createdAt": "2020-06-14T10:17:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc1NjU0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTg2ODY4MQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10183#discussion_r439868681", "bodyText": "Now's there's 3 components used by the contribution statistics. Grouping them together would be nice.\n\nQuote your words :P Modules help you organize your component better (there are other benefits like lazy-load which you can see more on the Angular documentation).\nLet's put it in this way. When you group similar things together and you want to describe the group. Do you usually describe what the group is or where the group is used?", "author": "xpdavid", "createdAt": "2020-06-14T21:21:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc1NjU0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTkxNTc0NA==", "url": "https://github.com/TEAMMATES/teammates/pull/10183#discussion_r439915744", "bodyText": "Let's put it in this way. When you group similar things together and you want to describe the group. Do you usually describe what the group is or where the group is used?\n\nWould describe what the group is. But it does gets a bit weird here though, seeing that the module only contains 1 component.\nSo i'll just say something like this?\n/**\n * Sortable table module.\n */", "author": "ccyccyccy", "createdAt": "2020-06-15T03:41:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc1NjU0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTkxNjQzNA==", "url": "https://github.com/TEAMMATES/teammates/pull/10183#discussion_r439916434", "bodyText": "Ohhh. I think we are talking about two things. The comment I given is for the file: contribution-question-statistics.module.ts not sortable-table.module.ts.", "author": "xpdavid", "createdAt": "2020-06-15T03:44:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc1NjU0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTkyNjk2Nw==", "url": "https://github.com/TEAMMATES/teammates/pull/10183#discussion_r439926967", "bodyText": "Ohhh i must have read wrongly. Just changed it.", "author": "ccyccyccy", "createdAt": "2020-06-15T04:40:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc1NjU0OA=="}], "type": "inlineReview"}, {"oid": "1de8c11a200a43f0f3869ac7203984761a2d9ccf", "url": "https://github.com/TEAMMATES/teammates/commit/1de8c11a200a43f0f3869ac7203984761a2d9ccf", "message": "Change comments for contribution question statistics module", "committedDate": "2020-06-15T04:39:44Z", "type": "commit"}, {"oid": "5e581d78277dd7d9bac75350aa9c5566a5a84cba", "url": "https://github.com/TEAMMATES/teammates/commit/5e581d78277dd7d9bac75350aa9c5566a5a84cba", "message": "Merge branch 'master' into 10155-contribution-msq-statistic-table", "committedDate": "2020-06-15T06:16:12Z", "type": "commit"}]}