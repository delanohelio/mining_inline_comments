{"pr_number": 8397, "pr_title": "[Issue 7372][docs] Add detailed info for retention policy", "pr_createdAt": "2020-10-28T08:05:41Z", "pr_url": "https://github.com/apache/pulsar/pull/8397", "timeline": [{"oid": "ecacc9bc4538aac11337beb6ddd333c108501d88", "url": "https://github.com/apache/pulsar/commit/ecacc9bc4538aac11337beb6ddd333c108501d88", "message": "add retention policy", "committedDate": "2020-10-28T07:49:52Z", "type": "commit"}, {"oid": "7e74f5174fd59eea6aba8cc87ec10e07f9c1fe57", "url": "https://github.com/apache/pulsar/commit/7e74f5174fd59eea6aba8cc87ec10e07f9c1fe57", "message": "fix the default vaule for retention", "committedDate": "2020-10-28T08:02:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzMzNzE0NQ==", "url": "https://github.com/apache/pulsar/pull/8397#discussion_r513337145", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            When you set a size limit of, for example, 10 gigabytes, and set the time limit to `-1`, then the acknowledged messages in all topics in the namespace are retained until the topic size reaches the size limit(10 gigabytes). If you set a time limit of, for example, 1 day, and set the size limit to `-1`, then the acknowledged messages for all topics in the namespace are retained for 1 day.\n          \n          \n            \n            When you set a size limit of, for example, 10 GB, and set the time limit to `-1`, then the acknowledged messages in all topics in the namespace are retained until the topic size reaches the size limit (10 GB). If you set a time limit of, for example, 1 day, and set the size limit to `-1`, then the acknowledged messages for all topics in the namespace are retained for 1 day.", "author": "Huanli-Meng", "createdAt": "2020-10-28T10:32:57Z", "path": "site2/docs/cookbooks-retention-expiry.md", "diffHunk": "@@ -27,90 +27,90 @@ Pulsar's [admin interface](admin-api-overview.md) enables you to manage both ret\n \n ## Retention policies\n \n-By default, when a Pulsar message arrives at a broker it will be stored until it has been acknowledged on all subscriptions, at which point it will be marked for deletion. You can override this behavior and retain even messages that have already been acknowledged on all subscriptions by setting a *retention policy* for all topics in a given namespace. Retention is based on both a *size limit* and a *time limit*.\n+By default, when a Pulsar message arrives at a broker, the message is stored until it has been acknowledged on all subscriptions, at which point it is marked for deletion. You can override this behavior and retain messages that have already been acknowledged on all subscriptions by setting a *retention policy* for all topics in a given namespace. Retention is based on both a *size limit* and a *time limit*.\n \n-Retention policies are particularly useful if you intend to exclusively use the Reader interface. Because the Reader interface does not use acknowledgements, messages will never exist within backlogs. Most realistic Reader-only use cases require that retention be configured.\n+Retention policies are useful when you use the Reader interface. The Reader interface does not use acknowledgements, and messages do not exist within backlogs. It is required to configure retention for Reader-only use cases.\n \n-When you set a retention policy you must set **both** a *size limit* and a *time limit*. In the case where you don't want to limit by either time or set, the value must be set to `-1`. Retention policy will be effectively disabled and it won't prevent the deletion of acknowledged messages when either size or time limit is set to `0`. Infinite retention can be achieved by setting both time and size limits to `-1`.\n+When you set a retention policy, you must set **both** a *size limit* and a *time limit*. \n \n-When you set a size limit of, say, 10 gigabytes, and the time limit to `-1` then acknowledged messages in all topics in the namespace will be retained until the size limit for the topic is reached; if you set a time limit of, say, 1 day, and the size limit to `-1` then acknowledged messages for all topics in the namespace will be retained for 24 hours.\n+- If you do not want to limit the message by time, set the value of time limit to `-1`.\n+- If you do not want to limit the message by size, set the value of size limit to `-1`.\n+- If you need infinite retention, set the values of time limit and size limit to `-1`.\n+- If you want to disable retention policy, set the values of time limit and size limit to `0`. Retention policy is disabled by default.\n \n-The retention settings apply to all messages on topics that do not have any subscriptions, or if there are subscriptions, to messages that have been acked by all subscriptions. The retention policy settings do not affect unacknowledged messages on topics with subscriptions -- these are instead controlled by the backlog quota (see below).\n+When you set a size limit of, for example, 10 gigabytes, and set the time limit to `-1`, then the acknowledged messages in all topics in the namespace are retained until the topic size reaches the size limit(10 gigabytes). If you set a time limit of, for example, 1 day, and set the size limit to `-1`, then the acknowledged messages for all topics in the namespace are retained for 1 day.", "originalCommit": "7e74f5174fd59eea6aba8cc87ec10e07f9c1fe57", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzMzNzQ4OA==", "url": "https://github.com/apache/pulsar/pull/8397#discussion_r513337488", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            The retention settings apply to all messages on topics that do not have any subscriptions, or to messages that have been acked by all subscriptions. The retention policy settings do not affect unacknowledged messages on topics with subscriptions. The unacknowledged messages are controlled by the backlog quota.\n          \n          \n            \n            The retention settings apply to all messages on topics that do not have any subscriptions, or to messages that have been acknowledged by all subscriptions. The retention policy settings do not affect unacknowledged messages on topics with subscriptions. The unacknowledged messages are controlled by the backlog quota.", "author": "Huanli-Meng", "createdAt": "2020-10-28T10:33:31Z", "path": "site2/docs/cookbooks-retention-expiry.md", "diffHunk": "@@ -27,90 +27,90 @@ Pulsar's [admin interface](admin-api-overview.md) enables you to manage both ret\n \n ## Retention policies\n \n-By default, when a Pulsar message arrives at a broker it will be stored until it has been acknowledged on all subscriptions, at which point it will be marked for deletion. You can override this behavior and retain even messages that have already been acknowledged on all subscriptions by setting a *retention policy* for all topics in a given namespace. Retention is based on both a *size limit* and a *time limit*.\n+By default, when a Pulsar message arrives at a broker, the message is stored until it has been acknowledged on all subscriptions, at which point it is marked for deletion. You can override this behavior and retain messages that have already been acknowledged on all subscriptions by setting a *retention policy* for all topics in a given namespace. Retention is based on both a *size limit* and a *time limit*.\n \n-Retention policies are particularly useful if you intend to exclusively use the Reader interface. Because the Reader interface does not use acknowledgements, messages will never exist within backlogs. Most realistic Reader-only use cases require that retention be configured.\n+Retention policies are useful when you use the Reader interface. The Reader interface does not use acknowledgements, and messages do not exist within backlogs. It is required to configure retention for Reader-only use cases.\n \n-When you set a retention policy you must set **both** a *size limit* and a *time limit*. In the case where you don't want to limit by either time or set, the value must be set to `-1`. Retention policy will be effectively disabled and it won't prevent the deletion of acknowledged messages when either size or time limit is set to `0`. Infinite retention can be achieved by setting both time and size limits to `-1`.\n+When you set a retention policy, you must set **both** a *size limit* and a *time limit*. \n \n-When you set a size limit of, say, 10 gigabytes, and the time limit to `-1` then acknowledged messages in all topics in the namespace will be retained until the size limit for the topic is reached; if you set a time limit of, say, 1 day, and the size limit to `-1` then acknowledged messages for all topics in the namespace will be retained for 24 hours.\n+- If you do not want to limit the message by time, set the value of time limit to `-1`.\n+- If you do not want to limit the message by size, set the value of size limit to `-1`.\n+- If you need infinite retention, set the values of time limit and size limit to `-1`.\n+- If you want to disable retention policy, set the values of time limit and size limit to `0`. Retention policy is disabled by default.\n \n-The retention settings apply to all messages on topics that do not have any subscriptions, or if there are subscriptions, to messages that have been acked by all subscriptions. The retention policy settings do not affect unacknowledged messages on topics with subscriptions -- these are instead controlled by the backlog quota (see below).\n+When you set a size limit of, for example, 10 gigabytes, and set the time limit to `-1`, then the acknowledged messages in all topics in the namespace are retained until the topic size reaches the size limit(10 gigabytes). If you set a time limit of, for example, 1 day, and set the size limit to `-1`, then the acknowledged messages for all topics in the namespace are retained for 1 day.\n+\n+The retention settings apply to all messages on topics that do not have any subscriptions, or to messages that have been acked by all subscriptions. The retention policy settings do not affect unacknowledged messages on topics with subscriptions. The unacknowledged messages are controlled by the backlog quota.", "originalCommit": "7e74f5174fd59eea6aba8cc87ec10e07f9c1fe57", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzMzODQ4Ng==", "url": "https://github.com/apache/pulsar/pull/8397#discussion_r513338486", "bodyText": "change instance-wide to instance-level?", "author": "Huanli-Meng", "createdAt": "2020-10-28T10:35:04Z", "path": "site2/docs/cookbooks-retention-expiry.md", "diffHunk": "@@ -27,90 +27,90 @@ Pulsar's [admin interface](admin-api-overview.md) enables you to manage both ret\n \n ## Retention policies\n \n-By default, when a Pulsar message arrives at a broker it will be stored until it has been acknowledged on all subscriptions, at which point it will be marked for deletion. You can override this behavior and retain even messages that have already been acknowledged on all subscriptions by setting a *retention policy* for all topics in a given namespace. Retention is based on both a *size limit* and a *time limit*.\n+By default, when a Pulsar message arrives at a broker, the message is stored until it has been acknowledged on all subscriptions, at which point it is marked for deletion. You can override this behavior and retain messages that have already been acknowledged on all subscriptions by setting a *retention policy* for all topics in a given namespace. Retention is based on both a *size limit* and a *time limit*.\n \n-Retention policies are particularly useful if you intend to exclusively use the Reader interface. Because the Reader interface does not use acknowledgements, messages will never exist within backlogs. Most realistic Reader-only use cases require that retention be configured.\n+Retention policies are useful when you use the Reader interface. The Reader interface does not use acknowledgements, and messages do not exist within backlogs. It is required to configure retention for Reader-only use cases.\n \n-When you set a retention policy you must set **both** a *size limit* and a *time limit*. In the case where you don't want to limit by either time or set, the value must be set to `-1`. Retention policy will be effectively disabled and it won't prevent the deletion of acknowledged messages when either size or time limit is set to `0`. Infinite retention can be achieved by setting both time and size limits to `-1`.\n+When you set a retention policy, you must set **both** a *size limit* and a *time limit*. \n \n-When you set a size limit of, say, 10 gigabytes, and the time limit to `-1` then acknowledged messages in all topics in the namespace will be retained until the size limit for the topic is reached; if you set a time limit of, say, 1 day, and the size limit to `-1` then acknowledged messages for all topics in the namespace will be retained for 24 hours.\n+- If you do not want to limit the message by time, set the value of time limit to `-1`.\n+- If you do not want to limit the message by size, set the value of size limit to `-1`.\n+- If you need infinite retention, set the values of time limit and size limit to `-1`.\n+- If you want to disable retention policy, set the values of time limit and size limit to `0`. Retention policy is disabled by default.\n \n-The retention settings apply to all messages on topics that do not have any subscriptions, or if there are subscriptions, to messages that have been acked by all subscriptions. The retention policy settings do not affect unacknowledged messages on topics with subscriptions -- these are instead controlled by the backlog quota (see below).\n+When you set a size limit of, for example, 10 gigabytes, and set the time limit to `-1`, then the acknowledged messages in all topics in the namespace are retained until the topic size reaches the size limit(10 gigabytes). If you set a time limit of, for example, 1 day, and set the size limit to `-1`, then the acknowledged messages for all topics in the namespace are retained for 1 day.\n+\n+The retention settings apply to all messages on topics that do not have any subscriptions, or to messages that have been acked by all subscriptions. The retention policy settings do not affect unacknowledged messages on topics with subscriptions. The unacknowledged messages are controlled by the backlog quota.\n \n When a retention limit is exceeded, the oldest message is marked for deletion until the set of retained messages falls within the specified limits again.\n \n ### Defaults\n \n-There are two configuration parameters that you can use to set [instance](reference-terminology.md#instance)-wide defaults for message retention: [`defaultRetentionTimeInMinutes=0`](reference-configuration.md#broker-defaultRetentionTimeInMinutes) and [`defaultRetentionSizeInMB=0`](reference-configuration.md#broker-defaultRetentionSizeInMB).\n+You can use the following two configuration parameters to set instance-wide defaults for message retention: `defaultRetentionTimeInMinutes` and `defaultRetentionSizeInMB`. Both parameters are set to `0` by default. ", "originalCommit": "7e74f5174fd59eea6aba8cc87ec10e07f9c1fe57", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzMzOTA3OQ==", "url": "https://github.com/apache/pulsar/pull/8397#discussion_r513339079", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            In the following example, size limit is set to 10 gigabytes and time limit is set to 3 hours for the `my-tenant/my-ns` namespace:\n          \n          \n            \n            In the following example, the size limit is set to 10 GB and time limit is set to 3 hours for the `my-tenant/my-ns` namespace:", "author": "Huanli-Meng", "createdAt": "2020-10-28T10:36:01Z", "path": "site2/docs/cookbooks-retention-expiry.md", "diffHunk": "@@ -27,90 +27,90 @@ Pulsar's [admin interface](admin-api-overview.md) enables you to manage both ret\n \n ## Retention policies\n \n-By default, when a Pulsar message arrives at a broker it will be stored until it has been acknowledged on all subscriptions, at which point it will be marked for deletion. You can override this behavior and retain even messages that have already been acknowledged on all subscriptions by setting a *retention policy* for all topics in a given namespace. Retention is based on both a *size limit* and a *time limit*.\n+By default, when a Pulsar message arrives at a broker, the message is stored until it has been acknowledged on all subscriptions, at which point it is marked for deletion. You can override this behavior and retain messages that have already been acknowledged on all subscriptions by setting a *retention policy* for all topics in a given namespace. Retention is based on both a *size limit* and a *time limit*.\n \n-Retention policies are particularly useful if you intend to exclusively use the Reader interface. Because the Reader interface does not use acknowledgements, messages will never exist within backlogs. Most realistic Reader-only use cases require that retention be configured.\n+Retention policies are useful when you use the Reader interface. The Reader interface does not use acknowledgements, and messages do not exist within backlogs. It is required to configure retention for Reader-only use cases.\n \n-When you set a retention policy you must set **both** a *size limit* and a *time limit*. In the case where you don't want to limit by either time or set, the value must be set to `-1`. Retention policy will be effectively disabled and it won't prevent the deletion of acknowledged messages when either size or time limit is set to `0`. Infinite retention can be achieved by setting both time and size limits to `-1`.\n+When you set a retention policy, you must set **both** a *size limit* and a *time limit*. \n \n-When you set a size limit of, say, 10 gigabytes, and the time limit to `-1` then acknowledged messages in all topics in the namespace will be retained until the size limit for the topic is reached; if you set a time limit of, say, 1 day, and the size limit to `-1` then acknowledged messages for all topics in the namespace will be retained for 24 hours.\n+- If you do not want to limit the message by time, set the value of time limit to `-1`.\n+- If you do not want to limit the message by size, set the value of size limit to `-1`.\n+- If you need infinite retention, set the values of time limit and size limit to `-1`.\n+- If you want to disable retention policy, set the values of time limit and size limit to `0`. Retention policy is disabled by default.\n \n-The retention settings apply to all messages on topics that do not have any subscriptions, or if there are subscriptions, to messages that have been acked by all subscriptions. The retention policy settings do not affect unacknowledged messages on topics with subscriptions -- these are instead controlled by the backlog quota (see below).\n+When you set a size limit of, for example, 10 gigabytes, and set the time limit to `-1`, then the acknowledged messages in all topics in the namespace are retained until the topic size reaches the size limit(10 gigabytes). If you set a time limit of, for example, 1 day, and set the size limit to `-1`, then the acknowledged messages for all topics in the namespace are retained for 1 day.\n+\n+The retention settings apply to all messages on topics that do not have any subscriptions, or to messages that have been acked by all subscriptions. The retention policy settings do not affect unacknowledged messages on topics with subscriptions. The unacknowledged messages are controlled by the backlog quota.\n \n When a retention limit is exceeded, the oldest message is marked for deletion until the set of retained messages falls within the specified limits again.\n \n ### Defaults\n \n-There are two configuration parameters that you can use to set [instance](reference-terminology.md#instance)-wide defaults for message retention: [`defaultRetentionTimeInMinutes=0`](reference-configuration.md#broker-defaultRetentionTimeInMinutes) and [`defaultRetentionSizeInMB=0`](reference-configuration.md#broker-defaultRetentionSizeInMB).\n+You can use the following two configuration parameters to set instance-wide defaults for message retention: `defaultRetentionTimeInMinutes` and `defaultRetentionSizeInMB`. Both parameters are set to `0` by default. \n \n-Both of these parameters are in the [`broker.conf`](reference-configuration.md#broker) configuration file.\n+For more information of the two parameters, refer to the [`broker.conf`](reference-configuration.md#broker) configuration file.\n \n ### Set retention policy\n \n-You can set a retention policy for a namespace by specifying the namespace as well as both a size limit *and* a time limit.\n-\n-#### pulsar-admin\n-\n-Use the [`set-retention`](reference-pulsar-admin.md#namespaces-set-retention) subcommand and specify a namespace, a size limit using the `-s`/`--size` flag, and a time limit using the `-t`/`--time` flag. \n-\n-You must set **both** a *size limit* and a *time limit*. In the case where you don't want to limit by either time or set, the value must be set to `-1`. Retention policy will be effectively disabled and it won't prevent the deletion of acknowledged messages when either size or time limit is set to 0.\n+You can set a retention policy for a namespace by specifying the namespace, a size limit and a time limit in `pulsar-admin`, REST API and Java.\n \n-##### Examples\n+<!--DOCUSAURUS_CODE_TABS-->\n+<!--pulsar-admin-->\n+You can use the [`set-retention`](reference-pulsar-admin.md#namespaces-set-retention) subcommand and specify a namespace, a size limit using the `-s`/`--size` flag, and a time limit using the `-t`/`--time` flag. \n \n-To set a size limit of 10 gigabytes and a time limit of 3 hours for the `my-tenant/my-ns` namespace:\n+In the following example, size limit is set to 10 gigabytes and time limit is set to 3 hours for the `my-tenant/my-ns` namespace:", "originalCommit": "7e74f5174fd59eea6aba8cc87ec10e07f9c1fe57", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzMzOTU3OA==", "url": "https://github.com/apache/pulsar/pull/8397#discussion_r513339578", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            In the following example, time is not limited and size limit is set to 1 terabyte. The size limit determines the retention result.\n          \n          \n            \n            In the following example, the time is not limited while the size limit is set to 1 TB. The size limit determines the retention result.", "author": "Huanli-Meng", "createdAt": "2020-10-28T10:36:50Z", "path": "site2/docs/cookbooks-retention-expiry.md", "diffHunk": "@@ -27,90 +27,90 @@ Pulsar's [admin interface](admin-api-overview.md) enables you to manage both ret\n \n ## Retention policies\n \n-By default, when a Pulsar message arrives at a broker it will be stored until it has been acknowledged on all subscriptions, at which point it will be marked for deletion. You can override this behavior and retain even messages that have already been acknowledged on all subscriptions by setting a *retention policy* for all topics in a given namespace. Retention is based on both a *size limit* and a *time limit*.\n+By default, when a Pulsar message arrives at a broker, the message is stored until it has been acknowledged on all subscriptions, at which point it is marked for deletion. You can override this behavior and retain messages that have already been acknowledged on all subscriptions by setting a *retention policy* for all topics in a given namespace. Retention is based on both a *size limit* and a *time limit*.\n \n-Retention policies are particularly useful if you intend to exclusively use the Reader interface. Because the Reader interface does not use acknowledgements, messages will never exist within backlogs. Most realistic Reader-only use cases require that retention be configured.\n+Retention policies are useful when you use the Reader interface. The Reader interface does not use acknowledgements, and messages do not exist within backlogs. It is required to configure retention for Reader-only use cases.\n \n-When you set a retention policy you must set **both** a *size limit* and a *time limit*. In the case where you don't want to limit by either time or set, the value must be set to `-1`. Retention policy will be effectively disabled and it won't prevent the deletion of acknowledged messages when either size or time limit is set to `0`. Infinite retention can be achieved by setting both time and size limits to `-1`.\n+When you set a retention policy, you must set **both** a *size limit* and a *time limit*. \n \n-When you set a size limit of, say, 10 gigabytes, and the time limit to `-1` then acknowledged messages in all topics in the namespace will be retained until the size limit for the topic is reached; if you set a time limit of, say, 1 day, and the size limit to `-1` then acknowledged messages for all topics in the namespace will be retained for 24 hours.\n+- If you do not want to limit the message by time, set the value of time limit to `-1`.\n+- If you do not want to limit the message by size, set the value of size limit to `-1`.\n+- If you need infinite retention, set the values of time limit and size limit to `-1`.\n+- If you want to disable retention policy, set the values of time limit and size limit to `0`. Retention policy is disabled by default.\n \n-The retention settings apply to all messages on topics that do not have any subscriptions, or if there are subscriptions, to messages that have been acked by all subscriptions. The retention policy settings do not affect unacknowledged messages on topics with subscriptions -- these are instead controlled by the backlog quota (see below).\n+When you set a size limit of, for example, 10 gigabytes, and set the time limit to `-1`, then the acknowledged messages in all topics in the namespace are retained until the topic size reaches the size limit(10 gigabytes). If you set a time limit of, for example, 1 day, and set the size limit to `-1`, then the acknowledged messages for all topics in the namespace are retained for 1 day.\n+\n+The retention settings apply to all messages on topics that do not have any subscriptions, or to messages that have been acked by all subscriptions. The retention policy settings do not affect unacknowledged messages on topics with subscriptions. The unacknowledged messages are controlled by the backlog quota.\n \n When a retention limit is exceeded, the oldest message is marked for deletion until the set of retained messages falls within the specified limits again.\n \n ### Defaults\n \n-There are two configuration parameters that you can use to set [instance](reference-terminology.md#instance)-wide defaults for message retention: [`defaultRetentionTimeInMinutes=0`](reference-configuration.md#broker-defaultRetentionTimeInMinutes) and [`defaultRetentionSizeInMB=0`](reference-configuration.md#broker-defaultRetentionSizeInMB).\n+You can use the following two configuration parameters to set instance-wide defaults for message retention: `defaultRetentionTimeInMinutes` and `defaultRetentionSizeInMB`. Both parameters are set to `0` by default. \n \n-Both of these parameters are in the [`broker.conf`](reference-configuration.md#broker) configuration file.\n+For more information of the two parameters, refer to the [`broker.conf`](reference-configuration.md#broker) configuration file.\n \n ### Set retention policy\n \n-You can set a retention policy for a namespace by specifying the namespace as well as both a size limit *and* a time limit.\n-\n-#### pulsar-admin\n-\n-Use the [`set-retention`](reference-pulsar-admin.md#namespaces-set-retention) subcommand and specify a namespace, a size limit using the `-s`/`--size` flag, and a time limit using the `-t`/`--time` flag. \n-\n-You must set **both** a *size limit* and a *time limit*. In the case where you don't want to limit by either time or set, the value must be set to `-1`. Retention policy will be effectively disabled and it won't prevent the deletion of acknowledged messages when either size or time limit is set to 0.\n+You can set a retention policy for a namespace by specifying the namespace, a size limit and a time limit in `pulsar-admin`, REST API and Java.\n \n-##### Examples\n+<!--DOCUSAURUS_CODE_TABS-->\n+<!--pulsar-admin-->\n+You can use the [`set-retention`](reference-pulsar-admin.md#namespaces-set-retention) subcommand and specify a namespace, a size limit using the `-s`/`--size` flag, and a time limit using the `-t`/`--time` flag. \n \n-To set a size limit of 10 gigabytes and a time limit of 3 hours for the `my-tenant/my-ns` namespace:\n+In the following example, size limit is set to 10 gigabytes and time limit is set to 3 hours for the `my-tenant/my-ns` namespace:\n \n ```shell\n $ pulsar-admin namespaces set-retention my-tenant/my-ns \\\n   --size 10G \\\n   --time 3h\n ```\n \n-To set retention where time limit is ignored and the size limit of 1 terabyte determines retention:\n+In the following example, time is not limited and size limit is set to 1 terabyte. The size limit determines the retention result.", "originalCommit": "7e74f5174fd59eea6aba8cc87ec10e07f9c1fe57", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzMzOTgxOA==", "url": "https://github.com/apache/pulsar/pull/8397#discussion_r513339818", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            In the following example, size is not limited and time limit is set to 3 hours. The time limit determines the retention result.\n          \n          \n            \n            In the following example, the size is not limited and the time limit is set to 3 hours. The time limit determines the retention result.", "author": "Huanli-Meng", "createdAt": "2020-10-28T10:37:19Z", "path": "site2/docs/cookbooks-retention-expiry.md", "diffHunk": "@@ -27,90 +27,90 @@ Pulsar's [admin interface](admin-api-overview.md) enables you to manage both ret\n \n ## Retention policies\n \n-By default, when a Pulsar message arrives at a broker it will be stored until it has been acknowledged on all subscriptions, at which point it will be marked for deletion. You can override this behavior and retain even messages that have already been acknowledged on all subscriptions by setting a *retention policy* for all topics in a given namespace. Retention is based on both a *size limit* and a *time limit*.\n+By default, when a Pulsar message arrives at a broker, the message is stored until it has been acknowledged on all subscriptions, at which point it is marked for deletion. You can override this behavior and retain messages that have already been acknowledged on all subscriptions by setting a *retention policy* for all topics in a given namespace. Retention is based on both a *size limit* and a *time limit*.\n \n-Retention policies are particularly useful if you intend to exclusively use the Reader interface. Because the Reader interface does not use acknowledgements, messages will never exist within backlogs. Most realistic Reader-only use cases require that retention be configured.\n+Retention policies are useful when you use the Reader interface. The Reader interface does not use acknowledgements, and messages do not exist within backlogs. It is required to configure retention for Reader-only use cases.\n \n-When you set a retention policy you must set **both** a *size limit* and a *time limit*. In the case where you don't want to limit by either time or set, the value must be set to `-1`. Retention policy will be effectively disabled and it won't prevent the deletion of acknowledged messages when either size or time limit is set to `0`. Infinite retention can be achieved by setting both time and size limits to `-1`.\n+When you set a retention policy, you must set **both** a *size limit* and a *time limit*. \n \n-When you set a size limit of, say, 10 gigabytes, and the time limit to `-1` then acknowledged messages in all topics in the namespace will be retained until the size limit for the topic is reached; if you set a time limit of, say, 1 day, and the size limit to `-1` then acknowledged messages for all topics in the namespace will be retained for 24 hours.\n+- If you do not want to limit the message by time, set the value of time limit to `-1`.\n+- If you do not want to limit the message by size, set the value of size limit to `-1`.\n+- If you need infinite retention, set the values of time limit and size limit to `-1`.\n+- If you want to disable retention policy, set the values of time limit and size limit to `0`. Retention policy is disabled by default.\n \n-The retention settings apply to all messages on topics that do not have any subscriptions, or if there are subscriptions, to messages that have been acked by all subscriptions. The retention policy settings do not affect unacknowledged messages on topics with subscriptions -- these are instead controlled by the backlog quota (see below).\n+When you set a size limit of, for example, 10 gigabytes, and set the time limit to `-1`, then the acknowledged messages in all topics in the namespace are retained until the topic size reaches the size limit(10 gigabytes). If you set a time limit of, for example, 1 day, and set the size limit to `-1`, then the acknowledged messages for all topics in the namespace are retained for 1 day.\n+\n+The retention settings apply to all messages on topics that do not have any subscriptions, or to messages that have been acked by all subscriptions. The retention policy settings do not affect unacknowledged messages on topics with subscriptions. The unacknowledged messages are controlled by the backlog quota.\n \n When a retention limit is exceeded, the oldest message is marked for deletion until the set of retained messages falls within the specified limits again.\n \n ### Defaults\n \n-There are two configuration parameters that you can use to set [instance](reference-terminology.md#instance)-wide defaults for message retention: [`defaultRetentionTimeInMinutes=0`](reference-configuration.md#broker-defaultRetentionTimeInMinutes) and [`defaultRetentionSizeInMB=0`](reference-configuration.md#broker-defaultRetentionSizeInMB).\n+You can use the following two configuration parameters to set instance-wide defaults for message retention: `defaultRetentionTimeInMinutes` and `defaultRetentionSizeInMB`. Both parameters are set to `0` by default. \n \n-Both of these parameters are in the [`broker.conf`](reference-configuration.md#broker) configuration file.\n+For more information of the two parameters, refer to the [`broker.conf`](reference-configuration.md#broker) configuration file.\n \n ### Set retention policy\n \n-You can set a retention policy for a namespace by specifying the namespace as well as both a size limit *and* a time limit.\n-\n-#### pulsar-admin\n-\n-Use the [`set-retention`](reference-pulsar-admin.md#namespaces-set-retention) subcommand and specify a namespace, a size limit using the `-s`/`--size` flag, and a time limit using the `-t`/`--time` flag. \n-\n-You must set **both** a *size limit* and a *time limit*. In the case where you don't want to limit by either time or set, the value must be set to `-1`. Retention policy will be effectively disabled and it won't prevent the deletion of acknowledged messages when either size or time limit is set to 0.\n+You can set a retention policy for a namespace by specifying the namespace, a size limit and a time limit in `pulsar-admin`, REST API and Java.\n \n-##### Examples\n+<!--DOCUSAURUS_CODE_TABS-->\n+<!--pulsar-admin-->\n+You can use the [`set-retention`](reference-pulsar-admin.md#namespaces-set-retention) subcommand and specify a namespace, a size limit using the `-s`/`--size` flag, and a time limit using the `-t`/`--time` flag. \n \n-To set a size limit of 10 gigabytes and a time limit of 3 hours for the `my-tenant/my-ns` namespace:\n+In the following example, size limit is set to 10 gigabytes and time limit is set to 3 hours for the `my-tenant/my-ns` namespace:\n \n ```shell\n $ pulsar-admin namespaces set-retention my-tenant/my-ns \\\n   --size 10G \\\n   --time 3h\n ```\n \n-To set retention where time limit is ignored and the size limit of 1 terabyte determines retention:\n+In the following example, time is not limited and size limit is set to 1 terabyte. The size limit determines the retention result.\n \n ```shell\n $ pulsar-admin namespaces set-retention my-tenant/my-ns \\\n   --size 1T \\\n   --time -1\n ```\n \n-To set retention where size limit is ignored and the time limit of 3 hours determines retention:\n+In the following example, size is not limited and time limit is set to 3 hours. The time limit determines the retention result.", "originalCommit": "7e74f5174fd59eea6aba8cc87ec10e07f9c1fe57", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "3b4681e8f979378526c0d69d94d8a8ae6a9b6a0f", "url": "https://github.com/apache/pulsar/commit/3b4681e8f979378526c0d69d94d8a8ae6a9b6a0f", "message": "add detailed retention info", "committedDate": "2020-10-29T08:43:09Z", "type": "commit"}, {"oid": "3b9d0424796cc427295f0b77c9c2373df906adf6", "url": "https://github.com/apache/pulsar/commit/3b9d0424796cc427295f0b77c9c2373df906adf6", "message": "update", "committedDate": "2020-10-29T09:58:32Z", "type": "commit"}, {"oid": "c5c26286ed72f3a596b9e0dba70f3602d8c0a350", "url": "https://github.com/apache/pulsar/commit/c5c26286ed72f3a596b9e0dba70f3602d8c0a350", "message": "update", "committedDate": "2020-10-29T10:16:53Z", "type": "commit"}]}