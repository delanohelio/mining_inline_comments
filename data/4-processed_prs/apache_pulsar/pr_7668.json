{"pr_number": 7668, "pr_title": "update aws deployment for 2.6.0", "pr_createdAt": "2020-07-26T23:26:11Z", "pr_url": "https://github.com/apache/pulsar/pull/7668", "timeline": [{"oid": "fe308ca675060e1eb879cf319b821c8ab747d536", "url": "https://github.com/apache/pulsar/commit/fe308ca675060e1eb879cf319b821c8ab747d536", "message": "ignore whitespace changes", "committedDate": "2020-07-26T23:32:01Z", "type": "forcePushed"}, {"oid": "3e46b2d194832ab455c0a8e18589a70904e40913", "url": "https://github.com/apache/pulsar/commit/3e46b2d194832ab455c0a8e18589a70904e40913", "message": "ignore whitespace changes", "committedDate": "2020-07-26T23:32:53Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTAyMTk3OA==", "url": "https://github.com/apache/pulsar/pull/7668#discussion_r461021978", "bodyText": "Should these go uncommented by default, to keep it consistent with previous behavior?", "author": "merlimat", "createdAt": "2020-07-27T16:39:22Z", "path": "deployment/terraform-ansible/deploy-pulsar.yaml", "diffHunk": "@@ -123,12 +124,45 @@\n   connection: ssh\n   become: true\n   tasks:\n-    - name: Download Pulsar IO package\n-      unarchive:\n-        src: http://archive.apache.org/dist/incubator/pulsar/pulsar-{{ pulsar_version }}/apache-pulsar-io-connectors-{{ pulsar_version }}-bin.tar.gz\n-        remote_src: yes\n-        dest: /opt/pulsar\n-        extra_opts: [\"--strip-components=1\"]\n+    - name: Create connectors directory\n+      file:\n+        path: \"/opt/pulsar/{{ item }}\"\n+        state: directory\n+      loop:\n+        - connectors\n+    - name: Download Pulsar IO packages\n+      get_url:\n+        url: https://www.apache.org/dyn/mirrors/mirrors.cgi?action=download&filename=pulsar/pulsar-{{ pulsar_version }}/connectors/pulsar-io-{{ item }}-{{ pulsar_version }}.nar\n+        dest: /opt/pulsar/connectors/pulsar-io-{{ item }}-{{ pulsar_version }}.nar\n+      loop:\n+#        - aerospike", "originalCommit": "3e46b2d194832ab455c0a8e18589a70904e40913", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTA2NzYzMw==", "url": "https://github.com/apache/pulsar/pull/7668#discussion_r461067633", "bodyText": "I'm not sure that the previous setup was widely used, given how out of date it was. I feel like it's more of a tutorial / jumping off point, rather than something that someone would use regularly and be confused by its behavior.\nIt's just a lot of time to download all of them.  Feels a bit more friendly to only download a couple, given that these are optional and that people using this are probably trying it out for the first time.", "author": "kristi", "createdAt": "2020-07-27T17:55:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTAyMTk3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTA3NjEyMA==", "url": "https://github.com/apache/pulsar/pull/7668#discussion_r461076120", "bodyText": "I added a note in the documentation page about the connectors", "author": "kristi", "createdAt": "2020-07-27T18:10:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTAyMTk3OA=="}], "type": "inlineReview"}, {"oid": "177a21d3077d381c01d0a977789e6bf151674c71", "url": "https://github.com/apache/pulsar/commit/177a21d3077d381c01d0a977789e6bf151674c71", "message": "update aws deployment for 2.6.0", "committedDate": "2020-07-28T01:23:31Z", "type": "commit"}, {"oid": "f9349b66caacd6b5acab22a0d1442b524e69011a", "url": "https://github.com/apache/pulsar/commit/f9349b66caacd6b5acab22a0d1442b524e69011a", "message": "ignore whitespace changes", "committedDate": "2020-07-28T01:23:31Z", "type": "commit"}, {"oid": "61f8223130ff531e574da99b988b8b1ef77d2123", "url": "https://github.com/apache/pulsar/commit/61f8223130ff531e574da99b988b8b1ef77d2123", "message": "actually mount volumes", "committedDate": "2020-07-28T01:23:31Z", "type": "commit"}, {"oid": "23b212b57ee0ab57c804cc81a9227bde837ed64a", "url": "https://github.com/apache/pulsar/commit/23b212b57ee0ab57c804cc81a9227bde837ed64a", "message": "add a note in the instructions on using connectors", "committedDate": "2020-07-28T01:23:31Z", "type": "commit"}, {"oid": "23b212b57ee0ab57c804cc81a9227bde837ed64a", "url": "https://github.com/apache/pulsar/commit/23b212b57ee0ab57c804cc81a9227bde837ed64a", "message": "add a note in the instructions on using connectors", "committedDate": "2020-07-28T01:23:31Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjQwMDYxMA==", "url": "https://github.com/apache/pulsar/pull/7668#discussion_r462400610", "bodyText": "This only works for the latest version. It doesn't work for old versions. Did you encounter any troubles using the archive path?", "author": "sijie", "createdAt": "2020-07-29T15:45:27Z", "path": "deployment/terraform-ansible/deploy-pulsar.yaml", "diffHunk": "@@ -28,20 +28,21 @@\n         state: directory\n       with_items: [\"/opt/pulsar\"]\n     - name: Install RPM packages\n-      yum: pkg={{ item }} state=latest\n-      with_items:\n-        - wget\n-        - java\n-        - sysstat\n-        - vim\n+      yum:\n+        state: latest\n+        name:\n+          - wget\n+          - java\n+          - sysstat\n+          - vim\n     - set_fact:\n-        zookeeper_servers: \"{{ groups['zookeeper']|map('extract', hostvars, ['ansible_default_ipv4', 'address'])|map('regex_replace', '(.*)', '\\\\1:2181') | join(',') }}\"\n-        service_url: \"pulsar://{{ hostvars[groups['proxy'][0]].public_ip }}:6650/\"\n-        http_url: \"http://{{ hostvars[groups['proxy'][0]].public_ip }}:8080/\"\n-        pulsar_version: \"2.1.0-incubating\"\n+        zookeeper_servers: \"{{ groups['zookeeper']|map('extract', hostvars, ['ansible_default_ipv4', 'address'])|map('regex_replace', '^(.*)$', '\\\\1:2181') | join(',') }}\"\n+        service_url: \"{{ pulsar_service_url }}\"\n+        http_url: \"{{ pulsar_web_url }}\"\n+        pulsar_version: \"2.6.0\"\n     - name: Download Pulsar binary package\n       unarchive:\n-        src: http://archive.apache.org/dist/incubator/pulsar/pulsar-{{ pulsar_version }}/apache-pulsar-{{ pulsar_version }}-bin.tar.gz\n+        src: https://www.apache.org/dyn/mirrors/mirrors.cgi?action=download&filename=pulsar/pulsar-{{ pulsar_version }}/apache-pulsar-{{ pulsar_version }}-bin.tar.gz", "originalCommit": "23b212b57ee0ab57c804cc81a9227bde837ed64a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDA5ODM5MQ==", "url": "https://github.com/apache/pulsar/pull/7668#discussion_r464098391", "bodyText": "Oh, thanks for testing this. I eventually hit the archive download limit after testing a bunch. I can see if there is a mirror url for other versions, or else I'll revert to the archive url.", "author": "kristi", "createdAt": "2020-08-02T16:43:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjQwMDYxMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTQzNTU2Mg==", "url": "https://github.com/apache/pulsar/pull/7668#discussion_r465435562", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            (Optional) If you want to use any [builtin IO connectors](io-connectors.md) , edit the `Download Pulsar IO packages` task in the `deploy-pulsar.yaml` file and uncomment the connectors you want to use. \n          \n          \n            \n            (Optional) If you want to use any [built-in IO connectors](io-connectors.md) , edit the `Download Pulsar IO packages` task in the `deploy-pulsar.yaml` file and uncomment the connectors you want to use.", "author": "Huanli-Meng", "createdAt": "2020-08-05T02:30:20Z", "path": "site2/docs/deploy-aws.md", "diffHunk": "@@ -173,7 +173,11 @@ Remember to enter this command just only once. If you attempt to enter this comm\n \n ## Run the Pulsar playbook\n \n-Once you have created the necessary AWS resources using Terraform, you can install and run Pulsar on the Terraform-created EC2 instances using Ansible. To do so, enter this command:\n+Once you have created the necessary AWS resources using Terraform, you can install and run Pulsar on the Terraform-created EC2 instances using Ansible. \n+\n+(Optional) If you want to use any [builtin IO connectors](io-connectors.md) , edit the `Download Pulsar IO packages` task in the `deploy-pulsar.yaml` file and uncomment the connectors you want to use. ", "originalCommit": "23b212b57ee0ab57c804cc81a9227bde837ed64a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "b113e5d8971f4fb2caceda74daa4a43c6650397e", "url": "https://github.com/apache/pulsar/commit/b113e5d8971f4fb2caceda74daa4a43c6650397e", "message": "Update site2/docs/deploy-aws.md\n\nCo-authored-by: HuanliMeng <48120384+Huanli-Meng@users.noreply.github.com>", "committedDate": "2020-08-06T09:57:34Z", "type": "commit"}]}