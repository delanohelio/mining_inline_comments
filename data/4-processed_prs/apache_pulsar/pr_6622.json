{"pr_number": 6622, "pr_title": "ISSUE-6612 FIX: parse long field in GenricJsonRecord (#6612)", "pr_createdAt": "2020-03-27T05:18:30Z", "pr_url": "https://github.com/apache/pulsar/pull/6622", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQ3NjI5Mg==", "url": "https://github.com/apache/pulsar/pull/6622#discussion_r400476292", "bodyText": "I think the integration tests failed due to this change.\nI think we should keep the original behavior and add the following\nelse if (fn.isLong()) {\n    return fn.asLong();\n} else if (fn.isNumber()) {\n    return fn.numberValue();\n}", "author": "sijie", "createdAt": "2020-03-30T20:33:46Z", "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/generic/GenericJsonRecord.java", "diffHunk": "@@ -55,12 +55,8 @@ public Object getField(String fieldName) {\n             return new GenericJsonRecord(schemaVersion, fields, fn);\n         } else if (fn.isBoolean()) {\n             return fn.asBoolean();\n-        } else if (fn.isInt()) {\n-            return fn.asInt();\n-        } else if (fn.isFloatingPointNumber()) {\n-            return fn.asDouble();\n-        } else if (fn.isDouble()) {\n-            return fn.asDouble();\n+        } else if (fn.isNumber()) {", "originalCommit": "c6d75e6967755e2c71fcb5d13e55fbf56a008446", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTAzMTU1NQ==", "url": "https://github.com/apache/pulsar/pull/6622#discussion_r401031555", "bodyText": "if fn is long, then fn.aslong() should equals to fn.numberValue()\u3002\nThe differences compared to the previous code are:\n\nIf fn is BigDecimal, the new code will return BigDecimal rather than double\nIf fn is BigInteger, the new code will return BigInteger rather than text\nIf fn is float, the new code will return float rather than double\n\nSo i modify the code like:\n        } else if (fn.isBoolean()) {\n            return fn.asBoolean();\n        } else if (fn.isFloatingPointNumber()) {\n            return fn.asDouble();\n        } else if (fn.isBigInteger()) {\n            if (fn.canConvertToLong()) {\n                return fn.asLong();\n            } else {\n                return fn.asText();\n            }\n        } else if (fn.isNumber()) {\n            return fn.numberValue();\n        } else {\n            return fn.asText();\n        }\nI am trying to do integration tests locally but it takes too long to download snapshot jars from maven. I'll try again, and if fail again, can I push directly and do ci test?", "author": "lynnmatrix", "createdAt": "2020-03-31T16:01:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQ3NjI5Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTIxODY5MA==", "url": "https://github.com/apache/pulsar/pull/6622#discussion_r401218690", "bodyText": "sounds good.", "author": "sijie", "createdAt": "2020-03-31T21:13:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQ3NjI5Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzIxODA0Mg==", "url": "https://github.com/apache/pulsar/pull/6622#discussion_r403218042", "bodyText": "Is there anything wrong with CI workflow? I reset to commit the one before the first commit of this PR, and it still fails.", "author": "lynnmatrix", "createdAt": "2020-04-03T18:20:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQ3NjI5Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzIxODg2MA==", "url": "https://github.com/apache/pulsar/pull/6622#discussion_r403218860", "bodyText": "I found this pull #6660, and it has been merged.\nI should try again.", "author": "lynnmatrix", "createdAt": "2020-04-03T18:21:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQ3NjI5Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzYzODY4Nw==", "url": "https://github.com/apache/pulsar/pull/6622#discussion_r403638687", "bodyText": "Finally pass the CI", "author": "lynnmatrix", "createdAt": "2020-04-05T02:19:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQ3NjI5Mg=="}], "type": "inlineReview"}, {"oid": "26cd98edfe76d9d19f29ef47bc004290f54e3799", "url": "https://github.com/apache/pulsar/commit/26cd98edfe76d9d19f29ef47bc004290f54e3799", "message": "TMP: test ci", "committedDate": "2020-04-03T01:08:50Z", "type": "forcePushed"}, {"oid": "03b803d192f7bfbd5d09c16b165ba95e1cf44bdb", "url": "https://github.com/apache/pulsar/commit/03b803d192f7bfbd5d09c16b165ba95e1cf44bdb", "message": "TMP: test ci", "committedDate": "2020-04-03T16:07:46Z", "type": "forcePushed"}, {"oid": "d4ee5a6b3938fd8a6f1aca795434591f36e16411", "url": "https://github.com/apache/pulsar/commit/d4ee5a6b3938fd8a6f1aca795434591f36e16411", "message": "TMP: test ci", "committedDate": "2020-04-03T18:17:48Z", "type": "forcePushed"}, {"oid": "77663acd0ce86251e76f665d278ec8c504c2436d", "url": "https://github.com/apache/pulsar/commit/77663acd0ce86251e76f665d278ec8c504c2436d", "message": "FIX: parse long field in GenricJsonRecord (#6612)", "committedDate": "2020-04-04T08:07:35Z", "type": "commit"}, {"oid": "6905380c1ceccc1d26b1af1d5cd2e201ec5ec707", "url": "https://github.com/apache/pulsar/commit/6905380c1ceccc1d26b1af1d5cd2e201ec5ec707", "message": "Cast BigDecimal to double, BigInteger to long or text(#6612)", "committedDate": "2020-04-04T08:07:35Z", "type": "commit"}, {"oid": "6905380c1ceccc1d26b1af1d5cd2e201ec5ec707", "url": "https://github.com/apache/pulsar/commit/6905380c1ceccc1d26b1af1d5cd2e201ec5ec707", "message": "Cast BigDecimal to double, BigInteger to long or text(#6612)", "committedDate": "2020-04-04T08:07:35Z", "type": "forcePushed"}]}