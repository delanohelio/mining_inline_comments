{"pr_number": 8893, "pr_title": "Add auth action for package management service", "pr_createdAt": "2020-12-10T08:47:16Z", "pr_url": "https://github.com/apache/pulsar/pull/8893", "timeline": [{"oid": "310c877eb1986fdcfa15cf5ffca8de3214775415", "url": "https://github.com/apache/pulsar/commit/310c877eb1986fdcfa15cf5ffca8de3214775415", "message": "Add integration tests for this", "committedDate": "2020-12-10T06:03:21Z", "type": "forcePushed"}, {"oid": "0150d1c2d4fa742feacbee911dc8ba77fd4182ee", "url": "https://github.com/apache/pulsar/commit/0150d1c2d4fa742feacbee911dc8ba77fd4182ee", "message": "Add auth action for package management service\n---\n\nMaster Issue: #8676\n\n*Motivation*\n\nAdd auth action 'package' for package management operations.\nOnly the role who is granted the 'package' permission can do\nthe package operations.\n\n*Modifications*\n\n- Add 'package' auth action and check the permissions when access the REST API\n- Add integration test for this\n\n*Verify this change*\n\n- Add integraion test for this", "committedDate": "2020-12-14T11:52:38Z", "type": "commit"}, {"oid": "e6627693d24ba9aff120ea6a1c42da89c1945561", "url": "https://github.com/apache/pulsar/commit/e6627693d24ba9aff120ea6a1c42da89c1945561", "message": "Add integration tests for this", "committedDate": "2020-12-14T11:52:41Z", "type": "commit"}, {"oid": "45cc6226f2ab2a169bd64ea5ff6f35a4a7e2082c", "url": "https://github.com/apache/pulsar/commit/45cc6226f2ab2a169bd64ea5ff6f35a4a7e2082c", "message": "Fix the tests", "committedDate": "2020-12-15T02:23:33Z", "type": "commit"}, {"oid": "45cc6226f2ab2a169bd64ea5ff6f35a4a7e2082c", "url": "https://github.com/apache/pulsar/commit/45cc6226f2ab2a169bd64ea5ff6f35a4a7e2082c", "message": "Fix the tests", "committedDate": "2020-12-15T02:23:33Z", "type": "forcePushed"}, {"oid": "e489081b66504aa234fba771f220f9f6b95ff756", "url": "https://github.com/apache/pulsar/commit/e489081b66504aa234fba771f220f9f6b95ff756", "message": "Complete the future when disable the auth", "committedDate": "2020-12-15T09:05:50Z", "type": "commit"}, {"oid": "21737aef58c1e8e3fb5f8bb88e99dfd252a9298f", "url": "https://github.com/apache/pulsar/commit/21737aef58c1e8e3fb5f8bb88e99dfd252a9298f", "message": "Remove the unused auth tests", "committedDate": "2020-12-15T13:20:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzQyNTU1NA==", "url": "https://github.com/apache/pulsar/pull/8893#discussion_r547425554", "bodyText": "We need to add a method like https://github.com/apache/pulsar/pull/8893/files#diff-cea47b9766438a068de61669ccde5f4e8435941c8953edf176aa62ffddf80545R248. This is the new method of defining the permissions. Don't use the old pattern.", "author": "sijie", "createdAt": "2020-12-22T18:12:33Z", "path": "pulsar-broker-common/src/main/java/org/apache/pulsar/broker/authorization/AuthorizationProvider.java", "diffHunk": "@@ -162,6 +162,24 @@\n     CompletableFuture<Boolean> allowSinkOpsAsync(NamespaceName namespaceName, String role,\n                                                  AuthenticationDataSource authenticationData);\n \n+    /**\n+     * Check the a role has the permission to do the package operations in a namespace.\n+     *\n+     * @param namespaceName\n+     *              the namespace name you want to check\n+     * @param role\n+     *              the role to check\n+     * @param authenticationData\n+     *              authentication data related to the role\n+     * @return\n+     *              a boolean value to determine whether authorized or not\n+     */\n+    default CompletableFuture<Boolean> canDoPackageOpsAsync(NamespaceName namespaceName, String role,", "originalCommit": "21737aef58c1e8e3fb5f8bb88e99dfd252a9298f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Nzk2NzEwOQ==", "url": "https://github.com/apache/pulsar/pull/8893#discussion_r547967109", "bodyText": "It seems the link is the diff for this PR...", "author": "zymap", "createdAt": "2020-12-23T13:48:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzQyNTU1NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODIwMDU5Mg==", "url": "https://github.com/apache/pulsar/pull/8893#discussion_r548200592", "bodyText": "pulsar/pulsar-broker-common/src/main/java/org/apache/pulsar/broker/authorization/AuthorizationProvider.java\n    \n    \n         Line 434\n      in\n      7c68ade\n    \n    \n    \n    \n\n        \n          \n           default CompletableFuture<Boolean> allowTopicOperationAsync(TopicName topic, \n        \n    \n  \n\n\nCheck this one.", "author": "sijie", "createdAt": "2020-12-23T20:15:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzQyNTU1NA=="}], "type": "inlineReview"}, {"oid": "aedc6ae60c1d288b67da85a08e06da1af5a35526", "url": "https://github.com/apache/pulsar/commit/aedc6ae60c1d288b67da85a08e06da1af5a35526", "message": "Using new auth api for the package auth", "committedDate": "2020-12-25T09:40:47Z", "type": "commit"}, {"oid": "aedc6ae60c1d288b67da85a08e06da1af5a35526", "url": "https://github.com/apache/pulsar/commit/aedc6ae60c1d288b67da85a08e06da1af5a35526", "message": "Using new auth api for the package auth", "committedDate": "2020-12-25T09:40:47Z", "type": "forcePushed"}, {"oid": "ef264156112f321ef5faf98e2310316a52bd4bf4", "url": "https://github.com/apache/pulsar/commit/ef264156112f321ef5faf98e2310316a52bd4bf4", "message": "Merge remote-tracking branch 'apache/master' into package-management-auth", "committedDate": "2020-12-29T07:36:18Z", "type": "commit"}, {"oid": "6aa3b6d8bb44c8959407a3473757462e2d196f60", "url": "https://github.com/apache/pulsar/commit/6aa3b6d8bb44c8959407a3473757462e2d196f60", "message": "Fix the build issue", "committedDate": "2020-12-29T13:58:26Z", "type": "commit"}, {"oid": "421c3997cbb31b2f3c1ea02a79ed5d8908d2c4d4", "url": "https://github.com/apache/pulsar/commit/421c3997cbb31b2f3c1ea02a79ed5d8908d2c4d4", "message": "Fix the tests", "committedDate": "2021-01-04T01:33:28Z", "type": "commit"}, {"oid": "0c4b3359a627f8818493e616c2d7aa794047cf94", "url": "https://github.com/apache/pulsar/commit/0c4b3359a627f8818493e616c2d7aa794047cf94", "message": "Fix the authorization of the packages", "committedDate": "2021-01-10T10:16:43Z", "type": "commit"}, {"oid": "078b63f3c27bc5538df85dc14f28d0cbdaef4e0f", "url": "https://github.com/apache/pulsar/commit/078b63f3c27bc5538df85dc14f28d0cbdaef4e0f", "message": "Revert \"Fix the authorization of the packages\"\n\nThis reverts commit 0c4b3359a627f8818493e616c2d7aa794047cf94.", "committedDate": "2021-01-11T08:20:00Z", "type": "commit"}, {"oid": "d79d7833edf1cd682a4ee9cb5a70413c5affc9ea", "url": "https://github.com/apache/pulsar/commit/d79d7833edf1cd682a4ee9cb5a70413c5affc9ea", "message": "Revert \"Fix the tests\"\n\nThis reverts commit 421c3997cbb31b2f3c1ea02a79ed5d8908d2c4d4.", "committedDate": "2021-01-11T08:20:17Z", "type": "commit"}, {"oid": "4a7de279d3916ab29d58060a255bde733902a5c6", "url": "https://github.com/apache/pulsar/commit/4a7de279d3916ab29d58060a255bde733902a5c6", "message": "Revert \"Fix the build issue\"\n\nThis reverts commit 6aa3b6d8bb44c8959407a3473757462e2d196f60.", "committedDate": "2021-01-11T08:20:27Z", "type": "commit"}, {"oid": "f16d29158531865d751e033ce03b13b3b04e5d9f", "url": "https://github.com/apache/pulsar/commit/f16d29158531865d751e033ce03b13b3b04e5d9f", "message": "Revert \"Using new auth api for the package auth\"\n\nThis reverts commit aedc6ae60c1d288b67da85a08e06da1af5a35526.", "committedDate": "2021-01-11T08:21:07Z", "type": "commit"}, {"oid": "f1f7473c9fc079e647aa97dc45c55a36a68c3735", "url": "https://github.com/apache/pulsar/commit/f1f7473c9fc079e647aa97dc45c55a36a68c3735", "message": "Update the package autorization and authentication implements", "committedDate": "2021-01-18T00:50:31Z", "type": "commit"}, {"oid": "78b1bfe5de741598302620db80aca7638d172680", "url": "https://github.com/apache/pulsar/commit/78b1bfe5de741598302620db80aca7638d172680", "message": "Merge remote-tracking branch 'apache/master' into package-management-auth", "committedDate": "2021-01-18T05:59:03Z", "type": "commit"}, {"oid": "c4ffa28b68b26aa1e82a7ea02c307d15d2d6035a", "url": "https://github.com/apache/pulsar/commit/c4ffa28b68b26aa1e82a7ea02c307d15d2d6035a", "message": "Fix the CI error and authorization error", "committedDate": "2021-01-18T07:35:24Z", "type": "commit"}]}