{"pr_number": 8326, "pr_title": "[Issue 8300][Java client] Support cancelling message & batch futures returned from Reader & Consumer", "pr_createdAt": "2020-10-21T09:46:50Z", "pr_url": "https://github.com/apache/pulsar/pull/8326", "timeline": [{"oid": "8c2c342f2b4178ed8d519eb6b8d2bb1ec58e93fe", "url": "https://github.com/apache/pulsar/commit/8c2c342f2b4178ed8d519eb6b8d2bb1ec58e93fe", "message": "Support cancelling message & batch futures returned from Reader & Consumer", "committedDate": "2020-10-21T09:32:21Z", "type": "commit"}, {"oid": "e930cbab8ed9ab2e99178be63158127dfe37d71d", "url": "https://github.com/apache/pulsar/commit/e930cbab8ed9ab2e99178be63158127dfe37d71d", "message": "Add javadocs for message/batch future cancellation support", "committedDate": "2020-10-21T11:36:26Z", "type": "commit"}, {"oid": "e930cbab8ed9ab2e99178be63158127dfe37d71d", "url": "https://github.com/apache/pulsar/commit/e930cbab8ed9ab2e99178be63158127dfe37d71d", "message": "Add javadocs for message/batch future cancellation support", "committedDate": "2020-10-21T11:36:26Z", "type": "forcePushed"}, {"oid": "68e9fe9daae857b82dfc00379092426ff0816087", "url": "https://github.com/apache/pulsar/commit/68e9fe9daae857b82dfc00379092426ff0816087", "message": "Fix license headers", "committedDate": "2020-10-21T11:54:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTMzNTU0NA==", "url": "https://github.com/apache/pulsar/pull/8326#discussion_r509335544", "bodyText": "this seems to fix #8307", "author": "lhotari", "createdAt": "2020-10-21T14:27:30Z", "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerBase.java", "diffHunk": "@@ -733,9 +821,11 @@ private void pendingBatchReceiveTask(Timeout timeout) throws Exception {\n                 if (diff <= 0) {\n                     // The diff is less than or equal to zero, meaning that the batch receive has been timed out.\n                     // complete the OpBatchReceive and continue to check the next OpBatchReceive in pendingBatchReceives.\n-                    OpBatchReceive<T> op = pendingBatchReceives.poll();\n-                    completeOpBatchReceive(op);\n-                    firstOpBatchReceive = pendingBatchReceives.peek();\n+                    OpBatchReceive<T> op = pollNextBatchReceive();\n+                    if (op != null) {\n+                        completeOpBatchReceive(op);\n+                    }", "originalCommit": "68e9fe9daae857b82dfc00379092426ff0816087", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}