{"pr_number": 7297, "pr_title": "[Issue 2404][doc]Add proxy auth data forwarding and refine pulsar proxy content", "pr_createdAt": "2020-06-18T09:44:28Z", "pr_url": "https://github.com/apache/pulsar/pull/7297", "timeline": [{"oid": "0b86e3eb75a15e8b7ae544ff3c7decced23e65b7", "url": "https://github.com/apache/pulsar/commit/0b86e3eb75a15e8b7ae544ff3c7decced23e65b7", "message": "add proxy auth data forwarding and refine pulsar proxy content", "committedDate": "2020-06-18T09:40:26Z", "type": "commit"}, {"oid": "a2bd93305e20eea182b9074aac9b5a8e7d32d2d9", "url": "https://github.com/apache/pulsar/commit/a2bd93305e20eea182b9074aac9b5a8e7d32d2d9", "message": "fix PR- 5845", "committedDate": "2020-06-18T12:34:54Z", "type": "commit"}, {"oid": "15465c669b355cffe14d749dccb847e332232af2", "url": "https://github.com/apache/pulsar/commit/15465c669b355cffe14d749dccb847e332232af2", "message": "add a note", "committedDate": "2020-06-18T12:39:27Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjIwMTUwMg==", "url": "https://github.com/apache/pulsar/pull/7297#discussion_r442201502", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Proxy authorization requires access to ZooKeeper, so if you use these broker URLs to connect to the brokers, you need disable authorization at Proxy level. Brokers still authorize requests after the proxy forwards them.\n          \n          \n            \n            Proxy authorization requires access to ZooKeeper, so if you use these broker URLs to connect to the brokers, you need to disable authorization at the Proxy level. Brokers still authorize requests after the proxy forwards them.", "author": "Anonymitaet", "createdAt": "2020-06-18T12:51:08Z", "path": "site2/docs/administration-proxy.md", "diffHunk": "@@ -1,30 +1,32 @@\n ---\n id: administration-proxy\n-title: The Pulsar proxy\n+title: Pulsar proxy\n sidebar_label: Pulsar proxy\n ---\n \n-The [Pulsar proxy](concepts-architecture-overview.md#pulsar-proxy) is an optional gateway that you can run in front of the brokers in a Pulsar cluster. You can run a Pulsar proxy in cases when direction connections between clients and Pulsar brokers are either infeasible, undesirable, or both, for example when you run Pulsar in a cloud environment or on [Kubernetes](https://kubernetes.io) or an analogous platform.\n+Pulsar proxy is an optional gateway. Pulsar proxy is used when direction connections between clients and Pulsar brokers are either infeasible or undesirable. For example, when you run Pulsar in a cloud environment or on [Kubernetes](https://kubernetes.io) or an analogous platform, you can run Pulsar proxy.\n \n ## Configure the proxy\n \n-The proxy must have some way to find the addresses of the brokers of the cluster. You can do this by either configuring the proxy to connect directly to service discovery or by specifying a broker URL in the configuration. \n+Before using the proxy, you need to configure it with the brokers addresses in the cluster. You can configure the proxy to connect directly to service discovery, or specify a broker URL in the configuration. \n \n-### Option 1: Use service discovery\n+### Use service discovery\n \n Pulsar uses [ZooKeeper](https://zookeeper.apache.org) for service discovery. To connect the proxy to ZooKeeper, specify the following in `conf/proxy.conf`.\n ```properties\n zookeeperServers=zk-0,zk-1,zk-2\n configurationStoreServers=zk-0:2184,zk-remote:2184\n ```\n \n-> If you use service discovery, the network ACL must allow the proxy to talk to the ZooKeeper nodes on the zookeeper client port, which is usually 2181, and on the configuration store client port, which is 2184 by default. Opening the network ACLs means that if someone compromises a proxy, they have full access to ZooKeeper. For this reason, using broker URLs to configure the proxy is more secure.\n+> To use service discovery, you need to open the network ACLs, so the proxy can connects to the ZooKeeper nodes on the ZooKeeper client port(the default is `2181`) and the configuration store client port(the default is `2184`).\n \n-### Option 2: Use broker URLs\n+> However, it is not secure to use service discovery. Because if the network ACL is open, when someone compromises a proxy, they have full access to ZooKeeper. \n \n-The more secure method of configuring the proxy is to specify a URL to connect to the brokers.\n+### Use broker URLs\n \n-> [Authorization](security-authorization#enable-authorization-and-assign-superusers) at the proxy requires access to ZooKeeper, so if you use these broker URLs to connect to the brokers, you should disable the Proxy level authorization. Brokers still authorize requests after the proxy forwards them.\n+It is more secure to specify a URL to connect to the brokers.\n+\n+Proxy authorization requires access to ZooKeeper, so if you use these broker URLs to connect to the brokers, you need disable authorization at Proxy level. Brokers still authorize requests after the proxy forwards them.", "originalCommit": "15465c669b355cffe14d749dccb847e332232af2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjIxNzU5NA==", "url": "https://github.com/apache/pulsar/pull/7297#discussion_r442217594", "bodyText": "thank you very much for your refinement~", "author": "Jennifer88huang", "createdAt": "2020-06-18T13:17:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjIwMTUwMg=="}], "type": "inlineReview"}, {"oid": "4b84d872eed4c801bf38c295242558645a1928ad", "url": "https://github.com/apache/pulsar/commit/4b84d872eed4c801bf38c295242558645a1928ad", "message": "Update site2/docs/administration-proxy.md\n\nCo-authored-by: Yu Liu <50226895+Anonymitaet@users.noreply.github.com>", "committedDate": "2020-06-18T13:16:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjU2MjUzNw==", "url": "https://github.com/apache/pulsar/pull/7297#discussion_r442562537", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            > To use service discovery, you need to open the network ACLs, so the proxy can connects to the ZooKeeper nodes on the ZooKeeper client port(the default is `2181`) and the configuration store client port(the default is `2184`).\n          \n          \n            \n            > To use service discovery, you need to open the network ACLs, so the proxy can connects to the ZooKeeper nodes through the ZooKeeper client port (port `2181`) and the configuration store client port (port `2184`).", "author": "Huanli-Meng", "createdAt": "2020-06-19T00:00:27Z", "path": "site2/docs/administration-proxy.md", "diffHunk": "@@ -1,30 +1,32 @@\n ---\n id: administration-proxy\n-title: The Pulsar proxy\n+title: Pulsar proxy\n sidebar_label: Pulsar proxy\n ---\n \n-The [Pulsar proxy](concepts-architecture-overview.md#pulsar-proxy) is an optional gateway that you can run in front of the brokers in a Pulsar cluster. You can run a Pulsar proxy in cases when direction connections between clients and Pulsar brokers are either infeasible, undesirable, or both, for example when you run Pulsar in a cloud environment or on [Kubernetes](https://kubernetes.io) or an analogous platform.\n+Pulsar proxy is an optional gateway. Pulsar proxy is used when direction connections between clients and Pulsar brokers are either infeasible or undesirable. For example, when you run Pulsar in a cloud environment or on [Kubernetes](https://kubernetes.io) or an analogous platform, you can run Pulsar proxy.\n \n ## Configure the proxy\n \n-The proxy must have some way to find the addresses of the brokers of the cluster. You can do this by either configuring the proxy to connect directly to service discovery or by specifying a broker URL in the configuration. \n+Before using the proxy, you need to configure it with the brokers addresses in the cluster. You can configure the proxy to connect directly to service discovery, or specify a broker URL in the configuration. \n \n-### Option 1: Use service discovery\n+### Use service discovery\n \n Pulsar uses [ZooKeeper](https://zookeeper.apache.org) for service discovery. To connect the proxy to ZooKeeper, specify the following in `conf/proxy.conf`.\n ```properties\n zookeeperServers=zk-0,zk-1,zk-2\n configurationStoreServers=zk-0:2184,zk-remote:2184\n ```\n \n-> If you use service discovery, the network ACL must allow the proxy to talk to the ZooKeeper nodes on the zookeeper client port, which is usually 2181, and on the configuration store client port, which is 2184 by default. Opening the network ACLs means that if someone compromises a proxy, they have full access to ZooKeeper. For this reason, using broker URLs to configure the proxy is more secure.\n+> To use service discovery, you need to open the network ACLs, so the proxy can connects to the ZooKeeper nodes on the ZooKeeper client port(the default is `2181`) and the configuration store client port(the default is `2184`).", "originalCommit": "4b84d872eed4c801bf38c295242558645a1928ad", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjU2MzA3Mw==", "url": "https://github.com/apache/pulsar/pull/7297#discussion_r442563073", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            The hostname in the URLs provided should be a DNS entry which points to multiple brokers or a Virtual IP, which is backed by multiple broker IP addresses, so that the proxy does not lose connectivity to Pulsar cluster if a single broker becomes unavailable.\n          \n          \n            \n            The hostname in the URLs provided should be a DNS entry which points to multiple brokers or a virtual IP address, which is backed by multiple broker IP addresses, so that the proxy does not lose connectivity to Pulsar cluster if a single broker becomes unavailable.", "author": "Huanli-Meng", "createdAt": "2020-06-19T00:02:26Z", "path": "site2/docs/administration-proxy.md", "diffHunk": "@@ -34,18 +36,18 @@ brokerWebServiceURL=http://brokers.example.com:8080\n functionWorkerWebServiceURL=http://function-workers.example.com:8080\n ```\n \n-Or if you use TLS:\n+If you use TLS, configure the broker URLs in the following way:\n ```properties\n brokerServiceURLTLS=pulsar+ssl://brokers.example.com:6651\n brokerWebServiceURLTLS=https://brokers.example.com:8443\n functionWorkerWebServiceURL=https://function-workers.example.com:8443\n ```\n \n-The hostname in the URLs provided should be a DNS entry which points to multiple brokers or a Virtual IP which is backed by multiple broker IP addresses so that the proxy does not lose connectivity to the pulsar cluster if a single broker becomes unavailable.\n+The hostname in the URLs provided should be a DNS entry which points to multiple brokers or a Virtual IP, which is backed by multiple broker IP addresses, so that the proxy does not lose connectivity to Pulsar cluster if a single broker becomes unavailable.", "originalCommit": "4b84d872eed4c801bf38c295242558645a1928ad", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "2127970f033a97e909bbe4d76393c3d9268b6748", "url": "https://github.com/apache/pulsar/commit/2127970f033a97e909bbe4d76393c3d9268b6748", "message": "Update site2/docs/administration-proxy.md\n\nCo-authored-by: HuanliMeng <48120384+Huanli-Meng@users.noreply.github.com>", "committedDate": "2020-06-19T05:23:02Z", "type": "commit"}, {"oid": "2aeeb1d0ce981b242abf2a892c3ffc90abbde39a", "url": "https://github.com/apache/pulsar/commit/2aeeb1d0ce981b242abf2a892c3ffc90abbde39a", "message": "Update site2/docs/administration-proxy.md\n\nCo-authored-by: HuanliMeng <48120384+Huanli-Meng@users.noreply.github.com>", "committedDate": "2020-06-19T05:23:14Z", "type": "commit"}]}