{"pr_number": 8386, "pr_title": "[Issue 6231][Build] Configure maven http connection pool setting and maven http retry setting in Github Flows", "pr_createdAt": "2020-10-27T05:56:13Z", "pr_url": "https://github.com/apache/pulsar/pull/8386", "timeline": [{"oid": "5781f66cc0f93d364db0d5284021f7e99eb83af3", "url": "https://github.com/apache/pulsar/commit/5781f66cc0f93d364db0d5284021f7e99eb83af3", "message": "Disable maven http pool and keep alive in Github flows\n\nFixes #6231\n\nSolution from https://stackoverflow.com/a/58769870", "committedDate": "2020-10-27T08:27:04Z", "type": "forcePushed"}, {"oid": "3caa9cc85194d0d4226c41fdd7509d2409827d41", "url": "https://github.com/apache/pulsar/commit/3caa9cc85194d0d4226c41fdd7509d2409827d41", "message": "Limit maven http connection pool TTL in Github flows\n\nFixes #6231\n\nMaven's wagon-http documentation:\nhttps://maven.apache.org/wagon/wagon-providers/wagon-http/\n\nSet maven.wagon.httpconnectionManager.ttlSeconds to\n25 seconds.\nmaven.wagon.httpconnectionManager.ttlSeconds documentation in source code:\nhttps://github.com/apache/maven-wagon/blob/a7c8e3470dd968961e87a7cb9a3829d3bec77383/wagon-providers/wagon-http-shared/src/main/java/org/apache/maven/wagon/shared/http/AbstractHttpClientWagon.java#L297-L305\n\nAlso add -Dmaven.wagon.http.retryHandler.count=3 which\nwill retry http calls 3 times. However this has no impact on\nretrying downloads. (documentatation: \"Any retry handler can\nonly react to exceptions when executing the request and receiving\nthe response head. It will not salvage in-flight failures of\nongoing response body streams.\")", "committedDate": "2020-10-27T08:54:34Z", "type": "commit"}, {"oid": "3caa9cc85194d0d4226c41fdd7509d2409827d41", "url": "https://github.com/apache/pulsar/commit/3caa9cc85194d0d4226c41fdd7509d2409827d41", "message": "Limit maven http connection pool TTL in Github flows\n\nFixes #6231\n\nMaven's wagon-http documentation:\nhttps://maven.apache.org/wagon/wagon-providers/wagon-http/\n\nSet maven.wagon.httpconnectionManager.ttlSeconds to\n25 seconds.\nmaven.wagon.httpconnectionManager.ttlSeconds documentation in source code:\nhttps://github.com/apache/maven-wagon/blob/a7c8e3470dd968961e87a7cb9a3829d3bec77383/wagon-providers/wagon-http-shared/src/main/java/org/apache/maven/wagon/shared/http/AbstractHttpClientWagon.java#L297-L305\n\nAlso add -Dmaven.wagon.http.retryHandler.count=3 which\nwill retry http calls 3 times. However this has no impact on\nretrying downloads. (documentatation: \"Any retry handler can\nonly react to exceptions when executing the request and receiving\nthe response head. It will not salvage in-flight failures of\nongoing response body streams.\")", "committedDate": "2020-10-27T08:54:34Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjYwODA2NA==", "url": "https://github.com/apache/pulsar/pull/8386#discussion_r512608064", "bodyText": "shall we use 240 seconds as you written in your comment ?", "author": "eolivelli", "createdAt": "2020-10-27T11:19:27Z", "path": ".github/workflows/ci-cpp.yaml", "diffHunk": "@@ -26,6 +26,9 @@ on:\n     branches:\n       - branch-*\n \n+env:\n+  MAVEN_OPTS: -Dmaven.wagon.httpconnectionManager.ttlSeconds=25 -Dmaven.wagon.http.retryHandler.count=3", "originalCommit": "3caa9cc85194d0d4226c41fdd7509d2409827d41", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjYyNzI1NA==", "url": "https://github.com/apache/pulsar/pull/8386#discussion_r512627254", "bodyText": "I was thinking about that. However I'm not exactly sure if the GitHub Flows environment is an Azure environment as referenced in WAGON-545.\nThe reason for the 25 second TTL is to ensure that it's shorter than any common firewall or NAT timeout. Some NATs have a 30 second idle timeout although that is very rare.\nThere shouldn't be harm in using the 25 second TTL since the connection pool will be able to pool connections well with a 25 second TTL. I don't see a reason to extend it to 240 seconds since there's not really a benefit.", "author": "lhotari", "createdAt": "2020-10-27T11:49:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjYwODA2NA=="}], "type": "inlineReview"}]}