{"pr_number": 7175, "pr_title": "[doc] Clarify the impact of batch message in key_shared subscription", "pr_createdAt": "2020-06-05T02:44:29Z", "pr_url": "https://github.com/apache/pulsar/pull/7175", "timeline": [{"oid": "4d9ecc1259d66e1cf770c86b51746cfd3c0255a6", "url": "https://github.com/apache/pulsar/commit/4d9ecc1259d66e1cf770c86b51746cfd3c0255a6", "message": "[doc] Clarify the impact of batch message in key_shared subscription", "committedDate": "2020-06-05T02:43:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTcxNDUyOA==", "url": "https://github.com/apache/pulsar/pull/7175#discussion_r435714528", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            If batch enabled at the producer side, messages with different key may add to a batch by default. The broker will dispatch the batch to the consumer, so the default batch mechanism may break the Key_Shared subscription guaranteed message distribution semantics. The producer need to use the `KeyBasedBatcher`.\n          \n          \n            \n            If batching is enabled at the producer side, messages with different keys are added to a batch by default. The broker will dispatch the batch to the consumer, so the default batch mechanism may break the Key_Shared subscription guaranteed message distribution semantics. The producer needs to use the `KeyBasedBatcher`.", "author": "Huanli-Meng", "createdAt": "2020-06-05T06:28:40Z", "path": "site2/docs/client-libraries-java.md", "diffHunk": "@@ -608,6 +608,22 @@ consumer2 receives the follwoing information.\n (\"key-4\", \"message-4-2\")\n ```\n \n+If batch enabled at the producer side, messages with different key may add to a batch by default. The broker will dispatch the batch to the consumer, so the default batch mechanism may break the Key_Shared subscription guaranteed message distribution semantics. The producer need to use the `KeyBasedBatcher`.", "originalCommit": "4d9ecc1259d66e1cf770c86b51746cfd3c0255a6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTcxNDgzMg==", "url": "https://github.com/apache/pulsar/pull/7175#discussion_r435714832", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Or the producer can disable the message batch mechanism.\n          \n          \n            \n            Or the producer can disable batching.", "author": "Huanli-Meng", "createdAt": "2020-06-05T06:29:35Z", "path": "site2/docs/client-libraries-java.md", "diffHunk": "@@ -608,6 +608,22 @@ consumer2 receives the follwoing information.\n (\"key-4\", \"message-4-2\")\n ```\n \n+If batch enabled at the producer side, messages with different key may add to a batch by default. The broker will dispatch the batch to the consumer, so the default batch mechanism may break the Key_Shared subscription guaranteed message distribution semantics. The producer need to use the `KeyBasedBatcher`.\n+\n+```java\n+Producer producer = client.newProducer()\n+        .topic(\"my-topic\")\n+        .batcherBuilder(BatcherBuilder.KEY_BASED)\n+        .create();\n+```\n+Or the producer can disable the message batch mechanism.", "originalCommit": "4d9ecc1259d66e1cf770c86b51746cfd3c0255a6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "d1893ce30b2fc216786e7908a9d63c12cd0298be", "url": "https://github.com/apache/pulsar/commit/d1893ce30b2fc216786e7908a9d63c12cd0298be", "message": "Update site2/docs/client-libraries-java.md\n\nCo-authored-by: HuanliMeng <48120384+Huanli-Meng@users.noreply.github.com>", "committedDate": "2020-06-05T06:44:52Z", "type": "commit"}, {"oid": "e2d7b44abb6daff5de5227617e29b1c5abda6e01", "url": "https://github.com/apache/pulsar/commit/e2d7b44abb6daff5de5227617e29b1c5abda6e01", "message": "Update site2/docs/client-libraries-java.md\n\nCo-authored-by: HuanliMeng <48120384+Huanli-Meng@users.noreply.github.com>", "committedDate": "2020-06-05T06:45:06Z", "type": "commit"}]}