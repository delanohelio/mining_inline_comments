{"pr_number": 9074, "pr_title": "[feature][cpp-client]Expose cpp end to end encryption interface", "pr_createdAt": "2020-12-29T04:38:10Z", "pr_url": "https://github.com/apache/pulsar/pull/9074", "timeline": [{"oid": "f4712285cbce4779cc6473e7114be7219063aea5", "url": "https://github.com/apache/pulsar/commit/f4712285cbce4779cc6473e7114be7219063aea5", "message": "Expose cpp end to end encryption interface", "committedDate": "2020-12-29T04:28:33Z", "type": "commit"}, {"oid": "ca392ac1d9b2a07b8ed8f8bb625acab6383565df", "url": "https://github.com/apache/pulsar/commit/ca392ac1d9b2a07b8ed8f8bb625acab6383565df", "message": "Fixed build error", "committedDate": "2020-12-29T09:04:16Z", "type": "commit"}, {"oid": "041424cf06f16bedf4ef5787c9b96b7c5daf5fce", "url": "https://github.com/apache/pulsar/commit/041424cf06f16bedf4ef5787c9b96b7c5daf5fce", "message": "Format code style", "committedDate": "2020-12-29T10:15:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTY1MzIxMg==", "url": "https://github.com/apache/pulsar/pull/9074#discussion_r549653212", "bodyText": "The naming style should be consistent with other enum values, i.e. change pulsar_producerFail to pulsar_ProducerFail.", "author": "BewareMyPower", "createdAt": "2020-12-29T10:30:06Z", "path": "pulsar-client-cpp/include/pulsar/c/producer_configuration.h", "diffHunk": "@@ -63,8 +63,17 @@ typedef enum {\n     pulsar_AutoPublish = -4,\n } pulsar_schema_type;\n \n+typedef enum {\n+    // This is the default option to fail send if crypto operation fails\n+    pulsar_producerFail,\n+    // Ignore crypto failure and proceed with sending unencrypted messages\n+    pulsar_producerSend", "originalCommit": "041424cf06f16bedf4ef5787c9b96b7c5daf5fce", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTY1Mzg4Nw==", "url": "https://github.com/apache/pulsar/pull/9074#discussion_r549653887", "bodyText": "Should EncKeyReader in testEncryptionFailure also be replaced with the default crypto key reader? Then the implementation of EncKeyReader could be removed.", "author": "BewareMyPower", "createdAt": "2020-12-29T10:32:12Z", "path": "pulsar-client-cpp/tests/BasicEndToEndTest.cc", "diffHunk": "@@ -1323,7 +1324,14 @@ TEST(BasicEndToEndTest, testRSAEncryption) {\n     std::string subName = \"my-sub-name\";\n     Producer producer;\n \n-    std::shared_ptr<EncKeyReader> keyReader = std::make_shared<EncKeyReader>();\n+    std::string PUBLIC_CERT_FILE_PATH =", "originalCommit": "041424cf06f16bedf4ef5787c9b96b7c5daf5fce", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTcxMjA3MA==", "url": "https://github.com/apache/pulsar/pull/9074#discussion_r549712070", "bodyText": "There is another test method testEncryptionFailure that needs to use this mock class, testEncryptionFailure mainly tests for some failure cases, it may be more appropriate to use this mock class", "author": "tuteng", "createdAt": "2020-12-29T13:51:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTY1Mzg4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTkwODI4NA==", "url": "https://github.com/apache/pulsar/pull/9074#discussion_r549908284", "bodyText": "But the implementation difference between EncKeyReader and DefaultCryptoKeyReader is just that EncKeyReader uses hard coding path while DefaultCryptoKeyReader does not, right?  The tests cases of  testEncryptionFailure are mocked by prodConf.addEncryptionKey(path)  but not the EncKeyReader itself.", "author": "BewareMyPower", "createdAt": "2020-12-30T01:45:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTY1Mzg4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDE1OTUzMA==", "url": "https://github.com/apache/pulsar/pull/9074#discussion_r550159530", "bodyText": "Thanks, I have removed this class EncKeyReader, PTAL @BewareMyPower", "author": "tuteng", "createdAt": "2020-12-30T11:20:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTY1Mzg4Nw=="}], "type": "inlineReview"}, {"oid": "7e8cff27c533ac562667c9fa46e435fbe3a42e15", "url": "https://github.com/apache/pulsar/commit/7e8cff27c533ac562667c9fa46e435fbe3a42e15", "message": "Fixed import error", "committedDate": "2020-12-29T11:06:29Z", "type": "commit"}, {"oid": "bb1bf76ea007ca3fddd9679347ab4ad35b23185d", "url": "https://github.com/apache/pulsar/commit/bb1bf76ea007ca3fddd9679347ab4ad35b23185d", "message": "Fixed comment", "committedDate": "2020-12-29T13:46:55Z", "type": "commit"}, {"oid": "72f4555420fab9e32a4dc2dde9fc5325e4c50da5", "url": "https://github.com/apache/pulsar/commit/72f4555420fab9e32a4dc2dde9fc5325e4c50da5", "message": "Update comment", "committedDate": "2020-12-30T10:23:58Z", "type": "commit"}, {"oid": "1a7a0ed806ee2c396302d3e3a084e2a078f7d2e9", "url": "https://github.com/apache/pulsar/commit/1a7a0ed806ee2c396302d3e3a084e2a078f7d2e9", "message": "Fixed style", "committedDate": "2020-12-30T10:36:19Z", "type": "commit"}]}