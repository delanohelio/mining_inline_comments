{"pr_number": 8173, "pr_title": "[Issue 8154] [Python client] Expose schema version (of writerSchema) in Message", "pr_createdAt": "2020-09-30T16:55:50Z", "pr_url": "https://github.com/apache/pulsar/pull/8173", "timeline": [{"oid": "61ba7dd52b99ac2220a690ee792f92bb86e7f995", "url": "https://github.com/apache/pulsar/commit/61ba7dd52b99ac2220a690ee792f92bb86e7f995", "message": "[Issue 8154] Expose schema version (of writerSchema) in python client message", "committedDate": "2020-09-30T16:32:41Z", "type": "commit"}, {"oid": "d99fa6978ad808b745958a9a52b0e8e3fd85c1a4", "url": "https://github.com/apache/pulsar/commit/d99fa6978ad808b745958a9a52b0e8e3fd85c1a4", "message": "Adding formating suggestion on PR#8173 to fix tests", "committedDate": "2020-10-01T11:05:59Z", "type": "commit"}, {"oid": "488f9c822cfd3be45d649a55d26411bf8389058e", "url": "https://github.com/apache/pulsar/commit/488f9c822cfd3be45d649a55d26411bf8389058e", "message": "Fixing build issues", "committedDate": "2020-10-01T12:40:02Z", "type": "commit"}, {"oid": "4dce3c2bac1c5f4d4d9f6acc946b0882b7845cfc", "url": "https://github.com/apache/pulsar/commit/4dce3c2bac1c5f4d4d9f6acc946b0882b7845cfc", "message": "Added a test for python client returning schema version", "committedDate": "2020-10-01T14:57:34Z", "type": "commit"}, {"oid": "d7b013c7ef26c1148665b4e87b77fae3fec6aa1d", "url": "https://github.com/apache/pulsar/commit/d7b013c7ef26c1148665b4e87b77fae3fec6aa1d", "message": "Added one more test case for python client returning schema version", "committedDate": "2020-10-02T01:58:53Z", "type": "commit"}, {"oid": "c52c51dbd21193ef4cd35647b98382458c5739e3", "url": "https://github.com/apache/pulsar/commit/c52c51dbd21193ef4cd35647b98382458c5739e3", "message": "Merge remote-tracking branch 'apache/master' into schema-version", "committedDate": "2020-10-21T17:34:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjM4NzAxNg==", "url": "https://github.com/apache/pulsar/pull/8173#discussion_r512387016", "bodyText": "We should call subscribe before send like what other unit tests do, otherwise the consumer will stuck at receive.", "author": "BewareMyPower", "createdAt": "2020-10-27T02:56:56Z", "path": "pulsar-client-cpp/python/schema_test.py", "diffHunk": "@@ -354,6 +354,32 @@ class Example(Record):\n         self.assertEqual(r2.__class__.__name__, 'Example')\n         self.assertEqual(r2, r)\n \n+    def test_schema_version(self):\n+        class Example(Record):\n+            a = Integer()\n+            b = Integer()\n+\n+        client = pulsar.Client(self.serviceUrl)\n+        producer = client.create_producer(\n+                        'my-avro-python-schema-version-topic',\n+                        schema=AvroSchema(Example))\n+\n+        r = Example(a=1, b=2)\n+        producer.send(r)\n+\n+        consumer = client.subscribe('my-avro-python-schema-version-topic', 'sub-1',\n+                                    schema=AvroSchema(Example))", "originalCommit": "c52c51dbd21193ef4cd35647b98382458c5739e3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzE3MDU5OQ==", "url": "https://github.com/apache/pulsar/pull/8173#discussion_r513170599", "bodyText": "Done, thanks for spotting that.", "author": "shiv4289", "createdAt": "2020-10-28T04:16:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjM4NzAxNg=="}], "type": "inlineReview"}, {"oid": "519ef04b3d55a0593df8f905a9f676ae097e8122", "url": "https://github.com/apache/pulsar/commit/519ef04b3d55a0593df8f905a9f676ae097e8122", "message": "Fix test- move subscribe before send so the consumer offset is ahead of new data", "committedDate": "2020-10-28T04:15:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzE4MjE4Ng==", "url": "https://github.com/apache/pulsar/pull/8173#discussion_r513182186", "bodyText": "int.from_bytes is a Python3 method, but CI environment use Python2 to test. You need to use another method to convert bytes to int.", "author": "BewareMyPower", "createdAt": "2020-10-28T05:02:27Z", "path": "pulsar-client-cpp/python/schema_test.py", "diffHunk": "@@ -354,6 +354,32 @@ class Example(Record):\n         self.assertEqual(r2.__class__.__name__, 'Example')\n         self.assertEqual(r2, r)\n \n+    def test_schema_version(self):\n+        class Example(Record):\n+            a = Integer()\n+            b = Integer()\n+\n+        client = pulsar.Client(self.serviceUrl)\n+        producer = client.create_producer(\n+                        'my-avro-python-schema-version-topic',\n+                        schema=AvroSchema(Example))\n+\n+        consumer = client.subscribe('my-avro-python-schema-version-topic', 'sub-1',\n+                                    schema=AvroSchema(Example))\n+        \n+        r = Example(a=1, b=2)\n+        producer.send(r)\n+\n+        msg = consumer.receive()\n+\n+        self.assertIsNotNone(msg.schema_version())\n+\n+        self.assertEqual(0, int.from_bytes(msg.schema_version().encode(), byteorder='big'))", "originalCommit": "519ef04b3d55a0593df8f905a9f676ae097e8122", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzE5MzA5Mg==", "url": "https://github.com/apache/pulsar/pull/8173#discussion_r513193092", "bodyText": "Fixed as suggested. Thank you!", "author": "shiv4289", "createdAt": "2020-10-28T05:42:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzE4MjE4Ng=="}], "type": "inlineReview"}, {"oid": "02411f4b07c9f0119ce39e0bd0b7ab0adc4d9a28", "url": "https://github.com/apache/pulsar/commit/02411f4b07c9f0119ce39e0bd0b7ab0adc4d9a28", "message": "Fix test to make it run on python 2 and 3 both", "committedDate": "2020-10-28T05:42:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3MjU5Njc3NQ==", "url": "https://github.com/apache/pulsar/pull/8173#discussion_r672596775", "bodyText": "Am I correct that this (and other two) functions were never implemented?", "author": "migmit", "createdAt": "2021-07-19T20:10:03Z", "path": "pulsar-client-cpp/include/pulsar/c/message.h", "diffHunk": "@@ -200,6 +200,12 @@ PULSAR_PUBLIC const char *pulsar_message_get_topic_name(pulsar_message_t *messag\n \n PULSAR_PUBLIC int pulsar_message_get_redelivery_count(pulsar_message_t *message);\n \n+PULSAR_PUBLIC int pulsar_message_has_schema_version(pulsar_message_t *message);", "originalCommit": "02411f4b07c9f0119ce39e0bd0b7ab0adc4d9a28", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3Mjc1NzQzMA==", "url": "https://github.com/apache/pulsar/pull/8173#discussion_r672757430", "bodyText": "Yeah, you can open a PR to add the missed implementation.", "author": "BewareMyPower", "createdAt": "2021-07-20T02:14:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3MjU5Njc3NQ=="}], "type": "inlineReview"}]}