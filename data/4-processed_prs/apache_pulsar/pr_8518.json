{"pr_number": 8518, "pr_title": "Fixed handling errors for client requests", "pr_createdAt": "2020-11-11T04:34:47Z", "pr_url": "https://github.com/apache/pulsar/pull/8518", "timeline": [{"oid": "ecc5bdca0c2ab7fd40a0feb513c293615407114a", "url": "https://github.com/apache/pulsar/commit/ecc5bdca0c2ab7fd40a0feb513c293615407114a", "message": "Fixed handling errors for client requests", "committedDate": "2020-11-11T04:29:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTEzMzU1Ng==", "url": "https://github.com/apache/pulsar/pull/8518#discussion_r521133556", "bodyText": "if there is a cast exception, shouldn't we handle it?  If the client somehow is returned a wrong request id that is for a different request type, a cast exception may happen here. If it does, the requestFuture will never get completed and may cause the client api call to block forever.", "author": "jerrypeng", "createdAt": "2020-11-11T06:11:02Z", "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ClientCnx.java", "diffHunk": "@@ -465,7 +443,7 @@ protected void handleGetLastMessageIdSuccess(CommandGetLastMessageIdResponse suc\n             log.debug(\"{} Received success GetLastMessageId response from server: {}\", ctx.channel(), success.getRequestId());\n         }\n         long requestId = success.getRequestId();\n-        CompletableFuture<MessageIdData> requestFuture = pendingGetLastMessageIdRequests.remove(requestId);\n+        CompletableFuture<MessageIdData> requestFuture = (CompletableFuture<MessageIdData>) pendingRequests.remove(requestId);", "originalCommit": "ecc5bdca0c2ab7fd40a0feb513c293615407114a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTEzODQ1OQ==", "url": "https://github.com/apache/pulsar/pull/8518#discussion_r521138459", "bodyText": "The connection will get automatically closed and therefore the future will be completed there.", "author": "merlimat", "createdAt": "2020-11-11T06:26:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTEzMzU1Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTE0MDA1NQ==", "url": "https://github.com/apache/pulsar/pull/8518#discussion_r521140055", "bodyText": "i see", "author": "jerrypeng", "createdAt": "2020-11-11T06:31:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTEzMzU1Ng=="}], "type": "inlineReview"}]}