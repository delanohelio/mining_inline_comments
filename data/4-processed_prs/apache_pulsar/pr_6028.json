{"pr_number": 6028, "pr_title": "[Issue 5690][pulsar-io] Make type name of Elasticsearch sink connector configurable.", "pr_createdAt": "2020-01-10T08:11:59Z", "pr_url": "https://github.com/apache/pulsar/pull/6028", "timeline": [{"oid": "ec9abcffc1f83a8c6a41ee095e5827da1e55aae2", "url": "https://github.com/apache/pulsar/commit/ec9abcffc1f83a8c6a41ee095e5827da1e55aae2", "message": "[pulsar-io-elastic-search] Made type name configurable.", "committedDate": "2020-01-10T07:09:14Z", "type": "commit"}, {"oid": "94f9b32baeb84ec2df815e0fac451d1b7c92187a", "url": "https://github.com/apache/pulsar/commit/94f9b32baeb84ec2df815e0fac451d1b7c92187a", "message": "[pulsar-io-elastic-search] Made type name configurable.", "committedDate": "2020-01-10T08:23:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTIwNDU1Ng==", "url": "https://github.com/apache/pulsar/pull/6028#discussion_r365204556", "bodyText": "Please align the indentation level with other annotations", "author": "vzhikserg", "createdAt": "2020-01-10T12:07:16Z", "path": "pulsar-io/elastic-search/src/main/java/org/apache/pulsar/io/elasticsearch/ElasticSearchConfig.java", "diffHunk": "@@ -52,6 +52,15 @@\n     )\n     private String indexName;\n \n+    @FieldDoc(\n+            required = false,", "originalCommit": "94f9b32baeb84ec2df815e0fac451d1b7c92187a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTQ1MTQ1Mg==", "url": "https://github.com/apache/pulsar/pull/6028#discussion_r365451452", "bodyText": "Fixed it, thanks!", "author": "fantapsody", "createdAt": "2020-01-10T22:13:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTIwNDU1Ng=="}], "type": "inlineReview"}, {"oid": "e0630f3a1d5b94f75c82e5866246076628a8fa24", "url": "https://github.com/apache/pulsar/commit/e0630f3a1d5b94f75c82e5866246076628a8fa24", "message": "[pulsar-io-elastic-search] Fixed indention.", "committedDate": "2020-01-10T22:12:12Z", "type": "commit"}, {"oid": "c686e19f597f3248c7094baa70e73bfc80defaca", "url": "https://github.com/apache/pulsar/commit/c686e19f597f3248c7094baa70e73bfc80defaca", "message": "[pulsar-io-elasticsearch] Adds an example in the doc of Elasticsearch connector.", "committedDate": "2020-01-12T16:23:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTY5NzE4Mg==", "url": "https://github.com/apache/pulsar/pull/6028#discussion_r365697182", "bodyText": "IMHO this example section should still belong to the ## Configuration part.  ### Configuration looks weird in this context.", "author": "vzhikserg", "createdAt": "2020-01-13T09:07:54Z", "path": "site2/docs/io-elasticsearch-sink.md", "diffHunk": "@@ -16,21 +16,26 @@ The configuration of the ElasticSearch sink connector has the following properti\n |------|----------|----------|---------|-------------|\n | `elasticSearchUrl` | String| true |\" \" (empty string)| The URL of elastic search cluster to which the connector connects. |\n | `indexName` | String| true |\" \" (empty string)| The index name to which the connector writes messages. |\n+| `typeName` | String | false | \"_doc\" | The type name to which the connector writes messages to. <br><br> The value should be set explicitly to a valid type name other than \"_doc\" for Elasticsearch version before 6.2, and left to default otherwise. |\n | `indexNumberOfShards` | int| false |1| The number of shards of the index. |\n | `indexNumberOfReplicas` | int| false |1 | The number of replicas of the index. |\n | `username` | String| false |\" \" (empty string)| The username used by the connector to connect to the elastic search cluster. <br><br>If `username` is set, then `password` should also be provided. |\n | `password` | String| false | \" \" (empty string)|The password used by the connector to connect to the elastic search cluster. <br><br>If `username` is set, then `password` should also be provided.  |\n \n-### Example\n+## Example", "originalCommit": "c686e19f597f3248c7094baa70e73bfc80defaca", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTcwNzg1OQ==", "url": "https://github.com/apache/pulsar/pull/6028#discussion_r365707859", "bodyText": "Thanks, the modification here is to follow the structure of https://raw.githubusercontent.com/apache/pulsar/master/site2/docs/io-cdc-debezium.md . @tuteng @Anonymitaet Could you give some suggestion here?", "author": "fantapsody", "createdAt": "2020-01-13T09:34:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTY5NzE4Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTc2ODU0Ng==", "url": "https://github.com/apache/pulsar/pull/6028#discussion_r365768546", "bodyText": "OK, it is fine if you wanted to make it consistent with description of other connectors", "author": "vzhikserg", "createdAt": "2020-01-13T12:02:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTY5NzE4Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTc2OTQ4Mw==", "url": "https://github.com/apache/pulsar/pull/6028#discussion_r365769483", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    ```bash\n          \n          \n            \n                    ```json", "author": "vzhikserg", "createdAt": "2020-01-13T12:05:22Z", "path": "site2/docs/io-elasticsearch-sink.md", "diffHunk": "@@ -40,10 +45,95 @@ Before using the ElasticSearch sink connector, you need to create a configuratio\n \n     ```yaml\n     configs:\n-        elasticSearchUrl: \"http://localhost:90902\"\n-        indexName: \"myIndex\"\n+        elasticSearchUrl: \"http://localhost:9200\"\n+        indexName: \"my_index\"\n         username: \"scooby\"\n         password: \"doobie\"\n     ```\n \n+#### For Elasticsearch Before 6.2\n+\n+* JSON \n+\n+    ```json\n+    {\n+        \"elasticSearchUrl\": \"http://localhost:9200\",\n+        \"indexName\": \"my_index\",\n+        \"typeName\": \"doc\",\n+        \"username\": \"scooby\",\n+        \"password\": \"doobie\"\n+    }\n+    ```\n+\n+* YAML\n+\n+    ```yaml\n+    configs:\n+        elasticSearchUrl: \"http://localhost:9200\"\n+        indexName: \"my_index\"\n+        typeName: \"doc\"\n+        username: \"scooby\"\n+        password: \"doobie\"\n+    ```\n+\n+### Usage\n+\n+1. Start a single node Elasticsearch cluster.\n+\n+    ```bash\n+    $ docker run -p 9200:9200 -p 9300:9300 \\\n+        -e \"discovery.type=single-node\" \\\n+        docker.elastic.co/elasticsearch/elasticsearch:7.5.1\n+    ```\n+\n+2. Start a Pulsar service locally in standalone mode.\n+    ```bash\n+    $ bin/pulsar standalone\n+    ```\n+    Make sure the nar file is available at `connectors/pulsar-io-elastic-search-{{pulsar:version}}.nar`.\n+\n+3. Start the Pulsar Elasticsearch connector in local run mode using one of the following methods.\n+    * Use the **JSON** configuration as shown previously. \n+        ```bash\n+        $ bin/pulsar-admin sinks localrun \\\n+            --archive connectors/pulsar-io-elastic-search-{{pulsar:version}}.nar \\\n+            --tenant public \\\n+            --namespace default \\\n+            --name elasticsearch-test-sink \\\n+            --sink-type elastic_search \\\n+            --sink-config '{\"elasticSearchUrl\":\"http://localhost:9200\",\"indexName\": \"my_index\",\"username\": \"scooby\",\"password\": \"doobie\"}' \\\n+            --inputs elasticsearch_test\n+        ```\n+    * Use the **YAML** configuration file as shown previously.\n+    \n+        ```bash\n+        $ bin/pulsar-admin sinks localrun \\\n+            --archive connectors/pulsar-io-elastic-search-{{pulsar:version}}.nar \\\n+            --tenant public \\\n+            --namespace default \\\n+            --name elasticsearch-test-sink \\\n+            --sink-type elastic_search \\\n+            --sink-config-file elasticsearch-sink.yml \\\n+            --inputs elasticsearch_test\n+        ```\n+\n+4. Publish records to the topic.\n+\n+    ```bash\n+    $ bin/pulsar-client produce elasticsearch_test --messages \"{\\\"a\\\":1}\"\n+    ```\n \n+5. Check documents in Elasticsearch.\n+    \n+    * refresh the index\n+        ```bash\n+            $ curl -s http://localhost:9200/my_index/_refresh\n+        ``` \n+    * search documents\n+        ```bash\n+            $ curl -s http://localhost:9200/my_index/_search\n+        ```\n+        You can see the record that published earlier has been successfully written into Elasticsearch.\n+        ```bash", "originalCommit": "c686e19f597f3248c7094baa70e73bfc80defaca", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "ea407473c9fdce7f48402fcdb5cb3bc71600fb8c", "url": "https://github.com/apache/pulsar/commit/ea407473c9fdce7f48402fcdb5cb3bc71600fb8c", "message": "Update site2/docs/io-elasticsearch-sink.md\n\nCo-Authored-By: Sergii Zhevzhyk <vzhikserg@users.noreply.github.com>", "committedDate": "2020-01-13T13:24:22Z", "type": "commit"}]}