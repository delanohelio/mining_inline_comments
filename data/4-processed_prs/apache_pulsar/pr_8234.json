{"pr_number": 8234, "pr_title": "Modify the occasion of triggering listeners", "pr_createdAt": "2020-10-11T04:47:20Z", "pr_url": "https://github.com/apache/pulsar/pull/8234", "timeline": [{"oid": "daefcdbc2450233ac38e9843a895719d6f65973c", "url": "https://github.com/apache/pulsar/commit/daefcdbc2450233ac38e9843a895719d6f65973c", "message": "fix policies lost", "committedDate": "2020-10-11T02:22:53Z", "type": "commit"}, {"oid": "ca1a7c4df1736f33b380442eb22bc1c2ecd58482", "url": "https://github.com/apache/pulsar/commit/ca1a7c4df1736f33b380442eb22bc1c2ecd58482", "message": "fix npe", "committedDate": "2020-10-11T03:35:32Z", "type": "commit"}, {"oid": "56080e71ff836cc31aa755d6d06ec2ddb69209ec", "url": "https://github.com/apache/pulsar/commit/56080e71ff836cc31aa755d6d06ec2ddb69209ec", "message": "fix get namespace policies", "committedDate": "2020-10-11T04:06:38Z", "type": "commit"}, {"oid": "b68a739ba27516b294c8a0413a72128ea189bfb2", "url": "https://github.com/apache/pulsar/commit/b68a739ba27516b294c8a0413a72128ea189bfb2", "message": "fix unit test", "committedDate": "2020-10-11T06:18:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjg3MTY2MQ==", "url": "https://github.com/apache/pulsar/pull/8234#discussion_r502871661", "bodyText": "Why do we need to get the namespace policy from the DispatchRateLimiter? If we don't enable the dispatch rate limiter, is it possible to get the namespace policy?", "author": "codelipenghui", "createdAt": "2020-10-11T06:19:41Z", "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/PersistentTopic.java", "diffHunk": "@@ -2427,14 +2427,8 @@ public void onUpdate(TopicPolicies policies) {\n         }\n     }\n \n-    private Optional<Policies> getNamespacePolicies(){\n-        try {\n-            return Optional.ofNullable(brokerService.pulsar().getAdminClient().namespaces()\n-                    .getPolicies(TopicName.get(topic).getNamespace()));\n-        } catch (Exception e) {\n-            log.error(\"get namespace policies fail\", e);\n-        }\n-        return Optional.empty();\n+    private Optional<Policies> getNamespacePolicies() {\n+        return DispatchRateLimiter.getPolicies(brokerService, topic);", "originalCommit": "b68a739ba27516b294c8a0413a72128ea189bfb2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjg3MTk2Ng==", "url": "https://github.com/apache/pulsar/pull/8234#discussion_r502871966", "bodyText": "This is a static tool method, and has nothing to do with whether DispatchRateLimiter is enabled", "author": "315157973", "createdAt": "2020-10-11T06:23:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjg3MTY2MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjg3MjE2NA==", "url": "https://github.com/apache/pulsar/pull/8234#discussion_r502872164", "bodyText": "Ok", "author": "codelipenghui", "createdAt": "2020-10-11T06:25:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjg3MTY2MQ=="}], "type": "inlineReview"}]}