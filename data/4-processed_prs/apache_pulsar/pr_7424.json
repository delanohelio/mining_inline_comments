{"pr_number": 7424, "pr_title": "[Issue: 7379] Improve security setting of Pulsar Functions", "pr_createdAt": "2020-07-02T02:49:05Z", "pr_url": "https://github.com/apache/pulsar/pull/7424", "timeline": [{"oid": "46a90e4d9a5194bf298abc1c41ca37bafd9936b9", "url": "https://github.com/apache/pulsar/commit/46a90e4d9a5194bf298abc1c41ca37bafd9936b9", "message": "Improve security setting of Pulsar Functions\n\nSigned-off-by: xiaolong.ran <rxl@apache.org>", "committedDate": "2020-07-02T02:43:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODc1MDkxMA==", "url": "https://github.com/apache/pulsar/pull/7424#discussion_r448750910", "bodyText": "Can you move this to end of the file and mark them as @Deprecated?", "author": "sijie", "createdAt": "2020-07-02T05:05:20Z", "path": "conf/functions_worker.yml", "diffHunk": "@@ -48,13 +48,25 @@ downloadDirectory: download/pulsar_functions\n \n # Configure the pulsar client used by function metadata management\n #\n-# points \n+# points\n+# Whether to enable TLS when clients connect to broker\n+useTls: false\n+# For TLS:\n+# brokerServiceUrl=pulsar+ssl://localhost:6651/\n pulsarServiceUrl: pulsar://localhost:6650\n+# For TLS:\n+# webServiceUrl=https://localhost:8443/\n pulsarWebServiceUrl: http://localhost:8080\n+\n+############################################\n+# security settings for pulsar broker client\n+############################################\n+# The path to trusted certificates used by the Pulsar client to authenticate with Pulsar brokers\n+# brokerClientTrustCertsFilePath:\n # the authentication plugin to be used by the pulsar client used in worker service\n-# clientAuthenticationPlugin:", "originalCommit": "46a90e4d9a5194bf298abc1c41ca37bafd9936b9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODc1MTc2Nw==", "url": "https://github.com/apache/pulsar/pull/7424#discussion_r448751767", "bodyText": "You need to consider backward compatibility. You can add getBrokerClientAuthenticationPlugin() method in WorkerConfig.\nString getBrokerClientAuthenticationPlugin() {\n    if (null == brokerClientAuthenticationParameters) {\n        return clientAuthenticationParameters;\n    } else {\n        return brokerClientAuthenticationParameters;\n    }\n}\n\nWe should do the same thing for getBrokerClientAuthenticationPlugin.", "author": "sijie", "createdAt": "2020-07-02T05:08:48Z", "path": "pulsar-broker/src/test/java/org/apache/pulsar/functions/worker/PulsarFunctionE2ESecurityTest.java", "diffHunk": "@@ -177,10 +177,10 @@ void setup(Method method) throws Exception {\n \n         ClientBuilder clientBuilder = PulsarClient.builder().serviceUrl(this.workerConfig.getPulsarServiceUrl())\n                 .operationTimeout(1000, TimeUnit.MILLISECONDS);\n-        if (isNotBlank(workerConfig.getClientAuthenticationPlugin())\n-                && isNotBlank(workerConfig.getClientAuthenticationParameters())) {\n-            clientBuilder.authentication(workerConfig.getClientAuthenticationPlugin(),\n-                    workerConfig.getClientAuthenticationParameters());\n+        if (isNotBlank(workerConfig.getBrokerClientAuthenticationPlugin())", "originalCommit": "46a90e4d9a5194bf298abc1c41ca37bafd9936b9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODc1MTkyNQ==", "url": "https://github.com/apache/pulsar/pull/7424#discussion_r448751925", "bodyText": "Please keep the original settings and mark them as deprecated.", "author": "sijie", "createdAt": "2020-07-02T05:09:17Z", "path": "pulsar-functions/runtime/src/main/java/org/apache/pulsar/functions/worker/WorkerConfig.java", "diffHunk": "@@ -258,12 +258,12 @@\n         category = CATEGORY_CLIENT_SECURITY,\n         doc = \"The authentication plugin used by function workers to talk to brokers\"\n     )\n-    private String clientAuthenticationPlugin;\n+    private String brokerClientAuthenticationPlugin;", "originalCommit": "46a90e4d9a5194bf298abc1c41ca37bafd9936b9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "b1ff3e765d911b78f7b9455e9d37c870e990374c", "url": "https://github.com/apache/pulsar/commit/b1ff3e765d911b78f7b9455e9d37c870e990374c", "message": "fix comments\n\nSigned-off-by: xiaolong.ran <rxl@apache.org>", "committedDate": "2020-07-02T06:29:29Z", "type": "commit"}, {"oid": "031c94cb981c3d6361afe69f0c1645e9adf273a1", "url": "https://github.com/apache/pulsar/commit/031c94cb981c3d6361afe69f0c1645e9adf273a1", "message": "fix comments\n\nSigned-off-by: xiaolong.ran <rxl@apache.org>", "committedDate": "2020-07-02T07:14:45Z", "type": "commit"}]}