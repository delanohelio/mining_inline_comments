{"pr_number": 7351, "pr_title": "Fix race condition in which exitFuture in FunctionAssignmentTailer never gets completed even though the tailer thread has exited", "pr_createdAt": "2020-06-24T06:43:10Z", "pr_url": "https://github.com/apache/pulsar/pull/7351", "timeline": [{"oid": "0e8d0e2e2982baf0dc8aac60680e442f762e8473", "url": "https://github.com/apache/pulsar/commit/0e8d0e2e2982baf0dc8aac60680e442f762e8473", "message": "fix race condition in which exitFuture in FunctionAssignmentTailer never gets completed even though the tailer thread has exited", "committedDate": "2020-06-24T06:37:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDY3OTQ0OA==", "url": "https://github.com/apache/pulsar/pull/7351#discussion_r444679448", "bodyText": "What are you trying to do assign a completed future ?", "author": "aahmed-se", "createdAt": "2020-06-24T06:47:22Z", "path": "pulsar-functions/worker/src/main/java/org/apache/pulsar/functions/worker/FunctionAssignmentTailer.java", "diffHunk": "@@ -113,6 +112,11 @@ public synchronized void close() {\n                     }\n                 }\n                 tailerThread = null;\n+\n+                // complete exit future to be safe\n+                exitFuture.complete(null);\n+                // reset the future\n+                exitFuture = new CompletableFuture<>();", "originalCommit": "0e8d0e2e2982baf0dc8aac60680e442f762e8473", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDY3OTgyNA==", "url": "https://github.com/apache/pulsar/pull/7351#discussion_r444679824", "bodyText": "just reset it because this object can be close() and start() again", "author": "jerrypeng", "createdAt": "2020-06-24T06:48:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDY3OTQ0OA=="}], "type": "inlineReview"}, {"oid": "49862307c1528e25bd7e17b8c184cce798557016", "url": "https://github.com/apache/pulsar/commit/49862307c1528e25bd7e17b8c184cce798557016", "message": "fix", "committedDate": "2020-06-24T06:47:23Z", "type": "commit"}]}