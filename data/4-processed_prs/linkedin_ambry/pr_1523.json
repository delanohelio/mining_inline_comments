{"pr_number": 1523, "pr_title": "Adding a new metrics to track delayed close for netty channels.", "pr_createdAt": "2020-05-19T15:08:46Z", "pr_url": "https://github.com/linkedin/ambry/pull/1523", "timeline": [{"oid": "276aa67133a33f8b6bee2b26f68eacb1c31cd1a9", "url": "https://github.com/linkedin/ambry/commit/276aa67133a33f8b6bee2b26f68eacb1c31cd1a9", "message": "Introducing a delay in closing the netty channel when a POST request fails due to any reason.\nAdding a config to enable this behaviour. By default this is disabled.\nAlso adding a metric to keep a count of such delayed close event.\nFix for some existing UT and and new UT to test the new code flow.", "committedDate": "2020-05-05T20:05:26Z", "type": "commit"}, {"oid": "5a54e259a79c65a0ec53bf4b55dce9e043d5c4af", "url": "https://github.com/linkedin/ambry/commit/5a54e259a79c65a0ec53bf4b55dce9e043d5c4af", "message": "Merge branch 'master' into ambry6804", "committedDate": "2020-05-05T20:39:35Z", "type": "commit"}, {"oid": "c875af4d0596d18c05bbc138cd066ba5629a957c", "url": "https://github.com/linkedin/ambry/commit/c875af4d0596d18c05bbc138cd066ba5629a957c", "message": "rename the variable", "committedDate": "2020-05-06T05:43:18Z", "type": "commit"}, {"oid": "327a6a95372c56d28332cab88809db267ae5feb2", "url": "https://github.com/linkedin/ambry/commit/327a6a95372c56d28332cab88809db267ae5feb2", "message": "removing the sleep", "committedDate": "2020-05-06T05:50:42Z", "type": "commit"}, {"oid": "00dc8e661333eba2c64213f1c79d176ecbf9d135", "url": "https://github.com/linkedin/ambry/commit/00dc8e661333eba2c64213f1c79d176ecbf9d135", "message": "adding another metrics to keep track of delayed close execution", "committedDate": "2020-05-06T15:33:25Z", "type": "commit"}, {"oid": "d98df91792d8d343b7f3fe58964f4c8e66c0b09f", "url": "https://github.com/linkedin/ambry/commit/d98df91792d8d343b7f3fe58964f4c8e66c0b09f", "message": "Merge branch 'master' of github.com:linkedin/ambry into ambry6804", "committedDate": "2020-05-06T18:55:14Z", "type": "commit"}, {"oid": "e732dca1afd644576825f18dd54e49b919d97615", "url": "https://github.com/linkedin/ambry/commit/e732dca1afd644576825f18dd54e49b919d97615", "message": "addressing the review comments", "committedDate": "2020-05-06T20:27:26Z", "type": "commit"}, {"oid": "d83cf4dfca4c72af7b1b5a072cf5b7f87df6250c", "url": "https://github.com/linkedin/ambry/commit/d83cf4dfca4c72af7b1b5a072cf5b7f87df6250c", "message": "enhancing the UT to test the channel close after the delay.:wq", "committedDate": "2020-05-09T05:44:26Z", "type": "commit"}, {"oid": "a08fda5d0b77d61d1aaf82927ec9bcd8fa0eb119", "url": "https://github.com/linkedin/ambry/commit/a08fda5d0b77d61d1aaf82927ec9bcd8fa0eb119", "message": "addressing more review comments", "committedDate": "2020-05-11T17:10:53Z", "type": "commit"}, {"oid": "965ead714fafbce74babb5728f1ece72ce6f5891", "url": "https://github.com/linkedin/ambry/commit/965ead714fafbce74babb5728f1ece72ce6f5891", "message": "Merge branch 'master' into ambry6804", "committedDate": "2020-05-19T04:08:41Z", "type": "commit"}, {"oid": "de34b4c156636e8b7654598bee96bda147a28c87", "url": "https://github.com/linkedin/ambry/commit/de34b4c156636e8b7654598bee96bda147a28c87", "message": "adding another metric for tracking to make sure all the sheduled\ndelayed close gets expired and the callbacks are called.", "committedDate": "2020-05-19T15:02:26Z", "type": "commit"}, {"oid": "aee0e135f7161e8bb8f7c4c28257d84878c29705", "url": "https://github.com/linkedin/ambry/commit/aee0e135f7161e8bb8f7c4c28257d84878c29705", "message": "minor string change", "committedDate": "2020-05-19T15:11:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODIxMTUwMw==", "url": "https://github.com/linkedin/ambry/pull/1523#discussion_r428211503", "bodyText": "Nit: nothing has really expired here.  Suggest renaming this delayedCloseActivatedCount or delayedCloseTriggerCount.", "author": "lightningrob", "createdAt": "2020-05-20T18:12:36Z", "path": "ambry-rest/src/main/java/com/github/ambry/rest/NettyResponseChannel.java", "diffHunk": "@@ -123,6 +123,7 @@\n     public void operationComplete(ChannelFuture future) {\n       logger.trace(\"scheduling closure of channel {}\", future.channel());\n       future.channel().eventLoop().schedule(() -> {\n+        nettyMetrics.delayedCloseExpiredCount.inc();", "originalCommit": "aee0e135f7161e8bb8f7c4c28257d84878c29705", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODI1Nzg3OQ==", "url": "https://github.com/linkedin/ambry/pull/1523#discussion_r428257879", "bodyText": "changed the metric name to delayedCloseActivatedCount. Thanks", "author": "ssen-li", "createdAt": "2020-05-20T19:29:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODIxMTUwMw=="}], "type": "inlineReview"}, {"oid": "7967cf763c23da0539bce15d00265a0b8bd5a706", "url": "https://github.com/linkedin/ambry/commit/7967cf763c23da0539bce15d00265a0b8bd5a706", "message": "renaming the metrics as suggested", "committedDate": "2020-05-20T18:33:52Z", "type": "commit"}]}