{"pr_number": 1729, "pr_title": "[StorageQuota] Add more metrics and fix a statsheader copy bug.", "pr_createdAt": "2020-12-16T17:52:27Z", "pr_url": "https://github.com/linkedin/ambry/pull/1729", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDczMTAxNw==", "url": "https://github.com/linkedin/ambry/pull/1729#discussion_r544731017", "bodyText": "Minor: I am not entirely sure what will happen if the report is not found as this report may be PartitionClass report which is temporarily not supported by mysql.", "author": "jsjtzyy", "createdAt": "2020-12-17T00:55:26Z", "path": "ambry-tools/src/main/java/com/github/ambry/clustermap/HelixClusterWideAggregationTool.java", "diffHunk": "@@ -167,8 +172,9 @@ public static void main(String[] args) throws Exception {\n               String jobId = statsType.toString().toLowerCase() + (isRecurrentWorkflow ? RECURRENT_JOB_SUFFIX\n                   : ONE_TIME_JOB_SUFFIX);\n               String taskId = statsType.toString().toLowerCase() + TASK_SUFFIX;\n-              String aggregationCommand =\n-                  String.format(\"%s_%s\", HelixHealthReportAggregatorTask.TASK_COMMAND_PREFIX, reportName);\n+              String aggregationCommand = String.format(\"%s_%s\",\n+                  config.isMysql ? MySqlReportAggregatorTask.TASK_COMMAND_PREFIX", "originalCommit": "f2c1dd183ad1c557c52fd40fa2a69bc5ba159d66", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDczNDMwMA==", "url": "https://github.com/linkedin/ambry/pull/1729#discussion_r544734300", "bodyText": "I won't worry too much about it, it's a cli tool. If we make a mistake, we can always revert it.", "author": "justinlin-linkedin", "createdAt": "2020-12-17T01:03:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDczMTAxNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDc0MzkwMw==", "url": "https://github.com/linkedin/ambry/pull/1729#discussion_r544743903", "bodyText": "why not logger.info(\"Aggregating stats from {} hosts\", statsWrappers.size());", "author": "zzmao", "createdAt": "2020-12-17T01:30:05Z", "path": "ambry-clustermap/src/main/java/com/github/ambry/clustermap/MySqlReportAggregatorTask.java", "diffHunk": "@@ -87,6 +87,7 @@ public TaskResult run() {\n         statsWrappers.put(instanceName,\n             accountStatsStore.queryStatsOf(clusterMapConfig.clusterMapClusterName, instanceName));\n       }\n+      logger.info(String.format(\"Aggregating stats from %d hosts\", statsWrappers.size()));", "originalCommit": "f2c1dd183ad1c557c52fd40fa2a69bc5ba159d66", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDc1NjI1Ng==", "url": "https://github.com/linkedin/ambry/pull/1729#discussion_r544756256", "bodyText": "does it matter? is one better than the other?", "author": "justinlin-linkedin", "createdAt": "2020-12-17T02:04:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDc0MzkwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDc3NTg2Mw==", "url": "https://github.com/linkedin/ambry/pull/1729#discussion_r544775863", "bodyText": "String.format is generally redundant inside logger calls.", "author": "lightningrob", "createdAt": "2020-12-17T03:00:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDc0MzkwMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDc0Mzk5Mw==", "url": "https://github.com/linkedin/ambry/pull/1729#discussion_r544743993", "bodyText": "same here, why not use {}", "author": "zzmao", "createdAt": "2020-12-17T01:30:20Z", "path": "ambry-clustermap/src/main/java/com/github/ambry/clustermap/MySqlReportAggregatorTask.java", "diffHunk": "@@ -99,6 +100,7 @@ public TaskResult run() {\n         String recordedMonthValue = accountStatsStore.queryRecordedMonth(clusterMapConfig.clusterMapClusterName);\n         if (recordedMonthValue == null || recordedMonthValue.isEmpty() || !currentMonthValue.equals(\n             recordedMonthValue)) {\n+          logger.info(\"Taking snapshot of aggregated stats for month \" + currentMonthValue);", "originalCommit": "f2c1dd183ad1c557c52fd40fa2a69bc5ba159d66", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDc3Njg4NQ==", "url": "https://github.com/linkedin/ambry/pull/1729#discussion_r544776885", "bodyText": "Time to remove Helix from the class name?  (Unless that will break something.)", "author": "lightningrob", "createdAt": "2020-12-17T03:04:18Z", "path": "ambry-tools/src/main/java/com/github/ambry/clustermap/HelixClusterWideAggregationTool.java", "diffHunk": "@@ -108,6 +108,10 @@\n     @Default(\"false\")\n     final boolean deleteSpecifiedWorkflow;\n \n+    @Config(\"is.mysql\")\n+    @Default(\"false\")\n+    final boolean isMysql;", "originalCommit": "f2c1dd183ad1c557c52fd40fa2a69bc5ba159d66", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTQxNTM3NA==", "url": "https://github.com/linkedin/ambry/pull/1729#discussion_r545415374", "bodyText": "Helix in the name is fine. Although we start to read the container storage reports from mysql, but this tool will instruct helix to execute these tasks.", "author": "justinlin-linkedin", "createdAt": "2020-12-17T21:29:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDc3Njg4NQ=="}], "type": "inlineReview"}, {"oid": "29653d1c7082281b135a8eaa1686ce93981af22c", "url": "https://github.com/linkedin/ambry/commit/29653d1c7082281b135a8eaa1686ce93981af22c", "message": "[StorageQuota] Add mysql support in HelixClusterWideAggregtionTool", "committedDate": "2020-12-17T21:53:57Z", "type": "commit"}, {"oid": "cd2c18d49b9a506d5a8086e861e9d0cf28927d56", "url": "https://github.com/linkedin/ambry/commit/cd2c18d49b9a506d5a8086e861e9d0cf28927d56", "message": "More metrics", "committedDate": "2020-12-17T21:53:57Z", "type": "commit"}, {"oid": "64857dea177ab8e56cd9e5d173584eef24f5c308", "url": "https://github.com/linkedin/ambry/commit/64857dea177ab8e56cd9e5d173584eef24f5c308", "message": "Comments", "committedDate": "2020-12-17T21:53:57Z", "type": "commit"}, {"oid": "64857dea177ab8e56cd9e5d173584eef24f5c308", "url": "https://github.com/linkedin/ambry/commit/64857dea177ab8e56cd9e5d173584eef24f5c308", "message": "Comments", "committedDate": "2020-12-17T21:53:57Z", "type": "forcePushed"}]}