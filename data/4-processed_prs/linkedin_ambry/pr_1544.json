{"pr_number": 1544, "pr_title": "Minor improvement for Helix bootstrap tool", "pr_createdAt": "2020-06-01T17:53:33Z", "pr_url": "https://github.com/linkedin/ambry/pull/1544", "timeline": [{"oid": "a6a1a6a2d59b0d62ae145b09f1cc18745fa6298e", "url": "https://github.com/linkedin/ambry/commit/a6a1a6a2d59b0d62ae145b09f1cc18745fa6298e", "message": "Minor improvement for Helix bootstrap tool\n\n1. ensure there is a dry-run option for bootstrapping/upgrading Helix.\n2. use isClusterSetup() instead of getClusters() to avoid expensive validation.", "committedDate": "2020-06-01T17:47:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzcyNzQ5OA==", "url": "https://github.com/linkedin/ambry/pull/1544#discussion_r433727498", "bodyText": "Minor: formating, info(\"[{}] Instance {} already present in Helix...\",", "author": "xuhao417347761", "createdAt": "2020-06-02T09:02:09Z", "path": "ambry-clustermap/src/main/java/com/github/ambry/clustermap/HelixBootstrapUpgradeUtil.java", "diffHunk": "@@ -863,22 +877,30 @@ private void addUpdateInstances(String dcName, Map<String, Set<String>> partitio\n             // the appropriate instanceConfig that is constructed with the correct values from both).\n             // For now, only bootstrapping cluster is allowed to directly change InstanceConfig\n             dcAdmin.setInstanceConfig(clusterName, instanceName, instanceConfigFromStatic);\n+          } else {\n+            info(", "originalCommit": "a6a1a6a2d59b0d62ae145b09f1cc18745fa6298e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDMxMTkyNw==", "url": "https://github.com/linkedin/ambry/pull/1544#discussion_r434311927", "bodyText": "Actually it has been formatted by intellij, as I did option+cmd+L.", "author": "jsjtzyy", "createdAt": "2020-06-03T05:13:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzcyNzQ5OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzczMTQ4Mg==", "url": "https://github.com/linkedin/ambry/pull/1544#discussion_r433731482", "bodyText": "The ZNRecordSerializer, HelixZkClient and ZKHelixAdmin are deprecated. Maybe add a to-do to update in the future?", "author": "xuhao417347761", "createdAt": "2020-06-02T09:08:41Z", "path": "ambry-clustermap/src/main/java/com/github/ambry/clustermap/HelixBootstrapUpgradeUtil.java", "diffHunk": "@@ -464,8 +465,21 @@ private HelixBootstrapUpgradeUtil(String hardwareLayoutPath, String partitionLay\n         throw new IllegalArgumentException(\n             entry.getKey() + \" has invalid number of ZK endpoints: \" + zkConnectStrs.size());\n       }\n-      HelixAdmin admin = helixAdminFactory.getHelixAdmin(zkConnectStrs.get(0));\n+      HelixAdmin admin;\n+      RealmAwareZkClient zkClient = null;\n+      if (helixAdminFactory == null) {\n+        RealmAwareZkClient.RealmAwareZkClientConfig clientConfig =\n+            new RealmAwareZkClient.RealmAwareZkClientConfig().setConnectInitTimeout(30 * 1000L)\n+                .setZkSerializer(new ZNRecordSerializer());", "originalCommit": "a6a1a6a2d59b0d62ae145b09f1cc18745fa6298e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDMxMTM2Mw==", "url": "https://github.com/linkedin/ambry/pull/1544#discussion_r434311363", "bodyText": "sure, will do", "author": "jsjtzyy", "createdAt": "2020-06-03T05:11:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzczMTQ4Mg=="}], "type": "inlineReview"}, {"oid": "6ee556b0441955260d42ae44c0010cc3b20557d2", "url": "https://github.com/linkedin/ambry/commit/6ee556b0441955260d42ae44c0010cc3b20557d2", "message": "comment", "committedDate": "2020-06-03T05:24:01Z", "type": "commit"}, {"oid": "c2f5e4183bd85771ccf61ff8b08c43bc73ba6773", "url": "https://github.com/linkedin/ambry/commit/c2f5e4183bd85771ccf61ff8b08c43bc73ba6773", "message": "minor change for VCR populate tool", "committedDate": "2020-06-05T17:21:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjA1OTAyMw==", "url": "https://github.com/linkedin/ambry/pull/1544#discussion_r436059023", "bodyText": "@ankagrawal this minor change should help us get rid of the warning messages we saw when building a new VCR cluster.", "author": "jsjtzyy", "createdAt": "2020-06-05T17:23:53Z", "path": "ambry-tools/src/main/java/com/github/ambry/clustermap/HelixVcrPopulateTool.java", "diffHunk": "@@ -145,7 +146,7 @@ public static void main(String[] args) {\n   static void createCluster(String destZkString, String destClusterName) {\n     HelixZkClient destZkClient = getHelixZkClient(destZkString);\n     HelixAdmin destAdmin = new ZKHelixAdmin(destZkClient);\n-    if (destAdmin.getClusters().contains(destClusterName)) {\n+    if (ZKUtil.isClusterSetup(destClusterName, destZkClient)) {", "originalCommit": "c2f5e4183bd85771ccf61ff8b08c43bc73ba6773", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "b499939ab0b24447541ccd3f4f957632a3b72f18", "url": "https://github.com/linkedin/ambry/commit/b499939ab0b24447541ccd3f4f957632a3b72f18", "message": "minor", "committedDate": "2020-06-05T17:44:53Z", "type": "commit"}, {"oid": "358f6d20a515da837dae15cfce2ea66ad5b9d015", "url": "https://github.com/linkedin/ambry/commit/358f6d20a515da837dae15cfce2ea66ad5b9d015", "message": "minor comment", "committedDate": "2020-06-05T20:26:53Z", "type": "commit"}]}