{"pr_number": 1476, "pr_title": "(#1475) Make Ternary consistent over its evaluation", "pr_createdAt": "2020-09-27T14:12:08Z", "pr_url": "https://github.com/yegor256/cactoos/pull/1476", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTU5MDc3MA==", "url": "https://github.com/yegor256/cactoos/pull/1476#discussion_r495590770", "bodyText": "@victornoel It would be better as String.format(\"else: %d\") here and in other pleases where + is used for concatenation.", "author": "andreoss", "createdAt": "2020-09-27T16:37:40Z", "path": "src/test/java/org/cactoos/scalar/TernaryTest.java", "diffHunk": "@@ -73,14 +76,40 @@ void conditionBoolean() throws Exception {\n \n     @Test\n     void conditionFunc() throws Exception {\n-        MatcherAssert.assertThat(\n+        new Assertion<>(\n+            \"Must call the Func with the input\",\n             new Ternary<>(\n                 5,\n                 input -> input > 3,\n-                input -> input = 8,\n-                input -> input = 2\n-            ).value(),\n-            Matchers.equalTo(8)\n-        );\n+                input -> input + 1,\n+                input -> input + 2\n+            ),\n+            new ScalarHasValue<>(6)\n+        ).affirm();\n+    }\n+\n+    @Test\n+    void conditionSticky() throws Exception {\n+        final AtomicInteger counter = new AtomicInteger(0);\n+        new Assertion<>(\n+            \"Must conserve the same value for the whole evaluation\",\n+            new Ternary<String>(\n+                counter::incrementAndGet,\n+                i -> i == 1,\n+                i ->  i + \" equals \" + 1,\n+                i -> \"else: \" + i", "originalCommit": "8f1a06ce4f8686f941eda421daa545f521f473d7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTIyMzAxMQ==", "url": "https://github.com/yegor256/cactoos/pull/1476#discussion_r499223011", "bodyText": "@andreoss I replaced all of this with FormattedText", "author": "victornoel", "createdAt": "2020-10-04T09:03:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTU5MDc3MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTU5MDkyNw==", "url": "https://github.com/yegor256/cactoos/pull/1476#discussion_r495590927", "bodyText": "@victornoel It's not clear here what should be conserved. Shouldn't Ternary be assigned to a variable for Sticky to have any effect?", "author": "andreoss", "createdAt": "2020-09-27T16:39:26Z", "path": "src/test/java/org/cactoos/scalar/TernaryTest.java", "diffHunk": "@@ -73,14 +76,40 @@ void conditionBoolean() throws Exception {\n \n     @Test\n     void conditionFunc() throws Exception {\n-        MatcherAssert.assertThat(\n+        new Assertion<>(\n+            \"Must call the Func with the input\",\n             new Ternary<>(\n                 5,\n                 input -> input > 3,\n-                input -> input = 8,\n-                input -> input = 2\n-            ).value(),\n-            Matchers.equalTo(8)\n-        );\n+                input -> input + 1,\n+                input -> input + 2\n+            ),\n+            new ScalarHasValue<>(6)\n+        ).affirm();\n+    }\n+\n+    @Test\n+    void conditionSticky() throws Exception {\n+        final AtomicInteger counter = new AtomicInteger(0);\n+        new Assertion<>(\n+            \"Must conserve the same value for the whole evaluation\",\n+            new Ternary<String>(\n+                counter::incrementAndGet,\n+                i -> i == 1,\n+                i ->  i + \" equals \" + 1,\n+                i -> \"else: \" + i\n+            ),\n+            new ScalarHasValue<>(\"1 equals 1\")\n+        ).affirm();\n+        new Assertion<>(\n+            \"Must conserve the same new value for the whole evaluation\",", "originalCommit": "8f1a06ce4f8686f941eda421daa545f521f473d7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjEzNTUzNg==", "url": "https://github.com/yegor256/cactoos/pull/1476#discussion_r496135536", "bodyText": "@andreoss ok, I see it's not clear. I thought the purpose of the PR was clear based on the ticket description, but maybe it's only clear in my head ^^ I will try to explain here and then once it's clear also for you, I will imrpove the code.\nBasically, when you can new Ternary(xxx).value(), you want that for every branches of the ternary, the value used to be the same. So for example in the test, each call to the provided scalar.value will return a new value, but you want that each call to ternary.value gives you the result for one given value of the provided scalar.value. Like this it makes behaviour much closer to the expected one by someone discovering the class ternary.\nAlso it allows to express things that were not possible before, we will see that in the PR for #1460: it will allow to write it only by pure object composition without imperative intermediate values:\n     public Abbreviated(final Text text, final int max) {\n         super(\n             new Flatten(\n                new Ternary<Text>(\n                    () -> new Sticky(text),\n                    t -> t.asString().length() <= max,\n                    t -> t,\n                    t -> new FormattedText(\n                        \"%s%s\",\n                        new Sub(\n                            t,\n                            0,\n                            max - Abbreviated.ELLIPSES.length()\n                        ),\n                        Abbreviated.ELLIPSES\n                    )\n                )\n             )\n        )\n    }", "author": "victornoel", "createdAt": "2020-09-28T18:00:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTU5MDkyNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTIyMjk1OQ==", "url": "https://github.com/yegor256/cactoos/pull/1476#discussion_r499222959", "bodyText": "@andreoss actually, thank you for your comment because I realised afterward that it's not that it was clear, but as you said, that the test was incorrect: ternary should be assigned to a variable to be reused in the two assertions. And when I tried, it showed that my implementation was indeed incorrect :)\nI've fixed that in my last push!", "author": "victornoel", "createdAt": "2020-10-04T09:03:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTU5MDkyNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTU5MTExOQ==", "url": "https://github.com/yegor256/cactoos/pull/1476#discussion_r495591119", "bodyText": "@victornoel Camel-cased variables are against the current code style, probably we should not have them in examples too.", "author": "andreoss", "createdAt": "2020-09-27T16:40:55Z", "path": "src/main/java/org/cactoos/scalar/Ternary.java", "diffHunk": "@@ -39,10 +39,10 @@\n  *\n  * <pre>{@code\n  * new Ternary<>(\n- *     5,\n+ *     someScalarOfInteger,", "originalCommit": "8f1a06ce4f8686f941eda421daa545f521f473d7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTIyMzA0Ng==", "url": "https://github.com/yegor256/cactoos/pull/1476#discussion_r499223046", "bodyText": "@andreoss right, I also simplified the example", "author": "victornoel", "createdAt": "2020-10-04T09:04:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTU5MTExOQ=="}], "type": "inlineReview"}, {"oid": "c2248947f4d385ebb87b2adca567e0399a1fd927", "url": "https://github.com/yegor256/cactoos/commit/c2248947f4d385ebb87b2adca567e0399a1fd927", "message": "(#1475) Make Ternary consistent over its evaluation", "committedDate": "2020-10-04T09:00:30Z", "type": "commit"}, {"oid": "c2248947f4d385ebb87b2adca567e0399a1fd927", "url": "https://github.com/yegor256/cactoos/commit/c2248947f4d385ebb87b2adca567e0399a1fd927", "message": "(#1475) Make Ternary consistent over its evaluation", "committedDate": "2020-10-04T09:00:30Z", "type": "forcePushed"}]}