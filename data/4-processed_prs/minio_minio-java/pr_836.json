{"pr_number": 836, "pr_title": "Add new method to set/get object retention & Legal Hold", "pr_createdAt": "2020-01-27T08:02:10Z", "pr_url": "https://github.com/minio/minio-java/pull/836", "timeline": [{"oid": "4546da1e2cfb13cde5ac03b8b2567c052cfff78c", "url": "https://github.com/minio/minio-java/commit/4546da1e2cfb13cde5ac03b8b2567c052cfff78c", "message": "Add new method to set/get object retention", "committedDate": "2020-01-27T17:08:38Z", "type": "forcePushed"}, {"oid": "b5c1c8038a7c2d02f53fdb792d5bdde725561cf3", "url": "https://github.com/minio/minio-java/commit/b5c1c8038a7c2d02f53fdb792d5bdde725561cf3", "message": "Add new method to set/get object retention", "committedDate": "2020-01-27T17:21:16Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTU3MzYzNQ==", "url": "https://github.com/minio/minio-java/pull/836#discussion_r371573635", "bodyText": "You could name it similar to S3 API ObjectRetentionConfiguration", "author": "balamurugana", "createdAt": "2020-01-28T01:37:43Z", "path": "api/src/main/java/io/minio/messages/ObjectLockRetentionConfiguration.java", "diffHunk": "@@ -0,0 +1,84 @@\n+/*\n+ * MinIO Java SDK for Amazon S3 Compatible Cloud Storage, (C) 2020 MinIO, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.minio.messages;\n+\n+import org.xmlpull.v1.XmlPullParserException;\n+import io.minio.DateFormat;\n+import org.joda.time.DateTime;\n+import com.google.api.client.util.Key;\n+\n+\n+/**\n+ * Helper class to construct create bucket configuration request XML for Amazon AWS S3.\n+ */\n+@edu.umd.cs.findbugs.annotations.SuppressFBWarnings(value = \"URF_UNREAD_FIELD\")\n+public class ObjectLockRetentionConfiguration extends XmlEntity {", "originalCommit": "b5c1c8038a7c2d02f53fdb792d5bdde725561cf3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTU3MzgwNA==", "url": "https://github.com/minio/minio-java/pull/836#discussion_r371573804", "bodyText": "versionId is not part of the configuration. It is a param in the API.", "author": "balamurugana", "createdAt": "2020-01-28T01:38:37Z", "path": "api/src/main/java/io/minio/messages/ObjectLockRetentionConfiguration.java", "diffHunk": "@@ -0,0 +1,84 @@\n+/*\n+ * MinIO Java SDK for Amazon S3 Compatible Cloud Storage, (C) 2020 MinIO, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.minio.messages;\n+\n+import org.xmlpull.v1.XmlPullParserException;\n+import io.minio.DateFormat;\n+import org.joda.time.DateTime;\n+import com.google.api.client.util.Key;\n+\n+\n+/**\n+ * Helper class to construct create bucket configuration request XML for Amazon AWS S3.\n+ */\n+@edu.umd.cs.findbugs.annotations.SuppressFBWarnings(value = \"URF_UNREAD_FIELD\")\n+public class ObjectLockRetentionConfiguration extends XmlEntity {\n+  @Key(\"ObjectRetention\")\n+  private ObjectLockRetention objectLockRetention;\n+  @Key(\"BypassGovernanceRetention\")\n+  private boolean bypassGovernanceRetention;\n+  @Key(\"Version\")\n+  private String versionId;", "originalCommit": "b5c1c8038a7c2d02f53fdb792d5bdde725561cf3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTU3MzkxOA==", "url": "https://github.com/minio/minio-java/pull/836#discussion_r371573918", "bodyText": "This is not part of the config. Its a param to the S3 API.", "author": "balamurugana", "createdAt": "2020-01-28T01:39:12Z", "path": "api/src/main/java/io/minio/messages/ObjectLockRetentionConfiguration.java", "diffHunk": "@@ -0,0 +1,84 @@\n+/*\n+ * MinIO Java SDK for Amazon S3 Compatible Cloud Storage, (C) 2020 MinIO, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.minio.messages;\n+\n+import org.xmlpull.v1.XmlPullParserException;\n+import io.minio.DateFormat;\n+import org.joda.time.DateTime;\n+import com.google.api.client.util.Key;\n+\n+\n+/**\n+ * Helper class to construct create bucket configuration request XML for Amazon AWS S3.\n+ */\n+@edu.umd.cs.findbugs.annotations.SuppressFBWarnings(value = \"URF_UNREAD_FIELD\")\n+public class ObjectLockRetentionConfiguration extends XmlEntity {\n+  @Key(\"ObjectRetention\")\n+  private ObjectLockRetention objectLockRetention;\n+  @Key(\"BypassGovernanceRetention\")\n+  private boolean bypassGovernanceRetention;", "originalCommit": "b5c1c8038a7c2d02f53fdb792d5bdde725561cf3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTU3NDEwMA==", "url": "https://github.com/minio/minio-java/pull/836#discussion_r371574100", "bodyText": "Above two getters are not required", "author": "balamurugana", "createdAt": "2020-01-28T01:40:11Z", "path": "api/src/main/java/io/minio/messages/ObjectLockRetentionConfiguration.java", "diffHunk": "@@ -0,0 +1,84 @@\n+/*\n+ * MinIO Java SDK for Amazon S3 Compatible Cloud Storage, (C) 2020 MinIO, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.minio.messages;\n+\n+import org.xmlpull.v1.XmlPullParserException;\n+import io.minio.DateFormat;\n+import org.joda.time.DateTime;\n+import com.google.api.client.util.Key;\n+\n+\n+/**\n+ * Helper class to construct create bucket configuration request XML for Amazon AWS S3.\n+ */\n+@edu.umd.cs.findbugs.annotations.SuppressFBWarnings(value = \"URF_UNREAD_FIELD\")\n+public class ObjectLockRetentionConfiguration extends XmlEntity {\n+  @Key(\"ObjectRetention\")\n+  private ObjectLockRetention objectLockRetention;\n+  @Key(\"BypassGovernanceRetention\")\n+  private boolean bypassGovernanceRetention;\n+  @Key(\"Version\")\n+  private String versionId;\n+\n+  /**\n+   * Constructs a new ObjectLockRetentionConfiguration object with given input parameters.\n+   */\n+  public ObjectLockRetentionConfiguration(RetentionMode mode, boolean bypassGovernanceRetention, \n+      DateTime retainUntilDate, String versionId) throws XmlPullParserException {\n+    super();\n+    this.bypassGovernanceRetention = bypassGovernanceRetention;\n+    this.versionId = versionId ;\n+    this.objectLockRetention = new ObjectLockRetention(mode, \n+        retainUntilDate.toString(DateFormat.RETENTION_DATE_FORMAT));\n+  }\n+\n+\n+  /**\n+   * Returns mode.\n+   */\n+  public RetentionMode mode() {\n+    if (objectLockRetention == null) {\n+      return null;\n+    }    \n+    return objectLockRetention.mode();\n+  }\n+\n+ \n+  /**\n+   * Returns retantion untill date.\n+   */\n+  public DateTime retainUntil() {\n+    if (objectLockRetention == null) {\n+      return null;\n+    }\n+    return objectLockRetention.retainUntil();\n+  }\n+\n+  /**\n+   * Returns version.\n+   */\n+  public String version() { \n+    return this.versionId;\n+  }\n+\n+  /**\n+   * Returns boolean for governanceBypass.\n+   */\n+  public boolean governanceBypass() { \n+    return this.bypassGovernanceRetention;\n+  }", "originalCommit": "b5c1c8038a7c2d02f53fdb792d5bdde725561cf3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTU3NDM0MQ==", "url": "https://github.com/minio/minio-java/pull/836#discussion_r371574341", "bodyText": "retainUntilDate should be a DateTime object not string.", "author": "balamurugana", "createdAt": "2020-01-28T01:41:30Z", "path": "api/src/main/java/io/minio/messages/ObjectLockRetention.java", "diffHunk": "@@ -0,0 +1,79 @@\n+/*\n+ * MinIO Java SDK for Amazon S3 Compatible Cloud Storage, (C) 2020 MinIO, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.minio.messages;\n+\n+import org.xmlpull.v1.XmlPullParserException;\n+\n+import io.minio.DateFormat;\n+import java.util.Date;\n+import org.joda.time.DateTime;\n+import com.google.api.client.util.Key;\n+\n+/**\n+ * Helper class to parse Amazon AWS S3 response XML containing ObjectLockRetention information.\n+ */\n+@SuppressWarnings(\"SameParameterValue\")\n+public class ObjectLockRetention extends XmlEntity {\n+  @Key(\"Mode\")\n+  private String mode;\n+  @Key(\"RetainUntilDate\")\n+  private String  retainUntilDate;\n+\n+ /**\n+   * Constructs a new ObjectLockRetention object.\n+   */\n+  public ObjectLockRetention() throws XmlPullParserException {\n+    super();\n+    super.name = \"Retention\";\n+  }\n+\n+  /**\n+   * Constructs a new CustomRetention object with given retention.\n+   */\n+  public ObjectLockRetention(RetentionMode mode,  String retainUntilDate) throws XmlPullParserException {", "originalCommit": "b5c1c8038a7c2d02f53fdb792d5bdde725561cf3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTU3NDg2Mg==", "url": "https://github.com/minio/minio-java/pull/836#discussion_r371574862", "bodyText": "above two methods are same getter. You would need to remove getRetentionDate()", "author": "balamurugana", "createdAt": "2020-01-28T01:43:58Z", "path": "api/src/main/java/io/minio/messages/ObjectLockRetention.java", "diffHunk": "@@ -0,0 +1,79 @@\n+/*\n+ * MinIO Java SDK for Amazon S3 Compatible Cloud Storage, (C) 2020 MinIO, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.minio.messages;\n+\n+import org.xmlpull.v1.XmlPullParserException;\n+\n+import io.minio.DateFormat;\n+import java.util.Date;\n+import org.joda.time.DateTime;\n+import com.google.api.client.util.Key;\n+\n+/**\n+ * Helper class to parse Amazon AWS S3 response XML containing ObjectLockRetention information.\n+ */\n+@SuppressWarnings(\"SameParameterValue\")\n+public class ObjectLockRetention extends XmlEntity {\n+  @Key(\"Mode\")\n+  private String mode;\n+  @Key(\"RetainUntilDate\")\n+  private String  retainUntilDate;\n+\n+ /**\n+   * Constructs a new ObjectLockRetention object.\n+   */\n+  public ObjectLockRetention() throws XmlPullParserException {\n+    super();\n+    super.name = \"Retention\";\n+  }\n+\n+  /**\n+   * Constructs a new CustomRetention object with given retention.\n+   */\n+  public ObjectLockRetention(RetentionMode mode,  String retainUntilDate) throws XmlPullParserException {\n+    super();\n+    super.name = \"Retention\";\n+    if (mode != null) {\n+      this.mode = mode.toString();\n+    }\n+    if (retainUntilDate != null ) {\n+      this.retainUntilDate = retainUntilDate;\n+    }\n+  }\n+\n+  /**\n+   * Returns mode.\n+   */\n+  public RetentionMode mode() {\n+    return RetentionMode.fromString(mode);\n+  }\n+\n+  /**\n+   * Returns retain until date.\n+   */\n+  public DateTime retainUntil() {\n+    return DateFormat.RETENTION_DATE_FORMAT.parseDateTime(retainUntilDate);\n+  }\n+\n+  /**\n+   * Returns retain until date.\n+   */\n+  public Date getRetentionDate() {\n+    return DateFormat.RETENTION_DATE_FORMAT.parseDateTime(retainUntilDate).toDate();", "originalCommit": "b5c1c8038a7c2d02f53fdb792d5bdde725561cf3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTU3NTIwOA==", "url": "https://github.com/minio/minio-java/pull/836#discussion_r371575208", "bodyText": "I guess if retainUntilDate is null,  parseDateTime() may throw an exception which is not needed here. Please check and return null or DateTime", "author": "balamurugana", "createdAt": "2020-01-28T01:45:40Z", "path": "api/src/main/java/io/minio/messages/ObjectLockRetention.java", "diffHunk": "@@ -0,0 +1,79 @@\n+/*\n+ * MinIO Java SDK for Amazon S3 Compatible Cloud Storage, (C) 2020 MinIO, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.minio.messages;\n+\n+import org.xmlpull.v1.XmlPullParserException;\n+\n+import io.minio.DateFormat;\n+import java.util.Date;\n+import org.joda.time.DateTime;\n+import com.google.api.client.util.Key;\n+\n+/**\n+ * Helper class to parse Amazon AWS S3 response XML containing ObjectLockRetention information.\n+ */\n+@SuppressWarnings(\"SameParameterValue\")\n+public class ObjectLockRetention extends XmlEntity {\n+  @Key(\"Mode\")\n+  private String mode;\n+  @Key(\"RetainUntilDate\")\n+  private String  retainUntilDate;\n+\n+ /**\n+   * Constructs a new ObjectLockRetention object.\n+   */\n+  public ObjectLockRetention() throws XmlPullParserException {\n+    super();\n+    super.name = \"Retention\";\n+  }\n+\n+  /**\n+   * Constructs a new CustomRetention object with given retention.\n+   */\n+  public ObjectLockRetention(RetentionMode mode,  String retainUntilDate) throws XmlPullParserException {\n+    super();\n+    super.name = \"Retention\";\n+    if (mode != null) {\n+      this.mode = mode.toString();\n+    }\n+    if (retainUntilDate != null ) {\n+      this.retainUntilDate = retainUntilDate;\n+    }\n+  }\n+\n+  /**\n+   * Returns mode.\n+   */\n+  public RetentionMode mode() {\n+    return RetentionMode.fromString(mode);\n+  }\n+\n+  /**\n+   * Returns retain until date.\n+   */\n+  public DateTime retainUntil() {\n+    return DateFormat.RETENTION_DATE_FORMAT.parseDateTime(retainUntilDate);", "originalCommit": "b5c1c8038a7c2d02f53fdb792d5bdde725561cf3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTU3NTczNA==", "url": "https://github.com/minio/minio-java/pull/836#discussion_r371575734", "bodyText": "you already have EXPIRATION_DATE_FORMAT", "author": "balamurugana", "createdAt": "2020-01-28T01:48:07Z", "path": "api/src/main/java/io/minio/DateFormat.java", "diffHunk": "@@ -40,5 +40,8 @@\n   public static final DateTimeFormatter HTTP_HEADER_DATE_FORMAT =\n       DateTimeFormat.forPattern(\"EEE',' dd MMM yyyy HH':'mm':'ss 'GMT'\").withZoneUTC().withLocale(Locale.US);\n \n+  public static final DateTimeFormatter RETENTION_DATE_FORMAT =", "originalCommit": "b5c1c8038a7c2d02f53fdb792d5bdde725561cf3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTU3NzA2OA==", "url": "https://github.com/minio/minio-java/pull/836#discussion_r371577068", "bodyText": "We need to comply with S3 API names to avoid confusion i.e. setObjectRetention() and getObjectRetention().  Below are right signature as per the spec.\npublic void setObjectRetention(String bucketName, String objectName, String versionId, boolean bypassGovernanceRetention, ObjectRetentionConfiguration config)\npublic ObjectRetentionConfiguration getObjectRetention(String bucketName, String objectName, String versionId)", "author": "balamurugana", "createdAt": "2020-01-28T01:53:58Z", "path": "api/src/main/java/io/minio/MinioClient.java", "diffHunk": "@@ -3895,6 +3898,107 @@ public ObjectLockConfiguration getDefaultRetention(String bucketName)\n   }\n \n \n+  /**\n+   * Applies object retention lock onto an object.\n+   *\n+   * </p><b>Example:</b><br>\n+   * <pre>{@code minioClient.setObjectRetention(\"my-bucketname\", \"my-object\", config );\n+   * System.out.println(\"Set object retention on my-object successfully.\"); }</pre>\n+   *\n+   * @param bucketName Bucket name.\n+   * @param objectName Object name.\n+   * @param config     Object lock configuration.\n+   *\n+   * @throws InvalidBucketNameException  upon invalid bucket name is given\n+   * @throws NoSuchAlgorithmException\n+   *           upon requested algorithm was not found during signature calculation\n+   * @throws InsufficientDataException  upon getting EOFException while reading given\n+   *           InputStream even before reading given length\n+   * @throws IOException                 upon connection error\n+   * @throws InvalidKeyException\n+   *           upon an invalid access key or secret key\n+   * @throws NoResponseException         upon no response from server\n+   * @throws XmlPullParserException      upon parsing response xml\n+   * @throws ErrorResponseException      upon unsuccessful execution\n+   * @throws InternalException           upon internal library error\n+   * @throws InvalidResponseException    upon a non-xml response from server\n+   */\n+  public void setObjectLockRetention(String bucketName, String objectName, ObjectLockRetentionConfiguration config)", "originalCommit": "b5c1c8038a7c2d02f53fdb792d5bdde725561cf3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "3dbb3441c78ab783a57e59ba5169aafafe0401bb", "url": "https://github.com/minio/minio-java/commit/3dbb3441c78ab783a57e59ba5169aafafe0401bb", "message": "Add new method to set/get object retention", "committedDate": "2020-02-02T14:54:52Z", "type": "forcePushed"}, {"oid": "c6c316b1468f311fcefa47db710aad2274a0842f", "url": "https://github.com/minio/minio-java/commit/c6c316b1468f311fcefa47db710aad2274a0842f", "message": "Add new method to set/get object retention and legal hold", "committedDate": "2020-02-02T17:53:25Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzg3ODQxNA==", "url": "https://github.com/minio/minio-java/pull/836#discussion_r373878414", "bodyText": "Not a good approach to pass and remove headers or params for sake of checksum calculation. You could pass a flag from higher level calls whether MD5 checksum calculation is required or not. You could add this improvement and remove these nested if guesses.", "author": "balamurugana", "createdAt": "2020-02-02T21:55:07Z", "path": "api/src/main/java/io/minio/MinioClient.java", "diffHunk": "@@ -976,10 +978,15 @@ private Request createRequest(Method method, String bucketName, String objectNam\n           String[] hashes = Digest.sha256Md5Hashes(data, len);\n           sha256Hash = hashes[0];\n           md5Hash = hashes[1];\n-        } else if (method == Method.PUT && queryParamMap != null && queryParamMap.containsKey(\"lifecycle\")) {\n+        } else if (method == Method.PUT && queryParamMap != null &&  queryParamMap.containsKey(\"lifecycle\"))  {\n           String[] hashes = Digest.sha256Md5Hashes(data, len);\n           sha256Hash = hashes[0];\n           md5Hash = hashes[1];\n+        } else if (method == Method.PUT && headerMap.containsKey(\"retention\")) {\n+          String[] hashes = Digest.sha256Md5Hashes(data, len);\n+          sha256Hash = hashes[0];\n+          md5Hash = hashes[1];\n+          headerMap.remove(\"retention\",\"\");", "originalCommit": "c6c316b1468f311fcefa47db710aad2274a0842f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzg3ODkxNw==", "url": "https://github.com/minio/minio-java/pull/836#discussion_r373878917", "bodyText": "Treat null versionId as empty string to support minio server and add it into query param i.e.\nif (versionId == null) {\n  queryParamMap.put(\"versionId\", \"\");\n} else {\n  queryParamMap.put(\"versionId\", versionId);\n}", "author": "balamurugana", "createdAt": "2020-02-02T22:02:23Z", "path": "api/src/main/java/io/minio/MinioClient.java", "diffHunk": "@@ -3895,6 +3902,201 @@ public ObjectLockConfiguration getDefaultRetention(String bucketName)\n   }\n \n \n+  /**\n+   * Applies object retention lock onto an object.\n+   *\n+   * </p><b>Example:</b><br>\n+   * <pre>{@code minioClient.setObjectRetention(\"my-bucketname\", \"my-object\", config );\n+   * System.out.println(\"Set object retention on my-object successfully.\"); }</pre>\n+   *\n+   * @param bucketName Bucket name.\n+   * @param objectName Object name.\n+   * @param versionId  Object versio id.\n+   * @param bypassGovernanceRetention  By pass governance retention.\n+   * @param config     Object lock configuration.\n+   *\n+   * @throws InvalidBucketNameException  upon invalid bucket name is given\n+   * @throws NoSuchAlgorithmException\n+   *           upon requested algorithm was not found during signature calculation\n+   * @throws InsufficientDataException  upon getting EOFException while reading given\n+   *           InputStream even before reading given length\n+   * @throws IOException                 upon connection error\n+   * @throws InvalidKeyException\n+   *           upon an invalid access key or secret key\n+   * @throws NoResponseException         upon no response from server\n+   * @throws XmlPullParserException      upon parsing response xml\n+   * @throws ErrorResponseException      upon unsuccessful execution\n+   * @throws InternalException           upon internal library error\n+   * @throws InvalidResponseException    upon a non-xml response from server\n+   */\n+  public void setObjectRetention(String bucketName, String objectName, String versionId, \n+          boolean bypassGovernanceRetention, ObjectRetentionConfiguration config)\n+    throws InvalidBucketNameException, NoSuchAlgorithmException, InsufficientDataException, IOException,\n+           InvalidKeyException, NoResponseException, XmlPullParserException, ErrorResponseException,\n+           InternalException, InvalidResponseException {\n+\n+    Map<String, String> queryParamMap = new HashMap<>();\n+    queryParamMap.put(\"retention\", \"\");\n+\n+    if (!versionId.isEmpty()) {\n+      queryParamMap.put(\"versionId\", versionId);\n+    }", "originalCommit": "c6c316b1468f311fcefa47db710aad2274a0842f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTc0NzY5Ng==", "url": "https://github.com/minio/minio-java/pull/836#discussion_r375747696", "bodyText": "You have to use this logic in all methods accepting versionId", "author": "balamurugana", "createdAt": "2020-02-06T10:16:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzg3ODkxNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzg3ODk4OA==", "url": "https://github.com/minio/minio-java/pull/836#discussion_r373878988", "bodyText": "move this boolean as last param looks like its optional.", "author": "balamurugana", "createdAt": "2020-02-02T22:03:36Z", "path": "api/src/main/java/io/minio/MinioClient.java", "diffHunk": "@@ -3895,6 +3902,201 @@ public ObjectLockConfiguration getDefaultRetention(String bucketName)\n   }\n \n \n+  /**\n+   * Applies object retention lock onto an object.\n+   *\n+   * </p><b>Example:</b><br>\n+   * <pre>{@code minioClient.setObjectRetention(\"my-bucketname\", \"my-object\", config );\n+   * System.out.println(\"Set object retention on my-object successfully.\"); }</pre>\n+   *\n+   * @param bucketName Bucket name.\n+   * @param objectName Object name.\n+   * @param versionId  Object versio id.\n+   * @param bypassGovernanceRetention  By pass governance retention.\n+   * @param config     Object lock configuration.\n+   *\n+   * @throws InvalidBucketNameException  upon invalid bucket name is given\n+   * @throws NoSuchAlgorithmException\n+   *           upon requested algorithm was not found during signature calculation\n+   * @throws InsufficientDataException  upon getting EOFException while reading given\n+   *           InputStream even before reading given length\n+   * @throws IOException                 upon connection error\n+   * @throws InvalidKeyException\n+   *           upon an invalid access key or secret key\n+   * @throws NoResponseException         upon no response from server\n+   * @throws XmlPullParserException      upon parsing response xml\n+   * @throws ErrorResponseException      upon unsuccessful execution\n+   * @throws InternalException           upon internal library error\n+   * @throws InvalidResponseException    upon a non-xml response from server\n+   */\n+  public void setObjectRetention(String bucketName, String objectName, String versionId, \n+          boolean bypassGovernanceRetention, ObjectRetentionConfiguration config)", "originalCommit": "c6c316b1468f311fcefa47db710aad2274a0842f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzg3OTM2MQ==", "url": "https://github.com/minio/minio-java/pull/836#discussion_r373879361", "bodyText": "config must be non-null and Mode and RetainUntilDate are mandatory configuration. You would need to add this validation properly.", "author": "balamurugana", "createdAt": "2020-02-02T22:08:53Z", "path": "api/src/main/java/io/minio/MinioClient.java", "diffHunk": "@@ -3895,6 +3902,201 @@ public ObjectLockConfiguration getDefaultRetention(String bucketName)\n   }\n \n \n+  /**\n+   * Applies object retention lock onto an object.\n+   *\n+   * </p><b>Example:</b><br>\n+   * <pre>{@code minioClient.setObjectRetention(\"my-bucketname\", \"my-object\", config );\n+   * System.out.println(\"Set object retention on my-object successfully.\"); }</pre>\n+   *\n+   * @param bucketName Bucket name.\n+   * @param objectName Object name.\n+   * @param versionId  Object versio id.\n+   * @param bypassGovernanceRetention  By pass governance retention.\n+   * @param config     Object lock configuration.\n+   *\n+   * @throws InvalidBucketNameException  upon invalid bucket name is given\n+   * @throws NoSuchAlgorithmException\n+   *           upon requested algorithm was not found during signature calculation\n+   * @throws InsufficientDataException  upon getting EOFException while reading given\n+   *           InputStream even before reading given length\n+   * @throws IOException                 upon connection error\n+   * @throws InvalidKeyException\n+   *           upon an invalid access key or secret key\n+   * @throws NoResponseException         upon no response from server\n+   * @throws XmlPullParserException      upon parsing response xml\n+   * @throws ErrorResponseException      upon unsuccessful execution\n+   * @throws InternalException           upon internal library error\n+   * @throws InvalidResponseException    upon a non-xml response from server\n+   */\n+  public void setObjectRetention(String bucketName, String objectName, String versionId, \n+          boolean bypassGovernanceRetention, ObjectRetentionConfiguration config)\n+    throws InvalidBucketNameException, NoSuchAlgorithmException, InsufficientDataException, IOException,\n+           InvalidKeyException, NoResponseException, XmlPullParserException, ErrorResponseException,\n+           InternalException, InvalidResponseException {\n+\n+    Map<String, String> queryParamMap = new HashMap<>();\n+    queryParamMap.put(\"retention\", \"\");\n+\n+    if (!versionId.isEmpty()) {\n+      queryParamMap.put(\"versionId\", versionId);\n+    }\n+\n+    Map<String, String> headerMap = new HashMap<>();\n+    if (bypassGovernanceRetention) {\n+      headerMap.put(\"x-amz-bypass-governance-retention\", \"True\");\n+    }\n+\n+    HttpResponse response = executePut(bucketName, objectName, headerMap, queryParamMap, config, 0);", "originalCommit": "c6c316b1468f311fcefa47db710aad2274a0842f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzg4MTQ0MQ==", "url": "https://github.com/minio/minio-java/pull/836#discussion_r373881441", "bodyText": "You would need to have below more friendlier APIs than boolean flag\npublic void enableObjectLegalHold(String bucketName, String objectName, String versionId)\npublic void disableObjectLegalHold(String bucketName, String objectName, String versionId)\npublic boolean isObjectLegalHoldEnabled(String bucketName, String objectName, String versionId)", "author": "balamurugana", "createdAt": "2020-02-02T22:39:00Z", "path": "api/src/main/java/io/minio/MinioClient.java", "diffHunk": "@@ -3895,6 +3902,201 @@ public ObjectLockConfiguration getDefaultRetention(String bucketName)\n   }\n \n \n+  /**\n+   * Applies object retention lock onto an object.\n+   *\n+   * </p><b>Example:</b><br>\n+   * <pre>{@code minioClient.setObjectRetention(\"my-bucketname\", \"my-object\", config );\n+   * System.out.println(\"Set object retention on my-object successfully.\"); }</pre>\n+   *\n+   * @param bucketName Bucket name.\n+   * @param objectName Object name.\n+   * @param versionId  Object versio id.\n+   * @param bypassGovernanceRetention  By pass governance retention.\n+   * @param config     Object lock configuration.\n+   *\n+   * @throws InvalidBucketNameException  upon invalid bucket name is given\n+   * @throws NoSuchAlgorithmException\n+   *           upon requested algorithm was not found during signature calculation\n+   * @throws InsufficientDataException  upon getting EOFException while reading given\n+   *           InputStream even before reading given length\n+   * @throws IOException                 upon connection error\n+   * @throws InvalidKeyException\n+   *           upon an invalid access key or secret key\n+   * @throws NoResponseException         upon no response from server\n+   * @throws XmlPullParserException      upon parsing response xml\n+   * @throws ErrorResponseException      upon unsuccessful execution\n+   * @throws InternalException           upon internal library error\n+   * @throws InvalidResponseException    upon a non-xml response from server\n+   */\n+  public void setObjectRetention(String bucketName, String objectName, String versionId, \n+          boolean bypassGovernanceRetention, ObjectRetentionConfiguration config)\n+    throws InvalidBucketNameException, NoSuchAlgorithmException, InsufficientDataException, IOException,\n+           InvalidKeyException, NoResponseException, XmlPullParserException, ErrorResponseException,\n+           InternalException, InvalidResponseException {\n+\n+    Map<String, String> queryParamMap = new HashMap<>();\n+    queryParamMap.put(\"retention\", \"\");\n+\n+    if (!versionId.isEmpty()) {\n+      queryParamMap.put(\"versionId\", versionId);\n+    }\n+\n+    Map<String, String> headerMap = new HashMap<>();\n+    if (bypassGovernanceRetention) {\n+      headerMap.put(\"x-amz-bypass-governance-retention\", \"True\");\n+    }\n+\n+    HttpResponse response = executePut(bucketName, objectName, headerMap, queryParamMap, config, 0);\n+    response.body().close();\n+  }\n+\n+  /**\n+   * Fetches object retention lock of an object.\n+   *\n+   * </p><b>Example:</b><br>\n+   * <pre>{@code\n+   * ObjectRetentionConfiguration objectRetentionConfiguration = minioClient.getObjectRetention(\"my-bucketname\", \n+   * \"my-object\", \"version-Id\" );\n+   * System.out.println(\"Mode \" + objectRetentionConfiguration.mode()); \n+   * System.out.println(\"Retanetion Until  \" + objectRetentionConfiguration.getRetentionDate()); }</pre>\n+   *\n+   * @param bucketName Bucket name.\n+   * @param objectName Object name.\n+   * @param versionId  Version Id.\n+   *\n+   * @throws InvalidBucketNameException  upon invalid bucket name is given\n+   * @throws NoSuchAlgorithmException\n+   *           upon requested algorithm was not found during signature calculation\n+   * @throws InsufficientDataException  upon getting EOFException while reading given\n+   *           InputStream even before reading given length\n+   * @throws IOException                 upon connection error\n+   * @throws InvalidKeyException\n+   *           upon an invalid access key or secret key\n+   * @throws NoResponseException         upon no response from server\n+   * @throws XmlPullParserException      upon parsing response xml\n+   * @throws ErrorResponseException      upon unsuccessful execution\n+   * @throws InternalException           upon internal library error\n+   * @throws InvalidResponseException    upon a non-xml response from server\n+   */\n+  public ObjectRetentionConfiguration getObjectRetention(String bucketName, String objectName, String versionId)\n+    throws InvalidBucketNameException, NoSuchAlgorithmException, InsufficientDataException, IOException,\n+           InvalidKeyException, NoResponseException, XmlPullParserException, ErrorResponseException,\n+           InternalException, InvalidResponseException {\n+\n+    Map<String, String> queryParamMap = new HashMap<>();\n+    queryParamMap.put(\"retention\", \"\");\n+\n+    if ( !(versionId == null || versionId.isEmpty())) {\n+      queryParamMap.put(\"versionId\",versionId);\n+    }\n+\n+    HttpResponse response = executeGet(bucketName, objectName, null, queryParamMap);\n+    ObjectRetentionConfiguration result = new ObjectRetentionConfiguration();\n+    try {\n+      result.parseXml(response.body().charStream());\n+    } finally {\n+      response.body().close();\n+    }\n+    return result;\n+  }\n+\n+\n+ \n+  \n+   /**\n+   * Applies object legal hold on an object.\n+   *\n+   * </p><b>Example:</b><br>\n+   * <pre>{@code minioClient.setObjectLegalHold(\"my-bucketname\", \"my-object\", \"\", true );\n+   * System.out.println(\"Legal Hold set on my-object successfully.\"); }</pre>\n+   *\n+   * @param bucketName Bucket name.\n+   * @param objectName Object name.\n+   * @param versionId  Object versio id.   * \n+   * @param legalHold  Legal Hold Status\n+   *\n+   * @throws InvalidBucketNameException  upon invalid bucket name is given\n+   * @throws NoSuchAlgorithmException\n+   *           upon requested algorithm was not found during signature calculation\n+   * @throws InsufficientDataException  upon getting EOFException while reading given\n+   *           InputStream even before reading given length\n+   * @throws IOException                 upon connection error\n+   * @throws InvalidKeyException\n+   *           upon an invalid access key or secret key\n+   * @throws NoResponseException         upon no response from server\n+   * @throws XmlPullParserException      upon parsing response xml\n+   * @throws ErrorResponseException      upon unsuccessful execution\n+   * @throws InternalException           upon internal library error\n+   * @throws InvalidResponseException    upon a non-xml response from server\n+   */\n+  public void setObjectLegalHold(String bucketName, String objectName, String versionId, \n+          boolean legalHold)", "originalCommit": "c6c316b1468f311fcefa47db710aad2274a0842f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzg4MjUxNw==", "url": "https://github.com/minio/minio-java/pull/836#discussion_r373882517", "bodyText": "You need to retrurn boolean depending on status; not string", "author": "balamurugana", "createdAt": "2020-02-02T22:55:42Z", "path": "api/src/main/java/io/minio/messages/ObjectLockLegalHold.java", "diffHunk": "@@ -0,0 +1,58 @@\n+/*\n+ * MinIO Java SDK for Amazon S3 Compatible Cloud Storage, (C) 2020 MinIO, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.minio.messages;\n+\n+import org.xmlpull.v1.XmlPullParserException;\n+import com.google.api.client.util.Key;\n+\n+\n+/**\n+ * Helper class to construct create bucket configuration request XML for Amazon AWS S3.\n+ */\n+@edu.umd.cs.findbugs.annotations.SuppressFBWarnings(value = \"URF_UNREAD_FIELD\")\n+public class ObjectLockLegalHold extends XmlEntity{\n+  @Key(\"Status\")\n+  private String status;\n+\n+  /**\n+   * Constructs a new CustomRetention object with given retention.\n+   */\n+  public ObjectLockLegalHold() throws XmlPullParserException {\n+    super();\n+    super.name = \"LegalHold\";\n+  }\n+\n+  /**\n+   * Constructs a new CustomRetention object with given retention.\n+   */\n+  public ObjectLockLegalHold(boolean legalHold) throws  XmlPullParserException {\n+    super();\n+    super.name = \"LegalHold\";\n+    if (legalHold) {\n+      this.status = \"ON\";\n+    } else {\n+      this.status = \"OFF\";\n+    }\n+  }\n+\n+  /**\n+   * Indicates whether the specified object has a Legal Hold in place.\n+   */\n+  public String getStatus() {\n+    return status;", "originalCommit": "c6c316b1468f311fcefa47db710aad2274a0842f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzg4Mjc4MQ==", "url": "https://github.com/minio/minio-java/pull/836#discussion_r373882781", "bodyText": "Two things you can do at the time of put object.\n\nretention (Mode and RetainUntilDate are required)\nlegal hold (boolean to say ON or OFF)\n\nYou could send these changes in put object as separate PR.", "author": "balamurugana", "createdAt": "2020-02-02T22:59:51Z", "path": "api/src/main/java/io/minio/MinioClient.java", "diffHunk": "@@ -4711,6 +4961,92 @@ public void putObject(String bucketName, String objectName, InputStream stream,\n     if (!(stream instanceof BufferedInputStream)) {\n       stream = new BufferedInputStream(stream);\n     }\n+    putObject(bucketName, objectName, stream, size, headerMap, sse, contentType, false);\n+  }\n+\n+    /**\n+   * Uploads data from given stream as object to given bucket where the stream size is unknown.\n+   * <p>\n+   * If the stream has more than 525MiB data, the client uses a multipart session automatically.\n+   * </p>\n+   * <p>\n+   * If the session fails, the user may attempt to re-upload the object by attempting to create\n+   * the exact same object again.\n+   * </p>\n+   * <p>\n+   * If the multipart session fails, we abort the uploaded parts automaticlly.\n+   * </p>\n+   *\n+   * </p><b>Example:</b><br>\n+   * <pre>{@code StringBuilder builder = new StringBuilder();\n+   * for (int i = 0; i < 1000; i++) {\n+   *   builder.append(\"Sphinx of black quartz, judge my vow: Used by Adobe InDesign to display font samples. \");\n+   *   builder.append(\"(29 letters)\\n\");\n+   *   builder.append(\"Jackdaws love my big sphinx of quartz: Similarly, used by Windows XP for some fonts. \");\n+   *   builder.append(\"(31 letters)\\n\"); \n+   *   builder.append(\"Pack my box with five dozen liquor jugs: According to Wikipedia, this one is used on \");\n+   *   builder.append(\"NASAs Space Shuttle. (32 letters)\\n\");\n+   *   builder.append(\"The quick onyx goblin jumps over the lazy dwarf: Flavor text from an Unhinged Magic Card. \");\n+   *   builder.append(\"(39 letters)\\n\");\n+   *   builder.append(\"How razorback-jumping frogs can level six piqued gymnasts!: Not going to win any brevity \");\n+   *   builder.append(\"awards at 49 letters long, but old-time Mac users may recognize it.\\n\");\n+   *   builder.append(\"Cozy lummox gives smart squid who asks for job pen: A 41-letter tester sentence for Mac \");\n+   *   builder.append(\"computers after System 7.\\n\");\n+   *   builder.append(\"A few others we like: Amazingly few discotheques provide jukeboxes; Now fax quiz Jack! my \");\n+   *   builder.append(\"brave ghost pled; Watch Jeopardy!, Alex Trebeks fun TV quiz game.\\n\");\n+   *   builder.append(\"---\\n\");\n+   * }\n+   * ByteArrayInputStream bais = new ByteArrayInputStream(builder.toString().getBytes(\"UTF-8\"));\n+   * // create object\n+   * Map<String, String> headerMap = new HashMap<>();\n+   * headerMap.put(\"Content-Type\", \"application/octet-stream\");\n+   * headerMap.put(\"X-Amz-Meta-Key\", \"meta-data\");\n+\n+   * //Generate symmetric 256 bit AES key.\n+   * KeyGenerator symKeyGenerator = KeyGenerator.getInstance(\"AES\");\n+   * symKeyGenerator.init(256);\n+   * SecretKey symKey = symKeyGenerator.generateKey();\n+\n+   * minioClient.putObject(\"my-bucketname\", \"my-objectname\", bais, bais.available(), headerMap, symKey);\n+   * bais.close();\n+   * System.out.println(\"my-objectname is uploaded successfully\"); }</pre>\n+   *\n+   * @param bucketName  Bucket name.\n+   * @param objectName  Object name to create in the bucket.\n+   * @param stream      stream to upload.\n+   * @param size        Size of all the data that will be uploaded.\n+   * @param headerMap   Custom/additional meta data of the object.\n+   * @param sse         encryption metadata.\n+   * @param contentType Content type of the stream.\n+   * @param objectLockRetention Objecct Lock Retention.\n+   *\n+   * @throws InvalidBucketNameException  upon invalid bucket name is given\n+   * @throws NoSuchAlgorithmException\n+   *           upon requested algorithm was not found during signature calculation\n+   * @throws InsufficientDataException  upon getting EOFException while reading given\n+   *           InputStream even before reading given length\n+   * @throws IOException                 upon connection error\n+   * @throws InvalidKeyException\n+   *           upon an invalid access key or secret key\n+   * @throws NoResponseException         upon no response from server\n+   * @throws XmlPullParserException      upon parsing response xml\n+   * @throws ErrorResponseException      upon unsuccessful execution\n+   * @throws InternalException           upon internal library error\n+   * @throws InvalidArgumentException    upon invalid value is passed to a method.\n+   * @throws InvalidResponseException    upon a non-xml response from server\n+   */\n+  public void putObject(String bucketName, String objectName, InputStream stream, Long size, \n+              Map<String, String> headerMap, ServerSideEncryption sse, String contentType, boolean objectLockRetention)\n+    throws InvalidBucketNameException, NoSuchAlgorithmException, IOException,\n+           InvalidKeyException, NoResponseException, XmlPullParserException, ErrorResponseException,\n+           InternalException, InvalidArgumentException, InsufficientDataException, InvalidResponseException {\n+\n+    if (!(stream instanceof BufferedInputStream)) {\n+      stream = new BufferedInputStream(stream);\n+    }\n+    if (objectLockRetention) {\n+      headerMap.put(\"retention\",\"\");", "originalCommit": "c6c316b1468f311fcefa47db710aad2274a0842f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTY1OTQzMg==", "url": "https://github.com/minio/minio-java/pull/836#discussion_r375659432", "bodyText": "Will send a separate PR for this", "author": "sinhaashish", "createdAt": "2020-02-06T06:28:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzg4Mjc4MQ=="}], "type": "inlineReview"}, {"oid": "5926cc828236cfe806811c655c326dd8e3eea0a5", "url": "https://github.com/minio/minio-java/commit/5926cc828236cfe806811c655c326dd8e3eea0a5", "message": "Add argument to calculate md5 id needed", "committedDate": "2020-02-06T06:12:52Z", "type": "forcePushed"}, {"oid": "47d23dadea2d6921f465528d127e415dcc59f3e7", "url": "https://github.com/minio/minio-java/commit/47d23dadea2d6921f465528d127e415dcc59f3e7", "message": "Add argument to calculate md5 if needed", "committedDate": "2020-02-06T06:20:42Z", "type": "forcePushed"}, {"oid": "e6668cb46d60ea71909f9f868261a73b69cd7d58", "url": "https://github.com/minio/minio-java/commit/e6668cb46d60ea71909f9f868261a73b69cd7d58", "message": "Add argument to calculate md5 if needed", "committedDate": "2020-02-06T06:23:14Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTcyMzgyNA==", "url": "https://github.com/minio/minio-java/pull/836#discussion_r375723824", "bodyText": "Remove RETENTION_DATE_FORMAT and use EXPIRATION_DATE_FORMAT directly", "author": "balamurugana", "createdAt": "2020-02-06T09:29:49Z", "path": "api/src/main/java/io/minio/DateFormat.java", "diffHunk": "@@ -40,5 +40,7 @@\n   public static final DateTimeFormatter HTTP_HEADER_DATE_FORMAT =\n       DateTimeFormat.forPattern(\"EEE',' dd MMM yyyy HH':'mm':'ss 'GMT'\").withZoneUTC().withLocale(Locale.US);\n \n+  public static final DateTimeFormatter RETENTION_DATE_FORMAT = EXPIRATION_DATE_FORMAT;   ", "originalCommit": "e6668cb46d60ea71909f9f868261a73b69cd7d58", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTc0MDI1OQ==", "url": "https://github.com/minio/minio-java/pull/836#discussion_r375740259", "bodyText": "have status(), not getStatus()\nI don't see javadoc of Boolean parses \"ON\"/\"OFF\" string. Are you sure it works?\nReturn boolean not Boolean", "author": "balamurugana", "createdAt": "2020-02-06T10:01:19Z", "path": "api/src/main/java/io/minio/messages/ObjectLockLegalHold.java", "diffHunk": "@@ -0,0 +1,58 @@\n+/*\n+ * MinIO Java SDK for Amazon S3 Compatible Cloud Storage, (C) 2020 MinIO, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.minio.messages;\n+\n+import org.xmlpull.v1.XmlPullParserException;\n+import com.google.api.client.util.Key;\n+\n+\n+/**\n+ * Helper class to construct create bucket configuration request XML for Amazon AWS S3.\n+ */\n+@edu.umd.cs.findbugs.annotations.SuppressFBWarnings(value = \"URF_UNREAD_FIELD\")\n+public class ObjectLockLegalHold extends XmlEntity{\n+  @Key(\"Status\")\n+  private String status;\n+\n+  /**\n+   * Constructs a new CustomRetention object with given retention.\n+   */\n+  public ObjectLockLegalHold() throws XmlPullParserException {\n+    super();\n+    super.name = \"LegalHold\";\n+  }\n+\n+  /**\n+   * Constructs a new CustomRetention object with given retention.\n+   */\n+  public ObjectLockLegalHold(boolean legalHold) throws  XmlPullParserException {\n+    super();\n+    super.name = \"LegalHold\";\n+    if (legalHold) {\n+      this.status = \"ON\";\n+    } else {\n+      this.status = \"OFF\";\n+    }\n+  }\n+\n+  /**\n+   * Indicates whether the specified object has a Legal Hold in place or not.\n+   */\n+  public Boolean getStatus() {\n+    return Boolean.parseBoolean(status);", "originalCommit": "e6668cb46d60ea71909f9f868261a73b69cd7d58", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTc0MTA2Mg==", "url": "https://github.com/minio/minio-java/pull/836#discussion_r375741062", "bodyText": "argument is status not legalHold", "author": "balamurugana", "createdAt": "2020-02-06T10:02:50Z", "path": "api/src/main/java/io/minio/messages/ObjectLockLegalHold.java", "diffHunk": "@@ -0,0 +1,58 @@\n+/*\n+ * MinIO Java SDK for Amazon S3 Compatible Cloud Storage, (C) 2020 MinIO, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.minio.messages;\n+\n+import org.xmlpull.v1.XmlPullParserException;\n+import com.google.api.client.util.Key;\n+\n+\n+/**\n+ * Helper class to construct create bucket configuration request XML for Amazon AWS S3.\n+ */\n+@edu.umd.cs.findbugs.annotations.SuppressFBWarnings(value = \"URF_UNREAD_FIELD\")\n+public class ObjectLockLegalHold extends XmlEntity{\n+  @Key(\"Status\")\n+  private String status;\n+\n+  /**\n+   * Constructs a new CustomRetention object with given retention.\n+   */\n+  public ObjectLockLegalHold() throws XmlPullParserException {\n+    super();\n+    super.name = \"LegalHold\";\n+  }\n+\n+  /**\n+   * Constructs a new CustomRetention object with given retention.\n+   */\n+  public ObjectLockLegalHold(boolean legalHold) throws  XmlPullParserException {", "originalCommit": "e6668cb46d60ea71909f9f868261a73b69cd7d58", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTc0MTYyNw==", "url": "https://github.com/minio/minio-java/pull/836#discussion_r375741627", "bodyText": "call this() than repeating these two lines", "author": "balamurugana", "createdAt": "2020-02-06T10:03:56Z", "path": "api/src/main/java/io/minio/messages/ObjectRetentionConfiguration.java", "diffHunk": "@@ -0,0 +1,80 @@\n+/*\n+ * MinIO Java SDK for Amazon S3 Compatible Cloud Storage, (C) 2020 MinIO, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.minio.messages;\n+\n+import org.xmlpull.v1.XmlPullParserException;\n+\n+import io.minio.DateFormat;\n+import java.util.Date;\n+import org.joda.time.DateTime;\n+import com.google.api.client.util.Key;\n+import io.minio.errors.InvalidArgumentException;\n+\n+/**\n+ * Helper class to parse Amazon AWS S3 response XML containing ObjectLockRetention information.\n+ */\n+@SuppressWarnings(\"SameParameterValue\")\n+public class ObjectRetentionConfiguration extends XmlEntity {\n+  @Key(\"Mode\")\n+  private String mode;\n+  @Key(\"RetainUntilDate\")\n+  private String retainUntilDate;\n+\n+ /**\n+   * Constructs a new ObjectLockRetention object.\n+   */\n+  public ObjectRetentionConfiguration() throws XmlPullParserException {\n+    super();\n+    super.name = \"Retention\";\n+  }\n+\n+  /**\n+   * Constructs a new CustomRetention object with given retention.\n+   */\n+  public ObjectRetentionConfiguration(RetentionMode mode,  DateTime retainUntilDate) throws XmlPullParserException,\n+          InvalidArgumentException {\n+    super();\n+    super.name = \"Retention\";", "originalCommit": "e6668cb46d60ea71909f9f868261a73b69cd7d58", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTc0MTk1Mw==", "url": "https://github.com/minio/minio-java/pull/836#discussion_r375741953", "bodyText": "use this() and don't repeat logic", "author": "balamurugana", "createdAt": "2020-02-06T10:04:38Z", "path": "api/src/main/java/io/minio/messages/ObjectLockLegalHold.java", "diffHunk": "@@ -0,0 +1,58 @@\n+/*\n+ * MinIO Java SDK for Amazon S3 Compatible Cloud Storage, (C) 2020 MinIO, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.minio.messages;\n+\n+import org.xmlpull.v1.XmlPullParserException;\n+import com.google.api.client.util.Key;\n+\n+\n+/**\n+ * Helper class to construct create bucket configuration request XML for Amazon AWS S3.\n+ */\n+@edu.umd.cs.findbugs.annotations.SuppressFBWarnings(value = \"URF_UNREAD_FIELD\")\n+public class ObjectLockLegalHold extends XmlEntity{\n+  @Key(\"Status\")\n+  private String status;\n+\n+  /**\n+   * Constructs a new CustomRetention object with given retention.\n+   */\n+  public ObjectLockLegalHold() throws XmlPullParserException {\n+    super();\n+    super.name = \"LegalHold\";\n+  }\n+\n+  /**\n+   * Constructs a new CustomRetention object with given retention.\n+   */\n+  public ObjectLockLegalHold(boolean legalHold) throws  XmlPullParserException {\n+    super();\n+    super.name = \"LegalHold\";", "originalCommit": "e6668cb46d60ea71909f9f868261a73b69cd7d58", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTc0MjU3MA==", "url": "https://github.com/minio/minio-java/pull/836#discussion_r375742570", "bodyText": "change error message as null mode is not allowed", "author": "balamurugana", "createdAt": "2020-02-06T10:05:56Z", "path": "api/src/main/java/io/minio/messages/ObjectRetentionConfiguration.java", "diffHunk": "@@ -0,0 +1,80 @@\n+/*\n+ * MinIO Java SDK for Amazon S3 Compatible Cloud Storage, (C) 2020 MinIO, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.minio.messages;\n+\n+import org.xmlpull.v1.XmlPullParserException;\n+\n+import io.minio.DateFormat;\n+import java.util.Date;\n+import org.joda.time.DateTime;\n+import com.google.api.client.util.Key;\n+import io.minio.errors.InvalidArgumentException;\n+\n+/**\n+ * Helper class to parse Amazon AWS S3 response XML containing ObjectLockRetention information.\n+ */\n+@SuppressWarnings(\"SameParameterValue\")\n+public class ObjectRetentionConfiguration extends XmlEntity {\n+  @Key(\"Mode\")\n+  private String mode;\n+  @Key(\"RetainUntilDate\")\n+  private String retainUntilDate;\n+\n+ /**\n+   * Constructs a new ObjectLockRetention object.\n+   */\n+  public ObjectRetentionConfiguration() throws XmlPullParserException {\n+    super();\n+    super.name = \"Retention\";\n+  }\n+\n+  /**\n+   * Constructs a new CustomRetention object with given retention.\n+   */\n+  public ObjectRetentionConfiguration(RetentionMode mode,  DateTime retainUntilDate) throws XmlPullParserException,\n+          InvalidArgumentException {\n+    super();\n+    super.name = \"Retention\";\n+    if (mode == null) {\n+      throw new InvalidArgumentException(\"null is not allowed in mode. Valid values are 'COMPLIANCE' and 'GOVERNANCE'\");", "originalCommit": "e6668cb46d60ea71909f9f868261a73b69cd7d58", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTc0MzEwNA==", "url": "https://github.com/minio/minio-java/pull/836#discussion_r375743104", "bodyText": "change error message as null retainUntilDate is not allowed", "author": "balamurugana", "createdAt": "2020-02-06T10:07:01Z", "path": "api/src/main/java/io/minio/messages/ObjectRetentionConfiguration.java", "diffHunk": "@@ -0,0 +1,80 @@\n+/*\n+ * MinIO Java SDK for Amazon S3 Compatible Cloud Storage, (C) 2020 MinIO, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.minio.messages;\n+\n+import org.xmlpull.v1.XmlPullParserException;\n+\n+import io.minio.DateFormat;\n+import java.util.Date;\n+import org.joda.time.DateTime;\n+import com.google.api.client.util.Key;\n+import io.minio.errors.InvalidArgumentException;\n+\n+/**\n+ * Helper class to parse Amazon AWS S3 response XML containing ObjectLockRetention information.\n+ */\n+@SuppressWarnings(\"SameParameterValue\")\n+public class ObjectRetentionConfiguration extends XmlEntity {\n+  @Key(\"Mode\")\n+  private String mode;\n+  @Key(\"RetainUntilDate\")\n+  private String retainUntilDate;\n+\n+ /**\n+   * Constructs a new ObjectLockRetention object.\n+   */\n+  public ObjectRetentionConfiguration() throws XmlPullParserException {\n+    super();\n+    super.name = \"Retention\";\n+  }\n+\n+  /**\n+   * Constructs a new CustomRetention object with given retention.\n+   */\n+  public ObjectRetentionConfiguration(RetentionMode mode,  DateTime retainUntilDate) throws XmlPullParserException,\n+          InvalidArgumentException {\n+    super();\n+    super.name = \"Retention\";\n+    if (mode == null) {\n+      throw new InvalidArgumentException(\"null is not allowed in mode. Valid values are 'COMPLIANCE' and 'GOVERNANCE'\");\n+    }\n+    this.mode = mode.toString();\n+    if (retainUntilDate == null) {\n+      throw new InvalidArgumentException(\"retain until date cant be null, it must be a valid date.\");", "originalCommit": "e6668cb46d60ea71909f9f868261a73b69cd7d58", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTc0Mzk0Nw==", "url": "https://github.com/minio/minio-java/pull/836#discussion_r375743947", "bodyText": "Method name should be same as member field retainUntilDate() and return DateTime not Date i.e. should be same as argument type in the constructor", "author": "balamurugana", "createdAt": "2020-02-06T10:08:45Z", "path": "api/src/main/java/io/minio/messages/ObjectRetentionConfiguration.java", "diffHunk": "@@ -0,0 +1,80 @@\n+/*\n+ * MinIO Java SDK for Amazon S3 Compatible Cloud Storage, (C) 2020 MinIO, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.minio.messages;\n+\n+import org.xmlpull.v1.XmlPullParserException;\n+\n+import io.minio.DateFormat;\n+import java.util.Date;\n+import org.joda.time.DateTime;\n+import com.google.api.client.util.Key;\n+import io.minio.errors.InvalidArgumentException;\n+\n+/**\n+ * Helper class to parse Amazon AWS S3 response XML containing ObjectLockRetention information.\n+ */\n+@SuppressWarnings(\"SameParameterValue\")\n+public class ObjectRetentionConfiguration extends XmlEntity {\n+  @Key(\"Mode\")\n+  private String mode;\n+  @Key(\"RetainUntilDate\")\n+  private String retainUntilDate;\n+\n+ /**\n+   * Constructs a new ObjectLockRetention object.\n+   */\n+  public ObjectRetentionConfiguration() throws XmlPullParserException {\n+    super();\n+    super.name = \"Retention\";\n+  }\n+\n+  /**\n+   * Constructs a new CustomRetention object with given retention.\n+   */\n+  public ObjectRetentionConfiguration(RetentionMode mode,  DateTime retainUntilDate) throws XmlPullParserException,\n+          InvalidArgumentException {\n+    super();\n+    super.name = \"Retention\";\n+    if (mode == null) {\n+      throw new InvalidArgumentException(\"null is not allowed in mode. Valid values are 'COMPLIANCE' and 'GOVERNANCE'\");\n+    }\n+    this.mode = mode.toString();\n+    if (retainUntilDate == null) {\n+      throw new InvalidArgumentException(\"retain until date cant be null, it must be a valid date.\");\n+    }\n+    \n+    this.retainUntilDate = retainUntilDate.toString(DateFormat.RETENTION_DATE_FORMAT);  \n+  }\n+\n+  /**\n+   * Returns mode.\n+   */\n+  public RetentionMode mode() {\n+    return RetentionMode.fromString(mode);\n+  }\n+\n+  /**\n+   * Returns retain until date.\n+   */\n+  public Date retainUntil() {", "originalCommit": "e6668cb46d60ea71909f9f868261a73b69cd7d58", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTc0NTcwNQ==", "url": "https://github.com/minio/minio-java/pull/836#discussion_r375745705", "bodyText": "Have overloaded executePost() i.e. with/without md5Required argument.", "author": "balamurugana", "createdAt": "2020-02-06T10:12:07Z", "path": "api/src/main/java/io/minio/MinioClient.java", "diffHunk": "@@ -1402,11 +1400,12 @@ private HttpResponse executeDelete(String bucketName, String objectName, Map<Str\n    * @param data           HTTP request body data.\n    */\n   private HttpResponse executePost(String bucketName, String objectName, Map<String,String> headerMap,\n-                                   Map<String,String> queryParamMap, Object data)\n+                                   Map<String,String> queryParamMap, Object data, boolean md5Required)", "originalCommit": "e6668cb46d60ea71909f9f868261a73b69cd7d58", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTc0NjA2Mg==", "url": "https://github.com/minio/minio-java/pull/836#discussion_r375746062", "bodyText": "Have overloaded executePut() i.e. with/without md5Required", "author": "balamurugana", "createdAt": "2020-02-06T10:12:50Z", "path": "api/src/main/java/io/minio/MinioClient.java", "diffHunk": "@@ -1439,13 +1438,13 @@ private HttpResponse executePost(String bucketName, String objectName, Map<Strin\n    * @param length         Length of HTTP request body data.\n    */\n   private HttpResponse executePut(String bucketName, String objectName, Map<String,String> headerMap,\n-                                  Map<String,String> queryParamMap, String region, Object data, int length)\n+                  Map<String,String> queryParamMap, String region, Object data, int length, boolean md5Required)", "originalCommit": "e6668cb46d60ea71909f9f868261a73b69cd7d58", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTc0NjU0MA==", "url": "https://github.com/minio/minio-java/pull/836#discussion_r375746540", "bodyText": "Same as above", "author": "balamurugana", "createdAt": "2020-02-06T10:13:43Z", "path": "api/src/main/java/io/minio/MinioClient.java", "diffHunk": "@@ -1461,11 +1460,12 @@ private HttpResponse executePut(String bucketName, String objectName, Map<String\n    * @param length         Length of HTTP request body data.\n    */\n   private HttpResponse executePut(String bucketName, String objectName, Map<String,String> headerMap,\n-                                  Map<String,String> queryParamMap, Object data, int length)\n+                                  Map<String,String> queryParamMap, Object data, int length,  boolean md5Required)", "originalCommit": "e6668cb46d60ea71909f9f868261a73b69cd7d58", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTc0NzE4Ng==", "url": "https://github.com/minio/minio-java/pull/836#discussion_r375747186", "bodyText": "Use overloaded executePut()/executePost() accepting md5Required argument to avoid unnecessary diffs.", "author": "balamurugana", "createdAt": "2020-02-06T10:15:07Z", "path": "api/src/main/java/io/minio/MinioClient.java", "diffHunk": "@@ -2388,7 +2388,7 @@ public void copyObject(String bucketName, String objectName, Map<String,String>\n       headerMap.putAll(copyConditions.getConditions());\n     }\n \n-    HttpResponse response = executePut(bucketName, objectName, headerMap, null, \"\", 0);\n+    HttpResponse response = executePut(bucketName, objectName, headerMap, null, \"\", 0, false);", "originalCommit": "e6668cb46d60ea71909f9f868261a73b69cd7d58", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "1462c63754e41ff6a45347cbf98bead336c78032", "url": "https://github.com/minio/minio-java/commit/1462c63754e41ff6a45347cbf98bead336c78032", "message": "Add argument to calculate md5 if needed", "committedDate": "2020-02-06T19:27:48Z", "type": "forcePushed"}, {"oid": "a96dde372c48c15346f500883e8b71d862552c07", "url": "https://github.com/minio/minio-java/commit/a96dde372c48c15346f500883e8b71d862552c07", "message": "Add new method to set/get object retention and legal hold", "committedDate": "2020-02-07T04:19:34Z", "type": "commit"}, {"oid": "29bdecdb961f1b58f0bbf4951072c38ceabfad7d", "url": "https://github.com/minio/minio-java/commit/29bdecdb961f1b58f0bbf4951072c38ceabfad7d", "message": "Legal Hold methods modified", "committedDate": "2020-02-07T04:19:34Z", "type": "commit"}, {"oid": "bb595dd63be6d9220d6ebd3cbbfe2f0d4f136372", "url": "https://github.com/minio/minio-java/commit/bb595dd63be6d9220d6ebd3cbbfe2f0d4f136372", "message": "Add argument to calculate md5 if needed", "committedDate": "2020-02-07T04:19:34Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjcxMDQ4Nw==", "url": "https://github.com/minio/minio-java/pull/836#discussion_r376710487", "bodyText": "mode can be null. You need to return null accordingly", "author": "balamurugana", "createdAt": "2020-02-08T13:35:55Z", "path": "api/src/main/java/io/minio/messages/ObjectRetentionConfiguration.java", "diffHunk": "@@ -0,0 +1,78 @@\n+/*\n+ * MinIO Java SDK for Amazon S3 Compatible Cloud Storage, (C) 2020 MinIO, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.minio.messages;\n+\n+import org.xmlpull.v1.XmlPullParserException;\n+\n+import io.minio.DateFormat;\n+import org.joda.time.DateTime;\n+import com.google.api.client.util.Key;\n+import io.minio.errors.InvalidArgumentException;\n+\n+/**\n+ * Helper class to parse Amazon AWS S3 response XML containing ObjectLockRetention information.\n+ */\n+@SuppressWarnings(\"SameParameterValue\")\n+public class ObjectRetentionConfiguration extends XmlEntity {\n+  @Key(\"Mode\")\n+  private String mode;\n+  @Key(\"RetainUntilDate\")\n+  private String retainUntilDate;\n+\n+ /**\n+   * Constructs a new ObjectRetentionConfiguration object.\n+   */\n+  public ObjectRetentionConfiguration() throws XmlPullParserException {\n+    super();\n+    super.name = \"Retention\";\n+  }\n+\n+  /**\n+   * Constructs a new ObjectRetentionConfiguration object with given retention \n+   * until date and mode.\n+   */\n+  public ObjectRetentionConfiguration(RetentionMode mode,  DateTime retainUntilDate) throws XmlPullParserException,\n+          InvalidArgumentException {\n+    this();\n+    if (mode == null) {\n+      throw new InvalidArgumentException(\"null mode is not allowed\");\n+    }\n+    this.mode = mode.toString();\n+    if (retainUntilDate == null) {\n+      throw new InvalidArgumentException(\"null retainUntilDate is not allowed\");\n+    }    \n+    this.retainUntilDate = retainUntilDate.toString(DateFormat.EXPIRATION_DATE_FORMAT);  \n+  }\n+\n+  /**\n+   * Returns mode.\n+   */\n+  public RetentionMode mode() {\n+    return RetentionMode.fromString(mode);", "originalCommit": "bb595dd63be6d9220d6ebd3cbbfe2f0d4f136372", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjcxMDU2OQ==", "url": "https://github.com/minio/minio-java/pull/836#discussion_r376710569", "bodyText": "return status != null && status.equals(\"ON\"); is correct and sufficient", "author": "balamurugana", "createdAt": "2020-02-08T13:37:29Z", "path": "api/src/main/java/io/minio/messages/ObjectLockLegalHold.java", "diffHunk": "@@ -0,0 +1,60 @@\n+/*\n+ * MinIO Java SDK for Amazon S3 Compatible Cloud Storage, (C) 2020 MinIO, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.minio.messages;\n+\n+import org.xmlpull.v1.XmlPullParserException;\n+import com.google.api.client.util.Key;\n+\n+\n+/**\n+ * Helper class to construct create bucket configuration request XML for Amazon AWS S3.\n+ */\n+@edu.umd.cs.findbugs.annotations.SuppressFBWarnings(value = \"URF_UNREAD_FIELD\")\n+public class ObjectLockLegalHold extends XmlEntity{\n+  @Key(\"Status\")\n+  private String status;\n+\n+  /**\n+   * Constructs a new ObjectLockLegalHold object .\n+   */\n+  public ObjectLockLegalHold() throws XmlPullParserException {\n+    super();\n+    super.name = \"LegalHold\";\n+  }\n+\n+  /**\n+   * Constructs a new ObjectLockLegalHold object with given status.\n+   */\n+  public ObjectLockLegalHold(boolean status) throws  XmlPullParserException {\n+    this();\n+    if (status) {\n+      this.status = \"ON\";\n+    } else {\n+      this.status = \"OFF\";\n+    }\n+  }\n+\n+  /**\n+   * Indicates whether the specified object has a Legal Hold in place or not.\n+   */\n+  public boolean status() {\n+    if (status.equals(\"ON\")) {\n+      return true;\n+    }\n+    return false;", "originalCommit": "bb595dd63be6d9220d6ebd3cbbfe2f0d4f136372", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjcxMDkzOA==", "url": "https://github.com/minio/minio-java/pull/836#discussion_r376710938", "bodyText": "I don't know why you are missing out of versionId handling. Are you deferring in other places?", "author": "balamurugana", "createdAt": "2020-02-08T13:45:26Z", "path": "api/src/main/java/io/minio/MinioClient.java", "diffHunk": "@@ -3895,6 +3956,247 @@ public ObjectLockConfiguration getDefaultRetention(String bucketName)\n   }\n \n \n+  /**\n+   * Applies object retention lock onto an object.\n+   *\n+   * </p><b>Example:</b><br>\n+   * <pre>{@code minioClient.setObjectRetention(\"my-bucketname\", \"my-object\", config, true );\n+   * System.out.println(\"Set object retention on my-object successfully.\"); }</pre>\n+   *\n+   * @param bucketName Bucket name.\n+   * @param objectName Object name.\n+   * @param versionId  Object versio id.\n+   * @param config     Object lock configuration.\n+   * @param bypassGovernanceRetention  By pass governance retention.\n+   *\n+   * @throws InvalidBucketNameException  upon invalid bucket name is given\n+   * @throws NoSuchAlgorithmException\n+   *           upon requested algorithm was not found during signature calculation\n+   * @throws InsufficientDataException  upon getting EOFException while reading given\n+   *           InputStream even before reading given length\n+   * @throws IOException                 upon connection error\n+   * @throws InvalidKeyException\n+   *           upon an invalid access key or secret key\n+   * @throws NoResponseException         upon no response from server\n+   * @throws XmlPullParserException      upon parsing response xml\n+   * @throws ErrorResponseException      upon unsuccessful execution\n+   * @throws InternalException           upon internal library error\n+   * @throws InvalidResponseException    upon a non-xml response from server\n+   * @throws InvalidArgumentException    upon invalid value is passed to a method.\n+   */\n+  public void setObjectRetention(String bucketName, String objectName, String versionId, \n+          ObjectRetentionConfiguration config, boolean bypassGovernanceRetention)\n+    throws InvalidBucketNameException, NoSuchAlgorithmException, InsufficientDataException, IOException,\n+           InvalidKeyException, NoResponseException, XmlPullParserException, ErrorResponseException,\n+           InternalException, InvalidResponseException, InvalidArgumentException {\n+\n+    if (config == null ) {\n+      throw new InvalidArgumentException(\"null value is not allowed in config.\");\n+    }\n+\n+    Map<String, String> queryParamMap = new HashMap<>();\n+    queryParamMap.put(\"retention\", \"\");\n+\n+    if (versionId == null) {\n+      queryParamMap.put(\"versionId\", \"\");\n+    } else {\n+      queryParamMap.put(\"versionId\", versionId);\n+    }\n+\n+    Map<String, String> headerMap = new HashMap<>();\n+    if (bypassGovernanceRetention) {\n+      headerMap.put(\"x-amz-bypass-governance-retention\", \"True\");\n+    }\n+\n+    HttpResponse response = executePut(bucketName, objectName, headerMap, queryParamMap, config, 0);\n+    response.body().close();\n+  }\n+\n+  /**\n+   * Fetches object retention lock of an object.\n+   *\n+   * </p><b>Example:</b><br>\n+   * <pre>{@code\n+   * ObjectRetentionConfiguration objectRetentionConfiguration = minioClient.getObjectRetention(\"my-bucketname\", \n+   * \"my-object\", \"version-Id\" );\n+   * System.out.println(\"Mode \" + objectRetentionConfiguration.mode()); \n+   * System.out.println(\"Retanetion Until  \" + objectRetentionConfiguration.getRetentionDate()); }</pre>\n+   *\n+   * @param bucketName Bucket name.\n+   * @param objectName Object name.\n+   * @param versionId  Version Id.\n+   *\n+   * @throws InvalidBucketNameException  upon invalid bucket name is given\n+   * @throws NoSuchAlgorithmException\n+   *           upon requested algorithm was not found during signature calculation\n+   * @throws InsufficientDataException  upon getting EOFException while reading given\n+   *           InputStream even before reading given length\n+   * @throws IOException                 upon connection error\n+   * @throws InvalidKeyException\n+   *           upon an invalid access key or secret key\n+   * @throws NoResponseException         upon no response from server\n+   * @throws XmlPullParserException      upon parsing response xml\n+   * @throws ErrorResponseException      upon unsuccessful execution\n+   * @throws InternalException           upon internal library error\n+   * @throws InvalidResponseException    upon a non-xml response from server\n+   */\n+  public ObjectRetentionConfiguration getObjectRetention(String bucketName, String objectName, String versionId)\n+    throws InvalidBucketNameException, NoSuchAlgorithmException, InsufficientDataException, IOException,\n+           InvalidKeyException, NoResponseException, XmlPullParserException, ErrorResponseException,\n+           InternalException, InvalidResponseException {\n+\n+    Map<String, String> queryParamMap = new HashMap<>();\n+    queryParamMap.put(\"retention\", \"\");\n+\n+    if ( !(versionId == null || versionId.isEmpty())) {\n+      queryParamMap.put(\"versionId\",versionId);\n+    }", "originalCommit": "bb595dd63be6d9220d6ebd3cbbfe2f0d4f136372", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjcxMTExMA==", "url": "https://github.com/minio/minio-java/pull/836#discussion_r376711110", "bodyText": "As we agreed previously, you are going to send separate PR to have putObject() with retention and legal hold. Are you still considering to add in this PR?", "author": "balamurugana", "createdAt": "2020-02-08T13:48:48Z", "path": "api/src/main/java/io/minio/MinioClient.java", "diffHunk": "@@ -4096,6 +4398,51 @@ public void putObject(String bucketName, String objectName, String fileName,  Lo\n            InvalidKeyException, NoResponseException, XmlPullParserException, ErrorResponseException,\n            InternalException, InvalidArgumentException, InsufficientDataException, InvalidResponseException {\n \n+    putObject(bucketName, objectName, fileName, size, headerMap, sse, contentType, false);\n+  }\n+\n+\n+   /**\n+   * Uploads given file as object in given bucket.\n+   * <p>\n+   * If the object is larger than 5MB, the client will automatically use a multipart session.\n+   * </p>\n+   * <p>\n+   * If the session fails, the user may attempt to re-upload the object by attempting to create\n+   * the exact same object again.\n+   * </p>\n+   * <p>\n+   * If the multipart session fails, abort the uploaded parts automatically.\n+   * </p>\n+   *\n+   * @param bucketName  Bucket name.\n+   * @param objectName  Object name to create in the bucket.\n+   * @param fileName    File name to upload.\n+   * @param size        Size of all the data that will be uploaded.\n+   * @param headerMap   Custom/additional meta data of the object.\n+   * @param sse         encryption metadata.\n+   * @param contentType Content type of the stream.\n+   * @param objectLockRetention Object lock retention.\n+   *\n+   * @throws InvalidBucketNameException  upon invalid bucket name is given\n+   * @throws NoSuchAlgorithmException\n+   *           upon requested algorithm was not found during signature calculation\n+   * @throws IOException                 upon connection error\n+   * @throws InvalidKeyException\n+   *           upon an invalid access key or secret key\n+   * @throws NoResponseException         upon no response from server\n+   * @throws XmlPullParserException      upon parsing response xml\n+   * @throws ErrorResponseException      upon unsuccessful execution\n+   * @throws InternalException           upon internal library error\n+   * @throws InvalidArgumentException    upon invalid value is passed to a method.\n+   * @throws InsufficientDataException   upon getting EOFException while reading given\n+   */\n+  public void putObject(String bucketName, String objectName, String fileName, Long size, Map<String, String> headerMap,\n+                        ServerSideEncryption sse, String contentType, boolean objectLockRetention)", "originalCommit": "bb595dd63be6d9220d6ebd3cbbfe2f0d4f136372", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njc0ODYxOA==", "url": "https://github.com/minio/minio-java/pull/836#discussion_r376748618", "bodyText": "Yes, that i will send as another PR.", "author": "sinhaashish", "createdAt": "2020-02-09T02:08:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjcxMTExMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODA1MDI1MA==", "url": "https://github.com/minio/minio-java/pull/836#discussion_r378050250", "bodyText": "If so, why are doing this change here?", "author": "balamurugana", "createdAt": "2020-02-12T05:44:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjcxMTExMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODA1ODczNw==", "url": "https://github.com/minio/minio-java/pull/836#discussion_r378058737", "bodyText": "If so, why are doing this change here?\n\nThis change is needed .\nThere are two cases to this flow:\nUser creates a bucket with lock function enabled.\nCase 1 : User can put the object on the bucket  and then at later point of time, set the retenetion. This case is handled in this PR.\nCase 2 :  User asks for retention/legalhold at the time of putting object. This will be handled in another PR.\nIf we dont have the below overloaded putObject then we wont be able to put the object on\nlock enabled buckets and hence not able to test the PR.\n  public void putObject(String bucketName, String objectName, String fileName, Long size, Map<String, String> headerMap,\n                        ServerSideEncryption sse, String contentType, boolean objectLockRetention) \n\n\nIf you think that case 2 should also be present in this PR , then i can come up with that .", "author": "sinhaashish", "createdAt": "2020-02-12T06:21:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjcxMTExMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODA4ODMxMQ==", "url": "https://github.com/minio/minio-java/pull/836#discussion_r378088311", "bodyText": "You cannot add any changes to putObject() if you plan for separate PR.", "author": "balamurugana", "createdAt": "2020-02-12T07:59:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjcxMTExMA=="}], "type": "inlineReview"}, {"oid": "fc431ebdebd79eedc779d37135ab036109eb3b67", "url": "https://github.com/minio/minio-java/commit/fc431ebdebd79eedc779d37135ab036109eb3b67", "message": "Add argument to calculate md5 if needed", "committedDate": "2020-02-09T02:07:09Z", "type": "commit"}, {"oid": "fc431ebdebd79eedc779d37135ab036109eb3b67", "url": "https://github.com/minio/minio-java/commit/fc431ebdebd79eedc779d37135ab036109eb3b67", "message": "Add argument to calculate md5 if needed", "committedDate": "2020-02-09T02:07:09Z", "type": "forcePushed"}, {"oid": "2c5206faf76ba3c62d3985b2178d65ed617de8f2", "url": "https://github.com/minio/minio-java/commit/2c5206faf76ba3c62d3985b2178d65ed617de8f2", "message": "Remove overloaded putObject", "committedDate": "2020-02-12T14:02:20Z", "type": "commit"}, {"oid": "2c5206faf76ba3c62d3985b2178d65ed617de8f2", "url": "https://github.com/minio/minio-java/commit/2c5206faf76ba3c62d3985b2178d65ed617de8f2", "message": "Remove overloaded putObject", "committedDate": "2020-02-12T14:02:20Z", "type": "forcePushed"}]}