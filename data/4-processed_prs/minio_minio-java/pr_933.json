{"pr_number": 933, "pr_title": "add arg builder to {set,get,delete}BucketPolicy APIs", "pr_createdAt": "2020-05-14T11:17:13Z", "pr_url": "https://github.com/minio/minio-java/pull/933", "timeline": [{"oid": "e5b2b63f5ba4a89259aaf032de6c0799f614dab4", "url": "https://github.com/minio/minio-java/commit/e5b2b63f5ba4a89259aaf032de6c0799f614dab4", "message": "add deleteBucketPolicy() API", "committedDate": "2020-05-14T12:51:22Z", "type": "forcePushed"}, {"oid": "6daad63fbb4f3ea97139372f02a2f63dc487f33a", "url": "https://github.com/minio/minio-java/commit/6daad63fbb4f3ea97139372f02a2f63dc487f33a", "message": "add arg builder to {set,get,delete}BucketPolicy APIs", "committedDate": "2020-05-19T14:37:55Z", "type": "forcePushed"}, {"oid": "885df55c18c13447684ed881a486a6b764e0912d", "url": "https://github.com/minio/minio-java/commit/885df55c18c13447684ed881a486a6b764e0912d", "message": "add arg builder to {set,get,delete}BucketPolicy APIs", "committedDate": "2020-05-21T10:20:31Z", "type": "forcePushed"}, {"oid": "86ba11e6350239a66aa0e2741192b1f7d80db660", "url": "https://github.com/minio/minio-java/commit/86ba11e6350239a66aa0e2741192b1f7d80db660", "message": "add arg builder to {set,get,delete}BucketPolicy APIs", "committedDate": "2020-05-21T10:27:23Z", "type": "forcePushed"}, {"oid": "9e830b2415e96c0addedf131378f8f32d5fec5c5", "url": "https://github.com/minio/minio-java/commit/9e830b2415e96c0addedf131378f8f32d5fec5c5", "message": "add arg builder to {set,get,delete}BucketPolicy APIs", "committedDate": "2020-05-22T06:53:20Z", "type": "forcePushed"}, {"oid": "d27af9b457f32f5094863474d4a1ceaf554da1da", "url": "https://github.com/minio/minio-java/commit/d27af9b457f32f5094863474d4a1ceaf554da1da", "message": "add arg builder to {set,get,delete}BucketPolicy APIs", "committedDate": "2020-05-26T09:16:16Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTA2MDk0NA==", "url": "https://github.com/minio/minio-java/pull/933#discussion_r431060944", "bodyText": "Add @Override annotation to this method", "author": "anjalshireesh", "createdAt": "2020-05-27T11:57:09Z", "path": "api/src/main/java/io/minio/SetBucketPolicyArgs.java", "diffHunk": "@@ -0,0 +1,50 @@\n+/*\n+ * MinIO Java SDK for Amazon S3 Compatible Cloud Storage, (C) 2020 MinIO, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.minio;\n+\n+/** Argument class of MinioClient.setBucketPolicy(). */\n+public class SetBucketPolicyArgs extends BucketArgs {\n+  private String config;\n+\n+  public String config() {\n+    return config;\n+  }\n+\n+  public static Builder builder() {\n+    return new Builder();\n+  }\n+\n+  /** Argument builder of {@link SetBucketPolicyArgs}. */\n+  public static final class Builder extends BucketArgs.Builder<Builder, SetBucketPolicyArgs> {\n+    private void validateConfig(String config) {\n+      if (config == null) {\n+        throw new IllegalArgumentException(\"null policy configuration\");\n+      }\n+    }\n+\n+    protected void validate(SetBucketPolicyArgs args) {", "originalCommit": "d27af9b457f32f5094863474d4a1ceaf554da1da", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTIxNDI0MQ==", "url": "https://github.com/minio/minio-java/pull/933#discussion_r431214241", "bodyText": "Done", "author": "balamurugana", "createdAt": "2020-05-27T15:06:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTA2MDk0NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTExMDU0NA==", "url": "https://github.com/minio/minio-java/pull/933#discussion_r431110544", "bodyText": "This can be replaced with checkArgs(args); after rebasing with latest master branch", "author": "anjalshireesh", "createdAt": "2020-05-27T13:09:47Z", "path": "api/src/main/java/io/minio/MinioClient.java", "diffHunk": "@@ -4295,20 +4295,53 @@ public void putObject(\n    * @throws NoSuchAlgorithmException thrown to indicate missing of MD5 or SHA-256 digest library.\n    * @throws XmlParserException thrown to indicate XML parsing error.\n    */\n+  @Deprecated\n   public String getBucketPolicy(String bucketName)\n       throws BucketPolicyTooLargeException, ErrorResponseException, IllegalArgumentException,\n           InsufficientDataException, InternalException, InvalidBucketNameException,\n           InvalidKeyException, InvalidResponseException, IOException, NoSuchAlgorithmException,\n           XmlParserException {\n+    return getBucketPolicy(GetBucketPolicyArgs.builder().bucket(bucketName).build());\n+  }\n+\n+  /**\n+   * Gets bucket policy configuration of a bucket.\n+   *\n+   * <pre>Example:{@code\n+   * String config =\n+   *     minioClient.getBucketPolicy(GetBucketPolicyArgs.builder().bucket(\"my-bucketname\").build());\n+   * }</pre>\n+   *\n+   * @param args {@link GetBucketPolicyArgs} object.\n+   * @return String - Bucket policy configuration as JSON string.\n+   * @throws BucketPolicyTooLargeException thrown to indicate returned bucket policy is too large.\n+   * @throws ErrorResponseException thrown to indicate S3 service returned an error response.\n+   * @throws IllegalArgumentException throws to indicate invalid argument passed.\n+   * @throws InsufficientDataException thrown to indicate not enough data available in InputStream.\n+   * @throws InternalException thrown to indicate internal library error.\n+   * @throws InvalidBucketNameException thrown to indicate invalid bucket name passed.\n+   * @throws InvalidKeyException thrown to indicate missing of HMAC SHA-256 library.\n+   * @throws InvalidResponseException thrown to indicate S3 service returned invalid or no error\n+   *     response.\n+   * @throws IOException thrown to indicate I/O error on S3 operation.\n+   * @throws NoSuchAlgorithmException thrown to indicate missing of MD5 or SHA-256 digest library.\n+   * @throws XmlParserException thrown to indicate XML parsing error.\n+   */\n+  public String getBucketPolicy(GetBucketPolicyArgs args)\n+      throws BucketPolicyTooLargeException, ErrorResponseException, IllegalArgumentException,\n+          InsufficientDataException, InternalException, InvalidBucketNameException,\n+          InvalidKeyException, InvalidResponseException, IOException, NoSuchAlgorithmException,\n+          XmlParserException {\n+    if (args == null) {\n+      throw new IllegalArgumentException(\"null arguments\");\n+    }", "originalCommit": "d27af9b457f32f5094863474d4a1ceaf554da1da", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTIxNjY2OQ==", "url": "https://github.com/minio/minio-java/pull/933#discussion_r431216669", "bodyText": "Done", "author": "balamurugana", "createdAt": "2020-05-27T15:10:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTExMDU0NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTExMjQ0Mw==", "url": "https://github.com/minio/minio-java/pull/933#discussion_r431112443", "bodyText": "Good to add a javadoc comment with @deprecated also providing link to the alternate method to be used", "author": "anjalshireesh", "createdAt": "2020-05-27T13:11:18Z", "path": "api/src/main/java/io/minio/MinioClient.java", "diffHunk": "@@ -4295,20 +4295,53 @@ public void putObject(\n    * @throws NoSuchAlgorithmException thrown to indicate missing of MD5 or SHA-256 digest library.\n    * @throws XmlParserException thrown to indicate XML parsing error.\n    */\n+  @Deprecated", "originalCommit": "d27af9b457f32f5094863474d4a1ceaf554da1da", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTIyMDE5MQ==", "url": "https://github.com/minio/minio-java/pull/933#discussion_r431220191", "bodyText": "Done", "author": "balamurugana", "createdAt": "2020-05-27T15:14:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTExMjQ0Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTEyNjk2OQ==", "url": "https://github.com/minio/minio-java/pull/933#discussion_r431126969", "bodyText": "Maybe we should verify that the value returned by getBucketPolicy matches what was set in the previous step?", "author": "anjalshireesh", "createdAt": "2020-05-27T13:23:29Z", "path": "functional/FunctionalTest.java", "diffHunk": "@@ -3798,35 +3795,20 @@ public static void getBucketPolicy_test1() throws Exception {\n               + \"\\\"Principal\\\":{\\\"AWS\\\":[\\\"*\\\"]},\\\"Resource\\\":[\\\"arn:aws:s3:::\"\n               + bucketName\n               + \"/myobject*\\\"],\\\"Sid\\\":\\\"\\\"}]}\";\n-      client.setBucketPolicy(bucketName, policy);\n-      client.getBucketPolicy(bucketName);\n-      mintSuccessLog(\"getBucketPolicy(String bucketName)\", null, startTime);\n+      client.setBucketPolicy(\n+          SetBucketPolicyArgs.builder().bucket(bucketName).config(policy).build());\n+      client.getBucketPolicy(GetBucketPolicyArgs.builder().bucket(bucketName).build());", "originalCommit": "d27af9b457f32f5094863474d4a1ceaf554da1da", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTIyNzEyNA==", "url": "https://github.com/minio/minio-java/pull/933#discussion_r431227124", "bodyText": "I think it is hard to check. For example below two JSON string are same.\n{\"Version\":\"2012-10-17\",\"Statement\":[{\"Action\":[\"s3:GetObject\"],\"Effect\":\"Allow\",\"Principal\":{\"AWS\":[\"*\"]},\"Resource\":[\"arn:aws:s3:::MYBUCKET/myobject*\"],\"Sid\":\"\"}]}\n{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Action\": [\n                \"s3:GetObject\"\n            ],\n            \"Effect\": \"Allow\",\n            \"Principal\": {\n                \"AWS\": [\n                    \"*\"\n                ]\n            },\n            \"Resource\": [\n                \"arn:aws:s3:::MYBUCKET/myobject*\"\n            ],\n            \"Sid\": \"\"\n        }\n    ]\n}\nServer may return a JSON which can be formatted differently but equally same.", "author": "balamurugana", "createdAt": "2020-05-27T15:23:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTEyNjk2OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTc5MzM3Mw==", "url": "https://github.com/minio/minio-java/pull/933#discussion_r431793373", "bodyText": "Should be possible by marshalling/unmarshalling from/into a java object, but probably not worth the effort here.", "author": "anjalshireesh", "createdAt": "2020-05-28T12:21:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTEyNjk2OQ=="}], "type": "inlineReview"}, {"oid": "62a8600ee7728f08c71a8d4c9668332039d1f2cf", "url": "https://github.com/minio/minio-java/commit/62a8600ee7728f08c71a8d4c9668332039d1f2cf", "message": "add arg builder to {set,get,delete}BucketPolicy APIs", "committedDate": "2020-05-27T15:24:48Z", "type": "forcePushed"}, {"oid": "259e09106f15e1ce8007b696e1c2a0253016bb24", "url": "https://github.com/minio/minio-java/commit/259e09106f15e1ce8007b696e1c2a0253016bb24", "message": "add arg builder to {set,get,delete}BucketPolicy APIs", "committedDate": "2020-05-28T04:09:17Z", "type": "commit"}, {"oid": "259e09106f15e1ce8007b696e1c2a0253016bb24", "url": "https://github.com/minio/minio-java/commit/259e09106f15e1ce8007b696e1c2a0253016bb24", "message": "add arg builder to {set,get,delete}BucketPolicy APIs", "committedDate": "2020-05-28T04:09:17Z", "type": "forcePushed"}]}