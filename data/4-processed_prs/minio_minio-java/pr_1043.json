{"pr_number": 1043, "pr_title": "add chained credential provider", "pr_createdAt": "2020-08-17T16:57:22Z", "pr_url": "https://github.com/minio/minio-java/pull/1043", "timeline": [{"oid": "64d52ce3350fb523d781c282cfec8ccfee73d5b3", "url": "https://github.com/minio/minio-java/commit/64d52ce3350fb523d781c282cfec8ccfee73d5b3", "message": "add chain credential provider", "committedDate": "2020-08-17T16:55:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjcwNDY1MQ==", "url": "https://github.com/minio/minio-java/pull/1043#discussion_r472704651", "bodyText": "ChainedProvider might sound better", "author": "anjalshireesh", "createdAt": "2020-08-19T05:13:09Z", "path": "api/src/main/java/io/minio/credentials/ChainProvider.java", "diffHunk": "@@ -0,0 +1,79 @@\n+/*\n+ * MinIO Java SDK for Amazon S3 Compatible Cloud Storage, (C) 2020 MinIO, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.minio.credentials;\n+\n+import java.util.Arrays;\n+import java.util.List;\n+import javax.annotation.Nonnull;\n+\n+/** Chained credential provider work with list of credential providers. */\n+public class ChainProvider implements Provider {", "originalCommit": "64d52ce3350fb523d781c282cfec8ccfee73d5b3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzU4MzM1NA==", "url": "https://github.com/minio/minio-java/pull/1043#discussion_r473583354", "bodyText": "done", "author": "balamurugana", "createdAt": "2020-08-20T04:37:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjcwNDY1MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjcxMTgwMw==", "url": "https://github.com/minio/minio-java/pull/1043#discussion_r472711803", "bodyText": "Not sure if synchronizing this block helps. Making the fetch method itself synchronized might be better.", "author": "anjalshireesh", "createdAt": "2020-08-19T05:24:31Z", "path": "api/src/main/java/io/minio/credentials/ChainProvider.java", "diffHunk": "@@ -0,0 +1,79 @@\n+/*\n+ * MinIO Java SDK for Amazon S3 Compatible Cloud Storage, (C) 2020 MinIO, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.minio.credentials;\n+\n+import java.util.Arrays;\n+import java.util.List;\n+import javax.annotation.Nonnull;\n+\n+/** Chained credential provider work with list of credential providers. */\n+public class ChainProvider implements Provider {\n+  private final List<Provider> providers;\n+  private Provider currentProvider;\n+  private Credentials credentials;\n+\n+  public ChainProvider(@Nonnull Provider... providers) {\n+    this.providers = Arrays.asList(providers);\n+  }\n+\n+  @Override\n+  public Credentials fetch() {\n+    if (this.credentials != null && !this.credentials.isExpired()) {\n+      return this.credentials;\n+    }\n+\n+    Credentials credentials = null;\n+\n+    if (currentProvider != null) {\n+      try {\n+        credentials = currentProvider.fetch();\n+      } catch (IllegalStateException e) {\n+        // Ignore and fallback to iteration.\n+      }\n+    }\n+\n+    if (credentials != null) {\n+      synchronized (this) {\n+        this.credentials = credentials;\n+      }", "originalCommit": "64d52ce3350fb523d781c282cfec8ccfee73d5b3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzU4NDk2OQ==", "url": "https://github.com/minio/minio-java/pull/1043#discussion_r473584969", "bodyText": "If entire method is locked in execution, fetch() becomes sequential execution, that leads to API execution sequential.", "author": "balamurugana", "createdAt": "2020-08-20T04:43:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjcxMTgwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDEwNDMxNg==", "url": "https://github.com/minio/minio-java/pull/1043#discussion_r474104316", "bodyText": "Can you please help me understand how the current synchronization helps? Maybe with an example use case of concurrent requests.", "author": "anjalshireesh", "createdAt": "2020-08-20T16:13:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjcxMTgwMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjcxMjcyNg==", "url": "https://github.com/minio/minio-java/pull/1043#discussion_r472712726", "bodyText": "Might want to skip doing this for currentProvider as that has already happened in previous lines.", "author": "anjalshireesh", "createdAt": "2020-08-19T05:25:48Z", "path": "api/src/main/java/io/minio/credentials/ChainProvider.java", "diffHunk": "@@ -0,0 +1,79 @@\n+/*\n+ * MinIO Java SDK for Amazon S3 Compatible Cloud Storage, (C) 2020 MinIO, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.minio.credentials;\n+\n+import java.util.Arrays;\n+import java.util.List;\n+import javax.annotation.Nonnull;\n+\n+/** Chained credential provider work with list of credential providers. */\n+public class ChainProvider implements Provider {\n+  private final List<Provider> providers;\n+  private Provider currentProvider;\n+  private Credentials credentials;\n+\n+  public ChainProvider(@Nonnull Provider... providers) {\n+    this.providers = Arrays.asList(providers);\n+  }\n+\n+  @Override\n+  public Credentials fetch() {\n+    if (this.credentials != null && !this.credentials.isExpired()) {\n+      return this.credentials;\n+    }\n+\n+    Credentials credentials = null;\n+\n+    if (currentProvider != null) {\n+      try {\n+        credentials = currentProvider.fetch();\n+      } catch (IllegalStateException e) {\n+        // Ignore and fallback to iteration.\n+      }\n+    }\n+\n+    if (credentials != null) {\n+      synchronized (this) {\n+        this.credentials = credentials;\n+      }\n+\n+      return this.credentials;\n+    }\n+\n+    for (Provider provider : providers) {\n+      try {\n+        credentials = provider.fetch();", "originalCommit": "64d52ce3350fb523d781c282cfec8ccfee73d5b3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzU4NTE5Mw==", "url": "https://github.com/minio/minio-java/pull/1043#discussion_r473585193", "bodyText": "Its OK to try one more time in a loop.", "author": "balamurugana", "createdAt": "2020-08-20T04:44:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjcxMjcyNg=="}], "type": "inlineReview"}, {"oid": "af75e302139157124a3ce698e849298b7a5a7098", "url": "https://github.com/minio/minio-java/commit/af75e302139157124a3ce698e849298b7a5a7098", "message": "address review comments", "committedDate": "2020-08-21T10:10:10Z", "type": "forcePushed"}, {"oid": "b2288affaae5de83d0199a53e2b8cafda4808f6a", "url": "https://github.com/minio/minio-java/commit/b2288affaae5de83d0199a53e2b8cafda4808f6a", "message": "address review comments", "committedDate": "2020-08-21T10:28:06Z", "type": "commit"}, {"oid": "b2288affaae5de83d0199a53e2b8cafda4808f6a", "url": "https://github.com/minio/minio-java/commit/b2288affaae5de83d0199a53e2b8cafda4808f6a", "message": "address review comments", "committedDate": "2020-08-21T10:28:06Z", "type": "forcePushed"}]}