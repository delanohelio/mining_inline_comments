{"pr_number": 3341, "pr_title": "fix: fix wrong import on annotated parameter #3320", "pr_createdAt": "2020-04-21T21:40:39Z", "pr_url": "https://github.com/INRIA/spoon/pull/3341", "timeline": [{"oid": "6919c239f6e28500a868480c1f1fbb8c891083b1", "url": "https://github.com/INRIA/spoon/commit/6919c239f6e28500a868480c1f1fbb8c891083b1", "message": "Merge remote-tracking branch 'source/master'", "committedDate": "2020-04-21T18:57:58Z", "type": "commit"}, {"oid": "d92b10a20b07824009bd4bfccc194810bee9965a", "url": "https://github.com/INRIA/spoon/commit/d92b10a20b07824009bd4bfccc194810bee9965a", "message": "fix: annotated element bad import", "committedDate": "2020-04-21T20:51:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjY3ODI3MQ==", "url": "https://github.com/INRIA/spoon/pull/3341#discussion_r412678271", "bodyText": "The test is in noclasspath mode. Remove this or work in fullclasspath?", "author": "monperrus", "createdAt": "2020-04-22T05:22:38Z", "path": "pom.xml", "diffHunk": "@@ -159,6 +159,14 @@\n       <artifactId>maven-invoker</artifactId>\n       <version>3.0.1</version>\n     </dependency>\n+    <!-- https://mvnrepository.com/artifact/javax.validation/validation-api -->", "originalCommit": "d92b10a20b07824009bd4bfccc194810bee9965a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjY3ODcyMg==", "url": "https://github.com/INRIA/spoon/pull/3341#discussion_r412678722", "bodyText": "In Spoon, the tests come with a one-line contract describing the test intention, something like\n// contract: annotations are not added on import statements\ncould you add the contract that is tested? Thanks!", "author": "monperrus", "createdAt": "2020-04-22T05:23:49Z", "path": "src/test/java/spoon/test/imports/ImportTest.java", "diffHunk": "@@ -1777,4 +1778,22 @@ public void testImportByJavaDoc() throws Exception {\n \t\t}\n \t}\n \n+\t@Test\n+\tpublic void testThatCorrectImportsAreGeneratedForJavaxAnnotatedElements() {", "originalCommit": "d92b10a20b07824009bd4bfccc194810bee9965a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjY3ODc5Nw==", "url": "https://github.com/INRIA/spoon/pull/3341#discussion_r412678797", "bodyText": "Remove System.out from tests.", "author": "monperrus", "createdAt": "2020-04-22T05:24:02Z", "path": "src/test/java/spoon/test/imports/ImportTest.java", "diffHunk": "@@ -1777,4 +1778,22 @@ public void testImportByJavaDoc() throws Exception {\n \t\t}\n \t}\n \n+\t@Test\n+\tpublic void testThatCorrectImportsAreGeneratedForJavaxAnnotatedElements() {\n+\t\tfinal Launcher l = new Launcher();\n+\t\tEnvironment e = l.getEnvironment();\n+\n+\t\te.setNoClasspath(true);\n+\t\te.setAutoImports(true);\n+\t\tl.addInputResource(\"src/test/java/spoon/test/imports/testclasses/badimportissue3320/source/TestSource.java\");\n+\t\tl.run();\n+\n+\t\tCtType<TestSource> objectCtType = l.getFactory().Type().get(TestSource.class);\n+\t\tCompilationUnit compilationUnit = l.getFactory().CompilationUnit().getOrCreate(objectCtType);\n+\n+\t\tfor (CtImport anImport : compilationUnit.getImports()) {\n+\t\t\tSystem.out.println(anImport.prettyprint());", "originalCommit": "d92b10a20b07824009bd4bfccc194810bee9965a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "1213053b6dbd49f7e835a1bb5642c4ff97ceb849", "url": "https://github.com/INRIA/spoon/commit/1213053b6dbd49f7e835a1bb5642c4ff97ceb849", "message": "attended to pr reviews", "committedDate": "2020-04-23T21:07:46Z", "type": "commit"}, {"oid": "dbb03134d4f2c770426526abac6e7df50d2e6855", "url": "https://github.com/INRIA/spoon/commit/dbb03134d4f2c770426526abac6e7df50d2e6855", "message": "Merge remote-tracking branch 'source/master'", "committedDate": "2020-04-23T21:08:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDEyNzk2MQ==", "url": "https://github.com/INRIA/spoon/pull/3341#discussion_r414127961", "bodyText": "Personally i hate reading this. It feels like useless information, which get outdated easily. Git can provide this information better. Maybe remove it?", "author": "MartinWitt", "createdAt": "2020-04-23T21:13:09Z", "path": "src/test/java/spoon/test/imports/testclasses/badimportissue3320/source/TestSource.java", "diffHunk": "@@ -0,0 +1,37 @@\n+package spoon.test.imports.testclasses.badimportissue3320.source;\n+\n+import spoon.test.imports.testclasses.badimportissue3320.source.other.SomeObjectDto;\n+import spoon.test.imports.testclasses.badimportissue3320.source.other.TestAnnotation;\n+\n+/**\n+ * @author Gibah Joseph\n+ * Email: gibahjoe@gmail.com\n+ * Apr, 2020\n+ **/", "originalCommit": "dbb03134d4f2c770426526abac6e7df50d2e6855", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDEyNzk5Nw==", "url": "https://github.com/INRIA/spoon/pull/3341#discussion_r414127997", "bodyText": "see other comment", "author": "MartinWitt", "createdAt": "2020-04-23T21:13:13Z", "path": "src/test/java/spoon/test/imports/testclasses/badimportissue3320/source/other/SomeObjectDto.java", "diffHunk": "@@ -0,0 +1,9 @@\n+package spoon.test.imports.testclasses.badimportissue3320.source.other;\n+\n+/**\n+ * @author Gibah Joseph\n+ * Email: gibahjoe@gmail.com\n+ * Apr, 2020\n+ **/", "originalCommit": "dbb03134d4f2c770426526abac6e7df50d2e6855", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDEyODEzMA==", "url": "https://github.com/INRIA/spoon/pull/3341#discussion_r414128130", "bodyText": "see other comment", "author": "MartinWitt", "createdAt": "2020-04-23T21:13:26Z", "path": "src/test/java/spoon/test/imports/testclasses/badimportissue3320/source/other/TestAnnotation.java", "diffHunk": "@@ -0,0 +1,17 @@\n+package spoon.test.imports.testclasses.badimportissue3320.source.other;\n+\n+import java.lang.annotation.Retention;\n+import java.lang.annotation.Target;\n+\n+import static java.lang.annotation.ElementType.*;\n+import static java.lang.annotation.RetentionPolicy.RUNTIME;\n+\n+/**\n+ * @author Gibah Joseph\n+ * email: gibahjoe@gmail.com\n+ * Apr, 2020\n+ **/", "originalCommit": "dbb03134d4f2c770426526abac6e7df50d2e6855", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDEyOTI1OA==", "url": "https://github.com/INRIA/spoon/pull/3341#discussion_r414129258", "bodyText": "maybe a pit \"picky\", but short names like e and l makes reading hard.", "author": "MartinWitt", "createdAt": "2020-04-23T21:15:18Z", "path": "src/test/java/spoon/test/imports/ImportTest.java", "diffHunk": "@@ -1777,4 +1778,20 @@ public void testImportByJavaDoc() throws Exception {\n \t\t}\n \t}\n \n+\t@Test\n+\tpublic void testImportsForElementsAnnotatedWithTypeUseAnnotations() {\n+\t\t// contract: correct import generated for method parameters annotated with TYPE_USE annotations\n+\t\tfinal Launcher l = new Launcher();\n+\t\tEnvironment e = l.getEnvironment();\n+\n+\t\te.setNoClasspath(true);\n+\t\te.setAutoImports(true);\n+\t\tl.addInputResource(\"src/test/java/spoon/test/imports/testclasses/badimportissue3320/source/TestSource.java\");\n+\t\tl.run();\n+", "originalCommit": "dbb03134d4f2c770426526abac6e7df50d2e6855", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDEzMDc5OQ==", "url": "https://github.com/INRIA/spoon/pull/3341#discussion_r414130799", "bodyText": "maybe a linebreak, but not mandatory", "author": "MartinWitt", "createdAt": "2020-04-23T21:17:52Z", "path": "src/test/java/spoon/test/imports/ImportTest.java", "diffHunk": "@@ -1777,4 +1778,20 @@ public void testImportByJavaDoc() throws Exception {\n \t\t}\n \t}\n \n+\t@Test\n+\tpublic void testImportsForElementsAnnotatedWithTypeUseAnnotations() {\n+\t\t// contract: correct import generated for method parameters annotated with TYPE_USE annotations\n+\t\tfinal Launcher l = new Launcher();\n+\t\tEnvironment e = l.getEnvironment();\n+\n+\t\te.setNoClasspath(true);\n+\t\te.setAutoImports(true);\n+\t\tl.addInputResource(\"src/test/java/spoon/test/imports/testclasses/badimportissue3320/source/TestSource.java\");\n+\t\tl.run();\n+\n+\t\tCtType<TestSource> objectCtType = l.getFactory().Type().get(TestSource.class);\n+\t\tCompilationUnit compilationUnit = l.getFactory().CompilationUnit().getOrCreate(objectCtType);\n+\n+\t\tassertEquals(1, compilationUnit.getImports().stream().filter(ctImport -> ctImport.prettyprint().equals(\"import spoon.test.imports.testclasses.badimportissue3320.source.other.SomeObjectDto;\")).count());", "originalCommit": "dbb03134d4f2c770426526abac6e7df50d2e6855", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "9ae6f078ca52694dbe3e68c680514b7403c99e47", "url": "https://github.com/INRIA/spoon/commit/9ae6f078ca52694dbe3e68c680514b7403c99e47", "message": "improved code readability", "committedDate": "2020-04-23T22:37:01Z", "type": "commit"}]}