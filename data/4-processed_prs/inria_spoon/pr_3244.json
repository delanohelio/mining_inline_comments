{"pr_number": 3244, "pr_title": "chore(checkstyle): add check for internal imports", "pr_createdAt": "2020-02-11T19:28:36Z", "pr_url": "https://github.com/INRIA/spoon/pull/3244", "timeline": [{"oid": "a75778ec054e38a2b6ca13af464beba79bec8aa1", "url": "https://github.com/INRIA/spoon/commit/a75778ec054e38a2b6ca13af464beba79bec8aa1", "message": "add check for internal packages expect jdt and spoon. Update checkstyle version because regex property is needed", "committedDate": "2020-02-11T19:21:12Z", "type": "commit"}, {"oid": "3ea8bed819160227b7b11df335da6ff53b279656", "url": "https://github.com/INRIA/spoon/commit/3ea8bed819160227b7b11df335da6ff53b279656", "message": "update all checkstyle versions", "committedDate": "2020-02-12T16:03:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODcyMzQ5OA==", "url": "https://github.com/INRIA/spoon/pull/3244#discussion_r378723498", "bodyText": "Could you provide some examples in a comment of what exactly you want to catch? I'm not sure to understand it in the context of the PR so I guess I won't understand it at all in few weeks :)\nThe regexp is to define which imports are illegal? Or in which package to look for illegal classes? So for example, does it look in https://github.com/INRIA/spoon/blob/master/src/main/java/spoon/support/compiler/jdt/JDTImportBuilder.java? Thanks!", "author": "surli", "createdAt": "2020-02-13T08:53:52Z", "path": "checkstyle.xml", "diffHunk": "@@ -28,6 +28,10 @@\n     <module name=\"AvoidStarImport\"/>\n     <module name=\"IllegalImport\"/> <!-- defaults to sun.* packages -->\n     <module name=\"RedundantImport\"/>\n+    <module name=\"IllegalImport\">\n+      <property name=\"regexp\" value=\"true\" />\n+      <property name=\"illegalClasses\" value=\"^(?!.*(spoon|jdt)).*internal.*$\" />", "originalCommit": "3ea8bed819160227b7b11df335da6ff53b279656", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODkxNjgyMg==", "url": "https://github.com/INRIA/spoon/pull/3244#discussion_r378916822", "bodyText": "This change adds a check looking at all imports and stops user from importing internal packages expect spoon and jdt ones. It defines which imports are illegal.\nThe regex looks for imports containing internal and not containing  spoon or jdt.\nSome examples are:\nimport java.util; //fine \nimport spoon.pattern.internal.node.ForEachNode; // allowed because internal package  but from spoon. \nimport org.eclipse.jdt.internal.compiler.batch.CompilationUnit; //allowed because internal  package but from jdt.\nimport org.apache.commons.jexl2.internal.introspection; //rejected because import of  internal package\nInternal packages from jdt are allowed because it's needed in some spoon classes.\nShould i add a comment in the pom for clarification?", "author": "MartinWitt", "createdAt": "2020-02-13T15:04:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODcyMzQ5OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODkyMjM5Ng==", "url": "https://github.com/INRIA/spoon/pull/3244#discussion_r378922396", "bodyText": "Thanks for the explanation :)\n\nThe regex looks for imports containing internal and not containing spoon or jdt.\n\nnice I had to check back the Pattern documentation to find that ?! was for a:\n\n(?!X) | X, via zero-width negative lookahead\n\ndidn't know about that :)\n\nShould i add a comment in the pom for clarification?\n\nThat would be really cool. At least one line such as the quote above and one example of allowed/rejected. Thanks", "author": "surli", "createdAt": "2020-02-13T15:13:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODcyMzQ5OA=="}], "type": "inlineReview"}, {"oid": "cd10c80b3b83f506efc5896d5f1fb329ea279fe7", "url": "https://github.com/INRIA/spoon/commit/cd10c80b3b83f506efc5896d5f1fb329ea279fe7", "message": "add comment to import check for clarification", "committedDate": "2020-02-13T15:19:51Z", "type": "commit"}]}