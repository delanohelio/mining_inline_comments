{"pr_number": 857, "pr_title": "CLDR-13139 Upgrade Tomcat using Ansible", "pr_createdAt": "2020-11-25T04:32:00Z", "pr_url": "https://github.com/unicode-org/cldr/pull/857", "timeline": [{"oid": "95cd6819586d3e91633abfb6163ed8a5e7769db2", "url": "https://github.com/unicode-org/cldr/commit/95cd6819586d3e91633abfb6163ed8a5e7769db2", "message": "CLDR-13139 Upgrade Tomcat using Ansible\n\n-Revise tomcat-playbook.yml to use robertdebock.tomcat\n\n-Move parts of vars/main.yml to new mysql.yml, tomcat.yml\n\n-Make cldr_tomcat_conf_path end in /conf\n\n-Use only /etc/tomcat, never /var/lib/tomcat (which no longer exists)\n\n-Remove roles.yml; use requirements.yml instead in ansible-lint.yml\n\n-Update README.md: requirements.yml not roles.yml; mvn not ant\n\n-Revise context.j2: com.mysql.cj.jdbc.Driver not com.mysql.jdbc.Driver; cachingAllowed; cacheMaxSize\n\n-For vagrant only, new vagrant-playbook.yml; just calls setup-playbook.yml but adds flexibility\n\n-Remove problematic AJP section from server.xml\n\n-In deploy-sh.j2 use only spaces for indentation, rather than mix tabs and spaces", "committedDate": "2020-11-25T04:14:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDQyMzAwOQ==", "url": "https://github.com/unicode-org/cldr/pull/857#discussion_r530423009", "bodyText": "only changed tabs to spaces in this file, no significant change", "author": "btangmu", "createdAt": "2020-11-25T14:40:57Z", "path": "tools/scripts/ansible/templates/deploy-sh.j2", "diffHunk": "@@ -11,8 +11,8 @@ dogit() {\n     rm -f ${WORKDIR}/git-list.txt\n     if [[ ${GITHUB_SHA} = \"master\" ]];\n     then\n-\techo \"changing 'master' to 'origin/master' to get the latest\"\n-\tGITHUB_SHA=origin/master\n+        echo \"changing 'master' to 'origin/master' to get the latest\"\n+        GITHUB_SHA=origin/master\n     fi", "originalCommit": "95cd6819586d3e91633abfb6163ed8a5e7769db2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDQyNTE1NA==", "url": "https://github.com/unicode-org/cldr/pull/857#discussion_r530425154", "bodyText": "avoid:\nSEVERE [main] org.apache.catalina.util.LifecycleBase.handleSubClassException Failed to start component [Connector[AJP/1.3-8009]]\norg.apache.catalina.LifecycleException: Protocol handler start failed\nat org.apache.catalina.connector.Connector.startInternal(Connector.java:1067)\nat org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:183)\nat org.apache.catalina.core.StandardService.startInternal(StandardService.java:438)\nat org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:183)\nat org.apache.catalina.core.StandardServer.startInternal(StandardServer.java:930)\nat org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:183)\nat org.apache.catalina.startup.Catalina.start(Catalina.java:633)\nat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\nat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\nat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\nat java.base/java.lang.reflect.Method.invoke(Method.java:566)\nat org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:343)\nat org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:474)\nCaused by: java.lang.IllegalArgumentException: The AJP Connector is configured with secretRequired=\"true\" but the secret attribute is either null or \"\". This combination is not valid.\nat org.apache.coyote.ajp.AbstractAjpProtocol.start(AbstractAjpProtocol.java:270)", "author": "btangmu", "createdAt": "2020-11-25T14:43:56Z", "path": "tools/scripts/ansible/templates/server.xml", "diffHunk": "@@ -84,15 +84,6 @@\n          style configuration. When using the APR/native implementation, the\n          OpenSSL style configuration is required as described in the APR/native\n          documentation -->\n-    <!--\n-    <Connector address=\"127.0.0.1\" port=\"8443\" protocol=\"org.apache.coyote.http11.Http11NioProtocol\"\n-               maxThreads=\"150\" SSLEnabled=\"true\" scheme=\"https\" secure=\"true\"\n-               clientAuth=\"false\" sslProtocol=\"TLS\" />\n-    -->\n-\n-    <!-- Define an AJP 1.3 Connector on port 8009 -->\n-    <Connector address=\"127.0.0.1\" port=\"8009\" protocol=\"AJP/1.3\" redirectPort=\"8443\" />\n-", "originalCommit": "95cd6819586d3e91633abfb6163ed8a5e7769db2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDQzODU3NQ==", "url": "https://github.com/unicode-org/cldr/pull/857#discussion_r530438575", "bodyText": "Fair enough\u2026\u00a0nginx recommends proxying with http instead of AJP: https://docs.nginx.com/nginx/deployment-guides/load-balance-third-party/apache-tomcat/", "author": "srl295", "createdAt": "2020-11-25T15:01:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDQyNTE1NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDQ1NzMwNg==", "url": "https://github.com/unicode-org/cldr/pull/857#discussion_r530457306", "bodyText": "I'm glad you knew that! I didn't, and I don't know for sure that we don't need AJP at all -- we'll see what happens on smoketest! BTW probably we don't need to supply an entire server.xml template; we could instead configure robertdebock.tomcat at a higher level", "author": "btangmu", "createdAt": "2020-11-25T15:27:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDQyNTE1NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDQ4NDY2OA==", "url": "https://github.com/unicode-org/cldr/pull/857#discussion_r530484668", "bodyText": "AJP is another proxy protocol (non-HTTP). We don't use it.  \"JK\" is another protocol you might read of somewhere.\nTomcat turns it on by default, but since we don't need it, best to just throw it out", "author": "srl295", "createdAt": "2020-11-25T16:04:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDQyNTE1NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDQ4NTEyMA==", "url": "https://github.com/unicode-org/cldr/pull/857#discussion_r530485120", "bodyText": "See this apache httpd example line showing how to connect to an AJP service:\nhttps://httpd.apache.org/docs/2.4/mod/mod_proxy_ajp.html#usage", "author": "srl295", "createdAt": "2020-11-25T16:05:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDQyNTE1NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDQzODc3Mg==", "url": "https://github.com/unicode-org/cldr/pull/857#discussion_r530438772", "bodyText": "this is a great idea.", "author": "srl295", "createdAt": "2020-11-25T15:02:11Z", "path": "tools/scripts/ansible/vagrant-playbook.yml", "diffHunk": "@@ -0,0 +1,2 @@\n+- import_playbook: setup-playbook.yml\n+# Note: any additional setup specifically for vagrant could be done here, such as adding a self-signed ssl cert", "originalCommit": "95cd6819586d3e91633abfb6163ed8a5e7769db2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}