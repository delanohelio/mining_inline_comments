{"pr_number": 762, "pr_title": "CLDR-14216 Automate ST db redaction for cldr-smoke", "pr_createdAt": "2020-10-05T22:08:01Z", "pr_url": "https://github.com/unicode-org/cldr/pull/762", "timeline": [{"oid": "a8b7d19b95ed4723ada5c862b316c26cd291bd6f", "url": "https://github.com/unicode-org/cldr/commit/a8b7d19b95ed4723ada5c862b316c26cd291bd6f", "message": "CLDR-14216 Automate ST db redaction for cldr-smoke\n\n-New redact-db-playbook.yml to set up and perform redaction\n\n-New redact-db.sql, fetch_db_sh.j2 and redact_db_sh.j2", "committedDate": "2020-10-05T22:06:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTkxOTc0NQ==", "url": "https://github.com/unicode-org/cldr/pull/762#discussion_r499919745", "bodyText": "good, so this one is a little different than other playbooks in that it is meant to be run only when redact is needed. Sounds good.  It's not included in setup playbook, for example.", "author": "srl295", "createdAt": "2020-10-05T23:09:11Z", "path": "tools/scripts/ansible/redact-db-playbook.yml", "diffHunk": "@@ -0,0 +1,73 @@\n+- hosts: redactdb\n+  vars_files:\n+    - vars/main.yml\n+    - local-vars/local.yml\n+  tasks:\n+    - name: set up /home/cldradmin/.ssh/config to fetch db backup\n+      template:\n+        src: templates/cldrbackup/config.j2\n+        dest: /home/cldradmin/.ssh/config\n+        owner: cldradmin\n+        group: cldradmin\n+        mode: '0640'\n+    - name: set up /home/cldradmin/.ssh/id_rsa\n+      no_log: true\n+      copy:\n+        src: local-vars/cldrbackup/id_rsa\n+        dest: /home/cldradmin/.ssh/id_rsa\n+        owner: cldradmin\n+        group: cldradmin\n+        mode: '0600'\n+    - name: set up /home/cldradmin/.ssh/id_rsa.pub\n+      copy:\n+        src: local-vars/cldrbackup/id_rsa.pub\n+        dest: /home/cldradmin/.ssh/id_rsa.pub\n+        owner: cldradmin\n+        group: cldradmin\n+        mode: '0640'\n+    - name: set up /home/cldradmin/.ssh/known_hosts\n+      copy:\n+        src: local-vars/cldrbackup/known_hosts\n+        dest: /home/cldradmin/.ssh/known_hosts\n+        owner: cldradmin\n+        group: cldradmin\n+        mode: '0640'\n+    - name: set up /home/cldradmin/redact-db.sql\n+      copy:\n+        src: templates/cldrbackup/redact-db.sql\n+        dest: /home/cldradmin/redact-db.sql\n+        owner: cldradmin\n+        group: cldradmin\n+        mode: '0640'\n+    - name: set up /home/cldradmin/fetch-db.sh\n+      template:\n+        src: templates/cldrbackup/fetch_db_sh.j2\n+        dest: /home/cldradmin/fetch-db.sh\n+        owner: cldradmin\n+        group: cldradmin\n+        mode: '0640'\n+    - name: set up /home/cldradmin/redact-db.sh\n+      template:\n+        src: templates/cldrbackup/redact_db_sh.j2\n+        dest: /home/cldradmin/redact-db.sh\n+        owner: cldradmin\n+        group: cldradmin\n+        mode: '0640'\n+    - name: fetch and unzip db\n+      command: bash /home/cldradmin/fetch-db.sh\n+      become: yes\n+      become_user: cldradmin\n+    - name: stop tomcat\n+      become: true\n+      service:\n+        name: tomcat8\n+        state: stopped\n+    - name: redact db\n+      command: bash /home/cldradmin/redact-db.sh", "originalCommit": "a8b7d19b95ed4723ada5c862b316c26cd291bd6f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDI5MTE1MA==", "url": "https://github.com/unicode-org/cldr/pull/762#discussion_r500291150", "bodyText": "Right. Running redact-db-playbook.yml is a manual operation that combines configuration with performing an actual redaction. Everything is in Ansible. In the long run we might use a cron job and/or a button like https://github.com/unicode-org/cldr/actions?query=workflow%3Aproduction for the redaction itself. Configuration  without immediately doing the redaction itself should be enabled and probably included in setup-playbook.yml. What do you think?", "author": "btangmu", "createdAt": "2020-10-06T13:45:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTkxOTc0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDMyNjM0MQ==", "url": "https://github.com/unicode-org/cldr/pull/762#discussion_r500326341", "bodyText": "Configuration without immediately doing the redaction itself should be enabled and probably included in setup-playbook.yml.\n\nI think this is fine how it is for now, because we might adjust the parameters in between redaction.\nIf we were automating the redaction, then yes it would move to setup-playbook.", "author": "srl295", "createdAt": "2020-10-06T14:21:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTkxOTc0NQ=="}], "type": "inlineReview"}]}