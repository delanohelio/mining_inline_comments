{"pr_number": 747, "pr_title": "CLDR-14205 Manual trigger for commit checker", "pr_createdAt": "2020-09-30T20:28:24Z", "pr_url": "https://github.com/unicode-org/cldr/pull/747", "timeline": [{"oid": "5d488a5df0c05671ce85207d92c5b0b91a290b38", "url": "https://github.com/unicode-org/cldr/commit/5d488a5df0c05671ce85207d92c5b0b91a290b38", "message": "CLDR-14205 Manual trigger for commit checker\n\n- new ansible playbook for commit checker setup\n- update ansible-lint task to run all playbooks\n- update ansible-lint to lint yaml also\n- new workflow commit-checker (manually run)", "committedDate": "2020-09-30T20:32:37Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODI0NDQyNQ==", "url": "https://github.com/unicode-org/cldr/pull/747#discussion_r498244425", "bodyText": "When we switch the DNS and cldr-smoke2 becomes cldr-smoke, code like this will need updating, likewise for st2 and st ...", "author": "btangmu", "createdAt": "2020-10-01T13:29:09Z", "path": ".github/workflows/commit-checker.yml", "diffHunk": "@@ -0,0 +1,90 @@\n+# Manually run: commit checker\n+\n+name: commit-checker\n+\n+# Triggered on push to master,\n+# or PR against master.\n+on:\n+  workflow_dispatch:\n+    inputs:\n+      end-ref:\n+        description: CLDR Commit to check\n+        required: true\n+        default: 'master'\n+      fix-version:\n+        description: Fix Version (e.g. 38)\n+        default: 38 # TODO: remove, for testing only\n+        required: true\n+      last-version:\n+        description: Last Version (e.g. 37)\n+        default: 37 # TODO: remove, for testing only\n+        required: true\n+      tool-repository:\n+        description: Commit Checker ICU repo\n+        required: true\n+        default: 'srl295/icu' # TODO: remove use next, for testing only\n+        #default: 'unicode-org/icu'\n+      tool-ref:\n+        description: Commit Checker ICU ref\n+        required: true\n+        default: 'cldr-commit-checker' # TODO: remove, use next, for testing only\n+        # default: 'master'\n+jobs:\n+  build:\n+    name: Run Checker\n+    runs-on: ubuntu-latest\n+    steps:\n+      - name: clone CLDR\n+        uses: actions/checkout@v2.3.3\n+        with:\n+          ref: ${{ github.event.inputs.end-ref }}\n+          lfs: false # not needed here\n+          path: cldr\n+          fetch-depth: 0 # expensive, but needed for checker\n+      - name: clone ICU for tools\n+        uses: actions/checkout@v2.3.3\n+        with:\n+          repository: ${{ github.event.inputs.tool-repository }}\n+          ref: ${{ github.event.inputs.tool-ref }}\n+          lfs: false # not needed here\n+          path: icu\n+      #- name: Prepare Check\n+      - name: Run Check and Publish\n+        run: |\n+          END_HASH=$(cd ${GITHUB_WORKSPACE}/cldr ; git rev-parse --short HEAD )\n+          REPORT=\"CLDR-Report-\"$(date +\"%Y-%m-%d\")-v38-${END_HASH}\n+          echo $REPORT\n+          cd icu/tools/commit-checker\n+          command -v pipenv >/dev/null 2>/dev/null || sudo pip3 install pipenv\n+          pipenv install\n+          pipenv run python3 check.py \\\n+          --jira-query \"project=CLDR AND fixVersion=${FV}\" \\\n+          --repo-root ${GITHUB_WORKSPACE}/cldr \\\n+          --github-url https://github.com/unicode-org/cldr \\\n+          --rev-range \"release-${LV}..${END_REF}\" > ${GITHUB_WORKSPACE}/${REPORT}.md\n+          cd ${GITHUB_WORKSPACE}\n+          wc -l ${REPORT}.md\n+          npx markdown-to-html --flavor gfm --title ${REPORT} ${REPORT}.md -c unicode-org/cldr README.md --stylesheet github-markdown.css > ${REPORT}.html\n+          echo \"${RSA_KEY_CCC}\" > ${HOME}/.key && chmod go= ${HOME}/.key\n+          echo \"${CCC_KNOWNHOSTS}\" > ${HOME}/.knownhosts && chmod go= ${HOME}/.knownhosts\n+          ln ${REPORT}.md CLDR_REPORT.md # use a fixed name for the publish step\n+          scp -o UserKnownHostsFile=${HOME}/.knownhosts -i ${HOME}/.key -P ${CCC_PORT} ${REPORT}.md ${REPORT}.html ${CCC_USER}@${CCC_HOST}:public_html/\n+          echo \"Now go to https://cldr-smoke2.unicode.org/cldrcc/${REPORT}.html\"\n+        env:\n+          END_REF: ${{ github.event.inputs.end-ref }}\n+          FV: ${{ github.event.inputs.fix-version }}\n+          LV: ${{ github.event.inputs.last-version }}\n+          # the RSA key for connecting\n+          RSA_KEY_CCC: ${{ secrets.RSA_KEY_CCC }}\n+          # the SSH port\n+          CCC_USER: ${{ secrets.CCC_USER }}\n+          CCC_PORT: 22\n+          # the SSH host\n+          CCC_HOST: cldr-smoke2.unicode.org", "originalCommit": "5d488a5df0c05671ce85207d92c5b0b91a290b38", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODI5NjQ0Mg==", "url": "https://github.com/unicode-org/cldr/pull/747#discussion_r498296442", "bodyText": "Yes.  However, when I made these parameters ('secrets') it obscured them in the logs. So I think it's better this way.", "author": "srl295", "createdAt": "2020-10-01T14:38:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODI0NDQyNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODI1MDA3OA==", "url": "https://github.com/unicode-org/cldr/pull/747#discussion_r498250078", "bodyText": "When can/should these defaults be changed or removed?", "author": "btangmu", "createdAt": "2020-10-01T13:37:06Z", "path": ".github/workflows/commit-checker.yml", "diffHunk": "@@ -0,0 +1,90 @@\n+# Manually run: commit checker\n+\n+name: commit-checker\n+\n+# Triggered on push to master,\n+# or PR against master.\n+on:\n+  workflow_dispatch:\n+    inputs:\n+      end-ref:\n+        description: CLDR Commit to check\n+        required: true\n+        default: 'master'\n+      fix-version:\n+        description: Fix Version (e.g. 38)\n+        default: 38 # TODO: remove, for testing only", "originalCommit": "5d488a5df0c05671ce85207d92c5b0b91a290b38", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODI5NzY0Mw==", "url": "https://github.com/unicode-org/cldr/pull/747#discussion_r498297643", "bodyText": "What I thought of doing is to leave the defaults in for now to make it easier to test (you can just click and click).   And then when we change the DNS over, then remove those so that you have to put in a version number.  There's no reason to keep updating the defaults then.", "author": "srl295", "createdAt": "2020-10-01T14:40:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODI1MDA3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODMwNDAzMw==", "url": "https://github.com/unicode-org/cldr/pull/747#discussion_r498304033", "bodyText": "Also, right now it points at my branch\u2026\u00a0while we are still making changes to the tool. when CLDR is happy with the output, then i will attempt to merge my branch into ICU. Then I can update this workflow to point at ICU itself instead of my fork.", "author": "srl295", "createdAt": "2020-10-01T14:48:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODI1MDA3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDk5ODczOA==", "url": "https://github.com/unicode-org/cldr/pull/747#discussion_r500998738", "bodyText": "I've removed many of the defaults.", "author": "srl295", "createdAt": "2020-10-07T13:10:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODI1MDA3OA=="}], "type": "inlineReview"}, {"oid": "eb25155ecee1e0c2b5315cb6d08e5db6389f4c39", "url": "https://github.com/unicode-org/cldr/commit/eb25155ecee1e0c2b5315cb6d08e5db6389f4c39", "message": "CLDR-14205 Manual trigger for commit checker\n\n- new ansible playbook for commit checker setup\n- update ansible-lint task to run all playbooks\n- update ansible-lint to lint yaml also\n- new workflow commit-checker (manually run)", "committedDate": "2020-10-07T13:08:24Z", "type": "forcePushed"}, {"oid": "2074ff0f8abd19ad22df5e172b207476efb77595", "url": "https://github.com/unicode-org/cldr/commit/2074ff0f8abd19ad22df5e172b207476efb77595", "message": "CLDR-14205 Manual trigger for commit checker\n\n- new ansible playbook for commit checker setup\n- update ansible-lint task to run all playbooks\n- update ansible-lint to lint yaml also\n- new workflow commit-checker (manually run)\n- also fix a linting issue in the redact playbook [CLDR-14216]", "committedDate": "2020-10-07T13:26:42Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTAxMjE3MA==", "url": "https://github.com/unicode-org/cldr/pull/747#discussion_r501012170", "bodyText": "@btangmu https://ansible-lint.readthedocs.io/en/latest/default_rules.html#commands-should-not-change-things-if-nothing-needs-doing normally ansible (it seems) wants to only change state to a fixed status. I think our usage of this playbook is fine, but we need to quell the linter warning.", "author": "srl295", "createdAt": "2020-10-07T13:28:55Z", "path": "tools/scripts/ansible/redact-db-playbook.yml", "diffHunk": "@@ -54,7 +54,8 @@\n         group: cldradmin\n         mode: '0640'\n     - name: fetch and unzip db\n-      command: bash /home/cldradmin/fetch-db.sh", "originalCommit": "2074ff0f8abd19ad22df5e172b207476efb77595", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTA4Mzk4NA==", "url": "https://github.com/unicode-org/cldr/pull/747#discussion_r501083984", "bodyText": "OK, thanks!", "author": "btangmu", "createdAt": "2020-10-07T15:00:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTAxMjE3MA=="}], "type": "inlineReview"}, {"oid": "5ba4f274c3c2c54ff4636865f39043f06b7292a8", "url": "https://github.com/unicode-org/cldr/commit/5ba4f274c3c2c54ff4636865f39043f06b7292a8", "message": "CLDR-14205 Manual trigger for commit checker\n\n- new ansible playbook for commit checker setup\n- update ansible-lint task to run all playbooks\n- update ansible-lint to lint yaml also\n- new workflow commit-checker (manually run)\n- also fix a linting issue in the redact playbook [CLDR-14216]", "committedDate": "2020-10-07T16:40:45Z", "type": "commit"}, {"oid": "5ba4f274c3c2c54ff4636865f39043f06b7292a8", "url": "https://github.com/unicode-org/cldr/commit/5ba4f274c3c2c54ff4636865f39043f06b7292a8", "message": "CLDR-14205 Manual trigger for commit checker\n\n- new ansible playbook for commit checker setup\n- update ansible-lint task to run all playbooks\n- update ansible-lint to lint yaml also\n- new workflow commit-checker (manually run)\n- also fix a linting issue in the redact playbook [CLDR-14216]", "committedDate": "2020-10-07T16:40:45Z", "type": "forcePushed"}]}