{"pr_number": 870, "pr_title": "CLDR-14057 Survey Tool CLDR_PHASE=FINAL_TESTING should not allow vetters to vote", "pr_createdAt": "2020-12-07T21:03:05Z", "pr_url": "https://github.com/unicode-org/cldr/pull/870", "timeline": [{"oid": "f7391c01de262c861ba09e1409c7596c15038e01", "url": "https://github.com/unicode-org/cldr/commit/f7391c01de262c861ba09e1409c7596c15038e01", "message": "CLDR-14057 Survey Tool CLDR_PHASE=FINAL_TESTING should not allow vetters to vote\n\n-New function SurveyMain.isPhaseFinalTesting called by userCanModifyLocaleWhy and manage.jsp\n\n-New message ModifyDenial.DENY_PHASE_FINAL_TESTING\n\n-Clean up formatting of enum ModifyDenial\n\n-Fix compiler warnings about static SurveyMain.QUERY_DO and SurveyMain.getNewVersion\n\n-Fix compiler warning about UserRegistry.writeUserFile, call out.close before return\n\n-Remove superfluously duplicated CLDR_PHASE setting in cldr-properties.j2\n\n-Delete some dead code", "committedDate": "2020-12-07T21:00:52Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzgzMjEzMQ==", "url": "https://github.com/unicode-org/cldr/pull/870#discussion_r537832131", "bodyText": "DENY_PHASE_FINAL_TESTING is new; the rest is just reformatted", "author": "btangmu", "createdAt": "2020-12-07T21:05:37Z", "path": "tools/cldr-apps/src/main/java/org/unicode/cldr/web/UserRegistry.java", "diffHunk": "@@ -1760,10 +1760,15 @@ static boolean localeMatchesLocaleList(String localeList, CLDRLocale locale) {\n     }\n \n     public enum ModifyDenial {\n-        DENY_NULL_USER(\"No user specified\"), DENY_LOCALE_READONLY(\"Locale is read-only\"), DENY_PHASE_READONLY(\n-            \"SurveyTool is in read-only mode\"), DENY_ALIASLOCALE(\"Locale is an alias\"), DENY_DEFAULTCONTENT(\n-                \"Locale is the Default Content for another locale\"), DENY_PHASE_CLOSED(\"SurveyTool is in 'closed' phase\"), DENY_NO_RIGHTS(\n-                    \"User does not have any voting rights\"), DENY_LOCALE_LIST(\"User does not have rights to vote for this locale\");\n+        DENY_NULL_USER(\"No user specified\"),\n+        DENY_LOCALE_READONLY(\"Locale is read-only\"),\n+        DENY_PHASE_READONLY(\"SurveyTool is in read-only mode\"),\n+        DENY_ALIASLOCALE(\"Locale is an alias\"),\n+        DENY_DEFAULTCONTENT(\"Locale is the Default Content for another locale\"),\n+        DENY_PHASE_CLOSED(\"SurveyTool is in 'closed' phase\"),\n+        DENY_NO_RIGHTS(\"User does not have any voting rights\"),\n+        DENY_LOCALE_LIST(\"User does not have rights to vote for this locale\"),\n+        DENY_PHASE_FINAL_TESTING(\"SurveyTool is in the 'final testing' phase\");", "originalCommit": "f7391c01de262c861ba09e1409c7596c15038e01", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzgzMjY3OQ==", "url": "https://github.com/unicode-org/cldr/pull/870#discussion_r537832679", "bodyText": "This fixes a compiler warning -- unrelated to this ticket but same file and too small for its own ticket", "author": "btangmu", "createdAt": "2020-12-07T21:06:31Z", "path": "tools/cldr-apps/src/main/java/org/unicode/cldr/web/UserRegistry.java", "diffHunk": "@@ -2453,6 +2461,7 @@ int writeUserFile(SurveyMain sm, String ourDate, boolean obscured, File outFile)\n                 rs = ps.executeQuery();\n                 if (rs == null) {\n                     out.println(\"\\t<!-- No results -->\");\n+                    out.close();", "originalCommit": "f7391c01de262c861ba09e1409c7596c15038e01", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzgzMzQ0Mg==", "url": "https://github.com/unicode-org/cldr/pull/870#discussion_r537833442", "bodyText": "This is the most essential addition. The other changes in this file fix compiler warnings or delete dead (\"if false\") code", "author": "btangmu", "createdAt": "2020-12-07T21:07:46Z", "path": "tools/cldr-apps/src/main/webapp/WEB-INF/tmpl/manage.jsp", "diffHunk": "@@ -55,9 +52,11 @@ String helpName = subCtx.getString(\"helpName\");\n                 subCtx.println(\"<br> (Note: in the Vetting phase, you may not submit new data.) \");\n             } else if(SurveyMain.isPhaseClosed() && !UserRegistry.userIsTC(subCtx.session.user)) {\n                 subCtx.println(\"<br>(SurveyTool is closed to vetting and data submissions.)\");\n+            } else if (SurveyMain.isPhaseFinalTesting() && !UserRegistry.userIsTC(subCtx.session.user)) {\n+                subCtx.println(\"(SurveyTool is in the Final Testing phase; you may not vote.)\");\n             }", "originalCommit": "f7391c01de262c861ba09e1409c7596c15038e01", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzgzMzgyNA==", "url": "https://github.com/unicode-org/cldr/pull/870#discussion_r537833824", "bodyText": "Somehow this template had \"CLDR_PHASE=BETA\" twice but only needs it once", "author": "btangmu", "createdAt": "2020-12-07T21:08:28Z", "path": "tools/scripts/ansible/templates/cldr-properties.j2", "diffHunk": "@@ -22,9 +22,6 @@ CLDR_OLDVERSION={{ surveytooldeploy.oldversion }}\n ## 'new'  version\n CLDR_NEWVERSION={{ surveytooldeploy.newversion }}\n \n-## Current SurveyTool phase \n-CLDR_PHASE=BETA\n-\n ## CLDR trunk. Default value shown", "originalCommit": "f7391c01de262c861ba09e1409c7596c15038e01", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}