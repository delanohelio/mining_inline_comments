{"pr_number": 601, "pr_title": "CLDR-13948 deploy to cldr-smoke2 on merge", "pr_createdAt": "2020-07-31T05:26:19Z", "pr_url": "https://github.com/unicode-org/cldr/pull/601", "timeline": [{"oid": "08d35e11e28280e7f91e76821787b5765f2153d5", "url": "https://github.com/unicode-org/cldr/commit/08d35e11e28280e7f91e76821787b5765f2153d5", "message": "CLDR-13948 deploy TEST", "committedDate": "2020-07-31T05:26:51Z", "type": "forcePushed"}, {"oid": "9e418af3f7bd900af6fd92e55379021b5ec9d63c", "url": "https://github.com/unicode-org/cldr/commit/9e418af3f7bd900af6fd92e55379021b5ec9d63c", "message": "CLDR-13948 deploy to cldr-ref on push\n\n- restructure build\n- on merge, update cldr-ref", "committedDate": "2020-07-31T19:47:18Z", "type": "forcePushed"}, {"oid": "70038bd12a2a60d29f221fe22e5a84c2d993f7a7", "url": "https://github.com/unicode-org/cldr/commit/70038bd12a2a60d29f221fe22e5a84c2d993f7a7", "message": "CLDR-13948 deploy to cldr-ref on push\n\n- restructure build\n- on merge, update cldr-ref", "committedDate": "2020-07-31T19:51:11Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzg2Njc3Nw==", "url": "https://github.com/unicode-org/cldr/pull/601#discussion_r463866777", "bodyText": "Note: this workflow is configured to execute on push events only on the master branch (which is what gets triggered when merging a PR).  Which makes sense, as it does for certain other things (ex: we have our API docs re-generate only on merges to master).\nThe comment \"Only on push\" kinda of obfuscates that fact, so maybe reword?", "author": "echeran", "createdAt": "2020-07-31T22:07:08Z", "path": ".github/workflows/ant.yml", "diffHunk": "@@ -60,10 +57,105 @@ jobs:\n       with:\n         name: cldr-apps\n         path: tools/cldr-apps/cldr-apps.war\n+  surveytest:\n+    needs: build\n+    runs-on: ubuntu-latest\n+    steps:\n+    - uses: actions/checkout@v2\n+      with:\n+        lfs: true # important!\n+    - name: Set up JDK 1.8\n+      uses: actions/setup-java@v1\n+      with:\n+        java-version: 1.8\n+    - name: Download cldr.jar\n+      uses: actions/download-artifact@v2\n+      with:\n+        name: cldr-tools\n+        path: tools/java/dist/for-build\n+    - name: Download cldr-apps.war\n+      uses: actions/download-artifact@v2\n+      with:\n+        name: cldr-apps\n+        path: tools/java/dist/for-build\n+    # Cache for Tomcat tarball (load on cache hit, else store at end of job)\n+    - name: Cache for Tomcat tarball\n+      id: cache-tomcat\n+      uses: actions/cache@v2\n+      with:\n+        path: tomcat-tarball\n+        key: ${{ runner.os }}-tomcat-tarball\n+    - name: Download Tomcat # only on cache miss\n+      if: steps.cache-tomcat.outputs.cache-hit != 'true'\n+      run: 'mkdir -p ./tomcat-tarball && cd ./tomcat-tarball && wget -O - \"https://www.apache.org/dyn/mirrors/mirrors.cgi?action=download&filename=tomcat/tomcat-8/v8.5.57/bin/apache-tomcat-8.5.57.tar.gz\" | tar xfpz - ; cd .. '\n+    - name: Alias Tomcat directory\n+      run: ln -svf tomcat-tarball/apache-tomcat-* tomcat\n+    - name: Survey Tool Check\n+      run: ant -noinput -DCLDR_TOOLS=$(pwd)/tools/java -DCATALINA_HOME=$(pwd)/tomcat -f tools/cldr-apps/build.xml check\n+  test:\n+    needs: build\n+    runs-on: ubuntu-latest\n+    steps:\n+    - uses: actions/checkout@v2\n+      with:\n+        lfs: true # important!\n+    - name: Set up JDK 1.8\n+      uses: actions/setup-java@v1\n+      with:\n+        java-version: 1.8\n+    - name: Download cldr.jar\n+      uses: actions/download-artifact@v2\n+      with:\n+        name: cldr-tools\n+        path: tools/java/dist/for-build\n+    - name: Debug\n+      run: find tools/java/dist/for-build -ls\n+    - name: Build tools/cldr-unittest\n+      run: ant -noinput -f tools/cldr-unittest/build.xml -DCLDR_DIR=$(pwd) tests\n     # Now run tests\n     - name: CLDR Unit Test\n       run: ant -noinput unittest -f tools/cldr-unittest/build.xml -DCLDR_DIR=$(pwd)\n     - name: CLDR Data Check\n       run: ant -noinput datacheck -f tools/cldr-unittest/build.xml -DCLDR_DIR=$(pwd)\n-    - name: Survey Tool Check\n-      run: ant -noinput -DCLDR_TOOLS=$(pwd)/tools/java -DCATALINA_HOME=$(pwd)/tomcat -f tools/cldr-apps/build.xml check\n+  deploy:\n+    needs:\n+      - build\n+      - surveytest\n+      - test\n+    runs-on: ubuntu-latest\n+    steps:\n+    - name: Download cldr-apps.war\n+      uses: actions/download-artifact@v2\n+      with:\n+        name: cldr-apps\n+    - name: Deploy to cldr-ref (experimental)\n+      # Only on push.\n+      if: ${{ github.event_name == 'push' }}", "originalCommit": "70038bd12a2a60d29f221fe22e5a84c2d993f7a7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzg5NjIwOA==", "url": "https://github.com/unicode-org/cldr/pull/601#discussion_r463896208", "bodyText": "@echeran the point is that PRs don't cause a deployment, only a merge. The workflow is triggered on pr OR push ( https://github.com/unicode-org/cldr/pull/601/files/70038bd12a2a60d29f221fe22e5a84c2d993f7a7#diff-42c4d583ae6d708ccce679a6fd657ed6L19 )", "author": "srl295", "createdAt": "2020-08-01T00:29:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzg2Njc3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDU0Nzc0OA==", "url": "https://github.com/unicode-org/cldr/pull/601#discussion_r464547748", "bodyText": "@echeran updated the wording of the comment.  As noted above, this workflow is triggered on a PR before merge, not just after merge.", "author": "srl295", "createdAt": "2020-08-03T17:13:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzg2Njc3Nw=="}], "type": "inlineReview"}, {"oid": "7238b7a6e8dfeb7ace7df4bac5e31c1527ca18c7", "url": "https://github.com/unicode-org/cldr/commit/7238b7a6e8dfeb7ace7df4bac5e31c1527ca18c7", "message": "CLDR-13948 deploy to cldr-ref on push\n\n- restructure build\n- on merge, update cldr-ref", "committedDate": "2020-08-03T17:12:43Z", "type": "forcePushed"}, {"oid": "af57d71bb7b4d5a4863bef8035a0e52a7203f06f", "url": "https://github.com/unicode-org/cldr/commit/af57d71bb7b4d5a4863bef8035a0e52a7203f06f", "message": "CLDR-13948 deploy to cldr-smoke2 on push\n\n- restructure build\n- on merge, update cldr-smoke2", "committedDate": "2020-08-19T13:58:03Z", "type": "forcePushed"}, {"oid": "06786fb365adc00423657dce185a5352f08de171", "url": "https://github.com/unicode-org/cldr/commit/06786fb365adc00423657dce185a5352f08de171", "message": "CLDR-13948 deploy to cldr-smoke2 on push\n\n- restructure build\n- on merge, update cldr-smoke2\n\nTEST", "committedDate": "2020-08-19T13:59:41Z", "type": "forcePushed"}, {"oid": "9435ee855755d900c633017f1b4fed99000868db", "url": "https://github.com/unicode-org/cldr/commit/9435ee855755d900c633017f1b4fed99000868db", "message": "CLDR-13948 deploy to cldr-smoke2 on push\n\n- restructure build\n- on merge, update cldr-smoke2\n\nTEST", "committedDate": "2020-08-19T14:00:37Z", "type": "forcePushed"}, {"oid": "d52f94aac728d312e67bf03a795f68aec1033d95", "url": "https://github.com/unicode-org/cldr/commit/d52f94aac728d312e67bf03a795f68aec1033d95", "message": "CLDR-13948 deploy to cldr-smoke2 on push\n\n- restructure build\n- on merge, update cldr-smoke2", "committedDate": "2020-08-19T14:27:19Z", "type": "commit"}, {"oid": "d52f94aac728d312e67bf03a795f68aec1033d95", "url": "https://github.com/unicode-org/cldr/commit/d52f94aac728d312e67bf03a795f68aec1033d95", "message": "CLDR-13948 deploy to cldr-smoke2 on push\n\n- restructure build\n- on merge, update cldr-smoke2", "committedDate": "2020-08-19T14:27:19Z", "type": "forcePushed"}]}