{"pr_number": 722, "pr_title": "CLDR-8753 reduce duplicate Collation construction", "pr_createdAt": "2020-09-22T00:12:24Z", "pr_url": "https://github.com/unicode-org/cldr/pull/722", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjQxNDEyOQ==", "url": "https://github.com/unicode-org/cldr/pull/722#discussion_r492414129", "bodyText": "this class is used in many other spots!", "author": "srl295", "createdAt": "2020-09-22T00:13:00Z", "path": "tools/java/org/unicode/cldr/util/MapComparator.java", "diffHunk": "@@ -24,9 +24,17 @@\n import com.ibm.icu.util.ULocale;\n \n public class MapComparator<K> implements Comparator<K>, Freezable<MapComparator<K>> {", "originalCommit": "63c5b7a8c26882d847e7331a4941565017745b64", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjQxNDIyNw==", "url": "https://github.com/unicode-org/cldr/pull/722#discussion_r492414227", "bodyText": "this is an Emoji-aware English collator, rather than the default (!!) collator.", "author": "srl295", "createdAt": "2020-09-22T00:13:25Z", "path": "tools/java/org/unicode/cldr/util/VettingViewer.java", "diffHunk": "@@ -1005,7 +1004,7 @@ void computeOne(int n) {\n     private void writeSummaryTable(Appendable output, String header, Level desiredLevel,\n         EnumSet<Choice> choices, T organization) throws IOException {\n \n-        Map<String, String> sortedNames = new TreeMap<>(Collator.getInstance());\n+        Map<String, String> sortedNames = new TreeMap<>(CLDRConfig.getInstance().getCollator());", "originalCommit": "63c5b7a8c26882d847e7331a4941565017745b64", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e313eb25050af3422fe7bbea2338e03ecd8a5786", "url": "https://github.com/unicode-org/cldr/commit/e313eb25050af3422fe7bbea2338e03ecd8a5786", "message": "CLDR-8753 reduce duplicate Collation construction\n\n- need to use String.valueOf(...) in some cases.", "committedDate": "2020-09-22T01:07:32Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjQyNzE3NA==", "url": "https://github.com/unicode-org/cldr/pull/722#discussion_r492427174", "bodyText": "I did end up retaining this, just to call String.valueOf\u2026", "author": "srl295", "createdAt": "2020-09-22T01:08:40Z", "path": "tools/java/org/unicode/cldr/util/VoteResolver.java", "diffHunk": "@@ -683,12 +683,15 @@ public T getOrgVoteRaw(Organization orgOfUser) {\n      */\n     private boolean usingKeywordAnnotationVoting = false;\n \n-    private final Comparator<T> ucaCollator = new Comparator<T>() {\n-        Collator col = Collator.getInstance(ULocale.ENGLISH);\n+    private static final Collator englishCollator = Collator.getInstance(ULocale.ENGLISH).freeze();\n \n+    /**\n+     * Used for comparing objects of type T\n+     */\n+    private final Comparator<T> objectCollator = new Comparator<T>() {", "originalCommit": "e313eb25050af3422fe7bbea2338e03ecd8a5786", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjQ0NzA4NQ==", "url": "https://github.com/unicode-org/cldr/pull/722#discussion_r492447085", "bodyText": "If we are sure this will be called at least ones by all users of MapComparator, this is fine. Otherwise would be good to use the Singleton thread-safe pattern (see other ticket).", "author": "macchiati", "createdAt": "2020-09-22T02:44:44Z", "path": "tools/java/org/unicode/cldr/util/MapComparator.java", "diffHunk": "@@ -24,9 +24,17 @@\n import com.ibm.icu.util.ULocale;\n \n public class MapComparator<K> implements Comparator<K>, Freezable<MapComparator<K>> {\n-    private RuleBasedCollator uca = (RuleBasedCollator) Collator.getInstance(ULocale.ROOT);\n-    {\n-        uca.setNumericCollation(true);\n+    // initialize this once\n+    private static final Collator uca = getUCA();\n+\n+    /**\n+     * This does not change, so we can create one and freeze it.\n+     * @return\n+     */\n+    private static Collator getUCA() {", "originalCommit": "e313eb25050af3422fe7bbea2338e03ecd8a5786", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjQ1Mjg0OA==", "url": "https://github.com/unicode-org/cldr/pull/722#discussion_r492452848", "bodyText": "it's used exactly once, in initializing the uca static member. Singleton pattern would be fine here too.", "author": "srl295", "createdAt": "2020-09-22T03:12:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjQ0NzA4NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjQ1Mjk0Nw==", "url": "https://github.com/unicode-org/cldr/pull/722#discussion_r492452947", "bodyText": "I'll check the other ticket and update this tomorrow\u2026good point. let's start to propagate that pattern.", "author": "srl295", "createdAt": "2020-09-22T03:13:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjQ0NzA4NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjg1MzQ5Ng==", "url": "https://github.com/unicode-org/cldr/pull/722#discussion_r492853496", "bodyText": "CLDR-14180", "author": "srl295", "createdAt": "2020-09-22T15:58:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjQ0NzA4NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjg1MzYwNg==", "url": "https://github.com/unicode-org/cldr/pull/722#discussion_r492853606", "bodyText": "updated.", "author": "srl295", "createdAt": "2020-09-22T15:58:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjQ0NzA4NQ=="}], "type": "inlineReview"}, {"oid": "9bb2bd4b61cb53d689a03b27376a3f0f43691811", "url": "https://github.com/unicode-org/cldr/commit/9bb2bd4b61cb53d689a03b27376a3f0f43691811", "message": "CLDR-14184 further updates to statistics page\n\n- turn x axis label to reduce crowding\n- improve spacing along y axis\n- improve wording in legend", "committedDate": "2020-09-22T15:56:29Z", "type": "forcePushed"}, {"oid": "7a54ae9149dfac4f53ffa3b4135cd3b1818d8b2f", "url": "https://github.com/unicode-org/cldr/commit/7a54ae9149dfac4f53ffa3b4135cd3b1818d8b2f", "message": "CLDR-8753 reduce duplicate Collation construction\n\n- need to use String.valueOf(...) in some cases.\n- use Bill Pugh (CLDR-14180) singleton for MapComparator", "committedDate": "2020-09-22T15:57:23Z", "type": "commit"}, {"oid": "7a54ae9149dfac4f53ffa3b4135cd3b1818d8b2f", "url": "https://github.com/unicode-org/cldr/commit/7a54ae9149dfac4f53ffa3b4135cd3b1818d8b2f", "message": "CLDR-8753 reduce duplicate Collation construction\n\n- need to use String.valueOf(...) in some cases.\n- use Bill Pugh (CLDR-14180) singleton for MapComparator", "committedDate": "2020-09-22T15:57:23Z", "type": "forcePushed"}]}