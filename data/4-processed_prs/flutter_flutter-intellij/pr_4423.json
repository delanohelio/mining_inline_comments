{"pr_number": 4423, "pr_title": "Fix API incompatibilities", "pr_createdAt": "2020-03-10T22:25:52Z", "pr_url": "https://github.com/flutter/flutter-intellij/pull/4423", "timeline": [{"oid": "286e57dbce775699c8ae8048abfb5ce860254f23", "url": "https://github.com/flutter/flutter-intellij/commit/286e57dbce775699c8ae8048abfb5ce860254f23", "message": "Fix API incompatibilities", "committedDate": "2020-03-10T22:22:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDY2MTAyNA==", "url": "https://github.com/flutter/flutter-intellij/pull/4423#discussion_r390661024", "bodyText": "does this need \"// for 4.0\"", "author": "kenzieschmoll", "createdAt": "2020-03-10T23:05:26Z", "path": "flutter-studio/src/io/flutter/project/FlutterProjectSystem.java", "diffHunk": "@@ -102,27 +102,19 @@ public ProjectSystemSyncManager getSyncManager() {\n     }\n   }\n \n-  @SuppressWarnings(\"override\")\n-  public boolean getAugmentRClasses() {\n-    // TODO(messick) Remove when 3.5 is stable\n-    return false;\n-  }\n-\n   @NotNull\n   @SuppressWarnings(\"override\")\n   public LightResourceClassService getLightResourceClassService() {\n     return gradleProjectSystem.getLightResourceClassService();\n   }\n \n-  @NotNull\n-  @SuppressWarnings(\"override\")\n-  public SourceProvidersFactory getSourceProvidersFactory() {\n-    return gradleProjectSystem.getSourceProvidersFactory();\n-  }\n+  //@NotNull\n+  //public SourceProvidersFactory getSourceProvidersFactory() {\n+  //  return gradleProjectSystem.getSourceProvidersFactory();\n+  //} // for 4.0\n \n-  @NotNull\n-  @SuppressWarnings(\"override\")\n-  public Collection<Module> getSubmodules() {\n-    return gradleProjectSystem.getSubmodules();\n-  }\n+  //@NotNull\n+  //public Collection<Module> getSubmodules() {\n+  //  return gradleProjectSystem.getSubmodules();\n+  //}", "originalCommit": "286e57dbce775699c8ae8048abfb5ce860254f23", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTAzMjI1NQ==", "url": "https://github.com/flutter/flutter-intellij/pull/4423#discussion_r391032255", "bodyText": "It is not used. I didn't delete it because I think it will be needed in a later version.", "author": "stevemessick", "createdAt": "2020-03-11T14:56:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDY2MTAyNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDY2MTIxNg==", "url": "https://github.com/flutter/flutter-intellij/pull/4423#discussion_r390661216", "bodyText": "do we need to uncomment the @NotNull  annotations too?", "author": "kenzieschmoll", "createdAt": "2020-03-10T23:06:05Z", "path": "tool/plugin/lib/plugin.dart", "diffHunk": "@@ -715,26 +715,60 @@ class BuildCommand extends ProductCommand {\n           'baseDir.getPath()',\n         );\n         processedFile.writeAsStringSync(source);\n+      }\n \n+      if (spec.version.startsWith('4.')) {\n         processedFile = File(\n             'flutter-studio/src/io/flutter/module/FlutterDescriptionProvider.java');\n         source = processedFile.readAsStringSync();\n         files[processedFile] = source;\n         source = source.replaceAll(\n-          'import com.android.tools.idea.npw.model.ProjectSyncInvoker',\n-          'import com.android.tools.idea.npw.model.NewModuleModel',\n+          'public SkippableWizardStep createStep(@NotNull NewModuleModel model) {',\n+          'public SkippableWizardStep createStep(@NotNull Project project, @NotNull ProjectSyncInvoker invoker, String parent) {',\n+        );\n+        source = source.replaceAll(\n+          'model(model.getProject().getValue()',\n+          'model(project',\n+        );\n+        source = source.replaceAll(\n+          'NewModuleModel',\n+          'NewAndroidModuleModel',\n+        );\n+        processedFile.writeAsStringSync(source);\n+\n+        processedFile = File(\n+            'flutter-studio/src/io/flutter/android/AndroidModuleLibraryManager.java');\n+        source = processedFile.readAsStringSync();\n+        files[processedFile] = source;\n+        source = source.replaceAll(\n+          'super(filePath.toString()',\n+          'super(filePath',\n+        );\n+        source = source.replaceAll(\n+          'getStateStore().setPath(path.toString()',\n+          'getStateStore().setPath(path',\n+        );\n+        processedFile.writeAsStringSync(source);\n+\n+        processedFile = File(\n+            'flutter-studio/src/io/flutter/project/FlutterProjectSystem.java');\n+        source = processedFile.readAsStringSync();\n+        files[processedFile] = source;\n+        source = source.replaceAll(\n+          '//import com.android.tools.idea.projectsystem.SourceProvidersFactory;',\n+          'import com.android.tools.idea.projectsystem.SourceProvidersFactory;',\n         );\n         source = source.replaceAll(\n-          'createStep(@NotNull Project model, @NotNull ProjectSyncInvoker invoker, String parent)',\n-          'createStep(@NotNull NewModuleModel model)',\n+          '//public SourceProvidersFactory getSourceProvidersFactory() {',\n+          'public SourceProvidersFactory getSourceProvidersFactory() {',\n         );\n         source = source.replaceAll(\n-          'FlutterProjectModel model(@NotNull Project project,',\n-          'FlutterProjectModel model(@NotNull NewModuleModel project,',\n+          '//  return gradleProjectSystem.getSourceProvidersFactory();',\n+          '  return gradleProjectSystem.getSourceProvidersFactory();',\n         );\n         source = source.replaceAll(\n-          'mySharedModel.getValue().project().setValue(project);',\n-          'mySharedModel.getValue().project().setValue(project.getProject().getValue());',\n+          '//} // for 4.0',\n+          '} // for 4.0',", "originalCommit": "286e57dbce775699c8ae8048abfb5ce860254f23", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTAzMzI2OA==", "url": "https://github.com/flutter/flutter-intellij/pull/4423#discussion_r391033268", "bodyText": "Those are only used by IntelliJ, and the editing is only temporary during a build, so I don't think there's a need.", "author": "stevemessick", "createdAt": "2020-03-11T14:57:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDY2MTIxNg=="}], "type": "inlineReview"}]}