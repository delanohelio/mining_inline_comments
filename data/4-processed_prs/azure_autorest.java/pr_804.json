{"pr_number": 804, "pr_title": "Support customization code in README", "pr_createdAt": "2020-11-19T07:59:38Z", "pr_url": "https://github.com/Azure/autorest.java/pull/804", "timeline": [{"oid": "8f21c2e5d31b77df921ad084d49786ba277bb739", "url": "https://github.com/Azure/autorest.java/commit/8f21c2e5d31b77df921ad084d49786ba277bb739", "message": "Support customization code in README", "committedDate": "2020-11-19T07:57:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjgwODA1NA==", "url": "https://github.com/Azure/autorest.java/pull/804#discussion_r526808054", "bodyText": "Would the user be able to write this code in a README without the help of compilable code?", "author": "srnagar", "createdAt": "2020-11-19T11:52:05Z", "path": "customization-tests/swagger/README.md", "diffHunk": "@@ -33,6 +33,40 @@ license-header: MICROSOFT_MIT_SMALL\n add-context-parameter: true\n models-subpackage: implementation.models\n context-client-method-parameter: true\n-customization-jar-path: target/bodycomplex-customization-1.0.0-beta.1.jar\n-customization-class: fixtures.bodycomplex.customization.BodyComplexCustomization\n+customization-class: BodyComplexCustomization\n ```\n+\n+### Customization\n+```java\n+public class BodyComplexCustomization extends Customization {", "originalCommit": "8f21c2e5d31b77df921ad084d49786ba277bb739", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzI1NjY0NA==", "url": "https://github.com/Azure/autorest.java/pull/804#discussion_r527256644", "bodyText": "Without an IDE it's definitely harder to write this. But that's a tradeoff users will have to make. They can opt for easier customization coding but have to set up a maven project, or opt for easier setup but lose IDE features.", "author": "jianghaolu", "createdAt": "2020-11-19T22:50:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjgwODA1NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjgwOTQ3OQ==", "url": "https://github.com/Azure/autorest.java/pull/804#discussion_r526809479", "bodyText": "How does the user specify import statements if this code requires some additional classes that have to be imported?", "author": "srnagar", "createdAt": "2020-11-19T11:54:36Z", "path": "customization-tests/swagger/README.md", "diffHunk": "@@ -33,6 +33,40 @@ license-header: MICROSOFT_MIT_SMALL\n add-context-parameter: true\n models-subpackage: implementation.models\n context-client-method-parameter: true\n-customization-jar-path: target/bodycomplex-customization-1.0.0-beta.1.jar\n-customization-class: fixtures.bodycomplex.customization.BodyComplexCustomization\n+customization-class: BodyComplexCustomization\n ```\n+\n+### Customization\n+```java\n+public class BodyComplexCustomization extends Customization {\n+    @Override\n+    public void customize(LibraryCustomization customization) {\n+        PackageCustomization implementationModels = customization.getPackage(\"fixtures.bodycomplex.implementation.models\");", "originalCommit": "8f21c2e5d31b77df921ad084d49786ba277bb739", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzI1NTY5Ng==", "url": "https://github.com/Azure/autorest.java/pull/804#discussion_r527255696", "bodyText": "The users don't have to specify the imports if they are not ambiguous. Otherwise they could write import aa.bbb.ccc; above the class definition. The code here is simply injected into a maven project that has customization-base as a dependency.", "author": "jianghaolu", "createdAt": "2020-11-19T22:48:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjgwOTQ3OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjg0NjM0MQ==", "url": "https://github.com/Azure/autorest.java/pull/804#discussion_r526846341", "bodyText": "Could there be a security risk if jarUrl can be loaded from remote?", "author": "weidongxu-microsoft", "createdAt": "2020-11-19T12:37:33Z", "path": "postprocessor/src/main/java/com/azure/autorest/postprocessor/Postprocessor.java", "diffHunk": "@@ -26,16 +40,25 @@ public Postprocessor(Connection connection, String plugin, String sessionId) {\n     super(connection, plugin, sessionId);\n   }\n \n+  @SuppressWarnings(\"unchecked\")\n   @Override\n   public boolean processInternal() {\n     List<String> files = listInputs();\n     Map<String, String> fileContents = files.stream().collect(Collectors.toMap(f -> f, this::readFile));\n \n+    String jarPath = JavaSettings.getInstance().getCustomizationJarPath();\n+    String className = JavaSettings.getInstance().getCustomizationClass();\n+    Map.Entry<String, String> readme = getReadme();\n+\n+    if (className == null || (jarPath == null && readme == null)) {\n+      logger.warn(\"Must provide a JAR path or a README.md config containing the customization class {}\", className);\n+      return false;\n+    }\n+\n     try {\n       //Step 1: post process\n-      String jarPath = JavaSettings.getInstance().getCustomizationJarPath();\n-      String className = JavaSettings.getInstance().getCustomizationClass();\n-      if (jarPath != null && className != null) {\n+      Class<? extends Customization> customizationClass;\n+      if (jarPath != null) {", "originalCommit": "8f21c2e5d31b77df921ad084d49786ba277bb739", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzMyNjQ4NQ==", "url": "https://github.com/Azure/autorest.java/pull/804#discussion_r527326485", "bodyText": "Can you elaborate on the risk here? It can be loaded from anywhere over the Internet, but it's passed in by the user and it's the user's responsibility to make sure they don't load random jars from untrusted sources.", "author": "jianghaolu", "createdAt": "2020-11-20T00:58:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjg0NjM0MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODI5NjkxNQ==", "url": "https://github.com/Azure/autorest.java/pull/804#discussion_r528296915", "bodyText": "Actually, I do not exactly know. Theoretically someone can modify the url hiding it among other changes in a submitted PR (to a lib that uses autorest.java), trick dev to test the PR and hence run the jar, and the jar would grab env and pass file from local disk, upload them to remote site. Will it happen? No idea. The risk probably is not significant at this stage. Does it worth some mitigation e.g. SecurityManager, or just disable remote jar? Not sure.", "author": "weidongxu-microsoft", "createdAt": "2020-11-22T07:47:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjg0NjM0MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjI1ODI4Mw==", "url": "https://github.com/Azure/autorest.java/pull/804#discussion_r552258283", "bodyText": "I think we should phase out passing in a separate jar - and use either the readme or a central location in the repo. So I'll not do too much here", "author": "jianghaolu", "createdAt": "2021-01-05T23:24:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjg0NjM0MQ=="}], "type": "inlineReview"}, {"oid": "7537740ca74b7da622b49244816a13c4d8cb9d96", "url": "https://github.com/Azure/autorest.java/commit/7537740ca74b7da622b49244816a13c4d8cb9d96", "message": "Merge branch 'v4' of github.com:Azure/autorest.java into customizationreadme", "committedDate": "2021-01-05T23:35:08Z", "type": "commit"}]}