{"pr_number": 1643, "pr_title": "update mssql script 2.1 to 3.2 migration", "pr_createdAt": "2020-08-10T05:10:14Z", "pr_url": "https://github.com/wso2/docs-apim/pull/1643", "timeline": [{"oid": "bdcf187f3f4f9019ebaf2f3a185306e0f6c2afdd", "url": "https://github.com/wso2/docs-apim/commit/bdcf187f3f4f9019ebaf2f3a185306e0f6c2afdd", "message": "update mssql script 2.1 to 3.2 migration", "committedDate": "2020-08-10T05:09:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY5MTExOA==", "url": "https://github.com/wso2/docs-apim/pull/1643#discussion_r467691118", "bodyText": "Shall we remove this extra line?", "author": "Meruja", "createdAt": "2020-08-10T05:14:59Z", "path": "en/docs/install-and-setup/upgrading-wso2-api-manager/upgrading-from-210-to-320.md", "diffHunk": "@@ -1463,7 +1468,43 @@ Follow the instructions below to move all the existing API Manager configuration\n             UNIQUE (API_ID,TYPE,FIELD)\n         );\n         \n+        ALTER TABLE AM_APPLICATION_KEY_MAPPING ADD UUID VARCHAR(50);\n+        GO\n+        UPDATE AM_APPLICATION_KEY_MAPPING SET UUID = NEWID() WHERE UUID IS NULL;\n+        GO\n+        ALTER TABLE AM_APPLICATION_KEY_MAPPING ADD KEY_MANAGER VARCHAR(50) NOT NULL DEFAULT 'Resident Key Manager';\n+        ALTER TABLE AM_APPLICATION_KEY_MAPPING ADD APP_INFO VARBINARY;\n+        ALTER TABLE AM_APPLICATION_KEY_MAPPING ADD CONSTRAINT app_key_unique_cns UNIQUE (APPLICATION_ID,KEY_TYPE,KEY_MANAGER);\n+\n+        DECLARE @ap_keymap as VARCHAR(8000);\n+        SET @ap_keymap = (SELECT name from sys.objects where parent_object_id=object_id('AM_APPLICATION_KEY_MAPPING') AND type='PK');\n+        EXEC('ALTER TABLE AM_APPLICATION_KEY_MAPPING\n+        drop CONSTRAINT ' + @ap_keymap);\n+\n         UPDATE IDN_OAUTH_CONSUMER_APPS SET CALLBACK_URL='' WHERE CALLBACK_URL IS NULL;\n+        \n+        IF NOT  EXISTS (SELECT * FROM SYS.OBJECTS WHERE OBJECT_ID = OBJECT_ID(N'[DBO].[AM_SCOPE]') AND TYPE IN (N'U'))\n+        CREATE TABLE AM_SCOPE (\n+        SCOPE_ID INTEGER IDENTITY,\n+        NAME VARCHAR(255) NOT NULL,\n+        DISPLAY_NAME VARCHAR(255) NOT NULL,\n+        DESCRIPTION VARCHAR(512),\n+        TENANT_ID INTEGER NOT NULL DEFAULT -1,\n+        SCOPE_TYPE VARCHAR(255) NOT NULL,\n+        PRIMARY KEY (SCOPE_ID)\n+        );\n+\n+", "originalCommit": "bdcf187f3f4f9019ebaf2f3a185306e0f6c2afdd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "4e1c51a86d8381a8555a7ab138602851072631cf", "url": "https://github.com/wso2/docs-apim/commit/4e1c51a86d8381a8555a7ab138602851072631cf", "message": "remove extra line", "committedDate": "2020-08-10T05:18:34Z", "type": "commit"}]}