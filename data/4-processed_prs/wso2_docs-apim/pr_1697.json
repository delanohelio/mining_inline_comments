{"pr_number": 1697, "pr_title": "Adds documentation on custom scope creation for analytics.", "pr_createdAt": "2020-08-13T10:11:54Z", "pr_url": "https://github.com/wso2/docs-apim/pull/1697", "timeline": [{"oid": "bfbf8eb4a4de755ba3e95f878af87bacbe2abe18", "url": "https://github.com/wso2/docs-apim/commit/bfbf8eb4a4de755ba3e95f878af87bacbe2abe18", "message": "Adds documentation on custom scope creation for analytics.", "committedDate": "2020-08-13T10:00:03Z", "type": "commit"}, {"oid": "df8c90a4adfe68a7829ac53ef4e07b8444a79a25", "url": "https://github.com/wso2/docs-apim/commit/df8c90a4adfe68a7829ac53ef4e07b8444a79a25", "message": "Adds a trailing new line.", "committedDate": "2020-08-13T10:07:36Z", "type": "commit"}, {"oid": "aac223045115b81741cde9e15c62b547804f6e6b", "url": "https://github.com/wso2/docs-apim/commit/aac223045115b81741cde9e15c62b547804f6e6b", "message": "Fixes formatting in the config.", "committedDate": "2020-08-14T05:04:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDk3MDM1NQ==", "url": "https://github.com/wso2/docs-apim/pull/1697#discussion_r470970355", "bodyText": "what is the \"dashboard runtime\"? Don't we call t the analytics dashboard? If not, how do we set it up? Shall we link to the place where we can set it up? We need to add it as a pre requisite to the steps as well.", "author": "shaniR", "createdAt": "2020-08-15T12:01:43Z", "path": "en/docs/learn/analytics/managing-dashboard-permissions.md", "diffHunk": "@@ -1,6 +1,6 @@\n # Managing Analytics Dashboard Permissions\n \n-You can view the API statistics related to both the API Publisher and the Developer Portal using the **dashboard** runtime of the WSO2 API-M Analytics server.\n+You can view the API statistics related to both the API Publisher and the Developer Portal using the **dashboard** runtime of the WSO2 API Manager Analytics server.", "originalCommit": "aac223045115b81741cde9e15c62b547804f6e6b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTI1OTY5MA==", "url": "https://github.com/wso2/docs-apim/pull/1697#discussion_r471259690", "bodyText": "API Manager Analytics has two runtime profiles, namely dashboard and worker. The worker receives the events and does the necessary summarizations and dashboard profile used to visualize the statistics. Yes, both dashboard runtime and analytics dashboards are interchangeable. Better to use the term analytics dashboard. For this case don't think we have to add that as a pre-requisite.", "author": "Ketharan", "createdAt": "2020-08-17T06:39:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDk3MDM1NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTM0ODA5NA==", "url": "https://github.com/wso2/docs-apim/pull/1697#discussion_r471348094", "bodyText": "Fixed with ab12d89", "author": "Ketharan", "createdAt": "2020-08-17T09:15:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDk3MDM1NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDk3MDQzMg==", "url": "https://github.com/wso2/docs-apim/pull/1697#discussion_r470970432", "bodyText": "WSO2 API Manager Analytics uses a set of scopes  - > WSO2 API Manager Analytics makes use of a set of scopes", "author": "shaniR", "createdAt": "2020-08-15T12:02:31Z", "path": "en/docs/learn/analytics/managing-dashboard-permissions.md", "diffHunk": "@@ -12,6 +12,101 @@ A dashboard has the following three levels of permissions.\n \n ## Configuring Dashboard Permissions\n \n+To support fine-grained access and permission control, WSO2 API Manager Analytics uses a set of scopes. Those scopes are assigned to each dashboard, mapping to different permission levels described above. The following table illustrates the default mapping between scopes and permission levels for each dashboard.", "originalCommit": "aac223045115b81741cde9e15c62b547804f6e6b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDk3MDgxNg==", "url": "https://github.com/wso2/docs-apim/pull/1697#discussion_r470970816", "bodyText": "Are the above permission levels mapped to roles? If so, we can add the role in the table or simply point to the role mapping table in the user management?", "author": "shaniR", "createdAt": "2020-08-15T12:06:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDk3MDQzMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTI2NTY0NA==", "url": "https://github.com/wso2/docs-apim/pull/1697#discussion_r471265644", "bodyText": "Not exactly. The permission levels are not directly mapped with the roles. A set of scopes can be assigned to permission levels, and since scopes are directly mapped with roles, the mapping between permission levels and roles can be derived. Also, that is customizable by assigning scopes to permission levels. Since this section focuses on that customization, didn;t added the table here. The following section \"Permission level and user role mapping\" contains the table which maps the default permission level to default user roles. Further, the permission levels are defined for the analytics only, we can't point the role mapping table for this purpose.", "author": "Ketharan", "createdAt": "2020-08-17T06:54:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDk3MDQzMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTM0ODk3Ng==", "url": "https://github.com/wso2/docs-apim/pull/1697#discussion_r471348976", "bodyText": "WSO2 API Manager Analytics uses a set of scopes - > WSO2 API Manager Analytics makes use of a set of scopes\n\nFixed with ab12d89", "author": "Ketharan", "createdAt": "2020-08-17T09:17:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDk3MDQzMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDk3MDU5Mw==", "url": "https://github.com/wso2/docs-apim/pull/1697#discussion_r470970593", "bodyText": "based on the assigned scopes?", "author": "shaniR", "createdAt": "2020-08-15T12:04:46Z", "path": "en/docs/learn/analytics/managing-dashboard-permissions.md", "diffHunk": "@@ -38,6 +133,8 @@ Follow the instructions below to change the default permissions that are set for\n \n ## Permission level and user role mapping\n \n+As described above the permission level of a logged-in user is decided based on the available scopes. The logged-in user possesses a user role, and scopes are mapped to that user role. You can find the mapping between default scopes and default user roles in the [role mapping table]({{base_path}}/administer/managing-users-and-roles/managing-user-roles/#adding-role-mappings).", "originalCommit": "aac223045115b81741cde9e15c62b547804f6e6b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTM0OTMwNA==", "url": "https://github.com/wso2/docs-apim/pull/1697#discussion_r471349304", "bodyText": "Fixed with ab12d89", "author": "Ketharan", "createdAt": "2020-08-17T09:17:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDk3MDU5Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDk3MDk0NA==", "url": "https://github.com/wso2/docs-apim/pull/1697#discussion_r470970944", "bodyText": "Break this into steps.\nwe need to point to how to create a custom scope.\nWe need to provide instructions or point to a page that includes them, on how to add role mapping.", "author": "shaniR", "createdAt": "2020-08-15T12:08:03Z", "path": "en/docs/learn/analytics/managing-dashboard-permissions.md", "diffHunk": "@@ -48,3 +145,30 @@ The following table illustrates the default mapping between the permission level\n | Internal/publisher  | Not allowed               | Not allowed            | Viewer            | Not allowed    | Not allowed    |\n | Internal/subscriber | Viewer                    | Not allowed            | Not allowed       | Not allowed    | Not allowed    |\n \n+\n+Further, you can add custom scopes for WSO2 API Manager Analytics. In order to do that, you have to add the custom scope and role mapping to `RESTAPIScopes` value of `APIM_HOME/repository/resources/tenant-conf.json` file and configure that in `ANALYTICS_HOME/conf/dashboard/deployment.yaml`.", "originalCommit": "aac223045115b81741cde9e15c62b547804f6e6b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTM1MDA5Mw==", "url": "https://github.com/wso2/docs-apim/pull/1697#discussion_r471350093", "bodyText": "Fixed with ab12d89", "author": "Ketharan", "createdAt": "2020-08-17T09:19:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDk3MDk0NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDk3MDk5Mg==", "url": "https://github.com/wso2/docs-apim/pull/1697#discussion_r470970992", "bodyText": "in the sample,  don't see where \"RESTAPIScopes\" is.", "author": "shaniR", "createdAt": "2020-08-15T12:08:43Z", "path": "en/docs/learn/analytics/managing-dashboard-permissions.md", "diffHunk": "@@ -48,3 +145,30 @@ The following table illustrates the default mapping between the permission level\n | Internal/publisher  | Not allowed               | Not allowed            | Viewer            | Not allowed    | Not allowed    |\n | Internal/subscriber | Viewer                    | Not allowed            | Not allowed       | Not allowed    | Not allowed    |\n \n+\n+Further, you can add custom scopes for WSO2 API Manager Analytics. In order to do that, you have to add the custom scope and role mapping to `RESTAPIScopes` value of `APIM_HOME/repository/resources/tenant-conf.json` file and configure that in `ANALYTICS_HOME/conf/dashboard/deployment.yaml`.\n+\n+For example if you need to create a custom scope `apim_analytics:reports:view`,  and map with `Internal/analytics` and `Internal/creator` role, then you have to add  the following entry to `RESTAPIScopes` value.\n+\n+``` toml", "originalCommit": "aac223045115b81741cde9e15c62b547804f6e6b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTM1MDI1NQ==", "url": "https://github.com/wso2/docs-apim/pull/1697#discussion_r471350255", "bodyText": "Fixed with ab12d89", "author": "Ketharan", "createdAt": "2020-08-17T09:19:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDk3MDk5Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDk3MTA1OA==", "url": "https://github.com/wso2/docs-apim/pull/1697#discussion_r470971058", "bodyText": "add this under a step you'll be breaking, based on the above comment.", "author": "shaniR", "createdAt": "2020-08-15T12:09:17Z", "path": "en/docs/learn/analytics/managing-dashboard-permissions.md", "diffHunk": "@@ -48,3 +145,30 @@ The following table illustrates the default mapping between the permission level\n | Internal/publisher  | Not allowed               | Not allowed            | Viewer            | Not allowed    | Not allowed    |\n | Internal/subscriber | Viewer                    | Not allowed            | Not allowed       | Not allowed    | Not allowed    |\n \n+\n+Further, you can add custom scopes for WSO2 API Manager Analytics. In order to do that, you have to add the custom scope and role mapping to `RESTAPIScopes` value of `APIM_HOME/repository/resources/tenant-conf.json` file and configure that in `ANALYTICS_HOME/conf/dashboard/deployment.yaml`.\n+\n+For example if you need to create a custom scope `apim_analytics:reports:view`,  and map with `Internal/analytics` and `Internal/creator` role, then you have to add  the following entry to `RESTAPIScopes` value.\n+\n+``` toml\n+    \"Scope\": [\n+       ...,\n+       {\n+              \"Name\": \"apim_analytics:reports:view\",\n+              \"Roles\": \"Internal/analytics, Internal/creator\"\n+       },\n+       ... \n+    ]\n+```\n+\n+Then, you have to append the custom scope, `apim_analytics:reports:view` to the space-separated `allScopes` property in the `ANALYTICS_HOME/conf/dashboard/deployment.yaml` as follows.", "originalCommit": "aac223045115b81741cde9e15c62b547804f6e6b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTM1MDQ3Nw==", "url": "https://github.com/wso2/docs-apim/pull/1697#discussion_r471350477", "bodyText": "Fixed with ab12d89", "author": "Ketharan", "createdAt": "2020-08-17T09:19:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDk3MTA1OA=="}], "type": "inlineReview"}, {"oid": "ab12d89bb02874fd1eccd6b48d0a387a8ccd7ffa", "url": "https://github.com/wso2/docs-apim/commit/ab12d89bb02874fd1eccd6b48d0a387a8ccd7ffa", "message": "Changes the wording and provides steps for custom scope creation.", "committedDate": "2020-08-17T09:05:48Z", "type": "commit"}]}