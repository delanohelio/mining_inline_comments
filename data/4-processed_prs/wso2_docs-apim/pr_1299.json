{"pr_number": 1299, "pr_title": "add external jwt signature validation", "pr_createdAt": "2020-06-05T15:12:42Z", "pr_url": "https://github.com/wso2/docs-apim/pull/1299", "timeline": [{"oid": "36635347c2b2f2fe8d3aff78b265793a70b1fc17", "url": "https://github.com/wso2/docs-apim/commit/36635347c2b2f2fe8d3aff78b265793a70b1fc17", "message": "add external jwt signature validation", "committedDate": "2020-06-06T05:33:36Z", "type": "commit"}, {"oid": "36635347c2b2f2fe8d3aff78b265793a70b1fc17", "url": "https://github.com/wso2/docs-apim/commit/36635347c2b2f2fe8d3aff78b265793a70b1fc17", "message": "add external jwt signature validation", "committedDate": "2020-06-06T05:33:36Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzU2NjgyMw==", "url": "https://github.com/wso2/docs-apim/pull/1299#discussion_r437566823", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            ## Validating JWT generated From external Oauth Provider\n          \n          \n            \n            ## Validating JWTs generated by external OAuth providers", "author": "bhathiya", "createdAt": "2020-06-09T16:34:39Z", "path": "en/docs/learn/api-security/oauth2/access-token-types/jwt-tokens.md", "diffHunk": "@@ -192,4 +192,65 @@ Follow the instructions below to import the public certificate into the client t\n      keytool -import -trustcacerts -keystore client-truststore.jks -alias gateway_certificate_alias -file wso2.crt\n      ```\n \n-5. Enter `wso2carbon` as the default password of the trust store when prompted.\n\\ No newline at end of file\n+5. Enter `wso2carbon` as the default password of the trust store when prompted.\n+\n+## Validating JWT generated From external Oauth Provider", "originalCommit": "36635347c2b2f2fe8d3aff78b265793a70b1fc17", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzU2NzU3Ng==", "url": "https://github.com/wso2/docs-apim/pull/1299#discussion_r437567576", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            JWT generated from an external Oauth provider can validate through Gateway as per the following diagram.\n          \n          \n            \n            JWTs generated by an external OAuth provider can be validated by the gateway as per the following diagram.", "author": "bhathiya", "createdAt": "2020-06-09T16:35:53Z", "path": "en/docs/learn/api-security/oauth2/access-token-types/jwt-tokens.md", "diffHunk": "@@ -192,4 +192,65 @@ Follow the instructions below to import the public certificate into the client t\n      keytool -import -trustcacerts -keystore client-truststore.jks -alias gateway_certificate_alias -file wso2.crt\n      ```\n \n-5. Enter `wso2carbon` as the default password of the trust store when prompted.\n\\ No newline at end of file\n+5. Enter `wso2carbon` as the default password of the trust store when prompted.\n+\n+## Validating JWT generated From external Oauth Provider\n+\n+JWT generated from an external Oauth provider can validate through Gateway as per the following diagram.", "originalCommit": "36635347c2b2f2fe8d3aff78b265793a70b1fc17", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzU2ODMzOQ==", "url": "https://github.com/wso2/docs-apim/pull/1299#discussion_r437568339", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            ### Signature Validation flow.\n          \n          \n            \n            ### Signature validation", "author": "bhathiya", "createdAt": "2020-06-09T16:37:07Z", "path": "en/docs/learn/api-security/oauth2/access-token-types/jwt-tokens.md", "diffHunk": "@@ -192,4 +192,65 @@ Follow the instructions below to import the public certificate into the client t\n      keytool -import -trustcacerts -keystore client-truststore.jks -alias gateway_certificate_alias -file wso2.crt\n      ```\n \n-5. Enter `wso2carbon` as the default password of the trust store when prompted.\n\\ No newline at end of file\n+5. Enter `wso2carbon` as the default password of the trust store when prompted.\n+\n+## Validating JWT generated From external Oauth Provider\n+\n+JWT generated from an external Oauth provider can validate through Gateway as per the following diagram.\n+\n+### Signature Validation flow.", "originalCommit": "36635347c2b2f2fe8d3aff78b265793a70b1fc17", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzU2OTI1Mg==", "url": "https://github.com/wso2/docs-apim/pull/1299#discussion_r437569252", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            In order to do the signature validation of jwt, can use one of the following steps.\n          \n          \n            \n            In order to do the signature validation of JWTs, you can use one of the following options.", "author": "bhathiya", "createdAt": "2020-06-09T16:38:36Z", "path": "en/docs/learn/api-security/oauth2/access-token-types/jwt-tokens.md", "diffHunk": "@@ -192,4 +192,65 @@ Follow the instructions below to import the public certificate into the client t\n      keytool -import -trustcacerts -keystore client-truststore.jks -alias gateway_certificate_alias -file wso2.crt\n      ```\n \n-5. Enter `wso2carbon` as the default password of the trust store when prompted.\n\\ No newline at end of file\n+5. Enter `wso2carbon` as the default password of the trust store when prompted.\n+\n+## Validating JWT generated From external Oauth Provider\n+\n+JWT generated from an external Oauth provider can validate through Gateway as per the following diagram.\n+\n+### Signature Validation flow.\n+\n+![]({{base_path}}/assets/img/learn/external-jwt-signature-validation.png)\n+\n+In order to do the signature validation of jwt, can use one of the following steps.", "originalCommit": "36635347c2b2f2fe8d3aff78b265793a70b1fc17", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzU3MDc1MA==", "url": "https://github.com/wso2/docs-apim/pull/1299#discussion_r437570750", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            - Import the public certificate into client-truststore.jks located under `<API-M_HOME>/repository/resources/security/` by using **kid** value as alias of key.\n          \n          \n            \n            - Import the public certificate into the client-truststore.jks located at `<API-M_HOME>/repository/resources/security/` with the **kid** value of the certificate as the alias.", "author": "bhathiya", "createdAt": "2020-06-09T16:41:07Z", "path": "en/docs/learn/api-security/oauth2/access-token-types/jwt-tokens.md", "diffHunk": "@@ -192,4 +192,65 @@ Follow the instructions below to import the public certificate into the client t\n      keytool -import -trustcacerts -keystore client-truststore.jks -alias gateway_certificate_alias -file wso2.crt\n      ```\n \n-5. Enter `wso2carbon` as the default password of the trust store when prompted.\n\\ No newline at end of file\n+5. Enter `wso2carbon` as the default password of the trust store when prompted.\n+\n+## Validating JWT generated From external Oauth Provider\n+\n+JWT generated from an external Oauth provider can validate through Gateway as per the following diagram.\n+\n+### Signature Validation flow.\n+\n+![]({{base_path}}/assets/img/learn/external-jwt-signature-validation.png)\n+\n+In order to do the signature validation of jwt, can use one of the following steps.\n+\n+- Import the public certificate into client-truststore.jks located under `<API-M_HOME>/repository/resources/security/` by using **kid** value as alias of key.", "originalCommit": "36635347c2b2f2fe8d3aff78b265793a70b1fc17", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzU3MjMyNA==", "url": "https://github.com/wso2/docs-apim/pull/1299#discussion_r437572324", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            - Use JWK endpoint of Oauth Provider.\n          \n          \n            \n            - Use the JWKS endpoint of the OAuth provider.", "author": "bhathiya", "createdAt": "2020-06-09T16:43:51Z", "path": "en/docs/learn/api-security/oauth2/access-token-types/jwt-tokens.md", "diffHunk": "@@ -192,4 +192,65 @@ Follow the instructions below to import the public certificate into the client t\n      keytool -import -trustcacerts -keystore client-truststore.jks -alias gateway_certificate_alias -file wso2.crt\n      ```\n \n-5. Enter `wso2carbon` as the default password of the trust store when prompted.\n\\ No newline at end of file\n+5. Enter `wso2carbon` as the default password of the trust store when prompted.\n+\n+## Validating JWT generated From external Oauth Provider\n+\n+JWT generated from an external Oauth provider can validate through Gateway as per the following diagram.\n+\n+### Signature Validation flow.\n+\n+![]({{base_path}}/assets/img/learn/external-jwt-signature-validation.png)\n+\n+In order to do the signature validation of jwt, can use one of the following steps.\n+\n+- Import the public certificate into client-truststore.jks located under `<API-M_HOME>/repository/resources/security/` by using **kid** value as alias of key.\n+\n+- Use JWK endpoint of Oauth Provider.", "originalCommit": "36635347c2b2f2fe8d3aff78b265793a70b1fc17", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzU3MjY3MA==", "url": "https://github.com/wso2/docs-apim/pull/1299#discussion_r437572670", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             1. Navigate to the `deployment.toml` under the `<API-M_HOME>/repository/conf` folder.\n          \n          \n            \n             1. Navigate to the `deployment.toml` under the `<API-M_HOME>/repository/conf/` folder.", "author": "bhathiya", "createdAt": "2020-06-09T16:44:26Z", "path": "en/docs/learn/api-security/oauth2/access-token-types/jwt-tokens.md", "diffHunk": "@@ -192,4 +192,65 @@ Follow the instructions below to import the public certificate into the client t\n      keytool -import -trustcacerts -keystore client-truststore.jks -alias gateway_certificate_alias -file wso2.crt\n      ```\n \n-5. Enter `wso2carbon` as the default password of the trust store when prompted.\n\\ No newline at end of file\n+5. Enter `wso2carbon` as the default password of the trust store when prompted.\n+\n+## Validating JWT generated From external Oauth Provider\n+\n+JWT generated from an external Oauth provider can validate through Gateway as per the following diagram.\n+\n+### Signature Validation flow.\n+\n+![]({{base_path}}/assets/img/learn/external-jwt-signature-validation.png)\n+\n+In order to do the signature validation of jwt, can use one of the following steps.\n+\n+- Import the public certificate into client-truststore.jks located under `<API-M_HOME>/repository/resources/security/` by using **kid** value as alias of key.\n+\n+- Use JWK endpoint of Oauth Provider.\n+\n+ 1. Navigate to the `deployment.toml` under the `<API-M_HOME>/repository/conf` folder.", "originalCommit": "36635347c2b2f2fe8d3aff78b265793a70b1fc17", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzU3MzQ2Ng==", "url": "https://github.com/wso2/docs-apim/pull/1299#discussion_r437573466", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             2. Add following content under the `[[apim.jwt.issuer]]` for issuer.\n          \n          \n            \n             2. Add the following configuration under the `[[apim.jwt.issuer]]` with the issuer details.", "author": "bhathiya", "createdAt": "2020-06-09T16:45:46Z", "path": "en/docs/learn/api-security/oauth2/access-token-types/jwt-tokens.md", "diffHunk": "@@ -192,4 +192,65 @@ Follow the instructions below to import the public certificate into the client t\n      keytool -import -trustcacerts -keystore client-truststore.jks -alias gateway_certificate_alias -file wso2.crt\n      ```\n \n-5. Enter `wso2carbon` as the default password of the trust store when prompted.\n\\ No newline at end of file\n+5. Enter `wso2carbon` as the default password of the trust store when prompted.\n+\n+## Validating JWT generated From external Oauth Provider\n+\n+JWT generated from an external Oauth provider can validate through Gateway as per the following diagram.\n+\n+### Signature Validation flow.\n+\n+![]({{base_path}}/assets/img/learn/external-jwt-signature-validation.png)\n+\n+In order to do the signature validation of jwt, can use one of the following steps.\n+\n+- Import the public certificate into client-truststore.jks located under `<API-M_HOME>/repository/resources/security/` by using **kid** value as alias of key.\n+\n+- Use JWK endpoint of Oauth Provider.\n+\n+ 1. Navigate to the `deployment.toml` under the `<API-M_HOME>/repository/conf` folder.\n+ 2. Add following content under the `[[apim.jwt.issuer]]` for issuer.", "originalCommit": "36635347c2b2f2fe8d3aff78b265793a70b1fc17", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzU4MTMxNA==", "url": "https://github.com/wso2/docs-apim/pull/1299#discussion_r437581314", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            ### Transform JWT Claims\n          \n          \n            \n            ### JWT claim transformation", "author": "bhathiya", "createdAt": "2020-06-09T16:58:23Z", "path": "en/docs/learn/api-security/oauth2/access-token-types/jwt-tokens.md", "diffHunk": "@@ -192,4 +192,65 @@ Follow the instructions below to import the public certificate into the client t\n      keytool -import -trustcacerts -keystore client-truststore.jks -alias gateway_certificate_alias -file wso2.crt\n      ```\n \n-5. Enter `wso2carbon` as the default password of the trust store when prompted.\n\\ No newline at end of file\n+5. Enter `wso2carbon` as the default password of the trust store when prompted.\n+\n+## Validating JWT generated From external Oauth Provider\n+\n+JWT generated from an external Oauth provider can validate through Gateway as per the following diagram.\n+\n+### Signature Validation flow.\n+\n+![]({{base_path}}/assets/img/learn/external-jwt-signature-validation.png)\n+\n+In order to do the signature validation of jwt, can use one of the following steps.\n+\n+- Import the public certificate into client-truststore.jks located under `<API-M_HOME>/repository/resources/security/` by using **kid** value as alias of key.\n+\n+- Use JWK endpoint of Oauth Provider.\n+\n+ 1. Navigate to the `deployment.toml` under the `<API-M_HOME>/repository/conf` folder.\n+ 2. Add following content under the `[[apim.jwt.issuer]]` for issuer.\n+  ```\n+  [[apim.jwt.issuer]]\n+  name = \"<issuer value of jwt>\"\n+  [apim.jwt.issuer.jwks]\n+  url = \"<jwks endpoint of oauth provider>\"\n+  ```\n+\n+### Transform JWT Claims", "originalCommit": "36635347c2b2f2fe8d3aff78b265793a70b1fc17", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzU4Mjg4Mg==", "url": "https://github.com/wso2/docs-apim/pull/1299#discussion_r437582882", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            By default WSO2 API Manager can convert the JWT claims into desired claims by configuring the claim mapping as per the following steps.\n          \n          \n            \n            In order to convert the incoming JWT claims into desired claims, you can configure the claim mapping as below.", "author": "bhathiya", "createdAt": "2020-06-09T17:00:52Z", "path": "en/docs/learn/api-security/oauth2/access-token-types/jwt-tokens.md", "diffHunk": "@@ -192,4 +192,65 @@ Follow the instructions below to import the public certificate into the client t\n      keytool -import -trustcacerts -keystore client-truststore.jks -alias gateway_certificate_alias -file wso2.crt\n      ```\n \n-5. Enter `wso2carbon` as the default password of the trust store when prompted.\n\\ No newline at end of file\n+5. Enter `wso2carbon` as the default password of the trust store when prompted.\n+\n+## Validating JWT generated From external Oauth Provider\n+\n+JWT generated from an external Oauth provider can validate through Gateway as per the following diagram.\n+\n+### Signature Validation flow.\n+\n+![]({{base_path}}/assets/img/learn/external-jwt-signature-validation.png)\n+\n+In order to do the signature validation of jwt, can use one of the following steps.\n+\n+- Import the public certificate into client-truststore.jks located under `<API-M_HOME>/repository/resources/security/` by using **kid** value as alias of key.\n+\n+- Use JWK endpoint of Oauth Provider.\n+\n+ 1. Navigate to the `deployment.toml` under the `<API-M_HOME>/repository/conf` folder.\n+ 2. Add following content under the `[[apim.jwt.issuer]]` for issuer.\n+  ```\n+  [[apim.jwt.issuer]]\n+  name = \"<issuer value of jwt>\"\n+  [apim.jwt.issuer.jwks]\n+  url = \"<jwks endpoint of oauth provider>\"\n+  ```\n+\n+### Transform JWT Claims\n+\n+By default WSO2 API Manager can convert the JWT claims into desired claims by configuring the claim mapping as per the following steps.", "originalCommit": "36635347c2b2f2fe8d3aff78b265793a70b1fc17", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzU4MzAzNw==", "url": "https://github.com/wso2/docs-apim/pull/1299#discussion_r437583037", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            1. Navigate to the `deployment.toml` under the `<API-M_HOME>/repository/conf` folder.\n          \n          \n            \n            1. Navigate to the `deployment.toml` under the `<API-M_HOME>/repository/conf/` folder.", "author": "bhathiya", "createdAt": "2020-06-09T17:01:09Z", "path": "en/docs/learn/api-security/oauth2/access-token-types/jwt-tokens.md", "diffHunk": "@@ -192,4 +192,65 @@ Follow the instructions below to import the public certificate into the client t\n      keytool -import -trustcacerts -keystore client-truststore.jks -alias gateway_certificate_alias -file wso2.crt\n      ```\n \n-5. Enter `wso2carbon` as the default password of the trust store when prompted.\n\\ No newline at end of file\n+5. Enter `wso2carbon` as the default password of the trust store when prompted.\n+\n+## Validating JWT generated From external Oauth Provider\n+\n+JWT generated from an external Oauth provider can validate through Gateway as per the following diagram.\n+\n+### Signature Validation flow.\n+\n+![]({{base_path}}/assets/img/learn/external-jwt-signature-validation.png)\n+\n+In order to do the signature validation of jwt, can use one of the following steps.\n+\n+- Import the public certificate into client-truststore.jks located under `<API-M_HOME>/repository/resources/security/` by using **kid** value as alias of key.\n+\n+- Use JWK endpoint of Oauth Provider.\n+\n+ 1. Navigate to the `deployment.toml` under the `<API-M_HOME>/repository/conf` folder.\n+ 2. Add following content under the `[[apim.jwt.issuer]]` for issuer.\n+  ```\n+  [[apim.jwt.issuer]]\n+  name = \"<issuer value of jwt>\"\n+  [apim.jwt.issuer.jwks]\n+  url = \"<jwks endpoint of oauth provider>\"\n+  ```\n+\n+### Transform JWT Claims\n+\n+By default WSO2 API Manager can convert the JWT claims into desired claims by configuring the claim mapping as per the following steps.\n+\n+1. Navigate to the `deployment.toml` under the `<API-M_HOME>/repository/conf` folder.", "originalCommit": "36635347c2b2f2fe8d3aff78b265793a70b1fc17", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzU4NTk2MA==", "url": "https://github.com/wso2/docs-apim/pull/1299#discussion_r437585960", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            By Default Claim mapping done in as one to one mapping, If claim mapping needs to be done in advance behaviour, Users can write a JWT transformer that can configure to specific token issuer.\n          \n          \n            \n            By default, the claim mapping is done in a one-to-one manner. But, if the mapping needs to be done in an advanced manner, the users can write custom JWT transformers which can be attached to each token issuer.", "author": "bhathiya", "createdAt": "2020-06-09T17:06:12Z", "path": "en/docs/learn/api-security/oauth2/access-token-types/jwt-tokens.md", "diffHunk": "@@ -192,4 +192,65 @@ Follow the instructions below to import the public certificate into the client t\n      keytool -import -trustcacerts -keystore client-truststore.jks -alias gateway_certificate_alias -file wso2.crt\n      ```\n \n-5. Enter `wso2carbon` as the default password of the trust store when prompted.\n\\ No newline at end of file\n+5. Enter `wso2carbon` as the default password of the trust store when prompted.\n+\n+## Validating JWT generated From external Oauth Provider\n+\n+JWT generated from an external Oauth provider can validate through Gateway as per the following diagram.\n+\n+### Signature Validation flow.\n+\n+![]({{base_path}}/assets/img/learn/external-jwt-signature-validation.png)\n+\n+In order to do the signature validation of jwt, can use one of the following steps.\n+\n+- Import the public certificate into client-truststore.jks located under `<API-M_HOME>/repository/resources/security/` by using **kid** value as alias of key.\n+\n+- Use JWK endpoint of Oauth Provider.\n+\n+ 1. Navigate to the `deployment.toml` under the `<API-M_HOME>/repository/conf` folder.\n+ 2. Add following content under the `[[apim.jwt.issuer]]` for issuer.\n+  ```\n+  [[apim.jwt.issuer]]\n+  name = \"<issuer value of jwt>\"\n+  [apim.jwt.issuer.jwks]\n+  url = \"<jwks endpoint of oauth provider>\"\n+  ```\n+\n+### Transform JWT Claims\n+\n+By default WSO2 API Manager can convert the JWT claims into desired claims by configuring the claim mapping as per the following steps.\n+\n+1. Navigate to the `deployment.toml` under the `<API-M_HOME>/repository/conf` folder.\n+2. Add the claim mapping as following under the `[[apim.jwt.issuer]]`.\n+  ```\n+  [[apim.jwt.issuer.claim_mapping]]\n+  remote_claim = \"<remote claim value>\"\n+  local_claim = \"<local claim value to map>\"\n+  ....\n+  ```\n+By Default Claim mapping done in as one to one mapping, If claim mapping needs to be done in advance behaviour, Users can write a JWT transformer that can configure to specific token issuer.\n+", "originalCommit": "36635347c2b2f2fe8d3aff78b265793a70b1fc17", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzU4NjM2Ng==", "url": "https://github.com/wso2/docs-apim/pull/1299#discussion_r437586366", "bodyText": "@tharindu1st we need to talk more about or link for more details on how to extend this.", "author": "bhathiya", "createdAt": "2020-06-09T17:06:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzU4NTk2MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzU4NjUyNw==", "url": "https://github.com/wso2/docs-apim/pull/1299#discussion_r437586527", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            ### Scope Validation flow\n          \n          \n            \n            ### Scope validation", "author": "bhathiya", "createdAt": "2020-06-09T17:07:09Z", "path": "en/docs/learn/api-security/oauth2/access-token-types/jwt-tokens.md", "diffHunk": "@@ -192,4 +192,65 @@ Follow the instructions below to import the public certificate into the client t\n      keytool -import -trustcacerts -keystore client-truststore.jks -alias gateway_certificate_alias -file wso2.crt\n      ```\n \n-5. Enter `wso2carbon` as the default password of the trust store when prompted.\n\\ No newline at end of file\n+5. Enter `wso2carbon` as the default password of the trust store when prompted.\n+\n+## Validating JWT generated From external Oauth Provider\n+\n+JWT generated from an external Oauth provider can validate through Gateway as per the following diagram.\n+\n+### Signature Validation flow.\n+\n+![]({{base_path}}/assets/img/learn/external-jwt-signature-validation.png)\n+\n+In order to do the signature validation of jwt, can use one of the following steps.\n+\n+- Import the public certificate into client-truststore.jks located under `<API-M_HOME>/repository/resources/security/` by using **kid** value as alias of key.\n+\n+- Use JWK endpoint of Oauth Provider.\n+\n+ 1. Navigate to the `deployment.toml` under the `<API-M_HOME>/repository/conf` folder.\n+ 2. Add following content under the `[[apim.jwt.issuer]]` for issuer.\n+  ```\n+  [[apim.jwt.issuer]]\n+  name = \"<issuer value of jwt>\"\n+  [apim.jwt.issuer.jwks]\n+  url = \"<jwks endpoint of oauth provider>\"\n+  ```\n+\n+### Transform JWT Claims\n+\n+By default WSO2 API Manager can convert the JWT claims into desired claims by configuring the claim mapping as per the following steps.\n+\n+1. Navigate to the `deployment.toml` under the `<API-M_HOME>/repository/conf` folder.\n+2. Add the claim mapping as following under the `[[apim.jwt.issuer]]`.\n+  ```\n+  [[apim.jwt.issuer.claim_mapping]]\n+  remote_claim = \"<remote claim value>\"\n+  local_claim = \"<local claim value to map>\"\n+  ....\n+  ```\n+By Default Claim mapping done in as one to one mapping, If claim mapping needs to be done in advance behaviour, Users can write a JWT transformer that can configure to specific token issuer.\n+\n+\n+### Scope Validation flow", "originalCommit": "36635347c2b2f2fe8d3aff78b265793a70b1fc17", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzU4ODg4Ng==", "url": "https://github.com/wso2/docs-apim/pull/1299#discussion_r437588886", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            By default WSO2 API Manager validates the scopes came in JWT in scopes claim. If JWT contains the scopes in a different claim, users need to map the claim into `scope` claim as per [Transform JWT Claims](#transform-jwt-claims).\n          \n          \n            \n            By default, the WSO2 API Manager validates the scopes coming in the `scope` claim of the JWT. If the JWT contains the scopes in a different claim, users can map that claim into the `scope` claim as per [Transform JWT Claims](#transform-jwt-claims) section.", "author": "bhathiya", "createdAt": "2020-06-09T17:11:10Z", "path": "en/docs/learn/api-security/oauth2/access-token-types/jwt-tokens.md", "diffHunk": "@@ -192,4 +192,65 @@ Follow the instructions below to import the public certificate into the client t\n      keytool -import -trustcacerts -keystore client-truststore.jks -alias gateway_certificate_alias -file wso2.crt\n      ```\n \n-5. Enter `wso2carbon` as the default password of the trust store when prompted.\n\\ No newline at end of file\n+5. Enter `wso2carbon` as the default password of the trust store when prompted.\n+\n+## Validating JWT generated From external Oauth Provider\n+\n+JWT generated from an external Oauth provider can validate through Gateway as per the following diagram.\n+\n+### Signature Validation flow.\n+\n+![]({{base_path}}/assets/img/learn/external-jwt-signature-validation.png)\n+\n+In order to do the signature validation of jwt, can use one of the following steps.\n+\n+- Import the public certificate into client-truststore.jks located under `<API-M_HOME>/repository/resources/security/` by using **kid** value as alias of key.\n+\n+- Use JWK endpoint of Oauth Provider.\n+\n+ 1. Navigate to the `deployment.toml` under the `<API-M_HOME>/repository/conf` folder.\n+ 2. Add following content under the `[[apim.jwt.issuer]]` for issuer.\n+  ```\n+  [[apim.jwt.issuer]]\n+  name = \"<issuer value of jwt>\"\n+  [apim.jwt.issuer.jwks]\n+  url = \"<jwks endpoint of oauth provider>\"\n+  ```\n+\n+### Transform JWT Claims\n+\n+By default WSO2 API Manager can convert the JWT claims into desired claims by configuring the claim mapping as per the following steps.\n+\n+1. Navigate to the `deployment.toml` under the `<API-M_HOME>/repository/conf` folder.\n+2. Add the claim mapping as following under the `[[apim.jwt.issuer]]`.\n+  ```\n+  [[apim.jwt.issuer.claim_mapping]]\n+  remote_claim = \"<remote claim value>\"\n+  local_claim = \"<local claim value to map>\"\n+  ....\n+  ```\n+By Default Claim mapping done in as one to one mapping, If claim mapping needs to be done in advance behaviour, Users can write a JWT transformer that can configure to specific token issuer.\n+\n+\n+### Scope Validation flow\n+\n+By default WSO2 API Manager validates the scopes came in JWT in scopes claim. If JWT contains the scopes in a different claim, users need to map the claim into `scope` claim as per [Transform JWT Claims](#transform-jwt-claims).\n+", "originalCommit": "36635347c2b2f2fe8d3aff78b265793a70b1fc17", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzU4OTAwMw==", "url": "https://github.com/wso2/docs-apim/pull/1299#discussion_r437589003", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            ### Subscription validation flow.\n          \n          \n            \n            ### Subscription validation", "author": "bhathiya", "createdAt": "2020-06-09T17:11:22Z", "path": "en/docs/learn/api-security/oauth2/access-token-types/jwt-tokens.md", "diffHunk": "@@ -192,4 +192,65 @@ Follow the instructions below to import the public certificate into the client t\n      keytool -import -trustcacerts -keystore client-truststore.jks -alias gateway_certificate_alias -file wso2.crt\n      ```\n \n-5. Enter `wso2carbon` as the default password of the trust store when prompted.\n\\ No newline at end of file\n+5. Enter `wso2carbon` as the default password of the trust store when prompted.\n+\n+## Validating JWT generated From external Oauth Provider\n+\n+JWT generated from an external Oauth provider can validate through Gateway as per the following diagram.\n+\n+### Signature Validation flow.\n+\n+![]({{base_path}}/assets/img/learn/external-jwt-signature-validation.png)\n+\n+In order to do the signature validation of jwt, can use one of the following steps.\n+\n+- Import the public certificate into client-truststore.jks located under `<API-M_HOME>/repository/resources/security/` by using **kid** value as alias of key.\n+\n+- Use JWK endpoint of Oauth Provider.\n+\n+ 1. Navigate to the `deployment.toml` under the `<API-M_HOME>/repository/conf` folder.\n+ 2. Add following content under the `[[apim.jwt.issuer]]` for issuer.\n+  ```\n+  [[apim.jwt.issuer]]\n+  name = \"<issuer value of jwt>\"\n+  [apim.jwt.issuer.jwks]\n+  url = \"<jwks endpoint of oauth provider>\"\n+  ```\n+\n+### Transform JWT Claims\n+\n+By default WSO2 API Manager can convert the JWT claims into desired claims by configuring the claim mapping as per the following steps.\n+\n+1. Navigate to the `deployment.toml` under the `<API-M_HOME>/repository/conf` folder.\n+2. Add the claim mapping as following under the `[[apim.jwt.issuer]]`.\n+  ```\n+  [[apim.jwt.issuer.claim_mapping]]\n+  remote_claim = \"<remote claim value>\"\n+  local_claim = \"<local claim value to map>\"\n+  ....\n+  ```\n+By Default Claim mapping done in as one to one mapping, If claim mapping needs to be done in advance behaviour, Users can write a JWT transformer that can configure to specific token issuer.\n+\n+\n+### Scope Validation flow\n+\n+By default WSO2 API Manager validates the scopes came in JWT in scopes claim. If JWT contains the scopes in a different claim, users need to map the claim into `scope` claim as per [Transform JWT Claims](#transform-jwt-claims).\n+\n+\n+### Subscription validation flow.", "originalCommit": "36635347c2b2f2fe8d3aff78b265793a70b1fc17", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzU5OTYyMw==", "url": "https://github.com/wso2/docs-apim/pull/1299#discussion_r437599623", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            By default WSO2 API Manager doesn't validate subscription against Application if JWT generated from different oauth provider.\n          \n          \n            \n            In order to validate subscriptions, following prerequisites need to be satisfied.\n          \n          \n            \n            \n          \n          \n            \n            1. JWT needs to contain the consumer key of the generated Oauth client application. By Default APIM reads the consumer key from `azp` claim or from `consumerKey` claim. If consumer key claim in a different claim, users need to map the claim into one of the above claim as per [Transform JWT Claims](#transform-jwt-claims).\n          \n          \n            \n            \n          \n          \n            \n            2. Consumer key need to be mapped into the Application by using [Provisioning Out-of-Band OAuth2 Clients]({{base_path}}/learn/api-security/oauth2/provisioning-out-of-band-oauth-clients/#provisioning-out-of-band-oauth2-clients/).\n          \n          \n            \n            \n          \n          \n            \n            Subscription validation from Key manager for JWT can be enabled by going through the following steps.\n          \n          \n            \n            \n          \n          \n            \n            1. Navigate to the `deployment.toml` under the `<API-M_HOME>/repository/conf` folder.\n          \n          \n            \n            2. Add the **subscription_validation_via_km** configuration under the `[apim.jwt_authenitcation]`.\n          \n          \n            \n              ```\n          \n          \n            \n              [apim.jwt_authenitcation]\n          \n          \n            \n              subscription_validation_via_km = true\n          \n          \n            \n              ```\n          \n          \n            \n            By default, the WSO2 API Manager does not validate subscriptions if the JWT is generated by an external OAuth provider. In order to enable subscription validation for such JWTs, the following need to be satisfied.\n          \n          \n            \n            \n          \n          \n            \n            1. The JWT needs to have the consumer key of the generated OAuth client application. By default, the API Manager expects the consumer key to be in the `azp` claim or the `consumerKey` claim. If the consumer key comes in a different claim than these 2, the user can map that claim into one of the above 2 claims as per [Transform JWT Claims](#transform-jwt-claims) section.\n          \n          \n            \n            \n          \n          \n            \n            2. The consumer key needs to be mapped to the application. For that, you can use [Provisioning Out-of-Band OAuth2 Clients]({{base_path}}/learn/api-security/oauth2/provisioning-out-of-band-oauth-clients/#provisioning-out-of-band-oauth2-clients/).\n          \n          \n            \n            \n          \n          \n            \n            If you can't satisfy the above requirements but still need subscription validation, the gateway can be configured to connect to the key manager to get the subscription validation done. You can enable that with the following steps.\n          \n          \n            \n            \n          \n          \n            \n            1. Navigate to the `deployment.toml` under the `<API-M_HOME>/repository/conf/` folder.\n          \n          \n            \n            2. Add the **subscription_validation_via_km** configuration under the `[apim.jwt_authenitcation]`.\n          \n      \n    \n    \n  \n\n[apim.jwt_authenitcation]\nsubscription_validation_via_km = true", "author": "bhathiya", "createdAt": "2020-06-09T17:29:27Z", "path": "en/docs/learn/api-security/oauth2/access-token-types/jwt-tokens.md", "diffHunk": "@@ -192,4 +192,65 @@ Follow the instructions below to import the public certificate into the client t\n      keytool -import -trustcacerts -keystore client-truststore.jks -alias gateway_certificate_alias -file wso2.crt\n      ```\n \n-5. Enter `wso2carbon` as the default password of the trust store when prompted.\n\\ No newline at end of file\n+5. Enter `wso2carbon` as the default password of the trust store when prompted.\n+\n+## Validating JWT generated From external Oauth Provider\n+\n+JWT generated from an external Oauth provider can validate through Gateway as per the following diagram.\n+\n+### Signature Validation flow.\n+\n+![]({{base_path}}/assets/img/learn/external-jwt-signature-validation.png)\n+\n+In order to do the signature validation of jwt, can use one of the following steps.\n+\n+- Import the public certificate into client-truststore.jks located under `<API-M_HOME>/repository/resources/security/` by using **kid** value as alias of key.\n+\n+- Use JWK endpoint of Oauth Provider.\n+\n+ 1. Navigate to the `deployment.toml` under the `<API-M_HOME>/repository/conf` folder.\n+ 2. Add following content under the `[[apim.jwt.issuer]]` for issuer.\n+  ```\n+  [[apim.jwt.issuer]]\n+  name = \"<issuer value of jwt>\"\n+  [apim.jwt.issuer.jwks]\n+  url = \"<jwks endpoint of oauth provider>\"\n+  ```\n+\n+### Transform JWT Claims\n+\n+By default WSO2 API Manager can convert the JWT claims into desired claims by configuring the claim mapping as per the following steps.\n+\n+1. Navigate to the `deployment.toml` under the `<API-M_HOME>/repository/conf` folder.\n+2. Add the claim mapping as following under the `[[apim.jwt.issuer]]`.\n+  ```\n+  [[apim.jwt.issuer.claim_mapping]]\n+  remote_claim = \"<remote claim value>\"\n+  local_claim = \"<local claim value to map>\"\n+  ....\n+  ```\n+By Default Claim mapping done in as one to one mapping, If claim mapping needs to be done in advance behaviour, Users can write a JWT transformer that can configure to specific token issuer.\n+\n+\n+### Scope Validation flow\n+\n+By default WSO2 API Manager validates the scopes came in JWT in scopes claim. If JWT contains the scopes in a different claim, users need to map the claim into `scope` claim as per [Transform JWT Claims](#transform-jwt-claims).\n+\n+\n+### Subscription validation flow.\n+\n+By default WSO2 API Manager doesn't validate subscription against Application if JWT generated from different oauth provider.\n+In order to validate subscriptions, following prerequisites need to be satisfied.\n+\n+1. JWT needs to contain the consumer key of the generated Oauth client application. By Default APIM reads the consumer key from `azp` claim or from `consumerKey` claim. If consumer key claim in a different claim, users need to map the claim into one of the above claim as per [Transform JWT Claims](#transform-jwt-claims).\n+\n+2. Consumer key need to be mapped into the Application by using [Provisioning Out-of-Band OAuth2 Clients]({{base_path}}/learn/api-security/oauth2/provisioning-out-of-band-oauth-clients/#provisioning-out-of-band-oauth2-clients/).\n+\n+Subscription validation from Key manager for JWT can be enabled by going through the following steps.\n+\n+1. Navigate to the `deployment.toml` under the `<API-M_HOME>/repository/conf` folder.\n+2. Add the **subscription_validation_via_km** configuration under the `[apim.jwt_authenitcation]`.\n+  ```\n+  [apim.jwt_authenitcation]\n+  subscription_validation_via_km = true\n+  ```", "originalCommit": "36635347c2b2f2fe8d3aff78b265793a70b1fc17", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "5311448b26aa59b580445cd490d130fa06908e80", "url": "https://github.com/wso2/docs-apim/commit/5311448b26aa59b580445cd490d130fa06908e80", "message": "Apply suggestions from code review\r\n\r\ncommit revised changes\n\nCo-authored-by: Bhathiya Jayasekara <bhathiya@wso2.com>", "committedDate": "2020-06-12T16:58:26Z", "type": "commit"}]}