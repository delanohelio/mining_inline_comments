{"pr_number": 2110, "pr_title": "[3.1.0] Add docs to configure SAML SSO for admin portal", "pr_createdAt": "2020-10-21T07:53:51Z", "pr_url": "https://github.com/wso2/docs-apim/pull/2110", "timeline": [{"oid": "fce38264d22d7d76db53a700b746b24c8f0e5f00", "url": "https://github.com/wso2/docs-apim/commit/fce38264d22d7d76db53a700b746b24c8f0e5f00", "message": "Add docs to configure SAML SSO for admin portal", "committedDate": "2020-10-21T07:49:24Z", "type": "commit"}, {"oid": "a785620f22bac679a2c1e33a10280bc5a746fa84", "url": "https://github.com/wso2/docs-apim/commit/a785620f22bac679a2c1e33a10280bc5a746fa84", "message": "Reviewed and updated entire doc", "committedDate": "2020-10-27T07:25:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjQ2NTk4Mg==", "url": "https://github.com/wso2/docs-apim/pull/2110#discussion_r512465982", "bodyText": "Images and files can not have uppercase characters in it.\nThis image will not render due to the upper case characters in upload-certificate-in-SP-for-saml2-sso.png.", "author": "Mariangela", "createdAt": "2020-10-27T07:30:16Z", "path": "en/docs/install-and-setup/setup/sso/configuring-sso-for-admin-portal-using-saml.md", "diffHunk": "@@ -0,0 +1,230 @@\n+# Configuring SSO for Admin Portal using SAML\n+\n+This document explains how to connect WSO2 Identity Server as a third-party Identity Provider to WSO2 API Manager using SAML 2.0. Using this feature, you can configure SSO with SAML 2.0 for Admin Portal.\n+\n+## Pre-requisites\n+\n+-   Download the API Manager distribution from [https://wso2.com/api-management/](https://wso2.com/api-management/).\n+\n+-   Download the Identity Server distribution from [https://wso2.com/identity-and-access-management/](https://wso2.com/identity-and-access-management/).\n+\n+    !!! Info\n+        To use WSO2 IS as the Key Manager, download the **WSO2 Identity Server 5.10.0 as a Key Manager** pack, with pre-packaged Key Manager features as follows:\n+\n+        1. Access the [previous WSO2 API Manager related releases](https://wso2.com/api-management/previous-releases/).\n+        2. Select version 3.1.0.\n+        3. Click on the Identity Server as a Key Manager download option.\n+\n+## Step 1 - Configure the userstore\n+\n+1. Configure the user store(s) (if you have not done so already).\n+\n+    Follow the instructions in [Configuring User Stores]({{base_path}}/administer/product-administration/managing-users-and-roles/managing-user-stores/introduction-to-userstores/).\n+\n+    Let's use JDBC userstore (MySQL) and share it between WSO2 Identity Server and WSO2 API Manager.\n+\n+    1.  Create a MySQL database (e.g., `user_db`) and run the `<API-M_HOME>/dbscripts/mysql.sql` script on it to create the required tables. \n+\n+    2.  Change the userstore type as `database_unique_id` in the Identity Server by adding the following configuration in the `deployment.toml` file, which is in the `<IS-HOME>/repository/conf` directory.\n+\n+        ``` toml\n+        [user_store]\n+        type = \"database_unique_id\"\n+        ```\n+\n+         <a name=\"stepc\"></a>\n+\n+    3.  Configure the primary userstore.\n+    \n+         Add the following configuration in the `deployment.toml` file.\n+\n+        ``` toml\n+        [database.user]\n+        type = \"mysql\"\n+        url = \"jdbc:mysql://localhost:3306/user_db\"\n+        username = \"${username}\"\n+        password = \"${password}\"\n+        ```\n+\n+    4.  Share the userstore with API Manager by adding the same configuration, which was defined in <a href=\"stepc\">Step C</a>) in the `deployment.toml` file, which is in the `<API-M_HOME>/repository/conf` directory.\n+\n+    5.  Copy the JDBC driver JAR file into the `<PRODUCT_HOME>/repository/components/lib` directory of both servers.\n+\n+    6.  Start the servers using the following commands:\n+\n+        ``` tab=\"On Windows\"\n+        wso2server.bat --run\n+        ```\n+\n+        ``` tab=\"On Linux/Mac OS\"\n+        sh wso2server.sh\n+        ```\n+\n+## Step 2 - Configure the Identity Server\n+\n+### Step 2.1 - Configure the Service Provider\n+\n+1.  Sign in to the WSO2 IS Management Console.  \n+\n+    ```\n+    https://{is-ip}:9444/carbon\n+    ```\n+\n+2.  Navigate to the **Service Providers** section under **Main** \u2192 **Identity** and create a new Service Provider.\n+\n+3.  Edit the created Service Provider:\n+\n+    1.  Expand the **Inbound Authentication Configuration** section and define the **SAML2 Web SSO Configuration** by providing the following information:\n+\n+        <table>\n+        <tbody>\n+            <tr>\n+                <td><b>Issuer</b></td>\n+                <td>Specify the Issuer</td>\n+            </tr>\n+            <tr>\n+                <td><b>Assertion Consumer URLs</b></td>\n+                <td><code>https://{apim-ip}:9443/admin/jagg/jaggery_acs.jag</code></td>\n+            </tr>\n+            <tr>\n+                <td><b>Response Signing Algorithm</b></td>\n+                <td><code>http://www.w3.org/2001/04/xmldsig-more#rsa-sha256</code></td>\n+            </tr>\n+            <tr>\n+                <td><b>Enable Response Signing</b></td>\n+                <td>true</td>\n+            </tr>\n+            <tr>\n+                <td><b>Enable Signature Validation in Authentication Requests and Logout Requests</b></td>\n+                <td>true</td>\n+            </tr>\n+            <tr>\n+                <td><b>Enable Single Logout</b></td>\n+                <td>true</td>\n+            </tr>\n+            <tr>\n+                <td><b>Enable Attribute Profile</b></td>\n+                <td>true</td>\n+            </tr>\n+            <tr>\n+                <td><b>Include Attributes in the Response Always</b></td>\n+                <td>true</td>\n+            </tr>\n+        </tbody>\n+        </table>\n+\n+        The following image shows the sample values for SAML2 Web SSO Configuration:\n+\n+        [![SAML configuration in Service Provider]({{base_path}}/assets/img/setup-and-install/saml-configuration-in-service-provider.png)]({{base_path}}/assets/img/setup-and-install/saml-configuration-in-service-provider.png)\n+\n+        !!! Info \"In multi-tenanted environments\"\n+            Carry out the instruction given below for all the tenants to be able to sign in to the Admin Portal in a multi-tenanted environment.\n+\n+            1. Click the **SaaS Application** option that appears after registering the service provider.\n+\n+            [![SaaS configuration in service provider]({{base_path}}/assets/img/setup-and-install/saas.png)]({{base_path}}/assets/img/setup-and-install/saas.png)            \n+\n+            If you do not select the **SaaS Application** option, only users in the current tenant domain will be allowed to sign in to the portal. You will need to register separate service providers for portals from each tenant.\n+\n+    2.  Register the Service Provider.\n+\n+        ??? Info \"Enable a tenant-specific SSO for the Publisher and Developer Portal\"\n+\n+            To enable a tenant-specific SSO with IS 5.10.0, enable the **Use tenant domain in local subject identifier** option under the **Local & Outbound Authentication Configuration** section.\n+\n+            [![Enable tenant domain in local sub identifier]({{base_path}}/assets/img/setup-and-install/enable-tenant-domain-in-local-sub-identifier.png)]({{base_path}}/assets/img/setup-and-install/enable-tenant-domain-in-local-sub-identifier.png)\n+\n+4.  Upload the public certificate of the API Manager by selecting **Select SP Certificate Type**.\n+", "originalCommit": "a785620f22bac679a2c1e33a10280bc5a746fa84", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjQ2ODc4Nw==", "url": "https://github.com/wso2/docs-apim/pull/2110#discussion_r512468787", "bodyText": "As the author is unavailable for the next couple of days, [1] has been created to expedite the fix.\n[1] #2142", "author": "Mariangela", "createdAt": "2020-10-27T07:36:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjQ2NTk4Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjQ2NjQ5Mg==", "url": "https://github.com/wso2/docs-apim/pull/2110#discussion_r512466492", "bodyText": "@vithu30 , Is the title of this info box correct?", "author": "Mariangela", "createdAt": "2020-10-27T07:31:27Z", "path": "en/docs/install-and-setup/setup/sso/configuring-sso-for-admin-portal-using-saml.md", "diffHunk": "@@ -0,0 +1,230 @@\n+# Configuring SSO for Admin Portal using SAML\n+\n+This document explains how to connect WSO2 Identity Server as a third-party Identity Provider to WSO2 API Manager using SAML 2.0. Using this feature, you can configure SSO with SAML 2.0 for Admin Portal.\n+\n+## Pre-requisites\n+\n+-   Download the API Manager distribution from [https://wso2.com/api-management/](https://wso2.com/api-management/).\n+\n+-   Download the Identity Server distribution from [https://wso2.com/identity-and-access-management/](https://wso2.com/identity-and-access-management/).\n+\n+    !!! Info\n+        To use WSO2 IS as the Key Manager, download the **WSO2 Identity Server 5.10.0 as a Key Manager** pack, with pre-packaged Key Manager features as follows:\n+\n+        1. Access the [previous WSO2 API Manager related releases](https://wso2.com/api-management/previous-releases/).\n+        2. Select version 3.1.0.\n+        3. Click on the Identity Server as a Key Manager download option.\n+\n+## Step 1 - Configure the userstore\n+\n+1. Configure the user store(s) (if you have not done so already).\n+\n+    Follow the instructions in [Configuring User Stores]({{base_path}}/administer/product-administration/managing-users-and-roles/managing-user-stores/introduction-to-userstores/).\n+\n+    Let's use JDBC userstore (MySQL) and share it between WSO2 Identity Server and WSO2 API Manager.\n+\n+    1.  Create a MySQL database (e.g., `user_db`) and run the `<API-M_HOME>/dbscripts/mysql.sql` script on it to create the required tables. \n+\n+    2.  Change the userstore type as `database_unique_id` in the Identity Server by adding the following configuration in the `deployment.toml` file, which is in the `<IS-HOME>/repository/conf` directory.\n+\n+        ``` toml\n+        [user_store]\n+        type = \"database_unique_id\"\n+        ```\n+\n+         <a name=\"stepc\"></a>\n+\n+    3.  Configure the primary userstore.\n+    \n+         Add the following configuration in the `deployment.toml` file.\n+\n+        ``` toml\n+        [database.user]\n+        type = \"mysql\"\n+        url = \"jdbc:mysql://localhost:3306/user_db\"\n+        username = \"${username}\"\n+        password = \"${password}\"\n+        ```\n+\n+    4.  Share the userstore with API Manager by adding the same configuration, which was defined in <a href=\"stepc\">Step C</a>) in the `deployment.toml` file, which is in the `<API-M_HOME>/repository/conf` directory.\n+\n+    5.  Copy the JDBC driver JAR file into the `<PRODUCT_HOME>/repository/components/lib` directory of both servers.\n+\n+    6.  Start the servers using the following commands:\n+\n+        ``` tab=\"On Windows\"\n+        wso2server.bat --run\n+        ```\n+\n+        ``` tab=\"On Linux/Mac OS\"\n+        sh wso2server.sh\n+        ```\n+\n+## Step 2 - Configure the Identity Server\n+\n+### Step 2.1 - Configure the Service Provider\n+\n+1.  Sign in to the WSO2 IS Management Console.  \n+\n+    ```\n+    https://{is-ip}:9444/carbon\n+    ```\n+\n+2.  Navigate to the **Service Providers** section under **Main** \u2192 **Identity** and create a new Service Provider.\n+\n+3.  Edit the created Service Provider:\n+\n+    1.  Expand the **Inbound Authentication Configuration** section and define the **SAML2 Web SSO Configuration** by providing the following information:\n+\n+        <table>\n+        <tbody>\n+            <tr>\n+                <td><b>Issuer</b></td>\n+                <td>Specify the Issuer</td>\n+            </tr>\n+            <tr>\n+                <td><b>Assertion Consumer URLs</b></td>\n+                <td><code>https://{apim-ip}:9443/admin/jagg/jaggery_acs.jag</code></td>\n+            </tr>\n+            <tr>\n+                <td><b>Response Signing Algorithm</b></td>\n+                <td><code>http://www.w3.org/2001/04/xmldsig-more#rsa-sha256</code></td>\n+            </tr>\n+            <tr>\n+                <td><b>Enable Response Signing</b></td>\n+                <td>true</td>\n+            </tr>\n+            <tr>\n+                <td><b>Enable Signature Validation in Authentication Requests and Logout Requests</b></td>\n+                <td>true</td>\n+            </tr>\n+            <tr>\n+                <td><b>Enable Single Logout</b></td>\n+                <td>true</td>\n+            </tr>\n+            <tr>\n+                <td><b>Enable Attribute Profile</b></td>\n+                <td>true</td>\n+            </tr>\n+            <tr>\n+                <td><b>Include Attributes in the Response Always</b></td>\n+                <td>true</td>\n+            </tr>\n+        </tbody>\n+        </table>\n+\n+        The following image shows the sample values for SAML2 Web SSO Configuration:\n+\n+        [![SAML configuration in Service Provider]({{base_path}}/assets/img/setup-and-install/saml-configuration-in-service-provider.png)]({{base_path}}/assets/img/setup-and-install/saml-configuration-in-service-provider.png)\n+\n+        !!! Info \"In multi-tenanted environments\"\n+            Carry out the instruction given below for all the tenants to be able to sign in to the Admin Portal in a multi-tenanted environment.\n+\n+            1. Click the **SaaS Application** option that appears after registering the service provider.\n+\n+            [![SaaS configuration in service provider]({{base_path}}/assets/img/setup-and-install/saas.png)]({{base_path}}/assets/img/setup-and-install/saas.png)            \n+\n+            If you do not select the **SaaS Application** option, only users in the current tenant domain will be allowed to sign in to the portal. You will need to register separate service providers for portals from each tenant.\n+\n+    2.  Register the Service Provider.\n+\n+        ??? Info \"Enable a tenant-specific SSO for the Publisher and Developer Portal\"", "originalCommit": "a785620f22bac679a2c1e33a10280bc5a746fa84", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}