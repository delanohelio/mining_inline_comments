{"pr_number": 2017, "pr_title": "3.1.0 performance results documentation", "pr_createdAt": "2020-10-08T06:01:51Z", "pr_url": "https://github.com/wso2/docs-apim/pull/2017", "timeline": [{"oid": "c908634853187b7ecd6cc8d9c9f14e402d7164cf", "url": "https://github.com/wso2/docs-apim/commit/c908634853187b7ecd6cc8d9c9f14e402d7164cf", "message": "Add performance result page", "committedDate": "2020-10-07T15:12:25Z", "type": "commit"}, {"oid": "57e252b41d7c404e728c41a160a44b2b9697a8e8", "url": "https://github.com/wso2/docs-apim/commit/57e252b41d7c404e728c41a160a44b2b9697a8e8", "message": "Reviewed and updated the PR\n\nReviewed and updated the PR", "committedDate": "2020-10-07T15:23:54Z", "type": "commit"}, {"oid": "531c4d55ee2418b01fe833f6cc64ce30dacef46a", "url": "https://github.com/wso2/docs-apim/commit/531c4d55ee2418b01fe833f6cc64ce30dacef46a", "message": "update performance results for apim 3.1.0", "committedDate": "2020-10-08T05:58:14Z", "type": "commit"}, {"oid": "6e946f0a1ba7e4325e0ff7e23fc240f9fb940b16", "url": "https://github.com/wso2/docs-apim/commit/6e946f0a1ba7e4325e0ff7e23fc240f9fb940b16", "message": "Reviewed and updated", "committedDate": "2020-10-15T16:08:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTY2NjUzMg==", "url": "https://github.com/wso2/docs-apim/pull/2017#discussion_r505666532", "bodyText": "Images or other files that have caps will not display in Mkdocs based on the existing configurations. Therefore, please rename the image files and update this doc with lower case image file names.", "author": "Mariangela", "createdAt": "2020-10-15T16:10:05Z", "path": "en/docs/install-and-setup/setup/deployment-best-practices/performance-test-results.md", "diffHunk": "@@ -0,0 +1,112 @@\n+# Performance Test Results\n+\n+## Summary\n+\n+The performance of WSO2 API Manager was measured using the following APIs, which invoke a simple \u201cNetty HTTP Echo Service\u201d. As the name suggests, the Netty service echoes back any request posted to the service.\n+\n+- Echo API: This is a secured API, which directly invokes the back-end service.\n+\n+- Mediation API: This is also a secured API, which has a \u201csequence\u201d as a mediation extension to modify the message.\n+\n+Tests were done using 100, 200, 300, 1000, and 2000 concurrent users. Concurrent Users mean that it consists of multiple users accessing the API Gateway at the same time. Different Message Sizes (Payloads) were used for the tests with different back-end service delays. The message sizes used are 50B, 1KiB, 10KiB, and 100KiB. The back-end delays were 0ms, 30ms, 500ms, and 1s.\n+\n+Two key performance metrics were used to measure the performance of each test.\n+- Throughput: This measures the number of API invocations that the API Manager Gateway server processed during a specific time interval (e.g. per second).\n+- Response Time: This measures end-to-end processing time for an operation (of invoking an API using HTTPS protocol). The complete distribution of response times was recorded.\n+\n+## Deployment used for the test\n+\n+[![APIM performance test all in one deployment]({{base_path}}/assets/img/setup-and-install/apim_performance_test_all_in_one_deployment.png)]({{base_path}}/assets/img/setup-and-install/apim_performance_test_all_in_one_deployment.png)\n+\n+| **Name** | **EC2 Instance Type** | **vCPU** | **Mem(GiB)** |  \n+|---|---|---|---|\n+| Apache JMeter Client | c5.large | 2 | 2 |\n+| Apache JMeter Server 01 | c5.xlarge | 4 | 4 |\n+| Apache JMeter Server 02 | c5.xlarge | 4 | 4 |\n+| MySQL | db.m5.large | 2 | 8 |\n+| Netty HTTP Backend  | c5.xlarge | 4 | 4 |\n+| WSO2 API Manager | c5.large | 2 | 2 |\n+\n+- Token type: JWT \n+\n+- The operating system is Ubuntu 18.04\n+\n+- MySQL version in RDS instance is 5.7\n+\n+- Java version is JDK 11\n+\n+### Performance test scripts\n+\n+All scripts used to run the performance tests and analyze results are in the following repositories.\n+\n+- [https://github.com/wso2/performance-common](https://github.com/wso2/performance-common/)\n+- [https://github.com/wso2/performance-apim](https://github.com/wso2/performance-apim/)\n+\n+## Results\n+\n+Considering the fact that an average WSO2 API Manager user uses ~1KiB messages, the performance test highlights for that scenario are represented in the charts below. The complete results can be found [here.](https://github.com/wso2/performance-apim/tree/performance-test-166-2020-06-13_19-22-35/performance/benchmarks/summary.md)\n+\n+The following graph depicts the throughput changes based on the number of concurrent users.\n+[![Performance result graph - throughtput]({{base_path}}/assets/img/setup-and-install/performance-result-graph-throughput-0ms-1KiB.png)]({{base_path}}/assets/img/setup-and-install/performance-result-graph-throughput-0ms-1KiB.png)\n+\n+Key observations:\n+\n+- More concurrent users mean more requests to the API Manager Gateway. Therefore, the throughput of the API Manager Gateway increases as the number of concurrent users accessing the APIs increases. The maximum throughput is obtained for 200 concurrent users for both \u201cEcho API\u201d and \u201cMediation API\u201d and the throughput degrades slightly after 200 concurrent users due to resource contentions in the system. The degradation point mainly depends on hardware resources.\n+\n+- Echo API throughput is much better than the Mediation API. The main reason is that the Mediation API has a mediation extension, which uses a \u201c[Payload Factory](https://docs.wso2.com/display/EI660/PayloadFactory+Mediator)\u201d Mediator. This mediation in the sequence does a JSON to JSON message transformation. That means, the Mediation API reads the message (payload) to do the message transformation and it has a considerable overhead than the \u201cEcho API\u201d, which is similar to a \u201cDirect Proxy\u201d. A \u201cDirect Proxy\u201d does not perform any processing on the messages that pass through it.\n+\n+The following graph depicts the average response time changes based on the number of concurrent users.\n+\n+[![Performance result graph - response time]({{base_path}}/assets/img/setup-and-install/performance-result-graph-response-time-0ms-1KiB.png)]({{base_path}}/assets/img/setup-and-install/performance-result-graph-response-time-0ms-1KiB.png)\n+\n+Key observations:\n+\n+- The **average response time** increases with the number of concurrent users. As the number of requests to serve increases with more users, there are more resource contentions. Therefore, the number of concurrent users served by the API Gateway needs to be decided on the required response time limits. Again, the average response time also varies as the hardware resources changes. For example, a user can achieve a less response time if the number of CPUs allocated is increased.\n+\n+- The **mediation API response times** are higher than Echo API due to the performance overhead of mediation extension.\n+\n+Let\u2019s look at the 90th, 95th, and 99th response time percentiles. This is useful to measure the percentage of requests that exceeded the response time value for a given percentile. A percentile can be used to determine the percentage of requests completed below the particular response time value.\n+\n+For example, when there are 100 concurrent users, the 90th response time percentile for Echo API is 52ms. This means that 10% of the requests have taken more than 52ms to respond. Similarly, the 99th response time percentile for Echo API is 101ms, which means that 99% of the requests have been completed within 101ms.\n+\n+[![Performance result graph - response time percentiles]({{base_path}}/assets/img/setup-and-install/performance-result-graph-precentiles-0ms-1KiB.png)]({{base_path}}/assets/img/setup-and-install/performance-result-graph-precentiles-0ms-1KiB.png)", "originalCommit": "6e946f0a1ba7e4325e0ff7e23fc240f9fb940b16", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTczMDUzMA==", "url": "https://github.com/wso2/docs-apim/pull/2017#discussion_r505730530", "bodyText": "Updated via 734ff15", "author": "VirajSalaka", "createdAt": "2020-10-15T17:52:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTY2NjUzMg=="}], "type": "inlineReview"}, {"oid": "734ff15a352df15b3cc4cf6cb17f022637ab81ce", "url": "https://github.com/wso2/docs-apim/commit/734ff15a352df15b3cc4cf6cb17f022637ab81ce", "message": "resolve commented issues", "committedDate": "2020-10-15T17:50:14Z", "type": "commit"}]}