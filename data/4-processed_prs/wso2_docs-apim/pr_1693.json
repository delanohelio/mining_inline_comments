{"pr_number": 1693, "pr_title": "update distributed deployment steps and active active steps", "pr_createdAt": "2020-08-13T07:59:20Z", "pr_url": "https://github.com/wso2/docs-apim/pull/1693", "timeline": [{"oid": "af3c1223283b7f1dbcdf8f2fec4e5d94f5dd08ea", "url": "https://github.com/wso2/docs-apim/commit/af3c1223283b7f1dbcdf8f2fec4e5d94f5dd08ea", "message": "update distributed deployment steps and active active steps", "committedDate": "2020-08-13T07:58:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTc3MTkwMw==", "url": "https://github.com/wso2/docs-apim/pull/1693#discussion_r469771903", "bodyText": "file name deploying-apim-in-a-distributed-setup.md", "author": "isharac", "createdAt": "2020-08-13T08:07:19Z", "path": "en/docs/install-and-setup/setup/distributed-deployment/deploying-wso2-api-m-in-a-distributed-setup.md", "diffHunk": "@@ -73,7 +73,7 @@ This section involves setting up the Key Manager node and enabling it to work wi\n ", "originalCommit": "af3c1223283b7f1dbcdf8f2fec4e5d94f5dd08ea", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTc4MDEwNQ==", "url": "https://github.com/wso2/docs-apim/pull/1693#discussion_r469780105", "bodyText": "existing name seem to be fine", "author": "isharac", "createdAt": "2020-08-13T08:21:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTc3MTkwMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTc4MjQ3MA==", "url": "https://github.com/wso2/docs-apim/pull/1693#discussion_r469782470", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    This configuration enables publishing of throttling policies, custom templates, and block conditions,API Events to the Traffic Manager node.\n          \n          \n            \n                    This configuration enables publishing of throttling policies, custom templates, block conditions, and API Events to the Traffic Manager node.", "author": "bhathiya", "createdAt": "2020-08-13T08:25:50Z", "path": "en/docs/install-and-setup/setup/distributed-deployment/deploying-wso2-api-m-in-a-distributed-setup.md", "diffHunk": "@@ -239,13 +319,13 @@ This section involves setting up the API Publisher node and enabling it to work\n 1.  Open the `<API-M_HOME>/repository/conf/deployment.toml` file in the API Publisher node and make the following changes.\n \n     1.  Configure the Publisher with the Traffic Manager.\n-        This configuration enables publishing of throttling policies, custom templates, and block conditions to the Traffic Manager node.\n+        This configuration enables publishing of throttling policies, custom templates, and block conditions,API Events to the Traffic Manager node.", "originalCommit": "af3c1223283b7f1dbcdf8f2fec4e5d94f5dd08ea", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDk3MTg4NQ==", "url": "https://github.com/wso2/docs-apim/pull/1693#discussion_r470971885", "bodyText": "API Events -> API events.", "author": "shaniR", "createdAt": "2020-08-15T12:18:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTc4MjQ3MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTc4MzEwMQ==", "url": "https://github.com/wso2/docs-apim/pull/1693#discussion_r469783101", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            2.  If you need to configure High Availability (HA) for the Api Publisher nodes, use a copy of the active instance configured above as the second active Publisher instance and configure a load balancer fronting the two Publisher instances.\n          \n          \n            \n            2.  If you need to configure High Availability (HA) for the API Publisher nodes, use a copy of the instance configured above as the second active Publisher instance and configure a load balancer fronting the two Publisher instances.", "author": "bhathiya", "createdAt": "2020-08-13T08:27:00Z", "path": "en/docs/install-and-setup/setup/distributed-deployment/deploying-wso2-api-m-in-a-distributed-setup.md", "diffHunk": "@@ -332,7 +412,23 @@ This section involves setting up the API Publisher node and enabling it to work\n         url = \"https://[devportal-hostname]:${mgt.transport.https.port}/devportal\"\n         ```\n \n-4.  If you need to configure High Availability (HA) for the Api Publisher nodes, use a copy of the active instance configured above as the second active Publisher instance and configure a load balancer fronting the two Publisher instances.\n+    4.  Configure the Publisher with the Key Manager.\n+    \n+    ``` toml tab=\"Key Manager with HA\"\n+        [apim.key_manager]\n+        service_url = \"https://[Key-Manager-LB-host]/services/\"\n+        username = \"$ref{super_admin.username}\"\n+        password = \"$ref{super_admin.password}\"\n+    ```\n+        \n+    ``` toml tab=\"Single Key Manager\"\n+        [apim.key_manager]\n+        service_url = \"https://[Key-Manager-host]:${mgt.transport.https.port}/services/\"\n+        username = \"$ref{super_admin.username}\"\n+        password = \"$ref{super_admin.password}\"\n+    ```\n+\n+2.  If you need to configure High Availability (HA) for the Api Publisher nodes, use a copy of the active instance configured above as the second active Publisher instance and configure a load balancer fronting the two Publisher instances.", "originalCommit": "af3c1223283b7f1dbcdf8f2fec4e5d94f5dd08ea", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDk3MjAzMQ==", "url": "https://github.com/wso2/docs-apim/pull/1693#discussion_r470972031", "bodyText": "Shall we rephrase is as \" If you need to configure High Availability (HA) for the API Publisher nodes, use a copy of the instance configured above as the second active Publisher instance. Thereafter, configure a load balancer fronting the two Publisher instances.\"", "author": "shaniR", "createdAt": "2020-08-15T12:19:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTc4MzEwMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTc4ODE4Nw==", "url": "https://github.com/wso2/docs-apim/pull/1693#discussion_r469788187", "bodyText": "a space required after comma", "author": "isharac", "createdAt": "2020-08-13T08:35:42Z", "path": "en/docs/install-and-setup/setup/distributed-deployment/deploying-wso2-api-m-in-a-distributed-setup.md", "diffHunk": "@@ -239,13 +319,13 @@ This section involves setting up the API Publisher node and enabling it to work\n 1.  Open the `<API-M_HOME>/repository/conf/deployment.toml` file in the API Publisher node and make the following changes.\n \n     1.  Configure the Publisher with the Traffic Manager.\n-        This configuration enables publishing of throttling policies, custom templates, and block conditions to the Traffic Manager node.\n+        This configuration enables publishing of throttling policies, custom templates, and block conditions,API Events to the Traffic Manager node.", "originalCommit": "af3c1223283b7f1dbcdf8f2fec4e5d94f5dd08ea", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDk3MTI4Nw==", "url": "https://github.com/wso2/docs-apim/pull/1693#discussion_r470971287", "bodyText": "hopefully these are included in the config catalog", "author": "shaniR", "createdAt": "2020-08-15T12:11:43Z", "path": "en/docs/install-and-setup/setup/distributed-deployment/deploying-wso2-api-m-in-a-distributed-setup.md", "diffHunk": "@@ -87,6 +87,17 @@ This section involves setting up the Key Manager node and enabling it to work wi\n      [[apim.throttling.url_group]]\n      traffic_manager_urls = [\"tcp://Traffic-Manager-2-host:9611\"]\n      traffic_manager_auth_urls = [\"ssl://Traffic-Manager-2-host:9711\"]\n+\n+     [[event_listener]]", "originalCommit": "af3c1223283b7f1dbcdf8f2fec4e5d94f5dd08ea", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODE0Mjk4Mw==", "url": "https://github.com/wso2/docs-apim/pull/1693#discussion_r478142983", "bodyText": "this was came from Identity server configs since they didn't have a config catalog we might need to include into our catalog\n@ruthryi", "author": "tharindu1st", "createdAt": "2020-08-27T05:36:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDk3MTI4Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDk3MTM0Mw==", "url": "https://github.com/wso2/docs-apim/pull/1693#discussion_r470971343", "bodyText": "Key manager -> Key Manager ?", "author": "shaniR", "createdAt": "2020-08-15T12:12:19Z", "path": "en/docs/install-and-setup/setup/distributed-deployment/deploying-wso2-api-m-in-a-distributed-setup.md", "diffHunk": "@@ -176,11 +210,42 @@ This section involves setting up the Traffic Manager node(s) and enabling it to\n \n [![Traffic Manager Connections]({{base_path}}/assets/img/setup-and-install/traffic-manager-connections.png)]({{base_path}}/assets/img/setup-and-install/traffic-manager-connections.png)\n \n+1.  Open the `<API-M_HOME>/repository/conf/deployment.toml` file in the Traffic Manager node and change as following to point to Key manager nodes.", "originalCommit": "af3c1223283b7f1dbcdf8f2fec4e5d94f5dd08ea", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDk3MTM5Mg==", "url": "https://github.com/wso2/docs-apim/pull/1693#discussion_r470971392", "bodyText": "publish events into other node -> publish events to other nodes.", "author": "shaniR", "createdAt": "2020-08-15T12:12:51Z", "path": "en/docs/install-and-setup/setup/distributed-deployment/deploying-wso2-api-m-in-a-distributed-setup.md", "diffHunk": "@@ -176,11 +210,42 @@ This section involves setting up the Traffic Manager node(s) and enabling it to\n \n [![Traffic Manager Connections]({{base_path}}/assets/img/setup-and-install/traffic-manager-connections.png)]({{base_path}}/assets/img/setup-and-install/traffic-manager-connections.png)\n \n+1.  Open the `<API-M_HOME>/repository/conf/deployment.toml` file in the Traffic Manager node and change as following to point to Key manager nodes.\n+\n+    ``` toml tab=\"Key Manager with HA\"\n+        [apim.key_manager]\n+        service_url = \"https://[Key-Manager-LB-host]/services/\"\n+        username = \"$ref{super_admin.username}\"\n+        password = \"$ref{super_admin.password}\"\n+    ```\n+        \n+    ``` toml tab=\"Single Key Manager\"\n+        [apim.key_manager]\n+        service_url = \"https://[Key-Manager-host]:${mgt.transport.https.port}/services/\"\n+        username = \"$ref{super_admin.username}\"\n+        password = \"$ref{super_admin.password}\"\n+    ```\n+##### Configuring High Availability (HA) for the Traffic Manager.\n+\n 1.  If you need to configure High Availability (HA) for the Traffic Manager, use a copy of the existing Traffic Manager instance as the second Traffic Manager active instance and configure a load balancer fronting the two Traffic Manager instances.\n \n-2.  Mount the `<API-M_HOME>/repository/deployment/server/executionplans` directory of all the Traffic Manager nodes to a shared file system as a content synchronization mechanism in-order to share the throttling policies between Traffic Manager nodes.\n+2. Open the `<API-M_HOME>/repository/conf/deployment.toml` file in the Traffic Manager node and add the following configuration to publish events into other node.", "originalCommit": "af3c1223283b7f1dbcdf8f2fec4e5d94f5dd08ea", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDk3MTQwMg==", "url": "https://github.com/wso2/docs-apim/pull/1693#discussion_r470971402", "bodyText": "what do you mean by other nodes?", "author": "shaniR", "createdAt": "2020-08-15T12:13:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDk3MTM5Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODE0NDAxMA==", "url": "https://github.com/wso2/docs-apim/pull/1693#discussion_r478144010", "bodyText": "this was a event duplicate from any one of the node", "author": "tharindu1st", "createdAt": "2020-08-27T05:37:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDk3MTM5Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDk3MTc5Nw==", "url": "https://github.com/wso2/docs-apim/pull/1693#discussion_r470971797", "bodyText": "let's reword it as \"Mount the <API-M_HOME>/repository/deployment/server/executionplans directory of all Traffic Manager nodes to a shared file system. This will synchronize the content among nodes allowing the throttling policies to be shared among them.", "author": "shaniR", "createdAt": "2020-08-15T12:17:10Z", "path": "en/docs/install-and-setup/setup/distributed-deployment/deploying-wso2-api-m-in-a-distributed-setup.md", "diffHunk": "@@ -176,11 +210,42 @@ This section involves setting up the Traffic Manager node(s) and enabling it to\n \n [![Traffic Manager Connections]({{base_path}}/assets/img/setup-and-install/traffic-manager-connections.png)]({{base_path}}/assets/img/setup-and-install/traffic-manager-connections.png)\n \n+1.  Open the `<API-M_HOME>/repository/conf/deployment.toml` file in the Traffic Manager node and change as following to point to Key manager nodes.\n+\n+    ``` toml tab=\"Key Manager with HA\"\n+        [apim.key_manager]\n+        service_url = \"https://[Key-Manager-LB-host]/services/\"\n+        username = \"$ref{super_admin.username}\"\n+        password = \"$ref{super_admin.password}\"\n+    ```\n+        \n+    ``` toml tab=\"Single Key Manager\"\n+        [apim.key_manager]\n+        service_url = \"https://[Key-Manager-host]:${mgt.transport.https.port}/services/\"\n+        username = \"$ref{super_admin.username}\"\n+        password = \"$ref{super_admin.password}\"\n+    ```\n+##### Configuring High Availability (HA) for the Traffic Manager.\n+\n 1.  If you need to configure High Availability (HA) for the Traffic Manager, use a copy of the existing Traffic Manager instance as the second Traffic Manager active instance and configure a load balancer fronting the two Traffic Manager instances.\n \n-2.  Mount the `<API-M_HOME>/repository/deployment/server/executionplans` directory of all the Traffic Manager nodes to a shared file system as a content synchronization mechanism in-order to share the throttling policies between Traffic Manager nodes.\n+2. Open the `<API-M_HOME>/repository/conf/deployment.toml` file in the Traffic Manager node and add the following configuration to publish events into other node.\n+\n+ \n+``` toml tab=\"Node1\"\n+[apim.throttling]\n+event_duplicate_url = [\"tcp://Traffic-Manager-2-host:5672\"]\n+```\n+\n+``` toml tab=\"Node2\"\n+[apim.throttling]\n+event_duplicate_url = [\"tcp://Traffic-Manager-1-host:5672\"]\n+```\n+\n+\n+3.  Mount the `<API-M_HOME>/repository/deployment/server/executionplans` directory of all the Traffic Manager nodes to a shared file system as a content synchronization mechanism in-order to share the throttling policies between Traffic Manager nodes.", "originalCommit": "af3c1223283b7f1dbcdf8f2fec4e5d94f5dd08ea", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDk3MjEwOQ==", "url": "https://github.com/wso2/docs-apim/pull/1693#discussion_r470972109", "bodyText": "in all Gateway components - > in all the gateway components.\ngateway components? or gateway nodes?", "author": "shaniR", "createdAt": "2020-08-15T12:20:28Z", "path": "en/docs/install-and-setup/setup/distributed-deployment/deploying-wso2-api-m-in-a-distributed-setup.md", "diffHunk": "@@ -665,7 +766,7 @@ This section involves setting up the Gateway node and enabling it to work with t\n     password = \"$ref{super_admin.password}\"\n     ```\n \n-4.  If you need to enable JSON Web Token (JWT), you have to enable it in all Gateway and Key Manager components.\n+4.  If you need to enable JSON Web Token (JWT), you have to enable it in all Gateway components.", "originalCommit": "af3c1223283b7f1dbcdf8f2fec4e5d94f5dd08ea", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODI3MDA5Mw==", "url": "https://github.com/wso2/docs-apim/pull/1693#discussion_r478270093", "bodyText": "let's add a space after this line.", "author": "isharac", "createdAt": "2020-08-27T09:07:13Z", "path": "en/docs/install-and-setup/setup/distributed-deployment/deploying-wso2-api-m-in-a-distributed-setup.md", "diffHunk": "@@ -87,6 +87,17 @@ This section involves setting up the Key Manager node and enabling it to work wi\n      [[apim.throttling.url_group]]\n      traffic_manager_urls = [\"tcp://Traffic-Manager-2-host:9611\"]\n      traffic_manager_auth_urls = [\"ssl://Traffic-Manager-2-host:9711\"]\n+\n+     [[event_listener]]\n+     id = \"token_revocation\"\n+     type = \"org.wso2.carbon.identity.core.handler.AbstractIdentityHandler\"\n+     name = \"org.wso2.is.notification.ApimOauthEventInterceptor\"\n+     order = 1", "originalCommit": "9fab0364cb609eaeb39f808193aa32cfa2aac8df", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODI3MDI4Ng==", "url": "https://github.com/wso2/docs-apim/pull/1693#discussion_r478270286", "bodyText": "here as well", "author": "isharac", "createdAt": "2020-08-27T09:07:34Z", "path": "en/docs/install-and-setup/setup/distributed-deployment/deploying-wso2-api-m-in-a-distributed-setup.md", "diffHunk": "@@ -96,8 +107,21 @@ This section involves setting up the Key Manager node and enabling it to work wi\n      [[apim.throttling.url_group]]\n      traffic_manager_urls = [\"tcp://Traffic-Manager-host:9611\"]\n      traffic_manager_auth_urls = [\"ssl://Traffic-Manager-host:9711\"]\n+\n+     [[event_listener]]\n+     id = \"token_revocation\"\n+     type = \"org.wso2.carbon.identity.core.handler.AbstractIdentityHandler\"\n+     name = \"org.wso2.is.notification.ApimOauthEventInterceptor\"\n+     order = 1", "originalCommit": "9fab0364cb609eaeb39f808193aa32cfa2aac8df", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODI3MDQ1MA==", "url": "https://github.com/wso2/docs-apim/pull/1693#discussion_r478270450", "bodyText": "here as well", "author": "isharac", "createdAt": "2020-08-27T09:07:49Z", "path": "en/docs/install-and-setup/setup/distributed-deployment/deploying-wso2-api-m-in-a-distributed-setup.md", "diffHunk": "@@ -163,11 +187,21 @@ This section involves setting up the Key Manager node and enabling it to work wi\n     \n     [apim.throttling]\n     throttle_decision_endpoints = [\"tcp://tm.wso2.com:5675\"]\n-    \n+\n     [[apim.throttling.url_group]]\n     traffic_manager_urls=[\"tcp://tm.wso2.com:9614\"]\n     traffic_manager_auth_urls=[\"ssl://tm.wso2.com:9714\"]\n \n+    [[event_listener]]\n+    id = \"token_revocation\"\n+    type = \"org.wso2.carbon.identity.core.handler.AbstractIdentityHandler\"\n+    name = \"org.wso2.is.notification.ApimOauthEventInterceptor\"\n+    order = 1", "originalCommit": "9fab0364cb609eaeb39f808193aa32cfa2aac8df", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODI3MzUyNg==", "url": "https://github.com/wso2/docs-apim/pull/1693#discussion_r478273526", "bodyText": "looks like this line is redundant or shall we make it bold to hight light it as a sub topic", "author": "isharac", "createdAt": "2020-08-27T09:13:07Z", "path": "en/docs/install-and-setup/setup/distributed-deployment/deploying-wso2-api-m-in-a-distributed-setup.md", "diffHunk": "@@ -176,11 +210,42 @@ This section involves setting up the Traffic Manager node(s) and enabling it to\n \n [![Traffic Manager Connections]({{base_path}}/assets/img/setup-and-install/traffic-manager-connections.png)]({{base_path}}/assets/img/setup-and-install/traffic-manager-connections.png)\n \n+1.  Open the `<API-M_HOME>/repository/conf/deployment.toml` file in the Traffic Manager node and change as following to point to Key Manager nodes.\n+\n+    ``` toml tab=\"Key Manager with HA\"\n+        [apim.key_manager]\n+        service_url = \"https://[Key-Manager-LB-host]/services/\"\n+        username = \"$ref{super_admin.username}\"\n+        password = \"$ref{super_admin.password}\"\n+    ```\n+        \n+    ``` toml tab=\"Single Key Manager\"\n+        [apim.key_manager]\n+        service_url = \"https://[Key-Manager-host]:${mgt.transport.https.port}/services/\"\n+        username = \"$ref{super_admin.username}\"\n+        password = \"$ref{super_admin.password}\"\n+    ```\n+##### Configuring High Availability (HA) for the Traffic Manager.", "originalCommit": "9fab0364cb609eaeb39f808193aa32cfa2aac8df", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODMzOTM3MA==", "url": "https://github.com/wso2/docs-apim/pull/1693#discussion_r478339370", "bodyText": "@shaniR wdyt ?", "author": "tharindu1st", "createdAt": "2020-08-27T11:14:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODI3MzUyNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDA5NTE5OA==", "url": "https://github.com/wso2/docs-apim/pull/1693#discussion_r480095198", "bodyText": "Since it's a heading, I think it's fine.", "author": "shaniR", "createdAt": "2020-08-31T12:26:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODI3MzUyNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODI3MzczMQ==", "url": "https://github.com/wso2/docs-apim/pull/1693#discussion_r478273731", "bodyText": "IMO step 2 and 3 should be swapped or it should be step 1 and 2 under the sub topic \"Configuring High Availability (HA) for the Traffic Manager\"", "author": "isharac", "createdAt": "2020-08-27T09:13:28Z", "path": "en/docs/install-and-setup/setup/distributed-deployment/deploying-wso2-api-m-in-a-distributed-setup.md", "diffHunk": "@@ -176,11 +210,42 @@ This section involves setting up the Traffic Manager node(s) and enabling it to\n \n [![Traffic Manager Connections]({{base_path}}/assets/img/setup-and-install/traffic-manager-connections.png)]({{base_path}}/assets/img/setup-and-install/traffic-manager-connections.png)\n \n+1.  Open the `<API-M_HOME>/repository/conf/deployment.toml` file in the Traffic Manager node and change as following to point to Key Manager nodes.\n+\n+    ``` toml tab=\"Key Manager with HA\"\n+        [apim.key_manager]\n+        service_url = \"https://[Key-Manager-LB-host]/services/\"\n+        username = \"$ref{super_admin.username}\"\n+        password = \"$ref{super_admin.password}\"\n+    ```\n+        \n+    ``` toml tab=\"Single Key Manager\"\n+        [apim.key_manager]\n+        service_url = \"https://[Key-Manager-host]:${mgt.transport.https.port}/services/\"\n+        username = \"$ref{super_admin.username}\"\n+        password = \"$ref{super_admin.password}\"\n+    ```\n+##### Configuring High Availability (HA) for the Traffic Manager.\n+\n 1.  If you need to configure High Availability (HA) for the Traffic Manager, use a copy of the existing Traffic Manager instance as the second Traffic Manager active instance and configure a load balancer fronting the two Traffic Manager instances.\n \n-2.  Mount the `<API-M_HOME>/repository/deployment/server/executionplans` directory of all the Traffic Manager nodes to a shared file system as a content synchronization mechanism in-order to share the throttling policies between Traffic Manager nodes.\n+2. Open the `<API-M_HOME>/repository/conf/deployment.toml` file in the Traffic Manager node and add the following configuration to publish events to other node.", "originalCommit": "9fab0364cb609eaeb39f808193aa32cfa2aac8df", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "5647cd8495ffac8d7223870901271e145bf447ce", "url": "https://github.com/wso2/docs-apim/commit/5647cd8495ffac8d7223870901271e145bf447ce", "message": "fix review comments", "committedDate": "2020-08-27T11:10:41Z", "type": "commit"}, {"oid": "5647cd8495ffac8d7223870901271e145bf447ce", "url": "https://github.com/wso2/docs-apim/commit/5647cd8495ffac8d7223870901271e145bf447ce", "message": "fix review comments", "committedDate": "2020-08-27T11:10:41Z", "type": "forcePushed"}, {"oid": "736157a5a4c19ad977a0572a4f6f1f00fc9897d1", "url": "https://github.com/wso2/docs-apim/commit/736157a5a4c19ad977a0572a4f6f1f00fc9897d1", "message": "Reviewed and fixed.", "committedDate": "2020-08-31T12:24:27Z", "type": "commit"}]}