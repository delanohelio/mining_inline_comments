{"pr_number": 2183, "pr_title": "Adding git integration config doc for apictl", "pr_createdAt": "2020-11-03T07:16:04Z", "pr_url": "https://github.com/wso2/docs-apim/pull/2183", "timeline": [{"oid": "b61a0fca688cb1a0170b813d2500f0bf3fa5deee", "url": "https://github.com/wso2/docs-apim/commit/b61a0fca688cb1a0170b813d2500f0bf3fa5deee", "message": "adding git integration config doc for apictl", "committedDate": "2020-11-03T06:14:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ2MzAxNw==", "url": "https://github.com/wso2/docs-apim/pull/2183#discussion_r516463017", "bodyText": "Shall we modify as \"Identifying APIs\"?", "author": "npamudika", "createdAt": "2020-11-03T07:19:51Z", "path": "en/docs/learn/api-controller/advanced-topics/configuring-git-integration.md", "diffHunk": "@@ -0,0 +1,96 @@\n+#  Configuring Git Integration\n+\n+API Controller natively supports identifying API or any other types of projects in a Git repository and seamlessly deploying the changes of the projects to a given API Manager environment. This topic is regarding some of the configurations that you can use to optimize the Git integration functionality.", "originalCommit": "b61a0fca688cb1a0170b813d2500f0bf3fa5deee", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ2NjkyOA==", "url": "https://github.com/wso2/docs-apim/pull/2183#discussion_r516466928", "bodyText": "What I meant here was API as project type.. which one would suit the most?\n\nidentifying API or any other types of projects (current)\nidentifying API or any other type of projects\nidentifying APIs or any other types of projects (your suggestion)", "author": "malinthaprasan", "createdAt": "2020-11-03T07:31:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ2MzAxNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ2OTY4Mw==", "url": "https://github.com/wso2/docs-apim/pull/2183#discussion_r516469683", "bodyText": "Will go with above \"Identifying APIs\". That looks better.", "author": "malinthaprasan", "createdAt": "2020-11-03T07:39:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ2MzAxNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ2MzIyOQ==", "url": "https://github.com/wso2/docs-apim/pull/2183#discussion_r516463229", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            After project deletion is enabled, any deleted API/Application or API Product project from the Git repository is detected from the `apictl vcs deploy -e <environment>` command and those projects will be deleted from the particular environment as well.\n          \n          \n            \n            After the project deletion is enabled, any deleted API/Application or API Product project from the Git repository is detected from the `apictl vcs deploy -e <environment>` command and those projects will be deleted from the particular environment as well.", "author": "npamudika", "createdAt": "2020-11-03T07:20:32Z", "path": "en/docs/learn/api-controller/advanced-topics/configuring-git-integration.md", "diffHunk": "@@ -0,0 +1,96 @@\n+#  Configuring Git Integration\n+\n+API Controller natively supports identifying API or any other types of projects in a Git repository and seamlessly deploying the changes of the projects to a given API Manager environment. This topic is regarding some of the configurations that you can use to optimize the Git integration functionality.\n+\n+## Enabling Project Deletion via Git Integration\n+\n+By default, API/Application/API Product deletion is disabled in API Controller. In order to enable it, use the below `apictl set` command.\n+\n+```bash\n+apictl set --vcs-deletion-enabled=true\n+```\n+\n+After project deletion is enabled, any deleted API/Application or API Product project from the Git repository is detected from the `apictl vcs deploy -e <environment>` command and those projects will be deleted from the particular environment as well.", "originalCommit": "b61a0fca688cb1a0170b813d2500f0bf3fa5deee", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ2NDEyOA==", "url": "https://github.com/wso2/docs-apim/pull/2183#discussion_r516464128", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Unlike the other configuration files inside `.wso2apictl`, `vcs_config.yaml` maintains a state for each repository. So it is mandatory to persist it during each `apictl vcs` command execution during each build cycle. In some container-based build systems, it might be difficult to keep this file persisted and make it available for each build cycle as it is required to enable volume mounts etc. It is also not advisable to persist/share the full `.wso2apictl` folder as it might include credentials. In such cases, an alternative approach would be externalizing the `vcs_config.yaml` into a different location where volume mounts or some persistence mechanism can be enabled for  `vcs_config.yaml` only.\n          \n          \n            \n            Unlike the other configuration files inside `.wso2apictl`, `vcs_config.yaml` maintains a state for each repository. So it is mandatory to persist it during each `apictl vcs` command execution during each build cycle. In some container-based build systems, it might be difficult to keep this file persisted and make it available for each build cycle as it is required to enable volume mounts etc. It is also not advisable to persist/share the full `.wso2apictl` folder as it might include credentials. In such cases, an alternative approach would be to externalize the `vcs_config.yaml` into a different location where volume mounts or some persistence mechanism can be enabled for `vcs_config.yaml` only.", "author": "npamudika", "createdAt": "2020-11-03T07:23:29Z", "path": "en/docs/learn/api-controller/advanced-topics/configuring-git-integration.md", "diffHunk": "@@ -0,0 +1,96 @@\n+#  Configuring Git Integration\n+\n+API Controller natively supports identifying API or any other types of projects in a Git repository and seamlessly deploying the changes of the projects to a given API Manager environment. This topic is regarding some of the configurations that you can use to optimize the Git integration functionality.\n+\n+## Enabling Project Deletion via Git Integration\n+\n+By default, API/Application/API Product deletion is disabled in API Controller. In order to enable it, use the below `apictl set` command.\n+\n+```bash\n+apictl set --vcs-deletion-enabled=true\n+```\n+\n+After project deletion is enabled, any deleted API/Application or API Product project from the Git repository is detected from the `apictl vcs deploy -e <environment>` command and those projects will be deleted from the particular environment as well.\n+\n+\n+!!! example\n+    ```bash\n+    $ apictl vcs deploy -e dev\n+    Deploying Projects (1)...\n+\n+    APIs (1) ...\n+    1: PizzaShackAPI-1.0.0: (PizzaShackAPI-1.0.0) awaiting deletion..\n+\n+    Deleting projects ..\n+    Switched to a new branch 'tmp-42b69a8c'\n+\n+    APIs (1) ...\n+    1: PizzaShackAPI-1.0.0: (PizzaShackAPI-1.0.0)\n+    API deleted successfully!. Status: 200\n+    Switched to branch 'master'\n+    ```\n+\n+## Externalizing the VCS Configuration\n+\n+API Controller's Git integration feature uses a dedicated configuration file which is located in `/home/<user>/.wso2apictl/vcs_config.yaml`. \n+\n+The structure of the file is as per below:\n+\n+\n+``` tab=\"Format\"\n+repos:\n+  <repoId1>: # This is coming from the \"vcs.yaml\" file (created via \"apictl vcs init\") of the Git repository.\n+    environments:\n+      <environment1>:\n+        lastAttemptedRev: <lastAttemptedGitCommitId>\n+        lastSuccessfulRev:\n+        - <lastSuccessfulGitCommitId> # This is equal to the <lastAttemptedGitCommitId>\n+        - <previousSuccessfulGitCommitId>\n+        - <..>\n+        failedProjects: {}\n+  <repoId2>:\n+    environments:\n+      <environment1>:\n+        ..\n+  <repoId3>:\n+    ..\n+...\n+```\n+\n+``` tab=\"Example\"\n+repos:\n+  99f6338f-24e0-42da-a69e-78aba98d0380:\n+    environments:\n+      dev:\n+        lastAttemptedRev: 7ef7911f197640b82b0c7f36f62f8b23d40d3bc1\n+        lastSuccessfulRev:\n+        - 7ef7911f197640b82b0c7f36f62f8b23d40d3bc1\n+        - 81b5a5f3998c1e04f6e37357b6e6bb09a1fe8fe6\n+        failedProjects: {}\n+  6815a6fa-a63c-4ff4-b690-7d85661bb187:\n+    environments:\n+      dev:\n+        lastAttemptedRev: 72925a149a6afa954d5a94dd79480adc4f812542\n+        lastSuccessfulRev:\n+        - 72925a149a6afa954d5a94dd79480adc4f812542\n+        - e8d2d308c6140f63c4eb5c0765ab79e4eee9aeb9\n+        - b4fed92fdac370b62b38eafcbc23c40382c5c277\n+        failedProjects: {}\n+```\n+\n+Unlike the other configuration files inside `.wso2apictl`, `vcs_config.yaml` maintains a state for each repository. So it is mandatory to persist it during each `apictl vcs` command execution during each build cycle. In some container-based build systems, it might be difficult to keep this file persisted and make it available for each build cycle as it is required to enable volume mounts etc. It is also not advisable to persist/share the full `.wso2apictl` folder as it might include credentials. In such cases, an alternative approach would be externalizing the `vcs_config.yaml` into a different location where volume mounts or some persistence mechanism can be enabled for  `vcs_config.yaml` only.", "originalCommit": "b61a0fca688cb1a0170b813d2500f0bf3fa5deee", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "df5604522c72eb1b039d5c562a6b34e37f2416da", "url": "https://github.com/wso2/docs-apim/commit/df5604522c72eb1b039d5c562a6b34e37f2416da", "message": "adding review suggestions", "committedDate": "2020-11-03T07:40:26Z", "type": "commit"}]}