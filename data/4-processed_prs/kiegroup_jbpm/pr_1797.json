{"pr_number": 1797, "pr_title": "[JBPM-9459] Nested process instances abort doesn't work when a task in event subprocess is marked with \"Is Async\" as true", "pr_createdAt": "2020-11-10T12:23:30Z", "pr_url": "https://github.com/kiegroup/jbpm/pull/1797", "timeline": [{"oid": "6792e1ea4b8cdb2fd5c6b3a4f591ad75c8d5f341", "url": "https://github.com/kiegroup/jbpm/commit/6792e1ea4b8cdb2fd5c6b3a4f591ad75c8d5f341", "message": "[JBPM-9459] Nested process instances abort doesn't work when a task in event subprocess is marked with \"Is Async\" as true", "committedDate": "2020-11-10T13:20:17Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTM0NTE4OA==", "url": "https://github.com/kiegroup/jbpm/pull/1797#discussion_r521345188", "bodyText": "typo\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            // we need to abort first otherwise the end node will completed the process normally (something that should not happen\n          \n          \n            \n                            // we need to abort first otherwise the end node will complete the process normally (something that should not happen)", "author": "afalhambra", "createdAt": "2020-11-11T13:07:00Z", "path": "jbpm-flow/src/main/java/org/jbpm/workflow/instance/node/EventSubProcessNodeInstance.java", "diffHunk": "@@ -79,21 +79,23 @@ public void nodeInstanceCompleted(org.jbpm.workflow.instance.NodeInstance nodeIn\n         if (nodeInstance instanceof EndNodeInstance) { \n             if (getCompositeNode().isKeepActive()) {\n                 StartNode startNode = getCompositeNode().findStartNode();\n-                triggerCompleted(true);\n+\n+                // we need to abort first otherwise the end node will completed the process normally (something that should not happen", "originalCommit": "6792e1ea4b8cdb2fd5c6b3a4f591ad75c8d5f341", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAyMzcxOQ==", "url": "https://github.com/kiegroup/jbpm/pull/1797#discussion_r522023719", "bodyText": "done", "author": "elguardian", "createdAt": "2020-11-12T11:07:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTM0NTE4OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTk5MTQ5Mw==", "url": "https://github.com/kiegroup/jbpm/pull/1797#discussion_r521991493", "bodyText": "please change package name\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              <bpmn2:process id=\"nested-abort.exception\" drools:packageName=\"com.bala.nested_abort\" drools:version=\"1.0\" drools:adHoc=\"false\" name=\"exception\" isExecutable=\"true\" processType=\"Public\">\n          \n          \n            \n              <bpmn2:process id=\"nested-abort.exception\" drools:packageName=\"org.jbpm.test.nested_abort\" drools:version=\"1.0\" drools:adHoc=\"false\" name=\"exception\" isExecutable=\"true\" processType=\"Public\">", "author": "afalhambra", "createdAt": "2020-11-12T10:15:47Z", "path": "jbpm-test-coverage/src/test/resources/org/jbpm/test/functional/async/Exception.bpmn2", "diffHunk": "@@ -0,0 +1,286 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<bpmn2:definitions xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns=\"http://www.omg.org/bpmn20\" xmlns:bpmn2=\"http://www.omg.org/spec/BPMN/20100524/MODEL\" xmlns:bpmndi=\"http://www.omg.org/spec/BPMN/20100524/DI\" xmlns:bpsim=\"http://www.bpsim.org/schemas/1.0\" xmlns:dc=\"http://www.omg.org/spec/DD/20100524/DC\" xmlns:di=\"http://www.omg.org/spec/DD/20100524/DI\" xmlns:drools=\"http://www.jboss.org/drools\" id=\"_0S1DcBjUEeunWshXBgPhRw\" xsi:schemaLocation=\"http://www.omg.org/spec/BPMN/20100524/MODEL BPMN20.xsd http://www.jboss.org/drools drools.xsd http://www.bpsim.org/schemas/1.0 bpsim.xsd http://www.omg.org/spec/DD/20100524/DC DC.xsd http://www.omg.org/spec/DD/20100524/DI DI.xsd \" exporter=\"jBPM Process Modeler\" exporterVersion=\"2.0\" targetNamespace=\"http://www.omg.org/bpmn20\">\n+  <bpmn2:itemDefinition id=\"__1DBE0765-593C-45A8-B3AA-337A64D3062E_ConnectTimeoutInputXItem\" structureRef=\"String\"/>\n+  <bpmn2:itemDefinition id=\"__1DBE0765-593C-45A8-B3AA-337A64D3062E_ContentDataInputXItem\" structureRef=\"String\"/>\n+  <bpmn2:itemDefinition id=\"__1DBE0765-593C-45A8-B3AA-337A64D3062E_MethodInputXItem\" structureRef=\"String\"/>\n+  <bpmn2:itemDefinition id=\"__1DBE0765-593C-45A8-B3AA-337A64D3062E_PasswordInputXItem\" structureRef=\"String\"/>\n+  <bpmn2:itemDefinition id=\"__1DBE0765-593C-45A8-B3AA-337A64D3062E_ReadTimeoutInputXItem\" structureRef=\"String\"/>\n+  <bpmn2:itemDefinition id=\"__1DBE0765-593C-45A8-B3AA-337A64D3062E_UrlInputXItem\" structureRef=\"String\"/>\n+  <bpmn2:itemDefinition id=\"__1DBE0765-593C-45A8-B3AA-337A64D3062E_UsernameInputXItem\" structureRef=\"String\"/>\n+  <bpmn2:itemDefinition id=\"__C48C30F9-F9BF-43B8-A1FC-46CB271B5526_ConnectTimeoutInputXItem\" structureRef=\"String\"/>\n+  <bpmn2:itemDefinition id=\"__C48C30F9-F9BF-43B8-A1FC-46CB271B5526_ContentDataInputXItem\" structureRef=\"String\"/>\n+  <bpmn2:itemDefinition id=\"__C48C30F9-F9BF-43B8-A1FC-46CB271B5526_MethodInputXItem\" structureRef=\"String\"/>\n+  <bpmn2:itemDefinition id=\"__C48C30F9-F9BF-43B8-A1FC-46CB271B5526_PasswordInputXItem\" structureRef=\"String\"/>\n+  <bpmn2:itemDefinition id=\"__C48C30F9-F9BF-43B8-A1FC-46CB271B5526_ReadTimeoutInputXItem\" structureRef=\"String\"/>\n+  <bpmn2:itemDefinition id=\"__C48C30F9-F9BF-43B8-A1FC-46CB271B5526_UrlInputXItem\" structureRef=\"String\"/>\n+  <bpmn2:itemDefinition id=\"__C48C30F9-F9BF-43B8-A1FC-46CB271B5526_UsernameInputXItem\" structureRef=\"String\"/>\n+  <bpmn2:process id=\"nested-abort.exception\" drools:packageName=\"com.bala.nested_abort\" drools:version=\"1.0\" drools:adHoc=\"false\" name=\"exception\" isExecutable=\"true\" processType=\"Public\">", "originalCommit": "6792e1ea4b8cdb2fd5c6b3a4f591ad75c8d5f341", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAzMTc2MQ==", "url": "https://github.com/kiegroup/jbpm/pull/1797#discussion_r522031761", "bodyText": "done", "author": "elguardian", "createdAt": "2020-11-12T11:21:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTk5MTQ5Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTk5MjA3MQ==", "url": "https://github.com/kiegroup/jbpm/pull/1797#discussion_r521992071", "bodyText": "There's no need for a second task call actually. This can be removed.", "author": "afalhambra", "createdAt": "2020-11-12T10:16:41Z", "path": "jbpm-test-coverage/src/test/resources/org/jbpm/test/functional/async/Exception.bpmn2", "diffHunk": "@@ -0,0 +1,286 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<bpmn2:definitions xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns=\"http://www.omg.org/bpmn20\" xmlns:bpmn2=\"http://www.omg.org/spec/BPMN/20100524/MODEL\" xmlns:bpmndi=\"http://www.omg.org/spec/BPMN/20100524/DI\" xmlns:bpsim=\"http://www.bpsim.org/schemas/1.0\" xmlns:dc=\"http://www.omg.org/spec/DD/20100524/DC\" xmlns:di=\"http://www.omg.org/spec/DD/20100524/DI\" xmlns:drools=\"http://www.jboss.org/drools\" id=\"_0S1DcBjUEeunWshXBgPhRw\" xsi:schemaLocation=\"http://www.omg.org/spec/BPMN/20100524/MODEL BPMN20.xsd http://www.jboss.org/drools drools.xsd http://www.bpsim.org/schemas/1.0 bpsim.xsd http://www.omg.org/spec/DD/20100524/DC DC.xsd http://www.omg.org/spec/DD/20100524/DI DI.xsd \" exporter=\"jBPM Process Modeler\" exporterVersion=\"2.0\" targetNamespace=\"http://www.omg.org/bpmn20\">\n+  <bpmn2:itemDefinition id=\"__1DBE0765-593C-45A8-B3AA-337A64D3062E_ConnectTimeoutInputXItem\" structureRef=\"String\"/>\n+  <bpmn2:itemDefinition id=\"__1DBE0765-593C-45A8-B3AA-337A64D3062E_ContentDataInputXItem\" structureRef=\"String\"/>\n+  <bpmn2:itemDefinition id=\"__1DBE0765-593C-45A8-B3AA-337A64D3062E_MethodInputXItem\" structureRef=\"String\"/>\n+  <bpmn2:itemDefinition id=\"__1DBE0765-593C-45A8-B3AA-337A64D3062E_PasswordInputXItem\" structureRef=\"String\"/>\n+  <bpmn2:itemDefinition id=\"__1DBE0765-593C-45A8-B3AA-337A64D3062E_ReadTimeoutInputXItem\" structureRef=\"String\"/>\n+  <bpmn2:itemDefinition id=\"__1DBE0765-593C-45A8-B3AA-337A64D3062E_UrlInputXItem\" structureRef=\"String\"/>\n+  <bpmn2:itemDefinition id=\"__1DBE0765-593C-45A8-B3AA-337A64D3062E_UsernameInputXItem\" structureRef=\"String\"/>\n+  <bpmn2:itemDefinition id=\"__C48C30F9-F9BF-43B8-A1FC-46CB271B5526_ConnectTimeoutInputXItem\" structureRef=\"String\"/>\n+  <bpmn2:itemDefinition id=\"__C48C30F9-F9BF-43B8-A1FC-46CB271B5526_ContentDataInputXItem\" structureRef=\"String\"/>\n+  <bpmn2:itemDefinition id=\"__C48C30F9-F9BF-43B8-A1FC-46CB271B5526_MethodInputXItem\" structureRef=\"String\"/>\n+  <bpmn2:itemDefinition id=\"__C48C30F9-F9BF-43B8-A1FC-46CB271B5526_PasswordInputXItem\" structureRef=\"String\"/>\n+  <bpmn2:itemDefinition id=\"__C48C30F9-F9BF-43B8-A1FC-46CB271B5526_ReadTimeoutInputXItem\" structureRef=\"String\"/>\n+  <bpmn2:itemDefinition id=\"__C48C30F9-F9BF-43B8-A1FC-46CB271B5526_UrlInputXItem\" structureRef=\"String\"/>\n+  <bpmn2:itemDefinition id=\"__C48C30F9-F9BF-43B8-A1FC-46CB271B5526_UsernameInputXItem\" structureRef=\"String\"/>\n+  <bpmn2:process id=\"nested-abort.exception\" drools:packageName=\"com.bala.nested_abort\" drools:version=\"1.0\" drools:adHoc=\"false\" name=\"exception\" isExecutable=\"true\" processType=\"Public\">\n+    <bpmn2:sequenceFlow id=\"_41FDCB68-AD96-4E54-847F-6CA248DE0D64\" sourceRef=\"_1DBE0765-593C-45A8-B3AA-337A64D3062E\" targetRef=\"_998B99CB-C057-44EC-80F8-0C1C67632319\">\n+      <bpmn2:extensionElements>\n+        <drools:metaData name=\"isAutoConnection.target\">\n+          <drools:metaValue><![CDATA[true]]></drools:metaValue>\n+        </drools:metaData>\n+      </bpmn2:extensionElements>\n+    </bpmn2:sequenceFlow>\n+    <bpmn2:sequenceFlow id=\"_DA62AAE0-2F86-426E-BB72-35B82267F16B\" sourceRef=\"_C48C30F9-F9BF-43B8-A1FC-46CB271B5526\" targetRef=\"_1DBE0765-593C-45A8-B3AA-337A64D3062E\">\n+      <bpmn2:extensionElements>\n+        <drools:metaData name=\"isAutoConnection.target\">\n+          <drools:metaValue><![CDATA[true]]></drools:metaValue>\n+        </drools:metaData>\n+      </bpmn2:extensionElements>\n+    </bpmn2:sequenceFlow>\n+    <bpmn2:sequenceFlow id=\"_44F0D147-486A-4142-8F8B-0C1A1494D245\" sourceRef=\"_26C4F040-851F-4EDA-9222-23BAA7B05B64\" targetRef=\"_C48C30F9-F9BF-43B8-A1FC-46CB271B5526\">\n+      <bpmn2:extensionElements>\n+        <drools:metaData name=\"isAutoConnection.source\">\n+          <drools:metaValue><![CDATA[true]]></drools:metaValue>\n+        </drools:metaData>\n+      </bpmn2:extensionElements>\n+    </bpmn2:sequenceFlow>\n+    <bpmn2:sequenceFlow id=\"_3CCDD702-7C2D-44A3-99C6-EF7AC511C461\" sourceRef=\"_E5580B86-C933-4E61-AFA7-DBD56F59746E\" targetRef=\"_26C4F040-851F-4EDA-9222-23BAA7B05B64\">\n+      <bpmn2:extensionElements>\n+        <drools:metaData name=\"isAutoConnection.target\">\n+          <drools:metaValue><![CDATA[true]]></drools:metaValue>\n+        </drools:metaData>\n+      </bpmn2:extensionElements>\n+    </bpmn2:sequenceFlow>\n+    <bpmn2:endEvent id=\"_998B99CB-C057-44EC-80F8-0C1C67632319\">\n+      <bpmn2:incoming>_41FDCB68-AD96-4E54-847F-6CA248DE0D64</bpmn2:incoming>\n+    </bpmn2:endEvent>\n+    <bpmn2:task id=\"_C48C30F9-F9BF-43B8-A1FC-46CB271B5526\" drools:taskName=\"Rest\" name=\"REST\">\n+      <bpmn2:extensionElements>\n+        <drools:metaData name=\"elementname\">\n+          <drools:metaValue><![CDATA[REST]]></drools:metaValue>\n+        </drools:metaData>\n+        <drools:metaData name=\"customAsync\">\n+          <drools:metaValue><![CDATA[true]]></drools:metaValue>\n+        </drools:metaData>\n+      </bpmn2:extensionElements>\n+      <bpmn2:incoming>_44F0D147-486A-4142-8F8B-0C1A1494D245</bpmn2:incoming>\n+      <bpmn2:outgoing>_DA62AAE0-2F86-426E-BB72-35B82267F16B</bpmn2:outgoing>\n+      <bpmn2:ioSpecification id=\"_0S1DcRjUEeunWshXBgPhRw\">\n+        <bpmn2:dataInput id=\"_C48C30F9-F9BF-43B8-A1FC-46CB271B5526_ConnectTimeoutInputX\" drools:dtype=\"String\" itemSubjectRef=\"__C48C30F9-F9BF-43B8-A1FC-46CB271B5526_ConnectTimeoutInputXItem\" name=\"ConnectTimeout\"/>\n+        <bpmn2:dataInput id=\"_C48C30F9-F9BF-43B8-A1FC-46CB271B5526_ContentDataInputX\" drools:dtype=\"String\" itemSubjectRef=\"__C48C30F9-F9BF-43B8-A1FC-46CB271B5526_ContentDataInputXItem\" name=\"ContentData\"/>\n+        <bpmn2:dataInput id=\"_C48C30F9-F9BF-43B8-A1FC-46CB271B5526_MethodInputX\" drools:dtype=\"String\" itemSubjectRef=\"__C48C30F9-F9BF-43B8-A1FC-46CB271B5526_MethodInputXItem\" name=\"Method\"/>\n+        <bpmn2:dataInput id=\"_C48C30F9-F9BF-43B8-A1FC-46CB271B5526_PasswordInputX\" drools:dtype=\"String\" itemSubjectRef=\"__C48C30F9-F9BF-43B8-A1FC-46CB271B5526_PasswordInputXItem\" name=\"Password\"/>\n+        <bpmn2:dataInput id=\"_C48C30F9-F9BF-43B8-A1FC-46CB271B5526_ReadTimeoutInputX\" drools:dtype=\"String\" itemSubjectRef=\"__C48C30F9-F9BF-43B8-A1FC-46CB271B5526_ReadTimeoutInputXItem\" name=\"ReadTimeout\"/>\n+        <bpmn2:dataInput id=\"_C48C30F9-F9BF-43B8-A1FC-46CB271B5526_UrlInputX\" drools:dtype=\"String\" itemSubjectRef=\"__C48C30F9-F9BF-43B8-A1FC-46CB271B5526_UrlInputXItem\" name=\"Url\"/>\n+        <bpmn2:dataInput id=\"_C48C30F9-F9BF-43B8-A1FC-46CB271B5526_UsernameInputX\" drools:dtype=\"String\" itemSubjectRef=\"__C48C30F9-F9BF-43B8-A1FC-46CB271B5526_UsernameInputXItem\" name=\"Username\"/>\n+        <bpmn2:dataInput id=\"_C48C30F9-F9BF-43B8-A1FC-46CB271B5526_TaskNameInputX\" drools:dtype=\"Object\" name=\"TaskName\"/>\n+        <bpmn2:inputSet id=\"_0S1DchjUEeunWshXBgPhRw\">\n+          <bpmn2:dataInputRefs>_C48C30F9-F9BF-43B8-A1FC-46CB271B5526_ConnectTimeoutInputX</bpmn2:dataInputRefs>\n+          <bpmn2:dataInputRefs>_C48C30F9-F9BF-43B8-A1FC-46CB271B5526_ContentDataInputX</bpmn2:dataInputRefs>\n+          <bpmn2:dataInputRefs>_C48C30F9-F9BF-43B8-A1FC-46CB271B5526_MethodInputX</bpmn2:dataInputRefs>\n+          <bpmn2:dataInputRefs>_C48C30F9-F9BF-43B8-A1FC-46CB271B5526_PasswordInputX</bpmn2:dataInputRefs>\n+          <bpmn2:dataInputRefs>_C48C30F9-F9BF-43B8-A1FC-46CB271B5526_ReadTimeoutInputX</bpmn2:dataInputRefs>\n+          <bpmn2:dataInputRefs>_C48C30F9-F9BF-43B8-A1FC-46CB271B5526_UrlInputX</bpmn2:dataInputRefs>\n+          <bpmn2:dataInputRefs>_C48C30F9-F9BF-43B8-A1FC-46CB271B5526_UsernameInputX</bpmn2:dataInputRefs>\n+          <bpmn2:dataInputRefs>_C48C30F9-F9BF-43B8-A1FC-46CB271B5526_TaskNameInputX</bpmn2:dataInputRefs>\n+        </bpmn2:inputSet>\n+        <bpmn2:outputSet id=\"_0S1DcxjUEeunWshXBgPhRw\"/>\n+      </bpmn2:ioSpecification>\n+      <bpmn2:dataInputAssociation id=\"_0S1DdBjUEeunWshXBgPhRw\">\n+        <bpmn2:targetRef>_C48C30F9-F9BF-43B8-A1FC-46CB271B5526_MethodInputX</bpmn2:targetRef>\n+        <bpmn2:assignment id=\"_0S1DdRjUEeunWshXBgPhRw\">\n+          <bpmn2:from xsi:type=\"bpmn2:tFormalExpression\" id=\"_0S1DdhjUEeunWshXBgPhRw\"><![CDATA[GET]]></bpmn2:from>\n+          <bpmn2:to xsi:type=\"bpmn2:tFormalExpression\" id=\"_0S1DdxjUEeunWshXBgPhRw\">_C48C30F9-F9BF-43B8-A1FC-46CB271B5526_MethodInputX</bpmn2:to>\n+        </bpmn2:assignment>\n+      </bpmn2:dataInputAssociation>\n+      <bpmn2:dataInputAssociation id=\"_0S1DeBjUEeunWshXBgPhRw\">\n+        <bpmn2:targetRef>_C48C30F9-F9BF-43B8-A1FC-46CB271B5526_UrlInputX</bpmn2:targetRef>\n+        <bpmn2:assignment id=\"_0S1DeRjUEeunWshXBgPhRw\">\n+          <bpmn2:from xsi:type=\"bpmn2:tFormalExpression\" id=\"_0S1DehjUEeunWshXBgPhRw\"><![CDATA[https://www.google.com]]></bpmn2:from>\n+          <bpmn2:to xsi:type=\"bpmn2:tFormalExpression\" id=\"_0S1DexjUEeunWshXBgPhRw\">_C48C30F9-F9BF-43B8-A1FC-46CB271B5526_UrlInputX</bpmn2:to>\n+        </bpmn2:assignment>\n+      </bpmn2:dataInputAssociation>\n+      <bpmn2:dataInputAssociation id=\"_0S1DfBjUEeunWshXBgPhRw\">\n+        <bpmn2:targetRef>_C48C30F9-F9BF-43B8-A1FC-46CB271B5526_TaskNameInputX</bpmn2:targetRef>\n+        <bpmn2:assignment id=\"_0S1DfRjUEeunWshXBgPhRw\">\n+          <bpmn2:from xsi:type=\"bpmn2:tFormalExpression\" id=\"_0S1DfhjUEeunWshXBgPhRw\"><![CDATA[Rest]]></bpmn2:from>\n+          <bpmn2:to xsi:type=\"bpmn2:tFormalExpression\" id=\"_0S1DfxjUEeunWshXBgPhRw\">_C48C30F9-F9BF-43B8-A1FC-46CB271B5526_TaskNameInputX</bpmn2:to>\n+        </bpmn2:assignment>\n+      </bpmn2:dataInputAssociation>\n+    </bpmn2:task>\n+    <bpmn2:task id=\"_1DBE0765-593C-45A8-B3AA-337A64D3062E\" drools:taskName=\"Rest\" name=\"REST\">", "originalCommit": "6792e1ea4b8cdb2fd5c6b3a4f591ad75c8d5f341", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTk5NDE2Nw==", "url": "https://github.com/kiegroup/jbpm/pull/1797#discussion_r521994167", "bodyText": "please change package name\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              <bpmn2:process id=\"nested-abort.level1P\" drools:packageName=\"com.bala.nested_abort\" drools:version=\"1.0\" drools:adHoc=\"false\" name=\"level1P\" isExecutable=\"true\" processType=\"Public\">\n          \n          \n            \n              <bpmn2:process id=\"nested-abort.level1P\" drools:packageName=\"org.jbpm.test.nested_abort\" drools:version=\"1.0\" drools:adHoc=\"false\" name=\"level1P\" isExecutable=\"true\" processType=\"Public\">", "author": "afalhambra", "createdAt": "2020-11-12T10:19:58Z", "path": "jbpm-test-coverage/src/test/resources/org/jbpm/test/functional/async/Level1P.bpmn2", "diffHunk": "@@ -0,0 +1,147 @@\n+<bpmn2:definitions xmlns:bpmn2=\"http://www.omg.org/spec/BPMN/20100524/MODEL\" xmlns:bpmndi=\"http://www.omg.org/spec/BPMN/20100524/DI\" xmlns:bpsim=\"http://www.bpsim.org/schemas/1.0\" xmlns:dc=\"http://www.omg.org/spec/DD/20100524/DC\" xmlns:di=\"http://www.omg.org/spec/DD/20100524/DI\" xmlns:drools=\"http://www.jboss.org/drools\" id=\"_jVei4PC-EDifGe5PaIYmug\" exporter=\"jBPM Process Modeler\" exporterVersion=\"2.0\" targetNamespace=\"http://www.omg.org/bpmn20\">\n+  <bpmn2:process id=\"nested-abort.level1P\" drools:packageName=\"com.bala.nested_abort\" drools:version=\"1.0\" drools:adHoc=\"false\" name=\"level1P\" isExecutable=\"true\" processType=\"Public\">", "originalCommit": "6792e1ea4b8cdb2fd5c6b3a4f591ad75c8d5f341", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAzMDk5MQ==", "url": "https://github.com/kiegroup/jbpm/pull/1797#discussion_r522030991", "bodyText": "done", "author": "elguardian", "createdAt": "2020-11-12T11:19:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTk5NDE2Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTk5NDY2Mw==", "url": "https://github.com/kiegroup/jbpm/pull/1797#discussion_r521994663", "bodyText": "please change package name\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              <bpmn2:process id=\"nested-abort.level2C\" drools:packageName=\"com.bala.nested_abort\" drools:version=\"1.0\" drools:adHoc=\"false\" name=\"level2C\" isExecutable=\"true\" processType=\"Public\">\n          \n          \n            \n              <bpmn2:process id=\"nested-abort.level2C\" drools:packageName=\"org.jbpm.test.nested_abort\" drools:version=\"1.0\" drools:adHoc=\"false\" name=\"level2C\" isExecutable=\"true\" processType=\"Public\">", "author": "afalhambra", "createdAt": "2020-11-12T10:20:44Z", "path": "jbpm-test-coverage/src/test/resources/org/jbpm/test/functional/async/Level2C.bpmn2", "diffHunk": "@@ -0,0 +1,145 @@\n+<bpmn2:definitions xmlns:bpmn2=\"http://www.omg.org/spec/BPMN/20100524/MODEL\" xmlns:bpmndi=\"http://www.omg.org/spec/BPMN/20100524/DI\" xmlns:bpsim=\"http://www.bpsim.org/schemas/1.0\" xmlns:dc=\"http://www.omg.org/spec/DD/20100524/DC\" xmlns:di=\"http://www.omg.org/spec/DD/20100524/DI\" xmlns:drools=\"http://www.jboss.org/drools\" id=\"_lJnaAPC-EDiFTownq8X-mw\" exporter=\"jBPM Process Modeler\" exporterVersion=\"2.0\" targetNamespace=\"http://www.omg.org/bpmn20\">\n+  <bpmn2:process id=\"nested-abort.level2C\" drools:packageName=\"com.bala.nested_abort\" drools:version=\"1.0\" drools:adHoc=\"false\" name=\"level2C\" isExecutable=\"true\" processType=\"Public\">", "originalCommit": "6792e1ea4b8cdb2fd5c6b3a4f591ad75c8d5f341", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAzMTA5NQ==", "url": "https://github.com/kiegroup/jbpm/pull/1797#discussion_r522031095", "bodyText": "done", "author": "elguardian", "createdAt": "2020-11-12T11:19:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTk5NDY2Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTk5NTc5OA==", "url": "https://github.com/kiegroup/jbpm/pull/1797#discussion_r521995798", "bodyText": "please change package name\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              <bpmn2:process id=\"nested-abort.level3SC\" drools:packageName=\"com.bala.nested_abort\" drools:version=\"1.0\" drools:adHoc=\"false\" name=\"level3SC\" isExecutable=\"true\" processType=\"Public\">\n          \n          \n            \n              <bpmn2:process id=\"nested-abort.level3SC\" drools:packageName=\"org.jbpm.test.nested_abort\" drools:version=\"1.0\" drools:adHoc=\"false\" name=\"level3SC\" isExecutable=\"true\" processType=\"Public\">", "author": "afalhambra", "createdAt": "2020-11-12T10:22:29Z", "path": "jbpm-test-coverage/src/test/resources/org/jbpm/test/functional/async/Level3SC.bpmn2", "diffHunk": "@@ -0,0 +1,204 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<bpmn2:definitions xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns=\"http://www.omg.org/bpmn20\" xmlns:bpmn2=\"http://www.omg.org/spec/BPMN/20100524/MODEL\" xmlns:bpmndi=\"http://www.omg.org/spec/BPMN/20100524/DI\" xmlns:bpsim=\"http://www.bpsim.org/schemas/1.0\" xmlns:dc=\"http://www.omg.org/spec/DD/20100524/DC\" xmlns:di=\"http://www.omg.org/spec/DD/20100524/DI\" xmlns:drools=\"http://www.jboss.org/drools\" id=\"_VoC38A6eEeuLXvl6Y20vSQ\" xsi:schemaLocation=\"http://www.omg.org/spec/BPMN/20100524/MODEL BPMN20.xsd http://www.jboss.org/drools drools.xsd http://www.bpsim.org/schemas/1.0 bpsim.xsd http://www.omg.org/spec/DD/20100524/DC DC.xsd http://www.omg.org/spec/DD/20100524/DI DI.xsd \" exporter=\"jBPM Process Modeler\" exporterVersion=\"2.0\" targetNamespace=\"http://www.omg.org/bpmn20\">\n+  <bpmn2:error id=\"java.lang.RuntimeException\" errorCode=\"java.lang.RuntimeException\"/>\n+  <bpmn2:process id=\"nested-abort.level3SC\" drools:packageName=\"com.bala.nested_abort\" drools:version=\"1.0\" drools:adHoc=\"false\" name=\"level3SC\" isExecutable=\"true\" processType=\"Public\">", "originalCommit": "6792e1ea4b8cdb2fd5c6b3a4f591ad75c8d5f341", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAzMTE5Mw==", "url": "https://github.com/kiegroup/jbpm/pull/1797#discussion_r522031193", "bodyText": "done", "author": "elguardian", "createdAt": "2020-11-12T11:20:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTk5NTc5OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTk5Nzk2Mg==", "url": "https://github.com/kiegroup/jbpm/pull/1797#discussion_r521997962", "bodyText": "There is no such exception class in our tests. Please change to something else", "author": "afalhambra", "createdAt": "2020-11-12T10:25:51Z", "path": "jbpm-test-coverage/src/test/resources/org/jbpm/test/functional/async/SubProcess.bpmn2", "diffHunk": "@@ -0,0 +1,222 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<bpmn2:definitions xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns=\"http://www.omg.org/bpmn20\" xmlns:bpmn2=\"http://www.omg.org/spec/BPMN/20100524/MODEL\" xmlns:bpmndi=\"http://www.omg.org/spec/BPMN/20100524/DI\" xmlns:bpsim=\"http://www.bpsim.org/schemas/1.0\" xmlns:dc=\"http://www.omg.org/spec/DD/20100524/DC\" xmlns:di=\"http://www.omg.org/spec/DD/20100524/DI\" xmlns:drools=\"http://www.jboss.org/drools\" id=\"_D5j9MBjUEeunWshXBgPhRw\" xsi:schemaLocation=\"http://www.omg.org/spec/BPMN/20100524/MODEL BPMN20.xsd http://www.jboss.org/drools drools.xsd http://www.bpsim.org/schemas/1.0 bpsim.xsd http://www.omg.org/spec/DD/20100524/DC DC.xsd http://www.omg.org/spec/DD/20100524/DI DI.xsd \" exporter=\"jBPM Process Modeler\" exporterVersion=\"2.0\" targetNamespace=\"http://www.omg.org/bpmn20\">\n+  <bpmn2:itemDefinition id=\"_errorItem\" structureRef=\"Object\"/>\n+  <bpmn2:itemDefinition id=\"__CFC4ADC6-C14B-4F65-8F11-B898C39216C9_errorObjectInputXItem\" structureRef=\"Object\"/>\n+  <bpmn2:itemDefinition id=\"__747BA832-B68E-4E52-A5C7-838E052F8D1F_eOutputXItem\" structureRef=\"Object\"/>\n+  <bpmn2:itemDefinition id=\"__9ABE6FBC-2131-4C38-9EBA-2FA551D7EB83_MethodInputXItem\" structureRef=\"String\"/>\n+  <bpmn2:itemDefinition id=\"__9ABE6FBC-2131-4C38-9EBA-2FA551D7EB83_UrlInputXItem\" structureRef=\"String\"/>\n+  <bpmn2:itemDefinition id=\"__9ABE6FBC-2131-4C38-9EBA-2FA551D7EB83_ConnectTimeoutInputXItem\" structureRef=\"String\"/>\n+  <bpmn2:itemDefinition id=\"__9ABE6FBC-2131-4C38-9EBA-2FA551D7EB83_ContentDataInputXItem\" structureRef=\"String\"/>\n+  <bpmn2:itemDefinition id=\"__9ABE6FBC-2131-4C38-9EBA-2FA551D7EB83_PasswordInputXItem\" structureRef=\"String\"/>\n+  <bpmn2:itemDefinition id=\"__9ABE6FBC-2131-4C38-9EBA-2FA551D7EB83_ReadTimeoutInputXItem\" structureRef=\"String\"/>\n+  <bpmn2:itemDefinition id=\"__9ABE6FBC-2131-4C38-9EBA-2FA551D7EB83_UsernameInputXItem\" structureRef=\"String\"/>\n+  <bpmn2:itemDefinition id=\"__9ABE6FBC-2131-4C38-9EBA-2FA551D7EB83_ResultOutputXItem\" structureRef=\"java.lang.Object\"/>\n+  <bpmn2:signal id=\"_32c760ea-a1dd-30e2-9bf0-63b9ce037d43\" name=\"MainProcessSignal\"/>\n+  <bpmn2:error id=\"com.test.cascade_abort.EMCRestAPIException\" errorCode=\"com.test.cascade_abort.EMCRestAPIException\"/>", "originalCommit": "6792e1ea4b8cdb2fd5c6b3a4f591ad75c8d5f341", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTk5ODkyOQ==", "url": "https://github.com/kiegroup/jbpm/pull/1797#discussion_r521998929", "bodyText": "Unused import - please remove\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            import org.junit.Assert;", "author": "afalhambra", "createdAt": "2020-11-12T10:27:22Z", "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/async/AsyncAdHocSubprocessTest.java", "diffHunk": "@@ -16,19 +16,30 @@\n \n package org.jbpm.test.functional.async;\n \n+import static java.util.Collections.emptyMap;\n+import static org.hamcrest.CoreMatchers.is;\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.jbpm.test.tools.TrackingListenerAssert.assertProcessStarted;\n+import static org.jbpm.test.tools.TrackingListenerAssert.assertTriggeredAndLeft;\n+\n+import java.util.concurrent.CountDownLatch;\n+\n import org.jbpm.executor.ExecutorServiceFactory;\n import org.jbpm.kie.services.impl.admin.commands.TriggerNodeCommand;\n import org.jbpm.test.JbpmTestCase;\n import org.jbpm.test.listener.TrackingProcessEventListener;\n import org.junit.After;\n+import org.junit.Assert;", "originalCommit": "6792e1ea4b8cdb2fd5c6b3a4f591ad75c8d5f341", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAyMzkzMA==", "url": "https://github.com/kiegroup/jbpm/pull/1797#discussion_r522023930", "bodyText": "done", "author": "elguardian", "createdAt": "2020-11-12T11:07:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTk5ODkyOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAwMDE3Ng==", "url": "https://github.com/kiegroup/jbpm/pull/1797#discussion_r522000176", "bodyText": "Isn't it too much? Actually child process 3, just directly throw a runtimeException so it should be pretty straight forward.", "author": "afalhambra", "createdAt": "2020-11-12T10:29:21Z", "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/async/AsyncAdHocSubprocessTest.java", "diffHunk": "@@ -91,6 +126,81 @@ public void testAdHocSubAsyncProcessAuto() throws Exception {\n         assertProcessInstanceAborted(id);\n     }\n \n+    @Test(timeout = 30000)", "originalCommit": "6792e1ea4b8cdb2fd5c6b3a4f591ad75c8d5f341", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAyNDA4Ng==", "url": "https://github.com/kiegroup/jbpm/pull/1797#discussion_r522024086", "bodyText": "it is the standard around", "author": "elguardian", "createdAt": "2020-11-12T11:08:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAwMDE3Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAwMTY1OQ==", "url": "https://github.com/kiegroup/jbpm/pull/1797#discussion_r522001659", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            if(\"nested-abort.level1P\".equals(event.getProcessInstance().getProcessId())) {\n          \n          \n            \n                            if(ERROR_MULTILEVEL_MAIN_PROCESS_ID.equals(event.getProcessInstance().getProcessId())) {", "author": "afalhambra", "createdAt": "2020-11-12T10:31:40Z", "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/async/AsyncAdHocSubprocessTest.java", "diffHunk": "@@ -91,6 +126,81 @@ public void testAdHocSubAsyncProcessAuto() throws Exception {\n         assertProcessInstanceAborted(id);\n     }\n \n+    @Test(timeout = 30000)\n+    public void testErrorMultilevelActivity() throws Exception {\n+\n+        \n+        \n+        KieSession ksession = createKSession(ERROR_MULTILEVEL_MAIN_PROCESS, ERROR_MULTILEVEL_CHILD_PROCESS, ERROR_MULTILEVEL_CHILD_CHILD_PROCESS, ERROR_MULTILEVEL_EXCEPTION_PROCESS);\n+        final CountDownLatch latch = new CountDownLatch(1);\n+        ksession.addEventListener(new DefaultProcessEventListener() {\n+            @Override\n+            public void afterProcessCompleted(ProcessCompletedEvent event) {\n+                if(\"nested-abort.level1P\".equals(event.getProcessInstance().getProcessId())) {", "originalCommit": "6792e1ea4b8cdb2fd5c6b3a4f591ad75c8d5f341", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAyNDQ4MA==", "url": "https://github.com/kiegroup/jbpm/pull/1797#discussion_r522024480", "bodyText": "done", "author": "elguardian", "createdAt": "2020-11-12T11:08:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAwMTY1OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAwNTc0Mw==", "url": "https://github.com/kiegroup/jbpm/pull/1797#discussion_r522005743", "bodyText": "It might be clearer\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    assertThat(getLogService().findProcessInstance(pi.getId()).getStatus(), is(3));\n          \n          \n            \n                    assertThat(getLogService().findProcessInstance(pi.getId()).getStatus(), is(ProcessInstance.STATE_ABORTED));", "author": "afalhambra", "createdAt": "2020-11-12T10:38:09Z", "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/async/AsyncAdHocSubprocessTest.java", "diffHunk": "@@ -91,6 +126,81 @@ public void testAdHocSubAsyncProcessAuto() throws Exception {\n         assertProcessInstanceAborted(id);\n     }\n \n+    @Test(timeout = 30000)\n+    public void testErrorMultilevelActivity() throws Exception {\n+\n+        \n+        \n+        KieSession ksession = createKSession(ERROR_MULTILEVEL_MAIN_PROCESS, ERROR_MULTILEVEL_CHILD_PROCESS, ERROR_MULTILEVEL_CHILD_CHILD_PROCESS, ERROR_MULTILEVEL_EXCEPTION_PROCESS);\n+        final CountDownLatch latch = new CountDownLatch(1);\n+        ksession.addEventListener(new DefaultProcessEventListener() {\n+            @Override\n+            public void afterProcessCompleted(ProcessCompletedEvent event) {\n+                if(\"nested-abort.level1P\".equals(event.getProcessInstance().getProcessId())) {\n+                    latch.countDown();\n+                }\n+            }\n+        });\n+        ksession.getWorkItemManager().registerWorkItemHandler(\"Rest\", new RestWorkItemHandler());\n+        ProcessInstance pi = ksession.startProcess(ERROR_MULTILEVEL_MAIN_PROCESS_ID);\n+        latch.await();\n+\n+        Thread.sleep(1000L);\n+        assertThat(getLogService().findProcessInstance(pi.getId()).getStatus(), is(3));", "originalCommit": "6792e1ea4b8cdb2fd5c6b3a4f591ad75c8d5f341", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAyNDgyNQ==", "url": "https://github.com/kiegroup/jbpm/pull/1797#discussion_r522024825", "bodyText": "ok", "author": "elguardian", "createdAt": "2020-11-12T11:09:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAwNTc0Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAwNjE0MA==", "url": "https://github.com/kiegroup/jbpm/pull/1797#discussion_r522006140", "bodyText": "is it not the same as previous assert?", "author": "afalhambra", "createdAt": "2020-11-12T10:38:51Z", "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/async/AsyncAdHocSubprocessTest.java", "diffHunk": "@@ -91,6 +126,81 @@ public void testAdHocSubAsyncProcessAuto() throws Exception {\n         assertProcessInstanceAborted(id);\n     }\n \n+    @Test(timeout = 30000)\n+    public void testErrorMultilevelActivity() throws Exception {\n+\n+        \n+        \n+        KieSession ksession = createKSession(ERROR_MULTILEVEL_MAIN_PROCESS, ERROR_MULTILEVEL_CHILD_PROCESS, ERROR_MULTILEVEL_CHILD_CHILD_PROCESS, ERROR_MULTILEVEL_EXCEPTION_PROCESS);\n+        final CountDownLatch latch = new CountDownLatch(1);\n+        ksession.addEventListener(new DefaultProcessEventListener() {\n+            @Override\n+            public void afterProcessCompleted(ProcessCompletedEvent event) {\n+                if(\"nested-abort.level1P\".equals(event.getProcessInstance().getProcessId())) {\n+                    latch.countDown();\n+                }\n+            }\n+        });\n+        ksession.getWorkItemManager().registerWorkItemHandler(\"Rest\", new RestWorkItemHandler());\n+        ProcessInstance pi = ksession.startProcess(ERROR_MULTILEVEL_MAIN_PROCESS_ID);\n+        latch.await();\n+\n+        Thread.sleep(1000L);\n+        assertThat(getLogService().findProcessInstance(pi.getId()).getStatus(), is(3));\n+        assertProcessInstanceAborted(pi.getId());", "originalCommit": "6792e1ea4b8cdb2fd5c6b3a4f591ad75c8d5f341", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAwNjY4OA==", "url": "https://github.com/kiegroup/jbpm/pull/1797#discussion_r522006688", "bodyText": "I think we should also check the status of subprocess 2 and 3, as they must be in an aborted state", "author": "afalhambra", "createdAt": "2020-11-12T10:39:43Z", "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/async/AsyncAdHocSubprocessTest.java", "diffHunk": "@@ -91,6 +126,81 @@ public void testAdHocSubAsyncProcessAuto() throws Exception {\n         assertProcessInstanceAborted(id);\n     }\n \n+    @Test(timeout = 30000)\n+    public void testErrorMultilevelActivity() throws Exception {\n+\n+        \n+        \n+        KieSession ksession = createKSession(ERROR_MULTILEVEL_MAIN_PROCESS, ERROR_MULTILEVEL_CHILD_PROCESS, ERROR_MULTILEVEL_CHILD_CHILD_PROCESS, ERROR_MULTILEVEL_EXCEPTION_PROCESS);\n+        final CountDownLatch latch = new CountDownLatch(1);\n+        ksession.addEventListener(new DefaultProcessEventListener() {\n+            @Override\n+            public void afterProcessCompleted(ProcessCompletedEvent event) {\n+                if(\"nested-abort.level1P\".equals(event.getProcessInstance().getProcessId())) {\n+                    latch.countDown();\n+                }\n+            }\n+        });\n+        ksession.getWorkItemManager().registerWorkItemHandler(\"Rest\", new RestWorkItemHandler());\n+        ProcessInstance pi = ksession.startProcess(ERROR_MULTILEVEL_MAIN_PROCESS_ID);\n+        latch.await();\n+\n+        Thread.sleep(1000L);\n+        assertThat(getLogService().findProcessInstance(pi.getId()).getStatus(), is(3));\n+        assertProcessInstanceAborted(pi.getId());\n+ ", "originalCommit": "6792e1ea4b8cdb2fd5c6b3a4f591ad75c8d5f341", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAwNjkzMg==", "url": "https://github.com/kiegroup/jbpm/pull/1797#discussion_r522006932", "bodyText": "Same as previous test", "author": "afalhambra", "createdAt": "2020-11-12T10:40:03Z", "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/async/AsyncAdHocSubprocessTest.java", "diffHunk": "@@ -91,6 +126,81 @@ public void testAdHocSubAsyncProcessAuto() throws Exception {\n         assertProcessInstanceAborted(id);\n     }\n \n+    @Test(timeout = 30000)\n+    public void testErrorMultilevelActivity() throws Exception {\n+\n+        \n+        \n+        KieSession ksession = createKSession(ERROR_MULTILEVEL_MAIN_PROCESS, ERROR_MULTILEVEL_CHILD_PROCESS, ERROR_MULTILEVEL_CHILD_CHILD_PROCESS, ERROR_MULTILEVEL_EXCEPTION_PROCESS);\n+        final CountDownLatch latch = new CountDownLatch(1);\n+        ksession.addEventListener(new DefaultProcessEventListener() {\n+            @Override\n+            public void afterProcessCompleted(ProcessCompletedEvent event) {\n+                if(\"nested-abort.level1P\".equals(event.getProcessInstance().getProcessId())) {\n+                    latch.countDown();\n+                }\n+            }\n+        });\n+        ksession.getWorkItemManager().registerWorkItemHandler(\"Rest\", new RestWorkItemHandler());\n+        ProcessInstance pi = ksession.startProcess(ERROR_MULTILEVEL_MAIN_PROCESS_ID);\n+        latch.await();\n+\n+        Thread.sleep(1000L);\n+        assertThat(getLogService().findProcessInstance(pi.getId()).getStatus(), is(3));\n+        assertProcessInstanceAborted(pi.getId());\n+ \n+    }\n+\n+    \n+\n+    @Test(timeout = 30000)", "originalCommit": "6792e1ea4b8cdb2fd5c6b3a4f591ad75c8d5f341", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAwNzQ2Mw==", "url": "https://github.com/kiegroup/jbpm/pull/1797#discussion_r522007463", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            if(\"cascade-abort.MainProcess\".equals(event.getProcessInstance().getProcessId())) {\n          \n          \n            \n                            if(if(ERROR_ASYNC_MAIN_EXCEPTION_PROCESS_ID.equals(event.getProcessInstance().getProcessId())) {.equals(event.getProcessInstance().getProcessId())) {", "author": "afalhambra", "createdAt": "2020-11-12T10:40:52Z", "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/async/AsyncAdHocSubprocessTest.java", "diffHunk": "@@ -91,6 +126,81 @@ public void testAdHocSubAsyncProcessAuto() throws Exception {\n         assertProcessInstanceAborted(id);\n     }\n \n+    @Test(timeout = 30000)\n+    public void testErrorMultilevelActivity() throws Exception {\n+\n+        \n+        \n+        KieSession ksession = createKSession(ERROR_MULTILEVEL_MAIN_PROCESS, ERROR_MULTILEVEL_CHILD_PROCESS, ERROR_MULTILEVEL_CHILD_CHILD_PROCESS, ERROR_MULTILEVEL_EXCEPTION_PROCESS);\n+        final CountDownLatch latch = new CountDownLatch(1);\n+        ksession.addEventListener(new DefaultProcessEventListener() {\n+            @Override\n+            public void afterProcessCompleted(ProcessCompletedEvent event) {\n+                if(\"nested-abort.level1P\".equals(event.getProcessInstance().getProcessId())) {\n+                    latch.countDown();\n+                }\n+            }\n+        });\n+        ksession.getWorkItemManager().registerWorkItemHandler(\"Rest\", new RestWorkItemHandler());\n+        ProcessInstance pi = ksession.startProcess(ERROR_MULTILEVEL_MAIN_PROCESS_ID);\n+        latch.await();\n+\n+        Thread.sleep(1000L);\n+        assertThat(getLogService().findProcessInstance(pi.getId()).getStatus(), is(3));\n+        assertProcessInstanceAborted(pi.getId());\n+ \n+    }\n+\n+    \n+\n+    @Test(timeout = 30000)\n+    public void testErrorAsyncActivity() throws Exception {\n+\n+        KieSession ksession = createKSession(ERROR_ASYNC_CHILD_EXCEPTION_PROCESS,  ERROR_ASYNC_MAIN_EXCEPTION_PROCESS);\n+        final CountDownLatch latch = new CountDownLatch(1);\n+        ksession.addEventListener(new DefaultProcessEventListener() {\n+            @Override\n+            public void afterProcessCompleted(ProcessCompletedEvent event) {\n+                if(\"cascade-abort.MainProcess\".equals(event.getProcessInstance().getProcessId())) {", "originalCommit": "6792e1ea4b8cdb2fd5c6b3a4f591ad75c8d5f341", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAzMTgyNw==", "url": "https://github.com/kiegroup/jbpm/pull/1797#discussion_r522031827", "bodyText": "done", "author": "elguardian", "createdAt": "2020-11-12T11:21:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAwNzQ2Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAwODIzNA==", "url": "https://github.com/kiegroup/jbpm/pull/1797#discussion_r522008234", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    assertThat(getLogService().findProcessInstance(pi.getId()).getStatus(), is(3));\n          \n          \n            \n                    assertThat(getLogService().findProcessInstance(pi.getId()).getStatus(), is(ProcessInstance.STATE_ABORTED));", "author": "afalhambra", "createdAt": "2020-11-12T10:42:03Z", "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/async/AsyncAdHocSubprocessTest.java", "diffHunk": "@@ -91,6 +126,81 @@ public void testAdHocSubAsyncProcessAuto() throws Exception {\n         assertProcessInstanceAborted(id);\n     }\n \n+    @Test(timeout = 30000)\n+    public void testErrorMultilevelActivity() throws Exception {\n+\n+        \n+        \n+        KieSession ksession = createKSession(ERROR_MULTILEVEL_MAIN_PROCESS, ERROR_MULTILEVEL_CHILD_PROCESS, ERROR_MULTILEVEL_CHILD_CHILD_PROCESS, ERROR_MULTILEVEL_EXCEPTION_PROCESS);\n+        final CountDownLatch latch = new CountDownLatch(1);\n+        ksession.addEventListener(new DefaultProcessEventListener() {\n+            @Override\n+            public void afterProcessCompleted(ProcessCompletedEvent event) {\n+                if(\"nested-abort.level1P\".equals(event.getProcessInstance().getProcessId())) {\n+                    latch.countDown();\n+                }\n+            }\n+        });\n+        ksession.getWorkItemManager().registerWorkItemHandler(\"Rest\", new RestWorkItemHandler());\n+        ProcessInstance pi = ksession.startProcess(ERROR_MULTILEVEL_MAIN_PROCESS_ID);\n+        latch.await();\n+\n+        Thread.sleep(1000L);\n+        assertThat(getLogService().findProcessInstance(pi.getId()).getStatus(), is(3));\n+        assertProcessInstanceAborted(pi.getId());\n+ \n+    }\n+\n+    \n+\n+    @Test(timeout = 30000)\n+    public void testErrorAsyncActivity() throws Exception {\n+\n+        KieSession ksession = createKSession(ERROR_ASYNC_CHILD_EXCEPTION_PROCESS,  ERROR_ASYNC_MAIN_EXCEPTION_PROCESS);\n+        final CountDownLatch latch = new CountDownLatch(1);\n+        ksession.addEventListener(new DefaultProcessEventListener() {\n+            @Override\n+            public void afterProcessCompleted(ProcessCompletedEvent event) {\n+                if(\"cascade-abort.MainProcess\".equals(event.getProcessInstance().getProcessId())) {\n+                    latch.countDown();\n+                }\n+            }\n+        });\n+        ksession.getWorkItemManager().registerWorkItemHandler(\"Rest\", new RestWorkItemHandler(true));\n+        ProcessInstance pi = ksession.startProcess(ERROR_ASYNC_MAIN_EXCEPTION_PROCESS_ID);\n+        latch.await();\n+\n+        Thread.sleep(1000L);\n+        assertThat(getLogService().findProcessInstance(pi.getId()).getStatus(), is(3));", "originalCommit": "6792e1ea4b8cdb2fd5c6b3a4f591ad75c8d5f341", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAyNTEwNQ==", "url": "https://github.com/kiegroup/jbpm/pull/1797#discussion_r522025105", "bodyText": "done", "author": "elguardian", "createdAt": "2020-11-12T11:09:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAwODIzNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAwODY2Nw==", "url": "https://github.com/kiegroup/jbpm/pull/1797#discussion_r522008667", "bodyText": "I think we should also check status of subprocess to verify it is also in an aborted status", "author": "afalhambra", "createdAt": "2020-11-12T10:42:42Z", "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/async/AsyncAdHocSubprocessTest.java", "diffHunk": "@@ -91,6 +126,81 @@ public void testAdHocSubAsyncProcessAuto() throws Exception {\n         assertProcessInstanceAborted(id);\n     }\n \n+    @Test(timeout = 30000)\n+    public void testErrorMultilevelActivity() throws Exception {\n+\n+        \n+        \n+        KieSession ksession = createKSession(ERROR_MULTILEVEL_MAIN_PROCESS, ERROR_MULTILEVEL_CHILD_PROCESS, ERROR_MULTILEVEL_CHILD_CHILD_PROCESS, ERROR_MULTILEVEL_EXCEPTION_PROCESS);\n+        final CountDownLatch latch = new CountDownLatch(1);\n+        ksession.addEventListener(new DefaultProcessEventListener() {\n+            @Override\n+            public void afterProcessCompleted(ProcessCompletedEvent event) {\n+                if(\"nested-abort.level1P\".equals(event.getProcessInstance().getProcessId())) {\n+                    latch.countDown();\n+                }\n+            }\n+        });\n+        ksession.getWorkItemManager().registerWorkItemHandler(\"Rest\", new RestWorkItemHandler());\n+        ProcessInstance pi = ksession.startProcess(ERROR_MULTILEVEL_MAIN_PROCESS_ID);\n+        latch.await();\n+\n+        Thread.sleep(1000L);\n+        assertThat(getLogService().findProcessInstance(pi.getId()).getStatus(), is(3));\n+        assertProcessInstanceAborted(pi.getId());\n+ \n+    }\n+\n+    \n+\n+    @Test(timeout = 30000)\n+    public void testErrorAsyncActivity() throws Exception {\n+\n+        KieSession ksession = createKSession(ERROR_ASYNC_CHILD_EXCEPTION_PROCESS,  ERROR_ASYNC_MAIN_EXCEPTION_PROCESS);\n+        final CountDownLatch latch = new CountDownLatch(1);\n+        ksession.addEventListener(new DefaultProcessEventListener() {\n+            @Override\n+            public void afterProcessCompleted(ProcessCompletedEvent event) {\n+                if(\"cascade-abort.MainProcess\".equals(event.getProcessInstance().getProcessId())) {\n+                    latch.countDown();\n+                }\n+            }\n+        });\n+        ksession.getWorkItemManager().registerWorkItemHandler(\"Rest\", new RestWorkItemHandler(true));\n+        ProcessInstance pi = ksession.startProcess(ERROR_ASYNC_MAIN_EXCEPTION_PROCESS_ID);\n+        latch.await();\n+\n+        Thread.sleep(1000L);\n+        assertThat(getLogService().findProcessInstance(pi.getId()).getStatus(), is(3));\n+        assertProcessInstanceAborted(pi.getId());", "originalCommit": "6792e1ea4b8cdb2fd5c6b3a4f591ad75c8d5f341", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAzMTkwMg==", "url": "https://github.com/kiegroup/jbpm/pull/1797#discussion_r522031902", "bodyText": "done", "author": "elguardian", "createdAt": "2020-11-12T11:21:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAwODY2Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAwOTU0NQ==", "url": "https://github.com/kiegroup/jbpm/pull/1797#discussion_r522009545", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \n          \n          \n            \n            // empty", "author": "afalhambra", "createdAt": "2020-11-12T10:44:05Z", "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/async/AsyncAdHocSubprocessTest.java", "diffHunk": "@@ -91,6 +126,81 @@ public void testAdHocSubAsyncProcessAuto() throws Exception {\n         assertProcessInstanceAborted(id);\n     }\n \n+    @Test(timeout = 30000)\n+    public void testErrorMultilevelActivity() throws Exception {\n+\n+        \n+        \n+        KieSession ksession = createKSession(ERROR_MULTILEVEL_MAIN_PROCESS, ERROR_MULTILEVEL_CHILD_PROCESS, ERROR_MULTILEVEL_CHILD_CHILD_PROCESS, ERROR_MULTILEVEL_EXCEPTION_PROCESS);\n+        final CountDownLatch latch = new CountDownLatch(1);\n+        ksession.addEventListener(new DefaultProcessEventListener() {\n+            @Override\n+            public void afterProcessCompleted(ProcessCompletedEvent event) {\n+                if(\"nested-abort.level1P\".equals(event.getProcessInstance().getProcessId())) {\n+                    latch.countDown();\n+                }\n+            }\n+        });\n+        ksession.getWorkItemManager().registerWorkItemHandler(\"Rest\", new RestWorkItemHandler());\n+        ProcessInstance pi = ksession.startProcess(ERROR_MULTILEVEL_MAIN_PROCESS_ID);\n+        latch.await();\n+\n+        Thread.sleep(1000L);\n+        assertThat(getLogService().findProcessInstance(pi.getId()).getStatus(), is(3));\n+        assertProcessInstanceAborted(pi.getId());\n+ \n+    }\n+\n+    \n+\n+    @Test(timeout = 30000)\n+    public void testErrorAsyncActivity() throws Exception {\n+\n+        KieSession ksession = createKSession(ERROR_ASYNC_CHILD_EXCEPTION_PROCESS,  ERROR_ASYNC_MAIN_EXCEPTION_PROCESS);\n+        final CountDownLatch latch = new CountDownLatch(1);\n+        ksession.addEventListener(new DefaultProcessEventListener() {\n+            @Override\n+            public void afterProcessCompleted(ProcessCompletedEvent event) {\n+                if(\"cascade-abort.MainProcess\".equals(event.getProcessInstance().getProcessId())) {\n+                    latch.countDown();\n+                }\n+            }\n+        });\n+        ksession.getWorkItemManager().registerWorkItemHandler(\"Rest\", new RestWorkItemHandler(true));\n+        ProcessInstance pi = ksession.startProcess(ERROR_ASYNC_MAIN_EXCEPTION_PROCESS_ID);\n+        latch.await();\n+\n+        Thread.sleep(1000L);\n+        assertThat(getLogService().findProcessInstance(pi.getId()).getStatus(), is(3));\n+        assertProcessInstanceAborted(pi.getId());\n+ \n+    }\n \n+    class RestWorkItemHandler implements WorkItemHandler {\n \n+        \n+        private boolean throwException;\n+\n+        public RestWorkItemHandler() {\n+            this(false);\n+        }\n+        \n+        public RestWorkItemHandler(boolean throwException) {\n+            this.throwException = throwException;\n+        }\n+        \n+        @Override\n+        public void executeWorkItem(WorkItem workItem, WorkItemManager manager) {\n+            if(throwException) {\n+                throw new RuntimeException();\n+            }\n+            manager.completeWorkItem(workItem.getId(), emptyMap());\n+        }\n+\n+        @Override\n+        public void abortWorkItem(WorkItem workItem, WorkItemManager manager) {\n+", "originalCommit": "6792e1ea4b8cdb2fd5c6b3a4f591ad75c8d5f341", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAyNTI3Ng==", "url": "https://github.com/kiegroup/jbpm/pull/1797#discussion_r522025276", "bodyText": "done", "author": "elguardian", "createdAt": "2020-11-12T11:10:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAwOTU0NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAwOTczNg==", "url": "https://github.com/kiegroup/jbpm/pull/1797#discussion_r522009736", "bodyText": "can be static\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                class RestWorkItemHandler implements WorkItemHandler {\n          \n          \n            \n                static class RestWorkItemHandler implements WorkItemHandler {", "author": "afalhambra", "createdAt": "2020-11-12T10:44:22Z", "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/async/AsyncAdHocSubprocessTest.java", "diffHunk": "@@ -91,6 +126,81 @@ public void testAdHocSubAsyncProcessAuto() throws Exception {\n         assertProcessInstanceAborted(id);\n     }\n \n+    @Test(timeout = 30000)\n+    public void testErrorMultilevelActivity() throws Exception {\n+\n+        \n+        \n+        KieSession ksession = createKSession(ERROR_MULTILEVEL_MAIN_PROCESS, ERROR_MULTILEVEL_CHILD_PROCESS, ERROR_MULTILEVEL_CHILD_CHILD_PROCESS, ERROR_MULTILEVEL_EXCEPTION_PROCESS);\n+        final CountDownLatch latch = new CountDownLatch(1);\n+        ksession.addEventListener(new DefaultProcessEventListener() {\n+            @Override\n+            public void afterProcessCompleted(ProcessCompletedEvent event) {\n+                if(\"nested-abort.level1P\".equals(event.getProcessInstance().getProcessId())) {\n+                    latch.countDown();\n+                }\n+            }\n+        });\n+        ksession.getWorkItemManager().registerWorkItemHandler(\"Rest\", new RestWorkItemHandler());\n+        ProcessInstance pi = ksession.startProcess(ERROR_MULTILEVEL_MAIN_PROCESS_ID);\n+        latch.await();\n+\n+        Thread.sleep(1000L);\n+        assertThat(getLogService().findProcessInstance(pi.getId()).getStatus(), is(3));\n+        assertProcessInstanceAborted(pi.getId());\n+ \n+    }\n+\n+    \n+\n+    @Test(timeout = 30000)\n+    public void testErrorAsyncActivity() throws Exception {\n+\n+        KieSession ksession = createKSession(ERROR_ASYNC_CHILD_EXCEPTION_PROCESS,  ERROR_ASYNC_MAIN_EXCEPTION_PROCESS);\n+        final CountDownLatch latch = new CountDownLatch(1);\n+        ksession.addEventListener(new DefaultProcessEventListener() {\n+            @Override\n+            public void afterProcessCompleted(ProcessCompletedEvent event) {\n+                if(\"cascade-abort.MainProcess\".equals(event.getProcessInstance().getProcessId())) {\n+                    latch.countDown();\n+                }\n+            }\n+        });\n+        ksession.getWorkItemManager().registerWorkItemHandler(\"Rest\", new RestWorkItemHandler(true));\n+        ProcessInstance pi = ksession.startProcess(ERROR_ASYNC_MAIN_EXCEPTION_PROCESS_ID);\n+        latch.await();\n+\n+        Thread.sleep(1000L);\n+        assertThat(getLogService().findProcessInstance(pi.getId()).getStatus(), is(3));\n+        assertProcessInstanceAborted(pi.getId());\n+ \n+    }\n \n+    class RestWorkItemHandler implements WorkItemHandler {", "originalCommit": "6792e1ea4b8cdb2fd5c6b3a4f591ad75c8d5f341", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAzMzE2MA==", "url": "https://github.com/kiegroup/jbpm/pull/1797#discussion_r522033160", "bodyText": "done", "author": "elguardian", "createdAt": "2020-11-12T11:23:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAwOTczNg=="}], "type": "inlineReview"}, {"oid": "cf058d34e1feab742d65c9c9fb5f2ea16ea4f93b", "url": "https://github.com/kiegroup/jbpm/commit/cf058d34e1feab742d65c9c9fb5f2ea16ea4f93b", "message": "[JBPM-9459] Nested process instances abort doesn't work when a task in event subprocess is marked with \"Is Async\" as true", "committedDate": "2020-11-12T11:26:50Z", "type": "commit"}, {"oid": "cf058d34e1feab742d65c9c9fb5f2ea16ea4f93b", "url": "https://github.com/kiegroup/jbpm/commit/cf058d34e1feab742d65c9c9fb5f2ea16ea4f93b", "message": "[JBPM-9459] Nested process instances abort doesn't work when a task in event subprocess is marked with \"Is Async\" as true", "committedDate": "2020-11-12T11:26:50Z", "type": "forcePushed"}]}