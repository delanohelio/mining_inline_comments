{"pr_number": 1803, "pr_title": "[JBPM-9466] Make configurable Kafka Producer max.block.ms", "pr_createdAt": "2020-11-12T19:19:11Z", "pr_url": "https://github.com/kiegroup/jbpm/pull/1803", "timeline": [{"oid": "a89a2b6595c01d321f782092d85c7bc1347c5706", "url": "https://github.com/kiegroup/jbpm/commit/a89a2b6595c01d321f782092d85c7bc1347c5706", "message": "[JBPM-9466] Make configurable Kafka Producer max.block.ms", "committedDate": "2020-11-13T09:43:46Z", "type": "commit"}, {"oid": "a89a2b6595c01d321f782092d85c7bc1347c5706", "url": "https://github.com/kiegroup/jbpm/commit/a89a2b6595c01d321f782092d85c7bc1347c5706", "message": "[JBPM-9466] Make configurable Kafka Producer max.block.ms", "committedDate": "2020-11-13T09:43:46Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTA3NTgzNA==", "url": "https://github.com/kiegroup/jbpm/pull/1803#discussion_r525075834", "bodyText": "maybe it's worth checking whether this.emitter is null as it might be already closed. wdyt?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    this.emitter.close();\n          \n          \n            \n                    emitter = null;\n          \n          \n            \n                    if (this.emitter != null) {\n          \n          \n            \n                        this.emitter.close();\n          \n          \n            \n                        emitter = null;\n          \n          \n            \n                    }", "author": "afalhambra", "createdAt": "2020-11-17T11:16:05Z", "path": "jbpm-persistence/jbpm-persistence-api/src/main/java/org/jbpm/persistence/api/integration/base/TransactionalPersistenceEventManager.java", "diffHunk": "@@ -153,5 +153,6 @@ public void close() {\n         }\n         \n         this.emitter.close();\n+        emitter = null;", "originalCommit": "a89a2b6595c01d321f782092d85c7bc1347c5706", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODc4MDUwMQ==", "url": "https://github.com/kiegroup/jbpm/pull/1803#discussion_r528780501", "bodyText": "It cannot be null at this point, because previously it was checked that isActive (i.e., not null)", "author": "gmunozfe", "createdAt": "2020-11-23T15:20:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTA3NTgzNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTA3NjY5Mw==", "url": "https://github.com/kiegroup/jbpm/pull/1803#discussion_r525076693", "bodyText": "Shouldn't we leave to the default ProducerConfig.MAX_BLOCK_MS_CONFIG value (60secs)? - wdyt?", "author": "afalhambra", "createdAt": "2020-11-17T11:17:35Z", "path": "jbpm-event-emitters/jbpm-event-emitters-kafka/src/main/java/org/jbpm/event/emitters/kafka/KafkaEventEmitter.java", "diffHunk": "@@ -154,6 +154,8 @@ public EventCollection newCollection() {\n         if (clientId != null) {\n             configs.put(ProducerConfig.CLIENT_ID_CONFIG, clientId);\n         }\n+        configs.put(ProducerConfig.MAX_BLOCK_MS_CONFIG, \n+                    System.getProperty(\"org.kie.jbpm.event.emitters.kafka.max.block.ms\", \"2000\"));", "originalCommit": "a89a2b6595c01d321f782092d85c7bc1347c5706", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTIyNTg1MQ==", "url": "https://github.com/kiegroup/jbpm/pull/1803#discussion_r525225851", "bodyText": "Problem is that default one is too long, thats the point of this JIRA ;)", "author": "fjtirado", "createdAt": "2020-11-17T15:04:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTA3NjY5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODc3NzUzMQ==", "url": "https://github.com/kiegroup/jbpm/pull/1803#discussion_r528777531", "bodyText": "Right, it keeps on waiting (by default 60 sec) if broker is down and cannot establish a socket connection. Value can be overridden by each customer by means of the system variable.", "author": "gmunozfe", "createdAt": "2020-11-23T15:16:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTA3NjY5Mw=="}], "type": "inlineReview"}]}