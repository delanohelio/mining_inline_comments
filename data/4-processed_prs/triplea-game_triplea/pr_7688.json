{"pr_number": 7688, "pr_title": "Convert general casualty removal", "pr_createdAt": "2020-09-17T13:56:45Z", "pr_url": "https://github.com/triplea-game/triplea/pull/7688", "timeline": [{"oid": "9f6f5500a8b8d36383469cee0e773e374955d47f", "url": "https://github.com/triplea-game/triplea/commit/9f6f5500a8b8d36383469cee0e773e374955d47f", "message": "Convert general casualty removal", "committedDate": "2020-09-17T13:56:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDYyMTc3Mw==", "url": "https://github.com/triplea-game/triplea/pull/7688#discussion_r490621773", "bodyText": "We're going to be inline this on next major vs outright removal, right?\nIf so, this might help us in the future to comment that so we don't think we can just delete it:\nRemoveOnNextMajorRelease(\"inline IExecutable body and remove IExecutable\")", "author": "DanVanAtta", "createdAt": "2020-09-17T23:46:19Z", "path": "game-core/src/main/java/games/strategy/triplea/delegate/battle/MustFightBattle.java", "diffHunk": "@@ -1587,16 +1588,19 @@ private void addCheckEndBattleAndRetreatingSteps(final List<IExecutable> steps)\n     final BattleStep defensiveSubsRetreat = new DefensiveSubsRetreat(this, this);\n     final BattleStep removeGeneralSuicide = new RemoveGeneralSuicide(this, this);\n     final BattleStep offensiveGeneralRetreat = new OffensiveGeneralRetreat(this, this);\n+    final BattleStep clearGeneralCasualties = new ClearGeneralCasualties(this, this);\n \n-    steps.add(\n-        new IExecutable() {\n-          private static final long serialVersionUID = 8611067962952500496L;\n+    steps.add(clearGeneralCasualties);\n+    new IExecutable() {\n+      private static final long serialVersionUID = 8611067962952500496L;\n \n-          @Override\n-          public void execute(final ExecutionStack stack, final IDelegateBridge bridge) {\n-            clearWaitingToDieAndDamagedChangesInto(bridge);\n-          }\n-        });\n+      @Override\n+      @RemoveOnNextMajorRelease", "originalCommit": "9f6f5500a8b8d36383469cee0e773e374955d47f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDY0NDExNA==", "url": "https://github.com/triplea-game/triplea/pull/7688#discussion_r490644114", "bodyText": "No, it should be removed in the next major version.  These IExecutables are completely replaced by the BattleStep classes that I'm building.", "author": "trevan", "createdAt": "2020-09-18T01:10:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDYyMTc3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDY0NjI3OA==", "url": "https://github.com/triplea-game/triplea/pull/7688#discussion_r490646278", "bodyText": "\ud83d\udc4d", "author": "DanVanAtta", "createdAt": "2020-09-18T01:19:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDYyMTc3Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDYyMjEzNg==", "url": "https://github.com/triplea-game/triplea/pull/7688#discussion_r490622136", "bodyText": "Any thoughts to rename 'clear' to 'remove'? They are mostly synonymous, IMO 'remove' is just slightly more descriptive.", "author": "DanVanAtta", "createdAt": "2020-09-17T23:47:38Z", "path": "game-core/src/main/java/games/strategy/triplea/delegate/battle/steps/BattleSteps.java", "diffHunk": "@@ -58,7 +59,10 @@\n         new ClearFirstStrikeCasualties(battleState, battleActions);\n     final BattleStep offensiveStandard = new OffensiveGeneral(battleState, battleActions);\n     final BattleStep defensiveStandard = new DefensiveGeneral(battleState, battleActions);\n-    final BattleStep generalRetreat = new OffensiveGeneralRetreat(battleState, battleActions);\n+    final BattleStep offensiveGeneralRetreat =\n+        new OffensiveGeneralRetreat(battleState, battleActions);\n+    final BattleStep clearGeneralCasualties =", "originalCommit": "9f6f5500a8b8d36383469cee0e773e374955d47f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDY0NTA5NQ==", "url": "https://github.com/triplea-game/triplea/pull/7688#discussion_r490645095", "bodyText": "Good idea except we already have ClearAaCasualties and ClearFirstStrikeCasualties which do the same thing for the other battle phases.  I'd like to keep their names similar.  And since they are stored in the save game, we would have to either just duplicate the class or do some sort of deserialization magic to handle the rename.", "author": "trevan", "createdAt": "2020-09-18T01:14:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDYyMjEzNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDY0NjM1Mw==", "url": "https://github.com/triplea-game/triplea/pull/7688#discussion_r490646353", "bodyText": "Fair enough \ud83d\udc4d", "author": "DanVanAtta", "createdAt": "2020-09-18T01:19:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDYyMjEzNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDYyMjQ1MA==", "url": "https://github.com/triplea-game/triplea/pull/7688#discussion_r490622450", "bodyText": "Why protected on these variables? Can we mark them as private?\n\nEffective Java Item 17: Design and document for inheritance or else prohibit it\nhttps://medium.com/@rufuszh90/effective-java-item-17-design-and-document-for-inheritance-or-else-prohibit-it-be6041719fbc", "author": "DanVanAtta", "createdAt": "2020-09-17T23:48:55Z", "path": "game-core/src/main/java/games/strategy/triplea/delegate/battle/steps/change/ClearGeneralCasualties.java", "diffHunk": "@@ -0,0 +1,35 @@\n+package games.strategy.triplea.delegate.battle.steps.change;\n+\n+import static games.strategy.triplea.delegate.battle.BattleStepStrings.REMOVE_CASUALTIES;\n+\n+import games.strategy.engine.delegate.IDelegateBridge;\n+import games.strategy.triplea.delegate.ExecutionStack;\n+import games.strategy.triplea.delegate.battle.BattleActions;\n+import games.strategy.triplea.delegate.battle.BattleState;\n+import games.strategy.triplea.delegate.battle.steps.BattleStep;\n+import java.util.List;\n+import lombok.AllArgsConstructor;\n+\n+@AllArgsConstructor\n+public class ClearGeneralCasualties implements BattleStep {\n+  private static final long serialVersionUID = 995118832242624142L;\n+\n+  protected final BattleState battleState;", "originalCommit": "9f6f5500a8b8d36383469cee0e773e374955d47f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "df059f3acc24e0aca0edb6a60f7c55fbaab7adb1", "url": "https://github.com/triplea-game/triplea/commit/df059f3acc24e0aca0edb6a60f7c55fbaab7adb1", "message": "Mark variables as private", "committedDate": "2020-09-18T01:15:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDY0NjkyOQ==", "url": "https://github.com/triplea-game/triplea/pull/7688#discussion_r490646929", "bodyText": "My first comment on this seems to have been lost in github : /\nI'm wondering/concerned if this class is too thin and a bit indirect. Can we move the logic of MustFightBattle here and have the other references in MustFightBattle and elsewhere call this class? Even if we move that logic here as a static method, at least it would have the one, isolated home and presumably could be independently tested. Of most significant though we'd be unburdening MustfightBattle that is already doing too much.", "author": "DanVanAtta", "createdAt": "2020-09-18T01:21:39Z", "path": "game-core/src/main/java/games/strategy/triplea/delegate/battle/steps/change/ClearGeneralCasualties.java", "diffHunk": "@@ -0,0 +1,35 @@\n+package games.strategy.triplea.delegate.battle.steps.change;\n+\n+import static games.strategy.triplea.delegate.battle.BattleStepStrings.REMOVE_CASUALTIES;\n+\n+import games.strategy.engine.delegate.IDelegateBridge;\n+import games.strategy.triplea.delegate.ExecutionStack;\n+import games.strategy.triplea.delegate.battle.BattleActions;\n+import games.strategy.triplea.delegate.battle.BattleState;\n+import games.strategy.triplea.delegate.battle.steps.BattleStep;\n+import java.util.List;\n+import lombok.AllArgsConstructor;\n+\n+@AllArgsConstructor\n+public class ClearGeneralCasualties implements BattleStep {\n+  private static final long serialVersionUID = 995118832242624142L;\n+\n+  private final BattleState battleState;\n+\n+  private final BattleActions battleActions;\n+\n+  @Override\n+  public List<String> getNames() {\n+    return List.of(REMOVE_CASUALTIES);\n+  }\n+\n+  @Override\n+  public Order getOrder() {\n+    return Order.GENERAL_REMOVE_CASUALTIES;\n+  }\n+\n+  @Override\n+  public void execute(final ExecutionStack stack, final IDelegateBridge bridge) {\n+    battleActions.clearWaitingToDieAndDamagedChangesInto(bridge);", "originalCommit": "df059f3acc24e0aca0edb6a60f7c55fbaab7adb1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDY0NzY5MA==", "url": "https://github.com/triplea-game/triplea/pull/7688#discussion_r490647690", "bodyText": "Yes, I plan to look into doing something like that now that most of the battle steps are converted.  You'll start seeing PR where I'm changing the BattleAction and BattleState apis and pull more of the code into the battlesteps or some sort of helper.", "author": "trevan", "createdAt": "2020-09-18T01:24:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDY0NjkyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDY2Mjk3OQ==", "url": "https://github.com/triplea-game/triplea/pull/7688#discussion_r490662979", "bodyText": "\ud83d\udc4d", "author": "DanVanAtta", "createdAt": "2020-09-18T02:22:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDY0NjkyOQ=="}], "type": "inlineReview"}]}