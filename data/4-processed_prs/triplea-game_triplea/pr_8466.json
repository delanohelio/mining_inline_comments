{"pr_number": 8466, "pr_title": "Headless logging conversion to logback", "pr_createdAt": "2020-12-20T19:24:54Z", "pr_url": "https://github.com/triplea-game/triplea/pull/8466", "timeline": [{"oid": "048db8b90f16149712f9d2b7b76dc90a1d3678f4", "url": "https://github.com/triplea-game/triplea/commit/048db8b90f16149712f9d2b7b76dc90a1d3678f4", "message": "Add headless logback.xml & convert 'chatHandler' to be a 'chatAppender'\n\nThis changes the headless server handling of logging java.util\nlogging to chat to instead be slf4j based and to send\nslf4j logging to chat. As part of this change we also configure\nheadless logging to have a logback.xml which configures logging.\n\nFunctionally this does change the output and there is no longer\na stack trace. This is generally okay, we have yet to receive\nany bug reports where the output message from a bot into\nchat was reported as a bug (generally these logging events\nare treated as informational and otherwise ignored by players).", "committedDate": "2020-12-20T19:23:26Z", "type": "commit"}, {"oid": "810a038210225c0d29e12ed6790d2cd742ebb613", "url": "https://github.com/triplea-game/triplea/commit/810a038210225c0d29e12ed6790d2cd742ebb613", "message": "Rename ChatHandler -> ChatAppender", "committedDate": "2020-12-20T19:24:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjQxODIwNA==", "url": "https://github.com/triplea-game/triplea/pull/8466#discussion_r546418204", "bodyText": "@trevan FWIW, this test written by Ssoloff I think is something of a good test class. Just wanted to refer you to this example.", "author": "DanVanAtta", "createdAt": "2020-12-20T19:26:15Z", "path": "game-headless/src/test/java/org/triplea/game/server/debug/ChatHandlerTest.java", "diffHunk": "@@ -1,91 +0,0 @@\n-package org.triplea.game.server.debug;\n-\n-import static org.mockito.AdditionalMatchers.not;\n-import static org.mockito.ArgumentMatchers.anyString;\n-import static org.mockito.ArgumentMatchers.endsWith;\n-import static org.mockito.Mockito.doAnswer;\n-import static org.mockito.Mockito.never;\n-import static org.mockito.Mockito.times;\n-import static org.mockito.Mockito.verify;\n-\n-import java.util.function.Consumer;\n-import java.util.logging.Level;\n-import java.util.logging.LogRecord;\n-import org.junit.jupiter.api.Nested;\n-import org.junit.jupiter.api.Test;\n-import org.junit.jupiter.api.extension.ExtendWith;\n-import org.mockito.Mock;\n-import org.mockito.junit.jupiter.MockitoExtension;\n-\n-final class ChatHandlerTest {\n-  @ExtendWith(MockitoExtension.class)\n-  @Nested\n-  final class PublishTest {\n-    private final ChatHandler chatHandler = new ChatHandler();\n-    @Mock private Consumer<String> sendChatMessage;\n-\n-    private LogRecord newLoggableLogRecord() {\n-      return new LogRecord(Level.WARNING, \"message\");\n-    }\n-\n-    private LogRecord newLoggableLogRecordWithMultipleLines() {\n-      return new LogRecord(Level.WARNING, \"message\\nmessage2\\n\");\n-    }\n-\n-    private LogRecord newUnloggableLogRecord() {\n-      return new LogRecord(Level.FINEST, \"message\");\n-    }\n-\n-    private void publish(final LogRecord record) {\n-      synchronized (chatHandler) {\n-        chatHandler.publish(record, sendChatMessage);\n-      }\n-    }\n-\n-    @Test\n-    void shouldSendChatMessageWhenRecordIsLoggable() {", "originalCommit": "810a038210225c0d29e12ed6790d2cd742ebb613", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "14d3c825760c14ea3df6e672abe737982943d418", "url": "https://github.com/triplea-game/triplea/commit/14d3c825760c14ea3df6e672abe737982943d418", "message": "Simplify Appender and remove thread safety guards\n\nJ.U.L handlers are not thread safe, logback 'AppenderBase' is\nthread safe.", "committedDate": "2020-12-20T19:35:31Z", "type": "commit"}, {"oid": "3264db18f9e6e38ea5ace8c389e9bc79ce9f7901", "url": "https://github.com/triplea-game/triplea/commit/3264db18f9e6e38ea5ace8c389e9bc79ce9f7901", "message": "Merge remote-tracking branch 'origin/master' into headless-logging", "committedDate": "2020-12-21T03:37:31Z", "type": "commit"}]}