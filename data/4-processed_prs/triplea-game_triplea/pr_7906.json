{"pr_number": 7906, "pr_title": "Update Node-BB Dockerfile. Add README.md, and example config.json", "pr_createdAt": "2020-10-15T04:35:16Z", "pr_url": "https://github.com/triplea-game/triplea/pull/7906", "timeline": [{"oid": "fb07edeae5b56eebc373b38a94029019b99226df", "url": "https://github.com/triplea-game/triplea/commit/fb07edeae5b56eebc373b38a94029019b99226df", "message": "NodeBB Dockerfile, README.md, and example config.json", "committedDate": "2020-10-15T04:23:34Z", "type": "commit"}, {"oid": "ebeb222b8a2818767f05a1879889afbe189e6b84", "url": "https://github.com/triplea-game/triplea/commit/ebeb222b8a2818767f05a1879889afbe189e6b84", "message": "Adding more info to the configuration section.", "committedDate": "2020-10-16T04:38:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjk4NzgwOA==", "url": "https://github.com/triplea-game/triplea/pull/7906#discussion_r506987808", "bodyText": "Which DB did you use @bacrossland ? Any thoughts to check in a docker file or a docker-compose for the DB piece too?", "author": "DanVanAtta", "createdAt": "2020-10-17T21:51:45Z", "path": "node-bb/README.md", "diffHunk": "@@ -0,0 +1,131 @@\n+# TripleA Forums\n+\n+The software that powers the TripleA Forums is [NodeBB](https://github.com/NodeBB/NodeBB). \n+This document is instructions on how to build and run the Docker container of the forums using an \n+[official Docker container of NodeBB](https://hub.docker.com/r/nodebb/docker) as the base image.\n+\n+### Building\n+\n+1. Make a directory on your machine for where the config file and upload folder will live. ```mkdir -p /opt/triple-forums```\n+1. Make a directory for uploaded files. Inside the upload directory, create folders category, emoji, files, profile, \n+sounds, and system.\n+    ```\n+    mkdir -p /opt/triple-forums/uploads/category\n+    mkdir -p /opt/triple-forums/uploads/emoji\n+    mkdir -p /opt/triple-forums/uploads/files\n+    mkdir -p /opt/triple-forums/uploads/profile\n+    mkdir -p /opt/triple-forums/uploads/sounds\n+    mkdir -p /opt/triple-forums/uploads/system\n+    ```\n+1. Build the Docker image using the command ```docker build -t triplea-forums:latest .```\n+\n+### Running\n+\n+**First time run**\n+\n+You will need a running database. The database can be either Redis, Mongo, or Postgres. Make sure you have one of these", "originalCommit": "ebeb222b8a2818767f05a1879889afbe189e6b84", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzIxOTgwNA==", "url": "https://github.com/triplea-game/triplea/pull/7906#discussion_r507219804", "bodyText": "I just ran a docker container for Redis on my system. Nothing custom. I'll update the readme to put in instructions for running all three types of databases with a volume mount for keeping the data permanent.", "author": "bacrossland", "createdAt": "2020-10-18T22:01:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjk4NzgwOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzIzMTE5Nw==", "url": "https://github.com/triplea-game/triplea/pull/7906#discussion_r507231197", "bodyText": "IMO you can stick to mongo, we run that in production. The docker should simulate prod as much as possible so we can tes it as best as possible locally before deploying.", "author": "DanVanAtta", "createdAt": "2020-10-18T22:39:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjk4NzgwOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTkxNzkyNw==", "url": "https://github.com/triplea-game/triplea/pull/7906#discussion_r509917927", "bodyText": "I updated the README.md and the config.json to be Mongo focussed only.", "author": "bacrossland", "createdAt": "2020-10-22T06:49:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjk4NzgwOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjk4ODAyMQ==", "url": "https://github.com/triplea-game/triplea/pull/7906#discussion_r506988021", "bodyText": "Can we mount the folder where the 'config.json' would land so that it is then stored on the file system? Is the config.json unique to the host machine that runs it? If we can't do a folder mount, I wonder if we can do a pre-fab config.json that is already ready to go.", "author": "DanVanAtta", "createdAt": "2020-10-17T21:54:58Z", "path": "node-bb/README.md", "diffHunk": "@@ -0,0 +1,131 @@\n+# TripleA Forums\n+\n+The software that powers the TripleA Forums is [NodeBB](https://github.com/NodeBB/NodeBB). \n+This document is instructions on how to build and run the Docker container of the forums using an \n+[official Docker container of NodeBB](https://hub.docker.com/r/nodebb/docker) as the base image.\n+\n+### Building\n+\n+1. Make a directory on your machine for where the config file and upload folder will live. ```mkdir -p /opt/triple-forums```\n+1. Make a directory for uploaded files. Inside the upload directory, create folders category, emoji, files, profile, \n+sounds, and system.\n+    ```\n+    mkdir -p /opt/triple-forums/uploads/category\n+    mkdir -p /opt/triple-forums/uploads/emoji\n+    mkdir -p /opt/triple-forums/uploads/files\n+    mkdir -p /opt/triple-forums/uploads/profile\n+    mkdir -p /opt/triple-forums/uploads/sounds\n+    mkdir -p /opt/triple-forums/uploads/system\n+    ```\n+1. Build the Docker image using the command ```docker build -t triplea-forums:latest .```\n+\n+### Running\n+\n+**First time run**\n+\n+You will need a running database. The database can be either Redis, Mongo, or Postgres. Make sure you have one of these\n+installed on your machine or a Docker container running. \n+\n+1. Run the triplea-forums:latest image using the command \n+```docker run -d --rm --name triplea-forums -v /opt/triple-forums/uploads:/usr/src/app/public/uploads -p 8080:4567 triplea-forums:latest```\n+1. Navigate to http://0.0.0.0:8080/. This will be the install and configuration screen for NodeBB.\n+1. Fill out the details on the page.\n+1. Once the configuration is complete, you will need to save the config.json file off the container to the folder you ", "originalCommit": "ebeb222b8a2818767f05a1879889afbe189e6b84", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzIyMTU2OQ==", "url": "https://github.com/triplea-game/triplea/pull/7906#discussion_r507221569", "bodyText": "Unfortunately you can't mount the folder since it is the root of the application install. That would require you to duplicate the entire install on your host in that folder in order for the container to run, which defeats the need for Docker.\nThe config.json is not unique. You can use it across multiple hosts and docker instances. The real issue is the database that NodeBB uses from the config.json file. NodeBB uses that setup process to initialize the database with tables and the first admin user. The good thing is that you only have to run that setup once. After the database is setup, you are free to do whatever.", "author": "bacrossland", "createdAt": "2020-10-18T22:09:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjk4ODAyMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzIzMTg0NQ==", "url": "https://github.com/triplea-game/triplea/pull/7906#discussion_r507231845", "bodyText": "Cool, we'll have ansible deploy the container, we can also use ansible to run any setup commands as well, same for local (future steps). Ideally we can get this all to be as 'one-touch' as possible.", "author": "DanVanAtta", "createdAt": "2020-10-18T22:40:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjk4ODAyMQ=="}], "type": "inlineReview"}, {"oid": "29a10251afd3e57b1cd361dbb0279ed753bd45ad", "url": "https://github.com/triplea-game/triplea/commit/29a10251afd3e57b1cd361dbb0279ed753bd45ad", "message": "Updated README.md and config.json for running Mongo", "committedDate": "2020-10-22T06:47:31Z", "type": "commit"}, {"oid": "c3ec4e87746b8d905c7e6762349621530e063599", "url": "https://github.com/triplea-game/triplea/commit/c3ec4e87746b8d905c7e6762349621530e063599", "message": "Fixed linting", "committedDate": "2020-10-22T07:09:48Z", "type": "commit"}, {"oid": "7cb23259c5653beade4d7f39e1d19c24ddebc41b", "url": "https://github.com/triplea-game/triplea/commit/7cb23259c5653beade4d7f39e1d19c24ddebc41b", "message": "Fixed more linting", "committedDate": "2020-10-22T07:22:59Z", "type": "commit"}, {"oid": "f64605b2d077c41d456980350dd9145880826540", "url": "https://github.com/triplea-game/triplea/commit/f64605b2d077c41d456980350dd9145880826540", "message": "Fixed even more linting", "committedDate": "2020-10-22T07:34:47Z", "type": "commit"}, {"oid": "edcc0fbbac2135af82db67ccebe2d0c6282ee9ac", "url": "https://github.com/triplea-game/triplea/commit/edcc0fbbac2135af82db67ccebe2d0c6282ee9ac", "message": "Fixed more more linting", "committedDate": "2020-10-22T07:46:28Z", "type": "commit"}, {"oid": "077d7fddada32f21822bfca437dc650d7209324b", "url": "https://github.com/triplea-game/triplea/commit/077d7fddada32f21822bfca437dc650d7209324b", "message": "Fixed linting x3", "committedDate": "2020-10-22T07:54:58Z", "type": "commit"}, {"oid": "6ba5f8c37235d95c12d0011c4c14899b98cc5404", "url": "https://github.com/triplea-game/triplea/commit/6ba5f8c37235d95c12d0011c4c14899b98cc5404", "message": "Fixed linting x4", "committedDate": "2020-10-22T12:37:33Z", "type": "commit"}, {"oid": "ff523b7fd6764213b6a55e7f8676ea71daca70e6", "url": "https://github.com/triplea-game/triplea/commit/ff523b7fd6764213b6a55e7f8676ea71daca70e6", "message": "Fixed linting x5", "committedDate": "2020-10-22T12:59:29Z", "type": "commit"}]}