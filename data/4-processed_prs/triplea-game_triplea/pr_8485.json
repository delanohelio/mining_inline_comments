{"pr_number": 8485, "pr_title": "Add the player types to the headless Injections", "pr_createdAt": "2020-12-22T00:21:35Z", "pr_url": "https://github.com/triplea-game/triplea/pull/8485", "timeline": [{"oid": "bba5ba4681c707e88a6219e1a0f0843075a8e83b", "url": "https://github.com/triplea-game/triplea/commit/bba5ba4681c707e88a6219e1a0f0843075a8e83b", "message": "Add the player types to the headless Injections", "committedDate": "2020-12-22T00:18:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzA3MDQ2Mw==", "url": "https://github.com/triplea-game/triplea/pull/8485#discussion_r547070463", "bodyText": "Bots are not able to use AI players, does this make sense to have?", "author": "DanVanAtta", "createdAt": "2020-12-22T05:07:11Z", "path": "game-headless/src/main/java/org/triplea/game/server/HeadlessGameRunner.java", "diffHunk": "@@ -17,6 +26,20 @@ public static void main(final String[] args) {\n   }\n \n   private static Injections constructInjections() {\n-    return Injections.builder().engineVersion(new ProductVersionReader().getVersion()).build();\n+    return Injections.builder()\n+        .engineVersion(new ProductVersionReader().getVersion())\n+        .playerTypes(gatherPlayerTypes())\n+        .build();\n+  }\n+\n+  private static Collection<PlayerTypes.Type> gatherPlayerTypes() {\n+    return Stream.of(\n+            PlayerTypes.getBuiltInPlayerTypes(),\n+            List.of(new PlayerTypes.AiType(new DoesNothingAiProvider())),", "originalCommit": "bba5ba4681c707e88a6219e1a0f0843075a8e83b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzA3NDEwMg==", "url": "https://github.com/triplea-game/triplea/pull/8485#discussion_r547074102", "bodyText": "I don't know.  The DoesNothingAi existed in the Headless game before this change so I'm not adding anything new.  I could remove it but I'm not sure how to test to ensure that it isn't actually used.  I do know that PlayerSelectorRow#setDefaultPlayerType requires the DoesNothingAi.  Is that method ever called in the Headless code paths?", "author": "trevan", "createdAt": "2020-12-22T05:22:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzA3MDQ2Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODM4MjU1MQ==", "url": "https://github.com/triplea-game/triplea/pull/8485#discussion_r548382551", "bodyText": "Let's see if this is really needed before merging.", "author": "DanVanAtta", "createdAt": "2020-12-24T04:58:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzA3MDQ2Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODM4Mjc2NQ==", "url": "https://github.com/triplea-game/triplea/pull/8485#discussion_r548382765", "bodyText": "Second question, do bots really need a selection of player types? Isn't this to support the launch screen? If this is needed, are bots broken currently without this?", "author": "DanVanAtta", "createdAt": "2020-12-24T04:59:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzA3MDQ2Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODY0MjE1Mw==", "url": "https://github.com/triplea-game/triplea/pull/8485#discussion_r548642153", "bodyText": "Bots are currently broken as I mentioned in the testing section.\nI removed the does nothing ai line and started a bot.  It looks like it isn't complaining.  I can actually start a game now.", "author": "trevan", "createdAt": "2020-12-24T17:30:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzA3MDQ2Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODM4MjM3Mg==", "url": "https://github.com/triplea-game/triplea/pull/8485#discussion_r548382372", "bodyText": "I'm quite sure we're not going to deploy custom AIs to bots, for a number of reasons:\n\nnone exist yet\nwe keep bots uniform, if something is going to be baked into the deployment it is effectively part of the code\nwe're fully responsible for bots running, any drop-in AIs are going to be us managing and debugging, at which point it really may as well be part of the main code base (a distributed code base is inherently more complex)\nAIs don't run on bots.", "author": "DanVanAtta", "createdAt": "2020-12-24T04:57:49Z", "path": "game-headless/src/main/java/org/triplea/game/server/HeadlessGameRunner.java", "diffHunk": "@@ -17,6 +26,20 @@ public static void main(final String[] args) {\n   }\n \n   private static Injections constructInjections() {\n-    return Injections.builder().engineVersion(new ProductVersionReader().getVersion()).build();\n+    return Injections.builder()\n+        .engineVersion(new ProductVersionReader().getVersion())\n+        .playerTypes(gatherPlayerTypes())\n+        .build();\n+  }\n+\n+  private static Collection<PlayerTypes.Type> gatherPlayerTypes() {\n+    return Stream.of(\n+            PlayerTypes.getBuiltInPlayerTypes(),\n+            List.of(new PlayerTypes.AiType(new DoesNothingAiProvider())),\n+            StreamSupport.stream(ServiceLoader.load(AiProvider.class).spliterator(), false)", "originalCommit": "bba5ba4681c707e88a6219e1a0f0843075a8e83b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODYzMjY4Ng==", "url": "https://github.com/triplea-game/triplea/pull/8485#discussion_r548632686", "bodyText": "I've removed the service provider code.", "author": "trevan", "createdAt": "2020-12-24T17:16:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODM4MjM3Mg=="}], "type": "inlineReview"}, {"oid": "6e3e339140a3c6ac24df08ab3b96e6267830c457", "url": "https://github.com/triplea-game/triplea/commit/6e3e339140a3c6ac24df08ab3b96e6267830c457", "message": "Remove unneeded service discovery for headless runner", "committedDate": "2020-12-24T17:15:43Z", "type": "commit"}, {"oid": "9123e42576df98510bb828c75aa4a31373a2970e", "url": "https://github.com/triplea-game/triplea/commit/9123e42576df98510bb828c75aa4a31373a2970e", "message": "Merge remote-tracking branch 'upstream/master' into fix-bot-ai-player-type", "committedDate": "2020-12-24T17:18:36Z", "type": "commit"}, {"oid": "cbfb56f0846a488d7b7901480bf52e3de4bd17c8", "url": "https://github.com/triplea-game/triplea/commit/cbfb56f0846a488d7b7901480bf52e3de4bd17c8", "message": "Remove doesnothing ai from headless bot", "committedDate": "2020-12-24T17:29:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODcyNzE1NQ==", "url": "https://github.com/triplea-game/triplea/pull/8485#discussion_r548727155", "bodyText": "nit, looks like it would be more concise and consistent (with   .engineVersion(new ProductVersionReader().getVersion())) to inline this method", "author": "DanVanAtta", "createdAt": "2020-12-24T19:36:27Z", "path": "game-headless/src/main/java/org/triplea/game/server/HeadlessGameRunner.java", "diffHunk": "@@ -17,6 +19,13 @@ public static void main(final String[] args) {\n   }\n \n   private static Injections constructInjections() {\n-    return Injections.builder().engineVersion(new ProductVersionReader().getVersion()).build();\n+    return Injections.builder()\n+        .engineVersion(new ProductVersionReader().getVersion())\n+        .playerTypes(gatherPlayerTypes())\n+        .build();\n+  }\n+\n+  private static Collection<PlayerTypes.Type> gatherPlayerTypes() {\n+    return PlayerTypes.getBuiltInPlayerTypes();", "originalCommit": "cbfb56f0846a488d7b7901480bf52e3de4bd17c8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODczMDAxOA==", "url": "https://github.com/triplea-game/triplea/pull/8485#discussion_r548730018", "bodyText": "@DanVanAtta , I just made that change.", "author": "trevan", "createdAt": "2020-12-24T19:41:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODcyNzE1NQ=="}], "type": "inlineReview"}, {"oid": "86c5b988dbe16d6dd164b436f572cd2c4cac5c01", "url": "https://github.com/triplea-game/triplea/commit/86c5b988dbe16d6dd164b436f572cd2c4cac5c01", "message": "Inline gatherPlayerTypes", "committedDate": "2020-12-24T19:39:53Z", "type": "commit"}]}