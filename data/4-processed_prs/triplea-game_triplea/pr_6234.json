{"pr_number": 6234, "pr_title": "Clean up keybindings code and remap done shortcut to \"ctrl+enter\"", "pr_createdAt": "2020-04-13T19:04:47Z", "pr_url": "https://github.com/triplea-game/triplea/pull/6234", "timeline": [{"oid": "aee55d94797a86ce193a026c98b1ecb99adf358c", "url": "https://github.com/triplea-game/triplea/commit/aee55d94797a86ce193a026c98b1ecb99adf358c", "message": "Clean up keybindings code and remap done shortcut to \"ctrl+enter\"\n\nRefactoring:\n- Moves keybindings utilities methods from SwingComponents to SwingKeyBindings\n- Helps combine keybinding helpers, they had become scattered and duplicative\n- Creates a single enum for 'ButtonDownModifier' (eg: shift, control)\n- Expands enumerated items in 'KeyCode'\n- Consistently uses addKeyBindings method across all usages, should help\n  in tracking down and finding keybindings.\n\nFeature updadting:\n- Changes 'shift+d' hotkey that was bound to the 'done' button to be 'ctrl+enter'", "committedDate": "2020-04-13T19:01:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzczNTgyNg==", "url": "https://github.com/triplea-game/triplea/pull/6234#discussion_r407735826", "bodyText": "What do you think about making KeyCombination and KeyCode implement the same interface?\nThis way you woldn't need to convert one to the other and were able to nest things in theory", "author": "RoiEXLab", "createdAt": "2020-04-13T21:36:10Z", "path": "swing-lib/src/main/java/org/triplea/swing/key/binding/SwingKeyBinding.java", "diffHunk": "@@ -0,0 +1,108 @@\n+package org.triplea.swing.key.binding;\n+\n+import java.awt.KeyboardFocusManager;\n+import java.util.UUID;\n+import java.util.concurrent.atomic.AtomicBoolean;\n+import javax.swing.JComponent;\n+import javax.swing.JDialog;\n+import javax.swing.JFrame;\n+import javax.swing.text.JTextComponent;\n+import lombok.experimental.UtilityClass;\n+import org.triplea.swing.SwingAction;\n+\n+/**\n+ * Supports adding key bindings. Reference:\n+ * https://docs.oracle.com/javase/tutorial/uiswing/misc/keybinding.html\n+ *\n+ * <p>Key bindings added through this class will \"always\" be active regardless if the component is\n+ * currently focused or not. Single key key bindings will not be active when focus is inside of a\n+ * text component. This is to avoid, for example, a user typing a chat message and unintentionally\n+ * firing key bindings.\n+ */\n+@UtilityClass\n+public class SwingKeyBinding {\n+  public static void addKeyBinding(\n+      final JDialog frame, final KeyCombination keyCombination, final Runnable action) {\n+    addKeyMapping(frame.getRootPane(), keyCombination, action);\n+  }\n+\n+  public static void addKeyBinding(\n+      final JFrame frame, final KeyCombination keyCombination, final Runnable action) {\n+    addKeyMapping(frame.getRootPane(), keyCombination, action);\n+  }\n+\n+  public static void addKeyBinding(\n+      final JDialog frame, final KeyCode keyCode, final Runnable action) {\n+    addKeyMapping(frame.getRootPane(), keyCode, action);\n+  }\n+\n+  public static void addKeyBinding(\n+      final JFrame frame, final KeyCode keyCode, final Runnable action) {\n+    addKeyMapping(frame.getRootPane(), keyCode, action);\n+  }\n+\n+  public static void addKeyBinding(\n+      final JComponent component, final KeyCode keyCode, final Runnable action) {\n+    addKeyMapping(component, keyCode, action);\n+  }\n+\n+  /**\n+   * Adds two keybindings to a given key, both active when \"ctrl\" and \"meta\" are held down.\n+   *\n+   * @param key The key to be bind in combination with \"ctrl\" being held down, or \"meta\" being held\n+   *     down.\n+   * @param action The action to execute when the keybinding is activated.\n+   */\n+  public static void addKeyListenerWithMetaAndCtrlMasks(\n+      final JFrame component, final KeyCode key, final Runnable action) {\n+\n+    addKeyMapping(\n+        (JComponent) component.getContentPane(),\n+        KeyCombination.of(key, ButtonDownMask.CTRL),\n+        action);\n+    addKeyMapping(\n+        (JComponent) component.getContentPane(),\n+        KeyCombination.of(key, ButtonDownMask.META),\n+        action);\n+  }\n+\n+  private static void addKeyMapping(\n+      final JComponent component, final KeyCode keyCode, final Runnable action) {\n+    addKeyMapping(component, KeyCombination.of(keyCode, ButtonDownMask.NONE), action);", "originalCommit": "aee55d94797a86ce193a026c98b1ecb99adf358c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzgwNjcwMA==", "url": "https://github.com/triplea-game/triplea/pull/6234#discussion_r407806700", "bodyText": "Not a  bad thought given the common method. It does not help that much though as we need to convert KeyCode into KeyCombination.", "author": "DanVanAtta", "createdAt": "2020-04-14T01:08:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzczNTgyNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzgxMDAwOA==", "url": "https://github.com/triplea-game/triplea/pull/6234#discussion_r407810008", "bodyText": "Going along those lines, KeyCode actually does not need the toKeyStroke at all and can be removed.", "author": "DanVanAtta", "createdAt": "2020-04-14T01:20:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzczNTgyNg=="}], "type": "inlineReview"}, {"oid": "e7ac0a8c0aef7634b799eb9352d4d11fd46cb76a", "url": "https://github.com/triplea-game/triplea/commit/e7ac0a8c0aef7634b799eb9352d4d11fd46cb76a", "message": "Correct boolean condition to disable keybindings on 'shift' modifier keybindings", "committedDate": "2020-04-14T01:06:41Z", "type": "commit"}, {"oid": "5192c396337662f9e613e6090a53f450ee1737d1", "url": "https://github.com/triplea-game/triplea/commit/5192c396337662f9e613e6090a53f450ee1737d1", "message": "Remove \"toKeyStroke\" from KeyCode", "committedDate": "2020-04-14T01:12:29Z", "type": "commit"}, {"oid": "4a6793874653be1f25af10586a5dfe91c981b331", "url": "https://github.com/triplea-game/triplea/commit/4a6793874653be1f25af10586a5dfe91c981b331", "message": "Move testing of KeyCode to KeyCombination", "committedDate": "2020-04-14T01:12:30Z", "type": "commit"}, {"oid": "1556ea99cf490e282773b2169e84d818f6b087c8", "url": "https://github.com/triplea-game/triplea/commit/1556ea99cf490e282773b2169e84d818f6b087c8", "message": "Update test to verify all permutations of key code and button down mask.", "committedDate": "2020-04-14T01:19:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzk1Mjc0Ng==", "url": "https://github.com/triplea-game/triplea/pull/6234#discussion_r407952746", "bodyText": "I was just about to complain that this might not always work, but then I reliazed that using this abstraction that only allows a single key to be down this is completely fine", "author": "RoiEXLab", "createdAt": "2020-04-14T08:21:02Z", "path": "swing-lib/src/main/java/org/triplea/swing/key/binding/SwingKeyBinding.java", "diffHunk": "@@ -0,0 +1,108 @@\n+package org.triplea.swing.key.binding;\n+\n+import java.awt.KeyboardFocusManager;\n+import java.util.UUID;\n+import java.util.concurrent.atomic.AtomicBoolean;\n+import javax.swing.JComponent;\n+import javax.swing.JDialog;\n+import javax.swing.JFrame;\n+import javax.swing.text.JTextComponent;\n+import lombok.experimental.UtilityClass;\n+import org.triplea.swing.SwingAction;\n+\n+/**\n+ * Supports adding key bindings. Reference:\n+ * https://docs.oracle.com/javase/tutorial/uiswing/misc/keybinding.html\n+ *\n+ * <p>Key bindings added through this class will \"always\" be active regardless if the component is\n+ * currently focused or not. Single key key bindings will not be active when focus is inside of a\n+ * text component. This is to avoid, for example, a user typing a chat message and unintentionally\n+ * firing key bindings.\n+ */\n+@UtilityClass\n+public class SwingKeyBinding {\n+  public static void addKeyBinding(\n+      final JDialog frame, final KeyCombination keyCombination, final Runnable action) {\n+    addKeyMapping(frame.getRootPane(), keyCombination, action);\n+  }\n+\n+  public static void addKeyBinding(\n+      final JFrame frame, final KeyCombination keyCombination, final Runnable action) {\n+    addKeyMapping(frame.getRootPane(), keyCombination, action);\n+  }\n+\n+  public static void addKeyBinding(\n+      final JDialog frame, final KeyCode keyCode, final Runnable action) {\n+    addKeyMapping(frame.getRootPane(), keyCode, action);\n+  }\n+\n+  public static void addKeyBinding(\n+      final JFrame frame, final KeyCode keyCode, final Runnable action) {\n+    addKeyMapping(frame.getRootPane(), keyCode, action);\n+  }\n+\n+  public static void addKeyBinding(\n+      final JComponent component, final KeyCode keyCode, final Runnable action) {\n+    addKeyMapping(component, keyCode, action);\n+  }\n+\n+  /**\n+   * Adds two keybindings to a given key, both active when \"ctrl\" and \"meta\" are held down.\n+   *\n+   * @param key The key to be bind in combination with \"ctrl\" being held down, or \"meta\" being held\n+   *     down.\n+   * @param action The action to execute when the keybinding is activated.\n+   */\n+  public static void addKeyListenerWithMetaAndCtrlMasks(\n+      final JFrame component, final KeyCode key, final Runnable action) {\n+\n+    addKeyMapping(\n+        (JComponent) component.getContentPane(),\n+        KeyCombination.of(key, ButtonDownMask.CTRL),\n+        action);\n+    addKeyMapping(\n+        (JComponent) component.getContentPane(),\n+        KeyCombination.of(key, ButtonDownMask.META),\n+        action);\n+  }\n+\n+  private static void addKeyMapping(\n+      final JComponent component, final KeyCode keyCode, final Runnable action) {\n+    addKeyMapping(component, KeyCombination.of(keyCode, ButtonDownMask.NONE), action);\n+  }\n+\n+  private static void addKeyMapping(\n+      final JComponent component, final KeyCombination keyCombination, final Runnable action) {\n+    final String keyBindingIdentifier = UUID.randomUUID().toString();\n+\n+    final AtomicBoolean enabled = new AtomicBoolean(true);\n+\n+    if (keyCombination.getButtonDownMask() == ButtonDownMask.NONE\n+        || keyCombination.getButtonDownMask() == ButtonDownMask.SHIFT) {", "originalCommit": "1556ea99cf490e282773b2169e84d818f6b087c8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}