{"pr_number": 7264, "pr_title": "Maps db", "pr_createdAt": "2020-07-27T04:40:01Z", "pr_url": "https://github.com/triplea-game/triplea/pull/7264", "timeline": [{"oid": "c84710061bd30ff30468ef2900458af654d31f4e", "url": "https://github.com/triplea-game/triplea/commit/c84710061bd30ff30468ef2900458af654d31f4e", "message": "Add a build.gradle file to run flyway migrations for maps database", "committedDate": "2020-07-27T03:35:10Z", "type": "commit"}, {"oid": "6c87d8a92bd368a1d092d817cf0efccef6c7f1e8", "url": "https://github.com/triplea-game/triplea/commit/6c87d8a92bd368a1d092d817cf0efccef6c7f1e8", "message": "Add maps-db as a subproject", "committedDate": "2020-07-27T03:47:23Z", "type": "commit"}, {"oid": "2edf0f367c2816265ab82b19bf58557aa80ae779", "url": "https://github.com/triplea-game/triplea/commit/2edf0f367c2816265ab82b19bf58557aa80ae779", "message": "add a run-flyway script", "committedDate": "2020-07-27T03:47:23Z", "type": "commit"}, {"oid": "dd4422f39fd0451b3b0cf3bece43cf7db8707bd2", "url": "https://github.com/triplea-game/triplea/commit/dd4422f39fd0451b3b0cf3bece43cf7db8707bd2", "message": "Add an initial migrations file to add a comment on the maps_db", "committedDate": "2020-07-27T03:47:23Z", "type": "commit"}, {"oid": "6402e49b8e281239194a6bdb1c6f9ec4e64fcca6", "url": "https://github.com/triplea-game/triplea/commit/6402e49b8e281239194a6bdb1c6f9ec4e64fcca6", "message": "Add docker to run maps DB on port 5433", "committedDate": "2020-07-27T03:47:54Z", "type": "commit"}, {"oid": "0d26584e27f17238b87dc579865c780e6085016e", "url": "https://github.com/triplea-game/triplea/commit/0d26584e27f17238b87dc579865c780e6085016e", "message": "Add a helper script 'connect_to_db' to connect to the new maps_db (docker container)", "committedDate": "2020-07-27T03:49:04Z", "type": "commit"}, {"oid": "80cdaff167dd62ce3c9d14fdd4c0e1d8d895e17c", "url": "https://github.com/triplea-game/triplea/commit/80cdaff167dd62ce3c9d14fdd4c0e1d8d895e17c", "message": "Add utility script 'drop_db' to drop maps_db data and recreate the database", "committedDate": "2020-07-27T03:51:51Z", "type": "commit"}, {"oid": "5cb20795ac413185146f65da1204a3981e201beb", "url": "https://github.com/triplea-game/triplea/commit/5cb20795ac413185146f65da1204a3981e201beb", "message": "Infrastructure: add maps_db schema", "committedDate": "2020-07-27T04:00:30Z", "type": "commit"}, {"oid": "97c36ed781d984745e3dc054eb7365a5e4224c61", "url": "https://github.com/triplea-game/triplea/commit/97c36ed781d984745e3dc054eb7365a5e4224c61", "message": "Infrastructure: update flyway to run multiple migrations, parameterized by database", "committedDate": "2020-07-27T04:29:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDY0MzA0OA==", "url": "https://github.com/triplea-game/triplea/pull/7264#discussion_r460643048", "bodyText": "Note, small simplification where this if statement was removed. If the target file DNE then we'll proceed to run gradle. Before we checked as well if the gradle output existed to skip the gradle run, instead now we'll just run gradle anyways.", "author": "DanVanAtta", "createdAt": "2020-07-27T04:41:13Z", "path": "infrastructure/run_ansible_vagrant", "diffHunk": "@@ -46,16 +46,15 @@ function buildJars() {\n \n function buildMigrations() {\n   local targetFolder=./ansible/roles/database/flyway/files/\n-  local zipFile=migrations.zip\n-  if [ ! -e $targetFolder/$zipFile ]; then\n-    if [ ! -e ../lobby-db/build/distributions/$zipFile ]; then", "originalCommit": "97c36ed781d984745e3dc054eb7365a5e4224c61", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDY0MzE2NQ==", "url": "https://github.com/triplea-game/triplea/pull/7264#discussion_r460643165", "bodyText": "Declare and assign separately to avoid masking return values.", "author": "codeclimate", "createdAt": "2020-07-27T04:41:44Z", "path": "maps-db/run_docker", "diffHunk": "@@ -0,0 +1,29 @@\n+#!/bin/bash\n+\n+# Launches a local docker container that will have a PSQL DB on it.\n+# Note, it takes a few seconds for database to initialize after running\n+# this script. Once initializated then 'run_flyway' can be run to install\n+# schema and tables.\n+\n+function stop_container() {\n+  echo \"Stopping docker...\"\n+  local runningContainerId=$(docker container ls | grep triplea-lobby-db | cut -f 1 -d ' ')", "originalCommit": "97c36ed781d984745e3dc054eb7365a5e4224c61", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "041ce4099cdc3fcf699a4f3fefd5031c29ef8f33", "url": "https://github.com/triplea-game/triplea/commit/041ce4099cdc3fcf699a4f3fefd5031c29ef8f33", "message": "Update maps-db build to parameterize the DB port number", "committedDate": "2020-07-27T05:41:31Z", "type": "commit"}, {"oid": "562e56bcc54732e3eb8f9c3a6396cc21a28c3bf8", "url": "https://github.com/triplea-game/triplea/commit/562e56bcc54732e3eb8f9c3a6396cc21a28c3bf8", "message": "Update travis build to create maps_db database", "committedDate": "2020-07-27T05:41:50Z", "type": "commit"}, {"oid": "20bf51e74e2426c758a5dd91c6e358e00ca9ea58", "url": "https://github.com/triplea-game/triplea/commit/20bf51e74e2426c758a5dd91c6e358e00ca9ea58", "message": "Formatting", "committedDate": "2020-07-27T05:47:54Z", "type": "commit"}, {"oid": "33039f604e7d148896a6821d8a3dab5515045b1f", "url": "https://github.com/triplea-game/triplea/commit/33039f604e7d148896a6821d8a3dab5515045b1f", "message": "Fix shellscript (shellcheck) declare and then assign value to avoid masking return value", "committedDate": "2020-07-27T05:51:27Z", "type": "commit"}]}