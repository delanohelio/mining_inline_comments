{"pr_number": 5899, "pr_title": "Clean Up and Restructure Travis Build Scripts", "pr_createdAt": "2020-02-03T05:22:20Z", "pr_url": "https://github.com/triplea-game/triplea/pull/5899", "timeline": [{"oid": "1353b9b121d93ad4275f855b2c40749f1c192437", "url": "https://github.com/triplea-game/triplea/commit/1353b9b121d93ad4275f855b2c40749f1c192437", "message": "Clean Up and Restructure Travis Build Scripts\n\n- **Re-structure Build Scripts**\n  - Goal was to make it so .travis.yml contained very little to any logic at all for build commands.\n    Second, by grouping build jobs together, the script structure and scope of which scripts were\n    used for what is hopefully now more clear.\n  - The new script configuration places build scripts into their own folders following this\n    convention: '.travis/stages/<stage-name>/<job-name>/run'. Any additional support scripts\n    used by a given job will be in the 'job' folder. For most part, any .travis.yml build job\n    will just call a 'run' a script and nothing more\n  - Scripts that are shared between multiple jobs are now located in '.travis/shared/'\n\n- **Break up Build Jobs**\n  - Results in a slightly faster build as we get better parallelism, and the slowest build is now\n    slightly faster as it has fewer tasks to perform.\n  - Error output is more focused, looking at which build job failed we can get a pretty good idea\n    of what went wrong without looking at the logs\n  - We get more feedback. Rather than knowing that just tests failed, we can see which parts of the\n    build passed and which pieces failed. For example, if there is just a checkstyle violation,\n    then we'll see just one failure for checkstyle and everything else would pass.\n\n- **Clean up .travis.yml**\n  - Build logic extracted to a 'run' script\n  - Lists and maps written with a single line syntax where possible and clean.\n  - Common operations, like \"install: false\", and \"cache: ..\" are extracted to a top level\n    where they become common for all jobs.\n\n- **Remove java-11.0.5 install**\n  - 11.0.2 is currently doing the job. We added the 11.0.5 install to mitigate a TLS versioning\n    issue where connections to JCenter were being rejected due to our version of TLS being too low.\n    Background info: https://github.com/triplea-game/triplea/issues/5480\n    It appears the problem is currently mitigated or patched on the Travis side as 11.0.2 is working.\n    We can restore the 11.0.5 install pretty readily if the need arises again, in the meantime it's\n    not necessary (and adds unwanted complexity).\n\n- **Move error reporting to a top-level task (out of build scripts) and be consistent**\n  - With all build jobs extracted to folders and invoked on a single line in .travis.yml,\n    we can more cleanly execute a build job fail handler by adding \"|| $REPORT_FAIL\" to\n    the end of each run script. This means if any script fails, we'll call the report-fail handler\n    to consistently have an issue be created whenever we see a build failure.\n    Note: we filter PR builds by checking to see if needed env variables that are only available\n    to a master branch build are present, if they are not, the 'report-fail' script is a no-op.\n\n- **Move Succuss Detection to a final Stage**\n  - We no longer require a specific script to detect if the build passed and report success. Instead\n    there is now a third and final build stage that will report a success and close any 'Build failed'\n    issues that may be open. This is in part to make it so that each build script in .travis/ can be\n    more focused on just one task.\n\n- **Updates to Prod Deployment - Just Install SSH Keys and Security updates**\n  - Implicitly, decided prod deployments will be done 'by-hand'\n  - Prod will be updated on every build, but it'll only have SSH keys deployed and security patches\n    applied, no binaries or configuration will be changed.", "committedDate": "2020-02-03T05:13:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTQwMjYyNQ==", "url": "https://github.com/triplea-game/triplea/pull/5899#discussion_r375402625", "bodyText": "Hmm, I think this mix of the yaml 1.1 syntax and the newer 1.2 syntax is a little bot weird here and there.\nThis line in particular doesn't add to readability IMO, but personal preference I guess", "author": "RoiEXLab", "createdAt": "2020-02-05T17:34:09Z", "path": ".travis.yml", "diffHunk": "@@ -1,188 +1,109 @@\n+if: tag is blank\n dist: xenial\n sudo: false\n language: java\n-if: tag is blank\n-\n-# Note: Travis generally does not allocate more than 5 VMs at once.\n-# Avoid running more than 5 jobs in parallel. Try to keep the jobs\n-# balanced so that they each take about the same amount of time.\n-\n-# Note: We download Java 11.0.5 for a few reasons:\n-# - jcenter no longer allows https TLS1.0 connection (this is seen as\n-#   a gradle failed to download plugin error)\n-# - Travis has Java 11.0.2 baked in to it, 11.0.2 does not have a\n-#   recent patch (2019-10) to allow Java 11 to use a compatible version\n-#   of TLS.\n-# To overcome this situation, we emulate the travis 'install-jdk' script\n-# and install a latest Java 11. For reference:\n-#   https://sormuras.github.io/blog/2017-12-08-install-jdk-on-travis.html\n-# Java12 does not have this issue, we do not download the Java11 script\n-# for that JVM or else we would be overriding Java12 with Java11.  \n-#\n-# Additional note: The export commands seem to not apply when extracted\n-# to a script and seemingly only work when located in the main travis config\n-# here.\n-#\n+jdk: openjdk11\n+cache: { directories: [ \"$HOME/.gradle\" , \".gradle\" ] }\n+install: skip\n \n+env:\n+  global:\n+   - REPORT_FAIL=\".travis/shared/report-build-status FAILURE\"\n+   - VERIFY_STAGE=\".travis/stages/verify\"\n+   - DEPLOY_STAGE=\".travis/stages/deploy\"\n jobs:\n   include:\n-    - stage: verify\n-      env: \"Static Verification\"\n-      jdk: openjdk11\n-      cache:\n-        directories:\n-          - '$HOME/.gradle'\n-          - '.gradle'\n-          - '~/jdk-11.0.5+10'\n-      before_install:\n-        - ./.travis/install_java_11.0.5\n-        - export JAVA_HOME=~/jdk-11.0.5+10\n-        - export PATH=${JAVA_HOME}/bin:$PATH\n-        - java --version\n-      install: skip\n-      script:\n-        ## shellcheck all shell scripts\n-        - find .travis/ -type f | xargs grep -lE \"^#\\!/bin/bash$\" | xargs shellcheck\n-        - .travis/check-links || travis_terminate 1;\n-        - .travis/find-unused-dbunit-datasets || travis_terminate 1\n-        - .travis/find-unmatched-test-packages || travis_terminate 1;\n-        - .travis/find-orphaned-tests || travis_terminate 1;\n-        - .travis/check-custom-style || travis_terminate 1;\n-        - ./gradlew --parallel validateYamls spotlessCheck checkstyleMain checkstyleTest pmdMain pmdTest\n-    - stage: verify\n-      env: \"Unit & Integration Tests\"\n-      jdk: openjdk11\n-      cache:\n-        directories:\n-          - '$HOME/.gradle'\n-          - '.gradle'\n-          - '~/jdk-11.0.5+10'\n-      addons: {postgresql: \"10\"}\n-      before_install:\n-        - ./.travis/install_java_11.0.5\n-        - export JAVA_HOME=~/jdk-11.0.5+10\n-        - export PATH=${JAVA_HOME}/bin:$PATH\n-        - java --version\n-      install: skip\n-      script:\n-        - .travis/setup_database\n-        - .travis/launch-http-server || travis_terminate 1\n-        - ./gradlew --parallel test integTest jacocoTestReport || travis_terminate 1\n-        - bash <(curl -s https://codecov.io/bash)  # upload coverage report - https://github.com/codecov/example-gradle\n-    - stage: verify\n-      env: \"Smoke Test\"\n-      jdk: openjdk11\n-      cache:\n-        directories:\n-          - '$HOME/.gradle'\n-          - '.gradle'\n-          - '~/jdk-11.0.5+10'\n+    \n+    ########################################################################\n+    # Jobs are ordered tests first and then slower jobs before faster ones.\n+  \n+    - stage: Verify\n+      name: \"Tests: Integration Test\"\n+      addons: { postgresql: \"10\" }\n+      script: [ $VERIFY_STAGE/integration-testing/run || $REPORT_FAIL ]\n+\n+    - stage: Verify\n+      name: \"Tests: Unit Test\"\n+      script: [ $VERIFY_STAGE/unit-testing/run || $REPORT_FAIL ]\n+    \n+    - stage: Verify\n+      name: \"Tests: Smoke Test\"\n       addons: {postgresql: \"10\"}\n-      before_install:\n-        - ./.travis/install_java_11.0.5\n-        - export JAVA_HOME=~/jdk-11.0.5+10\n-        - export PATH=${JAVA_HOME}/bin:$PATH\n-        - java --version\n-      install: skip\n-      script:\n-        - ./.travis/setup_database\n-        - ./.travis/run_smoke_tests\n-    - stage: deploy artifacts\n-      env: \"Upload to Github Releases\"\n+      script: [ $VERIFY_STAGE/smoke-testing/run || $REPORT_FAIL ]\n+\n+    - stage: Verify\n+      name: \"Analysis: PMD Verification\"\n+      script: [ $VERIFY_STAGE/pmd-verification/run || $REPORT_FAIL ]\n+    \n+    - stage: Verify\n+      name: \"Analysis: Checkstyle\"\n+      script: [ $VERIFY_STAGE/checkstyle/run || $REPORT_FAIL ]\n+    \n+    - stage: Verify\n+      name: \"Analysis: Java Formatting\"\n+      script: [ $VERIFY_STAGE/java-formatting/run || $REPORT_FAIL ]\n+    \n+    - stage: Verify\n+      name: \"Analysis: Check Links and YAML Syntax\"\n+      script: [ $VERIFY_STAGE/check-links-and-yaml-syntax/run || $REPORT_FAIL ]\n+      \n+    - stage: Verify\n+      name: \"Analysis: Code Convention Checks\"\n+      script: [ $VERIFY_STAGE/code-convention-checks/run || $REPORT_FAIL ]\n+\n+    - stage: Verify\n+      name: \"Analysis: Find Unused or Unmatched Tests\"\n+      script: [ $VERIFY_STAGE/find-unused-or-unmatched-tests/run || $REPORT_FAIL ]\n+\n+    ########################################################################\n+\n+    - stage: Deploy\n+      name: \"Push Map Descriptions to Website\"\n+      if: (branch = master) and (repo = 'triplea-game/triplea') and (type != 'pull_request')\n+      addons: { apt: { packages: [ python3, python3-yaml ] } }\n+      script: [ $DEPLOY_STAGE/update-maps-on-website/run || $REPORT_FAIL ]     \n+\n+    - stage: Deploy\n+      name: \"Ansible Deploy to Prerelease\"\n+      if: (branch = master) and (repo = 'triplea-game/triplea') and (type != 'pull_request')\n+      language: python\n+      python: \"3.6\"\n+      addons: { apt: { packages: [ sshpass ] } }\n+      install: [ pip install ansible ]\n+      script: [ $DEPLOY_STAGE/ansible-deploy-to-prerelease/run || $REPORT_FAIL ]\n+\n+    - stage: Deploy\n+      name: \"Build Installer Downloads & Upload to Github Releases\"\n       if: (branch = master) and (repo = 'triplea-game/triplea') and (type != 'pull_request')\n-      install: skip\n-      cache:\n-        directories:\n-          - '$HOME/.gradle'\n-          - '.gradle'\n-          - '~/jdk-11.0.5+10'\n-      before_install:\n-        - ./.travis/install_java_11.0.5\n-        - export JAVA_HOME=~/jdk-11.0.5+10\n-        - export PATH=${JAVA_HOME}/bin:$PATH\n-        - java --version\n-      script:\n-        - ./.travis/setup_gpg\n-        ## Update product version to include build number.\n-        ## EG: replace \"2.0.0\" to be \"2.0.15555\";\n-        - sed -i \"s/.0 *$/.$TRAVIS_BUILD_NUMBER/\" game-core/src/main/resources/META-INF/triplea/product.properties\n-        - ./.travis/do_release\n+      script: [ $DEPLOY_STAGE/installers/run || $REPORT_FAIL ]\n       deploy:\n+        on: { tags: false, repo: triplea-game/triplea, branch: master }", "originalCommit": "1353b9b121d93ad4275f855b2c40749f1c192437", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTU5Nzc4Nw==", "url": "https://github.com/triplea-game/triplea/pull/5899#discussion_r375597787", "bodyText": "Are you looking at this only from a web-browser, from a terminal, or from IDE?\nIn general, I found the shorter, the better for most of this, the multi-line elements lengthened the config file and stood out as most things are single line now.\nHow do you mean by mixing of the 1.1 vs 1.2 syntax, as far as I knew, the inline map syntax has always been equivalent.", "author": "DanVanAtta", "createdAt": "2020-02-06T01:22:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTQwMjYyNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTY4MzQ2OA==", "url": "https://github.com/triplea-game/triplea/pull/5899#discussion_r375683468", "bodyText": "Only the Web browser.\nI get what you were trying to achieve, but I think in this particular case (also because there are not too many deployment blocks) it doesn't really add to readability.\nBut I could live with either way, just wanted to point it out.", "author": "RoiEXLab", "createdAt": "2020-02-06T07:55:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTQwMjYyNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjE5ODk1OQ==", "url": "https://github.com/triplea-game/triplea/pull/5899#discussion_r376198959", "bodyText": "Here is a contrast:\n\n\nThe multi-line leads to the most indentation and makes nearby indentation much more important. The values specified are somewhat noisy, but also makes the file quite a bit longer. One issue IMO we developed with the travis file is it became very long, too much to really understand easily.", "author": "DanVanAtta", "createdAt": "2020-02-07T03:27:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTQwMjYyNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTQwNDI5MQ==", "url": "https://github.com/triplea-game/triplea/pull/5899#discussion_r375404291", "bodyText": "For all of the script parts: I'm pretty sure that travis doesn't care if a list or a single entry is given. After all the default value for this key should be ./gradlew check IIRC", "author": "RoiEXLab", "createdAt": "2020-02-05T17:37:26Z", "path": ".travis.yml", "diffHunk": "@@ -1,188 +1,109 @@\n+if: tag is blank\n dist: xenial\n sudo: false\n language: java\n-if: tag is blank\n-\n-# Note: Travis generally does not allocate more than 5 VMs at once.\n-# Avoid running more than 5 jobs in parallel. Try to keep the jobs\n-# balanced so that they each take about the same amount of time.\n-\n-# Note: We download Java 11.0.5 for a few reasons:\n-# - jcenter no longer allows https TLS1.0 connection (this is seen as\n-#   a gradle failed to download plugin error)\n-# - Travis has Java 11.0.2 baked in to it, 11.0.2 does not have a\n-#   recent patch (2019-10) to allow Java 11 to use a compatible version\n-#   of TLS.\n-# To overcome this situation, we emulate the travis 'install-jdk' script\n-# and install a latest Java 11. For reference:\n-#   https://sormuras.github.io/blog/2017-12-08-install-jdk-on-travis.html\n-# Java12 does not have this issue, we do not download the Java11 script\n-# for that JVM or else we would be overriding Java12 with Java11.  \n-#\n-# Additional note: The export commands seem to not apply when extracted\n-# to a script and seemingly only work when located in the main travis config\n-# here.\n-#\n+jdk: openjdk11\n+cache: { directories: [ \"$HOME/.gradle\" , \".gradle\" ] }\n+install: skip\n \n+env:\n+  global:\n+   - REPORT_FAIL=\".travis/shared/report-build-status FAILURE\"\n+   - VERIFY_STAGE=\".travis/stages/verify\"\n+   - DEPLOY_STAGE=\".travis/stages/deploy\"\n jobs:\n   include:\n-    - stage: verify\n-      env: \"Static Verification\"\n-      jdk: openjdk11\n-      cache:\n-        directories:\n-          - '$HOME/.gradle'\n-          - '.gradle'\n-          - '~/jdk-11.0.5+10'\n-      before_install:\n-        - ./.travis/install_java_11.0.5\n-        - export JAVA_HOME=~/jdk-11.0.5+10\n-        - export PATH=${JAVA_HOME}/bin:$PATH\n-        - java --version\n-      install: skip\n-      script:\n-        ## shellcheck all shell scripts\n-        - find .travis/ -type f | xargs grep -lE \"^#\\!/bin/bash$\" | xargs shellcheck\n-        - .travis/check-links || travis_terminate 1;\n-        - .travis/find-unused-dbunit-datasets || travis_terminate 1\n-        - .travis/find-unmatched-test-packages || travis_terminate 1;\n-        - .travis/find-orphaned-tests || travis_terminate 1;\n-        - .travis/check-custom-style || travis_terminate 1;\n-        - ./gradlew --parallel validateYamls spotlessCheck checkstyleMain checkstyleTest pmdMain pmdTest\n-    - stage: verify\n-      env: \"Unit & Integration Tests\"\n-      jdk: openjdk11\n-      cache:\n-        directories:\n-          - '$HOME/.gradle'\n-          - '.gradle'\n-          - '~/jdk-11.0.5+10'\n-      addons: {postgresql: \"10\"}\n-      before_install:\n-        - ./.travis/install_java_11.0.5\n-        - export JAVA_HOME=~/jdk-11.0.5+10\n-        - export PATH=${JAVA_HOME}/bin:$PATH\n-        - java --version\n-      install: skip\n-      script:\n-        - .travis/setup_database\n-        - .travis/launch-http-server || travis_terminate 1\n-        - ./gradlew --parallel test integTest jacocoTestReport || travis_terminate 1\n-        - bash <(curl -s https://codecov.io/bash)  # upload coverage report - https://github.com/codecov/example-gradle\n-    - stage: verify\n-      env: \"Smoke Test\"\n-      jdk: openjdk11\n-      cache:\n-        directories:\n-          - '$HOME/.gradle'\n-          - '.gradle'\n-          - '~/jdk-11.0.5+10'\n+    \n+    ########################################################################\n+    # Jobs are ordered tests first and then slower jobs before faster ones.\n+  \n+    - stage: Verify\n+      name: \"Tests: Integration Test\"\n+      addons: { postgresql: \"10\" }\n+      script: [ $VERIFY_STAGE/integration-testing/run || $REPORT_FAIL ]", "originalCommit": "1353b9b121d93ad4275f855b2c40749f1c192437", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTU5ODE3Ng==", "url": "https://github.com/triplea-game/triplea/pull/5899#discussion_r375598176", "bodyText": "Hmm, not sure if this matters. If we wind up adding more, then it'll be less of a diff, on the other hand we should not be adding more lines as each item in 'script' is intentionally extracted to 'run'.", "author": "DanVanAtta", "createdAt": "2020-02-06T01:23:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTQwNDI5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjIwMTQ3OQ==", "url": "https://github.com/triplea-game/triplea/pull/5899#discussion_r376201479", "bodyText": "Took a second look at this, while the list syntax is not strictly necessary, it does do a good job to visually distinguish the script step from the other labels that are scalars.", "author": "DanVanAtta", "createdAt": "2020-02-07T03:41:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTQwNDI5MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTQwNDg5Ng==", "url": "https://github.com/triplea-game/triplea/pull/5899#discussion_r375404896", "bodyText": "The same thing here, similar to the script thingy. It shouldn't be necessary to add list brackets here.", "author": "RoiEXLab", "createdAt": "2020-02-05T17:38:40Z", "path": ".travis.yml", "diffHunk": "@@ -1,188 +1,109 @@\n+if: tag is blank\n dist: xenial\n sudo: false\n language: java\n-if: tag is blank\n-\n-# Note: Travis generally does not allocate more than 5 VMs at once.\n-# Avoid running more than 5 jobs in parallel. Try to keep the jobs\n-# balanced so that they each take about the same amount of time.\n-\n-# Note: We download Java 11.0.5 for a few reasons:\n-# - jcenter no longer allows https TLS1.0 connection (this is seen as\n-#   a gradle failed to download plugin error)\n-# - Travis has Java 11.0.2 baked in to it, 11.0.2 does not have a\n-#   recent patch (2019-10) to allow Java 11 to use a compatible version\n-#   of TLS.\n-# To overcome this situation, we emulate the travis 'install-jdk' script\n-# and install a latest Java 11. For reference:\n-#   https://sormuras.github.io/blog/2017-12-08-install-jdk-on-travis.html\n-# Java12 does not have this issue, we do not download the Java11 script\n-# for that JVM or else we would be overriding Java12 with Java11.  \n-#\n-# Additional note: The export commands seem to not apply when extracted\n-# to a script and seemingly only work when located in the main travis config\n-# here.\n-#\n+jdk: openjdk11\n+cache: { directories: [ \"$HOME/.gradle\" , \".gradle\" ] }\n+install: skip\n \n+env:\n+  global:\n+   - REPORT_FAIL=\".travis/shared/report-build-status FAILURE\"\n+   - VERIFY_STAGE=\".travis/stages/verify\"\n+   - DEPLOY_STAGE=\".travis/stages/deploy\"\n jobs:\n   include:\n-    - stage: verify\n-      env: \"Static Verification\"\n-      jdk: openjdk11\n-      cache:\n-        directories:\n-          - '$HOME/.gradle'\n-          - '.gradle'\n-          - '~/jdk-11.0.5+10'\n-      before_install:\n-        - ./.travis/install_java_11.0.5\n-        - export JAVA_HOME=~/jdk-11.0.5+10\n-        - export PATH=${JAVA_HOME}/bin:$PATH\n-        - java --version\n-      install: skip\n-      script:\n-        ## shellcheck all shell scripts\n-        - find .travis/ -type f | xargs grep -lE \"^#\\!/bin/bash$\" | xargs shellcheck\n-        - .travis/check-links || travis_terminate 1;\n-        - .travis/find-unused-dbunit-datasets || travis_terminate 1\n-        - .travis/find-unmatched-test-packages || travis_terminate 1;\n-        - .travis/find-orphaned-tests || travis_terminate 1;\n-        - .travis/check-custom-style || travis_terminate 1;\n-        - ./gradlew --parallel validateYamls spotlessCheck checkstyleMain checkstyleTest pmdMain pmdTest\n-    - stage: verify\n-      env: \"Unit & Integration Tests\"\n-      jdk: openjdk11\n-      cache:\n-        directories:\n-          - '$HOME/.gradle'\n-          - '.gradle'\n-          - '~/jdk-11.0.5+10'\n-      addons: {postgresql: \"10\"}\n-      before_install:\n-        - ./.travis/install_java_11.0.5\n-        - export JAVA_HOME=~/jdk-11.0.5+10\n-        - export PATH=${JAVA_HOME}/bin:$PATH\n-        - java --version\n-      install: skip\n-      script:\n-        - .travis/setup_database\n-        - .travis/launch-http-server || travis_terminate 1\n-        - ./gradlew --parallel test integTest jacocoTestReport || travis_terminate 1\n-        - bash <(curl -s https://codecov.io/bash)  # upload coverage report - https://github.com/codecov/example-gradle\n-    - stage: verify\n-      env: \"Smoke Test\"\n-      jdk: openjdk11\n-      cache:\n-        directories:\n-          - '$HOME/.gradle'\n-          - '.gradle'\n-          - '~/jdk-11.0.5+10'\n+    \n+    ########################################################################\n+    # Jobs are ordered tests first and then slower jobs before faster ones.\n+  \n+    - stage: Verify\n+      name: \"Tests: Integration Test\"\n+      addons: { postgresql: \"10\" }\n+      script: [ $VERIFY_STAGE/integration-testing/run || $REPORT_FAIL ]\n+\n+    - stage: Verify\n+      name: \"Tests: Unit Test\"\n+      script: [ $VERIFY_STAGE/unit-testing/run || $REPORT_FAIL ]\n+    \n+    - stage: Verify\n+      name: \"Tests: Smoke Test\"\n       addons: {postgresql: \"10\"}\n-      before_install:\n-        - ./.travis/install_java_11.0.5\n-        - export JAVA_HOME=~/jdk-11.0.5+10\n-        - export PATH=${JAVA_HOME}/bin:$PATH\n-        - java --version\n-      install: skip\n-      script:\n-        - ./.travis/setup_database\n-        - ./.travis/run_smoke_tests\n-    - stage: deploy artifacts\n-      env: \"Upload to Github Releases\"\n+      script: [ $VERIFY_STAGE/smoke-testing/run || $REPORT_FAIL ]\n+\n+    - stage: Verify\n+      name: \"Analysis: PMD Verification\"\n+      script: [ $VERIFY_STAGE/pmd-verification/run || $REPORT_FAIL ]\n+    \n+    - stage: Verify\n+      name: \"Analysis: Checkstyle\"\n+      script: [ $VERIFY_STAGE/checkstyle/run || $REPORT_FAIL ]\n+    \n+    - stage: Verify\n+      name: \"Analysis: Java Formatting\"\n+      script: [ $VERIFY_STAGE/java-formatting/run || $REPORT_FAIL ]\n+    \n+    - stage: Verify\n+      name: \"Analysis: Check Links and YAML Syntax\"\n+      script: [ $VERIFY_STAGE/check-links-and-yaml-syntax/run || $REPORT_FAIL ]\n+      \n+    - stage: Verify\n+      name: \"Analysis: Code Convention Checks\"\n+      script: [ $VERIFY_STAGE/code-convention-checks/run || $REPORT_FAIL ]\n+\n+    - stage: Verify\n+      name: \"Analysis: Find Unused or Unmatched Tests\"\n+      script: [ $VERIFY_STAGE/find-unused-or-unmatched-tests/run || $REPORT_FAIL ]\n+\n+    ########################################################################\n+\n+    - stage: Deploy\n+      name: \"Push Map Descriptions to Website\"\n+      if: (branch = master) and (repo = 'triplea-game/triplea') and (type != 'pull_request')\n+      addons: { apt: { packages: [ python3, python3-yaml ] } }\n+      script: [ $DEPLOY_STAGE/update-maps-on-website/run || $REPORT_FAIL ]     \n+\n+    - stage: Deploy\n+      name: \"Ansible Deploy to Prerelease\"\n+      if: (branch = master) and (repo = 'triplea-game/triplea') and (type != 'pull_request')\n+      language: python\n+      python: \"3.6\"\n+      addons: { apt: { packages: [ sshpass ] } }\n+      install: [ pip install ansible ]", "originalCommit": "1353b9b121d93ad4275f855b2c40749f1c192437", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "8e9e78913d17d073f50a91bfe4890a32010c711c", "url": "https://github.com/triplea-game/triplea/commit/8e9e78913d17d073f50a91bfe4890a32010c711c", "message": "Remove unnecessary openJDK spec", "committedDate": "2020-02-07T03:25:51Z", "type": "commit"}]}