{"pr_number": 6616, "pr_title": "Local runnable prod deployment script", "pr_createdAt": "2020-06-07T00:49:17Z", "pr_url": "https://github.com/triplea-game/triplea/pull/6616", "timeline": [{"oid": "c0592ebcea4dc855aeb3e18848ae101e51d62d2a", "url": "https://github.com/triplea-game/triplea/commit/c0592ebcea4dc855aeb3e18848ae101e51d62d2a", "message": "Locally runnable prod deployment script\n\nUnify the name of the deployment scripts in 'infrastructure'.\nAfter this update we now have:\n  - run_ansible_vagrant\n  - run_ansible_prerelease\n  - run_ansible_production\nEach is similar and can be run locally. The travis scripts\nare now updated to set up any preconditions, notably copying\nthe ansible vault secret variable to a vault file and then\nkicking off the respective 'run_ansible' script.", "committedDate": "2020-06-07T00:46:09Z", "type": "commit"}, {"oid": "26ebb804e3a006e1da0e3d1fcb3f17255c8d2172", "url": "https://github.com/triplea-game/triplea/commit/26ebb804e3a006e1da0e3d1fcb3f17255c8d2172", "message": "Allow parameters to be passed to the run_ansible_production_script\n\nEG: to run with tags, `./run_ansible_production -t certbot` to execute\nonly the certbot role.", "committedDate": "2020-06-07T02:37:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjMxODU3MQ==", "url": "https://github.com/triplea-game/triplea/pull/6616#discussion_r436318571", "bodyText": "Double quote array expansions to avoid re-splitting elements.", "author": "codeclimate", "createdAt": "2020-06-07T02:39:31Z", "path": "infrastructure/run_ansible_production", "diffHunk": "@@ -0,0 +1,30 @@\n+#!/bin/bash\n+\n+set -eEu\n+\n+if [ ! -f \"vault_password\" ]; then\n+  echo \"Error: vault_password file must exist at $(pwd)\"\n+  exit 1\n+fi\n+\n+# Start up ssh-agent\n+eval \"$(ssh-agent -s)\"\n+\n+# Decrypt SSH key and add it to ssh agent\n+# Once available to SSH agent, when making SSH connections\n+# this key will be offered by SSH for authentication.\n+# This allows ansible to SSH to target servers and run\n+# deployment commands. We assume servers have been created\n+# with the corresponding public key already installed.\n+ansible-vault view \\\n+    --vault-password-file=vault_password \\\n+    ansible_ssh_key.ed25519 \\\n+  | ssh-add -\n+\n+# Run deployment\n+ansible-playbook \\\n+    --vault-password-file vault_password \\\n+    $@ \\", "originalCommit": "26ebb804e3a006e1da0e3d1fcb3f17255c8d2172", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "be7c578379dda6992f34a50c5daa218a04a8ad70", "url": "https://github.com/triplea-game/triplea/commit/be7c578379dda6992f34a50c5daa218a04a8ad70", "message": "Add double quotes to avoid element re-splitting (Fix shellcheck)", "committedDate": "2020-06-07T03:09:21Z", "type": "commit"}]}