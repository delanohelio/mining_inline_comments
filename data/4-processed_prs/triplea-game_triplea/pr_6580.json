{"pr_number": 6580, "pr_title": "Fix NPE in auto-placement-finder when finding islands", "pr_createdAt": "2020-06-02T05:18:03Z", "pr_url": "https://github.com/triplea-game/triplea/pull/6580", "timeline": [{"oid": "f305e5c98302ce978b1310198d4e3208828f340c", "url": "https://github.com/triplea-game/triplea/commit/f305e5c98302ce978b1310198d4e3208828f340c", "message": "Fix NPE in auto-placement-finder when finding islands\n\nThe contract of MapData#getContainedTerritoryPolygons (in javadoc)\nstates the parameter should be a sea territory. The caller passes\nall territories to this method which then results in a NPE in\nthe method. To fix, relax the contract and return an empty collection\nif the parameter is not a sea territory.\n\nReported in: https://github.com/triplea-game/triplea/issues/6469", "committedDate": "2020-06-02T05:14:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDI0MDU1Ng==", "url": "https://github.com/triplea-game/triplea/pull/6580#discussion_r434240556", "bodyText": "What about contains.getOrDefault(territoryName, Set.of())?", "author": "RoiEXLab", "createdAt": "2020-06-03T00:10:03Z", "path": "game-core/src/main/java/games/strategy/triplea/ui/mapdata/MapData.java", "diffHunk": "@@ -515,14 +515,18 @@ public Color impassableColor() {\n   /**\n    * Returns the polygons for any territories contained within a given territory.\n    *\n-   * @param territoryName Name of the territory, expected to be a sea territory, where we will be\n-   *     checking for any contained 'island' territories.\n+   * @param territoryName Name of the territory, where we will be checking for any contained\n+   *     'island' territories.\n+   * @return Empty if the parameter is not a sea territory or contains no 'islands', otherwise\n+   *     returns any 'islands' contained within the given territory.\n    */\n   public Set<Polygon> getContainedTerritoryPolygons(final String territoryName) {\n-    return contains.get(territoryName).stream()", "originalCommit": "f305e5c98302ce978b1310198d4e3208828f340c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjMwMzIzMA==", "url": "https://github.com/triplea-game/triplea/pull/6580#discussion_r436303230", "bodyText": "I'm really on the fence. I like that it is more direct, but the later operations are what give me trouble. Specifically I don't like how it's kind of a 'hack' where a reader has to see \"okay, in this case the set is empty, so we then get no-op, no-op, no-op, okay, we returned an empty set\". Having it be more direct I think is more clear. IE: \"if this does not contain, then we return empty set, otherwise we take the set, transform it, and return that\".", "author": "DanVanAtta", "createdAt": "2020-06-06T21:47:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDI0MDU1Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjMwMzI5NQ==", "url": "https://github.com/triplea-game/triplea/pull/6580#discussion_r436303295", "bodyText": "It is between:\n    return !contains.containsKey(territoryName)\n        ? Set.of()\n        : contains.get(territoryName).stream()\n            .map(this::getPolygons)\n            .flatMap(Collection::stream)\n            .collect(Collectors.toSet());\n\nOr the getDefault with no-ops.", "author": "DanVanAtta", "createdAt": "2020-06-06T21:49:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDI0MDU1Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjMwMzQyMQ==", "url": "https://github.com/triplea-game/triplea/pull/6580#discussion_r436303421", "bodyText": "Went with the 'getOrDefault' approach: 0edd2bc\nThe !contains is also problematic as well (still incur cognitive complexity from the if statement, leading an if condition with a not adds yet more cognitive complexity).", "author": "DanVanAtta", "createdAt": "2020-06-06T21:51:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDI0MDU1Ng=="}], "type": "inlineReview"}, {"oid": "0edd2bc50d2724f62ad3a09a009c6a3d7b0e3ec1", "url": "https://github.com/triplea-game/triplea/commit/0edd2bc50d2724f62ad3a09a009c6a3d7b0e3ec1", "message": "Minor refactor: Remove if statement by operating on empty set.", "committedDate": "2020-06-06T21:50:24Z", "type": "commit"}]}