{"pr_number": 7582, "pr_title": "Various game parser simplifications", "pr_createdAt": "2020-09-09T05:15:31Z", "pr_url": "https://github.com/triplea-game/triplea/pull/7582", "timeline": [{"oid": "15b34f3bfb03f24da0fefc967393088c861ec741", "url": "https://github.com/triplea-game/triplea/commit/15b34f3bfb03f24da0fefc967393088c861ec741", "message": "Combine private methods", "committedDate": "2020-09-09T03:29:41Z", "type": "commit"}, {"oid": "1a0abd15ce46636d6bd0f08e5c31844a1da5e9cb", "url": "https://github.com/triplea-game/triplea/commit/1a0abd15ce46636d6bd0f08e5c31844a1da5e9cb", "message": "Reduce entry points into GameParser", "committedDate": "2020-09-09T03:40:01Z", "type": "commit"}, {"oid": "5f4a57347b0790c2b9a39252bbcca0f15f251a0d", "url": "https://github.com/triplea-game/triplea/commit/5f4a57347b0790c2b9a39252bbcca0f15f251a0d", "message": "Remove no longer needed test-hack code", "committedDate": "2020-09-09T03:48:52Z", "type": "commit"}, {"oid": "53a360d188ac178c8710e4ef338fbc58c82ec5c1", "url": "https://github.com/triplea-game/triplea/commit/53a360d188ac178c8710e4ef338fbc58c82ec5c1", "message": "Inline utility method for 'getValidatedObject'", "committedDate": "2020-09-09T03:57:06Z", "type": "commit"}, {"oid": "208a6cfd1f1a4e3b01573ddf0ba02201ae752186", "url": "https://github.com/triplea-game/triplea/commit/208a6cfd1f1a4e3b01573ddf0ba02201ae752186", "message": "Move 'getPlayer' attribute lookup to caller.", "committedDate": "2020-09-09T04:05:30Z", "type": "commit"}, {"oid": "d76b2198908424bcaff7ad163ab5ff3629ebdddc", "url": "https://github.com/triplea-game/triplea/commit/d76b2198908424bcaff7ad163ab5ff3629ebdddc", "message": "Inline usages of 'getValidatedObject', use Optional API instead", "committedDate": "2020-09-09T04:28:37Z", "type": "commit"}, {"oid": "bbaaae0dcbee4386edd9f10e6fdb2461b86ddfda", "url": "https://github.com/triplea-game/triplea/commit/bbaaae0dcbee4386edd9f10e6fdb2461b86ddfda", "message": "Consistently pass attribute value rather than 'Element'", "committedDate": "2020-09-09T04:31:34Z", "type": "commit"}, {"oid": "013c3a0e9465b0a3a80a835a225b50ef4ca69366", "url": "https://github.com/triplea-game/triplea/commit/013c3a0e9465b0a3a80a835a225b50ef4ca69366", "message": "Convert 'getChild(.. boolean optional)' to return an Optional value.", "committedDate": "2020-09-09T04:36:39Z", "type": "commit"}, {"oid": "2ad99883c11d7529b4de14af5c2ace7b3053322c", "url": "https://github.com/triplea-game/triplea/commit/2ad99883c11d7529b4de14af5c2ace7b3053322c", "message": "Inline GameData constructor arg", "committedDate": "2020-09-09T04:40:18Z", "type": "commit"}, {"oid": "90f96cb9dea569e6e8bb9e089a27016b5b9df9f2", "url": "https://github.com/triplea-game/triplea/commit/90f96cb9dea569e6e8bb9e089a27016b5b9df9f2", "message": "cleanup imports", "committedDate": "2020-09-09T04:43:09Z", "type": "commit"}, {"oid": "1288bdd9f44eab7519d08a17881bc384f76dd970", "url": "https://github.com/triplea-game/triplea/commit/1288bdd9f44eab7519d08a17881bc384f76dd970", "message": "Reduce entry points to GameParser, have callers construct an xml game element mapper", "committedDate": "2020-09-09T04:45:39Z", "type": "commit"}, {"oid": "c67ceda1f272029335c7d64635602e1bed7061c4", "url": "https://github.com/triplea-game/triplea/commit/c67ceda1f272029335c7d64635602e1bed7061c4", "message": "Reduce game parser state, abort parsing if there are SAX errors", "committedDate": "2020-09-09T04:50:40Z", "type": "commit"}, {"oid": "15d6e7831b91f515b392e16994691aa85b640487", "url": "https://github.com/triplea-game/triplea/commit/15d6e7831b91f515b392e16994691aa85b640487", "message": "Fix syntax error / typo", "committedDate": "2020-09-09T04:51:18Z", "type": "commit"}, {"oid": "f5f1e452975e250cafbfe3340823759ba04334c2", "url": "https://github.com/triplea-game/triplea/commit/f5f1e452975e250cafbfe3340823759ba04334c2", "message": "Move error message formatting to GameParseException", "committedDate": "2020-09-09T04:56:45Z", "type": "commit"}, {"oid": "8a384d05cbceb091867c2c7632c15515e8c83fd3", "url": "https://github.com/triplea-game/triplea/commit/8a384d05cbceb091867c2c7632c15515e8c83fd3", "message": "Move GameParseException to gameparser package", "committedDate": "2020-09-09T04:58:22Z", "type": "commit"}, {"oid": "c87a8da79c6d84e7095c92427aae762d7ee5d12e", "url": "https://github.com/triplea-game/triplea/commit/c87a8da79c6d84e7095c92427aae762d7ee5d12e", "message": "Inline usages of GameParseException in GameParser", "committedDate": "2020-09-09T05:04:27Z", "type": "commit"}, {"oid": "e4c45c969851a8b530197a4f409d48a3c88b8481", "url": "https://github.com/triplea-game/triplea/commit/e4c45c969851a8b530197a4f409d48a3c88b8481", "message": "Simplify null property parsing, parseInt will throw an exception and we'll set the null value anyways", "committedDate": "2020-09-09T05:08:08Z", "type": "commit"}, {"oid": "754083366eeca81bb3f673bbebe856749a476261", "url": "https://github.com/triplea-game/triplea/commit/754083366eeca81bb3f673bbebe856749a476261", "message": "Move variable definitions closer to usage", "committedDate": "2020-09-09T05:10:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTM0NTI2NA==", "url": "https://github.com/triplea-game/triplea/pull/7582#discussion_r485345264", "bodyText": "Method parseMapPropertiesAndDetails has 59 lines of code (exceeds 50 allowed). Consider refactoring.", "author": "codeclimate", "createdAt": "2020-09-09T05:23:19Z", "path": "game-core/src/main/java/games/strategy/engine/data/gameparser/GameParser.java", "diffHunk": "@@ -118,111 +106,80 @@ private GameParser(\n         });\n   }\n \n-  @Nonnull\n-  @VisibleForTesting\n-  public static GameData parse(\n-      final String mapName,\n-      final InputStream stream,\n-      final XmlGameElementMapper xmlGameElementMapper)\n-      throws GameParseException, EngineVersionException {\n-    checkNotNull(mapName);\n-    checkNotNull(stream);\n-    checkNotNull(xmlGameElementMapper);\n-\n-    return new GameParser(new GameData(), mapName, xmlGameElementMapper).parse(stream);\n-  }\n-\n   @Nonnull\n   private GameData parse(final InputStream stream)\n       throws GameParseException, EngineVersionException {\n+\n+    final Collection<SAXParseException> errorsSax = new ArrayList<>();\n     final Element root = XmlReader.parseDom(mapName, stream, errorsSax);\n-    parseMapProperties(root);\n-    parseMapDetails(root);\n-    return data;\n-  }\n \n-  private GameParseException newGameParseException(final String message) {\n-    return newGameParseException(message, null);\n-  }\n+    if (!errorsSax.isEmpty()) {\n+      throw new GameParseException(errorsSax);\n+    }\n \n-  private GameParseException newGameParseException(\n-      final String message, final @Nullable Throwable cause) {\n-    final String gameName = data.getGameName() != null ? data.getGameName() : \"<unknown>\";\n-    return new GameParseException(\n-        String.format(\"map name: '%s', game name: '%s', %s\", mapName, gameName, message), cause);\n+    parseMapPropertiesAndDetails(root);\n+    return data;\n   }\n \n-  private void parseMapProperties(final Element root)\n+  private void parseMapPropertiesAndDetails(final Element root)", "originalCommit": "754083366eeca81bb3f673bbebe856749a476261", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTM0NTI2Ng==", "url": "https://github.com/triplea-game/triplea/pull/7582#discussion_r485345266", "bodyText": "Method parseMapPropertiesAndDetails has a Cognitive Complexity of 11 (exceeds 7 allowed). Consider refactoring.", "author": "codeclimate", "createdAt": "2020-09-09T05:23:20Z", "path": "game-core/src/main/java/games/strategy/engine/data/gameparser/GameParser.java", "diffHunk": "@@ -118,111 +106,80 @@ private GameParser(\n         });\n   }\n \n-  @Nonnull\n-  @VisibleForTesting\n-  public static GameData parse(\n-      final String mapName,\n-      final InputStream stream,\n-      final XmlGameElementMapper xmlGameElementMapper)\n-      throws GameParseException, EngineVersionException {\n-    checkNotNull(mapName);\n-    checkNotNull(stream);\n-    checkNotNull(xmlGameElementMapper);\n-\n-    return new GameParser(new GameData(), mapName, xmlGameElementMapper).parse(stream);\n-  }\n-\n   @Nonnull\n   private GameData parse(final InputStream stream)\n       throws GameParseException, EngineVersionException {\n+\n+    final Collection<SAXParseException> errorsSax = new ArrayList<>();\n     final Element root = XmlReader.parseDom(mapName, stream, errorsSax);\n-    parseMapProperties(root);\n-    parseMapDetails(root);\n-    return data;\n-  }\n \n-  private GameParseException newGameParseException(final String message) {\n-    return newGameParseException(message, null);\n-  }\n+    if (!errorsSax.isEmpty()) {\n+      throw new GameParseException(errorsSax);\n+    }\n \n-  private GameParseException newGameParseException(\n-      final String message, final @Nullable Throwable cause) {\n-    final String gameName = data.getGameName() != null ? data.getGameName() : \"<unknown>\";\n-    return new GameParseException(\n-        String.format(\"map name: '%s', game name: '%s', %s\", mapName, gameName, message), cause);\n+    parseMapPropertiesAndDetails(root);\n+    return data;\n   }\n \n-  private void parseMapProperties(final Element root)\n+  private void parseMapPropertiesAndDetails(final Element root)", "originalCommit": "754083366eeca81bb3f673bbebe856749a476261", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "25fc3f541913dd1085c5cf563f7025caf78c4dc1", "url": "https://github.com/triplea-game/triplea/commit/25fc3f541913dd1085c5cf563f7025caf78c4dc1", "message": "Combine private methods", "committedDate": "2020-09-09T07:02:45Z", "type": "commit"}, {"oid": "b18d9c3ec130e6a845437d2a5f9b649f1028d52e", "url": "https://github.com/triplea-game/triplea/commit/b18d9c3ec130e6a845437d2a5f9b649f1028d52e", "message": "Remove unnecessary parameter type-cast and inline intermediate info variables", "committedDate": "2020-09-09T07:05:06Z", "type": "commit"}, {"oid": "589d9b4210666f0e0d932779698fc4cc9e8fb0db", "url": "https://github.com/triplea-game/triplea/commit/589d9b4210666f0e0d932779698fc4cc9e8fb0db", "message": "Extract game parsing validation to another class", "committedDate": "2020-09-09T08:03:26Z", "type": "commit"}, {"oid": "589d9b4210666f0e0d932779698fc4cc9e8fb0db", "url": "https://github.com/triplea-game/triplea/commit/589d9b4210666f0e0d932779698fc4cc9e8fb0db", "message": "Extract game parsing validation to another class", "committedDate": "2020-09-09T08:03:26Z", "type": "forcePushed"}]}