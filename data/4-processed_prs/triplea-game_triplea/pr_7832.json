{"pr_number": 7832, "pr_title": "Improve AA Battle UI text", "pr_createdAt": "2020-10-03T15:34:48Z", "pr_url": "https://github.com/triplea-game/triplea/pull/7832", "timeline": [{"oid": "8e31ba25f8fd96d864311298e48a30b2892a2ca3", "url": "https://github.com/triplea-game/triplea/commit/8e31ba25f8fd96d864311298e48a30b2892a2ca3", "message": "Improve AA Battle UI text", "committedDate": "2020-10-03T16:06:01Z", "type": "commit"}, {"oid": "8e31ba25f8fd96d864311298e48a30b2892a2ca3", "url": "https://github.com/triplea-game/triplea/commit/8e31ba25f8fd96d864311298e48a30b2892a2ca3", "message": "Improve AA Battle UI text", "committedDate": "2020-10-03T16:06:01Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE3NjkyOQ==", "url": "https://github.com/triplea-game/triplea/pull/7832#discussion_r499176929", "bodyText": "I don't know if pushing this complexity to the caller is a good move. The caller will have to know the full implementation details of this method to know how this text is being used.\nI think for example one smell is the value of parameter is a composition of other parameters:\n            \"Select \"\n                + dice.getHits()\n                + \" casualties from \"\n                + currentTypeAa\n                + \" fire in \"\n                + territory.getName(),\n\n\nPerhaps we can fix this cleanly with a configuration flag?\n\nTo another extent, the root cause seems to be the overall structure here and arguably a lack of abstractions altogether. I think this is a good example of a \"routine\", in other words a procedural method. The deeper fix here is likely to be quite the rabbit hole.", "author": "DanVanAtta", "createdAt": "2020-10-03T19:51:44Z", "path": "game-core/src/main/java/games/strategy/triplea/delegate/battle/casualty/AaCasualtySelector.java", "diffHunk": "@@ -37,6 +37,7 @@ public static CasualtyDetails getAaCasualties(\n       final Collection<Unit> allFriendlyUnits,\n       final Collection<Unit> defendingAa,\n       final Collection<Unit> allEnemyUnits,\n+      final String text,", "originalCommit": "8e31ba25f8fd96d864311298e48a30b2892a2ca3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE4Mzc4OQ==", "url": "https://github.com/triplea-game/triplea/pull/7832#discussion_r499183789", "bodyText": "As I mentioned in the description, the \"battleid\" is basically used as a configuration flag.  It controls whether the entire text is used as is or if it will append \", select X casualties\".\nWe are limited on what changes we can make because this goes through a RemoteAction.  I looked at a possibility of change and one idea is to only pass the currentTypeAa (or similar for non aa) through the text parameter.  In the final callees (BattleDisplay#getCasualties and BattlePanel#getCasualtiesAa), they can get access to the territory and the dice.  So at that point, they can generate the final string.\nOne potential issue is that AirBattle.AttackersFire#execute and AirBattle.AttackersFire#execute use a different string format: \"Defenders Fire\" and \"Attackers Fire\".  By making this change, they would now say something like \"Hits from attackers\" and \"Hits from defenders\".", "author": "trevan", "createdAt": "2020-10-03T21:37:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE3NjkyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE4NTM2MA==", "url": "https://github.com/triplea-game/triplea/pull/7832#discussion_r499185360", "bodyText": "TBH I really cringe by passing a UI specific text to this API, but I recognize the code we're working with is tangled into knots. Are there any other reasonable options, or is this really the least worst?", "author": "DanVanAtta", "createdAt": "2020-10-03T22:01:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE3NjkyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE4OTIxOA==", "url": "https://github.com/triplea-game/triplea/pull/7832#discussion_r499189218", "bodyText": "Considering we can't add additional parameters or change the types of the parameters, I think either leaving it as is or making the change to only passing the currentTypeAa and similar is what we have available.", "author": "trevan", "createdAt": "2020-10-03T23:10:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE3NjkyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTIwMjc1Nw==", "url": "https://github.com/triplea-game/triplea/pull/7832#discussion_r499202757", "bodyText": "\ud83d\udc4d", "author": "DanVanAtta", "createdAt": "2020-10-04T03:49:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE3NjkyOQ=="}], "type": "inlineReview"}]}