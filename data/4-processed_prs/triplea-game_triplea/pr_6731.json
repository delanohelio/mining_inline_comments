{"pr_number": 6731, "pr_title": "Configure test coverage uploads to code climate", "pr_createdAt": "2020-06-21T21:59:04Z", "pr_url": "https://github.com/triplea-game/triplea/pull/6731", "timeline": [{"oid": "da4303941229cad67ab04560f8efdbce1f19163d", "url": "https://github.com/triplea-game/triplea/commit/da4303941229cad67ab04560f8efdbce1f19163d", "message": "Configure test coverage uploads to code climate", "committedDate": "2020-06-21T21:58:21Z", "type": "commit"}, {"oid": "2f213b1adfea832ed1f550be58ce14e2b054bb0f", "url": "https://github.com/triplea-game/triplea/commit/2f213b1adfea832ed1f550be58ce14e2b054bb0f", "message": "Capture test result exit code manually\n\nTRAVIS_TEST_RESULT env variable did not exist", "committedDate": "2020-06-21T22:14:46Z", "type": "commit"}, {"oid": "2f213b1adfea832ed1f550be58ce14e2b054bb0f", "url": "https://github.com/triplea-game/triplea/commit/2f213b1adfea832ed1f550be58ce14e2b054bb0f", "message": "Capture test result exit code manually\n\nTRAVIS_TEST_RESULT env variable did not exist", "committedDate": "2020-06-21T22:14:46Z", "type": "forcePushed"}, {"oid": "49aede681727c160680301a8d35ee0917480c301", "url": "https://github.com/triplea-game/triplea/commit/49aede681727c160680301a8d35ee0917480c301", "message": "Remove explicit exit", "committedDate": "2020-06-21T22:21:35Z", "type": "commit"}, {"oid": "5e28344d3ed6f1534a0a21889dcb34d09fe40127", "url": "https://github.com/triplea-game/triplea/commit/5e28344d3ed6f1534a0a21889dcb34d09fe40127", "message": "Inject explit test failure to demo test failure", "committedDate": "2020-06-21T22:21:37Z", "type": "commit"}, {"oid": "94864aae15abfa591ec26f874519f0363ff25631", "url": "https://github.com/triplea-game/triplea/commit/94864aae15abfa591ec26f874519f0363ff25631", "message": "Fix result flag to actually be '$?'", "committedDate": "2020-06-21T22:23:20Z", "type": "commit"}, {"oid": "5936dde03763ab98cb4239f8e2eec66807b56e6e", "url": "https://github.com/triplea-game/triplea/commit/5936dde03763ab98cb4239f8e2eec66807b56e6e", "message": "Skip codecov upload if tests fail", "committedDate": "2020-06-21T22:37:10Z", "type": "commit"}, {"oid": "b455c58bdc09dd2bf70cec847b61e0c9f5668aaa", "url": "https://github.com/triplea-game/triplea/commit/b455c58bdc09dd2bf70cec847b61e0c9f5668aaa", "message": "Remove demo test failure", "committedDate": "2020-06-21T22:58:03Z", "type": "commit"}, {"oid": "16432693474fd700b0f7caabf92b4d48a71db277", "url": "https://github.com/triplea-game/triplea/commit/16432693474fd700b0f7caabf92b4d48a71db277", "message": "Specify jacoco report type", "committedDate": "2020-06-21T23:08:36Z", "type": "commit"}, {"oid": "fed472def95f14c1766898efcd8ce2b98a739207", "url": "https://github.com/triplea-game/triplea/commit/fed472def95f14c1766898efcd8ce2b98a739207", "message": "Updata jacoco to output XML files", "committedDate": "2020-06-22T00:05:22Z", "type": "commit"}, {"oid": "06813754cfcc95fea1bea85b7691a0a1b078a709", "url": "https://github.com/triplea-game/triplea/commit/06813754cfcc95fea1bea85b7691a0a1b078a709", "message": "Script up summing of code-climate report files\n\nThe cc-report script only works when run from the root of the source directory.\nApparently the --prefix flag that is meant to do this does not work.\nTo generate a report we CD to each source directory of each subproject\nthat generates an XML file, run the coverage formatter, and then\nas a last step we sum up each coverage file and upload.", "committedDate": "2020-06-22T00:05:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI3MDU3MA==", "url": "https://github.com/triplea-game/triplea/pull/6731#discussion_r443270570", "bodyText": "Use -print0/-0 or -exec + to allow for non-alphanumeric filenames.", "author": "codeclimate", "createdAt": "2020-06-22T00:08:16Z", "path": ".travis/stages/verify/unit-testing/run", "diffHunk": "@@ -1,10 +1,35 @@\n #!/bin/bash\n \n-set -eEux\n+set -ux\n+\n+export CC_TEST_REPORTER_ID=\"$CODE_CLIMATE_TEST_COVERAGE_ID\"\n+\n+curl -L \\\n+  https://codeclimate.com/downloads/test-reporter/test-reporter-latest-linux-amd64 \\\n+  > ./cc-test-reporter\n+\n+chmod +x ./cc-test-reporter\n+\n+./cc-test-reporter before-build\n \n-# Run Tests\n ./gradlew -x :smoke-testing:test -parallel test jacocoTestReport\n \n+result=\"$?\"\n+\n+if [ \"$result\" != 0 ]; then\n+  exit \"$result\"\n+fi\n+\n+for i in $(find -name \"jacoco.xml\" | xargs dirname | xargs dirname);", "originalCommit": "06813754cfcc95fea1bea85b7691a0a1b078a709", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI3MDU3Mg==", "url": "https://github.com/triplea-game/triplea/pull/6731#discussion_r443270572", "bodyText": "Some finds don't have a default path. Specify '.' explicitly.", "author": "codeclimate", "createdAt": "2020-06-22T00:08:17Z", "path": ".travis/stages/verify/unit-testing/run", "diffHunk": "@@ -1,10 +1,35 @@\n #!/bin/bash\n \n-set -eEux\n+set -ux\n+\n+export CC_TEST_REPORTER_ID=\"$CODE_CLIMATE_TEST_COVERAGE_ID\"\n+\n+curl -L \\\n+  https://codeclimate.com/downloads/test-reporter/test-reporter-latest-linux-amd64 \\\n+  > ./cc-test-reporter\n+\n+chmod +x ./cc-test-reporter\n+\n+./cc-test-reporter before-build\n \n-# Run Tests\n ./gradlew -x :smoke-testing:test -parallel test jacocoTestReport\n \n+result=\"$?\"\n+\n+if [ \"$result\" != 0 ]; then\n+  exit \"$result\"\n+fi\n+\n+for i in $(find -name \"jacoco.xml\" | xargs dirname | xargs dirname);", "originalCommit": "06813754cfcc95fea1bea85b7691a0a1b078a709", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI3MDU3Mw==", "url": "https://github.com/triplea-game/triplea/pull/6731#discussion_r443270573", "bodyText": "Use 'cd ... || exit' or 'cd ... || return' in case cd fails.", "author": "codeclimate", "createdAt": "2020-06-22T00:08:17Z", "path": ".travis/stages/verify/unit-testing/run", "diffHunk": "@@ -1,10 +1,35 @@\n #!/bin/bash\n \n-set -eEux\n+set -ux\n+\n+export CC_TEST_REPORTER_ID=\"$CODE_CLIMATE_TEST_COVERAGE_ID\"\n+\n+curl -L \\\n+  https://codeclimate.com/downloads/test-reporter/test-reporter-latest-linux-amd64 \\\n+  > ./cc-test-reporter\n+\n+chmod +x ./cc-test-reporter\n+\n+./cc-test-reporter before-build\n \n-# Run Tests\n ./gradlew -x :smoke-testing:test -parallel test jacocoTestReport\n \n+result=\"$?\"\n+\n+if [ \"$result\" != 0 ]; then\n+  exit \"$result\"\n+fi\n+\n+for i in $(find -name \"jacoco.xml\" | xargs dirname | xargs dirname);\n+do\n+(\n+  cd $i", "originalCommit": "06813754cfcc95fea1bea85b7691a0a1b078a709", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI3MDU3NA==", "url": "https://github.com/triplea-game/triplea/pull/6731#discussion_r443270574", "bodyText": "Double quote to prevent globbing and word splitting.", "author": "codeclimate", "createdAt": "2020-06-22T00:08:17Z", "path": ".travis/stages/verify/unit-testing/run", "diffHunk": "@@ -1,10 +1,35 @@\n #!/bin/bash\n \n-set -eEux\n+set -ux\n+\n+export CC_TEST_REPORTER_ID=\"$CODE_CLIMATE_TEST_COVERAGE_ID\"\n+\n+curl -L \\\n+  https://codeclimate.com/downloads/test-reporter/test-reporter-latest-linux-amd64 \\\n+  > ./cc-test-reporter\n+\n+chmod +x ./cc-test-reporter\n+\n+./cc-test-reporter before-build\n \n-# Run Tests\n ./gradlew -x :smoke-testing:test -parallel test jacocoTestReport\n \n+result=\"$?\"\n+\n+if [ \"$result\" != 0 ]; then\n+  exit \"$result\"\n+fi\n+\n+for i in $(find -name \"jacoco.xml\" | xargs dirname | xargs dirname);\n+do\n+(\n+  cd $i", "originalCommit": "06813754cfcc95fea1bea85b7691a0a1b078a709", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI3MDU3NQ==", "url": "https://github.com/triplea-game/triplea/pull/6731#discussion_r443270575", "bodyText": "Quote this to prevent word splitting.", "author": "codeclimate", "createdAt": "2020-06-22T00:08:17Z", "path": ".travis/stages/verify/unit-testing/run", "diffHunk": "@@ -1,10 +1,35 @@\n #!/bin/bash\n \n-set -eEux\n+set -ux\n+\n+export CC_TEST_REPORTER_ID=\"$CODE_CLIMATE_TEST_COVERAGE_ID\"\n+\n+curl -L \\\n+  https://codeclimate.com/downloads/test-reporter/test-reporter-latest-linux-amd64 \\\n+  > ./cc-test-reporter\n+\n+chmod +x ./cc-test-reporter\n+\n+./cc-test-reporter before-build\n \n-# Run Tests\n ./gradlew -x :smoke-testing:test -parallel test jacocoTestReport\n \n+result=\"$?\"\n+\n+if [ \"$result\" != 0 ]; then\n+  exit \"$result\"\n+fi\n+\n+for i in $(find -name \"jacoco.xml\" | xargs dirname | xargs dirname);\n+do\n+(\n+  cd $i\n+  ../../../../cc-test-reporter format-coverage -t jacoco ../../../build/jacoco.xml\n+)\n+done\n+./cc-test-reporter sum-coverage $(find . -name \"codeclimate.json\")", "originalCommit": "06813754cfcc95fea1bea85b7691a0a1b078a709", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "69551377d6e4a2881af02e35c816ada71c476149", "url": "https://github.com/triplea-game/triplea/commit/69551377d6e4a2881af02e35c816ada71c476149", "message": "Fix shellchecks", "committedDate": "2020-06-22T00:17:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI3MTc3Nw==", "url": "https://github.com/triplea-game/triplea/pull/6731#discussion_r443271777", "bodyText": "Use -print0/-0 or -exec + to allow for non-alphanumeric filenames.", "author": "codeclimate", "createdAt": "2020-06-22T00:20:55Z", "path": ".travis/stages/verify/unit-testing/run", "diffHunk": "@@ -1,10 +1,35 @@\n #!/bin/bash\n \n-set -eEux\n+set -ux\n+\n+export CC_TEST_REPORTER_ID=\"$CODE_CLIMATE_TEST_COVERAGE_ID\"\n+\n+curl -L \\\n+  https://codeclimate.com/downloads/test-reporter/test-reporter-latest-linux-amd64 \\\n+  > ./cc-test-reporter\n+\n+chmod +x ./cc-test-reporter\n+\n+./cc-test-reporter before-build\n \n-# Run Tests\n ./gradlew -x :smoke-testing:test -parallel test jacocoTestReport\n \n+result=\"$?\"\n+\n+if [ \"$result\" != 0 ]; then\n+  exit \"$result\"\n+fi\n+\n+for i in $(find . -name \"jacoco.xml\" -exec dirname {} + | xargs dirname)", "originalCommit": "69551377d6e4a2881af02e35c816ada71c476149", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "6feb2a6849611e6774ddfdfe92f332c5c8bc71b9", "url": "https://github.com/triplea-game/triplea/commit/6feb2a6849611e6774ddfdfe92f332c5c8bc71b9", "message": "Fix shellchecks", "committedDate": "2020-06-22T00:44:33Z", "type": "commit"}, {"oid": "cb9aded0bfa8d5a636f1843dbbd5f4329c027769", "url": "https://github.com/triplea-game/triplea/commit/cb9aded0bfa8d5a636f1843dbbd5f4329c027769", "message": "Fix \"cd\"", "committedDate": "2020-06-22T01:12:21Z", "type": "commit"}, {"oid": "cfd1581de1ddd83002ea9935c039c0ced66f1a2d", "url": "https://github.com/triplea-game/triplea/commit/cfd1581de1ddd83002ea9935c039c0ced66f1a2d", "message": "Fix empty path from find", "committedDate": "2020-06-22T01:44:00Z", "type": "commit"}, {"oid": "dd1644c799d30b2e8e908a5301f88c58dfe4b2c4", "url": "https://github.com/triplea-game/triplea/commit/dd1644c799d30b2e8e908a5301f88c58dfe4b2c4", "message": "Fix cd path", "committedDate": "2020-06-22T02:17:01Z", "type": "commit"}, {"oid": "1c291aec1a45069cbdf5c62f9015dc32b4e09527", "url": "https://github.com/triplea-game/triplea/commit/1c291aec1a45069cbdf5c62f9015dc32b4e09527", "message": "More fixes to coverage script", "committedDate": "2020-06-22T02:51:14Z", "type": "commit"}, {"oid": "3dc230451e9a9d3e354a0ba53b23181930b06ff8", "url": "https://github.com/triplea-game/triplea/commit/3dc230451e9a9d3e354a0ba53b23181930b06ff8", "message": "Group commands into functions and add commentary", "committedDate": "2020-06-22T03:16:45Z", "type": "commit"}, {"oid": "fc6ae2e4e92525855f25e759ba6b1ddb350718f4", "url": "https://github.com/triplea-game/triplea/commit/fc6ae2e4e92525855f25e759ba6b1ddb350718f4", "message": "Organize unit test stage into functions", "committedDate": "2020-06-22T20:20:29Z", "type": "commit"}, {"oid": "d4bfe290fdfc2e895775575df91a33ef0414062a", "url": "https://github.com/triplea-game/triplea/commit/d4bfe290fdfc2e895775575df91a33ef0414062a", "message": "Re-comment in codeclimate token", "committedDate": "2020-06-22T20:27:08Z", "type": "commit"}]}