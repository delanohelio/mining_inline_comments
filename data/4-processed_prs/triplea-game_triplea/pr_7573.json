{"pr_number": 7573, "pr_title": "Single docker database", "pr_createdAt": "2020-09-08T03:14:40Z", "pr_url": "https://github.com/triplea-game/triplea/pull/7573", "timeline": [{"oid": "6fccc37a5384ae1ced5bb8d4d0d7a27d58ab7d77", "url": "https://github.com/triplea-game/triplea/commit/6fccc37a5384ae1ced5bb8d4d0d7a27d58ab7d77", "message": "Consolidate databases to same server\n\n- Instead of running two dockers, run just one docker with different schemas\n- This first update consolidates maps-db migrations to lobby-db", "committedDate": "2020-09-08T03:11:49Z", "type": "commit"}, {"oid": "fbec464f9784ccbda9ccd76b121c654333248ac9", "url": "https://github.com/triplea-game/triplea/commit/fbec464f9784ccbda9ccd76b121c654333248ac9", "message": "Rename subproject: 'lobby-db' to 'database'", "committedDate": "2020-09-08T03:12:11Z", "type": "commit"}, {"oid": "b804584117be55b3eb1c8666d3097efa45cdf4f1", "url": "https://github.com/triplea-game/triplea/commit/b804584117be55b3eb1c8666d3097efa45cdf4f1", "message": "Update database readme file", "committedDate": "2020-09-08T03:12:11Z", "type": "commit"}, {"oid": "615ea6b17b85340ad60bf6668083c409f4d8ec04", "url": "https://github.com/triplea-game/triplea/commit/615ea6b17b85340ad60bf6668083c409f4d8ec04", "message": "Update: infrastructure, Split apt_update and common package install", "committedDate": "2020-09-08T03:12:11Z", "type": "commit"}, {"oid": "78b8b78baf3c69986bf90b75f3d604524a1b6847", "url": "https://github.com/triplea-game/triplea/commit/78b8b78baf3c69986bf90b75f3d604524a1b6847", "message": "Simplify database/build.gradle flyway config", "committedDate": "2020-09-08T03:12:11Z", "type": "commit"}, {"oid": "2007f8b40a7b385b8cc69ef8d5247fd121b5b069", "url": "https://github.com/triplea-game/triplea/commit/2007f8b40a7b385b8cc69ef8d5247fd121b5b069", "message": "Update infrastructure deployment to deploy from a single migrations file (same database, two schema)", "committedDate": "2020-09-08T03:12:11Z", "type": "commit"}, {"oid": "b6f28afc164d15d07959db0cfb93f89ef1749a4e", "url": "https://github.com/triplea-game/triplea/commit/b6f28afc164d15d07959db0cfb93f89ef1749a4e", "message": "Update travis build to handle single database with both maps_db and lobby_db schema", "committedDate": "2020-09-08T03:12:11Z", "type": "commit"}, {"oid": "52af8f8fa7fc0fa506fa5a12779398cfd4af8cb1", "url": "https://github.com/triplea-game/triplea/commit/52af8f8fa7fc0fa506fa5a12779398cfd4af8cb1", "message": "Remove start-databases script now that we have just one and update docs", "committedDate": "2020-09-08T03:12:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDYyNzYzOA==", "url": "https://github.com/triplea-game/triplea/pull/7573#discussion_r484627638", "bodyText": "Double quote to prevent globbing and word splitting.", "author": "codeclimate", "createdAt": "2020-09-08T03:16:19Z", "path": "database/start_docker_db", "diffHunk": "@@ -0,0 +1,55 @@\n+#!/bin/bash\n+\n+set -eu\n+\n+bold=\"\\e[1m\"\n+bold_green=\"${bold}\\e[32m\"\n+normal=\"\\e[0m\"\n+\n+function main() {\n+  echo -e \"[${bold_green}STARTING DATABASE${normal}]\"\n+\n+  runDocker\n+  waitForDatabaseToStart\n+\n+  echo \"Deploying schema to lobby_db\"\n+  pwd\n+  \"$(dirname \"$0\")/../gradlew\" flywayMigrateAll\n+\n+  \"$(dirname \"$0\")\"/load_sample_data\n+  echo -e \"[${bold_green}DONE${normal}]\"\n+}\n+\n+function runDocker() {\n+  echo \"Stopping database..\"\n+  docker stop database || echo \"[OK] Database not running..\"\n+  docker run \\\n+    --rm  -d \\\n+    --name=\"database\" \\\n+    -p \"5432:5432\" \\\n+    -v \"$(pwd)/$(dirname $0)/sql/init/:/docker-entrypoint-initdb.d/\" \\", "originalCommit": "52af8f8fa7fc0fa506fa5a12779398cfd4af8cb1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "fc6d71260dbe403cfee07151eab9306d2a436991", "url": "https://github.com/triplea-game/triplea/commit/fc6d71260dbe403cfee07151eab9306d2a436991", "message": "Run formatting", "committedDate": "2020-09-08T03:27:41Z", "type": "commit"}, {"oid": "9b688dd21de6b6d03f84fb2d04dd07cb2b135065", "url": "https://github.com/triplea-game/triplea/commit/9b688dd21de6b6d03f84fb2d04dd07cb2b135065", "message": "Improve shell script quoting and MD file formatting.", "committedDate": "2020-09-08T03:29:57Z", "type": "commit"}, {"oid": "c6c58cd52af8cdfa6477d852ede2c491699a1cd8", "url": "https://github.com/triplea-game/triplea/commit/c6c58cd52af8cdfa6477d852ede2c491699a1cd8", "message": "Remove Dockerfile and build script, we can use a 100% vanilla postgres image", "committedDate": "2020-09-08T06:15:49Z", "type": "commit"}, {"oid": "252a95689b33ae1672c5e37379810a3ceda0b621", "url": "https://github.com/triplea-game/triplea/commit/252a95689b33ae1672c5e37379810a3ceda0b621", "message": "Simplify and update database documentation further", "committedDate": "2020-09-08T06:19:18Z", "type": "commit"}, {"oid": "4b19337281d6aa9e9b48560b86dfc6bf0819c77f", "url": "https://github.com/triplea-game/triplea/commit/4b19337281d6aa9e9b48560b86dfc6bf0819c77f", "message": "Set postgres docker version to 10 to match travis\n\nSetting the version to 10 requires passwords to be set,\nset the database user password to be 'postgres' for all users.", "committedDate": "2020-09-08T06:27:07Z", "type": "commit"}]}