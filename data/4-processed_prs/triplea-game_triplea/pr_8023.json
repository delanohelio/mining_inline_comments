{"pr_number": 8023, "pr_title": "Only skip giveUnitControl if the value is false or true", "pr_createdAt": "2020-10-31T17:56:39Z", "pr_url": "https://github.com/triplea-game/triplea/pull/8023", "timeline": [{"oid": "02ce8915f03453980a3ff58dbf8413a2c95154ae", "url": "https://github.com/triplea-game/triplea/commit/02ce8915f03453980a3ff58dbf8413a2c95154ae", "message": "Only skip giveUnitControl if the value is false or true", "committedDate": "2020-10-31T17:48:28Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTU2MDQ2NA==", "url": "https://github.com/triplea-game/triplea/pull/8023#discussion_r515560464", "bodyText": "Would you mind explaining why this if block is moved down @trevan ?\nIf we are going to ignore an option, why should we execute option.getValue() or option.getCount(), wouldn't those just be dead stores?", "author": "DanVanAtta", "createdAt": "2020-11-01T01:08:12Z", "path": "game-core/src/main/java/games/strategy/engine/data/gameparser/GameParser.java", "diffHunk": "@@ -895,16 +895,16 @@ private Attachable findAttachment(\n       }\n       // decapitalize the property name for backwards compatibility\n       final String name = LegacyPropertyMapper.mapLegacyOptionName(decapitalize(option.getName()));\n-      if (LegacyPropertyMapper.ignoreOptionName(name)) {", "originalCommit": "02ce8915f03453980a3ff58dbf8413a2c95154ae", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTU2MTYwMQ==", "url": "https://github.com/triplea-game/triplea/pull/8023#discussion_r515561601", "bodyText": "I moved it because I needed access to option.getValue() and I thought it would make more sense to use the local variable value that was going to be created vs passing in option.getValue().  But I can move it back up and pass in option.getValue().", "author": "trevan", "createdAt": "2020-11-01T01:23:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTU2MDQ2NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTU2MzU3OQ==", "url": "https://github.com/triplea-game/triplea/pull/8023#discussion_r515563579", "bodyText": "The local variable IMO is legacy, it's an unnecessary intermediate variable. This class in general followed a C++ pattern (if not older actually, maybe a C pattern or even Pascal) to declar all local variables at the beginning of a method. IMO all usages of 'value' probably should just get inlined.\nI did not spot you were using the value variable. That answers my question.", "author": "DanVanAtta", "createdAt": "2020-11-01T01:54:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTU2MDQ2NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTU2MDUwMQ==", "url": "https://github.com/triplea-game/triplea/pull/8023#discussion_r515560501", "bodyText": "Are you positive that value could never be null here? I don't remember if we translate empty values to empty strings or null values.", "author": "DanVanAtta", "createdAt": "2020-11-01T01:08:58Z", "path": "game-core/src/main/java/games/strategy/engine/data/gameparser/LegacyPropertyMapper.java", "diffHunk": "@@ -55,7 +55,9 @@ public String mapPropertyName(final String propertyName) {\n     return propertyName;\n   }\n \n-  static boolean ignoreOptionName(final String name) {\n-    return name.equalsIgnoreCase(\"takeUnitControl\") || name.equalsIgnoreCase(\"giveUnitControl\");\n+  static boolean ignoreOptionName(final String name, final String value) {\n+    return name.equalsIgnoreCase(\"takeUnitControl\")\n+        || (name.equalsIgnoreCase(\"giveUnitControl\")\n+            && (value.equals(\"false\") || value.equals(\"true\")));", "originalCommit": "02ce8915f03453980a3ff58dbf8413a2c95154ae", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTU2MTg2Nw==", "url": "https://github.com/triplea-game/triplea/pull/8023#discussion_r515561867", "bodyText": "value is never checked for null in the caller before using (see line 908 in GameParser) so I don't think it would ever be null.", "author": "trevan", "createdAt": "2020-11-01T01:26:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTU2MDUwMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTU2Mzc0Mg==", "url": "https://github.com/triplea-game/triplea/pull/8023#discussion_r515563742", "bodyText": "Considering we just had a NPE in GameParser, I would not presume it to be already correct. Another consideration, the 'value' is very context dependent, a DTD previously would have enforced values being provided, that is not necessarily guaranteed now.\nI wonder if there is any type of test coverage around this at all that could/should be updated.", "author": "DanVanAtta", "createdAt": "2020-11-01T01:56:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTU2MDUwMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTU2NDAyNg==", "url": "https://github.com/triplea-game/triplea/pull/8023#discussion_r515564026", "bodyText": "Hmm, I may be wrong about the DTD previously requiring a specific value, I'm not sure if it can constrain attribute values vs just requiring them being there. Regardless, it is context dependent if we can expect a value.", "author": "DanVanAtta", "createdAt": "2020-11-01T02:00:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTU2MDUwMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTU2NDE5NA==", "url": "https://github.com/triplea-game/triplea/pull/8023#discussion_r515564194", "bodyText": "Good point on the NPE.  It will now skip giveUnitControl if the value is null as well as true or false.\nThere is some test coverage but it requires creating a brand new xml with these attributes in it.  I'm looking at if there is a way to be able to create the xml in memory instead of committing the xml as a resource.", "author": "trevan", "createdAt": "2020-11-01T02:03:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTU2MDUwMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTU2NTA0OA==", "url": "https://github.com/triplea-game/triplea/pull/8023#discussion_r515565048", "bodyText": "If we can get away from XMLs for testing, that would be excellent.\nThe decoupling of XML parsing from the semantic data parsing into GameData was meant to help with this.\nOne should be able to set up a org.triplea.map.data.elements.Game object and then pass that to GameParser and avoid having to set up an XML. The former is well tested for a variety of XML snippets, so we can be pretty sure how that works. It should have some existing tests that might be interesting to know if we null out empty values. Beyond that, sending GameParser a defined Game object hopefully can do the trick. GameParser is still very rough, so it might take some plumbing work to accept a Game object here. Let me know if that turns out to be the case, for now a manual verification is enough or you can go the extra mile if you feel it's worthwhile given the context acquisition cost you will have payed.", "author": "DanVanAtta", "createdAt": "2020-11-01T02:15:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTU2MDUwMQ=="}], "type": "inlineReview"}, {"oid": "5ca0fbfc85874a93cfa1fc8dd73df934fae1a41f", "url": "https://github.com/triplea-game/triplea/commit/5ca0fbfc85874a93cfa1fc8dd73df934fae1a41f", "message": "Ignore giveUnitControl if its value is null", "committedDate": "2020-11-01T02:01:26Z", "type": "commit"}]}