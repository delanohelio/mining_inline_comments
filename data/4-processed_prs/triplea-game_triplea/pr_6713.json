{"pr_number": 6713, "pr_title": "Compute loop constant once", "pr_createdAt": "2020-06-18T05:22:21Z", "pr_url": "https://github.com/triplea-game/triplea/pull/6713", "timeline": [{"oid": "559c0eb4c4c7a14bb5e540e1d70b74147744af71", "url": "https://github.com/triplea-game/triplea/commit/559c0eb4c4c7a14bb5e540e1d70b74147744af71", "message": "Compute loop constant once\n\nSmall change to a for loop to compute the terminal condition just once.\n'getHitPoints' is a call to attachments which does casting, it is not\na constant value (so its better to compute it once rather than on each\nloop iteration).", "committedDate": "2020-06-18T05:20:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjAzNzY3MA==", "url": "https://github.com/triplea-game/triplea/pull/6713#discussion_r442037670", "bodyText": "Actually I think it would be better to just move initialisation and deklaration out of the loop, up one line", "author": "RoiEXLab", "createdAt": "2020-06-18T07:55:54Z", "path": "game-core/src/main/java/games/strategy/triplea/ui/UnitChooser.java", "diffHunk": "@@ -418,7 +418,9 @@ void disableMax() {\n       defaultHits = new ArrayList<>(Math.max(1, category.getHitPoints() - category.getDamaged()));\n       final int numUnits = category.getUnits().size();\n       int hitsUsedSoFar = 0;\n-      for (int i = 0; i < Math.max(1, category.getHitPoints() - category.getDamaged()); i++) {\n+      for (int i = 0, m = Math.max(1, category.getHitPoints() - category.getDamaged());\n+          i < m;\n+          i++) {", "originalCommit": "559c0eb4c4c7a14bb5e540e1d70b74147744af71", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI0MjA0Mw==", "url": "https://github.com/triplea-game/triplea/pull/6713#discussion_r443242043", "bodyText": "IE, convert the for loop to a while loop?", "author": "DanVanAtta", "createdAt": "2020-06-21T17:55:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjAzNzY3MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI0MjMyMQ==", "url": "https://github.com/triplea-game/triplea/pull/6713#discussion_r443242321", "bodyText": "Not really, just the constant variable 'm'", "author": "RoiEXLab", "createdAt": "2020-06-21T17:59:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjAzNzY3MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI0MzcyOA==", "url": "https://github.com/triplea-game/triplea/pull/6713#discussion_r443243728", "bodyText": "That has a problem where the m gets increased scoping compared to what's needed.\nFWIW, computing loop termination conditions like this used to be quite idiomatic. PMD used to recommend it. This performance improvement I think just became less common with Java 1.5 and for-each loops as there are usually better ways to iterate and iterating with a non-constant loop condition is less common.", "author": "DanVanAtta", "createdAt": "2020-06-21T18:17:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjAzNzY3MA=="}], "type": "inlineReview"}]}