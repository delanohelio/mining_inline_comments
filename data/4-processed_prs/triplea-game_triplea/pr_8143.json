{"pr_number": 8143, "pr_title": "Unify non-lowluck dice hit calculations", "pr_createdAt": "2020-11-10T03:29:47Z", "pr_url": "https://github.com/triplea-game/triplea/pull/8143", "timeline": [{"oid": "832c23b75b3c79e59854d1ed20a9c7c08bdfd87d", "url": "https://github.com/triplea-game/triplea/commit/832c23b75b3c79e59854d1ed20a9c7c08bdfd87d", "message": "Unify non-lowluck dice hit calculations\n\nAdd getDiceHits to the TotalPowerAndTotalRolls interface. Given an array\nof integers (random dice rolls), it will return a list of Die with the\nrolled number and whether it was a hit or not.", "committedDate": "2020-11-10T03:15:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDI2Mzg0OA==", "url": "https://github.com/triplea-game/triplea/pull/8143#discussion_r520263848", "bodyText": "This fixes a bug I introduced when I refactored this code.  I now have better tests around this.  This bug is in the pre-release so I didn't add any release notes for it.", "author": "trevan", "createdAt": "2020-11-10T03:30:34Z", "path": "game-core/src/main/java/games/strategy/triplea/delegate/power/calculator/AaPowerStrengthAndRolls.java", "diffHunk": "@@ -267,14 +268,15 @@ private void addUnits(final Collection<Unit> units) {\n         .flatMap(\n             unitPowerStrengthAndRolls -> {\n               final int strength = unitPowerStrengthAndRolls.getStrength();\n-              final int diceValue = diceQueue.removeFirst();\n               return IntStream.range(0, unitPowerStrengthAndRolls.getRolls())\n                   .mapToObj(\n-                      rollNumber ->\n-                          new Die(\n-                              diceValue,\n-                              strength,\n-                              diceValue < strength ? Die.DieType.HIT : Die.DieType.MISS));\n+                      rollNumber -> {\n+                        final int diceValue = diceQueue.removeFirst();", "originalCommit": "832c23b75b3c79e59854d1ed20a9c7c08bdfd87d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDI2NDA5Mg==", "url": "https://github.com/triplea-game/triplea/pull/8143#discussion_r520264092", "bodyText": "The previous code always made the first dice roll be the \"HIT\" roll and the other be \"IGNORED\".  The new code now keeps the dice rolls in order so this test had to be updated.", "author": "trevan", "createdAt": "2020-11-10T03:31:36Z", "path": "game-core/src/test/java/games/strategy/triplea/delegate/DiceRollTest.java", "diffHunk": "@@ -1010,8 +1010,8 @@ void testHeavyBombersLhtr2() {\n                 .gameDiceSides(testDelegateBridge.getData().getDiceSides())\n                 .territoryEffects(TerritoryEffectHelper.getEffects(germany))\n                 .build());\n-    assertThat(dice.getRolls(4).get(0).getType(), is(Die.DieType.HIT));\n-    assertThat(dice.getRolls(4).get(1).getType(), is(Die.DieType.IGNORED));\n+    assertThat(dice.getRolls(4).get(0).getType(), is(Die.DieType.IGNORED));", "originalCommit": "832c23b75b3c79e59854d1ed20a9c7c08bdfd87d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}