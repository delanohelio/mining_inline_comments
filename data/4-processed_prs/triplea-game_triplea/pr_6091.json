{"pr_number": 6091, "pr_title": "Inline server side factory objects", "pr_createdAt": "2020-03-26T03:34:58Z", "pr_url": "https://github.com/triplea-game/triplea/pull/6091", "timeline": [{"oid": "db2f5067f885453c39ea6da20b938e8f047bea7d", "url": "https://github.com/triplea-game/triplea/commit/db2f5067f885453c39ea6da20b938e8f047bea7d", "message": "Inline server side factory objects\n\nRefactor of http-server objects and how they are built.\n\nTo simplify and hide dependencies, delete single method factory classes\nand move factory methods to the class that is being built. Second, avoid\nbuilding nested dependencies and add a factory build method to dependencies.", "committedDate": "2020-03-26T03:29:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODI5OTUyNw==", "url": "https://github.com/triplea-game/triplea/pull/6091#discussion_r398299527", "bodyText": "Similar blocks of code found in 2 locations. Consider refactoring.", "author": "codeclimate", "createdAt": "2020-03-26T03:36:30Z", "path": "http-server/src/main/java/org/triplea/modules/error/reporting/ErrorReportController.java", "diffHunk": "@@ -11,17 +12,38 @@\n import javax.ws.rs.Path;\n import javax.ws.rs.core.Context;\n import lombok.Builder;\n+import org.jdbi.v3.core.Jdbi;\n+import org.triplea.http.AppConfig;\n import org.triplea.http.HttpController;\n import org.triplea.http.client.error.report.ErrorReportClient;\n import org.triplea.http.client.error.report.ErrorReportRequest;\n import org.triplea.http.client.error.report.ErrorReportResponse;\n+import org.triplea.http.client.github.issues.GithubIssueClient;\n \n /** Http controller that binds the error upload endpoint with the error report upload handler. */\n @Builder\n public class ErrorReportController extends HttpController {\n   @Nonnull\n   private final BiFunction<String, ErrorReportRequest, ErrorReportResponse> errorReportIngestion;\n \n+  public static ErrorReportController build(final AppConfig configuration, final Jdbi jdbi) {", "originalCommit": "db2f5067f885453c39ea6da20b938e8f047bea7d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY5MDYwOQ==", "url": "https://github.com/triplea-game/triplea/pull/6091#discussion_r399690609", "bodyText": "Its not clear to me if the variable type changed here? Should the var name be updated to chatMessagingService?", "author": "ron-murhammer", "createdAt": "2020-03-28T17:56:28Z", "path": "http-server/src/main/java/org/triplea/http/ServerApplication.java", "diffHunk": "@@ -165,7 +160,7 @@ public void run(final AppConfig configuration, final Environment environment) {\n         .getUserProperties()\n         .put(PlayerConnectionWebSocket.GAME_LISTING_QUEUE_KEY, gameListingEventQueue);\n \n-    final var messagingService = MessagingServiceFactory.build(jdbi, chatSessions, chatters);\n+    final var messagingService = ChatMessagingService.build(jdbi, chatSessions, chatters);", "originalCommit": "db2f5067f885453c39ea6da20b938e8f047bea7d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY5MjI0Nw==", "url": "https://github.com/triplea-game/triplea/pull/6091#discussion_r399692247", "bodyText": "It's not a super critical update as ChatMessagingService is still a 'messagingService'. MessagingServiceFactory was renamed as it was too generic, it really was 'chat' messages, and not things like network communication, internal events, queues, etc..\nLet's keep an eye on this for the branch in #6096, updating this here would conflict with that, that is my only hesitation to not update it now.\nThe main thrust of this PR is that we are going from factory classes, to a factory method.", "author": "DanVanAtta", "createdAt": "2020-03-28T18:13:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY5MDYwOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY5MDg5OQ==", "url": "https://github.com/triplea-game/triplea/pull/6091#discussion_r399690899", "bodyText": "Can you clarify what this block is for?", "author": "ron-murhammer", "createdAt": "2020-03-28T17:58:54Z", "path": "http-server/src/main/java/org/triplea/modules/error/reporting/ErrorReportController.java", "diffHunk": "@@ -11,17 +12,38 @@\n import javax.ws.rs.Path;\n import javax.ws.rs.core.Context;\n import lombok.Builder;\n+import org.jdbi.v3.core.Jdbi;\n+import org.triplea.http.AppConfig;\n import org.triplea.http.HttpController;\n import org.triplea.http.client.error.report.ErrorReportClient;\n import org.triplea.http.client.error.report.ErrorReportRequest;\n import org.triplea.http.client.error.report.ErrorReportResponse;\n+import org.triplea.http.client.github.issues.GithubIssueClient;\n \n /** Http controller that binds the error upload endpoint with the error report upload handler. */\n @Builder\n public class ErrorReportController extends HttpController {\n   @Nonnull\n   private final BiFunction<String, ErrorReportRequest, ErrorReportResponse> errorReportIngestion;\n \n+  public static ErrorReportController build(final AppConfig configuration, final Jdbi jdbi) {\n+    final GithubIssueClient githubIssueClient =\n+        GithubIssueClient.builder()\n+            .uri(AppConfig.GITHUB_WEB_SERVICE_API_URL)\n+            .authToken(configuration.getGithubApiToken())\n+            .githubOrg(AppConfig.GITHUB_ORG)\n+            .githubRepo(configuration.getGithubRepo())\n+            .build();\n+\n+    if (githubIssueClient.isTest()) {", "originalCommit": "db2f5067f885453c39ea6da20b938e8f047bea7d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY5MzQ3MA==", "url": "https://github.com/triplea-game/triplea/pull/6091#discussion_r399693470", "bodyText": "It is moved code. I can't find where @RoiEXLab had a similar question, that answer would have been useful here.\nIn short it's a validation check of configuration to ensure we do not have an 'issue client' set to a 'test' mode with a prod configuration set.\nThe isTest check is defined as:\n  public boolean isTest() {\n    return authToken.equalsIgnoreCase(\"test\");\n  }\n\nIn short we get a stubbing behavior when the authtoken used by the server to create github issues is set to 'test'.", "author": "DanVanAtta", "createdAt": "2020-03-28T18:24:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY5MDg5OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY5MTAzNw==", "url": "https://github.com/triplea-game/triplea/pull/6091#discussion_r399691037", "bodyText": "Is the // for formatting reasons?", "author": "ron-murhammer", "createdAt": "2020-03-28T18:00:06Z", "path": "http-server/src/main/java/org/triplea/modules/game/ConnectivityController.java", "diffHunk": "@@ -26,6 +26,12 @@\n public class ConnectivityController extends HttpController {\n   @Nonnull private final Predicate<InetSocketAddress> connectivityCheck;\n \n+  public static ConnectivityController build() {\n+    return ConnectivityController.builder() //", "originalCommit": "db2f5067f885453c39ea6da20b938e8f047bea7d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY5MzUwMQ==", "url": "https://github.com/triplea-game/triplea/pull/6091#discussion_r399693501", "bodyText": "Indeed", "author": "DanVanAtta", "createdAt": "2020-03-28T18:25:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY5MTAzNw=="}], "type": "inlineReview"}]}