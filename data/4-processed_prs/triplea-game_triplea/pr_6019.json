{"pr_number": 6019, "pr_title": "Avoid using JFileChooser in preference for FileDialog", "pr_createdAt": "2020-03-07T22:16:24Z", "pr_url": "https://github.com/triplea-game/triplea/pull/6019", "timeline": [{"oid": "fab8031ec87164e5ce209dbc8cfa6249724f1952", "url": "https://github.com/triplea-game/triplea/commit/fab8031ec87164e5ce209dbc8cfa6249724f1952", "message": "Avoid using JFileChooser in preference for FileDialog\n\nFileDialog uses a native native file chooser. This has some benefits:\n- looks better\n- less error prone, removing the option to type a file name means a user\n  can't specify a file that does not exist\n- removes OS specific code meaning we can test this code once and not\n  N times per OS.\n- Using native file chooser dialog aligns with JavaFX, in essence\n  it's a modernizing approach to avoid JFileChooser", "committedDate": "2020-03-07T22:14:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTMxNjk0Mw==", "url": "https://github.com/triplea-game/triplea/pull/6019#discussion_r389316943", "bodyText": "Hmm I think we should have that warning on all systems", "author": "RoiEXLab", "createdAt": "2020-03-07T22:30:15Z", "path": "game-core/src/main/java/games/strategy/triplea/ui/menubar/TripleAMenuBar.java", "diffHunk": "@@ -60,60 +56,19 @@ private void createLobbyMenu(final InGameLobbyWatcherWrapper watcher) {\n    *     cancelled the operation.\n    */\n   public static File getSaveGameLocation(final Frame frame) {\n-    // For some strange reason, the only way to get a Mac OS X native-style file dialog\n-    // is to use an AWT FileDialog instead of a Swing JDialog\n-    if (SystemProperties.isMac()) {\n-      final FileDialog fileDialog = new FileDialog(frame);\n-      fileDialog.setMode(FileDialog.SAVE);\n-      fileDialog.setDirectory(ClientSetting.saveGamesFolderPath.getValueOrThrow().toString());\n-      fileDialog.setFilenameFilter((dir, name) -> GameDataFileUtils.isCandidateFileName(name));\n-      fileDialog.setVisible(true);\n+    final FileDialog fileDialog = new FileDialog(frame);\n+    fileDialog.setMode(FileDialog.SAVE);\n+    fileDialog.setDirectory(ClientSetting.saveGamesFolderPath.getValueOrThrow().toString());\n+    fileDialog.setFilenameFilter((dir, name) -> GameDataFileUtils.isCandidateFileName(name));\n+    fileDialog.setVisible(true);\n \n-      final String fileName = fileDialog.getFile();\n-      if (fileName == null) {\n-        return null;\n-      }\n-\n-      // If the user selects a filename that already exists,\n-      // the AWT Dialog on Mac OS X will ask the user for confirmation\n-      return new File(fileDialog.getDirectory(), GameDataFileUtils.addExtensionIfAbsent(fileName));\n-    }\n-\n-    // Non-Mac platforms should use the normal Swing JFileChooser\n-    final JFileChooser fileChooser = SaveGameFileChooser.getInstance();\n-    final int selectedOption = fileChooser.showSaveDialog(frame);\n-    if (selectedOption != JFileChooser.APPROVE_OPTION) {\n+    final String fileName = fileDialog.getFile();\n+    if (fileName == null) {\n       return null;\n     }\n-    File f = fileChooser.getSelectedFile();\n-    // disallow sub directories to be entered (in the form directory/name) for Windows boxes\n-    if (SystemProperties.isWindows()) {\n-      final int slashIndex = Math.min(f.getPath().lastIndexOf(\"\\\\\"), f.getPath().length());\n-      final String filePath = f.getPath().substring(0, slashIndex);\n-      if (!fileChooser.getCurrentDirectory().toString().equals(filePath)) {\n-        JOptionPane.showConfirmDialog(\n-            frame,\n-            \"Sub directories are not allowed in the file name.  Please rename it.\",\n-            \"Cancel?\",\n-            JOptionPane.DEFAULT_OPTION,\n-            JOptionPane.WARNING_MESSAGE);\n-        return null;\n-      }\n-    }\n-    f = new File(f.getParent(), GameDataFileUtils.addExtensionIfAbsent(f.getName()));\n-    // A small warning so users will not over-write a file\n-    if (f.exists()) {", "originalCommit": "fab8031ec87164e5ce209dbc8cfa6249724f1952", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTMxNzczMA==", "url": "https://github.com/triplea-game/triplea/pull/6019#discussion_r389317730", "bodyText": "It is at least for sure on linux, it seems to be an OS default baked in already \ud83d\udc4d", "author": "DanVanAtta", "createdAt": "2020-03-07T22:44:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTMxNjk0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTMxODMzOQ==", "url": "https://github.com/triplea-game/triplea/pull/6019#discussion_r389318339", "bodyText": "Good to know, just double checked if this is the case on windows as well and it is \ud83d\udc4d", "author": "RoiEXLab", "createdAt": "2020-03-07T22:55:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTMxNjk0Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTMxNzAyMg==", "url": "https://github.com/triplea-game/triplea/pull/6019#discussion_r389317022", "bodyText": "Ok, this is a super weird thing I have never seen before.", "author": "RoiEXLab", "createdAt": "2020-03-07T22:31:25Z", "path": "game-core/src/main/java/games/strategy/triplea/ui/menubar/TripleAMenuBar.java", "diffHunk": "@@ -60,60 +56,19 @@ private void createLobbyMenu(final InGameLobbyWatcherWrapper watcher) {\n    *     cancelled the operation.\n    */\n   public static File getSaveGameLocation(final Frame frame) {\n-    // For some strange reason, the only way to get a Mac OS X native-style file dialog\n-    // is to use an AWT FileDialog instead of a Swing JDialog\n-    if (SystemProperties.isMac()) {\n-      final FileDialog fileDialog = new FileDialog(frame);\n-      fileDialog.setMode(FileDialog.SAVE);\n-      fileDialog.setDirectory(ClientSetting.saveGamesFolderPath.getValueOrThrow().toString());\n-      fileDialog.setFilenameFilter((dir, name) -> GameDataFileUtils.isCandidateFileName(name));\n-      fileDialog.setVisible(true);\n+    final FileDialog fileDialog = new FileDialog(frame);\n+    fileDialog.setMode(FileDialog.SAVE);\n+    fileDialog.setDirectory(ClientSetting.saveGamesFolderPath.getValueOrThrow().toString());\n+    fileDialog.setFilenameFilter((dir, name) -> GameDataFileUtils.isCandidateFileName(name));\n+    fileDialog.setVisible(true);\n \n-      final String fileName = fileDialog.getFile();\n-      if (fileName == null) {\n-        return null;\n-      }\n-\n-      // If the user selects a filename that already exists,\n-      // the AWT Dialog on Mac OS X will ask the user for confirmation\n-      return new File(fileDialog.getDirectory(), GameDataFileUtils.addExtensionIfAbsent(fileName));\n-    }\n-\n-    // Non-Mac platforms should use the normal Swing JFileChooser\n-    final JFileChooser fileChooser = SaveGameFileChooser.getInstance();\n-    final int selectedOption = fileChooser.showSaveDialog(frame);\n-    if (selectedOption != JFileChooser.APPROVE_OPTION) {\n+    final String fileName = fileDialog.getFile();\n+    if (fileName == null) {\n       return null;\n     }\n-    File f = fileChooser.getSelectedFile();\n-    // disallow sub directories to be entered (in the form directory/name) for Windows boxes", "originalCommit": "fab8031ec87164e5ce209dbc8cfa6249724f1952", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTMxNzcxMg==", "url": "https://github.com/triplea-game/triplea/pull/6019#discussion_r389317712", "bodyText": "Always quite a bit of 'interesting' code to find here and there  \ud83d\ude01", "author": "DanVanAtta", "createdAt": "2020-03-07T22:43:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTMxNzAyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTMxODM4Nw==", "url": "https://github.com/triplea-game/triplea/pull/6019#discussion_r389318387", "bodyText": "I mean at this point I shouldn't really be surprised anymore, but it happens again and again ^^", "author": "RoiEXLab", "createdAt": "2020-03-07T22:56:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTMxNzAyMg=="}], "type": "inlineReview"}]}