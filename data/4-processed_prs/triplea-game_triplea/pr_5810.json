{"pr_number": 5810, "pr_title": "Fix quit dialog not appearing on Mac when dismissed.", "pr_createdAt": "2020-01-01T16:45:07Z", "pr_url": "https://github.com/triplea-game/triplea/pull/5810", "timeline": [{"oid": "4a2e458fb94e7cd16d1044d902bf755e34bfa7fb", "url": "https://github.com/triplea-game/triplea/commit/4a2e458fb94e7cd16d1044d902bf755e34bfa7fb", "message": "Fix quit dialog not appearing on Mac when dismissed.", "committedDate": "2020-01-01T16:43:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjMzMzI5OQ==", "url": "https://github.com/triplea-game/triplea/pull/5810#discussion_r362333299", "bodyText": "Now that shutdown returns a boolean, shouldn't this change be unecessary?", "author": "RoiEXLab", "createdAt": "2020-01-01T17:03:42Z", "path": "game-core/src/main/java/games/strategy/triplea/ui/menubar/FileMenu.java", "diffHunk": "@@ -112,7 +112,7 @@ private void addExitMenu() {\n     // Mac OS X automatically creates a Quit menu item under the TripleA menu,\n     // so all we need to do is register that menu item with triplea's shutdown mechanism\n     if (isMac) {\n-      MacOsIntegration.setQuitHandler(frame::shutdown);\n+      MacOsIntegration.setQuitHandler(() -> frame.shutdown());", "originalCommit": "4a2e458fb94e7cd16d1044d902bf755e34bfa7fb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjM0MjU4NQ==", "url": "https://github.com/triplea-game/triplea/pull/5810#discussion_r362342585", "bodyText": "I thought so too, but seems not. frame::shutdown returns a function pointer which does not get converted to a BooleanSupplier implicitly. (But the inline function does.)", "author": "asvitkine", "createdAt": "2020-01-01T20:59:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjMzMzI5OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjMzMzQyNw==", "url": "https://github.com/triplea-game/triplea/pull/5810#discussion_r362333427", "bodyText": "Hmm Methods returning the same objects regardless of execution path seem weird to me.\nI'd actually move this true statement up one level and keep this method returning void, or alternatively have both frames implement an QuitHandler interface for consistency or something that will then be used.", "author": "RoiEXLab", "createdAt": "2020-01-01T17:06:35Z", "path": "game-core/src/main/java/games/strategy/engine/lobby/client/ui/LobbyFrame.java", "diffHunk": "@@ -140,5 +140,6 @@ public void shutdown() {\n               GameRunner.exitGameIfFinished();\n             })\n         .start();\n+    return true;", "originalCommit": "4a2e458fb94e7cd16d1044d902bf755e34bfa7fb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjM0MjY0Mg==", "url": "https://github.com/triplea-game/triplea/pull/5810#discussion_r362342642", "bodyText": "Implementing QuitHandler sounds interesting, I can take a look at doing it.", "author": "asvitkine", "createdAt": "2020-01-01T21:00:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjMzMzQyNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjM1MTE1Nw==", "url": "https://github.com/triplea-game/triplea/pull/5810#discussion_r362351157", "bodyText": "I gave it a shot (didn't update the PR) and I'm not convinced it ends up cleaner.\nAt least, for TripleAFrame, if we implement the interface, then the non-Mac code that needs to attach the action to a JMenuItem would need to call it, which ends up looking like:\n  public void shutdown() {\n\thandleQuitRequestWith(null, new QuitResponse() {\n\t\t@Override\n\t\tvoid cancelQuit() {\n\t\t}\n\t\t@Override\n\t\tvoid performQuit() {\n\t\t}\n\t});\n  }\n\nWhich is messy. Or we make handleQuitRequestWith() call shutdown(), but then shutdown() needs to return a boolean as now.\nSo it doesn't end up cleaning that my current code. I could make LobbyFrame's shutdown() not return a boolean and handle it in the caller, but then it would be inconsistent.\nI guess we could keep the version of setQuitHandler() that takes a Runnable (keep both signatures), and then LobbyFrame.shutdown() could be reverted to return void, while TripleAFrame would keep the code as-is.\nWhat do you prefer @RoiEXLab ?", "author": "asvitkine", "createdAt": "2020-01-02T00:07:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjMzMzQyNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjM1MjI4Ng==", "url": "https://github.com/triplea-game/triplea/pull/5810#discussion_r362352286", "bodyText": "Oh, that's not what I meant.\nI was thinking about creating an interface like this\ninterface QuitHandler {\n  boolean shutdown();\n}\nwhich is then being implemented by both frames and instead of BooleanSupplier you pass the object directly", "author": "RoiEXLab", "createdAt": "2020-01-02T00:32:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjMzMzQyNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjk5NjgzOQ==", "url": "https://github.com/triplea-game/triplea/pull/5810#discussion_r362996839", "bodyText": "Ah, I see. Done.", "author": "asvitkine", "createdAt": "2020-01-03T23:51:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjMzMzQyNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjMzMzYzMA==", "url": "https://github.com/triplea-game/triplea/pull/5810#discussion_r362333630", "bodyText": "This reminds me of #5283\nAny chance if we're using the files handler the wrong way?\n#5253", "author": "RoiEXLab", "createdAt": "2020-01-01T17:11:18Z", "path": "game-core/src/main/java/games/strategy/triplea/ui/MacOsIntegration.java", "diffHunk": "@@ -40,8 +41,16 @@ public static void setOpenFileHandler(final Consumer<File> handler) {\n   }\n \n   /** Sets the specified quit handler to the application. */\n-  public static void setQuitHandler(final Runnable handler) {\n+  public static void setQuitHandler(final BooleanSupplier handler) {\n     checkNotNull(handler);\n-    Desktop.getDesktop().setQuitHandler((quitEvent, quitResponse) -> handler.run());\n+    Desktop.getDesktop()\n+        .setQuitHandler(\n+            (quitEvent, quitResponse) -> {\n+              if (handler.getAsBoolean()) {\n+                quitResponse.performQuit();\n+              } else {\n+                quitResponse.cancelQuit();\n+              }\n+            });", "originalCommit": "4a2e458fb94e7cd16d1044d902bf755e34bfa7fb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e495881c75d7d6c935579989a0bb815c8e1a6529", "url": "https://github.com/triplea-game/triplea/commit/e495881c75d7d6c935579989a0bb815c8e1a6529", "message": "Add an interface", "committedDate": "2020-01-03T23:55:23Z", "type": "commit"}]}