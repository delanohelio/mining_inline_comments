{"pr_number": 286, "pr_title": "Update FlagDb & Task Deserializer to filter out synthetic point tags", "pr_createdAt": "2020-04-23T16:05:52Z", "pr_url": "https://github.com/osmlab/atlas-checks/pull/286", "timeline": [{"oid": "5e3c87d2c327d87b3ef1f3bd308a44ef31dd75d7", "url": "https://github.com/osmlab/atlas-checks/commit/5e3c87d2c327d87b3ef1f3bd308a44ef31dd75d7", "message": "filter points", "committedDate": "2020-04-23T06:05:52Z", "type": "commit"}, {"oid": "79a77f815624e76af017b1fc2d627c3e85753068", "url": "https://github.com/osmlab/atlas-checks/commit/79a77f815624e76af017b1fc2d627c3e85753068", "message": "status", "committedDate": "2020-04-23T06:07:08Z", "type": "commit"}, {"oid": "1389072c3eb8b6fd0325080ba73b90f7cd3eda5f", "url": "https://github.com/osmlab/atlas-checks/commit/1389072c3eb8b6fd0325080ba73b90f7cd3eda5f", "message": "add docs", "committedDate": "2020-04-23T06:11:40Z", "type": "commit"}, {"oid": "2af258aea142793ed48ec3bb56aff74ce16fc25f", "url": "https://github.com/osmlab/atlas-checks/commit/2af258aea142793ed48ec3bb56aff74ce16fc25f", "message": "deserialize id", "committedDate": "2020-05-11T22:39:03Z", "type": "commit"}, {"oid": "42b433fdb08ee377c3f54201b93c70b6df8ab468", "url": "https://github.com/osmlab/atlas-checks/commit/42b433fdb08ee377c3f54201b93c70b6df8ab468", "message": "clean up", "committedDate": "2020-05-11T23:02:54Z", "type": "commit"}, {"oid": "231b4bf7fe946e071d14abfc6504b4572ce5abe5", "url": "https://github.com/osmlab/atlas-checks/commit/231b4bf7fe946e071d14abfc6504b4572ce5abe5", "message": "add resource", "committedDate": "2020-05-11T23:12:47Z", "type": "commit"}, {"oid": "c03eba7576b63c2c1cb09e5deba15dd87b5a508c", "url": "https://github.com/osmlab/atlas-checks/commit/c03eba7576b63c2c1cb09e5deba15dd87b5a508c", "message": "Merge branch 'dev' into filter_synthetic_point", "committedDate": "2020-05-11T23:20:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDAxOTUzMQ==", "url": "https://github.com/osmlab/atlas-checks/pull/286#discussion_r424019531", "bodyText": "The unique identifiers are unsorted so in this case it would be a good idea to call .sorted() on the stream before collecting it.", "author": "Bentleysb", "createdAt": "2020-05-12T20:40:05Z", "path": "src/main/java/org/openstreetmap/atlas/checks/database/FlagDatabaseSubCommand.java", "diffHunk": "@@ -239,7 +240,8 @@ public void executeFlagStatement(final PreparedStatement sql, final CheckFlag fl\n     {\n         try\n         {\n-            sql.setString(1, flag.getIdentifier());\n+            sql.setString(1, flag.getUniqueIdentifiers().stream().map(String::toString)\n+                    .collect(Collectors.joining(\",\")));", "originalCommit": "c03eba7576b63c2c1cb09e5deba15dd87b5a508c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDAxOTg0NA==", "url": "https://github.com/osmlab/atlas-checks/pull/286#discussion_r424019844", "bodyText": "Same thing about .sorted().", "author": "Bentleysb", "createdAt": "2020-05-12T20:40:43Z", "path": "src/main/java/org/openstreetmap/atlas/checks/flag/serializer/CheckFlagDeserializer.java", "diffHunk": "@@ -34,11 +39,27 @@ public CheckFlag deserialize(final JsonElement json, final Type typeOfT,\n         final JsonObject properties = full.get(PROPERTIES).getAsJsonObject();\n         final String checkName = properties.get(GENERATOR).getAsString();\n         final String instruction = properties.get(INSTRUCTIONS).getAsString();\n-        final String flagIdentifier = properties.get(ID).getAsString();\n+        final String flagIdentifier = properties.get(IDENTIFIERS) == null\n+                ? properties.get(ID).getAsString()\n+                // Convert array of ids into comma delimited string\n+                : this.parseIdentifiers((JsonArray) properties.get(IDENTIFIERS));\n         final CheckFlag flag = new CheckFlag(flagIdentifier);\n         flag.addInstruction(instruction);\n         flag.setChallengeName(checkName);\n \n         return flag;\n     }\n+\n+    /**\n+     * Returns a comma delimited string of identifiers.\n+     * \n+     * @param identifiers\n+     *            - array of flag identifiers\n+     * @return - comma delimited string\n+     */\n+    private String parseIdentifiers(final JsonArray identifiers)\n+    {\n+        return Arrays.asList(new Gson().fromJson(identifiers, String[].class)).stream()\n+                .map(String::toString).collect(Collectors.joining(\",\"));", "originalCommit": "c03eba7576b63c2c1cb09e5deba15dd87b5a508c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjg2NTcxNg==", "url": "https://github.com/osmlab/atlas-checks/pull/286#discussion_r426865716", "bodyText": "This should be fixed now", "author": "danielduhh", "createdAt": "2020-05-18T20:07:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDAxOTg0NA=="}], "type": "inlineReview"}, {"oid": "f1dccbc205f5d188a97121fe4192ebb890ab5f62", "url": "https://github.com/osmlab/atlas-checks/commit/f1dccbc205f5d188a97121fe4192ebb890ab5f62", "message": "clean up conditional and test", "committedDate": "2020-05-18T19:59:55Z", "type": "commit"}, {"oid": "dd014f1b5f2308daf3dba38542f61118ab1e63bf", "url": "https://github.com/osmlab/atlas-checks/commit/dd014f1b5f2308daf3dba38542f61118ab1e63bf", "message": "Merge branch 'filter_synthetic_point' of https://github.com/danielduhh/atlas-checks into filter_synthetic_point", "committedDate": "2020-05-18T20:00:41Z", "type": "commit"}]}