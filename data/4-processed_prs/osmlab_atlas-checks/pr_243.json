{"pr_number": 243, "pr_title": "Snake road check bug", "pr_createdAt": "2020-01-16T19:05:07Z", "pr_url": "https://github.com/osmlab/atlas-checks/pull/243", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTUzNTczNA==", "url": "https://github.com/osmlab/atlas-checks/pull/243#discussion_r371535734", "bodyText": "Isn't this change performing the same operation as before? For all connections, checkIfEdgeHeadingDifferenceExceedsThreshold(comingFrom, comingTo); was called from walk.visitedEdge previously, and now it is called here. Was this to improve performance or is there something I am missing?", "author": "sayas01", "createdAt": "2020-01-27T23:15:21Z", "path": "src/main/java/org/openstreetmap/atlas/checks/validation/linear/edges/SnakeRoadCheck.java", "diffHunk": "@@ -160,6 +161,10 @@ private boolean networkWalkQualifiesAsSnakeRoad(final SnakeRoadNetworkWalk walk)\n      */\n     private void walkNetwork(final Edge current, final SnakeRoadNetworkWalk walk)\n     {\n+        final Set<Edge> directConnections = walk.getConnectedMasterEdgeOfTheSameWay(current);\n+        directConnections.stream().forEach(connection -> walk", "originalCommit": "8a307566b67a885de04b85840d7903a2fb6725c1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTU1NjM0OQ==", "url": "https://github.com/osmlab/atlas-checks/pull/243#discussion_r371556349", "bodyText": "The difference is before it used to call checkIfEdgeHeadingDifferenceExceedsThreshold() from visitedEdge() for all the edges not just directly connected edges to a current edge. My code will make sure that it will check the heading difference of two directly connected edges to a current edge.", "author": "smaheshwaram", "createdAt": "2020-01-28T00:26:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTUzNTczNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTU1ODY1NA==", "url": "https://github.com/osmlab/atlas-checks/pull/243#discussion_r371558654", "bodyText": "ahh I think the names got me confused.. directConnections and walk.getDirectConnections() are different but I read it as same.", "author": "sayas01", "createdAt": "2020-01-28T00:35:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTUzNTczNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTk4MTM4NA==", "url": "https://github.com/osmlab/atlas-checks/pull/243#discussion_r371981384", "bodyText": "The requirements from your PR description say to me that the 'snakiness' can be determined from any 2 consecutive edges, so shouldn't we be calling lines 164-166 inside the while loop as well? Instead of passing current we pass connection", "author": "seancoulter", "createdAt": "2020-01-28T18:32:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTUzNTczNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjczMDU3NA==", "url": "https://github.com/osmlab/atlas-checks/pull/243#discussion_r372730574", "bodyText": "Heading difference is verified only against the current edge and it direct connections(this will be done for each edge when it is processed). Valence is checked for whole highway so that we can qualify it as a snake road.\nMoving these lines inside the while loop will make the check do the same thing repeatedly for an edge object that will be processed for snakeRoadCheck.", "author": "smaheshwaram", "createdAt": "2020-01-30T02:18:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTUzNTczNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTU1OTUwNg==", "url": "https://github.com/osmlab/atlas-checks/pull/243#discussion_r375559506", "bodyText": "Sorry if I'm misunderstanding. But aren't we now only calling checkIfEdgeHeadingDifferenceExceedsThreshold(current, connection)) between the starting edge and all of its connected edges? When we want to be calling it on every consecutive edge in the original Way. This might be doable if we reassign current whenever we move to the next layer of edges", "author": "seancoulter", "createdAt": "2020-02-05T23:08:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTUzNTczNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTY0MTY1OA==", "url": "https://github.com/osmlab/atlas-checks/pull/243#discussion_r375641658", "bodyText": "yes, thats true.\nMy assumption is when snakeRoadcheck is invoked its invoked for every edge, if we do this inside for loop, heading difference is calculated repeatedly for all consecutive edges.\nSo by not doing this only the edge where heading difference is greater than threshold is flagged.", "author": "smaheshwaram", "createdAt": "2020-02-06T05:03:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTUzNTczNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTU2MDg5MA==", "url": "https://github.com/osmlab/atlas-checks/pull/243#discussion_r375560890", "bodyText": "to avoid reprocessing, we can just say final Set<Edge> directConnections = walk.getDirectConnections() here. Might need to change Set to a LinkedList doing this", "author": "seancoulter", "createdAt": "2020-02-05T23:12:26Z", "path": "src/main/java/org/openstreetmap/atlas/checks/validation/linear/edges/SnakeRoadCheck.java", "diffHunk": "@@ -160,6 +161,10 @@ private boolean networkWalkQualifiesAsSnakeRoad(final SnakeRoadNetworkWalk walk)\n      */\n     private void walkNetwork(final Edge current, final SnakeRoadNetworkWalk walk)\n     {\n+        final Set<Edge> directConnections = walk.getConnectedMasterEdgeOfTheSameWay(current);", "originalCommit": "0e21d292bb73c4a499ce29baa78dcc3d6f0e215a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTAyMTM1OA==", "url": "https://github.com/osmlab/atlas-checks/pull/243#discussion_r379021358", "bodyText": "Done", "author": "smaheshwaram", "createdAt": "2020-02-13T17:51:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTU2MDg5MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzgzMjUzNQ==", "url": "https://github.com/osmlab/atlas-checks/pull/243#discussion_r377832535", "bodyText": "conn -> onceRemovedConnection", "author": "seancoulter", "createdAt": "2020-02-11T18:56:20Z", "path": "src/main/java/org/openstreetmap/atlas/checks/validation/linear/edges/SnakeRoadCheck.java", "diffHunk": "@@ -168,9 +169,13 @@ private void walkNetwork(final Edge current, final SnakeRoadNetworkWalk walk)\n             // Process it\n             walk.visitEdge(current, connection);\n \n+            final Set<Edge> oneLayerRemovedConnections = walk\n+                    .getConnectedMasterEdgeOfTheSameWay(connection);\n+            oneLayerRemovedConnections.forEach(\n+                    conn -> walk.checkIfEdgeHeadingDifferenceExceedsThreshold(connection, conn));", "originalCommit": "1f27e83d04135a0e62161ead5c1a7fcad79a489f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzgzMjg2Nw==", "url": "https://github.com/osmlab/atlas-checks/pull/243#discussion_r377832867", "bodyText": "(to avoid abbreviating)", "author": "seancoulter", "createdAt": "2020-02-11T18:56:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzgzMjUzNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTAyMTQ2MQ==", "url": "https://github.com/osmlab/atlas-checks/pull/243#discussion_r379021461", "bodyText": "Done", "author": "smaheshwaram", "createdAt": "2020-02-13T17:51:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzgzMjUzNQ=="}], "type": "inlineReview"}, {"oid": "caf38fc8040833f451715a013e423c6224c778b8", "url": "https://github.com/osmlab/atlas-checks/commit/caf38fc8040833f451715a013e423c6224c778b8", "message": "SnakeRoadCheck, trying to clean up commit count.", "committedDate": "2020-02-12T17:53:55Z", "type": "commit"}, {"oid": "caf38fc8040833f451715a013e423c6224c778b8", "url": "https://github.com/osmlab/atlas-checks/commit/caf38fc8040833f451715a013e423c6224c778b8", "message": "SnakeRoadCheck, trying to clean up commit count.", "committedDate": "2020-02-12T17:53:55Z", "type": "forcePushed"}, {"oid": "29b6c66198ec98b324d552f4fd8308940e5269d2", "url": "https://github.com/osmlab/atlas-checks/commit/29b6c66198ec98b324d552f4fd8308940e5269d2", "message": "Merge branch 'dev' into snake-road-check-bug", "committedDate": "2020-02-13T17:51:30Z", "type": "commit"}]}