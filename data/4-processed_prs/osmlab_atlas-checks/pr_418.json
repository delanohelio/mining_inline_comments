{"pr_number": 418, "pr_title": "Add Map Roulette Upload to AWS script", "pr_createdAt": "2020-11-11T22:10:39Z", "pr_url": "https://github.com/osmlab/atlas-checks/pull/418", "timeline": [{"oid": "889e6c4362a3e316297f312efe6ba688c00c5b53", "url": "https://github.com/osmlab/atlas-checks/commit/889e6c4362a3e316297f312efe6ba688c00c5b53", "message": "Copy S3 files by default.", "committedDate": "2020-11-04T20:25:25Z", "type": "commit"}, {"oid": "5099601931bd2744cf34e55585e3b4c171ccd099", "url": "https://github.com/osmlab/atlas-checks/commit/5099601931bd2744cf34e55585e3b4c171ccd099", "message": "update to latest version. Need a better way to do this.", "committedDate": "2020-11-04T20:37:10Z", "type": "commit"}, {"oid": "7968e4b9428557c3086866ffbe589d2ce2ecd457", "url": "https://github.com/osmlab/atlas-checks/commit/7968e4b9428557c3086866ffbe589d2ce2ecd457", "message": "wildcard the version as there should only be one.", "committedDate": "2020-11-04T20:42:45Z", "type": "commit"}, {"oid": "a35d0e382291ba027db9fd2522a2d4c84904eec4", "url": "https://github.com/osmlab/atlas-checks/commit/a35d0e382291ba027db9fd2522a2d4c84904eec4", "message": "add some fixes I ran into while testing", "committedDate": "2020-11-09T15:20:05Z", "type": "commit"}, {"oid": "aebf0d9c509439f54ec22b6585a48dd0f42b6f8a", "url": "https://github.com/osmlab/atlas-checks/commit/aebf0d9c509439f54ec22b6585a48dd0f42b6f8a", "message": "Merge branch 'dev' of github.com:osmlab/atlas-checks into s3Copy", "committedDate": "2020-11-09T15:20:17Z", "type": "commit"}, {"oid": "d74ddf2825049419cc2f206b04b2330bca47ea69", "url": "https://github.com/osmlab/atlas-checks/commit/d74ddf2825049419cc2f206b04b2330bca47ea69", "message": "Add MR upload command to AWS script.", "committedDate": "2020-11-11T22:04:35Z", "type": "commit"}, {"oid": "63a4b53a73bc34ac97d6a7f1be45a08197defd62", "url": "https://github.com/osmlab/atlas-checks/commit/63a4b53a73bc34ac97d6a7f1be45a08197defd62", "message": "add includeFixSuggestions flag", "committedDate": "2020-11-16T18:57:17Z", "type": "commit"}, {"oid": "987a760d007fad7202bd9a0d855055efed854955", "url": "https://github.com/osmlab/atlas-checks/commit/987a760d007fad7202bd9a0d855055efed854955", "message": "add maxPoolMinutes to maproulette upload command call", "committedDate": "2020-11-17T18:18:10Z", "type": "commit"}, {"oid": "bd23d92cb47158998165ac9a12dc6c59cb04b670", "url": "https://github.com/osmlab/atlas-checks/commit/bd23d92cb47158998165ac9a12dc6c59cb04b670", "message": "Merge branch 'dev' into awsScriptMapRoulette", "committedDate": "2020-11-18T15:12:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjM2MTMzMQ==", "url": "https://github.com/osmlab/atlas-checks/pull/418#discussion_r526361331", "bodyText": "Could we make the jar location configurable?", "author": "seancoulter", "createdAt": "2020-11-18T19:26:37Z", "path": "scripts/cloud-check-control/cloudAtlasCheckControl.py", "diffHunk": "@@ -231,6 +244,55 @@ def sync(self):\n         if self.terminate:\n             self.terminate_instance()\n \n+    def challenge(self):\n+        logger.info(\"Creating map roulette challenge.\")\n+\n+        # sync the country folders to the local directory\n+        for c in list(self.countries.split(\",\")):\n+            logger.info(\n+                \"syncing {}/flag/{} to {}/flag/{}\".format(\n+                    self.s3OutFolder, c, self.atlasOutDir, c\n+                )\n+            )\n+            if self.ssh_cmd(\n+                \"aws s3 sync --only-show-errors s3://{0}/flag/{1} {2}/flag/{1}\".format(\n+                    self.s3OutFolder, c, self.atlasOutDir\n+                )\n+            ):\n+                finish(\"Failed to sync S3://{}/{}\".format(self.s3OutFolder, c), -1)\n+        if self.ssh_cmd(\n+            \"aws s3 cp s3://{} {}\".format(\n+                self.atlasConfig, os.path.join(self.homeDir, self.atlasConfig)\n+            )\n+        ):\n+            finish(\"Failed to copy config S3://{}\".format(self.atlasConfig), -1)\n+\n+        # push output to s3\n+        cmd = \"aws s3 sync --only-show-errors --exclude *.crc {} s3://{} \".format(\n+            self.atlasOutDir, self.s3OutFolder\n+        )\n+        if self.ssh_cmd(cmd):\n+            finish(\"Unable to sync with S3\", -1)\n+\n+        cmd = (\n+            \"java -cp atlas-checks/build/libs/atlas-checks-*-SNAPSHOT-shaded.jar\"", "originalCommit": "bd23d92cb47158998165ac9a12dc6c59cb04b670", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQxMDM3Nw==", "url": "https://github.com/osmlab/atlas-checks/pull/418#discussion_r526410377", "bodyText": "Sure.", "author": "atiannicelli", "createdAt": "2020-11-18T20:48:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjM2MTMzMQ=="}], "type": "inlineReview"}, {"oid": "be93b5a421785398fa371ee1924f76b883229086", "url": "https://github.com/osmlab/atlas-checks/commit/be93b5a421785398fa371ee1924f76b883229086", "message": "Merge branch 'dev' of github.com:osmlab/atlas-checks into awsScriptMapRoulette", "committedDate": "2020-11-18T20:51:05Z", "type": "commit"}, {"oid": "f0c4827721fd8bc52961b671f90710c547022fdb", "url": "https://github.com/osmlab/atlas-checks/commit/f0c4827721fd8bc52961b671f90710c547022fdb", "message": "add parameter for jar file.", "committedDate": "2020-11-18T21:08:07Z", "type": "commit"}]}