{"pr_number": 241, "pr_title": "BigNodeBadDataCheck Run Time Bug", "pr_createdAt": "2020-01-13T23:22:44Z", "pr_url": "https://github.com/osmlab/atlas-checks/pull/241", "timeline": [{"oid": "359815f92c84c4ef7d88eec300f8823bf83c0c7b", "url": "https://github.com/osmlab/atlas-checks/commit/359815f92c84c4ef7d88eec300f8823bf83c0c7b", "message": "short circuit", "committedDate": "2020-01-09T16:56:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjEwOTI4OA==", "url": "https://github.com/osmlab/atlas-checks/pull/241#discussion_r366109288", "bodyText": "nit: extra space", "author": "danielduhh", "createdAt": "2020-01-14T01:07:35Z", "path": "src/main/java/org/openstreetmap/atlas/checks/validation/intersections/BigNodeBadDataCheck.java", "diffHunk": "@@ -77,29 +78,43 @@ public boolean validCheckForObject(final AtlasObject object)\n         {\n             return Optional.empty();\n         }\n-        final int allPathsCount = bigNode.allPaths().size();\n+\n         final int junctionEdgesCount = bigNode.junctionEdges().size();\n-        final Set<RestrictedPath> turnRestrictions = bigNode.turnRestrictions();\n-        final int turnRestrictionCount = turnRestrictions.size();\n-        // Get list of restricted path OSM ids\n-        final List<Long> restrictedPathOsmIds = turnRestrictions.stream()\n-                .flatMap(restrictedPath -> Iterables.asList(restrictedPath.getRoute()).stream()\n-                        .map(Edge::getOsmIdentifier))\n-                .collect(Collectors.toList());\n-\n-        if (allPathsCount > maxNumberPathsThreshold\n-                || junctionEdgesCount > maxNumberJunctionEdgesThreshold)\n+        if (junctionEdgesCount > maxNumberJunctionEdgesThreshold)\n         {\n             final CheckFlag flag = createFlag(bigNode,\n-                    this.getLocalizedInstruction(0, allPathsCount, junctionEdgesCount,\n-                            turnRestrictionCount, restrictedPathOsmIds.toString()));\n+                    this.getLocalizedInstruction(0, junctionEdgesCount));\n \n             bigNode.edges().forEach(flag::addObject);\n             // Add map pin at each BigNode Node\n             bigNode.nodes().forEach(b -> flag.addPoint(b.getLocation()));\n \n             return Optional.of(flag);\n         }\n+        else\n+        {\n+            final int allPathsCount = bigNode.allPaths().size();\n+", "originalCommit": "359815f92c84c4ef7d88eec300f8823bf83c0c7b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "16237ba7887e1ce83a610d8d79460837b90582cf", "url": "https://github.com/osmlab/atlas-checks/commit/16237ba7887e1ce83a610d8d79460837b90582cf", "message": "rm space", "committedDate": "2020-01-14T17:15:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQ5OTQyNg==", "url": "https://github.com/osmlab/atlas-checks/pull/241#discussion_r366499426", "bodyText": "@Bentleysb Great improvement on the run time. I only have one doubt. So, here are you trying to get bigNode.allPaths() only if no other flag conditions are met so that you can save run time!!", "author": "smaheshwaram", "createdAt": "2020-01-14T18:25:14Z", "path": "src/main/java/org/openstreetmap/atlas/checks/validation/intersections/BigNodeBadDataCheck.java", "diffHunk": "@@ -77,29 +78,42 @@ public boolean validCheckForObject(final AtlasObject object)\n         {\n             return Optional.empty();\n         }\n-        final int allPathsCount = bigNode.allPaths().size();\n+\n         final int junctionEdgesCount = bigNode.junctionEdges().size();\n-        final Set<RestrictedPath> turnRestrictions = bigNode.turnRestrictions();\n-        final int turnRestrictionCount = turnRestrictions.size();\n-        // Get list of restricted path OSM ids\n-        final List<Long> restrictedPathOsmIds = turnRestrictions.stream()\n-                .flatMap(restrictedPath -> Iterables.asList(restrictedPath.getRoute()).stream()\n-                        .map(Edge::getOsmIdentifier))\n-                .collect(Collectors.toList());\n-\n-        if (allPathsCount > maxNumberPathsThreshold\n-                || junctionEdgesCount > maxNumberJunctionEdgesThreshold)\n+        if (junctionEdgesCount > maxNumberJunctionEdgesThreshold)\n         {\n             final CheckFlag flag = createFlag(bigNode,\n-                    this.getLocalizedInstruction(0, allPathsCount, junctionEdgesCount,\n-                            turnRestrictionCount, restrictedPathOsmIds.toString()));\n+                    this.getLocalizedInstruction(0, junctionEdgesCount));\n \n             bigNode.edges().forEach(flag::addObject);\n             // Add map pin at each BigNode Node\n             bigNode.nodes().forEach(b -> flag.addPoint(b.getLocation()));\n \n             return Optional.of(flag);\n         }\n+        else", "originalCommit": "16237ba7887e1ce83a610d8d79460837b90582cf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjUwMTIyMQ==", "url": "https://github.com/osmlab/atlas-checks/pull/241#discussion_r366501221", "bodyText": "That is the idea. Although currently the number of junction edges is the only other flag condition.", "author": "Bentleysb", "createdAt": "2020-01-14T18:28:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQ5OTQyNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjUwMjc1Mw==", "url": "https://github.com/osmlab/atlas-checks/pull/241#discussion_r366502753", "bodyText": "So we cannot avoid running into the case where it takes lot of time going through all the big node paths but we can at least save time on checking conditions ahead like junction edges. Cool. Thanks.", "author": "smaheshwaram", "createdAt": "2020-01-14T18:31:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjQ5OTQyNg=="}], "type": "inlineReview"}, {"oid": "4111f535e82e3a79e23be38b247dbf9370a5a83b", "url": "https://github.com/osmlab/atlas-checks/commit/4111f535e82e3a79e23be38b247dbf9370a5a83b", "message": "Merge branch 'dev' into dev-BigNodeBadRunTime", "committedDate": "2020-01-14T18:50:46Z", "type": "commit"}]}