{"pr_number": 11900, "pr_title": "[FLINK-17284][jdbc][postgres] Support serial fields", "pr_createdAt": "2020-04-24T08:52:37Z", "pr_url": "https://github.com/apache/flink/pull/11900", "timeline": [{"oid": "6d068905bd0bcdcdc6074ec657ee5b87b5377e2c", "url": "https://github.com/apache/flink/commit/6d068905bd0bcdcdc6074ec657ee5b87b5377e2c", "message": "Added tests and removed useless switch cases", "committedDate": "2020-04-30T22:53:38Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTIyNzQwMA==", "url": "https://github.com/apache/flink/pull/11900#discussion_r421227400", "bodyText": "just add comments, rather than commenting out string constants?", "author": "bowenli86", "createdAt": "2020-05-07T04:08:50Z", "path": "flink-connectors/flink-jdbc/src/main/java/org/apache/flink/api/java/io/jdbc/catalog/PostgresCatalog.java", "diffHunk": "@@ -216,6 +216,12 @@ public CatalogBaseTable getTable(ObjectPath tablePath) throws TableNotExistExcep\n \t\t}\n \t}\n \n+\tpublic static final String PG_SERIAL = \"serial\";\n+\t//public static final String PG_SERIAL2 = \"serial2\"; //ResultSetMetaData.getColumnTypeName() returns int2", "originalCommit": "6d068905bd0bcdcdc6074ec657ee5b87b5377e2c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTMzODI4NA==", "url": "https://github.com/apache/flink/pull/11900#discussion_r421338284", "bodyText": "Ok", "author": "fpompermaier", "createdAt": "2020-05-07T08:42:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTIyNzQwMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTIyNzU3Mg==", "url": "https://github.com/apache/flink/pull/11900#discussion_r421227572", "bodyText": "why use a separate table rather than reusing existing one?", "author": "bowenli86", "createdAt": "2020-05-07T04:09:28Z", "path": "flink-connectors/flink-jdbc/src/test/java/org/apache/flink/api/java/io/jdbc/catalog/PostgresCatalogTestBase.java", "diffHunk": "@@ -58,6 +58,7 @@\n \tprotected static final String TABLE5 = \"t5\";\n \tprotected static final String TABLE_PRIMITIVE_TYPE = \"dt\";\n \tprotected static final String TABLE_ARRAY_TYPE = \"dt2\";\n+\tprotected static final String TABLE_SERIAL_TYPE = \"dt3\";", "originalCommit": "6d068905bd0bcdcdc6074ec657ee5b87b5377e2c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTMzODAxNQ==", "url": "https://github.com/apache/flink/pull/11900#discussion_r421338015", "bodyText": "Beacause the other table was becoming too big..I think we need to split it a little bit..what do you think?", "author": "fpompermaier", "createdAt": "2020-05-07T08:41:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTIyNzU3Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjU4NDEwNw==", "url": "https://github.com/apache/flink/pull/11900#discussion_r422584107", "bodyText": "I'd recommend to rename dt,dt2, and dt3 to reflect the types they individually contain and test; otherwise, it's getting confusing", "author": "bowenli86", "createdAt": "2020-05-10T04:47:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTIyNzU3Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjcwNjY0OQ==", "url": "https://github.com/apache/flink/pull/11900#discussion_r422706649", "bodyText": "How should I rename them? Do you have something in mind?", "author": "fpompermaier", "createdAt": "2020-05-10T22:03:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTIyNzU3Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzE4NDEzNw==", "url": "https://github.com/apache/flink/pull/11900#discussion_r423184137", "bodyText": "\u201dprimitive_type\u201c, \"array_type\", \"serial_type\"?", "author": "bowenli86", "createdAt": "2020-05-11T16:59:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTIyNzU3Mg=="}], "type": "inlineReview"}, {"oid": "7dbc5136bfeaccf5ec33190993d0aed31664e1c8", "url": "https://github.com/apache/flink/commit/7dbc5136bfeaccf5ec33190993d0aed31664e1c8", "message": "Addressed PR comments, added tests for decimal type", "committedDate": "2020-05-07T09:32:02Z", "type": "forcePushed"}, {"oid": "b520f70f3c7dbc88c3260cd00649f3ee6f27180e", "url": "https://github.com/apache/flink/commit/b520f70f3c7dbc88c3260cd00649f3ee6f27180e", "message": "[FLINK-17537][connectors / jdbc] Support serial fields", "committedDate": "2020-05-11T21:32:09Z", "type": "forcePushed"}, {"oid": "225d015e642e19e1db90604aa01ccd82b96f54a5", "url": "https://github.com/apache/flink/commit/225d015e642e19e1db90604aa01ccd82b96f54a5", "message": "[FLINK-17537][connectors / jdbc] Support serial fields", "committedDate": "2020-05-11T21:35:48Z", "type": "forcePushed"}, {"oid": "ab01f79686561ac0677cb1841a92c01955e90c7f", "url": "https://github.com/apache/flink/commit/ab01f79686561ac0677cb1841a92c01955e90c7f", "message": "[FLINK-17537][connectors / jdbc] Support serial fields", "committedDate": "2020-05-11T21:37:46Z", "type": "forcePushed"}, {"oid": "61bc4171b2761832ba38b60f62f4979ab9783090", "url": "https://github.com/apache/flink/commit/61bc4171b2761832ba38b60f62f4979ab9783090", "message": "Rebased code", "committedDate": "2020-05-19T14:54:05Z", "type": "forcePushed"}, {"oid": "69bce2717b0279a894aa66d15cd4b9b72cd5a474", "url": "https://github.com/apache/flink/commit/69bce2717b0279a894aa66d15cd4b9b72cd5a474", "message": "[FLINK-17284][jdbc][postgres] Support serial fields", "committedDate": "2020-05-19T14:54:49Z", "type": "forcePushed"}, {"oid": "17ee20d6efb84cca02a24b032c9504dcf03ff8a1", "url": "https://github.com/apache/flink/commit/17ee20d6efb84cca02a24b032c9504dcf03ff8a1", "message": "[FLINK-17284][jdbc][postgres] Support serial fields", "committedDate": "2020-05-19T15:08:17Z", "type": "forcePushed"}, {"oid": "3ca03cd504f4ed817c49647de1523bf039d82a22", "url": "https://github.com/apache/flink/commit/3ca03cd504f4ed817c49647de1523bf039d82a22", "message": "[FLINK-17284][jdbc][postgres] Support serial fields", "committedDate": "2020-05-20T12:26:28Z", "type": "forcePushed"}, {"oid": "4cf97b2be4447c2d2f94259ad559fefb79a0a727", "url": "https://github.com/apache/flink/commit/4cf97b2be4447c2d2f94259ad559fefb79a0a727", "message": "[FLINK-17284][jdbc][postgres] Support serial fields", "committedDate": "2020-05-20T12:27:30Z", "type": "forcePushed"}, {"oid": "eeb75e199f3c920c4e36b336ff4598ccaa9acb9f", "url": "https://github.com/apache/flink/commit/eeb75e199f3c920c4e36b336ff4598ccaa9acb9f", "message": "[FLINK-17284][jdbc][postgres] Support serial fields", "committedDate": "2020-05-21T22:23:41Z", "type": "forcePushed"}, {"oid": "57beefa4d2852424d27ac41d193b188525ed191e", "url": "https://github.com/apache/flink/commit/57beefa4d2852424d27ac41d193b188525ed191e", "message": "[FLINK-17284][jdbc][postgres] Support serial fields", "committedDate": "2020-05-21T22:26:15Z", "type": "forcePushed"}, {"oid": "ccd3b17332d5a7eb5bb97124cd1a9a4c3986d82d", "url": "https://github.com/apache/flink/commit/ccd3b17332d5a7eb5bb97124cd1a9a4c3986d82d", "message": "[FLINK-17284][jdbc][postgres] Support serial fields", "committedDate": "2020-05-21T22:27:20Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY0NzExNg==", "url": "https://github.com/apache/flink/pull/11900#discussion_r429647116", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t// serial2 <=> int2\n          \n          \n            \n            \t// serial4 <=> serial\n          \n          \n            \n            \t// serial8 <=> bigserial\n          \n          \n            \n            \t// smallserial <=> int2\n          \n          \n            \n            \t// serial2 <=> int2\n          \n          \n            \n            \t// smallserial <=> int2\n          \n          \n            \n            \t// serial4 <=> serial\n          \n          \n            \n            \t// serial8 <=> bigserial\n          \n      \n    \n    \n  \n\nHow about bubbling up \"// smallserial <=> int2 \" to make them look better?", "author": "leonardBang", "createdAt": "2020-05-24T15:18:52Z", "path": "flink-connectors/flink-connector-jdbc/src/main/java/org/apache/flink/connector/jdbc/catalog/PostgresCatalog.java", "diffHunk": "@@ -231,13 +231,19 @@ public CatalogBaseTable getTable(ObjectPath tablePath) throws TableNotExistExcep\n \t}\n \n \t// Postgres jdbc driver maps several alias to real type, we use real type rather than alias:\n+\t// serial2 <=> int2\n+\t// serial4 <=> serial\n+\t// serial8 <=> bigserial\n+\t// smallserial <=> int2", "originalCommit": "ccd3b17332d5a7eb5bb97124cd1a9a4c3986d82d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY0ODMxNA==", "url": "https://github.com/apache/flink/pull/11900#discussion_r429648314", "bodyText": "This values is never used.\nHow about add a ITCase that read serial type data properly to check the type mapping logic? and we can use more meaningful values like \"32767, 2147483647, 32767, 2147483647 , 9223372036854775807, 9223372036854775807\" .", "author": "leonardBang", "createdAt": "2020-05-24T15:32:25Z", "path": "flink-connectors/flink-connector-jdbc/src/test/java/org/apache/flink/connector/jdbc/catalog/PostgresCatalogTestBase.java", "diffHunk": "@@ -289,4 +292,29 @@ public static TestTable getArrayTable() {\n \t\t\t));\n \t}\n \n+\tpublic static TestTable getSerialTable() {\n+\t\treturn new TestTable(\n+\t\t\tTableSchema.builder()\n+\t\t\t\t.field(\"f0\", DataTypes.SMALLINT())\n+\t\t\t\t.field(\"f1\", DataTypes.INT())\n+\t\t\t\t.field(\"f2\", DataTypes.SMALLINT())\n+\t\t\t\t.field(\"f3\", DataTypes.INT())\n+\t\t\t\t.field(\"f4\", DataTypes.BIGINT())\n+\t\t\t\t.field(\"f5\", DataTypes.BIGINT())\n+\t\t\t\t.build(),\n+\t\t\t\"f0 smallserial, \" +\n+\t\t\t\t\"f1 serial, \" +\n+\t\t\t\t\"f2 serial2, \" +\n+\t\t\t\t\"f3 serial4, \" +\n+\t\t\t\t\"f4 serial8, \" +\n+\t\t\t\t\"f5 bigserial\",\n+\t\t\t\"0,\" +\n+\t\t\t\t\"1,\" +\n+\t\t\t\t\"2,\" +\n+\t\t\t\t\"3,\" +\n+\t\t\t\t\"4,\" +\n+\t\t\t\t\"5\"", "originalCommit": "ccd3b17332d5a7eb5bb97124cd1a9a4c3986d82d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY1MzAzMw==", "url": "https://github.com/apache/flink/pull/11900#discussion_r429653033", "bodyText": "What do you mean exactly? Should I just use the suggested values or do sonething else?", "author": "fpompermaier", "createdAt": "2020-05-24T16:27:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY0ODMxNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY5NjQyMw==", "url": "https://github.com/apache/flink/pull/11900#discussion_r429696423", "bodyText": "I mean we can add an ITCase that read serial type from PG, and the serial type value could be suggested values.", "author": "leonardBang", "createdAt": "2020-05-25T01:10:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY0ODMxNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTc3Njc2OA==", "url": "https://github.com/apache/flink/pull/11900#discussion_r429776768", "bodyText": "Probably now I understood..you mean that for this table there's only the test that verifies the schema, not the returned values..I'll add it right now", "author": "fpompermaier", "createdAt": "2020-05-25T07:33:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY0ODMxNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTc5MDc2NA==", "url": "https://github.com/apache/flink/pull/11900#discussion_r429790764", "bodyText": "Just one note..now I've rebased the PR and addressed your comments..however I also had to set notNull() on the fields because serial fields are marked as not null by PG. Let me know if you think I should handle this situation in a different way", "author": "fpompermaier", "createdAt": "2020-05-25T08:02:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY0ODMxNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI3NjIwNQ==", "url": "https://github.com/apache/flink/pull/11900#discussion_r430276205", "bodyText": "It's fine to me, we only read serial from PG and wont write a serial column.", "author": "leonardBang", "createdAt": "2020-05-26T09:24:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY0ODMxNA=="}], "type": "inlineReview"}, {"oid": "c3938da0d084dad77f0222157a09ae5a0055f47a", "url": "https://github.com/apache/flink/commit/c3938da0d084dad77f0222157a09ae5a0055f47a", "message": "[FLINK-17284][jdbc][postgres] Support serial fields", "committedDate": "2020-05-25T07:27:38Z", "type": "commit"}, {"oid": "9190d85e2b0e02af9a1062263e25c6f9a23b1c5d", "url": "https://github.com/apache/flink/commit/9190d85e2b0e02af9a1062263e25c6f9a23b1c5d", "message": "Fixed test and addressed comments", "committedDate": "2020-05-25T07:57:41Z", "type": "commit"}, {"oid": "9190d85e2b0e02af9a1062263e25c6f9a23b1c5d", "url": "https://github.com/apache/flink/commit/9190d85e2b0e02af9a1062263e25c6f9a23b1c5d", "message": "Fixed test and addressed comments", "committedDate": "2020-05-25T07:57:41Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI3MzA0OQ==", "url": "https://github.com/apache/flink/pull/11900#discussion_r430273049", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\t\"2767,\" +\n          \n          \n            \n            \t\t\t\"32767,\" +", "author": "leonardBang", "createdAt": "2020-05-26T09:19:24Z", "path": "flink-connectors/flink-connector-jdbc/src/test/java/org/apache/flink/connector/jdbc/catalog/PostgresCatalogTestBase.java", "diffHunk": "@@ -289,4 +292,30 @@ public static TestTable getArrayTable() {\n \t\t\t));\n \t}\n \n+\tpublic static TestTable getSerialTable() {\n+\t\treturn new TestTable(\n+\t\t\tTableSchema.builder()\n+\t\t\t\t// serial fields are returned as not null by ResultSetMetaData.columnNoNulls\n+\t\t\t\t.field(\"f0\", DataTypes.SMALLINT().notNull())\n+\t\t\t\t.field(\"f1\", DataTypes.INT().notNull())\n+\t\t\t\t.field(\"f2\", DataTypes.SMALLINT().notNull())\n+\t\t\t\t.field(\"f3\", DataTypes.INT().notNull())\n+\t\t\t\t.field(\"f4\", DataTypes.BIGINT().notNull())\n+\t\t\t\t.field(\"f5\", DataTypes.BIGINT().notNull())\n+\t\t\t\t.build(),\n+\t\t\t\"f0 smallserial, \" +\n+\t\t\t\t\"f1 serial, \" +\n+\t\t\t\t\"f2 serial2, \" +\n+\t\t\t\t\"f3 serial4, \" +\n+\t\t\t\t\"f4 serial8, \" +\n+\t\t\t\t\"f5 bigserial\",\n+\t\t\t\"2767,\" +", "originalCommit": "9190d85e2b0e02af9a1062263e25c6f9a23b1c5d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI3MzM0Ng==", "url": "https://github.com/apache/flink/pull/11900#discussion_r430273346", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\t\t\"2767,\" +\n          \n          \n            \n            \t\t\t\t\"32767,\" +", "author": "leonardBang", "createdAt": "2020-05-26T09:19:56Z", "path": "flink-connectors/flink-connector-jdbc/src/test/java/org/apache/flink/connector/jdbc/catalog/PostgresCatalogITCase.java", "diffHunk": "@@ -139,4 +139,19 @@ public void testArrayTypes() {\n \t\t\t\t\"[00:51:03, 00:59:03]]\",\n \t\t\tresults.toString());\n \t}\n+\n+\t@Test\n+\tpublic void testSerialTypes() {\n+\t\tList<Row> results = Lists.newArrayList(\n+\t\t\ttEnv.sqlQuery(String.format(\"select * from %s\", TABLE_SERIAL_TYPE)).execute().collect());\n+\n+\t\tassertEquals(\"[\" +\n+\t\t\t\t\"2767,\" +", "originalCommit": "9190d85e2b0e02af9a1062263e25c6f9a23b1c5d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "cc55b2372cd6eb9c60298a8b8c4187521ff44aa8", "url": "https://github.com/apache/flink/commit/cc55b2372cd6eb9c60298a8b8c4187521ff44aa8", "message": "Update flink-connectors/flink-connector-jdbc/src/test/java/org/apache/flink/connector/jdbc/catalog/PostgresCatalogTestBase.java\n\nCo-authored-by: Leonard Xu <xbjtdcq@163.com>", "committedDate": "2020-05-26T17:11:04Z", "type": "commit"}, {"oid": "591a44a8755aa5ce787b4c555f23fa0ead4eca7c", "url": "https://github.com/apache/flink/commit/591a44a8755aa5ce787b4c555f23fa0ead4eca7c", "message": "Update flink-connectors/flink-connector-jdbc/src/test/java/org/apache/flink/connector/jdbc/catalog/PostgresCatalogITCase.java\n\nCo-authored-by: Leonard Xu <xbjtdcq@163.com>", "committedDate": "2020-05-26T17:12:32Z", "type": "commit"}]}