{"pr_number": 11764, "pr_title": "[FLINK-17023][scripts] Fix format checking of extractExecutionParams in config.sh", "pr_createdAt": "2020-04-16T03:11:43Z", "pr_url": "https://github.com/apache/flink/pull/11764", "timeline": [{"oid": "ef1fb835ec7655eb1a62ebb9dcf9e2033dcfb148", "url": "https://github.com/apache/flink/commit/ef1fb835ec7655eb1a62ebb9dcf9e2033dcfb148", "message": "[FLINK-17023][scripts] Fix format checking of extractExecutionParams in config.sh", "committedDate": "2020-04-17T06:03:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDAzNDk1OA==", "url": "https://github.com/apache/flink/pull/11764#discussion_r410034958", "bodyText": "taskmanager.sh uses a different way of counting lines: num_lines=$(echo \"${java_utils_output}\" | wc -l)\nI'd prefer if we stick to 1 way of doing it", "author": "zentol", "createdAt": "2020-04-17T07:14:13Z", "path": "flink-dist/src/main/flink-bin/bin/config.sh", "diffHunk": "@@ -644,9 +644,17 @@ extractExecutionParams() {\n     local execution_config=$1\n     local EXECUTION_PREFIX=\"BASH_JAVA_UTILS_EXEC_RESULT:\"\n \n-    if ! [[ $execution_config =~ ^${EXECUTION_PREFIX}.* ]]; then\n+    local line_count=`echo \"$execution_config\" | grep \"\" -c`", "originalCommit": "ef1fb835ec7655eb1a62ebb9dcf9e2033dcfb148", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDAzNTQxOA==", "url": "https://github.com/apache/flink/pull/11764#discussion_r410035418", "bodyText": "this is undefined is it not?", "author": "zentol", "createdAt": "2020-04-17T07:15:15Z", "path": "flink-dist/src/main/flink-bin/bin/config.sh", "diffHunk": "@@ -644,9 +644,17 @@ extractExecutionParams() {\n     local execution_config=$1\n     local EXECUTION_PREFIX=\"BASH_JAVA_UTILS_EXEC_RESULT:\"\n \n-    if ! [[ $execution_config =~ ^${EXECUTION_PREFIX}.* ]]; then\n+    local line_count=`echo \"$execution_config\" | grep \"\" -c`\n+    if ! [[ ${line_count} == 1 ]]; then\n+        echo \"[ERROR] Unexpected result ($line_count lines): $execution_config\" 1>&2\n+        echo \"[ERROR] extractExecutionParams only accepts exactly one line as the input\" 1>&2\n+        echo \"$output\" 1>&2", "originalCommit": "ef1fb835ec7655eb1a62ebb9dcf9e2033dcfb148", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDAzNTQ5OA==", "url": "https://github.com/apache/flink/pull/11764#discussion_r410035498", "bodyText": "same here, $output isn't defined anywhere", "author": "zentol", "createdAt": "2020-04-17T07:15:27Z", "path": "flink-dist/src/main/flink-bin/bin/config.sh", "diffHunk": "@@ -644,9 +644,17 @@ extractExecutionParams() {\n     local execution_config=$1\n     local EXECUTION_PREFIX=\"BASH_JAVA_UTILS_EXEC_RESULT:\"\n \n-    if ! [[ $execution_config =~ ^${EXECUTION_PREFIX}.* ]]; then\n+    local line_count=`echo \"$execution_config\" | grep \"\" -c`\n+    if ! [[ ${line_count} == 1 ]]; then\n+        echo \"[ERROR] Unexpected result ($line_count lines): $execution_config\" 1>&2\n+        echo \"[ERROR] extractExecutionParams only accepts exactly one line as the input\" 1>&2\n+        echo \"$output\" 1>&2\n+        exit 1\n+    fi\n+\n+    if ! [[ ${execution_config} =~ ^${EXECUTION_PREFIX}.* ]]; then\n         echo \"[ERROR] Unexpected result: $execution_config\" 1>&2\n-        echo \"[ERROR] The last line of the BashJavaUtils outputs is expected to be the execution result, following the prefix '${EXECUTION_PREFIX}'\" 1>&2\n+        echo \"[ERROR] The output of BashJavaUtils is expected to be the execution result, following the prefix '${EXECUTION_PREFIX}'\" 1>&2\n         echo \"$output\" 1>&2", "originalCommit": "ef1fb835ec7655eb1a62ebb9dcf9e2033dcfb148", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "85d4202c20c3d4649dd4c860595ffae7ea3eba3e", "url": "https://github.com/apache/flink/commit/85d4202c20c3d4649dd4c860595ffae7ea3eba3e", "message": "Fix comments", "committedDate": "2020-04-17T07:24:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTUyMzc0NA==", "url": "https://github.com/apache/flink/pull/11764#discussion_r411523744", "bodyText": "I think this change broke my local setup. If I build from master I can no longer start a cluster via bin/start-cluster.sh.", "author": "tillrohrmann", "createdAt": "2020-04-20T16:35:27Z", "path": "flink-dist/src/main/flink-bin/bin/config.sh", "diffHunk": "@@ -644,10 +644,16 @@ extractExecutionParams() {\n     local execution_config=$1\n     local EXECUTION_PREFIX=\"BASH_JAVA_UTILS_EXEC_RESULT:\"\n \n-    if ! [[ $execution_config =~ ^${EXECUTION_PREFIX}.* ]]; then\n+    local num_lines=$(echo \"$execution_config\" | wc -l)\n+    if ! [[ ${num_lines} == 1 ]]; then\n+        echo \"[ERROR] Unexpected result ($num_lines lines): $execution_config\" 1>&2\n+        echo \"[ERROR] extractExecutionParams only accepts exactly one line as the input\" 1>&2\n+        exit 1\n+    fi", "originalCommit": "85d4202c20c3d4649dd4c860595ffae7ea3eba3e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTUyNDIxNw==", "url": "https://github.com/apache/flink/pull/11764#discussion_r411524217", "bodyText": "I think the problem is that we don't do proper trimming.", "author": "tillrohrmann", "createdAt": "2020-04-20T16:36:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTUyMzc0NA=="}], "type": "inlineReview"}]}