{"pr_number": 11170, "pr_title": " [FLINK-16033][table-api] Expose catalog lookup function calls in Scala's expression dsl.", "pr_createdAt": "2020-02-21T09:27:06Z", "pr_url": "https://github.com/apache/flink/pull/11170", "timeline": [{"oid": "e13785504108e6e6373e30df43d245a6b47bb1ce", "url": "https://github.com/apache/flink/commit/e13785504108e6e6373e30df43d245a6b47bb1ce", "message": "[FLINK-16033][table-api] Expose catalog lookup function calls in Scala's\nexpression dsl.", "committedDate": "2020-02-21T09:52:06Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzIxMjIwMg==", "url": "https://github.com/apache/flink/pull/11170#discussion_r383212202", "bodyText": "How about we integrate the identifierParser into FunctionLookup. DataTypeFactory has also a method that takes (String). I would like to reduce the number of instances that we need to pass around.", "author": "twalthr", "createdAt": "2020-02-24T11:26:49Z", "path": "flink-table/flink-table-api-java/src/main/java/org/apache/flink/table/expressions/resolver/ExpressionResolver.java", "diffHunk": "@@ -382,11 +395,13 @@ public CallExpression get(ResolvedExpression composite, ValueLiteralExpression k\n \t\tprivate ExpressionResolverBuilder(\n \t\t\t\tQueryOperation[] queryOperations,\n \t\t\t\tTableConfig config,\n+\t\t\t\tFunction<String, UnresolvedIdentifier> identifierParser,\n \t\t\t\tTableReferenceLookup tableCatalog,\n \t\t\t\tFunctionLookup functionLookup,\n \t\t\t\tDataTypeFactory typeFactory) {\n \t\t\tthis.config = config;\n \t\t\tthis.queryOperations = Arrays.asList(queryOperations);\n+\t\t\tthis.identifierParser = identifierParser;", "originalCommit": "d4eef40b743be60e236da67edb9b1f5fdd4436d3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzIyMTk5Mw==", "url": "https://github.com/apache/flink/pull/11170#discussion_r383221993", "bodyText": "remove local variable", "author": "twalthr", "createdAt": "2020-02-24T11:51:25Z", "path": "flink-table/flink-table-planner-blink/src/main/scala/org/apache/flink/table/planner/calcite/FlinkRelBuilder.scala", "diffHunk": "@@ -59,7 +59,7 @@ class FlinkRelBuilder(\n \n   private val toRelNodeConverter = {\n     val functionCatalog = context.unwrap(classOf[FlinkContext]).getFunctionCatalog", "originalCommit": "d4eef40b743be60e236da67edb9b1f5fdd4436d3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzIyMzc4MA==", "url": "https://github.com/apache/flink/pull/11170#discussion_r383223780", "bodyText": "remove \"external\"?", "author": "twalthr", "createdAt": "2020-02-24T11:55:40Z", "path": "flink-table/flink-table-api-scala/src/main/scala/org/apache/flink/table/api/expressionDsl.scala", "diffHunk": "@@ -1257,6 +1257,38 @@ trait ImplicitExpressionConversions {\n     convertArray(array)\n   }\n \n+  // ----------------------------------------------------------------------------------------------\n+  // Function calls\n+  // ----------------------------------------------------------------------------------------------\n+\n+  /**\n+   * A call to a function that will be looked up in a catalog. There are two kinds of functions:\n+   *\n+   *  - System functions - which are identified with one part names\n+   *  - Catalog functions - which are identified always with three parts names\n+   *    (catalog, database, function)\n+   *\n+   * Moreover each function can either be a temporary function or permanent one\n+   * (which is stored in an external catalog).", "originalCommit": "e13785504108e6e6373e30df43d245a6b47bb1ce", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzIyNDk3Mw==", "url": "https://github.com/apache/flink/pull/11170#discussion_r383224973", "bodyText": "Based on those two properties, the resolution order for looking up a function based on the provided path is as follows:", "author": "twalthr", "createdAt": "2020-02-24T11:58:19Z", "path": "flink-table/flink-table-api-scala/src/main/scala/org/apache/flink/table/api/expressionDsl.scala", "diffHunk": "@@ -1257,6 +1257,38 @@ trait ImplicitExpressionConversions {\n     convertArray(array)\n   }\n \n+  // ----------------------------------------------------------------------------------------------\n+  // Function calls\n+  // ----------------------------------------------------------------------------------------------\n+\n+  /**\n+   * A call to a function that will be looked up in a catalog. There are two kinds of functions:\n+   *\n+   *  - System functions - which are identified with one part names\n+   *  - Catalog functions - which are identified always with three parts names\n+   *    (catalog, database, function)\n+   *\n+   * Moreover each function can either be a temporary function or permanent one\n+   * (which is stored in an external catalog).\n+   *\n+   * Based on that two properties the resolution order for looking up a function based on\n+   * the provided `functionName` is following:", "originalCommit": "e13785504108e6e6373e30df43d245a6b47bb1ce", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzIyNTA2NA==", "url": "https://github.com/apache/flink/pull/11170#discussion_r383225064", "bodyText": "nit: remove double empty line", "author": "twalthr", "createdAt": "2020-02-24T11:58:31Z", "path": "flink-table/flink-table-api-scala/src/main/scala/org/apache/flink/table/api/expressionDsl.scala", "diffHunk": "@@ -1257,6 +1257,38 @@ trait ImplicitExpressionConversions {\n     convertArray(array)\n   }\n \n+  // ----------------------------------------------------------------------------------------------\n+  // Function calls\n+  // ----------------------------------------------------------------------------------------------\n+\n+  /**\n+   * A call to a function that will be looked up in a catalog. There are two kinds of functions:\n+   *\n+   *  - System functions - which are identified with one part names\n+   *  - Catalog functions - which are identified always with three parts names\n+   *    (catalog, database, function)\n+   *\n+   * Moreover each function can either be a temporary function or permanent one\n+   * (which is stored in an external catalog).\n+   *\n+   * Based on that two properties the resolution order for looking up a function based on\n+   * the provided `functionName` is following:\n+   *\n+   *  - Temporary system function\n+   *  - System function\n+   *  - Temporary catalog function\n+   *  - Catalog function\n+   *\n+   *", "originalCommit": "e13785504108e6e6373e30df43d245a6b47bb1ce", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzIyNTQ4NA==", "url": "https://github.com/apache/flink/pull/11170#discussion_r383225484", "bodyText": "Should we also offer call(function: FunctionDefinition, ...) or at least call(function: UserDefinedFunction, ...)?", "author": "twalthr", "createdAt": "2020-02-24T11:59:31Z", "path": "flink-table/flink-table-api-scala/src/main/scala/org/apache/flink/table/api/expressionDsl.scala", "diffHunk": "@@ -1257,6 +1257,38 @@ trait ImplicitExpressionConversions {\n     convertArray(array)\n   }\n \n+  // ----------------------------------------------------------------------------------------------\n+  // Function calls\n+  // ----------------------------------------------------------------------------------------------\n+\n+  /**\n+   * A call to a function that will be looked up in a catalog. There are two kinds of functions:\n+   *\n+   *  - System functions - which are identified with one part names\n+   *  - Catalog functions - which are identified always with three parts names\n+   *    (catalog, database, function)\n+   *\n+   * Moreover each function can either be a temporary function or permanent one\n+   * (which is stored in an external catalog).\n+   *\n+   * Based on that two properties the resolution order for looking up a function based on\n+   * the provided `functionName` is following:\n+   *\n+   *  - Temporary system function\n+   *  - System function\n+   *  - Temporary catalog function\n+   *  - Catalog function\n+   *\n+   *\n+   * @see TableEnvironment#useCatalog(String)\n+   * @see TableEnvironment#useDatabase(String)\n+   * @see TableEnvironment#createTemporaryFunction\n+   * @see TableEnvironment#createTemporarySystemFunction\n+   */\n+  def call(path: String, params: Expression*): Expression = {", "originalCommit": "e13785504108e6e6373e30df43d245a6b47bb1ce", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzIzNDI2Ng==", "url": "https://github.com/apache/flink/pull/11170#discussion_r383234266", "bodyText": "Yes, it is already part of the next PR. In this one I wanted to solve only the parsing issues. I needed to add this one method to fix tests.", "author": "dawidwys", "createdAt": "2020-02-24T12:21:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzIyNTQ4NA=="}], "type": "inlineReview"}, {"oid": "6b38701e19f3818b2336f247d5bf183ee48b5abe", "url": "https://github.com/apache/flink/commit/6b38701e19f3818b2336f247d5bf183ee48b5abe", "message": "other comments addressed", "committedDate": "2020-02-24T14:50:02Z", "type": "forcePushed"}, {"oid": "1bbc82f17cc56dade152b0657f745785a6118c1f", "url": "https://github.com/apache/flink/commit/1bbc82f17cc56dade152b0657f745785a6118c1f", "message": "[FLINK-16033][table-api] Fix loosing function identifier in ExpressionResolver rules", "committedDate": "2020-02-24T15:04:20Z", "type": "commit"}, {"oid": "6bef14e4c89dc24d6c202ac0e3315e540bb81bc9", "url": "https://github.com/apache/flink/commit/6bef14e4c89dc24d6c202ac0e3315e540bb81bc9", "message": "[FLINK-16033][table-api] Parse identifiers in FunctionLookup.\n\nThis change effectively enables querying catalogs for catalog functions\nwith qualified names.", "committedDate": "2020-02-24T15:04:20Z", "type": "commit"}, {"oid": "65c4ef141c744fd8a51b17c02861225370f08a79", "url": "https://github.com/apache/flink/commit/65c4ef141c744fd8a51b17c02861225370f08a79", "message": "[FLINK-16033][table-api] Expose catalog lookup function calls in Scala's\nexpression dsl.", "committedDate": "2020-02-24T15:04:47Z", "type": "commit"}, {"oid": "65c4ef141c744fd8a51b17c02861225370f08a79", "url": "https://github.com/apache/flink/commit/65c4ef141c744fd8a51b17c02861225370f08a79", "message": "[FLINK-16033][table-api] Expose catalog lookup function calls in Scala's\nexpression dsl.", "committedDate": "2020-02-24T15:04:47Z", "type": "forcePushed"}]}