{"pr_number": 11073, "pr_title": "[FLINK-15672][build] Migrate to log4j2 ", "pr_createdAt": "2020-02-12T15:49:25Z", "pr_url": "https://github.com/apache/flink/pull/11073", "timeline": [{"oid": "29034cb85769cd69b09b121c4b88f54b4483aafe", "url": "https://github.com/apache/flink/commit/29034cb85769cd69b09b121c4b88f54b4483aafe", "message": "[FLINK-15672][build][tests] Migrate test log4j configurations to log4j2", "committedDate": "2020-02-12T15:50:00Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDU0NjE1Nw==", "url": "https://github.com/apache/flink/pull/11073#discussion_r380546157", "bodyText": "did it already cause a problem? it just looks that in this cases the plugins order is straightforward", "author": "azagrebin", "createdAt": "2020-02-18T09:21:09Z", "path": "flink-dist/pom.xml", "diffHunk": "@@ -623,7 +623,7 @@ under the License.\n \t\t\t\t<executions>\n \t\t\t\t\t<execution>\n \t\t\t\t\t\t<id>unpack-javax-libraries</id>\n-\t\t\t\t\t\t<phase>process-resources</phase>\n+\t\t\t\t\t\t<phase>compile</phase>", "originalCommit": "c12fcd377c584bed78d892e11febfda736f287ed", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTMzOTY2Nw==", "url": "https://github.com/apache/flink/pull/11073#discussion_r381339667", "bodyText": "Broke with the addition of the debug-build profile. The first commit is already on master and I have opened a dedicated PR for the latter commit. I will exclude these commits during the rebase.", "author": "zentol", "createdAt": "2020-02-19T14:50:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDU0NjE1Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDU1OTMxNw==", "url": "https://github.com/apache/flink/pull/11073#discussion_r380559317", "bodyText": "since log4j-to-slf4j is not needed anymore, can its config file META-INF/log4j-provider.properties, adjusted for shading, be deleted?\nThere are also some comments in ElasticsearchSinkITCase classes with probably old mentioning of log4j-to-slf4j which are not relevant or even correct anymore", "author": "azagrebin", "createdAt": "2020-02-18T09:43:50Z", "path": "flink-connectors/flink-connector-elasticsearch5/pom.xml", "diffHunk": "@@ -270,17 +222,6 @@ under the License.\n \t\t\t\t\t\t\t\t\t\t<exclude>META-INF/maven/org.y*/**</exclude>\n \t\t\t\t\t\t\t\t\t</excludes>\n \t\t\t\t\t\t\t\t</filter>\n-\t\t\t\t\t\t\t\t<!--\n-\t\t\t\t\t\t\t\t  Since we relocate the dependency, the paths specified in the providers file\n-\t\t\t\t\t\t\t\t  will be incorrect. We exclude it here, and re-package a new providers file\n-\t\t\t\t\t\t\t\t  with the correct re-located paths.\n-\t\t\t\t\t\t\t\t-->\n-\t\t\t\t\t\t\t\t<filter>\n-\t\t\t\t\t\t\t\t\t<artifact>org.apache.logging.log4j:log4j-to-slf4j</artifact>\n-\t\t\t\t\t\t\t\t\t<excludes>\n-\t\t\t\t\t\t\t\t\t\t<exclude>META-INF/log4j-provider.properties</exclude>", "originalCommit": "d2aa679446b439e7a296418159afcc97e64feefb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTM5MjA4NA==", "url": "https://github.com/apache/flink/pull/11073#discussion_r381392084", "bodyText": "I think we can remove it.", "author": "zentol", "createdAt": "2020-02-19T16:32:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDU1OTMxNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTkwNzAwNg==", "url": "https://github.com/apache/flink/pull/11073#discussion_r381907006", "bodyText": "and comments in tests?", "author": "azagrebin", "createdAt": "2020-02-20T10:19:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDU1OTMxNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTk4NzQxOA==", "url": "https://github.com/apache/flink/pull/11073#discussion_r381987418", "bodyText": "addressed", "author": "zentol", "createdAt": "2020-02-20T13:09:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDU1OTMxNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDU2MDg1Nw==", "url": "https://github.com/apache/flink/pull/11073#discussion_r380560857", "bodyText": "Not sure whether it is relevant but this is not done for ES 2", "author": "azagrebin", "createdAt": "2020-02-18T09:46:19Z", "path": "flink-connectors/flink-connector-elasticsearch5/pom.xml", "diffHunk": "@@ -213,7 +165,7 @@ under the License.\n \t\t\t\t\t\t\t\t\t<excludes>\n \t\t\t\t\t\t\t\t\t\t<!-- keep flink classes as they are (exceptions as above) -->\n \t\t\t\t\t\t\t\t\t\t<exclude>org.apache.flink.**</exclude>\n-\t\t\t\t\t\t\t\t\t\t<exclude>org.apache.log4j.**</exclude> <!-- provided -->\n+\t\t\t\t\t\t\t\t\t\t<exclude>org.apache.logging.log4j.**</exclude> <!-- provided -->", "originalCommit": "d2aa679446b439e7a296418159afcc97e64feefb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTMyODU1MQ==", "url": "https://github.com/apache/flink/pull/11073#discussion_r381328551", "bodyText": "I'll rebase the PR, ES 2 doesn't exist there anymore :P", "author": "zentol", "createdAt": "2020-02-19T14:33:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDU2MDg1Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDU2NzIxOA==", "url": "https://github.com/apache/flink/pull/11073#discussion_r380567218", "bodyText": "nit: weird line order change, also on some other places below", "author": "azagrebin", "createdAt": "2020-02-18T09:56:53Z", "path": "flink-connectors/flink-connector-filesystem/pom.xml", "diffHunk": "@@ -138,8 +152,14 @@ under the License.\n \t\t<dependency>\n \t\t\t<groupId>org.apache.hadoop</groupId>\n \t\t\t<artifactId>hadoop-minikdc</artifactId>\n-\t\t\t<version>${minikdc.version}</version>\n \t\t\t<scope>test</scope>\n+\t\t\t<version>${minikdc.version}</version>", "originalCommit": "d2aa679446b439e7a296418159afcc97e64feefb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTMyODE1Ng==", "url": "https://github.com/apache/flink/pull/11073#discussion_r381328156", "bodyText": "this is true for a lot of files, will adjust them.", "author": "zentol", "createdAt": "2020-02-19T14:33:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDU2NzIxOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDU3NjUzNA==", "url": "https://github.com/apache/flink/pull/11073#discussion_r380576534", "bodyText": "Is this comment relevant only for this exclusion or also for same others?", "author": "azagrebin", "createdAt": "2020-02-18T10:13:16Z", "path": "flink-connectors/flink-connector-kafka-0.10/pom.xml", "diffHunk": "@@ -133,6 +133,14 @@ under the License.\n \t\t\t<artifactId>kafka_${scala.binary.version}</artifactId>\n \t\t\t<version>${kafka.version}</version>\n \t\t\t<scope>test</scope>\n+\t\t\t<exclusions>\n+\t\t\t\t<exclusion>\n+\t\t\t\t\t<!-- conflicts with log4j2, since 2 slf4j bindings are on the classpath\n+\t\t\t\t\t\ttests will use the log4j API bridge defined in root pom instead -->", "originalCommit": "d2aa679446b439e7a296418159afcc97e64feefb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTM5MTE2OA==", "url": "https://github.com/apache/flink/pull/11073#discussion_r381391168", "bodyText": "applies to all exclusions; will remove it here.", "author": "zentol", "createdAt": "2020-02-19T16:31:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDU3NjUzNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTE1NTA4MQ==", "url": "https://github.com/apache/flink/pull/11073#discussion_r381155081", "bodyText": "something unfinished?", "author": "azagrebin", "createdAt": "2020-02-19T09:01:34Z", "path": "flink-test-utils-parent/flink-test-utils-junit/src/main/java/org/apache/flink/testutils/logging/TestLoggerResource.java", "diffHunk": "@@ -0,0 +1,104 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.flink.testutils.logging;\n+\n+import org.apache.logging.log4j.Level;\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.core.Appender;\n+import org.apache.logging.log4j.core.LogEvent;\n+import org.apache.logging.log4j.core.LoggerContext;\n+import org.apache.logging.log4j.core.appender.AbstractAppender;\n+import org.apache.logging.log4j.core.config.AppenderRef;\n+import org.apache.logging.log4j.core.config.LoggerConfig;\n+import org.junit.rules.ExternalResource;\n+\n+import javax.annotation.concurrent.GuardedBy;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+/**\n+ * Utility for auditing logged messages.\n+ *\n+ * <p>When using this class, keep", "originalCommit": "d2aa679446b439e7a296418159afcc97e64feefb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTE1Nzk1Nw==", "url": "https://github.com/apache/flink/pull/11073#discussion_r381157957", "bodyText": "any particular reason to use org.slf4j.event.Level here instead of org.apache.logging.log4j.Level?", "author": "azagrebin", "createdAt": "2020-02-19T09:07:11Z", "path": "flink-test-utils-parent/flink-test-utils-junit/src/main/java/org/apache/flink/testutils/logging/TestLoggerResource.java", "diffHunk": "@@ -0,0 +1,104 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.flink.testutils.logging;\n+\n+import org.apache.logging.log4j.Level;\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.core.Appender;\n+import org.apache.logging.log4j.core.LogEvent;\n+import org.apache.logging.log4j.core.LoggerContext;\n+import org.apache.logging.log4j.core.appender.AbstractAppender;\n+import org.apache.logging.log4j.core.config.AppenderRef;\n+import org.apache.logging.log4j.core.config.LoggerConfig;\n+import org.junit.rules.ExternalResource;\n+\n+import javax.annotation.concurrent.GuardedBy;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+/**\n+ * Utility for auditing logged messages.\n+ *\n+ * <p>When using this class, keep\n+ *\n+ * <p>Implementation note: Make sure to not expose log4j dependencies in the interface of this class to ease updates\n+ * in logging infrastructure.\n+ */\n+public class TestLoggerResource extends ExternalResource {\n+\tprivate static final LoggerContext LOGGER_CONTEXT = (LoggerContext) LogManager.getContext(false);\n+\n+\tprivate final String loggerName;\n+\tprivate final org.slf4j.event.Level level;\n+\n+\tprivate final Object lock = new Object();\n+\n+\t@GuardedBy(\"lock\")\n+\tprivate List<String> loggingEvents;\n+\n+\tpublic TestLoggerResource(Class<?> clazz, org.slf4j.event.Level level) {", "originalCommit": "d2aa679446b439e7a296418159afcc97e64feefb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTMyODg5Mw==", "url": "https://github.com/apache/flink/pull/11073#discussion_r381328893", "bodyText": "yes, to ensure we don't spread log4j compile dependencies to other modules.", "author": "zentol", "createdAt": "2020-02-19T14:34:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTE1Nzk1Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTE2MTYzMQ==", "url": "https://github.com/apache/flink/pull/11073#discussion_r381161631", "bodyText": "Why do we need to exclude logging here if its dependencies have been already marked only for runtime?", "author": "azagrebin", "createdAt": "2020-02-19T09:14:39Z", "path": "flink-quickstart/flink-quickstart-scala/src/main/resources/archetype-resources/pom.xml", "diffHunk": "@@ -122,7 +129,7 @@ under the License.\n \t\t\t\t\t\t\t\t\t<exclude>org.apache.flink:force-shading</exclude>\n \t\t\t\t\t\t\t\t\t<exclude>com.google.code.findbugs:jsr305</exclude>\n \t\t\t\t\t\t\t\t\t<exclude>org.slf4j:*</exclude>\n-\t\t\t\t\t\t\t\t\t<exclude>log4j:*</exclude>\n+\t\t\t\t\t\t\t\t\t<exclude>org.apache.logging.log4j:*</exclude>", "originalCommit": "d2aa679446b439e7a296418159afcc97e64feefb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTMyOTQ4Nw==", "url": "https://github.com/apache/flink/pull/11073#discussion_r381329487", "bodyText": "Only provided dependencies are excluded by the shade-plugin by default. I'm not sure why the dependencies are marked as runtime and not provided, maybe this makes it more convenient to run in the job in the IDE.", "author": "zentol", "createdAt": "2020-02-19T14:35:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTE2MTYzMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTE2NjQ2NQ==", "url": "https://github.com/apache/flink/pull/11073#discussion_r381166465", "bodyText": "maybe then just e.g. a ConcurrentLinkedQueue?", "author": "azagrebin", "createdAt": "2020-02-19T09:23:37Z", "path": "flink-test-utils-parent/flink-test-utils-junit/src/main/java/org/apache/flink/testutils/logging/TestLoggerResource.java", "diffHunk": "@@ -0,0 +1,104 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.flink.testutils.logging;\n+\n+import org.apache.logging.log4j.Level;\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.core.Appender;\n+import org.apache.logging.log4j.core.LogEvent;\n+import org.apache.logging.log4j.core.LoggerContext;\n+import org.apache.logging.log4j.core.appender.AbstractAppender;\n+import org.apache.logging.log4j.core.config.AppenderRef;\n+import org.apache.logging.log4j.core.config.LoggerConfig;\n+import org.junit.rules.ExternalResource;\n+\n+import javax.annotation.concurrent.GuardedBy;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+/**\n+ * Utility for auditing logged messages.\n+ *\n+ * <p>When using this class, keep\n+ *\n+ * <p>Implementation note: Make sure to not expose log4j dependencies in the interface of this class to ease updates\n+ * in logging infrastructure.\n+ */\n+public class TestLoggerResource extends ExternalResource {\n+\tprivate static final LoggerContext LOGGER_CONTEXT = (LoggerContext) LogManager.getContext(false);\n+\n+\tprivate final String loggerName;\n+\tprivate final org.slf4j.event.Level level;\n+\n+\tprivate final Object lock = new Object();\n+\n+\t@GuardedBy(\"lock\")\n+\tprivate List<String> loggingEvents;", "originalCommit": "d2aa679446b439e7a296418159afcc97e64feefb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTMyOTg5NA==", "url": "https://github.com/apache/flink/pull/11073#discussion_r381329894", "bodyText": "I ran into weird consistency issues on the way and this was the first solution that worked. I'll try ConcurrentLinkedQueue again, maybe the cause was something else.", "author": "zentol", "createdAt": "2020-02-19T14:35:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTE2NjQ2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTE3MzUxMA==", "url": "https://github.com/apache/flink/pull/11073#discussion_r381173510", "bodyText": "do we want to keep this log message for testPassedFromLog4j = true?", "author": "azagrebin", "createdAt": "2020-02-19T09:35:37Z", "path": "flink-yarn-tests/src/test/java/org/apache/flink/yarn/YarnTestBase.java", "diffHunk": "@@ -816,14 +816,7 @@ protected void runWithArgs(String[] args, String terminateAfterString, String[]\n \t\t\t\t}\n \t\t\t}\n \t\t\t// check output for the expected terminateAfterString.\n-\t\t\tif (checkLogForTerminateString) {\n-\t\t\t\tLoggingEvent matchedEvent = UtilsTest.getEventContainingString(terminateAfterString);\n-\t\t\t\tif (matchedEvent != null) {\n-\t\t\t\t\ttestPassedFromLog4j = true;\n-\t\t\t\t\tLOG.info(\"Found expected output in logging event {}\", matchedEvent);", "originalCommit": "d2aa679446b439e7a296418159afcc97e64feefb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTM5MDAzNg==", "url": "https://github.com/apache/flink/pull/11073#discussion_r381390036", "bodyText": "it's a bit of a pain to do; I'll retain it but better take another look.", "author": "zentol", "createdAt": "2020-02-19T16:29:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTE3MzUxMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTE3NTQ2NA==", "url": "https://github.com/apache/flink/pull/11073#discussion_r381175464", "bodyText": "CliFrontend - > FlinkYarnSessionCli?\nNot sure whether we need this though at all", "author": "azagrebin", "createdAt": "2020-02-19T09:38:52Z", "path": "flink-yarn-tests/src/test/java/org/apache/flink/yarn/YARNSessionFIFOITCase.java", "diffHunk": "@@ -60,6 +64,12 @@\n public class YARNSessionFIFOITCase extends YarnTestBase {\n \tprivate static final Logger LOG = LoggerFactory.getLogger(YARNSessionFIFOITCase.class);\n \n+\t@Rule\n+\tpublic final TestLoggerResource cliTestLoggerResource = new TestLoggerResource(CliFrontend.class, Level.INFO);", "originalCommit": "d2aa679446b439e7a296418159afcc97e64feefb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTMzMTI5MA==", "url": "https://github.com/apache/flink/pull/11073#discussion_r381331290", "bodyText": "probably a copy&paste error; should only required in the YARNSessionCapacitySchedulerITCase", "author": "zentol", "createdAt": "2020-02-19T14:37:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTE3NTQ2NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTE4MzQ4Mw==", "url": "https://github.com/apache/flink/pull/11073#discussion_r381183483", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                logger.netty.level = OFF\n          \n          \n            \n                logger.netty.level = ERROR\n          \n      \n    \n    \n  \n\nor there was a reason? also below", "author": "azagrebin", "createdAt": "2020-02-19T09:51:36Z", "path": "docs/ops/deployment/kubernetes.md", "diffHunk": "@@ -133,16 +133,24 @@ data:\n     jobmanager.heap.size: 1024m\n     taskmanager.memory.process.size: 1024m\n   log4j.properties: |+\n-    log4j.rootLogger=INFO, file\n-    log4j.logger.akka=INFO\n-    log4j.logger.org.apache.kafka=INFO\n-    log4j.logger.org.apache.hadoop=INFO\n-    log4j.logger.org.apache.zookeeper=INFO\n-    log4j.appender.file=org.apache.log4j.FileAppender\n-    log4j.appender.file.file=${log.file}\n-    log4j.appender.file.layout=org.apache.log4j.PatternLayout\n-    log4j.appender.file.layout.ConversionPattern=%d{yyyy-MM-dd HH:mm:ss,SSS} %-5p %-60c %x - %m%n\n-    log4j.logger.org.apache.flink.shaded.akka.org.jboss.netty.channel.DefaultChannelPipeline=ERROR, file\n+    rootLogger.level = INFO\n+    rootLogger.appenderRef.file.ref = MainAppender\n+    logger.akka.name = akka\n+    logger.akka.level = INFO\n+    logger.kafka.name= org.apache.kafka\n+    logger.kafka.level = INFO\n+    logger.hadoop.name = org.apache.hadoop\n+    logger.hadoop.level = INFO\n+    logger.zookeeper.name = org.apache.zookeeper\n+    logger.zookeeper.level = INFO\n+    appender.main.name = MainAppender\n+    appender.main.type = File\n+    appender.main.append = false\n+    appender.main.fileName = ${sys:log.file}\n+    appender.main.layout.type = PatternLayout\n+    appender.main.layout.pattern = %d{yyyy-MM-dd HH:mm:ss,SSS} %-5p %-60c %x - %m%n\n+    logger.netty.name = org.apache.flink.shaded.akka.org.jboss.netty.channel.DefaultChannelPipeline\n+    logger.netty.level = OFF", "originalCommit": "afa30bf5f00b6195aed0037ee4b54c40ce07ce27", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTMzNDI0MA==", "url": "https://github.com/apache/flink/pull/11073#discussion_r381334240", "bodyText": "I think I just missed this.", "author": "zentol", "createdAt": "2020-02-19T14:42:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTE4MzQ4Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTE4NDc2NQ==", "url": "https://github.com/apache/flink/pull/11073#discussion_r381184765", "bodyText": "all concrete loggers will inherit rootLogger.appenderRef.file.ref, right?", "author": "azagrebin", "createdAt": "2020-02-19T09:53:49Z", "path": "docs/ops/deployment/kubernetes.md", "diffHunk": "@@ -133,16 +133,24 @@ data:\n     jobmanager.heap.size: 1024m\n     taskmanager.memory.process.size: 1024m\n   log4j.properties: |+\n-    log4j.rootLogger=INFO, file\n-    log4j.logger.akka=INFO\n-    log4j.logger.org.apache.kafka=INFO\n-    log4j.logger.org.apache.hadoop=INFO\n-    log4j.logger.org.apache.zookeeper=INFO\n-    log4j.appender.file=org.apache.log4j.FileAppender\n-    log4j.appender.file.file=${log.file}\n-    log4j.appender.file.layout=org.apache.log4j.PatternLayout\n-    log4j.appender.file.layout.ConversionPattern=%d{yyyy-MM-dd HH:mm:ss,SSS} %-5p %-60c %x - %m%n\n-    log4j.logger.org.apache.flink.shaded.akka.org.jboss.netty.channel.DefaultChannelPipeline=ERROR, file\n+    rootLogger.level = INFO\n+    rootLogger.appenderRef.file.ref = MainAppender\n+    logger.akka.name = akka", "originalCommit": "afa30bf5f00b6195aed0037ee4b54c40ce07ce27", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTMzMTQ4MQ==", "url": "https://github.com/apache/flink/pull/11073#discussion_r381331481", "bodyText": "correct", "author": "zentol", "createdAt": "2020-02-19T14:38:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTE4NDc2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTE4NzA4MA==", "url": "https://github.com/apache/flink/pull/11073#discussion_r381187080", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            appender.console.name = org.apache.log4j.ConsoleAppender\n          \n          \n            \n            appender.console.name = ConsoleAppender\n          \n      \n    \n    \n  \n\nor then also: 'rootLogger.appenderRef.console.ref = org.apache.log4j.ConsoleAppender' above", "author": "azagrebin", "createdAt": "2020-02-19T09:57:46Z", "path": "docs/ops/deployment/native_kubernetes.md", "diffHunk": "@@ -134,15 +134,16 @@ By default, the JobManager and TaskManager only store logs under `/opt/flink/log\n If you want to use `kubectl logs <PodName>` to view the logs, you must perform the following:\n \n 1. Add a new appender to the log4j.properties in the Flink client.\n-2. Update the rootLogger in log4j.properties to `log4j.rootLogger=INFO, file, console`.\n+2. Add the following 'appenderRef' the rootLogger in log4j.properties `rootLogger.appenderRef.console.ref = ConsoleAppender`.\n 3. Remove the redirect args by adding config option `-Dkubernetes.container-start-command-template=\"%java% %classpath% %jvmmem% %jvmopts% %logging% %class% %args%\"`.\n 4. Stop and start your session again. Now you could use `kubectl logs` to view your logs.\n \n {% highlight bash %}\n # Log all infos to the console\n-log4j.appender.console=org.apache.log4j.ConsoleAppender\n-log4j.appender.console.layout=org.apache.log4j.PatternLayout\n-log4j.appender.console.layout.ConversionPattern=%d{yyyy-MM-dd HH:mm:ss,SSS} %-5p %-60c %x - %m%n\n+appender.console.name = org.apache.log4j.ConsoleAppender", "originalCommit": "afa30bf5f00b6195aed0037ee4b54c40ce07ce27", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTE4OTQ5OQ==", "url": "https://github.com/apache/flink/pull/11073#discussion_r381189499", "bodyText": "a bit strange there is different case style for File and CONSOLE appender types", "author": "azagrebin", "createdAt": "2020-02-19T10:01:52Z", "path": "docs/ops/deployment/native_kubernetes.zh.md", "diffHunk": "@@ -134,15 +134,16 @@ By default, the JobManager and TaskManager only store logs under `/opt/flink/log\n If you want to use `kubectl logs <PodName>` to view the logs, you must perform the following:\n \n 1. Add a new appender to the log4j.properties in the Flink client.\n-2. Update the rootLogger in log4j.properties to `log4j.rootLogger=INFO, file, console`.\n+2. Add the following 'appenderRef' the rootLogger in log4j.properties `rootLogger.appenderRef.console.ref = ConsoleAppender`.\n 3. Remove the redirect args by adding config option `-Dkubernetes.container-start-command-template=\"%java% %classpath% %jvmmem% %jvmopts% %logging% %class% %args%\"`.\n 4. Stop and start your session again. Now you could use `kubectl logs` to view your logs.\n \n {% highlight bash %}\n # Log all infos to the console\n-log4j.appender.console=org.apache.log4j.ConsoleAppender\n-log4j.appender.console.layout=org.apache.log4j.PatternLayout\n-log4j.appender.console.layout.ConversionPattern=%d{yyyy-MM-dd HH:mm:ss,SSS} %-5p %-60c %x - %m%n\n+appender.console.name = org.apache.log4j.ConsoleAppender\n+appender.console.type = CONSOLE", "originalCommit": "afa30bf5f00b6195aed0037ee4b54c40ce07ce27", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTMzNjA2MQ==", "url": "https://github.com/apache/flink/pull/11073#discussion_r381336061", "bodyText": "the type is case insensitive, but I generally prefer upper-case to denote log4j constants.", "author": "zentol", "createdAt": "2020-02-19T14:44:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTE4OTQ5OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTM0MDM2MA==", "url": "https://github.com/apache/flink/pull/11073#discussion_r381340360", "bodyText": "I will adjust the type in log4j-cli.properties", "author": "zentol", "createdAt": "2020-02-19T14:51:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTE4OTQ5OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTE5MTM4Mg==", "url": "https://github.com/apache/flink/pull/11073#discussion_r381191382", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            rootLogger.appenderRef.file.ref = FileAppender\n          \n          \n            \n            rootLogger.appenderRef.file.ref = FileLogger", "author": "azagrebin", "createdAt": "2020-02-19T10:05:10Z", "path": "flink-dist/src/main/flink-bin/conf/log4j-cli.properties", "diffHunk": "@@ -16,28 +16,38 @@\n # limitations under the License.\n ################################################################################\n \n-log4j.rootLogger=INFO, file\n+rootLogger.level = INFO\n+rootLogger.appenderRef.file.ref = FileAppender", "originalCommit": "afa30bf5f00b6195aed0037ee4b54c40ce07ce27", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTE5NjcxNA==", "url": "https://github.com/apache/flink/pull/11073#discussion_r381196714", "bodyText": "maybe not much important, but any reason to name it stderr?", "author": "azagrebin", "createdAt": "2020-02-19T10:14:33Z", "path": "flink-dist/src/main/flink-bin/conf/log4j-console.properties", "diffHunk": "@@ -17,23 +17,30 @@\n ################################################################################\n \n # This affects logging for both user code and Flink\n-log4j.rootLogger=INFO, console\n+rootLogger.level = INFO\n+rootLogger.appenderRef.stderr.ref = ConsoleLogger", "originalCommit": "afa30bf5f00b6195aed0037ee4b54c40ce07ce27", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTM0MTIxOA==", "url": "https://github.com/apache/flink/pull/11073#discussion_r381341218", "bodyText": "no, I think this was from earlier attempts at directing the console logger output.", "author": "zentol", "createdAt": "2020-02-19T14:52:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTE5NjcxNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTE5NzAyMg==", "url": "https://github.com/apache/flink/pull/11073#discussion_r381197022", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            rootLogger.appenderRef.stderr.ref = ConsoleLogger\n          \n          \n            \n            rootLogger.appenderRef.stderr.ref = ConsoleAppender", "author": "azagrebin", "createdAt": "2020-02-19T10:15:05Z", "path": "flink-dist/src/main/flink-bin/conf/log4j-console.properties", "diffHunk": "@@ -17,23 +17,30 @@\n ################################################################################\n \n # This affects logging for both user code and Flink\n-log4j.rootLogger=INFO, console\n+rootLogger.level = INFO\n+rootLogger.appenderRef.stderr.ref = ConsoleLogger", "originalCommit": "afa30bf5f00b6195aed0037ee4b54c40ce07ce27", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTE5NzYyMA==", "url": "https://github.com/apache/flink/pull/11073#discussion_r381197620", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            logger.netty.level = OFFlog4j.logger.org.apache.zookeeper=WARN, stdout\n          \n          \n            \n            logger.netty.level = ERROR", "author": "azagrebin", "createdAt": "2020-02-19T10:16:16Z", "path": "flink-dist/src/main/flink-bin/conf/log4j-yarn-session.properties", "diffHunk": "@@ -16,16 +16,20 @@\n # limitations under the License.\n ################################################################################\n \n-log4j.rootLogger=INFO, stdout\n+rootLogger.level = INFO\n+rootLogger.appenderRef.console.ref = ConsoleAppender\n \n-# Log all infos in the given file\n-log4j.appender.stdout=org.apache.log4j.ConsoleAppender\n-log4j.appender.stdout.layout=org.apache.log4j.PatternLayout\n-log4j.appender.stdout.layout.ConversionPattern=%d{yyyy-MM-dd HH:mm:ss,SSS} %-5p %-60c %x - %m%n\n+appender.console.name = ConsoleAppender\n+appender.console.type = CONSOLE\n+appender.console.layout.type = PatternLayout\n+appender.console.layout.pattern = %d{yyyy-MM-dd HH:mm:ss,SSS} %-5p %-60c %x - %m%n\n \n-# suppress the irrelevant (wrong) warnings from the netty channel handler\n-log4j.logger.org.apache.flink.shaded.akka.org.jboss.netty.channel.DefaultChannelPipeline=ERROR, stdout\n-log4j.logger.org.apache.zookeeper=WARN, stdout\n-log4j.logger.org.apache.flink.shaded.org.apache.curator.framework=WARN, stdout\n-log4j.logger.org.apache.flink.runtime.util.ZooKeeperUtils=WARN, stdout\n-log4j.logger.org.apache.flink.runtime.leaderretrieval.ZooKeeperLeaderRetrievalService=WARN, stdout\n+# Suppress the irrelevant (wrong) warnings from the Netty channel handler\n+logger.netty.name = org.apache.flink.shaded.akka.org.jboss.netty.channel.DefaultChannelPipeline\n+logger.netty.level = OFFlog4j.logger.org.apache.zookeeper=WARN, stdout", "originalCommit": "afa30bf5f00b6195aed0037ee4b54c40ce07ce27", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTIxNjMwMQ==", "url": "https://github.com/apache/flink/pull/11073#discussion_r381216301", "bodyText": "is this needed if there is already:\nrootLogger.appenderRef.console.ref = ConsoleAppender\n?\nor this is because levels differ for rootLogger  and sink ?\nalso for scala and LoggerOutputFormat", "author": "azagrebin", "createdAt": "2020-02-19T10:50:43Z", "path": "flink-walkthroughs/flink-walkthrough-datastream-java/src/main/resources/archetype-resources/src/main/resources/log4j2.properties", "diffHunk": "@@ -0,0 +1,29 @@\n+################################################################################\n+#  Licensed to the Apache Software Foundation (ASF) under one\n+#  or more contributor license agreements.  See the NOTICE file\n+#  distributed with this work for additional information\n+#  regarding copyright ownership.  The ASF licenses this file\n+#  to you under the Apache License, Version 2.0 (the\n+#  \"License\"); you may not use this file except in compliance\n+#  with the License.  You may obtain a copy of the License at\n+#\n+#      http://www.apache.org/licenses/LICENSE-2.0\n+#\n+#  Unless required by applicable law or agreed to in writing, software\n+#  distributed under the License is distributed on an \"AS IS\" BASIS,\n+#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+#  See the License for the specific language governing permissions and\n+# limitations under the License.\n+################################################################################\n+\n+rootLogger.level = WARN\n+rootLogger.appenderRef.console.ref = ConsoleAppender\n+\n+logger.sink.name = org.apache.flink.walkthrough.common.sink.AlertSink\n+logger.sink.level = INFO\n+logger.sink.appenderRef.console.ref = ConsoleAppender", "originalCommit": "afa30bf5f00b6195aed0037ee4b54c40ce07ce27", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTM0NTY4MQ==", "url": "https://github.com/apache/flink/pull/11073#discussion_r381345681", "bodyText": "should be redundant.", "author": "zentol", "createdAt": "2020-02-19T14:58:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTIxNjMwMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTIxODg2OQ==", "url": "https://github.com/apache/flink/pull/11073#discussion_r381218869", "bodyText": "it would be nice to have the same naming convention for all file/console appenders", "author": "azagrebin", "createdAt": "2020-02-19T10:55:47Z", "path": "tools/log4j-travis.properties", "diffHunk": "@@ -16,35 +16,52 @@\n # limitations under the License.\n ################################################################################\n \n-log4j.rootLogger=INFO, file\n+rootLogger.level = INFO\n+rootLogger.appenderRef.out.ref = file\n \n # -----------------------------------------------------------------------------\n # Console (use 'console')\n # -----------------------------------------------------------------------------\n-log4j.appender.console=org.apache.log4j.ConsoleAppender\n-log4j.appender.console.layout=org.apache.log4j.PatternLayout\n-log4j.appender.console.layout.ConversionPattern=%d{HH:mm:ss,SSS} [%20t] %-5p %-60c %x - %m%n\n+\n+appender.console.name = console", "originalCommit": "afa30bf5f00b6195aed0037ee4b54c40ce07ce27", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTIxOTM2Mw==", "url": "https://github.com/apache/flink/pull/11073#discussion_r381219363", "bodyText": "true by default?", "author": "azagrebin", "createdAt": "2020-02-19T10:56:42Z", "path": "tools/log4j-travis.properties", "diffHunk": "@@ -16,35 +16,52 @@\n # limitations under the License.\n ################################################################################\n \n-log4j.rootLogger=INFO, file\n+rootLogger.level = INFO\n+rootLogger.appenderRef.out.ref = file\n \n # -----------------------------------------------------------------------------\n # Console (use 'console')\n # -----------------------------------------------------------------------------\n-log4j.appender.console=org.apache.log4j.ConsoleAppender\n-log4j.appender.console.layout=org.apache.log4j.PatternLayout\n-log4j.appender.console.layout.ConversionPattern=%d{HH:mm:ss,SSS} [%20t] %-5p %-60c %x - %m%n\n+\n+appender.console.name = console\n+appender.console.type = CONSOLE\n+appender.console.layout.type = PatternLayout\n+appender.console.layout.pattern = %d{HH:mm:ss,SSS} [%20t] %-5p %-60c %x - %m%n\n \n # -----------------------------------------------------------------------------\n # File (use 'file')\n # -----------------------------------------------------------------------------\n-log4j.appender.file=org.apache.log4j.FileAppender\n-log4j.appender.file.file=${log.dir}/mvn-${mvn.forkNumber}.log\n-log4j.appender.file.append=true", "originalCommit": "afa30bf5f00b6195aed0037ee4b54c40ce07ce27", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTM0NDAyMg==", "url": "https://github.com/apache/flink/pull/11073#discussion_r381344022", "bodyText": "yes", "author": "zentol", "createdAt": "2020-02-19T14:56:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTIxOTM2Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTIyMDg5Ng==", "url": "https://github.com/apache/flink/pull/11073#discussion_r381220896", "bodyText": "maybe also naming convention for logger names containing only some package suffix (e.g. dash separated if needed) or class name or something like that\nI understand names do not matter too much here, just yarn1,2 looks confusing imo", "author": "azagrebin", "createdAt": "2020-02-19T10:59:41Z", "path": "tools/log4j-travis.properties", "diffHunk": "@@ -16,35 +16,52 @@\n # limitations under the License.\n ################################################################################\n \n-log4j.rootLogger=INFO, file\n+rootLogger.level = INFO\n+rootLogger.appenderRef.out.ref = file\n \n # -----------------------------------------------------------------------------\n # Console (use 'console')\n # -----------------------------------------------------------------------------\n-log4j.appender.console=org.apache.log4j.ConsoleAppender\n-log4j.appender.console.layout=org.apache.log4j.PatternLayout\n-log4j.appender.console.layout.ConversionPattern=%d{HH:mm:ss,SSS} [%20t] %-5p %-60c %x - %m%n\n+\n+appender.console.name = console\n+appender.console.type = CONSOLE\n+appender.console.layout.type = PatternLayout\n+appender.console.layout.pattern = %d{HH:mm:ss,SSS} [%20t] %-5p %-60c %x - %m%n\n \n # -----------------------------------------------------------------------------\n # File (use 'file')\n # -----------------------------------------------------------------------------\n-log4j.appender.file=org.apache.log4j.FileAppender\n-log4j.appender.file.file=${log.dir}/mvn-${mvn.forkNumber}.log\n-log4j.appender.file.append=true\n-log4j.appender.file.layout=org.apache.log4j.PatternLayout\n-log4j.appender.file.layout.ConversionPattern=%d{HH:mm:ss,SSS} [%20t] %-5p %-60c %x - %m%n\n+appender.file.name = file\n+appender.file.type = FILE\n+appender.file.fileName = ${sys:log.dir}/mvn-${sys:mvn.forkNumber}.log\n+appender.file.layout.type = PatternLayout\n+appender.file.layout.pattern = %d{HH:mm:ss,SSS} [%20t] %-5p %-60c %x - %m%n\n \n # suppress the irrelevant (wrong) warnings from the netty channel handler\n-log4j.logger.org.jboss.netty.channel.DefaultChannelPipeline=ERROR\n-log4j.logger.org.apache.zookeeper=ERROR\n-log4j.logger.org.apache.zookeeper.server.quorum.QuorumCnxManager=OFF\n-log4j.logger.org.apache.flink.runtime.leaderelection=DEBUG\n-log4j.logger.org.apache.flink.runtime.leaderretrieval=DEBUG\n+logger.netty.name = org.jboss.netty.channel.DefaultChannelPipeline\n+logger.netty.level = ERROR\n+logger.zookeeper.name = org.apache.zookeeper\n+logger.zookeeper.level = ERROR\n+logger.zkquorum.name = org.apache.zookeeper.server.quorum.QuorumCnxManager\n+logger.zkquorum.level = OFF\n+logger.leaderretrieval.name = org.apache.flink.runtime.leaderretrieval\n+logger.leaderretrieval.level = DEBUG\n+logger.leaderelection.name = org.apache.flink.runtime.leaderelection\n+logger.leaderelection.level = DEBUG\n \n # Log a bit when running the flink-yarn-tests to avoid running into the 5 minutes timeout for\n # the tests\n-log4j.logger.org.apache.flink.yarn.YARNSessionFIFOITCase=INFO, console\n-log4j.logger.org.apache.flink.yarn.YARNSessionCapacitySchedulerITCase=INFO, console\n-log4j.logger.org.apache.flink.streaming.connectors.kafka=INFO, console\n-log4j.logger.org.I0Itec.zkclient=INFO, console\n-log4j.logger.org.apache.flink.streaming.connectors.kafka.internals.SimpleConsumerThread=OFF\n+logger.yarn1.name = org.apache.flink.yarn.YARNSessionFIFOITCase", "originalCommit": "afa30bf5f00b6195aed0037ee4b54c40ce07ce27", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTM5OTU0MA==", "url": "https://github.com/apache/flink/pull/11073#discussion_r381399540", "bodyText": "I think it's fine as is for the time being.", "author": "zentol", "createdAt": "2020-02-19T16:43:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTIyMDg5Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTI2ODI5Mw==", "url": "https://github.com/apache/flink/pull/11073#discussion_r381268293", "bodyText": "org.I0Itec was not previously, but DefaultChannelPipeline \nalso other things do not always match the previous state", "author": "azagrebin", "createdAt": "2020-02-19T12:47:29Z", "path": "flink-connectors/flink-connector-kafka-0.10/src/test/resources/log4j2-test.properties", "diffHunk": "@@ -18,13 +18,21 @@\n \n # Set root logger level to OFF to not flood build logs\n # set manually to INFO for debugging purposes\n-log4j.rootLogger=OFF, testlogger\n+rootLogger.level = OFF\n+rootLogger.appenderRef.test.ref = TestLogger\n \n-# A1 is set to be a ConsoleAppender.\n-log4j.appender.testlogger=org.apache.log4j.ConsoleAppender\n-log4j.appender.testlogger.target = System.err\n-log4j.appender.testlogger.layout=org.apache.log4j.PatternLayout\n-log4j.appender.testlogger.layout.ConversionPattern=%-4r [%t] %-5p %c %x - %m%n\n+appender.testlogger.name = TestLogger\n+appender.testlogger.type = CONSOLE\n+appender.testlogger.target = SYSTEM_ERR\n+appender.testlogger.layout.type = PatternLayout\n+appender.testlogger.layout.pattern = %-4r [%t] %-5p %c %x - %m%n\n \n-# suppress the irrelevant (wrong) warnings from the netty channel handler\n-log4j.logger.org.jboss.netty.channel.DefaultChannelPipeline=ERROR, testlogger\n+logger.kafka.name = kafka\n+logger.kafka.level = OFF\n+logger.kafka2.name = state.change\n+logger.kafka2.level = OFF\n+\n+logger.zookeeper.name = org.apache.zookeeper\n+logger.zookeeper.level = OFF\n+logger.I0Itec.name = org.I0Itec", "originalCommit": "29034cb85769cd69b09b121c4b88f54b4483aafe", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTM4MjUwMw==", "url": "https://github.com/apache/flink/pull/11073#discussion_r381382503", "bodyText": "I don't remember where I0Itec came from (must've slipped in from some other module), will remove it.", "author": "zentol", "createdAt": "2020-02-19T16:18:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTI2ODI5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTM4NzEzNw==", "url": "https://github.com/apache/flink/pull/11073#discussion_r381387137", "bodyText": "oh, actually, I noticed this while trying things out. I0Itec is effectively part of ZK; for which we disabled logging, so I also disabled logging for I0Itec.\nYou get message like this:\nINFO  org.I0Itec.zkclient.ZkEventThread [] - Starting ZkClient event thread.\n\nAs such, I'll keep it as is.", "author": "zentol", "createdAt": "2020-02-19T16:25:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTI2ODI5Mw=="}], "type": "inlineReview"}, {"oid": "a214fcca8d4557d2e4962a713cd8f2d9caf1d5cd", "url": "https://github.com/apache/flink/commit/a214fcca8d4557d2e4962a713cd8f2d9caf1d5cd", "message": "remove obsolete provider file", "committedDate": "2020-02-19T16:41:50Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTkwMzU2NA==", "url": "https://github.com/apache/flink/pull/11073#discussion_r381903564", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            appender.console.name = ConsoleAppenderW\n          \n          \n            \n            appender.console.name = ConsoleAppender", "author": "azagrebin", "createdAt": "2020-02-20T10:13:36Z", "path": "docs/ops/deployment/native_kubernetes.md", "diffHunk": "@@ -140,7 +140,7 @@ If you want to use `kubectl logs <PodName>` to view the logs, you must perform t\n \n {% highlight bash %}\n # Log all infos to the console\n-appender.console.name = org.apache.log4j.ConsoleAppender\n+appender.console.name = ConsoleAppenderW", "originalCommit": "acdbe3a5b41c7c9a0ac20b74a36633d977de7881", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTkwNjQ1Mg==", "url": "https://github.com/apache/flink/pull/11073#discussion_r381906452", "bodyText": "will it not throw if the stream is empty after the filtering?", "author": "azagrebin", "createdAt": "2020-02-20T10:18:44Z", "path": "flink-yarn-tests/src/test/java/org/apache/flink/yarn/YarnTestBase.java", "diffHunk": "@@ -817,7 +817,12 @@ protected void runWithArgs(String[] args, String terminateAfterString, String[]\n \t\t\t\t}\n \t\t\t}\n \t\t\t// check output for the expected terminateAfterString.\n-\t\t\ttestPassedFromLog4j = logMessageSupplier.get().stream().anyMatch(s -> s.contains(terminateAfterString));\n+\t\t\ttestPassedFromLog4j = logMessageSupplier.get().stream()\n+\t\t\t\t.filter(s -> s.contains(terminateAfterString))\n+\t\t\t\t.limit(1)", "originalCommit": "3e8fd83e7450b1b408661d7d259a47cd83473ce1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTkwODQxOA==", "url": "https://github.com/apache/flink/pull/11073#discussion_r381908418", "bodyText": "maybe just good old loop :)", "author": "azagrebin", "createdAt": "2020-02-20T10:22:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTkwNjQ1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTkxMTM0MA==", "url": "https://github.com/apache/flink/pull/11073#discussion_r381911340", "bodyText": "I see no such behavior documented in the javadocs, it just limits the max size. Minimum size should be irrelevant.", "author": "zentol", "createdAt": "2020-02-20T10:27:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTkwNjQ1Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTk5OTQ4MQ==", "url": "https://github.com/apache/flink/pull/11073#discussion_r381999481", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            In the IDE this means to replacing such dependencies defined in your pom, and possible adding exclusions on dependencies that transitively depend on them.\n          \n          \n            \n            In the IDE this means you have to replace such dependencies defined in your pom, and possible adding exclusions on dependencies that transitively depend on them.", "author": "azagrebin", "createdAt": "2020-02-20T13:33:07Z", "path": "docs/monitoring/logging.md", "diffHunk": "@@ -38,6 +38,23 @@ Flink ships with the following default properties files:\n - `log4j-yarn-session.properties`: Used by the Flink command line client when starting a YARN session (`yarn-session.sh`)\n - `log4j.properties`: JobManager/Taskmanager logs (both standalone and YARN)\n \n+### Compatibility with Log4j1\n+\n+Flink ships with the [Log4j API bridge](https://logging.apache.org/log4j/log4j-2.2/log4j-1.2-api/index.html), allowing existing applications that work against Log4j1 classes to continue working.\n+\n+If you have custom Log4j1 properties files or code that relies on Log4j1, please check out the official Log4j [compatibility](https://logging.apache.org/log4j/2.x/manual/compatibility.html) and [migration](https://logging.apache.org/log4j/2.x/manual/migration.html) guides.\n+\n+## Configuring Log4j1\n+\n+To use Flink with Log4j1 you must ensure that:\n+- `org.apache.logging.log4j:log4j-slf4j-impl` and `org.apache.logging.log4j:log4j-1.2-api` are not on the classpath,\n+- `org.slf4j:slf4j-log4j12`and `log4j:log4j` are on the classpath.\n+\n+In the IDE this means to replacing such dependencies defined in your pom, and possible adding exclusions on dependencies that transitively depend on them.", "originalCommit": "cc0a443df07fd97291c40b32dab427584600a37e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjAwMDAzOA==", "url": "https://github.com/apache/flink/pull/11073#discussion_r382000038", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            For Flink distributions this means to replace the respective jars in the `lib` directory, and\n          \n          \n            \n            For Flink distributions this means you have to to replace the respective jars in the `lib` directory, and", "author": "azagrebin", "createdAt": "2020-02-20T13:34:05Z", "path": "docs/monitoring/logging.md", "diffHunk": "@@ -38,6 +38,23 @@ Flink ships with the following default properties files:\n - `log4j-yarn-session.properties`: Used by the Flink command line client when starting a YARN session (`yarn-session.sh`)\n - `log4j.properties`: JobManager/Taskmanager logs (both standalone and YARN)\n \n+### Compatibility with Log4j1\n+\n+Flink ships with the [Log4j API bridge](https://logging.apache.org/log4j/log4j-2.2/log4j-1.2-api/index.html), allowing existing applications that work against Log4j1 classes to continue working.\n+\n+If you have custom Log4j1 properties files or code that relies on Log4j1, please check out the official Log4j [compatibility](https://logging.apache.org/log4j/2.x/manual/compatibility.html) and [migration](https://logging.apache.org/log4j/2.x/manual/migration.html) guides.\n+\n+## Configuring Log4j1\n+\n+To use Flink with Log4j1 you must ensure that:\n+- `org.apache.logging.log4j:log4j-slf4j-impl` and `org.apache.logging.log4j:log4j-1.2-api` are not on the classpath,\n+- `org.slf4j:slf4j-log4j12`and `log4j:log4j` are on the classpath.\n+\n+In the IDE this means to replacing such dependencies defined in your pom, and possible adding exclusions on dependencies that transitively depend on them.\n+\n+For Flink distributions this means to replace the respective jars in the `lib` directory, and", "originalCommit": "cc0a443df07fd97291c40b32dab427584600a37e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjAwMDM3NQ==", "url": "https://github.com/apache/flink/pull/11073#discussion_r382000375", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            replacing all log4j properties files in the `conf` directory with Log4j1-compliant versions.\n          \n          \n            \n            all log4j properties files in the `conf` directory with Log4j1-compliant versions.", "author": "azagrebin", "createdAt": "2020-02-20T13:34:40Z", "path": "docs/monitoring/logging.md", "diffHunk": "@@ -38,6 +38,23 @@ Flink ships with the following default properties files:\n - `log4j-yarn-session.properties`: Used by the Flink command line client when starting a YARN session (`yarn-session.sh`)\n - `log4j.properties`: JobManager/Taskmanager logs (both standalone and YARN)\n \n+### Compatibility with Log4j1\n+\n+Flink ships with the [Log4j API bridge](https://logging.apache.org/log4j/log4j-2.2/log4j-1.2-api/index.html), allowing existing applications that work against Log4j1 classes to continue working.\n+\n+If you have custom Log4j1 properties files or code that relies on Log4j1, please check out the official Log4j [compatibility](https://logging.apache.org/log4j/2.x/manual/compatibility.html) and [migration](https://logging.apache.org/log4j/2.x/manual/migration.html) guides.\n+\n+## Configuring Log4j1\n+\n+To use Flink with Log4j1 you must ensure that:\n+- `org.apache.logging.log4j:log4j-slf4j-impl` and `org.apache.logging.log4j:log4j-1.2-api` are not on the classpath,\n+- `org.slf4j:slf4j-log4j12`and `log4j:log4j` are on the classpath.\n+\n+In the IDE this means to replacing such dependencies defined in your pom, and possible adding exclusions on dependencies that transitively depend on them.\n+\n+For Flink distributions this means to replace the respective jars in the `lib` directory, and\n+replacing all log4j properties files in the `conf` directory with Log4j1-compliant versions.", "originalCommit": "cc0a443df07fd97291c40b32dab427584600a37e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjAwMTY2Nw==", "url": "https://github.com/apache/flink/pull/11073#discussion_r382001667", "bodyText": "Maybe also a note that native log4j2 deps should stay in /lib for ES", "author": "azagrebin", "createdAt": "2020-02-20T13:37:05Z", "path": "docs/monitoring/logging.md", "diffHunk": "@@ -38,6 +38,23 @@ Flink ships with the following default properties files:\n - `log4j-yarn-session.properties`: Used by the Flink command line client when starting a YARN session (`yarn-session.sh`)\n - `log4j.properties`: JobManager/Taskmanager logs (both standalone and YARN)\n \n+### Compatibility with Log4j1\n+\n+Flink ships with the [Log4j API bridge](https://logging.apache.org/log4j/log4j-2.2/log4j-1.2-api/index.html), allowing existing applications that work against Log4j1 classes to continue working.\n+\n+If you have custom Log4j1 properties files or code that relies on Log4j1, please check out the official Log4j [compatibility](https://logging.apache.org/log4j/2.x/manual/compatibility.html) and [migration](https://logging.apache.org/log4j/2.x/manual/migration.html) guides.\n+\n+## Configuring Log4j1\n+\n+To use Flink with Log4j1 you must ensure that:\n+- `org.apache.logging.log4j:log4j-slf4j-impl` and `org.apache.logging.log4j:log4j-1.2-api` are not on the classpath,\n+- `org.slf4j:slf4j-log4j12`and `log4j:log4j` are on the classpath.\n+\n+In the IDE this means to replacing such dependencies defined in your pom, and possible adding exclusions on dependencies that transitively depend on them.\n+\n+For Flink distributions this means to replace the respective jars in the `lib` directory, and\n+replacing all log4j properties files in the `conf` directory with Log4j1-compliant versions.\n+", "originalCommit": "cc0a443df07fd97291c40b32dab427584600a37e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjA0ODE0Mg==", "url": "https://github.com/apache/flink/pull/11073#discussion_r382048142", "bodyText": "I'd prefer not to reference ES directly since such a statement is easily out-dated, or rather insufficient.\nBut I'll add a note that log4j-api must remain in /lib.", "author": "zentol", "createdAt": "2020-02-20T14:51:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjAwMTY2Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjExNjQ2Ng==", "url": "https://github.com/apache/flink/pull/11073#discussion_r382116466", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            In the IDE this means you have to replace such dependencies defined in your pom, and possible add exclusions on dependencies that transitively depend on them.\n          \n          \n            \n            In the IDE this means you have to replace such dependencies defined in your pom, and possibly add exclusions on dependencies that transitively depend on them.", "author": "azagrebin", "createdAt": "2020-02-20T16:34:18Z", "path": "docs/monitoring/logging.md", "diffHunk": "@@ -47,13 +47,15 @@ If you have custom Log4j1 properties files or code that relies on Log4j1, please\n ## Configuring Log4j1\n \n To use Flink with Log4j1 you must ensure that:\n-- `org.apache.logging.log4j:log4j-slf4j-impl` and `org.apache.logging.log4j:log4j-1.2-api` are not on the classpath,\n-- `org.slf4j:slf4j-log4j12`and `log4j:log4j` are on the classpath.\n+- `org.apache.logging.log4j:log4j-core`, `org.apache.logging.log4j:log4j-slf4j-impl` and `org.apache.logging.log4j:log4j-1.2-api` are not on the classpath,\n+- `log4j:log4j`, `org.slf4j:slf4j-log4j12`, `org.apache.logging.log4j:log4j-to-slf4j` and `org.apache.logging.log4j:log4j-api` are on the classpath.\n \n-In the IDE this means to replacing such dependencies defined in your pom, and possible adding exclusions on dependencies that transitively depend on them.\n+In the IDE this means you have to replace such dependencies defined in your pom, and possible add exclusions on dependencies that transitively depend on them.", "originalCommit": "ad174d1c0b5584c3ec74167f75c4d48b44cef657", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "61bb4cb16196729d63bf44071bb2aef63a8b5457", "url": "https://github.com/apache/flink/commit/61bb4cb16196729d63bf44071bb2aef63a8b5457", "message": "[FLINK-15672][build] Migrate to log4j2", "committedDate": "2020-02-21T10:37:18Z", "type": "commit"}, {"oid": "f911d085f42f3077eb8742ea54577a54089f2222", "url": "https://github.com/apache/flink/commit/f911d085f42f3077eb8742ea54577a54089f2222", "message": "[FLINK-15672][build] Migrate production log4j configuration to log4j2", "committedDate": "2020-02-21T10:37:18Z", "type": "commit"}, {"oid": "c0fa7ff0de573f9be8aaebe6791dbc5b9dc0fb74", "url": "https://github.com/apache/flink/commit/c0fa7ff0de573f9be8aaebe6791dbc5b9dc0fb74", "message": "[FLINK-15672][build][tests] Migrate test log4j configurations to log4j2", "committedDate": "2020-02-21T10:37:19Z", "type": "commit"}, {"oid": "c0fa7ff0de573f9be8aaebe6791dbc5b9dc0fb74", "url": "https://github.com/apache/flink/commit/c0fa7ff0de573f9be8aaebe6791dbc5b9dc0fb74", "message": "[FLINK-15672][build][tests] Migrate test log4j configurations to log4j2", "committedDate": "2020-02-21T10:37:19Z", "type": "forcePushed"}]}