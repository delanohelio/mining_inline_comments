{"pr_number": 12077, "pr_title": "[FLINK-17612][python][sql-client] add the parse logic of Python command line options to CliOptionsParser in SQL Client.", "pr_createdAt": "2020-05-11T09:47:04Z", "pr_url": "https://github.com/apache/flink/pull/12077", "timeline": [{"oid": "a0ce1305bb81f7b3ccbef8b097e9c54135f43f6a", "url": "https://github.com/apache/flink/commit/a0ce1305bb81f7b3ccbef8b097e9c54135f43f6a", "message": "[FLINK-17612][python][sql-client] add the parse logic of Python command line options to CliOptionsParser in SQL Client.", "committedDate": "2020-05-11T09:40:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzQ3MDc0Ng==", "url": "https://github.com/apache/flink/pull/12077#discussion_r423470746", "bodyText": "Change to Failed to parse the Python command line options?", "author": "dianfu", "createdAt": "2020-05-12T05:30:33Z", "path": "flink-table/flink-sql-client/src/main/java/org/apache/flink/table/client/cli/CliOptionsParser.java", "diffHunk": "@@ -331,4 +354,18 @@ private static String checkSessionId(CommandLine line) {\n \t\t}\n \t\treturn sessionId;\n \t}\n+\n+\tprivate static Configuration getPythonConfiguration(CommandLine line) {\n+\t\ttry {\n+\t\t\tClass<?> clazz = Class.forName(\n+\t\t\t\t\"org.apache.flink.python.util.PythonDependencyUtils\",\n+\t\t\t\ttrue,\n+\t\t\t\tThread.currentThread().getContextClassLoader());\n+\t\t\tMethod parsePythonDependencyConfiguration =\n+\t\t\t\tclazz.getMethod(\"parsePythonDependencyConfiguration\", CommandLine.class);\n+\t\t\treturn (Configuration) parsePythonDependencyConfiguration.invoke(null, line);\n+\t\t} catch (ClassNotFoundException | NoSuchMethodException | IllegalAccessException | InvocationTargetException e) {\n+\t\t\tthrow new SqlClientException(\"Parse the Python command line options failed.\", e);", "originalCommit": "a0ce1305bb81f7b3ccbef8b097e9c54135f43f6a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzQ3NDg1OA==", "url": "https://github.com/apache/flink/pull/12077#discussion_r423474858", "bodyText": "could use the enrich method defined in Environment as following:\nfinal Environment sessionEnvWithPythonConfiguration = Environment.enrich( sessionEnv, options.getPythonConfiguration().toMap(), Collections.emptyMap());", "author": "dianfu", "createdAt": "2020-05-12T05:44:55Z", "path": "flink-table/flink-sql-client/src/main/java/org/apache/flink/table/client/SqlClient.java", "diffHunk": "@@ -90,6 +96,7 @@ private void start() {\n \n \t\t\t// create CLI client with session environment\n \t\t\tfinal Environment sessionEnv = readSessionEnvironment(options.getEnvironment());\n+\t\t\tappendPythonConfig(sessionEnv, options.getPythonConfiguration());", "originalCommit": "a0ce1305bb81f7b3ccbef8b097e9c54135f43f6a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzQ3OTI3Mw==", "url": "https://github.com/apache/flink/pull/12077#discussion_r423479273", "bodyText": "It seems the enrich() method of the ConfigurationEntry only accepts the configurations that start with \"table.\". As the python configurations all start with \"python.\", the enrich method does not work for python configurations.", "author": "WeiZhong94", "createdAt": "2020-05-12T05:58:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzQ3NDg1OA=="}], "type": "inlineReview"}, {"oid": "826be85a1c9d715a519b8558dcbc71ee1b035214", "url": "https://github.com/apache/flink/commit/826be85a1c9d715a519b8558dcbc71ee1b035214", "message": "address comments.", "committedDate": "2020-05-12T06:00:03Z", "type": "commit"}, {"oid": "ee1f95cb56f232f916e4b5f9b6f26b8abf02ec35", "url": "https://github.com/apache/flink/commit/ee1f95cb56f232f916e4b5f9b6f26b8abf02ec35", "message": "update the sql client doc for the python command options", "committedDate": "2020-05-12T09:14:38Z", "type": "commit"}]}