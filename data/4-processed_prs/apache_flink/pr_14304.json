{"pr_number": 14304, "pr_title": "[FLINK-20353][docs][logging] Update logging documentation", "pr_createdAt": "2020-12-03T15:45:43Z", "pr_url": "https://github.com/apache/flink/pull/14304", "timeline": [{"oid": "aa48a945c6d276f7efe987e8e79441b8740ae1b2", "url": "https://github.com/apache/flink/commit/aa48a945c6d276f7efe987e8e79441b8740ae1b2", "message": "[FLINK-20353][docs][logging] Update logging documentation\n\nGeneral:\n- adjust project names based on phrasing on their repsective homepage\n- add links for all mentioned frameworks\n- add introduction for what logging is about\n- rename \"command line client\" to \"command line interface\"\n\nLog4j:\n- omit some details about JVM options being set automatically\n- list missing log4j-console.properties file\n\nLogback:\n- sync logback structure with log4j sections\n- add explicit instructions on which jars should be removed/added\n- remove logback.xml configuration example\n- add note about logback 1.3+ not being supported\n\nSlf4j:\n- extend the example to a runnable application\n- add note that the logger should be 'private static final'", "committedDate": "2020-12-03T15:44:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzUzNzc2Ng==", "url": "https://github.com/apache/flink/pull/14304#discussion_r537537766", "bodyText": "Isn't log4j:log4j the same as org.apache.logging.log4j:log4j-core?", "author": "tillrohrmann", "createdAt": "2020-12-07T14:13:44Z", "path": "docs/deployment/advanced/logging.md", "diffHunk": "@@ -23,30 +23,39 @@ specific language governing permissions and limitations\n under the License.\n -->\n \n-The logging in Flink is implemented using the slf4j logging interface. As underlying logging framework, log4j2 is used. We also provide logback configuration files and pass them to the JVM's as properties. Users willing to use logback instead of log4j2 can just exclude log4j2 (or delete it from the lib/ folder).\n+All Flink processes create a log text file that contains messages for various events happening in that process.\n+These logs provide deep insights into the inner workings of Flink, and can be used to detect problems (in the form of WARN/ERROR messages) and can help in debugging them.\n+\n+The log files can be accessed via the Job-/TaskManager pages of the WebUI. The used [Resource Provider]({% link deployment/resource-providers/index.md %}) (e.g., YARN) may provide additional means of accessing them.\n+\n+The logging in Flink uses the [SLF4J](http://www.slf4j.org/) logging interface.\n+This allows you to use any logging framework that supports SLF4J, without having to modify the Flink source code.\n+\n+By default, [Log4j 2](https://logging.apache.org/log4j/2.x/index.html) is used as the underlying logging framework.\n \n * This will be replaced by the TOC\n {:toc}\n \n-## Configuring Log4j2\n+## Configuring Log4j 2\n \n-Log4j2 is controlled using property files. In Flink's case, the file is usually called `log4j.properties`. We pass the filename and location of this file using the `-Dlog4j.configurationFile=` parameter to the JVM.\n+Log4j 2 is controlled using property files.\n \n-Flink ships with the following default properties files:\n+The Flink distribution ships with the following log4j properties files in the `conf` directory, which are used automatically if log4j 2 is enabled:\n \n-- `log4j-cli.properties`: Used by the Flink command line client (e.g. `flink run`) (not code executed on the cluster)\n-- `log4j-session.properties`: Used by the Flink command line client when starting a YARN or Kubernetes session (`yarn-session.sh`, `kubernetes-session.sh`)\n-- `log4j.properties`: JobManager/Taskmanager logs (both standalone and YARN)\n+- `log4j-cli.properties`: used by the command line interface (e.g., `flink run`)\n+- `log4j-session.properties`: used by the command line interface when starting a Kubernetes/Yarn session cluster (i.e., `kubernetes-session.sh`/`yarn-session.sh`)\n+- `log4j-console.properties`: used for Job-/TaskManagers if they are run in the foreground (e.g., Kubernetes)\n+- `log4j.properties`: used for Job-/TaskManagers by default\n \n-### Compatibility with Log4j1\n+### Compatibility with Log4j 1\n \n Flink ships with the [Log4j API bridge](https://logging.apache.org/log4j/log4j-2.2/log4j-1.2-api/index.html), allowing existing applications that work against Log4j1 classes to continue working.\n \n-If you have custom Log4j1 properties files or code that relies on Log4j1, please check out the official Log4j [compatibility](https://logging.apache.org/log4j/2.x/manual/compatibility.html) and [migration](https://logging.apache.org/log4j/2.x/manual/migration.html) guides.\n+If you have custom Log4j 1 properties files or code that relies on Log4j 1, please check out the official Log4j [compatibility](https://logging.apache.org/log4j/2.x/manual/compatibility.html) and [migration](https://logging.apache.org/log4j/2.x/manual/migration.html) guides.\n \n ## Configuring Log4j1\n \n-To use Flink with Log4j1 you must ensure that:\n+To use Flink with [Log4j 1](https://logging.apache.org/log4j/1.2/) you must ensure that:\n - `org.apache.logging.log4j:log4j-core`, `org.apache.logging.log4j:log4j-slf4j-impl` and `org.apache.logging.log4j:log4j-1.2-api` are not on the classpath,\n - `log4j:log4j`, `org.slf4j:slf4j-log4j12`, `org.apache.logging.log4j:log4j-to-slf4j` and `org.apache.logging.log4j:log4j-api` are on the classpath.", "originalCommit": "aa48a945c6d276f7efe987e8e79441b8740ae1b2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzU2OTE4MQ==", "url": "https://github.com/apache/flink/pull/14304#discussion_r537569181", "bodyText": "no.\nSemantically, log4j:log4j is equivalent to the union of org.apache.logging.log4j:log4j-core and org.apache.logging.log4j:log4j-api .\nThe packages for all classes are also different (org.apache.log4j vs org.apache.logging.log4j)", "author": "zentol", "createdAt": "2020-12-07T14:54:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzUzNzc2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzU3MTY2Nw==", "url": "https://github.com/apache/flink/pull/14304#discussion_r537571667", "bodyText": "In case you are wondering why org.apache.logging.log4j:log4j-api is also required for log4j1: This is because some dependencies directly work against log4j2 (iirc kinesis or elasticsearch), and will fail with CNFEs if the API is not accessible.\nI don't quite remember whether the affected classes would be able to log anything though.", "author": "zentol", "createdAt": "2020-12-07T14:57:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzUzNzc2Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzU0MzE3OQ==", "url": "https://github.com/apache/flink/pull/14304#discussion_r537543179", "bodyText": "Maybe state that the default log4j 2 configuration has set the monitorInterval to 30.", "author": "tillrohrmann", "createdAt": "2020-12-07T14:20:57Z", "path": "docs/deployment/advanced/logging.md", "diffHunk": "@@ -23,30 +23,39 @@ specific language governing permissions and limitations\n under the License.\n -->\n \n-The logging in Flink is implemented using the slf4j logging interface. As underlying logging framework, log4j2 is used. We also provide logback configuration files and pass them to the JVM's as properties. Users willing to use logback instead of log4j2 can just exclude log4j2 (or delete it from the lib/ folder).\n+All Flink processes create a log text file that contains messages for various events happening in that process.\n+These logs provide deep insights into the inner workings of Flink, and can be used to detect problems (in the form of WARN/ERROR messages) and can help in debugging them.\n+\n+The log files can be accessed via the Job-/TaskManager pages of the WebUI. The used [Resource Provider]({% link deployment/resource-providers/index.md %}) (e.g., YARN) may provide additional means of accessing them.\n+\n+The logging in Flink uses the [SLF4J](http://www.slf4j.org/) logging interface.\n+This allows you to use any logging framework that supports SLF4J, without having to modify the Flink source code.\n+\n+By default, [Log4j 2](https://logging.apache.org/log4j/2.x/index.html) is used as the underlying logging framework.\n \n * This will be replaced by the TOC\n {:toc}\n \n-## Configuring Log4j2\n+## Configuring Log4j 2\n \n-Log4j2 is controlled using property files. In Flink's case, the file is usually called `log4j.properties`. We pass the filename and location of this file using the `-Dlog4j.configurationFile=` parameter to the JVM.\n+Log4j 2 is controlled using property files.", "originalCommit": "aa48a945c6d276f7efe987e8e79441b8740ae1b2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "aa1ef877b83b780d97fcfcb558a6bbf3489d508f", "url": "https://github.com/apache/flink/commit/aa1ef877b83b780d97fcfcb558a6bbf3489d508f", "message": "+naming", "committedDate": "2020-12-08T10:31:49Z", "type": "commit"}, {"oid": "f9221a2432825b663273f3e1f17a46d9f10c5161", "url": "https://github.com/apache/flink/commit/f9221a2432825b663273f3e1f17a46d9f10c5161", "message": "Document monitorInterval", "committedDate": "2020-12-08T10:32:00Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODMwMDUyNA==", "url": "https://github.com/apache/flink/pull/14304#discussion_r538300524", "bodyText": "I think we can add a semicolon at the end and it's the best to change the import order according to checkstyle.", "author": "V1ncentzzZ", "createdAt": "2020-12-08T12:15:51Z", "path": "docs/deployment/advanced/logging.md", "diffHunk": "@@ -59,49 +71,47 @@ For Flink distributions this means you have to\n \n ## Configuring logback\n \n-For users and developers alike it is important to control the logging framework.\n-The configuration of the logging framework is exclusively done by configuration files.\n-The configuration file either has to be specified by setting the environment property `-Dlogback.configurationFile=<file>` or by putting `logback.xml` in the classpath.\n-The `conf` directory contains a `logback.xml` file which can be modified and is used if Flink is started outside of an IDE and with the provided starting scripts.\n-The provided `logback.xml` has the following form:\n-\n-{% highlight xml %}\n-<configuration>\n-    <appender name=\"file\" class=\"ch.qos.logback.core.FileAppender\">\n-        <file>${log.file}</file>\n-        <append>false</append>\n-        <encoder>\n-            <pattern>%d{HH:mm:ss.SSS} [%thread] %-5level %logger{60} %X{sourceThread} - %msg%n</pattern>\n-        </encoder>\n-    </appender>\n-\n-    <root level=\"INFO\">\n-        <appender-ref ref=\"file\"/>\n-    </root>\n-</configuration>\n-{% endhighlight %}\n+To use Flink with [logback](https://logback.qos.ch/) you must ensure that:\n+- `org.apache.logging.log4j:log4j-slf4j-impl` is not on the classpath,\n+- `ch.qos.logback:logback-core` and `ch.qos.logback:logback-classic` are on the classpath.\n \n-In order to control the logging level of `org.apache.flink.runtime.jobgraph.JobGraph`, for example, one would have to add the following line to the configuration file.\n+In the IDE this means you have to replace such dependencies defined in your pom, and possibly add exclusions on dependencies that transitively depend on them.\n \n-{% highlight xml %}\n-<logger name=\"org.apache.flink.runtime.jobgraph.JobGraph\" level=\"DEBUG\"/>\n-{% endhighlight %}\n+For Flink distributions this means you have to\n+- remove the `log4j-slf4j-impl` jar from the `lib` directory,\n+- add the `logback-core`, and `logback-classic` jars to the `lib` directory.\n+\n+The Flink distribution ships with the following logback configuration files in the `conf` directory, which are used automatically if logback is enabled:\n+- `logback-session.properties`: used by the command line interface when starting a Kubernetes/Yarn session cluster (i.e., `kubernetes-session.sh`/`yarn-session.sh`)\n+- `logback-console.properties`: used for Job-/TaskManagers if they are run in the foreground (e.g., Kubernetes)\n+- `logback.xml`: used for command line interface and Job-/TaskManagers by default\n \n-For further information on configuring logback see [LOGback's manual](http://logback.qos.ch/manual/configuration.html).\n+<div class=\"alert alert-info\" markdown=\"span\">\n+  <strong>Note:</strong> Logback 1.3+ requires SLF4J 2, which is currently not supported.\n+</div>\n \n ## Best practices for developers\n \n-The loggers using slf4j are created by calling\n+You can create an SLF4J logger by calling `org.slf4j.LoggerFactory#LoggerFactory.getLogger` with the `Class` of your class as an argument.\n+\n+We highly recommend storing this logger in a `private static final` field.\n \n {% highlight java %}\n import org.slf4j.LoggerFactory\n import org.slf4j.Logger", "originalCommit": "f9221a2432825b663273f3e1f17a46d9f10c5161", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODU0MDc2OQ==", "url": "https://github.com/apache/flink/pull/14304#discussion_r538540769", "bodyText": "good idea", "author": "zentol", "createdAt": "2020-12-08T16:05:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODMwMDUyNA=="}], "type": "inlineReview"}, {"oid": "bff98bfb36cb87bd3a988b2dbbdf6750641e13ce", "url": "https://github.com/apache/flink/commit/bff98bfb36cb87bd3a988b2dbbdf6750641e13ce", "message": "adjust imports", "committedDate": "2020-12-08T16:04:10Z", "type": "commit"}]}