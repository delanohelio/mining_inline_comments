{"pr_number": 11026, "pr_title": "[FLINK-15811][task] report CancelTaskException from SourceStreamTask", "pr_createdAt": "2020-02-05T13:19:46Z", "pr_url": "https://github.com/apache/flink/pull/11026", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTI1NDQ3OA==", "url": "https://github.com/apache/flink/pull/11026#discussion_r375254478", "bodyText": "We probably need to restore interruption flag Thread.interrupt().", "author": "AHeise", "createdAt": "2020-02-05T13:30:35Z", "path": "flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/tasks/SourceStreamTask.java", "diffHunk": "@@ -121,10 +123,12 @@ protected void processInput(MailboxDefaultAction.Controller controller) throws E\n \t\tsourceThread.setTaskDescription(getName());\n \t\tsourceThread.start();\n \t\tsourceThread.getCompletionFuture().whenComplete((Void ignore, Throwable sourceThreadThrowable) -> {\n-\t\t\tif (sourceThreadThrowable == null || isFinished) {\n-\t\t\t\tmailboxProcessor.allActionsCompleted();\n-\t\t\t} else {\n+\t\t\tif (isCanceled() && ExceptionUtils.findThrowable(sourceThreadThrowable, InterruptedException.class).isPresent()) {\n+\t\t\t\tmailboxProcessor.reportThrowable(new CancelTaskException(sourceThreadThrowable));", "originalCommit": "c8eaafb64c3d0d2b9045b2fea974a3bb04927cf8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTI2NDc1NQ==", "url": "https://github.com/apache/flink/pull/11026#discussion_r375264755", "bodyText": "Interruption is internal to SourceStreamTask, so I think the flag shouldn't be set.", "author": "rkhachatryan", "createdAt": "2020-02-05T13:50:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTI1NDQ3OA=="}], "type": "inlineReview"}, {"oid": "255396a280e23efa5474208f18854580226db5e0", "url": "https://github.com/apache/flink/commit/255396a280e23efa5474208f18854580226db5e0", "message": "[FLINK-15811][task] report CancelTaskException on SourceStreamTask cancellation\n\nThread interruption and InterruptedException are implementation details\nand shouldn't be exposed. Throw CancelTaskException instead which is a part of informal contract.", "committedDate": "2020-02-05T16:30:46Z", "type": "commit"}, {"oid": "255396a280e23efa5474208f18854580226db5e0", "url": "https://github.com/apache/flink/commit/255396a280e23efa5474208f18854580226db5e0", "message": "[FLINK-15811][task] report CancelTaskException on SourceStreamTask cancellation\n\nThread interruption and InterruptedException are implementation details\nand shouldn't be exposed. Throw CancelTaskException instead which is a part of informal contract.", "committedDate": "2020-02-05T16:30:46Z", "type": "forcePushed"}]}