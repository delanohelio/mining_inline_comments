{"pr_number": 11118, "pr_title": "[FLINK-16072][python] Optimize the performance of the write/read null mask", "pr_createdAt": "2020-02-18T07:55:28Z", "pr_url": "https://github.com/apache/flink/pull/11118", "timeline": [{"oid": "3bd212965eac342eb67cb216d47128405462889f", "url": "https://github.com/apache/flink/commit/3bd212965eac342eb67cb216d47128405462889f", "message": "[FLINK-16072][python] Optimize the performance of the write/read null mask", "committedDate": "2020-02-18T07:50:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTE4ODM0MA==", "url": "https://github.com/apache/flink/pull/11118#discussion_r381188340", "bodyText": "Could we generate this search table using one function? Besides, it would be great to add some comments on how to generate the search table. It will make it more readable and maintainable. What's your thought?", "author": "dianfu", "createdAt": "2020-02-19T09:59:52Z", "path": "flink-python/pyflink/fn_execution/coder_impl.py", "diffHunk": "@@ -25,56 +25,331 @@\n \n \n class FlattenRowCoderImpl(StreamCoderImpl):\n+    null_mask_search_table = ((False, False, False, False, False, False, False, False),", "originalCommit": "3bd212965eac342eb67cb216d47128405462889f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTMwMjU1MQ==", "url": "https://github.com/apache/flink/pull/11118#discussion_r381302551", "bodyText": "Yes. Good idea", "author": "HuangXingBo", "createdAt": "2020-02-19T13:53:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTE4ODM0MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTE5MzI3OQ==", "url": "https://github.com/apache/flink/pull/11118#discussion_r381193279", "bodyText": "What about renamed to _leading_bytes_num", "author": "dianfu", "createdAt": "2020-02-19T10:08:22Z", "path": "flink-python/pyflink/fn_execution/coder_impl.py", "diffHunk": "@@ -25,56 +25,331 @@\n \n \n class FlattenRowCoderImpl(StreamCoderImpl):\n+    null_mask_search_table = ((False, False, False, False, False, False, False, False),\n+                              (False, False, False, False, False, False, False, True),\n+                              (False, False, False, False, False, False, True, False),\n+                              (False, False, False, False, False, False, True, True),\n+                              (False, False, False, False, False, True, False, False),\n+                              (False, False, False, False, False, True, False, True),\n+                              (False, False, False, False, False, True, True, False),\n+                              (False, False, False, False, False, True, True, True),\n+                              (False, False, False, False, True, False, False, False),\n+                              (False, False, False, False, True, False, False, True),\n+                              (False, False, False, False, True, False, True, False),\n+                              (False, False, False, False, True, False, True, True),\n+                              (False, False, False, False, True, True, False, False),\n+                              (False, False, False, False, True, True, False, True),\n+                              (False, False, False, False, True, True, True, False),\n+                              (False, False, False, False, True, True, True, True),\n+                              (False, False, False, True, False, False, False, False),\n+                              (False, False, False, True, False, False, False, True),\n+                              (False, False, False, True, False, False, True, False),\n+                              (False, False, False, True, False, False, True, True),\n+                              (False, False, False, True, False, True, False, False),\n+                              (False, False, False, True, False, True, False, True),\n+                              (False, False, False, True, False, True, True, False),\n+                              (False, False, False, True, False, True, True, True),\n+                              (False, False, False, True, True, False, False, False),\n+                              (False, False, False, True, True, False, False, True),\n+                              (False, False, False, True, True, False, True, False),\n+                              (False, False, False, True, True, False, True, True),\n+                              (False, False, False, True, True, True, False, False),\n+                              (False, False, False, True, True, True, False, True),\n+                              (False, False, False, True, True, True, True, False),\n+                              (False, False, False, True, True, True, True, True),\n+                              (False, False, True, False, False, False, False, False),\n+                              (False, False, True, False, False, False, False, True),\n+                              (False, False, True, False, False, False, True, False),\n+                              (False, False, True, False, False, False, True, True),\n+                              (False, False, True, False, False, True, False, False),\n+                              (False, False, True, False, False, True, False, True),\n+                              (False, False, True, False, False, True, True, False),\n+                              (False, False, True, False, False, True, True, True),\n+                              (False, False, True, False, True, False, False, False),\n+                              (False, False, True, False, True, False, False, True),\n+                              (False, False, True, False, True, False, True, False),\n+                              (False, False, True, False, True, False, True, True),\n+                              (False, False, True, False, True, True, False, False),\n+                              (False, False, True, False, True, True, False, True),\n+                              (False, False, True, False, True, True, True, False),\n+                              (False, False, True, False, True, True, True, True),\n+                              (False, False, True, True, False, False, False, False),\n+                              (False, False, True, True, False, False, False, True),\n+                              (False, False, True, True, False, False, True, False),\n+                              (False, False, True, True, False, False, True, True),\n+                              (False, False, True, True, False, True, False, False),\n+                              (False, False, True, True, False, True, False, True),\n+                              (False, False, True, True, False, True, True, False),\n+                              (False, False, True, True, False, True, True, True),\n+                              (False, False, True, True, True, False, False, False),\n+                              (False, False, True, True, True, False, False, True),\n+                              (False, False, True, True, True, False, True, False),\n+                              (False, False, True, True, True, False, True, True),\n+                              (False, False, True, True, True, True, False, False),\n+                              (False, False, True, True, True, True, False, True),\n+                              (False, False, True, True, True, True, True, False),\n+                              (False, False, True, True, True, True, True, True),\n+                              (False, True, False, False, False, False, False, False),\n+                              (False, True, False, False, False, False, False, True),\n+                              (False, True, False, False, False, False, True, False),\n+                              (False, True, False, False, False, False, True, True),\n+                              (False, True, False, False, False, True, False, False),\n+                              (False, True, False, False, False, True, False, True),\n+                              (False, True, False, False, False, True, True, False),\n+                              (False, True, False, False, False, True, True, True),\n+                              (False, True, False, False, True, False, False, False),\n+                              (False, True, False, False, True, False, False, True),\n+                              (False, True, False, False, True, False, True, False),\n+                              (False, True, False, False, True, False, True, True),\n+                              (False, True, False, False, True, True, False, False),\n+                              (False, True, False, False, True, True, False, True),\n+                              (False, True, False, False, True, True, True, False),\n+                              (False, True, False, False, True, True, True, True),\n+                              (False, True, False, True, False, False, False, False),\n+                              (False, True, False, True, False, False, False, True),\n+                              (False, True, False, True, False, False, True, False),\n+                              (False, True, False, True, False, False, True, True),\n+                              (False, True, False, True, False, True, False, False),\n+                              (False, True, False, True, False, True, False, True),\n+                              (False, True, False, True, False, True, True, False),\n+                              (False, True, False, True, False, True, True, True),\n+                              (False, True, False, True, True, False, False, False),\n+                              (False, True, False, True, True, False, False, True),\n+                              (False, True, False, True, True, False, True, False),\n+                              (False, True, False, True, True, False, True, True),\n+                              (False, True, False, True, True, True, False, False),\n+                              (False, True, False, True, True, True, False, True),\n+                              (False, True, False, True, True, True, True, False),\n+                              (False, True, False, True, True, True, True, True),\n+                              (False, True, True, False, False, False, False, False),\n+                              (False, True, True, False, False, False, False, True),\n+                              (False, True, True, False, False, False, True, False),\n+                              (False, True, True, False, False, False, True, True),\n+                              (False, True, True, False, False, True, False, False),\n+                              (False, True, True, False, False, True, False, True),\n+                              (False, True, True, False, False, True, True, False),\n+                              (False, True, True, False, False, True, True, True),\n+                              (False, True, True, False, True, False, False, False),\n+                              (False, True, True, False, True, False, False, True),\n+                              (False, True, True, False, True, False, True, False),\n+                              (False, True, True, False, True, False, True, True),\n+                              (False, True, True, False, True, True, False, False),\n+                              (False, True, True, False, True, True, False, True),\n+                              (False, True, True, False, True, True, True, False),\n+                              (False, True, True, False, True, True, True, True),\n+                              (False, True, True, True, False, False, False, False),\n+                              (False, True, True, True, False, False, False, True),\n+                              (False, True, True, True, False, False, True, False),\n+                              (False, True, True, True, False, False, True, True),\n+                              (False, True, True, True, False, True, False, False),\n+                              (False, True, True, True, False, True, False, True),\n+                              (False, True, True, True, False, True, True, False),\n+                              (False, True, True, True, False, True, True, True),\n+                              (False, True, True, True, True, False, False, False),\n+                              (False, True, True, True, True, False, False, True),\n+                              (False, True, True, True, True, False, True, False),\n+                              (False, True, True, True, True, False, True, True),\n+                              (False, True, True, True, True, True, False, False),\n+                              (False, True, True, True, True, True, False, True),\n+                              (False, True, True, True, True, True, True, False),\n+                              (False, True, True, True, True, True, True, True),\n+                              (True, False, False, False, False, False, False, False),\n+                              (True, False, False, False, False, False, False, True),\n+                              (True, False, False, False, False, False, True, False),\n+                              (True, False, False, False, False, False, True, True),\n+                              (True, False, False, False, False, True, False, False),\n+                              (True, False, False, False, False, True, False, True),\n+                              (True, False, False, False, False, True, True, False),\n+                              (True, False, False, False, False, True, True, True),\n+                              (True, False, False, False, True, False, False, False),\n+                              (True, False, False, False, True, False, False, True),\n+                              (True, False, False, False, True, False, True, False),\n+                              (True, False, False, False, True, False, True, True),\n+                              (True, False, False, False, True, True, False, False),\n+                              (True, False, False, False, True, True, False, True),\n+                              (True, False, False, False, True, True, True, False),\n+                              (True, False, False, False, True, True, True, True),\n+                              (True, False, False, True, False, False, False, False),\n+                              (True, False, False, True, False, False, False, True),\n+                              (True, False, False, True, False, False, True, False),\n+                              (True, False, False, True, False, False, True, True),\n+                              (True, False, False, True, False, True, False, False),\n+                              (True, False, False, True, False, True, False, True),\n+                              (True, False, False, True, False, True, True, False),\n+                              (True, False, False, True, False, True, True, True),\n+                              (True, False, False, True, True, False, False, False),\n+                              (True, False, False, True, True, False, False, True),\n+                              (True, False, False, True, True, False, True, False),\n+                              (True, False, False, True, True, False, True, True),\n+                              (True, False, False, True, True, True, False, False),\n+                              (True, False, False, True, True, True, False, True),\n+                              (True, False, False, True, True, True, True, False),\n+                              (True, False, False, True, True, True, True, True),\n+                              (True, False, True, False, False, False, False, False),\n+                              (True, False, True, False, False, False, False, True),\n+                              (True, False, True, False, False, False, True, False),\n+                              (True, False, True, False, False, False, True, True),\n+                              (True, False, True, False, False, True, False, False),\n+                              (True, False, True, False, False, True, False, True),\n+                              (True, False, True, False, False, True, True, False),\n+                              (True, False, True, False, False, True, True, True),\n+                              (True, False, True, False, True, False, False, False),\n+                              (True, False, True, False, True, False, False, True),\n+                              (True, False, True, False, True, False, True, False),\n+                              (True, False, True, False, True, False, True, True),\n+                              (True, False, True, False, True, True, False, False),\n+                              (True, False, True, False, True, True, False, True),\n+                              (True, False, True, False, True, True, True, False),\n+                              (True, False, True, False, True, True, True, True),\n+                              (True, False, True, True, False, False, False, False),\n+                              (True, False, True, True, False, False, False, True),\n+                              (True, False, True, True, False, False, True, False),\n+                              (True, False, True, True, False, False, True, True),\n+                              (True, False, True, True, False, True, False, False),\n+                              (True, False, True, True, False, True, False, True),\n+                              (True, False, True, True, False, True, True, False),\n+                              (True, False, True, True, False, True, True, True),\n+                              (True, False, True, True, True, False, False, False),\n+                              (True, False, True, True, True, False, False, True),\n+                              (True, False, True, True, True, False, True, False),\n+                              (True, False, True, True, True, False, True, True),\n+                              (True, False, True, True, True, True, False, False),\n+                              (True, False, True, True, True, True, False, True),\n+                              (True, False, True, True, True, True, True, False),\n+                              (True, False, True, True, True, True, True, True),\n+                              (True, True, False, False, False, False, False, False),\n+                              (True, True, False, False, False, False, False, True),\n+                              (True, True, False, False, False, False, True, False),\n+                              (True, True, False, False, False, False, True, True),\n+                              (True, True, False, False, False, True, False, False),\n+                              (True, True, False, False, False, True, False, True),\n+                              (True, True, False, False, False, True, True, False),\n+                              (True, True, False, False, False, True, True, True),\n+                              (True, True, False, False, True, False, False, False),\n+                              (True, True, False, False, True, False, False, True),\n+                              (True, True, False, False, True, False, True, False),\n+                              (True, True, False, False, True, False, True, True),\n+                              (True, True, False, False, True, True, False, False),\n+                              (True, True, False, False, True, True, False, True),\n+                              (True, True, False, False, True, True, True, False),\n+                              (True, True, False, False, True, True, True, True),\n+                              (True, True, False, True, False, False, False, False),\n+                              (True, True, False, True, False, False, False, True),\n+                              (True, True, False, True, False, False, True, False),\n+                              (True, True, False, True, False, False, True, True),\n+                              (True, True, False, True, False, True, False, False),\n+                              (True, True, False, True, False, True, False, True),\n+                              (True, True, False, True, False, True, True, False),\n+                              (True, True, False, True, False, True, True, True),\n+                              (True, True, False, True, True, False, False, False),\n+                              (True, True, False, True, True, False, False, True),\n+                              (True, True, False, True, True, False, True, False),\n+                              (True, True, False, True, True, False, True, True),\n+                              (True, True, False, True, True, True, False, False),\n+                              (True, True, False, True, True, True, False, True),\n+                              (True, True, False, True, True, True, True, False),\n+                              (True, True, False, True, True, True, True, True),\n+                              (True, True, True, False, False, False, False, False),\n+                              (True, True, True, False, False, False, False, True),\n+                              (True, True, True, False, False, False, True, False),\n+                              (True, True, True, False, False, False, True, True),\n+                              (True, True, True, False, False, True, False, False),\n+                              (True, True, True, False, False, True, False, True),\n+                              (True, True, True, False, False, True, True, False),\n+                              (True, True, True, False, False, True, True, True),\n+                              (True, True, True, False, True, False, False, False),\n+                              (True, True, True, False, True, False, False, True),\n+                              (True, True, True, False, True, False, True, False),\n+                              (True, True, True, False, True, False, True, True),\n+                              (True, True, True, False, True, True, False, False),\n+                              (True, True, True, False, True, True, False, True),\n+                              (True, True, True, False, True, True, True, False),\n+                              (True, True, True, False, True, True, True, True),\n+                              (True, True, True, True, False, False, False, False),\n+                              (True, True, True, True, False, False, False, True),\n+                              (True, True, True, True, False, False, True, False),\n+                              (True, True, True, True, False, False, True, True),\n+                              (True, True, True, True, False, True, False, False),\n+                              (True, True, True, True, False, True, False, True),\n+                              (True, True, True, True, False, True, True, False),\n+                              (True, True, True, True, False, True, True, True),\n+                              (True, True, True, True, True, False, False, False),\n+                              (True, True, True, True, True, False, False, True),\n+                              (True, True, True, True, True, False, True, False),\n+                              (True, True, True, True, True, False, True, True),\n+                              (True, True, True, True, True, True, False, False),\n+                              (True, True, True, True, True, True, False, True),\n+                              (True, True, True, True, True, True, True, False),\n+                              (True, True, True, True, True, True, True, True))\n+\n+    null_byte_search_table = (0x80, 0x40, 0x20, 0x10, 0x08, 0x04, 0x02, 0x01)\n \n     def __init__(self, field_coders):\n         self._field_coders = field_coders\n         self._filed_count = len(field_coders)\n+        self._complete_byte_num = self._filed_count // 8", "originalCommit": "3bd212965eac342eb67cb216d47128405462889f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTc2OTE4Nw==", "url": "https://github.com/apache/flink/pull/11118#discussion_r381769187", "bodyText": "_complete_byte_num -> _leading_complete_bytes_num\n_leading_bytes_num -> _remaining_bits_num", "author": "dianfu", "createdAt": "2020-02-20T05:28:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTE5MzI3OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTE5NTI5Nw==", "url": "https://github.com/apache/flink/pull/11118#discussion_r381195297", "bodyText": "Make write_null_mask non-static? then this change is not needed any more.", "author": "dianfu", "createdAt": "2020-02-19T10:12:01Z", "path": "flink-python/pyflink/fn_execution/coder_impl.py", "diffHunk": "@@ -25,56 +25,331 @@\n \n \n class FlattenRowCoderImpl(StreamCoderImpl):\n+    null_mask_search_table = ((False, False, False, False, False, False, False, False),\n+                              (False, False, False, False, False, False, False, True),\n+                              (False, False, False, False, False, False, True, False),\n+                              (False, False, False, False, False, False, True, True),\n+                              (False, False, False, False, False, True, False, False),\n+                              (False, False, False, False, False, True, False, True),\n+                              (False, False, False, False, False, True, True, False),\n+                              (False, False, False, False, False, True, True, True),\n+                              (False, False, False, False, True, False, False, False),\n+                              (False, False, False, False, True, False, False, True),\n+                              (False, False, False, False, True, False, True, False),\n+                              (False, False, False, False, True, False, True, True),\n+                              (False, False, False, False, True, True, False, False),\n+                              (False, False, False, False, True, True, False, True),\n+                              (False, False, False, False, True, True, True, False),\n+                              (False, False, False, False, True, True, True, True),\n+                              (False, False, False, True, False, False, False, False),\n+                              (False, False, False, True, False, False, False, True),\n+                              (False, False, False, True, False, False, True, False),\n+                              (False, False, False, True, False, False, True, True),\n+                              (False, False, False, True, False, True, False, False),\n+                              (False, False, False, True, False, True, False, True),\n+                              (False, False, False, True, False, True, True, False),\n+                              (False, False, False, True, False, True, True, True),\n+                              (False, False, False, True, True, False, False, False),\n+                              (False, False, False, True, True, False, False, True),\n+                              (False, False, False, True, True, False, True, False),\n+                              (False, False, False, True, True, False, True, True),\n+                              (False, False, False, True, True, True, False, False),\n+                              (False, False, False, True, True, True, False, True),\n+                              (False, False, False, True, True, True, True, False),\n+                              (False, False, False, True, True, True, True, True),\n+                              (False, False, True, False, False, False, False, False),\n+                              (False, False, True, False, False, False, False, True),\n+                              (False, False, True, False, False, False, True, False),\n+                              (False, False, True, False, False, False, True, True),\n+                              (False, False, True, False, False, True, False, False),\n+                              (False, False, True, False, False, True, False, True),\n+                              (False, False, True, False, False, True, True, False),\n+                              (False, False, True, False, False, True, True, True),\n+                              (False, False, True, False, True, False, False, False),\n+                              (False, False, True, False, True, False, False, True),\n+                              (False, False, True, False, True, False, True, False),\n+                              (False, False, True, False, True, False, True, True),\n+                              (False, False, True, False, True, True, False, False),\n+                              (False, False, True, False, True, True, False, True),\n+                              (False, False, True, False, True, True, True, False),\n+                              (False, False, True, False, True, True, True, True),\n+                              (False, False, True, True, False, False, False, False),\n+                              (False, False, True, True, False, False, False, True),\n+                              (False, False, True, True, False, False, True, False),\n+                              (False, False, True, True, False, False, True, True),\n+                              (False, False, True, True, False, True, False, False),\n+                              (False, False, True, True, False, True, False, True),\n+                              (False, False, True, True, False, True, True, False),\n+                              (False, False, True, True, False, True, True, True),\n+                              (False, False, True, True, True, False, False, False),\n+                              (False, False, True, True, True, False, False, True),\n+                              (False, False, True, True, True, False, True, False),\n+                              (False, False, True, True, True, False, True, True),\n+                              (False, False, True, True, True, True, False, False),\n+                              (False, False, True, True, True, True, False, True),\n+                              (False, False, True, True, True, True, True, False),\n+                              (False, False, True, True, True, True, True, True),\n+                              (False, True, False, False, False, False, False, False),\n+                              (False, True, False, False, False, False, False, True),\n+                              (False, True, False, False, False, False, True, False),\n+                              (False, True, False, False, False, False, True, True),\n+                              (False, True, False, False, False, True, False, False),\n+                              (False, True, False, False, False, True, False, True),\n+                              (False, True, False, False, False, True, True, False),\n+                              (False, True, False, False, False, True, True, True),\n+                              (False, True, False, False, True, False, False, False),\n+                              (False, True, False, False, True, False, False, True),\n+                              (False, True, False, False, True, False, True, False),\n+                              (False, True, False, False, True, False, True, True),\n+                              (False, True, False, False, True, True, False, False),\n+                              (False, True, False, False, True, True, False, True),\n+                              (False, True, False, False, True, True, True, False),\n+                              (False, True, False, False, True, True, True, True),\n+                              (False, True, False, True, False, False, False, False),\n+                              (False, True, False, True, False, False, False, True),\n+                              (False, True, False, True, False, False, True, False),\n+                              (False, True, False, True, False, False, True, True),\n+                              (False, True, False, True, False, True, False, False),\n+                              (False, True, False, True, False, True, False, True),\n+                              (False, True, False, True, False, True, True, False),\n+                              (False, True, False, True, False, True, True, True),\n+                              (False, True, False, True, True, False, False, False),\n+                              (False, True, False, True, True, False, False, True),\n+                              (False, True, False, True, True, False, True, False),\n+                              (False, True, False, True, True, False, True, True),\n+                              (False, True, False, True, True, True, False, False),\n+                              (False, True, False, True, True, True, False, True),\n+                              (False, True, False, True, True, True, True, False),\n+                              (False, True, False, True, True, True, True, True),\n+                              (False, True, True, False, False, False, False, False),\n+                              (False, True, True, False, False, False, False, True),\n+                              (False, True, True, False, False, False, True, False),\n+                              (False, True, True, False, False, False, True, True),\n+                              (False, True, True, False, False, True, False, False),\n+                              (False, True, True, False, False, True, False, True),\n+                              (False, True, True, False, False, True, True, False),\n+                              (False, True, True, False, False, True, True, True),\n+                              (False, True, True, False, True, False, False, False),\n+                              (False, True, True, False, True, False, False, True),\n+                              (False, True, True, False, True, False, True, False),\n+                              (False, True, True, False, True, False, True, True),\n+                              (False, True, True, False, True, True, False, False),\n+                              (False, True, True, False, True, True, False, True),\n+                              (False, True, True, False, True, True, True, False),\n+                              (False, True, True, False, True, True, True, True),\n+                              (False, True, True, True, False, False, False, False),\n+                              (False, True, True, True, False, False, False, True),\n+                              (False, True, True, True, False, False, True, False),\n+                              (False, True, True, True, False, False, True, True),\n+                              (False, True, True, True, False, True, False, False),\n+                              (False, True, True, True, False, True, False, True),\n+                              (False, True, True, True, False, True, True, False),\n+                              (False, True, True, True, False, True, True, True),\n+                              (False, True, True, True, True, False, False, False),\n+                              (False, True, True, True, True, False, False, True),\n+                              (False, True, True, True, True, False, True, False),\n+                              (False, True, True, True, True, False, True, True),\n+                              (False, True, True, True, True, True, False, False),\n+                              (False, True, True, True, True, True, False, True),\n+                              (False, True, True, True, True, True, True, False),\n+                              (False, True, True, True, True, True, True, True),\n+                              (True, False, False, False, False, False, False, False),\n+                              (True, False, False, False, False, False, False, True),\n+                              (True, False, False, False, False, False, True, False),\n+                              (True, False, False, False, False, False, True, True),\n+                              (True, False, False, False, False, True, False, False),\n+                              (True, False, False, False, False, True, False, True),\n+                              (True, False, False, False, False, True, True, False),\n+                              (True, False, False, False, False, True, True, True),\n+                              (True, False, False, False, True, False, False, False),\n+                              (True, False, False, False, True, False, False, True),\n+                              (True, False, False, False, True, False, True, False),\n+                              (True, False, False, False, True, False, True, True),\n+                              (True, False, False, False, True, True, False, False),\n+                              (True, False, False, False, True, True, False, True),\n+                              (True, False, False, False, True, True, True, False),\n+                              (True, False, False, False, True, True, True, True),\n+                              (True, False, False, True, False, False, False, False),\n+                              (True, False, False, True, False, False, False, True),\n+                              (True, False, False, True, False, False, True, False),\n+                              (True, False, False, True, False, False, True, True),\n+                              (True, False, False, True, False, True, False, False),\n+                              (True, False, False, True, False, True, False, True),\n+                              (True, False, False, True, False, True, True, False),\n+                              (True, False, False, True, False, True, True, True),\n+                              (True, False, False, True, True, False, False, False),\n+                              (True, False, False, True, True, False, False, True),\n+                              (True, False, False, True, True, False, True, False),\n+                              (True, False, False, True, True, False, True, True),\n+                              (True, False, False, True, True, True, False, False),\n+                              (True, False, False, True, True, True, False, True),\n+                              (True, False, False, True, True, True, True, False),\n+                              (True, False, False, True, True, True, True, True),\n+                              (True, False, True, False, False, False, False, False),\n+                              (True, False, True, False, False, False, False, True),\n+                              (True, False, True, False, False, False, True, False),\n+                              (True, False, True, False, False, False, True, True),\n+                              (True, False, True, False, False, True, False, False),\n+                              (True, False, True, False, False, True, False, True),\n+                              (True, False, True, False, False, True, True, False),\n+                              (True, False, True, False, False, True, True, True),\n+                              (True, False, True, False, True, False, False, False),\n+                              (True, False, True, False, True, False, False, True),\n+                              (True, False, True, False, True, False, True, False),\n+                              (True, False, True, False, True, False, True, True),\n+                              (True, False, True, False, True, True, False, False),\n+                              (True, False, True, False, True, True, False, True),\n+                              (True, False, True, False, True, True, True, False),\n+                              (True, False, True, False, True, True, True, True),\n+                              (True, False, True, True, False, False, False, False),\n+                              (True, False, True, True, False, False, False, True),\n+                              (True, False, True, True, False, False, True, False),\n+                              (True, False, True, True, False, False, True, True),\n+                              (True, False, True, True, False, True, False, False),\n+                              (True, False, True, True, False, True, False, True),\n+                              (True, False, True, True, False, True, True, False),\n+                              (True, False, True, True, False, True, True, True),\n+                              (True, False, True, True, True, False, False, False),\n+                              (True, False, True, True, True, False, False, True),\n+                              (True, False, True, True, True, False, True, False),\n+                              (True, False, True, True, True, False, True, True),\n+                              (True, False, True, True, True, True, False, False),\n+                              (True, False, True, True, True, True, False, True),\n+                              (True, False, True, True, True, True, True, False),\n+                              (True, False, True, True, True, True, True, True),\n+                              (True, True, False, False, False, False, False, False),\n+                              (True, True, False, False, False, False, False, True),\n+                              (True, True, False, False, False, False, True, False),\n+                              (True, True, False, False, False, False, True, True),\n+                              (True, True, False, False, False, True, False, False),\n+                              (True, True, False, False, False, True, False, True),\n+                              (True, True, False, False, False, True, True, False),\n+                              (True, True, False, False, False, True, True, True),\n+                              (True, True, False, False, True, False, False, False),\n+                              (True, True, False, False, True, False, False, True),\n+                              (True, True, False, False, True, False, True, False),\n+                              (True, True, False, False, True, False, True, True),\n+                              (True, True, False, False, True, True, False, False),\n+                              (True, True, False, False, True, True, False, True),\n+                              (True, True, False, False, True, True, True, False),\n+                              (True, True, False, False, True, True, True, True),\n+                              (True, True, False, True, False, False, False, False),\n+                              (True, True, False, True, False, False, False, True),\n+                              (True, True, False, True, False, False, True, False),\n+                              (True, True, False, True, False, False, True, True),\n+                              (True, True, False, True, False, True, False, False),\n+                              (True, True, False, True, False, True, False, True),\n+                              (True, True, False, True, False, True, True, False),\n+                              (True, True, False, True, False, True, True, True),\n+                              (True, True, False, True, True, False, False, False),\n+                              (True, True, False, True, True, False, False, True),\n+                              (True, True, False, True, True, False, True, False),\n+                              (True, True, False, True, True, False, True, True),\n+                              (True, True, False, True, True, True, False, False),\n+                              (True, True, False, True, True, True, False, True),\n+                              (True, True, False, True, True, True, True, False),\n+                              (True, True, False, True, True, True, True, True),\n+                              (True, True, True, False, False, False, False, False),\n+                              (True, True, True, False, False, False, False, True),\n+                              (True, True, True, False, False, False, True, False),\n+                              (True, True, True, False, False, False, True, True),\n+                              (True, True, True, False, False, True, False, False),\n+                              (True, True, True, False, False, True, False, True),\n+                              (True, True, True, False, False, True, True, False),\n+                              (True, True, True, False, False, True, True, True),\n+                              (True, True, True, False, True, False, False, False),\n+                              (True, True, True, False, True, False, False, True),\n+                              (True, True, True, False, True, False, True, False),\n+                              (True, True, True, False, True, False, True, True),\n+                              (True, True, True, False, True, True, False, False),\n+                              (True, True, True, False, True, True, False, True),\n+                              (True, True, True, False, True, True, True, False),\n+                              (True, True, True, False, True, True, True, True),\n+                              (True, True, True, True, False, False, False, False),\n+                              (True, True, True, True, False, False, False, True),\n+                              (True, True, True, True, False, False, True, False),\n+                              (True, True, True, True, False, False, True, True),\n+                              (True, True, True, True, False, True, False, False),\n+                              (True, True, True, True, False, True, False, True),\n+                              (True, True, True, True, False, True, True, False),\n+                              (True, True, True, True, False, True, True, True),\n+                              (True, True, True, True, True, False, False, False),\n+                              (True, True, True, True, True, False, False, True),\n+                              (True, True, True, True, True, False, True, False),\n+                              (True, True, True, True, True, False, True, True),\n+                              (True, True, True, True, True, True, False, False),\n+                              (True, True, True, True, True, True, False, True),\n+                              (True, True, True, True, True, True, True, False),\n+                              (True, True, True, True, True, True, True, True))\n+\n+    null_byte_search_table = (0x80, 0x40, 0x20, 0x10, 0x08, 0x04, 0x02, 0x01)\n \n     def __init__(self, field_coders):\n         self._field_coders = field_coders\n         self._filed_count = len(field_coders)\n+        self._complete_byte_num = self._filed_count // 8\n+        self._remaining_bit_num = self._filed_count % 8\n \n     def encode_to_stream(self, value, out_stream, nested):\n-        self.write_null_mask(value, out_stream)\n+        self.write_null_mask(value, self._complete_byte_num, self._remaining_bit_num, out_stream)", "originalCommit": "3bd212965eac342eb67cb216d47128405462889f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTIwMDUyNA==", "url": "https://github.com/apache/flink/pull/11118#discussion_r381200524", "bodyText": "ditto", "author": "dianfu", "createdAt": "2020-02-19T10:21:24Z", "path": "flink-python/pyflink/fn_execution/coder_impl.py", "diffHunk": "@@ -25,56 +25,331 @@\n \n \n class FlattenRowCoderImpl(StreamCoderImpl):\n+    null_mask_search_table = ((False, False, False, False, False, False, False, False),\n+                              (False, False, False, False, False, False, False, True),\n+                              (False, False, False, False, False, False, True, False),\n+                              (False, False, False, False, False, False, True, True),\n+                              (False, False, False, False, False, True, False, False),\n+                              (False, False, False, False, False, True, False, True),\n+                              (False, False, False, False, False, True, True, False),\n+                              (False, False, False, False, False, True, True, True),\n+                              (False, False, False, False, True, False, False, False),\n+                              (False, False, False, False, True, False, False, True),\n+                              (False, False, False, False, True, False, True, False),\n+                              (False, False, False, False, True, False, True, True),\n+                              (False, False, False, False, True, True, False, False),\n+                              (False, False, False, False, True, True, False, True),\n+                              (False, False, False, False, True, True, True, False),\n+                              (False, False, False, False, True, True, True, True),\n+                              (False, False, False, True, False, False, False, False),\n+                              (False, False, False, True, False, False, False, True),\n+                              (False, False, False, True, False, False, True, False),\n+                              (False, False, False, True, False, False, True, True),\n+                              (False, False, False, True, False, True, False, False),\n+                              (False, False, False, True, False, True, False, True),\n+                              (False, False, False, True, False, True, True, False),\n+                              (False, False, False, True, False, True, True, True),\n+                              (False, False, False, True, True, False, False, False),\n+                              (False, False, False, True, True, False, False, True),\n+                              (False, False, False, True, True, False, True, False),\n+                              (False, False, False, True, True, False, True, True),\n+                              (False, False, False, True, True, True, False, False),\n+                              (False, False, False, True, True, True, False, True),\n+                              (False, False, False, True, True, True, True, False),\n+                              (False, False, False, True, True, True, True, True),\n+                              (False, False, True, False, False, False, False, False),\n+                              (False, False, True, False, False, False, False, True),\n+                              (False, False, True, False, False, False, True, False),\n+                              (False, False, True, False, False, False, True, True),\n+                              (False, False, True, False, False, True, False, False),\n+                              (False, False, True, False, False, True, False, True),\n+                              (False, False, True, False, False, True, True, False),\n+                              (False, False, True, False, False, True, True, True),\n+                              (False, False, True, False, True, False, False, False),\n+                              (False, False, True, False, True, False, False, True),\n+                              (False, False, True, False, True, False, True, False),\n+                              (False, False, True, False, True, False, True, True),\n+                              (False, False, True, False, True, True, False, False),\n+                              (False, False, True, False, True, True, False, True),\n+                              (False, False, True, False, True, True, True, False),\n+                              (False, False, True, False, True, True, True, True),\n+                              (False, False, True, True, False, False, False, False),\n+                              (False, False, True, True, False, False, False, True),\n+                              (False, False, True, True, False, False, True, False),\n+                              (False, False, True, True, False, False, True, True),\n+                              (False, False, True, True, False, True, False, False),\n+                              (False, False, True, True, False, True, False, True),\n+                              (False, False, True, True, False, True, True, False),\n+                              (False, False, True, True, False, True, True, True),\n+                              (False, False, True, True, True, False, False, False),\n+                              (False, False, True, True, True, False, False, True),\n+                              (False, False, True, True, True, False, True, False),\n+                              (False, False, True, True, True, False, True, True),\n+                              (False, False, True, True, True, True, False, False),\n+                              (False, False, True, True, True, True, False, True),\n+                              (False, False, True, True, True, True, True, False),\n+                              (False, False, True, True, True, True, True, True),\n+                              (False, True, False, False, False, False, False, False),\n+                              (False, True, False, False, False, False, False, True),\n+                              (False, True, False, False, False, False, True, False),\n+                              (False, True, False, False, False, False, True, True),\n+                              (False, True, False, False, False, True, False, False),\n+                              (False, True, False, False, False, True, False, True),\n+                              (False, True, False, False, False, True, True, False),\n+                              (False, True, False, False, False, True, True, True),\n+                              (False, True, False, False, True, False, False, False),\n+                              (False, True, False, False, True, False, False, True),\n+                              (False, True, False, False, True, False, True, False),\n+                              (False, True, False, False, True, False, True, True),\n+                              (False, True, False, False, True, True, False, False),\n+                              (False, True, False, False, True, True, False, True),\n+                              (False, True, False, False, True, True, True, False),\n+                              (False, True, False, False, True, True, True, True),\n+                              (False, True, False, True, False, False, False, False),\n+                              (False, True, False, True, False, False, False, True),\n+                              (False, True, False, True, False, False, True, False),\n+                              (False, True, False, True, False, False, True, True),\n+                              (False, True, False, True, False, True, False, False),\n+                              (False, True, False, True, False, True, False, True),\n+                              (False, True, False, True, False, True, True, False),\n+                              (False, True, False, True, False, True, True, True),\n+                              (False, True, False, True, True, False, False, False),\n+                              (False, True, False, True, True, False, False, True),\n+                              (False, True, False, True, True, False, True, False),\n+                              (False, True, False, True, True, False, True, True),\n+                              (False, True, False, True, True, True, False, False),\n+                              (False, True, False, True, True, True, False, True),\n+                              (False, True, False, True, True, True, True, False),\n+                              (False, True, False, True, True, True, True, True),\n+                              (False, True, True, False, False, False, False, False),\n+                              (False, True, True, False, False, False, False, True),\n+                              (False, True, True, False, False, False, True, False),\n+                              (False, True, True, False, False, False, True, True),\n+                              (False, True, True, False, False, True, False, False),\n+                              (False, True, True, False, False, True, False, True),\n+                              (False, True, True, False, False, True, True, False),\n+                              (False, True, True, False, False, True, True, True),\n+                              (False, True, True, False, True, False, False, False),\n+                              (False, True, True, False, True, False, False, True),\n+                              (False, True, True, False, True, False, True, False),\n+                              (False, True, True, False, True, False, True, True),\n+                              (False, True, True, False, True, True, False, False),\n+                              (False, True, True, False, True, True, False, True),\n+                              (False, True, True, False, True, True, True, False),\n+                              (False, True, True, False, True, True, True, True),\n+                              (False, True, True, True, False, False, False, False),\n+                              (False, True, True, True, False, False, False, True),\n+                              (False, True, True, True, False, False, True, False),\n+                              (False, True, True, True, False, False, True, True),\n+                              (False, True, True, True, False, True, False, False),\n+                              (False, True, True, True, False, True, False, True),\n+                              (False, True, True, True, False, True, True, False),\n+                              (False, True, True, True, False, True, True, True),\n+                              (False, True, True, True, True, False, False, False),\n+                              (False, True, True, True, True, False, False, True),\n+                              (False, True, True, True, True, False, True, False),\n+                              (False, True, True, True, True, False, True, True),\n+                              (False, True, True, True, True, True, False, False),\n+                              (False, True, True, True, True, True, False, True),\n+                              (False, True, True, True, True, True, True, False),\n+                              (False, True, True, True, True, True, True, True),\n+                              (True, False, False, False, False, False, False, False),\n+                              (True, False, False, False, False, False, False, True),\n+                              (True, False, False, False, False, False, True, False),\n+                              (True, False, False, False, False, False, True, True),\n+                              (True, False, False, False, False, True, False, False),\n+                              (True, False, False, False, False, True, False, True),\n+                              (True, False, False, False, False, True, True, False),\n+                              (True, False, False, False, False, True, True, True),\n+                              (True, False, False, False, True, False, False, False),\n+                              (True, False, False, False, True, False, False, True),\n+                              (True, False, False, False, True, False, True, False),\n+                              (True, False, False, False, True, False, True, True),\n+                              (True, False, False, False, True, True, False, False),\n+                              (True, False, False, False, True, True, False, True),\n+                              (True, False, False, False, True, True, True, False),\n+                              (True, False, False, False, True, True, True, True),\n+                              (True, False, False, True, False, False, False, False),\n+                              (True, False, False, True, False, False, False, True),\n+                              (True, False, False, True, False, False, True, False),\n+                              (True, False, False, True, False, False, True, True),\n+                              (True, False, False, True, False, True, False, False),\n+                              (True, False, False, True, False, True, False, True),\n+                              (True, False, False, True, False, True, True, False),\n+                              (True, False, False, True, False, True, True, True),\n+                              (True, False, False, True, True, False, False, False),\n+                              (True, False, False, True, True, False, False, True),\n+                              (True, False, False, True, True, False, True, False),\n+                              (True, False, False, True, True, False, True, True),\n+                              (True, False, False, True, True, True, False, False),\n+                              (True, False, False, True, True, True, False, True),\n+                              (True, False, False, True, True, True, True, False),\n+                              (True, False, False, True, True, True, True, True),\n+                              (True, False, True, False, False, False, False, False),\n+                              (True, False, True, False, False, False, False, True),\n+                              (True, False, True, False, False, False, True, False),\n+                              (True, False, True, False, False, False, True, True),\n+                              (True, False, True, False, False, True, False, False),\n+                              (True, False, True, False, False, True, False, True),\n+                              (True, False, True, False, False, True, True, False),\n+                              (True, False, True, False, False, True, True, True),\n+                              (True, False, True, False, True, False, False, False),\n+                              (True, False, True, False, True, False, False, True),\n+                              (True, False, True, False, True, False, True, False),\n+                              (True, False, True, False, True, False, True, True),\n+                              (True, False, True, False, True, True, False, False),\n+                              (True, False, True, False, True, True, False, True),\n+                              (True, False, True, False, True, True, True, False),\n+                              (True, False, True, False, True, True, True, True),\n+                              (True, False, True, True, False, False, False, False),\n+                              (True, False, True, True, False, False, False, True),\n+                              (True, False, True, True, False, False, True, False),\n+                              (True, False, True, True, False, False, True, True),\n+                              (True, False, True, True, False, True, False, False),\n+                              (True, False, True, True, False, True, False, True),\n+                              (True, False, True, True, False, True, True, False),\n+                              (True, False, True, True, False, True, True, True),\n+                              (True, False, True, True, True, False, False, False),\n+                              (True, False, True, True, True, False, False, True),\n+                              (True, False, True, True, True, False, True, False),\n+                              (True, False, True, True, True, False, True, True),\n+                              (True, False, True, True, True, True, False, False),\n+                              (True, False, True, True, True, True, False, True),\n+                              (True, False, True, True, True, True, True, False),\n+                              (True, False, True, True, True, True, True, True),\n+                              (True, True, False, False, False, False, False, False),\n+                              (True, True, False, False, False, False, False, True),\n+                              (True, True, False, False, False, False, True, False),\n+                              (True, True, False, False, False, False, True, True),\n+                              (True, True, False, False, False, True, False, False),\n+                              (True, True, False, False, False, True, False, True),\n+                              (True, True, False, False, False, True, True, False),\n+                              (True, True, False, False, False, True, True, True),\n+                              (True, True, False, False, True, False, False, False),\n+                              (True, True, False, False, True, False, False, True),\n+                              (True, True, False, False, True, False, True, False),\n+                              (True, True, False, False, True, False, True, True),\n+                              (True, True, False, False, True, True, False, False),\n+                              (True, True, False, False, True, True, False, True),\n+                              (True, True, False, False, True, True, True, False),\n+                              (True, True, False, False, True, True, True, True),\n+                              (True, True, False, True, False, False, False, False),\n+                              (True, True, False, True, False, False, False, True),\n+                              (True, True, False, True, False, False, True, False),\n+                              (True, True, False, True, False, False, True, True),\n+                              (True, True, False, True, False, True, False, False),\n+                              (True, True, False, True, False, True, False, True),\n+                              (True, True, False, True, False, True, True, False),\n+                              (True, True, False, True, False, True, True, True),\n+                              (True, True, False, True, True, False, False, False),\n+                              (True, True, False, True, True, False, False, True),\n+                              (True, True, False, True, True, False, True, False),\n+                              (True, True, False, True, True, False, True, True),\n+                              (True, True, False, True, True, True, False, False),\n+                              (True, True, False, True, True, True, False, True),\n+                              (True, True, False, True, True, True, True, False),\n+                              (True, True, False, True, True, True, True, True),\n+                              (True, True, True, False, False, False, False, False),\n+                              (True, True, True, False, False, False, False, True),\n+                              (True, True, True, False, False, False, True, False),\n+                              (True, True, True, False, False, False, True, True),\n+                              (True, True, True, False, False, True, False, False),\n+                              (True, True, True, False, False, True, False, True),\n+                              (True, True, True, False, False, True, True, False),\n+                              (True, True, True, False, False, True, True, True),\n+                              (True, True, True, False, True, False, False, False),\n+                              (True, True, True, False, True, False, False, True),\n+                              (True, True, True, False, True, False, True, False),\n+                              (True, True, True, False, True, False, True, True),\n+                              (True, True, True, False, True, True, False, False),\n+                              (True, True, True, False, True, True, False, True),\n+                              (True, True, True, False, True, True, True, False),\n+                              (True, True, True, False, True, True, True, True),\n+                              (True, True, True, True, False, False, False, False),\n+                              (True, True, True, True, False, False, False, True),\n+                              (True, True, True, True, False, False, True, False),\n+                              (True, True, True, True, False, False, True, True),\n+                              (True, True, True, True, False, True, False, False),\n+                              (True, True, True, True, False, True, False, True),\n+                              (True, True, True, True, False, True, True, False),\n+                              (True, True, True, True, False, True, True, True),\n+                              (True, True, True, True, True, False, False, False),\n+                              (True, True, True, True, True, False, False, True),\n+                              (True, True, True, True, True, False, True, False),\n+                              (True, True, True, True, True, False, True, True),\n+                              (True, True, True, True, True, True, False, False),\n+                              (True, True, True, True, True, True, False, True),\n+                              (True, True, True, True, True, True, True, False),\n+                              (True, True, True, True, True, True, True, True))\n+\n+    null_byte_search_table = (0x80, 0x40, 0x20, 0x10, 0x08, 0x04, 0x02, 0x01)\n \n     def __init__(self, field_coders):\n         self._field_coders = field_coders\n         self._filed_count = len(field_coders)\n+        self._complete_byte_num = self._filed_count // 8\n+        self._remaining_bit_num = self._filed_count % 8\n \n     def encode_to_stream(self, value, out_stream, nested):\n-        self.write_null_mask(value, out_stream)\n+        self.write_null_mask(value, self._complete_byte_num, self._remaining_bit_num, out_stream)\n         for i in range(self._filed_count):\n-            if value[i] is not None:\n-                self._field_coders[i].encode_to_stream(value[i], out_stream, nested)\n+            item = value[i]\n+            if item is not None:\n+                self._field_coders[i].encode_to_stream(item, out_stream, nested)\n \n     def decode_from_stream(self, in_stream, nested):\n-        null_mask = self.read_null_mask(self._filed_count, in_stream)\n+        null_mask = self.read_null_mask(self._complete_byte_num, self._remaining_bit_num, in_stream)", "originalCommit": "3bd212965eac342eb67cb216d47128405462889f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "7729a10a210e81cceb6ca909d2d7b73a93ae4c78", "url": "https://github.com/apache/flink/commit/7729a10a210e81cceb6ca909d2d7b73a93ae4c78", "message": "fix comments", "committedDate": "2020-02-19T13:52:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTMwNDQyMQ==", "url": "https://github.com/apache/flink/pull/11118#discussion_r381304421", "bodyText": "It seems that there is no need to introduce this variable.", "author": "dianfu", "createdAt": "2020-02-19T13:56:13Z", "path": "flink-python/pyflink/fn_execution/coder_impl.py", "diffHunk": "@@ -24,57 +24,71 @@\n from pyflink.table import Row\n \n \n+def generate_null_mask_search_table():\n+    \"\"\"\n+    Each bit of one byte represents if the column at the specified position is None or not, e.g.\n+    0x84 represents the first column and the sixth column are None.\n+    \"\"\"\n+    num = 256", "originalCommit": "7729a10a210e81cceb6ca909d2d7b73a93ae4c78", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTMwNDgzMQ==", "url": "https://github.com/apache/flink/pull/11118#discussion_r381304831", "bodyText": "specified -> corresponding", "author": "dianfu", "createdAt": "2020-02-19T13:56:56Z", "path": "flink-python/pyflink/fn_execution/coder_impl.py", "diffHunk": "@@ -24,57 +24,71 @@\n from pyflink.table import Row\n \n \n+def generate_null_mask_search_table():\n+    \"\"\"\n+    Each bit of one byte represents if the column at the specified position is None or not, e.g.", "originalCommit": "7729a10a210e81cceb6ca909d2d7b73a93ae4c78", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTcyNTk0MA==", "url": "https://github.com/apache/flink/pull/11118#discussion_r381725940", "bodyText": "Make it a private method of FlattenRowCoderImpl? I think there is no need to expose it.", "author": "dianfu", "createdAt": "2020-02-20T03:58:32Z", "path": "flink-python/pyflink/fn_execution/coder_impl.py", "diffHunk": "@@ -24,57 +24,71 @@\n from pyflink.table import Row\n \n \n+def generate_null_mask_search_table():", "originalCommit": "7729a10a210e81cceb6ca909d2d7b73a93ae4c78", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTc2NjI5OQ==", "url": "https://github.com/apache/flink/pull/11118#discussion_r381766299", "bodyText": "What about make it an instance variable as it's faster than static variable: https://stackoverflow.com/questions/2714573/instance-variables-vs-class-variables-in-python", "author": "dianfu", "createdAt": "2020-02-20T05:22:26Z", "path": "flink-python/pyflink/fn_execution/coder_impl.py", "diffHunk": "@@ -24,57 +24,71 @@\n from pyflink.table import Row\n \n \n+def generate_null_mask_search_table():\n+    \"\"\"\n+    Each bit of one byte represents if the column at the specified position is None or not, e.g.\n+    0x84 represents the first column and the sixth column are None.\n+    \"\"\"\n+    num = 256\n+    null_mask = []\n+    for b in range(num):\n+        every_num_null_mask = [(b & 0x80) > 0, (b & 0x40) > 0, (b & 0x20) > 0, (b & 0x10) > 0,\n+                               (b & 0x08) > 0, (b & 0x04) > 0, (b & 0x02) > 0, (b & 0x01) > 0]\n+        null_mask.append(tuple(every_num_null_mask))\n+\n+    return tuple(null_mask)\n+\n+\n class FlattenRowCoderImpl(StreamCoderImpl):\n+    null_mask_search_table = generate_null_mask_search_table()", "originalCommit": "7729a10a210e81cceb6ca909d2d7b73a93ae4c78", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTc2ODUyNg==", "url": "https://github.com/apache/flink/pull/11118#discussion_r381768526", "bodyText": "Could we add some unit tests for the null mask related logic?", "author": "dianfu", "createdAt": "2020-02-20T05:27:02Z", "path": "flink-python/pyflink/fn_execution/coder_impl.py", "diffHunk": "@@ -24,57 +24,71 @@\n from pyflink.table import Row\n \n \n+def generate_null_mask_search_table():\n+    \"\"\"\n+    Each bit of one byte represents if the column at the specified position is None or not, e.g.\n+    0x84 represents the first column and the sixth column are None.\n+    \"\"\"\n+    num = 256\n+    null_mask = []\n+    for b in range(num):\n+        every_num_null_mask = [(b & 0x80) > 0, (b & 0x40) > 0, (b & 0x20) > 0, (b & 0x10) > 0,\n+                               (b & 0x08) > 0, (b & 0x04) > 0, (b & 0x02) > 0, (b & 0x01) > 0]\n+        null_mask.append(tuple(every_num_null_mask))\n+\n+    return tuple(null_mask)\n+\n+\n class FlattenRowCoderImpl(StreamCoderImpl):\n+    null_mask_search_table = generate_null_mask_search_table()\n+\n+    null_byte_search_table = (0x80, 0x40, 0x20, 0x10, 0x08, 0x04, 0x02, 0x01)\n \n     def __init__(self, field_coders):\n         self._field_coders = field_coders\n         self._filed_count = len(field_coders)\n+        self._complete_byte_num = self._filed_count // 8\n+        self._leading_bytes_num = self._filed_count % 8\n \n     def encode_to_stream(self, value, out_stream, nested):\n         self.write_null_mask(value, out_stream)\n         for i in range(self._filed_count):\n-            if value[i] is not None:\n-                self._field_coders[i].encode_to_stream(value[i], out_stream, nested)\n+            item = value[i]\n+            if item is not None:\n+                self._field_coders[i].encode_to_stream(item, out_stream, nested)\n \n     def decode_from_stream(self, in_stream, nested):\n-        null_mask = self.read_null_mask(self._filed_count, in_stream)\n+        null_mask = self.read_null_mask(in_stream)\n         return [None if null_mask[idx] else self._field_coders[idx].decode_from_stream(\n             in_stream, nested) for idx in range(0, self._filed_count)]\n \n-    @staticmethod\n-    def write_null_mask(value, out_stream):", "originalCommit": "7729a10a210e81cceb6ca909d2d7b73a93ae4c78", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "a0859b135ab2f39a8173500bbec3e289b84bb1d1", "url": "https://github.com/apache/flink/commit/a0859b135ab2f39a8173500bbec3e289b84bb1d1", "message": "fix comments-2", "committedDate": "2020-02-20T08:57:17Z", "type": "commit"}]}