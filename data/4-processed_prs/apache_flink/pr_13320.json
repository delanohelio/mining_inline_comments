{"pr_number": 13320, "pr_title": "[FLINK-19035] Remove fold from DataStream API ", "pr_createdAt": "2020-09-03T13:55:44Z", "pr_url": "https://github.com/apache/flink/pull/13320", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzU3OTUxMA==", "url": "https://github.com/apache/flink/pull/13320#discussion_r483579510", "bodyText": "nit: remove empty line and add a comment to this section that fold was dropped in 1.12", "author": "twalthr", "createdAt": "2020-09-04T12:18:38Z", "path": "flink-streaming-scala/pom.xml", "diffHunk": "@@ -262,6 +262,22 @@ under the License.\n \t\t\t\t\t\t\t<exclude>org.apache.flink.streaming.api.scala.DataStream#iterate\\$default\\$3()</exclude>\n \t\t\t\t\t\t\t<exclude>org.apache.flink.streaming.api.scala.DataStream#assignTimestamps(org.apache.flink.streaming.api.functions.TimestampExtractor)</exclude>\n \t\t\t\t\t\t\t<exclude>org.apache.flink.streaming.api.scala.ConnectedStreams#keyBy(scala.Function1,scala.Function1,org.apache.flink.api.common.typeinfo.TypeInformation,org.apache.flink.api.common.typeinfo.TypeInformation)</exclude>\n+\n+\t\t\t\t\t\t\t<exlcude>org.apache.flink.streaming.api.scala.AllWindowedStream#apply(java.lang.Object,org.apache.flink.api.common.functions.FoldFunction,org.apache.flink.streaming.api.scala.function.AllWindowFunction,org.apache.flink.api.common.typeinfo.TypeInformation)</exlcude>\n+\t\t\t\t\t\t\t<exclude>org.apache.flink.streaming.api.scala.AllWindowedStream#apply(java.lang.Object,scala.Function2,scala.Function3,org.apache.flink.api.common.typeinfo.TypeInformation)</exclude>\n+\t\t\t\t\t\t\t<exclude>org.apache.flink.streaming.api.scala.AllWindowedStream#fold(java.lang.Object,scala.Function2,org.apache.flink.api.common.typeinfo.TypeInformation)</exclude>\n+\t\t\t\t\t\t\t<exclude>org.apache.flink.streaming.api.scala.AllWindowedStream#fold(java.lang.Object,org.apache.flink.api.common.functions.FoldFunction,org.apache.flink.streaming.api.scala.function.AllWindowFunction,org.apache.flink.api.common.typeinfo.TypeInformation,org.apache.flink.api.common.typeinfo.TypeInformation)</exclude>\n+\t\t\t\t\t\t\t<exclude>org.apache.flink.streaming.api.scala.AllWindowedStream#fold(java.lang.Object,scala.Function2,scala.Function3,org.apache.flink.api.common.typeinfo.TypeInformation,org.apache.flink.api.common.typeinfo.TypeInformation)</exclude>\n+\t\t\t\t\t\t\t<exclude>org.apache.flink.streaming.api.scala.KeyedStream#fold(java.lang.Object,org.apache.flink.api.common.functions.FoldFunction,org.apache.flink.api.common.typeinfo.TypeInformation)</exclude>\n+\t\t\t\t\t\t\t<exclude>org.apache.flink.streaming.api.scala.KeyedStream#fold(java.lang.Object,scala.Function2,org.apache.flink.api.common.typeinfo.TypeInformation)</exclude>\n+\t\t\t\t\t\t\t<exclude>org.apache.flink.streaming.api.scala.WindowedStream#apply(java.lang.Object,org.apache.flink.api.common.functions.FoldFunction,org.apache.flink.streaming.api.scala.function.WindowFunction,org.apache.flink.api.common.typeinfo.TypeInformation)</exclude>\n+\t\t\t\t\t\t\t<exclude>org.apache.flink.streaming.api.scala.WindowedStream#apply(java.lang.Object,scala.Function2,scala.Function4,org.apache.flink.api.common.typeinfo.TypeInformation)</exclude>\n+\t\t\t\t\t\t\t<exclude>org.apache.flink.streaming.api.scala.WindowedStream#fold(java.lang.Object,scala.Function2,org.apache.flink.api.common.typeinfo.TypeInformation)</exclude>\n+\t\t\t\t\t\t\t<exclude>org.apache.flink.streaming.api.scala.WindowedStream#fold(java.lang.Object,org.apache.flink.api.common.functions.FoldFunction,org.apache.flink.streaming.api.scala.function.WindowFunction,org.apache.flink.api.common.typeinfo.TypeInformation,org.apache.flink.api.common.typeinfo.TypeInformation)</exclude>\n+\t\t\t\t\t\t\t<exclude>org.apache.flink.streaming.api.scala.WindowedStream#fold(java.lang.Object,scala.Function2,scala.Function4,org.apache.flink.api.common.typeinfo.TypeInformation,org.apache.flink.api.common.typeinfo.TypeInformation)</exclude>\n+", "originalCommit": "a424075cc80ced3f5620b580134393213cc378a5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzU4NTgyNw==", "url": "https://github.com/apache/flink/pull/13320#discussion_r483585827", "bodyText": "this comment still occurs in the file", "author": "twalthr", "createdAt": "2020-09-04T12:32:01Z", "path": "flink-streaming-scala/src/test/scala/org/apache/flink/streaming/api/scala/AllWindowTranslationTest.scala", "diffHunk": "@@ -91,54 +91,10 @@ class AllWindowTranslationTest {\n     fail(\"exception was not thrown\")\n   }\n \n-  /**\n-    * .fold() does not support [[RichFoldFunction]], since the reduce function is used internally\n-    * in a [[org.apache.flink.api.common.state.FoldingState]].\n-    */\n-  @Test(expected = classOf[UnsupportedOperationException])\n-  def testFoldWithRichFolderFails() {\n-    val env = StreamExecutionEnvironment.getExecutionEnvironment\n-    val source = env.fromElements((\"hello\", 1), (\"hello\", 2))\n-\n-    env.setStreamTimeCharacteristic(TimeCharacteristic.ProcessingTime)\n-\n-    source\n-      .windowAll(SlidingEventTimeWindows.of(Time.seconds(1), Time.milliseconds(100)))\n-      .fold((\"\", 0), new RichFoldFunction[(String, Int), (String, Int)] {\n-        override def fold(accumulator: (String, Int), value: (String, Int)) = null\n-      })\n-\n-    fail(\"exception was not thrown\")\n-  }\n-\n   // ------------------------------------------------------------------------\n   //  merging window precondition\n   // ------------------------------------------------------------------------\n \n-  @Test\n-  def testSessionWithFoldFails() {\n-    // verify that fold does not work with merging windows\n-    val env = StreamExecutionEnvironment.getExecutionEnvironment\n-\n-    val windowedStream = env.fromElements(\"Hello\", \"Ciao\")\n-      .windowAll(EventTimeSessionWindows.withGap(Time.seconds(5)))\n-\n-    try\n-      windowedStream.fold(\"\", new FoldFunction[String, String]() {\n-        @throws[Exception]\n-        def fold(accumulator: String, value: String): String = accumulator\n-      })\n-\n-    catch {\n-      case _: UnsupportedOperationException =>\n-        // expected\n-        // use a catch to ensure that the exception is thrown by the fold", "originalCommit": "a424075cc80ced3f5620b580134393213cc378a5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzU4OTUyNQ==", "url": "https://github.com/apache/flink/pull/13320#discussion_r483589525", "bodyText": "same for java", "author": "twalthr", "createdAt": "2020-09-04T12:39:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzU4NTgyNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzU4NzIyMQ==", "url": "https://github.com/apache/flink/pull/13320#discussion_r483587221", "bodyText": "update testResource() in this class", "author": "twalthr", "createdAt": "2020-09-04T12:34:58Z", "path": "flink-streaming-scala/src/test/scala/org/apache/flink/streaming/api/scala/DataStreamTest.scala", "diffHunk": "@@ -35,10 +35,13 @@ import org.apache.flink.streaming.runtime.partitioner._\n import org.apache.flink.test.util.AbstractTestBase\n import org.apache.flink.util.Collector\n \n+import org.hamcrest.CoreMatchers.equalTo\n import org.junit.Assert._\n import org.junit.rules.ExpectedException\n import org.junit.{Rule, Test}\n \n+import java.lang\n+\n class DataStreamTest extends AbstractTestBase {", "originalCommit": "a424075cc80ced3f5620b580134393213cc378a5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzU4ODQxNA==", "url": "https://github.com/apache/flink/pull/13320#discussion_r483588414", "bodyText": "this comment is does still exist in the class", "author": "twalthr", "createdAt": "2020-09-04T12:37:18Z", "path": "flink-streaming-scala/src/test/scala/org/apache/flink/streaming/api/scala/WindowTranslationTest.scala", "diffHunk": "@@ -92,56 +93,10 @@ class WindowTranslationTest {\n     fail(\"exception was not thrown\")\n   }\n \n-  /**\n-    * .fold() does not support [[RichFoldFunction]], since the reduce function is used internally\n-    * in a [[org.apache.flink.api.common.state.FoldingState]].\n-    */\n-  @Test(expected = classOf[UnsupportedOperationException])\n-  def testFoldWithRichFolderFails() {\n-    val env = StreamExecutionEnvironment.getExecutionEnvironment\n-    val source = env.fromElements((\"hello\", 1), (\"hello\", 2))\n-\n-    env.setStreamTimeCharacteristic(TimeCharacteristic.ProcessingTime)\n-\n-    source\n-      .keyBy(0)\n-      .window(SlidingEventTimeWindows.of(Time.seconds(1), Time.milliseconds(100)))\n-      .fold((\"\", 0), new RichFoldFunction[(String, Int), (String, Int)] {\n-        override def fold(accumulator: (String, Int), value: (String, Int)) = null\n-      })\n-\n-    fail(\"exception was not thrown\")\n-  }\n-\n   // --------------------------------------------------------------------------\n   //  merging window checks\n   // --------------------------------------------------------------------------\n \n-  @Test\n-  def testSessionWithFoldFails() {\n-    // verify that fold does not work with merging windows\n-    val env = StreamExecutionEnvironment.getExecutionEnvironment\n-\n-    val windowedStream = env.fromElements(\"Hello\", \"Ciao\")\n-      .keyBy(x => x)\n-      .window(EventTimeSessionWindows.withGap(Time.seconds(5)))\n-\n-    try\n-      windowedStream.fold(\"\", new FoldFunction[String, String]() {\n-        @throws[Exception]\n-        def fold(accumulator: String, value: String): String = accumulator\n-      })\n-\n-    catch {\n-      case _: UnsupportedOperationException =>\n-        // expected\n-        // use a catch to ensure that the exception is thrown by the fold", "originalCommit": "a424075cc80ced3f5620b580134393213cc378a5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzU4OTQzNA==", "url": "https://github.com/apache/flink/pull/13320#discussion_r483589434", "bodyText": "same for java", "author": "twalthr", "createdAt": "2020-09-04T12:39:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzU4ODQxNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzY5MTI4Nw==", "url": "https://github.com/apache/flink/pull/13320#discussion_r483691287", "bodyText": "This and the next one should also be removed from the Chinese version. But I think I could help remove it separately after this PR.", "author": "gaoyunhaii", "createdAt": "2020-09-04T15:29:44Z", "path": "docs/dev/stream/state/queryable_state.md", "diffHunk": "@@ -155,7 +150,7 @@ descriptor.setQueryable(\"query-name\"); // queryable state name\n </div>\n \n This variant has no limitations as to which type of state can be made queryable. This means that this can be used for \n-any `ValueState`, `ReduceState`, `ListState`, `MapState`, `AggregatingState`, and the currently deprecated `FoldingState`.\n+any `ValueState`, `ReduceState`, `ListState`, `MapState`, and `AggregatingState`.", "originalCommit": "a424075cc80ced3f5620b580134393213cc378a5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDA5MDM5Ng==", "url": "https://github.com/apache/flink/pull/13320#discussion_r484090396", "bodyText": "I would appreciate help with updating the Chinese docs once I merge this PR.", "author": "dawidwys", "createdAt": "2020-09-06T16:39:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzY5MTI4Nw=="}], "type": "inlineReview"}, {"oid": "e3f0df0d8ac8c8f03a897cb14ad2fbb3fff59c7b", "url": "https://github.com/apache/flink/commit/e3f0df0d8ac8c8f03a897cb14ad2fbb3fff59c7b", "message": "[FLINK-19035] Remove fold from DataStream API", "committedDate": "2020-09-06T16:39:01Z", "type": "commit"}, {"oid": "184596b8cf59637e39c9be2df010a8fd57a802ce", "url": "https://github.com/apache/flink/commit/184596b8cf59637e39c9be2df010a8fd57a802ce", "message": "[FLINK-19035] Remove DataStream#fold references from docs", "committedDate": "2020-09-06T16:39:03Z", "type": "commit"}, {"oid": "184596b8cf59637e39c9be2df010a8fd57a802ce", "url": "https://github.com/apache/flink/commit/184596b8cf59637e39c9be2df010a8fd57a802ce", "message": "[FLINK-19035] Remove DataStream#fold references from docs", "committedDate": "2020-09-06T16:39:03Z", "type": "forcePushed"}]}