{"pr_number": 10816, "pr_title": "[Flink-15355] Fixed parsing of plugin parent-first patterns.", "pr_createdAt": "2020-01-09T13:42:30Z", "pr_url": "https://github.com/apache/flink/pull/10816", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDc0OTczNQ==", "url": "https://github.com/apache/flink/pull/10816#discussion_r364749735", "bodyText": "I think the decision is that we shouldn't be adding more guava dependencies/usages in our code base. At least that's the feedback once I tried to pull out the same trick you did (\"guava already present, so why not to use it?\").", "author": "pnowojski", "createdAt": "2020-01-09T13:54:48Z", "path": "flink-core/src/main/java/org/apache/flink/configuration/CoreOptions.java", "diffHunk": "@@ -25,6 +25,9 @@\n import org.apache.flink.configuration.description.Description;\n import org.apache.flink.util.ArrayUtils;\n \n+import org.apache.flink.shaded.guava18.com.google.common.base.Splitter;\n+import org.apache.flink.shaded.guava18.com.google.common.collect.Iterables;", "originalCommit": "8f7604d34d7048aa46ec86671b43548f88369bb2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDc1NzM4OQ==", "url": "https://github.com/apache/flink/pull/10816#discussion_r364757389", "bodyText": "Turns out people are fine with using more of guava now. \ud83e\udd37\u200d\u2642", "author": "zentol", "createdAt": "2020-01-09T14:10:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDc0OTczNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDc1Nzc2OA==", "url": "https://github.com/apache/flink/pull/10816#discussion_r364757768", "bodyText": "Discussion came up when the GuavaFlinkConnectorRateLimiter was added.", "author": "zentol", "createdAt": "2020-01-09T14:11:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDc0OTczNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDc3MDY3NQ==", "url": "https://github.com/apache/flink/pull/10816#discussion_r364770675", "bodyText": "Ok, I don't have any strong preference in that matter :)", "author": "pnowojski", "createdAt": "2020-01-09T14:35:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDc0OTczNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDc1MDc1Nw==", "url": "https://github.com/apache/flink/pull/10816#discussion_r364750757", "bodyText": "Can you deduplicate this code with getParentFirstLoaderPatterns? Provide a base method private static String[] getParentFirstLoaderPatterns(String base, String append)? Especially that the original method that was copied/duplicated didn't have the bug.\nAlso maybe a unit test since this has failed/caused a bug?", "author": "pnowojski", "createdAt": "2020-01-09T13:56:50Z", "path": "flink-core/src/main/java/org/apache/flink/configuration/CoreOptions.java", "diffHunk": "@@ -147,8 +150,8 @@\n \tpublic static String[] getPluginParentFirstLoaderPatterns(Configuration config) {\n \t\tString base = config.getString(PLUGIN_ALWAYS_PARENT_FIRST_LOADER_PATTERNS);\n \t\tString append = config.getString(PLUGIN_ALWAYS_PARENT_FIRST_LOADER_PATTERNS_ADDITIONAL);\n-\n-\t\treturn ArrayUtils.concat(base.split(\";\"), append.split(\";\"));\n+\t\tfinal Splitter splitter = Splitter.on(';').omitEmptyStrings();\n+\t\treturn Iterables.toArray(Iterables.concat(splitter.split(base), splitter.split(append)), String.class);\n \t}", "originalCommit": "8f7604d34d7048aa46ec86671b43548f88369bb2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDc2ODc4Mg==", "url": "https://github.com/apache/flink/pull/10816#discussion_r364768782", "bodyText": "Added a test.", "author": "AHeise", "createdAt": "2020-01-09T14:31:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDc1MDc1Nw=="}], "type": "inlineReview"}, {"oid": "17b4b7d5390c10d9fa34ea3f0ddb55f2b2a3efc6", "url": "https://github.com/apache/flink/commit/17b4b7d5390c10d9fa34ea3f0ddb55f2b2a3efc6", "message": "[FLINK-15355][plugins] Fixed parsing of plugin parent-first patterns.\n\nPreviously, empty options would result in an empty pattern, which\nmatches everything. Thus, we effectively got parent first for all\nclasses.", "committedDate": "2020-01-09T14:26:05Z", "type": "forcePushed"}, {"oid": "cb04c04cdb2cae6a8404e0bfce634f566cd1473c", "url": "https://github.com/apache/flink/commit/cb04c04cdb2cae6a8404e0bfce634f566cd1473c", "message": "[FLINK-15355][plugins] Fixed parsing of plugin parent-first patterns.\n\nPreviously, empty options would result in an empty pattern, which\nmatches everything. Thus, we effectively got parent first for all\nclasses.", "committedDate": "2020-01-09T14:34:13Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDc4NDc0Mw==", "url": "https://github.com/apache/flink/pull/10816#discussion_r364784743", "bodyText": "GuavaFlinkConnectorRateLimiteradditional\n:)", "author": "pnowojski", "createdAt": "2020-01-09T14:59:04Z", "path": "flink-core/src/main/java/org/apache/flink/configuration/CoreOptions.java", "diffHunk": "@@ -133,7 +127,7 @@\n \t\t.withDescription(\"A (semicolon-separated) list of patterns that specifies which classes should always be\" +\n \t\t\t\" resolved through the plugin parent ClassLoader first. A pattern is a simple prefix that is checked \" +\n \t\t\t\" against the fully qualified class name. This setting should generally not be modified. To add another \" +\n-\t\t\t\" pattern we recommend to use \\\"plugin.classloader.parent-first-patterns.additional\\\" instead.\");\n+\t\t\t\" pattern we recommend to use \\\"plugin.classloader.parent-first-patterns.GuavaFlinkConnectorRateLimiteradditional\\\" instead.\");", "originalCommit": "cb04c04cdb2cae6a8404e0bfce634f566cd1473c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDc4ODk4NA==", "url": "https://github.com/apache/flink/pull/10816#discussion_r364788984", "bodyText": "woooops, good catch. that would have been weird.", "author": "AHeise", "createdAt": "2020-01-09T15:06:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDc4NDc0Mw=="}], "type": "inlineReview"}, {"oid": "79f86e78791e0938480c97e422d7bc3003a97974", "url": "https://github.com/apache/flink/commit/79f86e78791e0938480c97e422d7bc3003a97974", "message": "[FLINK-15355][plugins] Fixed parsing of plugin parent-first patterns.\n\nPreviously, empty options would result in an empty pattern, which\nmatches everything. Thus, we effectively got parent first for all\nclasses.", "committedDate": "2020-01-09T15:06:21Z", "type": "forcePushed"}, {"oid": "80ff3913aadd6719a43ba19a86068e8b50cc43f6", "url": "https://github.com/apache/flink/commit/80ff3913aadd6719a43ba19a86068e8b50cc43f6", "message": "[FLINK-15355][plugins] Fixed parsing of plugin parent-first patterns.\n\nPreviously, empty options would result in an empty pattern, which\nmatches everything. Thus, we effectively got parent first for all\nclasses.", "committedDate": "2020-01-09T16:07:53Z", "type": "commit"}, {"oid": "80ff3913aadd6719a43ba19a86068e8b50cc43f6", "url": "https://github.com/apache/flink/commit/80ff3913aadd6719a43ba19a86068e8b50cc43f6", "message": "[FLINK-15355][plugins] Fixed parsing of plugin parent-first patterns.\n\nPreviously, empty options would result in an empty pattern, which\nmatches everything. Thus, we effectively got parent first for all\nclasses.", "committedDate": "2020-01-09T16:07:53Z", "type": "forcePushed"}]}