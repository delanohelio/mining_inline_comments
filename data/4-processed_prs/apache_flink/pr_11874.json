{"pr_number": 11874, "pr_title": "[FLINK-16935][table-planner-blink] Enable or delete most of the ignored test cases in blink planner.", "pr_createdAt": "2020-04-23T08:01:57Z", "pr_url": "https://github.com/apache/flink/pull/11874", "timeline": [{"oid": "f0a5bbab89ef55a5135daf70b1a990e132121db0", "url": "https://github.com/apache/flink/commit/f0a5bbab89ef55a5135daf70b1a990e132121db0", "message": "[FLINK-16935][table-planner-blink] Enable or delete most of the ignored test cases in blink planner.", "committedDate": "2020-04-23T07:59:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDI1MTAxNA==", "url": "https://github.com/apache/flink/pull/11874#discussion_r414251014", "bodyText": "This is on purpose. Tests in this file should be manually checked (e.g. whether the current timestamp is correct).", "author": "wuchong", "createdAt": "2020-04-24T02:43:08Z", "path": "flink-table/flink-table-planner-blink/src/test/scala/org/apache/flink/table/planner/expressions/NonDeterministicTests.scala", "diffHunk": "@@ -23,71 +23,65 @@ import org.apache.flink.table.api.scala._\n import org.apache.flink.table.planner.expressions.utils.ExpressionTestBase\n import org.apache.flink.types.Row\n \n-import org.junit.{Ignore, Test}\n+import org.junit.Test\n \n /**\n   * Tests that can only be checked manually as they are non-deterministic.\n   */\n class NonDeterministicTests extends ExpressionTestBase {\n \n-  @Ignore", "originalCommit": "f0a5bbab89ef55a5135daf70b1a990e132121db0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDMwMjc0MQ==", "url": "https://github.com/apache/flink/pull/11874#discussion_r414302741", "bodyText": "I don't think any developer will notice this file and really do the manually check. I would either delete this or change this testing purpose to verify all non-deterministic functions can successfully run", "author": "KurtYoung", "createdAt": "2020-04-24T05:26:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDI1MTAxNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDI1MTE0MA==", "url": "https://github.com/apache/flink/pull/11874#discussion_r414251140", "bodyText": "Shoud we fix this problem? This test is moved from old planner DecimalTypeTest#testDecimalCasting. And in blink planner, it will throw exception when cast using TypeInformation.\njava.lang.ClassCastException: org.apache.flink.table.types.logical.LegacyTypeInformationType cannot be cast to org.apache.flink.table.types.logical.DecimalType\n\n\tat org.apache.flink.table.planner.calcite.FlinkTypeFactory.newRelDataType$1(FlinkTypeFactory.scala:95)\n\tat org.apache.flink.table.planner.calcite.FlinkTypeFactory.createFieldTypeFromLogicalType(FlinkTypeFactory.scala:146)\n\tat org.apache.flink.table.planner.expressions.converter.CustomizedConvertRule.convertCast(CustomizedConvertRule.java:106)\n\tat org.apache.flink.table.planner.expressions.converter.CustomizedConvertRule.lambda$convert$0(CustomizedConvertRule.java:98)\n\tat java.util.Optional.map(Optional.java:215)\n\tat org.apache.flink.table.planner.expressions.converter.CustomizedConvertRule.convert(CustomizedConvertRule.java:98)\n\tat org.apache.flink.table.planner.expressions.converter.ExpressionConverter.visit(ExpressionConverter.java:97)\n\tat org.apache.flink.table.planner.expressions.converter.ExpressionConverter.visit(ExpressionConverter.java:72)\n\tat org.apache.flink.table.expressions.CallExpression.accept(CallExpression.java:122)\n\tat org.apache.flink.table.planner.plan.QueryOperationConverter.convertExprToRexNode(QueryOperationConverter.java:741)\n\tat org.apache.flink.table.planner.plan.QueryOperationConverter.access$800(QueryOperationConverter.java:132)\n\tat org.apache.flink.table.planner.plan.QueryOperationConverter$SingleRelVisitor.lambda$convertToRexNodes$6(QueryOperationConverter.java:547)\n\tat java.util.stream.ReferencePipeline$3$1.accept(ReferencePipeline.java:193)\n\tat java.util.ArrayList$ArrayListSpliterator.forEachRemaining(ArrayList.java:1382)\n\tat java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)\n\tat java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)\n\tat java.util.stream.ReduceOps$ReduceOp.evaluateSequential(ReduceOps.java:708)\n\tat java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)\n\tat java.util.stream.ReferencePipeline.collect(ReferencePipeline.java:499)\n\tat org.apache.flink.table.planner.plan.QueryOperationConverter$SingleRelVisitor.convertToRexNodes(QueryOperationConverter.java:548)\n\tat org.apache.flink.table.planner.plan.QueryOperationConverter$SingleRelVisitor.visit(QueryOperationConverter.java:156)\n\tat org.apache.flink.table.planner.plan.QueryOperationConverter$SingleRelVisitor.visit(QueryOperationConverter.java:152)\n\tat org.apache.flink.table.operations.ProjectQueryOperation.accept(ProjectQueryOperation.java:75)\n\tat org.apache.flink.table.planner.plan.QueryOperationConverter.defaultMethod(QueryOperationConverter.java:149)\n\tat org.apache.flink.table.planner.plan.QueryOperationConverter.defaultMethod(QueryOperationConverter.java:131)\n\tat org.apache.flink.table.operations.utils.QueryOperationDefaultVisitor.visit(QueryOperationDefaultVisitor.java:47)\n\tat org.apache.flink.table.operations.ProjectQueryOperation.accept(ProjectQueryOperation.java:75)\n\tat org.apache.flink.table.planner.calcite.FlinkRelBuilder.queryOperation(FlinkRelBuilder.scala:176)\n\tat org.apache.flink.table.planner.expressions.utils.ExpressionTestBase.addTableApiTestExpr(ExpressionTestBase.scala:242)\n\tat org.apache.flink.table.planner.expressions.utils.ExpressionTestBase.addTableApiTestExpr(ExpressionTestBase.scala:236)\n\tat org.apache.flink.table.planner.expressions.utils.ExpressionTestBase.testTableApi(ExpressionTestBase.scala:226)\n\tat org.apache.flink.table.planner.expressions.DecimalTypeTest.testDecimalCasting(DecimalTypeTest.scala:136)", "author": "wuchong", "createdAt": "2020-04-24T02:43:28Z", "path": "flink-table/flink-table-planner-blink/src/test/scala/org/apache/flink/table/planner/expressions/DecimalTypeTest.scala", "diffHunk": "@@ -129,23 +130,6 @@ class DecimalTypeTest extends ExpressionTestBase {\n       Long.MinValue.toString)\n   }\n \n-  @Ignore\n-  @Test\n-  def testDefaultDecimalCasting(): Unit = {", "originalCommit": "f0a5bbab89ef55a5135daf70b1a990e132121db0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQzNjUwNg==", "url": "https://github.com/apache/flink/pull/11874#discussion_r414436506", "bodyText": "I will create a jira to track this", "author": "KurtYoung", "createdAt": "2020-04-24T09:35:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDI1MTE0MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQ0NjE5OA==", "url": "https://github.com/apache/flink/pull/11874#discussion_r414446198", "bodyText": "https://issues.apache.org/jira/browse/FLINK-17371", "author": "KurtYoung", "createdAt": "2020-04-24T09:50:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDI1MTE0MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDI1NjYwMw==", "url": "https://github.com/apache/flink/pull/11874#discussion_r414256603", "bodyText": "Why this is removed? I run this test and can get a plan. Is the plan incorrect? cc @godfreyhe\nHashJoin(joinType=[LeftSemiJoin], where=[=(c, a1)], select=[a, b, c], build=[right], tryDistinctBuildRow=[true])\n:- Exchange(distribution=[hash[c]], shuffle_mode=[BATCH])\n:  +- TableSourceScan(table=[[default_catalog, default_database, A, source: [TestTableSource(a, b, c)]]], fields=[a, b, c], reuse_id=[1])\n+- Exchange(distribution=[hash[a1]])\n   +- LocalHashAggregate(groupBy=[a1], select=[a1])\n      +- Calc(select=[a AS a1], where=[=(b, _UTF-16LE'two')])\n         +- Reused(reference_id=[1])", "author": "wuchong", "createdAt": "2020-04-24T03:00:41Z", "path": "flink-table/flink-table-planner-blink/src/test/scala/org/apache/flink/table/planner/plan/batch/table/stringexpr/SetOperatorsTest.scala", "diffHunk": "@@ -22,24 +22,12 @@ import org.apache.flink.api.scala._\n import org.apache.flink.table.api.scala._\n import org.apache.flink.table.planner.utils.TableTestBase\n \n-import org.junit.{Ignore, Test}\n+import org.junit.Test\n \n import java.sql.Timestamp\n \n class SetOperatorsTest extends TableTestBase {\n \n-  @Ignore(\"Support in subQuery in ExpressionConverter\")\n-  @Test\n-  def testInWithFilter(): Unit = {", "originalCommit": "f0a5bbab89ef55a5135daf70b1a990e132121db0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQzNjcwNA==", "url": "https://github.com/apache/flink/pull/11874#discussion_r414436704", "bodyText": "Sorry, it seems this is deleted by accident", "author": "KurtYoung", "createdAt": "2020-04-24T09:35:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDI1NjYwMw=="}], "type": "inlineReview"}, {"oid": "1bdd69335126fb32b5c98ea0dfcfe32d588610f5", "url": "https://github.com/apache/flink/commit/1bdd69335126fb32b5c98ea0dfcfe32d588610f5", "message": "address comments", "committedDate": "2020-04-24T09:58:02Z", "type": "commit"}]}