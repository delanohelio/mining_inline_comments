{"pr_number": 13872, "pr_title": "[FLINK-19873][Formats/json]Skip DDL change events for Canal data", "pr_createdAt": "2020-11-02T06:17:05Z", "pr_url": "https://github.com/apache/flink/pull/13872", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjAzMDYzNQ==", "url": "https://github.com/apache/flink/pull/13872#discussion_r516030635", "bodyText": "Please add a real DDL message, rather than changing a DELETE message into CREATE.", "author": "wuchong", "createdAt": "2020-11-02T15:00:00Z", "path": "flink-formats/flink-json/src/test/resources/canal-data.txt", "diffHunk": "@@ -5,6 +5,6 @@\n {\"data\":[{\"id\":\"111\",\"name\":\"scooter\",\"description\":\"Big 2-wheel scooter \",\"weight\":\"5.18\"}],\"database\":\"inventory\",\"es\":1589373555000,\"id\":7,\"isDdl\":false,\"mysqlType\":{\"id\":\"INTEGER\",\"name\":\"VARCHAR(255)\",\"description\":\"VARCHAR(512)\",\"weight\":\"FLOAT\"},\"old\":null,\"pkNames\":[\"id\"],\"sql\":\"\",\"sqlType\":{\"id\":4,\"name\":12,\"description\":12,\"weight\":7},\"table\":\"products2\",\"ts\":1589373555457,\"type\":\"INSERT\"}\n {\"data\":[{\"id\":\"110\",\"name\":\"jacket\",\"description\":\"new water resistent white wind breaker\",\"weight\":\"0.5\"}],\"database\":\"inventory\",\"es\":1589373558000,\"id\":8,\"isDdl\":false,\"mysqlType\":{\"id\":\"INTEGER\",\"name\":\"VARCHAR(255)\",\"description\":\"VARCHAR(512)\",\"weight\":\"FLOAT\"},\"old\":[{\"description\":\"water resistent white wind breaker\",\"weight\":\"0.2\"}],\"pkNames\":[\"id\"],\"sql\":\"\",\"sqlType\":{\"id\":4,\"name\":12,\"description\":12,\"weight\":7},\"table\":\"products2\",\"ts\":1589373558230,\"type\":\"UPDATE\"}\n {\"data\":[{\"id\":\"111\",\"name\":\"scooter\",\"description\":\"Big 2-wheel scooter \",\"weight\":\"5.17\"}],\"database\":\"inventory\",\"es\":1589373560000,\"id\":9,\"isDdl\":false,\"mysqlType\":{\"id\":\"INTEGER\",\"name\":\"VARCHAR(255)\",\"description\":\"VARCHAR(512)\",\"weight\":\"FLOAT\"},\"old\":[{\"weight\":\"5.18\"}],\"pkNames\":[\"id\"],\"sql\":\"\",\"sqlType\":{\"id\":4,\"name\":12,\"description\":12,\"weight\":7},\"table\":\"products2\",\"ts\":1589373560798,\"type\":\"UPDATE\"}\n-{\"data\":[{\"id\":\"111\",\"name\":\"scooter\",\"description\":\"Big 2-wheel scooter \",\"weight\":\"5.17\"}],\"database\":\"inventory\",\"es\":1589373563000,\"id\":10,\"isDdl\":false,\"mysqlType\":{\"id\":\"INTEGER\",\"name\":\"VARCHAR(255)\",\"description\":\"VARCHAR(512)\",\"weight\":\"FLOAT\"},\"old\":null,\"pkNames\":[\"id\"],\"sql\":\"\",\"sqlType\":{\"id\":4,\"name\":12,\"description\":12,\"weight\":7},\"table\":\"products2\",\"ts\":1589373563798,\"type\":\"DELETE\"}\n+{\"data\":[{\"id\":\"111\",\"name\":\"scooter\",\"description\":\"Big 2-wheel scooter \",\"weight\":\"5.17\"}],\"database\":\"inventory\",\"es\":1589373563000,\"id\":10,\"isDdl\":false,\"mysqlType\":{\"id\":\"INTEGER\",\"name\":\"VARCHAR(255)\",\"description\":\"VARCHAR(512)\",\"weight\":\"FLOAT\"},\"old\":null,\"pkNames\":[\"id\"],\"sql\":\"\",\"sqlType\":{\"id\":4,\"name\":12,\"description\":12,\"weight\":7},\"table\":\"products2\",\"ts\":1589373563798,\"type\":\"CREATE\"}", "originalCommit": "3d5c8594e0371b5d2aab6a58677ac40d1f2892a3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQxMTc2MQ==", "url": "https://github.com/apache/flink/pull/13872#discussion_r516411761", "bodyText": "done", "author": "pyscala", "createdAt": "2020-11-03T03:35:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjAzMDYzNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjAzMTMzMg==", "url": "https://github.com/apache/flink/pull/13872#discussion_r516031332", "bodyText": "Please add a comment what is an CREATE message, and why we just ignore it.", "author": "wuchong", "createdAt": "2020-11-02T15:00:59Z", "path": "flink-formats/flink-json/src/main/java/org/apache/flink/formats/json/canal/CanalJsonDeserializationSchema.java", "diffHunk": "@@ -223,6 +224,8 @@ public void deserialize(byte[] message, Collector<RowData> out) throws IOExcepti\n \t\t\t\t\tinsert.setRowKind(RowKind.DELETE);\n \t\t\t\t\tout.collect(insert);\n \t\t\t\t}\n+\t\t\t} else if (OP_CREATE.equals(type)){\n+\t\t\t\treturn;", "originalCommit": "3d5c8594e0371b5d2aab6a58677ac40d1f2892a3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQxMTczNA==", "url": "https://github.com/apache/flink/pull/13872#discussion_r516411734", "bodyText": "done", "author": "pyscala", "createdAt": "2020-11-03T03:35:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjAzMTMzMg=="}], "type": "inlineReview"}, {"oid": "273f932c618f74665aeaaa83641e17a4e298c3f0", "url": "https://github.com/apache/flink/commit/273f932c618f74665aeaaa83641e17a4e298c3f0", "message": "[FLINK-19873][canal-json] Skip DDL change events for Canal data\n\nThis closes #13872", "committedDate": "2020-11-03T07:52:08Z", "type": "commit"}, {"oid": "273f932c618f74665aeaaa83641e17a4e298c3f0", "url": "https://github.com/apache/flink/commit/273f932c618f74665aeaaa83641e17a4e298c3f0", "message": "[FLINK-19873][canal-json] Skip DDL change events for Canal data\n\nThis closes #13872", "committedDate": "2020-11-03T07:52:08Z", "type": "forcePushed"}]}