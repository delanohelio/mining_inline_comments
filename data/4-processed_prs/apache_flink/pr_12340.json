{"pr_number": 12340, "pr_title": "[FLINK-17844][build] Enforce @PublicEvolving compatibility for minor versions", "pr_createdAt": "2020-05-26T11:47:30Z", "pr_url": "https://github.com/apache/flink/pull/12340", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQ3MTk5Ng==", "url": "https://github.com/apache/flink/pull/12340#discussion_r430471996", "bodyText": "Isn't \"major.minor.patch\" the \"official\" terminology for versions?", "author": "rmetzger", "createdAt": "2020-05-26T14:49:40Z", "path": "tools/releasing/create_release_branch.sh", "diffHunk": "@@ -59,6 +59,22 @@ git checkout -b $target_branch\n #change version in all pom files\n find . -name 'pom.xml' -type f -exec perl -pi -e 's#<version>(.*)'$OLD_VERSION'(.*)</version>#<version>${1}'$NEW_VERSION'${2}</version>#' {} \\;\n \n+ultra=$(echo \"${NEW_VERSION}\" | perl -p -e 's#(\\d+)\\.\\d+\\.\\d+#$1#')\n+major=$(echo \"${NEW_VERSION}\" | perl -p -e 's#\\d+\\.(\\d+)\\.\\d+#$1#')\n+minor=$(echo \"${NEW_VERSION}\" | perl -p -e 's#\\d+\\.\\d+\\.(\\d+)#$1#')", "originalCommit": "4c67c51b003823e1abd4373963f7d1ea53e829b6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDUzMDgwMQ==", "url": "https://github.com/apache/flink/pull/12340#discussion_r430530801", "bodyText": "no;  we use ?.major.minor unfortunately.", "author": "zentol", "createdAt": "2020-05-26T16:05:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQ3MTk5Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDYxODYyNA==", "url": "https://github.com/apache/flink/pull/12340#discussion_r430618624", "bodyText": "I know that we are not using the right terminologies in Flink, but maybe this is our chance of slowly introducing new terms.", "author": "rmetzger", "createdAt": "2020-05-26T18:25:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQ3MTk5Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTAxMjMzOQ==", "url": "https://github.com/apache/flink/pull/12340#discussion_r431012339", "bodyText": "Doing that will just introduce confusion; recent discussions on the ML showed that several devs were not aware of our version scheme, so it could easily happen that another one sees this and thinks that's what we are using.", "author": "zentol", "createdAt": "2020-05-27T10:20:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQ3MTk5Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTA0NTUyMQ==", "url": "https://github.com/apache/flink/pull/12340#discussion_r431045521", "bodyText": "+1", "author": "rmetzger", "createdAt": "2020-05-27T11:25:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQ3MTk5Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQ4MjIxMg==", "url": "https://github.com/apache/flink/pull/12340#discussion_r430482212", "bodyText": "Shouldn't these changes go into releasing/update_branch_version.sh? This file here seems to be used for preparing release candidate branches. (According to https://cwiki.apache.org/confluence/display/FLINK/Creating+a+Flink+Release#CreatingaFlinkRelease-Createareleasebranch)", "author": "rmetzger", "createdAt": "2020-05-26T15:03:09Z", "path": "tools/releasing/create_release_branch.sh", "diffHunk": "@@ -59,6 +59,22 @@ git checkout -b $target_branch\n #change version in all pom files\n find . -name 'pom.xml' -type f -exec perl -pi -e 's#<version>(.*)'$OLD_VERSION'(.*)</version>#<version>${1}'$NEW_VERSION'${2}</version>#' {} \\;\n \n+ultra=$(echo \"${NEW_VERSION}\" | perl -p -e 's#(\\d+)\\.\\d+\\.\\d+#$1#')\n+major=$(echo \"${NEW_VERSION}\" | perl -p -e 's#\\d+\\.(\\d+)\\.\\d+#$1#')\n+minor=$(echo \"${NEW_VERSION}\" | perl -p -e 's#\\d+\\.\\d+\\.(\\d+)#$1#')\n+\n+# update japicmp configuration\n+if [[ ${minor} == \"0\" ]]; then\n+  # set japicmp reference version to previous major version\n+  perl -pi -e 's#(<japicmp.referenceVersion>).*(</japicmp.referenceVersion>)#${1}'${ultra}.$((${major}-1)).0'${2}#' pom.xml\n+else\n+  # set japicmp reference version to previous minor version\n+  perl -pi -e 's#(<japicmp.referenceVersion>).*(</japicmp.referenceVersion>)#${1}'${ultra}.${major}.$(($minor - 1))'${2}#' pom.xml\n+  # harden compatibility constraints for minor versions\n+  perl -pi -e 's#<!--(<include>\\@org.apache.flink.annotation.PublicEvolving</include>)-->#${1}#' pom.xml\n+  perl -pi -e 's#\\t+<exclude>\\@org.apache.flink.annotation.PublicEvolving.*\\n##' pom.xml\n+fi", "originalCommit": "4c67c51b003823e1abd4373963f7d1ea53e829b6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDUzNDk2MA==", "url": "https://github.com/apache/flink/pull/12340#discussion_r430534960", "bodyText": "hmm, you're right, but I think we should have both.\nFor the release-X.Y branches we have to update the configuration manually, so this PR is more of a final safeguard for actual releases in case the the manual update is forgotten, which is basically guaranteed to happen at some point.", "author": "zentol", "createdAt": "2020-05-26T16:11:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQ4MjIxMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDYyMjMzNg==", "url": "https://github.com/apache/flink/pull/12340#discussion_r430622336", "bodyText": "Ah, so the idea is that the build of a release-x.y.z-rci branch would fail (as a last resort) because the japicmp plugin gets reconfigured as part of the release process.\nBut ideally the release managers manually uncomment this one line in the pom in the release-X.Y branch.", "author": "rmetzger", "createdAt": "2020-05-26T18:31:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQ4MjIxMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTAxNTYzMg==", "url": "https://github.com/apache/flink/pull/12340#discussion_r431015632", "bodyText": "It wasn't the original idea, I just remembered wrong how the release process works.\nAs for the manual work, the RM has to un-comment the line, remove the exclusion and update the reference version to the last release minor version.\nUltimately the logic is identical, so I'll see if I can refactor this update into a separate script that the RM can call.", "author": "zentol", "createdAt": "2020-05-27T10:26:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQ4MjIxMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQ4MzQxNA==", "url": "https://github.com/apache/flink/pull/12340#discussion_r430483414", "bodyText": "Maybe update the comment that this will be done automatically by a script?", "author": "rmetzger", "createdAt": "2020-05-26T15:04:48Z", "path": "pom.xml", "diffHunk": "@@ -1961,6 +1961,8 @@ under the License.\n \t\t\t\t\t\t\t<onlyModified>true</onlyModified>\n \t\t\t\t\t\t\t<includes>\n \t\t\t\t\t\t\t\t<include>@org.apache.flink.annotation.Public</include>\n+\t\t\t\t\t\t\t\t<!-- The following line must be un-commented for minor releases-->", "originalCommit": "4c67c51b003823e1abd4373963f7d1ea53e829b6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "122bae66113d7f2430c2568d594d39e38fe22585", "url": "https://github.com/apache/flink/commit/122bae66113d7f2430c2568d594d39e38fe22585", "message": "rev2", "committedDate": "2020-05-27T12:54:36Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTQxMzQ5NQ==", "url": "https://github.com/apache/flink/pull/12340#discussion_r431413495", "bodyText": "when do we have a branch name containing \"-SNAPSHOT\"? Shouldn't this be a check on the version set in the ./pom.xml ?", "author": "rmetzger", "createdAt": "2020-05-27T20:10:18Z", "path": "tools/releasing/update_japicmp_configuration.sh", "diffHunk": "@@ -0,0 +1,83 @@\n+#!/usr/bin/env bash\n+\n+#\n+# Licensed to the Apache Software Foundation (ASF) under one or more\n+# contributor license agreements.  See the NOTICE file distributed with\n+# this work for additional information regarding copyright ownership.\n+# The ASF licenses this file to You under the Apache License, Version 2.0\n+# (the \"License\"); you may not use this file except in compliance with\n+# the License.  You may obtain a copy of the License at\n+#\n+#    http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+#\n+\n+if [ -z \"${NEW_VERSION}\" ]; then\n+    echo \"NEW_VERSION was not set.\"\n+    exit 1\n+fi\n+\n+CURR_DIR=`pwd`\n+if [[ `basename $CURR_DIR` != \"tools\" ]] ; then\n+  echo \"You have to call the script from the tools/ dir\"\n+  exit 1\n+fi\n+\n+# Idealized use-cases:\n+# Scenario A) New major release X.Y.0\n+#   Premise:\n+#     There is a master branch with a version X.Y-SNAPSHOT, with a japicmp reference version of X.(Y-1).0 .\n+#   Release flow:\n+#     - update the master to X.(Y+1)-SNAPSHOT, but keep the reference version intact since X.Y.0 is not released (yet)\n+#     - create X.Y-SNAPSHOT branch, but keep the reference version intact since X.Y.0 is not released (yet)\n+#     - release X.Y.0\n+#     - update the japicmp reference version of both master and X.Y-SNAPSHOT to X.Y.0\n+#     - enable stronger compatibility constraints for X.Y-SNAPSHOT to ensure compatibility for PublicEvolving\n+# Scenario B) New minor release X.Y.Z\n+#   Premise:\n+#     There is a snapshot branch with a version X.Y-SNAPSHOT, with a japicmp reference version of X.Y.(Z-1)\n+#   Release flow:\n+#     - create X.Y.Z-rc branch\n+#     - update the japicmp reference version of X.Y.Z to X.Y.(Z-1)\n+#     - release X.Y.Z\n+#     - update the japicmp reference version of X.Y-SNAPSHOT to X.Y.Z\n+\n+POM=../pom.xml\n+function enable_public_evolving_compatibility_checks() {\n+  perl -pi -e 's#<!--(<include>\\@org.apache.flink.annotation.PublicEvolving</include>)-->#${1}#' ${POM}\n+  perl -pi -e 's#\\t+<exclude>\\@org.apache.flink.annotation.PublicEvolving.*\\n##' ${POM}\n+}\n+\n+function set_japicmp_reference_version() {\n+  local version=$1\n+\n+  perl -pi -e 's#(<japicmp.referenceVersion>).*(</japicmp.referenceVersion>)#${1}'${version}'${2}#' ${POM}\n+}\n+\n+current_branch=$(git rev-parse --abbrev-ref HEAD)\n+\n+if [[ ${current_branch} =~ -rc ]]; then\n+  # release branch\n+  version_prefix=$(echo \"${NEW_VERSION}\" | perl -p -e 's#(\\d+\\.\\d+)\\.\\d+#$1#')\n+  minor=$(echo \"${NEW_VERSION}\" | perl -p -e 's#\\d+\\.\\d+\\.(\\d+)#$1#')\n+  if ! [[ ${minor} == \"0\" ]]; then\n+    set_japicmp_reference_version ${version_prefix}.$((minor - 1))\n+    # this is a safeguard in case the manual step of enabling checks after the X.Y.0 release was forgotten\n+    enable_public_evolving_compatibility_checks\n+  fi\n+elif [[ ${current_branch} =~ -SNAPSHOT ]]; then", "originalCommit": "122bae66113d7f2430c2568d594d39e38fe22585", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTQ2MzM2Nw==", "url": "https://github.com/apache/flink/pull/12340#discussion_r431463367", "bodyText": "When for example we just released 1.11.0 and want to updated 1.11-SNAPSHOT to check against 1.11.0 and enable compatibility guarantees .", "author": "zentol", "createdAt": "2020-05-27T21:50:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTQxMzQ5NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTYzNTAwNg==", "url": "https://github.com/apache/flink/pull/12340#discussion_r431635006", "bodyText": "Will also be a manual invocation of the script described in the release guide?\nThe RM will have to rename release-1.11 to release-1.11-SNAPSHOT and then run this script after 1.11.0 has been released?\nI still wonder why this check is on the branch name, and not the version.", "author": "rmetzger", "createdAt": "2020-05-28T07:28:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTQxMzQ5NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTczMDUxNQ==", "url": "https://github.com/apache/flink/pull/12340#discussion_r431730515", "bodyText": "ah right, the branch name does not contain snapshot doesn't it. hmm :/\nWe do need to take the branch name into consideration since we never want to enable stronger guarantees on the master branch.", "author": "zentol", "createdAt": "2020-05-28T10:17:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTQxMzQ5NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTczMjc4MQ==", "url": "https://github.com/apache/flink/pull/12340#discussion_r431732781", "bodyText": "Now checks for a release- prefix, after the rc/master checks.", "author": "zentol", "createdAt": "2020-05-28T10:21:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTQxMzQ5NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTQyMTUzOA==", "url": "https://github.com/apache/flink/pull/12340#discussion_r431421538", "bodyText": "This case (and the previous one) require a manual invocation of update_japicmp_configuration.sh by the RM, right? (I assume you'll update the wiki?)", "author": "rmetzger", "createdAt": "2020-05-27T20:26:55Z", "path": "tools/releasing/update_japicmp_configuration.sh", "diffHunk": "@@ -0,0 +1,83 @@\n+#!/usr/bin/env bash\n+\n+#\n+# Licensed to the Apache Software Foundation (ASF) under one or more\n+# contributor license agreements.  See the NOTICE file distributed with\n+# this work for additional information regarding copyright ownership.\n+# The ASF licenses this file to You under the Apache License, Version 2.0\n+# (the \"License\"); you may not use this file except in compliance with\n+# the License.  You may obtain a copy of the License at\n+#\n+#    http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+#\n+\n+if [ -z \"${NEW_VERSION}\" ]; then\n+    echo \"NEW_VERSION was not set.\"\n+    exit 1\n+fi\n+\n+CURR_DIR=`pwd`\n+if [[ `basename $CURR_DIR` != \"tools\" ]] ; then\n+  echo \"You have to call the script from the tools/ dir\"\n+  exit 1\n+fi\n+\n+# Idealized use-cases:\n+# Scenario A) New major release X.Y.0\n+#   Premise:\n+#     There is a master branch with a version X.Y-SNAPSHOT, with a japicmp reference version of X.(Y-1).0 .\n+#   Release flow:\n+#     - update the master to X.(Y+1)-SNAPSHOT, but keep the reference version intact since X.Y.0 is not released (yet)\n+#     - create X.Y-SNAPSHOT branch, but keep the reference version intact since X.Y.0 is not released (yet)\n+#     - release X.Y.0\n+#     - update the japicmp reference version of both master and X.Y-SNAPSHOT to X.Y.0\n+#     - enable stronger compatibility constraints for X.Y-SNAPSHOT to ensure compatibility for PublicEvolving\n+# Scenario B) New minor release X.Y.Z\n+#   Premise:\n+#     There is a snapshot branch with a version X.Y-SNAPSHOT, with a japicmp reference version of X.Y.(Z-1)\n+#   Release flow:\n+#     - create X.Y.Z-rc branch\n+#     - update the japicmp reference version of X.Y.Z to X.Y.(Z-1)\n+#     - release X.Y.Z\n+#     - update the japicmp reference version of X.Y-SNAPSHOT to X.Y.Z\n+\n+POM=../pom.xml\n+function enable_public_evolving_compatibility_checks() {\n+  perl -pi -e 's#<!--(<include>\\@org.apache.flink.annotation.PublicEvolving</include>)-->#${1}#' ${POM}\n+  perl -pi -e 's#\\t+<exclude>\\@org.apache.flink.annotation.PublicEvolving.*\\n##' ${POM}\n+}\n+\n+function set_japicmp_reference_version() {\n+  local version=$1\n+\n+  perl -pi -e 's#(<japicmp.referenceVersion>).*(</japicmp.referenceVersion>)#${1}'${version}'${2}#' ${POM}\n+}\n+\n+current_branch=$(git rev-parse --abbrev-ref HEAD)\n+\n+if [[ ${current_branch} =~ -rc ]]; then\n+  # release branch\n+  version_prefix=$(echo \"${NEW_VERSION}\" | perl -p -e 's#(\\d+\\.\\d+)\\.\\d+#$1#')\n+  minor=$(echo \"${NEW_VERSION}\" | perl -p -e 's#\\d+\\.\\d+\\.(\\d+)#$1#')\n+  if ! [[ ${minor} == \"0\" ]]; then\n+    set_japicmp_reference_version ${version_prefix}.$((minor - 1))\n+    # this is a safeguard in case the manual step of enabling checks after the X.Y.0 release was forgotten\n+    enable_public_evolving_compatibility_checks\n+  fi\n+elif [[ ${current_branch} =~ -SNAPSHOT ]]; then\n+  # snapshot branch\n+  set_japicmp_reference_version ${NEW_VERSION}\n+  enable_public_evolving_compatibility_checks\n+elif [[ ${current_branch} =~ ^master$ ]]; then", "originalCommit": "122bae66113d7f2430c2568d594d39e38fe22585", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTQ2MjUyMA==", "url": "https://github.com/apache/flink/pull/12340#discussion_r431462520", "bodyText": "correct", "author": "zentol", "createdAt": "2020-05-27T21:49:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTQyMTUzOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTQyMjAzNg==", "url": "https://github.com/apache/flink/pull/12340#discussion_r431422036", "bodyText": "for this case, the RM doesn't need to invoke this script, because it is called from the create_release_branch.sh script, right?", "author": "rmetzger", "createdAt": "2020-05-27T20:27:51Z", "path": "tools/releasing/update_japicmp_configuration.sh", "diffHunk": "@@ -0,0 +1,83 @@\n+#!/usr/bin/env bash\n+\n+#\n+# Licensed to the Apache Software Foundation (ASF) under one or more\n+# contributor license agreements.  See the NOTICE file distributed with\n+# this work for additional information regarding copyright ownership.\n+# The ASF licenses this file to You under the Apache License, Version 2.0\n+# (the \"License\"); you may not use this file except in compliance with\n+# the License.  You may obtain a copy of the License at\n+#\n+#    http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+#\n+\n+if [ -z \"${NEW_VERSION}\" ]; then\n+    echo \"NEW_VERSION was not set.\"\n+    exit 1\n+fi\n+\n+CURR_DIR=`pwd`\n+if [[ `basename $CURR_DIR` != \"tools\" ]] ; then\n+  echo \"You have to call the script from the tools/ dir\"\n+  exit 1\n+fi\n+\n+# Idealized use-cases:\n+# Scenario A) New major release X.Y.0\n+#   Premise:\n+#     There is a master branch with a version X.Y-SNAPSHOT, with a japicmp reference version of X.(Y-1).0 .\n+#   Release flow:\n+#     - update the master to X.(Y+1)-SNAPSHOT, but keep the reference version intact since X.Y.0 is not released (yet)\n+#     - create X.Y-SNAPSHOT branch, but keep the reference version intact since X.Y.0 is not released (yet)\n+#     - release X.Y.0\n+#     - update the japicmp reference version of both master and X.Y-SNAPSHOT to X.Y.0\n+#     - enable stronger compatibility constraints for X.Y-SNAPSHOT to ensure compatibility for PublicEvolving\n+# Scenario B) New minor release X.Y.Z\n+#   Premise:\n+#     There is a snapshot branch with a version X.Y-SNAPSHOT, with a japicmp reference version of X.Y.(Z-1)\n+#   Release flow:\n+#     - create X.Y.Z-rc branch\n+#     - update the japicmp reference version of X.Y.Z to X.Y.(Z-1)\n+#     - release X.Y.Z\n+#     - update the japicmp reference version of X.Y-SNAPSHOT to X.Y.Z\n+\n+POM=../pom.xml\n+function enable_public_evolving_compatibility_checks() {\n+  perl -pi -e 's#<!--(<include>\\@org.apache.flink.annotation.PublicEvolving</include>)-->#${1}#' ${POM}\n+  perl -pi -e 's#\\t+<exclude>\\@org.apache.flink.annotation.PublicEvolving.*\\n##' ${POM}\n+}\n+\n+function set_japicmp_reference_version() {\n+  local version=$1\n+\n+  perl -pi -e 's#(<japicmp.referenceVersion>).*(</japicmp.referenceVersion>)#${1}'${version}'${2}#' ${POM}\n+}\n+\n+current_branch=$(git rev-parse --abbrev-ref HEAD)\n+\n+if [[ ${current_branch} =~ -rc ]]; then", "originalCommit": "122bae66113d7f2430c2568d594d39e38fe22585", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTQ2MjQ4Nw==", "url": "https://github.com/apache/flink/pull/12340#discussion_r431462487", "bodyText": "correct", "author": "zentol", "createdAt": "2020-05-27T21:49:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTQyMjAzNg=="}], "type": "inlineReview"}, {"oid": "07e80c0c14c3ac3358423e4e22788a0de2c0e39a", "url": "https://github.com/apache/flink/commit/07e80c0c14c3ac3358423e4e22788a0de2c0e39a", "message": "[FLINK-17844][build] Add tooling for updating japicmp configuration", "committedDate": "2020-05-29T07:22:50Z", "type": "commit"}, {"oid": "07e80c0c14c3ac3358423e4e22788a0de2c0e39a", "url": "https://github.com/apache/flink/commit/07e80c0c14c3ac3358423e4e22788a0de2c0e39a", "message": "[FLINK-17844][build] Add tooling for updating japicmp configuration", "committedDate": "2020-05-29T07:22:50Z", "type": "forcePushed"}]}