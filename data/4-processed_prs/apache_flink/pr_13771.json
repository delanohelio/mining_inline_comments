{"pr_number": 13771, "pr_title": "[FLINK-19789][hive] Migrate Hive connector to new table source sink interface", "pr_createdAt": "2020-10-23T12:21:17Z", "pr_url": "https://github.com/apache/flink/pull/13771", "timeline": [{"oid": "e5442954ffac19a92ba1f9a4620584e61acb601a", "url": "https://github.com/apache/flink/commit/e5442954ffac19a92ba1f9a4620584e61acb601a", "message": "Rebase&Fix", "committedDate": "2020-10-24T01:58:10Z", "type": "forcePushed"}, {"oid": "ad11b74a07505a1074e060977f46c485de64ae8a", "url": "https://github.com/apache/flink/commit/ad11b74a07505a1074e060977f46c485de64ae8a", "message": "[FLINK-19789][hive] Migrate Hive connector to new table source sink interface", "committedDate": "2020-10-26T03:04:36Z", "type": "commit"}, {"oid": "7dd404bb2fa589808d0c8b18c84fcae8da2a9c96", "url": "https://github.com/apache/flink/commit/7dd404bb2fa589808d0c8b18c84fcae8da2a9c96", "message": "Rebase&Fix", "committedDate": "2020-10-26T03:04:37Z", "type": "commit"}, {"oid": "7cb29bdf576ab721181dcf526e0ec1575971ee33", "url": "https://github.com/apache/flink/commit/7cb29bdf576ab721181dcf526e0ec1575971ee33", "message": "Fix cases", "committedDate": "2020-10-26T04:08:11Z", "type": "commit"}, {"oid": "7cb29bdf576ab721181dcf526e0ec1575971ee33", "url": "https://github.com/apache/flink/commit/7cb29bdf576ab721181dcf526e0ec1575971ee33", "message": "Fix cases", "committedDate": "2020-10-26T04:08:11Z", "type": "forcePushed"}, {"oid": "625bb55bba2c6febed70a805ffddef883b736dbc", "url": "https://github.com/apache/flink/commit/625bb55bba2c6febed70a805ffddef883b736dbc", "message": "Fix partition pruning", "committedDate": "2020-10-26T04:57:04Z", "type": "commit"}, {"oid": "ed12105171506a6cca4dfba4a228ded0d8215c2e", "url": "https://github.com/apache/flink/commit/ed12105171506a6cca4dfba4a228ded0d8215c2e", "message": "Revert no need changes", "committedDate": "2020-10-26T06:30:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTc0MzQyNA==", "url": "https://github.com/apache/flink/pull/13771#discussion_r511743424", "bodyText": "Unused field remainingPartitions", "author": "fsk119", "createdAt": "2020-10-26T06:38:02Z", "path": "flink-table/flink-table-planner-blink/src/main/java/org/apache/flink/table/planner/plan/rules/logical/PushPartitionIntoTableSourceScanRule.java", "diffHunk": "@@ -239,46 +239,40 @@ public RexNode visitInputRef(RexInputRef inputRef) {\n \t\t// get partitions from table/catalog and prune\n \t\tOptional<Catalog> catalogOptional = context.getCatalogManager().getCatalog(tableSourceTable.tableIdentifier().getCatalogName());\n \t\tList<Map<String, String>> remainingPartitions;", "originalCommit": "625bb55bba2c6febed70a805ffddef883b736dbc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "2ed42b2dd882c30eff6a0dc3f5e8cf5546958448", "url": "https://github.com/apache/flink/commit/2ed42b2dd882c30eff6a0dc3f5e8cf5546958448", "message": "Address comment", "committedDate": "2020-10-26T06:55:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjUzOTAyOA==", "url": "https://github.com/apache/flink/pull/13771#discussion_r512539028", "bodyText": "Should we report error for the else branch ?", "author": "danny0405", "createdAt": "2020-10-27T09:35:26Z", "path": "flink-connectors/flink-connector-hive/src/main/java/org/apache/flink/connectors/hive/HiveTableSource.java", "diffHunk": "@@ -346,63 +329,30 @@ private TableSchema getProducedTableSchema() {\n \t}\n \n \t@Override\n-\tpublic boolean isLimitPushedDown() {\n-\t\treturn isLimitPushDown;\n+\tpublic void applyLimit(long limit) {\n+\t\tthis.limit = limit;\n \t}\n \n \t@Override\n-\tpublic TableSource<RowData> applyLimit(long limit) {\n-\t\treturn new HiveTableSource(\n-\t\t\t\tjobConf,\n-\t\t\t\tflinkConf,\n-\t\t\t\ttablePath,\n-\t\t\t\tcatalogTable,\n-\t\t\t\tremainingPartitions,\n-\t\t\t\thiveVersion,\n-\t\t\t\tpartitionPruned,\n-\t\t\t\tprojectedFields,\n-\t\t\t\ttrue,\n-\t\t\t\tlimit);\n+\tpublic Optional<List<Map<String, String>>> listPartitions() {\n+\t\treturn Optional.empty();\n \t}\n \n \t@Override\n-\tpublic List<Map<String, String>> getPartitions() {\n-\t\tthrow new UnsupportedOperationException(\n-\t\t\t\t\"Please use Catalog API to retrieve all partitions of a table\");\n+\tpublic void applyPartitions(List<Map<String, String>> remainingPartitions) {\n+\t\tif (catalogTable.getPartitionKeys() != null && catalogTable.getPartitionKeys().size() != 0) {\n+\t\t\tthis.remainingPartitions = remainingPartitions;\n+\t\t}", "originalCommit": "2ed42b2dd882c30eff6a0dc3f5e8cf5546958448", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjU0Mzg1NQ==", "url": "https://github.com/apache/flink/pull/13771#discussion_r512543855", "bodyText": "I think we can", "author": "JingsongLi", "createdAt": "2020-10-27T09:42:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjUzOTAyOA=="}], "type": "inlineReview"}, {"oid": "9680240b60dbc74b3e0b53ddf9a5f605e4042c89", "url": "https://github.com/apache/flink/commit/9680240b60dbc74b3e0b53ddf9a5f605e4042c89", "message": "Address comment", "committedDate": "2020-10-27T10:41:42Z", "type": "commit"}]}