{"pr_number": 11439, "pr_title": "[FLINK-16650][python] Support LocalZonedTimestampType for Python UDF in blink planner", "pr_createdAt": "2020-03-18T11:52:12Z", "pr_url": "https://github.com/apache/flink/pull/11439", "timeline": [{"oid": "b8aa27ee90dac9820c29551644431f004094c527", "url": "https://github.com/apache/flink/commit/b8aa27ee90dac9820c29551644431f004094c527", "message": "[FLINK-16650][python] Support LocalZonedTimestampType for Python UDF in blink planner", "committedDate": "2020-03-18T11:47:30Z", "type": "commit"}, {"oid": "d65c0ec99a4b0ca509ebd83d55a5f9c21aa40db5", "url": "https://github.com/apache/flink/commit/d65c0ec99a4b0ca509ebd83d55a5f9c21aa40db5", "message": "fix tests", "committedDate": "2020-03-18T15:09:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDc3MDI2Mw==", "url": "https://github.com/apache/flink/pull/11439#discussion_r394770263", "bodyText": "Change to getConfig(planner.getTableConfig)? so that we don't need to change the signature of createPythonOneInputTransformation()", "author": "hequn8128", "createdAt": "2020-03-19T03:26:39Z", "path": "flink-table/flink-table-planner-blink/src/main/scala/org/apache/flink/table/planner/plan/nodes/physical/batch/BatchExecPythonCalc.scala", "diffHunk": "@@ -58,7 +58,7 @@ class BatchExecPythonCalc(\n       inputTransform,\n       calcProgram,\n       \"BatchExecPythonCalc\",\n-      planner.getTableConfig.getConfiguration)\n+      planner.getTableConfig)", "originalCommit": "d65c0ec99a4b0ca509ebd83d55a5f9c21aa40db5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDc3MTk0NQ==", "url": "https://github.com/apache/flink/pull/11439#discussion_r394771945", "bodyText": "Take local timezone into consideration? For example, time 0h in Japen should return -1h in China.", "author": "hequn8128", "createdAt": "2020-03-19T03:33:51Z", "path": "flink-python/pyflink/table/types.py", "diffHunk": "@@ -490,12 +492,20 @@ def need_conversion(self):\n \n     def to_sql_type(self, dt):\n         if dt is not None:\n+            if dt.tzinfo is not None:\n+                offset = dt.utcoffset()\n+                offset = offset if offset else datetime.timedelta()\n+                offset_microseconds =\\\n+                    (offset.days * 86400 + offset.seconds) * 10 ** 6 + offset.microseconds\n+            else:\n+                offset_microseconds = self.EPOCH_ORDINAL\n             seconds = (calendar.timegm(dt.utctimetuple()) if dt.tzinfo\n                        else time.mktime(dt.timetuple()))\n-            return int(seconds) * 10 ** 6 + dt.microsecond\n+            return int(seconds) * 10 ** 6 + dt.microsecond + offset_microseconds", "originalCommit": "d65c0ec99a4b0ca509ebd83d55a5f9c21aa40db5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDc3NDAwOQ==", "url": "https://github.com/apache/flink/pull/11439#discussion_r394774009", "bodyText": "Add python tests for the coder. e.g. tests in test_coders_common.py.", "author": "hequn8128", "createdAt": "2020-03-19T03:40:01Z", "path": "flink-python/pyflink/fn_execution/coders.py", "diffHunk": "@@ -377,6 +380,22 @@ def to_type_hint(self):\n         return datetime.datetime\n \n \n+class LocalZonedTimestampCoder(DeterministicCoder):", "originalCommit": "d65c0ec99a4b0ca509ebd83d55a5f9c21aa40db5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "a6a131a49ad032d36abbcf6292a37fe5b83d324b", "url": "https://github.com/apache/flink/commit/a6a131a49ad032d36abbcf6292a37fe5b83d324b", "message": "Address review", "committedDate": "2020-03-19T05:43:33Z", "type": "commit"}, {"oid": "a6a131a49ad032d36abbcf6292a37fe5b83d324b", "url": "https://github.com/apache/flink/commit/a6a131a49ad032d36abbcf6292a37fe5b83d324b", "message": "Address review", "committedDate": "2020-03-19T05:43:33Z", "type": "forcePushed"}, {"oid": "b7fb7300c3e98559ebf8051b805c06ba95f68446", "url": "https://github.com/apache/flink/commit/b7fb7300c3e98559ebf8051b805c06ba95f68446", "message": "fix tests", "committedDate": "2020-03-19T07:14:38Z", "type": "commit"}, {"oid": "e09703f6131909778568c17974e275f229ac6e66", "url": "https://github.com/apache/flink/commit/e09703f6131909778568c17974e275f229ac6e66", "message": "fix tests", "committedDate": "2020-03-19T09:47:26Z", "type": "commit"}]}