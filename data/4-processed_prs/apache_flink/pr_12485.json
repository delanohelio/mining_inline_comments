{"pr_number": 12485, "pr_title": "[FLINK-18130][hive][fs-connector] File name conflict for different jobs in filesystem/hive sink", "pr_createdAt": "2020-06-04T13:03:13Z", "pr_url": "https://github.com/apache/flink/pull/12485", "timeline": [{"oid": "765ffd5d614376c2fde93440c9c904a80e1eab94", "url": "https://github.com/apache/flink/commit/765ffd5d614376c2fde93440c9c904a80e1eab94", "message": "[FLINK-18130][hive][fs-connector] File name conflict for different jobs in filesystem/hive sink", "committedDate": "2020-06-05T07:53:41Z", "type": "commit"}, {"oid": "765ffd5d614376c2fde93440c9c904a80e1eab94", "url": "https://github.com/apache/flink/commit/765ffd5d614376c2fde93440c9c904a80e1eab94", "message": "[FLINK-18130][hive][fs-connector] File name conflict for different jobs in filesystem/hive sink", "committedDate": "2020-06-05T07:53:41Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQ0MzQ1Nw==", "url": "https://github.com/apache/flink/pull/12485#discussion_r436443457", "bodyText": "Here seems inconsistent with this method's comment: rename does not delete the dest path if it exists on HDFS. Instead, it will keep the srcPath and dest Path unchanged.", "author": "gaoyunhaii", "createdAt": "2020-06-08T03:42:02Z", "path": "flink-table/flink-table-runtime-blink/src/main/java/org/apache/flink/table/filesystem/PartitionLoader.java", "diffHunk": "@@ -113,12 +113,7 @@ private void renameFiles(List<Path> srcDirs, Path destDir) throws Exception {\n \t\t\t\t\tfor (FileStatus srcFile : srcFiles) {\n \t\t\t\t\t\tPath srcPath = srcFile.getPath();\n \t\t\t\t\t\tPath destPath = new Path(destDir, srcPath.getName());\n-\t\t\t\t\t\tint count = 1;\n-\t\t\t\t\t\twhile (!fs.rename(srcPath, destPath)) {\n-\t\t\t\t\t\t\tString name = srcPath.getName() + \"_copy_\" + count;\n-\t\t\t\t\t\t\tdestPath = new Path(destDir, name);\n-\t\t\t\t\t\t\tcount++;\n-\t\t\t\t\t\t}\n+\t\t\t\t\t\tfs.rename(srcPath, destPath);", "originalCommit": "765ffd5d614376c2fde93440c9c904a80e1eab94", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQ0NTE1Nw==", "url": "https://github.com/apache/flink/pull/12485#discussion_r436445157", "bodyText": "The comment is out of date, the overwrite is occurred in overwrite(Path) method instead of here.\nNow it is consistent with HadoopRecoverableFsDataOutputStream.commit.\nI will update comments.", "author": "JingsongLi", "createdAt": "2020-06-08T03:52:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQ0MzQ1Nw=="}], "type": "inlineReview"}, {"oid": "8f5f67699dfce0b311bf197f3d26df4ac16fa6a0", "url": "https://github.com/apache/flink/commit/8f5f67699dfce0b311bf197f3d26df4ac16fa6a0", "message": "Update comments", "committedDate": "2020-06-08T03:52:21Z", "type": "commit"}]}