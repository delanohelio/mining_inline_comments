{"pr_number": 11021, "pr_title": "[FLINK-15546][table-planner-blink] Fix obscure error message from Sca\u2026", "pr_createdAt": "2020-02-05T12:00:06Z", "pr_url": "https://github.com/apache/flink/pull/11021", "timeline": [{"oid": "0396817cd5d850704f3edc7b8196473afcd00cdf", "url": "https://github.com/apache/flink/commit/0396817cd5d850704f3edc7b8196473afcd00cdf", "message": "[FLINK-15546][table-planner-blink] Fix obscure error message from ScalarOperatorGens::generateCast", "committedDate": "2020-02-05T11:50:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjIzMDQwOA==", "url": "https://github.com/apache/flink/pull/11021#discussion_r376230408", "bodyText": "This test case can't reproduce the problem which reported by this issue. You should add a test case which cast a ROW to another ROW, e.g.\ntestSqlApi(\"CAST(f5 AS ROW<f0 INT, f1 STRING>)\", \"\")", "author": "wuchong", "createdAt": "2020-02-07T06:19:31Z", "path": "flink-table/flink-table-planner-blink/src/test/scala/org/apache/flink/table/planner/expressions/RowTypeTest.scala", "diffHunk": "@@ -129,4 +128,17 @@ class RowTypeTest extends RowTypeTestBase {\n       \"null\"\n     )\n   }\n+\n+  @Test\n+  def testUnsupportedCast(): Unit = {\n+    expectedException.expect(classOf[ValidationException])\n+    expectedException.expectMessage(\n+      \"Unsupported cast from Row(f0: String, f1: Boolean) to Long\")\n+\n+    testTableApi(\n+      'f5.cast(DataTypes.BIGINT()),", "originalCommit": "0396817cd5d850704f3edc7b8196473afcd00cdf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjIzMTI5Ng==", "url": "https://github.com/apache/flink/pull/11021#discussion_r376231296", "bodyText": "Ah... This is table api, we want to fix sql api.", "author": "JingsongLi", "createdAt": "2020-02-07T06:23:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjIzMDQwOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjIzMTY2OQ==", "url": "https://github.com/apache/flink/pull/11021#discussion_r376231669", "bodyText": "You should keep table api and sql api both.", "author": "JingsongLi", "createdAt": "2020-02-07T06:25:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjIzMDQwOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjIzNjU2Mg==", "url": "https://github.com/apache/flink/pull/11021#discussion_r376236562", "bodyText": "OK, Added a sql api test.", "author": "docete", "createdAt": "2020-02-07T06:48:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjIzMDQwOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjIzMTM1NQ==", "url": "https://github.com/apache/flink/pull/11021#discussion_r376231355", "bodyText": "Nit: Add '' to table api too.", "author": "JingsongLi", "createdAt": "2020-02-07T06:24:06Z", "path": "flink-table/flink-table-planner-blink/src/main/scala/org/apache/flink/table/planner/codegen/calls/ScalarOperatorGens.scala", "diffHunk": "@@ -1280,8 +1280,8 @@ object ScalarOperatorGens {\n           | (INTERVAL_YEAR_MONTH, BIGINT) =>\n       internalExprCasting(operand, targetType)\n \n-    case (from, to) =>\n-      throw new CodeGenException(s\"Unsupported cast from '$from' to '$to'.\")\n+    case (_, _) =>\n+      throw new CodeGenException(s\"Unsupported cast from '${operand.resultType}' to '$targetType'.\")", "originalCommit": "0396817cd5d850704f3edc7b8196473afcd00cdf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjIzNjYwOA==", "url": "https://github.com/apache/flink/pull/11021#discussion_r376236608", "bodyText": "modified", "author": "docete", "createdAt": "2020-02-07T06:48:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjIzMTM1NQ=="}], "type": "inlineReview"}, {"oid": "6569bb9fdc622da86b48abe6b00263e720d5bbe8", "url": "https://github.com/apache/flink/commit/6569bb9fdc622da86b48abe6b00263e720d5bbe8", "message": "fixup: add test case to verify SQL api and improve error message for Table api", "committedDate": "2020-02-07T06:47:09Z", "type": "commit"}]}