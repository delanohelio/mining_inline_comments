{"pr_number": 10945, "pr_title": "[FLINK-15274][docs]Added separate plugin page.", "pr_createdAt": "2020-01-24T16:20:48Z", "pr_url": "https://github.com/apache/flink/pull/10945", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgwNTc3OQ==", "url": "https://github.com/apache/flink/pull/10945#discussion_r370805779", "bodyText": "The documentation is versioned so the reader can assume what they are looking at is relevant to that version. For that reason we generally avoid listing Flink versions and reserve those comments for the release notes.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Plugins have been introduced in Flink 1.9 and facilitate a strict separation of code through restricted classloaders. Plugins cannot access classes from other plugins or from Flink that have not been specifically whitelisted. This strict isolation allows plugins to contain conflicting versions of the same library without the need to relocate classes or to converge to common versions.\n          \n          \n            \n            Plugins facilitate a strict separation of code through restricted classloaders. Plugins cannot access classes from other plugins or from Flink that have not been specifically whitelisted. This strict isolation allows plugins to contain conflicting versions of the same library without the need to relocate classes or to converge to common versions.", "author": "sjwiesman", "createdAt": "2020-01-24T19:32:16Z", "path": "docs/ops/plugins.md", "diffHunk": "@@ -0,0 +1,91 @@\n+---\n+title: \"Plugins\"\n+nav-id: plugins\n+nav-parent_id: ops\n+nav-pos: 16\n+---\n+<!--\n+Licensed to the Apache Software Foundation (ASF) under one\n+or more contributor license agreements.  See the NOTICE file\n+distributed with this work for additional information\n+regarding copyright ownership.  The ASF licenses this file\n+to you under the Apache License, Version 2.0 (the\n+\"License\"); you may not use this file except in compliance\n+with the License.  You may obtain a copy of the License at\n+\n+  http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing,\n+software distributed under the License is distributed on an\n+\"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+KIND, either express or implied.  See the License for the\n+specific language governing permissions and limitations\n+under the License.\n+-->\n+\n+Plugins have been introduced in Flink 1.9 and facilitate a strict separation of code through restricted classloaders. Plugins cannot access classes from other plugins or from Flink that have not been specifically whitelisted. This strict isolation allows plugins to contain conflicting versions of the same library without the need to relocate classes or to converge to common versions.", "originalCommit": "3f006c04d4c5e5237057a662096dd20742c026ec", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgwNjA3Mw==", "url": "https://github.com/apache/flink/pull/10945#discussion_r370806073", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Each plugin is loaded through it's own classloader and completely isolated from any other plugin. Hence, the `flink-s3-fs-hadoop` and `flink-azure-fs-hadoop` can depend on different conflicting library versions. There is no need to relocate any class during the creation of fat jars (shading).\n          \n          \n            \n            Each plugin is loaded through its own classloader and completely isolated from any other plugin. Hence, the `flink-s3-fs-hadoop` and `flink-azure-fs-hadoop` can depend on different conflicting library versions. There is no need to relocate any class during the creation of fat jars (shading).", "author": "sjwiesman", "createdAt": "2020-01-24T19:32:52Z", "path": "docs/ops/plugins.md", "diffHunk": "@@ -0,0 +1,91 @@\n+---\n+title: \"Plugins\"\n+nav-id: plugins\n+nav-parent_id: ops\n+nav-pos: 16\n+---\n+<!--\n+Licensed to the Apache Software Foundation (ASF) under one\n+or more contributor license agreements.  See the NOTICE file\n+distributed with this work for additional information\n+regarding copyright ownership.  The ASF licenses this file\n+to you under the Apache License, Version 2.0 (the\n+\"License\"); you may not use this file except in compliance\n+with the License.  You may obtain a copy of the License at\n+\n+  http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing,\n+software distributed under the License is distributed on an\n+\"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+KIND, either express or implied.  See the License for the\n+specific language governing permissions and limitations\n+under the License.\n+-->\n+\n+Plugins have been introduced in Flink 1.9 and facilitate a strict separation of code through restricted classloaders. Plugins cannot access classes from other plugins or from Flink that have not been specifically whitelisted. This strict isolation allows plugins to contain conflicting versions of the same library without the need to relocate classes or to converge to common versions.\n+\n+Currently, only file systems are pluggable but in the future, connectors, formats, and even user code should also be pluggable.\n+\n+* This will be replaced by the TOC\n+{:toc}\n+\n+## Isolation and plugin structure\n+\n+Plugins reside in their own folders and can consist of several jars. The names of the plugin folders are arbitrary.\n+\n+```\n+flink-dist\n++-- conf\n++-- lib\n++-- ...\n+\\-- plugins\n+    +-- s3\n+    |   +-- aws-credential-provider.jar\n+    |   \\-- flink-s3-fs-hadoop.jar\n+    \\-- azure\n+        \\-- flink-azure-fs-hadoop.jar\n+``` \n+\n+Each plugin is loaded through it's own classloader and completely isolated from any other plugin. Hence, the `flink-s3-fs-hadoop` and `flink-azure-fs-hadoop` can depend on different conflicting library versions. There is no need to relocate any class during the creation of fat jars (shading).", "originalCommit": "3f006c04d4c5e5237057a662096dd20742c026ec", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgwNjg2Ng==", "url": "https://github.com/apache/flink/pull/10945#discussion_r370806866", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Plugins may access certain whitelisted packages from lib/. Most importantly, all needed service provider interfaces (SPI) are loaded through the system classloader, so that no two versions of `org.apache.flink.core.fs.FileSystem` exist at any given time, even if users accidentally bundle it in their fat jar. This singleton class requirement is strictly necessary, so that core Flink has an entry point into the plugin. Service classes are discovered through the `java.util.ServiceLoader`, so make sure to retain the service definitions in `META-INF/services` during shading.\n          \n          \n            \n            Plugins may access certain whitelisted packages from Flink's `lib/` folder. In particular, all necessary service provider interfaces (SPI) are loaded through the system classloader, so that no two versions of `org.apache.flink.core.fs.FileSystem` exist at any given time, even if users accidentally bundle it in their fat jar. This singleton class requirement is strictly necessary so that the Flink runtime has an entry point into the plugin. Service classes are discovered through the `java.util.ServiceLoader`, so make sure to retain the service definitions in `META-INF/services` during shading.", "author": "sjwiesman", "createdAt": "2020-01-24T19:34:39Z", "path": "docs/ops/plugins.md", "diffHunk": "@@ -0,0 +1,91 @@\n+---\n+title: \"Plugins\"\n+nav-id: plugins\n+nav-parent_id: ops\n+nav-pos: 16\n+---\n+<!--\n+Licensed to the Apache Software Foundation (ASF) under one\n+or more contributor license agreements.  See the NOTICE file\n+distributed with this work for additional information\n+regarding copyright ownership.  The ASF licenses this file\n+to you under the Apache License, Version 2.0 (the\n+\"License\"); you may not use this file except in compliance\n+with the License.  You may obtain a copy of the License at\n+\n+  http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing,\n+software distributed under the License is distributed on an\n+\"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+KIND, either express or implied.  See the License for the\n+specific language governing permissions and limitations\n+under the License.\n+-->\n+\n+Plugins have been introduced in Flink 1.9 and facilitate a strict separation of code through restricted classloaders. Plugins cannot access classes from other plugins or from Flink that have not been specifically whitelisted. This strict isolation allows plugins to contain conflicting versions of the same library without the need to relocate classes or to converge to common versions.\n+\n+Currently, only file systems are pluggable but in the future, connectors, formats, and even user code should also be pluggable.\n+\n+* This will be replaced by the TOC\n+{:toc}\n+\n+## Isolation and plugin structure\n+\n+Plugins reside in their own folders and can consist of several jars. The names of the plugin folders are arbitrary.\n+\n+```\n+flink-dist\n++-- conf\n++-- lib\n++-- ...\n+\\-- plugins\n+    +-- s3\n+    |   +-- aws-credential-provider.jar\n+    |   \\-- flink-s3-fs-hadoop.jar\n+    \\-- azure\n+        \\-- flink-azure-fs-hadoop.jar\n+``` \n+\n+Each plugin is loaded through it's own classloader and completely isolated from any other plugin. Hence, the `flink-s3-fs-hadoop` and `flink-azure-fs-hadoop` can depend on different conflicting library versions. There is no need to relocate any class during the creation of fat jars (shading).\n+\n+Plugins may access certain whitelisted packages from lib/. Most importantly, all needed service provider interfaces (SPI) are loaded through the system classloader, so that no two versions of `org.apache.flink.core.fs.FileSystem` exist at any given time, even if users accidentally bundle it in their fat jar. This singleton class requirement is strictly necessary, so that core Flink has an entry point into the plugin. Service classes are discovered through the `java.util.ServiceLoader`, so make sure to retain the service definitions in `META-INF/services` during shading.", "originalCommit": "3f006c04d4c5e5237057a662096dd20742c026ec", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgwNzE4MA==", "url": "https://github.com/apache/flink/pull/10945#discussion_r370807180", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            All [file systems](filesystems/index) **except MapR** are pluggable. That means they can and should be used as plugins. To use a pluggable file systems, copy the corresponding JAR file from the `opt` directory to a directory under `plugins` directory\n          \n          \n            \n            All [file systems](filesystems/index) **except MapR** are pluggable. That means they can and should be used as plugins. To use a pluggable file system, copy the corresponding JAR file from the `opt` directory to a directory under `plugins` directory", "author": "sjwiesman", "createdAt": "2020-01-24T19:35:20Z", "path": "docs/ops/plugins.md", "diffHunk": "@@ -0,0 +1,91 @@\n+---\n+title: \"Plugins\"\n+nav-id: plugins\n+nav-parent_id: ops\n+nav-pos: 16\n+---\n+<!--\n+Licensed to the Apache Software Foundation (ASF) under one\n+or more contributor license agreements.  See the NOTICE file\n+distributed with this work for additional information\n+regarding copyright ownership.  The ASF licenses this file\n+to you under the Apache License, Version 2.0 (the\n+\"License\"); you may not use this file except in compliance\n+with the License.  You may obtain a copy of the License at\n+\n+  http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing,\n+software distributed under the License is distributed on an\n+\"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+KIND, either express or implied.  See the License for the\n+specific language governing permissions and limitations\n+under the License.\n+-->\n+\n+Plugins have been introduced in Flink 1.9 and facilitate a strict separation of code through restricted classloaders. Plugins cannot access classes from other plugins or from Flink that have not been specifically whitelisted. This strict isolation allows plugins to contain conflicting versions of the same library without the need to relocate classes or to converge to common versions.\n+\n+Currently, only file systems are pluggable but in the future, connectors, formats, and even user code should also be pluggable.\n+\n+* This will be replaced by the TOC\n+{:toc}\n+\n+## Isolation and plugin structure\n+\n+Plugins reside in their own folders and can consist of several jars. The names of the plugin folders are arbitrary.\n+\n+```\n+flink-dist\n++-- conf\n++-- lib\n++-- ...\n+\\-- plugins\n+    +-- s3\n+    |   +-- aws-credential-provider.jar\n+    |   \\-- flink-s3-fs-hadoop.jar\n+    \\-- azure\n+        \\-- flink-azure-fs-hadoop.jar\n+``` \n+\n+Each plugin is loaded through it's own classloader and completely isolated from any other plugin. Hence, the `flink-s3-fs-hadoop` and `flink-azure-fs-hadoop` can depend on different conflicting library versions. There is no need to relocate any class during the creation of fat jars (shading).\n+\n+Plugins may access certain whitelisted packages from lib/. Most importantly, all needed service provider interfaces (SPI) are loaded through the system classloader, so that no two versions of `org.apache.flink.core.fs.FileSystem` exist at any given time, even if users accidentally bundle it in their fat jar. This singleton class requirement is strictly necessary, so that core Flink has an entry point into the plugin. Service classes are discovered through the `java.util.ServiceLoader`, so make sure to retain the service definitions in `META-INF/services` during shading.\n+\n+<span class=\"label label-warning\">Note</span> *Currently, more Flink core classes are still accessible from plugins as we flesh out the SPI system.*\n+\n+Furthermore, the most common logger frameworks are whitelisted, such that logging is uniformly possible across Flink core, plugins, and user code.\n+\n+## File Systems\n+\n+All [file systems](filesystems/index) **except MapR** are pluggable. That means they can and should be used as plugins. To use a pluggable file systems, copy the corresponding JAR file from the `opt` directory to a directory under `plugins` directory", "originalCommit": "3f006c04d4c5e5237057a662096dd20742c026ec", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "c4c0572dd96d5ca2ff3a484e56adc569e03783da", "url": "https://github.com/apache/flink/commit/c4c0572dd96d5ca2ff3a484e56adc569e03783da", "message": "[FLINK-15274][docs]Added separate plugin page.\n\nPlugin page will be expanded in the future for connectors and other types.\nCentral page to point someone who asks: what are plugins?", "committedDate": "2020-01-24T21:43:14Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTEzMTMwNQ==", "url": "https://github.com/apache/flink/pull/10945#discussion_r371131305", "bodyText": "I would split longer lines (like this) into multiple lines. Makes reading diffs, reviewing and resolving conflicts significantly easier.", "author": "pnowojski", "createdAt": "2020-01-27T09:23:28Z", "path": "docs/ops/plugins.md", "diffHunk": "@@ -0,0 +1,91 @@\n+---\n+title: \"Plugins\"\n+nav-id: plugins\n+nav-parent_id: ops\n+nav-pos: 16\n+---\n+<!--\n+Licensed to the Apache Software Foundation (ASF) under one\n+or more contributor license agreements.  See the NOTICE file\n+distributed with this work for additional information\n+regarding copyright ownership.  The ASF licenses this file\n+to you under the Apache License, Version 2.0 (the\n+\"License\"); you may not use this file except in compliance\n+with the License.  You may obtain a copy of the License at\n+\n+  http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing,\n+software distributed under the License is distributed on an\n+\"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+KIND, either express or implied.  See the License for the\n+specific language governing permissions and limitations\n+under the License.\n+-->\n+\n+Plugins facilitate a strict separation of code through restricted classloaders. Plugins cannot access classes from other plugins or from Flink that have not been specifically whitelisted. This strict isolation allows plugins to contain conflicting versions of the same library without the need to relocate classes or to converge to common versions.", "originalCommit": "e1f1cfbd069850680d5fb3e0e9300794af30987d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTEzMjUyMg==", "url": "https://github.com/apache/flink/pull/10945#discussion_r371132522", "bodyText": "Could we document what's the problem with MapR? (I have already forgotten)", "author": "pnowojski", "createdAt": "2020-01-27T09:26:08Z", "path": "docs/ops/plugins.md", "diffHunk": "@@ -0,0 +1,91 @@\n+---\n+title: \"Plugins\"\n+nav-id: plugins\n+nav-parent_id: ops\n+nav-pos: 16\n+---\n+<!--\n+Licensed to the Apache Software Foundation (ASF) under one\n+or more contributor license agreements.  See the NOTICE file\n+distributed with this work for additional information\n+regarding copyright ownership.  The ASF licenses this file\n+to you under the Apache License, Version 2.0 (the\n+\"License\"); you may not use this file except in compliance\n+with the License.  You may obtain a copy of the License at\n+\n+  http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing,\n+software distributed under the License is distributed on an\n+\"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+KIND, either express or implied.  See the License for the\n+specific language governing permissions and limitations\n+under the License.\n+-->\n+\n+Plugins facilitate a strict separation of code through restricted classloaders. Plugins cannot access classes from other plugins or from Flink that have not been specifically whitelisted. This strict isolation allows plugins to contain conflicting versions of the same library without the need to relocate classes or to converge to common versions.\n+\n+Currently, only file systems are pluggable but in the future, connectors, formats, and even user code should also be pluggable.\n+\n+* This will be replaced by the TOC\n+{:toc}\n+\n+## Isolation and plugin structure\n+\n+Plugins reside in their own folders and can consist of several jars. The names of the plugin folders are arbitrary.\n+\n+```\n+flink-dist\n+\u251c\u2500\u2500 conf\n+\u251c\u2500\u2500 lib\n+...\n+\u2514\u2500\u2500 plugins\n+    \u251c\u2500\u2500 s3\n+    \u2502   \u251c\u2500\u2500 aws-credential-provider.jar\n+    \u2502   \u2514\u2500\u2500 flink-s3-fs-hadoop.jar\n+    \u2514\u2500\u2500 azure\n+        \u2514\u2500\u2500 flink-azure-fs-hadoop.jar\n+``` \n+\n+Each plugin is loaded through its own classloader and completely isolated from any other plugin. Hence, the `flink-s3-fs-hadoop` and `flink-azure-fs-hadoop` can depend on different conflicting library versions. There is no need to relocate any class during the creation of fat jars (shading).\n+\n+Plugins may access certain whitelisted packages from Flink's `lib/` folder. In particular, all necessary service provider interfaces (SPI) are loaded through the system classloader, so that no two versions of `org.apache.flink.core.fs.FileSystem` exist at any given time, even if users accidentally bundle it in their fat jar. This singleton class requirement is strictly necessary so that the Flink runtime has an entry point into the plugin. Service classes are discovered through the `java.util.ServiceLoader`, so make sure to retain the service definitions in `META-INF/services` during shading.\n+\n+<span class=\"label label-warning\">Note</span> *Currently, more Flink core classes are still accessible from plugins as we flesh out the SPI system.*\n+\n+Furthermore, the most common logger frameworks are whitelisted, such that logging is uniformly possible across Flink core, plugins, and user code.\n+\n+## File Systems\n+\n+All [file systems](filesystems/index) **except MapR** are pluggable. That means they can and should be used as plugins. To use a pluggable file system, copy the corresponding JAR file from the `opt` directory to a directory under `plugins` directory", "originalCommit": "e1f1cfbd069850680d5fb3e0e9300794af30987d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTI0MTE4MQ==", "url": "https://github.com/apache/flink/pull/10945#discussion_r371241181", "bodyText": "Didn\u2019t we drop MapR?", "author": "sjwiesman", "createdAt": "2020-01-27T13:33:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTEzMjUyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTI4OTY4Mw==", "url": "https://github.com/apache/flink/pull/10945#discussion_r371289683", "bodyText": "I think we just dropped MapR repositories but not the connector support itself. At least it's still on master https://github.com/apache/flink/blob/master/flink-filesystems/flink-mapr-fs/src/main/java/org/apache/flink/runtime/fs/maprfs/MapRFsFactory.java .", "author": "AHeise", "createdAt": "2020-01-27T15:00:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTEzMjUyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTI5MDE2MA==", "url": "https://github.com/apache/flink/pull/10945#discussion_r371290160", "bodyText": "@pnowojski there is no jar. it's bundled in flink-dist for some reason.", "author": "AHeise", "createdAt": "2020-01-27T15:01:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTEzMjUyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTMyNDk2NQ==", "url": "https://github.com/apache/flink/pull/10945#discussion_r371324965", "bodyText": "If we do not support it, we should drop the mentions from the docs. If we are still supporting it, it would be nice to figure out yet one more time WHY we don't support it via plugins, and write it down. I swear this is the 3rd or 4th time already that I'm wondering why is it like that.", "author": "pnowojski", "createdAt": "2020-01-27T15:57:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTEzMjUyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTcwMjYxNQ==", "url": "https://github.com/apache/flink/pull/10945#discussion_r371702615", "bodyText": "I just wrote the reason before; we support MapR but it's already in flink-dist.jar, so you cannot use it in plugins.", "author": "AHeise", "createdAt": "2020-01-28T09:55:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTEzMjUyMg=="}], "type": "inlineReview"}, {"oid": "9aaf22fc596b0c54c6aef28a6c1216a1e5474976", "url": "https://github.com/apache/flink/commit/9aaf22fc596b0c54c6aef28a6c1216a1e5474976", "message": "[FLINK-15274][docs]Added separate plugin page.\n\nPlugin page will be expanded in the future for connectors and other types.\nCentral page to point someone who asks: what are plugins?", "committedDate": "2020-01-27T15:14:25Z", "type": "commit"}, {"oid": "9aaf22fc596b0c54c6aef28a6c1216a1e5474976", "url": "https://github.com/apache/flink/commit/9aaf22fc596b0c54c6aef28a6c1216a1e5474976", "message": "[FLINK-15274][docs]Added separate plugin page.\n\nPlugin page will be expanded in the future for connectors and other types.\nCentral page to point someone who asks: what are plugins?", "committedDate": "2020-01-27T15:14:25Z", "type": "forcePushed"}]}