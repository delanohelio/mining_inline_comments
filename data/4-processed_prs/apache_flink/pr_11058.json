{"pr_number": 11058, "pr_title": "[FLINK-15995][Table-planner-blink] Change TO_BASE64 sql operator defination", "pr_createdAt": "2020-02-11T11:53:32Z", "pr_url": "https://github.com/apache/flink/pull/11058", "timeline": [{"oid": "66514df47c1dcf00cb12be4f26a7ed26ee97da1f", "url": "https://github.com/apache/flink/commit/66514df47c1dcf00cb12be4f26a7ed26ee97da1f", "message": "[FLINK-15995][Table-planner-blink] Change TO_BASE64 sql operator defination", "committedDate": "2020-02-11T11:42:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzU5MjkwNw==", "url": "https://github.com/apache/flink/pull/11058#discussion_r377592907", "bodyText": "Thanks for your contribution~\nCould you add a test for this, like the one you described in jira?", "author": "libenchao", "createdAt": "2020-02-11T12:02:10Z", "path": "flink-table/flink-table-planner-blink/src/main/java/org/apache/flink/table/planner/functions/sql/FlinkSqlOperatorTable.java", "diffHunk": "@@ -574,9 +574,9 @@ public SqlMonotonicity getMonotonicity(SqlOperatorBinding call) {\n \tpublic static final SqlFunction TO_BASE64 = new SqlFunction(\n \t\t\"TO_BASE64\",\n \t\tSqlKind.OTHER_FUNCTION,\n-\t\tVARCHAR_2000_NULLABLE,\n+\t\tReturnTypes.cascade(ReturnTypes.explicit(SqlTypeName.VARCHAR), SqlTypeTransforms.TO_NULLABLE),\n \t\tnull,\n-\t\tOperandTypes.ANY,\n+\t\tOperandTypes.family(SqlTypeFamily.STRING),", "originalCommit": "66514df47c1dcf00cb12be4f26a7ed26ee97da1f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzU5NTIzOQ==", "url": "https://github.com/apache/flink/pull/11058#discussion_r377595239", "bodyText": "You can add tests to org.apache.flink.table.expressions.ScalarFunctionsTest#testToBase64\u3002", "author": "wuchong", "createdAt": "2020-02-11T12:08:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzU5MjkwNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzYxMDA0Ng==", "url": "https://github.com/apache/flink/pull/11058#discussion_r377610046", "bodyText": "Thank you @wuchong @libenchao.  We change  from OperandTypes.ANY to OperandTypes.family(SqlTypeFamily.STRING). If user apply int type to to_base function. For the before, it will throw runtimeException. And for now, it will fail in validation.\nSo, if we should add a test, I think we can add it to org.apache.flink.table.planner.expressions.validation.ScalarFunctionsValidationTest to verify fail in validation stage. For the  org.apache.flink.table.expressions#testToBase64, it already has test to verify the correct arguments.\nis It right?", "author": "wangxlong", "createdAt": "2020-02-11T12:42:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzU5MjkwNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzYxODIyNQ==", "url": "https://github.com/apache/flink/pull/11058#discussion_r377618225", "bodyText": "You are right. I messed it with another fromBase64 PR.", "author": "wuchong", "createdAt": "2020-02-11T12:59:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzU5MjkwNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzYzNDY1Nw==", "url": "https://github.com/apache/flink/pull/11058#discussion_r377634657", "bodyText": "\ud83d\udc4c, Updated.", "author": "wangxlong", "createdAt": "2020-02-11T13:31:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzU5MjkwNw=="}], "type": "inlineReview"}, {"oid": "615c6ca6c5212d8638734e6f7fffb6f22bed9602", "url": "https://github.com/apache/flink/commit/615c6ca6c5212d8638734e6f7fffb6f22bed9602", "message": "[FLINK-15995][Table-planner-blink] Add test to verify changes", "committedDate": "2020-02-11T13:22:09Z", "type": "commit"}]}