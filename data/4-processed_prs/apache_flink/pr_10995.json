{"pr_number": 10995, "pr_title": "[FLINK-15847][ml] Include flink-ml-api and flink-ml-lib in opt", "pr_createdAt": "2020-02-03T07:55:08Z", "pr_url": "https://github.com/apache/flink/pull/10995", "timeline": [{"oid": "1385f42a76ba0060d37022873064e736d52ea0af", "url": "https://github.com/apache/flink/commit/1385f42a76ba0060d37022873064e736d52ea0af", "message": "[FLINK-15847][ml] Include flink-ml-api and flink-ml-lib in opt", "committedDate": "2020-02-03T08:53:39Z", "type": "commit"}, {"oid": "1385f42a76ba0060d37022873064e736d52ea0af", "url": "https://github.com/apache/flink/commit/1385f42a76ba0060d37022873064e736d52ea0af", "message": "[FLINK-15847][ml] Include flink-ml-api and flink-ml-lib in opt", "committedDate": "2020-02-03T08:53:39Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDAxNjY3OA==", "url": "https://github.com/apache/flink/pull/10995#discussion_r374016678", "bodyText": "licensing needs to be updated", "author": "zentol", "createdAt": "2020-02-03T10:10:03Z", "path": "flink-ml-parent/flink-ml-lib/pom.xml", "diffHunk": "@@ -57,4 +57,30 @@ under the License.\n \t\t\t<version>1.1.2</version>\n \t\t</dependency>\n \t</dependencies>\n+\n+\t<build>\n+\t\t<plugins>\n+\t\t\t<!-- Build flink-ml-lib jar -->\n+\t\t\t<plugin>\n+\t\t\t\t<groupId>org.apache.maven.plugins</groupId>\n+\t\t\t\t<artifactId>maven-shade-plugin</artifactId>\n+\t\t\t\t<executions>\n+\t\t\t\t\t<execution>\n+\t\t\t\t\t\t<id>shade-flink</id>\n+\t\t\t\t\t\t<phase>package</phase>\n+\t\t\t\t\t\t<goals>\n+\t\t\t\t\t\t\t<goal>shade</goal>\n+\t\t\t\t\t\t</goals>\n+\t\t\t\t\t\t<configuration>\n+\t\t\t\t\t\t\t<artifactSet>\n+\t\t\t\t\t\t\t\t<includes combine.children=\"append\">\n+\t\t\t\t\t\t\t\t\t<include>com.github.fommil.netlib:core</include>", "originalCommit": "1385f42a76ba0060d37022873064e736d52ea0af", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDUyMTI2NQ==", "url": "https://github.com/apache/flink/pull/10995#discussion_r374521265", "bodyText": "Hi, I'm not sure if I get your point. The license of com.github.fommil.netlib:core has already been included?", "author": "hequn8128", "createdAt": "2020-02-04T08:03:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDAxNjY3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTI3ODk3MQ==", "url": "https://github.com/apache/flink/pull/10995#discussion_r379278971", "bodyText": "@zentol cc", "author": "hequn8128", "createdAt": "2020-02-14T07:12:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDAxNjY3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTQ0MzQyOQ==", "url": "https://github.com/apache/flink/pull/10995#discussion_r379443429", "bodyText": "Why was the license already included if the dependency wasn't bundled so far?", "author": "zentol", "createdAt": "2020-02-14T13:59:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDAxNjY3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTcxMzg3OA==", "url": "https://github.com/apache/flink/pull/10995#discussion_r379713878", "bodyText": "@zentol The license has already been added by this commit https://github.com/apache/flink/pull/8631/files\nOr do you mean we should remove the licensing for release-1.10? I think we can create a fix in another PR.", "author": "hequn8128", "createdAt": "2020-02-15T03:19:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDAxNjY3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTkzMzUwMg==", "url": "https://github.com/apache/flink/pull/10995#discussion_r379933502", "bodyText": "If the dependency is not bundled in 1.10 then yes, the licensing part of the commit should be reverted.", "author": "zentol", "createdAt": "2020-02-16T21:08:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDAxNjY3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjc0ODA4NA==", "url": "https://github.com/apache/flink/pull/10995#discussion_r382748084", "bodyText": "hmm. in fact the flink-ml-* packages are never release/bundled anyway. we should revert the LICENSE notice (in fact it shouldn't contain any LICENSE since only source codes were released: https://repo1.maven.org/maven2/org/apache/flink/flink-ml-lib_2.12/1.10.0/.\nHow should we proceed? should we have a revert in release-1.10 branch only and keep this PR intact?", "author": "walterddr", "createdAt": "2020-02-21T18:52:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDAxNjY3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjk2MTUxNA==", "url": "https://github.com/apache/flink/pull/10995#discussion_r382961514", "bodyText": "@walterddr Hi, flink-ml-* are released by jar artifacts and the flink-ml-lib jar should not contain the license and notice file as it actually does not bundle the related dependencies. I have fired another issue(FLINK-16241) and will open a corresponding PR to address the problem on release-1.10. :-)", "author": "hequn8128", "createdAt": "2020-02-23T03:53:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDAxNjY3OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTI5NDE3NQ==", "url": "https://github.com/apache/flink/pull/10995#discussion_r379294175", "bodyText": "Should we add a module \"flink-ml-uber\" just like \"flink-table-uber\" to create a fat job for flink ml module? Currently it assumes that the flink-ml-api is packaged in the fat jar of flink-ml-lib. This seems a little wired for me. It would be great if more people could share the thoughts on this?", "author": "dianfu", "createdAt": "2020-02-14T08:05:03Z", "path": "flink-dist/src/main/assemblies/opt.xml", "diffHunk": "@@ -168,6 +168,14 @@\n \t\t\t<destName>flink-python_${scala.binary.version}-${project.version}.jar</destName>\n \t\t\t<fileMode>0644</fileMode>\n \t\t</file>\n+\n+\t\t<!-- ML (API & LIB)  -->\n+\t\t<file>", "originalCommit": "1385f42a76ba0060d37022873064e736d52ea0af", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTQ0NDE0MQ==", "url": "https://github.com/apache/flink/pull/10995#discussion_r379444141", "bodyText": "I agree that there should be an uber module. The current packaging also appears to be incorrect since flink-ml-api is not bundled in flink-ml-lib anyway.", "author": "zentol", "createdAt": "2020-02-14T14:00:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTI5NDE3NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTcxMzMwNA==", "url": "https://github.com/apache/flink/pull/10995#discussion_r379713304", "bodyText": "Hi @dianfu @zentol Thanks for your advice.\nI would fine with adding an uber module. But I think there are some differences between the table module and the ml module. For table module, it needs a uber module to packages all table sub-modules plus other modules, e.g., cep. While for ml, there are no such requirements.", "author": "hequn8128", "createdAt": "2020-02-15T03:06:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTI5NDE3NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTkzMzQyMA==", "url": "https://github.com/apache/flink/pull/10995#discussion_r379933420", "bodyText": "Where exactly do they differ? They both have multiple sub-modules that you want to ship as a single jar.", "author": "zentol", "createdAt": "2020-02-16T21:07:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTI5NDE3NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTk1MTU5Mw==", "url": "https://github.com/apache/flink/pull/10995#discussion_r379951593", "bodyText": "For the table module, it makes no sense to let any sub-modules to bundle cep, so a uber module is used to create the bundled jar. but for ml module, it makes sense to let flink-ml-lib to bundle the flink-ml-api module, so that we can simply put the flink-ml-lib jar into the opt.", "author": "hequn8128", "createdAt": "2020-02-17T01:03:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTI5NDE3NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDAzNjE2Nw==", "url": "https://github.com/apache/flink/pull/10995#discussion_r380036167", "bodyText": "the table-uber module existed before it bundled cep though.", "author": "zentol", "createdAt": "2020-02-17T08:21:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTI5NDE3NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDE5NDEyOQ==", "url": "https://github.com/apache/flink/pull/10995#discussion_r380194129", "bodyText": "ok, let's add the uber module.", "author": "hequn8128", "createdAt": "2020-02-17T13:53:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTI5NDE3NQ=="}], "type": "inlineReview"}, {"oid": "9c1edd078c466ee56f2aed16ce9098e35bfae69e", "url": "https://github.com/apache/flink/commit/9c1edd078c466ee56f2aed16ce9098e35bfae69e", "message": "address comments", "committedDate": "2020-02-15T04:53:05Z", "type": "commit"}, {"oid": "9c1edd078c466ee56f2aed16ce9098e35bfae69e", "url": "https://github.com/apache/flink/commit/9c1edd078c466ee56f2aed16ce9098e35bfae69e", "message": "address comments", "committedDate": "2020-02-15T04:53:05Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDQ4NDU1Ng==", "url": "https://github.com/apache/flink/pull/10995#discussion_r384484556", "bodyText": "I would move this (and the corresponding NOTICE) into the uber module.\nThe basic idea is that the uber module is responsible for all things related to the distribution. The individual modules usually shouldn't have to shade dependencies; users should set flink-ml dependencies to provided anyways so we don't have to concerned about them accidently bundling this dependency.", "author": "zentol", "createdAt": "2020-02-26T13:16:52Z", "path": "flink-ml-parent/flink-ml-lib/pom.xml", "diffHunk": "@@ -57,4 +60,30 @@ under the License.\n \t\t\t<version>1.1.2</version>\n \t\t</dependency>\n \t</dependencies>\n+\n+\t<build>\n+\t\t<plugins>\n+\t\t\t<!-- Build flink-ml-lib jar -->\n+\t\t\t<plugin>\n+\t\t\t\t<groupId>org.apache.maven.plugins</groupId>\n+\t\t\t\t<artifactId>maven-shade-plugin</artifactId>", "originalCommit": "9c1edd078c466ee56f2aed16ce9098e35bfae69e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "478491bde663e58f1e84753bf6fac3a7367ef195", "url": "https://github.com/apache/flink/commit/478491bde663e58f1e84753bf6fac3a7367ef195", "message": "move NOTICE into the uber module", "committedDate": "2020-02-27T03:12:33Z", "type": "commit"}]}