{"pr_number": 10889, "pr_title": "[Flink-15355][plugins]Enable s3 plugins under Java 11.", "pr_createdAt": "2020-01-17T16:12:17Z", "pr_url": "https://github.com/apache/flink/pull/10889", "timeline": [{"oid": "966745cdadf667b21fe7e33af854f7261eb94b50", "url": "https://github.com/apache/flink/commit/966745cdadf667b21fe7e33af854f7261eb94b50", "message": "[temp]Enable misc e2e tests", "committedDate": "2020-01-20T14:28:58Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODU3NjI1Ng==", "url": "https://github.com/apache/flink/pull/10889#discussion_r368576256", "bodyText": "I guess this is not the same as \"Creative Commons CC0 1.0 Universal Public Domain Dedication License\" and cannot be bundled?", "author": "AHeise", "createdAt": "2020-01-20T14:30:17Z", "path": "flink-filesystems/flink-s3-fs-presto/src/main/resources/META-INF/NOTICE", "diffHunk": "@@ -57,3 +57,8 @@ This project bundles the following dependencies under BSD License (https://opens\n See bundled license files for details.\n \n - org.codehaus.woodstox:stax2-api:3.1.4 (https://github.com/FasterXML/stax2-api/tree/stax2-api-3.1.4)\n+\n+This project bundles the following dependencies under the CDDL 1.1 license.", "originalCommit": "966745cdadf667b21fe7e33af854f7261eb94b50", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODU4MjE4Mg==", "url": "https://github.com/apache/flink/pull/10889#discussion_r368582182", "bodyText": "It is the Common Development and Distribution License and can be bundled.", "author": "zentol", "createdAt": "2020-01-20T14:41:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODU3NjI1Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODYzMTg0Ng==", "url": "https://github.com/apache/flink/pull/10889#discussion_r368631846", "bodyText": "Is it okay to bundle two different versions of the same license? (1.0 and 1.1)", "author": "AHeise", "createdAt": "2020-01-20T16:20:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODU3NjI1Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODcyMjk4NQ==", "url": "https://github.com/apache/flink/pull/10889#discussion_r368722985", "bodyText": "yes", "author": "zentol", "createdAt": "2020-01-20T20:56:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODU3NjI1Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODg2MTA4Nw==", "url": "https://github.com/apache/flink/pull/10889#discussion_r368861087", "bodyText": "Sorry to reiterate about that again but it feels as if the two are different.\nCreative Commons CC0 1.0 Universal Public Domain Dedication License is abbreviated CC0 and I haven't found a 1.1 version.\nCommon Development and Distribution License seems to be Oracle-specific.\nI'd keep them separate for now and we can revise later.", "author": "AHeise", "createdAt": "2020-01-21T08:21:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODU3NjI1Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODg2NDEzOQ==", "url": "https://github.com/apache/flink/pull/10889#discussion_r368864139", "bodyText": "Of course the CC0 and CDDL are different licenses. They have different names. What made you think they are the same?", "author": "zentol", "createdAt": "2020-01-21T08:30:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODU3NjI1Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODU4MzY3OA==", "url": "https://github.com/apache/flink/pull/10889#discussion_r368583678", "bodyText": "given that this depends on javax.activation I would think that we need to bundle both.\nWe had an issue in the past when we only had one in yarn: https://issues.apache.org/jira/browse/FLINK-15008", "author": "zentol", "createdAt": "2020-01-20T14:44:44Z", "path": "flink-filesystems/flink-s3-fs-presto/src/main/resources/META-INF/NOTICE", "diffHunk": "@@ -57,3 +57,8 @@ This project bundles the following dependencies under BSD License (https://opens\n See bundled license files for details.\n \n - org.codehaus.woodstox:stax2-api:3.1.4 (https://github.com/FasterXML/stax2-api/tree/stax2-api-3.1.4)\n+\n+This project bundles the following dependencies under the CDDL 1.1 license.\n+See bundled license files for details.\n+\n+- javax.xml.bind:jaxb-api:2.3.1", "originalCommit": "966745cdadf667b21fe7e33af854f7261eb94b50", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODU4NDA0MA==", "url": "https://github.com/apache/flink/pull/10889#discussion_r368584040", "bodyText": "somethings missing here ;)\nyou need to include these two files under resources/META-INF/licenses.", "author": "zentol", "createdAt": "2020-01-20T14:45:30Z", "path": "flink-filesystems/flink-s3-fs-presto/src/main/resources/META-INF/NOTICE", "diffHunk": "@@ -57,3 +57,8 @@ This project bundles the following dependencies under BSD License (https://opens\n See bundled license files for details.\n \n - org.codehaus.woodstox:stax2-api:3.1.4 (https://github.com/FasterXML/stax2-api/tree/stax2-api-3.1.4)\n+\n+This project bundles the following dependencies under the CDDL 1.1 license.\n+See bundled license files for details.", "originalCommit": "966745cdadf667b21fe7e33af854f7261eb94b50", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODYzMzMzNQ==", "url": "https://github.com/apache/flink/pull/10889#discussion_r368633335", "bodyText": "I already suspected that, but was not able to find them (in plain sight...).", "author": "AHeise", "createdAt": "2020-01-20T16:23:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODU4NDA0MA=="}], "type": "inlineReview"}, {"oid": "a1af064f262c989672448ac873502eb168717685", "url": "https://github.com/apache/flink/commit/a1af064f262c989672448ac873502eb168717685", "message": "[temp]Enable misc e2e tests", "committedDate": "2020-01-20T16:25:04Z", "type": "forcePushed"}, {"oid": "383ec9ba09f65430856c64712fcbf115c81ebe05", "url": "https://github.com/apache/flink/commit/383ec9ba09f65430856c64712fcbf115c81ebe05", "message": "[FLINK-15355][s3]Plugins now use multi-release mechanism to ship jaxb for Java 9+.", "committedDate": "2020-01-20T16:25:04Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODg3MzExOQ==", "url": "https://github.com/apache/flink/pull/10889#discussion_r368873119", "bodyText": "Shouldn't we propagate/handle some errors?", "author": "pnowojski", "createdAt": "2020-01-21T08:51:42Z", "path": "flink-core/src/main/java/org/apache/flink/core/plugin/PluginLoader.java", "diffHunk": "@@ -182,5 +184,16 @@ private boolean isAllowedFlinkClass(final String name) {\n \t\tprivate boolean isAllowedFlinkResource(final String name) {\n \t\t\treturn Arrays.stream(allowedResourcePrefixes).anyMatch(name::startsWith);\n \t\t}\n+\n+\t\tstatic {\n+\t\t\tClassLoader platformLoader = null;\n+\t\t\ttry {\n+\t\t\t\tplatformLoader = (ClassLoader) ClassLoader.class\n+\t\t\t\t\t.getMethod(\"getPlatformClassLoader\")\n+\t\t\t\t\t.invoke(null);\n+\t\t\t} catch (Exception e) {\n+\t\t\t}", "originalCommit": "afa1419d99ea2bf395d623f24798b7505f0c6a45", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODg4NzA2Ng==", "url": "https://github.com/apache/flink/pull/10889#discussion_r368887066", "bodyText": "This will always fail on Java 8, so not sure what to handle here. I also looked into detecting the Java version and do only specific stuff, but everything is more fragile than just trying.", "author": "AHeise", "createdAt": "2020-01-21T09:21:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODg3MzExOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODg4NzQ3MQ==", "url": "https://github.com/apache/flink/pull/10889#discussion_r368887471", "bodyText": "We could make it more differentiated and just swallow NoSuchMethodException though.", "author": "AHeise", "createdAt": "2020-01-21T09:22:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODg3MzExOQ=="}], "type": "inlineReview"}, {"oid": "5efc5d29f49884fe98d8d7540384463fdfda58ee", "url": "https://github.com/apache/flink/commit/5efc5d29f49884fe98d8d7540384463fdfda58ee", "message": "[FLINK-15355][plugins] PluginLoader allows access to JDK9 modules.\n\nWith Java9, classes that have moved to modules are not accessible through the bootstrap classloader anymore. The platform classloader is the equivalent to the Java8 bootstrap classloader and now used for plugins.", "committedDate": "2020-01-21T09:24:18Z", "type": "commit"}, {"oid": "cfa264bfee8bba65fa3218fa64716908f7bab371", "url": "https://github.com/apache/flink/commit/cfa264bfee8bba65fa3218fa64716908f7bab371", "message": "[FLINK-15355][s3]Plugins now use multi-release mechanism to ship jaxb for Java 9+.", "committedDate": "2020-01-21T09:24:18Z", "type": "commit"}, {"oid": "cfa264bfee8bba65fa3218fa64716908f7bab371", "url": "https://github.com/apache/flink/commit/cfa264bfee8bba65fa3218fa64716908f7bab371", "message": "[FLINK-15355][s3]Plugins now use multi-release mechanism to ship jaxb for Java 9+.", "committedDate": "2020-01-21T09:24:18Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODg4ODk0MQ==", "url": "https://github.com/apache/flink/pull/10889#discussion_r368888941", "bodyText": "@pnowojski What do you think of the exception handling now? Do you have any reliable way to detect if we are on Java9+?", "author": "AHeise", "createdAt": "2020-01-21T09:25:30Z", "path": "flink-core/src/main/java/org/apache/flink/core/plugin/PluginLoader.java", "diffHunk": "@@ -182,5 +184,20 @@ private boolean isAllowedFlinkClass(final String name) {\n \t\tprivate boolean isAllowedFlinkResource(final String name) {\n \t\t\treturn Arrays.stream(allowedResourcePrefixes).anyMatch(name::startsWith);\n \t\t}\n+\n+\t\tstatic {\n+\t\t\tClassLoader platformLoader = null;\n+\t\t\ttry {\n+\t\t\t\tplatformLoader = (ClassLoader) ClassLoader.class\n+\t\t\t\t\t.getMethod(\"getPlatformClassLoader\")\n+\t\t\t\t\t.invoke(null);\n+\t\t\t} catch (NoSuchMethodException e) {", "originalCommit": "5efc5d29f49884fe98d8d7540384463fdfda58ee", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODg5NTYxMw==", "url": "https://github.com/apache/flink/pull/10889#discussion_r368895613", "bodyText": "Maybe this?\nhttps://www.journaldev.com/20930/check-java-version#can-we-check-java-version-programmatically\nbut I'm also kind of fine with as it is.", "author": "pnowojski", "createdAt": "2020-01-21T09:39:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODg4ODk0MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODk1NTM4MA==", "url": "https://github.com/apache/flink/pull/10889#discussion_r368955380", "bodyText": "There's no good way to check for java versions on Java 8; Runtime.Version was added in Java 9.", "author": "zentol", "createdAt": "2020-01-21T11:46:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODg4ODk0MQ=="}], "type": "inlineReview"}]}