{"pr_number": 13570, "pr_title": "[FLINK-19522][Table SQL / Ecosystem] Add auto-commit option for Table/SQL API", "pr_createdAt": "2020-10-09T12:53:07Z", "pr_url": "https://github.com/apache/flink/pull/13570", "timeline": [{"oid": "a55035fb0a9a2aecec9e1469f30a6f991e9e9504", "url": "https://github.com/apache/flink/commit/a55035fb0a9a2aecec9e1469f30a6f991e9e9504", "message": "[FLINK-19522][Table SQL / Ecosystem] Add auto-commit option for Table/SQL API\n\nThis commit adds an option in the SQL API to set the auto-commit flag.", "committedDate": "2020-10-09T12:47:38Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjc1NjU5MQ==", "url": "https://github.com/apache/flink/pull/13570#discussion_r502756591", "bodyText": "Maybe it would be better to have a link to explain what is the auto commit? For example: https://docs.oracle.com/javase/tutorial/jdbc/basics/transactions.html#commit_transactions?\nHowever the above link only explains the behavior for DMLs, maybe some explanation for what it is used for scan would be better.", "author": "wuchong", "createdAt": "2020-10-10T07:01:31Z", "path": "docs/dev/table/connectors/jdbc.md", "diffHunk": "@@ -183,7 +183,14 @@ Connector Options\n       <td style=\"word-wrap: break-word;\">0</td>\n       <td>Integer</td>\n       <td>The number of rows that should be fetched from the database when reading per round trip. If the value specified is zero, then the hint is ignored.</td>\n-    </tr>     \n+    </tr>\n+    <tr>\n+      <td><h5>scan.auto-commit</h5></td>\n+      <td>optional</td>\n+      <td style=\"word-wrap: break-word;\">(none)</td>\n+      <td>Boolean</td>\n+      <td>Sets the auto commit flag on the JDBC driver.</td>", "originalCommit": "a55035fb0a9a2aecec9e1469f30a6f991e9e9504", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjc5NzE3NA==", "url": "https://github.com/apache/flink/pull/13570#discussion_r502797174", "bodyText": "Good idea. I had actually at first made a comment about the postgres JDBC driver behavior with scans, since I have run across this multiple times, but had removed it since it was vendor-specific. Any thoughts about including a comment about that?", "author": "dforciea", "createdAt": "2020-10-10T14:37:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjc1NjU5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzE4MTI1OQ==", "url": "https://github.com/apache/flink/pull/13570#discussion_r503181259", "bodyText": "I think the purpose of this option is addressing some specific database requirement. So having postgres as an example is great for users to understand.", "author": "wuchong", "createdAt": "2020-10-12T09:58:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjc1NjU5MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjc1Njg1Nw==", "url": "https://github.com/apache/flink/pull/13570#discussion_r502756857", "bodyText": "I think auto commit mode is not a three-valued (true, false, null), it should be either enabled or disabled. Besides, it should be enabled by default, because this is the default behavior of JDBC.\nSo what about changing the default value to true and also update the member virables from Boolean to primitive boolean?", "author": "wuchong", "createdAt": "2020-10-10T07:04:49Z", "path": "flink-connectors/flink-connector-jdbc/src/main/java/org/apache/flink/connector/jdbc/table/JdbcDynamicTableFactory.java", "diffHunk": "@@ -109,6 +109,11 @@\n \t\t.withDescription(\"gives the reader a hint as to the number of rows that should be fetched, from\" +\n \t\t\t\" the database when reading per round trip. If the value specified is zero, then the hint is ignored. The\" +\n \t\t\t\" default value is zero.\");\n+\tprivate static final ConfigOption<Boolean> SCAN_AUTO_COMMIT = ConfigOptions\n+\t\t.key(\"scan.auto-commit\")\n+\t\t.booleanType()\n+\t\t.noDefaultValue()", "originalCommit": "a55035fb0a9a2aecec9e1469f30a6f991e9e9504", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjc5ODg1MQ==", "url": "https://github.com/apache/flink/pull/13570#discussion_r502798851", "bodyText": "I had let it be optional so that it could use the JDBC default. But, per the JDBC spec the default is true, so your suggestion makes sense. I'll make that change.\nIn the email thread, you had made a comment about setting auto commit to false by default within JdbcRowDataInputFormat.Builder in the 1.11 branch so that it would do the right thing for scans in postgres. However, that would conflict with setting the default to be true here. If someone expected that behavior in a 1.11 patch and then we add this, the behavior would revert back if they don't specify this option explicitly.\nIn general, I think that leaving auto commit enabled is the right thing to do. However, this is a config option specifically for doing scans, so I could see an argument for letting the default be false in this case. But, I can also see a good argument for making it match the JDBC driver default. I would suggest whatever is decided that it should be consistent, so if we set the default to be true here we probably shouldn't change JdbcRowDataInputFormat.Builder.\nLet me know which direction you'd like to go with this.", "author": "dforciea", "createdAt": "2020-10-10T14:55:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjc1Njg1Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzE1NTQ5Ng==", "url": "https://github.com/apache/flink/pull/13570#discussion_r503155496", "bodyText": "In the mailing list, I had made a mistake that I thought the autoCommit is false by default in JdbcRowDataInputFormat.Builder (but it is null by default), so I said it should be true by default. As for now, I think we don't need to add a patch to branch 1.11 because this is not a bug, but is a new feature.\nI think it would be more reasonable to make auto commit default true everywhere. The behavior of JDBC connector should match JDBC driver default.", "author": "wuchong", "createdAt": "2020-10-12T09:17:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjc1Njg1Nw=="}], "type": "inlineReview"}, {"oid": "38017c0f4f0ec3235e8b1db79c8efa258916287c", "url": "https://github.com/apache/flink/commit/38017c0f4f0ec3235e8b1db79c8efa258916287c", "message": "[FLINK-19522][Table SQL / Ecosystem] Add auto-commit option for Table/SQL API\n\nUpdates to make auto-commit have a default option, and clarifies\ndocumentation.", "committedDate": "2020-10-12T15:18:50Z", "type": "commit"}]}