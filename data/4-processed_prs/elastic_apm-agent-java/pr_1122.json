{"pr_number": 1122, "pr_title": "Fix flaky gRPC server instrumentation", "pr_createdAt": "2020-04-03T16:21:49Z", "pr_url": "https://github.com/elastic/apm-agent-java/pull/1122", "timeline": [{"oid": "eae7e6d089d1b2760eeef8ff145af5e721b1df46", "url": "https://github.com/elastic/apm-agent-java/commit/eae7e6d089d1b2760eeef8ff145af5e721b1df46", "message": "minor test improvements", "committedDate": "2020-04-03T15:57:42Z", "type": "commit"}, {"oid": "3beb9912fd5508cb6cb56c47a498ce286e04bf03", "url": "https://github.com/elastic/apm-agent-java/commit/3beb9912fd5508cb6cb56c47a498ce286e04bf03", "message": "disable circuit breaker for tests", "committedDate": "2020-04-03T15:57:54Z", "type": "commit"}, {"oid": "a7d1ad261ebb40129f1769b3baf8710c624a2881", "url": "https://github.com/elastic/apm-agent-java/commit/a7d1ad261ebb40129f1769b3baf8710c624a2881", "message": "grpc server without rely on same-thread", "committedDate": "2020-04-03T16:03:43Z", "type": "commit"}, {"oid": "930d072739ac7f5dc1e9cc9efd6e5a14b84f9fcb", "url": "https://github.com/elastic/apm-agent-java/commit/930d072739ac7f5dc1e9cc9efd6e5a14b84f9fcb", "message": "avoid npe when stopping tracer", "committedDate": "2020-04-03T16:14:24Z", "type": "commit"}, {"oid": "79a13499379d3d7fbea74d0a66a60e228fdd26d8", "url": "https://github.com/elastic/apm-agent-java/commit/79a13499379d3d7fbea74d0a66a60e228fdd26d8", "message": "update changelog", "committedDate": "2020-04-03T16:25:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzY1MjI4OA==", "url": "https://github.com/elastic/apm-agent-java/pull/1122#discussion_r403652288", "bodyText": "The circuit breaker is off by default (except from the servlet container integration tests). It is enabled through a mock at the beginning of each CircuitBreakerTest test (which uses an isolated tracer and config).", "author": "eyalkoren", "createdAt": "2020-04-05T05:39:02Z", "path": "apm-agent-core/src/test/resources/elasticapm.properties", "diffHunk": "@@ -5,3 +5,6 @@ disable_instrumentations=\n # in unit tests, the agent is loaded by the system class loader so we can't instrument bootstrap classes\n classes_excluded_from_instrumentation=java.*,com.sun.*,sun.*\n application_packages=co.elastic.apm\n+\n+# circuit breaker should be disabled by default, otherwise it is triggered while tests execute\n+circuit_breaker_enabled=false", "originalCommit": "79a13499379d3d7fbea74d0a66a60e228fdd26d8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDA0NDgwOA==", "url": "https://github.com/elastic/apm-agent-java/pull/1122#discussion_r404044808", "bodyText": "Good point, I've reverted this change in latest version of the PR.", "author": "SylvainJuge", "createdAt": "2020-04-06T12:16:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzY1MjI4OA=="}], "type": "inlineReview"}, {"oid": "34c9ed866e490a498780def39cebee74423c4aca", "url": "https://github.com/elastic/apm-agent-java/commit/34c9ed866e490a498780def39cebee74423c4aca", "message": "remove useless logs", "committedDate": "2020-04-06T12:06:56Z", "type": "commit"}, {"oid": "b64207e688c5c5d4aad6efdba2ca42d97165f740", "url": "https://github.com/elastic/apm-agent-java/commit/b64207e688c5c5d4aad6efdba2ca42d97165f740", "message": "circuit breaker is already disabled by default", "committedDate": "2020-04-06T12:15:10Z", "type": "commit"}]}