{"pr_number": 1541, "pr_title": "[load test] build test app with recent JDK", "pr_createdAt": "2020-11-26T14:33:35Z", "pr_url": "https://github.com/elastic/apm-agent-java/pull/1541", "timeline": [{"oid": "325929e88b12e29b2f77ec684a05a02ca62720f3", "url": "https://github.com/elastic/apm-agent-java/commit/325929e88b12e29b2f77ec684a05a02ca62720f3", "message": "build test app with recent JDK", "committedDate": "2020-11-26T14:26:46Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTExMjYyMA==", "url": "https://github.com/elastic/apm-agent-java/pull/1541#discussion_r531112620", "bodyText": "I am worried about this line because I think it has the potential to overwrite the JDK that we download here on L79.", "author": "cachedout", "createdAt": "2020-11-26T15:47:08Z", "path": ".ci/load/Jenkinsfile", "diffHunk": "@@ -75,6 +79,15 @@ pipeline {\n                                 setEnvVar('JAVA_HOME', sh(script: \".ci/load/scripts/fetch_sdk.sh ${params.jvm_version}\", returnStdout: true).trim())\n                                 setEnvVar('JAVACMD', \"${env.JAVA_HOME}/bin/java\")\n                                 setEnvVar('PATH', \"${env.JAVA_HOME}/bin:$PATH\")\n+\n+                                def jdk_major = sh(script: \".ci/load/scripts/java_major.sh ${params.jvm_version}\", returnStdout: true).trim())\n+                                def app_build_jdk = \"${env.JAVA_HOME}\"\n+                                if(jdk_major == '7'){\n+                                    // build application with a more recent JDK that don't have TLS issues\n+                                    app_build_jdk = sh(script: \".ci/load/scripts/fetch_sdk.sh zulu-8.0.272-linux\", returnStdout: true).trim()", "originalCommit": "325929e88b12e29b2f77ec684a05a02ca62720f3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjcwMTEyMw==", "url": "https://github.com/elastic/apm-agent-java/pull/1541#discussion_r532701123", "bodyText": "do you think of any better way to handle this ? We could maybe have a java7 folder alongside the java11 that is used to build the agent.", "author": "SylvainJuge", "createdAt": "2020-11-30T15:53:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTExMjYyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjc3MzEwOA==", "url": "https://github.com/elastic/apm-agent-java/pull/1541#discussion_r532773108", "bodyText": "I wonder if we could just generate have the script generate a randomly generated directory name so we can be (fairly) sure we're avoiding collisions? So, we'd modify the shell script to return java-7-mYRand0mStr? Either way, so long as it's unique, I think we'll be fine.", "author": "cachedout", "createdAt": "2020-11-30T17:31:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTExMjYyMA=="}], "type": "inlineReview"}, {"oid": "e07b58cf34c952f9c86620b8444d1a1296faaa4f", "url": "https://github.com/elastic/apm-agent-java/commit/e07b58cf34c952f9c86620b8444d1a1296faaa4f", "message": "unpack jdk to random folder + use /tmp", "committedDate": "2020-12-01T12:58:32Z", "type": "commit"}, {"oid": "782e099684801419a2bf03e000a21ed00c2922c3", "url": "https://github.com/elastic/apm-agent-java/commit/782e099684801419a2bf03e000a21ed00c2922c3", "message": "fix typo", "committedDate": "2020-12-01T15:45:19Z", "type": "commit"}, {"oid": "93b938a08dd6c179f9baa47a7b91d6e071817419", "url": "https://github.com/elastic/apm-agent-java/commit/93b938a08dd6c179f9baa47a7b91d6e071817419", "message": "more typos", "committedDate": "2020-12-01T15:48:04Z", "type": "commit"}, {"oid": "639beff7d200fcbc5bed64c95b67579e96869106", "url": "https://github.com/elastic/apm-agent-java/commit/639beff7d200fcbc5bed64c95b67579e96869106", "message": "same player plays again", "committedDate": "2020-12-01T15:53:04Z", "type": "commit"}, {"oid": "e034a62065b4f2a31d6601d37d5b6d9a41a8eead", "url": "https://github.com/elastic/apm-agent-java/commit/e034a62065b4f2a31d6601d37d5b6d9a41a8eead", "message": "I love typos", "committedDate": "2020-12-01T15:55:15Z", "type": "commit"}]}