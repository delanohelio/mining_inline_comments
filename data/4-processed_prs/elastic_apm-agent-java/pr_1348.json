{"pr_number": 1348, "pr_title": "[Docs] Enhancing SSL-related documentation", "pr_createdAt": "2020-08-19T13:48:42Z", "pr_url": "https://github.com/elastic/apm-agent-java/pull/1348", "timeline": [{"oid": "d44a566b8e6ee993df52eb0641dd64b423e4fc9b", "url": "https://github.com/elastic/apm-agent-java/commit/d44a566b8e6ee993df52eb0641dd64b423e4fc9b", "message": "[Docs] Enhancing SSL-related documentation", "committedDate": "2020-08-19T13:29:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzE5Njk3Ng==", "url": "https://github.com/elastic/apm-agent-java/pull/1348#discussion_r473196976", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            If the certificate used by the APM Server is self-signed, you would need to add the same certificate\n          \n          \n            \n            If the certificate used by the APM Server is self-signed, you need to add the same certificate", "author": "bmorelli25", "createdAt": "2020-08-19T17:16:46Z", "path": "docs/setup-ssl.asciidoc", "diffHunk": "@@ -0,0 +1,37 @@\n+[[ssl-configuration]]\n+== SSL/TLS communication with APM Server\n+\n+If {apm-server-ref-v}/secure-communication-agents.html#ssl-setup[SSL/TLS communication] is enabled on\n+the APM Server, use the `https` protocol when configuring <<config-server-urls,`server_urls`>>.\n+\n+[float]\n+[[ssl-server-authentication]]\n+=== APM Server certificate authentication\n+\n+By default, when using HTTPS to communicate with APM Server, the agents will verify the identity\n+of the APM Server by authenticating its certificate. It is not recommended to change this default,\n+however it is possible through the <<config-verify-server-cert>> configuration.\n+\n+If the certificate used by the APM Server is self-signed, you would need to add the same certificate", "originalCommit": "d44a566b8e6ee993df52eb0641dd64b423e4fc9b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzE5NzQzMw==", "url": "https://github.com/elastic/apm-agent-java/pull/1348#discussion_r473197433", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Following is an example of using `keytool` to import a certificate into the truststore:\n          \n          \n            \n            The following is an example of using `keytool` to import a certificate into the truststore:", "author": "bmorelli25", "createdAt": "2020-08-19T17:17:38Z", "path": "docs/setup-ssl.asciidoc", "diffHunk": "@@ -0,0 +1,37 @@\n+[[ssl-configuration]]\n+== SSL/TLS communication with APM Server\n+\n+If {apm-server-ref-v}/secure-communication-agents.html#ssl-setup[SSL/TLS communication] is enabled on\n+the APM Server, use the `https` protocol when configuring <<config-server-urls,`server_urls`>>.\n+\n+[float]\n+[[ssl-server-authentication]]\n+=== APM Server certificate authentication\n+\n+By default, when using HTTPS to communicate with APM Server, the agents will verify the identity\n+of the APM Server by authenticating its certificate. It is not recommended to change this default,\n+however it is possible through the <<config-verify-server-cert>> configuration.\n+\n+If the certificate used by the APM Server is self-signed, you would need to add the same certificate\n+to the JVM's truststore. You can find which truststore is used by setting `-Djavax.net.debug=all`\n+in the command line. Typically, it would be `$JAVA_HOME/jre/lib/security/cacerts`.\n+Following is an example of using `keytool` to import a certificate into the truststore:", "originalCommit": "d44a566b8e6ee993df52eb0641dd64b423e4fc9b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzE5ODk3Mg==", "url": "https://github.com/elastic/apm-agent-java/pull/1348#discussion_r473198972", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            ----\n          \n          \n            \n            [source,ini]\n          \n          \n            \n            ----", "author": "bmorelli25", "createdAt": "2020-08-19T17:19:47Z", "path": "docs/setup-ssl.asciidoc", "diffHunk": "@@ -0,0 +1,37 @@\n+[[ssl-configuration]]\n+== SSL/TLS communication with APM Server\n+\n+If {apm-server-ref-v}/secure-communication-agents.html#ssl-setup[SSL/TLS communication] is enabled on\n+the APM Server, use the `https` protocol when configuring <<config-server-urls,`server_urls`>>.\n+\n+[float]\n+[[ssl-server-authentication]]\n+=== APM Server certificate authentication\n+\n+By default, when using HTTPS to communicate with APM Server, the agents will verify the identity\n+of the APM Server by authenticating its certificate. It is not recommended to change this default,\n+however it is possible through the <<config-verify-server-cert>> configuration.\n+\n+If the certificate used by the APM Server is self-signed, you would need to add the same certificate\n+to the JVM's truststore. You can find which truststore is used by setting `-Djavax.net.debug=all`\n+in the command line. Typically, it would be `$JAVA_HOME/jre/lib/security/cacerts`.\n+Following is an example of using `keytool` to import a certificate into the truststore:\n+`keytool -import -alias apm-server-cert -file /path/to/certificate.crt -keystore /path/to/truststore`\n+\n+[float]\n+[[ssl-client-authentication]]\n+=== Agent certificate authentication\n+\n+If {apm-server-ref-v}/secure-communication-agents.html#ssl-client-authentication[SSL client authentication]\n+is enabled on the APM server, the agent will be required to send a proper certificate as part of the\n+HTTPS handshake. There is currently no configuration on the Java agent that supports that and\n+no one straightforward option to do that that is suitable for all cases.\n+Generally speaking, the agent will send a certificate from the JVM keystore. So, if your JVM does not\n+use a keystore already, add the certificate file and the corresponding private key into a keystore and\n+configure your JVM to use it:\n+\n+----", "originalCommit": "d44a566b8e6ee993df52eb0641dd64b423e4fc9b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzE5OTUzNQ==", "url": "https://github.com/elastic/apm-agent-java/pull/1348#discussion_r473199535", "bodyText": "This is a long command. It probably makes more sense to format this in a code block so that it doesn't get split onto multiple lines\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            `keytool -import -alias apm-server-cert -file /path/to/certificate.crt -keystore /path/to/truststore`\n          \n          \n            \n            [source,bash]\n          \n          \n            \n            ----\n          \n          \n            \n            keytool -import -alias apm-server-cert -file /path/to/certificate.crt -keystore /path/to/truststore\n          \n          \n            \n            ----", "author": "bmorelli25", "createdAt": "2020-08-19T17:20:42Z", "path": "docs/setup-ssl.asciidoc", "diffHunk": "@@ -0,0 +1,37 @@\n+[[ssl-configuration]]\n+== SSL/TLS communication with APM Server\n+\n+If {apm-server-ref-v}/secure-communication-agents.html#ssl-setup[SSL/TLS communication] is enabled on\n+the APM Server, use the `https` protocol when configuring <<config-server-urls,`server_urls`>>.\n+\n+[float]\n+[[ssl-server-authentication]]\n+=== APM Server certificate authentication\n+\n+By default, when using HTTPS to communicate with APM Server, the agents will verify the identity\n+of the APM Server by authenticating its certificate. It is not recommended to change this default,\n+however it is possible through the <<config-verify-server-cert>> configuration.\n+\n+If the certificate used by the APM Server is self-signed, you would need to add the same certificate\n+to the JVM's truststore. You can find which truststore is used by setting `-Djavax.net.debug=all`\n+in the command line. Typically, it would be `$JAVA_HOME/jre/lib/security/cacerts`.\n+Following is an example of using `keytool` to import a certificate into the truststore:\n+`keytool -import -alias apm-server-cert -file /path/to/certificate.crt -keystore /path/to/truststore`", "originalCommit": "d44a566b8e6ee993df52eb0641dd64b423e4fc9b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzIwMDAwNw==", "url": "https://github.com/elastic/apm-agent-java/pull/1348#discussion_r473200007", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            ==== Communication with APM Server ====\n          \n          \n            \n            ==== Communication with APM Server", "author": "bmorelli25", "createdAt": "2020-08-19T17:21:29Z", "path": "docs/troubleshooting.asciidoc", "diffHunk": "@@ -211,6 +211,21 @@ at the incorrect jar file.\n The correct jar file to be pointing at should be in the form of `elastic-apm-agent-<version>.jar` and\n further information about how to download this file can be found <<setup-javaagent, in the manual setup instructions.>>\n \n+[float]\n+[[trouble-shooting-communication]]\n+==== Communication with APM Server ====", "originalCommit": "d44a566b8e6ee993df52eb0641dd64b423e4fc9b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "845979ec6715884864b6bd8f5ae6d7ff07e71a45", "url": "https://github.com/elastic/apm-agent-java/commit/845979ec6715884864b6bd8f5ae6d7ff07e71a45", "message": "Removing anchor references from server links", "committedDate": "2020-08-20T05:45:31Z", "type": "commit"}, {"oid": "845979ec6715884864b6bd8f5ae6d7ff07e71a45", "url": "https://github.com/elastic/apm-agent-java/commit/845979ec6715884864b6bd8f5ae6d7ff07e71a45", "message": "Removing anchor references from server links", "committedDate": "2020-08-20T05:45:31Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzY0NjY0Nw==", "url": "https://github.com/elastic/apm-agent-java/pull/1348#discussion_r473646647", "bodyText": "It currently fails on this one. How does it work on internal links? Does it depend on order of the pages being built? How do we deal with that?", "author": "eyalkoren", "createdAt": "2020-08-20T06:29:24Z", "path": "docs/troubleshooting.asciidoc", "diffHunk": "@@ -211,6 +211,21 @@ at the incorrect jar file.\n The correct jar file to be pointing at should be in the form of `elastic-apm-agent-<version>.jar` and\n further information about how to download this file can be found <<setup-javaagent, in the manual setup instructions.>>\n \n+[float]\n+[[trouble-shooting-communication]]\n+==== Communication with APM Server ====\n+\n+`unable to find valid certification path to requested target` - server authentication fails. Check out\n+<<ssl-server-authentication>>.", "originalCommit": "845979ec6715884864b6bd8f5ae6d7ff07e71a45", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzY1ODM3Nw==", "url": "https://github.com/elastic/apm-agent-java/pull/1348#discussion_r473658377", "bodyText": "OK, @felixbarny answered - the page needs to be included (directly or indirectly) from the index.asciidoc", "author": "eyalkoren", "createdAt": "2020-08-20T06:45:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzY0NjY0Nw=="}], "type": "inlineReview"}, {"oid": "78bce0a6f8e78d69055cdfb485cbba6f20fa1408", "url": "https://github.com/elastic/apm-agent-java/commit/78bce0a6f8e78d69055cdfb485cbba6f20fa1408", "message": "Including new SSL asciidoc", "committedDate": "2020-08-20T06:48:39Z", "type": "commit"}, {"oid": "33f415e97b223ffa3562b1caf2d84ce30f299957", "url": "https://github.com/elastic/apm-agent-java/commit/33f415e97b223ffa3562b1caf2d84ce30f299957", "message": "change duplicated ID", "committedDate": "2020-08-20T08:11:04Z", "type": "commit"}, {"oid": "c4c0455e35b7213e6ee10dc21c7a83ea2a85fa39", "url": "https://github.com/elastic/apm-agent-java/commit/c4c0455e35b7213e6ee10dc21c7a83ea2a85fa39", "message": "Moving SSL docs under agent setup", "committedDate": "2020-08-20T08:30:14Z", "type": "commit"}, {"oid": "9f3320003cb67f4dcc0a137730feea02754f4df6", "url": "https://github.com/elastic/apm-agent-java/commit/9f3320003cb67f4dcc0a137730feea02754f4df6", "message": "Small fix", "committedDate": "2020-08-20T08:32:37Z", "type": "commit"}, {"oid": "03a49397ef64153aa34d58bb2b5e06b0538f232d", "url": "https://github.com/elastic/apm-agent-java/commit/03a49397ef64153aa34d58bb2b5e06b0538f232d", "message": "Fix nesting", "committedDate": "2020-08-20T11:02:55Z", "type": "commit"}, {"oid": "ebb9d90e66af7a6319d81b6c6b2997b737ad7f2b", "url": "https://github.com/elastic/apm-agent-java/commit/ebb9d90e66af7a6319d81b6c6b2997b737ad7f2b", "message": "A small clarification", "committedDate": "2020-08-20T11:27:47Z", "type": "commit"}, {"oid": "43560b9eea4cd696be10ed30903acff9cbcff2c7", "url": "https://github.com/elastic/apm-agent-java/commit/43560b9eea4cd696be10ed30903acff9cbcff2c7", "message": "Merge remote-tracking branch 'upstream/master' into ssl-documentation", "committedDate": "2020-08-23T05:49:30Z", "type": "commit"}]}