{"pr_number": 1314, "pr_title": "Fixes problem with Vault in release automation", "pr_createdAt": "2020-07-28T14:54:02Z", "pr_url": "https://github.com/elastic/apm-agent-java/pull/1314", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjEyODcyMQ==", "url": "https://github.com/elastic/apm-agent-java/pull/1314#discussion_r462128721", "bodyText": "I am not sure why this command will not work\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                          def spid = sh(script: \"./scripts/jenkins/fetch_nexus_id.sh\", returnStdout: true).trim()\n          \n          \n            \n                          def spid = getVaultSecret('secret/apm-team/ci/nexus')[\"staging-profile-id\"]\n          \n      \n    \n    \n  \n\nor this one\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                          def spid = sh(script: \"./scripts/jenkins/fetch_nexus_id.sh\", returnStdout: true).trim()\n          \n          \n            \n                          def spid = getVaultSecret('secret/apm-team/ci/nexus').\"staging-profile-id\"", "author": "kuisathaverat", "createdAt": "2020-07-29T08:28:15Z", "path": ".ci/release/Jenkinsfile", "diffHunk": "@@ -140,7 +140,7 @@ pipeline {\n         stage('Nexus release') {\n           steps {\n             script {\n-              def spid = getVaultSecret('nexus')[\"staging-profile-id\"]\n+              def spid = sh(script: \"./scripts/jenkins/fetch_nexus_id.sh\", returnStdout: true).trim()", "originalCommit": "82d62510b302237bc38e1eb2ae703b2d9b6eee13", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjgzMjkyMQ==", "url": "https://github.com/elastic/apm-agent-java/pull/1314#discussion_r462832921", "bodyText": "It will  not work because we are not running on apm-ci. The implementation of getVaultSecret depends specifically on credentials for Vault which are not deployed on the internal CI. This implementation more closely mirrors approaches which are typically employed on the internal CI.", "author": "cachedout", "createdAt": "2020-07-30T08:24:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjEyODcyMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjg1ODQ0OA==", "url": "https://github.com/elastic/apm-agent-java/pull/1314#discussion_r462858448", "bodyText": "Btw, I'm not objecting having the post-release job on apm-ci as long as the job that pushes to maven central remains in the internal ci. This is especially true if there's already a precedent of using secrets from vault in a public CI and if you consider that safe.", "author": "felixbarny", "createdAt": "2020-07-30T09:07:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjEyODcyMQ=="}], "type": "inlineReview"}, {"oid": "42db6eeb3b7fcca7f68efa4513effc1b39aa00ef", "url": "https://github.com/elastic/apm-agent-java/commit/42db6eeb3b7fcca7f68efa4513effc1b39aa00ef", "message": "Add nexus fetch script", "committedDate": "2020-08-03T16:27:40Z", "type": "commit"}, {"oid": "6d8bf1fcc03d717e1d3ab69e2af180acc1933c80", "url": "https://github.com/elastic/apm-agent-java/commit/6d8bf1fcc03d717e1d3ab69e2af180acc1933c80", "message": "Switch over to script", "committedDate": "2020-08-03T16:27:40Z", "type": "commit"}, {"oid": "6d8bf1fcc03d717e1d3ab69e2af180acc1933c80", "url": "https://github.com/elastic/apm-agent-java/commit/6d8bf1fcc03d717e1d3ab69e2af180acc1933c80", "message": "Switch over to script", "committedDate": "2020-08-03T16:27:40Z", "type": "forcePushed"}]}