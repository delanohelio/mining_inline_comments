{"pr_number": 1447, "pr_title": "Avoid instrumenting HttpsURLConnectionImpl", "pr_createdAt": "2020-10-20T09:46:45Z", "pr_url": "https://github.com/elastic/apm-agent-java/pull/1447", "timeline": [{"oid": "82a1b384f39074b255ddfe6249d28af7fdc421f1", "url": "https://github.com/elastic/apm-agent-java/commit/82a1b384f39074b255ddfe6249d28af7fdc421f1", "message": "Avoid instrumenting HttpsURLConnectionImpl", "committedDate": "2020-10-20T09:42:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODM3MzY1OA==", "url": "https://github.com/elastic/apm-agent-java/pull/1447#discussion_r508373658", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    return hasSuperType(is(HttpURLConnection.class)).and(not(named(\"sun.net.www.protocol.https.HttpsURLConnectionImpl\")));\n          \n          \n            \n                    return hasSuperType(is(HttpURLConnection.class))\n          \n          \n            \n                        .and(not(named(\"sun.net.www.protocol.https.HttpsURLConnectionImpl\")))\n          \n          \n            \n                        .and(declaresField(named(\"connected\")));", "author": "felixbarny", "createdAt": "2020-10-20T10:05:02Z", "path": "apm-agent-plugins/apm-urlconnection-plugin/src/main/java/co/elastic/apm/agent/urlconnection/HttpUrlConnectionInstrumentation.java", "diffHunk": "@@ -64,7 +65,7 @@\n \n     @Override\n     public ElementMatcher<? super TypeDescription> getTypeMatcher() {\n-        return hasSuperType(is(HttpURLConnection.class));\n+        return hasSuperType(is(HttpURLConnection.class)).and(not(named(\"sun.net.www.protocol.https.HttpsURLConnectionImpl\")));", "originalCommit": "82a1b384f39074b255ddfe6249d28af7fdc421f1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODM3NTExMw==", "url": "https://github.com/elastic/apm-agent-java/pull/1447#discussion_r508375113", "bodyText": "Why declaresField(named(\"connected\"))? It can be an inherited and not a declared field.", "author": "eyalkoren", "createdAt": "2020-10-20T10:07:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODM3MzY1OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTAxNzQ0OA==", "url": "https://github.com/elastic/apm-agent-java/pull/1447#discussion_r509017448", "bodyText": "@felixbarny This cannot work, as the connected field belongs to java.net.URLConnection (abstract). Let me know if you think we can merge it.", "author": "eyalkoren", "createdAt": "2020-10-21T06:23:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODM3MzY1OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTAyNjgxNg==", "url": "https://github.com/elastic/apm-agent-java/pull/1447#discussion_r509026816", "bodyText": "Yes, forget what I said. @Advice.FieldValue(\"connected\") boolean connected is guaranteed to work as the connected field is always accessible as we're searching for sub-types of HttpUrlConnection that are also sub-types of URLConnection", "author": "felixbarny", "createdAt": "2020-10-21T06:45:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODM3MzY1OA=="}], "type": "inlineReview"}, {"oid": "d40f6fb9af343957f1e3cc3e6cd5391b323d2f18", "url": "https://github.com/elastic/apm-agent-java/commit/d40f6fb9af343957f1e3cc3e6cd5391b323d2f18", "message": "Merge remote-tracking branch 'upstream/master' into HttpUrlConnection-new-instr-fix", "committedDate": "2020-10-21T13:16:32Z", "type": "commit"}, {"oid": "ad02dc62e51d03c28ab7af32aeed6144881e4f4c", "url": "https://github.com/elastic/apm-agent-java/commit/ad02dc62e51d03c28ab7af32aeed6144881e4f4c", "message": "Adding to CHANGELOG", "committedDate": "2020-10-21T13:18:41Z", "type": "commit"}]}