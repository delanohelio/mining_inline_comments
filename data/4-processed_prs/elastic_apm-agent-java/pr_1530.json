{"pr_number": 1530, "pr_title": "[cache][ci] use cached m2 repository", "pr_createdAt": "2020-11-24T10:59:58Z", "pr_url": "https://github.com/elastic/apm-agent-java/pull/1530", "timeline": [{"oid": "a39a484f3a1cfe550a44c49b47204781ee95256f", "url": "https://github.com/elastic/apm-agent-java/commit/a39a484f3a1cfe550a44c49b47204781ee95256f", "message": "[cache][ci] use cached m2 repository", "committedDate": "2020-11-24T10:57:21Z", "type": "commit"}, {"oid": "030533d380b6ed4e32fe16bebc457340521d82f9", "url": "https://github.com/elastic/apm-agent-java/commit/030533d380b6ed4e32fe16bebc457340521d82f9", "message": "Revert \"[cache][ci] use cached m2 repository\"\n\nThis reverts commit a39a484f3a1cfe550a44c49b47204781ee95256f.", "committedDate": "2020-11-24T12:27:26Z", "type": "commit"}, {"oid": "b7a84781e37297c5cbd051ffef1e556b5203f76a", "url": "https://github.com/elastic/apm-agent-java/commit/b7a84781e37297c5cbd051ffef1e556b5203f76a", "message": ".m2 repository to be prepared before the building", "committedDate": "2020-11-24T12:31:20Z", "type": "commit"}, {"oid": "f04e77a0acd082b37357c094cacce7f1c7a27450", "url": "https://github.com/elastic/apm-agent-java/commit/f04e77a0acd082b37357c094cacce7f1c7a27450", "message": "Use more declarative syntax", "committedDate": "2020-11-24T12:34:07Z", "type": "commit"}, {"oid": "156a41efc04f0ad1636ceb9bbf28e58dbc54d3e3", "url": "https://github.com/elastic/apm-agent-java/commit/156a41efc04f0ad1636ceb9bbf28e58dbc54d3e3", "message": "Use Google Storage as a temporary location to copy files", "committedDate": "2020-11-24T14:28:12Z", "type": "commit"}, {"oid": "22ebae03cca9d84f1bd8b4fa06a54e87628b5908", "url": "https://github.com/elastic/apm-agent-java/commit/22ebae03cca9d84f1bd8b4fa06a54e87628b5908", "message": "Revert \"Use Google Storage as a temporary location to copy files\"\n\nThis reverts commit 156a41efc04f0ad1636ceb9bbf28e58dbc54d3e3.", "committedDate": "2020-11-24T15:32:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTcxMDcxOQ==", "url": "https://github.com/elastic/apm-agent-java/pull/1530#discussion_r529710719", "bodyText": "where is that dir coming from? from the packer cache?", "author": "felixbarny", "createdAt": "2020-11-24T16:28:35Z", "path": "Jenkinsfile", "diffHunk": "@@ -79,6 +79,10 @@ pipeline {\n             withGithubNotify(context: 'Build', tab: 'artifacts') {\n               deleteDir()\n               unstash 'source'\n+              // prepare m2 repository with the existing dependencies\n+              whenTrue(fileExists('/var/lib/jenkins/.m2/repository')) {", "originalCommit": "22ebae03cca9d84f1bd8b4fa06a54e87628b5908", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTcyNTYyNg==", "url": "https://github.com/elastic/apm-agent-java/pull/1530#discussion_r529725626", "bodyText": "that's the default home directory for the linux CI Workers, in fact, they don't have a HOME env variable but that's where all the cached artifacts are stored.", "author": "v1v", "createdAt": "2020-11-24T16:49:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTcxMDcxOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDM4MTk1Nw==", "url": "https://github.com/elastic/apm-agent-java/pull/1530#discussion_r530381957", "bodyText": "This copies a cached folder to this build. But how does the /var/lib/jenkins/.m2/repository folder get populated? Wouldn't it always be empty?", "author": "felixbarny", "createdAt": "2020-11-25T13:41:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTcxMDcxOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDM4OTA3OA==", "url": "https://github.com/elastic/apm-agent-java/pull/1530#discussion_r530389078", "bodyText": "/var/lib/jenkins/.m2/repository gets populated every night when the daily images run the packer_cache.sh. It should not be empty, but it it was then it will not cause any issues at all", "author": "v1v", "createdAt": "2020-11-25T13:52:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTcxMDcxOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDM5MzAwMw==", "url": "https://github.com/elastic/apm-agent-java/pull/1530#discussion_r530393003", "bodyText": "got it, thanks. A minor suggestion: we could add a du -hs .m2 so that we can verify whether this directory is non-empty.", "author": "felixbarny", "createdAt": "2020-11-25T13:58:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTcxMDcxOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDM5NDc2Mg==", "url": "https://github.com/elastic/apm-agent-java/pull/1530#discussion_r530394762", "bodyText": "Do you mean temporarily?\nit was not empty when I tested it out:\nsee copy step that took 15 seconds ( the screenshots section in the PR description also shows that particular step details)", "author": "v1v", "createdAt": "2020-11-25T14:01:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTcxMDcxOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDQxMzI4MQ==", "url": "https://github.com/elastic/apm-agent-java/pull/1530#discussion_r530413281", "bodyText": "21c44ba is there now", "author": "v1v", "createdAt": "2020-11-25T14:27:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTcxMDcxOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDQyNTEyMw==", "url": "https://github.com/elastic/apm-agent-java/pull/1530#discussion_r530425123", "bodyText": "I guess it doesn't hurt to just stay in there", "author": "felixbarny", "createdAt": "2020-11-25T14:43:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTcxMDcxOQ=="}], "type": "inlineReview"}, {"oid": "21c44bac8ebe3365b5b07be4cc3382c4be3416b1", "url": "https://github.com/elastic/apm-agent-java/commit/21c44bac8ebe3365b5b07be4cc3382c4be3416b1", "message": "As suggested in the code review", "committedDate": "2020-11-25T14:25:59Z", "type": "commit"}]}