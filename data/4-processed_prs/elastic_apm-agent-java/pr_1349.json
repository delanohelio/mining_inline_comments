{"pr_number": 1349, "pr_title": "Migrate Apache HttpClient plugin to indy plugin", "pr_createdAt": "2020-08-19T13:57:33Z", "pr_url": "https://github.com/elastic/apm-agent-java/pull/1349", "timeline": [{"oid": "556952a3cc2c5005d7f0f18743cd68f8db519ea4", "url": "https://github.com/elastic/apm-agent-java/commit/556952a3cc2c5005d7f0f18743cd68f8db519ea4", "message": "Migrate Apache HttpClient plugin to indy plugin", "committedDate": "2020-08-19T13:56:17Z", "type": "commit"}, {"oid": "05bbd0c9980da04d05bc6bd8f092707e5ba9cd0c", "url": "https://github.com/elastic/apm-agent-java/commit/05bbd0c9980da04d05bc6bd8f092707e5ba9cd0c", "message": "Avoid CNFE by moving helper to advice class", "committedDate": "2020-08-20T07:11:00Z", "type": "commit"}, {"oid": "1ee04f0d3f7f36378b2680726064ebff5e849b1c", "url": "https://github.com/elastic/apm-agent-java/commit/1ee04f0d3f7f36378b2680726064ebff5e849b1c", "message": "Avoid resolving TypeDescriptions when validating advice methods", "committedDate": "2020-08-20T09:55:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTQ0NjU5NQ==", "url": "https://github.com/elastic/apm-agent-java/pull/1349#discussion_r475446595", "bodyText": "[question] why do we have to use raw type here ? maybe add a small comment.", "author": "SylvainJuge", "createdAt": "2020-08-24T09:04:31Z", "path": "apm-agent-core/src/main/java/co/elastic/apm/agent/bci/ElasticApmAgent.java", "diffHunk": "@@ -448,7 +448,7 @@ private static void validateAdvice(Class<?> adviceClass) {\n         }\n         for (MethodDescription.InDefinedShape exitAdvice : typeDescription.getDeclaredMethods().filter(isStatic().and(isAnnotatedWith(Advice.OnMethodExit.class)))) {\n             validateAdviceReturnAndParameterTypes(exitAdvice);\n-            if (exitAdvice.getReturnType().getTypeName().startsWith(\"co.elastic.apm\")) {\n+            if (exitAdvice.getReturnType().asRawType().getTypeName().startsWith(\"co.elastic.apm\")) {", "originalCommit": "1ee04f0d3f7f36378b2680726064ebff5e849b1c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDEwNTYzNQ==", "url": "https://github.com/elastic/apm-agent-java/pull/1349#discussion_r480105635", "bodyText": "This is to avoid that the type gets resolved (leading to exceptions). That part of the code will change once we merge in the changes you made for WebFlux. So adding a comment would make merging trickier.", "author": "felixbarny", "createdAt": "2020-08-31T12:46:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTQ0NjU5NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDE2NzA1Nw==", "url": "https://github.com/elastic/apm-agent-java/pull/1349#discussion_r480167057", "bodyText": "Thank you for taking care of making other's PRs easier to merge !!", "author": "SylvainJuge", "createdAt": "2020-08-31T14:26:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTQ0NjU5NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDEwMDYxNA==", "url": "https://github.com/elastic/apm-agent-java/pull/1349#discussion_r480100614", "bodyText": "[minor] helper instance might be private", "author": "SylvainJuge", "createdAt": "2020-08-31T12:36:41Z", "path": "apm-agent-plugins/apm-apache-httpclient-plugin/src/main/java/co/elastic/apm/agent/httpclient/ApacheHttpAsyncClientInstrumentation.java", "diffHunk": "@@ -102,12 +84,14 @@ public ApacheHttpAsyncClientInstrumentation(ElasticApmTracer tracer) {\n     }\n \n     public static class ApacheHttpAsyncClientAdvice {\n+        public static ApacheHttpAsyncClientHelper asyncHelper = new ApacheHttpAsyncClientHelper();", "originalCommit": "1ee04f0d3f7f36378b2680726064ebff5e849b1c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDEwNTg4Ng==", "url": "https://github.com/elastic/apm-agent-java/pull/1349#discussion_r480105886", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    public static ApacheHttpAsyncClientHelper asyncHelper = new ApacheHttpAsyncClientHelper();\n          \n          \n            \n                    private static ApacheHttpAsyncClientHelper asyncHelper = new ApacheHttpAsyncClientHelper();", "author": "felixbarny", "createdAt": "2020-08-31T12:46:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDEwMDYxNA=="}], "type": "inlineReview"}, {"oid": "70500e03b4dfa4c8649af25dc384ffea1be7b990", "url": "https://github.com/elastic/apm-agent-java/commit/70500e03b4dfa4c8649af25dc384ffea1be7b990", "message": "Make helper private", "committedDate": "2020-08-31T12:46:55Z", "type": "commit"}]}