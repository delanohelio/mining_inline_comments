{"pr_number": 1087, "pr_title": "Document and reorder classpath config", "pr_createdAt": "2020-03-18T16:53:54Z", "pr_url": "https://github.com/elastic/apm-agent-java/pull/1087", "timeline": [{"oid": "c520dbf3546f840cab6c638ee13ca21e5883869c", "url": "https://github.com/elastic/apm-agent-java/commit/c520dbf3546f840cab6c638ee13ca21e5883869c", "message": "remove unused inline configuration", "committedDate": "2020-03-16T17:06:34Z", "type": "commit"}, {"oid": "1d8febccc76c5538cc4bd8de0af2b1c3ab2397bf", "url": "https://github.com/elastic/apm-agent-java/commit/1d8febccc76c5538cc4bd8de0af2b1c3ab2397bf", "message": "start clarify and change config order", "committedDate": "2020-03-17T13:21:53Z", "type": "commit"}, {"oid": "2152de27204169743c8e2d3679d40bc621e47fae", "url": "https://github.com/elastic/apm-agent-java/commit/2152de27204169743c8e2d3679d40bc621e47fae", "message": "re-order and document things", "committedDate": "2020-03-18T16:06:51Z", "type": "commit"}, {"oid": "8fad52a45defb58e9aac9972d44fb32d2337d909", "url": "https://github.com/elastic/apm-agent-java/commit/8fad52a45defb58e9aac9972d44fb32d2337d909", "message": "make comment more explicit", "committedDate": "2020-03-18T16:20:46Z", "type": "commit"}, {"oid": "d1ca23ae89820cf8257082b009733ac20c8bfe16", "url": "https://github.com/elastic/apm-agent-java/commit/d1ca23ae89820cf8257082b009733ac20c8bfe16", "message": "minor tweaks for doc", "committedDate": "2020-03-18T16:39:18Z", "type": "commit"}, {"oid": "39e9b3a1632138ac8d6c60548b1eddffca73e879", "url": "https://github.com/elastic/apm-agent-java/commit/39e9b3a1632138ac8d6c60548b1eddffca73e879", "message": "update changelog", "committedDate": "2020-03-18T16:55:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDQ5OTcwOQ==", "url": "https://github.com/elastic/apm-agent-java/pull/1087#discussion_r394499709", "bodyText": "This method wasn't used outside tests.", "author": "SylvainJuge", "createdAt": "2020-03-18T16:57:36Z", "path": "apm-agent-core/src/main/java/co/elastic/apm/agent/impl/ElasticApmTracerBuilder.java", "diffHunk": "@@ -101,10 +102,6 @@ public ElasticApmTracerBuilder reporter(Reporter reporter) {\n         return this;\n     }\n \n-    public ElasticApmTracerBuilder withConfig(String key, String value) {", "originalCommit": "39e9b3a1632138ac8d6c60548b1eddffca73e879", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDUwMjQ3Mw==", "url": "https://github.com/elastic/apm-agent-java/pull/1087#discussion_r394502473", "bodyText": "just like with kids, it's often better to explain the why behind the don't", "author": "SylvainJuge", "createdAt": "2020-03-18T17:01:38Z", "path": "docs/setup-javaagent.asciidoc", "diffHunk": "@@ -8,11 +8,12 @@\n The first step in getting started with the Elastic APM Java agent is to download the latest release of the agent jar file from\n link:https://search.maven.org/search?q=g:co.elastic.apm%20AND%20a:elastic-apm-agent[maven central].\n \n-NOTE: Don't declare a dependency to the agent in your application.\n+NOTE: Agents are not like regular application dependencies.\n+Don't declare a dependency to the agent in your application.", "originalCommit": "39e9b3a1632138ac8d6c60548b1eddffca73e879", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "6cff0db072eae8b9e3f68c0d15c2fdb699283e6f", "url": "https://github.com/elastic/apm-agent-java/commit/6cff0db072eae8b9e3f68c0d15c2fdb699283e6f", "message": "add link to doc CI if needed", "committedDate": "2020-03-19T09:29:01Z", "type": "commit"}, {"oid": "fc896537aba447e28efa45c13aee778428a5edb3", "url": "https://github.com/elastic/apm-agent-java/commit/fc896537aba447e28efa45c13aee778428a5edb3", "message": "move external elasticapm.properties with higher priority", "committedDate": "2020-03-19T13:42:38Z", "type": "commit"}, {"oid": "8bae92aa4e5bc9e83eaa277e0c0ac3085faac509", "url": "https://github.com/elastic/apm-agent-java/commit/8bae92aa4e5bc9e83eaa277e0c0ac3085faac509", "message": "add breaking change to changelog", "committedDate": "2020-03-19T16:38:18Z", "type": "commit"}, {"oid": "c0b1974433f02b785ec41537a2c9336d2c48eb44", "url": "https://github.com/elastic/apm-agent-java/commit/c0b1974433f02b785ec41537a2c9336d2c48eb44", "message": "Merge branch 'master' into document-and-reorder-classpath-config", "committedDate": "2020-03-19T16:39:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQ1MTUwMQ==", "url": "https://github.com/elastic/apm-agent-java/pull/1087#discussion_r396451501", "bodyText": "Remove this? Seems to be a duplicate of 2.", "author": "felixbarny", "createdAt": "2020-03-23T13:31:32Z", "path": "docs/configuration.asciidoc", "diffHunk": "@@ -5,28 +5,35 @@ Please only make changes in configuration.asciidoc.ftl\n ////\n [[configuration]]\n == Configuration\n-To adapt the Elastic APM agent to your needs,\n-you can configure it using different configuration sources,\n-which have different naming conventions for the property key.\n-In descending order of precedence:\n+The Elastic APM agent can be configured through different configuration sources,\n+with the following descending order of precedence:\n \n [arabic]\n . {apm-app-ref}/agent-configuration.html[Central configuration]\n+. `elasticapm.properties` file, by default in the same directory the agent jar. +\n+  Location can be set with the <<config-config-file>> option in system properties or environment variables. +\n+  No prefix is required for the configuration keys.\n . Java system properties +\n   All configuration keys are prefixed with `elastic.apm.`\n . Environment variables +\n   All configuration keys are in uppercase and prefixed with `ELASTIC_APM_`\n-. `elasticapm.properties` file +\n-  You can place a `elasticapm.properties` in the same directory the agent jar resides in.\n-  To customize the location, set the <<config-config-file>> option.\n+. runtime attach parameters, those are mutually exclusive +\n   No prefix is required for the configuration keys.\n-\n-Central configuration overrides all other settings. Java system properties override Environment variables. Environment variables override `elasticapm.properties`\n+.. `--config` parameter (<<setup-attach-cli>>)\n+.. arguments of  `ElasticApmAttacher.attach(...)` (<<setup-attach-api>>)\n+.. `elasticapm.properties` in classpath root with `ElasticApmAttacher.attach()` (<<setup-attach-api>>) +\n+. `elasticapm.properties` file, by default in the same directory the agent jar. +\n+  Location can be set with the <<config-config-file>> option. +\n+  No prefix is required for the configuration keys.", "originalCommit": "c0b1974433f02b785ec41537a2c9336d2c48eb44", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQ1ODUzNw==", "url": "https://github.com/elastic/apm-agent-java/pull/1087#discussion_r396458537", "bodyText": "I think by using footnotes it's easier to understand and with less text.", "author": "felixbarny", "createdAt": "2020-03-23T13:41:56Z", "path": "docs/configuration.asciidoc", "diffHunk": "@@ -5,28 +5,35 @@ Please only make changes in configuration.asciidoc.ftl\n ////\n [[configuration]]\n == Configuration\n-To adapt the Elastic APM agent to your needs,\n-you can configure it using different configuration sources,\n-which have different naming conventions for the property key.\n-In descending order of precedence:\n+The Elastic APM agent can be configured through different configuration sources,\n+with the following descending order of precedence:\n \n [arabic]\n . {apm-app-ref}/agent-configuration.html[Central configuration]\n+. `elasticapm.properties` file, by default in the same directory the agent jar. +\n+  Location can be set with the <<config-config-file>> option in system properties or environment variables. +\n+  No prefix is required for the configuration keys.\n . Java system properties +\n   All configuration keys are prefixed with `elastic.apm.`\n . Environment variables +\n   All configuration keys are in uppercase and prefixed with `ELASTIC_APM_`\n-. `elasticapm.properties` file +\n-  You can place a `elasticapm.properties` in the same directory the agent jar resides in.\n-  To customize the location, set the <<config-config-file>> option.\n+. runtime attach parameters, those are mutually exclusive +\n   No prefix is required for the configuration keys.\n-\n-Central configuration overrides all other settings. Java system properties override Environment variables. Environment variables override `elasticapm.properties`\n+.. `--config` parameter (<<setup-attach-cli>>)\n+.. arguments of  `ElasticApmAttacher.attach(...)` (<<setup-attach-api>>)\n+.. `elasticapm.properties` in classpath root with `ElasticApmAttacher.attach()` (<<setup-attach-api>>) +\n+. `elasticapm.properties` file, by default in the same directory the agent jar. +\n+  Location can be set with the <<config-config-file>> option. +\n+  No prefix is required for the configuration keys.\n+. default values\n \n Configuration options marked with Dynamic true can be changed at runtime via configuration sources which support dynamic reloading.\n {kibana-ref}/agent-configuration.html[Central configuration] and the `elasticapm.properties` file are such sources.\n Java system properties can be dynamic as well by being set from within the application.\n \n+Please note that there are two distinct ways to use `elasticapm.properties`: as an external configuration file, and as a\n+classpath resource. Only the external file can be used for dynamic configuration.\n+", "originalCommit": "c0b1974433f02b785ec41537a2c9336d2c48eb44", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQ1OTQwOA==", "url": "https://github.com/elastic/apm-agent-java/pull/1087#discussion_r396459408", "bodyText": "I think we could do a better job of flagging which configuration sources allow dynamic changes. Maybe we could use asciidoc footnotes for that.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            . {apm-app-ref}/agent-configuration.html[Central configuration]\n          \n          \n            \n            . `elasticapm.properties` file, by default in the same directory the agent jar. +\n          \n          \n            \n            . {apm-app-ref}/agent-configuration.html[Central configuration] footnote:dynamic[Configuration options marked with Dynamic true can be changed at runtime with this configuration source]\n          \n          \n            \n            . `elasticapm.properties` file footnote:dynamic[], by default in the same directory the agent jar. +\n          \n      \n    \n    \n  \n\ndisclaimer: I've never used footnotes before and have not tested this renders properly", "author": "felixbarny", "createdAt": "2020-03-23T13:43:13Z", "path": "docs/configuration.asciidoc", "diffHunk": "@@ -5,28 +5,35 @@ Please only make changes in configuration.asciidoc.ftl\n ////\n [[configuration]]\n == Configuration\n-To adapt the Elastic APM agent to your needs,\n-you can configure it using different configuration sources,\n-which have different naming conventions for the property key.\n-In descending order of precedence:\n+The Elastic APM agent can be configured through different configuration sources,\n+with the following descending order of precedence:\n \n [arabic]\n . {apm-app-ref}/agent-configuration.html[Central configuration]\n+. `elasticapm.properties` file, by default in the same directory the agent jar. +", "originalCommit": "c0b1974433f02b785ec41537a2c9336d2c48eb44", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "621b06d3c90cc4cfd46bab59e8ecaee95d6363ba", "url": "https://github.com/elastic/apm-agent-java/commit/621b06d3c90cc4cfd46bab59e8ecaee95d6363ba", "message": "try to improve config sources list", "committedDate": "2020-03-24T14:35:04Z", "type": "commit"}, {"oid": "db8024d21e24a4600d431c5ce02a40b953bd77a8", "url": "https://github.com/elastic/apm-agent-java/commit/db8024d21e24a4600d431c5ce02a40b953bd77a8", "message": "try to add float to see if that works", "committedDate": "2020-03-24T16:18:56Z", "type": "commit"}, {"oid": "2a8ba633acf86ff94918caefaf325a1c92468679", "url": "https://github.com/elastic/apm-agent-java/commit/2a8ba633acf86ff94918caefaf325a1c92468679", "message": "move note to dynamic config", "committedDate": "2020-03-25T09:28:14Z", "type": "commit"}]}