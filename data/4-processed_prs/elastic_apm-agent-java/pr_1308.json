{"pr_number": 1308, "pr_title": "Fixes for git error in release pipeline", "pr_createdAt": "2020-07-23T14:40:44Z", "pr_url": "https://github.com/elastic/apm-agent-java/pull/1308", "timeline": [{"oid": "0ddb5c33621be86ed9219b28b31b907db06274d5", "url": "https://github.com/elastic/apm-agent-java/commit/0ddb5c33621be86ed9219b28b31b907db06274d5", "message": "Move tag detection to script and fix sorting error", "committedDate": "2020-07-23T14:12:51Z", "type": "commit"}, {"oid": "eed6204f11b5ac0b9112ea1c35d9bd3fc7eebea8", "url": "https://github.com/elastic/apm-agent-java/commit/eed6204f11b5ac0b9112ea1c35d9bd3fc7eebea8", "message": "Try strip newline", "committedDate": "2020-07-23T14:31:14Z", "type": "commit"}, {"oid": "56132816880569c7c3bcc7b4405c048065b0bf19", "url": "https://github.com/elastic/apm-agent-java/commit/56132816880569c7c3bcc7b4405c048065b0bf19", "message": "Try tr", "committedDate": "2020-07-23T14:34:09Z", "type": "commit"}, {"oid": "a679f4d826e25ef7db9a8b72558e9371cb7638e0", "url": "https://github.com/elastic/apm-agent-java/commit/a679f4d826e25ef7db9a8b72558e9371cb7638e0", "message": "More tr", "committedDate": "2020-07-23T14:35:53Z", "type": "commit"}, {"oid": "10ffad810c9aa69500d356d2469eab6aecda1ee3", "url": "https://github.com/elastic/apm-agent-java/commit/10ffad810c9aa69500d356d2469eab6aecda1ee3", "message": "Spaces for readability", "committedDate": "2020-07-23T14:38:27Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTUxNDAwMg==", "url": "https://github.com/elastic/apm-agent-java/pull/1308#discussion_r459514002", "bodyText": "This is up to you but I personally prefer using long options in scripts as they are more descriptive\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    git tag | sort -V | tail -1 | tr -d '\\n'\n          \n          \n            \n                    git tag | sort --version-sort | tail -1 | tr -d '\\n'", "author": "felixbarny", "createdAt": "2020-07-23T14:57:25Z", "path": "scripts/jenkins/tags.sh", "diffHunk": "@@ -0,0 +1,12 @@\n+#!/usr/bin/env bash\n+case  $1  in\n+    bare)\n+        git tag | sort -V | tail -1 | tr -d '\\n'", "originalCommit": "10ffad810c9aa69500d356d2469eab6aecda1ee3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "71555f203a4b9bdebe42ae5bb78e2d10a3c90113", "url": "https://github.com/elastic/apm-agent-java/commit/71555f203a4b9bdebe42ae5bb78e2d10a3c90113", "message": "Update scripts/jenkins/tags.sh\n\nCo-authored-by: Felix Barnsteiner <felixbarny@users.noreply.github.com>", "committedDate": "2020-07-23T15:09:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTUzMjg1Mw==", "url": "https://github.com/elastic/apm-agent-java/pull/1308#discussion_r459532853", "bodyText": "?.trim() could also help here if no spaces/new lines are required at all\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            env.TAG_BARE = sh(script: \"./scripts/jenkins/tags.sh bare\", returnStdout: true)\n          \n          \n            \n                            env.TAG_VER = sh(script: \"./scripts/jenkins/tags.sh ver\", returnStdout: true)\n          \n          \n            \n                            env.TAG_DOT_X = sh(script: \"./scripts/jenkins/tags.sh dot_x\", returnStdout: true)\n          \n          \n            \n                            env.TAG_BARE = sh(script: \"./scripts/jenkins/tags.sh bare\", returnStdout: true)?.trim()\n          \n          \n            \n                            env.TAG_VER = sh(script: \"./scripts/jenkins/tags.sh ver\", returnStdout: true)?.trim()\n          \n          \n            \n                            env.TAG_DOT_X = sh(script: \"./scripts/jenkins/tags.sh dot_x\", returnStdout: true)?.trim()", "author": "v1v", "createdAt": "2020-07-23T15:22:54Z", "path": ".ci/release/Jenkinsfile", "diffHunk": "@@ -46,9 +46,9 @@ pipeline {\n             stash(allowEmpty: true, name: 'source', useDefaultExcludes: false)\n             dir(\"${BASE_DIR}\") {\n               script {\n-                env.TAG_BARE = sh(script: \"git tag | tail -1\", returnStdout: true)\n-                env.TAG_VER = sh(script: \"git tag | tail -1 | sed s/v//\", returnStdout: true)\n-                env.TAG_DOT_X = sh(script: 'git tag|tail -1|sed s/v//|cut -f1 -d \".\"|awk \\'{print $1\".x\"}\\'', returnStdout: true)\n+                env.TAG_BARE = sh(script: \"./scripts/jenkins/tags.sh bare\", returnStdout: true)\n+                env.TAG_VER = sh(script: \"./scripts/jenkins/tags.sh ver\", returnStdout: true)\n+                env.TAG_DOT_X = sh(script: \"./scripts/jenkins/tags.sh dot_x\", returnStdout: true)", "originalCommit": "71555f203a4b9bdebe42ae5bb78e2d10a3c90113", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}