{"pr_number": 1443, "pr_title": "Async Profiler - add support for AArch64", "pr_createdAt": "2020-10-19T12:30:36Z", "pr_url": "https://github.com/elastic/apm-agent-java/pull/1443", "timeline": [{"oid": "a34312ba0e90c1cf34208d80d182b43b54668e50", "url": "https://github.com/elastic/apm-agent-java/commit/a34312ba0e90c1cf34208d80d182b43b54668e50", "message": "Async Profiler - support AArch64", "committedDate": "2020-10-19T12:27:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzc1NDY2NQ==", "url": "https://github.com/elastic/apm-agent-java/pull/1443#discussion_r507754665", "bodyText": "Does this binary work for both 64 and 32-bit arm?", "author": "felixbarny", "createdAt": "2020-10-19T13:40:32Z", "path": "apm-agent-plugins/apm-profiling-plugin/src/main/java/co/elastic/apm/agent/profiler/asyncprofiler/AsyncProfiler.java", "diffHunk": "@@ -102,8 +102,10 @@ private static String getLibraryFileName() {\n         String os = System.getProperty(\"os.name\").toLowerCase();\n         String arch = System.getProperty(\"os.arch\").toLowerCase();\n         if (os.contains(\"linux\")) {\n-            if (arch.contains(\"arm\") || arch.contains(\"aarch\")) {\n+            if (arch.contains(\"arm\")) {", "originalCommit": "a34312ba0e90c1cf34208d80d182b43b54668e50", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzc1NTU1Mw==", "url": "https://github.com/elastic/apm-agent-java/pull/1443#discussion_r507755553", "bodyText": "Does this binary work for both 64 and 32-bit aarch? Is there even a 32-bit version? Throw exception if not 64 bit?", "author": "felixbarny", "createdAt": "2020-10-19T13:41:40Z", "path": "apm-agent-plugins/apm-profiling-plugin/src/main/java/co/elastic/apm/agent/profiler/asyncprofiler/AsyncProfiler.java", "diffHunk": "@@ -102,8 +102,10 @@ private static String getLibraryFileName() {\n         String os = System.getProperty(\"os.name\").toLowerCase();\n         String arch = System.getProperty(\"os.arch\").toLowerCase();\n         if (os.contains(\"linux\")) {\n-            if (arch.contains(\"arm\") || arch.contains(\"aarch\")) {\n+            if (arch.contains(\"arm\")) {\n                 return \"libasyncProfiler-linux-arm\";\n+            } else if (arch.contains(\"aarch\")) {\n+                return \"libasyncProfiler-linux-aarch64\";", "originalCommit": "a34312ba0e90c1cf34208d80d182b43b54668e50", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzc2OTQyNg==", "url": "https://github.com/elastic/apm-agent-java/pull/1443#discussion_r507769426", "bodyText": "It's 64-specific. I believe the value of the os.arch System property for aarch32 should be arm.\n@apangin can you confirm?", "author": "eyalkoren", "createdAt": "2020-10-19T13:59:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzc1NTU1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzg4NjM0NA==", "url": "https://github.com/elastic/apm-agent-java/pull/1443#discussion_r507886344", "bodyText": "Right, os.arch for 32-bit ARM is arm, for 64-bit ARM is aarch64.\nThere was even a fix to make os.arch return arm on systems that report aarch32.", "author": "apangin", "createdAt": "2020-10-19T16:23:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzc1NTU1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODE3MjI0Mw==", "url": "https://github.com/elastic/apm-agent-java/pull/1443#discussion_r508172243", "bodyText": "Thanks for confirming! Seems like it should be good enough then, but do you think it's better to look for aarch64? Can there be a AArch64 OS where the os.arch contains aarch but not aarch64?", "author": "eyalkoren", "createdAt": "2020-10-20T02:34:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzc1NTU1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODUxNTMxMg==", "url": "https://github.com/elastic/apm-agent-java/pull/1443#discussion_r508515312", "bodyText": "IMO, doesn't matter. You may look for aarch or aarch64 - I expect this to be the same set of systems.", "author": "apangin", "createdAt": "2020-10-20T13:43:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzc1NTU1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDA5NDMyOQ==", "url": "https://github.com/elastic/apm-agent-java/pull/1443#discussion_r510094329", "bodyText": "There was even a fix to make os.arch return arm on systems that report aarch32\n\nEven though this fix is old, I made it more specific so that we do not fail on such old JDKs.", "author": "eyalkoren", "createdAt": "2020-10-22T11:44:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzc1NTU1Mw=="}], "type": "inlineReview"}, {"oid": "46d791463a7bdc98fe58010edd4d7be453c90356", "url": "https://github.com/elastic/apm-agent-java/commit/46d791463a7bdc98fe58010edd4d7be453c90356", "message": "Make it more specific", "committedDate": "2020-10-22T11:43:30Z", "type": "commit"}, {"oid": "34e86bd3430ceeca5bf9d973b7e44da461d94f42", "url": "https://github.com/elastic/apm-agent-java/commit/34e86bd3430ceeca5bf9d973b7e44da461d94f42", "message": "Merge remote-tracking branch 'upstream/master' into async-profiler-add-aarch64-support", "committedDate": "2020-10-26T16:17:32Z", "type": "commit"}, {"oid": "8011fadb87846252f8cdb28119fb33a5159282f2", "url": "https://github.com/elastic/apm-agent-java/commit/8011fadb87846252f8cdb28119fb33a5159282f2", "message": "Add to CHANGELOG", "committedDate": "2020-10-26T16:19:28Z", "type": "commit"}]}