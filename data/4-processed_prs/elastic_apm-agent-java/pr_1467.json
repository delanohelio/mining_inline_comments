{"pr_number": 1467, "pr_title": "Agent load testing", "pr_createdAt": "2020-11-02T14:42:42Z", "pr_url": "https://github.com/elastic/apm-agent-java/pull/1467", "timeline": [{"oid": "cd1b20bfeda82d3d7b4d88881d36a4e20f9b447b", "url": "https://github.com/elastic/apm-agent-java/commit/cd1b20bfeda82d3d7b4d88881d36a4e20f9b447b", "message": "Skeleton of perf Jenkinsfile", "committedDate": "2020-10-21T05:45:48Z", "type": "commit"}, {"oid": "d3e93d2306f8bdbd1ebb17455eebbcd7542bd37e", "url": "https://github.com/elastic/apm-agent-java/commit/d3e93d2306f8bdbd1ebb17455eebbcd7542bd37e", "message": "load generation wait script", "committedDate": "2020-10-22T14:10:11Z", "type": "commit"}, {"oid": "0521d524ff15327ccc7707eb8f37b061dfa91400", "url": "https://github.com/elastic/apm-agent-java/commit/0521d524ff15327ccc7707eb8f37b061dfa91400", "message": "More orch", "committedDate": "2020-10-26T15:50:01Z", "type": "commit"}, {"oid": "6c979b9a91270bb4cd119fe8c76e1b997898f942", "url": "https://github.com/elastic/apm-agent-java/commit/6c979b9a91270bb4cd119fe8c76e1b997898f942", "message": "Working PoC", "committedDate": "2020-10-27T14:55:23Z", "type": "commit"}, {"oid": "6d725d33606c728279396b886a5ab252fc031d34", "url": "https://github.com/elastic/apm-agent-java/commit/6d725d33606c728279396b886a5ab252fc031d34", "message": "Script to generate parameters for the load generation pipeline", "committedDate": "2020-10-28T12:11:11Z", "type": "commit"}, {"oid": "a0d25740866a3f6cbaf619ec6c8cbd8af2ff7930", "url": "https://github.com/elastic/apm-agent-java/commit/a0d25740866a3f6cbaf619ec6c8cbd8af2ff7930", "message": "Add provisioning for agent", "committedDate": "2020-10-28T14:34:30Z", "type": "commit"}, {"oid": "68f3251b429c46e96749d81ad6fda55a05f9b7b4", "url": "https://github.com/elastic/apm-agent-java/commit/68f3251b429c46e96749d81ad6fda55a05f9b7b4", "message": "Add licenses for load gen scripts", "committedDate": "2020-10-28T14:36:40Z", "type": "commit"}, {"oid": "96f624ddc39f6dcf8277135b9542859d27fe2861", "url": "https://github.com/elastic/apm-agent-java/commit/96f624ddc39f6dcf8277135b9542859d27fe2861", "message": "Dynamic Java provisioning for load testing", "committedDate": "2020-10-28T16:54:40Z", "type": "commit"}, {"oid": "51ab260a0b19222de673ef6827d7f59be922edb0", "url": "https://github.com/elastic/apm-agent-java/commit/51ab260a0b19222de673ef6827d7f59be922edb0", "message": "Script for dynamic Java provisioning for load testing", "committedDate": "2020-10-28T16:54:59Z", "type": "commit"}, {"oid": "7c6f52f36c242b3fc29dab073c1fcbf9d10700d4", "url": "https://github.com/elastic/apm-agent-java/commit/7c6f52f36c242b3fc29dab073c1fcbf9d10700d4", "message": "Fix terrible bug with JDK selection and add more JDKs", "committedDate": "2020-10-29T13:53:21Z", "type": "commit"}, {"oid": "8e7cf645fa2b7bee854abd0b73ac1d93ea6b93db", "url": "https://github.com/elastic/apm-agent-java/commit/8e7cf645fa2b7bee854abd0b73ac1d93ea6b93db", "message": "Remove TODO", "committedDate": "2020-10-29T13:54:20Z", "type": "commit"}, {"oid": "7f4b66d28b010a4e11a4e3dc31d9a9c1e5efc1a0", "url": "https://github.com/elastic/apm-agent-java/commit/7f4b66d28b010a4e11a4e3dc31d9a9c1e5efc1a0", "message": "Formatting and lint", "committedDate": "2020-10-29T15:25:51Z", "type": "commit"}, {"oid": "148cb63588b480a97c56cf8a4099c53a1d58ee03", "url": "https://github.com/elastic/apm-agent-java/commit/148cb63588b480a97c56cf8a4099c53a1d58ee03", "message": "Add agent_config param", "committedDate": "2020-10-30T07:20:40Z", "type": "commit"}, {"oid": "90dd8f6203656ae3d93ce3600c94a5047b63de90", "url": "https://github.com/elastic/apm-agent-java/commit/90dd8f6203656ae3d93ce3600c94a5047b63de90", "message": "Add min JDK version and custom config option", "committedDate": "2020-10-30T08:49:33Z", "type": "commit"}, {"oid": "288e566f850cb80a83c8895ab5c001221e4ff36c", "url": "https://github.com/elastic/apm-agent-java/commit/288e566f850cb80a83c8895ab5c001221e4ff36c", "message": "Allow concurrent users setting", "committedDate": "2020-10-30T08:54:02Z", "type": "commit"}, {"oid": "6898351e5951db441aa33ea1f263dc884e55ac42", "url": "https://github.com/elastic/apm-agent-java/commit/6898351e5951db441aa33ea1f263dc884e55ac42", "message": "Disable num_of_runs in rev1", "committedDate": "2020-10-30T09:03:26Z", "type": "commit"}, {"oid": "049d33a2bc437f4791aaf93ada6b76e370b15cf0", "url": "https://github.com/elastic/apm-agent-java/commit/049d33a2bc437f4791aaf93ada6b76e370b15cf0", "message": "Use production orchestrator", "committedDate": "2020-10-30T09:04:58Z", "type": "commit"}, {"oid": "72a80395175e74684ff9afc102a9ffa03a1d02ec", "url": "https://github.com/elastic/apm-agent-java/commit/72a80395175e74684ff9afc102a9ffa03a1d02ec", "message": "More documentation and minor changes", "committedDate": "2020-10-30T10:55:49Z", "type": "commit"}, {"oid": "64643e6ad8d716ca9519e46df8c378c6cb4b7c91", "url": "https://github.com/elastic/apm-agent-java/commit/64643e6ad8d716ca9519e46df8c378c6cb4b7c91", "message": "Add bare-metal settings", "committedDate": "2020-10-30T13:48:59Z", "type": "commit"}, {"oid": "f080229fcad79d4efbfeb42663d4d8053d210e09", "url": "https://github.com/elastic/apm-agent-java/commit/f080229fcad79d4efbfeb42663d4d8053d210e09", "message": "Prep for production", "committedDate": "2020-11-02T11:26:35Z", "type": "commit"}, {"oid": "eed86f78167cdb5a2881dac76a882258a26ef4d9", "url": "https://github.com/elastic/apm-agent-java/commit/eed86f78167cdb5a2881dac76a882258a26ef4d9", "message": "Add metal tag", "committedDate": "2020-11-02T11:29:09Z", "type": "commit"}, {"oid": "7de00455e17722e56ae5b7bf3bde861fff7572c8", "url": "https://github.com/elastic/apm-agent-java/commit/7de00455e17722e56ae5b7bf3bde861fff7572c8", "message": "Add metrics collection", "committedDate": "2020-11-02T14:28:28Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA0MTczNg==", "url": "https://github.com/elastic/apm-agent-java/pull/1467#discussion_r516041736", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            While the orchestration layer is currently relatively lightweight and simple, it is built to be able to easily extended for more sophisticated needs, such as multiple test runs inside a single test exuection.\n          \n          \n            \n            While the orchestration layer is currently relatively lightweight and simple, it is built to be able to be easily extended for more sophisticated needs, such as multiple test runs inside a single test execution.", "author": "mdelapenya", "createdAt": "2020-11-02T15:15:47Z", "path": ".ci/load/README.md", "diffHunk": "@@ -0,0 +1,61 @@\n+# APM Java Agent Load Geneator\n+\n+This directory contains configuration files for load-testing the APM Java Agent.\n+\n+## Load Tests\n+\n+Load tests are run using two bare-metal workers. One worker is dedicated to the role of load generation, which other worker is dedicated to the role of hosting the application under test, which is instrumented by the APM Java Agent.\n+\n+Load generation is performed using [Locust](https://locust.io/) and the application which is instrumented by the APM Java Agent and placed under load is [Spring Petclinic](https://projects.spring.io/spring-petclinic/).\n+\n+## Orchestration\n+\n+Because of the nature of these tests, they require the use of a dedicated orchestration layer. For this project, that orchestrator is called Bandstand. It is an internal project to Elastic.\n+\n+Bandstand performs two primary functions.\n+\n+1. *Service discovery* The pipeline utilizes a load-generation machine and an application server which run in parallel to each other. These machines need to know how to find each other and Bandstand gives them that information.\n+2. *Orchestration* We need to have a system which tells various services when to start an stop based on the state of other services. For example, we can't start load-generation until we are assured that the application is up and in a coherent state. By using an independent orchestrator, we can allow each service to report on its own state. This avoid a number of otherwise difficult-to-maintain dependencies between service state through the lifetime of the load generation.\n+\n+While the orchestration layer is currently relatively lightweight and simple, it is built to be able to easily extended for more sophisticated needs, such as multiple test runs inside a single test exuection.", "originalCommit": "7de00455e17722e56ae5b7bf3bde861fff7572c8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA0MjYwMw==", "url": "https://github.com/elastic/apm-agent-java/pull/1467#discussion_r516042603", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            *Caution*: The following requires access to libraries which are internal to Elastic. Do not attempt to follow these instructions of you are an open-source user\n          \n          \n            \n            *Caution*: The following requires access to libraries which are internal to Elastic. Do not attempt to follow these instructions if you are an open-source user", "author": "mdelapenya", "createdAt": "2020-11-02T15:17:00Z", "path": ".ci/load/README.md", "diffHunk": "@@ -0,0 +1,61 @@\n+# APM Java Agent Load Geneator\n+\n+This directory contains configuration files for load-testing the APM Java Agent.\n+\n+## Load Tests\n+\n+Load tests are run using two bare-metal workers. One worker is dedicated to the role of load generation, which other worker is dedicated to the role of hosting the application under test, which is instrumented by the APM Java Agent.\n+\n+Load generation is performed using [Locust](https://locust.io/) and the application which is instrumented by the APM Java Agent and placed under load is [Spring Petclinic](https://projects.spring.io/spring-petclinic/).\n+\n+## Orchestration\n+\n+Because of the nature of these tests, they require the use of a dedicated orchestration layer. For this project, that orchestrator is called Bandstand. It is an internal project to Elastic.\n+\n+Bandstand performs two primary functions.\n+\n+1. *Service discovery* The pipeline utilizes a load-generation machine and an application server which run in parallel to each other. These machines need to know how to find each other and Bandstand gives them that information.\n+2. *Orchestration* We need to have a system which tells various services when to start an stop based on the state of other services. For example, we can't start load-generation until we are assured that the application is up and in a coherent state. By using an independent orchestrator, we can allow each service to report on its own state. This avoid a number of otherwise difficult-to-maintain dependencies between service state through the lifetime of the load generation.\n+\n+While the orchestration layer is currently relatively lightweight and simple, it is built to be able to easily extended for more sophisticated needs, such as multiple test runs inside a single test exuection.\n+\n+The current design uses a persistant orchestator. However, it is a future goal to have a dynamic orchestrator which is unique to each test execution and is spun up and torn down alongside the rest of the services.\n+\n+## Running Load Tests\n+\n+To run a load test, navigate to the [APM Java Agent CI](https://apm-ci.elastic.co/job/apm-agent-java/) and look for the `Load Test` pipeline. Tests can be executed with the following parameters:\n+\n+|Parameter|Description|\n+|:-------:|:---------|\n+|`apm_version`|The version of the APM Java Agent to use. After checking out the agent from source control, this is the git tag that will be used.|\n+|`jvm_version`|The version of the JVM which will be used. This will be used as the version of Java both when building the agent and when launching the application.|\n+|`concurrent_requests`|The number of concurrent, simulated users which will make requests against the test applicaiton.|\n+|`duration`|The duration for the load test. Specify this value using time units: (300s, 20m, 3h, 1h30m, etc.)|\n+|`agent_config`|To override the defaults of the APM Java Agent config, paste a configuration file.|\n+|`locustfile`|A Locust file controls the specifics of how load will be applied to the test application, such as which URLs are requested and at what rate. If this option is not specified, then `.ci/load/scripts/locustfile.py` will be used. For more information on writing a locustfile, [please see the documentation](https://docs.locust.io/en/stable/writing-a-locustfile.html).|\n+\n+\n+After specifying the options, a test run will begin. One can view the progress of the test run by following along in the Jenkins Blue Ocean interface for the given job after it is launched. Typically, it takes several minutes for the machines to be provisioned before tests can begin.\n+\n+## Viewing test results\n+\n+Because the [test application](https://projects.spring.io/spring-petclinic/) is instrumented with [JFR](https://docs.oracle.com/javacomponents/jmc-5-4/jfr-runtime-guide/about.htm#JFRUH170), it is necessary to have a copy of the [JDK Mission Control application](https://www.baeldung.com/java-flight-recorder-monitoring#3-visualize-data) which is distributed with the JDK.\n+\n+The results of the JFR instrumentation are available after a test run is complete by navigating to Jenkins and viewing the job results. A link to `Artifacts` will bring you to a page which shows the files generated by the test run. Download `src/spring-petclinic/flight.jfr` and then view its contents with JDK MIssion Control to examine the moment-by-moment profile of the application under test.\n+\n+To view the load generation output, see the console output in Jenkins for the `Load Generation` step.\n+\n+## Hacking\n+\n+*Caution*: The following requires access to libraries which are internal to Elastic. Do not attempt to follow these instructions of you are an open-source user", "originalCommit": "7de00455e17722e56ae5b7bf3bde861fff7572c8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA0MzE1Mg==", "url": "https://github.com/elastic/apm-agent-java/pull/1467#discussion_r516043152", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            3. In the `apm-pipeline-library` checkout from step 3, create a soft link from `local/jenkins_home` to the your checkout of the `apm-java-agent` codebase.\n          \n          \n            \n            3. In the `apm-pipeline-library` checkout from step 2, create a soft link from `local/jenkins_home` to the your checkout of the `apm-java-agent` codebase.", "author": "mdelapenya", "createdAt": "2020-11-02T15:17:51Z", "path": ".ci/load/README.md", "diffHunk": "@@ -0,0 +1,61 @@\n+# APM Java Agent Load Geneator\n+\n+This directory contains configuration files for load-testing the APM Java Agent.\n+\n+## Load Tests\n+\n+Load tests are run using two bare-metal workers. One worker is dedicated to the role of load generation, which other worker is dedicated to the role of hosting the application under test, which is instrumented by the APM Java Agent.\n+\n+Load generation is performed using [Locust](https://locust.io/) and the application which is instrumented by the APM Java Agent and placed under load is [Spring Petclinic](https://projects.spring.io/spring-petclinic/).\n+\n+## Orchestration\n+\n+Because of the nature of these tests, they require the use of a dedicated orchestration layer. For this project, that orchestrator is called Bandstand. It is an internal project to Elastic.\n+\n+Bandstand performs two primary functions.\n+\n+1. *Service discovery* The pipeline utilizes a load-generation machine and an application server which run in parallel to each other. These machines need to know how to find each other and Bandstand gives them that information.\n+2. *Orchestration* We need to have a system which tells various services when to start an stop based on the state of other services. For example, we can't start load-generation until we are assured that the application is up and in a coherent state. By using an independent orchestrator, we can allow each service to report on its own state. This avoid a number of otherwise difficult-to-maintain dependencies between service state through the lifetime of the load generation.\n+\n+While the orchestration layer is currently relatively lightweight and simple, it is built to be able to easily extended for more sophisticated needs, such as multiple test runs inside a single test exuection.\n+\n+The current design uses a persistant orchestator. However, it is a future goal to have a dynamic orchestrator which is unique to each test execution and is spun up and torn down alongside the rest of the services.\n+\n+## Running Load Tests\n+\n+To run a load test, navigate to the [APM Java Agent CI](https://apm-ci.elastic.co/job/apm-agent-java/) and look for the `Load Test` pipeline. Tests can be executed with the following parameters:\n+\n+|Parameter|Description|\n+|:-------:|:---------|\n+|`apm_version`|The version of the APM Java Agent to use. After checking out the agent from source control, this is the git tag that will be used.|\n+|`jvm_version`|The version of the JVM which will be used. This will be used as the version of Java both when building the agent and when launching the application.|\n+|`concurrent_requests`|The number of concurrent, simulated users which will make requests against the test applicaiton.|\n+|`duration`|The duration for the load test. Specify this value using time units: (300s, 20m, 3h, 1h30m, etc.)|\n+|`agent_config`|To override the defaults of the APM Java Agent config, paste a configuration file.|\n+|`locustfile`|A Locust file controls the specifics of how load will be applied to the test application, such as which URLs are requested and at what rate. If this option is not specified, then `.ci/load/scripts/locustfile.py` will be used. For more information on writing a locustfile, [please see the documentation](https://docs.locust.io/en/stable/writing-a-locustfile.html).|\n+\n+\n+After specifying the options, a test run will begin. One can view the progress of the test run by following along in the Jenkins Blue Ocean interface for the given job after it is launched. Typically, it takes several minutes for the machines to be provisioned before tests can begin.\n+\n+## Viewing test results\n+\n+Because the [test application](https://projects.spring.io/spring-petclinic/) is instrumented with [JFR](https://docs.oracle.com/javacomponents/jmc-5-4/jfr-runtime-guide/about.htm#JFRUH170), it is necessary to have a copy of the [JDK Mission Control application](https://www.baeldung.com/java-flight-recorder-monitoring#3-visualize-data) which is distributed with the JDK.\n+\n+The results of the JFR instrumentation are available after a test run is complete by navigating to Jenkins and viewing the job results. A link to `Artifacts` will bring you to a page which shows the files generated by the test run. Download `src/spring-petclinic/flight.jfr` and then view its contents with JDK MIssion Control to examine the moment-by-moment profile of the application under test.\n+\n+To view the load generation output, see the console output in Jenkins for the `Load Generation` step.\n+\n+## Hacking\n+\n+*Caution*: The following requires access to libraries which are internal to Elastic. Do not attempt to follow these instructions of you are an open-source user\n+of the APM Java Agent. Instead, contact the core development team with questions.\n+\n+To set up a local development environment for executing load tests and for developing the test framework, perform the following steps:\n+\n+1. Checkout the Bandstand application and build a docker container from it tagged as `bandstand`.\n+2. Checkout the [fork of the APM Pipeline library](https://github.com/cachedout/apm-pipeline-library-1/tree/perf) which contains the necessary modifications to provision a load-testing environment locally.\n+3. In the `apm-pipeline-library` checkout from step 3, create a soft link from `local/jenkins_home` to the your checkout of the `apm-java-agent` codebase.", "originalCommit": "7de00455e17722e56ae5b7bf3bde861fff7572c8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "4d9aa1bf286bb15613ed1d6f3c7eb4d0a46cf265", "url": "https://github.com/elastic/apm-agent-java/commit/4d9aa1bf286bb15613ed1d6f3c7eb4d0a46cf265", "message": "Update .ci/load/README.md\n\nCo-authored-by: Manuel de la Pe\u00f1a <social.mdelapenya@gmail.com>", "committedDate": "2020-11-02T15:28:46Z", "type": "commit"}, {"oid": "500f89bf7fc09a3bd5246df0db10516e40f917b0", "url": "https://github.com/elastic/apm-agent-java/commit/500f89bf7fc09a3bd5246df0db10516e40f917b0", "message": "Update .ci/load/README.md\n\nCo-authored-by: Manuel de la Pe\u00f1a <social.mdelapenya@gmail.com>", "committedDate": "2020-11-02T15:28:54Z", "type": "commit"}, {"oid": "61f9670e850341146dde2dd92350623caf2527da", "url": "https://github.com/elastic/apm-agent-java/commit/61f9670e850341146dde2dd92350623caf2527da", "message": "Update .ci/load/README.md\n\nCo-authored-by: Manuel de la Pe\u00f1a <social.mdelapenya@gmail.com>", "committedDate": "2020-11-02T15:29:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA0NDM5MA==", "url": "https://github.com/elastic/apm-agent-java/pull/1467#discussion_r516044390", "bodyText": "We'll also need to test against Java 7 and 8. Does Spring PetClinic event support such old versions?", "author": "felixbarny", "createdAt": "2020-11-02T15:19:34Z", "path": ".ci/load/scripts/param_gen/gen_params.py", "diffHunk": "@@ -0,0 +1,126 @@\n+#!/usr/bin/env python\n+\n+# Licensed to Elasticsearch B.V. under one or more contributor\n+# license agreements. See the NOTICE file distributed with\n+# this work for additional information regarding copyright\n+# ownership. Elasticsearch B.V. licenses this file to you under\n+# the Apache License, Version 2.0 (the \"License\"); you may\n+# not use this file except in compliance with the License.\n+# You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing,\n+# software distributed under the License is distributed on an\n+# \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+# KIND, either express or implied.  See the License for the\n+# specific language governing permissions and limitations\n+# under the License.\n+\n+\"\"\"\n+Description:\n+\n+This is an ad-hoc script used to generate the drop-down selections\n+for the Jenkinsfile to allow users to test against various combinations\n+of JDKs available in the Elastic JVM catalog which is hosted at:\n+https://jvm-catalog.elastic.co.\n+\n+It dymamically generates a list of available JDKs and of APM Java Agent\n+releases. These are returns as a snippet of code which can then be pasted\n+directly into a Jenkinsfile. Below is an example of the kind of output\n+produced by this script:\n+\n+    parameters {\n+    string(name: 'agent_version', defaultValue: 'v1.9.0', description: 'Version of agent. Should correspond to tag, e.g. `v1.9.0`.')\n+    string(name: 'jvm_version', defaultValue: '9.0.4', description: 'Version of JVM.')\n+    string(name: 'concurrent_requests', defaultValue: '100', description: 'The number of concurrent requests to test with.')\n+    string(name: 'duration', defaultValue: '10', description: 'Test duration in minutes. Max: 280')\n+    string(name: 'num_of_runs', defaultValue: '1', description: 'Number of test runs to execute.')\n+    }\n+\n+Author: Mike Place <mike.place@elastic.co>\n+\n+Maintainers: Observability Developer Productivity\n+<observability-robots@elastic.co>\n+\"\"\"\n+\n+import requests\n+import argparse\n+import github\n+from packaging.version import parse as parse_version\n+\n+CATALOG_URL = 'https://jvm-catalog.elastic.co'\n+SUPPORTED_JDKS = ['oracle', 'openjdk', 'adoptopenjdk', 'amazon', 'jdk', 'zulu']\n+MIN_JDK_VERSION = '11'", "originalCommit": "7de00455e17722e56ae5b7bf3bde861fff7572c8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA2NjA5MA==", "url": "https://github.com/elastic/apm-agent-java/pull/1467#discussion_r516066090", "bodyText": "Good question. I might need a little help from your team to make this determination. I see Java 8 referenced here, though: https://github.com/spring-projects/spring-petclinic#prerequisites", "author": "cachedout", "createdAt": "2020-11-02T15:48:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA0NDM5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ2NDE4Nw==", "url": "https://github.com/elastic/apm-agent-java/pull/1467#discussion_r516464187", "bodyText": "@felixbarny Also, with this, we are allowed only 250 entries in a drop-down list. If I set this down to 7 as the minimum, we're just over the limit. I could potentially refactor this to try and work around this but before I do, I should ask if there are any of these flavors you clearly won't be needing?", "author": "cachedout", "createdAt": "2020-11-03T07:23:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA0NDM5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjUxNjc0Mg==", "url": "https://github.com/elastic/apm-agent-java/pull/1467#discussion_r516516742", "bodyText": "Does removing 'amazon' from SUPPORTED_JDKS bring us under the limit? If not, also exclude 'jdk'.", "author": "felixbarny", "createdAt": "2020-11-03T09:12:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA0NDM5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjU2NDMxNQ==", "url": "https://github.com/elastic/apm-agent-java/pull/1467#discussion_r516564315", "bodyText": "@felixbarny Hrm. Sadly, removing both amazon and jdk only gets us to 266. If we just took the most recent patch release of any minor would that be sufficient for you or do you need that level of granularity?", "author": "cachedout", "createdAt": "2020-11-03T10:29:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA0NDM5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjU3NDk0Mw==", "url": "https://github.com/elastic/apm-agent-java/pull/1467#discussion_r516574943", "bodyText": "Unfortunately, we do need that level of granularity so that we can try to reproduce specific issues such as JVM crashes. It also helps us to bisect the JVM update version where a particular JVM bug has been fixed that causes issues in combination with the APM agent.\nAnother possibility would be to just list the Zulu builds, as they seem to offer the most exhaustive list of update versions, and to add a plain-text input for things other than Zulu.\nOr we could add different dropdowns for each vendor. By default, no JDK would be selected. If more than one checkbox has a non-default value, or if all have a non-default value we can consider that an input error.", "author": "felixbarny", "createdAt": "2020-11-03T10:46:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA0NDM5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjU3NzU3Mw==", "url": "https://github.com/elastic/apm-agent-java/pull/1467#discussion_r516577573", "bodyText": "Sounds good. Let me play with some options and see what I can come up with.", "author": "cachedout", "createdAt": "2020-11-03T10:50:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA0NDM5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA0MzQ4Mg==", "url": "https://github.com/elastic/apm-agent-java/pull/1467#discussion_r518043482", "bodyText": "There were some duplicates in the list that I removed. We're good now. \ud83d\udc4d", "author": "cachedout", "createdAt": "2020-11-05T13:19:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA0NDM5MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA0NjQzMQ==", "url": "https://github.com/elastic/apm-agent-java/pull/1467#discussion_r516046431", "bodyText": "Can we make it executing requests at a fixed rate in order to avoid coordinated omission problems?", "author": "felixbarny", "createdAt": "2020-11-02T15:22:25Z", "path": ".ci/load/scripts/locustfile.py", "diffHunk": "@@ -0,0 +1,13 @@\n+from locust import HttpUser, task, between\n+\n+\n+class QuickstartUser(HttpUser):\n+    wait_time = between(1, 2)", "originalCommit": "7de00455e17722e56ae5b7bf3bde861fff7572c8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA2Mzc3MQ==", "url": "https://github.com/elastic/apm-agent-java/pull/1467#discussion_r516063771", "bodyText": "Most certainly! I will make a change to the PR to modify the defaults.\n(Note that this pipeline also supports passing in your own Locust configuration file so you can design a test however you see fit. Obviously, I started with something super-basic but I'm thinking that we could also design \"scenarios\" which pre-package various load test configurations as well, but that's more of a long-term roadmap item.)", "author": "cachedout", "createdAt": "2020-11-02T15:45:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA0NjQzMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjUyNDk2Ng==", "url": "https://github.com/elastic/apm-agent-java/pull/1467#discussion_r516524966", "bodyText": "Updated. Some additional reading on this for folks who might be interested:\nlocustio/locust#646\nlocustio/locust#1118\nDown the road, there's no reason we couldn't explore supporting different types of load-generation tools if we really wanted to, but IMHO we should see how far this one gets us for the time being. I'm open to swapping it out if it doesn't meet our needs, though.", "author": "cachedout", "createdAt": "2020-11-03T09:26:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA0NjQzMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA1MDQ4Ng==", "url": "https://github.com/elastic/apm-agent-java/pull/1467#discussion_r516050486", "bodyText": "Is it possible to view the Locust results? If so, how?", "author": "felixbarny", "createdAt": "2020-11-02T15:27:55Z", "path": ".ci/load/README.md", "diffHunk": "@@ -0,0 +1,61 @@\n+# APM Java Agent Load Geneator\n+\n+This directory contains configuration files for load-testing the APM Java Agent.\n+\n+## Load Tests\n+\n+Load tests are run using two bare-metal workers. One worker is dedicated to the role of load generation, which other worker is dedicated to the role of hosting the application under test, which is instrumented by the APM Java Agent.\n+\n+Load generation is performed using [Locust](https://locust.io/) and the application which is instrumented by the APM Java Agent and placed under load is [Spring Petclinic](https://projects.spring.io/spring-petclinic/).", "originalCommit": "7de00455e17722e56ae5b7bf3bde861fff7572c8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA2MTkwNg==", "url": "https://github.com/elastic/apm-agent-java/pull/1467#discussion_r516061906", "bodyText": "Yes. It's not super-clean because you have to basically just navigate to the Blue Ocean UI in Jenkins and then scroll to the end of the console log for the load generation step, but the output is there. It will look like this:\n\nI would like to find a way to present this as an artifact of the test results so it can be easily downloaded but I just made this a future TODO. Let me know if you'd like me to prioritize improving this experience because it's definitely possible.", "author": "cachedout", "createdAt": "2020-11-02T15:43:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA1MDQ4Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA3MTExOQ==", "url": "https://github.com/elastic/apm-agent-java/pull/1467#discussion_r516071119", "bodyText": "sounds like the right tradeoff for an MVP", "author": "felixbarny", "createdAt": "2020-11-02T15:55:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA1MDQ4Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA5NTYxMw==", "url": "https://github.com/elastic/apm-agent-java/pull/1467#discussion_r516095613", "bodyText": "OMG!", "author": "v1v", "createdAt": "2020-11-02T16:30:17Z", "path": ".ci/load/Jenkinsfile", "diffHunk": "@@ -0,0 +1,179 @@\n+// For documentation on this pipeline, please see the README.md in this directory\n+pipeline {\n+    agent any\n+    environment {\n+        REPO = 'apm-agent-java'\n+        APP = 'spring-petclinic'\n+        APP_BASE_DIR = \"src/${APP}\"\n+        METRICS_BASE_DIR=\"metrics/\"\n+        AGENT_BASE_DIR = \"agent/\"\n+        ORCH_URL = 'obs-load-orch.app.elastic.co:8000'\n+        // Set below for local development\n+        // ORCH_URL='10.0.2.2:8000'\n+        DEBUG_MODE = '0' // set to '0' for production\n+        // This is a placeholder server. This will change to a dummy APM Server when it is available.\n+        APM_SERVER_URL = 'https://2a2bd0e2806a47e5996eeeec6d22e6df.apm.eu-west-3.aws.elastic-cloud.com:443'\n+\n+    }\n+    options {\n+        timeout(time: 3, unit: 'HOURS')\n+        buildDiscarder(logRotator(numToKeepStr: '20', artifactNumToKeepStr: '20', daysToKeepStr: '30'))\n+        timestamps()\n+        ansiColor('xterm')\n+        durabilityHint('PERFORMANCE_OPTIMIZED')\n+\n+    }\n+    parameters {\n+        // The following snippet is auto-generated. To update it, run the script located in .ci/load/scripts/param_gen and copy in the output\n+        choice(choices: ['1.18.1', '1.18.0', '1.18.0.RC1', '1.17.0', '1.16.0', '1.15.0', '1.14.0', '1.13.0', '1.12.0', '1.11.0', '1.10.0', '1.9.0', '1.8.0', '1.7.0', '1.6.1', '1.6.0', '1.5.0', '1.4.0', '1.3.0', '1.2.0', '1.1.0', '1.0.1', '1.0.0', '1.0.0.RC1', '0.7.1', '0.7.0', '0.6.2', '0.6.1', '0.6.0', '0.5.1', '0.1.2', '0.1.1'], name: \"apm_version\", description: \"APM Java Agent version\")\n+        choice(choices: ['adoptopenjdk-11+28-linux', 'adoptopenjdk-11.0.1+13-linux', 'adoptopenjdk-11.0.1+13-linux-aarch64', 'adoptopenjdk-11.0.2+7-linux', 'adoptopenjdk-11.0.2+7-linux-aarch64', 'adoptopenjdk-11.0.2+9-linux', 'adoptopenjdk-11.0.2+9-linux-aarch64', 'adoptopenjdk-11.0.3+7-linux', 'adoptopenjdk-11.0.3+7-linux-aarch64', 'adoptopenjdk-11.0.4+11-linux', 'adoptopenjdk-11.0.4+11-linux-aarch64', 'adoptopenjdk-11.0.5+10-linux', 'adoptopenjdk-11.0.6+10-linux', 'adoptopenjdk-11.0.6+10-linux-aarch64', 'adoptopenjdk-11.0.7+10-linux', 'adoptopenjdk-11.0.7+10-linux-aarch64', 'adoptopenjdk-11.0.8+10-linux', 'adoptopenjdk-11.0.8+10-linux-aarch64', 'adoptopenjdk-11.0.9+11-linux', 'adoptopenjdk-11.0.9+11-linux-aarch64', 'adoptopenjdk-12+33-linux', 'adoptopenjdk-12.0.1+12-linux', 'adoptopenjdk-12.0.1+12-linux-aarch64', 'adoptopenjdk-12.0.2+10-linux', 'adoptopenjdk-12.0.2+10-linux-aarch64', 'adoptopenjdk-13.0.1+9-linux', 'adoptopenjdk-13.0.2+8-linux', 'adoptopenjdk-13.0.2+8-linux-aarch64', 'adoptopenjdk-14.0.1+7-linux', 'adoptopenjdk-14.0.1+7-linux-aarch64', 'adoptopenjdk-14.0.2+12-linux', 'adoptopenjdk-14.0.2+12-linux-aarch64', 'adoptopenjdk-15+36-linux', 'adoptopenjdk-15+36-linux-aarch64', 'adoptopenjdk-15.0.1+9-linux', 'adoptopenjdk-15.0.1+9-linux-aarch64', 'openjdk-11+11-linux', 'openjdk-11+12-linux', 'openjdk-11+13-linux', 'openjdk-11+14-linux', 'openjdk-11+15-linux', 'openjdk-11+16-linux', 'openjdk-11+17-linux', 'openjdk-11+18-linux', 'openjdk-11+19-linux', 'openjdk-11+20-linux', 'openjdk-11+21-linux', 'openjdk-11+22-linux', 'openjdk-11+23-linux', 'openjdk-11+24-linux', 'openjdk-11+25-linux', 'openjdk-11+26-linux', 'openjdk-11+27-linux', 'openjdk-11+28-linux', 'openjdk-11+5-linux', 'openjdk-11-linux', 'openjdk-11.0.1-linux', 'openjdk-11.0.2-linux', 'openjdk-12+23-linux', 'openjdk-12+24-linux', 'openjdk-12+25-linux', 'openjdk-12+27-linux', 'openjdk-12+28-linux', 'openjdk-12+29-linux', 'openjdk-12+30-linux', 'openjdk-12+31-linux', 'openjdk-12+32-linux', 'openjdk-12+33-linux', 'openjdk-12-linux', 'openjdk-12.0.1-linux', 'openjdk-12.0.2-linux', 'openjdk-13+14-linux', 'openjdk-13+15-linux', 'openjdk-13+16-linux', 'openjdk-13+17-linux', 'openjdk-13+18-linux', 'openjdk-13+19-linux', 'openjdk-13+20-linux', 'openjdk-13+21-linux', 'openjdk-13+22-linux', 'openjdk-13+23-linux', 'openjdk-13+24-linux', 'openjdk-13+25-linux', 'openjdk-13+26-linux', 'openjdk-13+27-linux', 'openjdk-13+28-linux', 'openjdk-13+29-linux', 'openjdk-13+30-linux', 'openjdk-13+31-linux', 'openjdk-13+32-linux', 'openjdk-13-linux', 'openjdk-13.0.1-linux', 'openjdk-13.0.2-linux', 'openjdk-14+10-linux', 'openjdk-14+11-linux', 'openjdk-14+12-linux', 'openjdk-14+13-linux', 'openjdk-14+14-linux', 'openjdk-14+15-linux', 'openjdk-14+16-linux', 'openjdk-14+17-linux', 'openjdk-14+25-linux', 'openjdk-14+26-linux', 'openjdk-14+27-linux', 'openjdk-14+28-linux', 'openjdk-14+30-linux', 'openjdk-14+31-linux', 'openjdk-14+32-linux', 'openjdk-14+33-linux', 'openjdk-14+34-linux', 'openjdk-14+9-linux', 'openjdk-14-linux', 'openjdk-14.0.1-linux', 'openjdk-14.0.2+12-linux', 'openjdk-14.0.2-linux', 'openjdk-15+10-linux', 'openjdk-15+11-linux', 'openjdk-15+12-linux', 'openjdk-15+13-linux', 'openjdk-15+14-linux', 'openjdk-15+15-linux', 'openjdk-15+16-linux', 'openjdk-15+17-linux', 'openjdk-15+18-linux', 'openjdk-15+19-linux', 'openjdk-15+20-linux', 'openjdk-15+21-linux', 'openjdk-15+22-linux', 'openjdk-15+23-linux', 'openjdk-15+24-linux', 'openjdk-15+25-linux', 'openjdk-15+26-linux', 'openjdk-15+27-linux', 'openjdk-15+28-linux', 'openjdk-15+29-linux', 'openjdk-15+30-linux', 'openjdk-15+31-linux', 'openjdk-15+32-linux', 'openjdk-15+33-linux', 'openjdk-15+34-linux', 'openjdk-15+36-linux', 'openjdk-15+4-linux', 'openjdk-15+5-linux', 'openjdk-15+6-linux', 'openjdk-15+7-linux', 'openjdk-15+8-linux', 'openjdk-15+9-linux', 'openjdk-15-linux', 'openjdk-15.0.1+9-linux', 'oracle-11+11-linux', 'oracle-11+12-linux', 'oracle-11+13-linux', 'oracle-11+14-linux', 'oracle-11+15-linux', 'oracle-11+16-linux', 'oracle-11+17-linux', 'oracle-11+18-linux', 'oracle-11+19-linux', 'oracle-11+20-linux', 'oracle-11+21-linux', 'oracle-11+22-linux', 'oracle-11+23-linux', 'oracle-11+24-linux', 'oracle-11+25-linux', 'oracle-11+26-linux', 'oracle-11+27-linux', 'oracle-11+28-linux', 'oracle-11+5-linux', 'oracle-11.0.2+7-linux', 'oracle-11.0.2+9-linux', 'oracle-11.0.3+12-linux', 'oracle-11.0.4+10-linux', 'oracle-11.0.5+10-linux', 'oracle-11.0.6+8-linux', 'oracle-12+33-linux', 'oracle-12.0.1+12-linux', 'oracle-12.0.2+10-linux', 'oracle-13+33-linux', 'oracle-13.0.1+9-linux', 'oracle-13.0.2+8-linux', 'zulu-11.0.1-linux', 'zulu-11.0.2-linux', 'zulu-11.0.3-linux', 'zulu-11.0.4-linux', 'zulu-11.0.5-linux', 'zulu-11.0.6-linux', 'zulu-11.0.7-linux', 'zulu-11.0.8-linux', 'zulu-11.0.9-linux', 'zulu-12-linux', 'zulu-12.0.0-linux', 'zulu-12.0.1-linux', 'zulu-12.0.2-linux', 'zulu-13-linux', 'zulu-13.0.0-linux', 'zulu-13.0.1-linux', 'zulu-13.0.2-linux', 'zulu-13.0.3-linux', 'zulu-13.0.4-linux', 'zulu-13.0.5-linux', 'zulu-14-linux', 'zulu-14.0.0-linux', 'zulu-14.0.1-linux', 'zulu-14.0.2-linux', 'zulu-15.0.0-linux', 'zulu-15.0.1-linux'], name: \"jvm_version\", description: \"JVM\")", "originalCommit": "61f9670e850341146dde2dd92350623caf2527da", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjEwNzMxMw==", "url": "https://github.com/elastic/apm-agent-java/pull/1467#discussion_r516107313", "bodyText": "Hah! These are auto-generated via magic! See here.", "author": "cachedout", "createdAt": "2020-11-02T16:46:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA5NTYxMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA5NjA5MA==", "url": "https://github.com/elastic/apm-agent-java/pull/1467#discussion_r516096090", "bodyText": "You can set them in the top-level environment closure", "author": "v1v", "createdAt": "2020-11-02T16:30:54Z", "path": ".ci/load/Jenkinsfile", "diffHunk": "@@ -0,0 +1,179 @@\n+// For documentation on this pipeline, please see the README.md in this directory\n+pipeline {\n+    agent any\n+    environment {\n+        REPO = 'apm-agent-java'\n+        APP = 'spring-petclinic'\n+        APP_BASE_DIR = \"src/${APP}\"\n+        METRICS_BASE_DIR=\"metrics/\"\n+        AGENT_BASE_DIR = \"agent/\"\n+        ORCH_URL = 'obs-load-orch.app.elastic.co:8000'\n+        // Set below for local development\n+        // ORCH_URL='10.0.2.2:8000'\n+        DEBUG_MODE = '0' // set to '0' for production\n+        // This is a placeholder server. This will change to a dummy APM Server when it is available.\n+        APM_SERVER_URL = 'https://2a2bd0e2806a47e5996eeeec6d22e6df.apm.eu-west-3.aws.elastic-cloud.com:443'\n+\n+    }\n+    options {\n+        timeout(time: 3, unit: 'HOURS')\n+        buildDiscarder(logRotator(numToKeepStr: '20', artifactNumToKeepStr: '20', daysToKeepStr: '30'))\n+        timestamps()\n+        ansiColor('xterm')\n+        durabilityHint('PERFORMANCE_OPTIMIZED')\n+\n+    }\n+    parameters {\n+        // The following snippet is auto-generated. To update it, run the script located in .ci/load/scripts/param_gen and copy in the output\n+        choice(choices: ['1.18.1', '1.18.0', '1.18.0.RC1', '1.17.0', '1.16.0', '1.15.0', '1.14.0', '1.13.0', '1.12.0', '1.11.0', '1.10.0', '1.9.0', '1.8.0', '1.7.0', '1.6.1', '1.6.0', '1.5.0', '1.4.0', '1.3.0', '1.2.0', '1.1.0', '1.0.1', '1.0.0', '1.0.0.RC1', '0.7.1', '0.7.0', '0.6.2', '0.6.1', '0.6.0', '0.5.1', '0.1.2', '0.1.1'], name: \"apm_version\", description: \"APM Java Agent version\")\n+        choice(choices: ['adoptopenjdk-11+28-linux', 'adoptopenjdk-11.0.1+13-linux', 'adoptopenjdk-11.0.1+13-linux-aarch64', 'adoptopenjdk-11.0.2+7-linux', 'adoptopenjdk-11.0.2+7-linux-aarch64', 'adoptopenjdk-11.0.2+9-linux', 'adoptopenjdk-11.0.2+9-linux-aarch64', 'adoptopenjdk-11.0.3+7-linux', 'adoptopenjdk-11.0.3+7-linux-aarch64', 'adoptopenjdk-11.0.4+11-linux', 'adoptopenjdk-11.0.4+11-linux-aarch64', 'adoptopenjdk-11.0.5+10-linux', 'adoptopenjdk-11.0.6+10-linux', 'adoptopenjdk-11.0.6+10-linux-aarch64', 'adoptopenjdk-11.0.7+10-linux', 'adoptopenjdk-11.0.7+10-linux-aarch64', 'adoptopenjdk-11.0.8+10-linux', 'adoptopenjdk-11.0.8+10-linux-aarch64', 'adoptopenjdk-11.0.9+11-linux', 'adoptopenjdk-11.0.9+11-linux-aarch64', 'adoptopenjdk-12+33-linux', 'adoptopenjdk-12.0.1+12-linux', 'adoptopenjdk-12.0.1+12-linux-aarch64', 'adoptopenjdk-12.0.2+10-linux', 'adoptopenjdk-12.0.2+10-linux-aarch64', 'adoptopenjdk-13.0.1+9-linux', 'adoptopenjdk-13.0.2+8-linux', 'adoptopenjdk-13.0.2+8-linux-aarch64', 'adoptopenjdk-14.0.1+7-linux', 'adoptopenjdk-14.0.1+7-linux-aarch64', 'adoptopenjdk-14.0.2+12-linux', 'adoptopenjdk-14.0.2+12-linux-aarch64', 'adoptopenjdk-15+36-linux', 'adoptopenjdk-15+36-linux-aarch64', 'adoptopenjdk-15.0.1+9-linux', 'adoptopenjdk-15.0.1+9-linux-aarch64', 'openjdk-11+11-linux', 'openjdk-11+12-linux', 'openjdk-11+13-linux', 'openjdk-11+14-linux', 'openjdk-11+15-linux', 'openjdk-11+16-linux', 'openjdk-11+17-linux', 'openjdk-11+18-linux', 'openjdk-11+19-linux', 'openjdk-11+20-linux', 'openjdk-11+21-linux', 'openjdk-11+22-linux', 'openjdk-11+23-linux', 'openjdk-11+24-linux', 'openjdk-11+25-linux', 'openjdk-11+26-linux', 'openjdk-11+27-linux', 'openjdk-11+28-linux', 'openjdk-11+5-linux', 'openjdk-11-linux', 'openjdk-11.0.1-linux', 'openjdk-11.0.2-linux', 'openjdk-12+23-linux', 'openjdk-12+24-linux', 'openjdk-12+25-linux', 'openjdk-12+27-linux', 'openjdk-12+28-linux', 'openjdk-12+29-linux', 'openjdk-12+30-linux', 'openjdk-12+31-linux', 'openjdk-12+32-linux', 'openjdk-12+33-linux', 'openjdk-12-linux', 'openjdk-12.0.1-linux', 'openjdk-12.0.2-linux', 'openjdk-13+14-linux', 'openjdk-13+15-linux', 'openjdk-13+16-linux', 'openjdk-13+17-linux', 'openjdk-13+18-linux', 'openjdk-13+19-linux', 'openjdk-13+20-linux', 'openjdk-13+21-linux', 'openjdk-13+22-linux', 'openjdk-13+23-linux', 'openjdk-13+24-linux', 'openjdk-13+25-linux', 'openjdk-13+26-linux', 'openjdk-13+27-linux', 'openjdk-13+28-linux', 'openjdk-13+29-linux', 'openjdk-13+30-linux', 'openjdk-13+31-linux', 'openjdk-13+32-linux', 'openjdk-13-linux', 'openjdk-13.0.1-linux', 'openjdk-13.0.2-linux', 'openjdk-14+10-linux', 'openjdk-14+11-linux', 'openjdk-14+12-linux', 'openjdk-14+13-linux', 'openjdk-14+14-linux', 'openjdk-14+15-linux', 'openjdk-14+16-linux', 'openjdk-14+17-linux', 'openjdk-14+25-linux', 'openjdk-14+26-linux', 'openjdk-14+27-linux', 'openjdk-14+28-linux', 'openjdk-14+30-linux', 'openjdk-14+31-linux', 'openjdk-14+32-linux', 'openjdk-14+33-linux', 'openjdk-14+34-linux', 'openjdk-14+9-linux', 'openjdk-14-linux', 'openjdk-14.0.1-linux', 'openjdk-14.0.2+12-linux', 'openjdk-14.0.2-linux', 'openjdk-15+10-linux', 'openjdk-15+11-linux', 'openjdk-15+12-linux', 'openjdk-15+13-linux', 'openjdk-15+14-linux', 'openjdk-15+15-linux', 'openjdk-15+16-linux', 'openjdk-15+17-linux', 'openjdk-15+18-linux', 'openjdk-15+19-linux', 'openjdk-15+20-linux', 'openjdk-15+21-linux', 'openjdk-15+22-linux', 'openjdk-15+23-linux', 'openjdk-15+24-linux', 'openjdk-15+25-linux', 'openjdk-15+26-linux', 'openjdk-15+27-linux', 'openjdk-15+28-linux', 'openjdk-15+29-linux', 'openjdk-15+30-linux', 'openjdk-15+31-linux', 'openjdk-15+32-linux', 'openjdk-15+33-linux', 'openjdk-15+34-linux', 'openjdk-15+36-linux', 'openjdk-15+4-linux', 'openjdk-15+5-linux', 'openjdk-15+6-linux', 'openjdk-15+7-linux', 'openjdk-15+8-linux', 'openjdk-15+9-linux', 'openjdk-15-linux', 'openjdk-15.0.1+9-linux', 'oracle-11+11-linux', 'oracle-11+12-linux', 'oracle-11+13-linux', 'oracle-11+14-linux', 'oracle-11+15-linux', 'oracle-11+16-linux', 'oracle-11+17-linux', 'oracle-11+18-linux', 'oracle-11+19-linux', 'oracle-11+20-linux', 'oracle-11+21-linux', 'oracle-11+22-linux', 'oracle-11+23-linux', 'oracle-11+24-linux', 'oracle-11+25-linux', 'oracle-11+26-linux', 'oracle-11+27-linux', 'oracle-11+28-linux', 'oracle-11+5-linux', 'oracle-11.0.2+7-linux', 'oracle-11.0.2+9-linux', 'oracle-11.0.3+12-linux', 'oracle-11.0.4+10-linux', 'oracle-11.0.5+10-linux', 'oracle-11.0.6+8-linux', 'oracle-12+33-linux', 'oracle-12.0.1+12-linux', 'oracle-12.0.2+10-linux', 'oracle-13+33-linux', 'oracle-13.0.1+9-linux', 'oracle-13.0.2+8-linux', 'zulu-11.0.1-linux', 'zulu-11.0.2-linux', 'zulu-11.0.3-linux', 'zulu-11.0.4-linux', 'zulu-11.0.5-linux', 'zulu-11.0.6-linux', 'zulu-11.0.7-linux', 'zulu-11.0.8-linux', 'zulu-11.0.9-linux', 'zulu-12-linux', 'zulu-12.0.0-linux', 'zulu-12.0.1-linux', 'zulu-12.0.2-linux', 'zulu-13-linux', 'zulu-13.0.0-linux', 'zulu-13.0.1-linux', 'zulu-13.0.2-linux', 'zulu-13.0.3-linux', 'zulu-13.0.4-linux', 'zulu-13.0.5-linux', 'zulu-14-linux', 'zulu-14.0.0-linux', 'zulu-14.0.1-linux', 'zulu-14.0.2-linux', 'zulu-15.0.0-linux', 'zulu-15.0.1-linux'], name: \"jvm_version\", description: \"JVM\")\n+        string(name: \"concurrent_requests\", defaultValue: \"100\", description: \"The number of concurrent requests to test with\")\n+        string(name: \"duration\", defaultValue: \"10m\", description: \"Test duration in minutes. Max: 280 minutes\")\n+        // num_of_runs currently unsupported\n+        // string(name: \"num_of_runs\", defaultValue: \"1\", description: \"Number of test runs to execute\")\n+        text(name: \"agent_config\", \"defaultValue\": \"\", description: \"Custom APM Agent configuration. (WARNING: May echo to console. Do not supply sensitive data.)\")\n+        text(name: \"locustfile\", \"defaultValue\": \"\", description: \"Locust load-generator plan\")\n+        booleanParam(name: \"local_metrics\", description: \"Enable local metrics collection?\", defaultValue: false)\n+        // End script auto-generation\n+    }\n+\n+    stages {\n+        stage('Pre-flight'){\n+            steps {\n+                echo 'Getting authentication information from Vault'\n+                withSecretVault(secret: 'secret/apm-team/ci/bandstand', user_var_name: 'APP_TOKEN_TYPE', pass_var_name: 'APP_TOKEN'){\n+                    script {\n+                        sh(script: \".ci/load/scripts/start.sh\", returnStdout: true)\n+                        env.LOCUST_RUN_TIME = params.duration\n+                        env.LOCUST_USERS = params.concurrent_requests", "originalCommit": "61f9670e850341146dde2dd92350623caf2527da", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA5NjYyMw==", "url": "https://github.com/elastic/apm-agent-java/pull/1467#discussion_r516096623", "bodyText": "Is there any reason to use the returnStdout?", "author": "v1v", "createdAt": "2020-11-02T16:31:33Z", "path": ".ci/load/Jenkinsfile", "diffHunk": "@@ -0,0 +1,179 @@\n+// For documentation on this pipeline, please see the README.md in this directory\n+pipeline {\n+    agent any\n+    environment {\n+        REPO = 'apm-agent-java'\n+        APP = 'spring-petclinic'\n+        APP_BASE_DIR = \"src/${APP}\"\n+        METRICS_BASE_DIR=\"metrics/\"\n+        AGENT_BASE_DIR = \"agent/\"\n+        ORCH_URL = 'obs-load-orch.app.elastic.co:8000'\n+        // Set below for local development\n+        // ORCH_URL='10.0.2.2:8000'\n+        DEBUG_MODE = '0' // set to '0' for production\n+        // This is a placeholder server. This will change to a dummy APM Server when it is available.\n+        APM_SERVER_URL = 'https://2a2bd0e2806a47e5996eeeec6d22e6df.apm.eu-west-3.aws.elastic-cloud.com:443'\n+\n+    }\n+    options {\n+        timeout(time: 3, unit: 'HOURS')\n+        buildDiscarder(logRotator(numToKeepStr: '20', artifactNumToKeepStr: '20', daysToKeepStr: '30'))\n+        timestamps()\n+        ansiColor('xterm')\n+        durabilityHint('PERFORMANCE_OPTIMIZED')\n+\n+    }\n+    parameters {\n+        // The following snippet is auto-generated. To update it, run the script located in .ci/load/scripts/param_gen and copy in the output\n+        choice(choices: ['1.18.1', '1.18.0', '1.18.0.RC1', '1.17.0', '1.16.0', '1.15.0', '1.14.0', '1.13.0', '1.12.0', '1.11.0', '1.10.0', '1.9.0', '1.8.0', '1.7.0', '1.6.1', '1.6.0', '1.5.0', '1.4.0', '1.3.0', '1.2.0', '1.1.0', '1.0.1', '1.0.0', '1.0.0.RC1', '0.7.1', '0.7.0', '0.6.2', '0.6.1', '0.6.0', '0.5.1', '0.1.2', '0.1.1'], name: \"apm_version\", description: \"APM Java Agent version\")\n+        choice(choices: ['adoptopenjdk-11+28-linux', 'adoptopenjdk-11.0.1+13-linux', 'adoptopenjdk-11.0.1+13-linux-aarch64', 'adoptopenjdk-11.0.2+7-linux', 'adoptopenjdk-11.0.2+7-linux-aarch64', 'adoptopenjdk-11.0.2+9-linux', 'adoptopenjdk-11.0.2+9-linux-aarch64', 'adoptopenjdk-11.0.3+7-linux', 'adoptopenjdk-11.0.3+7-linux-aarch64', 'adoptopenjdk-11.0.4+11-linux', 'adoptopenjdk-11.0.4+11-linux-aarch64', 'adoptopenjdk-11.0.5+10-linux', 'adoptopenjdk-11.0.6+10-linux', 'adoptopenjdk-11.0.6+10-linux-aarch64', 'adoptopenjdk-11.0.7+10-linux', 'adoptopenjdk-11.0.7+10-linux-aarch64', 'adoptopenjdk-11.0.8+10-linux', 'adoptopenjdk-11.0.8+10-linux-aarch64', 'adoptopenjdk-11.0.9+11-linux', 'adoptopenjdk-11.0.9+11-linux-aarch64', 'adoptopenjdk-12+33-linux', 'adoptopenjdk-12.0.1+12-linux', 'adoptopenjdk-12.0.1+12-linux-aarch64', 'adoptopenjdk-12.0.2+10-linux', 'adoptopenjdk-12.0.2+10-linux-aarch64', 'adoptopenjdk-13.0.1+9-linux', 'adoptopenjdk-13.0.2+8-linux', 'adoptopenjdk-13.0.2+8-linux-aarch64', 'adoptopenjdk-14.0.1+7-linux', 'adoptopenjdk-14.0.1+7-linux-aarch64', 'adoptopenjdk-14.0.2+12-linux', 'adoptopenjdk-14.0.2+12-linux-aarch64', 'adoptopenjdk-15+36-linux', 'adoptopenjdk-15+36-linux-aarch64', 'adoptopenjdk-15.0.1+9-linux', 'adoptopenjdk-15.0.1+9-linux-aarch64', 'openjdk-11+11-linux', 'openjdk-11+12-linux', 'openjdk-11+13-linux', 'openjdk-11+14-linux', 'openjdk-11+15-linux', 'openjdk-11+16-linux', 'openjdk-11+17-linux', 'openjdk-11+18-linux', 'openjdk-11+19-linux', 'openjdk-11+20-linux', 'openjdk-11+21-linux', 'openjdk-11+22-linux', 'openjdk-11+23-linux', 'openjdk-11+24-linux', 'openjdk-11+25-linux', 'openjdk-11+26-linux', 'openjdk-11+27-linux', 'openjdk-11+28-linux', 'openjdk-11+5-linux', 'openjdk-11-linux', 'openjdk-11.0.1-linux', 'openjdk-11.0.2-linux', 'openjdk-12+23-linux', 'openjdk-12+24-linux', 'openjdk-12+25-linux', 'openjdk-12+27-linux', 'openjdk-12+28-linux', 'openjdk-12+29-linux', 'openjdk-12+30-linux', 'openjdk-12+31-linux', 'openjdk-12+32-linux', 'openjdk-12+33-linux', 'openjdk-12-linux', 'openjdk-12.0.1-linux', 'openjdk-12.0.2-linux', 'openjdk-13+14-linux', 'openjdk-13+15-linux', 'openjdk-13+16-linux', 'openjdk-13+17-linux', 'openjdk-13+18-linux', 'openjdk-13+19-linux', 'openjdk-13+20-linux', 'openjdk-13+21-linux', 'openjdk-13+22-linux', 'openjdk-13+23-linux', 'openjdk-13+24-linux', 'openjdk-13+25-linux', 'openjdk-13+26-linux', 'openjdk-13+27-linux', 'openjdk-13+28-linux', 'openjdk-13+29-linux', 'openjdk-13+30-linux', 'openjdk-13+31-linux', 'openjdk-13+32-linux', 'openjdk-13-linux', 'openjdk-13.0.1-linux', 'openjdk-13.0.2-linux', 'openjdk-14+10-linux', 'openjdk-14+11-linux', 'openjdk-14+12-linux', 'openjdk-14+13-linux', 'openjdk-14+14-linux', 'openjdk-14+15-linux', 'openjdk-14+16-linux', 'openjdk-14+17-linux', 'openjdk-14+25-linux', 'openjdk-14+26-linux', 'openjdk-14+27-linux', 'openjdk-14+28-linux', 'openjdk-14+30-linux', 'openjdk-14+31-linux', 'openjdk-14+32-linux', 'openjdk-14+33-linux', 'openjdk-14+34-linux', 'openjdk-14+9-linux', 'openjdk-14-linux', 'openjdk-14.0.1-linux', 'openjdk-14.0.2+12-linux', 'openjdk-14.0.2-linux', 'openjdk-15+10-linux', 'openjdk-15+11-linux', 'openjdk-15+12-linux', 'openjdk-15+13-linux', 'openjdk-15+14-linux', 'openjdk-15+15-linux', 'openjdk-15+16-linux', 'openjdk-15+17-linux', 'openjdk-15+18-linux', 'openjdk-15+19-linux', 'openjdk-15+20-linux', 'openjdk-15+21-linux', 'openjdk-15+22-linux', 'openjdk-15+23-linux', 'openjdk-15+24-linux', 'openjdk-15+25-linux', 'openjdk-15+26-linux', 'openjdk-15+27-linux', 'openjdk-15+28-linux', 'openjdk-15+29-linux', 'openjdk-15+30-linux', 'openjdk-15+31-linux', 'openjdk-15+32-linux', 'openjdk-15+33-linux', 'openjdk-15+34-linux', 'openjdk-15+36-linux', 'openjdk-15+4-linux', 'openjdk-15+5-linux', 'openjdk-15+6-linux', 'openjdk-15+7-linux', 'openjdk-15+8-linux', 'openjdk-15+9-linux', 'openjdk-15-linux', 'openjdk-15.0.1+9-linux', 'oracle-11+11-linux', 'oracle-11+12-linux', 'oracle-11+13-linux', 'oracle-11+14-linux', 'oracle-11+15-linux', 'oracle-11+16-linux', 'oracle-11+17-linux', 'oracle-11+18-linux', 'oracle-11+19-linux', 'oracle-11+20-linux', 'oracle-11+21-linux', 'oracle-11+22-linux', 'oracle-11+23-linux', 'oracle-11+24-linux', 'oracle-11+25-linux', 'oracle-11+26-linux', 'oracle-11+27-linux', 'oracle-11+28-linux', 'oracle-11+5-linux', 'oracle-11.0.2+7-linux', 'oracle-11.0.2+9-linux', 'oracle-11.0.3+12-linux', 'oracle-11.0.4+10-linux', 'oracle-11.0.5+10-linux', 'oracle-11.0.6+8-linux', 'oracle-12+33-linux', 'oracle-12.0.1+12-linux', 'oracle-12.0.2+10-linux', 'oracle-13+33-linux', 'oracle-13.0.1+9-linux', 'oracle-13.0.2+8-linux', 'zulu-11.0.1-linux', 'zulu-11.0.2-linux', 'zulu-11.0.3-linux', 'zulu-11.0.4-linux', 'zulu-11.0.5-linux', 'zulu-11.0.6-linux', 'zulu-11.0.7-linux', 'zulu-11.0.8-linux', 'zulu-11.0.9-linux', 'zulu-12-linux', 'zulu-12.0.0-linux', 'zulu-12.0.1-linux', 'zulu-12.0.2-linux', 'zulu-13-linux', 'zulu-13.0.0-linux', 'zulu-13.0.1-linux', 'zulu-13.0.2-linux', 'zulu-13.0.3-linux', 'zulu-13.0.4-linux', 'zulu-13.0.5-linux', 'zulu-14-linux', 'zulu-14.0.0-linux', 'zulu-14.0.1-linux', 'zulu-14.0.2-linux', 'zulu-15.0.0-linux', 'zulu-15.0.1-linux'], name: \"jvm_version\", description: \"JVM\")\n+        string(name: \"concurrent_requests\", defaultValue: \"100\", description: \"The number of concurrent requests to test with\")\n+        string(name: \"duration\", defaultValue: \"10m\", description: \"Test duration in minutes. Max: 280 minutes\")\n+        // num_of_runs currently unsupported\n+        // string(name: \"num_of_runs\", defaultValue: \"1\", description: \"Number of test runs to execute\")\n+        text(name: \"agent_config\", \"defaultValue\": \"\", description: \"Custom APM Agent configuration. (WARNING: May echo to console. Do not supply sensitive data.)\")\n+        text(name: \"locustfile\", \"defaultValue\": \"\", description: \"Locust load-generator plan\")\n+        booleanParam(name: \"local_metrics\", description: \"Enable local metrics collection?\", defaultValue: false)\n+        // End script auto-generation\n+    }\n+\n+    stages {\n+        stage('Pre-flight'){\n+            steps {\n+                echo 'Getting authentication information from Vault'\n+                withSecretVault(secret: 'secret/apm-team/ci/bandstand', user_var_name: 'APP_TOKEN_TYPE', pass_var_name: 'APP_TOKEN'){\n+                    script {\n+                        sh(script: \".ci/load/scripts/start.sh\", returnStdout: true)", "originalCommit": "61f9670e850341146dde2dd92350623caf2527da", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjEwODc4MQ==", "url": "https://github.com/elastic/apm-agent-java/pull/1467#discussion_r516108781", "bodyText": "Not really. I had it on for development but it should be safe to turn off for production. Will update. Good catch!\nEDIT: We do actually need this. It outputs the load-testing run to the console, which is valuable data.", "author": "cachedout", "createdAt": "2020-11-02T16:48:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA5NjYyMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA5NzEwMg==", "url": "https://github.com/elastic/apm-agent-java/pull/1467#discussion_r516097102", "bodyText": "If this is a MBP, then I'd suggest to also move the params to env variables to bypass an existing issue with the very first builds.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \n          \n          \n            \n                    LOCUST_RUN_TIME = \"$(params.duration}\"\n          \n          \n            \n                    LOCUST_USERS = \"$(params.concurrent_requests}\"", "author": "v1v", "createdAt": "2020-11-02T16:32:07Z", "path": ".ci/load/Jenkinsfile", "diffHunk": "@@ -0,0 +1,179 @@\n+// For documentation on this pipeline, please see the README.md in this directory\n+pipeline {\n+    agent any\n+    environment {\n+        REPO = 'apm-agent-java'\n+        APP = 'spring-petclinic'\n+        APP_BASE_DIR = \"src/${APP}\"\n+        METRICS_BASE_DIR=\"metrics/\"\n+        AGENT_BASE_DIR = \"agent/\"\n+        ORCH_URL = 'obs-load-orch.app.elastic.co:8000'\n+        // Set below for local development\n+        // ORCH_URL='10.0.2.2:8000'\n+        DEBUG_MODE = '0' // set to '0' for production\n+        // This is a placeholder server. This will change to a dummy APM Server when it is available.\n+        APM_SERVER_URL = 'https://2a2bd0e2806a47e5996eeeec6d22e6df.apm.eu-west-3.aws.elastic-cloud.com:443'\n+", "originalCommit": "61f9670e850341146dde2dd92350623caf2527da", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ2NTEyMQ==", "url": "https://github.com/elastic/apm-agent-java/pull/1467#discussion_r516465121", "bodyText": "This won't be a MBP so I think we're OK here.", "author": "cachedout", "createdAt": "2020-11-03T07:26:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA5NzEwMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA5OTA5MA==", "url": "https://github.com/elastic/apm-agent-java/pull/1467#discussion_r516099090", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                            script {\n          \n          \n            \n                                                if (params.locustfile) {\n          \n          \n            \n                                                    echo 'Using user-supplied plan for load-generation with Locust'\n          \n          \n            \n                                                    sh script: \"echo \\\"${params.locustfile}\\\">.ci/load/scripts/locustfile.py\"\n          \n          \n            \n                                                }\n          \n          \n            \n                                            }\n          \n          \n            \n                                            whenTrue(params.locustfile) {\n          \n          \n            \n                                                echo 'Using user-supplied plan for load-generation with Locust'\n          \n          \n            \n                                                sh script: \"echo \\\"${params.locustfile}\\\">.ci/load/scripts/locustfile.py\"\n          \n          \n            \n                                            }", "author": "v1v", "createdAt": "2020-11-02T16:34:45Z", "path": ".ci/load/Jenkinsfile", "diffHunk": "@@ -0,0 +1,179 @@\n+// For documentation on this pipeline, please see the README.md in this directory\n+pipeline {\n+    agent any\n+    environment {\n+        REPO = 'apm-agent-java'\n+        APP = 'spring-petclinic'\n+        APP_BASE_DIR = \"src/${APP}\"\n+        METRICS_BASE_DIR=\"metrics/\"\n+        AGENT_BASE_DIR = \"agent/\"\n+        ORCH_URL = 'obs-load-orch.app.elastic.co:8000'\n+        // Set below for local development\n+        // ORCH_URL='10.0.2.2:8000'\n+        DEBUG_MODE = '0' // set to '0' for production\n+        // This is a placeholder server. This will change to a dummy APM Server when it is available.\n+        APM_SERVER_URL = 'https://2a2bd0e2806a47e5996eeeec6d22e6df.apm.eu-west-3.aws.elastic-cloud.com:443'\n+\n+    }\n+    options {\n+        timeout(time: 3, unit: 'HOURS')\n+        buildDiscarder(logRotator(numToKeepStr: '20', artifactNumToKeepStr: '20', daysToKeepStr: '30'))\n+        timestamps()\n+        ansiColor('xterm')\n+        durabilityHint('PERFORMANCE_OPTIMIZED')\n+\n+    }\n+    parameters {\n+        // The following snippet is auto-generated. To update it, run the script located in .ci/load/scripts/param_gen and copy in the output\n+        choice(choices: ['1.18.1', '1.18.0', '1.18.0.RC1', '1.17.0', '1.16.0', '1.15.0', '1.14.0', '1.13.0', '1.12.0', '1.11.0', '1.10.0', '1.9.0', '1.8.0', '1.7.0', '1.6.1', '1.6.0', '1.5.0', '1.4.0', '1.3.0', '1.2.0', '1.1.0', '1.0.1', '1.0.0', '1.0.0.RC1', '0.7.1', '0.7.0', '0.6.2', '0.6.1', '0.6.0', '0.5.1', '0.1.2', '0.1.1'], name: \"apm_version\", description: \"APM Java Agent version\")\n+        choice(choices: ['adoptopenjdk-11+28-linux', 'adoptopenjdk-11.0.1+13-linux', 'adoptopenjdk-11.0.1+13-linux-aarch64', 'adoptopenjdk-11.0.2+7-linux', 'adoptopenjdk-11.0.2+7-linux-aarch64', 'adoptopenjdk-11.0.2+9-linux', 'adoptopenjdk-11.0.2+9-linux-aarch64', 'adoptopenjdk-11.0.3+7-linux', 'adoptopenjdk-11.0.3+7-linux-aarch64', 'adoptopenjdk-11.0.4+11-linux', 'adoptopenjdk-11.0.4+11-linux-aarch64', 'adoptopenjdk-11.0.5+10-linux', 'adoptopenjdk-11.0.6+10-linux', 'adoptopenjdk-11.0.6+10-linux-aarch64', 'adoptopenjdk-11.0.7+10-linux', 'adoptopenjdk-11.0.7+10-linux-aarch64', 'adoptopenjdk-11.0.8+10-linux', 'adoptopenjdk-11.0.8+10-linux-aarch64', 'adoptopenjdk-11.0.9+11-linux', 'adoptopenjdk-11.0.9+11-linux-aarch64', 'adoptopenjdk-12+33-linux', 'adoptopenjdk-12.0.1+12-linux', 'adoptopenjdk-12.0.1+12-linux-aarch64', 'adoptopenjdk-12.0.2+10-linux', 'adoptopenjdk-12.0.2+10-linux-aarch64', 'adoptopenjdk-13.0.1+9-linux', 'adoptopenjdk-13.0.2+8-linux', 'adoptopenjdk-13.0.2+8-linux-aarch64', 'adoptopenjdk-14.0.1+7-linux', 'adoptopenjdk-14.0.1+7-linux-aarch64', 'adoptopenjdk-14.0.2+12-linux', 'adoptopenjdk-14.0.2+12-linux-aarch64', 'adoptopenjdk-15+36-linux', 'adoptopenjdk-15+36-linux-aarch64', 'adoptopenjdk-15.0.1+9-linux', 'adoptopenjdk-15.0.1+9-linux-aarch64', 'openjdk-11+11-linux', 'openjdk-11+12-linux', 'openjdk-11+13-linux', 'openjdk-11+14-linux', 'openjdk-11+15-linux', 'openjdk-11+16-linux', 'openjdk-11+17-linux', 'openjdk-11+18-linux', 'openjdk-11+19-linux', 'openjdk-11+20-linux', 'openjdk-11+21-linux', 'openjdk-11+22-linux', 'openjdk-11+23-linux', 'openjdk-11+24-linux', 'openjdk-11+25-linux', 'openjdk-11+26-linux', 'openjdk-11+27-linux', 'openjdk-11+28-linux', 'openjdk-11+5-linux', 'openjdk-11-linux', 'openjdk-11.0.1-linux', 'openjdk-11.0.2-linux', 'openjdk-12+23-linux', 'openjdk-12+24-linux', 'openjdk-12+25-linux', 'openjdk-12+27-linux', 'openjdk-12+28-linux', 'openjdk-12+29-linux', 'openjdk-12+30-linux', 'openjdk-12+31-linux', 'openjdk-12+32-linux', 'openjdk-12+33-linux', 'openjdk-12-linux', 'openjdk-12.0.1-linux', 'openjdk-12.0.2-linux', 'openjdk-13+14-linux', 'openjdk-13+15-linux', 'openjdk-13+16-linux', 'openjdk-13+17-linux', 'openjdk-13+18-linux', 'openjdk-13+19-linux', 'openjdk-13+20-linux', 'openjdk-13+21-linux', 'openjdk-13+22-linux', 'openjdk-13+23-linux', 'openjdk-13+24-linux', 'openjdk-13+25-linux', 'openjdk-13+26-linux', 'openjdk-13+27-linux', 'openjdk-13+28-linux', 'openjdk-13+29-linux', 'openjdk-13+30-linux', 'openjdk-13+31-linux', 'openjdk-13+32-linux', 'openjdk-13-linux', 'openjdk-13.0.1-linux', 'openjdk-13.0.2-linux', 'openjdk-14+10-linux', 'openjdk-14+11-linux', 'openjdk-14+12-linux', 'openjdk-14+13-linux', 'openjdk-14+14-linux', 'openjdk-14+15-linux', 'openjdk-14+16-linux', 'openjdk-14+17-linux', 'openjdk-14+25-linux', 'openjdk-14+26-linux', 'openjdk-14+27-linux', 'openjdk-14+28-linux', 'openjdk-14+30-linux', 'openjdk-14+31-linux', 'openjdk-14+32-linux', 'openjdk-14+33-linux', 'openjdk-14+34-linux', 'openjdk-14+9-linux', 'openjdk-14-linux', 'openjdk-14.0.1-linux', 'openjdk-14.0.2+12-linux', 'openjdk-14.0.2-linux', 'openjdk-15+10-linux', 'openjdk-15+11-linux', 'openjdk-15+12-linux', 'openjdk-15+13-linux', 'openjdk-15+14-linux', 'openjdk-15+15-linux', 'openjdk-15+16-linux', 'openjdk-15+17-linux', 'openjdk-15+18-linux', 'openjdk-15+19-linux', 'openjdk-15+20-linux', 'openjdk-15+21-linux', 'openjdk-15+22-linux', 'openjdk-15+23-linux', 'openjdk-15+24-linux', 'openjdk-15+25-linux', 'openjdk-15+26-linux', 'openjdk-15+27-linux', 'openjdk-15+28-linux', 'openjdk-15+29-linux', 'openjdk-15+30-linux', 'openjdk-15+31-linux', 'openjdk-15+32-linux', 'openjdk-15+33-linux', 'openjdk-15+34-linux', 'openjdk-15+36-linux', 'openjdk-15+4-linux', 'openjdk-15+5-linux', 'openjdk-15+6-linux', 'openjdk-15+7-linux', 'openjdk-15+8-linux', 'openjdk-15+9-linux', 'openjdk-15-linux', 'openjdk-15.0.1+9-linux', 'oracle-11+11-linux', 'oracle-11+12-linux', 'oracle-11+13-linux', 'oracle-11+14-linux', 'oracle-11+15-linux', 'oracle-11+16-linux', 'oracle-11+17-linux', 'oracle-11+18-linux', 'oracle-11+19-linux', 'oracle-11+20-linux', 'oracle-11+21-linux', 'oracle-11+22-linux', 'oracle-11+23-linux', 'oracle-11+24-linux', 'oracle-11+25-linux', 'oracle-11+26-linux', 'oracle-11+27-linux', 'oracle-11+28-linux', 'oracle-11+5-linux', 'oracle-11.0.2+7-linux', 'oracle-11.0.2+9-linux', 'oracle-11.0.3+12-linux', 'oracle-11.0.4+10-linux', 'oracle-11.0.5+10-linux', 'oracle-11.0.6+8-linux', 'oracle-12+33-linux', 'oracle-12.0.1+12-linux', 'oracle-12.0.2+10-linux', 'oracle-13+33-linux', 'oracle-13.0.1+9-linux', 'oracle-13.0.2+8-linux', 'zulu-11.0.1-linux', 'zulu-11.0.2-linux', 'zulu-11.0.3-linux', 'zulu-11.0.4-linux', 'zulu-11.0.5-linux', 'zulu-11.0.6-linux', 'zulu-11.0.7-linux', 'zulu-11.0.8-linux', 'zulu-11.0.9-linux', 'zulu-12-linux', 'zulu-12.0.0-linux', 'zulu-12.0.1-linux', 'zulu-12.0.2-linux', 'zulu-13-linux', 'zulu-13.0.0-linux', 'zulu-13.0.1-linux', 'zulu-13.0.2-linux', 'zulu-13.0.3-linux', 'zulu-13.0.4-linux', 'zulu-13.0.5-linux', 'zulu-14-linux', 'zulu-14.0.0-linux', 'zulu-14.0.1-linux', 'zulu-14.0.2-linux', 'zulu-15.0.0-linux', 'zulu-15.0.1-linux'], name: \"jvm_version\", description: \"JVM\")\n+        string(name: \"concurrent_requests\", defaultValue: \"100\", description: \"The number of concurrent requests to test with\")\n+        string(name: \"duration\", defaultValue: \"10m\", description: \"Test duration in minutes. Max: 280 minutes\")\n+        // num_of_runs currently unsupported\n+        // string(name: \"num_of_runs\", defaultValue: \"1\", description: \"Number of test runs to execute\")\n+        text(name: \"agent_config\", \"defaultValue\": \"\", description: \"Custom APM Agent configuration. (WARNING: May echo to console. Do not supply sensitive data.)\")\n+        text(name: \"locustfile\", \"defaultValue\": \"\", description: \"Locust load-generator plan\")\n+        booleanParam(name: \"local_metrics\", description: \"Enable local metrics collection?\", defaultValue: false)\n+        // End script auto-generation\n+    }\n+\n+    stages {\n+        stage('Pre-flight'){\n+            steps {\n+                echo 'Getting authentication information from Vault'\n+                withSecretVault(secret: 'secret/apm-team/ci/bandstand', user_var_name: 'APP_TOKEN_TYPE', pass_var_name: 'APP_TOKEN'){\n+                    script {\n+                        sh(script: \".ci/load/scripts/start.sh\", returnStdout: true)\n+                        env.LOCUST_RUN_TIME = params.duration\n+                        env.LOCUST_USERS = params.concurrent_requests\n+                        env.SESSION_TOKEN = sh(script: \".ci/load/scripts/start.sh\", returnStdout: true).trim()\n+                    }\n+                }\n+            }    \n+        }\n+        stage('Load test') {\n+            parallel {\n+                stage('Load generation') {\n+                    agent { label 'metal' }\n+                    steps {\n+                            withSecretVault(secret: 'secret/apm-team/ci/bandstand', user_var_name: 'APP_TOKEN_TYPE', pass_var_name: 'APP_TOKEN'){\n+                                echo 'Preparing load generation..'\n+                                script {\n+                                    if (params.locustfile) {\n+                                        echo 'Using user-supplied plan for load-generation with Locust'\n+                                        sh script: \"echo \\\"${params.locustfile}\\\">.ci/load/scripts/locustfile.py\"\n+                                    }\n+                                }", "originalCommit": "61f9670e850341146dde2dd92350623caf2527da", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjEwOTk1NQ==", "url": "https://github.com/elastic/apm-agent-java/pull/1467#discussion_r516109955", "bodyText": "Ooh, I didn't know about whenTrue. That's handy! Thanks!", "author": "cachedout", "createdAt": "2020-11-02T16:49:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA5OTA5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ5MDg2Nw==", "url": "https://github.com/elastic/apm-agent-java/pull/1467#discussion_r516490867", "bodyText": "@v1v Setting this actually broke the pipeline. :(\nPreparing load generation..\u2014 Print Message<1s\n\n[2020-11-03T08:22:31.234Z] Preparing load generation..\n\nScripts not permitted to use method groovy.lang.GroovyObject invokeMethod java.lang.String java.lang.Object (org.jenkinsci.plugins.workflow.cps.CpsClosure2 whenTrue java.lang.String org.jenkinsci.plugins.workflow.cps.CpsClosure2)", "author": "cachedout", "createdAt": "2020-11-03T08:25:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA5OTA5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjUwMjc4NQ==", "url": "https://github.com/elastic/apm-agent-java/pull/1467#discussion_r516502785", "bodyText": "I went ahead and wrapped this in a Boolean.valueOf() and things are fine again. \ud83d\udc4d", "author": "cachedout", "createdAt": "2020-11-03T08:48:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA5OTA5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjU2MDE0Nw==", "url": "https://github.com/elastic/apm-agent-java/pull/1467#discussion_r516560147", "bodyText": "Sorry about the error, glad you solved :)", "author": "v1v", "createdAt": "2020-11-03T10:22:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA5OTA5MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjEwMDI4NA==", "url": "https://github.com/elastic/apm-agent-java/pull/1467#discussion_r516100284", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                            script {\n          \n          \n            \n                                                if (params.agent_config) {\n          \n          \n            \n                                                    echo 'Writing user-supplied agent configuration'\n          \n          \n            \n                                                    dir(\"${AGENT_BASE_DIR}\") {\n          \n          \n            \n                                                        sh script: \"echo \\\"${params.agent_config}\\\">custom_config.cfg\"\n          \n          \n            \n                                                    }\n          \n          \n            \n                                                }\n          \n          \n            \n                                            }\n          \n          \n            \n                                            whenTrue(params.agent_config) {\n          \n          \n            \n                                                echo 'Writing user-supplied agent configuration'\n          \n          \n            \n                                                dir(\"${AGENT_BASE_DIR}\") {\n          \n          \n            \n                                                    sh script: \"echo \\\"${params.agent_config}\\\">custom_config.cfg\"\n          \n          \n            \n                                                 }\n          \n          \n            \n                                            }", "author": "v1v", "createdAt": "2020-11-02T16:36:28Z", "path": ".ci/load/Jenkinsfile", "diffHunk": "@@ -0,0 +1,179 @@\n+// For documentation on this pipeline, please see the README.md in this directory\n+pipeline {\n+    agent any\n+    environment {\n+        REPO = 'apm-agent-java'\n+        APP = 'spring-petclinic'\n+        APP_BASE_DIR = \"src/${APP}\"\n+        METRICS_BASE_DIR=\"metrics/\"\n+        AGENT_BASE_DIR = \"agent/\"\n+        ORCH_URL = 'obs-load-orch.app.elastic.co:8000'\n+        // Set below for local development\n+        // ORCH_URL='10.0.2.2:8000'\n+        DEBUG_MODE = '0' // set to '0' for production\n+        // This is a placeholder server. This will change to a dummy APM Server when it is available.\n+        APM_SERVER_URL = 'https://2a2bd0e2806a47e5996eeeec6d22e6df.apm.eu-west-3.aws.elastic-cloud.com:443'\n+\n+    }\n+    options {\n+        timeout(time: 3, unit: 'HOURS')\n+        buildDiscarder(logRotator(numToKeepStr: '20', artifactNumToKeepStr: '20', daysToKeepStr: '30'))\n+        timestamps()\n+        ansiColor('xterm')\n+        durabilityHint('PERFORMANCE_OPTIMIZED')\n+\n+    }\n+    parameters {\n+        // The following snippet is auto-generated. To update it, run the script located in .ci/load/scripts/param_gen and copy in the output\n+        choice(choices: ['1.18.1', '1.18.0', '1.18.0.RC1', '1.17.0', '1.16.0', '1.15.0', '1.14.0', '1.13.0', '1.12.0', '1.11.0', '1.10.0', '1.9.0', '1.8.0', '1.7.0', '1.6.1', '1.6.0', '1.5.0', '1.4.0', '1.3.0', '1.2.0', '1.1.0', '1.0.1', '1.0.0', '1.0.0.RC1', '0.7.1', '0.7.0', '0.6.2', '0.6.1', '0.6.0', '0.5.1', '0.1.2', '0.1.1'], name: \"apm_version\", description: \"APM Java Agent version\")\n+        choice(choices: ['adoptopenjdk-11+28-linux', 'adoptopenjdk-11.0.1+13-linux', 'adoptopenjdk-11.0.1+13-linux-aarch64', 'adoptopenjdk-11.0.2+7-linux', 'adoptopenjdk-11.0.2+7-linux-aarch64', 'adoptopenjdk-11.0.2+9-linux', 'adoptopenjdk-11.0.2+9-linux-aarch64', 'adoptopenjdk-11.0.3+7-linux', 'adoptopenjdk-11.0.3+7-linux-aarch64', 'adoptopenjdk-11.0.4+11-linux', 'adoptopenjdk-11.0.4+11-linux-aarch64', 'adoptopenjdk-11.0.5+10-linux', 'adoptopenjdk-11.0.6+10-linux', 'adoptopenjdk-11.0.6+10-linux-aarch64', 'adoptopenjdk-11.0.7+10-linux', 'adoptopenjdk-11.0.7+10-linux-aarch64', 'adoptopenjdk-11.0.8+10-linux', 'adoptopenjdk-11.0.8+10-linux-aarch64', 'adoptopenjdk-11.0.9+11-linux', 'adoptopenjdk-11.0.9+11-linux-aarch64', 'adoptopenjdk-12+33-linux', 'adoptopenjdk-12.0.1+12-linux', 'adoptopenjdk-12.0.1+12-linux-aarch64', 'adoptopenjdk-12.0.2+10-linux', 'adoptopenjdk-12.0.2+10-linux-aarch64', 'adoptopenjdk-13.0.1+9-linux', 'adoptopenjdk-13.0.2+8-linux', 'adoptopenjdk-13.0.2+8-linux-aarch64', 'adoptopenjdk-14.0.1+7-linux', 'adoptopenjdk-14.0.1+7-linux-aarch64', 'adoptopenjdk-14.0.2+12-linux', 'adoptopenjdk-14.0.2+12-linux-aarch64', 'adoptopenjdk-15+36-linux', 'adoptopenjdk-15+36-linux-aarch64', 'adoptopenjdk-15.0.1+9-linux', 'adoptopenjdk-15.0.1+9-linux-aarch64', 'openjdk-11+11-linux', 'openjdk-11+12-linux', 'openjdk-11+13-linux', 'openjdk-11+14-linux', 'openjdk-11+15-linux', 'openjdk-11+16-linux', 'openjdk-11+17-linux', 'openjdk-11+18-linux', 'openjdk-11+19-linux', 'openjdk-11+20-linux', 'openjdk-11+21-linux', 'openjdk-11+22-linux', 'openjdk-11+23-linux', 'openjdk-11+24-linux', 'openjdk-11+25-linux', 'openjdk-11+26-linux', 'openjdk-11+27-linux', 'openjdk-11+28-linux', 'openjdk-11+5-linux', 'openjdk-11-linux', 'openjdk-11.0.1-linux', 'openjdk-11.0.2-linux', 'openjdk-12+23-linux', 'openjdk-12+24-linux', 'openjdk-12+25-linux', 'openjdk-12+27-linux', 'openjdk-12+28-linux', 'openjdk-12+29-linux', 'openjdk-12+30-linux', 'openjdk-12+31-linux', 'openjdk-12+32-linux', 'openjdk-12+33-linux', 'openjdk-12-linux', 'openjdk-12.0.1-linux', 'openjdk-12.0.2-linux', 'openjdk-13+14-linux', 'openjdk-13+15-linux', 'openjdk-13+16-linux', 'openjdk-13+17-linux', 'openjdk-13+18-linux', 'openjdk-13+19-linux', 'openjdk-13+20-linux', 'openjdk-13+21-linux', 'openjdk-13+22-linux', 'openjdk-13+23-linux', 'openjdk-13+24-linux', 'openjdk-13+25-linux', 'openjdk-13+26-linux', 'openjdk-13+27-linux', 'openjdk-13+28-linux', 'openjdk-13+29-linux', 'openjdk-13+30-linux', 'openjdk-13+31-linux', 'openjdk-13+32-linux', 'openjdk-13-linux', 'openjdk-13.0.1-linux', 'openjdk-13.0.2-linux', 'openjdk-14+10-linux', 'openjdk-14+11-linux', 'openjdk-14+12-linux', 'openjdk-14+13-linux', 'openjdk-14+14-linux', 'openjdk-14+15-linux', 'openjdk-14+16-linux', 'openjdk-14+17-linux', 'openjdk-14+25-linux', 'openjdk-14+26-linux', 'openjdk-14+27-linux', 'openjdk-14+28-linux', 'openjdk-14+30-linux', 'openjdk-14+31-linux', 'openjdk-14+32-linux', 'openjdk-14+33-linux', 'openjdk-14+34-linux', 'openjdk-14+9-linux', 'openjdk-14-linux', 'openjdk-14.0.1-linux', 'openjdk-14.0.2+12-linux', 'openjdk-14.0.2-linux', 'openjdk-15+10-linux', 'openjdk-15+11-linux', 'openjdk-15+12-linux', 'openjdk-15+13-linux', 'openjdk-15+14-linux', 'openjdk-15+15-linux', 'openjdk-15+16-linux', 'openjdk-15+17-linux', 'openjdk-15+18-linux', 'openjdk-15+19-linux', 'openjdk-15+20-linux', 'openjdk-15+21-linux', 'openjdk-15+22-linux', 'openjdk-15+23-linux', 'openjdk-15+24-linux', 'openjdk-15+25-linux', 'openjdk-15+26-linux', 'openjdk-15+27-linux', 'openjdk-15+28-linux', 'openjdk-15+29-linux', 'openjdk-15+30-linux', 'openjdk-15+31-linux', 'openjdk-15+32-linux', 'openjdk-15+33-linux', 'openjdk-15+34-linux', 'openjdk-15+36-linux', 'openjdk-15+4-linux', 'openjdk-15+5-linux', 'openjdk-15+6-linux', 'openjdk-15+7-linux', 'openjdk-15+8-linux', 'openjdk-15+9-linux', 'openjdk-15-linux', 'openjdk-15.0.1+9-linux', 'oracle-11+11-linux', 'oracle-11+12-linux', 'oracle-11+13-linux', 'oracle-11+14-linux', 'oracle-11+15-linux', 'oracle-11+16-linux', 'oracle-11+17-linux', 'oracle-11+18-linux', 'oracle-11+19-linux', 'oracle-11+20-linux', 'oracle-11+21-linux', 'oracle-11+22-linux', 'oracle-11+23-linux', 'oracle-11+24-linux', 'oracle-11+25-linux', 'oracle-11+26-linux', 'oracle-11+27-linux', 'oracle-11+28-linux', 'oracle-11+5-linux', 'oracle-11.0.2+7-linux', 'oracle-11.0.2+9-linux', 'oracle-11.0.3+12-linux', 'oracle-11.0.4+10-linux', 'oracle-11.0.5+10-linux', 'oracle-11.0.6+8-linux', 'oracle-12+33-linux', 'oracle-12.0.1+12-linux', 'oracle-12.0.2+10-linux', 'oracle-13+33-linux', 'oracle-13.0.1+9-linux', 'oracle-13.0.2+8-linux', 'zulu-11.0.1-linux', 'zulu-11.0.2-linux', 'zulu-11.0.3-linux', 'zulu-11.0.4-linux', 'zulu-11.0.5-linux', 'zulu-11.0.6-linux', 'zulu-11.0.7-linux', 'zulu-11.0.8-linux', 'zulu-11.0.9-linux', 'zulu-12-linux', 'zulu-12.0.0-linux', 'zulu-12.0.1-linux', 'zulu-12.0.2-linux', 'zulu-13-linux', 'zulu-13.0.0-linux', 'zulu-13.0.1-linux', 'zulu-13.0.2-linux', 'zulu-13.0.3-linux', 'zulu-13.0.4-linux', 'zulu-13.0.5-linux', 'zulu-14-linux', 'zulu-14.0.0-linux', 'zulu-14.0.1-linux', 'zulu-14.0.2-linux', 'zulu-15.0.0-linux', 'zulu-15.0.1-linux'], name: \"jvm_version\", description: \"JVM\")\n+        string(name: \"concurrent_requests\", defaultValue: \"100\", description: \"The number of concurrent requests to test with\")\n+        string(name: \"duration\", defaultValue: \"10m\", description: \"Test duration in minutes. Max: 280 minutes\")\n+        // num_of_runs currently unsupported\n+        // string(name: \"num_of_runs\", defaultValue: \"1\", description: \"Number of test runs to execute\")\n+        text(name: \"agent_config\", \"defaultValue\": \"\", description: \"Custom APM Agent configuration. (WARNING: May echo to console. Do not supply sensitive data.)\")\n+        text(name: \"locustfile\", \"defaultValue\": \"\", description: \"Locust load-generator plan\")\n+        booleanParam(name: \"local_metrics\", description: \"Enable local metrics collection?\", defaultValue: false)\n+        // End script auto-generation\n+    }\n+\n+    stages {\n+        stage('Pre-flight'){\n+            steps {\n+                echo 'Getting authentication information from Vault'\n+                withSecretVault(secret: 'secret/apm-team/ci/bandstand', user_var_name: 'APP_TOKEN_TYPE', pass_var_name: 'APP_TOKEN'){\n+                    script {\n+                        sh(script: \".ci/load/scripts/start.sh\", returnStdout: true)\n+                        env.LOCUST_RUN_TIME = params.duration\n+                        env.LOCUST_USERS = params.concurrent_requests\n+                        env.SESSION_TOKEN = sh(script: \".ci/load/scripts/start.sh\", returnStdout: true).trim()\n+                    }\n+                }\n+            }    \n+        }\n+        stage('Load test') {\n+            parallel {\n+                stage('Load generation') {\n+                    agent { label 'metal' }\n+                    steps {\n+                            withSecretVault(secret: 'secret/apm-team/ci/bandstand', user_var_name: 'APP_TOKEN_TYPE', pass_var_name: 'APP_TOKEN'){\n+                                echo 'Preparing load generation..'\n+                                script {\n+                                    if (params.locustfile) {\n+                                        echo 'Using user-supplied plan for load-generation with Locust'\n+                                        sh script: \"echo \\\"${params.locustfile}\\\">.ci/load/scripts/locustfile.py\"\n+                                    }\n+                                }\n+                                sh(script: \".ci/load/scripts/load_agent.sh\")\n+                            }\n+                    }\n+                }\n+                stage('Test application') {\n+                    agent { label 'metal' }\n+                    stages{\n+                        stage('Provision Java') {\n+                            steps {\n+                                echo \"Provisioning Java version: ${params.jvm_version}\"\n+                                script {\n+                                    def jdk_home = sh(script: \".ci/load/scripts/fetch_sdk.sh ${params.jvm_version}\", returnStdout: true).trim()\n+                                    env.JAVA_HOME = jdk_home\n+                                    env.JAVACMD = \"${env.JAVA_HOME}/bin/java\"\n+                                    env.PATH = \"${env.JAVA_HOME}/bin:$PATH\"\n+                                }\n+                            }\n+                        }\n+                        stage ('Provision agent') {\n+                            steps {\n+                                echo 'Checking out master branch'\n+                                dir(\"${AGENT_BASE_DIR}\") {\n+                                    gitCheckout(\n+                                        basedir: \"apm-agent-java\",\n+                                        branch: 'master',\n+                                        repo: \"https://github.com/elastic/${REPO}.git\",\n+                                        credentialsId: 'f6c7695a-671e-4f4f-a331-acdce44ff9ba',\n+                                        shallow: false\n+                                    )\n+                                    dir(\"apm-agent-java\"){\n+                                        echo 'Switching to requested version'\n+                                        sh(script: \"git checkout v${params.apm_version}\")\n+                                        echo 'Building agent'\n+                                        sh(script: './mvnw  clean install -DskipTests=true -Dmaven.javadoc.skip=true')\n+                                    }\n+                                }\n+                                script {\n+                                    if (params.agent_config) {\n+                                        echo 'Writing user-supplied agent configuration'\n+                                        dir(\"${AGENT_BASE_DIR}\") {\n+                                            sh script: \"echo \\\"${params.agent_config}\\\">custom_config.cfg\"\n+                                        }\n+                                    }\n+                                }", "originalCommit": "61f9670e850341146dde2dd92350623caf2527da", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjEwMjE5Mg==", "url": "https://github.com/elastic/apm-agent-java/pull/1467#discussion_r516102192", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                            script {\n          \n          \n            \n                                                def jdk_home = sh(script: \".ci/load/scripts/fetch_sdk.sh ${params.jvm_version}\", returnStdout: true).trim()\n          \n          \n            \n                                                env.JAVA_HOME = jdk_home\n          \n          \n            \n                                                env.JAVACMD = \"${env.JAVA_HOME}/bin/java\"\n          \n          \n            \n                                                env.PATH = \"${env.JAVA_HOME}/bin:$PATH\"\n          \n          \n            \n                                            }\n          \n          \n            \n                                            setEnvVar('JAVA_HOME', sh(script: \".ci/load/scripts/fetch_sdk.sh ${params.jvm_version}\", returnStdout: true).trim())\n          \n          \n            \n                                            setEnvVar('JAVACMD', \"${env.JAVA_HOME}/bin/java\")\n          \n          \n            \n                                            setEnvVar('PATH', \"${env.JAVA_HOME}/bin:$PATH\")", "author": "v1v", "createdAt": "2020-11-02T16:39:01Z", "path": ".ci/load/Jenkinsfile", "diffHunk": "@@ -0,0 +1,179 @@\n+// For documentation on this pipeline, please see the README.md in this directory\n+pipeline {\n+    agent any\n+    environment {\n+        REPO = 'apm-agent-java'\n+        APP = 'spring-petclinic'\n+        APP_BASE_DIR = \"src/${APP}\"\n+        METRICS_BASE_DIR=\"metrics/\"\n+        AGENT_BASE_DIR = \"agent/\"\n+        ORCH_URL = 'obs-load-orch.app.elastic.co:8000'\n+        // Set below for local development\n+        // ORCH_URL='10.0.2.2:8000'\n+        DEBUG_MODE = '0' // set to '0' for production\n+        // This is a placeholder server. This will change to a dummy APM Server when it is available.\n+        APM_SERVER_URL = 'https://2a2bd0e2806a47e5996eeeec6d22e6df.apm.eu-west-3.aws.elastic-cloud.com:443'\n+\n+    }\n+    options {\n+        timeout(time: 3, unit: 'HOURS')\n+        buildDiscarder(logRotator(numToKeepStr: '20', artifactNumToKeepStr: '20', daysToKeepStr: '30'))\n+        timestamps()\n+        ansiColor('xterm')\n+        durabilityHint('PERFORMANCE_OPTIMIZED')\n+\n+    }\n+    parameters {\n+        // The following snippet is auto-generated. To update it, run the script located in .ci/load/scripts/param_gen and copy in the output\n+        choice(choices: ['1.18.1', '1.18.0', '1.18.0.RC1', '1.17.0', '1.16.0', '1.15.0', '1.14.0', '1.13.0', '1.12.0', '1.11.0', '1.10.0', '1.9.0', '1.8.0', '1.7.0', '1.6.1', '1.6.0', '1.5.0', '1.4.0', '1.3.0', '1.2.0', '1.1.0', '1.0.1', '1.0.0', '1.0.0.RC1', '0.7.1', '0.7.0', '0.6.2', '0.6.1', '0.6.0', '0.5.1', '0.1.2', '0.1.1'], name: \"apm_version\", description: \"APM Java Agent version\")\n+        choice(choices: ['adoptopenjdk-11+28-linux', 'adoptopenjdk-11.0.1+13-linux', 'adoptopenjdk-11.0.1+13-linux-aarch64', 'adoptopenjdk-11.0.2+7-linux', 'adoptopenjdk-11.0.2+7-linux-aarch64', 'adoptopenjdk-11.0.2+9-linux', 'adoptopenjdk-11.0.2+9-linux-aarch64', 'adoptopenjdk-11.0.3+7-linux', 'adoptopenjdk-11.0.3+7-linux-aarch64', 'adoptopenjdk-11.0.4+11-linux', 'adoptopenjdk-11.0.4+11-linux-aarch64', 'adoptopenjdk-11.0.5+10-linux', 'adoptopenjdk-11.0.6+10-linux', 'adoptopenjdk-11.0.6+10-linux-aarch64', 'adoptopenjdk-11.0.7+10-linux', 'adoptopenjdk-11.0.7+10-linux-aarch64', 'adoptopenjdk-11.0.8+10-linux', 'adoptopenjdk-11.0.8+10-linux-aarch64', 'adoptopenjdk-11.0.9+11-linux', 'adoptopenjdk-11.0.9+11-linux-aarch64', 'adoptopenjdk-12+33-linux', 'adoptopenjdk-12.0.1+12-linux', 'adoptopenjdk-12.0.1+12-linux-aarch64', 'adoptopenjdk-12.0.2+10-linux', 'adoptopenjdk-12.0.2+10-linux-aarch64', 'adoptopenjdk-13.0.1+9-linux', 'adoptopenjdk-13.0.2+8-linux', 'adoptopenjdk-13.0.2+8-linux-aarch64', 'adoptopenjdk-14.0.1+7-linux', 'adoptopenjdk-14.0.1+7-linux-aarch64', 'adoptopenjdk-14.0.2+12-linux', 'adoptopenjdk-14.0.2+12-linux-aarch64', 'adoptopenjdk-15+36-linux', 'adoptopenjdk-15+36-linux-aarch64', 'adoptopenjdk-15.0.1+9-linux', 'adoptopenjdk-15.0.1+9-linux-aarch64', 'openjdk-11+11-linux', 'openjdk-11+12-linux', 'openjdk-11+13-linux', 'openjdk-11+14-linux', 'openjdk-11+15-linux', 'openjdk-11+16-linux', 'openjdk-11+17-linux', 'openjdk-11+18-linux', 'openjdk-11+19-linux', 'openjdk-11+20-linux', 'openjdk-11+21-linux', 'openjdk-11+22-linux', 'openjdk-11+23-linux', 'openjdk-11+24-linux', 'openjdk-11+25-linux', 'openjdk-11+26-linux', 'openjdk-11+27-linux', 'openjdk-11+28-linux', 'openjdk-11+5-linux', 'openjdk-11-linux', 'openjdk-11.0.1-linux', 'openjdk-11.0.2-linux', 'openjdk-12+23-linux', 'openjdk-12+24-linux', 'openjdk-12+25-linux', 'openjdk-12+27-linux', 'openjdk-12+28-linux', 'openjdk-12+29-linux', 'openjdk-12+30-linux', 'openjdk-12+31-linux', 'openjdk-12+32-linux', 'openjdk-12+33-linux', 'openjdk-12-linux', 'openjdk-12.0.1-linux', 'openjdk-12.0.2-linux', 'openjdk-13+14-linux', 'openjdk-13+15-linux', 'openjdk-13+16-linux', 'openjdk-13+17-linux', 'openjdk-13+18-linux', 'openjdk-13+19-linux', 'openjdk-13+20-linux', 'openjdk-13+21-linux', 'openjdk-13+22-linux', 'openjdk-13+23-linux', 'openjdk-13+24-linux', 'openjdk-13+25-linux', 'openjdk-13+26-linux', 'openjdk-13+27-linux', 'openjdk-13+28-linux', 'openjdk-13+29-linux', 'openjdk-13+30-linux', 'openjdk-13+31-linux', 'openjdk-13+32-linux', 'openjdk-13-linux', 'openjdk-13.0.1-linux', 'openjdk-13.0.2-linux', 'openjdk-14+10-linux', 'openjdk-14+11-linux', 'openjdk-14+12-linux', 'openjdk-14+13-linux', 'openjdk-14+14-linux', 'openjdk-14+15-linux', 'openjdk-14+16-linux', 'openjdk-14+17-linux', 'openjdk-14+25-linux', 'openjdk-14+26-linux', 'openjdk-14+27-linux', 'openjdk-14+28-linux', 'openjdk-14+30-linux', 'openjdk-14+31-linux', 'openjdk-14+32-linux', 'openjdk-14+33-linux', 'openjdk-14+34-linux', 'openjdk-14+9-linux', 'openjdk-14-linux', 'openjdk-14.0.1-linux', 'openjdk-14.0.2+12-linux', 'openjdk-14.0.2-linux', 'openjdk-15+10-linux', 'openjdk-15+11-linux', 'openjdk-15+12-linux', 'openjdk-15+13-linux', 'openjdk-15+14-linux', 'openjdk-15+15-linux', 'openjdk-15+16-linux', 'openjdk-15+17-linux', 'openjdk-15+18-linux', 'openjdk-15+19-linux', 'openjdk-15+20-linux', 'openjdk-15+21-linux', 'openjdk-15+22-linux', 'openjdk-15+23-linux', 'openjdk-15+24-linux', 'openjdk-15+25-linux', 'openjdk-15+26-linux', 'openjdk-15+27-linux', 'openjdk-15+28-linux', 'openjdk-15+29-linux', 'openjdk-15+30-linux', 'openjdk-15+31-linux', 'openjdk-15+32-linux', 'openjdk-15+33-linux', 'openjdk-15+34-linux', 'openjdk-15+36-linux', 'openjdk-15+4-linux', 'openjdk-15+5-linux', 'openjdk-15+6-linux', 'openjdk-15+7-linux', 'openjdk-15+8-linux', 'openjdk-15+9-linux', 'openjdk-15-linux', 'openjdk-15.0.1+9-linux', 'oracle-11+11-linux', 'oracle-11+12-linux', 'oracle-11+13-linux', 'oracle-11+14-linux', 'oracle-11+15-linux', 'oracle-11+16-linux', 'oracle-11+17-linux', 'oracle-11+18-linux', 'oracle-11+19-linux', 'oracle-11+20-linux', 'oracle-11+21-linux', 'oracle-11+22-linux', 'oracle-11+23-linux', 'oracle-11+24-linux', 'oracle-11+25-linux', 'oracle-11+26-linux', 'oracle-11+27-linux', 'oracle-11+28-linux', 'oracle-11+5-linux', 'oracle-11.0.2+7-linux', 'oracle-11.0.2+9-linux', 'oracle-11.0.3+12-linux', 'oracle-11.0.4+10-linux', 'oracle-11.0.5+10-linux', 'oracle-11.0.6+8-linux', 'oracle-12+33-linux', 'oracle-12.0.1+12-linux', 'oracle-12.0.2+10-linux', 'oracle-13+33-linux', 'oracle-13.0.1+9-linux', 'oracle-13.0.2+8-linux', 'zulu-11.0.1-linux', 'zulu-11.0.2-linux', 'zulu-11.0.3-linux', 'zulu-11.0.4-linux', 'zulu-11.0.5-linux', 'zulu-11.0.6-linux', 'zulu-11.0.7-linux', 'zulu-11.0.8-linux', 'zulu-11.0.9-linux', 'zulu-12-linux', 'zulu-12.0.0-linux', 'zulu-12.0.1-linux', 'zulu-12.0.2-linux', 'zulu-13-linux', 'zulu-13.0.0-linux', 'zulu-13.0.1-linux', 'zulu-13.0.2-linux', 'zulu-13.0.3-linux', 'zulu-13.0.4-linux', 'zulu-13.0.5-linux', 'zulu-14-linux', 'zulu-14.0.0-linux', 'zulu-14.0.1-linux', 'zulu-14.0.2-linux', 'zulu-15.0.0-linux', 'zulu-15.0.1-linux'], name: \"jvm_version\", description: \"JVM\")\n+        string(name: \"concurrent_requests\", defaultValue: \"100\", description: \"The number of concurrent requests to test with\")\n+        string(name: \"duration\", defaultValue: \"10m\", description: \"Test duration in minutes. Max: 280 minutes\")\n+        // num_of_runs currently unsupported\n+        // string(name: \"num_of_runs\", defaultValue: \"1\", description: \"Number of test runs to execute\")\n+        text(name: \"agent_config\", \"defaultValue\": \"\", description: \"Custom APM Agent configuration. (WARNING: May echo to console. Do not supply sensitive data.)\")\n+        text(name: \"locustfile\", \"defaultValue\": \"\", description: \"Locust load-generator plan\")\n+        booleanParam(name: \"local_metrics\", description: \"Enable local metrics collection?\", defaultValue: false)\n+        // End script auto-generation\n+    }\n+\n+    stages {\n+        stage('Pre-flight'){\n+            steps {\n+                echo 'Getting authentication information from Vault'\n+                withSecretVault(secret: 'secret/apm-team/ci/bandstand', user_var_name: 'APP_TOKEN_TYPE', pass_var_name: 'APP_TOKEN'){\n+                    script {\n+                        sh(script: \".ci/load/scripts/start.sh\", returnStdout: true)\n+                        env.LOCUST_RUN_TIME = params.duration\n+                        env.LOCUST_USERS = params.concurrent_requests\n+                        env.SESSION_TOKEN = sh(script: \".ci/load/scripts/start.sh\", returnStdout: true).trim()\n+                    }\n+                }\n+            }    \n+        }\n+        stage('Load test') {\n+            parallel {\n+                stage('Load generation') {\n+                    agent { label 'metal' }\n+                    steps {\n+                            withSecretVault(secret: 'secret/apm-team/ci/bandstand', user_var_name: 'APP_TOKEN_TYPE', pass_var_name: 'APP_TOKEN'){\n+                                echo 'Preparing load generation..'\n+                                script {\n+                                    if (params.locustfile) {\n+                                        echo 'Using user-supplied plan for load-generation with Locust'\n+                                        sh script: \"echo \\\"${params.locustfile}\\\">.ci/load/scripts/locustfile.py\"\n+                                    }\n+                                }\n+                                sh(script: \".ci/load/scripts/load_agent.sh\")\n+                            }\n+                    }\n+                }\n+                stage('Test application') {\n+                    agent { label 'metal' }\n+                    stages{\n+                        stage('Provision Java') {\n+                            steps {\n+                                echo \"Provisioning Java version: ${params.jvm_version}\"\n+                                script {\n+                                    def jdk_home = sh(script: \".ci/load/scripts/fetch_sdk.sh ${params.jvm_version}\", returnStdout: true).trim()\n+                                    env.JAVA_HOME = jdk_home\n+                                    env.JAVACMD = \"${env.JAVA_HOME}/bin/java\"\n+                                    env.PATH = \"${env.JAVA_HOME}/bin:$PATH\"\n+                                }", "originalCommit": "61f9670e850341146dde2dd92350623caf2527da", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjEwMzY4Mw==", "url": "https://github.com/elastic/apm-agent-java/pull/1467#discussion_r516103683", "bodyText": "The below will help to get rid of the required script closure\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                script {\n          \n          \n            \n                                    sh(script: \".ci/load/scripts/start.sh\", returnStdout: true)\n          \n          \n            \n                                    env.LOCUST_RUN_TIME = params.duration\n          \n          \n            \n                                    env.LOCUST_USERS = params.concurrent_requests\n          \n          \n            \n                                    env.SESSION_TOKEN = sh(script: \".ci/load/scripts/start.sh\", returnStdout: true).trim()\n          \n          \n            \n                                }\n          \n          \n            \n                                sh(script: \".ci/load/scripts/start.sh\", returnStdout: true)\n          \n          \n            \n                                setEnvVar('SESSION_TOKEN', sh(script: \".ci/load/scripts/start.sh\", returnStdout: true).trim())", "author": "v1v", "createdAt": "2020-11-02T16:41:11Z", "path": ".ci/load/Jenkinsfile", "diffHunk": "@@ -0,0 +1,179 @@\n+// For documentation on this pipeline, please see the README.md in this directory\n+pipeline {\n+    agent any\n+    environment {\n+        REPO = 'apm-agent-java'\n+        APP = 'spring-petclinic'\n+        APP_BASE_DIR = \"src/${APP}\"\n+        METRICS_BASE_DIR=\"metrics/\"\n+        AGENT_BASE_DIR = \"agent/\"\n+        ORCH_URL = 'obs-load-orch.app.elastic.co:8000'\n+        // Set below for local development\n+        // ORCH_URL='10.0.2.2:8000'\n+        DEBUG_MODE = '0' // set to '0' for production\n+        // This is a placeholder server. This will change to a dummy APM Server when it is available.\n+        APM_SERVER_URL = 'https://2a2bd0e2806a47e5996eeeec6d22e6df.apm.eu-west-3.aws.elastic-cloud.com:443'\n+\n+    }\n+    options {\n+        timeout(time: 3, unit: 'HOURS')\n+        buildDiscarder(logRotator(numToKeepStr: '20', artifactNumToKeepStr: '20', daysToKeepStr: '30'))\n+        timestamps()\n+        ansiColor('xterm')\n+        durabilityHint('PERFORMANCE_OPTIMIZED')\n+\n+    }\n+    parameters {\n+        // The following snippet is auto-generated. To update it, run the script located in .ci/load/scripts/param_gen and copy in the output\n+        choice(choices: ['1.18.1', '1.18.0', '1.18.0.RC1', '1.17.0', '1.16.0', '1.15.0', '1.14.0', '1.13.0', '1.12.0', '1.11.0', '1.10.0', '1.9.0', '1.8.0', '1.7.0', '1.6.1', '1.6.0', '1.5.0', '1.4.0', '1.3.0', '1.2.0', '1.1.0', '1.0.1', '1.0.0', '1.0.0.RC1', '0.7.1', '0.7.0', '0.6.2', '0.6.1', '0.6.0', '0.5.1', '0.1.2', '0.1.1'], name: \"apm_version\", description: \"APM Java Agent version\")\n+        choice(choices: ['adoptopenjdk-11+28-linux', 'adoptopenjdk-11.0.1+13-linux', 'adoptopenjdk-11.0.1+13-linux-aarch64', 'adoptopenjdk-11.0.2+7-linux', 'adoptopenjdk-11.0.2+7-linux-aarch64', 'adoptopenjdk-11.0.2+9-linux', 'adoptopenjdk-11.0.2+9-linux-aarch64', 'adoptopenjdk-11.0.3+7-linux', 'adoptopenjdk-11.0.3+7-linux-aarch64', 'adoptopenjdk-11.0.4+11-linux', 'adoptopenjdk-11.0.4+11-linux-aarch64', 'adoptopenjdk-11.0.5+10-linux', 'adoptopenjdk-11.0.6+10-linux', 'adoptopenjdk-11.0.6+10-linux-aarch64', 'adoptopenjdk-11.0.7+10-linux', 'adoptopenjdk-11.0.7+10-linux-aarch64', 'adoptopenjdk-11.0.8+10-linux', 'adoptopenjdk-11.0.8+10-linux-aarch64', 'adoptopenjdk-11.0.9+11-linux', 'adoptopenjdk-11.0.9+11-linux-aarch64', 'adoptopenjdk-12+33-linux', 'adoptopenjdk-12.0.1+12-linux', 'adoptopenjdk-12.0.1+12-linux-aarch64', 'adoptopenjdk-12.0.2+10-linux', 'adoptopenjdk-12.0.2+10-linux-aarch64', 'adoptopenjdk-13.0.1+9-linux', 'adoptopenjdk-13.0.2+8-linux', 'adoptopenjdk-13.0.2+8-linux-aarch64', 'adoptopenjdk-14.0.1+7-linux', 'adoptopenjdk-14.0.1+7-linux-aarch64', 'adoptopenjdk-14.0.2+12-linux', 'adoptopenjdk-14.0.2+12-linux-aarch64', 'adoptopenjdk-15+36-linux', 'adoptopenjdk-15+36-linux-aarch64', 'adoptopenjdk-15.0.1+9-linux', 'adoptopenjdk-15.0.1+9-linux-aarch64', 'openjdk-11+11-linux', 'openjdk-11+12-linux', 'openjdk-11+13-linux', 'openjdk-11+14-linux', 'openjdk-11+15-linux', 'openjdk-11+16-linux', 'openjdk-11+17-linux', 'openjdk-11+18-linux', 'openjdk-11+19-linux', 'openjdk-11+20-linux', 'openjdk-11+21-linux', 'openjdk-11+22-linux', 'openjdk-11+23-linux', 'openjdk-11+24-linux', 'openjdk-11+25-linux', 'openjdk-11+26-linux', 'openjdk-11+27-linux', 'openjdk-11+28-linux', 'openjdk-11+5-linux', 'openjdk-11-linux', 'openjdk-11.0.1-linux', 'openjdk-11.0.2-linux', 'openjdk-12+23-linux', 'openjdk-12+24-linux', 'openjdk-12+25-linux', 'openjdk-12+27-linux', 'openjdk-12+28-linux', 'openjdk-12+29-linux', 'openjdk-12+30-linux', 'openjdk-12+31-linux', 'openjdk-12+32-linux', 'openjdk-12+33-linux', 'openjdk-12-linux', 'openjdk-12.0.1-linux', 'openjdk-12.0.2-linux', 'openjdk-13+14-linux', 'openjdk-13+15-linux', 'openjdk-13+16-linux', 'openjdk-13+17-linux', 'openjdk-13+18-linux', 'openjdk-13+19-linux', 'openjdk-13+20-linux', 'openjdk-13+21-linux', 'openjdk-13+22-linux', 'openjdk-13+23-linux', 'openjdk-13+24-linux', 'openjdk-13+25-linux', 'openjdk-13+26-linux', 'openjdk-13+27-linux', 'openjdk-13+28-linux', 'openjdk-13+29-linux', 'openjdk-13+30-linux', 'openjdk-13+31-linux', 'openjdk-13+32-linux', 'openjdk-13-linux', 'openjdk-13.0.1-linux', 'openjdk-13.0.2-linux', 'openjdk-14+10-linux', 'openjdk-14+11-linux', 'openjdk-14+12-linux', 'openjdk-14+13-linux', 'openjdk-14+14-linux', 'openjdk-14+15-linux', 'openjdk-14+16-linux', 'openjdk-14+17-linux', 'openjdk-14+25-linux', 'openjdk-14+26-linux', 'openjdk-14+27-linux', 'openjdk-14+28-linux', 'openjdk-14+30-linux', 'openjdk-14+31-linux', 'openjdk-14+32-linux', 'openjdk-14+33-linux', 'openjdk-14+34-linux', 'openjdk-14+9-linux', 'openjdk-14-linux', 'openjdk-14.0.1-linux', 'openjdk-14.0.2+12-linux', 'openjdk-14.0.2-linux', 'openjdk-15+10-linux', 'openjdk-15+11-linux', 'openjdk-15+12-linux', 'openjdk-15+13-linux', 'openjdk-15+14-linux', 'openjdk-15+15-linux', 'openjdk-15+16-linux', 'openjdk-15+17-linux', 'openjdk-15+18-linux', 'openjdk-15+19-linux', 'openjdk-15+20-linux', 'openjdk-15+21-linux', 'openjdk-15+22-linux', 'openjdk-15+23-linux', 'openjdk-15+24-linux', 'openjdk-15+25-linux', 'openjdk-15+26-linux', 'openjdk-15+27-linux', 'openjdk-15+28-linux', 'openjdk-15+29-linux', 'openjdk-15+30-linux', 'openjdk-15+31-linux', 'openjdk-15+32-linux', 'openjdk-15+33-linux', 'openjdk-15+34-linux', 'openjdk-15+36-linux', 'openjdk-15+4-linux', 'openjdk-15+5-linux', 'openjdk-15+6-linux', 'openjdk-15+7-linux', 'openjdk-15+8-linux', 'openjdk-15+9-linux', 'openjdk-15-linux', 'openjdk-15.0.1+9-linux', 'oracle-11+11-linux', 'oracle-11+12-linux', 'oracle-11+13-linux', 'oracle-11+14-linux', 'oracle-11+15-linux', 'oracle-11+16-linux', 'oracle-11+17-linux', 'oracle-11+18-linux', 'oracle-11+19-linux', 'oracle-11+20-linux', 'oracle-11+21-linux', 'oracle-11+22-linux', 'oracle-11+23-linux', 'oracle-11+24-linux', 'oracle-11+25-linux', 'oracle-11+26-linux', 'oracle-11+27-linux', 'oracle-11+28-linux', 'oracle-11+5-linux', 'oracle-11.0.2+7-linux', 'oracle-11.0.2+9-linux', 'oracle-11.0.3+12-linux', 'oracle-11.0.4+10-linux', 'oracle-11.0.5+10-linux', 'oracle-11.0.6+8-linux', 'oracle-12+33-linux', 'oracle-12.0.1+12-linux', 'oracle-12.0.2+10-linux', 'oracle-13+33-linux', 'oracle-13.0.1+9-linux', 'oracle-13.0.2+8-linux', 'zulu-11.0.1-linux', 'zulu-11.0.2-linux', 'zulu-11.0.3-linux', 'zulu-11.0.4-linux', 'zulu-11.0.5-linux', 'zulu-11.0.6-linux', 'zulu-11.0.7-linux', 'zulu-11.0.8-linux', 'zulu-11.0.9-linux', 'zulu-12-linux', 'zulu-12.0.0-linux', 'zulu-12.0.1-linux', 'zulu-12.0.2-linux', 'zulu-13-linux', 'zulu-13.0.0-linux', 'zulu-13.0.1-linux', 'zulu-13.0.2-linux', 'zulu-13.0.3-linux', 'zulu-13.0.4-linux', 'zulu-13.0.5-linux', 'zulu-14-linux', 'zulu-14.0.0-linux', 'zulu-14.0.1-linux', 'zulu-14.0.2-linux', 'zulu-15.0.0-linux', 'zulu-15.0.1-linux'], name: \"jvm_version\", description: \"JVM\")\n+        string(name: \"concurrent_requests\", defaultValue: \"100\", description: \"The number of concurrent requests to test with\")\n+        string(name: \"duration\", defaultValue: \"10m\", description: \"Test duration in minutes. Max: 280 minutes\")\n+        // num_of_runs currently unsupported\n+        // string(name: \"num_of_runs\", defaultValue: \"1\", description: \"Number of test runs to execute\")\n+        text(name: \"agent_config\", \"defaultValue\": \"\", description: \"Custom APM Agent configuration. (WARNING: May echo to console. Do not supply sensitive data.)\")\n+        text(name: \"locustfile\", \"defaultValue\": \"\", description: \"Locust load-generator plan\")\n+        booleanParam(name: \"local_metrics\", description: \"Enable local metrics collection?\", defaultValue: false)\n+        // End script auto-generation\n+    }\n+\n+    stages {\n+        stage('Pre-flight'){\n+            steps {\n+                echo 'Getting authentication information from Vault'\n+                withSecretVault(secret: 'secret/apm-team/ci/bandstand', user_var_name: 'APP_TOKEN_TYPE', pass_var_name: 'APP_TOKEN'){\n+                    script {\n+                        sh(script: \".ci/load/scripts/start.sh\", returnStdout: true)\n+                        env.LOCUST_RUN_TIME = params.duration\n+                        env.LOCUST_USERS = params.concurrent_requests\n+                        env.SESSION_TOKEN = sh(script: \".ci/load/scripts/start.sh\", returnStdout: true).trim()\n+                    }", "originalCommit": "61f9670e850341146dde2dd92350623caf2527da", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e51c8e4bd19a3470cc3c8e32317dcff58b141bab", "url": "https://github.com/elastic/apm-agent-java/commit/e51c8e4bd19a3470cc3c8e32317dcff58b141bab", "message": "Update .ci/load/Jenkinsfile\n\nCo-authored-by: Victor Martinez <victormartinezrubio@gmail.com>", "committedDate": "2020-11-02T16:49:32Z", "type": "commit"}, {"oid": "9c6bb6f56a083c9a082881bd08fa16a6357c68f3", "url": "https://github.com/elastic/apm-agent-java/commit/9c6bb6f56a083c9a082881bd08fa16a6357c68f3", "message": "Update .ci/load/Jenkinsfile\n\nCo-authored-by: Victor Martinez <victormartinezrubio@gmail.com>", "committedDate": "2020-11-02T16:49:42Z", "type": "commit"}, {"oid": "0939974512b6a3708ca2c9901bdcfe61367cd440", "url": "https://github.com/elastic/apm-agent-java/commit/0939974512b6a3708ca2c9901bdcfe61367cd440", "message": "Update .ci/load/Jenkinsfile\n\nCo-authored-by: Victor Martinez <victormartinezrubio@gmail.com>", "committedDate": "2020-11-02T16:50:24Z", "type": "commit"}, {"oid": "e7012da2c09ad2a5d423b43191ecb24296694c01", "url": "https://github.com/elastic/apm-agent-java/commit/e7012da2c09ad2a5d423b43191ecb24296694c01", "message": "Update .ci/load/Jenkinsfile\n\nCo-authored-by: Victor Martinez <victormartinezrubio@gmail.com>", "committedDate": "2020-11-02T16:50:40Z", "type": "commit"}, {"oid": "547e001d254842b04053396c454869d08ea9c5e1", "url": "https://github.com/elastic/apm-agent-java/commit/547e001d254842b04053396c454869d08ea9c5e1", "message": "Fixup of review changes", "committedDate": "2020-11-03T08:47:37Z", "type": "commit"}, {"oid": "090a2596b8d121d2b2bfcb429083ed94a51fc1a2", "url": "https://github.com/elastic/apm-agent-java/commit/090a2596b8d121d2b2bfcb429083ed94a51fc1a2", "message": "Set interval to fixed time", "committedDate": "2020-11-03T09:24:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjU0NTA2Mg==", "url": "https://github.com/elastic/apm-agent-java/pull/1467#discussion_r516545062", "bodyText": "IIUC, constant is still vulnerable to coordinated omission as it waits one second after the requests has been completed. By using constant_pacing, we can ensure a constant RPS, regardless of how long it takes to serve the request.\nAn example of when this can be problematic: Imagine there's a 1-minute stop-the-world JVM pause due to a major garbage collection. During that time, we'd effectively \"look away\" by waiting for the current requests to execute before executing others. Only by executing pre-defined request/sec rate, no matter how the system under test responds, we can fully include the effect of the long stop-the-world pause in the test results.", "author": "felixbarny", "createdAt": "2020-11-03T09:58:00Z", "path": ".ci/load/scripts/locustfile.py", "diffHunk": "@@ -0,0 +1,13 @@\n+from locust import HttpUser, task, constant\n+\n+\n+class QuickstartUser(HttpUser):\n+    wait_time = constant(1)", "originalCommit": "090a2596b8d121d2b2bfcb429083ed94a51fc1a2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjU0NTU4OQ==", "url": "https://github.com/elastic/apm-agent-java/pull/1467#discussion_r516545589", "bodyText": "Ah, OK. I'll change this to constant_pacing.", "author": "cachedout", "createdAt": "2020-11-03T09:58:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjU0NTA2Mg=="}], "type": "inlineReview"}, {"oid": "8329f488a2909b4b4d73dc227981bb7734a4141b", "url": "https://github.com/elastic/apm-agent-java/commit/8329f488a2909b4b4d73dc227981bb7734a4141b", "message": "constant pacing for load gen", "committedDate": "2020-11-03T10:39:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjU3MzQxNg==", "url": "https://github.com/elastic/apm-agent-java/pull/1467#discussion_r516573416", "bodyText": "Should we mask this SESSION_TOKEN?", "author": "kuisathaverat", "createdAt": "2020-11-03T10:44:02Z", "path": ".ci/load/Jenkinsfile", "diffHunk": "@@ -0,0 +1,170 @@\n+// For documentation on this pipeline, please see the README.md in this directory\n+pipeline {\n+    agent any\n+    environment {\n+        REPO = 'apm-agent-java'\n+        APP = 'spring-petclinic'\n+        APP_BASE_DIR = \"src/${APP}\"\n+        METRICS_BASE_DIR=\"metrics/\"\n+        AGENT_BASE_DIR = \"agent/\"\n+        ORCH_URL = 'obs-load-orch.app.elastic.co:8000'\n+        // Set below for local development\n+        // ORCH_URL='10.0.2.2:8000'\n+        DEBUG_MODE = '0' // set to '0' for production\n+        // This is a placeholder server. This will change to a dummy APM Server when it is available.\n+        APM_SERVER_URL = 'https://2a2bd0e2806a47e5996eeeec6d22e6df.apm.eu-west-3.aws.elastic-cloud.com:443'\n+        LOCUST_RUN_TIME = \"${params.duration}\"\n+        LOCUST_USERS = \"${params.concurrent_requests}\"\n+\n+    }\n+    options {\n+        timeout(time: 3, unit: 'HOURS')\n+        buildDiscarder(logRotator(numToKeepStr: '20', artifactNumToKeepStr: '20', daysToKeepStr: '30'))\n+        timestamps()\n+        ansiColor('xterm')\n+        durabilityHint('PERFORMANCE_OPTIMIZED')\n+\n+    }\n+    parameters {\n+        // The following snippet is auto-generated. To update it, run the script located in .ci/load/scripts/param_gen and copy in the output\n+        choice(choices: ['1.18.1', '1.18.0', '1.18.0.RC1', '1.17.0', '1.16.0', '1.15.0', '1.14.0', '1.13.0', '1.12.0', '1.11.0', '1.10.0', '1.9.0', '1.8.0', '1.7.0', '1.6.1', '1.6.0', '1.5.0', '1.4.0', '1.3.0', '1.2.0', '1.1.0', '1.0.1', '1.0.0', '1.0.0.RC1', '0.7.1', '0.7.0', '0.6.2', '0.6.1', '0.6.0', '0.5.1', '0.1.2', '0.1.1'], name: \"apm_version\", description: \"APM Java Agent version\")\n+        choice(choices: ['adoptopenjdk-11+28-linux', 'adoptopenjdk-11.0.1+13-linux', 'adoptopenjdk-11.0.1+13-linux-aarch64', 'adoptopenjdk-11.0.2+7-linux', 'adoptopenjdk-11.0.2+7-linux-aarch64', 'adoptopenjdk-11.0.2+9-linux', 'adoptopenjdk-11.0.2+9-linux-aarch64', 'adoptopenjdk-11.0.3+7-linux', 'adoptopenjdk-11.0.3+7-linux-aarch64', 'adoptopenjdk-11.0.4+11-linux', 'adoptopenjdk-11.0.4+11-linux-aarch64', 'adoptopenjdk-11.0.5+10-linux', 'adoptopenjdk-11.0.6+10-linux', 'adoptopenjdk-11.0.6+10-linux-aarch64', 'adoptopenjdk-11.0.7+10-linux', 'adoptopenjdk-11.0.7+10-linux-aarch64', 'adoptopenjdk-11.0.8+10-linux', 'adoptopenjdk-11.0.8+10-linux-aarch64', 'adoptopenjdk-11.0.9+11-linux', 'adoptopenjdk-11.0.9+11-linux-aarch64', 'adoptopenjdk-12+33-linux', 'adoptopenjdk-12.0.1+12-linux', 'adoptopenjdk-12.0.1+12-linux-aarch64', 'adoptopenjdk-12.0.2+10-linux', 'adoptopenjdk-12.0.2+10-linux-aarch64', 'adoptopenjdk-13.0.1+9-linux', 'adoptopenjdk-13.0.2+8-linux', 'adoptopenjdk-13.0.2+8-linux-aarch64', 'adoptopenjdk-14.0.1+7-linux', 'adoptopenjdk-14.0.1+7-linux-aarch64', 'adoptopenjdk-14.0.2+12-linux', 'adoptopenjdk-14.0.2+12-linux-aarch64', 'adoptopenjdk-15+36-linux', 'adoptopenjdk-15+36-linux-aarch64', 'adoptopenjdk-15.0.1+9-linux', 'adoptopenjdk-15.0.1+9-linux-aarch64', 'openjdk-11+11-linux', 'openjdk-11+12-linux', 'openjdk-11+13-linux', 'openjdk-11+14-linux', 'openjdk-11+15-linux', 'openjdk-11+16-linux', 'openjdk-11+17-linux', 'openjdk-11+18-linux', 'openjdk-11+19-linux', 'openjdk-11+20-linux', 'openjdk-11+21-linux', 'openjdk-11+22-linux', 'openjdk-11+23-linux', 'openjdk-11+24-linux', 'openjdk-11+25-linux', 'openjdk-11+26-linux', 'openjdk-11+27-linux', 'openjdk-11+28-linux', 'openjdk-11+5-linux', 'openjdk-11-linux', 'openjdk-11.0.1-linux', 'openjdk-11.0.2-linux', 'openjdk-12+23-linux', 'openjdk-12+24-linux', 'openjdk-12+25-linux', 'openjdk-12+27-linux', 'openjdk-12+28-linux', 'openjdk-12+29-linux', 'openjdk-12+30-linux', 'openjdk-12+31-linux', 'openjdk-12+32-linux', 'openjdk-12+33-linux', 'openjdk-12-linux', 'openjdk-12.0.1-linux', 'openjdk-12.0.2-linux', 'openjdk-13+14-linux', 'openjdk-13+15-linux', 'openjdk-13+16-linux', 'openjdk-13+17-linux', 'openjdk-13+18-linux', 'openjdk-13+19-linux', 'openjdk-13+20-linux', 'openjdk-13+21-linux', 'openjdk-13+22-linux', 'openjdk-13+23-linux', 'openjdk-13+24-linux', 'openjdk-13+25-linux', 'openjdk-13+26-linux', 'openjdk-13+27-linux', 'openjdk-13+28-linux', 'openjdk-13+29-linux', 'openjdk-13+30-linux', 'openjdk-13+31-linux', 'openjdk-13+32-linux', 'openjdk-13-linux', 'openjdk-13.0.1-linux', 'openjdk-13.0.2-linux', 'openjdk-14+10-linux', 'openjdk-14+11-linux', 'openjdk-14+12-linux', 'openjdk-14+13-linux', 'openjdk-14+14-linux', 'openjdk-14+15-linux', 'openjdk-14+16-linux', 'openjdk-14+17-linux', 'openjdk-14+25-linux', 'openjdk-14+26-linux', 'openjdk-14+27-linux', 'openjdk-14+28-linux', 'openjdk-14+30-linux', 'openjdk-14+31-linux', 'openjdk-14+32-linux', 'openjdk-14+33-linux', 'openjdk-14+34-linux', 'openjdk-14+9-linux', 'openjdk-14-linux', 'openjdk-14.0.1-linux', 'openjdk-14.0.2+12-linux', 'openjdk-14.0.2-linux', 'openjdk-15+10-linux', 'openjdk-15+11-linux', 'openjdk-15+12-linux', 'openjdk-15+13-linux', 'openjdk-15+14-linux', 'openjdk-15+15-linux', 'openjdk-15+16-linux', 'openjdk-15+17-linux', 'openjdk-15+18-linux', 'openjdk-15+19-linux', 'openjdk-15+20-linux', 'openjdk-15+21-linux', 'openjdk-15+22-linux', 'openjdk-15+23-linux', 'openjdk-15+24-linux', 'openjdk-15+25-linux', 'openjdk-15+26-linux', 'openjdk-15+27-linux', 'openjdk-15+28-linux', 'openjdk-15+29-linux', 'openjdk-15+30-linux', 'openjdk-15+31-linux', 'openjdk-15+32-linux', 'openjdk-15+33-linux', 'openjdk-15+34-linux', 'openjdk-15+36-linux', 'openjdk-15+4-linux', 'openjdk-15+5-linux', 'openjdk-15+6-linux', 'openjdk-15+7-linux', 'openjdk-15+8-linux', 'openjdk-15+9-linux', 'openjdk-15-linux', 'openjdk-15.0.1+9-linux', 'oracle-11+11-linux', 'oracle-11+12-linux', 'oracle-11+13-linux', 'oracle-11+14-linux', 'oracle-11+15-linux', 'oracle-11+16-linux', 'oracle-11+17-linux', 'oracle-11+18-linux', 'oracle-11+19-linux', 'oracle-11+20-linux', 'oracle-11+21-linux', 'oracle-11+22-linux', 'oracle-11+23-linux', 'oracle-11+24-linux', 'oracle-11+25-linux', 'oracle-11+26-linux', 'oracle-11+27-linux', 'oracle-11+28-linux', 'oracle-11+5-linux', 'oracle-11.0.2+7-linux', 'oracle-11.0.2+9-linux', 'oracle-11.0.3+12-linux', 'oracle-11.0.4+10-linux', 'oracle-11.0.5+10-linux', 'oracle-11.0.6+8-linux', 'oracle-12+33-linux', 'oracle-12.0.1+12-linux', 'oracle-12.0.2+10-linux', 'oracle-13+33-linux', 'oracle-13.0.1+9-linux', 'oracle-13.0.2+8-linux', 'zulu-11.0.1-linux', 'zulu-11.0.2-linux', 'zulu-11.0.3-linux', 'zulu-11.0.4-linux', 'zulu-11.0.5-linux', 'zulu-11.0.6-linux', 'zulu-11.0.7-linux', 'zulu-11.0.8-linux', 'zulu-11.0.9-linux', 'zulu-12-linux', 'zulu-12.0.0-linux', 'zulu-12.0.1-linux', 'zulu-12.0.2-linux', 'zulu-13-linux', 'zulu-13.0.0-linux', 'zulu-13.0.1-linux', 'zulu-13.0.2-linux', 'zulu-13.0.3-linux', 'zulu-13.0.4-linux', 'zulu-13.0.5-linux', 'zulu-14-linux', 'zulu-14.0.0-linux', 'zulu-14.0.1-linux', 'zulu-14.0.2-linux', 'zulu-15.0.0-linux', 'zulu-15.0.1-linux'], name: \"jvm_version\", description: \"JVM\")\n+        string(name: \"concurrent_requests\", defaultValue: \"100\", description: \"The number of concurrent requests to test with\")\n+        string(name: \"duration\", defaultValue: \"10m\", description: \"Test duration in minutes. Max: 280 minutes\")\n+        // num_of_runs currently unsupported\n+        // string(name: \"num_of_runs\", defaultValue: \"1\", description: \"Number of test runs to execute\")\n+        text(name: \"agent_config\", \"defaultValue\": \"\", description: \"Custom APM Agent configuration. (WARNING: May echo to console. Do not supply sensitive data.)\")\n+        text(name: \"locustfile\", \"defaultValue\": \"\", description: \"Locust load-generator plan\")\n+        booleanParam(name: \"local_metrics\", description: \"Enable local metrics collection?\", defaultValue: false)\n+        // End script auto-generation\n+    }\n+\n+    stages {\n+        stage('Pre-flight'){\n+            steps {\n+                echo 'Getting authentication information from Vault'\n+                withSecretVault(secret: 'secret/apm-team/ci/bandstand', user_var_name: 'APP_TOKEN_TYPE', pass_var_name: 'APP_TOKEN'){\n+                    sh(script: \".ci/load/scripts/start.sh\", returnStdout: true)\n+                    setEnvVar('SESSION_TOKEN', sh(script: \".ci/load/scripts/start.sh\", returnStdout: true).trim())", "originalCommit": "8329f488a2909b4b4d73dc227981bb7734a4141b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjU3ODY3NA==", "url": "https://github.com/elastic/apm-agent-java/pull/1467#discussion_r516578674", "bodyText": "It's not a secure token. All security is handled via the APP_TOKEN which is a shared secret. The session token is really just an identifier for the session so it shouldn't need to be obscured.", "author": "cachedout", "createdAt": "2020-11-03T10:52:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjU3MzQxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjU4MjcxMA==", "url": "https://github.com/elastic/apm-agent-java/pull/1467#discussion_r516582710", "bodyText": "I do not think so, it is a TOKEN to coordinate the process, probably we can use BUILD_ID instead is a unique identified per build.", "author": "kuisathaverat", "createdAt": "2020-11-03T10:59:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjU3MzQxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjU4NjA0Mw==", "url": "https://github.com/elastic/apm-agent-java/pull/1467#discussion_r516586043", "bodyText": "Using something like the BUILD_ID would require some changes to the process as it is currently designed. At present, a unique SESSION_ID is generated by the orchestrator and passed back to Jenkins which then uses it for the lifetime of the pipeline. I agree that we could change this to let Jenkins tell the orchestrator which identifier it wants to use and pull that from the BUILD_ID, but I'm not clear on what advantage that would have. Could you please clarify?", "author": "cachedout", "createdAt": "2020-11-03T11:05:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjU3MzQxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjcxMzc5Nw==", "url": "https://github.com/elastic/apm-agent-java/pull/1467#discussion_r516713797", "bodyText": "there is no much benefice to use BUILD_ID, only to not have to generate it, so I think is fine to generate the SESSION_ID", "author": "kuisathaverat", "createdAt": "2020-11-03T14:37:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjU3MzQxNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjU3NDY2Nw==", "url": "https://github.com/elastic/apm-agent-java/pull/1467#discussion_r516574667", "bodyText": "Is correct to call twice the same script?", "author": "kuisathaverat", "createdAt": "2020-11-03T10:45:57Z", "path": ".ci/load/Jenkinsfile", "diffHunk": "@@ -0,0 +1,170 @@\n+// For documentation on this pipeline, please see the README.md in this directory\n+pipeline {\n+    agent any\n+    environment {\n+        REPO = 'apm-agent-java'\n+        APP = 'spring-petclinic'\n+        APP_BASE_DIR = \"src/${APP}\"\n+        METRICS_BASE_DIR=\"metrics/\"\n+        AGENT_BASE_DIR = \"agent/\"\n+        ORCH_URL = 'obs-load-orch.app.elastic.co:8000'\n+        // Set below for local development\n+        // ORCH_URL='10.0.2.2:8000'\n+        DEBUG_MODE = '0' // set to '0' for production\n+        // This is a placeholder server. This will change to a dummy APM Server when it is available.\n+        APM_SERVER_URL = 'https://2a2bd0e2806a47e5996eeeec6d22e6df.apm.eu-west-3.aws.elastic-cloud.com:443'\n+        LOCUST_RUN_TIME = \"${params.duration}\"\n+        LOCUST_USERS = \"${params.concurrent_requests}\"\n+\n+    }\n+    options {\n+        timeout(time: 3, unit: 'HOURS')\n+        buildDiscarder(logRotator(numToKeepStr: '20', artifactNumToKeepStr: '20', daysToKeepStr: '30'))\n+        timestamps()\n+        ansiColor('xterm')\n+        durabilityHint('PERFORMANCE_OPTIMIZED')\n+\n+    }\n+    parameters {\n+        // The following snippet is auto-generated. To update it, run the script located in .ci/load/scripts/param_gen and copy in the output\n+        choice(choices: ['1.18.1', '1.18.0', '1.18.0.RC1', '1.17.0', '1.16.0', '1.15.0', '1.14.0', '1.13.0', '1.12.0', '1.11.0', '1.10.0', '1.9.0', '1.8.0', '1.7.0', '1.6.1', '1.6.0', '1.5.0', '1.4.0', '1.3.0', '1.2.0', '1.1.0', '1.0.1', '1.0.0', '1.0.0.RC1', '0.7.1', '0.7.0', '0.6.2', '0.6.1', '0.6.0', '0.5.1', '0.1.2', '0.1.1'], name: \"apm_version\", description: \"APM Java Agent version\")\n+        choice(choices: ['adoptopenjdk-11+28-linux', 'adoptopenjdk-11.0.1+13-linux', 'adoptopenjdk-11.0.1+13-linux-aarch64', 'adoptopenjdk-11.0.2+7-linux', 'adoptopenjdk-11.0.2+7-linux-aarch64', 'adoptopenjdk-11.0.2+9-linux', 'adoptopenjdk-11.0.2+9-linux-aarch64', 'adoptopenjdk-11.0.3+7-linux', 'adoptopenjdk-11.0.3+7-linux-aarch64', 'adoptopenjdk-11.0.4+11-linux', 'adoptopenjdk-11.0.4+11-linux-aarch64', 'adoptopenjdk-11.0.5+10-linux', 'adoptopenjdk-11.0.6+10-linux', 'adoptopenjdk-11.0.6+10-linux-aarch64', 'adoptopenjdk-11.0.7+10-linux', 'adoptopenjdk-11.0.7+10-linux-aarch64', 'adoptopenjdk-11.0.8+10-linux', 'adoptopenjdk-11.0.8+10-linux-aarch64', 'adoptopenjdk-11.0.9+11-linux', 'adoptopenjdk-11.0.9+11-linux-aarch64', 'adoptopenjdk-12+33-linux', 'adoptopenjdk-12.0.1+12-linux', 'adoptopenjdk-12.0.1+12-linux-aarch64', 'adoptopenjdk-12.0.2+10-linux', 'adoptopenjdk-12.0.2+10-linux-aarch64', 'adoptopenjdk-13.0.1+9-linux', 'adoptopenjdk-13.0.2+8-linux', 'adoptopenjdk-13.0.2+8-linux-aarch64', 'adoptopenjdk-14.0.1+7-linux', 'adoptopenjdk-14.0.1+7-linux-aarch64', 'adoptopenjdk-14.0.2+12-linux', 'adoptopenjdk-14.0.2+12-linux-aarch64', 'adoptopenjdk-15+36-linux', 'adoptopenjdk-15+36-linux-aarch64', 'adoptopenjdk-15.0.1+9-linux', 'adoptopenjdk-15.0.1+9-linux-aarch64', 'openjdk-11+11-linux', 'openjdk-11+12-linux', 'openjdk-11+13-linux', 'openjdk-11+14-linux', 'openjdk-11+15-linux', 'openjdk-11+16-linux', 'openjdk-11+17-linux', 'openjdk-11+18-linux', 'openjdk-11+19-linux', 'openjdk-11+20-linux', 'openjdk-11+21-linux', 'openjdk-11+22-linux', 'openjdk-11+23-linux', 'openjdk-11+24-linux', 'openjdk-11+25-linux', 'openjdk-11+26-linux', 'openjdk-11+27-linux', 'openjdk-11+28-linux', 'openjdk-11+5-linux', 'openjdk-11-linux', 'openjdk-11.0.1-linux', 'openjdk-11.0.2-linux', 'openjdk-12+23-linux', 'openjdk-12+24-linux', 'openjdk-12+25-linux', 'openjdk-12+27-linux', 'openjdk-12+28-linux', 'openjdk-12+29-linux', 'openjdk-12+30-linux', 'openjdk-12+31-linux', 'openjdk-12+32-linux', 'openjdk-12+33-linux', 'openjdk-12-linux', 'openjdk-12.0.1-linux', 'openjdk-12.0.2-linux', 'openjdk-13+14-linux', 'openjdk-13+15-linux', 'openjdk-13+16-linux', 'openjdk-13+17-linux', 'openjdk-13+18-linux', 'openjdk-13+19-linux', 'openjdk-13+20-linux', 'openjdk-13+21-linux', 'openjdk-13+22-linux', 'openjdk-13+23-linux', 'openjdk-13+24-linux', 'openjdk-13+25-linux', 'openjdk-13+26-linux', 'openjdk-13+27-linux', 'openjdk-13+28-linux', 'openjdk-13+29-linux', 'openjdk-13+30-linux', 'openjdk-13+31-linux', 'openjdk-13+32-linux', 'openjdk-13-linux', 'openjdk-13.0.1-linux', 'openjdk-13.0.2-linux', 'openjdk-14+10-linux', 'openjdk-14+11-linux', 'openjdk-14+12-linux', 'openjdk-14+13-linux', 'openjdk-14+14-linux', 'openjdk-14+15-linux', 'openjdk-14+16-linux', 'openjdk-14+17-linux', 'openjdk-14+25-linux', 'openjdk-14+26-linux', 'openjdk-14+27-linux', 'openjdk-14+28-linux', 'openjdk-14+30-linux', 'openjdk-14+31-linux', 'openjdk-14+32-linux', 'openjdk-14+33-linux', 'openjdk-14+34-linux', 'openjdk-14+9-linux', 'openjdk-14-linux', 'openjdk-14.0.1-linux', 'openjdk-14.0.2+12-linux', 'openjdk-14.0.2-linux', 'openjdk-15+10-linux', 'openjdk-15+11-linux', 'openjdk-15+12-linux', 'openjdk-15+13-linux', 'openjdk-15+14-linux', 'openjdk-15+15-linux', 'openjdk-15+16-linux', 'openjdk-15+17-linux', 'openjdk-15+18-linux', 'openjdk-15+19-linux', 'openjdk-15+20-linux', 'openjdk-15+21-linux', 'openjdk-15+22-linux', 'openjdk-15+23-linux', 'openjdk-15+24-linux', 'openjdk-15+25-linux', 'openjdk-15+26-linux', 'openjdk-15+27-linux', 'openjdk-15+28-linux', 'openjdk-15+29-linux', 'openjdk-15+30-linux', 'openjdk-15+31-linux', 'openjdk-15+32-linux', 'openjdk-15+33-linux', 'openjdk-15+34-linux', 'openjdk-15+36-linux', 'openjdk-15+4-linux', 'openjdk-15+5-linux', 'openjdk-15+6-linux', 'openjdk-15+7-linux', 'openjdk-15+8-linux', 'openjdk-15+9-linux', 'openjdk-15-linux', 'openjdk-15.0.1+9-linux', 'oracle-11+11-linux', 'oracle-11+12-linux', 'oracle-11+13-linux', 'oracle-11+14-linux', 'oracle-11+15-linux', 'oracle-11+16-linux', 'oracle-11+17-linux', 'oracle-11+18-linux', 'oracle-11+19-linux', 'oracle-11+20-linux', 'oracle-11+21-linux', 'oracle-11+22-linux', 'oracle-11+23-linux', 'oracle-11+24-linux', 'oracle-11+25-linux', 'oracle-11+26-linux', 'oracle-11+27-linux', 'oracle-11+28-linux', 'oracle-11+5-linux', 'oracle-11.0.2+7-linux', 'oracle-11.0.2+9-linux', 'oracle-11.0.3+12-linux', 'oracle-11.0.4+10-linux', 'oracle-11.0.5+10-linux', 'oracle-11.0.6+8-linux', 'oracle-12+33-linux', 'oracle-12.0.1+12-linux', 'oracle-12.0.2+10-linux', 'oracle-13+33-linux', 'oracle-13.0.1+9-linux', 'oracle-13.0.2+8-linux', 'zulu-11.0.1-linux', 'zulu-11.0.2-linux', 'zulu-11.0.3-linux', 'zulu-11.0.4-linux', 'zulu-11.0.5-linux', 'zulu-11.0.6-linux', 'zulu-11.0.7-linux', 'zulu-11.0.8-linux', 'zulu-11.0.9-linux', 'zulu-12-linux', 'zulu-12.0.0-linux', 'zulu-12.0.1-linux', 'zulu-12.0.2-linux', 'zulu-13-linux', 'zulu-13.0.0-linux', 'zulu-13.0.1-linux', 'zulu-13.0.2-linux', 'zulu-13.0.3-linux', 'zulu-13.0.4-linux', 'zulu-13.0.5-linux', 'zulu-14-linux', 'zulu-14.0.0-linux', 'zulu-14.0.1-linux', 'zulu-14.0.2-linux', 'zulu-15.0.0-linux', 'zulu-15.0.1-linux'], name: \"jvm_version\", description: \"JVM\")\n+        string(name: \"concurrent_requests\", defaultValue: \"100\", description: \"The number of concurrent requests to test with\")\n+        string(name: \"duration\", defaultValue: \"10m\", description: \"Test duration in minutes. Max: 280 minutes\")\n+        // num_of_runs currently unsupported\n+        // string(name: \"num_of_runs\", defaultValue: \"1\", description: \"Number of test runs to execute\")\n+        text(name: \"agent_config\", \"defaultValue\": \"\", description: \"Custom APM Agent configuration. (WARNING: May echo to console. Do not supply sensitive data.)\")\n+        text(name: \"locustfile\", \"defaultValue\": \"\", description: \"Locust load-generator plan\")\n+        booleanParam(name: \"local_metrics\", description: \"Enable local metrics collection?\", defaultValue: false)\n+        // End script auto-generation\n+    }\n+\n+    stages {\n+        stage('Pre-flight'){\n+            steps {\n+                echo 'Getting authentication information from Vault'\n+                withSecretVault(secret: 'secret/apm-team/ci/bandstand', user_var_name: 'APP_TOKEN_TYPE', pass_var_name: 'APP_TOKEN'){\n+                    sh(script: \".ci/load/scripts/start.sh\", returnStdout: true)\n+                    setEnvVar('SESSION_TOKEN', sh(script: \".ci/load/scripts/start.sh\", returnStdout: true).trim())", "originalCommit": "8329f488a2909b4b4d73dc227981bb7734a4141b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjU3OTE4Mg==", "url": "https://github.com/elastic/apm-agent-java/pull/1467#discussion_r516579182", "bodyText": "Gah. That snuck back in via a bad merge. Will remove. Thanks.", "author": "cachedout", "createdAt": "2020-11-03T10:53:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjU3NDY2Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjU3NTg4NA==", "url": "https://github.com/elastic/apm-agent-java/pull/1467#discussion_r516575884", "bodyText": "we usually put the APM URL and the APM token in a Vault secret", "author": "kuisathaverat", "createdAt": "2020-11-03T10:48:12Z", "path": ".ci/load/Jenkinsfile", "diffHunk": "@@ -0,0 +1,170 @@\n+// For documentation on this pipeline, please see the README.md in this directory\n+pipeline {\n+    agent any\n+    environment {\n+        REPO = 'apm-agent-java'\n+        APP = 'spring-petclinic'\n+        APP_BASE_DIR = \"src/${APP}\"\n+        METRICS_BASE_DIR=\"metrics/\"\n+        AGENT_BASE_DIR = \"agent/\"\n+        ORCH_URL = 'obs-load-orch.app.elastic.co:8000'\n+        // Set below for local development\n+        // ORCH_URL='10.0.2.2:8000'\n+        DEBUG_MODE = '0' // set to '0' for production\n+        // This is a placeholder server. This will change to a dummy APM Server when it is available.\n+        APM_SERVER_URL = 'https://2a2bd0e2806a47e5996eeeec6d22e6df.apm.eu-west-3.aws.elastic-cloud.com:443'", "originalCommit": "8329f488a2909b4b4d73dc227981bb7734a4141b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjU4MDAzNQ==", "url": "https://github.com/elastic/apm-agent-java/pull/1467#discussion_r516580035", "bodyText": "The token is in a secret but I left the URL public. I'll change it.", "author": "cachedout", "createdAt": "2020-11-03T10:55:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjU3NTg4NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA1Mjc3NA==", "url": "https://github.com/elastic/apm-agent-java/pull/1467#discussion_r518052774", "bodyText": "does not seem to be resolved yet? not sure if that's a nice-to-have or a requirement @kuisathaverat?", "author": "felixbarny", "createdAt": "2020-11-05T13:33:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjU3NTg4NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA4MDk2MQ==", "url": "https://github.com/elastic/apm-agent-java/pull/1467#discussion_r518080961", "bodyText": "This is my mistake. I accidentally resolved this thread. I'll update this as well.", "author": "cachedout", "createdAt": "2020-11-05T14:13:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjU3NTg4NA=="}], "type": "inlineReview"}, {"oid": "b7d53c2b04c553620901218c40cd5b5904e094cb", "url": "https://github.com/elastic/apm-agent-java/commit/b7d53c2b04c553620901218c40cd5b5904e094cb", "message": "Fix bad merge", "committedDate": "2020-11-03T10:54:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjU4MDk1MA==", "url": "https://github.com/elastic/apm-agent-java/pull/1467#discussion_r516580950", "bodyText": "I think we can make a step in the library that collects all the version from https://jvm-catalog.elastic.co/jdks", "author": "kuisathaverat", "createdAt": "2020-11-03T10:56:57Z", "path": ".ci/load/Jenkinsfile", "diffHunk": "@@ -0,0 +1,170 @@\n+// For documentation on this pipeline, please see the README.md in this directory\n+pipeline {\n+    agent any\n+    environment {\n+        REPO = 'apm-agent-java'\n+        APP = 'spring-petclinic'\n+        APP_BASE_DIR = \"src/${APP}\"\n+        METRICS_BASE_DIR=\"metrics/\"\n+        AGENT_BASE_DIR = \"agent/\"\n+        ORCH_URL = 'obs-load-orch.app.elastic.co:8000'\n+        // Set below for local development\n+        // ORCH_URL='10.0.2.2:8000'\n+        DEBUG_MODE = '0' // set to '0' for production\n+        // This is a placeholder server. This will change to a dummy APM Server when it is available.\n+        APM_SERVER_URL = 'https://2a2bd0e2806a47e5996eeeec6d22e6df.apm.eu-west-3.aws.elastic-cloud.com:443'\n+        LOCUST_RUN_TIME = \"${params.duration}\"\n+        LOCUST_USERS = \"${params.concurrent_requests}\"\n+\n+    }\n+    options {\n+        timeout(time: 3, unit: 'HOURS')\n+        buildDiscarder(logRotator(numToKeepStr: '20', artifactNumToKeepStr: '20', daysToKeepStr: '30'))\n+        timestamps()\n+        ansiColor('xterm')\n+        durabilityHint('PERFORMANCE_OPTIMIZED')\n+\n+    }\n+    parameters {\n+        // The following snippet is auto-generated. To update it, run the script located in .ci/load/scripts/param_gen and copy in the output\n+        choice(choices: ['1.18.1', '1.18.0', '1.18.0.RC1', '1.17.0', '1.16.0', '1.15.0', '1.14.0', '1.13.0', '1.12.0', '1.11.0', '1.10.0', '1.9.0', '1.8.0', '1.7.0', '1.6.1', '1.6.0', '1.5.0', '1.4.0', '1.3.0', '1.2.0', '1.1.0', '1.0.1', '1.0.0', '1.0.0.RC1', '0.7.1', '0.7.0', '0.6.2', '0.6.1', '0.6.0', '0.5.1', '0.1.2', '0.1.1'], name: \"apm_version\", description: \"APM Java Agent version\")\n+        choice(choices: ['adoptopenjdk-11+28-linux', 'adoptopenjdk-11.0.1+13-linux', 'adoptopenjdk-11.0.1+13-linux-aarch64', 'adoptopenjdk-11.0.2+7-linux', 'adoptopenjdk-11.0.2+7-linux-aarch64', 'adoptopenjdk-11.0.2+9-linux', 'adoptopenjdk-11.0.2+9-linux-aarch64', 'adoptopenjdk-11.0.3+7-linux', 'adoptopenjdk-11.0.3+7-linux-aarch64', 'adoptopenjdk-11.0.4+11-linux', 'adoptopenjdk-11.0.4+11-linux-aarch64', 'adoptopenjdk-11.0.5+10-linux', 'adoptopenjdk-11.0.6+10-linux', 'adoptopenjdk-11.0.6+10-linux-aarch64', 'adoptopenjdk-11.0.7+10-linux', 'adoptopenjdk-11.0.7+10-linux-aarch64', 'adoptopenjdk-11.0.8+10-linux', 'adoptopenjdk-11.0.8+10-linux-aarch64', 'adoptopenjdk-11.0.9+11-linux', 'adoptopenjdk-11.0.9+11-linux-aarch64', 'adoptopenjdk-12+33-linux', 'adoptopenjdk-12.0.1+12-linux', 'adoptopenjdk-12.0.1+12-linux-aarch64', 'adoptopenjdk-12.0.2+10-linux', 'adoptopenjdk-12.0.2+10-linux-aarch64', 'adoptopenjdk-13.0.1+9-linux', 'adoptopenjdk-13.0.2+8-linux', 'adoptopenjdk-13.0.2+8-linux-aarch64', 'adoptopenjdk-14.0.1+7-linux', 'adoptopenjdk-14.0.1+7-linux-aarch64', 'adoptopenjdk-14.0.2+12-linux', 'adoptopenjdk-14.0.2+12-linux-aarch64', 'adoptopenjdk-15+36-linux', 'adoptopenjdk-15+36-linux-aarch64', 'adoptopenjdk-15.0.1+9-linux', 'adoptopenjdk-15.0.1+9-linux-aarch64', 'openjdk-11+11-linux', 'openjdk-11+12-linux', 'openjdk-11+13-linux', 'openjdk-11+14-linux', 'openjdk-11+15-linux', 'openjdk-11+16-linux', 'openjdk-11+17-linux', 'openjdk-11+18-linux', 'openjdk-11+19-linux', 'openjdk-11+20-linux', 'openjdk-11+21-linux', 'openjdk-11+22-linux', 'openjdk-11+23-linux', 'openjdk-11+24-linux', 'openjdk-11+25-linux', 'openjdk-11+26-linux', 'openjdk-11+27-linux', 'openjdk-11+28-linux', 'openjdk-11+5-linux', 'openjdk-11-linux', 'openjdk-11.0.1-linux', 'openjdk-11.0.2-linux', 'openjdk-12+23-linux', 'openjdk-12+24-linux', 'openjdk-12+25-linux', 'openjdk-12+27-linux', 'openjdk-12+28-linux', 'openjdk-12+29-linux', 'openjdk-12+30-linux', 'openjdk-12+31-linux', 'openjdk-12+32-linux', 'openjdk-12+33-linux', 'openjdk-12-linux', 'openjdk-12.0.1-linux', 'openjdk-12.0.2-linux', 'openjdk-13+14-linux', 'openjdk-13+15-linux', 'openjdk-13+16-linux', 'openjdk-13+17-linux', 'openjdk-13+18-linux', 'openjdk-13+19-linux', 'openjdk-13+20-linux', 'openjdk-13+21-linux', 'openjdk-13+22-linux', 'openjdk-13+23-linux', 'openjdk-13+24-linux', 'openjdk-13+25-linux', 'openjdk-13+26-linux', 'openjdk-13+27-linux', 'openjdk-13+28-linux', 'openjdk-13+29-linux', 'openjdk-13+30-linux', 'openjdk-13+31-linux', 'openjdk-13+32-linux', 'openjdk-13-linux', 'openjdk-13.0.1-linux', 'openjdk-13.0.2-linux', 'openjdk-14+10-linux', 'openjdk-14+11-linux', 'openjdk-14+12-linux', 'openjdk-14+13-linux', 'openjdk-14+14-linux', 'openjdk-14+15-linux', 'openjdk-14+16-linux', 'openjdk-14+17-linux', 'openjdk-14+25-linux', 'openjdk-14+26-linux', 'openjdk-14+27-linux', 'openjdk-14+28-linux', 'openjdk-14+30-linux', 'openjdk-14+31-linux', 'openjdk-14+32-linux', 'openjdk-14+33-linux', 'openjdk-14+34-linux', 'openjdk-14+9-linux', 'openjdk-14-linux', 'openjdk-14.0.1-linux', 'openjdk-14.0.2+12-linux', 'openjdk-14.0.2-linux', 'openjdk-15+10-linux', 'openjdk-15+11-linux', 'openjdk-15+12-linux', 'openjdk-15+13-linux', 'openjdk-15+14-linux', 'openjdk-15+15-linux', 'openjdk-15+16-linux', 'openjdk-15+17-linux', 'openjdk-15+18-linux', 'openjdk-15+19-linux', 'openjdk-15+20-linux', 'openjdk-15+21-linux', 'openjdk-15+22-linux', 'openjdk-15+23-linux', 'openjdk-15+24-linux', 'openjdk-15+25-linux', 'openjdk-15+26-linux', 'openjdk-15+27-linux', 'openjdk-15+28-linux', 'openjdk-15+29-linux', 'openjdk-15+30-linux', 'openjdk-15+31-linux', 'openjdk-15+32-linux', 'openjdk-15+33-linux', 'openjdk-15+34-linux', 'openjdk-15+36-linux', 'openjdk-15+4-linux', 'openjdk-15+5-linux', 'openjdk-15+6-linux', 'openjdk-15+7-linux', 'openjdk-15+8-linux', 'openjdk-15+9-linux', 'openjdk-15-linux', 'openjdk-15.0.1+9-linux', 'oracle-11+11-linux', 'oracle-11+12-linux', 'oracle-11+13-linux', 'oracle-11+14-linux', 'oracle-11+15-linux', 'oracle-11+16-linux', 'oracle-11+17-linux', 'oracle-11+18-linux', 'oracle-11+19-linux', 'oracle-11+20-linux', 'oracle-11+21-linux', 'oracle-11+22-linux', 'oracle-11+23-linux', 'oracle-11+24-linux', 'oracle-11+25-linux', 'oracle-11+26-linux', 'oracle-11+27-linux', 'oracle-11+28-linux', 'oracle-11+5-linux', 'oracle-11.0.2+7-linux', 'oracle-11.0.2+9-linux', 'oracle-11.0.3+12-linux', 'oracle-11.0.4+10-linux', 'oracle-11.0.5+10-linux', 'oracle-11.0.6+8-linux', 'oracle-12+33-linux', 'oracle-12.0.1+12-linux', 'oracle-12.0.2+10-linux', 'oracle-13+33-linux', 'oracle-13.0.1+9-linux', 'oracle-13.0.2+8-linux', 'zulu-11.0.1-linux', 'zulu-11.0.2-linux', 'zulu-11.0.3-linux', 'zulu-11.0.4-linux', 'zulu-11.0.5-linux', 'zulu-11.0.6-linux', 'zulu-11.0.7-linux', 'zulu-11.0.8-linux', 'zulu-11.0.9-linux', 'zulu-12-linux', 'zulu-12.0.0-linux', 'zulu-12.0.1-linux', 'zulu-12.0.2-linux', 'zulu-13-linux', 'zulu-13.0.0-linux', 'zulu-13.0.1-linux', 'zulu-13.0.2-linux', 'zulu-13.0.3-linux', 'zulu-13.0.4-linux', 'zulu-13.0.5-linux', 'zulu-14-linux', 'zulu-14.0.0-linux', 'zulu-14.0.1-linux', 'zulu-14.0.2-linux', 'zulu-15.0.0-linux', 'zulu-15.0.1-linux'], name: \"jvm_version\", description: \"JVM\")", "originalCommit": "8329f488a2909b4b4d73dc227981bb7734a4141b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjU4MTg1Mw==", "url": "https://github.com/elastic/apm-agent-java/pull/1467#discussion_r516581853", "bodyText": "This PR includes a script which does that collection already, which is how this snippet generated, but it isn't dynamic.", "author": "cachedout", "createdAt": "2020-11-03T10:58:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjU4MDk1MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjcxNjIzMA==", "url": "https://github.com/elastic/apm-agent-java/pull/1467#discussion_r516716230", "bodyText": "I saw the script, I was thinking more about not to have to update that list ever, so a groovy step in the library can grab this list from the URL and short the names, or read that list from some file that is generated and stored daily in the library repo. but yep, it is a follow-up.", "author": "kuisathaverat", "createdAt": "2020-11-03T14:39:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjU4MDk1MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjc3Mjg0Ng==", "url": "https://github.com/elastic/apm-agent-java/pull/1467#discussion_r516772846", "bodyText": "Gotcha. Cool. I agree that this would be a good follow-up. Having this list be dynamic would be much better in the long run.", "author": "cachedout", "createdAt": "2020-11-03T15:54:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjU4MDk1MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4Mjg1MTY3Mw==", "url": "https://github.com/elastic/apm-agent-java/pull/1467#discussion_r582851673", "bodyText": "(Super-late follow-up) This ended up just getting turned into a free-form text field and seems to be just fine, so I don't see a need to build anything fancier for this.", "author": "cachedout", "createdAt": "2021-02-25T13:56:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjU4MDk1MA=="}], "type": "inlineReview"}, {"oid": "cbe6351395b22ec5a3892a4430bfb14901fba624", "url": "https://github.com/elastic/apm-agent-java/commit/cbe6351395b22ec5a3892a4430bfb14901fba624", "message": "Bring number of jdks below 250", "committedDate": "2020-11-05T13:18:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA1MzU3Ng==", "url": "https://github.com/elastic/apm-agent-java/pull/1467#discussion_r518053576", "bodyText": "[minor] for long running stability tests, we might want to have longer or no timeouts", "author": "felixbarny", "createdAt": "2020-11-05T13:34:29Z", "path": ".ci/load/Jenkinsfile", "diffHunk": "@@ -0,0 +1,169 @@\n+// For documentation on this pipeline, please see the README.md in this directory\n+pipeline {\n+    agent any\n+    environment {\n+        REPO = 'apm-agent-java'\n+        APP = 'spring-petclinic'\n+        APP_BASE_DIR = \"src/${APP}\"\n+        METRICS_BASE_DIR=\"metrics/\"\n+        AGENT_BASE_DIR = \"agent/\"\n+        ORCH_URL = 'obs-load-orch.app.elastic.co:8000'\n+        // Set below for local development\n+        // ORCH_URL='10.0.2.2:8000'\n+        DEBUG_MODE = '0' // set to '0' for production\n+        // This is a placeholder server. This will change to a dummy APM Server when it is available.\n+        APM_SERVER_URL = 'https://2a2bd0e2806a47e5996eeeec6d22e6df.apm.eu-west-3.aws.elastic-cloud.com:443'\n+        LOCUST_RUN_TIME = \"${params.duration}\"\n+        LOCUST_USERS = \"${params.concurrent_requests}\"\n+\n+    }\n+    options {\n+        timeout(time: 3, unit: 'HOURS')", "originalCommit": "cbe6351395b22ec5a3892a4430bfb14901fba624", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA2NDM0MQ==", "url": "https://github.com/elastic/apm-agent-java/pull/1467#discussion_r518064341", "bodyText": "How about I set this to 72 hours for now which should be more than long enough and then we can re-visit it if we find a need for multi-day tests? Let me know if that sounds all right.", "author": "cachedout", "createdAt": "2020-11-05T13:50:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA1MzU3Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA3NDMzNA==", "url": "https://github.com/elastic/apm-agent-java/pull/1467#discussion_r518074334", "bodyText": "sgtm", "author": "felixbarny", "createdAt": "2020-11-05T14:04:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA1MzU3Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA1NTY4NQ==", "url": "https://github.com/elastic/apm-agent-java/pull/1467#discussion_r518055685", "bodyText": "are the workers guaranteed to be the same run-to-run? how many cpu cores do they have?", "author": "felixbarny", "createdAt": "2020-11-05T13:37:40Z", "path": ".ci/load/Jenkinsfile", "diffHunk": "@@ -0,0 +1,169 @@\n+// For documentation on this pipeline, please see the README.md in this directory\n+pipeline {\n+    agent any\n+    environment {\n+        REPO = 'apm-agent-java'\n+        APP = 'spring-petclinic'\n+        APP_BASE_DIR = \"src/${APP}\"\n+        METRICS_BASE_DIR=\"metrics/\"\n+        AGENT_BASE_DIR = \"agent/\"\n+        ORCH_URL = 'obs-load-orch.app.elastic.co:8000'\n+        // Set below for local development\n+        // ORCH_URL='10.0.2.2:8000'\n+        DEBUG_MODE = '0' // set to '0' for production\n+        // This is a placeholder server. This will change to a dummy APM Server when it is available.\n+        APM_SERVER_URL = 'https://2a2bd0e2806a47e5996eeeec6d22e6df.apm.eu-west-3.aws.elastic-cloud.com:443'\n+        LOCUST_RUN_TIME = \"${params.duration}\"\n+        LOCUST_USERS = \"${params.concurrent_requests}\"\n+\n+    }\n+    options {\n+        timeout(time: 3, unit: 'HOURS')\n+        buildDiscarder(logRotator(numToKeepStr: '20', artifactNumToKeepStr: '20', daysToKeepStr: '30'))\n+        timestamps()\n+        ansiColor('xterm')\n+        durabilityHint('PERFORMANCE_OPTIMIZED')\n+\n+    }\n+    parameters {\n+        // The following snippet is auto-generated. To update it, run the script located in .ci/load/scripts/param_gen and copy in the output\n+        choice(choices: ['1.18.1', '1.18.0', '1.18.0.RC1', '1.17.0', '1.16.0', '1.15.0', '1.14.0', '1.13.0', '1.12.0', '1.11.0', '1.10.0', '1.9.0', '1.8.0', '1.7.0', '1.6.1', '1.6.0', '1.5.0', '1.4.0', '1.3.0', '1.2.0', '1.1.0', '1.0.1', '1.0.0', '1.0.0.RC1', '0.7.1', '0.7.0', '0.6.2', '0.6.1', '0.6.0', '0.5.1', '0.1.2', '0.1.1'], name: \"apm_version\", description: \"APM Java Agent version\")\n+        choice(choices: ['adoptopenjdk-11+28-linux', 'adoptopenjdk-11.0.1+13-linux', 'adoptopenjdk-11.0.2+7-linux', 'adoptopenjdk-11.0.2+9-linux', 'adoptopenjdk-11.0.3+7-linux', 'adoptopenjdk-11.0.4+11-linux', 'adoptopenjdk-11.0.5+10-linux', 'adoptopenjdk-11.0.6+10-linux', 'adoptopenjdk-11.0.7+10-linux', 'adoptopenjdk-11.0.8+10-linux', 'adoptopenjdk-11.0.9+11-linux', 'adoptopenjdk-12+33-linux', 'adoptopenjdk-12.0.1+12-linux', 'adoptopenjdk-12.0.2+10-linux', 'adoptopenjdk-13.0.1+9-linux', 'adoptopenjdk-13.0.2+8-linux', 'adoptopenjdk-14.0.1+7-linux', 'adoptopenjdk-14.0.2+12-linux', 'adoptopenjdk-15+36-linux', 'adoptopenjdk-15.0.1+9-linux', 'openjdk-10+43-linux', 'openjdk-10-linux', 'openjdk-10.0.1-linux', 'openjdk-10.0.2-linux', 'openjdk-11+11-linux', 'openjdk-11+12-linux', 'openjdk-11+13-linux', 'openjdk-11+14-linux', 'openjdk-11+15-linux', 'openjdk-11+16-linux', 'openjdk-11+17-linux', 'openjdk-11+18-linux', 'openjdk-11+19-linux', 'openjdk-11+20-linux', 'openjdk-11+21-linux', 'openjdk-11+22-linux', 'openjdk-11+23-linux', 'openjdk-11+24-linux', 'openjdk-11+25-linux', 'openjdk-11+26-linux', 'openjdk-11+27-linux', 'openjdk-11+28-linux', 'openjdk-11+5-linux', 'openjdk-11-linux', 'openjdk-11.0.1-linux', 'openjdk-11.0.2-linux', 'openjdk-12+23-linux', 'openjdk-12+24-linux', 'openjdk-12+25-linux', 'openjdk-12+27-linux', 'openjdk-12+28-linux', 'openjdk-12+29-linux', 'openjdk-12+30-linux', 'openjdk-12+31-linux', 'openjdk-12+32-linux', 'openjdk-12+33-linux', 'openjdk-12-linux', 'openjdk-12.0.1-linux', 'openjdk-12.0.2-linux', 'openjdk-13+14-linux', 'openjdk-13+15-linux', 'openjdk-13+16-linux', 'openjdk-13+17-linux', 'openjdk-13+18-linux', 'openjdk-13+19-linux', 'openjdk-13+20-linux', 'openjdk-13+21-linux', 'openjdk-13+22-linux', 'openjdk-13+23-linux', 'openjdk-13+24-linux', 'openjdk-13+25-linux', 'openjdk-13+26-linux', 'openjdk-13+27-linux', 'openjdk-13+28-linux', 'openjdk-13+29-linux', 'openjdk-13+30-linux', 'openjdk-13+31-linux', 'openjdk-13+32-linux', 'openjdk-13-linux', 'openjdk-13.0.1-linux', 'openjdk-13.0.2-linux', 'openjdk-14+10-linux', 'openjdk-14+11-linux', 'openjdk-14+12-linux', 'openjdk-14+13-linux', 'openjdk-14+14-linux', 'openjdk-14+15-linux', 'openjdk-14+16-linux', 'openjdk-14+17-linux', 'openjdk-14+25-linux', 'openjdk-14+26-linux', 'openjdk-14+27-linux', 'openjdk-14+28-linux', 'openjdk-14+30-linux', 'openjdk-14+31-linux', 'openjdk-14+32-linux', 'openjdk-14+33-linux', 'openjdk-14+34-linux', 'openjdk-14+9-linux', 'openjdk-14-linux', 'openjdk-14.0.1-linux', 'openjdk-14.0.2+12-linux', 'openjdk-14.0.2-linux', 'openjdk-15+10-linux', 'openjdk-15+11-linux', 'openjdk-15+12-linux', 'openjdk-15+13-linux', 'openjdk-15+14-linux', 'openjdk-15+15-linux', 'openjdk-15+16-linux', 'openjdk-15+17-linux', 'openjdk-15+18-linux', 'openjdk-15+19-linux', 'openjdk-15+20-linux', 'openjdk-15+21-linux', 'openjdk-15+22-linux', 'openjdk-15+23-linux', 'openjdk-15+24-linux', 'openjdk-15+25-linux', 'openjdk-15+26-linux', 'openjdk-15+27-linux', 'openjdk-15+28-linux', 'openjdk-15+29-linux', 'openjdk-15+30-linux', 'openjdk-15+31-linux', 'openjdk-15+32-linux', 'openjdk-15+33-linux', 'openjdk-15+34-linux', 'openjdk-15+36-linux', 'openjdk-15+4-linux', 'openjdk-15+5-linux', 'openjdk-15+6-linux', 'openjdk-15+7-linux', 'openjdk-15+8-linux', 'openjdk-15+9-linux', 'openjdk-15-linux', 'openjdk-15.0.1+9-linux', 'openjdk-9.0.4-linux', 'oracle-10+43-linux', 'oracle-10+46-linux', 'oracle-11+11-linux', 'oracle-11+12-linux', 'oracle-11+13-linux', 'oracle-11+14-linux', 'oracle-11+15-linux', 'oracle-11+16-linux', 'oracle-11+17-linux', 'oracle-11+18-linux', 'oracle-11+19-linux', 'oracle-11+20-linux', 'oracle-11+21-linux', 'oracle-11+22-linux', 'oracle-11+23-linux', 'oracle-11+24-linux', 'oracle-11+25-linux', 'oracle-11+26-linux', 'oracle-11+27-linux', 'oracle-11+28-linux', 'oracle-11+5-linux', 'oracle-11.0.2+7-linux', 'oracle-11.0.2+9-linux', 'oracle-11.0.3+12-linux', 'oracle-11.0.4+10-linux', 'oracle-11.0.5+10-linux', 'oracle-11.0.6+8-linux', 'oracle-12+33-linux', 'oracle-12.0.1+12-linux', 'oracle-12.0.2+10-linux', 'oracle-13+33-linux', 'oracle-13.0.1+9-linux', 'oracle-13.0.2+8-linux', 'oracle-9.0.4+11-linux', 'zulu-10.0.0-linux', 'zulu-10.0.1-linux', 'zulu-10.0.2-linux', 'zulu-11.0.1-linux', 'zulu-11.0.2-linux', 'zulu-11.0.3-linux', 'zulu-11.0.4-linux', 'zulu-11.0.5-linux', 'zulu-11.0.6-linux', 'zulu-11.0.7-linux', 'zulu-11.0.8-linux', 'zulu-11.0.9-linux', 'zulu-12-linux', 'zulu-12.0.0-linux', 'zulu-12.0.1-linux', 'zulu-12.0.2-linux', 'zulu-13-linux', 'zulu-13.0.0-linux', 'zulu-13.0.1-linux', 'zulu-13.0.2-linux', 'zulu-13.0.3-linux', 'zulu-13.0.4-linux', 'zulu-13.0.5-linux', 'zulu-14-linux', 'zulu-14.0.0-linux', 'zulu-14.0.1-linux', 'zulu-14.0.2-linux', 'zulu-15.0.0-linux', 'zulu-15.0.1-linux', 'zulu-7.0.101-linux', 'zulu-7.0.111-linux', 'zulu-7.0.121-linux', 'zulu-7.0.131-linux', 'zulu-7.0.141-linux', 'zulu-7.0.154-linux', 'zulu-7.0.161-linux', 'zulu-7.0.171-linux', 'zulu-7.0.181-linux', 'zulu-7.0.191-linux', 'zulu-7.0.201-linux', 'zulu-7.0.211-linux', 'zulu-7.0.222-linux', 'zulu-7.0.232-linux', 'zulu-7.0.242-linux', 'zulu-7.0.252-linux', 'zulu-7.0.262-linux', 'zulu-7.0.272-linux', 'zulu-7.0.282-linux', 'zulu-7.0.95-linux', 'zulu-8.0.102-linux', 'zulu-8.0.112-linux', 'zulu-8.0.121-linux', 'zulu-8.0.131-linux', 'zulu-8.0.144-linux', 'zulu-8.0.152-linux', 'zulu-8.0.162-linux', 'zulu-8.0.163-linux', 'zulu-8.0.172-linux', 'zulu-8.0.181-linux', 'zulu-8.0.192-linux', 'zulu-8.0.201-linux', 'zulu-8.0.202-linux', 'zulu-8.0.212-linux', 'zulu-8.0.222-linux', 'zulu-8.0.232-linux', 'zulu-8.0.242-linux', 'zulu-8.0.252-linux', 'zulu-8.0.262-linux', 'zulu-8.0.265-linux', 'zulu-8.0.272-linux', 'zulu-8.0.71-linux', 'zulu-8.0.72-linux', 'zulu-8.0.91-linux', 'zulu-8.0.92-linux', 'zulu-9.0.0-linux', 'zulu-9.0.1-linux', 'zulu-9.0.4-linux', 'zulu-9.0.7-linux'], name: \"jvm_version\", description: \"JVM\")\n+        string(name: \"concurrent_requests\", defaultValue: \"100\", description: \"The number of concurrent requests to test with\")\n+        string(name: \"duration\", defaultValue: \"10\", description: \"Test duration in minutes. Max: 280\")\n+        // num_of_runs currently unsupported\n+        // string(name: \"num_of_runs\", defaultValue: \"1\", description: \"Number of test runs to execute\")\n+        text(name: \"agent_config\", \"defaultValue\": \"\", description: \"Custom APM Agent configuration. (WARNING: May echo to console. Do not supply sensitive data.)\")\n+        text(name: \"locustfile\", \"defaultValue\": \"\", description: \"Locust load-generator plan\")\n+        booleanParam(name: \"local_metrics\", description: \"Enable local metrics collection?\", defaultValue: false)\n+        // End script auto-generation\n+    }\n+\n+    stages {\n+        stage('Pre-flight'){\n+            steps {\n+                echo 'Getting authentication information from Vault'\n+                withSecretVault(secret: 'secret/apm-team/ci/bandstand', user_var_name: 'APP_TOKEN_TYPE', pass_var_name: 'APP_TOKEN'){\n+                    setEnvVar('SESSION_TOKEN', sh(script: \".ci/load/scripts/start.sh\", returnStdout: true).trim())\n+                }\n+            }    \n+        }\n+        stage('Load test') {\n+            parallel {\n+                stage('Load generation') {\n+                    agent { label 'metal' }\n+                    steps {\n+                            withSecretVault(secret: 'secret/apm-team/ci/bandstand', user_var_name: 'APP_TOKEN_TYPE', pass_var_name: 'APP_TOKEN'){\n+                                echo 'Preparing load generation..'\n+                                whenTrue(Boolean.valueOf(params.locustfile)) {\n+                                    echo 'Using user-supplied plan for load-generation with Locust'\n+                                    sh script: \"echo \\\"${params.locustfile}\\\">.ci/load/scripts/locustfile.py\"\n+                                }\n+                                sh(script: \".ci/load/scripts/load_agent.sh\")\n+                            }\n+                    }\n+                }\n+                stage('Test application') {\n+                    agent { label 'metal' }", "originalCommit": "cbe6351395b22ec5a3892a4430bfb14901fba624", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA3NTQzOQ==", "url": "https://github.com/elastic/apm-agent-java/pull/1467#discussion_r518075439", "bodyText": "This is an important discussion point. Thanks for bringing it up!\nThe tl;dr here is that they should be the same but an absolute guarantee is challenging. For example, the ES Performance Testing team has a fleet of machines but have discovered over time that there are going to be variances even when they try hard to avoid them. SSDs in arrays fail, machines aren't tagged the same way by the provider but aren't physically identical, etc, etc.\nSo, where does that leave us? I think the best thing to do here is to be cautious about comparing results between runs but that we continue to enhance this pipeline to support scenarios where we can run multiple invocations of a single test scenario multiple times on what we can guarantee to be the same machine(s) and maybe even some sort of comparative logic as well. (So, run scenario A and the scenario B on the same machine and output the results.)\nI'm also going to file an issue in the infra repo to try to get an audit underway so we can know a bit more about what divergence we do have currently. As mentioned earlier, it should be a lot but it may be some. Additionally, we'll investigate the possibility of creating some dedicated groups of machines which we can try to ensure are as similar as we can make them instead of just assuming that they're similar, which is essentially the strategy that's in place right now.", "author": "cachedout", "createdAt": "2020-11-05T14:05:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA1NTY4NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODEzOTYzNA==", "url": "https://github.com/elastic/apm-agent-java/pull/1467#discussion_r518139634", "bodyText": "Some additional data here:\nWe have four workers right now, all of which vary in subtle ways. I propose that we make the following changes:\n\nPin the stage that runs the application to the same worker every time. We can do this by using the benchmark label, which currently is only assigned to one machine. That machine has the following specs:\n\n\nUbuntu 18.04\n6CPUs\n64 GB\n\n\n\nWe keep the load-generation stage marked as metal which will allow it to float between the other bare-metal machines which have slightly varying specs. However, there's not much reason to believe that they vary enough to modify the behavior of the load-generation script, which doesn't consume a great deal of resources at present.\n\n\nWe decide on a plan to order some additional machines which we can put into the benchmark pool which will ensure better consistency going forward.\n\n\n(I will link backward from a ticket which provides more info, so we don't link from a public repo into a private one.)\nLet me know how this sounds @felixbarny and @v1v and if you give a \ud83d\udc4d I will make the necessary change.", "author": "cachedout", "createdAt": "2020-11-05T15:30:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA1NTY4NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODE1MDIxOQ==", "url": "https://github.com/elastic/apm-agent-java/pull/1467#discussion_r518150219", "bodyText": "\ud83d\udc4d", "author": "felixbarny", "createdAt": "2020-11-05T15:41:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA1NTY4NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA2MjAzOA==", "url": "https://github.com/elastic/apm-agent-java/pull/1467#discussion_r518062038", "bodyText": "a likely feature request in the future will be to  checkout specific revisions or master", "author": "felixbarny", "createdAt": "2020-11-05T13:47:06Z", "path": ".ci/load/Jenkinsfile", "diffHunk": "@@ -0,0 +1,169 @@\n+// For documentation on this pipeline, please see the README.md in this directory\n+pipeline {\n+    agent any\n+    environment {\n+        REPO = 'apm-agent-java'\n+        APP = 'spring-petclinic'\n+        APP_BASE_DIR = \"src/${APP}\"\n+        METRICS_BASE_DIR=\"metrics/\"\n+        AGENT_BASE_DIR = \"agent/\"\n+        ORCH_URL = 'obs-load-orch.app.elastic.co:8000'\n+        // Set below for local development\n+        // ORCH_URL='10.0.2.2:8000'\n+        DEBUG_MODE = '0' // set to '0' for production\n+        // This is a placeholder server. This will change to a dummy APM Server when it is available.\n+        APM_SERVER_URL = 'https://2a2bd0e2806a47e5996eeeec6d22e6df.apm.eu-west-3.aws.elastic-cloud.com:443'\n+        LOCUST_RUN_TIME = \"${params.duration}\"\n+        LOCUST_USERS = \"${params.concurrent_requests}\"\n+\n+    }\n+    options {\n+        timeout(time: 3, unit: 'HOURS')\n+        buildDiscarder(logRotator(numToKeepStr: '20', artifactNumToKeepStr: '20', daysToKeepStr: '30'))\n+        timestamps()\n+        ansiColor('xterm')\n+        durabilityHint('PERFORMANCE_OPTIMIZED')\n+\n+    }\n+    parameters {\n+        // The following snippet is auto-generated. To update it, run the script located in .ci/load/scripts/param_gen and copy in the output\n+        choice(choices: ['1.18.1', '1.18.0', '1.18.0.RC1', '1.17.0', '1.16.0', '1.15.0', '1.14.0', '1.13.0', '1.12.0', '1.11.0', '1.10.0', '1.9.0', '1.8.0', '1.7.0', '1.6.1', '1.6.0', '1.5.0', '1.4.0', '1.3.0', '1.2.0', '1.1.0', '1.0.1', '1.0.0', '1.0.0.RC1', '0.7.1', '0.7.0', '0.6.2', '0.6.1', '0.6.0', '0.5.1', '0.1.2', '0.1.1'], name: \"apm_version\", description: \"APM Java Agent version\")\n+        choice(choices: ['adoptopenjdk-11+28-linux', 'adoptopenjdk-11.0.1+13-linux', 'adoptopenjdk-11.0.2+7-linux', 'adoptopenjdk-11.0.2+9-linux', 'adoptopenjdk-11.0.3+7-linux', 'adoptopenjdk-11.0.4+11-linux', 'adoptopenjdk-11.0.5+10-linux', 'adoptopenjdk-11.0.6+10-linux', 'adoptopenjdk-11.0.7+10-linux', 'adoptopenjdk-11.0.8+10-linux', 'adoptopenjdk-11.0.9+11-linux', 'adoptopenjdk-12+33-linux', 'adoptopenjdk-12.0.1+12-linux', 'adoptopenjdk-12.0.2+10-linux', 'adoptopenjdk-13.0.1+9-linux', 'adoptopenjdk-13.0.2+8-linux', 'adoptopenjdk-14.0.1+7-linux', 'adoptopenjdk-14.0.2+12-linux', 'adoptopenjdk-15+36-linux', 'adoptopenjdk-15.0.1+9-linux', 'openjdk-10+43-linux', 'openjdk-10-linux', 'openjdk-10.0.1-linux', 'openjdk-10.0.2-linux', 'openjdk-11+11-linux', 'openjdk-11+12-linux', 'openjdk-11+13-linux', 'openjdk-11+14-linux', 'openjdk-11+15-linux', 'openjdk-11+16-linux', 'openjdk-11+17-linux', 'openjdk-11+18-linux', 'openjdk-11+19-linux', 'openjdk-11+20-linux', 'openjdk-11+21-linux', 'openjdk-11+22-linux', 'openjdk-11+23-linux', 'openjdk-11+24-linux', 'openjdk-11+25-linux', 'openjdk-11+26-linux', 'openjdk-11+27-linux', 'openjdk-11+28-linux', 'openjdk-11+5-linux', 'openjdk-11-linux', 'openjdk-11.0.1-linux', 'openjdk-11.0.2-linux', 'openjdk-12+23-linux', 'openjdk-12+24-linux', 'openjdk-12+25-linux', 'openjdk-12+27-linux', 'openjdk-12+28-linux', 'openjdk-12+29-linux', 'openjdk-12+30-linux', 'openjdk-12+31-linux', 'openjdk-12+32-linux', 'openjdk-12+33-linux', 'openjdk-12-linux', 'openjdk-12.0.1-linux', 'openjdk-12.0.2-linux', 'openjdk-13+14-linux', 'openjdk-13+15-linux', 'openjdk-13+16-linux', 'openjdk-13+17-linux', 'openjdk-13+18-linux', 'openjdk-13+19-linux', 'openjdk-13+20-linux', 'openjdk-13+21-linux', 'openjdk-13+22-linux', 'openjdk-13+23-linux', 'openjdk-13+24-linux', 'openjdk-13+25-linux', 'openjdk-13+26-linux', 'openjdk-13+27-linux', 'openjdk-13+28-linux', 'openjdk-13+29-linux', 'openjdk-13+30-linux', 'openjdk-13+31-linux', 'openjdk-13+32-linux', 'openjdk-13-linux', 'openjdk-13.0.1-linux', 'openjdk-13.0.2-linux', 'openjdk-14+10-linux', 'openjdk-14+11-linux', 'openjdk-14+12-linux', 'openjdk-14+13-linux', 'openjdk-14+14-linux', 'openjdk-14+15-linux', 'openjdk-14+16-linux', 'openjdk-14+17-linux', 'openjdk-14+25-linux', 'openjdk-14+26-linux', 'openjdk-14+27-linux', 'openjdk-14+28-linux', 'openjdk-14+30-linux', 'openjdk-14+31-linux', 'openjdk-14+32-linux', 'openjdk-14+33-linux', 'openjdk-14+34-linux', 'openjdk-14+9-linux', 'openjdk-14-linux', 'openjdk-14.0.1-linux', 'openjdk-14.0.2+12-linux', 'openjdk-14.0.2-linux', 'openjdk-15+10-linux', 'openjdk-15+11-linux', 'openjdk-15+12-linux', 'openjdk-15+13-linux', 'openjdk-15+14-linux', 'openjdk-15+15-linux', 'openjdk-15+16-linux', 'openjdk-15+17-linux', 'openjdk-15+18-linux', 'openjdk-15+19-linux', 'openjdk-15+20-linux', 'openjdk-15+21-linux', 'openjdk-15+22-linux', 'openjdk-15+23-linux', 'openjdk-15+24-linux', 'openjdk-15+25-linux', 'openjdk-15+26-linux', 'openjdk-15+27-linux', 'openjdk-15+28-linux', 'openjdk-15+29-linux', 'openjdk-15+30-linux', 'openjdk-15+31-linux', 'openjdk-15+32-linux', 'openjdk-15+33-linux', 'openjdk-15+34-linux', 'openjdk-15+36-linux', 'openjdk-15+4-linux', 'openjdk-15+5-linux', 'openjdk-15+6-linux', 'openjdk-15+7-linux', 'openjdk-15+8-linux', 'openjdk-15+9-linux', 'openjdk-15-linux', 'openjdk-15.0.1+9-linux', 'openjdk-9.0.4-linux', 'oracle-10+43-linux', 'oracle-10+46-linux', 'oracle-11+11-linux', 'oracle-11+12-linux', 'oracle-11+13-linux', 'oracle-11+14-linux', 'oracle-11+15-linux', 'oracle-11+16-linux', 'oracle-11+17-linux', 'oracle-11+18-linux', 'oracle-11+19-linux', 'oracle-11+20-linux', 'oracle-11+21-linux', 'oracle-11+22-linux', 'oracle-11+23-linux', 'oracle-11+24-linux', 'oracle-11+25-linux', 'oracle-11+26-linux', 'oracle-11+27-linux', 'oracle-11+28-linux', 'oracle-11+5-linux', 'oracle-11.0.2+7-linux', 'oracle-11.0.2+9-linux', 'oracle-11.0.3+12-linux', 'oracle-11.0.4+10-linux', 'oracle-11.0.5+10-linux', 'oracle-11.0.6+8-linux', 'oracle-12+33-linux', 'oracle-12.0.1+12-linux', 'oracle-12.0.2+10-linux', 'oracle-13+33-linux', 'oracle-13.0.1+9-linux', 'oracle-13.0.2+8-linux', 'oracle-9.0.4+11-linux', 'zulu-10.0.0-linux', 'zulu-10.0.1-linux', 'zulu-10.0.2-linux', 'zulu-11.0.1-linux', 'zulu-11.0.2-linux', 'zulu-11.0.3-linux', 'zulu-11.0.4-linux', 'zulu-11.0.5-linux', 'zulu-11.0.6-linux', 'zulu-11.0.7-linux', 'zulu-11.0.8-linux', 'zulu-11.0.9-linux', 'zulu-12-linux', 'zulu-12.0.0-linux', 'zulu-12.0.1-linux', 'zulu-12.0.2-linux', 'zulu-13-linux', 'zulu-13.0.0-linux', 'zulu-13.0.1-linux', 'zulu-13.0.2-linux', 'zulu-13.0.3-linux', 'zulu-13.0.4-linux', 'zulu-13.0.5-linux', 'zulu-14-linux', 'zulu-14.0.0-linux', 'zulu-14.0.1-linux', 'zulu-14.0.2-linux', 'zulu-15.0.0-linux', 'zulu-15.0.1-linux', 'zulu-7.0.101-linux', 'zulu-7.0.111-linux', 'zulu-7.0.121-linux', 'zulu-7.0.131-linux', 'zulu-7.0.141-linux', 'zulu-7.0.154-linux', 'zulu-7.0.161-linux', 'zulu-7.0.171-linux', 'zulu-7.0.181-linux', 'zulu-7.0.191-linux', 'zulu-7.0.201-linux', 'zulu-7.0.211-linux', 'zulu-7.0.222-linux', 'zulu-7.0.232-linux', 'zulu-7.0.242-linux', 'zulu-7.0.252-linux', 'zulu-7.0.262-linux', 'zulu-7.0.272-linux', 'zulu-7.0.282-linux', 'zulu-7.0.95-linux', 'zulu-8.0.102-linux', 'zulu-8.0.112-linux', 'zulu-8.0.121-linux', 'zulu-8.0.131-linux', 'zulu-8.0.144-linux', 'zulu-8.0.152-linux', 'zulu-8.0.162-linux', 'zulu-8.0.163-linux', 'zulu-8.0.172-linux', 'zulu-8.0.181-linux', 'zulu-8.0.192-linux', 'zulu-8.0.201-linux', 'zulu-8.0.202-linux', 'zulu-8.0.212-linux', 'zulu-8.0.222-linux', 'zulu-8.0.232-linux', 'zulu-8.0.242-linux', 'zulu-8.0.252-linux', 'zulu-8.0.262-linux', 'zulu-8.0.265-linux', 'zulu-8.0.272-linux', 'zulu-8.0.71-linux', 'zulu-8.0.72-linux', 'zulu-8.0.91-linux', 'zulu-8.0.92-linux', 'zulu-9.0.0-linux', 'zulu-9.0.1-linux', 'zulu-9.0.4-linux', 'zulu-9.0.7-linux'], name: \"jvm_version\", description: \"JVM\")\n+        string(name: \"concurrent_requests\", defaultValue: \"100\", description: \"The number of concurrent requests to test with\")\n+        string(name: \"duration\", defaultValue: \"10\", description: \"Test duration in minutes. Max: 280\")\n+        // num_of_runs currently unsupported\n+        // string(name: \"num_of_runs\", defaultValue: \"1\", description: \"Number of test runs to execute\")\n+        text(name: \"agent_config\", \"defaultValue\": \"\", description: \"Custom APM Agent configuration. (WARNING: May echo to console. Do not supply sensitive data.)\")\n+        text(name: \"locustfile\", \"defaultValue\": \"\", description: \"Locust load-generator plan\")\n+        booleanParam(name: \"local_metrics\", description: \"Enable local metrics collection?\", defaultValue: false)\n+        // End script auto-generation\n+    }\n+\n+    stages {\n+        stage('Pre-flight'){\n+            steps {\n+                echo 'Getting authentication information from Vault'\n+                withSecretVault(secret: 'secret/apm-team/ci/bandstand', user_var_name: 'APP_TOKEN_TYPE', pass_var_name: 'APP_TOKEN'){\n+                    setEnvVar('SESSION_TOKEN', sh(script: \".ci/load/scripts/start.sh\", returnStdout: true).trim())\n+                }\n+            }    \n+        }\n+        stage('Load test') {\n+            parallel {\n+                stage('Load generation') {\n+                    agent { label 'metal' }\n+                    steps {\n+                            withSecretVault(secret: 'secret/apm-team/ci/bandstand', user_var_name: 'APP_TOKEN_TYPE', pass_var_name: 'APP_TOKEN'){\n+                                echo 'Preparing load generation..'\n+                                whenTrue(Boolean.valueOf(params.locustfile)) {\n+                                    echo 'Using user-supplied plan for load-generation with Locust'\n+                                    sh script: \"echo \\\"${params.locustfile}\\\">.ci/load/scripts/locustfile.py\"\n+                                }\n+                                sh(script: \".ci/load/scripts/load_agent.sh\")\n+                            }\n+                    }\n+                }\n+                stage('Test application') {\n+                    agent { label 'metal' }\n+                    stages{\n+                        stage('Provision Java') {\n+                            steps {\n+                                echo \"Provisioning Java version: ${params.jvm_version}\"\n+                                setEnvVar('JAVA_HOME', sh(script: \".ci/load/scripts/fetch_sdk.sh ${params.jvm_version}\", returnStdout: true).trim())\n+                                setEnvVar('JAVACMD', \"${env.JAVA_HOME}/bin/java\")\n+                                setEnvVar('PATH', \"${env.JAVA_HOME}/bin:$PATH\")\n+                            }\n+                        }\n+                        stage ('Provision agent') {\n+                            steps {\n+                                echo 'Checking out master branch'\n+                                dir(\"${AGENT_BASE_DIR}\") {\n+                                    gitCheckout(\n+                                        basedir: \"apm-agent-java\",\n+                                        branch: 'master',\n+                                        repo: \"https://github.com/elastic/${REPO}.git\",\n+                                        credentialsId: 'f6c7695a-671e-4f4f-a331-acdce44ff9ba',\n+                                        shallow: false\n+                                    )\n+                                    dir(\"apm-agent-java\"){\n+                                        echo 'Switching to requested version'\n+                                        sh(script: \"git checkout v${params.apm_version}\")", "originalCommit": "cbe6351395b22ec5a3892a4430bfb14901fba624", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA3Njk4OA==", "url": "https://github.com/elastic/apm-agent-java/pull/1467#discussion_r518076988", "bodyText": "Aye. I bumped that (in my head) to an upcoming iteration but it should be do-able, no problem.", "author": "cachedout", "createdAt": "2020-11-05T14:08:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA2MjAzOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4Mjg0MDExMg==", "url": "https://github.com/elastic/apm-agent-java/pull/1467#discussion_r582840112", "bodyText": "(Very delayed follow-up) It looks like this is now handled and that hashes can be passed in.", "author": "cachedout", "createdAt": "2021-02-25T13:41:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA2MjAzOA=="}], "type": "inlineReview"}, {"oid": "7ce0452975eb6f1b4e5547558369d0b4b714f66f", "url": "https://github.com/elastic/apm-agent-java/commit/7ce0452975eb6f1b4e5547558369d0b4b714f66f", "message": "Increase timeout", "committedDate": "2020-11-05T14:42:43Z", "type": "commit"}, {"oid": "b76a251d87c5184de3ca7d644b6a7cd99548a4ba", "url": "https://github.com/elastic/apm-agent-java/commit/b76a251d87c5184de3ca7d644b6a7cd99548a4ba", "message": "Hide server URL", "committedDate": "2020-11-05T15:23:54Z", "type": "commit"}, {"oid": "719b5851d7ed5f575618cb01ad0e16c0974d2bf7", "url": "https://github.com/elastic/apm-agent-java/commit/719b5851d7ed5f575618cb01ad0e16c0974d2bf7", "message": "Switch app to benchmark label", "committedDate": "2020-11-05T15:46:01Z", "type": "commit"}]}