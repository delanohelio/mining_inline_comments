{"pr_number": 1525, "pr_title": "[load test] Use 7.x application when Java 7 is requested", "pr_createdAt": "2020-11-20T17:00:28Z", "pr_url": "https://github.com/elastic/apm-agent-java/pull/1525", "timeline": [{"oid": "6639b0d3d359fa1a22a5d5ee848e50be044c7501", "url": "https://github.com/elastic/apm-agent-java/commit/6639b0d3d359fa1a22a5d5ee848e50be044c7501", "message": "[load test] Use 7.x application when Java 7 is requested", "committedDate": "2020-11-20T16:58:52Z", "type": "commit"}, {"oid": "7308cc859c1724ee51587cc3b7a11ce7e340d5e0", "url": "https://github.com/elastic/apm-agent-java/commit/7308cc859c1724ee51587cc3b7a11ce7e340d5e0", "message": "newline", "committedDate": "2020-11-20T17:00:54Z", "type": "commit"}, {"oid": "27975321d8ef199cbe556cf4a977bd474ee0f8fd", "url": "https://github.com/elastic/apm-agent-java/commit/27975321d8ef199cbe556cf4a977bd474ee0f8fd", "message": "Change 7.x invocation", "committedDate": "2020-11-20T18:08:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzkwOTE4MQ==", "url": "https://github.com/elastic/apm-agent-java/pull/1525#discussion_r527909181", "bodyText": "[minor style] maybe would be slightly easier to read with a variable to hold the target binary as the only difference is\n./target/petclinic.war\n./target/spring-petclinic-*.jar", "author": "SylvainJuge", "createdAt": "2020-11-20T18:56:23Z", "path": ".ci/load/Jenkinsfile", "diffHunk": "@@ -163,7 +163,15 @@ pipeline {\n                                         // Start with packaging things up\n                                         sh(script: \"./mvnw package\")\n                                         echo \"start application with JVM options '${params.jvm_options}'\"\n-                                        sh(script: \"java -jar -javaagent:${WORKSPACE}/${AGENT_BASE_DIR}/apm-agent-java/elastic-apm-agent/target/elastic-apm-agent-${params.apm_version}.jar -Delastic.apm.server_urls=${env.APM_SERVER_URL} -Delastic.apm.secret_token=${env.ELASTIC_APM_API_KEY} ${params.jvm_options} -XX:+FlightRecorder -XX:StartFlightRecording=filename=flight.jfr ./target/spring-petclinic-*.jar &\")\n+                                        script {\n+                                            def ver = sh(script: \".ci/load/scripts/java_major.sh ${params.jvm_version}\", returnStdout: true).trim()\n+                                            if(ver == '7'){\n+                                                echo \"Detected 7.x Java version. Switching to 7.x compat mode and calling .war\"\n+                                                sh(script: \"java -jar -javaagent:${WORKSPACE}/${AGENT_BASE_DIR}/apm-agent-java/elastic-apm-agent/target/elastic-apm-agent-${params.apm_version}.jar -Delastic.apm.server_urls=${env.APM_SERVER_URL} -Delastic.apm.secret_token=${env.ELASTIC_APM_API_KEY} ${params.jvm_options} -XX:+FlightRecorder -XX:StartFlightRecording=filename=flight.jfr ./target/petclinic.war &\")", "originalCommit": "27975321d8ef199cbe556cf4a977bd474ee0f8fd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}