{"pr_number": 1464, "pr_title": "Fix spring app name startup exception", "pr_createdAt": "2020-10-30T16:48:07Z", "pr_url": "https://github.com/elastic/apm-agent-java/pull/1464", "timeline": [{"oid": "070ecf6c008290f37eec7b91d22c08ba2cab3950", "url": "https://github.com/elastic/apm-agent-java/commit/070ecf6c008290f37eec7b91d22c08ba2cab3950", "message": "fix set app name on startup", "committedDate": "2020-10-30T16:35:55Z", "type": "commit"}, {"oid": "3187fb0ca4364a1b79ff34cd89ebb71e400f4942", "url": "https://github.com/elastic/apm-agent-java/commit/3187fb0ca4364a1b79ff34cd89ebb71e400f4942", "message": "fix other debug statements", "committedDate": "2020-10-30T16:36:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTIzOTQ2Mg==", "url": "https://github.com/elastic/apm-agent-java/pull/1464#discussion_r515239462", "bodyText": "Better guard against null. I've seen servletContext.getContextPath() return null on some application servers.", "author": "felixbarny", "createdAt": "2020-10-30T16:55:10Z", "path": "apm-agent-plugins/apm-spring-webmvc-plugin/src/main/java/co/elastic/apm/agent/springwebmvc/SpringServiceNameInstrumentation.java", "diffHunk": "@@ -71,9 +71,19 @@\n \n         @Advice.OnMethodExit(suppress = Throwable.class, inline = false)\n         public static void afterInitPropertySources(@Advice.This WebApplicationContext applicationContext) {\n-            if (applicationContext.getServletContext() != null) {\n-                tracer.overrideServiceNameForClassLoader(applicationContext.getServletContext().getClassLoader(), applicationContext.getEnvironment().getProperty(\"spring.application.name\"));\n+\n+            String appName = applicationContext.getEnvironment().getProperty(\"spring.application.name\", \"\");\n+\n+            // fallback when application name isn't set through an environment property\n+            if (appName.isEmpty()) {\n+                appName = applicationContext.getApplicationName();", "originalCommit": "3187fb0ca4364a1b79ff34cd89ebb71e400f4942", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTI0MDQ5OA==", "url": "https://github.com/elastic/apm-agent-java/pull/1464#discussion_r515240498", "bodyText": "I was also wondering should we make this work for older versions of Spring framework < 3.x", "author": "SylvainJuge", "createdAt": "2020-10-30T16:56:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTIzOTQ2Mg=="}], "type": "inlineReview"}, {"oid": "eb2c8b55b0d246005bfd091838d283d2d5bbdad3", "url": "https://github.com/elastic/apm-agent-java/commit/eb2c8b55b0d246005bfd091838d283d2d5bbdad3", "message": "fix using servlet classloader when available", "committedDate": "2020-11-02T14:46:16Z", "type": "commit"}, {"oid": "79f08a319ac3d5d64b973fbb3058e11a871b4198", "url": "https://github.com/elastic/apm-agent-java/commit/79f08a319ac3d5d64b973fbb3058e11a871b4198", "message": "improve comment about double invocation for tomcat", "committedDate": "2020-11-02T14:55:04Z", "type": "commit"}, {"oid": "6f51ae605548824ed2d4a05f7347cfad4a16b76b", "url": "https://github.com/elastic/apm-agent-java/commit/6f51ae605548824ed2d4a05f7347cfad4a16b76b", "message": "defensively avoid null classloader", "committedDate": "2020-11-02T14:59:45Z", "type": "commit"}, {"oid": "5fae41629aee6c04fe754bd072e4814dabfa583c", "url": "https://github.com/elastic/apm-agent-java/commit/5fae41629aee6c04fe754bd072e4814dabfa583c", "message": "update changelog", "committedDate": "2020-11-03T08:25:59Z", "type": "commit"}, {"oid": "87e6cac3d0b92cf1232872c70d2b61253c59e368", "url": "https://github.com/elastic/apm-agent-java/commit/87e6cac3d0b92cf1232872c70d2b61253c59e368", "message": "Merge branch 'master' into fix-spring-app-name-startup-exception", "committedDate": "2020-11-03T09:57:31Z", "type": "commit"}]}