{"pr_number": 1289, "pr_title": "Minor changes to release process pipeline", "pr_createdAt": "2020-07-13T10:52:31Z", "pr_url": "https://github.com/elastic/apm-agent-java/pull/1289", "timeline": [{"oid": "5db346b452dd78041f97358f8094504a8413dca5", "url": "https://github.com/elastic/apm-agent-java/commit/5db346b452dd78041f97358f8094504a8413dca5", "message": "Flag to skip master branch failures", "committedDate": "2020-07-13T08:28:25Z", "type": "commit"}, {"oid": "838917240fc00549ff560a939707039b312f62ab", "url": "https://github.com/elastic/apm-agent-java/commit/838917240fc00549ff560a939707039b312f62ab", "message": "All changelog to be modified in-flight", "committedDate": "2020-07-13T10:26:01Z", "type": "commit"}, {"oid": "8f63e053c1b76bf0dc72784ed56c759bb5f20dc7", "url": "https://github.com/elastic/apm-agent-java/commit/8f63e053c1b76bf0dc72784ed56c759bb5f20dc7", "message": "Cleaner version of ci branch check", "committedDate": "2020-07-13T10:51:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzYyMTI3NA==", "url": "https://github.com/elastic/apm-agent-java/pull/1289#discussion_r453621274", "bodyText": "I don't see any deleteDir step and the BASE_DIR should already contain the source code, What's the reason for cloning the repo again?", "author": "v1v", "createdAt": "2020-07-13T12:43:34Z", "path": ".ci/release/Jenkinsfile", "diffHunk": "@@ -68,27 +69,30 @@ pipeline {\n             }\n           }\n         }\n-        //stage('Check master build status') {\n-        //  steps {\n-        //    script {\n-        //      // If this build is not green: https://apm-ci.elastic.co/job/apm-agent-java/job/apm-agent-java-mbp/job/master/\n-        //      if(!buildStatus(host: 'apm-ci.elastic.co', job: ['apm-agent-java', 'apm-agent-java-mbp', 'master'], return_boolean: true)) {\n-        //        input(message: \"WARNING! The master build is not passing. Do you wish to continue?\")\n-        //      }\n-        //    }\n-        //  }\n-        //}\n+        stage('Check master build status') {\n+        when { expression { params.ignore_branch_ci_status } }\n+         steps {\n+           script {\n+             // If this build is not green: https://apm-ci.elastic.co/job/apm-agent-java/job/apm-agent-java-mbp/job/master/\n+             if(!buildStatus(host: 'apm-ci.elastic.co', job: ['apm-agent-java', 'apm-agent-java-mbp', 'master'], return_boolean: true)) {\n+               input(message: \"WARNING! The master build is not passing. Do you wish to continue?\")\n+             }\n+           }\n+         }\n+        }\n         stage('Require confirmation that CHANGELOG.asciidoc has been updated') {\n           steps {\n             input(message: \"\"\"\n             Update CHANGELOG.asciidoc to reflect the new version release:\n             Go over PRs or git log and add bug fixes and features.\n             Move release notes from the Unreleased sub-heading to the correct [[release-notes-{major}.x]] sub-heading (Example PR for 1.13.0 release).\n \n-            Click 'Proceed' to confirm that this step has been completed or Abort to stop the build in order to complete this step.\n+            Click 'Proceed' to confirm that this step has been completed and changes have been pushed or Abort to stop the build.\n             \"\"\"\n             )\n-            sh(script: \"git pull\")\n+            dir(\"${BASE_DIR}\") {\n+              git credentialsId: 'f6c7695a-671e-4f4f-a331-acdce44ff9ba', url: 'git@github.com:elastic/apm-agent-java.git'", "originalCommit": "8f63e053c1b76bf0dc72784ed56c759bb5f20dc7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzYyNTQ4MQ==", "url": "https://github.com/elastic/apm-agent-java/pull/1289#discussion_r453625481", "bodyText": "Because we want to pull in any additional changes to the changelog that might be made as a result of the reminder and prompt just above this.", "author": "cachedout", "createdAt": "2020-07-13T12:50:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzYyMTI3NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDIwMDk4MA==", "url": "https://github.com/elastic/apm-agent-java/pull/1289#discussion_r454200980", "bodyText": "In branch_creation.sh, we just do a plain git pull instead. Is that intentional?", "author": "felixbarny", "createdAt": "2020-07-14T08:45:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzYyMTI3NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzExMDQ5MA==", "url": "https://github.com/elastic/apm-agent-java/pull/1289#discussion_r457110490", "bodyText": "Good catch. I agree that we should be consistent here and I have replaced that shell call with the approach we are using in this step.", "author": "cachedout", "createdAt": "2020-07-20T06:58:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzYyMTI3NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzY4NzU3OA==", "url": "https://github.com/elastic/apm-agent-java/pull/1289#discussion_r453687578", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                       script {\n          \n          \n            \n                         // If this build is not green: https://apm-ci.elastic.co/job/apm-agent-java/job/apm-agent-java-mbp/job/master/\n          \n          \n            \n                         if(!buildStatus(host: 'apm-ci.elastic.co', job: ['apm-agent-java', 'apm-agent-java-mbp', 'master'], return_boolean: true)) {\n          \n          \n            \n                           input(message: \"WARNING! The master build is not passing. Do you wish to continue?\")\n          \n          \n            \n                         }\n          \n          \n            \n                       }\n          \n          \n            \n                         // If this build is not green: https://apm-ci.elastic.co/job/apm-agent-java/job/apm-agent-java-mbp/job/master/\n          \n          \n            \n                         whenTrue(!buildStatus(host: 'apm-ci.elastic.co', job: ['apm-agent-java', 'apm-agent-java-mbp', 'master'], return_boolean: true)) {\n          \n          \n            \n                           input(message: \"WARNING! The master build is not passing. Do you wish to continue?\")\n          \n          \n            \n                         }", "author": "kuisathaverat", "createdAt": "2020-07-13T14:24:17Z", "path": ".ci/release/Jenkinsfile", "diffHunk": "@@ -68,27 +69,30 @@ pipeline {\n             }\n           }\n         }\n-        //stage('Check master build status') {\n-        //  steps {\n-        //    script {\n-        //      // If this build is not green: https://apm-ci.elastic.co/job/apm-agent-java/job/apm-agent-java-mbp/job/master/\n-        //      if(!buildStatus(host: 'apm-ci.elastic.co', job: ['apm-agent-java', 'apm-agent-java-mbp', 'master'], return_boolean: true)) {\n-        //        input(message: \"WARNING! The master build is not passing. Do you wish to continue?\")\n-        //      }\n-        //    }\n-        //  }\n-        //}\n+        stage('Check master build status') {\n+        when { expression { params.ignore_branch_ci_status } }\n+         steps {\n+           script {\n+             // If this build is not green: https://apm-ci.elastic.co/job/apm-agent-java/job/apm-agent-java-mbp/job/master/\n+             if(!buildStatus(host: 'apm-ci.elastic.co', job: ['apm-agent-java', 'apm-agent-java-mbp', 'master'], return_boolean: true)) {\n+               input(message: \"WARNING! The master build is not passing. Do you wish to continue?\")\n+             }\n+           }", "originalCommit": "8f63e053c1b76bf0dc72784ed56c759bb5f20dc7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "6d924f00b6a5c166eaa4127e368b5f0ce345d8a8", "url": "https://github.com/elastic/apm-agent-java/commit/6d924f00b6a5c166eaa4127e368b5f0ce345d8a8", "message": "Update .ci/release/Jenkinsfile\n\nCo-authored-by: Ivan Fernandez Calvo <kuisathaverat@users.noreply.github.com>", "committedDate": "2020-07-13T15:14:43Z", "type": "commit"}, {"oid": "be82000ecf9131ba6f6d5ba49010a7d703554791", "url": "https://github.com/elastic/apm-agent-java/commit/be82000ecf9131ba6f6d5ba49010a7d703554791", "message": "Replace shell git call", "committedDate": "2020-07-20T06:57:17Z", "type": "commit"}, {"oid": "7259f957b14e426a02aad2b973476911c9151788", "url": "https://github.com/elastic/apm-agent-java/commit/7259f957b14e426a02aad2b973476911c9151788", "message": "Merge branch 'ci_minor' of github.com:cachedout/apm-agent-java into ci_minor", "committedDate": "2020-07-20T06:57:30Z", "type": "commit"}]}