{"pr_number": 8524, "pr_title": "Layers: js lib #8483", "pr_createdAt": "2020-12-03T07:57:03Z", "pr_url": "https://github.com/enonic/xp/pull/8524", "timeline": [{"oid": "75ea1986817635535622d135bfe4b12e22916386", "url": "https://github.com/enonic/xp/commit/75ea1986817635535622d135bfe4b12e22916386", "message": "Layers: js lib #8483", "committedDate": "2020-12-03T10:37:22Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTA4NDQ1OQ==", "url": "https://github.com/enonic/xp/pull/8524#discussion_r535084459", "bodyText": "call get() in doExecute\nDue to OSGi dynamic nature service may become unavailable between initialize and doExecute.", "author": "rymsha", "createdAt": "2020-12-03T10:42:00Z", "path": "modules/lib/lib-content/src/main/java/com/enonic/xp/lib/content/ResetInheritanceHandler.java", "diffHunk": "@@ -0,0 +1,83 @@\n+package com.enonic.xp.lib.content;\n+\n+import java.util.List;\n+import java.util.stream.Collectors;\n+\n+import com.google.common.base.Preconditions;\n+\n+import com.enonic.xp.content.Content;\n+import com.enonic.xp.content.ContentId;\n+import com.enonic.xp.content.ContentInheritType;\n+import com.enonic.xp.content.ContentPath;\n+import com.enonic.xp.content.ResetContentInheritParams;\n+import com.enonic.xp.content.SyncContentService;\n+import com.enonic.xp.project.ProjectName;\n+import com.enonic.xp.script.bean.BeanContext;\n+\n+public class ResetInheritanceHandler\n+    extends BaseContextHandler\n+{\n+    private SyncContentService syncContentService;\n+\n+    private String key;\n+\n+    private String projectName;\n+\n+    private List<String> inherit;\n+\n+    @Override\n+    public void initialize( final BeanContext context )\n+    {\n+        super.initialize( context );\n+        this.syncContentService = context.getService( SyncContentService.class ).get();", "originalCommit": "75ea1986817635535622d135bfe4b12e22916386", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e0f9137e7a0b9f5aef4f6d7b2ed36282bc84acd6", "url": "https://github.com/enonic/xp/commit/e0f9137e7a0b9f5aef4f6d7b2ed36282bc84acd6", "message": "Layers: js lib #8483", "committedDate": "2020-12-03T11:07:49Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTE3Mjg0Nw==", "url": "https://github.com/enonic/xp/pull/8524#discussion_r535172847", "bodyText": "add /* global __ */ on top of the file. see how it is done in project.js", "author": "rymsha", "createdAt": "2020-12-03T12:10:02Z", "path": "modules/lib/lib-content/src/main/resources/lib/xp/content.js", "diffHunk": "@@ -512,3 +512,20 @@ exports.getOutboundDependencies = function (params) {\n \n     return __.toNativeObject(bean.execute());\n };\n+\n+/** Resets dropped inherit flags back.\n+ *\n+ * @param {object} params JSON parameters.\n+ * @param {string} params.key Path or id of the content.\n+ * @param {string} params.projectName name of project with content.\n+ * @param {string[]} params.inherit flags to be reset.\n+ */\n+exports.resetInheritance = function (params) {\n+    var bean = __.newBean('com.enonic.xp.lib.content.ResetInheritanceHandler');", "originalCommit": "e0f9137e7a0b9f5aef4f6d7b2ed36282bc84acd6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTE3NjI0OA==", "url": "https://github.com/enonic/xp/pull/8524#discussion_r535176248", "bodyText": "should we add assertions here instead of java?", "author": "rymsha", "createdAt": "2020-12-03T12:13:15Z", "path": "modules/lib/lib-content/src/main/resources/lib/xp/examples/content/resetInheritance.js", "diffHunk": "@@ -0,0 +1,16 @@\n+var contentLib = require('/lib/xp/content');\n+\n+// reset content by path\n+contentLib.resetInheritance({\n+    key: '/a/b/mycontent',\n+    projectName: 'child1',\n+    inherit: ['NAME', 'CONTENT']\n+});\n+\n+// reset content by id\n+contentLib.resetInheritance({\n+    key: 'mycontent-id',\n+    projectName: 'child2',\n+    inherit: ['SORT']\n+});\n+", "originalCommit": "e0f9137e7a0b9f5aef4f6d7b2ed36282bc84acd6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "de7c6a28641cd2db641b728557639773f3ff4ad0", "url": "https://github.com/enonic/xp/commit/de7c6a28641cd2db641b728557639773f3ff4ad0", "message": "Layers: js lib #8483", "committedDate": "2020-12-04T10:17:11Z", "type": "commit"}, {"oid": "de7c6a28641cd2db641b728557639773f3ff4ad0", "url": "https://github.com/enonic/xp/commit/de7c6a28641cd2db641b728557639773f3ff4ad0", "message": "Layers: js lib #8483", "committedDate": "2020-12-04T10:17:11Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTk5NjUyMA==", "url": "https://github.com/enonic/xp/pull/8524#discussion_r535996520", "bodyText": "Don't we need to mention new field in JSDoc?", "author": "rymsha", "createdAt": "2020-12-04T10:28:29Z", "path": "modules/lib/lib-content/src/main/java/com/enonic/xp/lib/content/mapper/ContentMapper.java", "diffHunk": "@@ -168,6 +172,16 @@ private void serializeAttachments( final MapGenerator gen, final Attachments val\n         gen.end();\n     }\n \n+    private void serializeInherit( final MapGenerator gen, final Set<ContentInheritType> value )", "originalCommit": "de7c6a28641cd2db641b728557639773f3ff4ad0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTk5Njg1NQ==", "url": "https://github.com/enonic/xp/pull/8524#discussion_r535996855", "bodyText": "We have a limited set of values accepted, maybe mention them here?", "author": "rymsha", "createdAt": "2020-12-04T10:29:04Z", "path": "modules/lib/lib-content/src/main/resources/lib/xp/content.js", "diffHunk": "@@ -512,3 +512,20 @@ exports.getOutboundDependencies = function (params) {\n \n     return __.toNativeObject(bean.execute());\n };\n+\n+/** Resets dropped inherit flags back.\n+ *\n+ * @param {object} params JSON parameters.\n+ * @param {string} params.key Path or id of the content.\n+ * @param {string} params.projectName name of project with content.\n+ * @param {string[]} params.inherit flags to be reset.", "originalCommit": "de7c6a28641cd2db641b728557639773f3ff4ad0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}