{"pr_number": 376, "pr_title": "BCDA-3781 - RFC for service date filter", "pr_createdAt": "2020-10-15T17:01:08Z", "pr_url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/376", "timeline": [{"oid": "caf72661568758dd21771c4f6f282c0c1a1c611a", "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/caf72661568758dd21771c4f6f282c0c1a1c611a", "message": "Adding RFC for service date filter", "committedDate": "2020-10-15T16:58:34Z", "type": "commit"}, {"oid": "d7b1cd0b688749e5b68e1ca845fef4a68748122e", "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/d7b1cd0b688749e5b68e1ca845fef4a68748122e", "message": "Adding PR link", "committedDate": "2020-10-15T17:02:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTc5NTkwMg==", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/376#discussion_r505795902", "bodyText": "Should we list ACO Termination here too?", "author": "msnook", "createdAt": "2020-10-15T19:43:17Z", "path": "rfcs/0007-service-date-filter.md", "diffHunk": "@@ -0,0 +1,102 @@\n+# RFC Proposal\n+[RFC Proposal]: #rfc-proposal\n+\n+* RFC Proposal ID: `0007-service-date-filter` (fill me in with a unique ident)\n+* Start Date: 2020-10-15\n+* RFC PR: [#376](https://github.com/CMSgov/beneficiary-fhir-data/pull/376)\n+* JIRA Ticket(s):\n+    * [BCDA-3871](https://jira.cms.gov/browse/BCDA-3871)\n+\n+This proposal will suggest adding an additional date range query on service completion date to EOB requests. This will allow users to guarantee that claims data falls within an expected date range.\n+\n+## Table of Contents\n+[Table of Contents]: #table-of-contents\n+\n+- [RFC Proposal](#rfc-proposal)\n+  - [Table of Contents](#table-of-contents)\n+  - [Motivation](#motivation)\n+  - [Proposed Solution](#proposed-solution)\n+    - [Proposed Solution: Detailed Design](#proposed-solution-detailed-design)\n+    - [Proposed Solution: Unresolved Questions](#proposed-solution-unresolved-questions)\n+    - [Proposed Solution: Drawbacks](#proposed-solution-drawbacks)\n+    - [Proposed Solution: Notable Alternatives](#proposed-solution-notable-alternatives)\n+  - [Prior Art](#prior-art)\n+  - [Future Possibilities](#future-possibilities)\n+  - [Addendums](#addendums)\n+\n+## Motivation\n+[Motivation]: #motivation\n+\n+BCDA needs to ensure that they are not returning beneficiary data to an ACO to which that beneficiary is not attributed. There are a variety of use-cases where this could occur if not handled properly:", "originalCommit": "d7b1cd0b688749e5b68e1ca845fef4a68748122e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTgxNjg2NQ==", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/376#discussion_r505816865", "bodyText": "I wast thinking that would be a \"Future\" use case since there may be some nuances with that.", "author": "mtrang1263", "createdAt": "2020-10-15T20:24:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTc5NTkwMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTc5NjAzNA==", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/376#discussion_r505796034", "bodyText": "Can we remove the (fill me in with a unique ident)?", "author": "msnook", "createdAt": "2020-10-15T19:43:37Z", "path": "rfcs/0007-service-date-filter.md", "diffHunk": "@@ -0,0 +1,102 @@\n+# RFC Proposal\n+[RFC Proposal]: #rfc-proposal\n+\n+* RFC Proposal ID: `0007-service-date-filter` (fill me in with a unique ident)", "originalCommit": "d7b1cd0b688749e5b68e1ca845fef4a68748122e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "ef0b35972a4b59dc08e26edc9da677f257ceb8e8", "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/ef0b35972a4b59dc08e26edc9da677f257ceb8e8", "message": "Remove stale content", "committedDate": "2020-10-16T13:54:49Z", "type": "commit"}, {"oid": "bbce12918660382e41948580cc7265d40521f38a", "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/bbce12918660382e41948580cc7265d40521f38a", "message": "Add note about null/empty service date fields", "committedDate": "2020-10-16T14:34:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzkwNDI0Mg==", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/376#discussion_r507904242", "bodyText": "I'm also curious to see if there's any significant performance change with the additional filter. BFD ops can help you load test a PR when we get to that point.", "author": "jzulim", "createdAt": "2020-10-19T16:52:07Z", "path": "rfcs/0007-service-date-filter.md", "diffHunk": "@@ -0,0 +1,104 @@\n+# RFC Proposal\n+[RFC Proposal]: #rfc-proposal\n+\n+* RFC Proposal ID: `0007-service-date-filter` \n+* Start Date: 2020-10-15\n+* RFC PR: [#376](https://github.com/CMSgov/beneficiary-fhir-data/pull/376)\n+* JIRA Ticket(s):\n+    * [BCDA-3871](https://jira.cms.gov/browse/BCDA-3871)\n+\n+This proposal will suggest adding an additional date range query on service completion date to EOB requests. This will allow users to guarantee that claims data falls within an expected date range.\n+\n+## Table of Contents\n+[Table of Contents]: #table-of-contents\n+\n+- [RFC Proposal](#rfc-proposal)\n+  - [Table of Contents](#table-of-contents)\n+  - [Motivation](#motivation)\n+  - [Proposed Solution](#proposed-solution)\n+    - [Proposed Solution: Detailed Design](#proposed-solution-detailed-design)\n+    - [Proposed Solution: Unresolved Questions](#proposed-solution-unresolved-questions)\n+    - [Proposed Solution: Drawbacks](#proposed-solution-drawbacks)\n+    - [Proposed Solution: Notable Alternatives](#proposed-solution-notable-alternatives)\n+  - [Prior Art](#prior-art)\n+  - [Future Possibilities](#future-possibilities)\n+  - [Addendums](#addendums)\n+\n+## Motivation\n+[Motivation]: #motivation\n+\n+BCDA needs to ensure that they are not returning beneficiary data to an ACO to which that beneficiary is not attributed. There are a variety of use-cases where this could occur if not handled properly:\n+* End of year reassignment/attribution changes\n+* Runouts\n+\n+## Proposed Solution\n+[Proposed Solution]: #proposed-solution\n+\n+The solution will allow a client to specify a new query parameter (`serviceEndDate`) when searching EOB resources. When specified, the search filters resources against the passed in date range. \n+\n+The table below captures the claim type field used in the serviceEndDate filter.\n+\n+| Claim Type                            | Date Field           | EOB Field          | CCW Field   |\n+|---------------------------------------|----------------------|--------------------|-------------|\n+| Carrier Claim                         | dateThrough          | billablePeriod#end | CLM_THRU_DT |\n+| DME (Durable Medical Equipment) Claim | dateThrough          | billablePeriod#end | CLM_THRU_DT |\n+| HHA (Home Health Agency) Claim        | dateThrough          | billablePeriod#end | CLM_THRU_DT |\n+| Hospice Claim                         | dateThrough          | billablePeriod#end | CLM_THRU_DT |\n+| Inpatient Claim                       | dateThrough          | billablePeriod#end | CLM_THRU_DT |\n+| Outpatient Claim                      | dateThrough          | billablePeriod#end | CLM_THRU_DT |\n+| PDE (Part D Event) Claim              | prescriptionFillDate | item#servicedDate  | SRVC_DT     |\n+| SNF (Skilled Nursing Facility) Claim  | dateThrough          | billablePeriod#end | CLM_THRU_DT |\n+\n+\n+### Proposed Solution: Detailed Design\n+[Proposed Solution: Detailed Design]: #proposed-solution-detailed-design\n+\n+Currently, EOB lookup by patients accepts an optional date range filter (`_lastUpdated`). The lookup would be expanded to support an additional date range filter (`serviceEndDate`).\n+\n+The `serviceEndDate` filter will be implemented at the application layer, not the data layer. No schema changes are needed. After querying the database by patientId and (optionally) lastUpdated, the `serviceEndDate` filter checks the claim entity's date field against the provided date range. All claim entities that pass the filter are returned to the caller.\n+\n+If the caller does not supply `serviceEndDate`, no post query filtering occurs.\n+\n+Similar to the `_lastUpdated` parameter, the `serviceEndDate` is supplied as a date range. Users can supply a lower bound, upper bound, or lower/upper bound. The supported parameters include: `ge`, `gt`, `le`, `lt`.\n+\n+Sample Requests:\n+* https://\\<hostname\\>/v1/fhir/ExplanationOfBenefit?patient=\\<beneficiaryId\\>&serviceEndDate=ge2020-01-01\n+  * Returns claims data that occurred on or after 2020-01-01\n+* https://\\<hostname\\>/v1/fhir/ExplanationOfBenefit?patient=\\<beneficiaryId\\>&serviceEndDate=lt2020-01-01\n+  * Returns claims data that occurred before 2020-01-01\n+* https://\\<hostname\\>/v1/fhir/ExplanationOfBenefit?patient=\\<beneficiaryId\\>&serviceEndDate=ge2020-01-01&serviceEndDate=le2020-01-31\n+  * Returns claims data that occurred between 2020-01-01 and 2020-01-31 (inclusive)\n+\n+If a claim entity's date field is unset/null and the caller supplies a `serviceEndDate`, then the claim **will not** be returned to the caller. Since we cannot guarantee that the claim falls within the supplied filter, we cannot return it.\n+\n+### Proposed Solution: Unresolved Questions\n+[Proposed Solution: Unresolved Questions]: #proposed-solution-unresolved-questions\n+\n+1. The `serviceEndDate` filter was previously implemented, but removed due to lack of adoption. While BCDA has identified a use case for this functionality, it may be BCDA-specific and thus should be implemented on the BCDA side.\n+\n+### Proposed Solution: Drawbacks\n+[Proposed Solution: Drawbacks]: #proposed-solution-drawbacks\n+\n+1. Since the filtering is on the application layer, instead of the database layer, we may roundtrip claim entities that will be filtered out.", "originalCommit": "bbce12918660382e41948580cc7265d40521f38a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTM1NjI5OA==", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/376#discussion_r509356298", "bodyText": "Good to know John! I'll note in the implementation PR to make sure we have some numbers", "author": "mtrang1263", "createdAt": "2020-10-21T14:51:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzkwNDI0Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzkwNDY3MA==", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/376#discussion_r507904670", "bodyText": "In general, BFD is interested in being the gatekeeper of data, so filtering on the BFD side makes sense for us.", "author": "jzulim", "createdAt": "2020-10-19T16:52:43Z", "path": "rfcs/0007-service-date-filter.md", "diffHunk": "@@ -0,0 +1,104 @@\n+# RFC Proposal\n+[RFC Proposal]: #rfc-proposal\n+\n+* RFC Proposal ID: `0007-service-date-filter` \n+* Start Date: 2020-10-15\n+* RFC PR: [#376](https://github.com/CMSgov/beneficiary-fhir-data/pull/376)\n+* JIRA Ticket(s):\n+    * [BCDA-3871](https://jira.cms.gov/browse/BCDA-3871)\n+\n+This proposal will suggest adding an additional date range query on service completion date to EOB requests. This will allow users to guarantee that claims data falls within an expected date range.\n+\n+## Table of Contents\n+[Table of Contents]: #table-of-contents\n+\n+- [RFC Proposal](#rfc-proposal)\n+  - [Table of Contents](#table-of-contents)\n+  - [Motivation](#motivation)\n+  - [Proposed Solution](#proposed-solution)\n+    - [Proposed Solution: Detailed Design](#proposed-solution-detailed-design)\n+    - [Proposed Solution: Unresolved Questions](#proposed-solution-unresolved-questions)\n+    - [Proposed Solution: Drawbacks](#proposed-solution-drawbacks)\n+    - [Proposed Solution: Notable Alternatives](#proposed-solution-notable-alternatives)\n+  - [Prior Art](#prior-art)\n+  - [Future Possibilities](#future-possibilities)\n+  - [Addendums](#addendums)\n+\n+## Motivation\n+[Motivation]: #motivation\n+\n+BCDA needs to ensure that they are not returning beneficiary data to an ACO to which that beneficiary is not attributed. There are a variety of use-cases where this could occur if not handled properly:\n+* End of year reassignment/attribution changes\n+* Runouts\n+\n+## Proposed Solution\n+[Proposed Solution]: #proposed-solution\n+\n+The solution will allow a client to specify a new query parameter (`serviceEndDate`) when searching EOB resources. When specified, the search filters resources against the passed in date range. \n+\n+The table below captures the claim type field used in the serviceEndDate filter.\n+\n+| Claim Type                            | Date Field           | EOB Field          | CCW Field   |\n+|---------------------------------------|----------------------|--------------------|-------------|\n+| Carrier Claim                         | dateThrough          | billablePeriod#end | CLM_THRU_DT |\n+| DME (Durable Medical Equipment) Claim | dateThrough          | billablePeriod#end | CLM_THRU_DT |\n+| HHA (Home Health Agency) Claim        | dateThrough          | billablePeriod#end | CLM_THRU_DT |\n+| Hospice Claim                         | dateThrough          | billablePeriod#end | CLM_THRU_DT |\n+| Inpatient Claim                       | dateThrough          | billablePeriod#end | CLM_THRU_DT |\n+| Outpatient Claim                      | dateThrough          | billablePeriod#end | CLM_THRU_DT |\n+| PDE (Part D Event) Claim              | prescriptionFillDate | item#servicedDate  | SRVC_DT     |\n+| SNF (Skilled Nursing Facility) Claim  | dateThrough          | billablePeriod#end | CLM_THRU_DT |\n+\n+\n+### Proposed Solution: Detailed Design\n+[Proposed Solution: Detailed Design]: #proposed-solution-detailed-design\n+\n+Currently, EOB lookup by patients accepts an optional date range filter (`_lastUpdated`). The lookup would be expanded to support an additional date range filter (`serviceEndDate`).\n+\n+The `serviceEndDate` filter will be implemented at the application layer, not the data layer. No schema changes are needed. After querying the database by patientId and (optionally) lastUpdated, the `serviceEndDate` filter checks the claim entity's date field against the provided date range. All claim entities that pass the filter are returned to the caller.\n+\n+If the caller does not supply `serviceEndDate`, no post query filtering occurs.\n+\n+Similar to the `_lastUpdated` parameter, the `serviceEndDate` is supplied as a date range. Users can supply a lower bound, upper bound, or lower/upper bound. The supported parameters include: `ge`, `gt`, `le`, `lt`.\n+\n+Sample Requests:\n+* https://\\<hostname\\>/v1/fhir/ExplanationOfBenefit?patient=\\<beneficiaryId\\>&serviceEndDate=ge2020-01-01\n+  * Returns claims data that occurred on or after 2020-01-01\n+* https://\\<hostname\\>/v1/fhir/ExplanationOfBenefit?patient=\\<beneficiaryId\\>&serviceEndDate=lt2020-01-01\n+  * Returns claims data that occurred before 2020-01-01\n+* https://\\<hostname\\>/v1/fhir/ExplanationOfBenefit?patient=\\<beneficiaryId\\>&serviceEndDate=ge2020-01-01&serviceEndDate=le2020-01-31\n+  * Returns claims data that occurred between 2020-01-01 and 2020-01-31 (inclusive)\n+\n+If a claim entity's date field is unset/null and the caller supplies a `serviceEndDate`, then the claim **will not** be returned to the caller. Since we cannot guarantee that the claim falls within the supplied filter, we cannot return it.\n+\n+### Proposed Solution: Unresolved Questions\n+[Proposed Solution: Unresolved Questions]: #proposed-solution-unresolved-questions\n+\n+1. The `serviceEndDate` filter was previously implemented, but removed due to lack of adoption. While BCDA has identified a use case for this functionality, it may be BCDA-specific and thus should be implemented on the BCDA side.", "originalCommit": "bbce12918660382e41948580cc7265d40521f38a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDIyMjk1Ng==", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/376#discussion_r510222956", "bodyText": "@mtrang1263\nserviceEndDate is not a EOB standard search param in FHIR R4 and CARIN. You can use HTTP header to pass serviceEndDate.\nOR\nUse the below CARIN defined EOB search param called service-date:\nGET [base]/ExplanationOfBenefit?service-date=[service-date] and you can pass ExplanationOfBenefit.billablePeriod.end or ExplanationOfBenefit.item.servicedDate.", "author": "dshekhar18", "createdAt": "2020-10-22T14:46:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzkwNDY3MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDI0NzQ1Mw==", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/376#discussion_r510247453", "bodyText": "Didn't know there was a standard search param for service date, thanks for sharing @dshekhar18 !\nWill update to use service-date instead.", "author": "mtrang1263", "createdAt": "2020-10-22T15:18:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzkwNDY3MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzkwNzg2MA==", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/376#discussion_r507907860", "bodyText": "\ud83d\udc4d", "author": "jzulim", "createdAt": "2020-10-19T16:57:35Z", "path": "rfcs/0007-service-date-filter.md", "diffHunk": "@@ -0,0 +1,104 @@\n+# RFC Proposal\n+[RFC Proposal]: #rfc-proposal\n+\n+* RFC Proposal ID: `0007-service-date-filter` \n+* Start Date: 2020-10-15\n+* RFC PR: [#376](https://github.com/CMSgov/beneficiary-fhir-data/pull/376)\n+* JIRA Ticket(s):\n+    * [BCDA-3871](https://jira.cms.gov/browse/BCDA-3871)\n+\n+This proposal will suggest adding an additional date range query on service completion date to EOB requests. This will allow users to guarantee that claims data falls within an expected date range.\n+\n+## Table of Contents\n+[Table of Contents]: #table-of-contents\n+\n+- [RFC Proposal](#rfc-proposal)\n+  - [Table of Contents](#table-of-contents)\n+  - [Motivation](#motivation)\n+  - [Proposed Solution](#proposed-solution)\n+    - [Proposed Solution: Detailed Design](#proposed-solution-detailed-design)\n+    - [Proposed Solution: Unresolved Questions](#proposed-solution-unresolved-questions)\n+    - [Proposed Solution: Drawbacks](#proposed-solution-drawbacks)\n+    - [Proposed Solution: Notable Alternatives](#proposed-solution-notable-alternatives)\n+  - [Prior Art](#prior-art)\n+  - [Future Possibilities](#future-possibilities)\n+  - [Addendums](#addendums)\n+\n+## Motivation\n+[Motivation]: #motivation\n+\n+BCDA needs to ensure that they are not returning beneficiary data to an ACO to which that beneficiary is not attributed. There are a variety of use-cases where this could occur if not handled properly:\n+* End of year reassignment/attribution changes\n+* Runouts\n+\n+## Proposed Solution\n+[Proposed Solution]: #proposed-solution\n+\n+The solution will allow a client to specify a new query parameter (`serviceEndDate`) when searching EOB resources. When specified, the search filters resources against the passed in date range. \n+\n+The table below captures the claim type field used in the serviceEndDate filter.", "originalCommit": "bbce12918660382e41948580cc7265d40521f38a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "cf44fdbdc3b0fd9f08cc8542fc93b0a8b4a2f7d0", "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/cf44fdbdc3b0fd9f08cc8542fc93b0a8b4a2f7d0", "message": "Rework to use service-date instead of serviceEndDate", "committedDate": "2020-10-22T15:22:01Z", "type": "commit"}]}