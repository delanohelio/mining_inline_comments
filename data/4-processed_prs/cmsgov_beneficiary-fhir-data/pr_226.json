{"pr_number": 226, "pr_title": "BLUEBUTTON-1810: Support env agnostic AMIs, remove code for unused deployment envs", "pr_createdAt": "2020-02-20T18:00:26Z", "pr_url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/226", "timeline": [{"oid": "1fdd8400385aaa39afa60534dbdb57dc78d12961", "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/1fdd8400385aaa39afa60534dbdb57dc78d12961", "message": "Remove healthapt + hhsdevcloud envs from groovy, remove deploy env references from packer and deploy-ccs", "committedDate": "2020-02-18T19:20:43Z", "type": "commit"}, {"oid": "a153a227f8fe8f98296d4f682706b11674c1f9af", "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/a153a227f8fe8f98296d4f682706b11674c1f9af", "message": "Remove healthapt/hhsdevcloud reqs, move all pre-ami cert operations into post-ami launch, remove handlers on install due to immutable deploy in CCS", "committedDate": "2020-02-20T17:43:19Z", "type": "commit"}, {"oid": "ebae7a94a0d89df4f98a47aa67a4585e1ed3f4fe", "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/ebae7a94a0d89df4f98a47aa67a4585e1ed3f4fe", "message": "Move SSH users into pre-ami stage", "committedDate": "2020-02-20T17:45:31Z", "type": "commit"}, {"oid": "57ce06c15142ef4f18851fa3d0451e71a27293a9", "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/57ce06c15142ef4f18851fa3d0451e71a27293a9", "message": "Move SSH users into pre-ami stage for bfd-pipeline", "committedDate": "2020-02-20T17:48:36Z", "type": "commit"}, {"oid": "0b693a432208300c671da54b15a227a27a74d997", "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/0b693a432208300c671da54b15a227a27a74d997", "message": "Remove handlers in bfd-pipeline for pre-ami due to immutable deploy", "committedDate": "2020-02-20T17:51:02Z", "type": "commit"}, {"oid": "acb4265653b493d7fad2a529da61bd9aaba25708", "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/acb4265653b493d7fad2a529da61bd9aaba25708", "message": "Move service def for bfd-server to post-ami stage to be consistent with bfd-pipeline", "committedDate": "2020-02-20T17:54:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDE4NTgwOA==", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/226#discussion_r384185808", "bodyText": "Unsure why bfd-pipeline did not require a vault_password_file definition previously.", "author": "njdister", "createdAt": "2020-02-25T23:18:27Z", "path": "ops/packer/build_bfd-pipeline.json", "diffHunk": "@@ -2,7 +2,7 @@\n   \"variables\": {\n     \"source_ami\": \"\",\n     \"subnet_id\": \"\",\n-    \"env\": \"\"\n+    \"vault_password_file\": \"\"", "originalCommit": "acb4265653b493d7fad2a529da61bd9aaba25708", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDE4NzQ3Mw==", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/226#discussion_r384187473", "bodyText": "Removing as this should no longer be needed in CCS environment.", "author": "njdister", "createdAt": "2020-02-25T23:22:50Z", "path": "ops/ansible/roles/bfd-server/tasks/install.yml", "diffHunk": "@@ -24,154 +24,17 @@\n     mode: u=rwx,g=rx,o=rx\n   become: true\n \n-# TODO: This can be removed once we've fully migrated away from JBoss.\n-# The first time we dpeloy the new Jetty-based server, we need to ensure that JBoss is stopped first (if it already exists).\n-- name: Stop Existing BFD Server Service\n-  service:\n-    name: \"{{ data_server_appserver_service }}\"\n-    state: stopped\n-  become: true\n-  ignore_errors: true\n-", "originalCommit": "acb4265653b493d7fad2a529da61bd9aaba25708", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDE4ODM3Nw==", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/226#discussion_r384188377", "bodyText": "Removing as this shouldn't be needed in CCS, we just copy the keystore contained within the repo after this task anyway.", "author": "njdister", "createdAt": "2020-02-25T23:24:54Z", "path": "ops/ansible/roles/bfd-server/tasks/install.yml", "diffHunk": "@@ -24,154 +24,17 @@\n     mode: u=rwx,g=rx,o=rx\n   become: true\n \n-# TODO: This can be removed once we've fully migrated away from JBoss.\n-# The first time we dpeloy the new Jetty-based server, we need to ensure that JBoss is stopped first (if it already exists).\n-- name: Stop Existing BFD Server Service\n-  service:\n-    name: \"{{ data_server_appserver_service }}\"\n-    state: stopped\n-  become: true\n-  ignore_errors: true\n-\n - name: Copy BFD Server Launcher\n   copy:\n     src: \"{{ data_server_launcher }}\"\n     dest: \"{{ data_server_dir }}/{{ data_server_launcher | basename }}\"\n   become: true\n-  notify:\n-    - 'Restart BFD Server Service'\n \n - name: Copy BFD Server WAR\n   copy:\n     src: \"{{ data_server_war }}\"\n     dest: \"{{ data_server_dir }}/{{ data_server_war | basename }}\"\n   become: true\n-  notify:\n-    - 'Restart BFD Server Service'\n-\n-- name: Copy App Server Launcher Script\n-  template:\n-    src: bfd-server.sh.j2\n-    dest: \"{{ data_server_dir }}/bfd-server.sh\"\n-    owner: \"{{ data_server_user }}\"\n-    group: \"{{ data_server_user }}\"\n-    mode: u=rwx,g=rwx,o=rx\n-  become: true\n-  notify:\n-    - 'Restart BFD Server Service'\n-\n-- name: Create BFD Server Service Definition\n-  template:\n-    src: bluebutton-appserver.service.j2\n-    dest: \"/etc/systemd/system/{{ data_server_appserver_service }}.service\"\n-    owner: root\n-    group: root\n-    mode: u=rw,g=r,o=r\n-  become: true\n-  notify:\n-    - 'Enable BFD Server Service'\n-    - 'Restart BFD Server Service'\n-\n-- name: Check for BFD Server SSL Keystore\n-  stat:\n-    path: \"{{ data_server_dir }}/bluebutton-appserver-keystore.jks\"\n-  register: stat_appserver_keystore\n-  changed_when: false\n-  become: true\n-\n-- name: Create BFD Server SSL Keystore\n-  command: \"keytool -genkeypair -alias server {{ data_server_ssl_server_genkeypair_args }} -keystore {{ data_server_dir }}/bluebutton-appserver-keystore.jks -storepass changeit -keypass changeit\"\n-  when: stat_appserver_keystore.stat.isreg is not defined\n-  become: true\n-  become_user: \"{{ data_server_user }}\"\n-  no_log: true  # Ensure that the key args aren't logged if this command fails.\n-  notify:\n-    - 'Restart BFD Server Service'", "originalCommit": "acb4265653b493d7fad2a529da61bd9aaba25708", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDE4ODY4Mg==", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/226#discussion_r384188682", "bodyText": "Removed due to lack of use of data_server_ssl_client_cas in CCS.", "author": "njdister", "createdAt": "2020-02-25T23:25:33Z", "path": "ops/ansible/roles/bfd-server/tasks/install.yml", "diffHunk": "@@ -24,154 +24,17 @@\n     mode: u=rwx,g=rx,o=rx\n   become: true\n \n-# TODO: This can be removed once we've fully migrated away from JBoss.\n-# The first time we dpeloy the new Jetty-based server, we need to ensure that JBoss is stopped first (if it already exists).\n-- name: Stop Existing BFD Server Service\n-  service:\n-    name: \"{{ data_server_appserver_service }}\"\n-    state: stopped\n-  become: true\n-  ignore_errors: true\n-\n - name: Copy BFD Server Launcher\n   copy:\n     src: \"{{ data_server_launcher }}\"\n     dest: \"{{ data_server_dir }}/{{ data_server_launcher | basename }}\"\n   become: true\n-  notify:\n-    - 'Restart BFD Server Service'\n \n - name: Copy BFD Server WAR\n   copy:\n     src: \"{{ data_server_war }}\"\n     dest: \"{{ data_server_dir }}/{{ data_server_war | basename }}\"\n   become: true\n-  notify:\n-    - 'Restart BFD Server Service'\n-\n-- name: Copy App Server Launcher Script\n-  template:\n-    src: bfd-server.sh.j2\n-    dest: \"{{ data_server_dir }}/bfd-server.sh\"\n-    owner: \"{{ data_server_user }}\"\n-    group: \"{{ data_server_user }}\"\n-    mode: u=rwx,g=rwx,o=rx\n-  become: true\n-  notify:\n-    - 'Restart BFD Server Service'\n-\n-- name: Create BFD Server Service Definition\n-  template:\n-    src: bluebutton-appserver.service.j2\n-    dest: \"/etc/systemd/system/{{ data_server_appserver_service }}.service\"\n-    owner: root\n-    group: root\n-    mode: u=rw,g=r,o=r\n-  become: true\n-  notify:\n-    - 'Enable BFD Server Service'\n-    - 'Restart BFD Server Service'\n-\n-- name: Check for BFD Server SSL Keystore\n-  stat:\n-    path: \"{{ data_server_dir }}/bluebutton-appserver-keystore.jks\"\n-  register: stat_appserver_keystore\n-  changed_when: false\n-  become: true\n-\n-- name: Create BFD Server SSL Keystore\n-  command: \"keytool -genkeypair -alias server {{ data_server_ssl_server_genkeypair_args }} -keystore {{ data_server_dir }}/bluebutton-appserver-keystore.jks -storepass changeit -keypass changeit\"\n-  when: stat_appserver_keystore.stat.isreg is not defined\n-  become: true\n-  become_user: \"{{ data_server_user }}\"\n-  no_log: true  # Ensure that the key args aren't logged if this command fails.\n-  notify:\n-    - 'Restart BFD Server Service'\n-\n-# TODO: Export server's public cert and publish to S3 or somesuch (so the frontend and others can pick it up).\n-\n-- name: Secure BFD Server SSL Keystore\n-  file:\n-    path: \"{{ data_server_dir }}/bluebutton-appserver-keystore.jks\"\n-    owner: \"{{ data_server_user }}\"\n-    group: \"{{ data_server_user }}\"\n-    mode: u=rw,g=,o=\n-  become: true\n-  notify:\n-    - 'Restart BFD Server Service'\n-\n-- name: Create BFD Server SSL Truststore Working Directory\n-  file:\n-    state: directory\n-    path: \"{{ data_server_dir }}/bluebutton-appserver-truststore-work\"\n-    owner: \"{{ data_server_user }}\"\n-    group: \"{{ data_server_user }}\"\n-    mode: u=rwx,g=rwx,o=rx\n-  become: true\n-\n-- name: Delete Previous BFD Server SSL Truststore Working Copy\n-  file:\n-    state: absent\n-    path: \"{{ data_server_dir }}/bluebutton-appserver-truststore-work/bluebutton-appserver-truststore.jks\"\n-  changed_when: false\n-  become: true\n-\n-- name: Create Empty App Server SSL Truststore Working Copy\n-  command: \"{{ item }}\"\n-  with_items:\n-    - \"keytool -genkeypair -alias fake -dname cn=fake -keypass changeit -keystore {{ data_server_dir }}/bluebutton-appserver-truststore-work/bluebutton-appserver-truststore.jks -storepass changeit\"\n-    - \"keytool -delete -alias fake -keystore {{ data_server_dir }}/bluebutton-appserver-truststore-work/bluebutton-appserver-truststore.jks -storepass changeit -keypass changeit\"\n-  changed_when: false\n-  become: true\n-  become_user: \"{{ data_server_user }}\"\n-\n-- name: Save App Server SSL Truststore Certificates\n-  copy:\n-    content: \"{{ item.certificate }}\"\n-    dest: \"{{ data_server_dir }}/bluebutton-appserver-truststore-work/{{ item.alias }}.crt\"\n-  with_items: \"{{ data_server_ssl_client_certificates }}\"\n-  changed_when: false\n-  become: true\n-  become_user: \"{{ data_server_user }}\"\n-\n-- name: Save App Server SSL Truststore Certificate Authorities\n-  copy:\n-    content: \"{{ item.certificate }}\"\n-    dest: \"{{ data_server_dir }}/bluebutton-appserver-truststore-work/{{ item.alias }}.crt\"\n-  with_items: \"{{ data_server_ssl_client_cas }}\"\n-  changed_when: false\n-  become: true\n-  become_user: \"{{ data_server_user }}\"", "originalCommit": "acb4265653b493d7fad2a529da61bd9aaba25708", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDE4ODc5MA==", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/226#discussion_r384188790", "bodyText": "Removed due to lack of use of data_server_ssl_client_cas in CCS.", "author": "njdister", "createdAt": "2020-02-25T23:25:46Z", "path": "ops/ansible/roles/bfd-server/tasks/install.yml", "diffHunk": "@@ -24,154 +24,17 @@\n     mode: u=rwx,g=rx,o=rx\n   become: true\n \n-# TODO: This can be removed once we've fully migrated away from JBoss.\n-# The first time we dpeloy the new Jetty-based server, we need to ensure that JBoss is stopped first (if it already exists).\n-- name: Stop Existing BFD Server Service\n-  service:\n-    name: \"{{ data_server_appserver_service }}\"\n-    state: stopped\n-  become: true\n-  ignore_errors: true\n-\n - name: Copy BFD Server Launcher\n   copy:\n     src: \"{{ data_server_launcher }}\"\n     dest: \"{{ data_server_dir }}/{{ data_server_launcher | basename }}\"\n   become: true\n-  notify:\n-    - 'Restart BFD Server Service'\n \n - name: Copy BFD Server WAR\n   copy:\n     src: \"{{ data_server_war }}\"\n     dest: \"{{ data_server_dir }}/{{ data_server_war | basename }}\"\n   become: true\n-  notify:\n-    - 'Restart BFD Server Service'\n-\n-- name: Copy App Server Launcher Script\n-  template:\n-    src: bfd-server.sh.j2\n-    dest: \"{{ data_server_dir }}/bfd-server.sh\"\n-    owner: \"{{ data_server_user }}\"\n-    group: \"{{ data_server_user }}\"\n-    mode: u=rwx,g=rwx,o=rx\n-  become: true\n-  notify:\n-    - 'Restart BFD Server Service'\n-\n-- name: Create BFD Server Service Definition\n-  template:\n-    src: bluebutton-appserver.service.j2\n-    dest: \"/etc/systemd/system/{{ data_server_appserver_service }}.service\"\n-    owner: root\n-    group: root\n-    mode: u=rw,g=r,o=r\n-  become: true\n-  notify:\n-    - 'Enable BFD Server Service'\n-    - 'Restart BFD Server Service'\n-\n-- name: Check for BFD Server SSL Keystore\n-  stat:\n-    path: \"{{ data_server_dir }}/bluebutton-appserver-keystore.jks\"\n-  register: stat_appserver_keystore\n-  changed_when: false\n-  become: true\n-\n-- name: Create BFD Server SSL Keystore\n-  command: \"keytool -genkeypair -alias server {{ data_server_ssl_server_genkeypair_args }} -keystore {{ data_server_dir }}/bluebutton-appserver-keystore.jks -storepass changeit -keypass changeit\"\n-  when: stat_appserver_keystore.stat.isreg is not defined\n-  become: true\n-  become_user: \"{{ data_server_user }}\"\n-  no_log: true  # Ensure that the key args aren't logged if this command fails.\n-  notify:\n-    - 'Restart BFD Server Service'\n-\n-# TODO: Export server's public cert and publish to S3 or somesuch (so the frontend and others can pick it up).\n-\n-- name: Secure BFD Server SSL Keystore\n-  file:\n-    path: \"{{ data_server_dir }}/bluebutton-appserver-keystore.jks\"\n-    owner: \"{{ data_server_user }}\"\n-    group: \"{{ data_server_user }}\"\n-    mode: u=rw,g=,o=\n-  become: true\n-  notify:\n-    - 'Restart BFD Server Service'\n-\n-- name: Create BFD Server SSL Truststore Working Directory\n-  file:\n-    state: directory\n-    path: \"{{ data_server_dir }}/bluebutton-appserver-truststore-work\"\n-    owner: \"{{ data_server_user }}\"\n-    group: \"{{ data_server_user }}\"\n-    mode: u=rwx,g=rwx,o=rx\n-  become: true\n-\n-- name: Delete Previous BFD Server SSL Truststore Working Copy\n-  file:\n-    state: absent\n-    path: \"{{ data_server_dir }}/bluebutton-appserver-truststore-work/bluebutton-appserver-truststore.jks\"\n-  changed_when: false\n-  become: true\n-\n-- name: Create Empty App Server SSL Truststore Working Copy\n-  command: \"{{ item }}\"\n-  with_items:\n-    - \"keytool -genkeypair -alias fake -dname cn=fake -keypass changeit -keystore {{ data_server_dir }}/bluebutton-appserver-truststore-work/bluebutton-appserver-truststore.jks -storepass changeit\"\n-    - \"keytool -delete -alias fake -keystore {{ data_server_dir }}/bluebutton-appserver-truststore-work/bluebutton-appserver-truststore.jks -storepass changeit -keypass changeit\"\n-  changed_when: false\n-  become: true\n-  become_user: \"{{ data_server_user }}\"\n-\n-- name: Save App Server SSL Truststore Certificates\n-  copy:\n-    content: \"{{ item.certificate }}\"\n-    dest: \"{{ data_server_dir }}/bluebutton-appserver-truststore-work/{{ item.alias }}.crt\"\n-  with_items: \"{{ data_server_ssl_client_certificates }}\"\n-  changed_when: false\n-  become: true\n-  become_user: \"{{ data_server_user }}\"\n-\n-- name: Save App Server SSL Truststore Certificate Authorities\n-  copy:\n-    content: \"{{ item.certificate }}\"\n-    dest: \"{{ data_server_dir }}/bluebutton-appserver-truststore-work/{{ item.alias }}.crt\"\n-  with_items: \"{{ data_server_ssl_client_cas }}\"\n-  changed_when: false\n-  become: true\n-  become_user: \"{{ data_server_user }}\"\n-\n-- name: Import Certificates into App Server SSL Truststore Working Copy\n-  java_cert:\n-    cert_alias: \"{{ item.alias }}\"\n-    cert_path: \"{{ data_server_dir }}/bluebutton-appserver-truststore-work/{{ item.alias }}.crt\"\n-    keystore_pass: changeit\n-    keystore_path: \"{{ data_server_dir }}/bluebutton-appserver-truststore-work/bluebutton-appserver-truststore.jks\"\n-  with_items: \"{{ data_server_ssl_client_certificates }}\"\n-  changed_when: false\n-  become: true\n-  become_user: \"{{ data_server_user }}\"\n-\n-- name: Import Certificate Authorities into App Server SSL Truststore Working Copy\n-  command: \"keytool -importcert -noprompt -trustcacerts -alias {{ item.alias }} -file {{ data_server_dir }}/bluebutton-appserver-truststore-work/{{ item.alias }}.crt -keypass changeit -keystore {{ data_server_dir }}/bluebutton-appserver-truststore-work/bluebutton-appserver-truststore.jks -storepass changeit\"\n-  with_items: \"{{ data_server_ssl_client_cas }}\"\n-  changed_when: false\n-  become: true\n-  become_user: \"{{ data_server_user }}\"", "originalCommit": "acb4265653b493d7fad2a529da61bd9aaba25708", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDE5MDAyNw==", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/226#discussion_r384190027", "bodyText": "I can't think of any reason to to have a default env, potential vector for misconfiguration with agnostic AMIs.", "author": "njdister", "createdAt": "2020-02-25T23:29:17Z", "path": "ops/ansible/playbooks-ccs/launch_bfd-pipeline.yml", "diffHunk": "@@ -4,8 +4,6 @@\n ##\n - name: Configure ETL Server\n   hosts: localhost\n-  vars:\n-    env: \"test\"", "originalCommit": "acb4265653b493d7fad2a529da61bd9aaba25708", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjU1NTE5MA==", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/226#discussion_r386555190", "bodyText": "I feel like this was probably put in to avoid accidental deploys to other environments, but I have also have no issues with removing it.", "author": "cthulhuplus", "createdAt": "2020-03-02T18:01:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDE5MDAyNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjU1OTYzOA==", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/226#discussion_r386559638", "bodyText": "The scenario I was thinking of here was, if for some reason terraform doesn't properly pass the env var, I'd rather the deployment break entirely rather than just defaulting to test.", "author": "njdister", "createdAt": "2020-03-02T18:09:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDE5MDAyNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzMzODMxMg==", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/226#discussion_r387338312", "bodyText": "I like this.", "author": "jzulim", "createdAt": "2020-03-03T22:40:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDE5MDAyNw=="}], "type": "inlineReview"}, {"oid": "f130c769b7031bc1b0cca9fc35addef89d59920e", "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/f130c769b7031bc1b0cca9fc35addef89d59920e", "message": "Remove enviornmentId from params of buildAppAmis", "committedDate": "2020-02-26T20:19:18Z", "type": "commit"}, {"oid": "72b31b780c517090558d5f98c4fd95f108c2c29f", "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/72b31b780c517090558d5f98c4fd95f108c2c29f", "message": "With our current Jenkins merge strategy, the passed commit ID from Jenkins cannot be used with a repo checked out directly from GitHub", "committedDate": "2020-02-26T20:40:26Z", "type": "commit"}, {"oid": "39ef6602ce7f6815ec45460ec8b435e1a7e49cd9", "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/39ef6602ce7f6815ec45460ec8b435e1a7e49cd9", "message": "Leave uncommented in terraform, be more explicit in template", "committedDate": "2020-02-26T21:09:03Z", "type": "commit"}, {"oid": "327cca1af977ea790a18a6dda285e931b12c7299", "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/327cca1af977ea790a18a6dda285e931b12c7299", "message": "Add rng-tools in hopes of increasing slow truststore generation", "committedDate": "2020-02-26T22:28:15Z", "type": "commit"}, {"oid": "93f18bebaf32f5433ef494a3a600b2bac8a44268", "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/93f18bebaf32f5433ef494a3a600b2bac8a44268", "message": "DEBUG: add playbook statements to assist debugging", "committedDate": "2020-02-27T17:48:45Z", "type": "commit"}, {"oid": "f771570ebb05ed2c6bbc16a8837cbc264f1a6edf", "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/f771570ebb05ed2c6bbc16a8837cbc264f1a6edf", "message": "DEBUG: narrowing down debug statements", "committedDate": "2020-02-27T18:13:04Z", "type": "commit"}, {"oid": "0eb93d6171202eb033c32bba63aa3fe6d535b8a5", "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/0eb93d6171202eb033c32bba63aa3fe6d535b8a5", "message": "DEBUG: narrowing down debug statements", "committedDate": "2020-02-27T18:37:02Z", "type": "commit"}, {"oid": "57e8c25ee54030c88418e6d4dd1e77621418bf36", "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/57e8c25ee54030c88418e6d4dd1e77621418bf36", "message": "DEBUG: narrowing down debug statements", "committedDate": "2020-02-27T18:46:27Z", "type": "commit"}, {"oid": "803036642e12c69e05cde26145acdb6c9eef6126", "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/803036642e12c69e05cde26145acdb6c9eef6126", "message": "DEBUG: narrowing down debug statements", "committedDate": "2020-02-27T19:03:41Z", "type": "commit"}, {"oid": "3023817048265eafb6f5313e2378c7012900f9fe", "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/3023817048265eafb6f5313e2378c7012900f9fe", "message": "DEBUG: narrowing down debug statements", "committedDate": "2020-02-27T19:14:55Z", "type": "commit"}, {"oid": "b484f4a06e82131a3fd7133d528918682b82de8a", "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/b484f4a06e82131a3fd7133d528918682b82de8a", "message": "DEBUG: issue isolated to become_user, testing solutions", "committedDate": "2020-02-27T19:28:15Z", "type": "commit"}, {"oid": "1b91a68665fe54ff4c018033d647696d31351f7e", "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/1b91a68665fe54ff4c018033d647696d31351f7e", "message": "DEBUG: test connection local", "committedDate": "2020-02-27T19:42:23Z", "type": "commit"}, {"oid": "bc9ea6c8eaa310c2715ff98f08d1ce6928aa08fd", "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/bc9ea6c8eaa310c2715ff98f08d1ce6928aa08fd", "message": "DEBUG: test alternate become method", "committedDate": "2020-02-27T20:03:26Z", "type": "commit"}, {"oid": "7c697b8a4a99a9a7f5208bbce4d7431cfdc29316", "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/7c697b8a4a99a9a7f5208bbce4d7431cfdc29316", "message": "DEBUG: test timeliness of playbook when commenting out become_user, add perms fix", "committedDate": "2020-02-27T21:29:31Z", "type": "commit"}, {"oid": "f22ae1a328f3cbda37f6d97aaef165588c15c4a5", "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/f22ae1a328f3cbda37f6d97aaef165588c15c4a5", "message": "DEBUG: set perms recursively", "committedDate": "2020-02-27T21:31:07Z", "type": "commit"}, {"oid": "debb915c85a2e05c97183e8ff651d31454a6bec7", "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/debb915c85a2e05c97183e8ff651d31454a6bec7", "message": "DEBUG: testing", "committedDate": "2020-02-27T21:46:50Z", "type": "commit"}, {"oid": "4b4e3b47ed5d0e2c1bba3a11f93dc7a59ff5b2b8", "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/4b4e3b47ed5d0e2c1bba3a11f93dc7a59ff5b2b8", "message": "Comment out debug to test deploy times", "committedDate": "2020-03-02T15:31:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjUwNDE0OA==", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/226#discussion_r386504148", "bodyText": "It appears this was never working as intended, though if it was it would have broken due to the fact that the the commit ID is a unique merge commit that cannot be referenced from anywhere other than in that Jenkins build.  Fixing intended behavior here, but commenting out in the launch template.", "author": "njdister", "createdAt": "2020-03-02T16:32:06Z", "path": "ops/terraform/modules/resources/asg/main.tf", "diffHunk": "@@ -127,7 +127,7 @@ resource \"aws_launch_template\" \"main\" {\n     port          = var.lb_config.port\n     accountId     = var.launch_config.account_id\n     gitBranchName = var.launch_config.git_branch\n-    gitCommitId   = var.launch_config.git_branch\n+    gitCommitId   = var.launch_config.git_commit", "originalCommit": "4b4e3b47ed5d0e2c1bba3a11f93dc7a59ff5b2b8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjUwNDc5Nw==", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/226#discussion_r386504797", "bodyText": "Disabling this feature here until it's refactored to work as intended.", "author": "njdister", "createdAt": "2020-03-02T16:33:01Z", "path": "ops/terraform/modules/resources/templates/fhir_server.tpl", "diffHunk": "@@ -13,7 +13,9 @@ git clone https://github.com/CMSgov/beneficiary-fhir-data.git --branch ${gitBran\n \n cd beneficiary-fhir-data/ops/ansible/playbooks-ccs/\n \n-git checkout ${gitCommitId}\n+# At this time gitCommitId is a unique merge commit in Jenkins that cannot be properly\n+# checked out via GitHub, uncommenting this will break instance launch!\n+# git checkout ${gitCommitId}", "originalCommit": "4b4e3b47ed5d0e2c1bba3a11f93dc7a59ff5b2b8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjUwNDkxMg==", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/226#discussion_r386504912", "bodyText": "Disabling this feature here until it's refactored to work as intended.", "author": "njdister", "createdAt": "2020-03-02T16:33:11Z", "path": "ops/terraform/modules/resources/templates/pipeline_server.tpl", "diffHunk": "@@ -13,7 +13,9 @@ git clone https://github.com/CMSgov/beneficiary-fhir-data.git --branch ${gitBran\n \n cd beneficiary-fhir-data/ops/ansible/playbooks-ccs/\n \n-git checkout ${gitCommitId}\n+# At this time gitCommitId is a unique merge commit in Jenkins that cannot be properly\n+# checked out via GitHub, uncommenting this will break instance launch!\n+# git checkout ${gitCommitId}", "originalCommit": "4b4e3b47ed5d0e2c1bba3a11f93dc7a59ff5b2b8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjU5MTM5NA==", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/226#discussion_r386591394", "bodyText": "Is there a ticket to make something that works? The need to tie AMI to commit is still valid.", "author": "RickHawesUSDS", "createdAt": "2020-03-02T19:09:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjUwNDkxMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjYzNDk3OQ==", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/226#discussion_r386634979", "bodyText": "No, I'll go ahead and make one.", "author": "njdister", "createdAt": "2020-03-02T20:35:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjUwNDkxMg=="}], "type": "inlineReview"}, {"oid": "cb6b8a529d56dbe15f2fafd39c283bd3b7f49bfc", "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/cb6b8a529d56dbe15f2fafd39c283bd3b7f49bfc", "message": "Use permissions setting rather than become_user to set permissions on certs", "committedDate": "2020-03-02T16:37:06Z", "type": "commit"}, {"oid": "f917a2819fd5a41494c60e53e65f19f49aa9b9f5", "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/f917a2819fd5a41494c60e53e65f19f49aa9b9f5", "message": "Revert \"Add rng-tools in hopes of increasing slow truststore generation\"\n\nThis reverts commit 327cca1af977ea790a18a6dda285e931b12c7299.", "committedDate": "2020-03-02T16:46:52Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjU5MzExMw==", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/226#discussion_r386593113", "bodyText": "I really love the fact that you are removing all of the healthapt cases.", "author": "RickHawesUSDS", "createdAt": "2020-03-02T19:12:32Z", "path": "apps/build.groovy", "diffHunk": "@@ -70,12 +49,9 @@ class AppBuildResults implements Serializable {\n  \n def build(String build_env) {\n \tdir ('apps') {\n-\t\tif (build_env == 'healthapt') {\n-\t\t\tmvn \"--update-snapshots -Dmaven.test.failure.ignore clean verify -Dhttp.nonProxyHosts=localhost\"\n-\t\t} else if (build_env == 'ccs') {\n-\t\t\tmvn \"--update-snapshots -Dmaven.test.failure.ignore clean verify\"\n-\t\t} else \n-\t\tUnsupportedOperationException(\"No Build Apps job available for ${params.dev_env} environment\")\n+", "originalCommit": "f917a2819fd5a41494c60e53e65f19f49aa9b9f5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}