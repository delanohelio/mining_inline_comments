{"pr_number": 424, "pr_title": "BFD-549 Separated out db migration", "pr_createdAt": "2020-12-28T19:57:39Z", "pr_url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/424", "timeline": [{"oid": "66813c5326ad1f43fd91f0bac97b2c415eb57b7e", "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/66813c5326ad1f43fd91f0bac97b2c415eb57b7e", "message": "Separated out db migration", "committedDate": "2020-12-28T19:55:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU1NTg1Mw==", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/424#discussion_r549555853", "bodyText": "Just curious: what is \"the column\"?", "author": "karlmdavis", "createdAt": "2020-12-29T03:34:20Z", "path": "apps/bfd-model/bfd-model-rif/src/main/resources/db/migration/V27__Create_BeneficiaryMonthlytable.sql", "diffHunk": "@@ -0,0 +1,142 @@\n+/*\n+ * The column doesn't have a default value to avoid updating the column on migration. The pipeline server", "originalCommit": "66813c5326ad1f43fd91f0bac97b2c415eb57b7e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU1ODIzOQ==", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/424#discussion_r549558239", "bodyText": "done", "author": "cbrunefearless", "createdAt": "2020-12-29T03:50:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU1NTg1Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU1NjMwOA==", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/424#discussion_r549556308", "bodyText": "Did we ever get a final answer as to why we have all the null beneEnrollmentReferenceYear records? Regardless, I'd suggest adding a comment here explaining why we're leaving them out -- even if it's just \"we don't know why there are null values for this column, but we'll figure that out later in BFD-12345.\"", "author": "karlmdavis", "createdAt": "2020-12-29T03:36:59Z", "path": "apps/bfd-model/bfd-model-rif/src/main/resources/db/migration/V27__Create_BeneficiaryMonthlytable.sql", "diffHunk": "@@ -0,0 +1,142 @@\n+/*\n+ * The column doesn't have a default value to avoid updating the column on migration. The pipeline server\n+ * will populate the column as new beneficaries are added or existing beneficaries are updated. \n+ */\n+\n+${logic.tablespaces-escape} SET default_tablespace = fhirdb_ts2;\n+\n+create table \"BeneficiaryMonthly\" (\n+    \"parentBeneficiary\" varchar(255) not null,\n+    \"yearMonth\" date not null,\n+    \"fipsStateCntyCode\" varchar(5),\n+    \"medicareStatusCode\" varchar(2),\n+    \"entitlementBuyInInd\" char(1),\n+    \"hmoIndicatorInd\" char(1),\n+    \"partCContractNumberId\" varchar(5),\n+    \"partCPbpNumberId\" varchar(3),\n+    \"partCPlanTypeCode\" varchar(3),\n+    \"partDContractNumberId\" varchar(5),\n+    \"partDPbpNumberId\" varchar(3),\n+    \"partDSegmentNumberId\" varchar(3),\n+    \"partDRetireeDrugSubsidyInd\" char(1),\n+    \"medicaidDualEligibilityCode\" varchar(2),\n+    \"partDLowIncomeCostShareGroupCode\" varchar(2),\n+    constraint \"BeneficiaryMonthly_pkey\" primary key (\"parentBeneficiary\", \"yearMonth\")\n+)\n+${logic.tablespaces-escape} tablespace \"beneficiarymonthly_ts\"\n+;\n+\n+\n+\n+INSERT INTO \"BeneficiaryMonthly\" \n+    SELECT  \"beneficiaryId\", TO_DATE(CONCAT(\"beneEnrollmentReferenceYear\", '/01/01'), 'YYYY/MM/DD') as \"yearMonth\", \"fipsStateCntyJanCode\",\n+    \"medicareStatusJanCode\", \"entitlementBuyInJanInd\", \"hmoIndicatorJanInd\",\n+    \"partCContractNumberJanId\", \"partCPbpNumberJanId\", \"partCPlanTypeJanCode\",\n+    \"partDContractNumberJanId\", \"partDPbpNumberJanId\", \"partDSegmentNumberJanId\",\n+    \"partDRetireeDrugSubsidyJanInd\", \"medicaidDualEligibilityJanCode\", \"partDLowIncomeCostShareGroupJanCode\"\n+    FROM \"Beneficiaries\"\n+    WHERE \"beneEnrollmentReferenceYear\" is not null;\n+\n+INSERT INTO \"BeneficiaryMonthly\" \n+    SELECT  \"beneficiaryId\", TO_DATE(CONCAT(\"beneEnrollmentReferenceYear\", '/02/01'), 'YYYY/MM/DD') as \"yearMonth\", \"fipsStateCntyFebCode\",\n+    \"medicareStatusFebCode\", \"entitlementBuyInFebInd\", \"hmoIndicatorFebInd\",\n+    \"partCContractNumberFebId\", \"partCPbpNumberFebId\", \"partCPlanTypeFebCode\",\n+    \"partDContractNumberFebId\", \"partDPbpNumberFebId\", \"partDSegmentNumberFebId\",\n+    \"partDRetireeDrugSubsidyFebInd\", \"medicaidDualEligibilityFebCode\", \"partDLowIncomeCostShareGroupFebCode\"\n+    FROM \"Beneficiaries\"\n+    WHERE \"beneEnrollmentReferenceYear\" is not null;\n+\n+INSERT INTO \"BeneficiaryMonthly\" \n+    SELECT \"beneficiaryId\", TO_DATE(CONCAT(\"beneEnrollmentReferenceYear\", '/03/01'), 'YYYY/MM/DD') as \"yearMonth\", \"fipsStateCntyMarCode\",\n+    \"medicareStatusMarCode\", \"entitlementBuyInMarInd\", \"hmoIndicatorMarInd\",\n+    \"partCContractNumberMarId\", \"partCPbpNumberMarId\", \"partCPlanTypeMarCode\",\n+    \"partDContractNumberMarId\", \"partDPbpNumberMarId\", \"partDSegmentNumberMarId\",\n+    \"partDRetireeDrugSubsidyMarInd\", \"medicaidDualEligibilityMarCode\", \"partDLowIncomeCostShareGroupMarCode\"\n+    FROM \"Beneficiaries\"\n+    WHERE \"beneEnrollmentReferenceYear\" is not null;\n+\n+INSERT INTO \"BeneficiaryMonthly\" \n+    SELECT  \"beneficiaryId\", TO_DATE(CONCAT(\"beneEnrollmentReferenceYear\", '/04/01'), 'YYYY/MM/DD') as \"yearMonth\", \"fipsStateCntyAprCode\",\n+    \"medicareStatusAprCode\", \"entitlementBuyInAprInd\", \"hmoIndicatorAprInd\",\n+    \"partCContractNumberAprId\", \"partCPbpNumberAprId\", \"partCPlanTypeAprCode\",\n+    \"partDContractNumberAprId\", \"partDPbpNumberAprId\", \"partDSegmentNumberAprId\",\n+    \"partDRetireeDrugSubsidyAprInd\", \"medicaidDualEligibilityAprCode\", \"partDLowIncomeCostShareGroupAprCode\"\n+    FROM \"Beneficiaries\"\n+    WHERE \"beneEnrollmentReferenceYear\" is not null;\n+\n+INSERT INTO \"BeneficiaryMonthly\" \n+    SELECT  \"beneficiaryId\", TO_DATE(CONCAT(\"beneEnrollmentReferenceYear\", '/05/01'), 'YYYY/MM/DD') as \"yearMonth\", \"fipsStateCntyMayCode\",\n+    \"medicareStatusMayCode\", \"entitlementBuyInMayInd\", \"hmoIndicatorMayInd\",\n+    \"partCContractNumberMayId\", \"partCPbpNumberMayId\", \"partCPlanTypeMayCode\",\n+    \"partDContractNumberMayId\", \"partDPbpNumberMayId\", \"partDSegmentNumberMayId\",\n+    \"partDRetireeDrugSubsidyMayInd\", \"medicaidDualEligibilityMayCode\", \"partDLowIncomeCostShareGroupMayCode\"\n+    FROM \"Beneficiaries\"\n+    WHERE \"beneEnrollmentReferenceYear\" is not null;\n+\n+INSERT INTO \"BeneficiaryMonthly\" \n+    SELECT  \"beneficiaryId\", TO_DATE(CONCAT(\"beneEnrollmentReferenceYear\", '/06/01'), 'YYYY/MM/DD') as \"yearMonth\", \"fipsStateCntyJunCode\",\n+    \"medicareStatusJunCode\", \"entitlementBuyInJunInd\", \"hmoIndicatorJunInd\",\n+    \"partCContractNumberJunId\", \"partCPbpNumberJunId\", \"partCPlanTypeJunCode\",\n+    \"partDContractNumberJunId\", \"partDPbpNumberJunId\", \"partDSegmentNumberJunId\",\n+    \"partDRetireeDrugSubsidyJunInd\", \"medicaidDualEligibilityJunCode\", \"partDLowIncomeCostShareGroupJunCode\"\n+    FROM \"Beneficiaries\"\n+    WHERE \"beneEnrollmentReferenceYear\" is not null;\n+\n+INSERT INTO \"BeneficiaryMonthly\" \n+    SELECT  \"beneficiaryId\", TO_DATE(CONCAT(\"beneEnrollmentReferenceYear\", '/07/01'), 'YYYY/MM/DD')as \"yearMonth\", \"fipsStateCntyJulCode\",\n+    \"medicareStatusJulCode\", \"entitlementBuyInJulInd\", \"hmoIndicatorJulInd\",\n+    \"partCContractNumberJulId\", \"partCPbpNumberJulId\", \"partCPlanTypeJulCode\",\n+    \"partDContractNumberJulId\", \"partDPbpNumberJulId\", \"partDSegmentNumberJulId\",\n+    \"partDRetireeDrugSubsidyJulInd\", \"medicaidDualEligibilityJulCode\", \"partDLowIncomeCostShareGroupJulCode\"\n+    FROM \"Beneficiaries\"\n+    WHERE \"beneEnrollmentReferenceYear\" is not null;\n+\n+INSERT INTO \"BeneficiaryMonthly\" \n+    SELECT  \"beneficiaryId\", TO_DATE(CONCAT(\"beneEnrollmentReferenceYear\", '/08/01'), 'YYYY/MM/DD') as \"yearMonth\", \"fipsStateCntyAugCode\",\n+    \"medicareStatusAugCode\", \"entitlementBuyInAugInd\", \"hmoIndicatorAugInd\",\n+    \"partCContractNumberAugId\", \"partCPbpNumberAugId\", \"partCPlanTypeAugCode\",\n+    \"partDContractNumberAugId\", \"partDPbpNumberAugId\", \"partDSegmentNumberAugId\",\n+    \"partDRetireeDrugSubsidyAugInd\", \"medicaidDualEligibilityAugCode\", \"partDLowIncomeCostShareGroupAugCode\"\n+    FROM \"Beneficiaries\"\n+    WHERE \"beneEnrollmentReferenceYear\" is not null;\n+\n+INSERT INTO \"BeneficiaryMonthly\" \n+    SELECT  \"beneficiaryId\", TO_DATE(CONCAT(\"beneEnrollmentReferenceYear\", '/09/01'), 'YYYY/MM/DD') as \"yearMonth\", \"fipsStateCntySeptCode\",\n+    \"medicareStatusSeptCode\", \"entitlementBuyInSeptInd\", \"hmoIndicatorSeptInd\",\n+    \"partCContractNumberSeptId\", \"partCPbpNumberSeptId\", \"partCPlanTypeSeptCode\",\n+    \"partDContractNumberSeptId\", \"partDPbpNumberSeptId\", \"partDSegmentNumberSeptId\",\n+    \"partDRetireeDrugSubsidySeptInd\", \"medicaidDualEligibilitySeptCode\", \"partDLowIncomeCostShareGroupSeptCode\"\n+    FROM \"Beneficiaries\"\n+    WHERE \"beneEnrollmentReferenceYear\" is not null;\n+\n+INSERT INTO \"BeneficiaryMonthly\" \n+   SELECT  \"beneficiaryId\", TO_DATE(CONCAT(\"beneEnrollmentReferenceYear\", '/10/01'), 'YYYY/MM/DD') as \"yearMonth\", \"fipsStateCntyOctCode\",\n+    \"medicareStatusOctCode\", \"entitlementBuyInOctInd\", \"hmoIndicatorOctInd\",\n+    \"partCContractNumberOctId\", \"partCPbpNumberOctId\", \"partCPlanTypeOctCode\",\n+    \"partDContractNumberOctId\", \"partDPbpNumberOctId\", \"partDSegmentNumberOctId\",\n+    \"partDRetireeDrugSubsidyOctInd\", \"medicaidDualEligibilityOctCode\", \"partDLowIncomeCostShareGroupOctCode\"\n+    FROM \"Beneficiaries\"\n+    WHERE \"beneEnrollmentReferenceYear\" is not null;  \n+\n+INSERT INTO \"BeneficiaryMonthly\" \n+    SELECT  \"beneficiaryId\", TO_DATE(CONCAT(\"beneEnrollmentReferenceYear\", '/11/01'), 'YYYY/MM/DD') as \"yearMonth\", \"fipsStateCntyNovCode\",\n+    \"medicareStatusNovCode\", \"entitlementBuyInNovInd\", \"hmoIndicatorNovInd\",\n+    \"partCContractNumberNovId\", \"partCPbpNumberNovId\", \"partCPlanTypeNovCode\",\n+    \"partDContractNumberNovId\", \"partDPbpNumberNovId\", \"partDSegmentNumberNovId\",\n+    \"partDRetireeDrugSubsidyNovInd\", \"medicaidDualEligibilityNovCode\", \"partDLowIncomeCostShareGroupNovCode\"\n+    FROM \"Beneficiaries\"\n+    WHERE \"beneEnrollmentReferenceYear\" is not null;  \n+\n+INSERT INTO \"BeneficiaryMonthly\" \n+    SELECT  \"beneficiaryId\", TO_DATE(CONCAT(\"beneEnrollmentReferenceYear\", '/12/01'), 'YYYY/MM/DD') as \"yearMonth\", \"fipsStateCntyDecCode\",\n+    \"medicareStatusDecCode\", \"entitlementBuyInDecInd\", \"hmoIndicatorDecInd\",\n+    \"partCContractNumberDecId\", \"partCPbpNumberDecId\", \"partCPlanTypeDecCode\",\n+    \"partDContractNumberDecId\", \"partDPbpNumberDecId\", \"partDSegmentNumberDecId\",\n+    \"partDRetireeDrugSubsidyDecInd\", \"medicaidDualEligibilityDecCode\", \"partDLowIncomeCostShareGroupDecCode\"\n+    FROM \"Beneficiaries\"\n+    WHERE \"beneEnrollmentReferenceYear\" is not null;", "originalCommit": "66813c5326ad1f43fd91f0bac97b2c415eb57b7e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU1Njc4OQ==", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/424#discussion_r549556789", "bodyText": "Thinking about it a bit more, @jzulim, with all the records you found that had a null beneEnrollmentReferenceYear, did any of them have non-null values for the other columns here?", "author": "karlmdavis", "createdAt": "2020-12-29T03:40:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU1NjMwOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU1ODIyNQ==", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/424#discussion_r549558225", "bodyText": "Added comment", "author": "cbrunefearless", "createdAt": "2020-12-29T03:50:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU1NjMwOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU1NjM3Ng==", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/424#discussion_r549556376", "bodyText": "You have a copy-paste error here to fix:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              add constraint \"BeneficiaryMonthly_parentClaim_to_Beneficiary\" foreign key (\"parentBeneficiary\") \n          \n          \n            \n              add constraint \"BeneficiaryMonthly_parentBeneficiary_to_Beneficiary\" foreign key (\"parentBeneficiary\")", "author": "karlmdavis", "createdAt": "2020-12-29T03:37:43Z", "path": "apps/bfd-model/bfd-model-rif/src/main/resources/db/migration/V27__Create_BeneficiaryMonthlytable.sql", "diffHunk": "@@ -0,0 +1,142 @@\n+/*\n+ * The column doesn't have a default value to avoid updating the column on migration. The pipeline server\n+ * will populate the column as new beneficaries are added or existing beneficaries are updated. \n+ */\n+\n+${logic.tablespaces-escape} SET default_tablespace = fhirdb_ts2;\n+\n+create table \"BeneficiaryMonthly\" (\n+    \"parentBeneficiary\" varchar(255) not null,\n+    \"yearMonth\" date not null,\n+    \"fipsStateCntyCode\" varchar(5),\n+    \"medicareStatusCode\" varchar(2),\n+    \"entitlementBuyInInd\" char(1),\n+    \"hmoIndicatorInd\" char(1),\n+    \"partCContractNumberId\" varchar(5),\n+    \"partCPbpNumberId\" varchar(3),\n+    \"partCPlanTypeCode\" varchar(3),\n+    \"partDContractNumberId\" varchar(5),\n+    \"partDPbpNumberId\" varchar(3),\n+    \"partDSegmentNumberId\" varchar(3),\n+    \"partDRetireeDrugSubsidyInd\" char(1),\n+    \"medicaidDualEligibilityCode\" varchar(2),\n+    \"partDLowIncomeCostShareGroupCode\" varchar(2),\n+    constraint \"BeneficiaryMonthly_pkey\" primary key (\"parentBeneficiary\", \"yearMonth\")\n+)\n+${logic.tablespaces-escape} tablespace \"beneficiarymonthly_ts\"\n+;\n+\n+\n+\n+INSERT INTO \"BeneficiaryMonthly\" \n+    SELECT  \"beneficiaryId\", TO_DATE(CONCAT(\"beneEnrollmentReferenceYear\", '/01/01'), 'YYYY/MM/DD') as \"yearMonth\", \"fipsStateCntyJanCode\",\n+    \"medicareStatusJanCode\", \"entitlementBuyInJanInd\", \"hmoIndicatorJanInd\",\n+    \"partCContractNumberJanId\", \"partCPbpNumberJanId\", \"partCPlanTypeJanCode\",\n+    \"partDContractNumberJanId\", \"partDPbpNumberJanId\", \"partDSegmentNumberJanId\",\n+    \"partDRetireeDrugSubsidyJanInd\", \"medicaidDualEligibilityJanCode\", \"partDLowIncomeCostShareGroupJanCode\"\n+    FROM \"Beneficiaries\"\n+    WHERE \"beneEnrollmentReferenceYear\" is not null;\n+\n+INSERT INTO \"BeneficiaryMonthly\" \n+    SELECT  \"beneficiaryId\", TO_DATE(CONCAT(\"beneEnrollmentReferenceYear\", '/02/01'), 'YYYY/MM/DD') as \"yearMonth\", \"fipsStateCntyFebCode\",\n+    \"medicareStatusFebCode\", \"entitlementBuyInFebInd\", \"hmoIndicatorFebInd\",\n+    \"partCContractNumberFebId\", \"partCPbpNumberFebId\", \"partCPlanTypeFebCode\",\n+    \"partDContractNumberFebId\", \"partDPbpNumberFebId\", \"partDSegmentNumberFebId\",\n+    \"partDRetireeDrugSubsidyFebInd\", \"medicaidDualEligibilityFebCode\", \"partDLowIncomeCostShareGroupFebCode\"\n+    FROM \"Beneficiaries\"\n+    WHERE \"beneEnrollmentReferenceYear\" is not null;\n+\n+INSERT INTO \"BeneficiaryMonthly\" \n+    SELECT \"beneficiaryId\", TO_DATE(CONCAT(\"beneEnrollmentReferenceYear\", '/03/01'), 'YYYY/MM/DD') as \"yearMonth\", \"fipsStateCntyMarCode\",\n+    \"medicareStatusMarCode\", \"entitlementBuyInMarInd\", \"hmoIndicatorMarInd\",\n+    \"partCContractNumberMarId\", \"partCPbpNumberMarId\", \"partCPlanTypeMarCode\",\n+    \"partDContractNumberMarId\", \"partDPbpNumberMarId\", \"partDSegmentNumberMarId\",\n+    \"partDRetireeDrugSubsidyMarInd\", \"medicaidDualEligibilityMarCode\", \"partDLowIncomeCostShareGroupMarCode\"\n+    FROM \"Beneficiaries\"\n+    WHERE \"beneEnrollmentReferenceYear\" is not null;\n+\n+INSERT INTO \"BeneficiaryMonthly\" \n+    SELECT  \"beneficiaryId\", TO_DATE(CONCAT(\"beneEnrollmentReferenceYear\", '/04/01'), 'YYYY/MM/DD') as \"yearMonth\", \"fipsStateCntyAprCode\",\n+    \"medicareStatusAprCode\", \"entitlementBuyInAprInd\", \"hmoIndicatorAprInd\",\n+    \"partCContractNumberAprId\", \"partCPbpNumberAprId\", \"partCPlanTypeAprCode\",\n+    \"partDContractNumberAprId\", \"partDPbpNumberAprId\", \"partDSegmentNumberAprId\",\n+    \"partDRetireeDrugSubsidyAprInd\", \"medicaidDualEligibilityAprCode\", \"partDLowIncomeCostShareGroupAprCode\"\n+    FROM \"Beneficiaries\"\n+    WHERE \"beneEnrollmentReferenceYear\" is not null;\n+\n+INSERT INTO \"BeneficiaryMonthly\" \n+    SELECT  \"beneficiaryId\", TO_DATE(CONCAT(\"beneEnrollmentReferenceYear\", '/05/01'), 'YYYY/MM/DD') as \"yearMonth\", \"fipsStateCntyMayCode\",\n+    \"medicareStatusMayCode\", \"entitlementBuyInMayInd\", \"hmoIndicatorMayInd\",\n+    \"partCContractNumberMayId\", \"partCPbpNumberMayId\", \"partCPlanTypeMayCode\",\n+    \"partDContractNumberMayId\", \"partDPbpNumberMayId\", \"partDSegmentNumberMayId\",\n+    \"partDRetireeDrugSubsidyMayInd\", \"medicaidDualEligibilityMayCode\", \"partDLowIncomeCostShareGroupMayCode\"\n+    FROM \"Beneficiaries\"\n+    WHERE \"beneEnrollmentReferenceYear\" is not null;\n+\n+INSERT INTO \"BeneficiaryMonthly\" \n+    SELECT  \"beneficiaryId\", TO_DATE(CONCAT(\"beneEnrollmentReferenceYear\", '/06/01'), 'YYYY/MM/DD') as \"yearMonth\", \"fipsStateCntyJunCode\",\n+    \"medicareStatusJunCode\", \"entitlementBuyInJunInd\", \"hmoIndicatorJunInd\",\n+    \"partCContractNumberJunId\", \"partCPbpNumberJunId\", \"partCPlanTypeJunCode\",\n+    \"partDContractNumberJunId\", \"partDPbpNumberJunId\", \"partDSegmentNumberJunId\",\n+    \"partDRetireeDrugSubsidyJunInd\", \"medicaidDualEligibilityJunCode\", \"partDLowIncomeCostShareGroupJunCode\"\n+    FROM \"Beneficiaries\"\n+    WHERE \"beneEnrollmentReferenceYear\" is not null;\n+\n+INSERT INTO \"BeneficiaryMonthly\" \n+    SELECT  \"beneficiaryId\", TO_DATE(CONCAT(\"beneEnrollmentReferenceYear\", '/07/01'), 'YYYY/MM/DD')as \"yearMonth\", \"fipsStateCntyJulCode\",\n+    \"medicareStatusJulCode\", \"entitlementBuyInJulInd\", \"hmoIndicatorJulInd\",\n+    \"partCContractNumberJulId\", \"partCPbpNumberJulId\", \"partCPlanTypeJulCode\",\n+    \"partDContractNumberJulId\", \"partDPbpNumberJulId\", \"partDSegmentNumberJulId\",\n+    \"partDRetireeDrugSubsidyJulInd\", \"medicaidDualEligibilityJulCode\", \"partDLowIncomeCostShareGroupJulCode\"\n+    FROM \"Beneficiaries\"\n+    WHERE \"beneEnrollmentReferenceYear\" is not null;\n+\n+INSERT INTO \"BeneficiaryMonthly\" \n+    SELECT  \"beneficiaryId\", TO_DATE(CONCAT(\"beneEnrollmentReferenceYear\", '/08/01'), 'YYYY/MM/DD') as \"yearMonth\", \"fipsStateCntyAugCode\",\n+    \"medicareStatusAugCode\", \"entitlementBuyInAugInd\", \"hmoIndicatorAugInd\",\n+    \"partCContractNumberAugId\", \"partCPbpNumberAugId\", \"partCPlanTypeAugCode\",\n+    \"partDContractNumberAugId\", \"partDPbpNumberAugId\", \"partDSegmentNumberAugId\",\n+    \"partDRetireeDrugSubsidyAugInd\", \"medicaidDualEligibilityAugCode\", \"partDLowIncomeCostShareGroupAugCode\"\n+    FROM \"Beneficiaries\"\n+    WHERE \"beneEnrollmentReferenceYear\" is not null;\n+\n+INSERT INTO \"BeneficiaryMonthly\" \n+    SELECT  \"beneficiaryId\", TO_DATE(CONCAT(\"beneEnrollmentReferenceYear\", '/09/01'), 'YYYY/MM/DD') as \"yearMonth\", \"fipsStateCntySeptCode\",\n+    \"medicareStatusSeptCode\", \"entitlementBuyInSeptInd\", \"hmoIndicatorSeptInd\",\n+    \"partCContractNumberSeptId\", \"partCPbpNumberSeptId\", \"partCPlanTypeSeptCode\",\n+    \"partDContractNumberSeptId\", \"partDPbpNumberSeptId\", \"partDSegmentNumberSeptId\",\n+    \"partDRetireeDrugSubsidySeptInd\", \"medicaidDualEligibilitySeptCode\", \"partDLowIncomeCostShareGroupSeptCode\"\n+    FROM \"Beneficiaries\"\n+    WHERE \"beneEnrollmentReferenceYear\" is not null;\n+\n+INSERT INTO \"BeneficiaryMonthly\" \n+   SELECT  \"beneficiaryId\", TO_DATE(CONCAT(\"beneEnrollmentReferenceYear\", '/10/01'), 'YYYY/MM/DD') as \"yearMonth\", \"fipsStateCntyOctCode\",\n+    \"medicareStatusOctCode\", \"entitlementBuyInOctInd\", \"hmoIndicatorOctInd\",\n+    \"partCContractNumberOctId\", \"partCPbpNumberOctId\", \"partCPlanTypeOctCode\",\n+    \"partDContractNumberOctId\", \"partDPbpNumberOctId\", \"partDSegmentNumberOctId\",\n+    \"partDRetireeDrugSubsidyOctInd\", \"medicaidDualEligibilityOctCode\", \"partDLowIncomeCostShareGroupOctCode\"\n+    FROM \"Beneficiaries\"\n+    WHERE \"beneEnrollmentReferenceYear\" is not null;  \n+\n+INSERT INTO \"BeneficiaryMonthly\" \n+    SELECT  \"beneficiaryId\", TO_DATE(CONCAT(\"beneEnrollmentReferenceYear\", '/11/01'), 'YYYY/MM/DD') as \"yearMonth\", \"fipsStateCntyNovCode\",\n+    \"medicareStatusNovCode\", \"entitlementBuyInNovInd\", \"hmoIndicatorNovInd\",\n+    \"partCContractNumberNovId\", \"partCPbpNumberNovId\", \"partCPlanTypeNovCode\",\n+    \"partDContractNumberNovId\", \"partDPbpNumberNovId\", \"partDSegmentNumberNovId\",\n+    \"partDRetireeDrugSubsidyNovInd\", \"medicaidDualEligibilityNovCode\", \"partDLowIncomeCostShareGroupNovCode\"\n+    FROM \"Beneficiaries\"\n+    WHERE \"beneEnrollmentReferenceYear\" is not null;  \n+\n+INSERT INTO \"BeneficiaryMonthly\" \n+    SELECT  \"beneficiaryId\", TO_DATE(CONCAT(\"beneEnrollmentReferenceYear\", '/12/01'), 'YYYY/MM/DD') as \"yearMonth\", \"fipsStateCntyDecCode\",\n+    \"medicareStatusDecCode\", \"entitlementBuyInDecInd\", \"hmoIndicatorDecInd\",\n+    \"partCContractNumberDecId\", \"partCPbpNumberDecId\", \"partCPlanTypeDecCode\",\n+    \"partDContractNumberDecId\", \"partDPbpNumberDecId\", \"partDSegmentNumberDecId\",\n+    \"partDRetireeDrugSubsidyDecInd\", \"medicaidDualEligibilityDecCode\", \"partDLowIncomeCostShareGroupDecCode\"\n+    FROM \"Beneficiaries\"\n+    WHERE \"beneEnrollmentReferenceYear\" is not null;\n+\n+alter table \"BeneficiaryMonthly\" \n+  add constraint \"BeneficiaryMonthly_parentClaim_to_Beneficiary\" foreign key (\"parentBeneficiary\") ", "originalCommit": "66813c5326ad1f43fd91f0bac97b2c415eb57b7e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU1ODIwNg==", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/424#discussion_r549558206", "bodyText": "Changed", "author": "cbrunefearless", "createdAt": "2020-12-29T03:50:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU1NjM3Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU1ODY1Nw==", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/424#discussion_r549558657", "bodyText": "Nice eyes. Upset I didnt catch that. TY.", "author": "jzulim", "createdAt": "2020-12-29T03:54:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU1NjM3Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU2MzU2MA==", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/424#discussion_r549563560", "bodyText": "@jzulim I've looked at this... five times or so now, and it's the first time I noticed it, so... \ud83e\udd37.", "author": "karlmdavis", "createdAt": "2020-12-29T04:27:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU1NjM3Ng=="}], "type": "inlineReview"}, {"oid": "4492204abb5d7746a74fe5ce6b3720d4149e6072", "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/4492204abb5d7746a74fe5ce6b3720d4149e6072", "message": "MAde changes from pr comments also changed .validate to .update for jpa settings", "committedDate": "2020-12-29T03:50:16Z", "type": "commit"}, {"oid": "e71fff300b42ed89f3991827874e9547789c1308", "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/e71fff300b42ed89f3991827874e9547789c1308", "message": "Changed the spring parametwers", "committedDate": "2020-12-29T03:59:51Z", "type": "commit"}, {"oid": "a615efd548e886e5d7d55d186766246a1f19c068", "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/a615efd548e886e5d7d55d186766246a1f19c068", "message": "Set parameter to none", "committedDate": "2020-12-29T04:05:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU2NDIxNA==", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/424#discussion_r549564214", "bodyText": "Apologies, I'd probably explain a bit more here (folks tend to look at the DB migrations when onboarding, so it's good to explain ourselves in them).\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            /* we don't know why there are null values for this column, but we'll figure that out later in a different story.\" */\n          \n          \n            \n            /*\n          \n          \n            \n             * Per the CCW folks, the beneEnrollmentReferenceYear column is null for newer bene records that\n          \n          \n            \n             * haven't received data from all sources yet. There are over a million such records, which is a bit concerning,\n          \n          \n            \n             * but that will be addressed in a separate ticket, if needed.\n          \n          \n            \n             */", "author": "karlmdavis", "createdAt": "2020-12-29T04:32:23Z", "path": "apps/bfd-model/bfd-model-rif/src/main/resources/db/migration/V27__Create_BeneficiaryMonthlytable.sql", "diffHunk": "@@ -0,0 +1,141 @@\n+/*\n+ * The pipeline server will populate the table as new beneficaries are added or existing beneficaries are updated. \n+ */\n+\n+${logic.tablespaces-escape} SET default_tablespace = fhirdb_ts2;\n+\n+create table \"BeneficiaryMonthly\" (\n+    \"parentBeneficiary\" varchar(255) not null,\n+    \"yearMonth\" date not null,\n+    \"fipsStateCntyCode\" varchar(5),\n+    \"medicareStatusCode\" varchar(2),\n+    \"entitlementBuyInInd\" char(1),\n+    \"hmoIndicatorInd\" char(1),\n+    \"partCContractNumberId\" varchar(5),\n+    \"partCPbpNumberId\" varchar(3),\n+    \"partCPlanTypeCode\" varchar(3),\n+    \"partDContractNumberId\" varchar(5),\n+    \"partDPbpNumberId\" varchar(3),\n+    \"partDSegmentNumberId\" varchar(3),\n+    \"partDRetireeDrugSubsidyInd\" char(1),\n+    \"medicaidDualEligibilityCode\" varchar(2),\n+    \"partDLowIncomeCostShareGroupCode\" varchar(2),\n+    constraint \"BeneficiaryMonthly_pkey\" primary key (\"parentBeneficiary\", \"yearMonth\")\n+)\n+${logic.tablespaces-escape} tablespace \"beneficiarymonthly_ts\"\n+;\n+\n+/* we don't know why there are null values for this column, but we'll figure that out later in a different story.\" */", "originalCommit": "a615efd548e886e5d7d55d186766246a1f19c068", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU2NzExMA==", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/424#discussion_r549567110", "bodyText": "changed the comment", "author": "cbrunefearless", "createdAt": "2020-12-29T04:51:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU2NDIxNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU2NDMzMQ==", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/424#discussion_r549564331", "bodyText": "Won't having this same change give you a merge conflict? Or is Git / GitHub smart enough to avoid that?", "author": "karlmdavis", "createdAt": "2020-12-29T04:33:18Z", "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/SpringConfiguration.java", "diffHunk": "@@ -271,7 +271,7 @@ public LocalContainerEntityManagerFactoryBean entityManagerFactory(DataSource da\n   /** @return the {@link Properties} to configure Hibernate and JPA with */\n   private Properties jpaProperties() {\n     Properties extraProperties = new Properties();\n-    extraProperties.put(AvailableSettings.HBM2DDL_AUTO, Action.VALIDATE);\n+    extraProperties.put(AvailableSettings.HBM2DDL_AUTO, Action.NONE);", "originalCommit": "a615efd548e886e5d7d55d186766246a1f19c068", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU2NjkxMA==", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/424#discussion_r549566910", "bodyText": "I believe GItHub will be smart enough after we rebase.", "author": "cbrunefearless", "createdAt": "2020-12-29T04:49:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU2NDMzMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU2NDM1OQ==", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/424#discussion_r549564359", "bodyText": "Won't having this same change give you a merge conflict? Or is Git / GitHub smart enough to avoid that?", "author": "karlmdavis", "createdAt": "2020-12-29T04:33:24Z", "path": "apps/bfd-pipeline/bfd-pipeline-rif-load/src/main/java/gov/cms/bfd/pipeline/rif/load/RifLoader.java", "diffHunk": "@@ -174,7 +174,7 @@ public static EntityManagerFactory createEntityManagerFactory(DataSource jdbcDat\n \n     Map<String, Object> hibernateProperties = new HashMap<>();\n     hibernateProperties.put(org.hibernate.cfg.AvailableSettings.DATASOURCE, jdbcDataSource);\n-    hibernateProperties.put(org.hibernate.cfg.AvailableSettings.HBM2DDL_AUTO, Action.VALIDATE);\n+    hibernateProperties.put(org.hibernate.cfg.AvailableSettings.HBM2DDL_AUTO, Action.NONE);", "originalCommit": "a615efd548e886e5d7d55d186766246a1f19c068", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU2NjkwOA==", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/424#discussion_r549566908", "bodyText": "I believe GItHub will be smart enough after we rebase.", "author": "cbrunefearless", "createdAt": "2020-12-29T04:49:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU2NDM1OQ=="}], "type": "inlineReview"}, {"oid": "aead373de820b07e1e99e35126f8ac6aa71c24ab", "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/aead373de820b07e1e99e35126f8ac6aa71c24ab", "message": "Changed comments in the sql script", "committedDate": "2020-12-29T04:51:16Z", "type": "commit"}, {"oid": "e86adf2acd9ad3bef3d9a4f71780f5ac2e0e7321", "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/e86adf2acd9ad3bef3d9a4f71780f5ac2e0e7321", "message": "Merge branch 'master' into cbrune/BFD-549-DBMigration", "committedDate": "2020-12-29T19:17:22Z", "type": "commit"}]}