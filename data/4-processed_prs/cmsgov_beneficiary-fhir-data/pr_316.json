{"pr_number": 316, "pr_title": "Dshekhar/bfd 285 BFD v2 rfc", "pr_createdAt": "2020-07-24T00:24:08Z", "pr_url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/316", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjQ4ODI0Ng==", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/316#discussion_r472488246", "bodyText": "Since at least initially there won't be as many users using v2, would it be possible to do something like dedicate 1 node to v2 and 3 to v1? Just so the new experimental doesn't affect the current stable version.", "author": "adaykin", "createdAt": "2020-08-18T20:56:32Z", "path": "rfcs/BFDv2/Patient RFC.md", "diffHunk": "@@ -0,0 +1,250 @@\n+# RFC Proposal\n+\n+[RFC Proposal]: #rfc-proposal\n+\n+* RFC Proposal ID: `0000-patient-fhir-r4-carin_bfdv2`\n+* Start Date: 08-03-2020\n+* RFC PR: [BFD-264-v2_Patient_RFC #313](https://github.com/CMSgov/beneficiary-fhir-data/pull/313)\n+* JIRA Ticket(s): [BFD-264](https://jira.cms.gov/browse/BFD-264)\n+\n+\n+This RFC proposes that our team migrate from BFD v1 STU3 Patient FHIR resource to the first normative FHIR release, R4 and implement CARIN Patient profile.\n+\n+## Table of Contents\n+[Table of Contents]: #table-of-contents\n+\n+* [RFC Proposal](#rfc-proposal)\n+* [Table of Contents](#table-of-contents)\n+* [Motivation](#motivation)\n+* [Proposed Solution](#proposed-solution)\n+\t* [Detailed Design](#detailed-design)\n+\t* [Current State](#current-state)\n+\t* [Future State](#future-state)\n+\t* [Differential View](#differential-view)\n+\t* [Unresolved Questions](#unresolved-questions)\n+\t* [Drawbacks](#proposed-solution-drawbacks)\n+\t* [Notable Alternatives](#proposed-solution-notable-alternatives)\n+* [Prior Art](#prior-art)\n+* [Future Possibilities](#future-possibilities)\n+* [Addendums](#addendums)\n+\n+\n+## Motivation\n+[Motivation]: #motivation\n+\n+This change will make BFD's Patient FHIR resource increase the system's conformance with FHIR R4 and industry alliance like CARIN.\n+This will help BFD move its platform to use the first normative release of FHIR R4. This will also make integration and \n+interoperability with all our peer partners seamless by enabling to provide FHIR R4 validated and conformant Patient resources\n+(Beneficiaries demographic data).\n+\n+\n+## Proposed Solution\n+[Proposed Solution]: #proposed-solution\n+\n+\n+BFD proposes to provide a new v2 endpoint based on Patient FHRI-R4 and CARIN BB Profile. \n+\n+Sample indicative Patient v2 endpoint:  \n+https://localhost:1337/v2/fhir/Patient?_id=-19990000000001&_format=json\n+\n+\n+Patient FHIR R4 (US-Core, Normative release):  \n+http://hl7.org/fhir/R4/patient.html\n+\n+\n+CARIN Patient Profile:  \n+http://build.fhir.org/ig/HL7/carin-bb/StructureDefinition-CARIN-BB-Patient.html\n+\n+### Detailed Design\n+\n+[Detailed Design]: #detailed-design\n+\n+**HAPI Version to be used:** HAPI FHIR 4.1.0\n+\n+**HAPI 4.1.0 Patient Data Model class to be used:** org.hl7.fhir.r4.model.Patient\n+\n+**POC Code snippet:** \n+\n+\t// Slicing for Patient Identifier\n+      Patient patientSlicing = new Patient();\n+\n+      patientSlicing.addIdentifier().setValue(\"-20140000010000\")\n+          .setSystem(\"https://bluebutton.cms.gov/resources/variables/bene_id\").getType().addCoding()\n+          .setCode(\n+          \"PI\")\n+          .setSystem(\"http://terminology.hl7.org/CodeSystem/v2-0203\")\n+          .setDisplay(\"Patient Internal Identifier\");\n+\n+      patientSlicing.addIdentifier()\n+          .setValue(\"-2b034220943953861f7b17963091ea962c13548f4b1d5f4c1013ee1779d621f4\")\n+          .setSystem(\"https://bluebutton.cms.gov/resources/identifier/mbi-hash\").getType()\n+          .addCoding().setCode(\"MC\").setSystem(\"http://terminology.hl7.org/CodeSystem/v2-0203\")\n+          .setDisplay(\"Patient's Medicare Number\");\n+\n+**Below are the payload changes being proposed in Patient resource:**\n+\n+\n+#### Changes:\n+\n+##### Slicing:\n+\n+Current State: No Slicing.\n+\n+Future State: The element Patient.identifier is sliced based on the values of value:type, value:system.\n+\n+Slicing Implementation: POC code above. Slicing codes are used from the below list:\n+\n+Code\t\tDisplay  \n+MR\t\tMedical record number  \n+MA\t\tPatient Medicaid number  \n+PI\t\tPatient internal identifier  \n+PT\t\tPatient external identifier  \n+SN\t\tSubscriber Number  \n+ \n+\n+##### Extensions/Code System Changes:\n+\n+Race:\n+ \n+HL7 FHIR extension for Race used by US-Core and CARIN.\n+\n+##### Patient.Active field \n+\n+Type boolean\n+\n+##### MANDATORY New Fields to be Added:\n+None as part of FHIR-R4 Spec. But CARIN mandates some mandatory Patient fields:  \n+\n+\u2022\tIdentifier  \n+\u2022\tName  \n+\u2022\tGender  \n+\n+##### Cardinality Rule Changes (From STU3 to R4)\n+NONE.\n+\n+##### Renamed Items:\n+NONE.\n+\n+##### Deleted Elements:\n+N/A (Patient.Animal)\n+\n+\n+##### R4 Code Systems Changes:\n+\n+\n+Patient.identifier:\n+\n+\u2022\thttps://bluebutton.cms.gov/resources/variables/bene_id/  \n+\u2022\thttp://hl7.org/fhir/us/carin/ValueSet/carin-bb-identifier-type  \n+\u2022\thttp://terminology.hl7.org/CodeSystem/v2-0203  \n+\n+Patient.gender:\n+\t\u2022\tChange value set from http://hl7.org/fhir/ValueSet/administrative-gender to http://hl7.org/fhir/ValueSet/administrative-gender|4.0.1\n+\n+\n+\n+#### Not Supported:\n+\n+\u2022\tTelecom field - we don\u2019t send, not in CCW.  \n+\u2022\tEmail field \u2013 we don\u2019t send, not in CCW.  \n+\u2022\tEthnicity - we don\u2019t send, not in CCW.  \n+\u2022\tCommunication/Language - we don\u2019t send, not in CCW.  \n+\u2022\tContact/Next of Kin - we don\u2019t send, not in CCW.  \n+\n+#### R4 Non-Conformance Errors: \n+\n+Next issue ERROR - Patient - Unable to locate profile\n+ http://hl7.org/fhir/us/carin/StructureDefinition/carin-bb-patient\n+Next issue INFORMATION - Patient.extension[0] - Unknown extension\n+\n+http://hl7.org/fhir/us/core/StructureDefinition/us-core-race\n+\n+Next issue INFORMATION - Patient.extension[1] - Unknown extension\n+http://hl7.org/fhir/us/core/StructureDefinition/us-core-ethnicity\n+\n+Next issue INFORMATION - Patient.extension[2] - Unknown extension\n+http://hl7.org/fhir/us/core/StructureDefinition/us-core-birthsex\n+\n+#### CARIN IG:\n+https://build.fhir.org/ig/HL7/carin-bb/StructureDefinition-CARIN-BB-Patient.html\n+\n+Summary:  \n+\u2022\tMandatory: 2 elements  \n+\u2022\tMust-Support: 1 element  \n+\n+Slices:\n+This structure defines the following Slices:  \n+\u2022\tThe element Patient.identifier is sliced based on the values of value:type, value:system\n+\n+### Current State\n+[Current State]: #current-state\n+\n+[BFD v1: Current State Patient Resource](./BFD_v1_Patient-Current_State.txt)\n+\n+### Future State\n+[Future State]: #future-state\n+\n+[BFD v2: Future State Patient Resource](./BFD_v2_Patient-Future_State.txt)\n+\n+### Differential View\n+[Differential View]: #differential-view\n+\n+[Differential_view_1](./Differential_view_Patientv2_1.PNG)\n+\n+[Differential_view_2](./Differential_view_Patientv2_2.PNG)\n+\n+\n+### Unresolved Questions\n+[Unresolved Questions]: #unresolved-questions\n+\n+\n+The following questions need to be resolved prior to merging this RFC:\n+\n+1. Hash Identifiers in Patient resource:\n+\n+Do we need to return hash identifiers? Use the identifier flag in the header to determine what to send \u2013 MBI. HICN, Hashes? We do send out BENE_ID as local patient (beneficiary) identifier (medical record number).\n+\n+2. Race code mapping for Hispanic:\n+\n+What is the best approach in CMS-Blue Button to map Hispanic race to US-Core Race code (see below):\n+\n+\tCode\t\t\tDisplay  \n+\u2022\t1002-5\t\t\tAmerican Indian or Alaska Native  \n+\u2022\t2028-9\t\t\tAsian  \n+\u2022\t2054-5\t\t\tBlack or African American  \n+\u2022\t2076-8\t\t\tNative Hawaiian or Other Pacific Islander  \n+\u2022\t2106-3\t\t\tWhite  \n+\u2022\tUNK\t\t\tUnknown  \n+\u2022\tASKU\t\t\tAsked but no answer  \n+\n+ \t\t\n+\n+### Proposed Solution: Drawbacks\n+[Proposed Solution: Drawbacks]: #proposed-solution-drawbacks\n+\n+Supporting both v1 and v2 in parallel may cause slight performance issues.", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjUxNTE1MQ==", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/316#discussion_r472515151", "bodyText": "@jzulim, @sarah-tully, @karlmdavis\n\n@adaykin This can be definitely discussed once POC phase is DONE as part of v2 go-live. Thanks.", "author": "dshekhar18", "createdAt": "2020-08-18T21:54:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjQ4ODI0Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTk2NjQ0NQ==", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/316#discussion_r475966445", "bodyText": "@adaykin With our current deploy / infra and tooling, running V2 on a single node is not in scope here. We are limiting the V2 with a feature flag, but this will apply to all nodes. We'll only be in SBX for the time being, so if we see performance issues we'll catch and work through them.", "author": "jzulim", "createdAt": "2020-08-24T23:40:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjQ4ODI0Ng=="}], "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": "3eb63f449acc81ebe00f01411f1989a3398b1104", "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/3eb63f449acc81ebe00f01411f1989a3398b1104", "message": "Add V2_ENABLED environment variable for all environments (#342)\n\n* Adding ENV VAR V2_ENABLED", "committedDate": "2020-08-20T17:06:35Z", "type": "forcePushed"}, {"oid": "0407d06f5cc38f75182cb8a9736589711e4bae70", "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/0407d06f5cc38f75182cb8a9736589711e4bae70", "message": "BFDv2 RFC Process\n\nBFDv2", "committedDate": "2020-08-29T04:22:28Z", "type": "commit"}, {"oid": "ee0eb904fe3febb26e40b9beb2095f968739b0ed", "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/ee0eb904fe3febb26e40b9beb2095f968739b0ed", "message": "v1_v2 workflow diagram", "committedDate": "2020-08-29T04:26:27Z", "type": "commit"}]}