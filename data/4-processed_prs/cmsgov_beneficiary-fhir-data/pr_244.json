{"pr_number": 244, "pr_title": "Create Logrotate Definitions to Ensure Disk Space", "pr_createdAt": "2020-03-13T15:35:57Z", "pr_url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/244", "timeline": [{"oid": "b1b70d51259abf19c99327b07c089e05daa65a30", "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/b1b70d51259abf19c99327b07c089e05daa65a30", "message": "Moving disk space to AMI build", "committedDate": "2020-03-13T14:06:59Z", "type": "commit"}, {"oid": "85ba339050afc73e115685742b3fdfce40e3d880", "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/85ba339050afc73e115685742b3fdfce40e3d880", "message": "Updated file path for user_data_file", "committedDate": "2020-03-13T16:23:22Z", "type": "commit"}, {"oid": "3248e955e71b67a95a5e98605fe737bbe3da558b", "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/3248e955e71b67a95a5e98605fe737bbe3da558b", "message": "Creating log rotation definitions for bfd-server logs", "committedDate": "2020-03-16T16:37:28Z", "type": "commit"}, {"oid": "a502bbbccabaa91c69d811a7fa3db530ea95b815", "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/a502bbbccabaa91c69d811a7fa3db530ea95b815", "message": "Removed excess disk terraform provisioning", "committedDate": "2020-03-18T16:21:15Z", "type": "commit"}, {"oid": "5e7709952414fd5c60bc11f8060f4661ffd3812a", "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/5e7709952414fd5c60bc11f8060f4661ffd3812a", "message": "Added comments to disabled disk extension terraform", "committedDate": "2020-03-18T16:25:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDQ4MDMzMA==", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/244#discussion_r394480330", "bodyText": "Maybe link or reference JIRA ticket here?", "author": "jzulim", "createdAt": "2020-03-18T16:29:05Z", "path": "ops/terraform/modules/resources/templates/fhir_server.tpl", "diffHunk": "@@ -4,10 +4,12 @@ set -e\n exec > >(tee -a /var/log/user_data.log 2>&1)\n \n # Extend gold image defined root partition with all available free space\n-sudo growpart /dev/nvme0n1 2\n-sudo pvresize /dev/nvme0n1p2\n-sudo lvextend -l +100%FREE /dev/VolGroup00/rootVol\n-sudo xfs_growfs /\n+# The extend gold image has been commented out in favor of rotating the logs", "originalCommit": "5e7709952414fd5c60bc11f8060f4661ffd3812a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDQ4MjM0NA==", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/244#discussion_r394482344", "bodyText": "Done", "author": "cthulhuplus", "createdAt": "2020-03-18T16:32:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDQ4MDMzMA=="}], "type": "inlineReview"}, {"oid": "e1aaa388d5f9b7159d51d95378f707733d371eed", "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/e1aaa388d5f9b7159d51d95378f707733d371eed", "message": "Added ticket ID to comments", "committedDate": "2020-03-18T16:31:54Z", "type": "commit"}, {"oid": "38bf5f7b84079c01be41e76d550ab6fe1d8bd18c", "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/38bf5f7b84079c01be41e76d550ab6fe1d8bd18c", "message": "Added 1 rotation, copytruncate, and compression", "committedDate": "2020-03-18T17:03:08Z", "type": "commit"}, {"oid": "3dbf21218cc8a03f7a53b58c291053a85b2d8fd6", "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/3dbf21218cc8a03f7a53b58c291053a85b2d8fd6", "message": "Readded extra disk, removed sudo", "committedDate": "2020-04-01T11:26:37Z", "type": "commit"}, {"oid": "f487f0340b5db8415a6d5270edf753bf91eae06b", "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/f487f0340b5db8415a6d5270edf753bf91eae06b", "message": "Merge branch 'master' into bbrooks/BLUEBUTTON-1582-Move-Add-Disk-Space", "committedDate": "2020-04-01T12:43:27Z", "type": "commit"}, {"oid": "26546cc99369174ccd73c3842b44603616ce4655", "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/26546cc99369174ccd73c3842b44603616ce4655", "message": "Merge branch 'master' into bbrooks/BLUEBUTTON-1582-Move-Add-Disk-Space", "committedDate": "2020-04-01T13:15:30Z", "type": "commit"}, {"oid": "e3724fa0fc1c1711fa8d3a82bf43ea242a95a6f3", "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/e3724fa0fc1c1711fa8d3a82bf43ea242a95a6f3", "message": "Added sudo back", "committedDate": "2020-04-01T13:54:00Z", "type": "commit"}, {"oid": "aba8c9fe0c719f0828388cc77a6927bf6e7c285b", "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/aba8c9fe0c719f0828388cc77a6927bf6e7c285b", "message": "Adding the disk space back to 100", "committedDate": "2020-04-02T14:54:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDM3Nzg3Nw==", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/244#discussion_r404377877", "bodyText": "Can you remove sudo from these statements and test again?  I want to see how much time we might be losing to that one bug that caused issues for me in the AMI refactor.", "author": "njdister", "createdAt": "2020-04-06T20:47:15Z", "path": "ops/terraform/modules/resources/templates/fhir_server.tpl", "diffHunk": "@@ -4,6 +4,8 @@ set -e\n exec > >(tee -a /var/log/user_data.log 2>&1)\n \n # Extend gold image defined root partition with all available free space\n+# The extend gold image has been commented out in favor of rotating the logs\n+# Doing this should improve deploy time, BLUEBUTTON-1582\n sudo growpart /dev/nvme0n1 2\n sudo pvresize /dev/nvme0n1p2\n sudo lvextend -l +100%FREE /dev/VolGroup00/rootVol", "originalCommit": "aba8c9fe0c719f0828388cc77a6927bf6e7c285b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDc5OTEzOA==", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/244#discussion_r404799138", "bodyText": "I have removed the sudo lines and successfully built. I had some tests before where it was failing to build, but it looks like it was failing for some other reason.", "author": "cthulhuplus", "createdAt": "2020-04-07T13:15:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDM3Nzg3Nw=="}], "type": "inlineReview"}, {"oid": "d69f7a4b0f6784d817c8a02f98075811684da621", "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/d69f7a4b0f6784d817c8a02f98075811684da621", "message": "Removed sudo for testing", "committedDate": "2020-04-07T12:46:29Z", "type": "commit"}, {"oid": "b4ab448e40b6e697bff7f8cd33a81d86c861e2e6", "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/b4ab448e40b6e697bff7f8cd33a81d86c861e2e6", "message": "Reduced disk space added to 60Gb from 100Gb", "committedDate": "2020-04-07T15:22:06Z", "type": "commit"}]}