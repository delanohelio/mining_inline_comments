{"pr_number": 232, "pr_title": "BLUEBUTTON-1644: Update the flamegraph play to fix bitrot", "pr_createdAt": "2020-02-26T20:53:44Z", "pr_url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/232", "timeline": [{"oid": "b02b8e4a90dc6084416a5927a551b0ed0af4f5e3", "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/b02b8e4a90dc6084416a5927a551b0ed0af4f5e3", "message": "Update the flamegraph play to fix bitrot.\n\nWasn't working anymore, due to changes in the AWS environments, my local\nsystem, etc.\n\nAlso moved it out of the HealthAPT Ansible directory.\n\nBLUEBUTTON-1644", "committedDate": "2020-02-26T20:51:49Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDc2MjkzNA==", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/232#discussion_r384762934", "bodyText": "Had to do this in order to get the --inventory=foo.ec2.internal play parameter working, as it requires the enabled-by-default-but-disabled-here hosts_list plugin to be enabled.\nAnyone know why this config was locked down to just ini? If there's not a good reason, let's just deleted this line altogether as part of this PR.", "author": "karlmdavis", "createdAt": "2020-02-26T21:01:41Z", "path": "ops/ansible/playbooks-ccs/ansible.cfg", "diffHunk": "@@ -42,4 +42,4 @@ pipelining = True\n #ssh_args = -o ControlMaster=no\n \n [inventory]\n-enable_plugins = ini\n+#enable_plugins = ini", "originalCommit": "b02b8e4a90dc6084416a5927a551b0ed0af4f5e3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTE2NjgwMw==", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/232#discussion_r385166803", "bodyText": "No idea why it was locked to ini. Agreed we should remove.", "author": "jzulim", "createdAt": "2020-02-27T14:55:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDc2MjkzNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDc2MzQ3Nw==", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/232#discussion_r384763477", "bodyText": "Fun fact: pgrep -f 'java.*DataServerLauncherApp' would be a much better filter/search command here, but won't work for reasons that escape me. It looks like maybe pgrep -f won't search the command line past a certain character limit?", "author": "karlmdavis", "createdAt": "2020-02-26T21:02:54Z", "path": "ops/ansible/playbooks-ccs/data_server_collect_flame_graph.yml", "diffHunk": "@@ -5,17 +5,17 @@\n #\n # Usage:\n #\n-#     $ pipenv run ./ansible-playbook-wrapper data_server_collect_flame_graph.yml --extra-vars \"perf_record_seconds=15 find_process_command='pgrep java' jdk_path=/etc/alternatives/java_sdk_1.8.0_openjdk\" --limit bluebutton-healthapt-test-data-server-a-1\n+#     $ pipenv run ./ansible-playbook-wrapper data_server_collect_flame_graph.yml --inventory='somehost.ec2.internal' --extra-vars \"perf_record_seconds=15 find_process_command='pgrep -f bfd-server-launcher.*jetty' java_user='bfd' jdk_path=/etc/alternatives/java_sdk_1.8.0_openjdk\"", "originalCommit": "b02b8e4a90dc6084416a5927a551b0ed0af4f5e3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDc2MzkxOA==", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/232#discussion_r384763918", "bodyText": "We should consider updating our default builds to install the JDK like this, rather than the JRE. It's super useful to have a JDK around for all sorts of things.", "author": "karlmdavis", "createdAt": "2020-02-26T21:03:47Z", "path": "ops/ansible/playbooks-ccs/data_server_collect_flame_graph.yml", "diffHunk": "@@ -49,6 +48,7 @@\n           - cmake\n           - gcc\n           - gcc-c++\n+          - java-1.8.0-openjdk-devel", "originalCommit": "b02b8e4a90dc6084416a5927a551b0ed0af4f5e3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDc3MzI2OQ==", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/232#discussion_r384773269", "bodyText": "I'm pretty sure we already do: \n  \n    \n      beneficiary-fhir-data/ops/ansible/roles/bfd-server/tasks/install.yml\n    \n    \n         Line 9\n      in\n      a5e50a5\n    \n    \n    \n    \n\n        \n          \n           - java-1.8.0-openjdk-devel", "author": "njdister", "createdAt": "2020-02-26T21:21:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDc2MzkxOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDc2NDEwMA==", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/232#discussion_r384764100", "bodyText": "Whoops: need to go uncomment this and make sure that things still work.", "author": "karlmdavis", "createdAt": "2020-02-26T21:04:08Z", "path": "ops/ansible/playbooks-ccs/data_server_collect_flame_graph.yml", "diffHunk": "@@ -92,6 +92,23 @@\n         PERF_RECORD_SECONDS: \"{{ perf_record_seconds }}\"\n       become: true\n \n+      #    - name: Attach Java Symbol Agent to Java Process\n+      #      shell: \"java -cp attach-main.jar:$JAVA_HOME/lib/tools.jar net.virtualvoid.perf.AttachOnce {{ process_pid }}\"\n+      #      args:\n+      #        chdir: \"{{ perf_map_agent_path_remote }}/out\"\n+      #      environment:\n+      #        JAVA_HOME: \"{{ jdk_path }}\"\n+      #      become: true\n+      #      become_user: \"{{ java_user }}\"", "originalCommit": "b02b8e4a90dc6084416a5927a551b0ed0af4f5e3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "5f6e40c579157ce8dc273017c259cad1dbfcac3e", "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/5f6e40c579157ce8dc273017c259cad1dbfcac3e", "message": "Uncomment a task that I'd disabled temporarily.\n\nBLUEBUTTON-1644", "committedDate": "2020-02-26T21:07:36Z", "type": "commit"}, {"oid": "c945aad995ac6d39e50575e57ce878095101173e", "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/c945aad995ac6d39e50575e57ce878095101173e", "message": "Merge branch 'master' into BLUEBUTTON-1644-java-flamegraph-script", "committedDate": "2021-01-21T18:28:49Z", "type": "commit"}, {"oid": "1282b6e6fbebb097c7b9b6c4b1e41794ba6fa35b", "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/1282b6e6fbebb097c7b9b6c4b1e41794ba6fa35b", "message": "Merge branch 'master' into BLUEBUTTON-1644-java-flamegraph-script", "committedDate": "2021-01-21T18:35:49Z", "type": "commit"}, {"oid": "05194131c80fd2a00f7c830d1085334a6281a179", "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/05194131c80fd2a00f7c830d1085334a6281a179", "message": "Merge branch 'master' into BLUEBUTTON-1644-java-flamegraph-script", "committedDate": "2021-01-21T19:57:45Z", "type": "commit"}, {"oid": "d686dcc090e0b1a60a816c95f174ff28384c5d38", "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/d686dcc090e0b1a60a816c95f174ff28384c5d38", "message": "Merge branch 'master' into BLUEBUTTON-1644-java-flamegraph-script", "committedDate": "2021-01-25T20:46:35Z", "type": "commit"}, {"oid": "7129ce78d73607684ea96111eb22dd2e5ca32ceb", "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/7129ce78d73607684ea96111eb22dd2e5ca32ceb", "message": "Merge branch 'master' into BLUEBUTTON-1644-java-flamegraph-script", "committedDate": "2021-01-28T16:58:47Z", "type": "commit"}]}