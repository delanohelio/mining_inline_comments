{"pr_number": 386, "pr_title": "BFD-501: Adding x-forwarded and unifying bulk headers to documentation", "pr_createdAt": "2020-11-02T22:47:27Z", "pr_url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/386", "timeline": [{"oid": "cdb38b193e69d7bc65f603b4e9659ebc6d459873", "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/cdb38b193e69d7bc65f603b4e9659ebc6d459873", "message": "Adding x-forwarded and unifying bulk headers", "committedDate": "2020-11-02T22:38:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjM3MjM5MQ==", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/386#discussion_r516372391", "bodyText": "Will requests that contain these deprecated headers be rejected?\nFor reference, the code in BCDA which sets these headers is here.\nCC: @mtrang1263", "author": "msnook", "createdAt": "2020-11-03T00:55:13Z", "path": "docs/request-audit-headers.md", "diffHunk": "@@ -25,28 +25,13 @@ For synchronous (i.e. non-bulk) requests, BFD users SHALL include meaningful val\n * `BlueButton-UserId`: the unique ID in the frontend system for the user (e.g. beneficiary) that data is being requested on behalf of.\n * `BlueButton-User`: the human-readable login ID (e.g. email address) in the frontend system for the user (e.g. beneficiary) that the data is being requested on behalf of.\n * `BlueButton-BeneficiaryId`: the unique beneificary ID (e.g. `Patient.id`) from BFD for the user the beneficiary whose data is being requested.\n+* `x-forwarded-for`: a standard header for identifying the originating IP address of a client connecting to a web server through an HTTP proxy or a load balancer.\n \n ## Asynchronous Requests\n \n For asynchronous (i.e. bulk) requests, BFD users SHALL include meaningful values for as many as possible of the following HTTP headers.\n \n-### BCDA", "originalCommit": "cdb38b193e69d7bc65f603b4e9659ebc6d459873", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDg3NzM0Ng==", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/386#discussion_r520877346", "bodyText": "No. These headers are only used for auditing purposes.", "author": "jzulim", "createdAt": "2020-11-10T21:13:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjM3MjM5MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTk1MjM3Mw==", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/386#discussion_r519952373", "bodyText": "What is the recommended migration path for these headers?\nShould BCDA start sending BULK-CLIENTID and BULK-JOBID in addition to BCDA-CMSID and BCDA-JOBID?\nAnd if we do not send these two headers (and continue sending BCDA-CMSID and BCDA-JOBID), will our request get rejected?", "author": "mtrang1263", "createdAt": "2020-11-09T16:39:59Z", "path": "docs/request-audit-headers.md", "diffHunk": "@@ -25,28 +25,13 @@ For synchronous (i.e. non-bulk) requests, BFD users SHALL include meaningful val\n * `BlueButton-UserId`: the unique ID in the frontend system for the user (e.g. beneficiary) that data is being requested on behalf of.\n * `BlueButton-User`: the human-readable login ID (e.g. email address) in the frontend system for the user (e.g. beneficiary) that the data is being requested on behalf of.\n * `BlueButton-BeneficiaryId`: the unique beneificary ID (e.g. `Patient.id`) from BFD for the user the beneficiary whose data is being requested.\n+* `x-forwarded-for`: a standard header for identifying the originating IP address of a client connecting to a web server through an HTTP proxy or a load balancer.\n \n ## Asynchronous Requests\n \n For asynchronous (i.e. bulk) requests, BFD users SHALL include meaningful values for as many as possible of the following HTTP headers.\n \n-### BCDA\n-\n-* `BlueButton-OriginalQueryId`: (see above; same thing)\n-    * For asynchronous jobs, users SHALL use the `BlueButton-OriginalQueryId` for the HTTP request that created/submitted/whatever the job.\n-* `BCDA-CMSID`: the 5 digit A1234 Identifier for ACOs\n-* `BCDA-JOBID`: integer generated by DB sequence\n-\n-### AB2D\n-\n-* `BlueButton-OriginalQueryId`: (see above; same thing)\n-    * For asynchronous jobs, users SHALL use the `BlueButton-OriginalQueryId` for the HTTP request that created/submitted/whatever the job.\n-* `AB2D-CMSID`: the Part D contract ID\n-* `AB2D-JOBID`: integer generated by DB sequence\n-\n-### DPC\n-\n * `BlueButton-OriginalQueryId`: (see above; same thing)\n     * For asynchronous jobs, users SHALL use the `BlueButton-OriginalQueryId` for the HTTP request that created/submitted/whatever the job.\n-* `DPC-CMSID`: The NPI of the downstream requesting provider or organization.\n-* `DPC-JOBID`: integer generated by DB sequence\n+* `BULK-CLIENTID`: a unique identifier of the bulk client for whom this request is for (i.e. ACO ID, NPI, Part D Contract)", "originalCommit": "cdb38b193e69d7bc65f603b4e9659ebc6d459873", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDg3ODAyMw==", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/386#discussion_r520878023", "bodyText": "@mtrang1263 No soft migration is necessary. We can cut over in a hard fashion. These headers are used for audit purposes only. These specific bulk headers do not impact the validity of requests to BFD.", "author": "jzulim", "createdAt": "2020-11-10T21:14:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTk1MjM3Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDg4NTI1MQ==", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/386#discussion_r520885251", "bodyText": "Do we need another header to differentiate between the various partner applications? Or do we believe that BULK-CLIENTID can be leverage to see who the source was (e.g. BCDA request would have BULK-CLIENTID set to A****, V***, E***)", "author": "mtrang1263", "createdAt": "2020-11-10T21:29:07Z", "path": "docs/request-audit-headers.md", "diffHunk": "@@ -25,28 +25,13 @@ For synchronous (i.e. non-bulk) requests, BFD users SHALL include meaningful val\n * `BlueButton-UserId`: the unique ID in the frontend system for the user (e.g. beneficiary) that data is being requested on behalf of.\n * `BlueButton-User`: the human-readable login ID (e.g. email address) in the frontend system for the user (e.g. beneficiary) that the data is being requested on behalf of.\n * `BlueButton-BeneficiaryId`: the unique beneificary ID (e.g. `Patient.id`) from BFD for the user the beneficiary whose data is being requested.\n+* `x-forwarded-for`: a standard header for identifying the originating IP address of a client connecting to a web server through an HTTP proxy or a load balancer.\n \n ## Asynchronous Requests", "originalCommit": "cdb38b193e69d7bc65f603b4e9659ebc6d459873", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDg5NDA4NQ==", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/386#discussion_r520894085", "bodyText": "We record the TLS certificate presented in the handshake as another header, which we use to key off.", "author": "jzulim", "createdAt": "2020-11-10T21:46:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDg4NTI1MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDkzMjMwNA==", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/386#discussion_r520932304", "bodyText": "We use UUIDs for almost everything in the backend, including job ids. We do not use db sequences. Is an integer really a must?", "author": "DeirdreHolub", "createdAt": "2020-11-10T23:09:33Z", "path": "docs/request-audit-headers.md", "diffHunk": "@@ -25,28 +25,13 @@ For synchronous (i.e. non-bulk) requests, BFD users SHALL include meaningful val\n * `BlueButton-UserId`: the unique ID in the frontend system for the user (e.g. beneficiary) that data is being requested on behalf of.\n * `BlueButton-User`: the human-readable login ID (e.g. email address) in the frontend system for the user (e.g. beneficiary) that the data is being requested on behalf of.\n * `BlueButton-BeneficiaryId`: the unique beneificary ID (e.g. `Patient.id`) from BFD for the user the beneficiary whose data is being requested.\n+* `x-forwarded-for`: a standard header for identifying the originating IP address of a client connecting to a web server through an HTTP proxy or a load balancer.\n \n ## Asynchronous Requests\n \n For asynchronous (i.e. bulk) requests, BFD users SHALL include meaningful values for as many as possible of the following HTTP headers.\n \n-### BCDA\n-\n-* `BlueButton-OriginalQueryId`: (see above; same thing)\n-    * For asynchronous jobs, users SHALL use the `BlueButton-OriginalQueryId` for the HTTP request that created/submitted/whatever the job.\n-* `BCDA-CMSID`: the 5 digit A1234 Identifier for ACOs\n-* `BCDA-JOBID`: integer generated by DB sequence\n-\n-### AB2D\n-\n-* `BlueButton-OriginalQueryId`: (see above; same thing)\n-    * For asynchronous jobs, users SHALL use the `BlueButton-OriginalQueryId` for the HTTP request that created/submitted/whatever the job.\n-* `AB2D-CMSID`: the Part D contract ID\n-* `AB2D-JOBID`: integer generated by DB sequence\n-\n-### DPC\n-\n * `BlueButton-OriginalQueryId`: (see above; same thing)\n     * For asynchronous jobs, users SHALL use the `BlueButton-OriginalQueryId` for the HTTP request that created/submitted/whatever the job.\n-* `DPC-CMSID`: The NPI of the downstream requesting provider or organization.\n-* `DPC-JOBID`: integer generated by DB sequence\n+* `BULK-CLIENTID`: a unique identifier of the bulk client for whom this request is for (i.e. ACO ID, NPI, Part D Contract)\n+* `BULK-JOBID`: integer generated by DB sequence", "originalCommit": "cdb38b193e69d7bc65f603b4e9659ebc6d459873", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTUxMTYzMw==", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/386#discussion_r521511633", "bodyText": "This is also ok.", "author": "jzulim", "createdAt": "2020-11-11T17:14:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDkzMjMwNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDkzNTcwMg==", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/386#discussion_r520935702", "bodyText": "DPC uses UUIDs as internal identifiers, as mentioned elsewhere in another comment. DPC logging always includes the UUID, not the NPI. Any problem with using UUID here?", "author": "DeirdreHolub", "createdAt": "2020-11-10T23:18:15Z", "path": "docs/request-audit-headers.md", "diffHunk": "@@ -25,28 +25,13 @@ For synchronous (i.e. non-bulk) requests, BFD users SHALL include meaningful val\n * `BlueButton-UserId`: the unique ID in the frontend system for the user (e.g. beneficiary) that data is being requested on behalf of.\n * `BlueButton-User`: the human-readable login ID (e.g. email address) in the frontend system for the user (e.g. beneficiary) that the data is being requested on behalf of.\n * `BlueButton-BeneficiaryId`: the unique beneificary ID (e.g. `Patient.id`) from BFD for the user the beneficiary whose data is being requested.\n+* `x-forwarded-for`: a standard header for identifying the originating IP address of a client connecting to a web server through an HTTP proxy or a load balancer.\n \n ## Asynchronous Requests\n \n For asynchronous (i.e. bulk) requests, BFD users SHALL include meaningful values for as many as possible of the following HTTP headers.\n \n-### BCDA\n-\n-* `BlueButton-OriginalQueryId`: (see above; same thing)\n-    * For asynchronous jobs, users SHALL use the `BlueButton-OriginalQueryId` for the HTTP request that created/submitted/whatever the job.\n-* `BCDA-CMSID`: the 5 digit A1234 Identifier for ACOs\n-* `BCDA-JOBID`: integer generated by DB sequence\n-\n-### AB2D\n-\n-* `BlueButton-OriginalQueryId`: (see above; same thing)\n-    * For asynchronous jobs, users SHALL use the `BlueButton-OriginalQueryId` for the HTTP request that created/submitted/whatever the job.\n-* `AB2D-CMSID`: the Part D contract ID\n-* `AB2D-JOBID`: integer generated by DB sequence\n-\n-### DPC\n-\n * `BlueButton-OriginalQueryId`: (see above; same thing)\n     * For asynchronous jobs, users SHALL use the `BlueButton-OriginalQueryId` for the HTTP request that created/submitted/whatever the job.\n-* `DPC-CMSID`: The NPI of the downstream requesting provider or organization.\n-* `DPC-JOBID`: integer generated by DB sequence\n+* `BULK-CLIENTID`: a unique identifier of the bulk client for whom this request is for (i.e. ACO ID, NPI, Part D Contract)", "originalCommit": "cdb38b193e69d7bc65f603b4e9659ebc6d459873", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTUxMDgzNA==", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/386#discussion_r521510834", "bodyText": "This will be ok for us. Thanks.", "author": "jzulim", "createdAt": "2020-11-11T17:13:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDkzNTcwMg=="}], "type": "inlineReview"}, {"oid": "140d18c787b792dfbaac4eee376fa8a9658ed817", "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/140d18c787b792dfbaac4eee376fa8a9658ed817", "message": "Change language to specify alternative ID's", "committedDate": "2020-11-12T16:50:01Z", "type": "commit"}]}