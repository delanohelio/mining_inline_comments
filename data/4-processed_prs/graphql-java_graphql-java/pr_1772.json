{"pr_number": 1772, "pr_title": "add custom scalar Specification URL", "pr_createdAt": "2020-01-24T00:02:21Z", "pr_url": "https://github.com/graphql-java/graphql-java/pull/1772", "timeline": [{"oid": "23090f635173b35355d77bbd0698e2d8f8c4cc71", "url": "https://github.com/graphql-java/graphql-java/commit/23090f635173b35355d77bbd0698e2d8f8c4cc71", "message": "add specified by url (wip)", "committedDate": "2020-01-19T19:25:16Z", "type": "commit"}, {"oid": "ab5004f6b188f0108bad4f5c73123b7623ba9c84", "url": "https://github.com/graphql-java/graphql-java/commit/ab5004f6b188f0108bad4f5c73123b7623ba9c84", "message": "add specified by url directive", "committedDate": "2020-01-24T00:01:11Z", "type": "commit"}, {"oid": "5b17b65ea6693e7ee3723f43f563f8900c3d15c0", "url": "https://github.com/graphql-java/graphql-java/commit/5b17b65ea6693e7ee3723f43f563f8900c3d15c0", "message": "formatting", "committedDate": "2020-01-24T00:09:01Z", "type": "commit"}, {"oid": "11186a6284711b63e71162302689bd13c37aa618", "url": "https://github.com/graphql-java/graphql-java/commit/11186a6284711b63e71162302689bd13c37aa618", "message": "Merge branch 'master' into specified-by-url", "committedDate": "2020-05-20T00:14:40Z", "type": "commit"}, {"oid": "ad30ab35906c0a376bafd30d7bd249299e131dc7", "url": "https://github.com/graphql-java/graphql-java/commit/ad30ab35906c0a376bafd30d7bd249299e131dc7", "message": "fix tests, rename to specifiedByUrl", "committedDate": "2020-05-20T02:18:16Z", "type": "commit"}, {"oid": "e6f868433769be178ddf1eb4c4c6802721b5668e", "url": "https://github.com/graphql-java/graphql-java/commit/e6f868433769be178ddf1eb4c4c6802721b5668e", "message": "cleanup and consistent description", "committedDate": "2020-05-20T03:30:45Z", "type": "commit"}, {"oid": "f3dba37acbde19a1dcb1408c82bfbab62de664d4", "url": "https://github.com/graphql-java/graphql-java/commit/f3dba37acbde19a1dcb1408c82bfbab62de664d4", "message": "more tests", "committedDate": "2020-05-20T05:50:14Z", "type": "commit"}, {"oid": "1afa487bfd28a878fe57c190e0e272487cc57b95", "url": "https://github.com/graphql-java/graphql-java/commit/1afa487bfd28a878fe57c190e0e272487cc57b95", "message": "more tests", "committedDate": "2020-05-20T06:05:45Z", "type": "commit"}, {"oid": "bae1d4f7b0acbdc8441f301c6d4f2a71ab27feb4", "url": "https://github.com/graphql-java/graphql-java/commit/bae1d4f7b0acbdc8441f301c6d4f2a71ab27feb4", "message": "cleanup", "committedDate": "2020-05-20T06:09:41Z", "type": "commit"}, {"oid": "b01b2a495f96664ae71b7cb0b28149aecbb0e774", "url": "https://github.com/graphql-java/graphql-java/commit/b01b2a495f96664ae71b7cb0b28149aecbb0e774", "message": "add integration test", "committedDate": "2020-05-20T23:21:56Z", "type": "commit"}, {"oid": "6c6dd4d0f34221dad88d647c1649e5db8e6cab66", "url": "https://github.com/graphql-java/graphql-java/commit/6c6dd4d0f34221dad88d647c1649e5db8e6cab66", "message": "Merge branch 'master' into specified-by-url", "committedDate": "2020-05-21T05:57:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODQ5MTM4Mg==", "url": "https://github.com/graphql-java/graphql-java/pull/1772#discussion_r428491382", "bodyText": "spillin - Scalar (not Scala - never Scala)", "author": "bbakerman", "createdAt": "2020-05-21T07:29:32Z", "path": "src/main/java/graphql/Directives.java", "diffHunk": "@@ -64,11 +65,23 @@\n             .description(\"Marks the field or enum value as deprecated\")\n             .argument(newArgument()\n                     .name(\"reason\")\n-                    .type(nonNull(GraphQLString))\n+                    .type(GraphQLString)\n                     .defaultValue(\"No longer supported\")\n                     .description(\"The reason for the deprecation\"))\n             .validLocations(FIELD_DEFINITION, ENUM_VALUE)\n             .build();\n \n+    /**\n+     * The \"specifiedBy\" directive allows to provide a specification URL for a Scala", "originalCommit": "6c6dd4d0f34221dad88d647c1649e5db8e6cab66", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODQ5MjAxNA==", "url": "https://github.com/graphql-java/graphql-java/pull/1772#discussion_r428492014", "bodyText": "one version we need to remove the old constructors!", "author": "bbakerman", "createdAt": "2020-05-21T07:31:04Z", "path": "src/main/java/graphql/schema/GraphQLScalarType.java", "diffHunk": "@@ -73,10 +74,16 @@ public GraphQLScalarType(String name, String description, Coercing coercing) {\n     @Internal\n     @Deprecated\n     public GraphQLScalarType(String name, String description, Coercing coercing, List<GraphQLDirective> directives, ScalarTypeDefinition definition) {", "originalCommit": "6c6dd4d0f34221dad88d647c1649e5db8e6cab66", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODQ5Mjg3Ng==", "url": "https://github.com/graphql-java/graphql-java/pull/1772#discussion_r428492876", "bodyText": "Thought - Will it always be non null arg values?", "author": "bbakerman", "createdAt": "2020-05-21T07:33:11Z", "path": "src/main/java/graphql/schema/idl/SchemaGenerator.java", "diffHunk": "@@ -694,17 +697,32 @@ private GraphQLScalarType buildScalar(BuildContext buildCtx, ScalarTypeDefinitio\n             scalar = scalar.transform(builder -> builder\n                     .definition(typeDefinition)\n                     .comparatorRegistry(buildCtx.getComparatorRegistry())\n-                    .withDirectives(\n-                            buildDirectives(typeDefinition.getDirectives(),\n-                                    directivesOf(extensions), SCALAR, buildCtx.getDirectiveDefinitions(), buildCtx.getComparatorRegistry())\n+                    .specifiedByUrl(getSpecifiedByUrl(typeDefinition, extensions))\n+                    .withDirectives(buildDirectives(\n+                            typeDefinition.getDirectives(),\n+                            directivesOf(extensions),\n+                            SCALAR,\n+                            buildCtx.getDirectiveDefinitions(),\n+                            buildCtx.getComparatorRegistry())\n                     ));\n-            //\n-            // only allow modification of custom scalars\n             scalar = directiveBehaviour.onScalar(scalar, buildCtx.mkBehaviourParams());\n         }\n         return scalar;\n     }\n \n+    private String getSpecifiedByUrl(ScalarTypeDefinition scalarTypeDefinition, List<ScalarTypeExtensionDefinition> extensions) {\n+        List<Directive> allDirectives = new ArrayList<>(scalarTypeDefinition.getDirectives());\n+        extensions.forEach(extension -> allDirectives.addAll(extension.getDirectives()));\n+        Optional<Directive> specifiedByDirective = FpKit.findOne(allDirectives,\n+                directiveDefinition -> directiveDefinition.getName().equals(Directives.SpecifiedByDirective.getName()));\n+        if (!specifiedByDirective.isPresent()) {\n+            return null;\n+        }\n+        Argument urlArgument = specifiedByDirective.get().getArgument(\"url\");\n+        StringValue url = (StringValue) urlArgument.getValue();\n+        return url.getValue();", "originalCommit": "6c6dd4d0f34221dad88d647c1649e5db8e6cab66", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODUxNDQwMQ==", "url": "https://github.com/graphql-java/graphql-java/pull/1772#discussion_r428514401", "bodyText": "yes it is: url is required non null", "author": "andimarek", "createdAt": "2020-05-21T08:23:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODQ5Mjg3Ng=="}], "type": "inlineReview"}, {"oid": "a77edab5de27a8456baf1bd27ebb923ebc8eb4b5", "url": "https://github.com/graphql-java/graphql-java/commit/a77edab5de27a8456baf1bd27ebb923ebc8eb4b5", "message": "typo", "committedDate": "2020-05-21T08:23:34Z", "type": "commit"}]}