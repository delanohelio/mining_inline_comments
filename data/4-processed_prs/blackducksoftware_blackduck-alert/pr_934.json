{"pr_number": 934, "pr_title": "provider table", "pr_createdAt": "2020-03-25T21:00:02Z", "pr_url": "https://github.com/blackducksoftware/blackduck-alert/pull/934", "timeline": [{"oid": "aee22ed92ecd7b96427b3c20c64c73c4df7709bf", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/aee22ed92ecd7b96427b3c20c64c73c4df7709bf", "message": "feat: Add initial provider component.", "committedDate": "2020-03-12T18:48:06Z", "type": "commit"}, {"oid": "ba9decbc217cfaacf9a9242aec4800b8dab8557f", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/ba9decbc217cfaacf9a9242aec4800b8dab8557f", "message": "Merge remote-tracking branch 'origin/master' into ps_provider_table", "committedDate": "2020-03-12T18:48:50Z", "type": "commit"}, {"oid": "b8464490e5d8a50f46ef3d7632b88faac27d918d", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/b8464490e5d8a50f46ef3d7632b88faac27d918d", "message": "feat: Fetch all provider global configurations.", "committedDate": "2020-03-13T19:44:23Z", "type": "commit"}, {"oid": "ae358cb652cc597dc26aff9fa8a493c56c084fc4", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/ae358cb652cc597dc26aff9fa8a493c56c084fc4", "message": "feat: Provider get table data to display.", "committedDate": "2020-03-16T16:40:10Z", "type": "commit"}, {"oid": "bceb347a225f5b4dff151d20d9662b1d9cee102c", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/bceb347a225f5b4dff151d20d9662b1d9cee102c", "message": "feat: Implement ability to create and edit configs.", "committedDate": "2020-03-17T16:05:23Z", "type": "commit"}, {"oid": "e7558cb09f9a94a22e6c0af567e4940ad5e8f4a6", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/e7558cb09f9a94a22e6c0af567e4940ad5e8f4a6", "message": "feat: Add ability to test configurations.", "committedDate": "2020-03-17T18:43:19Z", "type": "commit"}, {"oid": "3f18246df9fa8bbe12f40458980a69870447c7b3", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/3f18246df9fa8bbe12f40458980a69870447c7b3", "message": "feat: Add test button and status message.", "committedDate": "2020-03-17T19:45:39Z", "type": "commit"}, {"oid": "5bca0463327b211fef0449d10055bcae4a813317", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/5bca0463327b211fef0449d10055bcae4a813317", "message": "Merge remote-tracking branch 'origin/master' into ps_provider_table", "committedDate": "2020-03-17T19:46:41Z", "type": "commit"}, {"oid": "ee1c27f3b86407bad0e3cdcd09c9ada56461ca93", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/ee1c27f3b86407bad0e3cdcd09c9ada56461ca93", "message": "feat: Only get the provider global configuration.", "committedDate": "2020-03-18T15:07:31Z", "type": "commit"}, {"oid": "a8cae6221f7e1c98ff5a85c74538e9e6718964db", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/a8cae6221f7e1c98ff5a85c74538e9e6718964db", "message": "feat: Fix the edit save and cancel buttons.", "committedDate": "2020-03-18T20:12:00Z", "type": "commit"}, {"oid": "ee18f9d9bfb36b47d38531c7a9ebb179a1f65311", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/ee18f9d9bfb36b47d38531c7a9ebb179a1f65311", "message": "feat: use callbacks for table events.", "committedDate": "2020-03-20T18:08:03Z", "type": "commit"}, {"oid": "54eb0f511b96514098015a482d58135967be7e5c", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/54eb0f511b96514098015a482d58135967be7e5c", "message": "Merge remote-tracking branch 'origin/master' into ps_provider_table", "committedDate": "2020-03-20T19:31:34Z", "type": "commit"}, {"oid": "a711a6fc3260bb81c9b501b26ce8cc98c1816efa", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/a711a6fc3260bb81c9b501b26ce8cc98c1816efa", "message": "feat: Implement correct updates to the table on save.", "committedDate": "2020-03-20T20:12:42Z", "type": "commit"}, {"oid": "4dd854f3993fb27e4622e31eba4eac81d7c6173f", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/4dd854f3993fb27e4622e31eba4eac81d7c6173f", "message": "feat: Get latest table data on save or delete.", "committedDate": "2020-03-24T18:02:37Z", "type": "commit"}, {"oid": "e3eaeb285c7256a1b1e69de0e6c12c5f6abd76b6", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/e3eaeb285c7256a1b1e69de0e6c12c5f6abd76b6", "message": "feat: Use TableDisplay callbacks.", "committedDate": "2020-03-24T18:07:57Z", "type": "commit"}, {"oid": "7587087131c355f6e808f8ddef4cb661ddccce98", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/7587087131c355f6e808f8ddef4cb661ddccce98", "message": "feat: Use TableDisplay callbacks.", "committedDate": "2020-03-24T18:11:47Z", "type": "commit"}, {"oid": "ea769f785ec7a0001c085c27d9ab6314cb24d80a", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/ea769f785ec7a0001c085c27d9ab6314cb24d80a", "message": "feat: Use TableDisplay callbacks for roles.", "committedDate": "2020-03-24T18:20:56Z", "type": "commit"}, {"oid": "de43b3390c2a89fb81869ec2667e6b6f0660e87e", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/de43b3390c2a89fb81869ec2667e6b6f0660e87e", "message": "Merge remote-tracking branch 'origin/master' into ps_provider_table", "committedDate": "2020-03-24T20:17:14Z", "type": "commit"}, {"oid": "dbd4f401c5039b11096726839f3a2e8eb95c5300", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/dbd4f401c5039b11096726839f3a2e8eb95c5300", "message": "feat: Separate copy functionality from edit in the tables.", "committedDate": "2020-03-25T13:17:56Z", "type": "commit"}, {"oid": "117cfe10b732e7e7994e4df99787f29fd5cca004", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/117cfe10b732e7e7994e4df99787f29fd5cca004", "message": "feat: Add custom column renderers to TableDisplay.", "committedDate": "2020-03-25T13:36:20Z", "type": "commit"}, {"oid": "e363ffe80b2673e4b4a3a63883b62eb97f1ae24e", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/e363ffe80b2673e4b4a3a63883b62eb97f1ae24e", "message": "feat: Add provider name validator.", "committedDate": "2020-03-25T15:27:29Z", "type": "commit"}, {"oid": "db0f0e8231da752ee9354a9097247e7fbe8dec7e", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/db0f0e8231da752ee9354a9097247e7fbe8dec7e", "message": "feat: Clear sensitive fields when copying.", "committedDate": "2020-03-25T16:07:02Z", "type": "commit"}, {"oid": "af342d13d11874ba679af0e4b737fee02c19ae46", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/af342d13d11874ba679af0e4b737fee02c19ae46", "message": "feat: Remove old Providers display.", "committedDate": "2020-03-25T18:00:46Z", "type": "commit"}, {"oid": "688e00f5c0b90dcae9a61a5c49f79c8b9015a4f9", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/688e00f5c0b90dcae9a61a5c49f79c8b9015a4f9", "message": "feat: Use the new confirm modal for delete.", "committedDate": "2020-03-25T19:06:04Z", "type": "commit"}, {"oid": "cd38969112dc6b8a643f918e7fc33ff471031890", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/cd38969112dc6b8a643f918e7fc33ff471031890", "message": "Merge remote-tracking branch 'origin/master' into ps_provider_table", "committedDate": "2020-03-25T20:50:47Z", "type": "commit"}, {"oid": "4f484bb8b61e8a2708b5b6100f99a7954e4b5e35", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/4f484bb8b61e8a2708b5b6100f99a7954e4b5e35", "message": "Merge remote-tracking branch 'origin/master' into ps_provider_table", "committedDate": "2020-03-26T10:18:41Z", "type": "commit"}, {"oid": "2212415e7b0427bb939ad359710bca887d161791", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/2212415e7b0427bb939ad359710bca887d161791", "message": "feat: Update the import statements.", "committedDate": "2020-03-26T11:57:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODYyMTA0Mg==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/934#discussion_r398621042", "bodyText": "I don't think we really need this empty check. If the content is empty, we'll stream through an empty list creating another empty list which we're checking later on.", "author": "bamandel", "createdAt": "2020-03-26T14:34:37Z", "path": "alert-common/src/main/java/com/synopsys/integration/alert/common/descriptor/config/ui/ProviderGlobalUIConfig.java", "diffHunk": "@@ -58,4 +74,29 @@ public ProviderKey getProviderKey() {\n         return providerKey;\n     }\n \n+    private Collection<String> validateDuplicateNames(FieldValueModel fieldToValidate, FieldModel fieldModel) {\n+        try {\n+            List<ConfigurationModel> configurations = configurationAccessor.getConfigurationsByDescriptorType(DescriptorType.PROVIDER);\n+            if (!configurations.isEmpty()) {", "originalCommit": "2212415e7b0427bb939ad359710bca887d161791", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODczNTMwNg==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/934#discussion_r398735306", "bodyText": "I think this is defensive coding and saves us from running a few lines of code that we may not want.", "author": "jamesrichard91", "createdAt": "2020-03-26T16:58:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODYyMTA0Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODYzNDI2Ng==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/934#discussion_r398634266", "bodyText": "Probably don't need this variable anymore", "author": "bamandel", "createdAt": "2020-03-26T14:51:39Z", "path": "src/main/js/field/TableDisplay.js", "diffHunk": "@@ -150,25 +151,57 @@ class TableDisplay extends Component {\n         this.handleSubmit();\n     }\n \n+    handleInsertModalTest(event, onModalClose) {\n+        if (event) {\n+            event.preventDefault()\n+            event.stopPropagation();\n+        }\n+        const { nestedInAnotherModal } = this.props;\n+        // nested modals are not supported by react-bootstrap.\n+        // if this table is nested in a modal it cannot call onModalClose because it would close all modals.\n+        if (!nestedInAnotherModal) {\n+            onModalClose();\n+        }\n+        this.handleTest();\n+    }\n+\n     handleSubmit(event) {\n         if (event) {\n             event.preventDefault()\n             event.stopPropagation();\n         }\n-        const result = this.props.onConfigSave();\n-        const validationState = result ? VALIDATION_STATE.SUCCESS : VALIDATION_STATE.FAILED;\n-        this.setState({\n-            uiValidation: validationState\n-        });\n-        this.setState({\n-            showConfiguration: false\n-        });\n+        const callback = (result) => {\n+            const validationState = result ? VALIDATION_STATE.SUCCESS : VALIDATION_STATE.FAILED;\n+            const validationSetCallback = () => this.setState({\n+                showConfiguration: false\n+            }, this.updateData);\n+            this.setState({\n+                uiValidation: validationState\n+            }, validationSetCallback);\n+        };\n+        this.props.onConfigSave(callback);\n+    }\n+\n+    handleTest(event) {\n+        if (event) {\n+            event.preventDefault()\n+            event.stopPropagation();\n+        }\n+        const callback = (result) => {\n+            const validationState = result ? VALIDATION_STATE.SUCCESS : VALIDATION_STATE.FAILED;\n+            this.setState({\n+                uiValidation: validationState\n+            });\n+        };\n+        this.props.onConfigTest(callback);\n     }\n \n     createEditModal() {\n         const { currentRowSelected } = this.state;\n-        const { modalTitle, newConfigFields, inProgress } = this.props;\n-        const showModal = Boolean(currentRowSelected) || this.isShowModal();\n+        const { modalTitle, newConfigFields, inProgress, testButton, testButtonLabel, errorDialogMessage, actionMessage } = this.props;\n+        const showModal = this.isShowModal();", "originalCommit": "2212415e7b0427bb939ad359710bca887d161791", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODYzNjEzMA==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/934#discussion_r398636130", "bodyText": "HandleChange seems to be very similar everywhere. Could this be made common somewhere? If it's similar to the TableDisplay, perhaps we add most of this code there?", "author": "bamandel", "createdAt": "2020-03-26T14:53:58Z", "path": "src/main/js/providers/ProviderTable.js", "diffHunk": "@@ -0,0 +1,363 @@\n+import React, { Component } from 'react';\n+import { connect } from 'react-redux';\n+import { withRouter } from 'react-router-dom';\n+import ConfigurationLabel from 'component/common/ConfigurationLabel';\n+import PropTypes from 'prop-types';\n+import { clearConfigFieldErrors, deleteConfig, getAllConfigs, testConfig, updateConfig } from 'store/actions/globalConfiguration';\n+import * as DescriptorUtilities from 'util/descriptorUtilities';\n+import * as FieldModelUtilities from 'util/fieldModelUtilities';\n+import TableDisplay from 'field/TableDisplay';\n+import FieldsPanel from 'field/FieldsPanel';\n+import { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\n+\n+const ProviderCommonKeys = {\n+    KEY_NAME: 'provider.common.config.name',\n+    KEY_ENABLED: 'provider.common.config.enabled'\n+}\n+\n+class ProviderTable extends Component {\n+    constructor(props) {\n+        super(props);\n+        this.createTableData = this.createTableData.bind(this);\n+        this.retrieveData = this.retrieveData.bind(this);\n+        this.clearModalFieldState = this.clearModalFieldState.bind(this);\n+        this.createColumns = this.createColumns.bind(this);\n+        this.handleChange = this.handleChange.bind(this);\n+        this.onSave = this.onSave.bind(this);\n+        this.onTest = this.onTest.bind(this);\n+        this.onConfigClose = this.onConfigClose.bind(this);\n+        this.onDelete = this.onDelete.bind(this);\n+        this.createModalFields = this.createModalFields.bind(this);\n+        this.onEdit = this.onEdit.bind(this);\n+        this.onCopy = this.onCopy.bind(this);\n+        this.combineModelWithDefaults = this.combineModelWithDefaults.bind(this);\n+\n+        this.state = {\n+            descriptor: null,\n+            providerConfig: {},\n+            saveCallback: () => null\n+        };\n+    }\n+\n+    componentDidMount() {\n+        const descriptor = this.props.descriptors.find(descriptor => descriptor.name === this.props.descriptorName\n+            && descriptor.context === DescriptorUtilities.CONTEXT_TYPE.GLOBAL)\n+        if (descriptor) {\n+            const emptyConfig = FieldModelUtilities.createFieldModelWithDefaults(descriptor.fields, DescriptorUtilities.CONTEXT_TYPE.GLOBAL, descriptor.name);\n+            this.setState({\n+                descriptor,\n+                providerConfig: emptyConfig\n+            });\n+            this.props.getAllConfigs(descriptor.name);\n+        }\n+    }\n+\n+    componentDidUpdate(prevProps) {\n+        if (prevProps.updateStatus === 'UPDATING' && (this.props.updateStatus === 'UPDATED' || this.props.updateStatus === 'ERROR')) {\n+            this.state.saveCallback(true);\n+        }\n+    }\n+\n+    combineModelWithDefaults(providerConfig) {\n+        const { descriptor } = this.state;\n+        if (!descriptor) {\n+            return {};\n+        }\n+        const emptyConfig = FieldModelUtilities.createFieldModelWithDefaults(descriptor.fields, DescriptorUtilities.CONTEXT_TYPE.GLOBAL, descriptor.name);\n+        const updatedFieldModel = FieldModelUtilities.combineFieldModels(emptyConfig, providerConfig);\n+        if (providerConfig.id) {\n+            updatedFieldModel.id = providerConfig.id;\n+        }\n+        return updatedFieldModel;\n+    }\n+\n+    createColumns() {\n+        return [\n+            {\n+                header: 'id',\n+                headerLabel: 'Id',\n+                isKey: true,\n+                hidden: true\n+            },\n+            {\n+                header: 'name',\n+                headerLabel: 'Name',\n+                isKey: false,\n+                hidden: false\n+            },\n+            {\n+                header: 'createdAt',\n+                headerLabel: 'Created At',\n+                isKey: false,\n+                hidden: false\n+            },\n+            {\n+                header: 'lastUpdated',\n+                headerLabel: 'Last Updated',\n+                isKey: false,\n+                hidden: false\n+            },\n+            {\n+                header: 'enabled',\n+                headerLabel: 'Enabled',\n+                isKey: false,\n+                hidden: false,\n+                dataFormat: this.enabledState\n+            }\n+        ];\n+    }\n+\n+    enabledState(cell) {\n+        const icon = (cell == 'true') ? 'check' : 'times';\n+        const color = (cell == 'true') ? 'synopsysGreen' : 'synopsysRed';\n+        const className = `alert-icon ${color}`;\n+\n+        return (\n+            <div className=\"btn btn-link jobIconButton\">\n+                <FontAwesomeIcon icon={icon} className={className} size=\"lg\" />\n+            </div>\n+        );\n+    }\n+\n+    onConfigClose(callback) {\n+        this.props.clearFieldErrors();\n+        callback();\n+    }\n+\n+    clearModalFieldState() {\n+        if (this.state.providerConfig && Object.keys(this.state.providerConfig).length > 0) {\n+            this.setState({\n+                providerConfig: {}\n+            });\n+        }\n+    }\n+\n+    retrieveData() {\n+        const { descriptor } = this.state;\n+        if (descriptor) {\n+            this.props.getAllConfigs(descriptor.name);\n+        }\n+    }\n+\n+    handleChange(e) {\n+        const { name, value, type, checked } = e.target;\n+        const { providerConfig } = this.state;\n+\n+        const updatedValue = type === 'checkbox' ? checked.toString().toLowerCase() === 'true' : value;\n+        const newProviderConfig = Object.assign(providerConfig, FieldModelUtilities.updateFieldModelSingleValue(providerConfig, name, updatedValue));\n+\n+        this.setState({\n+            providerConfig: newProviderConfig\n+        });\n+    }", "originalCommit": "2212415e7b0427bb939ad359710bca887d161791", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODYzNjkyNA==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/934#discussion_r398636924", "bodyText": "FieldsPanel handles its on handleChange similar to this. Perhaps we could do it that way.", "author": "bamandel", "createdAt": "2020-03-26T14:54:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODYzNjEzMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODY4NTIwMw==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/934#discussion_r398685203", "bodyText": "I will look into this with another feature I will add.  I will consider it for a different PR.", "author": "psantos1113", "createdAt": "2020-03-26T15:54:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODYzNjEzMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODY2NzYzMg==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/934#discussion_r398667632", "bodyText": "Should this be a database constraint? I don't think this is the appropriate place to handle this error.", "author": "gkillough", "createdAt": "2020-03-26T15:33:02Z", "path": "alert-common/src/main/java/com/synopsys/integration/alert/common/descriptor/config/ui/ProviderGlobalUIConfig.java", "diffHunk": "@@ -58,4 +74,29 @@ public ProviderKey getProviderKey() {\n         return providerKey;\n     }\n \n+    private Collection<String> validateDuplicateNames(FieldValueModel fieldToValidate, FieldModel fieldModel) {\n+        try {\n+            List<ConfigurationModel> configurations = configurationAccessor.getConfigurationsByDescriptorType(DescriptorType.PROVIDER);\n+            if (!configurations.isEmpty()) {\n+                List<ConfigurationModel> modelsWithName = configurations.stream()\n+                                                              .filter(configurationModel ->\n+                                                                          configurationModel.getField(ProviderDescriptor.KEY_PROVIDER_CONFIG_NAME)\n+                                                                              .flatMap(ConfigurationFieldModel::getFieldValue)\n+                                                                              .filter(configName -> configName.equals(fieldToValidate.getValue().orElse(\"\")))\n+                                                                              .isPresent())\n+                                                              .collect(Collectors.toList());\n+                if (modelsWithName.size() > 1) {\n+                    return List.of(ERROR_DUPLICATE_PROVIDER_NAME);", "originalCommit": "2212415e7b0427bb939ad359710bca887d161791", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODczNjYyNw==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/934#discussion_r398736627", "bodyText": "We could move this duplicate validation into the database accessors.", "author": "jamesrichard91", "createdAt": "2020-03-26T17:00:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODY2NzYzMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODgxNjQ5Ng==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/934#discussion_r398816496", "bodyText": "A database exception won't get associated as a field exception and then we can't display the error of a duplicate name with the name text field in the form.  We perform the same validation with job names and construct the the field exception in the JobConfigActions.  If I throw a database exception it won't be tied to a field.  We should add a constraint to the database that the configuration name be unique", "author": "psantos1113", "createdAt": "2020-03-26T18:55:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODY2NzYzMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODgxODMzNQ==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/934#discussion_r398818335", "bodyText": "My bad, I realize this is the validator, not the endpoint.", "author": "gkillough", "createdAt": "2020-03-26T18:58:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODY2NzYzMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODY2OTIyMQ==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/934#discussion_r398669221", "bodyText": "Anything we can do to make this more dynamic? We should have a display name in the provider metadata no?", "author": "gkillough", "createdAt": "2020-03-26T15:35:03Z", "path": "src/main/js/Navigation.js", "diffHunk": "@@ -40,12 +40,18 @@ class Navigation extends Component {\n \n     render() {\n         const channelGlobals = this.createNavItemForDescriptors(DescriptorUtilities.DESCRIPTOR_TYPE.CHANNEL, DescriptorUtilities.CONTEXT_TYPE.GLOBAL, '/alert/channels/', 'Channels');\n-        const providers = this.createNavItemForDescriptors(DescriptorUtilities.DESCRIPTOR_TYPE.PROVIDER, DescriptorUtilities.CONTEXT_TYPE.GLOBAL, '/alert/providers/', 'Providers');\n         const components = this.createNavItemForDescriptors(DescriptorUtilities.DESCRIPTOR_TYPE.COMPONENT, DescriptorUtilities.CONTEXT_TYPE.GLOBAL, '/alert/components/');\n \n         const nav = (\n             <Fragment>\n-                {providers}\n+                <li className=\"navHeader\">\n+                    Providers\n+                </li>\n+                <li>\n+                    <NavLink to=\"/alert/providers/blackduck\" activeClassName=\"activeNav\">\n+                        Black Duck\n+                    </NavLink>", "originalCommit": "2212415e7b0427bb939ad359710bca887d161791", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODY4NTc5Mw==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/934#discussion_r398685793", "bodyText": "I should be able to iterate through the providers to make it more dynamic.", "author": "psantos1113", "createdAt": "2020-03-26T15:55:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODY2OTIyMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODY3MjYwMA==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/934#discussion_r398672600", "bodyText": "Are we storing the CSRF token as a cookie?", "author": "gkillough", "createdAt": "2020-03-26T15:39:06Z", "path": "src/main/js/store/actions/globalConfiguration.js", "diffHunk": "@@ -152,6 +167,27 @@ export function refreshConfig(id) {\n     };\n }\n \n+export function getAllConfigs(descriptorName) {\n+    return (dispatch, getState) => {\n+        dispatch(fetchingConfig());\n+        const { csrfToken } = getState().session;", "originalCommit": "2212415e7b0427bb939ad359710bca887d161791", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODY4Njc3NQ==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/934#discussion_r398686775", "bodyText": "The CSRF token is stored in the redux state for the application.  When you login we update the redux state with the CSRF token for the application.  It isn't stored as a cookie.", "author": "psantos1113", "createdAt": "2020-03-26T15:56:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODY3MjYwMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODc1MTc0Mw==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/934#discussion_r398751743", "bodyText": "I dont think this method name makes sense. Maybe checkGlobalPermissions ?", "author": "jamesrichard91", "createdAt": "2020-03-26T17:21:34Z", "path": "src/main/js/providers/ProviderTable.js", "diffHunk": "@@ -0,0 +1,363 @@\n+import React, { Component } from 'react';\n+import { connect } from 'react-redux';\n+import { withRouter } from 'react-router-dom';\n+import ConfigurationLabel from 'component/common/ConfigurationLabel';\n+import PropTypes from 'prop-types';\n+import { clearConfigFieldErrors, deleteConfig, getAllConfigs, testConfig, updateConfig } from 'store/actions/globalConfiguration';\n+import * as DescriptorUtilities from 'util/descriptorUtilities';\n+import * as FieldModelUtilities from 'util/fieldModelUtilities';\n+import TableDisplay from 'field/TableDisplay';\n+import FieldsPanel from 'field/FieldsPanel';\n+import { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\n+\n+const ProviderCommonKeys = {\n+    KEY_NAME: 'provider.common.config.name',\n+    KEY_ENABLED: 'provider.common.config.enabled'\n+}\n+\n+class ProviderTable extends Component {\n+    constructor(props) {\n+        super(props);\n+        this.createTableData = this.createTableData.bind(this);\n+        this.retrieveData = this.retrieveData.bind(this);\n+        this.clearModalFieldState = this.clearModalFieldState.bind(this);\n+        this.createColumns = this.createColumns.bind(this);\n+        this.handleChange = this.handleChange.bind(this);\n+        this.onSave = this.onSave.bind(this);\n+        this.onTest = this.onTest.bind(this);\n+        this.onConfigClose = this.onConfigClose.bind(this);\n+        this.onDelete = this.onDelete.bind(this);\n+        this.createModalFields = this.createModalFields.bind(this);\n+        this.onEdit = this.onEdit.bind(this);\n+        this.onCopy = this.onCopy.bind(this);\n+        this.combineModelWithDefaults = this.combineModelWithDefaults.bind(this);\n+\n+        this.state = {\n+            descriptor: null,\n+            providerConfig: {},\n+            saveCallback: () => null\n+        };\n+    }\n+\n+    componentDidMount() {\n+        const descriptor = this.props.descriptors.find(descriptor => descriptor.name === this.props.descriptorName\n+            && descriptor.context === DescriptorUtilities.CONTEXT_TYPE.GLOBAL)\n+        if (descriptor) {\n+            const emptyConfig = FieldModelUtilities.createFieldModelWithDefaults(descriptor.fields, DescriptorUtilities.CONTEXT_TYPE.GLOBAL, descriptor.name);\n+            this.setState({\n+                descriptor,\n+                providerConfig: emptyConfig\n+            });\n+            this.props.getAllConfigs(descriptor.name);\n+        }\n+    }\n+\n+    componentDidUpdate(prevProps) {\n+        if (prevProps.updateStatus === 'UPDATING' && (this.props.updateStatus === 'UPDATED' || this.props.updateStatus === 'ERROR')) {\n+            this.state.saveCallback(true);\n+        }\n+    }\n+\n+    combineModelWithDefaults(providerConfig) {\n+        const { descriptor } = this.state;\n+        if (!descriptor) {\n+            return {};\n+        }\n+        const emptyConfig = FieldModelUtilities.createFieldModelWithDefaults(descriptor.fields, DescriptorUtilities.CONTEXT_TYPE.GLOBAL, descriptor.name);\n+        const updatedFieldModel = FieldModelUtilities.combineFieldModels(emptyConfig, providerConfig);\n+        if (providerConfig.id) {\n+            updatedFieldModel.id = providerConfig.id;\n+        }\n+        return updatedFieldModel;\n+    }\n+\n+    createColumns() {\n+        return [\n+            {\n+                header: 'id',\n+                headerLabel: 'Id',\n+                isKey: true,\n+                hidden: true\n+            },\n+            {\n+                header: 'name',\n+                headerLabel: 'Name',\n+                isKey: false,\n+                hidden: false\n+            },\n+            {\n+                header: 'createdAt',\n+                headerLabel: 'Created At',\n+                isKey: false,\n+                hidden: false\n+            },\n+            {\n+                header: 'lastUpdated',\n+                headerLabel: 'Last Updated',\n+                isKey: false,\n+                hidden: false\n+            },\n+            {\n+                header: 'enabled',\n+                headerLabel: 'Enabled',\n+                isKey: false,\n+                hidden: false,\n+                dataFormat: this.enabledState\n+            }\n+        ];\n+    }\n+\n+    enabledState(cell) {\n+        const icon = (cell == 'true') ? 'check' : 'times';\n+        const color = (cell == 'true') ? 'synopsysGreen' : 'synopsysRed';\n+        const className = `alert-icon ${color}`;\n+\n+        return (\n+            <div className=\"btn btn-link jobIconButton\">\n+                <FontAwesomeIcon icon={icon} className={className} size=\"lg\" />\n+            </div>\n+        );\n+    }\n+\n+    onConfigClose(callback) {\n+        this.props.clearFieldErrors();\n+        callback();\n+    }\n+\n+    clearModalFieldState() {\n+        if (this.state.providerConfig && Object.keys(this.state.providerConfig).length > 0) {\n+            this.setState({\n+                providerConfig: {}\n+            });\n+        }\n+    }\n+\n+    retrieveData() {\n+        const { descriptor } = this.state;\n+        if (descriptor) {\n+            this.props.getAllConfigs(descriptor.name);\n+        }\n+    }\n+\n+    handleChange(e) {\n+        const { name, value, type, checked } = e.target;\n+        const { providerConfig } = this.state;\n+\n+        const updatedValue = type === 'checkbox' ? checked.toString().toLowerCase() === 'true' : value;\n+        const newProviderConfig = Object.assign(providerConfig, FieldModelUtilities.updateFieldModelSingleValue(providerConfig, name, updatedValue));\n+\n+        this.setState({\n+            providerConfig: newProviderConfig\n+        });\n+    }\n+\n+    onSave(callback) {\n+        const { providerConfig } = this.state;\n+        const configToUpdate = this.combineModelWithDefaults(providerConfig);\n+        this.props.updateConfig(configToUpdate);\n+        this.setState({\n+            saveCallback: callback\n+        });\n+        return true;\n+    }\n+\n+    onTest(callback) {\n+        const { providerConfig } = this.state;\n+        const configToUpdate = this.combineModelWithDefaults(providerConfig);\n+        this.props.testConfig(configToUpdate, '');\n+        callback(true);\n+        return true;\n+    }\n+\n+    onDelete(configsToDelete, callback) {\n+        if (configsToDelete) {\n+            configsToDelete.forEach(configId => {\n+                this.props.deleteConfig(configId);\n+            });\n+        }\n+        callback();\n+        this.retrieveData();\n+    }\n+\n+    createModalFields() {\n+        const { providerConfig, descriptor } = this.state;\n+        const { fieldErrors } = this.props;\n+        const newConfig = this.combineModelWithDefaults(providerConfig);\n+        if (descriptor) {\n+            return (\n+                <div>\n+                    <FieldsPanel\n+                        descriptorFields={descriptor.fields}\n+                        self={this}\n+                        fieldErrors={fieldErrors}\n+                        stateName={'providerConfig'}\n+                        currentConfig={newConfig}\n+                    />\n+                </div>\n+            );\n+        }\n+        return <div />;\n+    }\n+\n+    onEdit(selectedRow, callback) {\n+        const { id } = selectedRow;\n+        const { providerConfigs } = this.props;\n+        const selectedConfig = providerConfigs.find(config => config.id === id);\n+        this.setState({\n+            providerConfig: selectedConfig\n+        }, callback);\n+    }\n+\n+    onCopy(selectedRow, callback) {\n+        const { id } = selectedRow;\n+        const { providerConfigs } = this.props;\n+        let selectedConfig = providerConfigs.find(config => config.id === id);\n+        const { descriptor } = this.state;\n+        if (descriptor) {\n+            descriptor.fields.forEach(field => {\n+                if (field.sensitive) {\n+                    selectedConfig = FieldModelUtilities.updateFieldModelSingleValue(selectedConfig, field.key, \"\");\n+                }\n+            });\n+        }\n+\n+        selectedConfig.id = null;\n+        this.setState({\n+            providerConfig: selectedConfig\n+        }, callback);\n+    }\n+\n+    checkJobPermissions(operation) {", "originalCommit": "2212415e7b0427bb939ad359710bca887d161791", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "0d00d13c771d53614ab6ff492cc864705daf48d9", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/0d00d13c771d53614ab6ff492cc864705daf48d9", "message": "Merge remote-tracking branch 'origin/master' into ps_provider_table", "committedDate": "2020-03-26T18:33:28Z", "type": "commit"}, {"oid": "d1e94f723b5d7e066daaa74d45ecddeccde85f04", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/d1e94f723b5d7e066daaa74d45ecddeccde85f04", "message": "refactor: Implement PR feedback.", "committedDate": "2020-03-26T19:34:54Z", "type": "commit"}]}