{"pr_number": 1041, "pr_title": "Create Initial Azure Boards Library", "pr_createdAt": "2020-06-30T19:09:47Z", "pr_url": "https://github.com/blackducksoftware/blackduck-alert/pull/1041", "timeline": [{"oid": "0612092c30865423240e7b50702ef04ba6c767e9", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/0612092c30865423240e7b50702ef04ba6c767e9", "message": "Feat: Create azure-boards-common and create OAuth 2.0 example", "committedDate": "2020-06-30T15:03:23Z", "type": "commit"}, {"oid": "63852faf932ea757f1c52e31605898c16163acf3", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/63852faf932ea757f1c52e31605898c16163acf3", "message": "Feat(Azure Library): Return String rather than OAuth specific object to limit client's ability to manipulate a request", "committedDate": "2020-06-30T15:34:41Z", "type": "commit"}, {"oid": "e7fd5a0ef8a466a8761c1be2075a264cebf5f0f1", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/e7fd5a0ef8a466a8761c1be2075a264cebf5f0f1", "message": "Feat(Azure Library): Create basic HTTP service for azure", "committedDate": "2020-06-30T16:18:39Z", "type": "commit"}, {"oid": "d8e9cb55c93cfe8f83a7308ed8bebb585f0a6366", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/d8e9cb55c93cfe8f83a7308ed8bebb585f0a6366", "message": "Feat(Azure Library): Add project service and various utilities it needed", "committedDate": "2020-06-30T17:59:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzkyMDE0Mw==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1041#discussion_r447920143", "bodyText": "Shouldn't we extend IntegrationException to make error handling easier?", "author": "jamesrichard91", "createdAt": "2020-06-30T19:13:28Z", "path": "azure-boards-common/src/main/java/com/synopsys/integration/azure/boards/common/http/HttpServiceException.java", "diffHunk": "@@ -0,0 +1,51 @@\n+package com.synopsys.integration.azure.boards.common.http;\n+\n+import org.apache.http.HttpStatus;\n+\n+public class HttpServiceException extends Exception {", "originalCommit": "d8e9cb55c93cfe8f83a7308ed8bebb585f0a6366", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzkyMTg0Mg==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1041#discussion_r447921842", "bodyText": "The API for this class will definitely change, but for now, I'm going to leave this as a POC.", "author": "gkillough", "createdAt": "2020-06-30T19:16:54Z", "path": "azure-boards-common/src/main/java/com/synopsys/integration/azure/boards/common/http/AzureBoardsOAuthService.java", "diffHunk": "@@ -0,0 +1,86 @@\n+package com.synopsys.integration.azure.boards.common.http;\n+\n+import java.io.IOException;\n+import java.net.Proxy;\n+import java.util.Optional;\n+\n+import org.apache.commons.lang3.StringUtils;\n+\n+import com.google.api.client.auth.oauth2.AuthorizationCodeFlow;\n+import com.google.api.client.auth.oauth2.AuthorizationCodeTokenRequest;\n+import com.google.api.client.auth.oauth2.BearerToken;\n+import com.google.api.client.auth.oauth2.Credential;\n+import com.google.api.client.auth.oauth2.StoredCredential;\n+import com.google.api.client.auth.oauth2.TokenResponse;\n+import com.google.api.client.http.GenericUrl;\n+import com.google.api.client.http.javanet.NetHttpTransport;\n+import com.google.api.client.json.jackson2.JacksonFactory;\n+import com.google.api.client.util.Base64;\n+import com.google.api.client.util.store.DataStoreFactory;\n+import com.synopsys.integration.exception.IntegrationException;\n+\n+public class AzureBoardsOAuthService {", "originalCommit": "d8e9cb55c93cfe8f83a7308ed8bebb585f0a6366", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzkzNDExMw==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1041#discussion_r447934113", "bodyText": "This is probably unnecessary.", "author": "gkillough", "createdAt": "2020-06-30T19:40:13Z", "path": "azure-boards-common/src/main/java/com/synopsys/integration/azure/boards/common/model/AzureSpecTemplate.java", "diffHunk": "@@ -0,0 +1,40 @@\n+package com.synopsys.integration.azure.boards.common.model;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import org.apache.commons.lang3.StringUtils;\n+\n+public class AzureSpecTemplate {\n+    private final String specTemplate;\n+    private final Map<String, String> replacementMappings;\n+\n+    public AzureSpecTemplate(String specTemplate) {\n+        this.specTemplate = specTemplate;\n+        this.replacementMappings = new HashMap<>();\n+    }\n+\n+    private AzureSpecTemplate(String specTemplate, Map<String, String> replacementMappings) {\n+        this.specTemplate = specTemplate;\n+        this.replacementMappings = replacementMappings;\n+    }\n+\n+    public AzureSpecTemplate defineReplacement(String specTemplateKey, String replacementString) {\n+        HashMap<String, String> populatedReplacementMappings = new HashMap<>(replacementMappings);\n+        populatedReplacementMappings.put(specTemplateKey, replacementString);\n+        return new AzureSpecTemplate(specTemplate, populatedReplacementMappings);\n+    }\n+\n+    public String populateSpec() {\n+        String populatedSpec = specTemplate;\n+        for (Map.Entry<String, String> replacementEntry : replacementMappings.entrySet()) {\n+            populatedSpec = StringUtils.replaceOnce(populatedSpec, replacementEntry.getKey(), replacementEntry.getValue());\n+        }\n+\n+        if (!replacementMappings.isEmpty()) {\n+            replacementMappings.clear();\n+        }", "originalCommit": "d8e9cb55c93cfe8f83a7308ed8bebb585f0a6366", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e3203be506b937c757187bf2e0c9f70966785158", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/e3203be506b937c757187bf2e0c9f70966785158", "message": "Fix(Azure Boards): Extend integration exception and improve spec templating", "committedDate": "2020-06-30T19:44:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODI3NDQzNQ==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1041#discussion_r448274435", "bodyText": "Wouldn't this need to be public in the future?  I don't see this method used but the public methods require an AuthorizationCodeFlow which this private method produces.", "author": "psantos1113", "createdAt": "2020-07-01T10:38:03Z", "path": "azure-boards-common/src/main/java/com/synopsys/integration/azure/boards/common/http/AzureBoardsOAuthService.java", "diffHunk": "@@ -0,0 +1,86 @@\n+package com.synopsys.integration.azure.boards.common.http;\n+\n+import java.io.IOException;\n+import java.net.Proxy;\n+import java.util.Optional;\n+\n+import org.apache.commons.lang3.StringUtils;\n+\n+import com.google.api.client.auth.oauth2.AuthorizationCodeFlow;\n+import com.google.api.client.auth.oauth2.AuthorizationCodeTokenRequest;\n+import com.google.api.client.auth.oauth2.BearerToken;\n+import com.google.api.client.auth.oauth2.Credential;\n+import com.google.api.client.auth.oauth2.StoredCredential;\n+import com.google.api.client.auth.oauth2.TokenResponse;\n+import com.google.api.client.http.GenericUrl;\n+import com.google.api.client.http.javanet.NetHttpTransport;\n+import com.google.api.client.json.jackson2.JacksonFactory;\n+import com.google.api.client.util.Base64;\n+import com.google.api.client.util.store.DataStoreFactory;\n+import com.synopsys.integration.exception.IntegrationException;\n+\n+public class AzureBoardsOAuthService {\n+    private final String authorizationServerUrl;\n+    private final Proxy proxy;\n+    private final DataStoreFactory dataStoreFactory;\n+\n+    public AzureBoardsOAuthService(String authorizationServerUrl, Proxy proxy, DataStoreFactory dataStoreFactory) {\n+        this.authorizationServerUrl = sanitizeUrl(authorizationServerUrl);\n+        this.proxy = proxy;\n+        this.dataStoreFactory = dataStoreFactory;\n+    }\n+\n+    public Optional<Credential> getExistingOAuthCredential(AuthorizationCodeFlow authorizationCodeFlow, String userId) throws IntegrationException {\n+        try {\n+            Credential storedCredential = authorizationCodeFlow.loadCredential(userId);\n+            return Optional.ofNullable(storedCredential);\n+        } catch (IOException e) {\n+            throw new IntegrationException(e);\n+        }\n+    }\n+\n+    public String getAuthorizationUrl(AuthorizationCodeFlow authorizationCodeFlow, String redirectUri) {\n+        return authorizationCodeFlow.newAuthorizationUrl()\n+                   .setClientId(authorizationCodeFlow.getClientId())\n+                   .setRedirectUri(redirectUri)\n+                   .build();\n+    }\n+\n+    public Credential authorizeAndStoreCredential(AuthorizationCodeFlow authorizationCodeFlow, String userId, String authorizationCode) throws IntegrationException {\n+        try {\n+            AuthorizationCodeTokenRequest authorizationCodeTokenRequest = authorizationCodeFlow.newTokenRequest(authorizationCode);\n+            TokenResponse tokenResponse = authorizationCodeTokenRequest.execute();\n+            return authorizationCodeFlow.createAndStoreCredential(tokenResponse, userId);\n+        } catch (IOException e) {\n+            throw new IntegrationException(e);\n+        }\n+    }\n+\n+    private AuthorizationCodeFlow initializeFlow(String clientId) throws IOException {", "originalCommit": "e3203be506b937c757187bf2e0c9f70966785158", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODMxMjQ1NQ==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1041#discussion_r448312455", "bodyText": "Yeah, I'm leaving the code in this class alone for now because we will need to determine what gets configured vs gets defaults. I just wanted to leave some code examples in the library, but this may actually become something totally different when we start to implement the channel global config.", "author": "gkillough", "createdAt": "2020-07-01T11:56:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODI3NDQzNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODI3OTMwMA==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1041#discussion_r448279300", "bodyText": "This seems like it would be well suited in our int-rest library. A utility to handle this kind of replacement for urls.  Might be something to look into in the future.  I like the concept here.", "author": "psantos1113", "createdAt": "2020-07-01T10:48:01Z", "path": "azure-boards-common/src/main/java/com/synopsys/integration/azure/boards/common/model/AzureSpecTemplate.java", "diffHunk": "@@ -0,0 +1,44 @@\n+package com.synopsys.integration.azure.boards.common.model;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import org.apache.commons.lang3.StringUtils;\n+\n+public class AzureSpecTemplate {", "originalCommit": "e3203be506b937c757187bf2e0c9f70966785158", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "ad48e322ebe790c72c65c95cced8113c0ab1fc6c", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/ad48e322ebe790c72c65c95cced8113c0ab1fc6c", "message": "Merge branch 'master' into feat_azure_boards_library", "committedDate": "2020-07-01T12:33:54Z", "type": "commit"}]}