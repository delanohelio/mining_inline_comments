{"pr_number": 1170, "pr_title": "global config validation", "pr_createdAt": "2020-09-16T18:13:26Z", "pr_url": "https://github.com/blackducksoftware/blackduck-alert/pull/1170", "timeline": [{"oid": "45e336a3dfe4daa68e0033135ef62dde2689b385", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/45e336a3dfe4daa68e0033135ef62dde2689b385", "message": "refactor: Initial work for updating actions and reducers for globalConfiguration", "committedDate": "2020-09-15T19:13:48Z", "type": "commit"}, {"oid": "f178dd5397b302e1b46e0a2f93dfa99aff5d8ebd", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/f178dd5397b302e1b46e0a2f93dfa99aff5d8ebd", "message": "refactor: Update GlobalConfiguration to use new action responses", "committedDate": "2020-09-16T17:51:15Z", "type": "commit"}, {"oid": "891616a43d2127a8b4c8c5311b49a22cbff125cb", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/891616a43d2127a8b4c8c5311b49a22cbff125cb", "message": "Merge branch 'feat_action_response' into mc_action_response_globalConfig", "committedDate": "2020-09-16T17:51:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTY0Mzk2Ng==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1170#discussion_r489643966", "bodyText": "Do we prefer a multiline method signature?", "author": "bamandel", "createdAt": "2020-09-16T18:32:30Z", "path": "src/main/js/store/actions/globalConfiguration.js", "diffHunk": "@@ -153,18 +157,39 @@ function clearFieldErrors() {\n     };\n }\n \n-function handleFailureResponse(dispatch, responseData, statusCode) {\n+function validatingConfig() {\n+    return {\n+        type: CONFIG_VALIDATING\n+    };\n+}\n+\n+function validatedConfig() {\n+    return {\n+        type: CONFIG_VALIDATED\n+    };\n+}\n+\n+function configValidationError({ message, errors }) {\n+    return {\n+        type: CONFIG_VALIDATE_ERROR,\n+        message,\n+        errors\n+    };\n+}\n+\n+function createErrorHandler(type, defaultHandler) {\n     const errorHandlers = [];\n-    const configErrorHandler = () => configError(responseData.message, responseData.errors);\n     errorHandlers.push(HTTPErrorUtils.createUnauthorizedHandler(unauthorized));\n-    errorHandlers.push(HTTPErrorUtils.createDefaultHandler(() => configError(responseData.message, null)));\n-    errorHandlers.push(HTTPErrorUtils.createBadRequestHandler(configErrorHandler));\n-    errorHandlers.push(HTTPErrorUtils.createPreconditionFailedHandler(configErrorHandler));\n-    const handler = HTTPErrorUtils.createHttpErrorHandler(errorHandlers);\n-    dispatch(handler(statusCode));\n+    errorHandlers.push(HTTPErrorUtils.createForbiddenHandler(() => configError({ type, message: HTTPErrorUtils.MESSAGES.FORBIDDEN_ACTION })));\n+    errorHandlers.push(HTTPErrorUtils.createBadRequestHandler(defaultHandler));\n+    errorHandlers.push(HTTPErrorUtils.createPreconditionFailedHandler(defaultHandler));\n+    errorHandlers.push(HTTPErrorUtils.createDefaultHandler(defaultHandler));\n+\n+    return HTTPErrorUtils.createHttpErrorHandler(errorHandlers);\n }\n \n-export function refreshConfig(id) {\n+export function\n+refreshConfig(id) {", "originalCommit": "891616a43d2127a8b4c8c5311b49a22cbff125cb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTY1NzUxNw==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1170#discussion_r489657517", "bodyText": "Why is export function and refreshConfig(id) { on different lines?", "author": "jamesrichard91", "createdAt": "2020-09-16T18:44:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTY0Mzk2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTY2MjI2NA==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1170#discussion_r489662264", "bodyText": "This was a mistake, I can update it", "author": "ChomickiM", "createdAt": "2020-09-16T18:49:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTY0Mzk2Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTY0NjE5Ng==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1170#discussion_r489646196", "bodyText": "You could remove the else (for the response.status check) and only need to call refresh once:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                        dispatch(refreshConfig(newId));\n          \n          \n            \n                                    });\n          \n          \n            \n                            } else {\n          \n          \n            \n                                dispatch(refreshConfig(id));\n          \n          \n            \n                            }\n          \n          \n            \n                                    });\n          \n          \n            \n                            }\n          \n          \n            \n                            dispatch(refreshConfig(id));", "author": "gkillough", "createdAt": "2020-09-16T18:34:25Z", "path": "src/main/js/store/actions/globalConfiguration.js", "diffHunk": "@@ -258,17 +304,29 @@ export function updateConfig(config) {\n             request = ConfigRequestBuilder.createNewConfigurationRequest(ConfigRequestBuilder.CONFIG_API_URL, csrfToken, config);\n         }\n         request.then((response) => {\n-            response.json()\n-                .then((responseData) => {\n-                    if (response.ok) {\n-                        const newId = responseData.id;\n-                        const updatedConfig = FieldModelUtilities.updateFieldModelSingleValue(config, 'id', newId);\n-                        dispatch(configUpdated(updatedConfig));\n-                        dispatch(refreshConfig(newId));\n-                    } else {\n-                        handleFailureResponse(dispatch, responseData, response.status);\n-                    }\n-                });\n+            if (response.ok) {\n+                if (response.status === 201) {\n+                    response.json()\n+                        .then((responseData) => {\n+                            const newId = responseData.id;\n+                            const updatedConfig = FieldModelUtilities.updateFieldModelSingleValue(config, 'id', newId);\n+                            dispatch(configUpdated(updatedConfig));\n+                            dispatch(refreshConfig(newId));\n+                        });\n+                } else {\n+                    dispatch(refreshConfig(id));\n+                }", "originalCommit": "891616a43d2127a8b4c8c5311b49a22cbff125cb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTY1MTkwNg==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1170#discussion_r489651906", "bodyText": "Ah, but you'll have to create an id variable outside of the if-statement and set it for a 201.", "author": "gkillough", "createdAt": "2020-09-16T18:39:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTY0NjE5Ng=="}], "type": "inlineReview"}, {"oid": "9faafff51fcc567d9bb1445c7af43b8bfc596fd9", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/9faafff51fcc567d9bb1445c7af43b8bfc596fd9", "message": "style: Fixing multiline method signature mistake", "committedDate": "2020-09-16T18:51:23Z", "type": "commit"}]}