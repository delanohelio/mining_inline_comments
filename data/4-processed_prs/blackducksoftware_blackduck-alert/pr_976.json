{"pr_number": 976, "pr_title": "Fixing UIConfig, and TableDisplay usage", "pr_createdAt": "2020-05-12T20:13:38Z", "pr_url": "https://github.com/blackducksoftware/blackduck-alert/pull/976", "timeline": [{"oid": "b33185de02ede40bf9a52c57f187c41ab2a8605a", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/b33185de02ede40bf9a52c57f187c41ab2a8605a", "message": "Fix: Fixing the config field retrieval so state changes don't have lasting impacts. Updating the UI to make sure the correct descriptor is used.", "committedDate": "2020-05-12T20:11:31Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDAwNjQ4MQ==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/976#discussion_r424006481", "bodyText": "For User's that have READONLY access we were changing the state of the fields. This change was being persisted even when you switched user's. So now we create a copy of the list to prevent the changes from effecting the in memory fields.", "author": "jamesrichard91", "createdAt": "2020-05-12T20:15:36Z", "path": "alert-common/src/main/java/com/synopsys/integration/alert/common/descriptor/config/ui/UIConfig.java", "diffHunk": "@@ -57,7 +59,7 @@ public void setConfigFields() {\n     protected abstract List<ConfigField> createFields();\n \n     public List<ConfigField> getFields() {\n-        return configFields;\n+        return configFields.stream().map(SerializationUtils::clone).collect(Collectors.toList());", "originalCommit": "b33185de02ede40bf9a52c57f187c41ab2a8605a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDM1NjQ3OA==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/976#discussion_r424356478", "bodyText": "Should we have a findSingleDescriptorByNameAndContext or modify findDescriptorByNameAndContext to perform encapsulate this code into the method so that we don't have to copy and paste the if check?\nAdd this code to the findDescriptorByNameAndContext or create a new method:\nlet foundDescriptor = null; if(descriptorList && descriptorList.length > 0) { foundDescriptor = descriptorLIst[0]; }", "author": "psantos1113", "createdAt": "2020-05-13T11:11:20Z", "path": "src/main/js/dynamic/loaded/users/UserManagement.js", "diffHunk": "@@ -12,15 +12,18 @@ class UserManagement extends Component {\n     constructor(props) {\n         super(props);\n \n-        const descriptor = DescriptorUtilities.findDescriptorByNameAndContext(this.props.descriptors, DescriptorUtilities.DESCRIPTOR_NAME.COMPONENT_USERS, DescriptorUtilities.CONTEXT_TYPE.GLOBAL)[0];\n-        this.state = { descriptor };\n     }\n \n     render() {\n-        const { descriptor } = this.state;\n-        const { label, description } = this.props;\n-        const canCreate = DescriptorUtilities.isOperationAssigned(descriptor, DescriptorUtilities.OPERATIONS.CREATE);\n-        const canDelete = DescriptorUtilities.isOperationAssigned(descriptor, DescriptorUtilities.OPERATIONS.DELETE);\n+        const { label, description, descriptors } = this.props;\n+        const descriptorList = DescriptorUtilities.findDescriptorByNameAndContext(descriptors, DescriptorUtilities.DESCRIPTOR_NAME.COMPONENT_USERS, DescriptorUtilities.CONTEXT_TYPE.GLOBAL)", "originalCommit": "b33185de02ede40bf9a52c57f187c41ab2a8605a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDQ3NzIyNA==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/976#discussion_r424477224", "bodyText": "Should this return an empty object? from the function name, I imagine this should return at least the original model without defaults.", "author": "bamandel", "createdAt": "2020-05-13T14:21:59Z", "path": "src/main/js/providers/ProviderTable.js", "diffHunk": "@@ -59,16 +58,18 @@ class ProviderTable extends Component {\n     }\n \n     combineModelWithDefaults(providerConfig) {\n-        const { descriptor } = this.state;\n-        if (!descriptor) {\n-            return {};\n-        }\n-        const emptyConfig = FieldModelUtilities.createFieldModelWithDefaults(descriptor.fields, DescriptorUtilities.CONTEXT_TYPE.GLOBAL, descriptor.name);\n-        const updatedFieldModel = FieldModelUtilities.combineFieldModels(emptyConfig, providerConfig);\n-        if (providerConfig.id) {\n-            updatedFieldModel.id = providerConfig.id;\n+        const { descriptors, descriptorName } = this.props\n+        const descriptorList = DescriptorUtilities.findDescriptorByNameAndContext(descriptors, descriptorName, DescriptorUtilities.CONTEXT_TYPE.GLOBAL)\n+        if (descriptorList && descriptorList.length > 0) {\n+            const foundDescriptor = descriptorList[0];\n+            const emptyConfig = FieldModelUtilities.createFieldModelWithDefaults(foundDescriptor.fields, DescriptorUtilities.CONTEXT_TYPE.GLOBAL, foundDescriptor.name);\n+            const updatedFieldModel = FieldModelUtilities.combineFieldModels(emptyConfig, providerConfig);\n+            if (providerConfig.id) {\n+                updatedFieldModel.id = providerConfig.id;\n+            }\n+            return updatedFieldModel;\n         }\n-        return updatedFieldModel;\n+        return {};", "originalCommit": "b33185de02ede40bf9a52c57f187c41ab2a8605a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU5OTY0Mg==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/976#discussion_r424599642", "bodyText": "Previously we had\n if (!descriptor) {\n            return {};\n        }\nSo this maintains that behavior.", "author": "jamesrichard91", "createdAt": "2020-05-13T17:12:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDQ3NzIyNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDQ3OTk5OQ==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/976#discussion_r424479999", "bodyText": "The lines Paulo mentioned above is used through out the PR. The new function can be used here as well", "author": "bamandel", "createdAt": "2020-05-13T14:25:30Z", "path": "src/main/js/providers/ProviderTable.js", "diffHunk": "@@ -133,9 +134,11 @@ class ProviderTable extends Component {\n     }\n \n     retrieveData() {\n-        const { descriptor } = this.state;\n-        if (descriptor) {\n-            this.props.getAllConfigs(descriptor.name);\n+        const { descriptors, descriptorName } = this.props\n+        const descriptorList = DescriptorUtilities.findDescriptorByNameAndContext(descriptors, descriptorName, DescriptorUtilities.CONTEXT_TYPE.GLOBAL)\n+        if (descriptorList && descriptorList.length > 0) {\n+            const foundDescriptor = descriptorList[0];", "originalCommit": "b33185de02ede40bf9a52c57f187c41ab2a8605a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDQ4MDY4Nw==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/976#discussion_r424480687", "bodyText": "I'll just mark them all for you", "author": "bamandel", "createdAt": "2020-05-13T14:26:17Z", "path": "src/main/js/providers/ProviderTable.js", "diffHunk": "@@ -180,14 +183,16 @@ class ProviderTable extends Component {\n     }\n \n     createModalFields() {\n-        const { providerConfig, descriptor } = this.state;\n-        const { fieldErrors } = this.props;\n+        const { providerConfig } = this.state;\n+        const { fieldErrors, descriptors, descriptorName } = this.props;\n         const newConfig = this.combineModelWithDefaults(providerConfig);\n-        if (descriptor) {\n+        const descriptorList = DescriptorUtilities.findDescriptorByNameAndContext(descriptors, descriptorName, DescriptorUtilities.CONTEXT_TYPE.GLOBAL)\n+        if (descriptorList && descriptorList.length > 0) {\n+            const foundDescriptor = descriptorList[0];", "originalCommit": "b33185de02ede40bf9a52c57f187c41ab2a8605a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDQ4MDc2Mw==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/976#discussion_r424480763", "bodyText": "here", "author": "bamandel", "createdAt": "2020-05-13T14:26:24Z", "path": "src/main/js/providers/ProviderTable.js", "diffHunk": "@@ -212,9 +217,11 @@ class ProviderTable extends Component {\n         const { id } = selectedRow;\n         const { providerConfigs } = this.props;\n         let selectedConfig = providerConfigs.find(config => config.id === id);\n-        const { descriptor } = this.state;\n-        if (descriptor) {\n-            descriptor.fields.forEach(field => {\n+        const { descriptors, descriptorName } = this.props\n+        const descriptorList = DescriptorUtilities.findDescriptorByNameAndContext(descriptors, descriptorName, DescriptorUtilities.CONTEXT_TYPE.GLOBAL)\n+        if (descriptorList && descriptorList.length > 0) {\n+            const foundDescriptor = descriptorList[0];", "originalCommit": "b33185de02ede40bf9a52c57f187c41ab2a8605a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDQ4MDg5Mg==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/976#discussion_r424480892", "bodyText": "here", "author": "bamandel", "createdAt": "2020-05-13T14:26:33Z", "path": "src/main/js/providers/ProviderTable.js", "diffHunk": "@@ -59,16 +58,18 @@ class ProviderTable extends Component {\n     }\n \n     combineModelWithDefaults(providerConfig) {\n-        const { descriptor } = this.state;\n-        if (!descriptor) {\n-            return {};\n-        }\n-        const emptyConfig = FieldModelUtilities.createFieldModelWithDefaults(descriptor.fields, DescriptorUtilities.CONTEXT_TYPE.GLOBAL, descriptor.name);\n-        const updatedFieldModel = FieldModelUtilities.combineFieldModels(emptyConfig, providerConfig);\n-        if (providerConfig.id) {\n-            updatedFieldModel.id = providerConfig.id;\n+        const { descriptors, descriptorName } = this.props\n+        const descriptorList = DescriptorUtilities.findDescriptorByNameAndContext(descriptors, descriptorName, DescriptorUtilities.CONTEXT_TYPE.GLOBAL)\n+        if (descriptorList && descriptorList.length > 0) {\n+            const foundDescriptor = descriptorList[0];", "originalCommit": "b33185de02ede40bf9a52c57f187c41ab2a8605a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDQ4MTA4OQ==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/976#discussion_r424481089", "bodyText": "here", "author": "bamandel", "createdAt": "2020-05-13T14:26:48Z", "path": "src/main/js/providers/ProviderTable.js", "diffHunk": "@@ -33,22 +33,21 @@ class ProviderTable extends Component {\n         this.combineModelWithDefaults = this.combineModelWithDefaults.bind(this);\n \n         this.state = {\n-            descriptor: null,\n             providerConfig: {},\n             saveCallback: () => null\n         };\n     }\n \n     componentDidMount() {\n-        const descriptor = this.props.descriptors.find(descriptor => descriptor.name === this.props.descriptorName\n-            && descriptor.context === DescriptorUtilities.CONTEXT_TYPE.GLOBAL)\n-        if (descriptor) {\n-            const emptyConfig = FieldModelUtilities.createFieldModelWithDefaults(descriptor.fields, DescriptorUtilities.CONTEXT_TYPE.GLOBAL, descriptor.name);\n+        const { descriptors, descriptorName } = this.props\n+        const descriptorList = DescriptorUtilities.findDescriptorByNameAndContext(descriptors, descriptorName, DescriptorUtilities.CONTEXT_TYPE.GLOBAL)\n+        if (descriptorList && descriptorList.length > 0) {\n+            const foundDescriptor = descriptorList[0];", "originalCommit": "b33185de02ede40bf9a52c57f187c41ab2a8605a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDQ4MTM2NQ==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/976#discussion_r424481365", "bodyText": "here", "author": "bamandel", "createdAt": "2020-05-13T14:27:09Z", "path": "src/main/js/providers/ProviderTable.js", "diffHunk": "@@ -264,20 +260,25 @@ class ProviderTable extends Component {\n     }\n \n     render() {\n-        const { descriptor } = this.state;\n-        const { providerConfigs, descriptorFetching, configFetching, testInProgress, updateStatus, fieldErrors, errorMessage, actionMessage } = this.props;\n-        const descriptorHeader = descriptor && (\n+        const { providerConfigs, descriptorFetching, configFetching, testInProgress, updateStatus, fieldErrors, errorMessage, actionMessage, descriptors, descriptorName } = this.props;\n+        const descriptorList = DescriptorUtilities.findDescriptorByNameAndContext(descriptors, descriptorName, DescriptorUtilities.CONTEXT_TYPE.GLOBAL)\n+        let foundDescriptor = null;\n+        if (descriptorList && descriptorList.length > 0) {\n+            foundDescriptor = descriptorList[0];", "originalCommit": "b33185de02ede40bf9a52c57f187c41ab2a8605a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDQ4MTgzMQ==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/976#discussion_r424481831", "bodyText": "here", "author": "bamandel", "createdAt": "2020-05-13T14:27:43Z", "path": "src/main/js/dynamic/loaded/certificates/CertificatesPage.js", "diffHunk": "@@ -146,8 +147,17 @@ class CertificatesPage extends Component {\n     }\n \n     render() {\n-        const { fetching, inProgress, certificates, certificateDeleteError, label, description, fieldErrors } = this.props;\n+        const { fetching, inProgress, certificates, certificateDeleteError, label, description, fieldErrors, descriptors } = this.props;\n+        const descriptorList = DescriptorUtilities.findDescriptorByNameAndContext(descriptors, DescriptorUtilities.DESCRIPTOR_NAME.COMPONENT_CERTIFICATES, DescriptorUtilities.CONTEXT_TYPE.GLOBAL)\n+        let foundDescriptor = null;\n+        if (descriptorList && descriptorList.length > 0) {\n+            foundDescriptor = descriptorList[0];", "originalCommit": "b33185de02ede40bf9a52c57f187c41ab2a8605a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "5d65798ff5283a516f43008fcfe6c45dc189b0c2", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/5d65798ff5283a516f43008fcfe6c45dc189b0c2", "message": "Fix: Fixing the config fields for the Descriptor metadata. Refactoring the descriptor lookup in the javascript.", "committedDate": "2020-05-13T17:06:10Z", "type": "commit"}, {"oid": "24a99cb95d4f54b693120cfc064d5d182f39277e", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/24a99cb95d4f54b693120cfc064d5d182f39277e", "message": "Adding javadoc to clarify methods", "committedDate": "2020-05-13T17:09:25Z", "type": "commit"}]}