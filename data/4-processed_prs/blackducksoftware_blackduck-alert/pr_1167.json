{"pr_number": 1167, "pr_title": "UI: Fix Role Permissions Options", "pr_createdAt": "2020-09-15T20:21:34Z", "pr_url": "https://github.com/blackducksoftware/blackduck-alert/pull/1167", "timeline": [{"oid": "7fb60ba546cdf551dd7989b94392996307358bca", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/7fb60ba546cdf551dd7989b94392996307358bca", "message": "Fix(JS): Only display relevant contexts in permissions table", "committedDate": "2020-09-15T19:39:29Z", "type": "commit"}, {"oid": "8a3a47e7065d54637b090170fcb28cdbd38383c7", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/8a3a47e7065d54637b090170fcb28cdbd38383c7", "message": "Fix(JS): Hide upload permissions as options for non-settings descriptors in roles table", "committedDate": "2020-09-15T20:13:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODk1MDU2MQ==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1167#discussion_r488950561", "bodyText": "If the settings permissions happen to be set, unset them if the descriptor isn't 'Settings'.", "author": "gkillough", "createdAt": "2020-09-15T20:22:53Z", "path": "src/main/js/dynamic/loaded/users/PermissionTable.js", "diffHunk": "@@ -47,7 +48,15 @@ class PermissionTable extends Component {\n         const updatedValue = type === 'checkbox' ? checked.toString()\n             .toLowerCase() === 'true' : value;\n         const trimmedValue = (Array.isArray(updatedValue) && updatedValue.length > 0) ? updatedValue[0] : updatedValue;\n-        const newPermissions = Object.assign(permissionsData, { [name]: trimmedValue });\n+\n+        let newPermissions = Object.assign(permissionsData, { [name]: trimmedValue });\n+        if (newPermissions && newPermissions.descriptorName !== 'Settings') {\n+            newPermissions = Object.assign(newPermissions, {\n+                [PERMISSIONS_TABLE.UPLOAD_READ]: undefined,\n+                [PERMISSIONS_TABLE.UPLOAD_WRITE]: undefined,\n+                [PERMISSIONS_TABLE.UPLOAD_DELETE]: undefined\n+            });\n+        }", "originalCommit": "8a3a47e7065d54637b090170fcb28cdbd38383c7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTM4MzUyMQ==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1167#discussion_r489383521", "bodyText": "SAML configuration is in Authentication not Settings.  I think you need to change the keyword from Settings to 'Authentication'", "author": "psantos1113", "createdAt": "2020-09-16T12:04:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODk1MDU2MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTM5NTk0NQ==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1167#discussion_r489395945", "bodyText": "Oof, good catch.", "author": "gkillough", "createdAt": "2020-09-16T12:26:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODk1MDU2MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODk1MTA2Mw==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1167#discussion_r488951063", "bodyText": "If the user changes descriptors, clear the context if it is no longer relevant to the new descriptor.", "author": "gkillough", "createdAt": "2020-09-15T20:23:51Z", "path": "src/main/js/dynamic/loaded/users/PermissionTable.js", "diffHunk": "@@ -147,13 +156,30 @@ class PermissionTable extends Component {\n     }\n \n     createContextOptions() {\n-        return [{\n-            label: CONTEXT_TYPE.DISTRIBUTION,\n-            value: CONTEXT_TYPE.DISTRIBUTION\n-        }, {\n-            label: CONTEXT_TYPE.GLOBAL,\n-            value: CONTEXT_TYPE.GLOBAL\n-        }];\n+        const { permissionsData } = this.state;\n+        const { descriptors } = this.props;\n+\n+        const availableContexts = [];\n+        if (permissionsData && permissionsData.descriptorName) {\n+            descriptors.forEach((descriptor) => {\n+                if (descriptor.label === permissionsData.descriptorName) {\n+                    availableContexts.push(descriptor.context);\n+                }\n+            });\n+\n+            if (permissionsData.context && !availableContexts.includes(permissionsData.context)) {\n+                this.setState({\n+                    permissionsData: {\n+                        descriptorName: permissionsData.descriptorName\n+                    }\n+                });\n+            }\n+        }", "originalCommit": "8a3a47e7065d54637b090170fcb28cdbd38383c7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODk1NjkyNg==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1167#discussion_r488956926", "bodyText": "This import should be absolute not relative", "author": "jamesrichard91", "createdAt": "2020-09-15T20:34:57Z", "path": "src/main/js/dynamic/loaded/users/PermissionTable.js", "diffHunk": "@@ -4,6 +4,7 @@ import TableDisplay from 'field/TableDisplay';\n import DynamicSelectInput from 'field/input/DynamicSelect';\n import CheckboxInput from 'field/input/CheckboxInput';\n import { CONTEXT_TYPE } from 'util/descriptorUtilities';\n+import StatusMessage from '../../../field/StatusMessage';", "originalCommit": "8a3a47e7065d54637b090170fcb28cdbd38383c7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODk2NjIwMg==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1167#discussion_r488966202", "bodyText": "Do our lint settings cover this?", "author": "bamandel", "createdAt": "2020-09-15T20:52:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODk1NjkyNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTM4MjU0MQ==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1167#discussion_r489382541", "bodyText": "The linting thinks that the absolute paths are wrong because it cannot resolve the path from the current location where the file is located.  Currently it does not catch this.", "author": "psantos1113", "createdAt": "2020-09-16T12:02:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODk1NjkyNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTM4NDIwNQ==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1167#discussion_r489384205", "bodyText": "Same as above use 'Authentication' not 'Settings'", "author": "psantos1113", "createdAt": "2020-09-16T12:05:49Z", "path": "src/main/js/dynamic/loaded/users/PermissionTable.js", "diffHunk": "@@ -178,11 +204,44 @@ class PermissionTable extends Component {\n     }\n \n     createPermissionsModal() {\n-        const { permissionsData } = this.state;\n+        const { permissionsData, errorMessage } = this.state;\n+\n+        let uploadInputs;\n+        // Currently, there does not seem to be a good way to filter this dynamically.\n+        // For now, restrict upload permissions to 'Settings'.\n+        if (permissionsData && permissionsData.descriptorName === 'Settings') {", "originalCommit": "8a3a47e7065d54637b090170fcb28cdbd38383c7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "bdeb971bf7091a4a4f78c10556a42155064a7e4c", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/bdeb971bf7091a4a4f78c10556a42155064a7e4c", "message": "Fix(JS): Change upload permission UI restriction to 'Authentication' from 'Settings'", "committedDate": "2020-09-16T12:41:01Z", "type": "commit"}]}