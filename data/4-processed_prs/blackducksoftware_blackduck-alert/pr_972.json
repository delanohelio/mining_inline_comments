{"pr_number": 972, "pr_title": "Mc alertdb tests continued", "pr_createdAt": "2020-05-05T17:45:29Z", "pr_url": "https://github.com/blackducksoftware/blackduck-alert/pull/972", "timeline": [{"oid": "29984950ec4ca47656391416607f229573558bf0", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/29984950ec4ca47656391416607f229573558bf0", "message": "test: Adding tests and mock repository for ProviderTaskProperties", "committedDate": "2020-05-01T18:08:36Z", "type": "commit"}, {"oid": "159c0af84930d73d5c1e45cc8f9fb7131dc54fae", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/159c0af84930d73d5c1e45cc8f9fb7131dc54fae", "message": "tests: Implement a mock JPA repository.", "committedDate": "2020-05-01T18:16:21Z", "type": "commit"}, {"oid": "d4e448762824573d975f5e2c99fd7bbd738aca30", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/d4e448762824573d975f5e2c99fd7bbd738aca30", "message": "test: Implement a default repository class to be extended.", "committedDate": "2020-05-01T18:48:38Z", "type": "commit"}, {"oid": "8d6bbe400149b6d8f5478a36d68fe61db8dfca72", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/8d6bbe400149b6d8f5478a36d68fe61db8dfca72", "message": "test: Increasing test coverage for DefaultProviderTaskPropertiesAccessorTest", "committedDate": "2020-05-04T15:49:03Z", "type": "commit"}, {"oid": "f2df55955f9c6f8c83305b96f61391ef870754b3", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/f2df55955f9c6f8c83305b96f61391ef870754b3", "message": "test: Increasing test coverage for DefaultCustomCertificateAccessor", "committedDate": "2020-05-05T15:44:46Z", "type": "commit"}, {"oid": "8e81e3fcda81b8828582ffc53cc65f3d3c0aaaad", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/8e81e3fcda81b8828582ffc53cc65f3d3c0aaaad", "message": "test: improve repositories to extend DefaultMockJPARepository", "committedDate": "2020-05-05T17:14:23Z", "type": "commit"}, {"oid": "f44f186e7408bada21c9569c35cc7ef31c547ca4", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/f44f186e7408bada21c9569c35cc7ef31c547ca4", "message": "Merge remote-tracking branch 'origin/master' into MC_alertdb_tests_continued", "committedDate": "2020-05-05T17:20:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMwMzc2Mw==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/972#discussion_r420303763", "bodyText": "new Date() will have a different underlying time every time it is called. We should be careful when comparing these.", "author": "gkillough", "createdAt": "2020-05-05T18:02:40Z", "path": "alert-database/src/test/java/com/synopsys/integration/alert/database/api/DefaultCustomCertificateAccessorTest.java", "diffHunk": "@@ -0,0 +1,174 @@\n+package com.synopsys.integration.alert.database.api;\n+\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertFalse;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+import static org.junit.jupiter.api.Assertions.fail;\n+\n+import java.util.Date;\n+import java.util.List;\n+import java.util.Optional;\n+\n+import org.junit.jupiter.api.Test;\n+\n+import com.synopsys.integration.alert.common.exception.AlertDatabaseConstraintException;\n+import com.synopsys.integration.alert.common.persistence.model.CustomCertificateModel;\n+import com.synopsys.integration.alert.database.api.mock.MockCustomCertificateRepository;\n+import com.synopsys.integration.alert.database.certificates.CustomCertificateRepository;\n+\n+public class DefaultCustomCertificateAccessorTest {\n+    private final String alias = \"alias-test\";\n+    private final String content = \"content-test\";\n+\n+    private CustomCertificateModel expectedCustomCertificateModel = new CustomCertificateModel(alias, content, new Date().toString());\n+\n+    @Test\n+    public void getCertificatesTest() {\n+        CustomCertificateRepository customCertificateRepository = new MockCustomCertificateRepository(alias, content, new Date());", "originalCommit": "f44f186e7408bada21c9569c35cc7ef31c547ca4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMxMDgwOQ==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/972#discussion_r420310809", "bodyText": "when I was doing my comparisons I wasn't quite sure how to compare the time stamps so I decided to just compare on the alias and content. Instead, I could create a Date object like I did with alias and content and pass it throughout if you think thats a better alternative", "author": "ChomickiM", "createdAt": "2020-05-05T18:14:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMwMzc2Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMxMDA5OQ==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/972#discussion_r420310099", "bodyText": "If we want to compare the updated times, we should move the Date to its own field. And in the tests we can create a new Date if we want to use a newer time, and use the Date field when they should be the same.", "author": "jamesrichard91", "createdAt": "2020-05-05T18:13:19Z", "path": "alert-database/src/test/java/com/synopsys/integration/alert/database/api/DefaultCustomCertificateAccessorTest.java", "diffHunk": "@@ -0,0 +1,174 @@\n+package com.synopsys.integration.alert.database.api;\n+\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertFalse;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+import static org.junit.jupiter.api.Assertions.fail;\n+\n+import java.util.Date;\n+import java.util.List;\n+import java.util.Optional;\n+\n+import org.junit.jupiter.api.Test;\n+\n+import com.synopsys.integration.alert.common.exception.AlertDatabaseConstraintException;\n+import com.synopsys.integration.alert.common.persistence.model.CustomCertificateModel;\n+import com.synopsys.integration.alert.database.api.mock.MockCustomCertificateRepository;\n+import com.synopsys.integration.alert.database.certificates.CustomCertificateRepository;\n+\n+public class DefaultCustomCertificateAccessorTest {\n+    private final String alias = \"alias-test\";\n+    private final String content = \"content-test\";\n+\n+    private CustomCertificateModel expectedCustomCertificateModel = new CustomCertificateModel(alias, content, new Date().toString());", "originalCommit": "f44f186e7408bada21c9569c35cc7ef31c547ca4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMxMjYxMg==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/972#discussion_r420312612", "bodyText": "This could be an isEmpty check", "author": "bamandel", "createdAt": "2020-05-05T18:17:26Z", "path": "alert-database/src/test/java/com/synopsys/integration/alert/database/api/DefaultCustomCertificateAccessorTest.java", "diffHunk": "@@ -0,0 +1,174 @@\n+package com.synopsys.integration.alert.database.api;\n+\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertFalse;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+import static org.junit.jupiter.api.Assertions.fail;\n+\n+import java.util.Date;\n+import java.util.List;\n+import java.util.Optional;\n+\n+import org.junit.jupiter.api.Test;\n+\n+import com.synopsys.integration.alert.common.exception.AlertDatabaseConstraintException;\n+import com.synopsys.integration.alert.common.persistence.model.CustomCertificateModel;\n+import com.synopsys.integration.alert.database.api.mock.MockCustomCertificateRepository;\n+import com.synopsys.integration.alert.database.certificates.CustomCertificateRepository;\n+\n+public class DefaultCustomCertificateAccessorTest {\n+    private final String alias = \"alias-test\";\n+    private final String content = \"content-test\";\n+\n+    private CustomCertificateModel expectedCustomCertificateModel = new CustomCertificateModel(alias, content, new Date().toString());\n+\n+    @Test\n+    public void getCertificatesTest() {\n+        CustomCertificateRepository customCertificateRepository = new MockCustomCertificateRepository(alias, content, new Date());\n+\n+        DefaultCustomCertificateAccessor customCertificateAccessor = new DefaultCustomCertificateAccessor(customCertificateRepository);\n+        List<CustomCertificateModel> customCertificateModelList = customCertificateAccessor.getCertificates();\n+\n+        assertEquals(1, customCertificateModelList.size());\n+        CustomCertificateModel customCertificateModel = customCertificateModelList.get(0);\n+        testCustomCertificateModel(expectedCustomCertificateModel, customCertificateModel);\n+    }\n+\n+    @Test\n+    public void getCertificateTest() {\n+        CustomCertificateRepository customCertificateRepository = new MockCustomCertificateRepository(alias, content, new Date());\n+\n+        DefaultCustomCertificateAccessor customCertificateAccessor = new DefaultCustomCertificateAccessor(customCertificateRepository);\n+        Optional<CustomCertificateModel> customCertificateModelOptional = customCertificateAccessor.getCertificate(0L);\n+        Optional<CustomCertificateModel> customCertificateModelOptionalEmpty = customCertificateAccessor.getCertificate(9L);\n+\n+        assertTrue(customCertificateModelOptional.isPresent());\n+        assertFalse(customCertificateModelOptionalEmpty.isPresent());\n+        CustomCertificateModel customCertificateModel = customCertificateModelOptional.get();\n+        testCustomCertificateModel(expectedCustomCertificateModel, customCertificateModel);\n+    }\n+\n+    @Test\n+    public void storeCertificateTest() throws Exception {\n+        CustomCertificateModel certificateModel = new CustomCertificateModel(alias, content, new Date().toString());\n+\n+        CustomCertificateRepository customCertificateRepository = new MockCustomCertificateRepository();\n+\n+        DefaultCustomCertificateAccessor customCertificateAccessor = new DefaultCustomCertificateAccessor(customCertificateRepository);\n+        CustomCertificateModel customCertificateModel = customCertificateAccessor.storeCertificate(certificateModel);\n+\n+        testCustomCertificateModel(expectedCustomCertificateModel, customCertificateModel);\n+    }\n+\n+    @Test\n+    public void storeCertificateNullTest() throws Exception {\n+        CustomCertificateRepository customCertificateRepository = new MockCustomCertificateRepository();\n+        DefaultCustomCertificateAccessor customCertificateAccessor = new DefaultCustomCertificateAccessor(customCertificateRepository);\n+        try {\n+            customCertificateAccessor.storeCertificate(null);\n+            fail();\n+        } catch (AlertDatabaseConstraintException e) {\n+        }\n+    }\n+\n+    @Test\n+    public void storeCertificateBlankValuesTest() throws Exception {\n+        CustomCertificateRepository customCertificateRepository = new MockCustomCertificateRepository();\n+        DefaultCustomCertificateAccessor customCertificateAccessor = new DefaultCustomCertificateAccessor(customCertificateRepository);\n+\n+        try {\n+            CustomCertificateModel certificateModel = new CustomCertificateModel(\"\", content, new Date().toString());\n+            customCertificateAccessor.storeCertificate(certificateModel);\n+            fail();\n+        } catch (AlertDatabaseConstraintException e) {\n+        }\n+\n+        try {\n+            CustomCertificateModel certificateModel = new CustomCertificateModel(alias, \"\", new Date().toString());\n+            customCertificateAccessor.storeCertificate(certificateModel);\n+            fail();\n+        } catch (AlertDatabaseConstraintException e) {\n+        }\n+    }\n+\n+    @Test\n+    public void storeCertificateIdDoesNotExistTest() throws Exception {\n+        CustomCertificateRepository customCertificateRepository = new MockCustomCertificateRepository();\n+        DefaultCustomCertificateAccessor customCertificateAccessor = new DefaultCustomCertificateAccessor(customCertificateRepository);\n+\n+        try {\n+            CustomCertificateModel certificateModel = new CustomCertificateModel(9L, alias, content, new Date().toString());\n+            customCertificateAccessor.storeCertificate(certificateModel);\n+            fail();\n+        } catch (AlertDatabaseConstraintException e) {\n+        }\n+    }\n+\n+    @Test\n+    public void deleteCertificateByAliasTest() throws Exception {\n+        CustomCertificateRepository customCertificateRepository = new MockCustomCertificateRepository(alias, content, new Date());\n+        DefaultCustomCertificateAccessor customCertificateAccessor = new DefaultCustomCertificateAccessor(customCertificateRepository);\n+        List<CustomCertificateModel> customCertificateModelList = customCertificateAccessor.getCertificates();\n+\n+        assertEquals(1, customCertificateModelList.size());\n+        CustomCertificateModel customCertificateModel = customCertificateModelList.get(0);\n+        testCustomCertificateModel(expectedCustomCertificateModel, customCertificateModel);\n+\n+        customCertificateAccessor.deleteCertificate(alias);\n+        customCertificateModelList = customCertificateAccessor.getCertificates();\n+\n+        assertEquals(0, customCertificateModelList.size());", "originalCommit": "f44f186e7408bada21c9569c35cc7ef31c547ca4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMxMzc0Mg==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/972#discussion_r420313742", "bodyText": "Could be isEmpty check.", "author": "bamandel", "createdAt": "2020-05-05T18:19:13Z", "path": "alert-database/src/test/java/com/synopsys/integration/alert/database/api/DefaultCustomCertificateAccessorTest.java", "diffHunk": "@@ -0,0 +1,174 @@\n+package com.synopsys.integration.alert.database.api;\n+\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertFalse;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+import static org.junit.jupiter.api.Assertions.fail;\n+\n+import java.util.Date;\n+import java.util.List;\n+import java.util.Optional;\n+\n+import org.junit.jupiter.api.Test;\n+\n+import com.synopsys.integration.alert.common.exception.AlertDatabaseConstraintException;\n+import com.synopsys.integration.alert.common.persistence.model.CustomCertificateModel;\n+import com.synopsys.integration.alert.database.api.mock.MockCustomCertificateRepository;\n+import com.synopsys.integration.alert.database.certificates.CustomCertificateRepository;\n+\n+public class DefaultCustomCertificateAccessorTest {\n+    private final String alias = \"alias-test\";\n+    private final String content = \"content-test\";\n+\n+    private CustomCertificateModel expectedCustomCertificateModel = new CustomCertificateModel(alias, content, new Date().toString());\n+\n+    @Test\n+    public void getCertificatesTest() {\n+        CustomCertificateRepository customCertificateRepository = new MockCustomCertificateRepository(alias, content, new Date());\n+\n+        DefaultCustomCertificateAccessor customCertificateAccessor = new DefaultCustomCertificateAccessor(customCertificateRepository);\n+        List<CustomCertificateModel> customCertificateModelList = customCertificateAccessor.getCertificates();\n+\n+        assertEquals(1, customCertificateModelList.size());\n+        CustomCertificateModel customCertificateModel = customCertificateModelList.get(0);\n+        testCustomCertificateModel(expectedCustomCertificateModel, customCertificateModel);\n+    }\n+\n+    @Test\n+    public void getCertificateTest() {\n+        CustomCertificateRepository customCertificateRepository = new MockCustomCertificateRepository(alias, content, new Date());\n+\n+        DefaultCustomCertificateAccessor customCertificateAccessor = new DefaultCustomCertificateAccessor(customCertificateRepository);\n+        Optional<CustomCertificateModel> customCertificateModelOptional = customCertificateAccessor.getCertificate(0L);\n+        Optional<CustomCertificateModel> customCertificateModelOptionalEmpty = customCertificateAccessor.getCertificate(9L);\n+\n+        assertTrue(customCertificateModelOptional.isPresent());\n+        assertFalse(customCertificateModelOptionalEmpty.isPresent());\n+        CustomCertificateModel customCertificateModel = customCertificateModelOptional.get();\n+        testCustomCertificateModel(expectedCustomCertificateModel, customCertificateModel);\n+    }\n+\n+    @Test\n+    public void storeCertificateTest() throws Exception {\n+        CustomCertificateModel certificateModel = new CustomCertificateModel(alias, content, new Date().toString());\n+\n+        CustomCertificateRepository customCertificateRepository = new MockCustomCertificateRepository();\n+\n+        DefaultCustomCertificateAccessor customCertificateAccessor = new DefaultCustomCertificateAccessor(customCertificateRepository);\n+        CustomCertificateModel customCertificateModel = customCertificateAccessor.storeCertificate(certificateModel);\n+\n+        testCustomCertificateModel(expectedCustomCertificateModel, customCertificateModel);\n+    }\n+\n+    @Test\n+    public void storeCertificateNullTest() throws Exception {\n+        CustomCertificateRepository customCertificateRepository = new MockCustomCertificateRepository();\n+        DefaultCustomCertificateAccessor customCertificateAccessor = new DefaultCustomCertificateAccessor(customCertificateRepository);\n+        try {\n+            customCertificateAccessor.storeCertificate(null);\n+            fail();\n+        } catch (AlertDatabaseConstraintException e) {\n+        }\n+    }\n+\n+    @Test\n+    public void storeCertificateBlankValuesTest() throws Exception {\n+        CustomCertificateRepository customCertificateRepository = new MockCustomCertificateRepository();\n+        DefaultCustomCertificateAccessor customCertificateAccessor = new DefaultCustomCertificateAccessor(customCertificateRepository);\n+\n+        try {\n+            CustomCertificateModel certificateModel = new CustomCertificateModel(\"\", content, new Date().toString());\n+            customCertificateAccessor.storeCertificate(certificateModel);\n+            fail();\n+        } catch (AlertDatabaseConstraintException e) {\n+        }\n+\n+        try {\n+            CustomCertificateModel certificateModel = new CustomCertificateModel(alias, \"\", new Date().toString());\n+            customCertificateAccessor.storeCertificate(certificateModel);\n+            fail();\n+        } catch (AlertDatabaseConstraintException e) {\n+        }\n+    }\n+\n+    @Test\n+    public void storeCertificateIdDoesNotExistTest() throws Exception {\n+        CustomCertificateRepository customCertificateRepository = new MockCustomCertificateRepository();\n+        DefaultCustomCertificateAccessor customCertificateAccessor = new DefaultCustomCertificateAccessor(customCertificateRepository);\n+\n+        try {\n+            CustomCertificateModel certificateModel = new CustomCertificateModel(9L, alias, content, new Date().toString());\n+            customCertificateAccessor.storeCertificate(certificateModel);\n+            fail();\n+        } catch (AlertDatabaseConstraintException e) {\n+        }\n+    }\n+\n+    @Test\n+    public void deleteCertificateByAliasTest() throws Exception {\n+        CustomCertificateRepository customCertificateRepository = new MockCustomCertificateRepository(alias, content, new Date());\n+        DefaultCustomCertificateAccessor customCertificateAccessor = new DefaultCustomCertificateAccessor(customCertificateRepository);\n+        List<CustomCertificateModel> customCertificateModelList = customCertificateAccessor.getCertificates();\n+\n+        assertEquals(1, customCertificateModelList.size());\n+        CustomCertificateModel customCertificateModel = customCertificateModelList.get(0);\n+        testCustomCertificateModel(expectedCustomCertificateModel, customCertificateModel);\n+\n+        customCertificateAccessor.deleteCertificate(alias);\n+        customCertificateModelList = customCertificateAccessor.getCertificates();\n+\n+        assertEquals(0, customCertificateModelList.size());\n+    }\n+\n+    @Test\n+    public void deleteCertificateByAliasBlankTest() throws Exception {\n+        CustomCertificateRepository customCertificateRepository = new MockCustomCertificateRepository(alias, content, new Date());\n+        DefaultCustomCertificateAccessor customCertificateAccessor = new DefaultCustomCertificateAccessor(customCertificateRepository);\n+\n+        try {\n+            customCertificateAccessor.deleteCertificate(\"\");\n+            fail();\n+        } catch (AlertDatabaseConstraintException e) {\n+        }\n+    }\n+\n+    @Test\n+    public void deleteCertificateByIdTest() throws Exception {\n+        CustomCertificateRepository customCertificateRepository = new MockCustomCertificateRepository(alias, content, new Date());\n+        DefaultCustomCertificateAccessor customCertificateAccessor = new DefaultCustomCertificateAccessor(customCertificateRepository);\n+        List<CustomCertificateModel> customCertificateModelList = customCertificateAccessor.getCertificates();\n+\n+        assertEquals(1, customCertificateModelList.size());\n+        CustomCertificateModel customCertificateModel = customCertificateModelList.get(0);\n+        testCustomCertificateModel(expectedCustomCertificateModel, customCertificateModel);\n+\n+        customCertificateAccessor.deleteCertificate(0L);\n+        customCertificateModelList = customCertificateAccessor.getCertificates();\n+\n+        assertEquals(0, customCertificateModelList.size());", "originalCommit": "f44f186e7408bada21c9569c35cc7ef31c547ca4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMxNTQwOQ==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/972#discussion_r420315409", "bodyText": "These lines may not be necessary if you made the class abstract. Having the keyword there would others realize that the class should be extended.", "author": "bamandel", "createdAt": "2020-05-05T18:22:02Z", "path": "alert-database/src/test/java/com/synopsys/integration/alert/database/api/mock/DefaultMockJPARepository.java", "diffHunk": "@@ -0,0 +1,140 @@\n+package com.synopsys.integration.alert.database.api.mock;\n+\n+import java.util.List;\n+import java.util.Optional;\n+\n+import org.springframework.data.domain.Example;\n+import org.springframework.data.domain.Page;\n+import org.springframework.data.domain.Pageable;\n+import org.springframework.data.domain.Sort;\n+import org.springframework.data.jpa.repository.JpaRepository;\n+\n+public class DefaultMockJPARepository<T, ID> implements JpaRepository<T,ID> {\n+    // Empty implementation of a JPA repository to be extended by other mock repositories.\n+    // The child classes that extend this can then override the methods they need to\n+    // provide the correct testing functionality needed.", "originalCommit": "f44f186e7408bada21c9569c35cc7ef31c547ca4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMxNjY1MQ==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/972#discussion_r420316651", "bodyText": "Can you add a comment in the exception block or an assertion that the exception is not null? That way other people can see that we expect that exception and it wasn't a mistake.", "author": "jamesrichard91", "createdAt": "2020-05-05T18:24:12Z", "path": "alert-database/src/test/java/com/synopsys/integration/alert/database/api/DefaultCustomCertificateAccessorTest.java", "diffHunk": "@@ -0,0 +1,174 @@\n+package com.synopsys.integration.alert.database.api;\n+\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertFalse;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+import static org.junit.jupiter.api.Assertions.fail;\n+\n+import java.util.Date;\n+import java.util.List;\n+import java.util.Optional;\n+\n+import org.junit.jupiter.api.Test;\n+\n+import com.synopsys.integration.alert.common.exception.AlertDatabaseConstraintException;\n+import com.synopsys.integration.alert.common.persistence.model.CustomCertificateModel;\n+import com.synopsys.integration.alert.database.api.mock.MockCustomCertificateRepository;\n+import com.synopsys.integration.alert.database.certificates.CustomCertificateRepository;\n+\n+public class DefaultCustomCertificateAccessorTest {\n+    private final String alias = \"alias-test\";\n+    private final String content = \"content-test\";\n+\n+    private CustomCertificateModel expectedCustomCertificateModel = new CustomCertificateModel(alias, content, new Date().toString());\n+\n+    @Test\n+    public void getCertificatesTest() {\n+        CustomCertificateRepository customCertificateRepository = new MockCustomCertificateRepository(alias, content, new Date());\n+\n+        DefaultCustomCertificateAccessor customCertificateAccessor = new DefaultCustomCertificateAccessor(customCertificateRepository);\n+        List<CustomCertificateModel> customCertificateModelList = customCertificateAccessor.getCertificates();\n+\n+        assertEquals(1, customCertificateModelList.size());\n+        CustomCertificateModel customCertificateModel = customCertificateModelList.get(0);\n+        testCustomCertificateModel(expectedCustomCertificateModel, customCertificateModel);\n+    }\n+\n+    @Test\n+    public void getCertificateTest() {\n+        CustomCertificateRepository customCertificateRepository = new MockCustomCertificateRepository(alias, content, new Date());\n+\n+        DefaultCustomCertificateAccessor customCertificateAccessor = new DefaultCustomCertificateAccessor(customCertificateRepository);\n+        Optional<CustomCertificateModel> customCertificateModelOptional = customCertificateAccessor.getCertificate(0L);\n+        Optional<CustomCertificateModel> customCertificateModelOptionalEmpty = customCertificateAccessor.getCertificate(9L);\n+\n+        assertTrue(customCertificateModelOptional.isPresent());\n+        assertFalse(customCertificateModelOptionalEmpty.isPresent());\n+        CustomCertificateModel customCertificateModel = customCertificateModelOptional.get();\n+        testCustomCertificateModel(expectedCustomCertificateModel, customCertificateModel);\n+    }\n+\n+    @Test\n+    public void storeCertificateTest() throws Exception {\n+        CustomCertificateModel certificateModel = new CustomCertificateModel(alias, content, new Date().toString());\n+\n+        CustomCertificateRepository customCertificateRepository = new MockCustomCertificateRepository();\n+\n+        DefaultCustomCertificateAccessor customCertificateAccessor = new DefaultCustomCertificateAccessor(customCertificateRepository);\n+        CustomCertificateModel customCertificateModel = customCertificateAccessor.storeCertificate(certificateModel);\n+\n+        testCustomCertificateModel(expectedCustomCertificateModel, customCertificateModel);\n+    }\n+\n+    @Test\n+    public void storeCertificateNullTest() throws Exception {\n+        CustomCertificateRepository customCertificateRepository = new MockCustomCertificateRepository();\n+        DefaultCustomCertificateAccessor customCertificateAccessor = new DefaultCustomCertificateAccessor(customCertificateRepository);\n+        try {\n+            customCertificateAccessor.storeCertificate(null);\n+            fail();\n+        } catch (AlertDatabaseConstraintException e) {\n+        }\n+    }\n+\n+    @Test\n+    public void storeCertificateBlankValuesTest() throws Exception {\n+        CustomCertificateRepository customCertificateRepository = new MockCustomCertificateRepository();\n+        DefaultCustomCertificateAccessor customCertificateAccessor = new DefaultCustomCertificateAccessor(customCertificateRepository);\n+\n+        try {\n+            CustomCertificateModel certificateModel = new CustomCertificateModel(\"\", content, new Date().toString());\n+            customCertificateAccessor.storeCertificate(certificateModel);\n+            fail();\n+        } catch (AlertDatabaseConstraintException e) {\n+        }\n+\n+        try {\n+            CustomCertificateModel certificateModel = new CustomCertificateModel(alias, \"\", new Date().toString());\n+            customCertificateAccessor.storeCertificate(certificateModel);\n+            fail();\n+        } catch (AlertDatabaseConstraintException e) {\n+        }\n+    }\n+\n+    @Test\n+    public void storeCertificateIdDoesNotExistTest() throws Exception {\n+        CustomCertificateRepository customCertificateRepository = new MockCustomCertificateRepository();\n+        DefaultCustomCertificateAccessor customCertificateAccessor = new DefaultCustomCertificateAccessor(customCertificateRepository);\n+\n+        try {\n+            CustomCertificateModel certificateModel = new CustomCertificateModel(9L, alias, content, new Date().toString());\n+            customCertificateAccessor.storeCertificate(certificateModel);\n+            fail();\n+        } catch (AlertDatabaseConstraintException e) {\n+        }", "originalCommit": "f44f186e7408bada21c9569c35cc7ef31c547ca4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMxNjkzMA==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/972#discussion_r420316930", "bodyText": "Same as above.", "author": "jamesrichard91", "createdAt": "2020-05-05T18:24:39Z", "path": "alert-database/src/test/java/com/synopsys/integration/alert/database/api/DefaultCustomCertificateAccessorTest.java", "diffHunk": "@@ -0,0 +1,174 @@\n+package com.synopsys.integration.alert.database.api;\n+\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertFalse;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+import static org.junit.jupiter.api.Assertions.fail;\n+\n+import java.util.Date;\n+import java.util.List;\n+import java.util.Optional;\n+\n+import org.junit.jupiter.api.Test;\n+\n+import com.synopsys.integration.alert.common.exception.AlertDatabaseConstraintException;\n+import com.synopsys.integration.alert.common.persistence.model.CustomCertificateModel;\n+import com.synopsys.integration.alert.database.api.mock.MockCustomCertificateRepository;\n+import com.synopsys.integration.alert.database.certificates.CustomCertificateRepository;\n+\n+public class DefaultCustomCertificateAccessorTest {\n+    private final String alias = \"alias-test\";\n+    private final String content = \"content-test\";\n+\n+    private CustomCertificateModel expectedCustomCertificateModel = new CustomCertificateModel(alias, content, new Date().toString());\n+\n+    @Test\n+    public void getCertificatesTest() {\n+        CustomCertificateRepository customCertificateRepository = new MockCustomCertificateRepository(alias, content, new Date());\n+\n+        DefaultCustomCertificateAccessor customCertificateAccessor = new DefaultCustomCertificateAccessor(customCertificateRepository);\n+        List<CustomCertificateModel> customCertificateModelList = customCertificateAccessor.getCertificates();\n+\n+        assertEquals(1, customCertificateModelList.size());\n+        CustomCertificateModel customCertificateModel = customCertificateModelList.get(0);\n+        testCustomCertificateModel(expectedCustomCertificateModel, customCertificateModel);\n+    }\n+\n+    @Test\n+    public void getCertificateTest() {\n+        CustomCertificateRepository customCertificateRepository = new MockCustomCertificateRepository(alias, content, new Date());\n+\n+        DefaultCustomCertificateAccessor customCertificateAccessor = new DefaultCustomCertificateAccessor(customCertificateRepository);\n+        Optional<CustomCertificateModel> customCertificateModelOptional = customCertificateAccessor.getCertificate(0L);\n+        Optional<CustomCertificateModel> customCertificateModelOptionalEmpty = customCertificateAccessor.getCertificate(9L);\n+\n+        assertTrue(customCertificateModelOptional.isPresent());\n+        assertFalse(customCertificateModelOptionalEmpty.isPresent());\n+        CustomCertificateModel customCertificateModel = customCertificateModelOptional.get();\n+        testCustomCertificateModel(expectedCustomCertificateModel, customCertificateModel);\n+    }\n+\n+    @Test\n+    public void storeCertificateTest() throws Exception {\n+        CustomCertificateModel certificateModel = new CustomCertificateModel(alias, content, new Date().toString());\n+\n+        CustomCertificateRepository customCertificateRepository = new MockCustomCertificateRepository();\n+\n+        DefaultCustomCertificateAccessor customCertificateAccessor = new DefaultCustomCertificateAccessor(customCertificateRepository);\n+        CustomCertificateModel customCertificateModel = customCertificateAccessor.storeCertificate(certificateModel);\n+\n+        testCustomCertificateModel(expectedCustomCertificateModel, customCertificateModel);\n+    }\n+\n+    @Test\n+    public void storeCertificateNullTest() throws Exception {\n+        CustomCertificateRepository customCertificateRepository = new MockCustomCertificateRepository();\n+        DefaultCustomCertificateAccessor customCertificateAccessor = new DefaultCustomCertificateAccessor(customCertificateRepository);\n+        try {\n+            customCertificateAccessor.storeCertificate(null);\n+            fail();\n+        } catch (AlertDatabaseConstraintException e) {\n+        }\n+    }\n+\n+    @Test\n+    public void storeCertificateBlankValuesTest() throws Exception {\n+        CustomCertificateRepository customCertificateRepository = new MockCustomCertificateRepository();\n+        DefaultCustomCertificateAccessor customCertificateAccessor = new DefaultCustomCertificateAccessor(customCertificateRepository);\n+\n+        try {\n+            CustomCertificateModel certificateModel = new CustomCertificateModel(\"\", content, new Date().toString());\n+            customCertificateAccessor.storeCertificate(certificateModel);\n+            fail();\n+        } catch (AlertDatabaseConstraintException e) {\n+        }\n+\n+        try {\n+            CustomCertificateModel certificateModel = new CustomCertificateModel(alias, \"\", new Date().toString());\n+            customCertificateAccessor.storeCertificate(certificateModel);\n+            fail();\n+        } catch (AlertDatabaseConstraintException e) {\n+        }\n+    }\n+\n+    @Test\n+    public void storeCertificateIdDoesNotExistTest() throws Exception {\n+        CustomCertificateRepository customCertificateRepository = new MockCustomCertificateRepository();\n+        DefaultCustomCertificateAccessor customCertificateAccessor = new DefaultCustomCertificateAccessor(customCertificateRepository);\n+\n+        try {\n+            CustomCertificateModel certificateModel = new CustomCertificateModel(9L, alias, content, new Date().toString());\n+            customCertificateAccessor.storeCertificate(certificateModel);\n+            fail();\n+        } catch (AlertDatabaseConstraintException e) {\n+        }\n+    }\n+\n+    @Test\n+    public void deleteCertificateByAliasTest() throws Exception {\n+        CustomCertificateRepository customCertificateRepository = new MockCustomCertificateRepository(alias, content, new Date());\n+        DefaultCustomCertificateAccessor customCertificateAccessor = new DefaultCustomCertificateAccessor(customCertificateRepository);\n+        List<CustomCertificateModel> customCertificateModelList = customCertificateAccessor.getCertificates();\n+\n+        assertEquals(1, customCertificateModelList.size());\n+        CustomCertificateModel customCertificateModel = customCertificateModelList.get(0);\n+        testCustomCertificateModel(expectedCustomCertificateModel, customCertificateModel);\n+\n+        customCertificateAccessor.deleteCertificate(alias);\n+        customCertificateModelList = customCertificateAccessor.getCertificates();\n+\n+        assertEquals(0, customCertificateModelList.size());\n+    }\n+\n+    @Test\n+    public void deleteCertificateByAliasBlankTest() throws Exception {\n+        CustomCertificateRepository customCertificateRepository = new MockCustomCertificateRepository(alias, content, new Date());\n+        DefaultCustomCertificateAccessor customCertificateAccessor = new DefaultCustomCertificateAccessor(customCertificateRepository);\n+\n+        try {\n+            customCertificateAccessor.deleteCertificate(\"\");\n+            fail();\n+        } catch (AlertDatabaseConstraintException e) {\n+        }", "originalCommit": "f44f186e7408bada21c9569c35cc7ef31c547ca4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMxNzA2MA==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/972#discussion_r420317060", "bodyText": "Generally, this sort of explanation would go above the class declaration.", "author": "bamandel", "createdAt": "2020-05-05T18:24:54Z", "path": "alert-database/src/test/java/com/synopsys/integration/alert/database/api/mock/DefaultMockJPARepository.java", "diffHunk": "@@ -0,0 +1,140 @@\n+package com.synopsys.integration.alert.database.api.mock;\n+\n+import java.util.List;\n+import java.util.Optional;\n+\n+import org.springframework.data.domain.Example;\n+import org.springframework.data.domain.Page;\n+import org.springframework.data.domain.Pageable;\n+import org.springframework.data.domain.Sort;\n+import org.springframework.data.jpa.repository.JpaRepository;\n+\n+public class DefaultMockJPARepository<T, ID> implements JpaRepository<T,ID> {\n+    // Empty implementation of a JPA repository to be extended by other mock repositories.\n+    // The child classes that extend this can then override the methods they need to\n+    // provide the correct testing functionality needed.\n+    // To use the class correctly have a child class extend this class and also implement the JPA Repository\n+    // interface to be tested.\n+    //\n+    // For example creating a mock for SystemStatusRepository\n+    // class MockSystemStatusRepository extends DefaultMockJPARepository<SystemStatus, Long> implements SystemStatusRepository", "originalCommit": "f44f186e7408bada21c9569c35cc7ef31c547ca4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMxNzc4NA==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/972#discussion_r420317784", "bodyText": "You could replace these 3 lines by calling the save method.", "author": "jamesrichard91", "createdAt": "2020-05-05T18:26:11Z", "path": "alert-database/src/test/java/com/synopsys/integration/alert/database/api/mock/MockCustomCertificateRepository.java", "diffHunk": "@@ -0,0 +1,65 @@\n+package com.synopsys.integration.alert.database.api.mock;\n+\n+import java.util.ArrayList;\n+import java.util.Date;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Optional;\n+\n+import com.synopsys.integration.alert.database.certificates.CustomCertificateEntity;\n+import com.synopsys.integration.alert.database.certificates.CustomCertificateRepository;\n+\n+public class MockCustomCertificateRepository extends DefaultMockJPARepository<CustomCertificateEntity, Long> implements CustomCertificateRepository {\n+\n+    private Map<Long, CustomCertificateEntity> customCertificateEntityMapById = new HashMap<>();\n+\n+    private long currentId = 0;\n+\n+    public MockCustomCertificateRepository() {\n+\n+    }\n+\n+    public MockCustomCertificateRepository(String alias, String content, Date lastUpdated) {\n+        CustomCertificateEntity customCertificateEntity = new CustomCertificateEntity(alias, content, lastUpdated);\n+        customCertificateEntity.setId(currentId);\n+        customCertificateEntityMapById.put(currentId, customCertificateEntity);\n+        currentId++;", "originalCommit": "f44f186e7408bada21c9569c35cc7ef31c547ca4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMyMDM0OQ==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/972#discussion_r420320349", "bodyText": "Should add something in the exception block.", "author": "jamesrichard91", "createdAt": "2020-05-05T18:30:12Z", "path": "alert-database/src/test/java/com/synopsys/integration/alert/database/api/DefaultProviderTaskPropertiesAccessorTest.java", "diffHunk": "@@ -0,0 +1,74 @@\n+package com.synopsys.integration.alert.database.api;\n+\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertFalse;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+import static org.junit.jupiter.api.Assertions.fail;\n+\n+import java.util.Optional;\n+\n+import org.junit.jupiter.api.Test;\n+\n+import com.synopsys.integration.alert.common.exception.AlertDatabaseConstraintException;\n+import com.synopsys.integration.alert.database.api.mock.MockProviderTaskPropertiesRepository;\n+import com.synopsys.integration.alert.database.provider.task.ProviderTaskPropertiesEntity;\n+import com.synopsys.integration.alert.database.provider.task.ProviderTaskPropertiesRepository;\n+\n+public class DefaultProviderTaskPropertiesAccessorTest {\n+    private final Long providerConfigId = 1L;\n+    private final String taskName = \"taskName-test\";\n+    private final String propertyName = \"propertyName-test\";\n+    private final String value = \"value-test\";\n+\n+    private ProviderTaskPropertiesRepository providerTaskPropertiesRepository = new MockProviderTaskPropertiesRepository(providerConfigId, taskName, propertyName, value);\n+\n+    @Test\n+    public void getTaskPropertyTest() {\n+        DefaultProviderTaskPropertiesAccessor providerTaskPropertiesAccessor = new DefaultProviderTaskPropertiesAccessor(providerTaskPropertiesRepository);\n+        Optional<String> taskPropertyValue = providerTaskPropertiesAccessor.getTaskProperty(taskName, propertyName);\n+\n+        assertTrue(taskPropertyValue.isPresent());\n+        assertEquals(value, taskPropertyValue.get());\n+    }\n+\n+    @Test\n+    public void getTaskPropertyEmptyTest() {\n+        DefaultProviderTaskPropertiesAccessor providerTaskPropertiesAccessor = new DefaultProviderTaskPropertiesAccessor(providerTaskPropertiesRepository);\n+        Optional<String> taskPropertyOptionalEmpty = providerTaskPropertiesAccessor.getTaskProperty(\"invalidTaskName\", \"invalidPropertyKey\");\n+        Optional<String> taskPropertyValueEmpty = providerTaskPropertiesAccessor.getTaskProperty(\"\", \"\");\n+\n+        assertFalse(taskPropertyOptionalEmpty.isPresent());\n+        assertFalse(taskPropertyValueEmpty.isPresent());\n+    }\n+\n+    @Test\n+    public void setTaskPropertyTest() throws Exception {\n+        final Long newConfigId = 2L;\n+        final String newTaskName = \"taskName-new\";\n+        final String newPropertyName = \"propertyName-new\";\n+        final String newValue = \"value-new\";\n+\n+        DefaultProviderTaskPropertiesAccessor providerTaskPropertiesAccessor = new DefaultProviderTaskPropertiesAccessor(providerTaskPropertiesRepository);\n+        providerTaskPropertiesAccessor.setTaskProperty(newConfigId, newTaskName, newPropertyName, newValue);\n+\n+        Optional<ProviderTaskPropertiesEntity> providerTaskPropertiesEntityOptional = providerTaskPropertiesRepository.findByTaskNameAndPropertyName(newTaskName, newPropertyName);\n+\n+        assertTrue(providerTaskPropertiesEntityOptional.isPresent());\n+        ProviderTaskPropertiesEntity providerTaskPropertiesEntity = providerTaskPropertiesEntityOptional.get();\n+        assertEquals(newConfigId, providerTaskPropertiesEntity.getProviderConfigId());\n+        assertEquals(newTaskName, providerTaskPropertiesEntity.getTaskName());\n+        assertEquals(newPropertyName, providerTaskPropertiesEntity.getPropertyName());\n+        assertEquals(newValue, providerTaskPropertiesEntity.getValue());\n+    }\n+\n+    @Test\n+    public void setTaskPropertyExceptionTest() throws Exception {\n+        DefaultProviderTaskPropertiesAccessor providerTaskPropertiesAccessor = new DefaultProviderTaskPropertiesAccessor(providerTaskPropertiesRepository);\n+\n+        try {\n+            providerTaskPropertiesAccessor.setTaskProperty(null, \"\", \"\", \"\");\n+            fail();\n+        } catch (AlertDatabaseConstraintException e) {\n+        }", "originalCommit": "f44f186e7408bada21c9569c35cc7ef31c547ca4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMyMTIyNg==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/972#discussion_r420321226", "bodyText": "Should call the save method here, in case we need to add additional behavior for saving entities in this Mock class in the future.", "author": "jamesrichard91", "createdAt": "2020-05-05T18:31:38Z", "path": "alert-database/src/test/java/com/synopsys/integration/alert/database/api/mock/MockProviderTaskPropertiesRepository.java", "diffHunk": "@@ -0,0 +1,32 @@\n+package com.synopsys.integration.alert.database.api.mock;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.Optional;\n+\n+import com.synopsys.integration.alert.database.provider.task.ProviderTaskPropertiesEntity;\n+import com.synopsys.integration.alert.database.provider.task.ProviderTaskPropertiesRepository;\n+\n+public class MockProviderTaskPropertiesRepository extends DefaultMockJPARepository<ProviderTaskPropertiesEntity, Long> implements ProviderTaskPropertiesRepository {\n+\n+    private Map<Long, ProviderTaskPropertiesEntity> providerTaskPropertiesEntityMap = new HashMap<>();\n+\n+    public MockProviderTaskPropertiesRepository(Long providerConfigId, String taskName, String propertyName, String value) {\n+        ProviderTaskPropertiesEntity providerTaskPropertiesEntity = new ProviderTaskPropertiesEntity(providerConfigId, taskName, propertyName, value);\n+        providerTaskPropertiesEntityMap.put(providerConfigId, providerTaskPropertiesEntity);", "originalCommit": "f44f186e7408bada21c9569c35cc7ef31c547ca4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "3b271f75764f1d4c3ac037474b16d44596d8c2e7", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/3b271f75764f1d4c3ac037474b16d44596d8c2e7", "message": "test: Updating tests based on PR feedback", "committedDate": "2020-05-05T19:37:39Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDc2OTA3MA==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/972#discussion_r420769070", "bodyText": "Why are we using the DateUtils above and the .toString() method here? We should be more consistent and choose one of these approaches.", "author": "jamesrichard91", "createdAt": "2020-05-06T12:58:19Z", "path": "alert-database/src/test/java/com/synopsys/integration/alert/database/api/DefaultCustomCertificateAccessorTest.java", "diffHunk": "@@ -50,7 +53,7 @@ public void getCertificateTest() {\n \n     @Test\n     public void storeCertificateTest() throws Exception {\n-        CustomCertificateModel certificateModel = new CustomCertificateModel(alias, content, new Date().toString());\n+        CustomCertificateModel certificateModel = new CustomCertificateModel(alias, content, testDate.toString());", "originalCommit": "3b271f75764f1d4c3ac037474b16d44596d8c2e7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}