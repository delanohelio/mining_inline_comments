{"pr_number": 1224, "pr_title": "Performance/End to End tests", "pr_createdAt": "2020-10-14T15:52:20Z", "pr_url": "https://github.com/blackducksoftware/blackduck-alert/pull/1224", "timeline": [{"oid": "d540234e961ee6cfa314af33001d919d2aa1458a", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/d540234e961ee6cfa314af33001d919d2aa1458a", "message": "Adding the beginning of a new end to end test", "committedDate": "2020-10-05T22:30:04Z", "type": "commit"}, {"oid": "33a3ff2a27536789cc2265a16d4f00689930ce98", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/33a3ff2a27536789cc2265a16d4f00689930ce98", "message": "Ignoring the new test for now, so it isn't run by default.", "committedDate": "2020-10-05T22:30:46Z", "type": "commit"}, {"oid": "c90355e2e577cd54c1aff2142a36bbdd5659692d", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/c90355e2e577cd54c1aff2142a36bbdd5659692d", "message": "Refactor(test): Renaming the test, renaming the test method, refactoring the private test methods", "committedDate": "2020-10-06T16:41:12Z", "type": "commit"}, {"oid": "f4d31d8b066b14d95165abe2e58968e18ef7d545", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/f4d31d8b066b14d95165abe2e58968e18ef7d545", "message": "Adding logs for timing, adding Slack Job creation.", "committedDate": "2020-10-06T19:56:43Z", "type": "commit"}, {"oid": "630af3bad5e746095421e1548fe48f27056fbbb4", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/630af3bad5e746095421e1548fe48f27056fbbb4", "message": "Java (Test): adding comments to explain the test, adding TODO's for work to be done, adding code to trigger BD notification, adding code to find the Black Duck provider if it already exists.", "committedDate": "2020-10-06T22:46:59Z", "type": "commit"}, {"oid": "7796c70a05e915d2ea40d28bf07579bde553e984", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/7796c70a05e915d2ea40d28bf07579bde553e984", "message": "Merge branch 'master' into jr_external_tests", "committedDate": "2020-10-07T13:58:36Z", "type": "commit"}, {"oid": "e5ed1818b1174344b2269b17a17cd5b478087719", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/e5ed1818b1174344b2269b17a17cd5b478087719", "message": "Java(Test): Renaming the performance test, moving the test into a performance package, adding the AlertRequestUtility, adding the NotificationWaitJobTask to wait for the notification to be triggered and for it to be processed by the jobs.", "committedDate": "2020-10-07T16:49:01Z", "type": "commit"}, {"oid": "2f8f55923073565737683780af32d2de97d15b57", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/2f8f55923073565737683780af32d2de97d15b57", "message": "Merge branch 'master' into jr_external_tests", "committedDate": "2020-10-07T19:57:09Z", "type": "commit"}, {"oid": "d138da181021d63dc37579c4eb19bb4ab80dd0f2", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/d138da181021d63dc37579c4eb19bb4ab80dd0f2", "message": "Working on adding base classes for the performance tests. Attempting to get the tests working using spring boot tests rather than running an external Alert server.", "committedDate": "2020-10-07T22:11:59Z", "type": "commit"}, {"oid": "b09919e9662a041915379af8dd8e3775ab84569e", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/b09919e9662a041915379af8dd8e3775ab84569e", "message": "Merge branch 'master' into jr_external_tests", "committedDate": "2020-10-08T18:33:51Z", "type": "commit"}, {"oid": "af2e8a14804e411f18df362a61d710904b35f564", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/af2e8a14804e411f18df362a61d710904b35f564", "message": "Splitting up the tests between external Alert tests and Integration tests", "committedDate": "2020-10-08T19:22:16Z", "type": "commit"}, {"oid": "4a55e561600d6cb208b52c85b4be95876b8ceff0", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/4a55e561600d6cb208b52c85b4be95876b8ceff0", "message": "Removing the repository objects", "committedDate": "2020-10-08T19:41:37Z", "type": "commit"}, {"oid": "21022ad87a4b6aeb0f729501be93f9da8d7a0da5", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/21022ad87a4b6aeb0f729501be93f9da8d7a0da5", "message": "Merge branch 'master' into jr_external_tests", "committedDate": "2020-10-08T19:42:27Z", "type": "commit"}, {"oid": "b8f186de7f8798c89f7a14d42652bde1c32bfecc", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/b8f186de7f8798c89f7a14d42652bde1c32bfecc", "message": "Merge branch 'master' into jr_external_tests", "committedDate": "2020-10-12T13:50:17Z", "type": "commit"}, {"oid": "7048dbc75e89738384158c01ff9dcda98580ce4d", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/7048dbc75e89738384158c01ff9dcda98580ce4d", "message": "Chore(Build/Test): Update runServer task to use testcontainers-spring-boot", "committedDate": "2020-10-13T19:00:43Z", "type": "commit"}, {"oid": "c1e83afa3a20a1d631c0c2a32e2a7d37276974ea", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/c1e83afa3a20a1d631c0c2a32e2a7d37276974ea", "message": "Fix(Build/Test): Remove superfluous code for runServer", "committedDate": "2020-10-13T19:21:22Z", "type": "commit"}, {"oid": "2f1afd1fab6fe91f8eb3c97185f43daa72916461", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/2f1afd1fab6fe91f8eb3c97185f43daa72916461", "message": "Merge branch 'jr_external_tests_runServer' into jr_external_tests", "committedDate": "2020-10-13T19:21:47Z", "type": "commit"}, {"oid": "3b101a1610c1c983b418ac6df8f12b295d29fc34", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/3b101a1610c1c983b418ac6df8f12b295d29fc34", "message": "Updating postgres version for integration test. Fixing IntegrationPerformanceTest", "committedDate": "2020-10-14T15:33:15Z", "type": "commit"}, {"oid": "5af3dc143424c60b1f02dc24c376c3e00f74c521", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/5af3dc143424c60b1f02dc24c376c3e00f74c521", "message": "Merge branch 'master' into jr_external_tests", "committedDate": "2020-10-14T15:34:26Z", "type": "commit"}, {"oid": "c0beb414968c59f5409de350742c1422a1377bfd", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/c0beb414968c59f5409de350742c1422a1377bfd", "message": "Merge branch 'master' into jr_external_tests", "committedDate": "2020-10-14T15:55:40Z", "type": "commit"}, {"oid": "f7cc909334db82c3276f9560d54f91198748513a", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/f7cc909334db82c3276f9560d54f91198748513a", "message": "Updating the test properties", "committedDate": "2020-10-14T15:56:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTUxNDU0MQ==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1224#discussion_r505514541", "bodyText": "What benefit does this container have over the original?   There isn't anything wrong with using this new container I just would like some more context for switching.  Is the fact that it's an embedded container more appropriate for Spring Boot applications?", "author": "psantos1113", "createdAt": "2020-10-15T12:50:41Z", "path": "build.gradle", "diffHunk": "@@ -104,7 +104,9 @@ dependencies {\n     // =============\n     testImplementation 'org.testcontainers:postgresql:1.12.5'\n     if (getGradle().getStartParameter().taskNames.contains('runServer')) {\n-        runtimeClasspath 'org.testcontainers:postgresql:1.12.5'\n+        runtimeClasspath 'org.springframework.cloud:spring-cloud-starter:2.2.3.RELEASE'\n+        runtimeClasspath \"com.playtika.testcontainers:embedded-postgresql:1.78\"", "originalCommit": "f7cc909334db82c3276f9560d54f91198748513a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjQ2MDY1MA==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1224#discussion_r506460650", "bodyText": "This dependency is linked to from the official Test Containers GitHub as being the appropriate choice for Spring Boot applications. It gives us benefits like bootstrap properties for configuration rather than query parameters on the JDBC URL.", "author": "gkillough", "createdAt": "2020-10-16T14:04:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTUxNDU0MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTUyMjMzMQ==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1224#discussion_r505522331", "bodyText": "If you don't envision running these performance tests against older versions then can we remove this comment?\nOtherwise if you want to support older and newer versions of Alert, can you create a request to get the alert version from the about info?  Based on the alert version create the corresponding login JSON payload.  I would consider that an enhancement to be able to create the login payload based on the version.  Not something to hold up this PR right now.", "author": "psantos1113", "createdAt": "2020-10-15T13:01:54Z", "path": "src/test/java/com/synopsys/integration/alert/performance/utility/ExternalAlertRequestUtility.java", "diffHunk": "@@ -0,0 +1,82 @@\n+package com.synopsys.integration.alert.performance.utility;\n+\n+import com.synopsys.integration.exception.IntegrationException;\n+import com.synopsys.integration.log.IntLogger;\n+import com.synopsys.integration.rest.HttpMethod;\n+import com.synopsys.integration.rest.HttpUrl;\n+import com.synopsys.integration.rest.body.BodyContent;\n+import com.synopsys.integration.rest.body.StringBodyContent;\n+import com.synopsys.integration.rest.client.IntHttpClient;\n+import com.synopsys.integration.rest.request.Request;\n+import com.synopsys.integration.rest.response.Response;\n+\n+public class ExternalAlertRequestUtility implements AlertRequestUtility {\n+    private final IntLogger intLogger;\n+    private final IntHttpClient client;\n+    private final String alertURL;\n+\n+    public ExternalAlertRequestUtility(IntLogger intLogger, IntHttpClient client, String alertURL) {\n+        this.intLogger = intLogger;\n+        this.client = client;\n+        this.alertURL = alertURL;\n+    }\n+\n+    public void loginToExternalAlert() throws IntegrationException {\n+        //String loginBody = \"{\\\"blackDuckUsername\\\":\\\"sysadmin\\\",\\\"blackDuckPassword\\\":\\\"blackduck\\\"}\";", "originalCommit": "f7cc909334db82c3276f9560d54f91198748513a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTUyNjY2OQ==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1224#discussion_r505526669", "bodyText": "Use the constants for the names of the fields that are put into the map from these classes:\n\nProviderDescriptor\nProviderDistributionUIConfig\nChannelDistributionUIConfig\nSlackDescriptor", "author": "psantos1113", "createdAt": "2020-10-15T13:08:16Z", "path": "src/test/java/com/synopsys/integration/alert/performance/SlackPerformanceTest.java", "diffHunk": "@@ -0,0 +1,96 @@\n+package com.synopsys.integration.alert.performance;\n+\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+\n+import java.time.LocalDateTime;\n+import java.time.ZoneId;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Set;\n+\n+import org.junit.Ignore;\n+import org.junit.jupiter.api.Test;\n+\n+import com.google.gson.JsonObject;\n+import com.synopsys.integration.alert.common.enumeration.ConfigContextEnum;\n+import com.synopsys.integration.alert.common.enumeration.FrequencyType;\n+import com.synopsys.integration.alert.common.enumeration.ProcessingType;\n+import com.synopsys.integration.alert.common.rest.model.FieldModel;\n+import com.synopsys.integration.alert.common.rest.model.FieldValueModel;\n+import com.synopsys.integration.alert.common.rest.model.JobFieldModel;\n+import com.synopsys.integration.alert.performance.model.SlackPerformanceProperties;\n+import com.synopsys.integration.alert.performance.utility.NotificationWaitJobTask;\n+import com.synopsys.integration.wait.WaitJob;\n+\n+public class SlackPerformanceTest extends IntegrationPerformanceTest {\n+    private final static String SLACK_PERFORMANCE_JOB_NAME = \"Slack Performance Job\";\n+    private final SlackPerformanceProperties slackProperties = new SlackPerformanceProperties();\n+\n+    private String blackDuckProviderID = \"-1\";\n+\n+    @Test\n+    @Ignore\n+    public void testAlertPerformance() throws Exception {\n+        LocalDateTime startingTime = LocalDateTime.now();\n+        intLogger.info(String.format(\"Starting time %s\", getDateTimeFormatter().format(startingTime)));\n+\n+        logTimeElapsedWithMessage(\"Logging in took %s\", startingTime, LocalDateTime.now());\n+        startingTime = LocalDateTime.now();\n+\n+        // Create the Black Duck Global provider configuration\n+        blackDuckProviderID = setupBlackDuck();\n+        \n+        logTimeElapsedWithMessage(\"Configuring the Black Duck provider took %s\", startingTime, LocalDateTime.now());\n+        startingTime = LocalDateTime.now();\n+\n+        String jobId = createSlackJob();\n+        String message = String.format(\"Creating the Job %s jobs took\", SLACK_PERFORMANCE_JOB_NAME);\n+        logTimeElapsedWithMessage(message + \" %s\", startingTime, LocalDateTime.now());\n+\n+        LocalDateTime startingSearchDateTime = LocalDateTime.now();\n+        // trigger BD notification\n+        triggerBlackDuckNotification();\n+\n+        NotificationWaitJobTask notificationWaitJobTask = new NotificationWaitJobTask(intLogger, getDateTimeFormatter(), getGson(), getAlertRequestUtility(), startingSearchDateTime, jobId);\n+        WaitJob waitForNotificationToBeProcessed = WaitJob.create(intLogger, 600, startingSearchDateTime.atZone(ZoneId.systemDefault()).toInstant().toEpochMilli(), 20, notificationWaitJobTask);\n+        boolean isComplete = waitForNotificationToBeProcessed.waitFor();\n+        intLogger.info(\"Finished waiting for the notification to be processed: \" + isComplete);\n+        assertTrue(isComplete);\n+    }\n+\n+    private String createSlackJob() throws Exception {\n+        Map<String, FieldValueModel> providerKeyToValues = new HashMap<>();\n+        providerKeyToValues.put(\"provider.common.config.id\", new FieldValueModel(List.of(blackDuckProviderID), true));", "originalCommit": "f7cc909334db82c3276f9560d54f91198748513a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e291f582ee20dc74486c61f8b2c7effbbc1fb8e8", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/e291f582ee20dc74486c61f8b2c7effbbc1fb8e8", "message": "Refactor(Test): updating the tests to use statics for the field keys and improving the logging", "committedDate": "2020-10-16T19:54:35Z", "type": "commit"}, {"oid": "7d18d89b860d71bb6a041702c9e203c4b7857ef8", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/7d18d89b860d71bb6a041702c9e203c4b7857ef8", "message": "Adding MsTeamsPerformanceTest, refactoring the performance tests to make adding new channel tests easier", "committedDate": "2020-10-19T19:14:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODYxMDk5Mw==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1224#discussion_r508610993", "bodyText": "Don't you think this would be better suited for a test utility as well rather than a superclass?", "author": "gkillough", "createdAt": "2020-10-20T15:29:02Z", "path": "src/test/java/com/synopsys/integration/alert/performance/BasePerformanceTest.java", "diffHunk": "@@ -0,0 +1,183 @@\n+package com.synopsys.integration.alert.performance;\n+\n+import java.time.Duration;\n+import java.time.LocalDateTime;\n+import java.time.format.DateTimeFormatter;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Optional;\n+\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Tag;\n+import org.slf4j.LoggerFactory;\n+\n+import com.google.gson.Gson;\n+import com.google.gson.GsonBuilder;\n+import com.google.gson.JsonObject;\n+import com.synopsys.integration.alert.common.enumeration.ConfigContextEnum;\n+import com.synopsys.integration.alert.common.rest.model.FieldModel;\n+import com.synopsys.integration.alert.common.rest.model.FieldValueModel;\n+import com.synopsys.integration.alert.common.rest.model.MultiFieldModel;\n+import com.synopsys.integration.alert.performance.model.BlackDuckPerformanceProperties;\n+import com.synopsys.integration.alert.performance.utility.AlertRequestUtility;\n+import com.synopsys.integration.alert.util.TestTags;\n+import com.synopsys.integration.bdio.model.Forge;\n+import com.synopsys.integration.bdio.model.externalid.ExternalId;\n+import com.synopsys.integration.blackduck.api.generated.view.ProjectVersionComponentView;\n+import com.synopsys.integration.blackduck.api.generated.view.ProjectVersionView;\n+import com.synopsys.integration.blackduck.configuration.BlackDuckServerConfig;\n+import com.synopsys.integration.blackduck.configuration.BlackDuckServerConfigBuilder;\n+import com.synopsys.integration.blackduck.service.BlackDuckService;\n+import com.synopsys.integration.blackduck.service.BlackDuckServicesFactory;\n+import com.synopsys.integration.blackduck.service.dataservice.ProjectBomService;\n+import com.synopsys.integration.blackduck.service.dataservice.ProjectService;\n+import com.synopsys.integration.blackduck.service.model.ProjectVersionWrapper;\n+import com.synopsys.integration.exception.IntegrationException;\n+import com.synopsys.integration.log.IntLogger;\n+import com.synopsys.integration.log.Slf4jIntLogger;\n+\n+@Tag(TestTags.DEFAULT_PERFORMANCE)\n+public abstract class BasePerformanceTest {\n+    public static final String ROLE_ALERT_ADMIN = \"ALERT_ADMIN\";\n+    protected final IntLogger intLogger = new Slf4jIntLogger(LoggerFactory.getLogger(this.getClass()));\n+\n+    private final BlackDuckPerformanceProperties blackDuckProperties = new BlackDuckPerformanceProperties();\n+    private final Gson gson = new GsonBuilder().setPrettyPrinting().create();\n+    private final DateTimeFormatter dateTimeFormatter = DateTimeFormatter.ofPattern(\"yyyy/MM/dd HH:mm:ss\");\n+\n+    private final String localAlertURL = \"http://localhost/\";\n+\n+    private AlertRequestUtility alertRequestUtility;\n+    private BlackDuckServicesFactory blackDuckServicesFactory = null;\n+\n+    public abstract AlertRequestUtility createAlertRequestUtility();\n+\n+    @BeforeEach\n+    public void setupTests() {\n+        alertRequestUtility = createAlertRequestUtility();\n+    }\n+\n+    public void triggerBlackDuckNotification() throws Exception {", "originalCommit": "7d18d89b860d71bb6a041702c9e203c4b7857ef8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODYxMTczOQ==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1224#discussion_r508611739", "bodyText": "Don't forget about this TODO.", "author": "gkillough", "createdAt": "2020-10-20T15:29:39Z", "path": "src/test/java/com/synopsys/integration/alert/performance/BasePerformanceTest.java", "diffHunk": "@@ -0,0 +1,183 @@\n+package com.synopsys.integration.alert.performance;\n+\n+import java.time.Duration;\n+import java.time.LocalDateTime;\n+import java.time.format.DateTimeFormatter;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Optional;\n+\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Tag;\n+import org.slf4j.LoggerFactory;\n+\n+import com.google.gson.Gson;\n+import com.google.gson.GsonBuilder;\n+import com.google.gson.JsonObject;\n+import com.synopsys.integration.alert.common.enumeration.ConfigContextEnum;\n+import com.synopsys.integration.alert.common.rest.model.FieldModel;\n+import com.synopsys.integration.alert.common.rest.model.FieldValueModel;\n+import com.synopsys.integration.alert.common.rest.model.MultiFieldModel;\n+import com.synopsys.integration.alert.performance.model.BlackDuckPerformanceProperties;\n+import com.synopsys.integration.alert.performance.utility.AlertRequestUtility;\n+import com.synopsys.integration.alert.util.TestTags;\n+import com.synopsys.integration.bdio.model.Forge;\n+import com.synopsys.integration.bdio.model.externalid.ExternalId;\n+import com.synopsys.integration.blackduck.api.generated.view.ProjectVersionComponentView;\n+import com.synopsys.integration.blackduck.api.generated.view.ProjectVersionView;\n+import com.synopsys.integration.blackduck.configuration.BlackDuckServerConfig;\n+import com.synopsys.integration.blackduck.configuration.BlackDuckServerConfigBuilder;\n+import com.synopsys.integration.blackduck.service.BlackDuckService;\n+import com.synopsys.integration.blackduck.service.BlackDuckServicesFactory;\n+import com.synopsys.integration.blackduck.service.dataservice.ProjectBomService;\n+import com.synopsys.integration.blackduck.service.dataservice.ProjectService;\n+import com.synopsys.integration.blackduck.service.model.ProjectVersionWrapper;\n+import com.synopsys.integration.exception.IntegrationException;\n+import com.synopsys.integration.log.IntLogger;\n+import com.synopsys.integration.log.Slf4jIntLogger;\n+\n+@Tag(TestTags.DEFAULT_PERFORMANCE)\n+public abstract class BasePerformanceTest {\n+    public static final String ROLE_ALERT_ADMIN = \"ALERT_ADMIN\";\n+    protected final IntLogger intLogger = new Slf4jIntLogger(LoggerFactory.getLogger(this.getClass()));\n+\n+    private final BlackDuckPerformanceProperties blackDuckProperties = new BlackDuckPerformanceProperties();\n+    private final Gson gson = new GsonBuilder().setPrettyPrinting().create();\n+    private final DateTimeFormatter dateTimeFormatter = DateTimeFormatter.ofPattern(\"yyyy/MM/dd HH:mm:ss\");\n+\n+    private final String localAlertURL = \"http://localhost/\";\n+\n+    private AlertRequestUtility alertRequestUtility;\n+    private BlackDuckServicesFactory blackDuckServicesFactory = null;\n+\n+    public abstract AlertRequestUtility createAlertRequestUtility();\n+\n+    @BeforeEach\n+    public void setupTests() {\n+        alertRequestUtility = createAlertRequestUtility();\n+    }\n+\n+    public void triggerBlackDuckNotification() throws Exception {\n+        setupBlackDuckServicesFactory();\n+        BlackDuckService blackDuckService = blackDuckServicesFactory.getBlackDuckService();\n+        ProjectService projectService = blackDuckServicesFactory.createProjectService();\n+        String blackDuckProjectName = blackDuckProperties.getBlackDuckProjectName();\n+        String blackDuckProjectVersion = blackDuckProperties.getBlackDuckProjectVersion();\n+        ProjectVersionWrapper projectVersion = projectService.getProjectVersion(blackDuckProjectName, blackDuckProjectVersion)\n+                                                   .orElseThrow(() -> new IntegrationException(String.format(\"Could not find the Black Duck project '%s' version '%s'\", blackDuckProjectName, blackDuckProjectVersion)));\n+\n+        ProjectVersionView projectVersionView = projectVersion.getProjectVersionView();\n+        List<ProjectVersionComponentView> bomComponents = blackDuckService.getAllResponses(projectVersionView, ProjectVersionView.COMPONENTS_LINK_RESPONSE);\n+        Optional<ProjectVersionComponentView> apacheCommonsFileUpload = bomComponents.stream()\n+                                                                            .filter(component -> component.getComponentName().equals(\"Apache Commons FileUpload\"))\n+                                                                            .filter(component -> component.getComponentVersionName().equals(\"1.2.1\"))\n+                                                                            .findFirst();\n+        if (apacheCommonsFileUpload.isPresent()) {\n+            blackDuckService.delete(apacheCommonsFileUpload.get());\n+            //Thread.currentThread().wait(1000);\n+        }\n+\n+        ExternalId commonsFileUploadExternalId = new ExternalId(Forge.MAVEN);\n+        commonsFileUploadExternalId.setGroup(\"commons-fileupload\");\n+        commonsFileUploadExternalId.setName(\"commons-fileupload\");\n+        commonsFileUploadExternalId.setVersion(\"1.2.1\");\n+\n+        ProjectBomService projectBomService = blackDuckServicesFactory.createProjectBomService();\n+        projectBomService.addComponentToProjectVersion(commonsFileUploadExternalId, projectVersionView);\n+    }\n+\n+    private void setupBlackDuckServicesFactory() {\n+        if (null == blackDuckServicesFactory) {\n+            BlackDuckServerConfigBuilder blackDuckServerConfigBuilder = new BlackDuckServerConfigBuilder();\n+            blackDuckServerConfigBuilder.setUrl(blackDuckProperties.getBlackDuckProviderUrl())\n+                .setApiToken(blackDuckProperties.getBlackDuckApiToken())\n+                .setTimeoutInSeconds(blackDuckProperties.getBlackDuckTimeout())\n+                .setTrustCert(true);\n+            BlackDuckServerConfig blackDuckServerConfig = blackDuckServerConfigBuilder.build();\n+            blackDuckServicesFactory = blackDuckServerConfig.createBlackDuckServicesFactory(intLogger);\n+        }\n+    }\n+\n+    public String setupBlackDuck() throws Exception {\n+        try {\n+            return findBlackDuckProvider();\n+        } catch (IntegrationException exception) {\n+            intLogger.error(exception.getMessage());\n+            return createBlackDuckProvider();\n+        }\n+    }\n+\n+    public String findBlackDuckProvider() throws Exception {\n+        String blackDuckProviderSearch = String.format(\"api/configuration?context=%s&descriptorName=%s\", ConfigContextEnum.GLOBAL, blackDuckProperties.getBlackDuckProviderKey());\n+        String response = alertRequestUtility.executeGetRequest(blackDuckProviderSearch, \"Could not find the Black Duck provider.\");\n+\n+        MultiFieldModel blackDuckConfigurations = gson.fromJson(response, MultiFieldModel.class);\n+        FieldModel blackDuckProviderConfiguration = blackDuckConfigurations.getFieldModels().stream()\n+                                                        .filter(blackDuckConfiguration -> blackDuckConfiguration.getFieldValue(\"blackduck.url\").isPresent())\n+                                                        .filter(blackDuckConfiguration -> blackDuckConfiguration.getFieldValue(\"blackduck.url\").get().equals(blackDuckProperties.getBlackDuckProviderUrl()))\n+                                                        .findFirst()\n+                                                        .orElseThrow(() -> new IntegrationException(\"Could not find the BlackDuck provider configuration.\"));\n+\n+        String blackDuckProviderID = blackDuckProviderConfiguration.getId();\n+        String blackDuckConfigBody = gson.toJson(blackDuckProviderConfiguration);\n+        alertRequestUtility.executePutRequest(\"/api/configuration/\" + blackDuckProviderID, blackDuckConfigBody, \"Could not save the Black Duck provider.\");\n+        intLogger.info(String.format(\"Retrieved the Black Duck provider, ID %s.\", blackDuckProviderID));\n+\n+        return blackDuckProviderID;\n+    }\n+\n+    private String createBlackDuckProvider() throws Exception {\n+        Map<String, FieldValueModel> keyToValues = new HashMap<>();\n+        keyToValues.put(\"provider.common.config.enabled\", new FieldValueModel(List.of(\"true\"), true));\n+        keyToValues.put(\"provider.common.config.name\", new FieldValueModel(List.of(blackDuckProperties.getBlackDuckProviderUniqueName()), true));\n+        keyToValues.put(\"blackduck.url\", new FieldValueModel(List.of(blackDuckProperties.getBlackDuckProviderUrl()), true));\n+        keyToValues.put(\"blackduck.api.key\", new FieldValueModel(List.of(blackDuckProperties.getBlackDuckApiToken()), true));\n+        keyToValues.put(\"blackduck.timeout\", new FieldValueModel(List.of(blackDuckProperties.getBlackDuckTimeout()), true));\n+        FieldModel blackDuckProviderConfiguration = new FieldModel(blackDuckProperties.getBlackDuckProviderKey(), ConfigContextEnum.GLOBAL.name(), keyToValues);\n+\n+        String blackDuckConfigBody = gson.toJson(blackDuckProviderConfiguration);\n+\n+        alertRequestUtility.executePostRequest(\"/api/configuration/validate\", blackDuckConfigBody, \"Validating the Black Duck provider failed.\");\n+        alertRequestUtility.executePostRequest(\"/api/configuration/test\", blackDuckConfigBody, \"Testing the Black Duck provider failed.\");\n+        String creationResponse = alertRequestUtility.executePostRequest(\"/api/configuration\", blackDuckConfigBody, \"Could not create the Black Duck provider.\");\n+\n+        JsonObject jsonObject = gson.fromJson(creationResponse, JsonObject.class);\n+        String blackDuckProviderID = jsonObject.get(\"id\").getAsString();\n+        intLogger.info(String.format(\"Configured the Black Duck provider, ID %s.\", blackDuckProviderID));\n+        return blackDuckProviderID;\n+    }\n+\n+    public void logTimeElapsedWithMessage(String messageFormat, LocalDateTime start, LocalDateTime end) {\n+        //TODO log timing to a file", "originalCommit": "7d18d89b860d71bb6a041702c9e203c4b7857ef8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODYxNjkxMg==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1224#discussion_r508616912", "bodyText": "Once again, I'm wondering if it would be better to have a class PerformanceTestJobCreator that handled this per channel. I think we should try to move away from test inheritance.", "author": "gkillough", "createdAt": "2020-10-20T15:33:57Z", "path": "src/test/java/com/synopsys/integration/alert/performance/MsTeamsPerformanceTest.java", "diffHunk": "@@ -0,0 +1,73 @@\n+package com.synopsys.integration.alert.performance;\n+\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Set;\n+\n+import org.junit.Ignore;\n+import org.junit.jupiter.api.Test;\n+\n+import com.google.gson.JsonObject;\n+import com.synopsys.integration.alert.channel.msteams.descriptor.MsTeamsDescriptor;\n+import com.synopsys.integration.alert.common.descriptor.ProviderDescriptor;\n+import com.synopsys.integration.alert.common.descriptor.config.ui.ChannelDistributionUIConfig;\n+import com.synopsys.integration.alert.common.descriptor.config.ui.ProviderDistributionUIConfig;\n+import com.synopsys.integration.alert.common.enumeration.ConfigContextEnum;\n+import com.synopsys.integration.alert.common.enumeration.FrequencyType;\n+import com.synopsys.integration.alert.common.enumeration.ProcessingType;\n+import com.synopsys.integration.alert.common.rest.model.FieldModel;\n+import com.synopsys.integration.alert.common.rest.model.FieldValueModel;\n+import com.synopsys.integration.alert.common.rest.model.JobFieldModel;\n+import com.synopsys.integration.alert.performance.model.MsTeamsPerformanceProperties;\n+import com.synopsys.integration.exception.IntegrationException;\n+\n+public class MsTeamsPerformanceTest extends IntegrationPerformanceTest {\n+    private final static String MS_TEAMS_PERFORMANCE_JOB_NAME = \"MsTeams Performance Job\";\n+    private final MsTeamsPerformanceProperties msTeamsProperties = new MsTeamsPerformanceProperties();\n+\n+    @Test\n+    @Ignore\n+    public void testMsTeamsJob() throws Exception {\n+        runTest();\n+    }\n+\n+    @Override\n+    public String createJob() throws IntegrationException {", "originalCommit": "7d18d89b860d71bb6a041702c9e203c4b7857ef8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODc1NDU5OQ==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1224#discussion_r508754599", "bodyText": "Another instance where I'm not convinced inheritance is the right approach. Is this class adding new functionality to TestProperties or is it wrapping functionality of TestProperties?", "author": "gkillough", "createdAt": "2020-10-20T18:39:29Z", "path": "src/test/java/com/synopsys/integration/alert/performance/model/SlackPerformanceProperties.java", "diffHunk": "@@ -0,0 +1,37 @@\n+package com.synopsys.integration.alert.performance.model;\n+\n+import com.synopsys.integration.alert.channel.slack.SlackChannelKey;\n+import com.synopsys.integration.alert.util.TestProperties;\n+import com.synopsys.integration.alert.util.TestPropertyKey;\n+\n+public class SlackPerformanceProperties extends TestProperties {", "originalCommit": "7d18d89b860d71bb6a041702c9e203c4b7857ef8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODc1NDkzNA==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1224#discussion_r508754934", "bodyText": "See comment about SlackPerformanceTestProperties.", "author": "gkillough", "createdAt": "2020-10-20T18:39:55Z", "path": "src/test/java/com/synopsys/integration/alert/performance/model/MsTeamsPerformanceProperties.java", "diffHunk": "@@ -0,0 +1,24 @@\n+package com.synopsys.integration.alert.performance.model;\n+\n+import com.synopsys.integration.alert.channel.msteams.MsTeamsKey;\n+import com.synopsys.integration.alert.util.TestProperties;\n+import com.synopsys.integration.alert.util.TestPropertyKey;\n+\n+public class MsTeamsPerformanceProperties extends TestProperties {", "originalCommit": "7d18d89b860d71bb6a041702c9e203c4b7857ef8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODc1NTI2OA==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1224#discussion_r508755268", "bodyText": "See comment about SlackPerformanceTestProperties.", "author": "gkillough", "createdAt": "2020-10-20T18:40:17Z", "path": "src/test/java/com/synopsys/integration/alert/performance/model/BlackDuckPerformanceProperties.java", "diffHunk": "@@ -0,0 +1,57 @@\n+package com.synopsys.integration.alert.performance.model;\n+\n+import java.util.UUID;\n+\n+import com.synopsys.integration.alert.provider.blackduck.BlackDuckProviderKey;\n+import com.synopsys.integration.alert.util.TestProperties;\n+import com.synopsys.integration.alert.util.TestPropertyKey;\n+\n+public class BlackDuckPerformanceProperties extends TestProperties {", "originalCommit": "7d18d89b860d71bb6a041702c9e203c4b7857ef8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "a67a9954674e90f130e0ff6afd13dee877f7c98f", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/a67a9954674e90f130e0ff6afd13dee877f7c98f", "message": "Changing the performance tests to a less inheritance based structure", "committedDate": "2020-11-02T20:45:11Z", "type": "commit"}, {"oid": "364b5400911dc2a1314275f468866188909f1e34", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/364b5400911dc2a1314275f468866188909f1e34", "message": "Merge branch 'master' into jr_external_tests\n\n# Conflicts:\n#\tbuild.gradle", "committedDate": "2020-11-02T20:47:33Z", "type": "commit"}, {"oid": "1a111cd78daad2c089509ec2751befddc6fce232", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/1a111cd78daad2c089509ec2751befddc6fce232", "message": "Deleting unused class", "committedDate": "2020-11-02T20:50:07Z", "type": "commit"}, {"oid": "bc80518f538c0167ca97d3ceb4190012415900ee", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/bc80518f538c0167ca97d3ceb4190012415900ee", "message": "Fixing the scaling performance test after the new structure change", "committedDate": "2020-11-02T20:54:24Z", "type": "commit"}]}