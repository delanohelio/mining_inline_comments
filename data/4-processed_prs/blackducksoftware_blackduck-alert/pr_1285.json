{"pr_number": 1285, "pr_title": "Refactored PhoneHomeTask to use new JobAccessor", "pr_createdAt": "2020-12-03T18:56:18Z", "pr_url": "https://github.com/blackducksoftware/blackduck-alert/pull/1285", "timeline": [{"oid": "7aceceb1a4af10f207c6da35000aecca659fa697", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/7aceceb1a4af10f207c6da35000aecca659fa697", "message": "refactor(phone-home): Refactored PhoneHomeTask to use new JobAccessor.", "committedDate": "2020-12-03T18:55:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTQ5NzczMQ==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1285#discussion_r535497731", "bodyText": "I was unsure if this is still necessary.", "author": "JakeMathews", "createdAt": "2020-12-03T18:56:46Z", "path": "src/main/java/com/synopsys/integration/alert/workflow/scheduled/PhoneHomeTask.java", "diffHunk": "@@ -182,26 +181,24 @@ private PhoneHomeService createPhoneHomeService(ExecutorService phoneHomeExecuto\n         return channelMetadata.toArray(String[]::new);\n     }\n \n-    private Set<String> retrieveChannelMetadataForJobs(List<ConfigurationJobModel> jobs) {\n+    private Set<String> retrieveChannelMetadataForJobs(List<DistributionJobModel> jobs) {\n         Map<String, Integer> createdDistributions = new HashMap<>();\n         String successKeyPart = \"::Successes\";\n-        for (ConfigurationJobModel job : jobs) {\n-            for (ConfigurationModel configuration : job.getCopyOfConfigurations()) {\n-                String channelName = configuration.getField(ChannelDistributionUIConfig.KEY_CHANNEL_NAME).flatMap(ConfigurationFieldModel::getFieldValue).orElse(\"\");\n-                String providerName = configuration.getField(ChannelDistributionUIConfig.KEY_PROVIDER_NAME).flatMap(ConfigurationFieldModel::getFieldValue).orElse(\"\");\n-\n-                if (StringUtils.isBlank(channelName) || StringUtils.isBlank(providerName)) {\n-                    // We want to specifically get the channel configuration here and the only way to determine that is if it has these fields.\n-                    continue;\n-                }\n+        for (DistributionJobModel job : jobs) {\n+            String channelName = job.getChannelDescriptorName();\n+            String providerName = new BlackDuckProviderKey().getUniversalKey();\n+\n+            if (StringUtils.isBlank(channelName)) {", "originalCommit": "7aceceb1a4af10f207c6da35000aecca659fa697", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTUxMDk4Mw==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1285#discussion_r535510983", "bodyText": "The database does not allow null values for the channel descriptor name, so I'm inclined to think that this being blank would be a bug (if we are correctly validating the data that gets saved). So I think this can be removed.", "author": "gkillough", "createdAt": "2020-12-03T19:16:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTQ5NzczMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTUxMjE4MQ==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1285#discussion_r535512181", "bodyText": "Since this class is a component, you can autowire BlackDuckProviderKey.", "author": "gkillough", "createdAt": "2020-12-03T19:18:08Z", "path": "src/main/java/com/synopsys/integration/alert/workflow/scheduled/PhoneHomeTask.java", "diffHunk": "@@ -182,26 +181,24 @@ private PhoneHomeService createPhoneHomeService(ExecutorService phoneHomeExecuto\n         return channelMetadata.toArray(String[]::new);\n     }\n \n-    private Set<String> retrieveChannelMetadataForJobs(List<ConfigurationJobModel> jobs) {\n+    private Set<String> retrieveChannelMetadataForJobs(List<DistributionJobModel> jobs) {\n         Map<String, Integer> createdDistributions = new HashMap<>();\n         String successKeyPart = \"::Successes\";\n-        for (ConfigurationJobModel job : jobs) {\n-            for (ConfigurationModel configuration : job.getCopyOfConfigurations()) {\n-                String channelName = configuration.getField(ChannelDistributionUIConfig.KEY_CHANNEL_NAME).flatMap(ConfigurationFieldModel::getFieldValue).orElse(\"\");\n-                String providerName = configuration.getField(ChannelDistributionUIConfig.KEY_PROVIDER_NAME).flatMap(ConfigurationFieldModel::getFieldValue).orElse(\"\");\n-\n-                if (StringUtils.isBlank(channelName) || StringUtils.isBlank(providerName)) {\n-                    // We want to specifically get the channel configuration here and the only way to determine that is if it has these fields.\n-                    continue;\n-                }\n+        for (DistributionJobModel job : jobs) {\n+            String channelName = job.getChannelDescriptorName();\n+            String providerName = new BlackDuckProviderKey().getUniversalKey();", "originalCommit": "7aceceb1a4af10f207c6da35000aecca659fa697", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTUyMDkwMA==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1285#discussion_r535520900", "bodyText": "I went vague an autowired a ProviderKey if that's alright.", "author": "JakeMathews", "createdAt": "2020-12-03T19:28:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTUxMjE4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTUyNzIzMQ==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1285#discussion_r535527231", "bodyText": "Yeah, that's fine. If we ever do need to refactor to multiple providers, it will be with ProviderKey.", "author": "gkillough", "createdAt": "2020-12-03T19:35:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTUxMjE4MQ=="}], "type": "inlineReview"}, {"oid": "53a8dfb190a8b49d1617d67084512315fa0e6b58", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/53a8dfb190a8b49d1617d67084512315fa0e6b58", "message": "refactor(phone-home): PhoneHomeTask now has an autowired ProviderKey.", "committedDate": "2020-12-03T19:26:49Z", "type": "commit"}, {"oid": "be8eb4913b005bfbba31c56104aaf17c6701f063", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/be8eb4913b005bfbba31c56104aaf17c6701f063", "message": "refactor(phone-home): Removed check for already validated data.", "committedDate": "2020-12-03T19:27:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTUyODA5Nw==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1285#discussion_r535528097", "bodyText": "While you're in here, can you make this a constant?", "author": "gkillough", "createdAt": "2020-12-03T19:35:58Z", "path": "src/main/java/com/synopsys/integration/alert/workflow/scheduled/PhoneHomeTask.java", "diffHunk": "@@ -182,26 +182,19 @@ private PhoneHomeService createPhoneHomeService(ExecutorService phoneHomeExecuto\n         return channelMetadata.toArray(String[]::new);\n     }\n \n-    private Set<String> retrieveChannelMetadataForJobs(List<ConfigurationJobModel> jobs) {\n+    private Set<String> retrieveChannelMetadataForJobs(List<DistributionJobModel> jobs) {\n         Map<String, Integer> createdDistributions = new HashMap<>();\n         String successKeyPart = \"::Successes\";", "originalCommit": "be8eb4913b005bfbba31c56104aaf17c6701f063", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "b4eba72c6e18c821cacd2999eddece8f05629f2e", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/b4eba72c6e18c821cacd2999eddece8f05629f2e", "message": "refactor(phone-home): Made success String a constant.", "committedDate": "2020-12-03T20:17:23Z", "type": "commit"}]}