{"pr_number": 1231, "pr_title": "Add static jobs tables to liquibase", "pr_createdAt": "2020-10-27T17:04:44Z", "pr_url": "https://github.com/blackducksoftware/blackduck-alert/pull/1231", "timeline": [{"oid": "0418b0662a3e4bcecfc42258c3ffd2b11c0b77b4", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/0418b0662a3e4bcecfc42258c3ffd2b11c0b77b4", "message": "Feat(Liquibase): Create initial jobs table and black duck jobs tables", "committedDate": "2020-10-27T15:43:17Z", "type": "commit"}, {"oid": "7b4c888ed9196c53c3b54fde20974cb4c8c502a1", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/7b4c888ed9196c53c3b54fde20974cb4c8c502a1", "message": "Refactor(Liquibase): Changing black_duck to blackduck", "committedDate": "2020-10-27T15:56:27Z", "type": "commit"}, {"oid": "a78605d871a26be25da624f2b3260ca5ef64f03e", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/a78605d871a26be25da624f2b3260ca5ef64f03e", "message": "Feat(Liquibase): Add distribution channel job details tables", "committedDate": "2020-10-27T17:03:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjkwNTg2MQ==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1231#discussion_r512905861", "bodyText": "Can/Should we decide to use either name of key here instead of either?", "author": "bamandel", "createdAt": "2020-10-27T17:51:50Z", "path": "alert-database/src/main/resources/liquibase/6.4.0/static-distribution-jobs.xml", "diffHunk": "@@ -0,0 +1,399 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<databaseChangeLog xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns=\"http://www.liquibase.org/xml/ns/dbchangelog\"\n+                   xsi:schemaLocation=\"http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.3.xsd\">\n+    <changeSet author=\"gavink\" id=\"create-uuid-ossp-extension\">\n+        <sql stripComments=\"true\">\n+            CREATE EXTENSION IF NOT EXISTS \"uuid-ossp\";\n+        </sql>\n+    </changeSet>\n+    <changeSet author=\"gavink\" id=\"create-distribution-jobs-table\">\n+        <createTable schemaName=\"alert\" tableName=\"distribution_jobs\">\n+            <column name=\"job_id\" type=\"UUID\" defaultValueComputed=\"uuid_generate_v4()\">\n+                <constraints primaryKey=\"true\"/>\n+            </column>\n+            <column name=\"name\" type=\"VARCHAR\">\n+                <constraints nullable=\"false\"/>\n+            </column>\n+            <column name=\"enabled\" type=\"BOOLEAN\" defaultValueBoolean=\"true\">\n+                <constraints nullable=\"false\"/>\n+            </column>\n+            <column name=\"distribution_frequency\" type=\"VARCHAR\" defaultValue=\"REAL_TIME\">\n+                <constraints nullable=\"false\"/>\n+            </column>\n+            <column name=\"processing_type\" type=\"VARCHAR\" defaultValue=\"DEFAULT\">\n+                <constraints nullable=\"false\"/>\n+            </column>\n+            <column name=\"channel_descriptor_name\" type=\"VARCHAR\">\n+                <constraints nullable=\"false\"/>\n+            </column>\n+        </createTable>\n+    </changeSet>\n+\n+    <!-- Black Duck Job Tables -->\n+\n+    <changeSet author=\"gavink\" id=\"create-blackduck-job-details-table\">\n+        <createTable schemaName=\"alert\" tableName=\"blackduck_job_details\">\n+            <column name=\"job_id\" type=\"UUID\">\n+                <constraints primaryKey=\"true\"/>\n+            </column>\n+            <!-- This might eventually become a UUID -->\n+            <column name=\"global_config_id\" type=\"BIGINT\">\n+                <constraints nullable=\"false\"/>\n+            </column>\n+            <column name=\"filter_by_project\" type=\"BOOLEAN\" defaultValueBoolean=\"false\">\n+                <constraints nullable=\"false\"/>\n+            </column>\n+            <column name=\"project_name_pattern\" type=\"VARCHAR\">\n+                <constraints nullable=\"true\"/>\n+            </column>\n+        </createTable>\n+    </changeSet>\n+    <changeSet author=\"gavink\" id=\"create-blackduck-job-details-table-fk\">\n+        <addForeignKeyConstraint\n+                constraintName=\"blackduck_job_details_job_id_fk\"\n+                baseTableSchemaName=\"alert\"\n+                baseTableName=\"blackduck_job_details\"\n+                baseColumnNames=\"job_id\"\n+                referencedTableSchemaName=\"alert\"\n+                referencedTableName=\"distribution_jobs\"\n+                referencedColumnNames=\"job_id\"\n+                onDelete=\"CASCADE\"\n+                onUpdate=\"CASCADE\"\n+        />\n+    </changeSet>\n+    <changeSet author=\"gavink\" id=\"create-blackduck-notification-types-table\">\n+        <createTable schemaName=\"alert\" tableName=\"blackduck_notification_types\">\n+            <column name=\"notification_type_id\" type=\"UUID\" defaultValueComputed=\"uuid_generate_v4()\">\n+                <constraints primaryKey=\"true\"/>\n+            </column>\n+            <column name=\"name\" type=\"VARCHAR\">\n+                <constraints nullable=\"false\"/>\n+            </column>\n+        </createTable>\n+    </changeSet>\n+    <changeSet author=\"gavink\" id=\"create-blackduck-job-notification-types-table\">\n+        <createTable schemaName=\"alert\" tableName=\"blackduck_job_notification_types\">\n+            <column name=\"job_id\" type=\"UUID\">\n+                <constraints primaryKey=\"true\"/>\n+            </column>\n+            <column name=\"notification_type\" type=\"VARCHAR\">\n+                <constraints primaryKey=\"true\"/>\n+            </column>\n+        </createTable>\n+    </changeSet>\n+    <changeSet author=\"gavink\" id=\"create-blackduck-job-notification-types-table-fk\">\n+        <addForeignKeyConstraint\n+                constraintName=\"blackduck_job_notification_types_job_id_fk\"\n+                baseTableSchemaName=\"alert\"\n+                baseTableName=\"blackduck_job_notification_types\"\n+                baseColumnNames=\"job_id\"\n+                referencedTableSchemaName=\"alert\"\n+                referencedTableName=\"distribution_jobs\"\n+                referencedColumnNames=\"job_id\"\n+                onDelete=\"CASCADE\"\n+                onUpdate=\"CASCADE\"\n+        />\n+    </changeSet>\n+    <changeSet author=\"gavink\" id=\"create-blackduck-job-policy-filters-table\">\n+        <createTable schemaName=\"alert\" tableName=\"blackduck_job_policy_filters\">\n+            <column name=\"job_id\" type=\"UUID\">\n+                <constraints primaryKey=\"true\"/>\n+            </column>\n+            <column name=\"policy_name\" type=\"VARCHAR\">\n+                <constraints primaryKey=\"true\"/>\n+            </column>\n+        </createTable>\n+    </changeSet>\n+    <changeSet author=\"gavink\" id=\"create-blackduck-job-policy-filters-table-fk\">\n+        <addForeignKeyConstraint\n+                constraintName=\"blackduck_job_policy_filters_job_id_fk\"\n+                baseTableSchemaName=\"alert\"\n+                baseTableName=\"blackduck_job_policy_filters\"\n+                baseColumnNames=\"job_id\"\n+                referencedTableSchemaName=\"alert\"\n+                referencedTableName=\"distribution_jobs\"\n+                referencedColumnNames=\"job_id\"\n+                onDelete=\"CASCADE\"\n+                onUpdate=\"CASCADE\"\n+        />\n+    </changeSet>\n+    <changeSet author=\"gavink\" id=\"create-blackduck-job-vulnerability-severity-filters-table\">\n+        <createTable schemaName=\"alert\" tableName=\"blackduck_job_vulnerability_severity_filters\">\n+            <column name=\"job_id\" type=\"UUID\">\n+                <constraints primaryKey=\"true\"/>\n+            </column>\n+            <column name=\"severity_name\" type=\"VARCHAR\">\n+                <constraints primaryKey=\"true\"/>\n+            </column>\n+        </createTable>\n+    </changeSet>\n+    <changeSet author=\"gavink\" id=\"create-blackduck-job-vulnerability-severity-filters-table-fk\">\n+        <addForeignKeyConstraint\n+                constraintName=\"blackduck_job_vulnerability_severity_filters_job_id_fk\"\n+                baseTableSchemaName=\"alert\"\n+                baseTableName=\"blackduck_job_vulnerability_severity_filters\"\n+                baseColumnNames=\"job_id\"\n+                referencedTableSchemaName=\"alert\"\n+                referencedTableName=\"distribution_jobs\"\n+                referencedColumnNames=\"job_id\"\n+                onDelete=\"CASCADE\"\n+                onUpdate=\"CASCADE\"\n+        />\n+    </changeSet>\n+    <changeSet author=\"gavink\" id=\"create-blackduck-job-projects-table\">\n+        <createTable schemaName=\"alert\" tableName=\"blackduck_job_projects\">\n+            <column name=\"job_id\" type=\"UUID\">\n+                <constraints primaryKey=\"true\"/>\n+            </column>\n+            <column name=\"project_name\" type=\"VARCHAR\">\n+                <constraints primaryKey=\"true\"/>\n+            </column>\n+        </createTable>\n+    </changeSet>\n+    <changeSet author=\"gavink\" id=\"create-blackduck-job-projects-table-fk\">\n+        <addForeignKeyConstraint\n+                constraintName=\"blackduck_job_projects_job_id_fk\"\n+                baseTableSchemaName=\"alert\"\n+                baseTableName=\"blackduck_job_projects\"\n+                baseColumnNames=\"job_id\"\n+                referencedTableSchemaName=\"alert\"\n+                referencedTableName=\"distribution_jobs\"\n+                referencedColumnNames=\"job_id\"\n+                onDelete=\"CASCADE\"\n+                onUpdate=\"CASCADE\"\n+        />\n+    </changeSet>\n+\n+    <!-- Azure Boards Job Table -->\n+\n+    <changeSet author=\"gavink\" id=\"create-azure-boards-job-details-table\">\n+        <createTable schemaName=\"alert\" tableName=\"azure_boards_job_details\">\n+            <column name=\"job_id\" type=\"UUID\">\n+                <constraints primaryKey=\"true\"/>\n+            </column>\n+            <column name=\"project_name_or_id\" type=\"VARCHAR\">\n+                <constraints nullable=\"false\"/>\n+            </column>\n+            <column name=\"work_item_type\" type=\"VARCHAR\">\n+                <constraints nullable=\"false\"/>\n+            </column>\n+            <column name=\"work_item_completed_state\" type=\"VARCHAR\">\n+                <constraints nullable=\"true\"/>\n+            </column>\n+            <column name=\"work_item_reopen_state\" type=\"VARCHAR\">\n+                <constraints nullable=\"true\"/>\n+            </column>\n+        </createTable>\n+    </changeSet>\n+    <changeSet author=\"gavink\" id=\"create-azure-boards-job-details-table-fk\">\n+        <addForeignKeyConstraint\n+                constraintName=\"azure_boards_job_details_job_id_fk\"\n+                baseTableSchemaName=\"alert\"\n+                baseTableName=\"azure_boards_job_details\"\n+                baseColumnNames=\"job_id\"\n+                referencedTableSchemaName=\"alert\"\n+                referencedTableName=\"distribution_jobs\"\n+                referencedColumnNames=\"job_id\"\n+                onDelete=\"CASCADE\"\n+                onUpdate=\"CASCADE\"\n+        />\n+    </changeSet>\n+\n+    <!-- Email Job Tables -->\n+\n+    <changeSet author=\"gavink\" id=\"create-email-job-details-table\">\n+        <createTable schemaName=\"alert\" tableName=\"email_job_details\">\n+            <column name=\"job_id\" type=\"UUID\">\n+                <constraints primaryKey=\"true\"/>\n+            </column>\n+            <column name=\"subject_line\" type=\"VARCHAR\">\n+                <constraints nullable=\"true\"/>\n+            </column>\n+            <column name=\"project_owner_only\" type=\"BOOLEAN\" defaultValueBoolean=\"false\">\n+                <constraints nullable=\"false\"/>\n+            </column>\n+            <column name=\"additional_email_addresses_only\" type=\"BOOLEAN\" defaultValueBoolean=\"false\">\n+                <constraints nullable=\"false\"/>\n+            </column>\n+            <column name=\"attachement_file_type\" type=\"VARCHAR\">\n+                <constraints nullable=\"true\"/>\n+            </column>\n+        </createTable>\n+    </changeSet>\n+    <changeSet author=\"gavink\" id=\"create-email-job-details-table-fk\">\n+        <addForeignKeyConstraint\n+                constraintName=\"email_job_details_job_id_fk\"\n+                baseTableSchemaName=\"alert\"\n+                baseTableName=\"email_job_details\"\n+                baseColumnNames=\"job_id\"\n+                referencedTableSchemaName=\"alert\"\n+                referencedTableName=\"distribution_jobs\"\n+                referencedColumnNames=\"job_id\"\n+                onDelete=\"CASCADE\"\n+                onUpdate=\"CASCADE\"\n+        />\n+    </changeSet>\n+    <changeSet author=\"gavink\" id=\"create-email-job-additional-email-addresses-table\">\n+        <createTable schemaName=\"alert\" tableName=\"email_job_additional_email_addresses\">\n+            <column name=\"job_id\" type=\"UUID\">\n+                <constraints primaryKey=\"true\"/>\n+            </column>\n+            <column name=\"email_address\" type=\"VARCHAR\">\n+                <constraints primaryKey=\"true\"/>\n+            </column>\n+        </createTable>\n+    </changeSet>\n+    <changeSet author=\"gavink\" id=\"create-email-job-additional-email-addresses-table-fk\">\n+        <addForeignKeyConstraint\n+                constraintName=\"email_job_additional_email_addresses_job_id_fk\"\n+                baseTableSchemaName=\"alert\"\n+                baseTableName=\"email_job_additional_email_addresses\"\n+                baseColumnNames=\"job_id\"\n+                referencedTableSchemaName=\"alert\"\n+                referencedTableName=\"distribution_jobs\"\n+                referencedColumnNames=\"job_id\"\n+                onDelete=\"CASCADE\"\n+                onUpdate=\"CASCADE\"\n+        />\n+    </changeSet>\n+\n+    <!-- Jira Could Job Tables -->\n+\n+    <changeSet author=\"gavink\" id=\"create-jira-cloud-job-details-table\">\n+        <createTable schemaName=\"alert\" tableName=\"jira_cloud_job_details\">\n+            <column name=\"job_id\" type=\"UUID\">\n+                <constraints primaryKey=\"true\"/>\n+            </column>\n+            <column name=\"add_comments\" type=\"BOOLEAN\" defaultValueBoolean=\"false\">\n+                <constraints nullable=\"false\"/>\n+            </column>\n+            <column name=\"issue_creator_email\" type=\"VARCHAR\">\n+                <constraints nullable=\"true\"/>\n+            </column>\n+            <column name=\"project_name_or_key\" type=\"VARCHAR\">\n+                <constraints nullable=\"false\"/>\n+            </column>\n+            <column name=\"issue_type\" type=\"VARCHAR\">\n+                <constraints nullable=\"false\"/>\n+            </column>\n+            <column name=\"resolve_transition\" type=\"VARCHAR\">\n+                <constraints nullable=\"true\"/>\n+            </column>\n+            <column name=\"reopen_transition\" type=\"VARCHAR\">\n+                <constraints nullable=\"true\"/>\n+            </column>\n+        </createTable>\n+    </changeSet>\n+    <changeSet author=\"gavink\" id=\"create-jira-cloud-job-details-table-fk\">\n+        <addForeignKeyConstraint\n+                constraintName=\"jira_cloud_job_details_job_id_fk\"\n+                baseTableSchemaName=\"alert\"\n+                baseTableName=\"jira_cloud_job_details\"\n+                baseColumnNames=\"job_id\"\n+                referencedTableSchemaName=\"alert\"\n+                referencedTableName=\"distribution_jobs\"\n+                referencedColumnNames=\"job_id\"\n+                onDelete=\"CASCADE\"\n+                onUpdate=\"CASCADE\"\n+        />\n+    </changeSet>\n+\n+    <!-- Jira Server Job Tables -->\n+\n+    <changeSet author=\"gavink\" id=\"create-jira-server-job-details-table\">\n+        <createTable schemaName=\"alert\" tableName=\"jira_server_job_details\">\n+            <column name=\"job_id\" type=\"UUID\">\n+                <constraints primaryKey=\"true\"/>\n+            </column>\n+            <column name=\"add_comments\" type=\"BOOLEAN\" defaultValueBoolean=\"false\">\n+                <constraints nullable=\"false\"/>\n+            </column>\n+            <column name=\"issue_creator_username\" type=\"VARCHAR\">\n+                <constraints nullable=\"true\"/>\n+            </column>\n+            <column name=\"project_name_or_key\" type=\"VARCHAR\">", "originalCommit": "a78605d871a26be25da624f2b3260ca5ef64f03e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjkxMjI0Mg==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1231#discussion_r512912242", "bodyText": "Good question. Either is valid for Jira, so we're sticking with the or-name.", "author": "gkillough", "createdAt": "2020-10-27T17:59:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjkwNTg2MQ=="}], "type": "inlineReview"}]}