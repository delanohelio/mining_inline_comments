{"pr_number": 1234, "pr_title": "Add an additional audit logger for Alert", "pr_createdAt": "2020-10-28T15:26:45Z", "pr_url": "https://github.com/blackducksoftware/blackduck-alert/pull/1234", "timeline": [{"oid": "065786dffdd097be3faea6426486082708ce93e3", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/065786dffdd097be3faea6426486082708ce93e3", "message": "feat: Add AlertLoggerFactory to log additional trace level messages into an audit log", "committedDate": "2020-10-15T19:26:39Z", "type": "commit"}, {"oid": "c7038314b3d3a39f0472a20628939c43132d9300", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/c7038314b3d3a39f0472a20628939c43132d9300", "message": "Merge branch 'master' into mc_audit_logger_refactor\n\n# Conflicts:\n#\talert-common/src/main/java/com/synopsys/integration/alert/common/action/api/AbstractResourceActions.java", "committedDate": "2020-10-15T19:32:17Z", "type": "commit"}, {"oid": "9f543990d4449b1d052331da8adb1b236e0b253d", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/9f543990d4449b1d052331da8adb1b236e0b253d", "message": "Merge branch 'master' into mc_audit_logger_refactor", "committedDate": "2020-10-28T14:19:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzU0MjQyNg==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1234#discussion_r513542426", "bodyText": "This blank line can be removed.", "author": "gkillough", "createdAt": "2020-10-28T15:33:17Z", "path": "alert-common/src/main/java/com/synopsys/integration/alert/common/logging/AlertLoggerFactory.java", "diffHunk": "@@ -0,0 +1,45 @@\n+/**\n+ * alert-common\n+ *\n+ * Copyright (c) 2020 Synopsys, Inc.\n+ *\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership. The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package com.synopsys.integration.alert.common.logging;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+public class AlertLoggerFactory {\n+", "originalCommit": "9f543990d4449b1d052331da8adb1b236e0b253d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzU0NTk1NQ==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1234#discussion_r513545955", "bodyText": "This seems a little small. What made you choose this default value? I realized that it's a rolling log file, but it seems like this size could produce a lot of files. I would expect somewhere between 50MB and 250MB.", "author": "gkillough", "createdAt": "2020-10-28T15:37:31Z", "path": "src/main/resources/logback-spring.xml", "diffHunk": "@@ -0,0 +1,24 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<configuration>\n+\n+    <include resource=\"org/springframework/boot/logging/logback/base.xml\"/>\n+\n+    <appender name=\"ALERT_AUDIT\" class=\"ch.qos.logback.core.rolling.RollingFileAppender\">\n+        <encoder>\n+\t\t\t<pattern>${FILE_LOG_PATTERN}</pattern>\n+\t\t</encoder>\n+\t\t<file>log/alertAudit.log</file>\n+\t\t<rollingPolicy class=\"ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy\">\n+\t\t\t<cleanHistoryOnStart>${LOG_FILE_CLEAN_HISTORY_ON_START:-false}</cleanHistoryOnStart>\n+\t\t\t<fileNamePattern>${ROLLING_FILE_NAME_PATTERN:-log/alertAudit.log.%d{yyyy-MM-dd}.%i.gz}</fileNamePattern>\n+\t\t\t<maxFileSize>${LOG_FILE_MAX_SIZE:-10MB}</maxFileSize>", "originalCommit": "9f543990d4449b1d052331da8adb1b236e0b253d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzU1MjA4Nw==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1234#discussion_r513552087", "bodyText": "The appender here is actually a copy of the default file appender used by spring to generate our current blackduck-alert.log file. The only difference here is the path that it is being logged to. The default values here are already the same ones we are using in the alert logs.", "author": "ChomickiM", "createdAt": "2020-10-28T15:45:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzU0NTk1NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzcwMzQ3OA==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1234#discussion_r513703478", "bodyText": "I agree with Gavin here, the default for both should be increased to 50 - 250MB.", "author": "jamesrichard91", "createdAt": "2020-10-28T19:23:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzU0NTk1NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzcwODg5Ng==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1234#discussion_r513708896", "bodyText": "This value can also be controlled for both logs by setting logging.file.max-size to the desired size, might be easier to set it there depending on the customer and how big the logs they produce are", "author": "ChomickiM", "createdAt": "2020-10-28T19:33:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzU0NTk1NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDIzMDkzMg==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1234#discussion_r514230932", "bodyText": "The property logging.file.max-size would be a property in the application.properties file which isn't exposed to the customer.  I would suggest adding that property to the application.properties file and also creating an environment variable so it can be controlled by support, devops, or the customer.\nSomething like this.\nlogging.file.max-size=${ALERT_LOG_FILE_SIZE:50MB}", "author": "psantos1113", "createdAt": "2020-10-29T12:47:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzU0NTk1NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzU0NjU5MQ==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1234#discussion_r513546591", "bodyText": "Will zero here prevent us from logging at all or is it \"unlimited\"?", "author": "gkillough", "createdAt": "2020-10-28T15:38:22Z", "path": "src/main/resources/logback-spring.xml", "diffHunk": "@@ -0,0 +1,24 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<configuration>\n+\n+    <include resource=\"org/springframework/boot/logging/logback/base.xml\"/>\n+\n+    <appender name=\"ALERT_AUDIT\" class=\"ch.qos.logback.core.rolling.RollingFileAppender\">\n+        <encoder>\n+\t\t\t<pattern>${FILE_LOG_PATTERN}</pattern>\n+\t\t</encoder>\n+\t\t<file>log/alertAudit.log</file>\n+\t\t<rollingPolicy class=\"ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy\">\n+\t\t\t<cleanHistoryOnStart>${LOG_FILE_CLEAN_HISTORY_ON_START:-false}</cleanHistoryOnStart>\n+\t\t\t<fileNamePattern>${ROLLING_FILE_NAME_PATTERN:-log/alertAudit.log.%d{yyyy-MM-dd}.%i.gz}</fileNamePattern>\n+\t\t\t<maxFileSize>${LOG_FILE_MAX_SIZE:-10MB}</maxFileSize>\n+\t\t\t<maxHistory>${LOG_FILE_MAX_HISTORY:-7}</maxHistory>\n+\t\t\t<totalSizeCap>${LOG_FILE_TOTAL_SIZE_CAP:-0}</totalSizeCap>", "originalCommit": "9f543990d4449b1d052331da8adb1b236e0b253d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzU2MTE4NQ==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1234#discussion_r513561185", "bodyText": "I'm looking for an answer still to this specific property to see if a value of 0 is considered unlimited. But regardless this logging is still successfully writing to the alertAudit file", "author": "ChomickiM", "createdAt": "2020-10-28T15:56:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzU0NjU5MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzU1NzQwNA==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1234#discussion_r513557404", "bodyText": "This is the value that will appear in the logs, correct? If so, I don't think it should be camel case. Perhaps match the class format?", "author": "bamandel", "createdAt": "2020-10-28T15:51:39Z", "path": "alert-common/src/main/java/com/synopsys/integration/alert/common/logging/AlertLoggerFactory.java", "diffHunk": "@@ -0,0 +1,45 @@\n+/**\n+ * alert-common\n+ *\n+ * Copyright (c) 2020 Synopsys, Inc.\n+ *\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership. The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package com.synopsys.integration.alert.common.logging;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+public class AlertLoggerFactory {\n+\n+    public static final String ALERT_AUDIT_LOGGER = \"alertAudit\";", "originalCommit": "9f543990d4449b1d052331da8adb1b236e0b253d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzU1OTY4MQ==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1234#discussion_r513559681", "bodyText": "Is the format strange here? I'm not sure if it's github or if it's actually offset", "author": "bamandel", "createdAt": "2020-10-28T15:54:32Z", "path": "src/main/resources/logback-spring.xml", "diffHunk": "@@ -0,0 +1,24 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<configuration>\n+\n+    <include resource=\"org/springframework/boot/logging/logback/base.xml\"/>\n+\n+    <appender name=\"ALERT_AUDIT\" class=\"ch.qos.logback.core.rolling.RollingFileAppender\">\n+        <encoder>\n+\t\t\t<pattern>${FILE_LOG_PATTERN}</pattern>\n+\t\t</encoder>\n+\t\t<file>log/alertAudit.log</file>", "originalCommit": "9f543990d4449b1d052331da8adb1b236e0b253d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzU2MjE4NA==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1234#discussion_r513562184", "bodyText": "I believe its Github, it looks normal in the IDE.", "author": "ChomickiM", "createdAt": "2020-10-28T15:57:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzU1OTY4MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzU2MTQzMQ==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1234#discussion_r513561431", "bodyText": "I think this would need to change if we change the logger name in my other comment?", "author": "bamandel", "createdAt": "2020-10-28T15:56:41Z", "path": "src/main/resources/logback-spring.xml", "diffHunk": "@@ -0,0 +1,24 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<configuration>\n+\n+    <include resource=\"org/springframework/boot/logging/logback/base.xml\"/>\n+\n+    <appender name=\"ALERT_AUDIT\" class=\"ch.qos.logback.core.rolling.RollingFileAppender\">\n+        <encoder>\n+\t\t\t<pattern>${FILE_LOG_PATTERN}</pattern>\n+\t\t</encoder>\n+\t\t<file>log/alertAudit.log</file>\n+\t\t<rollingPolicy class=\"ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy\">\n+\t\t\t<cleanHistoryOnStart>${LOG_FILE_CLEAN_HISTORY_ON_START:-false}</cleanHistoryOnStart>\n+\t\t\t<fileNamePattern>${ROLLING_FILE_NAME_PATTERN:-log/alertAudit.log.%d{yyyy-MM-dd}.%i.gz}</fileNamePattern>\n+\t\t\t<maxFileSize>${LOG_FILE_MAX_SIZE:-10MB}</maxFileSize>\n+\t\t\t<maxHistory>${LOG_FILE_MAX_HISTORY:-7}</maxHistory>\n+\t\t\t<totalSizeCap>${LOG_FILE_TOTAL_SIZE_CAP:-0}</totalSizeCap>\n+\t\t</rollingPolicy>\n+    </appender>\n+\n+\t<logger name=\"alertAudit\" level=\"trace\" additivity=\"false\">", "originalCommit": "9f543990d4449b1d052331da8adb1b236e0b253d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzU2MzE1Mg==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1234#discussion_r513563152", "bodyText": "Yes, whatever the logger name is here is what we will need to use in the AlertLoggerFactory.", "author": "ChomickiM", "createdAt": "2020-10-28T15:58:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzU2MTQzMQ=="}], "type": "inlineReview"}, {"oid": "0734fbdf510f52f6fc101b156ea7ae7eb92cdbc9", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/0734fbdf510f52f6fc101b156ea7ae7eb92cdbc9", "message": "style: Change logger name to Alert Audit", "committedDate": "2020-10-28T17:38:00Z", "type": "commit"}, {"oid": "402ca66586b893f751d7b97e89f539459783313b", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/402ca66586b893f751d7b97e89f539459783313b", "message": "refactor: Updating totalSizeCap for auditLog to max at 1GB", "committedDate": "2020-10-28T18:30:21Z", "type": "commit"}, {"oid": "7d9f008dd1a0d86a8595bf2d2b00ddeccb4c71e0", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/7d9f008dd1a0d86a8595bf2d2b00ddeccb4c71e0", "message": "style: Renaming log file to alert_audit and exposing logging.file.max-size in application,.properties", "committedDate": "2020-10-29T13:34:58Z", "type": "commit"}]}