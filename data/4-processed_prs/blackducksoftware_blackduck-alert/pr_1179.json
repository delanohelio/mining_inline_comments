{"pr_number": 1179, "pr_title": "Create a copy of the Microsoft work item", "pr_createdAt": "2020-09-22T19:39:43Z", "pr_url": "https://github.com/blackducksoftware/blackduck-alert/pull/1179", "timeline": [{"oid": "16621f01530b12d420d42025e001ec881bf4ed17", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/16621f01530b12d420d42025e001ec881bf4ed17", "message": "Fix: Create a copy of the Microsoft work item so it can be modified and we can add custom fields to it", "committedDate": "2020-09-22T19:30:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjk4OTY4NQ==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1179#discussion_r492989685", "bodyText": "Can we extract this into its own method?", "author": "gkillough", "createdAt": "2020-09-22T19:43:44Z", "path": "src/main/java/com/synopsys/integration/alert/channel/azure/boards/service/AzureCustomFieldManager.java", "diffHunk": "@@ -194,12 +197,22 @@ private String getProjectPropertyValue(TeamProjectReferenceResponseModel project\n     private String getWorkItemTypeRefName(String processId, String workItemTypeName) throws AlertException {\n         try {\n             AzureArrayResponseModel<ProcessWorkItemTypesResponseModel> processWorkItemTypes = processService.getWorkItemTypes(organizationName, processId);\n-            return processWorkItemTypes.getValue()\n-                       .stream()\n-                       .filter(workItemType -> workItemType.getName().equals(workItemTypeName))\n-                       .map(ProcessWorkItemTypesResponseModel::getReferenceName)\n-                       .findFirst()\n-                       .orElseThrow(() -> new AlertException(String.format(\"No work item type '%s' exists for the Azure process with id: '%s'\", workItemTypeName, processId)));\n+            ProcessWorkItemTypesResponseModel matchingWorkItemType = processWorkItemTypes.getValue()\n+                                                                         .stream()\n+                                                                         .filter(workItemType -> workItemType.getName().equals(workItemTypeName))\n+                                                                         .findFirst()\n+                                                                         .orElseThrow(\n+                                                                             () -> new AlertException(String.format(\"No work item type '%s' exists for the Azure process with id: '%s'\", workItemTypeName, processId)));\n+\n+            if (matchingWorkItemType.getReferenceName().startsWith(UNMODIFIABLE_WORK_ITEM_PREFIX)) {\n+                // if the reference name starts with this prefix, we know it is a system default so it can not be modified and fields can not be added to it, so we need to create a \"copy\" of it\n+                try {\n+                    matchingWorkItemType = processService.createWorkItemType(organizationName, processId, ProcessWorkItemTypeRequestModel.copyWorkItem(matchingWorkItemType));\n+                } catch (IOException e) {\n+                    throw new AlertException(String.format(\"There was a problem creating a modifiable work item from % in the Azure process with id: %s\", matchingWorkItemType.getReferenceName(), processId), e);\n+                }", "originalCommit": "16621f01530b12d420d42025e001ec881bf4ed17", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "77a4e1d09ed00b7984b2d6818c5f477604b6e168", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/77a4e1d09ed00b7984b2d6818c5f477604b6e168", "message": "Refactor: Moving code into a separate method", "committedDate": "2020-09-22T19:50:39Z", "type": "commit"}, {"oid": "d5a52717f014761ca8d93dc6198d7d98d1189637", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/d5a52717f014761ca8d93dc6198d7d98d1189637", "message": "Refactor: Changing the code back to the original style with the try/catch for copying moved into a new method.", "committedDate": "2020-09-22T20:07:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzAwMzI0NQ==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1179#discussion_r493003245", "bodyText": "can you just return here?", "author": "bamandel", "createdAt": "2020-09-22T20:09:10Z", "path": "src/main/java/com/synopsys/integration/alert/channel/azure/boards/service/AzureCustomFieldManager.java", "diffHunk": "@@ -191,15 +194,31 @@ private String getProjectPropertyValue(TeamProjectReferenceResponseModel project\n         }\n     }\n \n+    private ProcessWorkItemTypesResponseModel copyWorkItem(String processId, ProcessWorkItemTypesResponseModel workItemType) throws AlertException {\n+        ProcessWorkItemTypesResponseModel newWorkItemType;\n+        try {\n+            newWorkItemType = processService.createWorkItemType(organizationName, processId, ProcessWorkItemTypeRequestModel.copyWorkItem(workItemType));", "originalCommit": "d5a52717f014761ca8d93dc6198d7d98d1189637", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "825f77d4c3e761655afb3cedf80961eab142e0bc", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/825f77d4c3e761655afb3cedf80961eab142e0bc", "message": "Refactor: simplifying the copyWorkItem method", "committedDate": "2020-09-22T20:11:46Z", "type": "commit"}]}