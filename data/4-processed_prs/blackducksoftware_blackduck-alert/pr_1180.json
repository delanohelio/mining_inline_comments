{"pr_number": 1180, "pr_title": "audit controller", "pr_createdAt": "2020-09-22T19:46:27Z", "pr_url": "https://github.com/blackducksoftware/blackduck-alert/pull/1180", "timeline": [{"oid": "bad6b6442df025b49d5b874d68a60833fa0dde40", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/bad6b6442df025b49d5b874d68a60833fa0dde40", "message": "refactor: Convert to use ActionResponse.", "committedDate": "2020-09-22T12:44:33Z", "type": "commit"}, {"oid": "100f6710a5b62c6e2c9b43dcd225db96301ada2a", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/100f6710a5b62c6e2c9b43dcd225db96301ada2a", "message": "test: Fix tests and move to web/api/audit for consistency.", "committedDate": "2020-09-22T13:30:35Z", "type": "commit"}, {"oid": "3d04fb6bc8cb79519c20f1eeebc34b7559ee0ada", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/3d04fb6bc8cb79519c20f1eeebc34b7559ee0ada", "message": "refactor: Replace AlertPageModel with AuditEntryPageModel for audit.", "committedDate": "2020-09-22T19:32:26Z", "type": "commit"}, {"oid": "51487d0ec63643fc5c4be9b052dda0f189252f73", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/51487d0ec63643fc5c4be9b052dda0f189252f73", "message": "test: Fix tests with AuditEntryPageModel and add missing test.", "committedDate": "2020-09-22T19:33:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzAwMjk4OQ==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1180#discussion_r493002989", "bodyText": "Wouldn't this be an INTERNAL_SERVER_ERROR since we return the GONE response if there are issues with the two input fields? Maybe this try-catch is too big and we need two to handle the BAD_REQUEST case and the INTERNAL_SERVER_ERROR case?", "author": "gkillough", "createdAt": "2020-09-22T20:08:43Z", "path": "src/main/java/com/synopsys/integration/alert/web/api/audit/AuditEntryActions.java", "diffHunk": "@@ -31,102 +31,135 @@\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpStatus;\n import org.springframework.stereotype.Component;\n import org.springframework.transaction.annotation.Transactional;\n \n+import com.synopsys.integration.alert.common.action.ActionResponse;\n import com.synopsys.integration.alert.common.channel.ChannelEventManager;\n import com.synopsys.integration.alert.common.descriptor.accessor.AuditUtility;\n+import com.synopsys.integration.alert.common.enumeration.ConfigContextEnum;\n import com.synopsys.integration.alert.common.event.DistributionEvent;\n-import com.synopsys.integration.alert.common.exception.AlertJobMissingException;\n-import com.synopsys.integration.alert.common.exception.AlertNotificationPurgedException;\n import com.synopsys.integration.alert.common.persistence.accessor.ConfigurationAccessor;\n import com.synopsys.integration.alert.common.persistence.accessor.NotificationManager;\n import com.synopsys.integration.alert.common.persistence.model.AuditEntryModel;\n+import com.synopsys.integration.alert.common.persistence.model.AuditEntryPageModel;\n import com.synopsys.integration.alert.common.persistence.model.AuditJobStatusModel;\n import com.synopsys.integration.alert.common.persistence.model.ConfigurationJobModel;\n import com.synopsys.integration.alert.common.rest.model.AlertNotificationModel;\n-import com.synopsys.integration.alert.common.rest.model.AlertPagedModel;\n+import com.synopsys.integration.alert.common.security.authorization.AuthorizationManager;\n import com.synopsys.integration.alert.common.workflow.processor.notification.NotificationProcessor;\n+import com.synopsys.integration.alert.component.audit.AuditDescriptorKey;\n import com.synopsys.integration.exception.IntegrationException;\n \n @Component\n @Transactional\n public class AuditEntryActions {\n     private final Logger logger = LoggerFactory.getLogger(AuditEntryActions.class);\n \n+    private final AuthorizationManager authorizationManager;\n+    private final AuditDescriptorKey descriptorKey;\n     private final AuditUtility auditUtility;\n     private final NotificationManager notificationManager;\n     private final ConfigurationAccessor jobConfigReader;\n     private final ChannelEventManager eventManager;\n     private final NotificationProcessor notificationProcessor;\n \n     @Autowired\n-    public AuditEntryActions(AuditUtility auditUtility, NotificationManager notificationManager, ConfigurationAccessor jobConfigReader, ChannelEventManager eventManager, NotificationProcessor notificationProcessor) {\n+    public AuditEntryActions(AuthorizationManager authorizationManager, AuditDescriptorKey descriptorKey, AuditUtility auditUtility, NotificationManager notificationManager, ConfigurationAccessor jobConfigReader,\n+        ChannelEventManager eventManager, NotificationProcessor notificationProcessor) {\n+        this.authorizationManager = authorizationManager;\n+        this.descriptorKey = descriptorKey;\n         this.auditUtility = auditUtility;\n         this.notificationManager = notificationManager;\n         this.jobConfigReader = jobConfigReader;\n         this.eventManager = eventManager;\n         this.notificationProcessor = notificationProcessor;\n     }\n \n-    public AlertPagedModel<AuditEntryModel> get() {\n+    public ActionResponse<AuditEntryPageModel> get() {\n         return get(null, null, null, null, null, false);\n     }\n \n-    public AlertPagedModel<AuditEntryModel> get(Integer pageNumber, Integer pageSize, String searchTerm, String sortField, String sortOrder, boolean onlyShowSentNotifications) {\n-        AlertPagedModel<AuditEntryModel> pagedRestModel = auditUtility.getPageOfAuditEntries(pageNumber, pageSize, searchTerm, sortField, sortOrder, onlyShowSentNotifications, auditUtility::convertToAuditEntryModelFromNotification);\n+    public ActionResponse<AuditEntryPageModel> get(Integer pageNumber, Integer pageSize, String searchTerm, String sortField, String sortOrder, boolean onlyShowSentNotifications) {\n+        if (!authorizationManager.hasReadPermission(ConfigContextEnum.GLOBAL.name(), descriptorKey.getUniversalKey())) {\n+            return new ActionResponse<>(HttpStatus.FORBIDDEN, ActionResponse.FORBIDDEN_MESSAGE);\n+        }\n+        AuditEntryPageModel pagedRestModel = auditUtility.getPageOfAuditEntries(pageNumber, pageSize, searchTerm, sortField, sortOrder, onlyShowSentNotifications, auditUtility::convertToAuditEntryModelFromNotification);\n         logger.debug(\"Paged Audit Entry Rest Model: {}\", pagedRestModel);\n-        return pagedRestModel;\n+        return new ActionResponse<>(HttpStatus.OK, pagedRestModel);\n     }\n \n-    public Optional<AuditEntryModel> get(Long id) {\n-        if (id != null) {\n-            Optional<AlertNotificationModel> notificationContent = notificationManager.findById(id);\n-            return notificationContent.map(auditUtility::convertToAuditEntryModelFromNotification);\n+    public ActionResponse<AuditEntryModel> get(Long id) {\n+        if (!authorizationManager.hasReadPermission(ConfigContextEnum.GLOBAL.name(), descriptorKey.getUniversalKey())) {\n+            return new ActionResponse<>(HttpStatus.FORBIDDEN, ActionResponse.FORBIDDEN_MESSAGE);\n+        }\n+        Optional<AlertNotificationModel> notificationContent = notificationManager.findById(id);\n+        if (notificationContent.isPresent()) {\n+            AuditEntryModel auditEntryModel = auditUtility.convertToAuditEntryModelFromNotification(notificationContent.get());\n+            return new ActionResponse<>(HttpStatus.OK, auditEntryModel);\n         }\n-        return Optional.empty();\n+        return new ActionResponse<>(HttpStatus.GONE, \"This Audit entry could not be found.\");\n     }\n \n-    public Optional<AuditJobStatusModel> getAuditInfoForJob(UUID jobId) {\n-        if (jobId != null) {\n-            return auditUtility.findFirstByJobId(jobId);\n+    public ActionResponse<AuditJobStatusModel> getAuditInfoForJob(UUID jobId) {\n+        if (!authorizationManager.hasReadPermission(ConfigContextEnum.GLOBAL.name(), descriptorKey.getUniversalKey())) {\n+            return new ActionResponse<>(HttpStatus.FORBIDDEN, ActionResponse.FORBIDDEN_MESSAGE);\n+        }\n+        Optional<AuditJobStatusModel> auditJobStatusModel = auditUtility.findFirstByJobId(jobId);\n+        if (auditJobStatusModel.isPresent()) {\n+            return new ActionResponse<>(HttpStatus.OK, auditJobStatusModel.get());\n         }\n-        return Optional.empty();\n+        return new ActionResponse<>(HttpStatus.GONE, \"The Audit information could not be found for this job.\");\n     }\n \n-    public AlertPagedModel<AuditEntryModel> resendNotification(Long notificationId, UUID commonConfigId) throws IntegrationException {\n-        AlertNotificationModel notificationContent = notificationManager\n-                                                         .findById(notificationId)\n-                                                         .orElseThrow(() -> new AlertNotificationPurgedException(\"No notification with this id exists.\"));\n-        List<DistributionEvent> distributionEvents;\n-        if (null != commonConfigId) {\n-            ConfigurationJobModel commonDistributionConfig = jobConfigReader.getJobById(commonConfigId).orElseThrow(() -> {\n-                logger.warn(\"The Distribution Job with Id {} could not be found. This notification could not be sent\", commonConfigId);\n-                return new AlertJobMissingException(\"The Distribution Job with this id could not be found.\", commonConfigId);\n-            });\n-            if (commonDistributionConfig.isEnabled()) {\n-                distributionEvents = notificationProcessor.processNotifications(commonDistributionConfig, List.of(notificationContent));\n+    public ActionResponse<AuditEntryPageModel> resendNotification(Long notificationId, UUID commonConfigId) {\n+        if (!authorizationManager.hasExecutePermission(ConfigContextEnum.GLOBAL.name(), descriptorKey.getUniversalKey())) {\n+            return new ActionResponse<>(HttpStatus.FORBIDDEN, ActionResponse.FORBIDDEN_MESSAGE);\n+        }\n+        try {\n+            Optional<AlertNotificationModel> notification = notificationManager\n+                                                                .findById(notificationId);\n+            if (notification.isEmpty()) {\n+                return new ActionResponse<>(HttpStatus.GONE, \"No notification with this id exists.\");\n+            }\n+            AlertNotificationModel notificationContent = notification.get();\n+\n+            List<DistributionEvent> distributionEvents;\n+            if (null != commonConfigId) {\n+                Optional<ConfigurationJobModel> commonDistributionConfig = jobConfigReader.getJobById(commonConfigId);\n+                if (commonDistributionConfig.isEmpty()) {\n+                    String message = String.format(\"The Distribution Job with this id could not be found. %s\", commonConfigId.toString());\n+                    return new ActionResponse<>(HttpStatus.GONE, message);\n+                }\n+                ConfigurationJobModel commonConfig = commonDistributionConfig.get();\n+                if (commonConfig.isEnabled()) {\n+                    distributionEvents = notificationProcessor.processNotifications(commonConfig, List.of(notificationContent));\n+                } else {\n+                    UUID jobConfigId = commonConfig.getJobId();\n+                    logger.warn(\"The Distribution Job with Id {} was disabled. This notification could not be sent\", jobConfigId);\n+                    String message = String.format(\"The Distribution Job is currently disabled. %s\", jobConfigId.toString());\n+                    return new ActionResponse<>(HttpStatus.GONE, message);\n+                }\n             } else {\n-                UUID jobConfigId = commonDistributionConfig.getJobId();\n-                logger.warn(\"The Distribution Job with Id {} was disabled. This notification could not be sent\", jobConfigId);\n-                throw new AlertJobMissingException(\"The Distribution Job is currently disabled.\", jobConfigId);\n+                distributionEvents = notificationProcessor.processNotifications(List.of(notificationContent));\n+            }\n+            if (distributionEvents.isEmpty()) {\n+                logger.warn(\"This notification could not be sent. Make sure you have a Distribution Job configured to handle this notification.\");\n             }\n-        } else {\n-            distributionEvents = notificationProcessor.processNotifications(List.of(notificationContent));\n-        }\n-        if (distributionEvents.isEmpty()) {\n-            logger.warn(\"This notification could not be sent. Make sure you have a Distribution Job configured to handle this notification.\");\n-        }\n \n-        for (DistributionEvent event : distributionEvents) {\n-            UUID commonDistributionId = UUID.fromString(event.getConfigId());\n-            Long auditId = auditUtility.findMatchingAuditId(notificationContent.getId(), commonDistributionId).orElse(null);\n-            Map<Long, Long> notificationIdToAuditId = new HashMap<>();\n-            notificationIdToAuditId.put(notificationContent.getId(), auditId);\n-            event.setNotificationIdToAuditId(notificationIdToAuditId);\n-            eventManager.sendEvent(event);\n+            for (DistributionEvent event : distributionEvents) {\n+                UUID commonDistributionId = UUID.fromString(event.getConfigId());\n+                Long auditId = auditUtility.findMatchingAuditId(notificationContent.getId(), commonDistributionId).orElse(null);\n+                Map<Long, Long> notificationIdToAuditId = new HashMap<>();\n+                notificationIdToAuditId.put(notificationContent.getId(), auditId);\n+                event.setNotificationIdToAuditId(notificationIdToAuditId);\n+                eventManager.sendEvent(event);\n+            }\n+            return get();\n+        } catch (IntegrationException e) {\n+            return new ActionResponse<>(HttpStatus.BAD_REQUEST, e.getMessage());", "originalCommit": "51487d0ec63643fc5c4be9b052dda0f189252f73", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzAwODAyNA==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1180#discussion_r493008024", "bodyText": "We can't use the new ConfigAction helper classes to cut down on duplicate code here?", "author": "bamandel", "createdAt": "2020-09-22T20:18:25Z", "path": "src/main/java/com/synopsys/integration/alert/web/api/audit/AuditEntryActions.java", "diffHunk": "@@ -31,102 +31,135 @@\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpStatus;\n import org.springframework.stereotype.Component;\n import org.springframework.transaction.annotation.Transactional;\n \n+import com.synopsys.integration.alert.common.action.ActionResponse;\n import com.synopsys.integration.alert.common.channel.ChannelEventManager;\n import com.synopsys.integration.alert.common.descriptor.accessor.AuditUtility;\n+import com.synopsys.integration.alert.common.enumeration.ConfigContextEnum;\n import com.synopsys.integration.alert.common.event.DistributionEvent;\n-import com.synopsys.integration.alert.common.exception.AlertJobMissingException;\n-import com.synopsys.integration.alert.common.exception.AlertNotificationPurgedException;\n import com.synopsys.integration.alert.common.persistence.accessor.ConfigurationAccessor;\n import com.synopsys.integration.alert.common.persistence.accessor.NotificationManager;\n import com.synopsys.integration.alert.common.persistence.model.AuditEntryModel;\n+import com.synopsys.integration.alert.common.persistence.model.AuditEntryPageModel;\n import com.synopsys.integration.alert.common.persistence.model.AuditJobStatusModel;\n import com.synopsys.integration.alert.common.persistence.model.ConfigurationJobModel;\n import com.synopsys.integration.alert.common.rest.model.AlertNotificationModel;\n-import com.synopsys.integration.alert.common.rest.model.AlertPagedModel;\n+import com.synopsys.integration.alert.common.security.authorization.AuthorizationManager;\n import com.synopsys.integration.alert.common.workflow.processor.notification.NotificationProcessor;\n+import com.synopsys.integration.alert.component.audit.AuditDescriptorKey;\n import com.synopsys.integration.exception.IntegrationException;\n \n @Component\n @Transactional\n public class AuditEntryActions {", "originalCommit": "51487d0ec63643fc5c4be9b052dda0f189252f73", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzQ0Mzk3NA==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1180#discussion_r493443974", "bodyText": "Unfortunately the classes that are there right now will require more empty implementation code.  Only the\nget(Long id) matches one of the method signatures.  Once we have all the Action and controller classes converted to return ActionResponses another pass on the classes we have in case improvements can be made.", "author": "psantos1113", "createdAt": "2020-09-23T10:50:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzAwODAyNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzAxMjUwNw==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1180#discussion_r493012507", "bodyText": "If the job is disabled, shouldn't this be a BAD_REQUEST response instead of GONE?", "author": "jamesrichard91", "createdAt": "2020-09-22T20:26:38Z", "path": "src/main/java/com/synopsys/integration/alert/web/api/audit/AuditEntryActions.java", "diffHunk": "@@ -31,102 +31,135 @@\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpStatus;\n import org.springframework.stereotype.Component;\n import org.springframework.transaction.annotation.Transactional;\n \n+import com.synopsys.integration.alert.common.action.ActionResponse;\n import com.synopsys.integration.alert.common.channel.ChannelEventManager;\n import com.synopsys.integration.alert.common.descriptor.accessor.AuditUtility;\n+import com.synopsys.integration.alert.common.enumeration.ConfigContextEnum;\n import com.synopsys.integration.alert.common.event.DistributionEvent;\n-import com.synopsys.integration.alert.common.exception.AlertJobMissingException;\n-import com.synopsys.integration.alert.common.exception.AlertNotificationPurgedException;\n import com.synopsys.integration.alert.common.persistence.accessor.ConfigurationAccessor;\n import com.synopsys.integration.alert.common.persistence.accessor.NotificationManager;\n import com.synopsys.integration.alert.common.persistence.model.AuditEntryModel;\n+import com.synopsys.integration.alert.common.persistence.model.AuditEntryPageModel;\n import com.synopsys.integration.alert.common.persistence.model.AuditJobStatusModel;\n import com.synopsys.integration.alert.common.persistence.model.ConfigurationJobModel;\n import com.synopsys.integration.alert.common.rest.model.AlertNotificationModel;\n-import com.synopsys.integration.alert.common.rest.model.AlertPagedModel;\n+import com.synopsys.integration.alert.common.security.authorization.AuthorizationManager;\n import com.synopsys.integration.alert.common.workflow.processor.notification.NotificationProcessor;\n+import com.synopsys.integration.alert.component.audit.AuditDescriptorKey;\n import com.synopsys.integration.exception.IntegrationException;\n \n @Component\n @Transactional\n public class AuditEntryActions {\n     private final Logger logger = LoggerFactory.getLogger(AuditEntryActions.class);\n \n+    private final AuthorizationManager authorizationManager;\n+    private final AuditDescriptorKey descriptorKey;\n     private final AuditUtility auditUtility;\n     private final NotificationManager notificationManager;\n     private final ConfigurationAccessor jobConfigReader;\n     private final ChannelEventManager eventManager;\n     private final NotificationProcessor notificationProcessor;\n \n     @Autowired\n-    public AuditEntryActions(AuditUtility auditUtility, NotificationManager notificationManager, ConfigurationAccessor jobConfigReader, ChannelEventManager eventManager, NotificationProcessor notificationProcessor) {\n+    public AuditEntryActions(AuthorizationManager authorizationManager, AuditDescriptorKey descriptorKey, AuditUtility auditUtility, NotificationManager notificationManager, ConfigurationAccessor jobConfigReader,\n+        ChannelEventManager eventManager, NotificationProcessor notificationProcessor) {\n+        this.authorizationManager = authorizationManager;\n+        this.descriptorKey = descriptorKey;\n         this.auditUtility = auditUtility;\n         this.notificationManager = notificationManager;\n         this.jobConfigReader = jobConfigReader;\n         this.eventManager = eventManager;\n         this.notificationProcessor = notificationProcessor;\n     }\n \n-    public AlertPagedModel<AuditEntryModel> get() {\n+    public ActionResponse<AuditEntryPageModel> get() {\n         return get(null, null, null, null, null, false);\n     }\n \n-    public AlertPagedModel<AuditEntryModel> get(Integer pageNumber, Integer pageSize, String searchTerm, String sortField, String sortOrder, boolean onlyShowSentNotifications) {\n-        AlertPagedModel<AuditEntryModel> pagedRestModel = auditUtility.getPageOfAuditEntries(pageNumber, pageSize, searchTerm, sortField, sortOrder, onlyShowSentNotifications, auditUtility::convertToAuditEntryModelFromNotification);\n+    public ActionResponse<AuditEntryPageModel> get(Integer pageNumber, Integer pageSize, String searchTerm, String sortField, String sortOrder, boolean onlyShowSentNotifications) {\n+        if (!authorizationManager.hasReadPermission(ConfigContextEnum.GLOBAL.name(), descriptorKey.getUniversalKey())) {\n+            return new ActionResponse<>(HttpStatus.FORBIDDEN, ActionResponse.FORBIDDEN_MESSAGE);\n+        }\n+        AuditEntryPageModel pagedRestModel = auditUtility.getPageOfAuditEntries(pageNumber, pageSize, searchTerm, sortField, sortOrder, onlyShowSentNotifications, auditUtility::convertToAuditEntryModelFromNotification);\n         logger.debug(\"Paged Audit Entry Rest Model: {}\", pagedRestModel);\n-        return pagedRestModel;\n+        return new ActionResponse<>(HttpStatus.OK, pagedRestModel);\n     }\n \n-    public Optional<AuditEntryModel> get(Long id) {\n-        if (id != null) {\n-            Optional<AlertNotificationModel> notificationContent = notificationManager.findById(id);\n-            return notificationContent.map(auditUtility::convertToAuditEntryModelFromNotification);\n+    public ActionResponse<AuditEntryModel> get(Long id) {\n+        if (!authorizationManager.hasReadPermission(ConfigContextEnum.GLOBAL.name(), descriptorKey.getUniversalKey())) {\n+            return new ActionResponse<>(HttpStatus.FORBIDDEN, ActionResponse.FORBIDDEN_MESSAGE);\n+        }\n+        Optional<AlertNotificationModel> notificationContent = notificationManager.findById(id);\n+        if (notificationContent.isPresent()) {\n+            AuditEntryModel auditEntryModel = auditUtility.convertToAuditEntryModelFromNotification(notificationContent.get());\n+            return new ActionResponse<>(HttpStatus.OK, auditEntryModel);\n         }\n-        return Optional.empty();\n+        return new ActionResponse<>(HttpStatus.GONE, \"This Audit entry could not be found.\");\n     }\n \n-    public Optional<AuditJobStatusModel> getAuditInfoForJob(UUID jobId) {\n-        if (jobId != null) {\n-            return auditUtility.findFirstByJobId(jobId);\n+    public ActionResponse<AuditJobStatusModel> getAuditInfoForJob(UUID jobId) {\n+        if (!authorizationManager.hasReadPermission(ConfigContextEnum.GLOBAL.name(), descriptorKey.getUniversalKey())) {\n+            return new ActionResponse<>(HttpStatus.FORBIDDEN, ActionResponse.FORBIDDEN_MESSAGE);\n+        }\n+        Optional<AuditJobStatusModel> auditJobStatusModel = auditUtility.findFirstByJobId(jobId);\n+        if (auditJobStatusModel.isPresent()) {\n+            return new ActionResponse<>(HttpStatus.OK, auditJobStatusModel.get());\n         }\n-        return Optional.empty();\n+        return new ActionResponse<>(HttpStatus.GONE, \"The Audit information could not be found for this job.\");\n     }\n \n-    public AlertPagedModel<AuditEntryModel> resendNotification(Long notificationId, UUID commonConfigId) throws IntegrationException {\n-        AlertNotificationModel notificationContent = notificationManager\n-                                                         .findById(notificationId)\n-                                                         .orElseThrow(() -> new AlertNotificationPurgedException(\"No notification with this id exists.\"));\n-        List<DistributionEvent> distributionEvents;\n-        if (null != commonConfigId) {\n-            ConfigurationJobModel commonDistributionConfig = jobConfigReader.getJobById(commonConfigId).orElseThrow(() -> {\n-                logger.warn(\"The Distribution Job with Id {} could not be found. This notification could not be sent\", commonConfigId);\n-                return new AlertJobMissingException(\"The Distribution Job with this id could not be found.\", commonConfigId);\n-            });\n-            if (commonDistributionConfig.isEnabled()) {\n-                distributionEvents = notificationProcessor.processNotifications(commonDistributionConfig, List.of(notificationContent));\n+    public ActionResponse<AuditEntryPageModel> resendNotification(Long notificationId, UUID commonConfigId) {\n+        if (!authorizationManager.hasExecutePermission(ConfigContextEnum.GLOBAL.name(), descriptorKey.getUniversalKey())) {\n+            return new ActionResponse<>(HttpStatus.FORBIDDEN, ActionResponse.FORBIDDEN_MESSAGE);\n+        }\n+        try {\n+            Optional<AlertNotificationModel> notification = notificationManager\n+                                                                .findById(notificationId);\n+            if (notification.isEmpty()) {\n+                return new ActionResponse<>(HttpStatus.GONE, \"No notification with this id exists.\");\n+            }\n+            AlertNotificationModel notificationContent = notification.get();\n+\n+            List<DistributionEvent> distributionEvents;\n+            if (null != commonConfigId) {\n+                Optional<ConfigurationJobModel> commonDistributionConfig = jobConfigReader.getJobById(commonConfigId);\n+                if (commonDistributionConfig.isEmpty()) {\n+                    String message = String.format(\"The Distribution Job with this id could not be found. %s\", commonConfigId.toString());\n+                    return new ActionResponse<>(HttpStatus.GONE, message);\n+                }\n+                ConfigurationJobModel commonConfig = commonDistributionConfig.get();\n+                if (commonConfig.isEnabled()) {\n+                    distributionEvents = notificationProcessor.processNotifications(commonConfig, List.of(notificationContent));\n+                } else {\n+                    UUID jobConfigId = commonConfig.getJobId();\n+                    logger.warn(\"The Distribution Job with Id {} was disabled. This notification could not be sent\", jobConfigId);\n+                    String message = String.format(\"The Distribution Job is currently disabled. %s\", jobConfigId.toString());\n+                    return new ActionResponse<>(HttpStatus.GONE, message);", "originalCommit": "51487d0ec63643fc5c4be9b052dda0f189252f73", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzQxNzM3MA==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1180#discussion_r493417370", "bodyText": "Given that the job is disabled and not deleted then BAD_REQUEST makes sense rather than GONE.", "author": "psantos1113", "createdAt": "2020-09-23T10:21:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzAxMjUwNw=="}], "type": "inlineReview"}, {"oid": "34f68ac3ae3849e89055d92e93083d5d150c21a7", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/34f68ac3ae3849e89055d92e93083d5d150c21a7", "message": "refactor: Change the http status codes.", "committedDate": "2020-09-23T10:51:39Z", "type": "commit"}]}