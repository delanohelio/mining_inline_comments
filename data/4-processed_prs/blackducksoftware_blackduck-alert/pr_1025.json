{"pr_number": 1025, "pr_title": "Build: Adding task to push the helm chart", "pr_createdAt": "2020-06-17T22:23:31Z", "pr_url": "https://github.com/blackducksoftware/blackduck-alert/pull/1025", "timeline": [{"oid": "7f9263ba7f2e4e71270899260e0dc4fb709d5e5e", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/7f9263ba7f2e4e71270899260e0dc4fb709d5e5e", "message": "Build: Adding task to push the helm chart", "committedDate": "2020-06-17T22:15:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTkwMDkxNw==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1025#discussion_r441900917", "bodyText": "We could see if we could run the repo add command on the Jenkins node and add a comment here with the command to run in case we need to setup Helm on the node again.", "author": "jamesrichard91", "createdAt": "2020-06-18T00:17:23Z", "path": "buildSrc/deploymentTasks.gradle", "diffHunk": "@@ -56,3 +56,13 @@ task helmValidation(dependsOn: [copyDeploymentFiles, helmLint, helmDryRun, helmP\n     helmPackage.mustRunAfter helmDryRun\n }\n \n+task helmPushChart(type: Exec) {\n+    workingDir = \"${project.buildDir}/deployment/helm/synopsys-alert/\"\n+    if (!project.ext.isSnapshot) {\n+        commandLine \"helm\", \"repo\", \"add\", \"sig-cloudnative\", \"https://${System.env.ARTIFACTORY_HOST}/artifactory/sig-cloudnative\", \"&&\",", "originalCommit": "7f9263ba7f2e4e71270899260e0dc4fb709d5e5e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjE0NDU0OA==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1025#discussion_r442144548", "bodyText": "if we've added the repo already I am guessing the first part of the command will fail.  Can we use https://helm.sh/docs/helm/helm_repo_list/ command to list the repos and grep if it is present?  If it isn't present run the add command and always run the push command at the end.  Otherwise consider using the || operator instead of && So if the add repo fails because it exists it will try the push command.", "author": "psantos1113", "createdAt": "2020-06-18T11:01:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTkwMDkxNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjIwOTU1MA==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1025#discussion_r442209550", "bodyText": "I moved the repo add... into a comment in case we need to setup helm again. I also put this in a doLast block so the GradleException does not get thrown when the IDE is processing the tasks.", "author": "jamesrichard91", "createdAt": "2020-06-18T13:04:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTkwMDkxNw=="}], "type": "inlineReview"}, {"oid": "96a9bdf6b96f76e6850414b8e13d8d1e4f6ec210", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/96a9bdf6b96f76e6850414b8e13d8d1e4f6ec210", "message": "Build: Updating the helmPushChart task.", "committedDate": "2020-06-18T13:02:01Z", "type": "commit"}]}