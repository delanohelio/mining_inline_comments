{"pr_number": 887, "pr_title": "feat(project-report): Layout and content update in project report", "pr_createdAt": "2020-06-15T14:05:06Z", "pr_url": "https://github.com/eclipse/sw360/pull/887", "timeline": [{"oid": "f2d0d6011d5cdd11443cbe129e4a51c051bb13a7", "url": "https://github.com/eclipse/sw360/commit/f2d0d6011d5cdd11443cbe129e4a51c051bb13a7", "message": "feat(project-report): Layout and content update in project report\n\n\t* Renamed todo to obligation in admin section.\n        * Now different levels of obligations(viz. organisation obligation, project obligation etc.) can be added in that section, the same will be\n          reflected in administration section of individual project, where user can choose fill the fulfillment details of the obligation.\n        * In product clearing report chapter 1.4.3 and 1.4.4 if there is no content per default the shall be the sentences \"No commercial 3rd party software is used\".\n        * Common rules table renamed to Organisation obligation.\n        * Additional requirement table renamed to component obligation.\n        * Added a table for project level obligation.\n        * Spliited the additional component obligation table license wise.\n          etc.\n\nSigned-off-by: Smruti Sahoo <smruti.sahoo@siemens.com>", "committedDate": "2020-06-18T13:33:03Z", "type": "forcePushed"}, {"oid": "42bd47e6f6b49c658a03a00db8a1f848b3cc572b", "url": "https://github.com/eclipse/sw360/commit/42bd47e6f6b49c658a03a00db8a1f848b3cc572b", "message": "feat(project-report): Layout and content update in project report\n\n\t* Renamed todo to obligation in admin section.\n        * Now different levels of obligations(viz. organisation obligation, project obligation etc.) can be added in that section, the same will be\n          reflected in administration section of individual project, where user can choose fill the fulfillment details of the obligation.\n        * In product clearing report chapter 1.4.3 and 1.4.4 if there is no content per default the shall be the sentences \"No commercial 3rd party software is used\".\n        * Common rules table renamed to Organisation obligation.\n        * Additional requirement table renamed to component obligation.\n        * Added a table for project level obligation.\n        * Spliited the additional component obligation table license wise.\n          etc.\n\nSigned-off-by: Smruti Sahoo <smruti.sahoo@siemens.com>", "committedDate": "2020-06-19T05:38:45Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTUxNDA0Nw==", "url": "https://github.com/eclipse/sw360/pull/887#discussion_r449514047", "bodyText": "Instead of fetching all licenses and then filtering.\nUse query to fetch all filtered licenses which contains todoDatabaseIds\nfunction(doc){\n    if (doc.type == \"license\" && \"todoDatabaseIds\" in doc){\n        emit(doc._id, doc)\n    }", "author": "JaideepPalit", "createdAt": "2020-07-03T10:38:18Z", "path": "scripts/migrations/017_migrate_todo_to_obligation.py", "diffHunk": "@@ -0,0 +1,62 @@\n+#!/usr/bin/python\n+\n+# -----------------------------------------------------------------------------\n+# Copyright Siemens AG, 2019. Part of the SW360 Portal Project.\n+#\n+# This program and the accompanying materials are made\n+# available under the terms of the Eclipse Public License 2.0\n+# which is available at https://www.eclipse.org/legal/epl-2.0/\n+#\n+# SPDX-License-Identifier: EPL-2.0\n+#\n+# This is a manual database migration script. It is assumed that a\n+# dedicated framework for automatic migration will be written in the\n+# future. When that happens, this script should be refactored to conform\n+# to the framework's prerequisites to be run by the framework. For\n+# example, server address and db name should be parametrized, the code\n+# reorganized into a single class or function, etc.\n+# -----------------------------------------------------------------------------\n+import time\n+import couchdb\n+import json\n+from webbrowser import get\n+\n+COUCHSERVER = \"http://localhost:5984/\"\n+DBNAME = 'sw360db'\n+\n+couch=couchdb.Server(COUCHSERVER)\n+db = couch[DBNAME]\n+\n+DRY_RUN = True\n+\n+licenses_by_id_fun = '''function(doc){\n+    if (doc.type==\"license\"){\n+        emit(doc._id, doc)\n+    }\n+}'''\n+\n+licenses = db.query(licenses_by_id_fun)\n+\n+def run():\n+    log = {}\n+    log['updatedLicenses'] = []\n+    for license_row in licenses:\n+        license = license_row.value\n+        if 'todoDatabaseIds' in license:", "originalCommit": "42bd47e6f6b49c658a03a00db8a1f848b3cc572b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjAxNDk3NQ==", "url": "https://github.com/eclipse/sw360/pull/887#discussion_r452014975", "bodyText": "Done", "author": "smrutis1", "createdAt": "2020-07-09T07:22:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTUxNDA0Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTUxNDI4NA==", "url": "https://github.com/eclipse/sw360/pull/887#discussion_r449514284", "bodyText": "Script no. needs to be changed and description needs to be added\nAlso script needs to be added in Readme.md", "author": "JaideepPalit", "createdAt": "2020-07-03T10:38:56Z", "path": "scripts/migrations/017_migrate_todo_to_obligation.py", "diffHunk": "@@ -0,0 +1,62 @@\n+#!/usr/bin/python\n+\n+# -----------------------------------------------------------------------------\n+# Copyright Siemens AG, 2019. Part of the SW360 Portal Project.\n+#\n+# This program and the accompanying materials are made\n+# available under the terms of the Eclipse Public License 2.0\n+# which is available at https://www.eclipse.org/legal/epl-2.0/\n+#\n+# SPDX-License-Identifier: EPL-2.0\n+#\n+# This is a manual database migration script. It is assumed that a\n+# dedicated framework for automatic migration will be written in the\n+# future. When that happens, this script should be refactored to conform\n+# to the framework's prerequisites to be run by the framework. For\n+# example, server address and db name should be parametrized, the code\n+# reorganized into a single class or function, etc.\n+# -----------------------------------------------------------------------------", "originalCommit": "42bd47e6f6b49c658a03a00db8a1f848b3cc572b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTUxNzQ4Ng==", "url": "https://github.com/eclipse/sw360/pull/887#discussion_r449517486", "bodyText": "Kindly check code formatting is missing to some place", "author": "JaideepPalit", "createdAt": "2020-07-03T10:46:22Z", "path": "frontend/sw360-portlet/src/main/java/org/eclipse/sw360/portal/portlets/projects/ProjectPortletUtils.java", "diffHunk": "@@ -148,14 +170,20 @@ private static void updateProjectTodosFromRequest(String[] ids, String userId, P\n                     projectTodo.fulfilled = false;\n                     projectTodo.setUserId(userId);\n                     projectTodo.setUpdated(updated);\n+                    projectTodo.setComments(getCommentsByTodoId(request, projectTodo.todoId));\n                     return projectTodo;\n                 })\n                 .collect(Collectors.toSet());\n \n         projectTodos.addAll(changedToNotFulfilled);\n+        projectTodos.addAll(listOfNotFulfilledProjectIds);\n         project.setTodos(projectTodos);\n     }\n \n+    public static String getCommentsByTodoId(PortletRequest request, String id) {\n+        return request.getParameter(\"projectobligation:\"+id);", "originalCommit": "42bd47e6f6b49c658a03a00db8a1f848b3cc572b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTUxNzk2NA==", "url": "https://github.com/eclipse/sw360/pull/887#discussion_r449517964", "bodyText": "Kindly escapeXml and use sw360:out jstl wherever possible\nsame for line 124", "author": "JaideepPalit", "createdAt": "2020-07-03T10:47:28Z", "path": "frontend/sw360-portlet/src/main/resources/META-INF/resources/html/projects/includes/projects/administration.jspf", "diffHunk": "@@ -97,7 +91,26 @@\n \n <table class=\"table label-value-table\" id=\"obligations\">\n     <thead>\n-        <tr><th><liferay-ui:message key=\"obligation\" /></th><th><liferay-ui:message key=\"fulfilled\" /></th><th><liferay-ui:message key=\"modified\" /></th></tr>\n+        <tr><th><liferay-ui:message key=\"organisation.obligation\" /></th><th><liferay-ui:message key=\"fulfilled\" /></th><th><liferay-ui:message key=\"modified\" /></th><th>Comments</th></tr>\n+    </thead>\n+    <tbody>\n+        <core_rt:forEach items=\"${organisationObligations}\" var=\"entry\">\n+            <tr>\n+                <td>${entry.getKey().getText()}</td>", "originalCommit": "42bd47e6f6b49c658a03a00db8a1f848b3cc572b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjAxNDgyNw==", "url": "https://github.com/eclipse/sw360/pull/887#discussion_r452014827", "bodyText": "Done", "author": "smrutis1", "createdAt": "2020-07-09T07:22:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTUxNzk2NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTUxODc5MA==", "url": "https://github.com/eclipse/sw360/pull/887#discussion_r449518790", "bodyText": "Kindly escapeXml and use sw360:out jstl whereever possible", "author": "JaideepPalit", "createdAt": "2020-07-03T10:49:19Z", "path": "frontend/sw360-portlet/src/main/resources/META-INF/resources/html/projects/includes/projects/administrationEdit.jspf", "diffHunk": "@@ -135,24 +124,46 @@\n         </td>\n     </tr>\n </table>\n-\n-<table class=\"table edit-table two-columns\" id=\"obligations\">\n+<table class=\"table edit-table three-columns\" id=\"org_obligations\">\n     <thead>\n-        <tr><th><liferay-ui:message key=\"obligation\" /></th><th><liferay-ui:message key=\"fulfilled\" /></th></tr>\n+        <tr><th><liferay-ui:message key=\"organisation.obligation\" /></th><th><liferay-ui:message key=\"fulfilled\" /></th><th>Comments</th></tr>\n     </thead>\n     <tbody>\n-        <core_rt:forEach items=\"${projectObligations}\" var=\"entry\">\n+        <core_rt:forEach items=\"${organisationObligations}\" var=\"entry\" varStatus=\"theCount\">\n             <tr>\n                 <td>${entry.getKey().getText()}</td>\n                 <td>\n                     <div class=\"form-group form-check\">\n                         <input type=\"checkbox\"\n                             name=\"<portlet:namespace/><%=Project._Fields.TODOS%>\"\n-                            value=\"${entry.getKey().getId()}\"\n+                            value =\"${entry.getKey().getId()}\"\n                             class=\"form-check-input\"\n                             <core_rt:if test=\"${entry.getValue().fulfilled}\">checked=\"checked\"</core_rt:if>/>\n                     </div>\n                 </td>\n+                <td><textarea name=\"<portlet:namespace/>projectobligation:${entry.getKey().getId()}\" placeholder=\"Enter comments here\" class=\"form-control\" type=\"text\"></textarea></td>\n+            </tr>\n+        </core_rt:forEach>\n+    </tbody>\n+</table>\n+<table class=\"table edit-table three-columns\" id=\"prod_obligations\">\n+    <thead>\n+        <tr><th><liferay-ui:message key=\"product.obligation\" /></th><th><liferay-ui:message key=\"fulfilled\" /></th><th>Comments</th></tr>\n+    </thead>\n+    <tbody>\n+        <core_rt:forEach items=\"${projectObligations}\" var=\"entry\" varStatus=\"theCount\">\n+            <tr>\n+                <td>${entry.getKey().getText()}</td>", "originalCommit": "42bd47e6f6b49c658a03a00db8a1f848b3cc572b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjAxNDc3MQ==", "url": "https://github.com/eclipse/sw360/pull/887#discussion_r452014771", "bodyText": "Done", "author": "smrutis1", "createdAt": "2020-07-09T07:22:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTUxODc5MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTUyMDAwNg==", "url": "https://github.com/eclipse/sw360/pull/887#discussion_r449520006", "bodyText": "Add error log", "author": "JaideepPalit", "createdAt": "2020-07-03T10:52:06Z", "path": "libraries/lib-datahandler/src/main/java/org/eclipse/sw360/datahandler/common/SW360Utils.java", "diffHunk": "@@ -270,13 +277,37 @@ public static String printFullname(Release release) {\n         return getReleaseFullname(vendorName, release.getName(), release.getVersion());\n     }\n \n-    public static Map<Todo, TodoInfo> getProjectObligations(Project project) {\n+    public static Map<Obligations, TodoInfo> getProjectObligations(Project project) {\n+        final LicenseService.Iface licenseClient = new ThriftClients().makeLicenseClient();\n+\n+        Set<ProjectTodo> projectTodos = project.getTodosSize() > 0 ? project.getTodos() : Collections.emptySet();\n+        try {\n+            return licenseClient.getTodos().stream()\n+                    .filter(o -> o.isValidForProject())\n+                    .filter(o -> Objects.nonNull(o.getObligationType()))\n+                    .filter(o->o.getObligationType().equals(ObligationType.PRODUCT_OBLIGATION))\n+                    .collect(Collectors.toMap(\n+                            todo -> todo,\n+                            todo -> new TodoInfo(projectTodos.stream()\n+                                        .filter(projectTodo -> projectTodo.getTodoId().equals(todo.getId()))\n+                                        .findFirst()\n+                                        .orElseGet(ProjectTodo::new))\n+                            )\n+                    );\n+        } catch (TException te) {\n+            return Collections.emptyMap();", "originalCommit": "42bd47e6f6b49c658a03a00db8a1f848b3cc572b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjAxNDY4NA==", "url": "https://github.com/eclipse/sw360/pull/887#discussion_r452014684", "bodyText": "Done", "author": "smrutis1", "createdAt": "2020-07-09T07:22:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTUyMDAwNg=="}], "type": "inlineReview"}, {"oid": "26d3d5de7649be5e9fe7303a2f3ef66981df7deb", "url": "https://github.com/eclipse/sw360/commit/26d3d5de7649be5e9fe7303a2f3ef66981df7deb", "message": "feat(project-report): Layout and content update in project report\n\n\t* Renamed todo to obligation in admin section.\n        * Now different levels of obligations(viz. organisation obligation, project obligation etc.) can be added in that section, the same will be\n          reflected in administration section of individual project, where user can choose fill the fulfillment details of the obligation.\n        * In product clearing report chapter 1.4.3 and 1.4.4 if there is no content per default the shall be the sentences \"No commercial 3rd party software is used\".\n        * Common rules table renamed to Organisation obligation.\n        * Additional requirement table renamed to component obligation.\n        * Added a table for project level obligation.\n        * Spliited the additional component obligation table license wise.\n          etc.\n\nSigned-off-by: Smruti Sahoo <smruti.sahoo@siemens.com>", "committedDate": "2020-07-08T08:00:38Z", "type": "forcePushed"}, {"oid": "45ead8a2f2c1f4e7973ab4f13980d618466215e1", "url": "https://github.com/eclipse/sw360/commit/45ead8a2f2c1f4e7973ab4f13980d618466215e1", "message": "feat(project-report): Layout and content update in project report\n\n\t* Renamed todo to obligation in admin section.\n        * Now different levels of obligations(viz. organisation obligation, project obligation etc.) can be added in that section, the same will be\n          reflected in administration section of individual project, where user can choose fill the fulfillment details of the obligation.\n        * In product clearing report chapter 1.4.3 and 1.4.4 if there is no content per default the shall be the sentences \"No commercial 3rd party software is used\".\n        * Common rules table renamed to Organisation obligation.\n        * Additional requirement table renamed to component obligation.\n        * Added a table for project level obligation.\n        * Spliited the additional component obligation table license wise.\n          etc.\n\nSigned-off-by: Smruti Sahoo <smruti.sahoo@siemens.com>", "committedDate": "2020-07-08T17:09:36Z", "type": "forcePushed"}, {"oid": "4638664bc5f6cd3a568c615afc9c1eeb4e5dc576", "url": "https://github.com/eclipse/sw360/commit/4638664bc5f6cd3a568c615afc9c1eeb4e5dc576", "message": "feat(project-report): Layout and content update in project report\n\n\t* Renamed todo to obligation in admin section.\n        * Now different levels of obligations(viz. organisation obligation, project obligation etc.) can be added in that section, the same will be\n          reflected in administration section of individual project, where user can choose fill the fulfillment details of the obligation.\n        * In product clearing report chapter 1.4.3 and 1.4.4 if there is no content per default the shall be the sentences \"No commercial 3rd party software is used\".\n        * Common rules table renamed to Organisation obligation.\n        * Additional requirement table renamed to component obligation.\n        * Added a table for project level obligation.\n        * Spliited the additional component obligation table license wise.\n          etc.\n\nSigned-off-by: Smruti Sahoo <smruti.sahoo@siemens.com>", "committedDate": "2020-07-09T07:05:43Z", "type": "forcePushed"}, {"oid": "e64e8c3e6e1783eaea67268b46d31fc99a434974", "url": "https://github.com/eclipse/sw360/commit/e64e8c3e6e1783eaea67268b46d31fc99a434974", "message": "feat(project-report): Layout and content update in project report\n\n\t* Renamed todo to obligation in admin section.\n        * Now different levels of obligations(viz. organisation obligation, project obligation etc.) can be added in that section, the same will be\n          reflected in administration section of individual project, where user can choose fill the fulfillment details of the obligation.\n        * In product clearing report chapter 1.4.3 and 1.4.4 if there is no content per default the shall be the sentences \"No commercial 3rd party software is used\".\n        * Common rules table renamed to Organisation obligation.\n        * Additional requirement table renamed to component obligation.\n        * Added a table for project level obligation.\n        * Spliited the additional component obligation table license wise.\n          etc.\n\nSigned-off-by: Smruti Sahoo <smruti.sahoo@siemens.com>", "committedDate": "2020-07-17T07:55:03Z", "type": "forcePushed"}, {"oid": "787aa1be1d8415f8d227b6d9b262a104a9073bb4", "url": "https://github.com/eclipse/sw360/commit/787aa1be1d8415f8d227b6d9b262a104a9073bb4", "message": "feat(project-report): Layout and content update in project report\n\n\t* Renamed todo to obligation in admin section.\n        * Now different levels of obligations(viz. organisation obligation, project obligation etc.) can be added in that section, the same will be\n          reflected in administration section of individual project, where user can choose fill the fulfillment details of the obligation.\n        * In product clearing report chapter 1.4.3 and 1.4.4 if there is no content per default the shall be the sentences \"No commercial 3rd party software is used\".\n        * Common rules table renamed to Organisation obligation.\n        * Additional requirement table renamed to component obligation.\n        * Added a table for project level obligation.\n        * Spliited the additional component obligation table license wise.\n          etc.\n\nSigned-off-by: Smruti Sahoo <smruti.sahoo@siemens.com>", "committedDate": "2020-07-17T10:55:11Z", "type": "forcePushed"}, {"oid": "39ea743315260096ed5bf323ea5b28871668c009", "url": "https://github.com/eclipse/sw360/commit/39ea743315260096ed5bf323ea5b28871668c009", "message": "feat(project-report): Layout and content update in project report\n\n\t* Renamed todo to obligation in admin section.\n        * Now different levels of obligations(viz. organisation obligation, project obligation etc.) can be added in that section, the same will be\n          reflected in administration section of individual project, where user can choose fill the fulfillment details of the obligation.\n        * In product clearing report chapter 1.4.3 and 1.4.4 if there is no content per default the shall be the sentences \"No commercial 3rd party software is used\".\n        * Common rules table renamed to Organisation obligation.\n        * Additional requirement table renamed to component obligation.\n        * Added a table for project level obligation.\n        * Spliited the additional component obligation table license wise.\n          etc.\n\nSigned-off-by: Smruti Sahoo <smruti.sahoo@siemens.com>", "committedDate": "2020-07-21T06:05:55Z", "type": "forcePushed"}, {"oid": "1b4f236258586a3ae131a6b4941bb0f23644fc72", "url": "https://github.com/eclipse/sw360/commit/1b4f236258586a3ae131a6b4941bb0f23644fc72", "message": "feat(project-report): Layout and content update in project report\n\n\t* Renamed todo to obligation in admin section.\n        * Now different levels of obligations(viz. organisation obligation, project obligation etc.) can be added in that section, the same will be\n          reflected in administration section of individual project, where user can choose fill the fulfillment details of the obligation.\n        * In product clearing report chapter 1.4.3 and 1.4.4 if there is no content per default the shall be the sentences \"No commercial 3rd party software is used\".\n        * Common rules table renamed to Organisation obligation.\n        * Additional requirement table renamed to component obligation.\n        * Added a table for project level obligation.\n        * Spliited the additional component obligation table license wise.\n          etc.\n\nSigned-off-by: Smruti Sahoo <smruti.sahoo@siemens.com>", "committedDate": "2020-07-22T11:15:53Z", "type": "commit"}, {"oid": "1b4f236258586a3ae131a6b4941bb0f23644fc72", "url": "https://github.com/eclipse/sw360/commit/1b4f236258586a3ae131a6b4941bb0f23644fc72", "message": "feat(project-report): Layout and content update in project report\n\n\t* Renamed todo to obligation in admin section.\n        * Now different levels of obligations(viz. organisation obligation, project obligation etc.) can be added in that section, the same will be\n          reflected in administration section of individual project, where user can choose fill the fulfillment details of the obligation.\n        * In product clearing report chapter 1.4.3 and 1.4.4 if there is no content per default the shall be the sentences \"No commercial 3rd party software is used\".\n        * Common rules table renamed to Organisation obligation.\n        * Additional requirement table renamed to component obligation.\n        * Added a table for project level obligation.\n        * Spliited the additional component obligation table license wise.\n          etc.\n\nSigned-off-by: Smruti Sahoo <smruti.sahoo@siemens.com>", "committedDate": "2020-07-22T11:15:53Z", "type": "forcePushed"}]}