{"pr_number": 939, "pr_title": "chore(script): Added a script to uninstall the current thrift version.", "pr_createdAt": "2020-08-04T09:23:42Z", "pr_url": "https://github.com/eclipse/sw360/pull/939", "timeline": [{"oid": "c06851878b6a60aca265b519d987549c2955ea7f", "url": "https://github.com/eclipse/sw360/commit/c06851878b6a60aca265b519d987549c2955ea7f", "message": "chore(script): Added support to uninstall the current thrift version.\n\nThe script to install thrift has been extended to accept a new\n\"--uninstall\" parameter. If this parameter is passed, it checks\nwhether thrift is currently installed on the local machine. If so, the\nthrift version is determined, and this version is uninstalled.\n\nThis is useful when the thrift version is updated. Then the old\nversion needs to be uninstalled first before the new one can be\ninstalled.\n\nWhen calling the script to install thrift, but an unsupported version\nis found, it now prints a message referring to the new parameter.\n\nSigned-off-by: Oliver Heger <oliver.heger@bosch.io>", "committedDate": "2020-08-18T12:21:18Z", "type": "commit"}, {"oid": "c06851878b6a60aca265b519d987549c2955ea7f", "url": "https://github.com/eclipse/sw360/commit/c06851878b6a60aca265b519d987549c2955ea7f", "message": "chore(script): Added support to uninstall the current thrift version.\n\nThe script to install thrift has been extended to accept a new\n\"--uninstall\" parameter. If this parameter is passed, it checks\nwhether thrift is currently installed on the local machine. If so, the\nthrift version is determined, and this version is uninstalled.\n\nThis is useful when the thrift version is updated. Then the old\nversion needs to be uninstalled first before the new one can be\ninstalled.\n\nWhen calling the script to install thrift, but an unsupported version\nis found, it now prints a message referring to the new parameter.\n\nSigned-off-by: Oliver Heger <oliver.heger@bosch.io>", "committedDate": "2020-08-18T12:21:18Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjE2OTI1Ng==", "url": "https://github.com/eclipse/sw360/pull/939#discussion_r486169256", "bodyText": "actually this seems to be a good way of doing the uninstall here (passing it as parameter", "author": "mcjaeger", "createdAt": "2020-09-10T08:44:02Z", "path": "scripts/install-thrift.sh", "diffHunk": "@@ -18,23 +18,116 @@\n # -----------------------------------------------------------------------------\n \n set -e\n-\n-VERSION=0.13.0\n+CURRENT_THRIFT_VERSION=0.13.0\n \n BASEDIR=\"/tmp\"\n-BUILDDIR=\"${BASEDIR}/thrift-$VERSION\"\n+CLEANUP=true\n+UNINSTALL=false\n \n has() { type \"$1\" &> /dev/null; }\n \n-if has \"thrift\"; then\n-    if thrift --version | grep -q \"$VERSION\"; then\n-        echo \"thrift is already installed at $(which thrift)\"\n-        exit 0\n-    else\n-        echo \"thrift is already installed but does not have the correct version: $VERSION\"\n-        exit 1\n-    fi\n-fi\n+processThrift() {\n+  set -x\n+  VERSION=$3\n+  BUILDDIR=\"${BASEDIR}/thrift-$VERSION\"\n+\n+  if [[ ! -d \"$BUILDDIR\" ]]; then\n+      echo \"-[shell provisioning] Extracting thrift\"\n+      if [ -e \"/vagrant_shared/packages/thrift-$VERSION.tar.gz\" ]; then\n+          tar -xzf \"/vagrant_shared/packages/thrift-$VERSION.tar.gz\" -C $BASEDIR\n+      else\n+          if has \"apt-get\" ; then\n+              $SUDO_CMD apt-get update\n+              $SUDO_CMD apt-get install -y curl\n+          elif has \"apk\" ; then\n+              $SUDO_CMD apk --update add curl\n+          else\n+              echo \"no supported package manager found\"\n+              exit 1\n+          fi\n+\n+          TGZ=\"${BASEDIR}/thrift-$VERSION.tar.gz\"\n+\n+          curl -z $TGZ -o $TGZ http://archive.apache.org/dist/thrift/$VERSION/thrift-$VERSION.tar.gz\n+          tar -xzf $TGZ -C $BASEDIR\n+\n+          [[ $CLEANUP ]] && rm \"${BASEDIR}/thrift-$VERSION.tar.gz\"\n+      fi\n+  fi\n+\n+  cd \"$BUILDDIR\"\n+  if [[ ! -f \"./compiler/cpp/thrift\" ]]; then\n+      echo \"-[shell provisioning] Installing dependencies of thrift\"\n+\n+      if has \"apt-get\" ; then\n+          $SUDO_CMD apt-get update\n+          $SUDO_CMD apt-get install -y build-essential libboost-dev libboost-test-dev libboost-program-options-dev libevent-dev automake libtool flex bison pkg-config g++ libssl-dev\n+      elif has \"apk\" ; then\n+          $SUDO_CMD apk --update add g++ make apache-ant libtool automake autoconf bison flex\n+      else\n+          echo \"no supported package manager found\"\n+          exit 1\n+      fi\n+\n+      echo \"-[shell provisioning] Building thrift\"\n+      if [[ ! -f \"./Makefile\" ]]; then\n+          ./configure --without-java --without-cpp --without-qt4 --without-c_glib --without-csharp --without-erlang \\\n+                      --without-perl --without-php --without-php_extension --without-python --without-py3 --without-ruby \\\n+                      --without-haskell --without-go --without-d --without-haskell --without-php --without-ruby \\\n+                      --without-python --without-erlang --without-perl --without-c_sharp --without-d --without-php \\\n+                      --without-go --without-lua --without-nodejs --without-cl\n+      fi\n+      if [ \"$1\" == true ]; then\n+        make\n+      fi\n+  fi\n+\n+  echo \"-[shell provisioning] Executing make $2 on thrift\"\n+  $SUDO_CMD make $2", "originalCommit": "c06851878b6a60aca265b519d987549c2955ea7f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}