{"pr_number": 880, "pr_title": "feat(CRView): Clearing Request Comments enhancements.", "pr_createdAt": "2020-06-09T08:44:26Z", "pr_url": "https://github.com/eclipse/sw360/pull/880", "timeline": [{"oid": "26845ba8de8714bd0f214d5b7cb8b90646dafcb2", "url": "https://github.com/eclipse/sw360/commit/26845ba8de8714bd0f214d5b7cb8b90646dafcb2", "message": "feat(CRView): Clearing Request Comments enhancements.\n\nSigned-off-by: Abdul Kapti <abdul.mannankapti@siemens.com>", "committedDate": "2020-06-10T06:05:09Z", "type": "forcePushed"}, {"oid": "b754ec78edc5f5bbb9648fe9e28956009ec7f3f1", "url": "https://github.com/eclipse/sw360/commit/b754ec78edc5f5bbb9648fe9e28956009ec7f3f1", "message": "feat(CRView): Clearing Request Comments enhancements.\n\nSigned-off-by: Abdul Kapti <abdul.mannankapti@siemens.com>", "committedDate": "2020-06-24T08:52:47Z", "type": "forcePushed"}, {"oid": "76d48266dbe18d135021a85eb4e3d2c5b65d93ac", "url": "https://github.com/eclipse/sw360/commit/76d48266dbe18d135021a85eb4e3d2c5b65d93ac", "message": "feat(CRView): Clearing Request Comments enhancements.\n\nSigned-off-by: Abdul Kapti <abdul.mannankapti@siemens.com>", "committedDate": "2020-06-25T10:08:41Z", "type": "forcePushed"}, {"oid": "e5e16e978e8261689596d0438dcea9225fd425a8", "url": "https://github.com/eclipse/sw360/commit/e5e16e978e8261689596d0438dcea9225fd425a8", "message": "feat(CRView): Clearing Request Comments enhancements.\n\nSigned-off-by: Abdul Kapti <abdul.mannankapti@siemens.com>", "committedDate": "2020-06-25T10:13:52Z", "type": "forcePushed"}, {"oid": "e05f282123a18e427afae6973a39fd81e04ef2e8", "url": "https://github.com/eclipse/sw360/commit/e05f282123a18e427afae6973a39fd81e04ef2e8", "message": "feat(CRView): Clearing Request Comments enhancements.\n\nSigned-off-by: Abdul Kapti <abdul.mannankapti@siemens.com>", "committedDate": "2020-06-25T10:16:14Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQ2MTg3Mg==", "url": "https://github.com/eclipse/sw360/pull/880#discussion_r445461872", "bodyText": "Kindly Change the description according to your script, same for Line 39", "author": "JaideepPalit", "createdAt": "2020-06-25T10:29:57Z", "path": "scripts/migrations/018_remove_unwanted_field_from_clearing_request.py", "diffHunk": "@@ -0,0 +1,98 @@\n+#!/usr/bin/python\r\n+# -----------------------------------------------------------------------------\r\n+# Copyright Siemens AG, 2020. Part of the SW360 Portal Project.\r\n+#\r\n+# This program and the accompanying materials are made\r\n+# available under the terms of the Eclipse Public License 2.0\r\n+# which is available at https://www.eclipse.org/legal/epl-2.0/\r\n+#\r\n+# SPDX-License-Identifier: EPL-2.0\r\n+#\r\n+# This is a manual database migration script. It is assumed that a\r\n+# dedicated framework for automatic migration will be written in the\r\n+# future. When that happens, this script should be refactored to conform\r\n+# to the framework's prerequisites to be run by the framework. For\r\n+# example, server address and db name should be parameterized, the code\r\n+# reorganized into a single class or function, etc.\r\n+#\r\n+# This script updates releases with empty clearingState to default value - NEW_CLEARING.\r", "originalCommit": "e05f282123a18e427afae6973a39fd81e04ef2e8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTk2NTc1NQ==", "url": "https://github.com/eclipse/sw360/pull/880#discussion_r445965755", "bodyText": "changed the description.", "author": "akapti", "createdAt": "2020-06-26T04:49:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQ2MTg3Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQ2MjEyNA==", "url": "https://github.com/eclipse/sw360/pull/880#discussion_r445462124", "bodyText": "DRY_RUN  should be true by default", "author": "JaideepPalit", "createdAt": "2020-06-25T10:30:24Z", "path": "scripts/migrations/018_remove_unwanted_field_from_clearing_request.py", "diffHunk": "@@ -0,0 +1,98 @@\n+#!/usr/bin/python\r\n+# -----------------------------------------------------------------------------\r\n+# Copyright Siemens AG, 2020. Part of the SW360 Portal Project.\r\n+#\r\n+# This program and the accompanying materials are made\r\n+# available under the terms of the Eclipse Public License 2.0\r\n+# which is available at https://www.eclipse.org/legal/epl-2.0/\r\n+#\r\n+# SPDX-License-Identifier: EPL-2.0\r\n+#\r\n+# This is a manual database migration script. It is assumed that a\r\n+# dedicated framework for automatic migration will be written in the\r\n+# future. When that happens, this script should be refactored to conform\r\n+# to the framework's prerequisites to be run by the framework. For\r\n+# example, server address and db name should be parameterized, the code\r\n+# reorganized into a single class or function, etc.\r\n+#\r\n+# This script updates releases with empty clearingState to default value - NEW_CLEARING.\r\n+# -----------------------------------------------------------------------------\r\n+\r\n+import time\r\n+import couchdb\r\n+import json\r\n+from webbrowser import get\r\n+\r\n+# ---------------------------------------\r\n+# constants\r\n+# ---------------------------------------\r\n+\r\n+DRY_RUN = False\r", "originalCommit": "e05f282123a18e427afae6973a39fd81e04ef2e8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTk2NjUxOQ==", "url": "https://github.com/eclipse/sw360/pull/880#discussion_r445966519", "bodyText": "done.", "author": "akapti", "createdAt": "2020-06-26T04:53:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQ2MjEyNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQ2MjQxNw==", "url": "https://github.com/eclipse/sw360/pull/880#discussion_r445462417", "bodyText": "project doc is not used later in the script", "author": "JaideepPalit", "createdAt": "2020-06-25T10:31:01Z", "path": "scripts/migrations/018_remove_unwanted_field_from_clearing_request.py", "diffHunk": "@@ -0,0 +1,98 @@\n+#!/usr/bin/python\r\n+# -----------------------------------------------------------------------------\r\n+# Copyright Siemens AG, 2020. Part of the SW360 Portal Project.\r\n+#\r\n+# This program and the accompanying materials are made\r\n+# available under the terms of the Eclipse Public License 2.0\r\n+# which is available at https://www.eclipse.org/legal/epl-2.0/\r\n+#\r\n+# SPDX-License-Identifier: EPL-2.0\r\n+#\r\n+# This is a manual database migration script. It is assumed that a\r\n+# dedicated framework for automatic migration will be written in the\r\n+# future. When that happens, this script should be refactored to conform\r\n+# to the framework's prerequisites to be run by the framework. For\r\n+# example, server address and db name should be parameterized, the code\r\n+# reorganized into a single class or function, etc.\r\n+#\r\n+# This script updates releases with empty clearingState to default value - NEW_CLEARING.\r\n+# -----------------------------------------------------------------------------\r\n+\r\n+import time\r\n+import couchdb\r\n+import json\r\n+from webbrowser import get\r\n+\r\n+# ---------------------------------------\r\n+# constants\r\n+# ---------------------------------------\r\n+\r\n+DRY_RUN = False\r\n+\r\n+COUCHSERVER = \"http://localhost:5984/\"\r\n+DBNAME = 'sw360db'\r\n+\r\n+couch = couchdb.Server(COUCHSERVER)\r\n+db = couch[DBNAME]\r\n+\r\n+\r\n+# set default values for clearingState field of Release\r\n+fieldValue = \"clearingTeamComment\"\r\n+\r\n+\r\n+# ----------------------------------------\r\n+# queries\r\n+# ----------------------------------------\r\n+\r\n+# get all the clearing requests\r\n+cr_all_query = '''function(doc){\r\n+    if (doc.type == \"clearingRequest\"){\r\n+        emit(doc._id, doc)\r\n+    }\r\n+}'''\r\n+\r\n+# ---------------------------------------\r\n+# functions\r\n+# ---------------------------------------\r\n+\r\n+def run():\r\n+    log = {}\r\n+    count = 0;\r\n+    log['updatedCR'] = []\r\n+    print 'Getting all clearing requests'\r\n+    clearing_request_all = db.query(cr_all_query)\r\n+    print 'found ' + str(len(clearing_request_all)) + ' clearing requests in db!'\r\n+    log['totalCount'] = len(clearing_request_all)\r\n+\r\n+    for crRow in clearing_request_all:\r\n+        cr = crRow.value\r\n+\r\n+\tif fieldValue in cr:\r\n+\t\tif 'projectId' in cr:\r\n+\t\t\tproject = db.get(cr.get('projectId'))\r", "originalCommit": "e05f282123a18e427afae6973a39fd81e04ef2e8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTk2NTgyOQ==", "url": "https://github.com/eclipse/sw360/pull/880#discussion_r445965829", "bodyText": "removed this code.", "author": "akapti", "createdAt": "2020-06-26T04:50:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQ2MjQxNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQ2Mjg0OQ==", "url": "https://github.com/eclipse/sw360/pull/880#discussion_r445462849", "bodyText": "Kindly remove tab from the script and maintain same indentation rule for each level", "author": "JaideepPalit", "createdAt": "2020-06-25T10:31:58Z", "path": "scripts/migrations/018_remove_unwanted_field_from_clearing_request.py", "diffHunk": "@@ -0,0 +1,98 @@\n+#!/usr/bin/python\r\n+# -----------------------------------------------------------------------------\r\n+# Copyright Siemens AG, 2020. Part of the SW360 Portal Project.\r\n+#\r\n+# This program and the accompanying materials are made\r\n+# available under the terms of the Eclipse Public License 2.0\r\n+# which is available at https://www.eclipse.org/legal/epl-2.0/\r\n+#\r\n+# SPDX-License-Identifier: EPL-2.0\r\n+#\r\n+# This is a manual database migration script. It is assumed that a\r\n+# dedicated framework for automatic migration will be written in the\r\n+# future. When that happens, this script should be refactored to conform\r\n+# to the framework's prerequisites to be run by the framework. For\r\n+# example, server address and db name should be parameterized, the code\r\n+# reorganized into a single class or function, etc.\r\n+#\r\n+# This script updates releases with empty clearingState to default value - NEW_CLEARING.\r\n+# -----------------------------------------------------------------------------\r\n+\r\n+import time\r\n+import couchdb\r\n+import json\r\n+from webbrowser import get\r\n+\r\n+# ---------------------------------------\r\n+# constants\r\n+# ---------------------------------------\r\n+\r\n+DRY_RUN = False\r\n+\r\n+COUCHSERVER = \"http://localhost:5984/\"\r\n+DBNAME = 'sw360db'\r\n+\r\n+couch = couchdb.Server(COUCHSERVER)\r\n+db = couch[DBNAME]\r\n+\r\n+\r\n+# set default values for clearingState field of Release\r\n+fieldValue = \"clearingTeamComment\"\r\n+\r\n+\r\n+# ----------------------------------------\r\n+# queries\r\n+# ----------------------------------------\r\n+\r\n+# get all the clearing requests\r\n+cr_all_query = '''function(doc){\r\n+    if (doc.type == \"clearingRequest\"){\r\n+        emit(doc._id, doc)\r\n+    }\r\n+}'''\r\n+\r\n+# ---------------------------------------\r\n+# functions\r\n+# ---------------------------------------\r\n+\r\n+def run():\r\n+    log = {}\r\n+    count = 0;\r\n+    log['updatedCR'] = []\r\n+    print 'Getting all clearing requests'\r\n+    clearing_request_all = db.query(cr_all_query)\r\n+    print 'found ' + str(len(clearing_request_all)) + ' clearing requests in db!'\r\n+    log['totalCount'] = len(clearing_request_all)\r\n+\r\n+    for crRow in clearing_request_all:\r\n+        cr = crRow.value\r\n+\r\n+\tif fieldValue in cr:\r", "originalCommit": "e05f282123a18e427afae6973a39fd81e04ef2e8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTk2NTkzMA==", "url": "https://github.com/eclipse/sw360/pull/880#discussion_r445965930", "bodyText": "fixed indentation.", "author": "akapti", "createdAt": "2020-06-26T04:50:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQ2Mjg0OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQ2NTg1NA==", "url": "https://github.com/eclipse/sw360/pull/880#discussion_r445465854", "bodyText": "File name is varied based on fieldValue", "author": "JaideepPalit", "createdAt": "2020-06-25T10:37:57Z", "path": "scripts/migrations/018_remove_unwanted_field_from_clearing_request.py", "diffHunk": "@@ -0,0 +1,98 @@\n+#!/usr/bin/python\r\n+# -----------------------------------------------------------------------------\r\n+# Copyright Siemens AG, 2020. Part of the SW360 Portal Project.\r\n+#\r\n+# This program and the accompanying materials are made\r\n+# available under the terms of the Eclipse Public License 2.0\r\n+# which is available at https://www.eclipse.org/legal/epl-2.0/\r\n+#\r\n+# SPDX-License-Identifier: EPL-2.0\r\n+#\r\n+# This is a manual database migration script. It is assumed that a\r\n+# dedicated framework for automatic migration will be written in the\r\n+# future. When that happens, this script should be refactored to conform\r\n+# to the framework's prerequisites to be run by the framework. For\r\n+# example, server address and db name should be parameterized, the code\r\n+# reorganized into a single class or function, etc.\r\n+#\r\n+# This script updates releases with empty clearingState to default value - NEW_CLEARING.\r\n+# -----------------------------------------------------------------------------\r\n+\r\n+import time\r\n+import couchdb\r\n+import json\r\n+from webbrowser import get\r\n+\r\n+# ---------------------------------------\r\n+# constants\r\n+# ---------------------------------------\r\n+\r\n+DRY_RUN = False\r\n+\r\n+COUCHSERVER = \"http://localhost:5984/\"\r\n+DBNAME = 'sw360db'\r\n+\r\n+couch = couchdb.Server(COUCHSERVER)\r\n+db = couch[DBNAME]\r\n+\r\n+\r\n+# set default values for clearingState field of Release\r\n+fieldValue = \"clearingTeamComment\"\r\n+\r\n+\r\n+# ----------------------------------------\r\n+# queries\r\n+# ----------------------------------------\r\n+\r\n+# get all the clearing requests\r\n+cr_all_query = '''function(doc){\r\n+    if (doc.type == \"clearingRequest\"){\r\n+        emit(doc._id, doc)\r\n+    }\r\n+}'''\r\n+\r\n+# ---------------------------------------\r\n+# functions\r\n+# ---------------------------------------\r\n+\r\n+def run():\r\n+    log = {}\r\n+    count = 0;\r\n+    log['updatedCR'] = []\r\n+    print 'Getting all clearing requests'\r\n+    clearing_request_all = db.query(cr_all_query)\r\n+    print 'found ' + str(len(clearing_request_all)) + ' clearing requests in db!'\r\n+    log['totalCount'] = len(clearing_request_all)\r\n+\r\n+    for crRow in clearing_request_all:\r\n+        cr = crRow.value\r\n+\r\n+\tif fieldValue in cr:\r\n+\t\tif 'projectId' in cr:\r\n+\t\t\tproject = db.get(cr.get('projectId'))\r\n+\r\n+\t        print '\\tUpdating Clearing Request ID -> ' + cr.get('_id')\r\n+\t        del cr[fieldValue]\r\n+\t        updatedCR = {}\r\n+\t        updatedCR['id'] = cr.get('_id')\r\n+\t        log['updatedCR'].append(updatedCR)\r\n+\t\tcount = count + 1\r\n+\t        if not DRY_RUN:\r\n+\t            db.save(cr)\r\n+\t\t    print '\\tUpdated Clearing Request ID -> ' + cr.get('_id')\r\n+    resultFile = open('018_clearing_request_migration_'+fieldValue+'.log', 'w')\r\n+    json.dump(log, resultFile, indent = 4, sort_keys = True)\r\n+    resultFile.close()\r\n+\r\n+    print '\\n'\r\n+    print '------------------------------------------'\r\n+    print 'Total Clearing Request updated : ' + str(count)\r\n+    print '------------------------------------------'\r\n+    print 'Please check log file \"018_clearing_request_migration_fieldName.log\" in this directory for details'\r", "originalCommit": "e05f282123a18e427afae6973a39fd81e04ef2e8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTk2NjQ5MA==", "url": "https://github.com/eclipse/sw360/pull/880#discussion_r445966490", "bodyText": "removed fieldName from file name.", "author": "akapti", "createdAt": "2020-06-26T04:53:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQ2NTg1NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQ4NjUwMQ==", "url": "https://github.com/eclipse/sw360/pull/880#discussion_r445486501", "bodyText": "Instead of fetching all CRs and then filtering in a for loop.\nIt would be good to fetch all Docs containing the field\n'''function(doc){\n    if (doc.type == \"clearingRequest\" && doc.'''+ fieldValue +''' !=null){\n        emit(doc._id, doc)\n    }\n}'''", "author": "JaideepPalit", "createdAt": "2020-06-25T11:21:40Z", "path": "scripts/migrations/018_remove_unwanted_field_from_clearing_request.py", "diffHunk": "@@ -0,0 +1,98 @@\n+#!/usr/bin/python\r\n+# -----------------------------------------------------------------------------\r\n+# Copyright Siemens AG, 2020. Part of the SW360 Portal Project.\r\n+#\r\n+# This program and the accompanying materials are made\r\n+# available under the terms of the Eclipse Public License 2.0\r\n+# which is available at https://www.eclipse.org/legal/epl-2.0/\r\n+#\r\n+# SPDX-License-Identifier: EPL-2.0\r\n+#\r\n+# This is a manual database migration script. It is assumed that a\r\n+# dedicated framework for automatic migration will be written in the\r\n+# future. When that happens, this script should be refactored to conform\r\n+# to the framework's prerequisites to be run by the framework. For\r\n+# example, server address and db name should be parameterized, the code\r\n+# reorganized into a single class or function, etc.\r\n+#\r\n+# This script updates releases with empty clearingState to default value - NEW_CLEARING.\r\n+# -----------------------------------------------------------------------------\r\n+\r\n+import time\r\n+import couchdb\r\n+import json\r\n+from webbrowser import get\r\n+\r\n+# ---------------------------------------\r\n+# constants\r\n+# ---------------------------------------\r\n+\r\n+DRY_RUN = False\r\n+\r\n+COUCHSERVER = \"http://localhost:5984/\"\r\n+DBNAME = 'sw360db'\r\n+\r\n+couch = couchdb.Server(COUCHSERVER)\r\n+db = couch[DBNAME]\r\n+\r\n+\r\n+# set default values for clearingState field of Release\r\n+fieldValue = \"clearingTeamComment\"\r\n+\r\n+\r\n+# ----------------------------------------\r\n+# queries\r\n+# ----------------------------------------\r\n+\r\n+# get all the clearing requests\r\n+cr_all_query = '''function(doc){\r\n+    if (doc.type == \"clearingRequest\"){\r\n+        emit(doc._id, doc)\r\n+    }\r\n+}'''\r", "originalCommit": "e05f282123a18e427afae6973a39fd81e04ef2e8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTk2NjMxOA==", "url": "https://github.com/eclipse/sw360/pull/880#discussion_r445966318", "bodyText": "done.", "author": "akapti", "createdAt": "2020-06-26T04:52:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQ4NjUwMQ=="}], "type": "inlineReview"}, {"oid": "5c8b1d4fedd83c6b63929c417b9805d472a05ffb", "url": "https://github.com/eclipse/sw360/commit/5c8b1d4fedd83c6b63929c417b9805d472a05ffb", "message": "feat(CRView): Clearing Request Comments enhancements.\n\nSigned-off-by: Abdul Kapti <abdul.mannankapti@siemens.com>", "committedDate": "2020-06-26T04:43:25Z", "type": "forcePushed"}, {"oid": "c0bf713271a5ac7d2dab838e9a801cc514cabf21", "url": "https://github.com/eclipse/sw360/commit/c0bf713271a5ac7d2dab838e9a801cc514cabf21", "message": "feat(CRView): Clearing Request Comments enhancements.\n\nSigned-off-by: Abdul Kapti <abdul.mannankapti@siemens.com>", "committedDate": "2020-06-26T05:03:00Z", "type": "commit"}, {"oid": "c0bf713271a5ac7d2dab838e9a801cc514cabf21", "url": "https://github.com/eclipse/sw360/commit/c0bf713271a5ac7d2dab838e9a801cc514cabf21", "message": "feat(CRView): Clearing Request Comments enhancements.\n\nSigned-off-by: Abdul Kapti <abdul.mannankapti@siemens.com>", "committedDate": "2020-06-26T05:03:00Z", "type": "forcePushed"}]}