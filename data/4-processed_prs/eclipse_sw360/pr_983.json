{"pr_number": 983, "pr_title": "feat(ObligationDataModel): Changes in Obligation data model", "pr_createdAt": "2020-09-16T06:31:33Z", "pr_url": "https://github.com/eclipse/sw360/pull/983", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTMzNTkxNw==", "url": "https://github.com/eclipse/sw360/pull/983#discussion_r489335917", "bodyText": "Please remove this count variable, It seems like it is not used anywhere.", "author": "smrutis1", "createdAt": "2020-09-16T10:33:35Z", "path": "scripts/migrations/024_update_type_from_obligations_to_obligation.py", "diffHunk": "@@ -0,0 +1,85 @@\n+#!/usr/bin/python\n+# -----------------------------------------------------------------------------\n+# Copyright Siemens AG, 2020. Part of the SW360 Portal Project.\n+#\n+# This program and the accompanying materials are made\n+# available under the terms of the Eclipse Public License 2.0\n+# which is available at https://www.eclipse.org/legal/epl-2.0/\n+#\n+# SPDX-License-Identifier: EPL-2.0\n+#\n+# This is a manual database migration script. It is assumed that a\n+# dedicated framework for automatic migration will be written in the\n+# future. When that happens, this script should be refactored to conform\n+# to the framework's prerequisites to be run by the framework. For\n+# example, server address and db name should be parameterized, the code\n+# reorganized into a single class or function, etc.\n+#\n+# This script updates type of document from obligations to obligation\n+# ---------------------------------------------------------------------------------------------------------------------------------------------------------------\n+\n+import time\n+import couchdb\n+import json\n+from webbrowser import get\n+\n+# ---------------------------------------\n+# constants\n+# ---------------------------------------\n+\n+DRY_RUN = True\n+\n+COUCHSERVER = \"http://localhost:5984/\"\n+DBNAME = 'sw360db'\n+\n+couch=couchdb.Server(COUCHSERVER)\n+db = couch[DBNAME]\n+\n+# set fieldName\n+newValue = \"obligation\"\n+\n+# ----------------------------------------\n+# queries\n+# ----------------------------------------\n+\n+# get all obligations\n+all_obligations_query = {\"selector\": {\"type\": {\"$eq\": \"obligations\"}}}\n+\n+# ---------------------------------------\n+# functions\n+# ---------------------------------------\n+\n+def run():\n+    log = {}\n+    count = 0;\n+    log['updatedObligation'] = []\n+    print 'Getting all obligations'\n+    all_obligations = db.find(all_obligations_query)\n+    print 'found ' + str(len(all_obligations)) + ' obligations in db!'\n+    log['totalCount'] = len(all_obligations)\n+\n+    for obligation in all_obligations:\n+        print '\\tUpdating type of document from obligations to '+newValue+' for ID -> ' + obligation.get('_id')\n+        obligation['type'] = newValue\n+        updatedObligation = {}\n+        updatedObligation['id'] = obligation.get('_id')\n+        log['updatedObligation'].append(updatedObligation)\n+        count = count + 1", "originalCommit": "b24fdd5fdff4ac63395326cfd20a1ac775f0ea96", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTM2MDgwNA==", "url": "https://github.com/eclipse/sw360/pull/983#discussion_r489360804", "bodyText": "removed count variable", "author": "JaideepPalit", "createdAt": "2020-09-16T11:21:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTMzNTkxNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTM0MDA3Mg==", "url": "https://github.com/eclipse/sw360/pull/983#discussion_r489340072", "bodyText": "It should be  ${oblig.listOfobligation} instead of ${oblig.obligations}", "author": "smrutis1", "createdAt": "2020-09-16T10:41:22Z", "path": "frontend/sw360-portlet/src/main/resources/META-INF/resources/html/licenses/includes/detailTodos.jspf", "diffHunk": "@@ -95,15 +95,15 @@\n                     <td><sw360:DisplayBoolean value=\"${oblig.development}\" defined=\"${oblig.setDevelopment}\"/></td>\n                     <td><sw360:DisplayBoolean value=\"${oblig.distribution}\" defined=\"${oblig.setDistribution}\"/></td>\n                     <td><sw360:DisplayMap value=\"${oblig.customPropertyToValue}\"/></td>\n-                    <core_rt:if test=\"${oblig.listOfobligationSize > 0}\">\n-                        <td>\n+                    <td>\n+                        <core_rt:if test=\"${oblig.listOfobligationSize > 0}\">\n                             <ul>\n                                 <core_rt:forEach var=\"ob\" varStatus=\"status\" items=\"${oblig.obligations}\">", "originalCommit": "b24fdd5fdff4ac63395326cfd20a1ac775f0ea96", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTM2MDc3NQ==", "url": "https://github.com/eclipse/sw360/pull/983#discussion_r489360775", "bodyText": "Changes made", "author": "JaideepPalit", "createdAt": "2020-09-16T11:21:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTM0MDA3Mg=="}], "type": "inlineReview"}, {"oid": "19bf2d8e4ef6bf6e0841bafa2f4f902c94dbb0ea", "url": "https://github.com/eclipse/sw360/commit/19bf2d8e4ef6bf6e0841bafa2f4f902c94dbb0ea", "message": "feat(ObligationDataModel): Changes in Obligation data model\n  * Renamed struct Obligations to struct Obligation in License.thrift\n  * Renamed existing obligationType to obligationLevel\n  * Created new obligationType field which has Permission,Risk,Exception,Restriction as options\n  * Fixed adding obligation in licenses tab\n\nSigned-off-by: Jaideep Palit <jaideep.palit@siemens.com>", "committedDate": "2020-09-16T11:20:02Z", "type": "forcePushed"}, {"oid": "6c13cc93a498005828c276e3855d1124a6a6e0af", "url": "https://github.com/eclipse/sw360/commit/6c13cc93a498005828c276e3855d1124a6a6e0af", "message": "feat(ObligationDataModel): Changes in Obligation data model\n  * Renamed struct Obligations to struct Obligation in License.thrift\n  * Renamed existing obligationType to obligationLevel\n  * Created new obligationType field which has Permission,Risk,Exception,Restriction as options\n  * Fixed adding obligation in licenses tab\n\nSigned-off-by: Jaideep Palit <jaideep.palit@siemens.com>", "committedDate": "2020-09-16T11:47:35Z", "type": "commit"}, {"oid": "6c13cc93a498005828c276e3855d1124a6a6e0af", "url": "https://github.com/eclipse/sw360/commit/6c13cc93a498005828c276e3855d1124a6a6e0af", "message": "feat(ObligationDataModel): Changes in Obligation data model\n  * Renamed struct Obligations to struct Obligation in License.thrift\n  * Renamed existing obligationType to obligationLevel\n  * Created new obligationType field which has Permission,Risk,Exception,Restriction as options\n  * Fixed adding obligation in licenses tab\n\nSigned-off-by: Jaideep Palit <jaideep.palit@siemens.com>", "committedDate": "2020-09-16T11:47:35Z", "type": "forcePushed"}]}