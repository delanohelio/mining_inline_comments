{"pr_number": 837, "pr_title": "feat(ProjectUI): Unified view of Linked Project and Releases, Clearing status, Linked Release Hierarchy. View includes tree view and list view", "pr_createdAt": "2020-04-29T06:11:35Z", "pr_url": "https://github.com/eclipse/sw360/pull/837", "timeline": [{"oid": "ae902c937e9af664e36e1d87d496578efc92f573", "url": "https://github.com/eclipse/sw360/commit/ae902c937e9af664e36e1d87d496578efc92f573", "message": "feat(ProjectUI): Unified view of Linked Project and Releases, Clearing status, Linked Release Hierarchy. View includes tree view and list view\n\nSigned-off-by: Jaideep Palit <jaideep.palit@siemens.com>", "committedDate": "2020-04-29T14:48:12Z", "type": "forcePushed"}, {"oid": "725703f0a2f4eebe7fae2f13e6e74b32641773f4", "url": "https://github.com/eclipse/sw360/commit/725703f0a2f4eebe7fae2f13e6e74b32641773f4", "message": "feat(ProjectUI): Unified view of Linked Project and Releases, Clearing status, Linked Release Hierarchy. View includes tree view and list view\n\nSigned-off-by: Jaideep Palit <jaideep.palit@siemens.com>", "committedDate": "2020-05-06T12:19:19Z", "type": "forcePushed"}, {"oid": "73ee218ae959b2cf35cbdad181d14b3286869828", "url": "https://github.com/eclipse/sw360/commit/73ee218ae959b2cf35cbdad181d14b3286869828", "message": "feat(ProjectUI): Unified view of Linked Project and Releases, Clearing status, Linked Release Hierarchy. View includes tree view and list view\n\nSigned-off-by: Jaideep Palit <jaideep.palit@siemens.com>", "committedDate": "2020-05-07T09:59:07Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzUwMjgyOA==", "url": "https://github.com/eclipse/sw360/pull/837#discussion_r423502828", "bodyText": "May be we can use Objects::nonNull to do null check inside filter.", "author": "smrutis1", "createdAt": "2020-05-12T06:56:48Z", "path": "frontend/sw360-portlet/src/main/java/org/eclipse/sw360/portal/portlets/LinkedReleasesAndProjectsAwarePortlet.java", "diffHunk": "@@ -165,9 +177,15 @@ protected void prepareLinkedProjects(ResourceRequest request) throws PortletExce\n         } else {\n             project = new Project();\n         }\n-\n+        ComponentService.Iface compClient = thriftClients.makeComponentClient();\n         List<ProjectLink> mappedProjectLinks = createLinkedProjects(project, user);\n+\n+        Set<String> releaseIds = mappedProjectLinks.stream().map(ProjectLink::getLinkedReleases)\n+                .filter(CommonUtils::isNotEmpty).flatMap(rList -> rList.stream()).filter(rl -> rl != null)", "originalCommit": "73ee218ae959b2cf35cbdad181d14b3286869828", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE2OTA3Mg==", "url": "https://github.com/eclipse/sw360/pull/837#discussion_r424169072", "bodyText": "Changes Done", "author": "JaideepPalit", "createdAt": "2020-05-13T04:43:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzUwMjgyOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzUxMDA0Mg==", "url": "https://github.com/eclipse/sw360/pull/837#discussion_r423510042", "bodyText": "This javascript here looks huge. May be we can consider moving it into a separate js file.", "author": "smrutis1", "createdAt": "2020-05-12T07:11:24Z", "path": "frontend/sw360-portlet/src/main/resources/META-INF/resources/html/projects/includes/projects/clearingStatus.jspf", "diffHunk": "@@ -7,97 +7,315 @@\n   ~\n   ~ SPDX-License-Identifier: EPL-2.0\n --%>\n-<%@ page import=\"org.eclipse.sw360.portal.common.PortalConstants\" %>\n-<%@ page import=\"org.eclipse.sw360.portal.common.page.PortletReleasePage\" %>\n-<%@ taglib uri=\"http://java.sun.com/jsp/jstl/functions\" prefix=\"fn\" %>\n+<%@ page import=\"com.liferay.portal.kernel.portlet.PortletURLFactoryUtil\" %>\n+<%@ page import=\"org.eclipse.sw360.datahandler.thrift.projects.Project\" %>\n+<%@ page import=\"javax.portlet.PortletRequest\" %>\n \n-<jsp:useBean id=\"releasesAndProjects\" type=\"java.util.List<org.eclipse.sw360.datahandler.thrift.components.ReleaseClearingStatusData>\" scope=\"request\"/>\n+<%@include file=\"/html/init.jsp\" %>\n \n-<core_rt:if test=\"${releasesAndProjects.size() == 0 }\">\n-    <div class=\"alert alert-info\" role=\"alert\">\n-        <liferay-ui:message key=\"please.add.linked.releases.or.projects.with.linked.releases.to.view.their.clearing.status.here\" />\n+<portlet:defineObjects/>\n+<liferay-theme:defineObjects/>\n+\n+<portlet:resourceURL var=\"loadLinkedProjectsRowsURL\">\n+    <portlet:param name=\"<%=PortalConstants.ACTION%>\" value='<%=PortalConstants.LOAD_LINKED_PROJECTS_ROWS%>'/>\n+    <portlet:param name=\"<%=PortalConstants.LOAD_LINKED_RELEASES_ROWS%>\" value='true'/>\n+</portlet:resourceURL>\n+\n+<portlet:resourceURL var=\"clearingStatuslisturl\">\n+    <portlet:param name=\"<%=PortalConstants.ACTION%>\" value=\"<%=PortalConstants.LIST_CLEARING_STATUS%>\"/>\n+    <portlet:param name=\"<%=PortalConstants.DOCUMENT_ID%>\" value=\"${docid}\"/>\n+</portlet:resourceURL>\n+\n+<portlet:resourceURL var=\"clearingStatuslistOnloadurl\">\n+    <portlet:param name=\"<%=PortalConstants.ACTION%>\" value=\"<%=PortalConstants.CLEARING_STATUS_ON_LOAD%>\"/>\n+    <portlet:param name=\"<%=PortalConstants.PROJECT_ID%>\" value=\"${docid}\"/>\n+</portlet:resourceURL>\n+\n+<jsp:useBean id=\"projectList\" type=\"java.util.List<org.eclipse.sw360.datahandler.thrift.projects.ProjectLink>\"\n+             scope=\"request\"/>\n+\n+<div class=\"tab-content\" id=\"pills-clearingStatusTab\">\n+    <div class=\"tab-pane fade show active\" id=\"pills-treeView\" role=\"tabpanel\" aria-labelledby=\"pills-tree-tab\">\n+        <div id=\"clearingStatusTreeViewSpinner\">\n+            <%@ include file=\"/html/utils/includes/pageSpinner.jspf\" %>\n+        </div>\n+        <table class=\"table table-bordered d-none\" id=\"LinkedProjectsInfo\" data-load-node-url=\"<%=loadLinkedProjectsRowsURL%>\"\n+        data-portlet-namespace=\"<portlet:namespace/>\" data-parent-branch-key=\"<%=PortalConstants.PARENT_BRANCH_ID%>\"\n+        data-scope-group-id=\"${httpServletRequest.getAttribute('scopeGroupId')}\"\n+        >\n+            <thead>\n+                <tr>\n+                    <th style=\"width:46%\"><liferay-ui:message key=\"name\" /></th>\n+                    <th style=\"width:7%\"><liferay-ui:message key=\"type\" /></th>\n+                    <th style=\"width:7%\"><liferay-ui:message key=\"relation\" /></th>\n+                    <th style=\"width:15%\"><liferay-ui:message key=\"main.licenses\" /></th>\n+                    <th style=\"width:7%\"><liferay-ui:message key=\"state\" /></th>\n+                    <th style=\"width:7%\"><liferay-ui:message key=\"release.mainline.state\" /></th>\n+                    <th style=\"width:7%\"><liferay-ui:message key=\"project.mainline.state\" /></th>\n+                    <th style=\"width:4%\"><liferay-ui:message key=\"actions\" /></th>\n+               </tr>\n+           </thead>\n+           <tbody id=\"clearingStatusTreeViewTableBody\">\n+               <tr class=\"d-none\" id=\"noRecordRow\">\n+                    <td colspan=\"8\" class=\"text-center\"><liferay-ui:message key=\"no.linked.releases.or.projects\" /></td>\n+               </tr>\n+          </tbody>\n+       </table>\n+   </div>\n+   <div class=\"tab-pane fade\" id=\"pills-listView\" role=\"tabpanel\" aria-labelledby=\"pills-list-tab\">\n+        <div id=\"clearingStatusSpinner\">\n+            <%@ include file=\"/html/utils/includes/pageSpinner.jspf\" %>\n+        </div>\n+        <table id=\"clearingStatusTable\" class=\"table table-bordered d-none\"></table>\n     </div>\n-</core_rt:if>\n-<core_rt:if test=\"${releasesAndProjects.size()  > 0 }\">\n-    <table id=\"releasesTable\" class=\"table table-bordered\" data-details-context=\"${inProjectDetailsContext}\"></table>\n-</core_rt:if>\n-\n-<script type=\"text/javascript\">\n-require(['jquery', 'bridges/datatables', 'utils/render'], function ($, datatables, render) {\n-    var homeUrl = themeDisplay.getURLHome().replace(/\\/web\\//, '/group/');\n-\n-    createClearingTable();\n-\n-    $('#exportReleasesSpreadsheetClearingButton').on('click', exportReleasesSpreadsheet);\n-\n-    function createClearingTable() {\n-        var table,\n-            result = [],\n-            editRelease;\n-\n-        <core_rt:forEach items=\"${releasesAndProjects}\" var=\"releasesClearingStatusData\">\n-            result.push({\n-                \"DT_RowId\": \"${releasesClearingStatusData.release.id}\",\n-                \"0\": \"<sw360:DisplayReleaseLink release=\"${releasesClearingStatusData.release}\" showFullname=\"true\"/>\",\n-                \"1\": \"<sw360:out value=\"${releasesClearingStatusData.projectNames}\"/>\",\n-                \"2\": \"<span id='releaseClearingState${releasesClearingStatusData.release.id}'><sw360:DisplayEnum value=\"${releasesClearingStatusData.release.clearingState}\"/></span>\",\n-                \"3\": \"<sw360:DisplayEnum value=\"${releasesClearingStatusData.release.mainlineState}\"/>\",\n-                \"4\": \"<sw360:out value=\"${releasesClearingStatusData.mainlineStates}\"/>\",\n-                \"5\": \"<sw360:DisplayEnum value=\"${releasesClearingStatusData.componentType}\"/>\",\n-                \"6\": \"${releasesClearingStatusData.release.id}\"\n-            });\n-        </core_rt:forEach>\n-\n-        table = datatables.create('#releasesTable', {\n-            data: result,\n-            columns: [\n-                {title: \"<liferay-ui:message key=\"name\" />\"},\n-                {title: \"<liferay-ui:message key=\"project.origin\" />\"},\n-                {title: \"<liferay-ui:message key=\"clearing.state\" />\"},\n-                {title: \"<liferay-ui:message key=\"release.mainline.state\" />\"},\n-                {title: \"<liferay-ui:message key=\"project.mainline.state\" />\"},\n-                {title: \"<liferay-ui:message key=\"type\" />\"},\n-                {title: \"<liferay-ui:message key=\"actions\" />\", render: {display: renderActions}, className: \"two actions\" }\n-            ],\n-            columnDefs: [\n-                {\n-                    targets: [ 6 ],\n-                    visible: $('#releasesTable').data() ? $('#releasesTable').data().detailsContext : false\n-                }\n-            ],\n+</div>\n+<%--for javascript library loading --%>\n+<%@ include file=\"/html/utils/includes/requirejs.jspf\" %>\n+<script>\n+AUI().use('liferay-portlet-url', function () {", "originalCommit": "73ee218ae959b2cf35cbdad181d14b3286869828", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE3MzU5NQ==", "url": "https://github.com/eclipse/sw360/pull/837#discussion_r424173595", "bodyText": "Tried moving script tag content to separate JS file.\nNot working as expected , since it is using JSP features to resolve language tags and URLs\n\n\nThe language properties are not getting resolved.\n\n\n\nAlso the Urls are not getting resolved for new as well as existing code\n\n\nfunction downloadSourceCodeBundleButton(type) {\n            var portletURL = Liferay.PortletURL.createURL('<%= PortletURLFactoryUtil.create(request, portletDisplay.getId(), themeDisplay.getPlid(), PortletRequest.RENDER_PHASE) %>');\n            portletURL.setParameter('<%=PortalConstants.PROJECT_ID%>', '${project.id}');\n            portletURL.setParameter('<%=PortalConstants.PAGENAME%>', '<%=PortalConstants.PAGENAME_SOURCE_CODE_BUNDLE%>');\n            portletURL.setParameter('<%=PortalConstants.PROJECT_WITH_SUBPROJECT%>', type === 'projectWithSubProject' ? 'true' : 'false');\n\n            window.location.href = portletURL.toString();\n        }\n\n\nKindley suggest, if this can be achieved by any other means.", "author": "JaideepPalit", "createdAt": "2020-05-13T05:02:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzUxMDA0Mg=="}], "type": "inlineReview"}, {"oid": "0300040115fb257a824be5ce1b1451b145bfbb74", "url": "https://github.com/eclipse/sw360/commit/0300040115fb257a824be5ce1b1451b145bfbb74", "message": "feat(ProjectUI): Unified view of Linked Project and Releases, Clearing status, Linked Release Hierarchy. View includes tree view and list view\n\nSigned-off-by: Jaideep Palit <jaideep.palit@siemens.com>", "committedDate": "2020-05-13T04:40:01Z", "type": "commit"}, {"oid": "0300040115fb257a824be5ce1b1451b145bfbb74", "url": "https://github.com/eclipse/sw360/commit/0300040115fb257a824be5ce1b1451b145bfbb74", "message": "feat(ProjectUI): Unified view of Linked Project and Releases, Clearing status, Linked Release Hierarchy. View includes tree view and list view\n\nSigned-off-by: Jaideep Palit <jaideep.palit@siemens.com>", "committedDate": "2020-05-13T04:40:01Z", "type": "forcePushed"}]}