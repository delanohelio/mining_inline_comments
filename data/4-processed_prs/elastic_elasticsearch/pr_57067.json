{"pr_number": 57067, "pr_title": "Update to highlight the impact of the global state setting", "pr_createdAt": "2020-05-21T22:54:39Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/57067", "timeline": [{"oid": "429e6cd39d0a85aee9a7d897bf0e6f6745526604", "url": "https://github.com/elastic/elasticsearch/commit/429e6cd39d0a85aee9a7d897bf0e6f6745526604", "message": "Update to highlight the impact of the global state setting\n\nUpdated the language and added a callout to more prominently detail what happens when including the global state of a snapshot from which indices are being restored. I've had recent cases where customers copy and pasted the second code example verbatim, updated the index and snapshot name values, and executed the command. In effect wiping out their current ILM policies, templates, and ingestion pipelines. In hindsight they realize that they were unclear of the ramifications of including the setting as is.", "committedDate": "2020-05-21T22:52:21Z", "type": "commit"}, {"oid": "a98aac2c5ee48923b1ce3438876f296c4ff57b07", "url": "https://github.com/elastic/elasticsearch/commit/a98aac2c5ee48923b1ce3438876f296c4ff57b07", "message": "add callout and tweaks", "committedDate": "2020-05-26T14:08:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQ1NTk1MQ==", "url": "https://github.com/elastic/elasticsearch/pull/57067#discussion_r430455951", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            pipelines, and {ilm-init} policies are restored and added to the current\n          \n          \n            \n            pipelines, and {ilm-init} policies are restored into the current", "author": "DaveCTurner", "createdAt": "2020-05-26T14:28:31Z", "path": "docs/reference/snapshot-restore/restore-snapshot.asciidoc", "diffHunk": "@@ -47,23 +47,26 @@ POST /_snapshot/my_backup/snapshot_1/_restore\n {\n   \"indices\": \"index_1,index_2\",\n   \"ignore_unavailable\": true,\n-  \"include_global_state\": true,\n+  \"include_global_state\": true,              <1>\n   \"rename_pattern\": \"index_(.+)\",\n   \"rename_replacement\": \"restored_index_$1\"\n }\n -----------------------------------\n // TEST[continued]\n \n+<1> By default, `include_global_state` is `false`, meaning the snapshot's\n+cluster state is not restored.\n++\n+If `true`, the snapshot's persistent settings, index templates, ingest\n+pipelines, and {ilm-init} policies are restored and added to the current", "originalCommit": "a98aac2c5ee48923b1ce3438876f296c4ff57b07", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQ1NzY1NA==", "url": "https://github.com/elastic/elasticsearch/pull/57067#discussion_r430457654", "bodyText": "I really think we should use false in the example here and adjust the callout to match, with the expectation that people will continue to copy-paste this anyway.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              \"include_global_state\": true,              <1>\n          \n          \n            \n              \"include_global_state\": false,              <1>", "author": "DaveCTurner", "createdAt": "2020-05-26T14:30:44Z", "path": "docs/reference/snapshot-restore/restore-snapshot.asciidoc", "diffHunk": "@@ -47,23 +47,26 @@ POST /_snapshot/my_backup/snapshot_1/_restore\n {\n   \"indices\": \"index_1,index_2\",\n   \"ignore_unavailable\": true,\n-  \"include_global_state\": true,\n+  \"include_global_state\": true,              <1>", "originalCommit": "a98aac2c5ee48923b1ce3438876f296c4ff57b07", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQ1ODY3Nw==", "url": "https://github.com/elastic/elasticsearch/pull/57067#discussion_r430458677", "bodyText": "Suggest adding include_aliases to the example too:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              \"rename_replacement\": \"restored_index_$1\"\n          \n          \n            \n              \"rename_replacement\": \"restored_index_$1\",\n          \n          \n            \n              \"include_aliases\": false", "author": "DaveCTurner", "createdAt": "2020-05-26T14:31:58Z", "path": "docs/reference/snapshot-restore/restore-snapshot.asciidoc", "diffHunk": "@@ -47,23 +47,26 @@ POST /_snapshot/my_backup/snapshot_1/_restore\n {\n   \"indices\": \"index_1,index_2\",\n   \"ignore_unavailable\": true,\n-  \"include_global_state\": true,\n+  \"include_global_state\": true,              <1>\n   \"rename_pattern\": \"index_(.+)\",\n   \"rename_replacement\": \"restored_index_$1\"", "originalCommit": "a98aac2c5ee48923b1ce3438876f296c4ff57b07", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQ2MDc4OA==", "url": "https://github.com/elastic/elasticsearch/pull/57067#discussion_r430460788", "bodyText": "I think \"overrides\" is still a bit ambiguous. How about \"overwrites\"?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            cluster. This overrides current settings, templates, pipeline, and policies with\n          \n          \n            \n            cluster. This overwrites any existing cluster settings, templates, pipelines and {ilm-init} policies whose names match those in the snapshot.", "author": "DaveCTurner", "createdAt": "2020-05-26T14:34:52Z", "path": "docs/reference/snapshot-restore/restore-snapshot.asciidoc", "diffHunk": "@@ -47,23 +47,26 @@ POST /_snapshot/my_backup/snapshot_1/_restore\n {\n   \"indices\": \"index_1,index_2\",\n   \"ignore_unavailable\": true,\n-  \"include_global_state\": true,\n+  \"include_global_state\": true,              <1>\n   \"rename_pattern\": \"index_(.+)\",\n   \"rename_replacement\": \"restored_index_$1\"\n }\n -----------------------------------\n // TEST[continued]\n \n+<1> By default, `include_global_state` is `false`, meaning the snapshot's\n+cluster state is not restored.\n++\n+If `true`, the snapshot's persistent settings, index templates, ingest\n+pipelines, and {ilm-init} policies are restored and added to the current\n+cluster. This overrides current settings, templates, pipeline, and policies with", "originalCommit": "a98aac2c5ee48923b1ce3438876f296c4ff57b07", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQ2MTIyMA==", "url": "https://github.com/elastic/elasticsearch/pull/57067#discussion_r430461220", "bodyText": "I think true is ok here, this is in an API response.", "author": "DaveCTurner", "createdAt": "2020-05-26T14:35:26Z", "path": "docs/reference/snapshot-restore/restore-snapshot.asciidoc", "diffHunk": "@@ -160,7 +163,7 @@ The output looks similar to the following:\n       \"repository\": \"my_backup\",\n       \"uuid\": \"XuBo4l4ISYiVg0nYUen9zg\",\n       \"state\": \"SUCCESS\",\n-      \"include_global_state\": true,\n+      \"include_global_state\": false,", "originalCommit": "a98aac2c5ee48923b1ce3438876f296c4ff57b07", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQ2ODAxMQ==", "url": "https://github.com/elastic/elasticsearch/pull/57067#discussion_r430468011", "bodyText": "I reverted this with a07e2a0.", "author": "jrodewig", "createdAt": "2020-05-26T14:44:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQ2MTIyMA=="}], "type": "inlineReview"}, {"oid": "0715227dd97b16c9584bf2d0e4701c13eb78d5b3", "url": "https://github.com/elastic/elasticsearch/commit/0715227dd97b16c9584bf2d0e4701c13eb78d5b3", "message": "Update docs/reference/snapshot-restore/restore-snapshot.asciidoc\n\nCo-authored-by: David Turner <david.turner@elastic.co>", "committedDate": "2020-05-26T14:41:07Z", "type": "commit"}, {"oid": "7b314b01d376f7f04d5725683a2365b284eb84be", "url": "https://github.com/elastic/elasticsearch/commit/7b314b01d376f7f04d5725683a2365b284eb84be", "message": "Update docs/reference/snapshot-restore/restore-snapshot.asciidoc\n\nCo-authored-by: David Turner <david.turner@elastic.co>", "committedDate": "2020-05-26T14:41:23Z", "type": "commit"}, {"oid": "eaffccd69c56a343adcb5c67b3aec58a80b8bde5", "url": "https://github.com/elastic/elasticsearch/commit/eaffccd69c56a343adcb5c67b3aec58a80b8bde5", "message": "Update docs/reference/snapshot-restore/restore-snapshot.asciidoc\n\nCo-authored-by: David Turner <david.turner@elastic.co>", "committedDate": "2020-05-26T14:41:32Z", "type": "commit"}, {"oid": "b23b186b099bb5319b1595631e544016108b36a9", "url": "https://github.com/elastic/elasticsearch/commit/b23b186b099bb5319b1595631e544016108b36a9", "message": "Update docs/reference/snapshot-restore/restore-snapshot.asciidoc\n\nCo-authored-by: David Turner <david.turner@elastic.co>", "committedDate": "2020-05-26T14:41:40Z", "type": "commit"}, {"oid": "a07e2a06fe4d9f64f56467bd3721b31de1ad6800", "url": "https://github.com/elastic/elasticsearch/commit/a07e2a06fe4d9f64f56467bd3721b31de1ad6800", "message": "revert response change", "committedDate": "2020-05-26T14:42:41Z", "type": "commit"}, {"oid": "967d8299a1c3bed3452e8a732a87840bfd61a1c4", "url": "https://github.com/elastic/elasticsearch/commit/967d8299a1c3bed3452e8a732a87840bfd61a1c4", "message": "reword/rewrap", "committedDate": "2020-05-26T14:43:39Z", "type": "commit"}]}