{"pr_number": 57560, "pr_title": "[DOCS] Add documentation for near real-time search", "pr_createdAt": "2020-06-02T21:24:09Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/57560", "timeline": [{"oid": "e491cd62906a9d197c4bbccfd29ff4fef5f56e2c", "url": "https://github.com/elastic/elasticsearch/commit/e491cd62906a9d197c4bbccfd29ff4fef5f56e2c", "message": "Adding documentation for near real-time search.", "committedDate": "2020-06-02T21:21:06Z", "type": "commit"}, {"oid": "d0afddd1c32c086be2cffebdd65c9787d7338a45", "url": "https://github.com/elastic/elasticsearch/commit/d0afddd1c32c086be2cffebdd65c9787d7338a45", "message": "Adding link to NRT topic and clarifying some text.", "committedDate": "2020-06-03T13:32:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTc4NTEzNQ==", "url": "https://github.com/elastic/elasticsearch/pull/57560#discussion_r435785135", "bodyText": "Suggest moving this down to the second item in the TOC, since this is probably not the first thing a beginner needs to read.", "author": "DaveCTurner", "createdAt": "2020-06-05T08:58:13Z", "path": "docs/reference/search/index.asciidoc", "diffHunk": "@@ -28,12 +28,14 @@ a specific number of results.\n [[search-toc]]\n === In this section\n \n+* <<near-real-time>>", "originalCommit": "d0afddd1c32c086be2cffebdd65c9787d7338a45", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTc4NjMwMQ==", "url": "https://github.com/elastic/elasticsearch/pull/57560#discussion_r435786301", "bodyText": "Can we lift some of the content/diagrams from the definitive guide to this page? I think these are difficult concepts for beginners to handle, so we should try and start from the basics and make this page as self-contained as possible. The target audience includes first-time users that just started Elasticsearch, indexed some docs, tried to search for them, and didn't find them.", "author": "DaveCTurner", "createdAt": "2020-06-05T09:00:03Z", "path": "docs/reference/search/near-real-time.asciidoc", "diffHunk": "@@ -0,0 +1,21 @@\n+[[near-real-time]]\n+== Near real-time search", "originalCommit": "d0afddd1c32c086be2cffebdd65c9787d7338a45", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjAzNDI4Nw==", "url": "https://github.com/elastic/elasticsearch/pull/57560#discussion_r436034287", "bodyText": "Agreed. I will migrate some content from the NRT page in the definitive guide to help bridge this gap.", "author": "lockewritesdocs", "createdAt": "2020-06-05T16:33:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTc4NjMwMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTc4NjM5Nw==", "url": "https://github.com/elastic/elasticsearch/pull/57560#discussion_r435786397", "bodyText": "Could you wrap to 80 columns?", "author": "DaveCTurner", "createdAt": "2020-06-05T09:00:11Z", "path": "docs/reference/search/near-real-time.asciidoc", "diffHunk": "@@ -0,0 +1,21 @@\n+[[near-real-time]]\n+== Near real-time search\n+The overview of <<documents-indices,documents and indices>> indicates that when a document is stored in {es}, it is indexed and fully searchable in _near real-time_--within 1 second. What defines near real-time search?", "originalCommit": "d0afddd1c32c086be2cffebdd65c9787d7338a45", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjAxOTY3NQ==", "url": "https://github.com/elastic/elasticsearch/pull/57560#discussion_r436019675", "bodyText": "I have the preferred line length set to 80 in Atom editor, and all lines appear to be wrapping at that length. If you notice this issue again, please let me know.", "author": "lockewritesdocs", "createdAt": "2020-06-05T16:06:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTc4NjM5Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTc4NzYyNw==", "url": "https://github.com/elastic/elasticsearch/pull/57560#discussion_r435787627", "bodyText": "Could we expand this to spell out all the different ways that a refresh might happen?\n\nwait for the refresh interval\nuse the ?refresh option\nperform an explicit POST _refresh\n\nAlso let's not call it \"lightweight\" as an absolute term. It's certainly lighter than a full commit, but it's not free and you can cause performance issues by doing it too much.", "author": "DaveCTurner", "createdAt": "2020-06-05T09:02:17Z", "path": "docs/reference/search/near-real-time.asciidoc", "diffHunk": "@@ -0,0 +1,21 @@\n+[[near-real-time]]\n+== Near real-time search\n+The overview of <<documents-indices,documents and indices>> indicates that when a document is stored in {es}, it is indexed and fully searchable in _near real-time_--within 1 second. What defines near real-time search?\n+\n+Lucene, the Java libraries on which {es} is based, introduced the concept of per-segment search. A _segment_ is similar to an inverted index, but the word _index_ in Lucene means \"a collection of segments plus a commit point\". After a commit, a new segment is added to the commit point and the buffer is cleared.\n+\n+Lucene allows new segments to be written and opened, making the documents they contain visible to search \u200bwithout performing a full commit. This is a much lighter process than a commit to disk, and can be done frequently without degrading performance.\n+\n+In {es}, this lightweight process of writing and opening a new segment is called a _refresh_. A refresh makes all operations performed on an index since the last refresh available for search. By default, every shard is refreshed automatically once per second. This is why we say that {es} has _near_ real-time search: document changes are not visible to search immediately, but will become visible within 1 second.", "originalCommit": "d0afddd1c32c086be2cffebdd65c9787d7338a45", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjExMzA1OA==", "url": "https://github.com/elastic/elasticsearch/pull/57560#discussion_r436113058", "bodyText": "Adding a list to explicitly mention those options, and removing \"lightweight\".", "author": "lockewritesdocs", "createdAt": "2020-06-05T19:08:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTc4NzYyNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTc4OTgyNQ==", "url": "https://github.com/elastic/elasticsearch/pull/57560#discussion_r435789825", "bodyText": "Also, the default isn't quite to refresh every second, it's more complicated than that. If you're searching frequently enough then we do indeed refresh every second but if there's a gap in searches of over 30s then we stop refreshing periodically and instead refresh just before the first search after the \u226530s gap, which can cause a surprising pause in how long that search takes.", "author": "DaveCTurner", "createdAt": "2020-06-05T09:06:24Z", "path": "docs/reference/search/near-real-time.asciidoc", "diffHunk": "@@ -0,0 +1,21 @@\n+[[near-real-time]]\n+== Near real-time search\n+The overview of <<documents-indices,documents and indices>> indicates that when a document is stored in {es}, it is indexed and fully searchable in _near real-time_--within 1 second. What defines near real-time search?\n+\n+Lucene, the Java libraries on which {es} is based, introduced the concept of per-segment search. A _segment_ is similar to an inverted index, but the word _index_ in Lucene means \"a collection of segments plus a commit point\". After a commit, a new segment is added to the commit point and the buffer is cleared.\n+\n+Lucene allows new segments to be written and opened, making the documents they contain visible to search \u200bwithout performing a full commit. This is a much lighter process than a commit to disk, and can be done frequently without degrading performance.\n+\n+In {es}, this lightweight process of writing and opening a new segment is called a _refresh_. A refresh makes all operations performed on an index since the last refresh available for search. By default, every shard is refreshed automatically once per second. This is why we say that {es} has _near_ real-time search: document changes are not visible to search immediately, but will become visible within 1 second.", "originalCommit": "d0afddd1c32c086be2cffebdd65c9787d7338a45", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjExMzQ1OA==", "url": "https://github.com/elastic/elasticsearch/pull/57560#discussion_r436113458", "bodyText": "Thanks for the clarification! I'm modifying this section to read:\n\nBy default, Elasticsearch periodically refreshes indices every second, but only on indices that have received one search request or more in the last 30 seconds. This is why we say that Elasticsearch has near real-time search: document changes are not visible to search immediately, but will become visible within this timeframe.", "author": "lockewritesdocs", "createdAt": "2020-06-05T19:09:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTc4OTgyNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTc5MjMyOQ==", "url": "https://github.com/elastic/elasticsearch/pull/57560#discussion_r435792329", "bodyText": "I think we don't need this section, if we link to the ?refresh docs above.", "author": "DaveCTurner", "createdAt": "2020-06-05T09:10:52Z", "path": "docs/reference/search/near-real-time.asciidoc", "diffHunk": "@@ -0,0 +1,21 @@\n+[[near-real-time]]\n+== Near real-time search\n+The overview of <<documents-indices,documents and indices>> indicates that when a document is stored in {es}, it is indexed and fully searchable in _near real-time_--within 1 second. What defines near real-time search?\n+\n+Lucene, the Java libraries on which {es} is based, introduced the concept of per-segment search. A _segment_ is similar to an inverted index, but the word _index_ in Lucene means \"a collection of segments plus a commit point\". After a commit, a new segment is added to the commit point and the buffer is cleared.\n+\n+Lucene allows new segments to be written and opened, making the documents they contain visible to search \u200bwithout performing a full commit. This is a much lighter process than a commit to disk, and can be done frequently without degrading performance.\n+\n+In {es}, this lightweight process of writing and opening a new segment is called a _refresh_. A refresh makes all operations performed on an index since the last refresh available for search. By default, every shard is refreshed automatically once per second. This is why we say that {es} has _near_ real-time search: document changes are not visible to search immediately, but will become visible within 1 second.\n+\n+[[near-real-time-configure-refresh]]\n+[discrete]\n+=== Configuring the refresh interval", "originalCommit": "d0afddd1c32c086be2cffebdd65c9787d7338a45", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "1b9297d6b08e39e9de0f35415f8208714425818b", "url": "https://github.com/elastic/elasticsearch/commit/1b9297d6b08e39e9de0f35415f8208714425818b", "message": "Adding diagrams and incorporating changes from David T.", "committedDate": "2020-06-05T19:10:12Z", "type": "commit"}]}