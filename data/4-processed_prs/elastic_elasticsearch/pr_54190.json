{"pr_number": 54190, "pr_title": "[DOCS] Adds feature importance mapping subsection to inference processor docs", "pr_createdAt": "2020-03-25T15:05:31Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/54190", "timeline": [{"oid": "c16c827aa2bafc4d1babfcc8549ec09d7661d265", "url": "https://github.com/elastic/elasticsearch/commit/c16c827aa2bafc4d1babfcc8549ec09d7661d265", "message": "[DOCS] Adds feature importance mapping subsection to inference processor docs.", "committedDate": "2020-03-25T14:51:37Z", "type": "commit"}, {"oid": "06e148db62dbd5b705163ffd7e320e751da22873", "url": "https://github.com/elastic/elasticsearch/commit/06e148db62dbd5b705163ffd7e320e751da22873", "message": "[DOCS] Fixes mapping path.", "committedDate": "2020-03-25T15:04:37Z", "type": "commit"}, {"oid": "92bf8e9fe38c025111b0c1d2954ef71530b57f79", "url": "https://github.com/elastic/elasticsearch/commit/92bf8e9fe38c025111b0c1d2954ef71530b57f79", "message": "[DOCS] Adjusts indentation.", "committedDate": "2020-03-25T15:07:46Z", "type": "commit"}, {"oid": "4f6c0d614cb59a332d123750e113f2f1765d7292", "url": "https://github.com/elastic/elasticsearch/commit/4f6c0d614cb59a332d123750e113f2f1765d7292", "message": "[DOCS] Fixes link.", "committedDate": "2020-03-25T15:19:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzk0ODc2NQ==", "url": "https://github.com/elastic/elasticsearch/pull/54190#discussion_r397948765", "bodyText": "This should indicate that this is the mapping for the feature importance result field.", "author": "benwtrent", "createdAt": "2020-03-25T15:31:55Z", "path": "docs/reference/ingest/processors/inference.asciidoc", "diffHunk": "@@ -116,3 +117,36 @@ categories for which the predicted probabilities are reported is 2\n (`num_top_classes`). The result is written to the `prediction` field and the top \n classes to the `probabilities` field. Both fields are contained in the \n `target_field` results object.\n+\n+\n+[discrete]\n+[[inference-processor-feature-importance]]\n+==== {feat-imp-cap} object mapping\n+\n+Update your index mapping as you can see below to get the full benefit of \n+aggregating and searching for \n+{ml-docs}/dfa-classification.html#dfa-classification-feature-importance[{feat-imp}].\n+\n+[source,js]\n+--------------------------------------------------\n+{", "originalCommit": "4f6c0d614cb59a332d123750e113f2f1765d7292", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzk1MTg1Mw==", "url": "https://github.com/elastic/elasticsearch/pull/54190#discussion_r397951853", "bodyText": "probably some inference configs + field name examples?\n{\n    \"tag\": \"foo\",\n    ...\n}\n\nWrites feature importance to field ml.inference.foo.feature_importance.\n{\n    \"tag\": \"foo\",\n    \"target_field\": \"my_field\"\n}\n\nWrites feature importance to field my_field.foo.feature_importance.", "author": "benwtrent", "createdAt": "2020-03-25T15:35:42Z", "path": "docs/reference/ingest/processors/inference.asciidoc", "diffHunk": "@@ -116,3 +117,36 @@ categories for which the predicted probabilities are reported is 2\n (`num_top_classes`). The result is written to the `prediction` field and the top \n classes to the `probabilities` field. Both fields are contained in the \n `target_field` results object.\n+\n+\n+[discrete]\n+[[inference-processor-feature-importance]]\n+==== {feat-imp-cap} object mapping\n+\n+Update your index mapping as you can see below to get the full benefit of \n+aggregating and searching for \n+{ml-docs}/dfa-classification.html#dfa-classification-feature-importance[{feat-imp}].\n+\n+[source,js]\n+--------------------------------------------------\n+{\n+  \"type\": \"nested\",\n+  \"dynamic\": true,\n+  \"properties\": {\n+    \"feature_name\": {\n+      \"type\": \"keyword\"\n+    },\n+    \"importance\": {\n+      \"type\": \"double\"\n+    }\n+  }\n+}\n+--------------------------------------------------\n+// NOTCONSOLE\n+\n+The mapping field name for {feat-imp} is compounded as follows:\n+\n+`ml.<inference.target_field>`.`<inference.tag>`.`feature_importance`\n+\n+If `inference.tag` is not provided in the processor definition, it is not part \n+of the field path. The `<inference.target_field>` defaults to `inference`.", "originalCommit": "4f6c0d614cb59a332d123750e113f2f1765d7292", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "51990ab7cfd26241e1f9e4a702dd2ab622ed38ec", "url": "https://github.com/elastic/elasticsearch/commit/51990ab7cfd26241e1f9e4a702dd2ab622ed38ec", "message": "[DOCS] Addresses feedback.", "committedDate": "2020-03-25T16:19:22Z", "type": "commit"}, {"oid": "f7d907c5ec9259d65fd3208afc4233eb73fbf978", "url": "https://github.com/elastic/elasticsearch/commit/f7d907c5ec9259d65fd3208afc4233eb73fbf978", "message": "[DOCS] Adds field name to the snippet.", "committedDate": "2020-03-25T16:26:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzk5OTY4MA==", "url": "https://github.com/elastic/elasticsearch/pull/54190#discussion_r397999680", "bodyText": "it is not ml.my_field. Its just my_field.foo.feature_importance", "author": "benwtrent", "createdAt": "2020-03-25T16:36:28Z", "path": "docs/reference/ingest/processors/inference.asciidoc", "diffHunk": "@@ -149,4 +149,33 @@ The mapping field name for {feat-imp} is compounded as follows:\n `ml.<inference.target_field>`.`<inference.tag>`.`feature_importance`\n \n If `inference.tag` is not provided in the processor definition, it is not part \n-of the field path. The `<inference.target_field>` defaults to `inference`.\n\\ No newline at end of file\n+of the field path. The `<inference.target_field>` defaults to `inference`.\n+\n+For example, you provide a tag `foo` in the definition as you can see below:\n+\n+[source,js]\n+--------------------------------------------------\n+{\n+  \"tag\": \"foo\",\n+  ...\n+}\n+--------------------------------------------------\n+// NOTCONSOLE\n+\n+\n+The `{feat-imp}` value is written to the `ml.inference.foo.feature_importance` \n+field.\n+\n+You can also specify a target field as follows:\n+\n+[source,js]\n+--------------------------------------------------\n+{\n+  \"tag\": \"foo\",\n+  \"target_field\": \"my_field\"\n+}\n+--------------------------------------------------\n+// NOTCONSOLE\n+\n+In this case, `{feat-imp}` is exposed in the \n+`ml.my_field.foo.feature_importance` field.", "originalCommit": "51990ab7cfd26241e1f9e4a702dd2ab622ed38ec", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODAxMjk4Mg==", "url": "https://github.com/elastic/elasticsearch/pull/54190#discussion_r398012982", "bodyText": "@benwtrent Thanks. I also updated the schema accordingly. I.e.: <ml.inference.target_field>.<inference.tag>.feature_importance instead of\nml.<inference.target_field>.<inference.tag>.feature_importance", "author": "szabosteve", "createdAt": "2020-03-25T16:54:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzk5OTY4MA=="}], "type": "inlineReview"}, {"oid": "de64cf5d6973640abf0252a69829fdaacc8df562", "url": "https://github.com/elastic/elasticsearch/commit/de64cf5d6973640abf0252a69829fdaacc8df562", "message": "[DOCS] Addresses feedback.", "committedDate": "2020-03-25T16:52:28Z", "type": "commit"}]}