{"pr_number": 53558, "pr_title": "Add REST API for ComponentTemplate CRUD", "pr_createdAt": "2020-03-13T19:01:34Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/53558", "timeline": [{"oid": "0d1fcfd03bf22dff28ff24abb19812b6b370f415", "url": "https://github.com/elastic/elasticsearch/commit/0d1fcfd03bf22dff28ff24abb19812b6b370f415", "message": "Add REST API for ComponentTemplate CRUD\n\nThis adds the Put/Get/DeleteComponentTemplate APIs that allow inserting, retrieving, and removing\nComponentTemplateMetadata into the cluster state metadata.\n\nThese APIs are currently only available behind a feature flag system property -\n`es.itv2_feature_flag_registered`.\n\nRelates to #53101", "committedDate": "2020-03-13T18:59:24Z", "type": "commit"}, {"oid": "92801325388d4b6c61d9b441f4445741b32aa226", "url": "https://github.com/elastic/elasticsearch/commit/92801325388d4b6c61d9b441f4445741b32aa226", "message": "Fix API names in json spec", "committedDate": "2020-03-13T19:10:20Z", "type": "commit"}, {"oid": "d406dc5072cd1c7df004fcfb9341e209cc7de427", "url": "https://github.com/elastic/elasticsearch/commit/d406dc5072cd1c7df004fcfb9341e209cc7de427", "message": "Fix yaml test definition", "committedDate": "2020-03-13T19:31:29Z", "type": "commit"}, {"oid": "e2cba2600c0255237f613bf65c937f89d0f72fd5", "url": "https://github.com/elastic/elasticsearch/commit/e2cba2600c0255237f613bf65c937f89d0f72fd5", "message": "Fix version in skip", "committedDate": "2020-03-13T20:32:10Z", "type": "commit"}, {"oid": "a312ef9f0c078b87b9b14b19747368c1345a8cf6", "url": "https://github.com/elastic/elasticsearch/commit/a312ef9f0c078b87b9b14b19747368c1345a8cf6", "message": "I think I finally got the right format :|", "committedDate": "2020-03-13T21:07:22Z", "type": "commit"}, {"oid": "d46eca0cbc51a3c97b548ab3a60059bb1acde6f0", "url": "https://github.com/elastic/elasticsearch/commit/d46eca0cbc51a3c97b548ab3a60059bb1acde6f0", "message": "Add component apis to exceptions list", "committedDate": "2020-03-13T21:16:11Z", "type": "commit"}, {"oid": "b77411f012eef3fbf321e072bf5156d9875dac7a", "url": "https://github.com/elastic/elasticsearch/commit/b77411f012eef3fbf321e072bf5156d9875dac7a", "message": "Fix yaml test", "committedDate": "2020-03-13T21:47:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjkwOTI0Ng==", "url": "https://github.com/elastic/elasticsearch/pull/53558#discussion_r392909246", "bodyText": "Perhaps inline the request and transport actions classes into each action class?\nI think this will save some LOC.", "author": "martijnvg", "createdAt": "2020-03-16T10:17:03Z", "path": "server/src/main/java/org/elasticsearch/action/admin/indices/template/delete/DeleteComponentTemplateAction.java", "diffHunk": "@@ -0,0 +1,34 @@\n+/*\n+ * Licensed to Elasticsearch under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.elasticsearch.action.admin.indices.template.delete;\n+\n+import org.elasticsearch.action.ActionType;\n+import org.elasticsearch.action.support.master.AcknowledgedResponse;\n+\n+public class DeleteComponentTemplateAction extends ActionType<AcknowledgedResponse> {\n+\n+    public static final DeleteComponentTemplateAction INSTANCE = new DeleteComponentTemplateAction();\n+    public static final String NAME = \"cluster:admin/component_template/delete\";\n+\n+    private DeleteComponentTemplateAction() {\n+        super(NAME, AcknowledgedResponse::new);\n+    }\n+", "originalCommit": "b77411f012eef3fbf321e072bf5156d9875dac7a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE2MDEwMA==", "url": "https://github.com/elastic/elasticsearch/pull/53558#discussion_r393160100", "bodyText": "Sure, I can do that", "author": "dakrone", "createdAt": "2020-03-16T16:41:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjkwOTI0Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjkxMDI0NQ==", "url": "https://github.com/elastic/elasticsearch/pull/53558#discussion_r392910245", "bodyText": "maybe move the body of this method and remove method into a static method?\nThis will make writing unit tests easier.", "author": "martijnvg", "createdAt": "2020-03-16T10:18:58Z", "path": "server/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexTemplateService.java", "diffHunk": "@@ -132,6 +134,98 @@ public void clusterStateProcessed(String source, ClusterState oldState, ClusterS\n         });\n     }\n \n+    /**\n+     * Add the given component template to the cluster state. If {@code create} is true, an\n+     * exception will be thrown if the component template already exists\n+     */\n+    public void putComponentTemplate(final String cause, final boolean create, final String name, final TimeValue masterTimeout,\n+                                     final ComponentTemplate template, final ActionListener<AcknowledgedResponse> listener) {\n+        clusterService.submitStateUpdateTask(\"create-component-template [\" + name + \"], cause [\" + cause + \"]\",\n+            new ClusterStateUpdateTask(Priority.URGENT) {\n+\n+                @Override\n+                public TimeValue timeout() {\n+                    return masterTimeout;\n+                }\n+\n+                @Override\n+                public void onFailure(String source, Exception e) {\n+                    listener.onFailure(e);\n+                }\n+\n+                @Override\n+                public ClusterState execute(ClusterState currentState) {\n+                    if (create && currentState.metaData().componentTemplates().containsKey(name)) {", "originalCommit": "b77411f012eef3fbf321e072bf5156d9875dac7a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE2MDE2MQ==", "url": "https://github.com/elastic/elasticsearch/pull/53558#discussion_r393160161", "bodyText": "Will do, and I'll add a unit test for it.", "author": "dakrone", "createdAt": "2020-03-16T16:41:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjkxMDI0NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjkxMzgxNw==", "url": "https://github.com/elastic/elasticsearch/pull/53558#discussion_r392913817", "bodyText": "Should we return a json array here? If I recall correctly, for new apis we try to return arrays instead of keyed json objects.", "author": "martijnvg", "createdAt": "2020-03-16T10:25:57Z", "path": "server/src/main/java/org/elasticsearch/action/admin/indices/template/get/GetComponentTemplateResponse.java", "diffHunk": "@@ -0,0 +1,87 @@\n+/*\n+ * Licensed to Elasticsearch under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.elasticsearch.action.admin.indices.template.get;\n+\n+import org.elasticsearch.action.ActionResponse;\n+import org.elasticsearch.cluster.metadata.ComponentTemplate;\n+import org.elasticsearch.common.io.stream.StreamInput;\n+import org.elasticsearch.common.io.stream.StreamOutput;\n+import org.elasticsearch.common.xcontent.ToXContentObject;\n+import org.elasticsearch.common.xcontent.XContentBuilder;\n+\n+import java.io.IOException;\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.Objects;\n+\n+public class GetComponentTemplateResponse extends ActionResponse implements ToXContentObject {\n+\n+    private final Map<String, ComponentTemplate> componentTemplates;\n+\n+    public GetComponentTemplateResponse(StreamInput in) throws IOException {\n+        super(in);\n+        int size = in.readVInt();\n+        componentTemplates = new HashMap<>();\n+        for (int i = 0 ; i < size ; i++) {\n+            componentTemplates.put(in.readString(), new ComponentTemplate(in));\n+        }\n+    }\n+\n+    public GetComponentTemplateResponse(Map<String, ComponentTemplate> componentTemplates) {\n+        this.componentTemplates = componentTemplates;\n+    }\n+\n+    public Map<String, ComponentTemplate> getComponentTemplates() {\n+        return componentTemplates;\n+    }\n+\n+    @Override\n+    public void writeTo(StreamOutput out) throws IOException {\n+        out.writeVInt(componentTemplates.size());\n+        for (Map.Entry<String, ComponentTemplate> componentTemplate : componentTemplates.entrySet()) {\n+            out.writeString(componentTemplate.getKey());\n+            componentTemplate.getValue().writeTo(out);\n+        }\n+    }\n+\n+    @Override\n+    public boolean equals(Object o) {\n+        if (this == o) return true;\n+        if (o == null || getClass() != o.getClass()) return false;\n+        GetComponentTemplateResponse that = (GetComponentTemplateResponse) o;\n+        return Objects.equals(componentTemplates, that.componentTemplates);\n+    }\n+\n+    @Override\n+    public int hashCode() {\n+        return Objects.hash(componentTemplates);\n+    }\n+\n+    @Override\n+    public XContentBuilder toXContent(XContentBuilder builder, Params params) throws IOException {\n+        builder.startObject();", "originalCommit": "b77411f012eef3fbf321e072bf5156d9875dac7a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzA4MjQwMg==", "url": "https://github.com/elastic/elasticsearch/pull/53558#discussion_r393082402", "bodyText": "I'm on the fence about this, on one hand I wanted to try and match the existing templates API output to be as \"familiar\" to folks as possible, but I know that a lot of people like the newer format of arrays of json objects (I really don't -_-). I can go either way, if you think it's valuable to have it in the new format then I can change it, what do you think @martijnvg?", "author": "dakrone", "createdAt": "2020-03-16T14:50:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjkxMzgxNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE1MDQyNw==", "url": "https://github.com/elastic/elasticsearch/pull/53558#discussion_r393150427", "bodyText": "I think because eventually all APIs that return multiple objects will move to return an array instead of a json object with a keyed json object, so I'd be in favor of returning the new format here. @jakelandis what do you think?", "author": "martijnvg", "createdAt": "2020-03-16T16:26:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjkxMzgxNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjUxNTk2Nw==", "url": "https://github.com/elastic/elasticsearch/pull/53558#discussion_r392515967", "bodyText": "Use Strings.hasText(name) == false instead of !", "author": "probakowski", "createdAt": "2020-03-13T22:38:54Z", "path": "server/src/main/java/org/elasticsearch/action/admin/indices/template/get/GetComponentTemplateRequest.java", "diffHunk": "@@ -0,0 +1,85 @@\n+/*\n+ * Licensed to Elasticsearch under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.elasticsearch.action.admin.indices.template.get;\n+\n+import org.elasticsearch.action.ActionRequestValidationException;\n+import org.elasticsearch.action.support.master.MasterNodeReadRequest;\n+import org.elasticsearch.common.Strings;\n+import org.elasticsearch.common.io.stream.StreamInput;\n+import org.elasticsearch.common.io.stream.StreamOutput;\n+\n+import java.io.IOException;\n+\n+import static org.elasticsearch.action.ValidateActions.addValidationError;\n+\n+/**\n+ * Request that to retrieve one or more component templates\n+ */\n+public class GetComponentTemplateRequest extends MasterNodeReadRequest<GetComponentTemplateRequest> {\n+\n+    private String[] names;\n+\n+    public GetComponentTemplateRequest() { }\n+\n+    public GetComponentTemplateRequest(String... names) {\n+        this.names = names;\n+    }\n+\n+    public GetComponentTemplateRequest(StreamInput in) throws IOException {\n+        super(in);\n+        names = in.readStringArray();\n+    }\n+\n+    @Override\n+    public void writeTo(StreamOutput out) throws IOException {\n+        super.writeTo(out);\n+        out.writeStringArray(names);\n+    }\n+\n+    @Override\n+    public ActionRequestValidationException validate() {\n+        ActionRequestValidationException validationException = null;\n+        if (names == null) {\n+            validationException = addValidationError(\"names is null or empty\", validationException);\n+        } else {\n+            for (String name : names) {\n+                if (name == null || !Strings.hasText(name)) {", "originalCommit": "b77411f012eef3fbf321e072bf5156d9875dac7a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjUxNjY5NA==", "url": "https://github.com/elastic/elasticsearch/pull/53558#discussion_r392516694", "bodyText": "empty names is allowed, right? To return all templates?", "author": "probakowski", "createdAt": "2020-03-13T22:41:48Z", "path": "server/src/main/java/org/elasticsearch/action/admin/indices/template/get/GetComponentTemplateRequest.java", "diffHunk": "@@ -0,0 +1,85 @@\n+/*\n+ * Licensed to Elasticsearch under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.elasticsearch.action.admin.indices.template.get;\n+\n+import org.elasticsearch.action.ActionRequestValidationException;\n+import org.elasticsearch.action.support.master.MasterNodeReadRequest;\n+import org.elasticsearch.common.Strings;\n+import org.elasticsearch.common.io.stream.StreamInput;\n+import org.elasticsearch.common.io.stream.StreamOutput;\n+\n+import java.io.IOException;\n+\n+import static org.elasticsearch.action.ValidateActions.addValidationError;\n+\n+/**\n+ * Request that to retrieve one or more component templates\n+ */\n+public class GetComponentTemplateRequest extends MasterNodeReadRequest<GetComponentTemplateRequest> {\n+\n+    private String[] names;\n+\n+    public GetComponentTemplateRequest() { }\n+\n+    public GetComponentTemplateRequest(String... names) {\n+        this.names = names;\n+    }\n+\n+    public GetComponentTemplateRequest(StreamInput in) throws IOException {\n+        super(in);\n+        names = in.readStringArray();\n+    }\n+\n+    @Override\n+    public void writeTo(StreamOutput out) throws IOException {\n+        super.writeTo(out);\n+        out.writeStringArray(names);\n+    }\n+\n+    @Override\n+    public ActionRequestValidationException validate() {\n+        ActionRequestValidationException validationException = null;\n+        if (names == null) {\n+            validationException = addValidationError(\"names is null or empty\", validationException);", "originalCommit": "b77411f012eef3fbf321e072bf5156d9875dac7a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE0Njg5Ng==", "url": "https://github.com/elastic/elasticsearch/pull/53558#discussion_r393146896", "bodyText": "It is, an empty array, but not null in this case", "author": "dakrone", "createdAt": "2020-03-16T16:21:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjUxNjY5NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjUxNjk5Mw==", "url": "https://github.com/elastic/elasticsearch/pull/53558#discussion_r392516993", "bodyText": "You can move it above if and reuse", "author": "probakowski", "createdAt": "2020-03-13T22:43:13Z", "path": "server/src/main/java/org/elasticsearch/action/admin/indices/template/get/TransportGetComponentTemplateAction.java", "diffHunk": "@@ -0,0 +1,95 @@\n+/*\n+ * Licensed to Elasticsearch under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.elasticsearch.action.admin.indices.template.get;\n+\n+import org.elasticsearch.action.ActionListener;\n+import org.elasticsearch.action.support.ActionFilters;\n+import org.elasticsearch.action.support.master.TransportMasterNodeReadAction;\n+import org.elasticsearch.cluster.ClusterState;\n+import org.elasticsearch.cluster.block.ClusterBlockException;\n+import org.elasticsearch.cluster.block.ClusterBlockLevel;\n+import org.elasticsearch.cluster.metadata.ComponentTemplate;\n+import org.elasticsearch.cluster.metadata.IndexNameExpressionResolver;\n+import org.elasticsearch.cluster.service.ClusterService;\n+import org.elasticsearch.common.inject.Inject;\n+import org.elasticsearch.common.io.stream.StreamInput;\n+import org.elasticsearch.common.regex.Regex;\n+import org.elasticsearch.tasks.Task;\n+import org.elasticsearch.threadpool.ThreadPool;\n+import org.elasticsearch.transport.TransportService;\n+\n+import java.io.IOException;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+public class TransportGetComponentTemplateAction extends\n+    TransportMasterNodeReadAction<GetComponentTemplateRequest, GetComponentTemplateResponse> {\n+\n+    @Inject\n+    public TransportGetComponentTemplateAction(TransportService transportService, ClusterService clusterService,\n+                                               ThreadPool threadPool, ActionFilters actionFilters,\n+                                               IndexNameExpressionResolver indexNameExpressionResolver) {\n+        super(GetComponentTemplateAction.NAME, transportService, clusterService, threadPool, actionFilters,\n+            GetComponentTemplateRequest::new, indexNameExpressionResolver);\n+    }\n+\n+    @Override\n+    protected String executor() {\n+        return ThreadPool.Names.SAME;\n+    }\n+\n+    @Override\n+    protected GetComponentTemplateResponse read(StreamInput in) throws IOException {\n+        return new GetComponentTemplateResponse(in);\n+    }\n+\n+    @Override\n+    protected ClusterBlockException checkBlock(GetComponentTemplateRequest request, ClusterState state) {\n+        return state.blocks().globalBlockedException(ClusterBlockLevel.METADATA_READ);\n+    }\n+\n+    @Override\n+    protected void masterOperation(Task task, GetComponentTemplateRequest request, ClusterState state,\n+                                   ActionListener<GetComponentTemplateResponse> listener) {\n+        final Map<String, ComponentTemplate> results;\n+\n+        // If we did not ask for a specific name, then we return all templates\n+        if (request.names().length == 0) {\n+            results = new HashMap<>(state.metaData().componentTemplates());\n+        } else {\n+            results = new HashMap<>();\n+        }\n+\n+        Map<String, ComponentTemplate> allTemplates = state.metaData().componentTemplates();", "originalCommit": "b77411f012eef3fbf321e072bf5156d9875dac7a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjUxNzM2MA==", "url": "https://github.com/elastic/elasticsearch/pull/53558#discussion_r392517360", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (name == null) {\n          \n          \n            \n                    if (name == null || Strings.hasText(name) == false) {", "author": "probakowski", "createdAt": "2020-03-13T22:44:39Z", "path": "server/src/main/java/org/elasticsearch/action/admin/indices/template/put/PutComponentTemplateRequest.java", "diffHunk": "@@ -0,0 +1,134 @@\n+/*\n+ * Licensed to Elasticsearch under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.elasticsearch.action.admin.indices.template.put;\n+\n+import org.elasticsearch.action.ActionRequestValidationException;\n+import org.elasticsearch.action.support.master.MasterNodeRequest;\n+import org.elasticsearch.cluster.metadata.ComponentTemplate;\n+import org.elasticsearch.common.Nullable;\n+import org.elasticsearch.common.io.stream.StreamInput;\n+import org.elasticsearch.common.io.stream.StreamOutput;\n+\n+import java.io.IOException;\n+\n+import static org.elasticsearch.action.ValidateActions.addValidationError;\n+\n+/**\n+ * A request for putting a single component template into the cluster state\n+ */\n+public class PutComponentTemplateRequest extends MasterNodeRequest<PutComponentTemplateRequest> {\n+    private final String name;\n+    @Nullable\n+    private String cause;\n+    private boolean create;\n+    private ComponentTemplate componentTemplate;\n+\n+    public PutComponentTemplateRequest(StreamInput in) throws IOException {\n+        super(in);\n+        this.name = in.readString();\n+        this.cause = in.readOptionalString();\n+        this.create = in.readBoolean();\n+        this.componentTemplate = new ComponentTemplate(in);\n+    }\n+\n+    /**\n+     * Constructs a new put component template request with the provided name.\n+     */\n+    public PutComponentTemplateRequest(String name) {\n+        this.name = name;\n+    }\n+\n+    @Override\n+    public void writeTo(StreamOutput out) throws IOException {\n+        super.writeTo(out);\n+        out.writeString(name);\n+        out.writeOptionalString(cause);\n+        out.writeBoolean(create);\n+        this.componentTemplate.writeTo(out);\n+    }\n+\n+    @Override\n+    public ActionRequestValidationException validate() {\n+        ActionRequestValidationException validationException = null;\n+        if (name == null) {", "originalCommit": "b77411f012eef3fbf321e072bf5156d9875dac7a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "3002266d8113f008b126358246806a357637adf2", "url": "https://github.com/elastic/elasticsearch/commit/3002266d8113f008b126358246806a357637adf2", "message": "Remove accidental ! in favor of == false", "committedDate": "2020-03-16T16:21:21Z", "type": "commit"}, {"oid": "f3d46f9cc76fd1da4712c18f26649bbadb3cd20a", "url": "https://github.com/elastic/elasticsearch/commit/f3d46f9cc76fd1da4712c18f26649bbadb3cd20a", "message": "Rejig TransportGetComponentTemplateAction", "committedDate": "2020-03-16T16:23:51Z", "type": "commit"}, {"oid": "0153f47fef4f0ad21a922f7ef27f85a94e5cddb5", "url": "https://github.com/elastic/elasticsearch/commit/0153f47fef4f0ad21a922f7ef27f85a94e5cddb5", "message": "Check for empty name in PutComponentTemplateRequest", "committedDate": "2020-03-16T16:26:30Z", "type": "commit"}, {"oid": "068ecadcd8791bfcb82dc4bee456165428a11984", "url": "https://github.com/elastic/elasticsearch/commit/068ecadcd8791bfcb82dc4bee456165428a11984", "message": "Move addition into static method and add unit test", "committedDate": "2020-03-16T16:38:54Z", "type": "commit"}, {"oid": "fe2152ac303814fe251bbbf0f3b3e3ac73b9c1e4", "url": "https://github.com/elastic/elasticsearch/commit/fe2152ac303814fe251bbbf0f3b3e3ac73b9c1e4", "message": "Collapse request/response objects into the actions", "committedDate": "2020-03-16T16:49:16Z", "type": "commit"}, {"oid": "d8dc5f449777b84a5c074539fd90ac1208a2ad5a", "url": "https://github.com/elastic/elasticsearch/commit/d8dc5f449777b84a5c074539fd90ac1208a2ad5a", "message": "Checkstyle", "committedDate": "2020-03-16T16:50:36Z", "type": "commit"}, {"oid": "e56e63f08c2833a70e3c5d00d9bb14b17bb2f985", "url": "https://github.com/elastic/elasticsearch/commit/e56e63f08c2833a70e3c5d00d9bb14b17bb2f985", "message": "Merge branch 'master' into itv2-component-template-apis", "committedDate": "2020-03-16T17:48:25Z", "type": "commit"}, {"oid": "f6d11d0e0864c660d63b772834cfd8dab1cbc35b", "url": "https://github.com/elastic/elasticsearch/commit/f6d11d0e0864c660d63b772834cfd8dab1cbc35b", "message": "Merge branch 'master' into itv2-component-template-apis", "committedDate": "2020-03-16T18:30:39Z", "type": "commit"}, {"oid": "6c9b76f41cc7a84197374f5413e4417aa5b14b9f", "url": "https://github.com/elastic/elasticsearch/commit/6c9b76f41cc7a84197374f5413e4417aa5b14b9f", "message": "Change output format to use arrays", "committedDate": "2020-03-17T15:35:59Z", "type": "commit"}, {"oid": "b2f460b8e5d732c9211f2a5b5b78c0bf4a664122", "url": "https://github.com/elastic/elasticsearch/commit/b2f460b8e5d732c9211f2a5b5b78c0bf4a664122", "message": "Merge branch 'master' into itv2-component-template-apis", "committedDate": "2020-03-17T15:55:24Z", "type": "commit"}]}