{"pr_number": 61530, "pr_title": "Do not create two loggers for DeprecationLogger backport(#58435) ", "pr_createdAt": "2020-08-25T14:30:41Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/61530", "timeline": [{"oid": "08d6f63e7542a034acd4025eb3a84038325fa7e5", "url": "https://github.com/elastic/elasticsearch/commit/08d6f63e7542a034acd4025eb3a84038325fa7e5", "message": "Header warning logging refactoring backport(#55941)\n\nSplitting DeprecationLogger into two. HeaderWarningLogger - responsible for adding a response warning headers and ThrottlingLogger - responsible for limiting the duplicated log entries for the same key (previously deprecateAndMaybeLog).\nIntroducing A ThrottlingAndHeaderWarningLogger which is a base for other common logging usages where both response warning header and logging throttling was needed.\n\nrelates #55699\nrelates #52369", "committedDate": "2020-08-25T09:48:44Z", "type": "commit"}, {"oid": "b899785b8a2c2bdbcbbe9d8f87dc8d94203b3383", "url": "https://github.com/elastic/elasticsearch/commit/b899785b8a2c2bdbcbbe9d8f87dc8d94203b3383", "message": "comile and precommit", "committedDate": "2020-08-25T12:12:37Z", "type": "commit"}, {"oid": "2ad8b8d5aa592f5b82c37bb246de81523f4060af", "url": "https://github.com/elastic/elasticsearch/commit/2ad8b8d5aa592f5b82c37bb246de81523f4060af", "message": "logger checks", "committedDate": "2020-08-25T13:13:39Z", "type": "commit"}, {"oid": "5223462ecf23267d56b6668abc68bd751d97fcca", "url": "https://github.com/elastic/elasticsearch/commit/5223462ecf23267d56b6668abc68bd751d97fcca", "message": "rename suppression", "committedDate": "2020-08-25T13:20:46Z", "type": "commit"}, {"oid": "20eaf7a8890ee3bb2c4ef66d0daea55ed89163a1", "url": "https://github.com/elastic/elasticsearch/commit/20eaf7a8890ee3bb2c4ef66d0daea55ed89163a1", "message": "Do not create two loggers for DeprecationLogger backport(#58435)\n\nDeprecationLogger's constructor should not create two loggers. It was\ntaking parent logger instance, changing its name with a .deprecation\nprefix and creating a new logger.\nMost of the time parent logger was not needed. It was causing Log4j to\nunnecessarily cache the unused parent logger instance.", "committedDate": "2020-08-25T14:28:26Z", "type": "commit"}, {"oid": "ec4301a5b4a24770c6dbab0388217bbf33c6fea4", "url": "https://github.com/elastic/elasticsearch/commit/ec4301a5b4a24770c6dbab0388217bbf33c6fea4", "message": "Merge branch '7.x' into bp/7x/deprecation_log_construction", "committedDate": "2020-08-25T14:42:47Z", "type": "commit"}, {"oid": "66ce5257cc5086b89eb5bddf547b636d28fad0bc", "url": "https://github.com/elastic/elasticsearch/commit/66ce5257cc5086b89eb5bddf547b636d28fad0bc", "message": "precommit", "committedDate": "2020-08-25T15:23:27Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA5Mzk2Mw==", "url": "https://github.com/elastic/elasticsearch/pull/61530#discussion_r477093963", "bodyText": "there is a series of classes that possibly incorrectly use DynamicMap logger\nThis PR grew so large and was mostly automatic (find/replace, backport, automated refactoring) that I am reluctant to fix it here too. Maybe I miss something and DynamicMap was actually intended here?\n@pugnascotia WDYT?", "author": "pgomulka", "createdAt": "2020-08-26T07:34:18Z", "path": "modules/ingest-common/src/main/java/org/elasticsearch/ingest/common/ScriptProcessor.java", "diffHunk": "@@ -53,7 +52,7 @@\n public final class ScriptProcessor extends AbstractProcessor {\n \n     private static final DeprecationLogger deprecationLogger =\n-            new DeprecationLogger(LogManager.getLogger(DynamicMap.class));\n+            DeprecationLogger.getLogger(DynamicMap.class);", "originalCommit": "66ce5257cc5086b89eb5bddf547b636d28fad0bc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzE5OTAyNQ==", "url": "https://github.com/elastic/elasticsearch/pull/61530#discussion_r477199025", "bodyText": "Looks like a mistake to me. @stu-elastic what do you think?", "author": "pugnascotia", "createdAt": "2020-08-26T10:28:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA5Mzk2Mw=="}], "type": "inlineReview"}, {"oid": "f4a22e182cda9aa2d9772da3ae92ea8829b50e7c", "url": "https://github.com/elastic/elasticsearch/commit/f4a22e182cda9aa2d9772da3ae92ea8829b50e7c", "message": "remove unnecessary line splits", "committedDate": "2020-08-26T07:52:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzIyMDk3MA==", "url": "https://github.com/elastic/elasticsearch/pull/61530#discussion_r477220970", "bodyText": "Looks like another mistake.", "author": "pugnascotia", "createdAt": "2020-08-26T11:12:57Z", "path": "modules/percolator/src/main/java/org/elasticsearch/percolator/PercolateQueryBuilder.java", "diffHunk": "@@ -100,7 +99,7 @@\n public class PercolateQueryBuilder extends AbstractQueryBuilder<PercolateQueryBuilder> {\n     public static final String NAME = \"percolate\";\n \n-    private static final DeprecationLogger deprecationLogger = new DeprecationLogger(LogManager.getLogger(ParseField.class));\n+    private static final DeprecationLogger deprecationLogger = DeprecationLogger.getLogger(ParseField.class);", "originalCommit": "f4a22e182cda9aa2d9772da3ae92ea8829b50e7c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzIyOTQ2Mg==", "url": "https://github.com/elastic/elasticsearch/pull/61530#discussion_r477229462", "bodyText": "This one looks just plain wrong.", "author": "pugnascotia", "createdAt": "2020-08-26T11:29:15Z", "path": "server/src/main/java/org/elasticsearch/ingest/ConditionalProcessor.java", "diffHunk": "@@ -47,8 +46,7 @@\n \n public class ConditionalProcessor extends AbstractProcessor implements WrappingProcessor {\n \n-    private static final DeprecationLogger deprecationLogger =\n-            new DeprecationLogger(LogManager.getLogger(DynamicMap.class));\n+    private static final DeprecationLogger deprecationLogger = DeprecationLogger.getLogger(DynamicMap.class);", "originalCommit": "f4a22e182cda9aa2d9772da3ae92ea8829b50e7c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzIzMTIwNQ==", "url": "https://github.com/elastic/elasticsearch/pull/61530#discussion_r477231205", "bodyText": "This one is incorrect too.", "author": "pugnascotia", "createdAt": "2020-08-26T11:32:41Z", "path": "server/src/main/java/org/elasticsearch/rest/action/document/RestMultiTermVectorsAction.java", "diffHunk": "@@ -39,8 +38,7 @@\n import static org.elasticsearch.rest.RestRequest.Method.POST;\n \n public class RestMultiTermVectorsAction extends BaseRestHandler {\n-    private static final DeprecationLogger deprecationLogger = new DeprecationLogger(\n-        LogManager.getLogger(RestTermVectorsAction.class));\n+    private static final DeprecationLogger deprecationLogger = DeprecationLogger.getLogger(RestTermVectorsAction.class);", "originalCommit": "f4a22e182cda9aa2d9772da3ae92ea8829b50e7c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzIzMTYxMw==", "url": "https://github.com/elastic/elasticsearch/pull/61530#discussion_r477231613", "bodyText": "This one too.", "author": "pugnascotia", "createdAt": "2020-08-26T11:33:33Z", "path": "server/src/main/java/org/elasticsearch/script/AbstractSortScript.java", "diffHunk": "@@ -36,8 +35,7 @@\n \n abstract class AbstractSortScript implements ScorerAware {\n \n-    private static final DeprecationLogger deprecationLogger =\n-            new DeprecationLogger(LogManager.getLogger(DynamicMap.class));\n+    private static final DeprecationLogger deprecationLogger = DeprecationLogger.getLogger(DynamicMap.class);", "originalCommit": "f4a22e182cda9aa2d9772da3ae92ea8829b50e7c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzIzMjQ2NA==", "url": "https://github.com/elastic/elasticsearch/pull/61530#discussion_r477232464", "bodyText": "And this one.", "author": "pugnascotia", "createdAt": "2020-08-26T11:35:18Z", "path": "server/src/main/java/org/elasticsearch/script/AggregationScript.java", "diffHunk": "@@ -40,8 +39,7 @@\n \n     public static final ScriptContext<Factory> CONTEXT = new ScriptContext<>(\"aggs\", Factory.class);\n \n-    private static final DeprecationLogger deprecationLogger =\n-            new DeprecationLogger(LogManager.getLogger(DynamicMap.class));\n+    private static final DeprecationLogger deprecationLogger = DeprecationLogger.getLogger(DynamicMap.class);", "originalCommit": "f4a22e182cda9aa2d9772da3ae92ea8829b50e7c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzIzMjUyNw==", "url": "https://github.com/elastic/elasticsearch/pull/61530#discussion_r477232527", "bodyText": "And this one.", "author": "pugnascotia", "createdAt": "2020-08-26T11:35:23Z", "path": "server/src/main/java/org/elasticsearch/script/FieldScript.java", "diffHunk": "@@ -39,8 +38,7 @@\n \n     public static final String[] PARAMETERS = {};\n \n-    private static final DeprecationLogger deprecationLogger =\n-            new DeprecationLogger(LogManager.getLogger(DynamicMap.class));\n+    private static final DeprecationLogger deprecationLogger = DeprecationLogger.getLogger(DynamicMap.class);", "originalCommit": "f4a22e182cda9aa2d9772da3ae92ea8829b50e7c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzIzMjU4Nw==", "url": "https://github.com/elastic/elasticsearch/pull/61530#discussion_r477232587", "bodyText": "And this one.", "author": "pugnascotia", "createdAt": "2020-08-26T11:35:31Z", "path": "server/src/main/java/org/elasticsearch/script/ScoreScript.java", "diffHunk": "@@ -65,8 +64,7 @@ public Explanation get(double score, Explanation subQueryExplanation) {\n         }\n     }\n \n-    private static final DeprecationLogger deprecationLogger =\n-            new DeprecationLogger(LogManager.getLogger(DynamicMap.class));\n+    private static final DeprecationLogger deprecationLogger = DeprecationLogger.getLogger(DynamicMap.class);", "originalCommit": "f4a22e182cda9aa2d9772da3ae92ea8829b50e7c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzIzMjcxMQ==", "url": "https://github.com/elastic/elasticsearch/pull/61530#discussion_r477232711", "bodyText": "And this one.", "author": "pugnascotia", "createdAt": "2020-08-26T11:35:44Z", "path": "server/src/main/java/org/elasticsearch/script/ScriptedMetricAggContexts.java", "diffHunk": "@@ -66,8 +65,7 @@ public Object getState() {\n \n     public abstract static class MapScript {\n \n-        private static final DeprecationLogger deprecationLogger =\n-                new DeprecationLogger(LogManager.getLogger(DynamicMap.class));\n+        private static final DeprecationLogger deprecationLogger = DeprecationLogger.getLogger(DynamicMap.class);", "originalCommit": "f4a22e182cda9aa2d9772da3ae92ea8829b50e7c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}