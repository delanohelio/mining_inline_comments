{"pr_number": 63162, "pr_title": "Some template alias settings are not persisted on PUT template ", "pr_createdAt": "2020-10-02T08:41:43Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/63162", "timeline": [{"oid": "e07ebac0ee11d6c2f24f6b44186a4f98a4572e46", "url": "https://github.com/elastic/elasticsearch/commit/e07ebac0ee11d6c2f24f6b44186a4f98a4572e46", "message": "Copy all the template alias settings", "committedDate": "2020-10-02T13:50:45Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTE0NzMyOA==", "url": "https://github.com/elastic/elasticsearch/pull/63162#discussion_r501147328", "bodyText": "I actually don't think we should persist this one. Putting a template in place with is_write_index: true will be confusing because only a single index can be marked as the write index. I think we should instead throw an exception if alias.writeIndex() is set to true here (fail early rather than fail late)", "author": "dakrone", "createdAt": "2020-10-07T16:25:54Z", "path": "server/src/main/java/org/elasticsearch/cluster/metadata/MetadataIndexTemplateService.java", "diffHunk": "@@ -823,8 +823,13 @@ static ClusterState innerPutTemplate(final ClusterState currentState, PutRequest\n         }\n \n         for (Alias alias : request.aliases) {\n-            AliasMetadata aliasMetadata = AliasMetadata.builder(alias.name()).filter(alias.filter())\n-                .indexRouting(alias.indexRouting()).searchRouting(alias.searchRouting()).build();\n+            AliasMetadata aliasMetadata = AliasMetadata.builder(alias.name())\n+                .filter(alias.filter())\n+                .indexRouting(alias.indexRouting())\n+                .searchRouting(alias.searchRouting())\n+                .writeIndex(alias.writeIndex())", "originalCommit": "e07ebac0ee11d6c2f24f6b44186a4f98a4572e46", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTY0NDQzOQ==", "url": "https://github.com/elastic/elasticsearch/pull/63162#discussion_r501644439", "bodyText": "Makes perfect sense. I added a validation against the alias having is_write_index: true and updated the tests", "author": "davidkyle", "createdAt": "2020-10-08T11:24:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTE0NzMyOA=="}], "type": "inlineReview"}, {"oid": "ab4b119747b0534d294360b8ae50d2b9f58aefd5", "url": "https://github.com/elastic/elasticsearch/commit/ab4b119747b0534d294360b8ae50d2b9f58aefd5", "message": "Copy all the template alias settings", "committedDate": "2020-10-08T12:00:29Z", "type": "commit"}, {"oid": "f215de9e18a9ba8e14e42dc2662e4afe81929f9e", "url": "https://github.com/elastic/elasticsearch/commit/f215de9e18a9ba8e14e42dc2662e4afe81929f9e", "message": "Validate template alias cannot have write alias", "committedDate": "2020-10-08T12:00:29Z", "type": "commit"}, {"oid": "f215de9e18a9ba8e14e42dc2662e4afe81929f9e", "url": "https://github.com/elastic/elasticsearch/commit/f215de9e18a9ba8e14e42dc2662e4afe81929f9e", "message": "Validate template alias cannot have write alias", "committedDate": "2020-10-08T12:00:29Z", "type": "forcePushed"}, {"oid": "d9eefa0ffb1d602fd9633154a742e7d4469535fe", "url": "https://github.com/elastic/elasticsearch/commit/d9eefa0ffb1d602fd9633154a742e7d4469535fe", "message": "Revert \"Validate template alias cannot have write alias\"\n\nThis reverts commit f215de9e18a9ba8e14e42dc2662e4afe81929f9e.", "committedDate": "2020-10-12T08:13:51Z", "type": "commit"}]}