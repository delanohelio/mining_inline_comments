{"pr_number": 59088, "pr_title": "Fix deprecated unsave project outputs resolution", "pr_createdAt": "2020-07-06T16:27:26Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/59088", "timeline": [{"oid": "e1f0a70a4959b995672c68f759c54611b3b19f01", "url": "https://github.com/elastic/elasticsearch/commit/e1f0a70a4959b995672c68f759c54611b3b19f01", "message": "Fix deprecated unsave project outputs resolution\n\n- Fixes how libs in distribution are resolved\n- Related to #57920\n- Required minor rework on common repository setup to allow distribution projects\nto resolve thirdparty artifacts", "committedDate": "2020-07-07T15:50:14Z", "type": "forcePushed"}, {"oid": "b960f739ebcafe559f6452c4118173c3f39108ba", "url": "https://github.com/elastic/elasticsearch/commit/b960f739ebcafe559f6452c4118173c3f39108ba", "message": "Cleanup formatting", "committedDate": "2020-07-08T08:28:58Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ0Nzc2OA==", "url": "https://github.com/elastic/elasticsearch/pull/59088#discussion_r452447768", "bodyText": "So the first two of these don't actually declare any dependencies, so it would be functionally equivalent to just use the default configuration, no?\nAs for the launcher project, it does declare dependencies, but it's expected to be packaged here in a common libs dir. @rjernst should the launcher deps be considered \"provided\"? In which case I think it might make sense to flag them compileOnly and again bring in the default configuration.", "author": "mark-vieira", "createdAt": "2020-07-09T19:40:55Z", "path": "distribution/build.gradle", "diffHunk": "@@ -278,6 +279,31 @@ configure(subprojects.findAll { ['archives', 'packages'].contains(it.name) }) {\n   /*****************************************************************************\n    *             Properties to expand when copying packaging files             *\n    *****************************************************************************/\n+  configurations {\n+    ['libs', 'libsPluginCli', 'libsKeystoreCli', 'libsSecurityCli'].each {\n+      create(it) {\n+        canBeConsumed = false\n+        canBeResolved = true\n+        attributes {\n+          attribute(Category.CATEGORY_ATTRIBUTE, objects.named(Category, Category.LIBRARY))\n+          attribute(Usage.USAGE_ATTRIBUTE, objects.named(Usage, Usage.JAVA_RUNTIME))\n+          attribute(Bundling.BUNDLING_ATTRIBUTE, objects.named(Bundling, Bundling.EXTERNAL))\n+        }\n+      }\n+    }\n+  }\n+\n+  dependencies {\n+    libs project(':server')\n+    libs project(path: ':libs:elasticsearch-plugin-classloader', configuration: 'archives')\n+    libs project(path: ':distribution:tools:java-version-checker', configuration: 'archives')\n+    libs project(path: ':distribution:tools:launchers', configuration: 'archives')", "originalCommit": "b960f739ebcafe559f6452c4118173c3f39108ba", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjU0MDg1NA==", "url": "https://github.com/elastic/elasticsearch/pull/59088#discussion_r452540854", "bodyText": "I don't know about compileOnly, but maybe I'm misunderstanding what that means in this context. The launchers are needed at runtime. They are a bunch of the classes called by our cli scripts prior actually running the main cli class. IIRC they are not depended on by any cli classes at compile time.", "author": "rjernst", "createdAt": "2020-07-09T23:19:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ0Nzc2OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjcxMDg2Mw==", "url": "https://github.com/elastic/elasticsearch/pull/59088#discussion_r452710863", "bodyText": "+1 on using the default. I made the change to compileOnly. that sounds reasonable and is also how things are done already for the keystone-cli compile dependencies.", "author": "breskeby", "createdAt": "2020-07-10T08:49:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ0Nzc2OA=="}], "type": "inlineReview"}, {"oid": "1686e05248f2956701b6c82395fd30bc12080e24", "url": "https://github.com/elastic/elasticsearch/commit/1686e05248f2956701b6c82395fd30bc12080e24", "message": "Fix deprecated unsave project outputs resolution\n\n- Fixes how libs in distribution are resolved\n- Related to #57920\n- Required minor rework on common repository setup to allow distribution projects\nto resolve thirdparty artifacts", "committedDate": "2020-07-10T11:46:15Z", "type": "commit"}, {"oid": "af8715d40c478e8ad9ad9ed389c7337d63d2b09d", "url": "https://github.com/elastic/elasticsearch/commit/af8715d40c478e8ad9ad9ed389c7337d63d2b09d", "message": "Cleanup formatting", "committedDate": "2020-07-10T11:46:16Z", "type": "commit"}, {"oid": "85821ce5e132cf39211c5863073b4942132fa3b8", "url": "https://github.com/elastic/elasticsearch/commit/85821ce5e132cf39211c5863073b4942132fa3b8", "message": "Use efault configurations when resolving tools", "committedDate": "2020-07-10T11:46:16Z", "type": "commit"}, {"oid": "71bf7fc94e16da239f2ab0c0016d177e7d311ba1", "url": "https://github.com/elastic/elasticsearch/commit/71bf7fc94e16da239f2ab0c0016d177e7d311ba1", "message": "Revert \"Use efault configurations when resolving tools\"\n\nThis reverts commit acf1021d79229dec2f3ae7e4f0c28a547e8f0574.", "committedDate": "2020-07-10T11:46:16Z", "type": "forcePushed"}, {"oid": "85821ce5e132cf39211c5863073b4942132fa3b8", "url": "https://github.com/elastic/elasticsearch/commit/85821ce5e132cf39211c5863073b4942132fa3b8", "message": "Use efault configurations when resolving tools", "committedDate": "2020-07-10T11:46:16Z", "type": "forcePushed"}]}