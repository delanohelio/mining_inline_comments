{"pr_number": 51355, "pr_title": "Add HLRC docs for AuthN and TLS", "pr_createdAt": "2020-01-23T15:45:00Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/51355", "timeline": [{"oid": "9841d316d0e59c0bd20bee977a9391530ece043e", "url": "https://github.com/elastic/elasticsearch/commit/9841d316d0e59c0bd20bee977a9391530ece043e", "message": "Add HLRC docs for AuthN and TLS\n\nThis commit adds examples in our documentation for\n\n- An HLRC instance authenticating to an elasticsearch cluster using\nan elasticsearch token service access token or an API key\n- An HLRC instance connecting to an elasticsearch cluster that is\nsetup for TLS on the HTTP layer when the CA certificate of the\ncluster is available either as a PEM file or a keystore\n- An HLRC instance connecting to an elasticsearch cluster that\nrequires client authentication where the client key and certificate\nare available in a keystore\n\nResolves:  #44202", "committedDate": "2020-01-23T15:19:14Z", "type": "commit"}, {"oid": "0c060524a5c2f0181876e8f981d70fe3998f25b8", "url": "https://github.com/elastic/elasticsearch/commit/0c060524a5c2f0181876e8f981d70fe3998f25b8", "message": "add paths in the examples", "committedDate": "2020-01-23T15:41:33Z", "type": "commit"}, {"oid": "38fdea2f644488a71772a519f376f15112ed1c8e", "url": "https://github.com/elastic/elasticsearch/commit/38fdea2f644488a71772a519f376f15112ed1c8e", "message": "fix snippet length", "committedDate": "2020-01-23T16:03:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDQ3MjY5NQ==", "url": "https://github.com/elastic/elasticsearch/pull/51355#discussion_r370472695", "bodyText": "This doesn't look like a real API key to me (or am I confused?)\n$ printf \"%s\" 'VnVhQ2ZHY0JDZGJrUW0tZTVhT3gdWkybHAdzw' | base64 -D\nVuaCfGcBCdbkQm-e5aOxZL\ufffds%\n\nI think maybe we should we show the base64 process as well?\nString apiKeyId = \"uqlEyn8B_gQ_jlvwDIvM\"\nString apiKeySecret = \"HxHWk2m4RN-V_qg9cDpuX\"\nString apiKeyAuth = Base64.getEncoder().encodeToString((apiKeyId + \":\" + apiKeySecret).getBytes());", "author": "tvernum", "createdAt": "2020-01-24T04:49:09Z", "path": "client/rest/src/test/java/org/elasticsearch/client/documentation/RestClientDocumentation.java", "diffHunk": "@@ -400,5 +402,81 @@ public HttpAsyncClientBuilder customizeHttpClient(\n                 });\n             //end::rest-client-config-encrypted-communication\n         }\n+        {\n+            //tag::rest-client-config-trust-ca-pem\n+            Path caCertificatePath = Paths.get(\"/path/to/ca.crt\");\n+            CertificateFactory factory =\n+                CertificateFactory.getInstance(\"X.509\");\n+            Certificate trustedCa;\n+            try (InputStream is = Files.newInputStream(caCertificatePath)) {\n+                trustedCa = factory.generateCertificate(is);\n+            }\n+            KeyStore trustStore = KeyStore.getInstance(\"pkcs12\");\n+            trustStore.load(null, null);\n+            trustStore.setCertificateEntry(\"ca\", trustedCa);\n+            SSLContextBuilder sslContextBuilder = SSLContexts.custom()\n+                .loadTrustMaterial(trustStore, null);\n+            final SSLContext sslContext = sslContextBuilder.build();\n+            RestClient.builder(\n+                new HttpHost(\"localhost\", 9200, \"https\"))\n+                .setHttpClientConfigCallback(new HttpClientConfigCallback() {\n+                    @Override\n+                    public HttpAsyncClientBuilder customizeHttpClient(\n+                        HttpAsyncClientBuilder httpClientBuilder) {\n+                        return httpClientBuilder.setSSLContext(sslContext);\n+                    }\n+                });\n+            //end::rest-client-config-trust-ca-pem\n+        }\n+        {\n+            String trustStorePass = \"\";\n+            String keyStorePass = \"\";\n+            //tag::rest-client-config-mutual-tls-authentication\n+            Path trustStorePath = Paths.get(\"/path/to/your/truststore.p12\");\n+            Path keyStorePath = Paths.get(\"/path/to/your/keystore.p12\");\n+            KeyStore trustStore = KeyStore.getInstance(\"pkcs12\");\n+            KeyStore keyStore = KeyStore.getInstance(\"pkcs12\");\n+            try (InputStream is = Files.newInputStream(trustStorePath)) {\n+                trustStore.load(is, trustStorePass.toCharArray());\n+            }\n+            try (InputStream is = Files.newInputStream(keyStorePath)) {\n+                keyStore.load(is, keyStorePass.toCharArray());\n+            }\n+            SSLContextBuilder sslBuilder = SSLContexts.custom()\n+                .loadTrustMaterial(trustStore, null)\n+                .loadKeyMaterial(keyStore, keyStorePass.toCharArray());\n+            final SSLContext sslContext = sslBuilder.build();\n+            RestClientBuilder builder = RestClient.builder(\n+                new HttpHost(\"localhost\", 9200, \"https\"))\n+                .setHttpClientConfigCallback(new HttpClientConfigCallback() {\n+                    @Override\n+                    public HttpAsyncClientBuilder customizeHttpClient(\n+                        HttpAsyncClientBuilder httpClientBuilder) {\n+                        return httpClientBuilder.setSSLContext(sslContext);\n+                    }\n+                });\n+            //end::rest-client-config-mutual-tls-authentication\n+        }\n+        {\n+            //tag::rest-client-auth-bearer-token\n+            RestClientBuilder builder = RestClient.builder(\n+                new HttpHost(\"localhost\", 9200, \"http\"));\n+            Header[] defaultHeaders =\n+                new Header[]{new BasicHeader(\"Authorization\",\n+                    \"Bearer u6iuAxZ0RG1Kcm5jVFI4eU4tZU9aVFEwT2F3\")};\n+            builder.setDefaultHeaders(defaultHeaders);\n+            //end::rest-client-auth-bearer-token\n+        }\n+        {\n+            //tag::rest-client-auth-api-key\n+            RestClientBuilder builder = RestClient.builder(\n+                new HttpHost(\"localhost\", 9200, \"http\"));\n+            Header[] defaultHeaders =\n+                new Header[]{new BasicHeader(\"Authorization\",\n+                    \"ApiKey VnVhQ2ZHY0JDZGJrUW0tZTVhT3gdWkybHAdzw==\")};", "originalCommit": "38fdea2f644488a71772a519f376f15112ed1c8e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDQ4NDg3NA==", "url": "https://github.com/elastic/elasticsearch/pull/51355#discussion_r370484874", "bodyText": "This doesn't look like a real API key to me (or am I confused?)\n\nIt's not. An API Key doesn't fit in the 72 line limit and since there was no way to add an API key that would work in a request to an arbitrary cluster either way ... I cheated.\nYou're right, since the create API key only returns the ID and secret now, it makes sense to show how to base64 encode it too, which also thankfully solves the above issue too.", "author": "jkakavas", "createdAt": "2020-01-24T06:04:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDQ3MjY5NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDQ3NzM4MQ==", "url": "https://github.com/elastic/elasticsearch/pull/51355#discussion_r370477381", "bodyText": "Can we split this on two lines to that it is easier to read in the docs?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            openssl pkcs12 -export -in client.crt -inkey private_key.pem -name \"client\" -out client.p12\n          \n          \n            \n            openssl pkcs12 -export -in client.crt -inkey private_key.pem \\\n          \n          \n            \n                -name \"client\" -out client.p12", "author": "tvernum", "createdAt": "2020-01-24T05:20:17Z", "path": "docs/java-rest/low-level/configuration.asciidoc", "diffHunk": "@@ -64,21 +64,74 @@ include-tagged::{doc-tests}/RestClientDocumentation.java[rest-client-config-disa\n --------------------------------------------------\n <1> Disable preemptive authentication\n \n+=== Other authentication methods\n+\n+==== Elasticsearch Token Service tokens\n+\n+Configuring the client to authenticate with an elasticsearch access token can be accomplished by setting the relevant HTTP request header.\n+If the client makes requests on behalf of a single user only, you can set the necessary `Authorization` header as a default header as shown\n+in the following example\n+\n+[\"source\",\"java\",subs=\"attributes,callouts,macros\"]\n+--------------------------------------------------\n+include-tagged::{doc-tests}/RestClientDocumentation.java[rest-client-auth-bearer-token]\n+--------------------------------------------------\n+\n+==== Elasticsearch API keys\n+\n+Configuring the client to authenticate with an elasticsearch API Key can be also accomplished by setting the relevant HTTP request header.\n+If the client makes requests on behalf of a single user only, you can set the necessary `Authorization` header as a default header as shown\n+in the following example\n+\n+[\"source\",\"java\",subs=\"attributes,callouts,macros\"]\n+--------------------------------------------------\n+include-tagged::{doc-tests}/RestClientDocumentation.java[rest-client-auth-api-key]\n+--------------------------------------------------\n+\n === Encrypted communication\n \n-Encrypted communication can also be configured through the\n+Encrypted communication using TLS can also be configured through the\n `HttpClientConfigCallback`. The\n https://hc.apache.org/httpcomponents-asyncclient-dev/httpasyncclient/apidocs/org/apache/http/impl/nio/client/HttpAsyncClientBuilder.html[`org.apache.http.impl.nio.client.HttpAsyncClientBuilder`]\n  received as an argument exposes multiple methods to configure encrypted\n  communication: `setSSLContext`, `setSSLSessionStrategy` and\n  `setConnectionManager`, in order of precedence from the least important.\n- The following is an example:\n+\n+When accessing an elasticsearch cluster that is setup for TLS on the HTTP layer, the client needs to trust the certificate that\n+elasticsearch is using.\n+ The following is an example of setting up the client to trust the CA that has signed the certificate that elasticsearch is using, when\n+ that CA certificate is available in a PKCS#12 keystore:\n \n [\"source\",\"java\",subs=\"attributes,callouts,macros\"]\n --------------------------------------------------\n include-tagged::{doc-tests}/RestClientDocumentation.java[rest-client-config-encrypted-communication]\n --------------------------------------------------\n \n+The following is an example of setting up the client to trust the CA that has signed the certificate that elasticsearch is using, when\n+that CA certificate is available as a PEM encoded file.\n+\n+[\"source\",\"java\",subs=\"attributes,callouts,macros\"]\n+--------------------------------------------------\n+include-tagged::{doc-tests}/RestClientDocumentation.java[rest-client-config-trust-ca-pem]\n+--------------------------------------------------\n+\n+When elasticsearch is configured to require client TLS authentication, i.e. when a PKI realm is configured, the client needs to provide\n+a client certificate during the TLS handshake in order to authenticate. The following is an example of setting up the client for TLS\n+authentication with a certificate and a private key that are stored in a PKCS#12 keystore.\n+\n+[\"source\",\"java\",subs=\"attributes,callouts,macros\"]\n+--------------------------------------------------\n+include-tagged::{doc-tests}/RestClientDocumentation.java[rest-client-config-mutual-tls-authentication]\n+--------------------------------------------------\n+\n+if the client certificate and key are not available in a keystore but as PEM encoded files, there is no possibility to use them\n+directly to build an SSLContext, without relying on external libraries to parse the PEM key into a PrivateKey instance. Alternatively, you\n+can use external tools to build a keystore from your PEM files, as shown in the following example:\n+\n+```\n+openssl pkcs12 -export -in client.crt -inkey private_key.pem -name \"client\" -out client.p12", "originalCommit": "38fdea2f644488a71772a519f376f15112ed1c8e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "31efd746869de7e11c5b96396bf2970b5f51b309", "url": "https://github.com/elastic/elasticsearch/commit/31efd746869de7e11c5b96396bf2970b5f51b309", "message": "Address feedback", "committedDate": "2020-01-24T06:11:36Z", "type": "commit"}, {"oid": "0e57234cdc9c04f5a179848699573ac9a8ff86c3", "url": "https://github.com/elastic/elasticsearch/commit/0e57234cdc9c04f5a179848699573ac9a8ff86c3", "message": "that's what you get for not running precommit locally", "committedDate": "2020-01-24T06:23:35Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDQ5MDY5Ng==", "url": "https://github.com/elastic/elasticsearch/pull/51355#discussion_r370490696", "bodyText": ":) Sorry, my fault :)", "author": "tvernum", "createdAt": "2020-01-24T06:36:54Z", "path": "client/rest/src/test/java/org/elasticsearch/client/documentation/RestClientDocumentation.java", "diffHunk": "@@ -474,7 +475,8 @@ public HttpAsyncClientBuilder customizeHttpClient(\n             String apiKeySecret = \"HxHWk2m4RN-V_qg9cDpuX\";\n             String apiKeyAuth =\n                 Base64.getEncoder().encodeToString(\n-                    (apiKeyId + \":\" + apiKeySecret).getBytes());\n+                    (apiKeyId + \":\" + apiKeySecret)\n+                        .getBytes(StandardCharsets.UTF_8));", "originalCommit": "0e57234cdc9c04f5a179848699573ac9a8ff86c3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f1da1c982941266060aac7774a4b5041ca3ffe67", "url": "https://github.com/elastic/elasticsearch/commit/f1da1c982941266060aac7774a4b5041ca3ffe67", "message": "add authentication scheme in the Authorization header for API keys", "committedDate": "2020-01-24T08:52:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDczNDUzNQ==", "url": "https://github.com/elastic/elasticsearch/pull/51355#discussion_r370734535", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Configuring the client to authenticate with an elasticsearch access token can be accomplished by setting the relevant HTTP request header.\n          \n          \n            \n            If you want the client to authenticate with an Elasticsearch access token, set the relevant HTTP request header.", "author": "lcawl", "createdAt": "2020-01-24T16:49:55Z", "path": "docs/java-rest/low-level/configuration.asciidoc", "diffHunk": "@@ -64,21 +64,75 @@ include-tagged::{doc-tests}/RestClientDocumentation.java[rest-client-config-disa\n --------------------------------------------------\n <1> Disable preemptive authentication\n \n+=== Other authentication methods\n+\n+==== Elasticsearch Token Service tokens\n+\n+Configuring the client to authenticate with an elasticsearch access token can be accomplished by setting the relevant HTTP request header.", "originalCommit": "f1da1c982941266060aac7774a4b5041ca3ffe67", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDczNTAxMw==", "url": "https://github.com/elastic/elasticsearch/pull/51355#discussion_r370735013", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Configuring the client to authenticate with an elasticsearch API Key can be also accomplished by setting the relevant HTTP request header.\n          \n          \n            \n            If you want the client to authenticate with an Elasticsearch API key, set the relevant HTTP request header.", "author": "lcawl", "createdAt": "2020-01-24T16:50:51Z", "path": "docs/java-rest/low-level/configuration.asciidoc", "diffHunk": "@@ -64,21 +64,75 @@ include-tagged::{doc-tests}/RestClientDocumentation.java[rest-client-config-disa\n --------------------------------------------------\n <1> Disable preemptive authentication\n \n+=== Other authentication methods\n+\n+==== Elasticsearch Token Service tokens\n+\n+Configuring the client to authenticate with an elasticsearch access token can be accomplished by setting the relevant HTTP request header.\n+If the client makes requests on behalf of a single user only, you can set the necessary `Authorization` header as a default header as shown\n+in the following example\n+\n+[\"source\",\"java\",subs=\"attributes,callouts,macros\"]\n+--------------------------------------------------\n+include-tagged::{doc-tests}/RestClientDocumentation.java[rest-client-auth-bearer-token]\n+--------------------------------------------------\n+\n+==== Elasticsearch API keys\n+\n+Configuring the client to authenticate with an elasticsearch API Key can be also accomplished by setting the relevant HTTP request header.", "originalCommit": "f1da1c982941266060aac7774a4b5041ca3ffe67", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDczNTI2OQ==", "url": "https://github.com/elastic/elasticsearch/pull/51355#discussion_r370735269", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            When accessing an elasticsearch cluster that is setup for TLS on the HTTP layer, the client needs to trust the certificate that\n          \n          \n            \n            When accessing an Elasticsearch cluster that is setup for TLS on the HTTP layer, the client needs to trust the certificate that", "author": "lcawl", "createdAt": "2020-01-24T16:51:23Z", "path": "docs/java-rest/low-level/configuration.asciidoc", "diffHunk": "@@ -64,21 +64,75 @@ include-tagged::{doc-tests}/RestClientDocumentation.java[rest-client-config-disa\n --------------------------------------------------\n <1> Disable preemptive authentication\n \n+=== Other authentication methods\n+\n+==== Elasticsearch Token Service tokens\n+\n+Configuring the client to authenticate with an elasticsearch access token can be accomplished by setting the relevant HTTP request header.\n+If the client makes requests on behalf of a single user only, you can set the necessary `Authorization` header as a default header as shown\n+in the following example\n+\n+[\"source\",\"java\",subs=\"attributes,callouts,macros\"]\n+--------------------------------------------------\n+include-tagged::{doc-tests}/RestClientDocumentation.java[rest-client-auth-bearer-token]\n+--------------------------------------------------\n+\n+==== Elasticsearch API keys\n+\n+Configuring the client to authenticate with an elasticsearch API Key can be also accomplished by setting the relevant HTTP request header.\n+If the client makes requests on behalf of a single user only, you can set the necessary `Authorization` header as a default header as shown\n+in the following example\n+\n+[\"source\",\"java\",subs=\"attributes,callouts,macros\"]\n+--------------------------------------------------\n+include-tagged::{doc-tests}/RestClientDocumentation.java[rest-client-auth-api-key]\n+--------------------------------------------------\n+\n === Encrypted communication\n \n-Encrypted communication can also be configured through the\n+Encrypted communication using TLS can also be configured through the\n `HttpClientConfigCallback`. The\n https://hc.apache.org/httpcomponents-asyncclient-dev/httpasyncclient/apidocs/org/apache/http/impl/nio/client/HttpAsyncClientBuilder.html[`org.apache.http.impl.nio.client.HttpAsyncClientBuilder`]\n  received as an argument exposes multiple methods to configure encrypted\n  communication: `setSSLContext`, `setSSLSessionStrategy` and\n  `setConnectionManager`, in order of precedence from the least important.\n- The following is an example:\n+\n+When accessing an elasticsearch cluster that is setup for TLS on the HTTP layer, the client needs to trust the certificate that", "originalCommit": "f1da1c982941266060aac7774a4b5041ca3ffe67", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDczNTQwOA==", "url": "https://github.com/elastic/elasticsearch/pull/51355#discussion_r370735408", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            elasticsearch is using.\n          \n          \n            \n            Elasticsearch is using.", "author": "lcawl", "createdAt": "2020-01-24T16:51:39Z", "path": "docs/java-rest/low-level/configuration.asciidoc", "diffHunk": "@@ -64,21 +64,75 @@ include-tagged::{doc-tests}/RestClientDocumentation.java[rest-client-config-disa\n --------------------------------------------------\n <1> Disable preemptive authentication\n \n+=== Other authentication methods\n+\n+==== Elasticsearch Token Service tokens\n+\n+Configuring the client to authenticate with an elasticsearch access token can be accomplished by setting the relevant HTTP request header.\n+If the client makes requests on behalf of a single user only, you can set the necessary `Authorization` header as a default header as shown\n+in the following example\n+\n+[\"source\",\"java\",subs=\"attributes,callouts,macros\"]\n+--------------------------------------------------\n+include-tagged::{doc-tests}/RestClientDocumentation.java[rest-client-auth-bearer-token]\n+--------------------------------------------------\n+\n+==== Elasticsearch API keys\n+\n+Configuring the client to authenticate with an elasticsearch API Key can be also accomplished by setting the relevant HTTP request header.\n+If the client makes requests on behalf of a single user only, you can set the necessary `Authorization` header as a default header as shown\n+in the following example\n+\n+[\"source\",\"java\",subs=\"attributes,callouts,macros\"]\n+--------------------------------------------------\n+include-tagged::{doc-tests}/RestClientDocumentation.java[rest-client-auth-api-key]\n+--------------------------------------------------\n+\n === Encrypted communication\n \n-Encrypted communication can also be configured through the\n+Encrypted communication using TLS can also be configured through the\n `HttpClientConfigCallback`. The\n https://hc.apache.org/httpcomponents-asyncclient-dev/httpasyncclient/apidocs/org/apache/http/impl/nio/client/HttpAsyncClientBuilder.html[`org.apache.http.impl.nio.client.HttpAsyncClientBuilder`]\n  received as an argument exposes multiple methods to configure encrypted\n  communication: `setSSLContext`, `setSSLSessionStrategy` and\n  `setConnectionManager`, in order of precedence from the least important.\n- The following is an example:\n+\n+When accessing an elasticsearch cluster that is setup for TLS on the HTTP layer, the client needs to trust the certificate that\n+elasticsearch is using.", "originalCommit": "f1da1c982941266060aac7774a4b5041ca3ffe67", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDczNTU3Mw==", "url": "https://github.com/elastic/elasticsearch/pull/51355#discussion_r370735573", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             The following is an example of setting up the client to trust the CA that has signed the certificate that elasticsearch is using, when\n          \n          \n            \n             The following is an example of setting up the client to trust the CA that has signed the certificate that Elasticsearch is using, when", "author": "lcawl", "createdAt": "2020-01-24T16:52:00Z", "path": "docs/java-rest/low-level/configuration.asciidoc", "diffHunk": "@@ -64,21 +64,75 @@ include-tagged::{doc-tests}/RestClientDocumentation.java[rest-client-config-disa\n --------------------------------------------------\n <1> Disable preemptive authentication\n \n+=== Other authentication methods\n+\n+==== Elasticsearch Token Service tokens\n+\n+Configuring the client to authenticate with an elasticsearch access token can be accomplished by setting the relevant HTTP request header.\n+If the client makes requests on behalf of a single user only, you can set the necessary `Authorization` header as a default header as shown\n+in the following example\n+\n+[\"source\",\"java\",subs=\"attributes,callouts,macros\"]\n+--------------------------------------------------\n+include-tagged::{doc-tests}/RestClientDocumentation.java[rest-client-auth-bearer-token]\n+--------------------------------------------------\n+\n+==== Elasticsearch API keys\n+\n+Configuring the client to authenticate with an elasticsearch API Key can be also accomplished by setting the relevant HTTP request header.\n+If the client makes requests on behalf of a single user only, you can set the necessary `Authorization` header as a default header as shown\n+in the following example\n+\n+[\"source\",\"java\",subs=\"attributes,callouts,macros\"]\n+--------------------------------------------------\n+include-tagged::{doc-tests}/RestClientDocumentation.java[rest-client-auth-api-key]\n+--------------------------------------------------\n+\n === Encrypted communication\n \n-Encrypted communication can also be configured through the\n+Encrypted communication using TLS can also be configured through the\n `HttpClientConfigCallback`. The\n https://hc.apache.org/httpcomponents-asyncclient-dev/httpasyncclient/apidocs/org/apache/http/impl/nio/client/HttpAsyncClientBuilder.html[`org.apache.http.impl.nio.client.HttpAsyncClientBuilder`]\n  received as an argument exposes multiple methods to configure encrypted\n  communication: `setSSLContext`, `setSSLSessionStrategy` and\n  `setConnectionManager`, in order of precedence from the least important.\n- The following is an example:\n+\n+When accessing an elasticsearch cluster that is setup for TLS on the HTTP layer, the client needs to trust the certificate that\n+elasticsearch is using.\n+ The following is an example of setting up the client to trust the CA that has signed the certificate that elasticsearch is using, when", "originalCommit": "f1da1c982941266060aac7774a4b5041ca3ffe67", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDczNTcyOQ==", "url": "https://github.com/elastic/elasticsearch/pull/51355#discussion_r370735729", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            The following is an example of setting up the client to trust the CA that has signed the certificate that elasticsearch is using, when\n          \n          \n            \n            The following is an example of setting up the client to trust the CA that has signed the certificate that Elasticsearch is using, when", "author": "lcawl", "createdAt": "2020-01-24T16:52:18Z", "path": "docs/java-rest/low-level/configuration.asciidoc", "diffHunk": "@@ -64,21 +64,75 @@ include-tagged::{doc-tests}/RestClientDocumentation.java[rest-client-config-disa\n --------------------------------------------------\n <1> Disable preemptive authentication\n \n+=== Other authentication methods\n+\n+==== Elasticsearch Token Service tokens\n+\n+Configuring the client to authenticate with an elasticsearch access token can be accomplished by setting the relevant HTTP request header.\n+If the client makes requests on behalf of a single user only, you can set the necessary `Authorization` header as a default header as shown\n+in the following example\n+\n+[\"source\",\"java\",subs=\"attributes,callouts,macros\"]\n+--------------------------------------------------\n+include-tagged::{doc-tests}/RestClientDocumentation.java[rest-client-auth-bearer-token]\n+--------------------------------------------------\n+\n+==== Elasticsearch API keys\n+\n+Configuring the client to authenticate with an elasticsearch API Key can be also accomplished by setting the relevant HTTP request header.\n+If the client makes requests on behalf of a single user only, you can set the necessary `Authorization` header as a default header as shown\n+in the following example\n+\n+[\"source\",\"java\",subs=\"attributes,callouts,macros\"]\n+--------------------------------------------------\n+include-tagged::{doc-tests}/RestClientDocumentation.java[rest-client-auth-api-key]\n+--------------------------------------------------\n+\n === Encrypted communication\n \n-Encrypted communication can also be configured through the\n+Encrypted communication using TLS can also be configured through the\n `HttpClientConfigCallback`. The\n https://hc.apache.org/httpcomponents-asyncclient-dev/httpasyncclient/apidocs/org/apache/http/impl/nio/client/HttpAsyncClientBuilder.html[`org.apache.http.impl.nio.client.HttpAsyncClientBuilder`]\n  received as an argument exposes multiple methods to configure encrypted\n  communication: `setSSLContext`, `setSSLSessionStrategy` and\n  `setConnectionManager`, in order of precedence from the least important.\n- The following is an example:\n+\n+When accessing an elasticsearch cluster that is setup for TLS on the HTTP layer, the client needs to trust the certificate that\n+elasticsearch is using.\n+ The following is an example of setting up the client to trust the CA that has signed the certificate that elasticsearch is using, when\n+ that CA certificate is available in a PKCS#12 keystore:\n \n [\"source\",\"java\",subs=\"attributes,callouts,macros\"]\n --------------------------------------------------\n include-tagged::{doc-tests}/RestClientDocumentation.java[rest-client-config-encrypted-communication]\n --------------------------------------------------\n \n+The following is an example of setting up the client to trust the CA that has signed the certificate that elasticsearch is using, when", "originalCommit": "f1da1c982941266060aac7774a4b5041ca3ffe67", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDczNjAwOA==", "url": "https://github.com/elastic/elasticsearch/pull/51355#discussion_r370736008", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            When elasticsearch is configured to require client TLS authentication, i.e. when a PKI realm is configured, the client needs to provide\n          \n          \n            \n            When Elasticsearch is configured to require client TLS authentication, i.e. when a PKI realm is configured, the client needs to provide", "author": "lcawl", "createdAt": "2020-01-24T16:52:51Z", "path": "docs/java-rest/low-level/configuration.asciidoc", "diffHunk": "@@ -64,21 +64,75 @@ include-tagged::{doc-tests}/RestClientDocumentation.java[rest-client-config-disa\n --------------------------------------------------\n <1> Disable preemptive authentication\n \n+=== Other authentication methods\n+\n+==== Elasticsearch Token Service tokens\n+\n+Configuring the client to authenticate with an elasticsearch access token can be accomplished by setting the relevant HTTP request header.\n+If the client makes requests on behalf of a single user only, you can set the necessary `Authorization` header as a default header as shown\n+in the following example\n+\n+[\"source\",\"java\",subs=\"attributes,callouts,macros\"]\n+--------------------------------------------------\n+include-tagged::{doc-tests}/RestClientDocumentation.java[rest-client-auth-bearer-token]\n+--------------------------------------------------\n+\n+==== Elasticsearch API keys\n+\n+Configuring the client to authenticate with an elasticsearch API Key can be also accomplished by setting the relevant HTTP request header.\n+If the client makes requests on behalf of a single user only, you can set the necessary `Authorization` header as a default header as shown\n+in the following example\n+\n+[\"source\",\"java\",subs=\"attributes,callouts,macros\"]\n+--------------------------------------------------\n+include-tagged::{doc-tests}/RestClientDocumentation.java[rest-client-auth-api-key]\n+--------------------------------------------------\n+\n === Encrypted communication\n \n-Encrypted communication can also be configured through the\n+Encrypted communication using TLS can also be configured through the\n `HttpClientConfigCallback`. The\n https://hc.apache.org/httpcomponents-asyncclient-dev/httpasyncclient/apidocs/org/apache/http/impl/nio/client/HttpAsyncClientBuilder.html[`org.apache.http.impl.nio.client.HttpAsyncClientBuilder`]\n  received as an argument exposes multiple methods to configure encrypted\n  communication: `setSSLContext`, `setSSLSessionStrategy` and\n  `setConnectionManager`, in order of precedence from the least important.\n- The following is an example:\n+\n+When accessing an elasticsearch cluster that is setup for TLS on the HTTP layer, the client needs to trust the certificate that\n+elasticsearch is using.\n+ The following is an example of setting up the client to trust the CA that has signed the certificate that elasticsearch is using, when\n+ that CA certificate is available in a PKCS#12 keystore:\n \n [\"source\",\"java\",subs=\"attributes,callouts,macros\"]\n --------------------------------------------------\n include-tagged::{doc-tests}/RestClientDocumentation.java[rest-client-config-encrypted-communication]\n --------------------------------------------------\n \n+The following is an example of setting up the client to trust the CA that has signed the certificate that elasticsearch is using, when\n+that CA certificate is available as a PEM encoded file.\n+\n+[\"source\",\"java\",subs=\"attributes,callouts,macros\"]\n+--------------------------------------------------\n+include-tagged::{doc-tests}/RestClientDocumentation.java[rest-client-config-trust-ca-pem]\n+--------------------------------------------------\n+\n+When elasticsearch is configured to require client TLS authentication, i.e. when a PKI realm is configured, the client needs to provide", "originalCommit": "f1da1c982941266060aac7774a4b5041ca3ffe67", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDczNjg4OA==", "url": "https://github.com/elastic/elasticsearch/pull/51355#discussion_r370736888", "bodyText": "When elasticsearch is configured to require client TLS authentication, i.e. when a PKI realm is configured ...\n\nThe use of \"i.e.\" here implies that this is the only situation where ES requires TLS authentication, which seems unlikely to me.  Should it be \"e.g.\" or \"for example\" instead?", "author": "lcawl", "createdAt": "2020-01-24T16:54:33Z", "path": "docs/java-rest/low-level/configuration.asciidoc", "diffHunk": "@@ -64,21 +64,75 @@ include-tagged::{doc-tests}/RestClientDocumentation.java[rest-client-config-disa\n --------------------------------------------------\n <1> Disable preemptive authentication\n \n+=== Other authentication methods\n+\n+==== Elasticsearch Token Service tokens\n+\n+Configuring the client to authenticate with an elasticsearch access token can be accomplished by setting the relevant HTTP request header.\n+If the client makes requests on behalf of a single user only, you can set the necessary `Authorization` header as a default header as shown\n+in the following example\n+\n+[\"source\",\"java\",subs=\"attributes,callouts,macros\"]\n+--------------------------------------------------\n+include-tagged::{doc-tests}/RestClientDocumentation.java[rest-client-auth-bearer-token]\n+--------------------------------------------------\n+\n+==== Elasticsearch API keys\n+\n+Configuring the client to authenticate with an elasticsearch API Key can be also accomplished by setting the relevant HTTP request header.\n+If the client makes requests on behalf of a single user only, you can set the necessary `Authorization` header as a default header as shown\n+in the following example\n+\n+[\"source\",\"java\",subs=\"attributes,callouts,macros\"]\n+--------------------------------------------------\n+include-tagged::{doc-tests}/RestClientDocumentation.java[rest-client-auth-api-key]\n+--------------------------------------------------\n+\n === Encrypted communication\n \n-Encrypted communication can also be configured through the\n+Encrypted communication using TLS can also be configured through the\n `HttpClientConfigCallback`. The\n https://hc.apache.org/httpcomponents-asyncclient-dev/httpasyncclient/apidocs/org/apache/http/impl/nio/client/HttpAsyncClientBuilder.html[`org.apache.http.impl.nio.client.HttpAsyncClientBuilder`]\n  received as an argument exposes multiple methods to configure encrypted\n  communication: `setSSLContext`, `setSSLSessionStrategy` and\n  `setConnectionManager`, in order of precedence from the least important.\n- The following is an example:\n+\n+When accessing an elasticsearch cluster that is setup for TLS on the HTTP layer, the client needs to trust the certificate that\n+elasticsearch is using.\n+ The following is an example of setting up the client to trust the CA that has signed the certificate that elasticsearch is using, when\n+ that CA certificate is available in a PKCS#12 keystore:\n \n [\"source\",\"java\",subs=\"attributes,callouts,macros\"]\n --------------------------------------------------\n include-tagged::{doc-tests}/RestClientDocumentation.java[rest-client-config-encrypted-communication]\n --------------------------------------------------\n \n+The following is an example of setting up the client to trust the CA that has signed the certificate that elasticsearch is using, when\n+that CA certificate is available as a PEM encoded file.\n+\n+[\"source\",\"java\",subs=\"attributes,callouts,macros\"]\n+--------------------------------------------------\n+include-tagged::{doc-tests}/RestClientDocumentation.java[rest-client-config-trust-ca-pem]\n+--------------------------------------------------\n+\n+When elasticsearch is configured to require client TLS authentication, i.e. when a PKI realm is configured, the client needs to provide", "originalCommit": "f1da1c982941266060aac7774a4b5041ca3ffe67", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDczOTU1Ng==", "url": "https://github.com/elastic/elasticsearch/pull/51355#discussion_r370739556", "bodyText": "A PKI realm is actually the most common case to require TLS Client authentication on the HTTP layer. Otherwise the client authenticates with some other means ( credentials, tokens, api keys ) and not with a client certificate. I", "author": "jkakavas", "createdAt": "2020-01-24T17:00:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDczNjg4OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDc0MDU3NA==", "url": "https://github.com/elastic/elasticsearch/pull/51355#discussion_r370740574", "bodyText": "Unless it's the only case, I'd still recommend \"e.g.\" instead of \"i.e.\".", "author": "lcawl", "createdAt": "2020-01-24T17:02:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDczNjg4OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDc0NDY3Nw==", "url": "https://github.com/elastic/elasticsearch/pull/51355#discussion_r370744677", "bodyText": "It is the only documented case , but a user might elect to enable it and just disregard the authentication information ( by not specifying a PKI realm ) I guess, so I'll apply the suggestion.\nBy the way, thanks for that , I did not know that distinction and was using e.g and i.e. interchangeably for years \u2764\ufe0f", "author": "jkakavas", "createdAt": "2020-01-24T17:11:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDczNjg4OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDc2MDY5MQ==", "url": "https://github.com/elastic/elasticsearch/pull/51355#discussion_r370760691", "bodyText": "Words are fun i.e. crazy-making :)", "author": "lcawl", "createdAt": "2020-01-24T17:48:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDczNjg4OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDczNzU0OA==", "url": "https://github.com/elastic/elasticsearch/pull/51355#discussion_r370737548", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            in the following example\n          \n          \n            \n            in the following example:", "author": "lcawl", "createdAt": "2020-01-24T16:55:56Z", "path": "docs/java-rest/low-level/configuration.asciidoc", "diffHunk": "@@ -64,21 +64,75 @@ include-tagged::{doc-tests}/RestClientDocumentation.java[rest-client-config-disa\n --------------------------------------------------\n <1> Disable preemptive authentication\n \n+=== Other authentication methods\n+\n+==== Elasticsearch Token Service tokens\n+\n+Configuring the client to authenticate with an elasticsearch access token can be accomplished by setting the relevant HTTP request header.\n+If the client makes requests on behalf of a single user only, you can set the necessary `Authorization` header as a default header as shown\n+in the following example", "originalCommit": "f1da1c982941266060aac7774a4b5041ca3ffe67", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDczNzg0NA==", "url": "https://github.com/elastic/elasticsearch/pull/51355#discussion_r370737844", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            in the following example\n          \n          \n            \n            in the following example:", "author": "lcawl", "createdAt": "2020-01-24T16:56:35Z", "path": "docs/java-rest/low-level/configuration.asciidoc", "diffHunk": "@@ -64,21 +64,75 @@ include-tagged::{doc-tests}/RestClientDocumentation.java[rest-client-config-disa\n --------------------------------------------------\n <1> Disable preemptive authentication\n \n+=== Other authentication methods\n+\n+==== Elasticsearch Token Service tokens\n+\n+Configuring the client to authenticate with an elasticsearch access token can be accomplished by setting the relevant HTTP request header.\n+If the client makes requests on behalf of a single user only, you can set the necessary `Authorization` header as a default header as shown\n+in the following example\n+\n+[\"source\",\"java\",subs=\"attributes,callouts,macros\"]\n+--------------------------------------------------\n+include-tagged::{doc-tests}/RestClientDocumentation.java[rest-client-auth-bearer-token]\n+--------------------------------------------------\n+\n+==== Elasticsearch API keys\n+\n+Configuring the client to authenticate with an elasticsearch API Key can be also accomplished by setting the relevant HTTP request header.\n+If the client makes requests on behalf of a single user only, you can set the necessary `Authorization` header as a default header as shown\n+in the following example", "originalCommit": "f1da1c982941266060aac7774a4b5041ca3ffe67", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDczODkyNQ==", "url": "https://github.com/elastic/elasticsearch/pull/51355#discussion_r370738925", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            if the client certificate and key are not available in a keystore but as PEM encoded files, there is no possibility to use them\n          \n          \n            \n            If the client certificate and key are not available in a keystore but rather as PEM encoded files, you cannot use them", "author": "lcawl", "createdAt": "2020-01-24T16:58:44Z", "path": "docs/java-rest/low-level/configuration.asciidoc", "diffHunk": "@@ -64,21 +64,75 @@ include-tagged::{doc-tests}/RestClientDocumentation.java[rest-client-config-disa\n --------------------------------------------------\n <1> Disable preemptive authentication\n \n+=== Other authentication methods\n+\n+==== Elasticsearch Token Service tokens\n+\n+Configuring the client to authenticate with an elasticsearch access token can be accomplished by setting the relevant HTTP request header.\n+If the client makes requests on behalf of a single user only, you can set the necessary `Authorization` header as a default header as shown\n+in the following example\n+\n+[\"source\",\"java\",subs=\"attributes,callouts,macros\"]\n+--------------------------------------------------\n+include-tagged::{doc-tests}/RestClientDocumentation.java[rest-client-auth-bearer-token]\n+--------------------------------------------------\n+\n+==== Elasticsearch API keys\n+\n+Configuring the client to authenticate with an elasticsearch API Key can be also accomplished by setting the relevant HTTP request header.\n+If the client makes requests on behalf of a single user only, you can set the necessary `Authorization` header as a default header as shown\n+in the following example\n+\n+[\"source\",\"java\",subs=\"attributes,callouts,macros\"]\n+--------------------------------------------------\n+include-tagged::{doc-tests}/RestClientDocumentation.java[rest-client-auth-api-key]\n+--------------------------------------------------\n+\n === Encrypted communication\n \n-Encrypted communication can also be configured through the\n+Encrypted communication using TLS can also be configured through the\n `HttpClientConfigCallback`. The\n https://hc.apache.org/httpcomponents-asyncclient-dev/httpasyncclient/apidocs/org/apache/http/impl/nio/client/HttpAsyncClientBuilder.html[`org.apache.http.impl.nio.client.HttpAsyncClientBuilder`]\n  received as an argument exposes multiple methods to configure encrypted\n  communication: `setSSLContext`, `setSSLSessionStrategy` and\n  `setConnectionManager`, in order of precedence from the least important.\n- The following is an example:\n+\n+When accessing an elasticsearch cluster that is setup for TLS on the HTTP layer, the client needs to trust the certificate that\n+elasticsearch is using.\n+ The following is an example of setting up the client to trust the CA that has signed the certificate that elasticsearch is using, when\n+ that CA certificate is available in a PKCS#12 keystore:\n \n [\"source\",\"java\",subs=\"attributes,callouts,macros\"]\n --------------------------------------------------\n include-tagged::{doc-tests}/RestClientDocumentation.java[rest-client-config-encrypted-communication]\n --------------------------------------------------\n \n+The following is an example of setting up the client to trust the CA that has signed the certificate that elasticsearch is using, when\n+that CA certificate is available as a PEM encoded file.\n+\n+[\"source\",\"java\",subs=\"attributes,callouts,macros\"]\n+--------------------------------------------------\n+include-tagged::{doc-tests}/RestClientDocumentation.java[rest-client-config-trust-ca-pem]\n+--------------------------------------------------\n+\n+When elasticsearch is configured to require client TLS authentication, i.e. when a PKI realm is configured, the client needs to provide\n+a client certificate during the TLS handshake in order to authenticate. The following is an example of setting up the client for TLS\n+authentication with a certificate and a private key that are stored in a PKCS#12 keystore.\n+\n+[\"source\",\"java\",subs=\"attributes,callouts,macros\"]\n+--------------------------------------------------\n+include-tagged::{doc-tests}/RestClientDocumentation.java[rest-client-config-mutual-tls-authentication]\n+--------------------------------------------------\n+\n+if the client certificate and key are not available in a keystore but as PEM encoded files, there is no possibility to use them", "originalCommit": "f1da1c982941266060aac7774a4b5041ca3ffe67", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDczOTY1NA==", "url": "https://github.com/elastic/elasticsearch/pull/51355#discussion_r370739654", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            directly to build an SSLContext, without relying on external libraries to parse the PEM key into a PrivateKey instance. Alternatively, you\n          \n          \n            \n            directly to build an SSLContext. You must rely on external libraries to parse the PEM key into a PrivateKey instance. Alternatively, you", "author": "lcawl", "createdAt": "2020-01-24T17:00:20Z", "path": "docs/java-rest/low-level/configuration.asciidoc", "diffHunk": "@@ -64,21 +64,75 @@ include-tagged::{doc-tests}/RestClientDocumentation.java[rest-client-config-disa\n --------------------------------------------------\n <1> Disable preemptive authentication\n \n+=== Other authentication methods\n+\n+==== Elasticsearch Token Service tokens\n+\n+Configuring the client to authenticate with an elasticsearch access token can be accomplished by setting the relevant HTTP request header.\n+If the client makes requests on behalf of a single user only, you can set the necessary `Authorization` header as a default header as shown\n+in the following example\n+\n+[\"source\",\"java\",subs=\"attributes,callouts,macros\"]\n+--------------------------------------------------\n+include-tagged::{doc-tests}/RestClientDocumentation.java[rest-client-auth-bearer-token]\n+--------------------------------------------------\n+\n+==== Elasticsearch API keys\n+\n+Configuring the client to authenticate with an elasticsearch API Key can be also accomplished by setting the relevant HTTP request header.\n+If the client makes requests on behalf of a single user only, you can set the necessary `Authorization` header as a default header as shown\n+in the following example\n+\n+[\"source\",\"java\",subs=\"attributes,callouts,macros\"]\n+--------------------------------------------------\n+include-tagged::{doc-tests}/RestClientDocumentation.java[rest-client-auth-api-key]\n+--------------------------------------------------\n+\n === Encrypted communication\n \n-Encrypted communication can also be configured through the\n+Encrypted communication using TLS can also be configured through the\n `HttpClientConfigCallback`. The\n https://hc.apache.org/httpcomponents-asyncclient-dev/httpasyncclient/apidocs/org/apache/http/impl/nio/client/HttpAsyncClientBuilder.html[`org.apache.http.impl.nio.client.HttpAsyncClientBuilder`]\n  received as an argument exposes multiple methods to configure encrypted\n  communication: `setSSLContext`, `setSSLSessionStrategy` and\n  `setConnectionManager`, in order of precedence from the least important.\n- The following is an example:\n+\n+When accessing an elasticsearch cluster that is setup for TLS on the HTTP layer, the client needs to trust the certificate that\n+elasticsearch is using.\n+ The following is an example of setting up the client to trust the CA that has signed the certificate that elasticsearch is using, when\n+ that CA certificate is available in a PKCS#12 keystore:\n \n [\"source\",\"java\",subs=\"attributes,callouts,macros\"]\n --------------------------------------------------\n include-tagged::{doc-tests}/RestClientDocumentation.java[rest-client-config-encrypted-communication]\n --------------------------------------------------\n \n+The following is an example of setting up the client to trust the CA that has signed the certificate that elasticsearch is using, when\n+that CA certificate is available as a PEM encoded file.\n+\n+[\"source\",\"java\",subs=\"attributes,callouts,macros\"]\n+--------------------------------------------------\n+include-tagged::{doc-tests}/RestClientDocumentation.java[rest-client-config-trust-ca-pem]\n+--------------------------------------------------\n+\n+When elasticsearch is configured to require client TLS authentication, i.e. when a PKI realm is configured, the client needs to provide\n+a client certificate during the TLS handshake in order to authenticate. The following is an example of setting up the client for TLS\n+authentication with a certificate and a private key that are stored in a PKCS#12 keystore.\n+\n+[\"source\",\"java\",subs=\"attributes,callouts,macros\"]\n+--------------------------------------------------\n+include-tagged::{doc-tests}/RestClientDocumentation.java[rest-client-config-mutual-tls-authentication]\n+--------------------------------------------------\n+\n+if the client certificate and key are not available in a keystore but as PEM encoded files, there is no possibility to use them\n+directly to build an SSLContext, without relying on external libraries to parse the PEM key into a PrivateKey instance. Alternatively, you", "originalCommit": "f1da1c982941266060aac7774a4b5041ca3ffe67", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDc4NDc4Ng==", "url": "https://github.com/elastic/elasticsearch/pull/51355#discussion_r370784786", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            When elasticsearch is configured to require client TLS authentication, i.e. when a PKI realm is configured, the client needs to provide\n          \n          \n            \n            When elasticsearch is configured to require client TLS authentication, e.g. when a PKI realm is configured, the client needs to provide", "author": "jkakavas", "createdAt": "2020-01-24T18:45:29Z", "path": "docs/java-rest/low-level/configuration.asciidoc", "diffHunk": "@@ -64,21 +64,75 @@ include-tagged::{doc-tests}/RestClientDocumentation.java[rest-client-config-disa\n --------------------------------------------------\n <1> Disable preemptive authentication\n \n+=== Other authentication methods\n+\n+==== Elasticsearch Token Service tokens\n+\n+Configuring the client to authenticate with an elasticsearch access token can be accomplished by setting the relevant HTTP request header.\n+If the client makes requests on behalf of a single user only, you can set the necessary `Authorization` header as a default header as shown\n+in the following example\n+\n+[\"source\",\"java\",subs=\"attributes,callouts,macros\"]\n+--------------------------------------------------\n+include-tagged::{doc-tests}/RestClientDocumentation.java[rest-client-auth-bearer-token]\n+--------------------------------------------------\n+\n+==== Elasticsearch API keys\n+\n+Configuring the client to authenticate with an elasticsearch API Key can be also accomplished by setting the relevant HTTP request header.\n+If the client makes requests on behalf of a single user only, you can set the necessary `Authorization` header as a default header as shown\n+in the following example\n+\n+[\"source\",\"java\",subs=\"attributes,callouts,macros\"]\n+--------------------------------------------------\n+include-tagged::{doc-tests}/RestClientDocumentation.java[rest-client-auth-api-key]\n+--------------------------------------------------\n+\n === Encrypted communication\n \n-Encrypted communication can also be configured through the\n+Encrypted communication using TLS can also be configured through the\n `HttpClientConfigCallback`. The\n https://hc.apache.org/httpcomponents-asyncclient-dev/httpasyncclient/apidocs/org/apache/http/impl/nio/client/HttpAsyncClientBuilder.html[`org.apache.http.impl.nio.client.HttpAsyncClientBuilder`]\n  received as an argument exposes multiple methods to configure encrypted\n  communication: `setSSLContext`, `setSSLSessionStrategy` and\n  `setConnectionManager`, in order of precedence from the least important.\n- The following is an example:\n+\n+When accessing an elasticsearch cluster that is setup for TLS on the HTTP layer, the client needs to trust the certificate that\n+elasticsearch is using.\n+ The following is an example of setting up the client to trust the CA that has signed the certificate that elasticsearch is using, when\n+ that CA certificate is available in a PKCS#12 keystore:\n \n [\"source\",\"java\",subs=\"attributes,callouts,macros\"]\n --------------------------------------------------\n include-tagged::{doc-tests}/RestClientDocumentation.java[rest-client-config-encrypted-communication]\n --------------------------------------------------\n \n+The following is an example of setting up the client to trust the CA that has signed the certificate that elasticsearch is using, when\n+that CA certificate is available as a PEM encoded file.\n+\n+[\"source\",\"java\",subs=\"attributes,callouts,macros\"]\n+--------------------------------------------------\n+include-tagged::{doc-tests}/RestClientDocumentation.java[rest-client-config-trust-ca-pem]\n+--------------------------------------------------\n+\n+When elasticsearch is configured to require client TLS authentication, i.e. when a PKI realm is configured, the client needs to provide", "originalCommit": "f1da1c982941266060aac7774a4b5041ca3ffe67", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "8f19a284cb4bd6594e657e47164696d5ca78adec", "url": "https://github.com/elastic/elasticsearch/commit/8f19a284cb4bd6594e657e47164696d5ca78adec", "message": "Apply suggestions from code review\n\nCo-Authored-By: Lisa Cawley <lcawley@elastic.co>", "committedDate": "2020-01-24T18:46:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTUzNTI3OQ==", "url": "https://github.com/elastic/elasticsearch/pull/51355#discussion_r371535279", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            When Elasticsearch is configured to require client TLS authentication, i.e. when a PKI realm is configured, the client needs to provide\n          \n          \n            \n            When Elasticsearch is configured to require client TLS authentication, for example when a PKI realm is configured, the client needs to provide", "author": "lcawl", "createdAt": "2020-01-27T23:14:00Z", "path": "docs/java-rest/low-level/configuration.asciidoc", "diffHunk": "@@ -64,21 +64,75 @@ include-tagged::{doc-tests}/RestClientDocumentation.java[rest-client-config-disa\n --------------------------------------------------\n <1> Disable preemptive authentication\n \n+=== Other authentication methods\n+\n+==== Elasticsearch Token Service tokens\n+\n+If you want the client to authenticate with an Elasticsearch access token, set the relevant HTTP request header.\n+If the client makes requests on behalf of a single user only, you can set the necessary `Authorization` header as a default header as shown\n+in the following example:\n+\n+[\"source\",\"java\",subs=\"attributes,callouts,macros\"]\n+--------------------------------------------------\n+include-tagged::{doc-tests}/RestClientDocumentation.java[rest-client-auth-bearer-token]\n+--------------------------------------------------\n+\n+==== Elasticsearch API keys\n+\n+If you want the client to authenticate with an Elasticsearch API key, set the relevant HTTP request header.\n+If the client makes requests on behalf of a single user only, you can set the necessary `Authorization` header as a default header as shown\n+in the following example:\n+\n+[\"source\",\"java\",subs=\"attributes,callouts,macros\"]\n+--------------------------------------------------\n+include-tagged::{doc-tests}/RestClientDocumentation.java[rest-client-auth-api-key]\n+--------------------------------------------------\n+\n === Encrypted communication\n \n-Encrypted communication can also be configured through the\n+Encrypted communication using TLS can also be configured through the\n `HttpClientConfigCallback`. The\n https://hc.apache.org/httpcomponents-asyncclient-dev/httpasyncclient/apidocs/org/apache/http/impl/nio/client/HttpAsyncClientBuilder.html[`org.apache.http.impl.nio.client.HttpAsyncClientBuilder`]\n  received as an argument exposes multiple methods to configure encrypted\n  communication: `setSSLContext`, `setSSLSessionStrategy` and\n  `setConnectionManager`, in order of precedence from the least important.\n- The following is an example:\n+\n+When accessing an Elasticsearch cluster that is setup for TLS on the HTTP layer, the client needs to trust the certificate that\n+Elasticsearch is using.\n+ The following is an example of setting up the client to trust the CA that has signed the certificate that Elasticsearch is using, when\n+ that CA certificate is available in a PKCS#12 keystore:\n \n [\"source\",\"java\",subs=\"attributes,callouts,macros\"]\n --------------------------------------------------\n include-tagged::{doc-tests}/RestClientDocumentation.java[rest-client-config-encrypted-communication]\n --------------------------------------------------\n \n+The following is an example of setting up the client to trust the CA that has signed the certificate that Elasticsearch is using, when\n+that CA certificate is available as a PEM encoded file.\n+\n+[\"source\",\"java\",subs=\"attributes,callouts,macros\"]\n+--------------------------------------------------\n+include-tagged::{doc-tests}/RestClientDocumentation.java[rest-client-config-trust-ca-pem]\n+--------------------------------------------------\n+\n+When Elasticsearch is configured to require client TLS authentication, i.e. when a PKI realm is configured, the client needs to provide", "originalCommit": "8f19a284cb4bd6594e657e47164696d5ca78adec", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "95207c8a668cc5c0039bf41b59d6e99dd263939f", "url": "https://github.com/elastic/elasticsearch/commit/95207c8a668cc5c0039bf41b59d6e99dd263939f", "message": "Update docs/java-rest/low-level/configuration.asciidoc\n\nCo-Authored-By: Lisa Cawley <lcawley@elastic.co>", "committedDate": "2020-01-28T05:31:12Z", "type": "commit"}]}