{"pr_number": 63327, "pr_title": "Handle error conditions when simulating ingest pipelines with verbosity enabled", "pr_createdAt": "2020-10-06T13:57:37Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/63327", "timeline": [{"oid": "40d554c36b67345588fd29bcaab60c56dee162fd", "url": "https://github.com/elastic/elasticsearch/commit/40d554c36b67345588fd29bcaab60c56dee162fd", "message": "Change conditional to handle all exception scenarios", "committedDate": "2020-10-06T12:59:56Z", "type": "commit"}, {"oid": "2b7c651e8dc02dd0e06004e2ad9996309ccea9a2", "url": "https://github.com/elastic/elasticsearch/commit/2b7c651e8dc02dd0e06004e2ad9996309ccea9a2", "message": "add unit test", "committedDate": "2020-10-06T13:57:49Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDMwNjcwOA==", "url": "https://github.com/elastic/elasticsearch/pull/63327#discussion_r500306708", "bodyText": "This combination of if statements allowed cases of ElasticsearchException with causes other than those of type IllegalStateException to fall through with invoking the failure handler. I believe the original intention was to catch cyclical pipelines so I believe the correct behavior is to check for both conditions at once and allow any other exception scenarios to fall through to the \"now that we know there are no cycles\" condition.", "author": "danhermann", "createdAt": "2020-10-06T14:01:23Z", "path": "server/src/main/java/org/elasticsearch/ingest/TrackingResultProcessor.java", "diffHunk": "@@ -74,19 +74,15 @@ public void execute(IngestDocument ingestDocument, BiConsumer<IngestDocument, Ex\n             }\n             ingestDocumentCopy.executePipeline(pipelineToCall, (result, e) -> {\n                 // do nothing, let the tracking processors throw the exception while recording the path up to the failure\n-                if (e instanceof ElasticsearchException) {\n-                    ElasticsearchException elasticsearchException = (ElasticsearchException) e;\n-                    //else do nothing, let the tracking processors throw the exception while recording the path up to the failure\n-                    if (elasticsearchException.getCause() instanceof IllegalStateException) {", "originalCommit": "2b7c651e8dc02dd0e06004e2ad9996309ccea9a2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDMyNzE0Mg==", "url": "https://github.com/elastic/elasticsearch/pull/63327#discussion_r500327142", "bodyText": "Additionally, it seems brittle to check for pipeline cycles based only on the class of the inner exception when there's nothing that would prevent other processors from throwing exceptions of type IllegalStateException that have nothing to do with pipeline cycles.", "author": "danhermann", "createdAt": "2020-10-06T14:22:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDMwNjcwOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ0ODY2OA==", "url": "https://github.com/elastic/elasticsearch/pull/63327#discussion_r500448668", "bodyText": "This was briefly discussed a while back #34155 (comment) ..IIRC it had to do with amount of overhead to introduce a custom exception for an edge case.", "author": "jakelandis", "createdAt": "2020-10-06T16:49:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDMwNjcwOA=="}], "type": "inlineReview"}, {"oid": "2285091040df53dbd9786b912bf1f04e0db7a8ca", "url": "https://github.com/elastic/elasticsearch/commit/2285091040df53dbd9786b912bf1f04e0db7a8ca", "message": "Merge branch 'master' into 63199_simulate_pipeline_error", "committedDate": "2020-10-06T14:54:56Z", "type": "commit"}, {"oid": "b4ec09ca90228f80aba15cb72dcad10d7e6cde91", "url": "https://github.com/elastic/elasticsearch/commit/b4ec09ca90228f80aba15cb72dcad10d7e6cde91", "message": "check exception message in addition to class for pipeline cycle errors", "committedDate": "2020-10-06T20:14:05Z", "type": "commit"}, {"oid": "0b7127207de25699a047be77c553b7b17d80a477", "url": "https://github.com/elastic/elasticsearch/commit/0b7127207de25699a047be77c553b7b17d80a477", "message": "add REST test", "committedDate": "2020-10-06T20:29:48Z", "type": "commit"}, {"oid": "8337ef76d3d4bd43616e3b7a562f5160642037f1", "url": "https://github.com/elastic/elasticsearch/commit/8337ef76d3d4bd43616e3b7a562f5160642037f1", "message": "fix REST test", "committedDate": "2020-10-06T21:02:29Z", "type": "commit"}, {"oid": "a35dfd49f6bc1650981ce0232ce2a5581f0e61e3", "url": "https://github.com/elastic/elasticsearch/commit/a35dfd49f6bc1650981ce0232ce2a5581f0e61e3", "message": "Merge branch 'master' into 63199_simulate_pipeline_error", "committedDate": "2020-10-06T21:20:00Z", "type": "commit"}]}