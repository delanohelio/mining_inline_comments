{"pr_number": 61332, "pr_title": "Add note on the danger of closed indices", "pr_createdAt": "2020-08-19T14:23:02Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/61332", "timeline": [{"oid": "7796e7e9aa9536659b1bb5ca94eb3dd89652724c", "url": "https://github.com/elastic/elasticsearch/commit/7796e7e9aa9536659b1bb5ca94eb3dd89652724c", "message": "Add note on the danger of closed indices\n\nPrior to #33888 it is dangerous to keep closed indices in your cluster\nlong-term: Elasticsearch does not maintain their shard copies so they\ntend to get lost as the cluster migrates to new nodes. This risk isn't\ndocumented today. This commit addresses that gap.", "committedDate": "2020-08-19T14:17:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzA4MTM3Nw==", "url": "https://github.com/elastic/elasticsearch/pull/61332#discussion_r473081377", "bodyText": "Extra word.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            are lost when a node leaves your cluster. This means you will should expect to\n          \n          \n            \n            are lost when a node leaves your cluster. This means you should expect to", "author": "jrodewig", "createdAt": "2020-08-19T14:39:22Z", "path": "docs/reference/indices/open-close.asciidoc", "diffHunk": "@@ -7,6 +7,15 @@ for maintaining its metadata), and is blocked for read/write operations.\n A closed index can be opened which will then go through the normal\n recovery process.\n \n+IMPORTANT: {es} will not rebuild any copies of shards of closed indices that\n+are lost when a node leaves your cluster. This means you will should expect to", "originalCommit": "7796e7e9aa9536659b1bb5ca94eb3dd89652724c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzA4MTgzOQ==", "url": "https://github.com/elastic/elasticsearch/pull/61332#discussion_r473081839", "bodyText": "Because there's a risk of data loss, I'd use the WARNING admon here.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            IMPORTANT: {es} will not rebuild any copies of shards of closed indices that\n          \n          \n            \n            WARNING: {es} will not rebuild any copies of shards of closed indices that", "author": "jrodewig", "createdAt": "2020-08-19T14:40:02Z", "path": "docs/reference/indices/open-close.asciidoc", "diffHunk": "@@ -7,6 +7,15 @@ for maintaining its metadata), and is blocked for read/write operations.\n A closed index can be opened which will then go through the normal\n recovery process.\n \n+IMPORTANT: {es} will not rebuild any copies of shards of closed indices that", "originalCommit": "7796e7e9aa9536659b1bb5ca94eb3dd89652724c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzA5MDY5OA==", "url": "https://github.com/elastic/elasticsearch/pull/61332#discussion_r473090698", "bodyText": "This warning is fine as-is, but I'd reorder it a bit to lead with the recommendation\nand follow up with the why.\nIf you accept this suggestion, you can ignore the other ones.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            IMPORTANT: {es} will not rebuild any copies of shards of closed indices that\n          \n          \n            \n            are lost when a node leaves your cluster. This means you will should expect to\n          \n          \n            \n            lose the data held in closed indices if you replace the nodes in your cluster\n          \n          \n            \n            over time. Because of the risk of data loss it is best to avoid keeping closed\n          \n          \n            \n            indices in your cluster for a long period of time. You should instead prefer to\n          \n          \n            \n            <<frozen-indices,freeze>> indices that you want to keep available for\n          \n          \n            \n            occasional searches with low overhead, and store any other indices outside the\n          \n          \n            \n            cluster using a <<modules-snapshots,snapshot>>.\n          \n          \n            \n            [WARNING]\n          \n          \n            \n            ====\n          \n          \n            \n            To reduce the risk of data loss, avoid keeping closed indices for long periods.\n          \n          \n            \n            When a node leaves your cluster, {es} does not rebuild shard replicas for closed\n          \n          \n            \n            indices. If you regularly replace nodes in your cluster, this will eventually\n          \n          \n            \n            result in data loss for the cluster's closed indices.\n          \n          \n            \n            \n          \n          \n            \n            If you want to reduce the overhead of an index while keeping it available for\n          \n          \n            \n            occasional searches, <<frozen-indices,freeze>> the index instead. If you want\n          \n          \n            \n            to store an index outside of the cluster, use a <<modules-snapshots,snapshot>>.\n          \n          \n            \n            ====", "author": "jrodewig", "createdAt": "2020-08-19T14:52:06Z", "path": "docs/reference/indices/open-close.asciidoc", "diffHunk": "@@ -7,6 +7,15 @@ for maintaining its metadata), and is blocked for read/write operations.\n A closed index can be opened which will then go through the normal\n recovery process.\n \n+IMPORTANT: {es} will not rebuild any copies of shards of closed indices that\n+are lost when a node leaves your cluster. This means you will should expect to\n+lose the data held in closed indices if you replace the nodes in your cluster\n+over time. Because of the risk of data loss it is best to avoid keeping closed\n+indices in your cluster for a long period of time. You should instead prefer to\n+<<frozen-indices,freeze>> indices that you want to keep available for\n+occasional searches with low overhead, and store any other indices outside the\n+cluster using a <<modules-snapshots,snapshot>>.", "originalCommit": "7796e7e9aa9536659b1bb5ca94eb3dd89652724c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "3345a56cba376593668152d566ffc4d838f12fc7", "url": "https://github.com/elastic/elasticsearch/commit/3345a56cba376593668152d566ffc4d838f12fc7", "message": "Update docs/reference/indices/open-close.asciidoc\n\nCo-authored-by: James Rodewig <40268737+jrodewig@users.noreply.github.com>", "committedDate": "2020-08-19T14:58:02Z", "type": "commit"}, {"oid": "23e488800405dea96e571eae0eb22be248d108bb", "url": "https://github.com/elastic/elasticsearch/commit/23e488800405dea96e571eae0eb22be248d108bb", "message": "Minor tweaks", "committedDate": "2020-08-19T15:02:20Z", "type": "commit"}, {"oid": "3ebceaf8cfd02989d1cbfa2196446d52a0618cff", "url": "https://github.com/elastic/elasticsearch/commit/3ebceaf8cfd02989d1cbfa2196446d52a0618cff", "message": "Mention Cloud", "committedDate": "2020-08-19T17:19:51Z", "type": "commit"}, {"oid": "888990a94d2d8c67054dffe3232bdc9c48178e4a", "url": "https://github.com/elastic/elasticsearch/commit/888990a94d2d8c67054dffe3232bdc9c48178e4a", "message": "Cloud is now on Azure too", "committedDate": "2020-08-19T17:20:13Z", "type": "commit"}, {"oid": "00c06986633fd67fe16e971e2a5cc37ea6fcf84d", "url": "https://github.com/elastic/elasticsearch/commit/00c06986633fd67fe16e971e2a5cc37ea6fcf84d", "message": "Strengthen exception message", "committedDate": "2020-08-19T17:20:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzIwMDU1Mw==", "url": "https://github.com/elastic/elasticsearch/pull/61332#discussion_r473200553", "bodyText": "Unrelated except that I was looking for other references to Cloud: reformat & mention Azure.", "author": "DaveCTurner", "createdAt": "2020-08-19T17:22:26Z", "path": "docs/reference/setup/install.asciidoc", "diffHunk": "@@ -3,10 +3,11 @@\n \n [float]\n === Hosted Elasticsearch\n-Elasticsearch can be run on your own hardware or using our hosted\n-Elasticsearch Service on https://www.elastic.co/cloud[Elastic Cloud], which is\n-available on AWS and GCP. You can\n-https://www.elastic.co/cloud/elasticsearch-service/signup[try out the hosted service] for free.\n+Elasticsearch can be run on your own hardware or using our hosted Elasticsearch\n+Service on https://www.elastic.co/cloud[Elastic Cloud], which is available on\n+AWS, GCP and Azure. You can", "originalCommit": "00c06986633fd67fe16e971e2a5cc37ea6fcf84d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzIwNDMwMA==", "url": "https://github.com/elastic/elasticsearch/pull/61332#discussion_r473204300", "bodyText": "Reorders this para a little.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            problems in managed environments. Closing indices can be disabled via the\n          \n          \n            \n            cluster settings API by setting `cluster.indices.close.enable` to `false`. The\n          \n          \n            \n            default is `true`.\n          \n          \n            \n            problems in managed environments. Closed indices are enabled by default. You can\n          \n          \n            \n            disable closed indices by setting `cluster.indices.close.enable` to `false`\n          \n          \n            \n            using the <<cluster-update-settings,cluster settings API>>.", "author": "jrodewig", "createdAt": "2020-08-19T17:29:14Z", "path": "docs/reference/indices/open-close.asciidoc", "diffHunk": "@@ -30,8 +48,10 @@ Identifying indices via wildcards or `_all` can be disabled by setting the\n `action.destructive_requires_name` flag in the config file to `true`.\n This setting can also be changed via the cluster update settings api.\n \n-Closed indices consume a significant amount of disk-space which can cause problems in managed environments. Closing indices can be disabled via the cluster settings\n-API by setting `cluster.indices.close.enable` to `false`. The default is `true`.\n+Closed indices consume a significant amount of disk-space which can cause\n+problems in managed environments. Closing indices can be disabled via the\n+cluster settings API by setting `cluster.indices.close.enable` to `false`. The\n+default is `true`.", "originalCommit": "00c06986633fd67fe16e971e2a5cc37ea6fcf84d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzIwNzIwNw==", "url": "https://github.com/elastic/elasticsearch/pull/61332#discussion_r473207207", "bodyText": "Just adds attributes.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Elasticsearch can be run on your own hardware or using our hosted Elasticsearch\n          \n          \n            \n            Service on https://www.elastic.co/cloud[Elastic Cloud], which is available on\n          \n          \n            \n            AWS, GCP and Azure. You can\n          \n          \n            \n            https://www.elastic.co/cloud/elasticsearch-service/signup[try out the hosted\n          \n          \n            \n            service] for free.\n          \n          \n            \n            {es} can be run on your own hardware or using our hosted {ess} on\n          \n          \n            \n            https://www.elastic.co/cloud[{ecloud}], which is available on AWS, GCP and\n          \n          \n            \n            Azure. You can {ess-trial}[try out the hosted service] for free.", "author": "jrodewig", "createdAt": "2020-08-19T17:34:14Z", "path": "docs/reference/setup/install.asciidoc", "diffHunk": "@@ -3,10 +3,11 @@\n \n [float]\n === Hosted Elasticsearch\n-Elasticsearch can be run on your own hardware or using our hosted\n-Elasticsearch Service on https://www.elastic.co/cloud[Elastic Cloud], which is\n-available on AWS and GCP. You can\n-https://www.elastic.co/cloud/elasticsearch-service/signup[try out the hosted service] for free.\n+Elasticsearch can be run on your own hardware or using our hosted Elasticsearch\n+Service on https://www.elastic.co/cloud[Elastic Cloud], which is available on\n+AWS, GCP and Azure. You can\n+https://www.elastic.co/cloud/elasticsearch-service/signup[try out the hosted\n+service] for free.", "originalCommit": "00c06986633fd67fe16e971e2a5cc37ea6fcf84d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "bf08629ac100ad408f686c66dcbbf149a667ac2a", "url": "https://github.com/elastic/elasticsearch/commit/bf08629ac100ad408f686c66dcbbf149a667ac2a", "message": "Update docs/reference/setup/install.asciidoc\n\nCo-authored-by: James Rodewig <40268737+jrodewig@users.noreply.github.com>", "committedDate": "2020-08-19T18:21:39Z", "type": "commit"}, {"oid": "5c99678a4f085e978a801bbc703cd95aa8bcad9d", "url": "https://github.com/elastic/elasticsearch/commit/5c99678a4f085e978a801bbc703cd95aa8bcad9d", "message": "Update docs/reference/indices/open-close.asciidoc\n\nCo-authored-by: James Rodewig <40268737+jrodewig@users.noreply.github.com>", "committedDate": "2020-08-19T18:21:56Z", "type": "commit"}, {"oid": "0270b0f0fd5846356ae04f42a76adc30225859c8", "url": "https://github.com/elastic/elasticsearch/commit/0270b0f0fd5846356ae04f42a76adc30225859c8", "message": "Tabs \u2620\ufe0f", "committedDate": "2020-08-19T18:53:16Z", "type": "commit"}]}