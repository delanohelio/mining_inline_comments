{"pr_number": 54281, "pr_title": "Introduce ValuesSource Registry & Refactor Aggregation Type System", "pr_createdAt": "2020-03-26T15:35:17Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/54281", "timeline": [{"oid": "db9f53f7c6bb1a43dea07dea408e44ecaa0940df", "url": "https://github.com/elastic/elasticsearch/commit/db9f53f7c6bb1a43dea07dea408e44ecaa0940df", "message": "Remove ValuesSourceType argument to ValuesSourceAggregationBuilder (#48638)", "committedDate": "2019-10-31T19:17:37Z", "type": "commit"}, {"oid": "8ac8731c3cfc8bbfe3f9c4edc8ec5fe3f60a0498", "url": "https://github.com/elastic/elasticsearch/commit/8ac8731c3cfc8bbfe3f9c4edc8ec5fe3f60a0498", "message": "Merge branch 'master' into feature/extensible-values-source", "committedDate": "2019-10-31T19:19:28Z", "type": "commit"}, {"oid": "7c59324c56733399d41f6ce453d0806368b23f66", "url": "https://github.com/elastic/elasticsearch/commit/7c59324c56733399d41f6ce453d0806368b23f66", "message": "Merge branch 'master' into feature/extensible-values-source", "committedDate": "2019-11-14T21:11:48Z", "type": "commit"}, {"oid": "1a76ff9662d906747e292445d41670d0afc8232b", "url": "https://github.com/elastic/elasticsearch/commit/1a76ff9662d906747e292445d41670d0afc8232b", "message": "Merge branch 'master' into feature/extensible-values-source", "committedDate": "2019-11-18T19:25:49Z", "type": "commit"}, {"oid": "750b234076ee2269fe371e993b1d3d61279b0cfb", "url": "https://github.com/elastic/elasticsearch/commit/750b234076ee2269fe371e993b1d3d61279b0cfb", "message": "Merge branch 'master' into feature/extensible-values-source\n\n Conflicts:\nmodules/parent-join/src/main/java/org/elasticsearch/join/aggregations/ChildrenAggregationBuilder.java\n\tmodules/parent-join/src/main/java/org/elasticsearch/join/aggregations/ParentAggregationBuilder.java\n\tserver/src/main/java/org/elasticsearch/search/aggregations/bucket/geogrid/GeoGridAggregationBuilder.java\n\tserver/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/AutoDateHistogramAggregationBuilder.java\n\tserver/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateHistogramAggregationBuilder.java\n\tserver/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/HistogramAggregationBuilder.java\n\tserver/src/main/java/org/elasticsearch/search/aggregations/bucket/missing/MissingAggregationBuilder.java\n\tserver/src/main/java/org/elasticsearch/search/aggregations/bucket/range/IpRangeAggregationBuilder.java\n\tserver/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/DiversifiedAggregationBuilder.java\n\tserver/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/SignificantTermsAggregationBuilder.java\n\tserver/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/RareTermsAggregationBuilder.java\n\tserver/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/TermsAggregationBuilder.java\n\tserver/src/main/java/org/elasticsearch/search/aggregations/metrics/GeoBoundsAggregationBuilder.java\n\tx-pack/plugin/core/src/test/java/org/elasticsearch/xpack/core/transform/transforms/MockDeprecatedAggregationBuilder.java", "committedDate": "2019-11-19T19:52:54Z", "type": "commit"}, {"oid": "fc3509cd4a203253096bff1f3e4826cabfb83052", "url": "https://github.com/elastic/elasticsearch/commit/fc3509cd4a203253096bff1f3e4826cabfb83052", "message": "Merge branch 'master' into feature/extensible-values-source", "committedDate": "2019-11-25T17:03:31Z", "type": "commit"}, {"oid": "0331312aa51c7be2c70546b882d1135e078e7e25", "url": "https://github.com/elastic/elasticsearch/commit/0331312aa51c7be2c70546b882d1135e078e7e25", "message": "ValuesSourceRegistry Prototype (#48758)", "committedDate": "2019-11-25T21:43:03Z", "type": "commit"}, {"oid": "60b7ae7b7651e22f29e36b4026e2b80a03ae3c9e", "url": "https://github.com/elastic/elasticsearch/commit/60b7ae7b7651e22f29e36b4026e2b80a03ae3c9e", "message": "Remove generics from ValuesSource related classes (#49606)", "committedDate": "2019-12-02T15:17:12Z", "type": "commit"}, {"oid": "b0e1efeedd8dda0e4ae4686cf57d7a1af0ce4e94", "url": "https://github.com/elastic/elasticsearch/commit/b0e1efeedd8dda0e4ae4686cf57d7a1af0ce4e94", "message": "Merge branch 'master' into feature/extensible-values-source\n\n Conflicts:\n\tserver/src/main/java/org/elasticsearch/search/aggregations/metrics/HDRPercentileRanksAggregatorFactory.java\n\tserver/src/main/java/org/elasticsearch/search/aggregations/metrics/HDRPercentilesAggregatorFactory.java\n\tserver/src/main/java/org/elasticsearch/search/aggregations/metrics/PercentileRanksAggregationBuilder.java\n\tserver/src/main/java/org/elasticsearch/search/aggregations/metrics/PercentilesAggregationBuilder.java\n\tserver/src/main/java/org/elasticsearch/search/aggregations/metrics/TDigestPercentileRanksAggregatorFactory.java\n\tserver/src/main/java/org/elasticsearch/search/aggregations/metrics/TDigestPercentilesAggregatorFactory.java\n\tserver/src/main/java/org/elasticsearch/search/aggregations/support/ValuesSourceConfig.java", "committedDate": "2019-12-12T15:53:36Z", "type": "commit"}, {"oid": "538bae16b375cbe20e3ac1b74a286eff551b6a2a", "url": "https://github.com/elastic/elasticsearch/commit/538bae16b375cbe20e3ac1b74a286eff551b6a2a", "message": "Merge branch 'master' into feature/extensible-values-source\n\n Conflicts:\n\tserver/src/test/java/org/elasticsearch/search/aggregations/metrics/MinAggregatorTests.java", "committedDate": "2020-01-07T18:03:13Z", "type": "commit"}, {"oid": "f9e5255f5ddd3fa0041c93c887ead02e67488d85", "url": "https://github.com/elastic/elasticsearch/commit/f9e5255f5ddd3fa0041c93c887ead02e67488d85", "message": "fix percentile aggregation tests (#50712)", "committedDate": "2020-01-08T15:29:00Z", "type": "commit"}, {"oid": "2aeaedbf54a6b544a05e8c457b16d8dbc7b50439", "url": "https://github.com/elastic/elasticsearch/commit/2aeaedbf54a6b544a05e8c457b16d8dbc7b50439", "message": "Merge branch 'master' into feature/extensible-values-source\n\n Conflicts:\n\tserver/src/main/java/org/elasticsearch/search/aggregations/bucket/composite/DateHistogramValuesSourceBuilder.java", "committedDate": "2020-01-10T14:37:50Z", "type": "commit"}, {"oid": "57579124b6e3a24268804ebdfa28705a81bf36a0", "url": "https://github.com/elastic/elasticsearch/commit/57579124b6e3a24268804ebdfa28705a81bf36a0", "message": "Basic thread safety for ValuesSourceRegistry (#50340)", "committedDate": "2020-01-10T19:07:51Z", "type": "commit"}, {"oid": "c44db7936cf33d74478a3b202c3c4d19d74e3056", "url": "https://github.com/elastic/elasticsearch/commit/c44db7936cf33d74478a3b202c3c4d19d74e3056", "message": "Remove target value type from ValuesSourceAggregationBuilder (#49943)", "committedDate": "2020-01-13T21:25:39Z", "type": "commit"}, {"oid": "82590a7e224c6bf5f8a51a8dc7d2481c24eb6a23", "url": "https://github.com/elastic/elasticsearch/commit/82590a7e224c6bf5f8a51a8dc7d2481c24eb6a23", "message": "Merge branch 'master' into feature/extensible-values-source\n\n Conflicts:\n\tserver/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateHistogramAggregatorFactory.java", "committedDate": "2020-01-14T15:03:00Z", "type": "commit"}, {"oid": "41503f81a29354c916bc567826bfff8dd8f1d4c8", "url": "https://github.com/elastic/elasticsearch/commit/41503f81a29354c916bc567826bfff8dd8f1d4c8", "message": "Merge branch 'master' into feature/extensible-values-source\n\n Conflicts:\n\tserver/src/main/java/org/elasticsearch/search/aggregations/bucket/geogrid/GeoGridAggregationBuilder.java\n\tserver/src/main/java/org/elasticsearch/search/aggregations/bucket/geogrid/GeoHashGridAggregationBuilder.java\n\tserver/src/main/java/org/elasticsearch/search/aggregations/bucket/geogrid/GeoHashGridAggregatorFactory.java\n\tserver/src/main/java/org/elasticsearch/search/aggregations/bucket/geogrid/GeoTileGridAggregationBuilder.java\n\tserver/src/main/java/org/elasticsearch/search/aggregations/bucket/geogrid/GeoTileGridAggregatorFactory.java", "committedDate": "2020-01-16T14:36:16Z", "type": "commit"}, {"oid": "3759d6f774a2c949cc9e2323f600111463945979", "url": "https://github.com/elastic/elasticsearch/commit/3759d6f774a2c949cc9e2323f600111463945979", "message": "Merge branch 'master' into feature/extensible-values-source", "committedDate": "2020-01-16T15:54:08Z", "type": "commit"}, {"oid": "e0d4e8fb5ea275b735062699852df1210e58ec70", "url": "https://github.com/elastic/elasticsearch/commit/e0d4e8fb5ea275b735062699852df1210e58ec70", "message": "Cleanup default values source type (#50992)", "committedDate": "2020-01-21T18:17:30Z", "type": "commit"}, {"oid": "4e44149974ca0442d92b8bad7165c0b4af7c8d4e", "url": "https://github.com/elastic/elasticsearch/commit/4e44149974ca0442d92b8bad7165c0b4af7c8d4e", "message": "Merge branch 'master' into feature/extensible-values-source\n\n Conflicts:\n\tserver/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateHistogramAggregatorFactory.java", "committedDate": "2020-01-22T15:00:04Z", "type": "commit"}, {"oid": "98d5b22e6aabfdacc7085dcfbba887c542eec54e", "url": "https://github.com/elastic/elasticsearch/commit/98d5b22e6aabfdacc7085dcfbba887c542eec54e", "message": "CoreValuesSourceType no longer implements Writable (#51276)", "committedDate": "2020-01-22T17:00:40Z", "type": "commit"}, {"oid": "1276d7390e6ebf53f9005f3a3dc49f52da92a0fa", "url": "https://github.com/elastic/elasticsearch/commit/1276d7390e6ebf53f9005f3a3dc49f52da92a0fa", "message": "Remove genereics & hard coded ValuesSource references from Matrix Stats (#51131)", "committedDate": "2020-01-22T18:11:13Z", "type": "commit"}, {"oid": "64ba8a96de2be87fd7e7af4fe9f0d326bd06b56d", "url": "https://github.com/elastic/elasticsearch/commit/64ba8a96de2be87fd7e7af4fe9f0d326bd06b56d", "message": "Put values source types on fields (#51503)", "committedDate": "2020-01-28T17:26:47Z", "type": "commit"}, {"oid": "b36c79be98c165798c1eff21d7d73600145ffc39", "url": "https://github.com/elastic/elasticsearch/commit/b36c79be98c165798c1eff21d7d73600145ffc39", "message": "Remove VST Any (#51539)", "committedDate": "2020-01-28T17:47:09Z", "type": "commit"}, {"oid": "02c82d81fbf58794ba5957070e278fcdd53234d3", "url": "https://github.com/elastic/elasticsearch/commit/02c82d81fbf58794ba5957070e278fcdd53234d3", "message": "Rewire terms agg to use new VS registry (#51182)\n\nAlso adds some basic AggTestCases for untested code\r\npaths (and boilerplate for future tests once the IT are\r\nconverted over)", "committedDate": "2020-01-29T15:29:37Z", "type": "commit"}, {"oid": "a8a35dcebd58f0756241236771b5399bbd730003", "url": "https://github.com/elastic/elasticsearch/commit/a8a35dcebd58f0756241236771b5399bbd730003", "message": "Wire Cardinality aggregation to work with the ValuesSourceRegistry (#51337)", "committedDate": "2020-01-30T16:03:20Z", "type": "commit"}, {"oid": "362d6fac059cf5f2e23622f1596554b63bc9ec65", "url": "https://github.com/elastic/elasticsearch/commit/362d6fac059cf5f2e23622f1596554b63bc9ec65", "message": "Merge branch 'master' into feature/extensible-values-source\n\n Conflicts:\n\tserver/src/main/java/org/elasticsearch/search/aggregations/bucket/composite/CompositeValuesSourceBuilder.java\n\tserver/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateHistogramAggregatorFactory.java", "committedDate": "2020-01-31T16:37:53Z", "type": "commit"}, {"oid": "24669387918b8a010147b840c2aae2ea0b20a048", "url": "https://github.com/elastic/elasticsearch/commit/24669387918b8a010147b840c2aae2ea0b20a048", "message": "Wire Percentiles aggregator into new VS framework (#51639)\n\nThis required a bit of a refactor to percentiles itself.  Before,\r\nthe Builder would switch on the chosen algo to generate an\r\nalgo-specific factory.  This doesn't work (or at least, would be\r\ndifficult) in the new VS framework.\r\n\r\nThis refactor consolidates both factories together and introduces\r\na PercentilesConfig object to act as a standardized way to pass\r\nalgo-specific parameters through the factory.  This object\r\nis then used when deciding which kind of aggregator to create\r\n\r\nNote: CoreValuesSourceType.HISTOGRAM still lives in core, and will\r\nbe moved in a subsequent PR.", "committedDate": "2020-01-31T18:14:08Z", "type": "commit"}, {"oid": "369ad6052fafd4cfd1b183f210a5bbd7769c7d1d", "url": "https://github.com/elastic/elasticsearch/commit/369ad6052fafd4cfd1b183f210a5bbd7769c7d1d", "message": "Remove generics and target value type from MultiVSAB (#51647)", "committedDate": "2020-02-05T17:16:28Z", "type": "commit"}, {"oid": "91bbb5f7c82f5693acf722821948d8ec84516009", "url": "https://github.com/elastic/elasticsearch/commit/91bbb5f7c82f5693acf722821948d8ec84516009", "message": "Merge branch 'master' into feature/extensible-values-source", "committedDate": "2020-02-05T18:11:47Z", "type": "commit"}, {"oid": "b33baec5f8665c970c77748b4d4be502edfc1c05", "url": "https://github.com/elastic/elasticsearch/commit/b33baec5f8665c970c77748b4d4be502edfc1c05", "message": "fix checkstyle after merge (#52008)", "committedDate": "2020-02-07T13:51:15Z", "type": "commit"}, {"oid": "af5f31983dbbb89a4a4c9c91967eee96498acde7", "url": "https://github.com/elastic/elasticsearch/commit/af5f31983dbbb89a4a4c9c91967eee96498acde7", "message": "Merge branch 'master' into feature/extensible-values-source", "committedDate": "2020-02-07T15:27:58Z", "type": "commit"}, {"oid": "77b87a10785f543fed9704c6ceefbc0fa1f01e77", "url": "https://github.com/elastic/elasticsearch/commit/77b87a10785f543fed9704c6ceefbc0fa1f01e77", "message": "Plumb ValuesSourceRegistry through to QuerySearchContext (#51710)", "committedDate": "2020-02-07T17:26:34Z", "type": "commit"}, {"oid": "22397e08fbfb142cf1b086ef2216fe062b1ed232", "url": "https://github.com/elastic/elasticsearch/commit/22397e08fbfb142cf1b086ef2216fe062b1ed232", "message": "Merge remote-tracking branch 'origin/master' into feature/extensible-values-source", "committedDate": "2020-02-11T21:19:20Z", "type": "commit"}, {"oid": "d0eea4edd3fb849ff9e037e8e7e158f207f289d3", "url": "https://github.com/elastic/elasticsearch/commit/d0eea4edd3fb849ff9e037e8e7e158f207f289d3", "message": "Merge branch 'master' into feature/extensible-values-source\n\n Conflicts:\n\tmodules/mapper-extras/src/main/java/org/elasticsearch/index/mapper/ScaledFloatFieldMapper.java\n\tserver/src/main/java/org/elasticsearch/index/IndexModule.java\n\tserver/src/main/java/org/elasticsearch/index/IndexService.java\n\tserver/src/main/java/org/elasticsearch/index/mapper/IdFieldMapper.java\n\tserver/src/main/java/org/elasticsearch/index/query/QueryShardContext.java\n\tserver/src/test/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexServiceTests.java\n\tserver/src/test/java/org/elasticsearch/index/mapper/DateFieldTypeTests.java\n\tserver/src/test/java/org/elasticsearch/index/mapper/FieldNamesFieldTypeTests.java\n\tserver/src/test/java/org/elasticsearch/index/mapper/IndexFieldTypeTests.java\n\tserver/src/test/java/org/elasticsearch/index/mapper/RangeFieldTypeTests.java\n\tserver/src/test/java/org/elasticsearch/index/query/IntervalQueryBuilderTests.java\n\tserver/src/test/java/org/elasticsearch/index/query/QueryShardContextTests.java\n\tserver/src/test/java/org/elasticsearch/index/query/RangeQueryRewriteTests.java\n\tserver/src/test/java/org/elasticsearch/search/aggregations/bucket/histogram/ExtendedBoundsTests.java\n\tserver/src/test/java/org/elasticsearch/search/aggregations/metrics/MinAggregatorTests.java\n\tserver/src/test/java/org/elasticsearch/search/aggregations/metrics/ScriptedMetricAggregatorTests.java\n\tserver/src/test/java/org/elasticsearch/search/fetch/subphase/highlight/HighlightBuilderTests.java\n\tserver/src/test/java/org/elasticsearch/search/rescore/QueryRescorerBuilderTests.java\n\tserver/src/test/java/org/elasticsearch/search/sort/AbstractSortTestCase.java\n\tserver/src/test/java/org/elasticsearch/search/suggest/AbstractSuggestionBuilderTestCase.java\n\ttest/framework/src/main/java/org/elasticsearch/search/aggregations/AggregatorTestCase.java\n\ttest/framework/src/main/java/org/elasticsearch/test/AbstractBuilderTestCase.java\n\ttest/framework/src/test/java/org/elasticsearch/search/MockSearchServiceTests.java\n\tx-pack/plugin/analytics/src/main/java/org/elasticsearch/xpack/analytics/boxplot/BoxplotAggregationBuilder.java\n\tx-pack/plugin/analytics/src/main/java/org/elasticsearch/xpack/analytics/boxplot/BoxplotAggregatorFactory.java\n\tx-pack/plugin/analytics/src/main/java/org/elasticsearch/xpack/analytics/mapper/HistogramFieldMapper.java\n\tx-pack/plugin/analytics/src/main/java/org/elasticsearch/xpack/analytics/stringstats/StringStatsAggregationBuilder.java\n\tx-pack/plugin/core/src/test/java/org/elasticsearch/xpack/core/security/authz/accesscontrol/DocumentSubsetBitsetCacheTests.java\n\tx-pack/plugin/core/src/test/java/org/elasticsearch/xpack/core/security/authz/accesscontrol/SecurityIndexReaderWrapperIntegrationTests.java\n\tx-pack/plugin/mapper-flattened/src/main/java/org/elasticsearch/xpack/flattened/mapper/FlatObjectFieldMapper.java\n\tx-pack/plugin/rollup/src/test/java/org/elasticsearch/xpack/rollup/job/RollupIndexerIndexingTests.java", "committedDate": "2020-02-19T16:28:56Z", "type": "commit"}, {"oid": "a79bc739de7893ed727ad4402eecad2d88e6df39", "url": "https://github.com/elastic/elasticsearch/commit/a79bc739de7893ed727ad4402eecad2d88e6df39", "message": "Merge branch 'master' into feature/extensible-values-source\n\n Conflicts:\n\tserver/src/main/java/org/elasticsearch/index/IndexModule.java\n\tserver/src/main/java/org/elasticsearch/index/IndexService.java\n\tserver/src/main/java/org/elasticsearch/index/mapper/BooleanFieldMapper.java\n\tserver/src/main/java/org/elasticsearch/index/mapper/DateFieldMapper.java\n\tserver/src/main/java/org/elasticsearch/index/mapper/IpFieldMapper.java\n\tserver/src/main/java/org/elasticsearch/node/Node.java\n\ttest/framework/src/main/java/org/elasticsearch/search/aggregations/AggregatorTestCase.java\n\tx-pack/plugin/transform/src/main/java/org/elasticsearch/xpack/transform/transforms/pivot/SchemaUtil.java", "committedDate": "2020-02-24T16:44:36Z", "type": "commit"}, {"oid": "d6caf2db0e0112d3bdda9569f6ddd9d424ddf1ef", "url": "https://github.com/elastic/elasticsearch/commit/d6caf2db0e0112d3bdda9569f6ddd9d424ddf1ef", "message": "Convert RareTerms to new VS registry (#52166)", "committedDate": "2020-02-24T19:55:01Z", "type": "commit"}, {"oid": "e567ecb483113a943d4b0e6a75f1240c6d0ae42e", "url": "https://github.com/elastic/elasticsearch/commit/e567ecb483113a943d4b0e6a75f1240c6d0ae42e", "message": "Wire up Value Count (#52225)", "committedDate": "2020-02-24T20:50:39Z", "type": "commit"}, {"oid": "8fbff7332b9070f68a79e8e879bf304237b36e4b", "url": "https://github.com/elastic/elasticsearch/commit/8fbff7332b9070f68a79e8e879bf304237b36e4b", "message": "Wire up Max & Min aggregations (#52219)", "committedDate": "2020-02-24T20:51:02Z", "type": "commit"}, {"oid": "24ca41948a394406e54e87782235cdaf6186e3aa", "url": "https://github.com/elastic/elasticsearch/commit/24ca41948a394406e54e87782235cdaf6186e3aa", "message": "Merge remote-tracking branch 'origin/master' into feature/extensible-values-source\n\nNote: mutes AggregatorTestCase#testSupportedFieldTypes() temporarily,\nas the fix will require a bit more work than I'm comfortable\ndoing in a merge commit.", "committedDate": "2020-02-24T22:29:33Z", "type": "commit"}, {"oid": "59ae37ae3d8412840735b6435fd2677b0a4732b5", "url": "https://github.com/elastic/elasticsearch/commit/59ae37ae3d8412840735b6435fd2677b0a4732b5", "message": "ValuesSource refactoring: Wire up Sum aggregation (#52571)", "committedDate": "2020-02-25T08:59:02Z", "type": "commit"}, {"oid": "9df4ee6d2616c39655d5ad6beb4100a9a105a9ed", "url": "https://github.com/elastic/elasticsearch/commit/9df4ee6d2616c39655d5ad6beb4100a9a105a9ed", "message": "ValuesSource refactoring: Wire up SigTerms aggregation (#52590)", "committedDate": "2020-02-25T16:42:09Z", "type": "commit"}, {"oid": "678164ba464f1f1ad887c1c7642362f5f51d086f", "url": "https://github.com/elastic/elasticsearch/commit/678164ba464f1f1ad887c1c7642362f5f51d086f", "message": "Soft immutability for VSConfig (#52729)", "committedDate": "2020-02-26T14:32:53Z", "type": "commit"}, {"oid": "898fc70c65706bb96796d4b21e93e9bf5edcb2b7", "url": "https://github.com/elastic/elasticsearch/commit/898fc70c65706bb96796d4b21e93e9bf5edcb2b7", "message": "Unmute testSupportedFieldTypes, fix Percentiles/Ranks/Terms tests (#52734)\n\nAlso fixes Percentiles which was incorrectly specified to only accept\r\nnumeric, but in fact also accepts Boolean and Date (because those are\r\nnumeric on master - thanks `testSupportedFieldTypes` for catching it!)", "committedDate": "2020-02-26T15:21:23Z", "type": "commit"}, {"oid": "3dea0e657297b7483aa7231101697b8c62b17b32", "url": "https://github.com/elastic/elasticsearch/commit/3dea0e657297b7483aa7231101697b8c62b17b32", "message": "VS refactoring: Wire up stats aggregation (#52891)", "committedDate": "2020-02-27T16:00:50Z", "type": "commit"}, {"oid": "d434a9d2658dade09fb5259b1eb43f8f605b0785", "url": "https://github.com/elastic/elasticsearch/commit/d434a9d2658dade09fb5259b1eb43f8f605b0785", "message": "ValuesSource refactoring: Wire up string_stats aggregation (#52875)", "committedDate": "2020-02-27T16:13:15Z", "type": "commit"}, {"oid": "0e79fd5cf128a8a59b2be00adeef2c648e55e544", "url": "https://github.com/elastic/elasticsearch/commit/0e79fd5cf128a8a59b2be00adeef2c648e55e544", "message": "Merge remote-tracking branch 'origin/master' into feature/extensible-values-source", "committedDate": "2020-02-28T15:54:29Z", "type": "commit"}, {"oid": "d961faa33561cf73610b1dac37a3589526b5f730", "url": "https://github.com/elastic/elasticsearch/commit/d961faa33561cf73610b1dac37a3589526b5f730", "message": "VS refactoring: Wire up median (MAD) aggregation (#52945)", "committedDate": "2020-02-28T21:48:19Z", "type": "commit"}, {"oid": "f2474a4db2fd7e14a87f2ac81f8b92119c2fdd46", "url": "https://github.com/elastic/elasticsearch/commit/f2474a4db2fd7e14a87f2ac81f8b92119c2fdd46", "message": "Merge branch 'master' into feature/extensible-values-source", "committedDate": "2020-03-02T23:06:38Z", "type": "commit"}, {"oid": "b742a6421c64b891502dbdee3262766a3503d44b", "url": "https://github.com/elastic/elasticsearch/commit/b742a6421c64b891502dbdee3262766a3503d44b", "message": "fix valuesourcetype issue with constant_keyword field (#53041)\n\nthis commit implements `getValuesSourceType` for\r\nthe ConstantKeyword field type.\r\n\r\nmaster was merged into feature/extensible-values-source\r\nintroducing a new field type that was not implementing\r\n`getValuesSourceType`.", "committedDate": "2020-03-03T16:12:32Z", "type": "commit"}, {"oid": "95886974ff8e4eee746ef85430ddd02c620e76d1", "url": "https://github.com/elastic/elasticsearch/commit/95886974ff8e4eee746ef85430ddd02c620e76d1", "message": "ValuesSource refactoring: Wire up Avg aggregation (#52752)", "committedDate": "2020-03-03T17:50:22Z", "type": "commit"}, {"oid": "52de1e80c371010c011495ddc9964bac8b60a9aa", "url": "https://github.com/elastic/elasticsearch/commit/52de1e80c371010c011495ddc9964bac8b60a9aa", "message": "Wire PercentileRanks aggregator into new VS framework  (#51693)", "committedDate": "2020-03-03T18:30:54Z", "type": "commit"}, {"oid": "33fc002e4160e6849430e5a5ac38338094bf721b", "url": "https://github.com/elastic/elasticsearch/commit/33fc002e4160e6849430e5a5ac38338094bf721b", "message": "Add a VSConfig resolver for aggregations not using the registry (#53038)", "committedDate": "2020-03-04T20:06:04Z", "type": "commit"}, {"oid": "29463c43a23b830beee1c8c31df1f57a8626270e", "url": "https://github.com/elastic/elasticsearch/commit/29463c43a23b830beee1c8c31df1f57a8626270e", "message": "Vs refactor wire up ranges and date ranges (#52918)", "committedDate": "2020-03-04T22:05:34Z", "type": "commit"}, {"oid": "5ae3f193b9db13ea1a1d1f25181ab01b60e93245", "url": "https://github.com/elastic/elasticsearch/commit/5ae3f193b9db13ea1a1d1f25181ab01b60e93245", "message": "Wire up geo_bounds aggregation to ValuesSourceRegistry (#53034)\n\nThis commit updates the geo_bounds aggregation to depend\r\non registering itself in the ValuesSourceRegistry\r\n\r\nrelates #42949.", "committedDate": "2020-03-05T18:08:22Z", "type": "commit"}, {"oid": "9923466af9f2fdb46e687186c0cbaeff06d68fcd", "url": "https://github.com/elastic/elasticsearch/commit/9923466af9f2fdb46e687186c0cbaeff06d68fcd", "message": "VS refactoring: convert Boxplot to new registry (#53132)", "committedDate": "2020-03-05T21:32:28Z", "type": "commit"}, {"oid": "3a2818dab1ba5c08fdcba3f25183c32038178001", "url": "https://github.com/elastic/elasticsearch/commit/3a2818dab1ba5c08fdcba3f25183c32038178001", "message": "Merge remote-tracking branch 'elastic/master' into feature/extensible-values-source", "committedDate": "2020-03-06T21:02:58Z", "type": "commit"}, {"oid": "7ed6a7ecde32fb05ce190894485c58b8ce95a1c4", "url": "https://github.com/elastic/elasticsearch/commit/7ed6a7ecde32fb05ce190894485c58b8ce95a1c4", "message": "Wire-up geotile_grid and geohash_grid to ValuesSourceRegistry (#53037)\n\nThis commit updates the geo*_grid aggregations to depend\r\non registering itself in the ValuesSourceRegistry\r\n\r\nrelates to the values-source refactoring meta issue #42949.", "committedDate": "2020-03-09T19:46:01Z", "type": "commit"}, {"oid": "08c242d1583d13a4768648fcece39284f376d2b8", "url": "https://github.com/elastic/elasticsearch/commit/08c242d1583d13a4768648fcece39284f376d2b8", "message": "Wire-up geo_centroid agg to ValuesSourceRegistry (#53040)\n\nThis commit updates the geo_centroid aggregation to depend\r\non registering itself in the ValuesSourceRegistry.\r\n\r\nrelates to the values-source refactoring meta issue #42949.", "committedDate": "2020-03-09T19:46:26Z", "type": "commit"}, {"oid": "66364025570334d254e815f1e9a33997b75f7e60", "url": "https://github.com/elastic/elasticsearch/commit/66364025570334d254e815f1e9a33997b75f7e60", "message": "Merge remote-tracking branch 'origin/master' into feature/extensible-values-source", "committedDate": "2020-03-09T21:42:32Z", "type": "commit"}, {"oid": "5960eeddbf3eee91a7090a9bb0c15abf99df4467", "url": "https://github.com/elastic/elasticsearch/commit/5960eeddbf3eee91a7090a9bb0c15abf99df4467", "message": "Merge branch 'master' into feature/extensible-values-source\n\n Conflicts:\n\tserver/src/test/java/org/elasticsearch/search/aggregations/bucket/missing/MissingAggregatorTests.java\n\tx-pack/plugin/analytics/src/main/java/org/elasticsearch/xpack/analytics/topmetrics/TopMetricsAggregatorFactory.java", "committedDate": "2020-03-12T14:50:16Z", "type": "commit"}, {"oid": "64d5c84c5c616c8b15cc3048dc9fd82bf03f67ab", "url": "https://github.com/elastic/elasticsearch/commit/64d5c84c5c616c8b15cc3048dc9fd82bf03f67ab", "message": "Fix type tests for Missing aggregation (#53501)", "committedDate": "2020-03-12T18:12:25Z", "type": "commit"}, {"oid": "ba2210e7f2e2bcabba9208446ff94d62dd449bd4", "url": "https://github.com/elastic/elasticsearch/commit/ba2210e7f2e2bcabba9208446ff94d62dd449bd4", "message": "ValuesSource Refactor: move histo VSType into XPack module (#53298)\n\n- Introduces a new API (`getBareAggregatorRegistrar()`) which allows plugins to register aggregations against existing agg definitions defined in Core.\r\n- This moves the histogram VSType over to XPack where it belongs. `getHistogramValues()` still remains as a Core concept\r\n- Moves the histo-specific bits over to xpack (e.g. the actual aggregator logic). This requires extra boilerplate since we need to create a new \"Analytics\" Percentile/Rank aggregators to deal with the histo field. Doubly-so since percentiles/ranks are extra boiler-plate'y... should be much lighter for other aggs", "committedDate": "2020-03-12T19:52:55Z", "type": "commit"}, {"oid": "52214eb4b0421c0e8f9c7620beb098348c1e86c2", "url": "https://github.com/elastic/elasticsearch/commit/52214eb4b0421c0e8f9c7620beb098348c1e86c2", "message": "Wire up DateHistogram to the ValuesSourceRegistry (#53484)", "committedDate": "2020-03-12T19:54:32Z", "type": "commit"}, {"oid": "e30dd36b5d227ab5e405c2adbc7bbb6bc9d6a8cc", "url": "https://github.com/elastic/elasticsearch/commit/e30dd36b5d227ab5e405c2adbc7bbb6bc9d6a8cc", "message": "Vs refactor parser cleanup (#53198)", "committedDate": "2020-03-13T14:30:26Z", "type": "commit"}, {"oid": "cacf0a6fca9955da89cf6597bd3befa1a0428e03", "url": "https://github.com/elastic/elasticsearch/commit/cacf0a6fca9955da89cf6597bd3befa1a0428e03", "message": "Merge branch 'master' into experiment5\n\n Conflicts:\n\tserver/src/main/java/org/elasticsearch/search/SearchModule.java\n\tserver/src/main/java/org/elasticsearch/search/aggregations/bucket/geogrid/GeoGridAggregationBuilder.java\n\tserver/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/AutoDateHistogramAggregationBuilder.java\n\tserver/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateHistogramAggregationBuilder.java\n\tserver/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/HistogramAggregationBuilder.java\n\tserver/src/main/java/org/elasticsearch/search/aggregations/bucket/range/DateRangeAggregationBuilder.java\n\tserver/src/main/java/org/elasticsearch/search/aggregations/bucket/range/IpRangeAggregationBuilder.java\n\tserver/src/main/java/org/elasticsearch/search/aggregations/bucket/range/RangeAggregationBuilder.java\n\tserver/src/main/java/org/elasticsearch/search/aggregations/metrics/GeoBoundsAggregationBuilder.java\n\tserver/src/main/java/org/elasticsearch/search/aggregations/metrics/GeoCentroidAggregationBuilder.java\n\tserver/src/main/java/org/elasticsearch/search/aggregations/support/ValuesSource.java\n\tserver/src/test/java/org/elasticsearch/search/aggregations/bucket/significant/SignificantTermsAggregatorTests.java\n\tserver/src/test/java/org/elasticsearch/search/aggregations/metrics/MinAggregatorTests.java\n\ttest/framework/src/main/java/org/elasticsearch/search/aggregations/AggregatorTestCase.java\n\tx-pack/plugin/analytics/src/test/java/org/elasticsearch/xpack/analytics/boxplot/BoxplotAggregatorTests.java\n\tx-pack/plugin/analytics/src/test/java/org/elasticsearch/xpack/analytics/cumulativecardinality/CumulativeCardinalityAggregatorTests.java\n\tx-pack/plugin/analytics/src/test/java/org/elasticsearch/xpack/analytics/stringstats/StringStatsAggregatorTests.java", "committedDate": "2020-03-26T15:30:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODcxNTU1OA==", "url": "https://github.com/elastic/elasticsearch/pull/54281#discussion_r398715558", "bodyText": "I'm aware of this TODO, I think it's okay to merge to master as is and fix there.", "author": "not-napoleon", "createdAt": "2020-03-26T16:32:44Z", "path": "server/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/AutoDateHistogramAggregationBuilder.java", "diffHunk": "@@ -148,6 +145,12 @@ protected AutoDateHistogramAggregationBuilder(AutoDateHistogramAggregationBuilde\n         this.minimumIntervalExpression = clone.minimumIntervalExpression;\n     }\n \n+    @Override\n+    protected ValuesSourceType defaultValueSourceType() {\n+        // TODO: This should probably be DATE, but we're not failing tests with BYTES, so needs more tests?", "originalCommit": "cacf0a6fca9955da89cf6597bd3befa1a0428e03", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODc5MzM3OQ==", "url": "https://github.com/elastic/elasticsearch/pull/54281#discussion_r398793379", "bodyText": "I can't tell if github is being weird with the diff or if this is an actual change, but it seems these are listed below as well?  Surprised precommit doesn't fail this", "author": "polyfractal", "createdAt": "2020-03-26T18:20:13Z", "path": "server/src/main/java/org/elasticsearch/index/mapper/IdFieldMapper.java", "diffHunk": "@@ -48,6 +48,8 @@\n import org.elasticsearch.indices.breaker.CircuitBreakerService;\n import org.elasticsearch.search.DocValueFormat;\n import org.elasticsearch.search.MultiValueMode;\n+import org.elasticsearch.search.aggregations.support.CoreValuesSourceType;", "originalCommit": "cacf0a6fca9955da89cf6597bd3befa1a0428e03", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODgwMTA0Mg==", "url": "https://github.com/elastic/elasticsearch/pull/54281#discussion_r398801042", "bodyText": "I believe we lost the check for date_nanos (DateFieldMapper.DATE_NANOS_CONTENT_TYPE)) which I think will eventually break?\nWe can do a quick follow-on PR instead of changing this one imo.", "author": "polyfractal", "createdAt": "2020-03-26T18:31:28Z", "path": "test/framework/src/main/java/org/elasticsearch/search/aggregations/AggregatorTestCase.java", "diffHunk": "@@ -741,15 +737,25 @@ private void writeTestDoc(MappedFieldType fieldType, String fieldName, RandomInd\n             if (typeName.equals(BinaryFieldMapper.CONTENT_TYPE)) {\n                 doc.add(new BinaryFieldMapper.CustomBinaryDocValuesField(fieldName, new BytesRef(\"a\").bytes));\n                 json = \"{ \\\"\" + fieldName + \"\\\" : \\\"a\\\" }\";\n-            } else if (typeName.equals(IpFieldMapper.CONTENT_TYPE)) {\n-                // TODO note: once VS refactor adds IP, this conditional will go away\n-                InetAddress ip = randomIp(randomBoolean());\n-                json = \"{ \\\"\" + fieldName + \"\\\" : \\\"\" + NetworkAddress.format(ip) + \"\\\" }\";\n-                doc.add(new SortedSetDocValuesField(fieldName, new BytesRef(InetAddressPoint.encode(ip))));\n             } else {\n                 doc.add(new SortedSetDocValuesField(fieldName, new BytesRef(\"a\")));\n                 json = \"{ \\\"\" + fieldName + \"\\\" : \\\"a\\\" }\";\n             }\n+        } else if (vst.equals(CoreValuesSourceType.DATE)) {", "originalCommit": "cacf0a6fca9955da89cf6597bd3befa1a0428e03", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}