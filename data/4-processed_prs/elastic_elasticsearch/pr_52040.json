{"pr_number": 52040, "pr_title": "Example for index multi-document support", "pr_createdAt": "2020-02-07T12:25:59Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/52040", "timeline": [{"oid": "0698a9969d45835960ead893ebff82a3c5b04b8e", "url": "https://github.com/elastic/elasticsearch/commit/0698a9969d45835960ead893ebff82a3c5b04b8e", "message": "Example for index multi-document support\n\nThe previous docs provided instructions on how to create the _doc payload field. However, it's not trivial and an example can help to create it.", "committedDate": "2020-02-07T12:25:12Z", "type": "commit"}, {"oid": "6ba3118da00a46bfa2de211bc4bf80180837785d", "url": "https://github.com/elastic/elasticsearch/commit/6ba3118da00a46bfa2de211bc4bf80180837785d", "message": "Merge branch 'master' into luizgpsantos-patch-3", "committedDate": "2020-05-20T13:13:00Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODIzOTgwOA==", "url": "https://github.com/elastic/elasticsearch/pull/52040#discussion_r428239808", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  return [ '_doc' : documents]; <4>\n          \n          \n            \n                  return [ \"_doc\" : documents]; <4>", "author": "jrodewig", "createdAt": "2020-05-20T18:56:51Z", "path": "x-pack/docs/en/watcher/actions/index.asciidoc", "diffHunk": "@@ -73,5 +73,34 @@ When a `_doc` field exists, if the field holds an object, it is extracted and in\n as a single document. If the field holds an array of objects, each object is treated as\n a document and the index action indexes all of them in a bulk.\n \n-An `_index`, or `_id` value can be added per document to dynamically set the ID\n+An `_index`, or `_id` value can be added per document to dynamically set the index and ID\n of the indexed document.\n+\n+The following snippet shows a multi-document `index` action definition:\n+\n+[source,js]\n+--------------------------------------------------\n+\"actions\": {\n+  \"index_payload\": {\n+    \"transform\": {\n+      \"script\": \"\"\"\n+      def documents = ctx.payload.hits.hits.stream()\n+        .map(hit -> [\n+          \"_index\": \"my-index\", <1>\n+          \"_id\": hit._id, <2>\n+          \"severity\": \"Sev: \" + hit._source.severity <3>\n+        ])\n+        .collect(Collectors.toList());\n+      return [ '_doc' : documents]; <4>", "originalCommit": "6ba3118da00a46bfa2de211bc4bf80180837785d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "fa225625810023a835eb4a37c3f0504a03a62835", "url": "https://github.com/elastic/elasticsearch/commit/fa225625810023a835eb4a37c3f0504a03a62835", "message": "Update x-pack/docs/en/watcher/actions/index.asciidoc\n\nCo-authored-by: James Rodewig <james.rodewig@elastic.co>", "committedDate": "2020-05-20T19:08:16Z", "type": "commit"}]}