{"pr_number": 52862, "pr_title": "Updates to TESTING.asciidoc for REST testing", "pr_createdAt": "2020-02-27T01:45:36Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/52862", "timeline": [{"oid": "799a09753b8b025bbaad200836e8487ca6a1f4f4", "url": "https://github.com/elastic/elasticsearch/commit/799a09753b8b025bbaad200836e8487ca6a1f4f4", "message": "updates to TESTING.asciidoc for rest testing", "committedDate": "2020-02-27T01:39:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTIyMzY1NQ==", "url": "https://github.com/elastic/elasticsearch/pull/52862#discussion_r385223655", "bodyText": "Is the underscore prefix to \"common\" required?", "author": "mark-vieira", "createdAt": "2020-02-27T16:31:06Z", "path": "TESTING.asciidoc", "diffHunk": "@@ -270,34 +270,49 @@ code 137 (128 + 9, where 9 means SIGKILL).\n \n == Testing the REST layer\n \n-The available integration tests make use of the java API to communicate with\n-the elasticsearch nodes, using the internal binary transport (port 9300 by\n-default).\n-The REST layer is tested through specific tests that are shared between all\n-the elasticsearch official clients and consist of YAML files that describe the\n+The REST layer is tested through specific tests that are executed against\n+a cluster that is configured and initialized via Gradle. The tests\n+themselves can be written in either Java or with a YAML based DSL.\n+\n+YAML based REST tests should be preferred since these are shared between all\n+the elasticsearch official clients. The YAML based tests describe the\n operations to be executed and the obtained results that need to be tested.\n \n-The YAML files support various operators defined in the link:/rest-api-spec/src/main/resources/rest-api-spec/test/README.asciidoc[rest-api-spec] and adhere to the link:/rest-api-spec/README.markdown[Elasticsearch REST API JSON specification]\n+The YAML tests support various operators defined in the link:/rest-api-spec/src/main/resources/rest-api-spec/test/README.asciidoc[rest-api-spec] and adhere to the link:/rest-api-spec/README.markdown[Elasticsearch REST API JSON specification]\n+In order to run the the YAML tests, the relevant API specification needs\n+to be on the test classpath. Any gradle project that has support for REST\n+tests will get the primary API on it's class path. However, to better support\n+Gradle incremental builds, it is recommended to explicitly declare which\n+parts of the API the tests depend upon.\n+\n+For example:\n+---------------------------------------------------------------------------\n+restResources {\n+  restApi {\n+    includeCore '_common', 'indices', 'index', 'cluster', 'nodes', 'get', 'ingest'", "originalCommit": "799a09753b8b025bbaad200836e8487ca6a1f4f4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTIzODQ3Nw==", "url": "https://github.com/elastic/elasticsearch/pull/52862#discussion_r385238477", "bodyText": "yeah it's required to match the pattern\nThis will result in a pattern match of  _common*/**. The file we are matching is _common.json. The api's don't use use folders, so we could change the pattern match to be *common*.json, however the tests do use folders so those would need to stay <prefix>*/** (or the like). I figured a simple prefix match for both would be simplest to reason about, but am open to change (in a different PR)", "author": "jakelandis", "createdAt": "2020-02-27T16:53:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTIyMzY1NQ=="}], "type": "inlineReview"}]}