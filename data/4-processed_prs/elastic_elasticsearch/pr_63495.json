{"pr_number": 63495, "pr_title": "Enable collapse on unsigned_long field", "pr_createdAt": "2020-10-08T15:06:35Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/63495", "timeline": [{"oid": "0e2b4c423a489d70bdb6ccd40c7eec3966e396ec", "url": "https://github.com/elastic/elasticsearch/commit/0e2b4c423a489d70bdb6ccd40c7eec3966e396ec", "message": "Enabled collapse on unsigned_long field\n\nCollapse was not working on unsigned_long field,\nas collapsing was enabled only on KeywordFieldType and NumberFieldType.\n\nThis introduces a new method `collapseType` to MappedFieldType,\nthat is checked to decide if collapsing should be enabled.\n\nRelates to #60050", "committedDate": "2020-10-08T15:01:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDY1OTg0MQ==", "url": "https://github.com/elastic/elasticsearch/pull/63495#discussion_r504659841", "bodyText": "Should we keep adding the field name to the error message to make it more actionable? Maybe we also have the actual field type available here to add to the error?", "author": "cbuescher", "createdAt": "2020-10-14T13:05:19Z", "path": "server/src/main/java/org/elasticsearch/search/collapse/CollapseBuilder.java", "diffHunk": "@@ -203,12 +202,9 @@ public CollapseContext build(QueryShardContext queryShardContext) {\n         if (fieldType == null) {\n             throw new IllegalArgumentException(\"no mapping found for `\" + field + \"` in order to collapse on\");\n         }\n-        if (fieldType instanceof KeywordFieldMapper.KeywordFieldType == false &&\n-            fieldType instanceof NumberFieldMapper.NumberFieldType == false) {\n-            throw new IllegalArgumentException(\"unknown type for collapse field `\" + field +\n-                \"`, only keywords and numbers are accepted\");\n+        if (fieldType.collapseType() == CollapseType.NONE) {\n+            throw new IllegalArgumentException(\"collapse is not supported on this field type\");", "originalCommit": "0e2b4c423a489d70bdb6ccd40c7eec3966e396ec", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTgwMjc5Mg==", "url": "https://github.com/elastic/elasticsearch/pull/63495#discussion_r505802792", "bodyText": "@cbuescher Thanks for the feedback, addressed in 621992c", "author": "mayya-sharipova", "createdAt": "2020-10-15T19:56:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDY1OTg0MQ=="}], "type": "inlineReview"}, {"oid": "621992c7551fffdd6f4cf76eeabb055906d3eacc", "url": "https://github.com/elastic/elasticsearch/commit/621992c7551fffdd6f4cf76eeabb055906d3eacc", "message": "Change error message to include field name and type", "committedDate": "2020-10-15T19:38:51Z", "type": "commit"}, {"oid": "fcfe48edcd0189a84c1067aa097c9ba79e35b1c2", "url": "https://github.com/elastic/elasticsearch/commit/fcfe48edcd0189a84c1067aa097c9ba79e35b1c2", "message": "Merge remote-tracking branch 'upstream/master' into unsigned-long-make-collapsable", "committedDate": "2020-10-15T19:40:27Z", "type": "commit"}]}