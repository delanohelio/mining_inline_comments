{"pr_number": 64668, "pr_title": "[DOCS] Improve docs for Windows DOS/UNC paths in `path.*` settings", "pr_createdAt": "2020-11-05T19:14:50Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/64668", "timeline": [{"oid": "3f735ec9a513fbaf6c3f176ed8abe1af9f3e4c2c", "url": "https://github.com/elastic/elasticsearch/commit/3f735ec9a513fbaf6c3f176ed8abe1af9f3e4c2c", "message": "[DOCS] Note `path.repo` supports UNC paths in Windows only", "committedDate": "2020-11-05T19:13:35Z", "type": "commit"}, {"oid": "4549c4cee71d9bebf8042f9adf6cd46536e792a7", "url": "https://github.com/elastic/elasticsearch/commit/4549c4cee71d9bebf8042f9adf6cd46536e792a7", "message": "Address feedback", "committedDate": "2020-11-06T20:58:16Z", "type": "commit"}, {"oid": "1a77d1be66d0a292e254ff1f6ceee4f37206e10c", "url": "https://github.com/elastic/elasticsearch/commit/1a77d1be66d0a292e254ff1f6ceee4f37206e10c", "message": "Fixes + rewords", "committedDate": "2020-11-06T21:53:24Z", "type": "commit"}, {"oid": "51e27a9d7512e24d20315ad169789fa95acaba3d", "url": "https://github.com/elastic/elasticsearch/commit/51e27a9d7512e24d20315ad169789fa95acaba3d", "message": "Remove redundant content", "committedDate": "2020-11-06T22:13:22Z", "type": "commit"}, {"oid": "15a2757bd07d2784f5a73d2309b9ef89b7450a21", "url": "https://github.com/elastic/elasticsearch/commit/15a2757bd07d2784f5a73d2309b9ef89b7450a21", "message": "Re-add intro", "committedDate": "2020-11-06T22:14:49Z", "type": "commit"}, {"oid": "a01cb41841c25df4b32983d969e3f7c85b753fdc", "url": "https://github.com/elastic/elasticsearch/commit/a01cb41841c25df4b32983d969e3f7c85b753fdc", "message": "Add note for unix-style paths", "committedDate": "2020-11-06T22:26:26Z", "type": "commit"}, {"oid": "7cf36405e31c8a4b30a26912a20f69a6087f1b0c", "url": "https://github.com/elastic/elasticsearch/commit/7cf36405e31c8a4b30a26912a20f69a6087f1b0c", "message": "Add note for unix-style paths", "committedDate": "2020-11-06T22:27:55Z", "type": "commit"}, {"oid": "38e1e3626412bc464d0ac494578d6f8d7c8a58ac", "url": "https://github.com/elastic/elasticsearch/commit/38e1e3626412bc464d0ac494578d6f8d7c8a58ac", "message": "Add intro", "committedDate": "2020-11-06T22:28:56Z", "type": "commit"}, {"oid": "cbe9fe76a6040ab7be178ace9f332ff85d1a2fb7", "url": "https://github.com/elastic/elasticsearch/commit/cbe9fe76a6040ab7be178ace9f332ff85d1a2fb7", "message": "Reword", "committedDate": "2020-11-06T22:32:50Z", "type": "commit"}, {"oid": "cdcfd673222e7bc080279946e8da4b74f169e61c", "url": "https://github.com/elastic/elasticsearch/commit/cdcfd673222e7bc080279946e8da4b74f169e61c", "message": "Reword logging warning", "committedDate": "2020-11-06T22:45:54Z", "type": "commit"}, {"oid": "b04f8fdbf299620a7c8d7f8a3a812f5f30e2d9a5", "url": "https://github.com/elastic/elasticsearch/commit/b04f8fdbf299620a7c8d7f8a3a812f5f30e2d9a5", "message": "Improve multi data path examples", "committedDate": "2020-11-06T23:10:01Z", "type": "commit"}, {"oid": "cb8ea69c83a0555947f86980ea99022b6620322c", "url": "https://github.com/elastic/elasticsearch/commit/cb8ea69c83a0555947f86980ea99022b6620322c", "message": "On second thought, UNC paths in path.data is a bad idea.", "committedDate": "2020-11-07T23:25:48Z", "type": "commit"}, {"oid": "df0dc4288766b31d1c9116bf52bc721702b59541", "url": "https://github.com/elastic/elasticsearch/commit/df0dc4288766b31d1c9116bf52bc721702b59541", "message": "Rewords", "committedDate": "2020-11-07T23:29:15Z", "type": "commit"}, {"oid": "4efb2b07bb33c693a6cdeb1a5a1f1f243f0a28aa", "url": "https://github.com/elastic/elasticsearch/commit/4efb2b07bb33c693a6cdeb1a5a1f1f243f0a28aa", "message": "Reword", "committedDate": "2020-11-07T23:41:30Z", "type": "commit"}, {"oid": "bdad1a7c3421d878df1b5a07131aac791e99f85c", "url": "https://github.com/elastic/elasticsearch/commit/bdad1a7c3421d878df1b5a07131aac791e99f85c", "message": "Fix typo", "committedDate": "2020-11-07T23:44:04Z", "type": "commit"}, {"oid": "0af73cf0ca00cb96cc217890b9e81baa7b372ea8", "url": "https://github.com/elastic/elasticsearch/commit/0af73cf0ca00cb96cc217890b9e81baa7b372ea8", "message": "Remove unneeded words", "committedDate": "2020-11-08T00:09:18Z", "type": "commit"}, {"oid": "d0de12b8ecc4f871315011d2b22bb8d8679fcb3e", "url": "https://github.com/elastic/elasticsearch/commit/d0de12b8ecc4f871315011d2b22bb8d8679fcb3e", "message": "Reword", "committedDate": "2020-11-08T00:21:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTY1OTgxOA==", "url": "https://github.com/elastic/elasticsearch/pull/64668#discussion_r519659818", "bodyText": "Suggest combining these two examples, to avoid suggesting that all the paths must be either one or the other.", "author": "DaveCTurner", "createdAt": "2020-11-09T09:21:56Z", "path": "docs/reference/tab-widgets/register-fs-repo.asciidoc", "diffHunk": "@@ -0,0 +1,109 @@\n+// tag::unix[]\n+Linux and macOS installations support Unix-style paths:\n+\n+[source,yaml]\n+----\n+path:\n+  repo:\n+    - /mount/backups\n+    - /mount/long_term_backups\n+----\n+\n+After restarting each node, use the <<put-snapshot-repo-api,put snapshot\n+repository>> API to register the file system repository. Specify the file\n+system's path in `settings.location`:\n+\n+[source,console]\n+----\n+PUT /_snapshot/my_fs_backup\n+{\n+  \"type\": \"fs\",\n+  \"settings\": {\n+    \"location\": \"/mount/backups/my_fs_backup_location\",\n+    \"compress\": true\n+  }\n+}\n+----\n+// TEST[skip:no access to path]\n+\n+If you specify a relative path in `settings.location`, {es} resolves the path\n+using the first value in the `path.repo` setting.\n+\n+[source,console]\n+----\n+PUT /_snapshot/my_fs_backup\n+{\n+  \"type\": \"fs\",\n+  \"settings\": {\n+    \"location\": \"my_fs_backup_location\",       <1>\n+    \"compress\": true\n+  }\n+}\n+----\n+// TEST[skip:no access to path]\n+\n+<1> The first value in the `path.repo` setting is `/mount/backups`. This\n+relative path, `my_fs_backup_location`, resolves to\n+`/mount/backups/my_fs_backup_location`.\n+// end::unix[]\n+\n+\n+// tag::win[]\n+Windows installations support both DOS and Microsoft UNC paths. The following\n+example uses DOS paths with escaped backslashes:\n+\n+[source,yaml]\n+----\n+path:\n+  repo:\n+    - \"E:\\\\Mount\\\\Backups\"\n+    - \"F:\\\\Mount\\\\Long_term_backups\"\n+----\n+\n+For UNC paths, provide the server and share name as a prefix:", "originalCommit": "d0de12b8ecc4f871315011d2b22bb8d8679fcb3e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTgyMjUyNQ==", "url": "https://github.com/elastic/elasticsearch/pull/64668#discussion_r519822525", "bodyText": "Combined these with 02e169b.", "author": "jrodewig", "createdAt": "2020-11-09T13:42:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTY1OTgxOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTY2MDQ0Mg==", "url": "https://github.com/elastic/elasticsearch/pull/64668#discussion_r519660442", "bodyText": "Looks like we lost these settings in the move \ud83d\ude04", "author": "DaveCTurner", "createdAt": "2020-11-09T09:22:52Z", "path": "docs/reference/snapshot-restore/register-repository.asciidoc", "diffHunk": "@@ -100,71 +100,20 @@ are left untouched and in place.\n [[snapshots-filesystem-repository]]\n === Shared file system repository\n \n-The shared file system repository (`\"type\": \"fs\"`) uses the shared file system to store snapshots. In order to register\n-the shared file system repository it is necessary to mount the same shared filesystem to the same location on all\n-master and data nodes. This location (or one of its parent directories) must be registered in the `path.repo`\n-setting on all master and data nodes.\n+Use a shared file system repository (`\"type\": \"fs\"`) to store snapshots on a\n+shared file system.\n \n-Assuming that the shared filesystem is mounted to `/mount/backups/my_fs_backup_location`, the following setting should\n-be added to `elasticsearch.yml` file:\n+To register a shared file system repository, first mount the file system to the\n+same location on all master and data nodes. Then add the file system's\n+path or parent directory to the `path.repo` setting in `elasticsearch.yml` for\n+each master and data node. For running clusters, this requires a\n+<<restart-cluster-rolling,rolling restart>> of each node.\n \n-[source,yaml]\n---------------\n-path.repo: [\"/mount/backups\", \"/mount/longterm_backups\"]\n---------------\n-\n-The `path.repo` setting supports Microsoft Windows UNC paths as long as at least server name and share are specified as\n-a prefix and back slashes are properly escaped:\n-\n-[source,yaml]\n---------------\n-path.repo: [\"\\\\\\\\MY_SERVER\\\\Snapshots\"]\n---------------\n-\n-After all nodes are restarted, the following command can be used to register the shared file system repository with\n-the name `my_fs_backup`:\n-\n-[source,console]\n------------------------------------\n-PUT /_snapshot/my_fs_backup\n-{\n-  \"type\": \"fs\",\n-  \"settings\": {\n-    \"location\": \"/mount/backups/my_fs_backup_location\",\n-    \"compress\": true\n-  }\n-}\n------------------------------------\n-// TEST[skip:no access to absolute path]\n-\n-If the repository location is specified as a relative path this path will be resolved against the first path specified\n-in `path.repo`:\n+Supported `path.repo` values vary by platform:\n \n-[source,console]\n------------------------------------\n-PUT /_snapshot/my_fs_backup\n-{\n-  \"type\": \"fs\",\n-  \"settings\": {\n-    \"location\": \"my_fs_backup_location\",\n-    \"compress\": true\n-  }\n-}\n------------------------------------\n-// TEST[continued]\n+include::{es-repo-dir}/tab-widgets/code.asciidoc[]\n \n-The following settings are supported:", "originalCommit": "d0de12b8ecc4f871315011d2b22bb8d8679fcb3e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTgyMjgzMQ==", "url": "https://github.com/elastic/elasticsearch/pull/64668#discussion_r519822831", "bodyText": "Thanks for pointing this out. I intentionally removed these params as they're also documented in the API reference here: https://www.elastic.co/guide/en/elasticsearch/reference/master/put-snapshot-repo-api.html#put-snapshot-repo-api-request-body\nI can re-add if you'd prefer to have those docs in both places, but I figured a link to the API reference would suffice.", "author": "jrodewig", "createdAt": "2020-11-09T13:43:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTY2MDQ0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTg3NzI2OA==", "url": "https://github.com/elastic/elasticsearch/pull/64668#discussion_r519877268", "bodyText": "Ah, I missed that. Yes that's sufficient IMO. Bit tricky because some of these (e.g. max_restore_bytes_per_sec, max_number_of_snapshots) apply to all repository types, but that's out of the scope of this discussion.", "author": "DaveCTurner", "createdAt": "2020-11-09T14:59:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTY2MDQ0Mg=="}], "type": "inlineReview"}, {"oid": "02e169b751748025e01629d4c7fb0d3ba81523f2", "url": "https://github.com/elastic/elasticsearch/commit/02e169b751748025e01629d4c7fb0d3ba81523f2", "message": "Combine DOS/UNC example", "committedDate": "2020-11-09T13:42:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTgyNDc2Mg==", "url": "https://github.com/elastic/elasticsearch/pull/64668#discussion_r519824762", "bodyText": "This param is not documented in the API reference docs as we don't actually recommend setting it.", "author": "jrodewig", "createdAt": "2020-11-09T13:45:48Z", "path": "docs/reference/snapshot-restore/register-repository.asciidoc", "diffHunk": "@@ -100,71 +100,20 @@ are left untouched and in place.\n [[snapshots-filesystem-repository]]\n === Shared file system repository\n \n-The shared file system repository (`\"type\": \"fs\"`) uses the shared file system to store snapshots. In order to register\n-the shared file system repository it is necessary to mount the same shared filesystem to the same location on all\n-master and data nodes. This location (or one of its parent directories) must be registered in the `path.repo`\n-setting on all master and data nodes.\n+Use a shared file system repository (`\"type\": \"fs\"`) to store snapshots on a\n+shared file system.\n \n-Assuming that the shared filesystem is mounted to `/mount/backups/my_fs_backup_location`, the following setting should\n-be added to `elasticsearch.yml` file:\n+To register a shared file system repository, first mount the file system to the\n+same location on all master and data nodes. Then add the file system's\n+path or parent directory to the `path.repo` setting in `elasticsearch.yml` for\n+each master and data node. For running clusters, this requires a\n+<<restart-cluster-rolling,rolling restart>> of each node.\n \n-[source,yaml]\n---------------\n-path.repo: [\"/mount/backups\", \"/mount/longterm_backups\"]\n---------------\n-\n-The `path.repo` setting supports Microsoft Windows UNC paths as long as at least server name and share are specified as\n-a prefix and back slashes are properly escaped:\n-\n-[source,yaml]\n---------------\n-path.repo: [\"\\\\\\\\MY_SERVER\\\\Snapshots\"]\n---------------\n-\n-After all nodes are restarted, the following command can be used to register the shared file system repository with\n-the name `my_fs_backup`:\n-\n-[source,console]\n------------------------------------\n-PUT /_snapshot/my_fs_backup\n-{\n-  \"type\": \"fs\",\n-  \"settings\": {\n-    \"location\": \"/mount/backups/my_fs_backup_location\",\n-    \"compress\": true\n-  }\n-}\n------------------------------------\n-// TEST[skip:no access to absolute path]\n-\n-If the repository location is specified as a relative path this path will be resolved against the first path specified\n-in `path.repo`:\n+Supported `path.repo` values vary by platform:\n \n-[source,console]\n------------------------------------\n-PUT /_snapshot/my_fs_backup\n-{\n-  \"type\": \"fs\",\n-  \"settings\": {\n-    \"location\": \"my_fs_backup_location\",\n-    \"compress\": true\n-  }\n-}\n------------------------------------\n-// TEST[continued]\n+include::{es-repo-dir}/tab-widgets/code.asciidoc[]\n \n-The following settings are supported:\n-\n-`location`:: Location of the snapshots. Mandatory.\n-`compress`:: Turns on compression of the snapshot files. Compression is applied only to metadata files (index mapping and settings). Data files are not compressed. Defaults to `true`.\n-`chunk_size`:: Big files can be broken down into chunks during snapshotting if needed. Specify the chunk size as a value and\n-unit, for example: `1GB`, `10MB`, `5KB`, `500B`. Defaults to `null` (unlimited chunk size).\n-`max_restore_bytes_per_sec`:: Throttles per node restore rate. Defaults to unlimited. Note that restores are also throttled through <<recovery,recovery settings>>.\n-`max_snapshot_bytes_per_sec`:: Throttles per node snapshot rate. Defaults to `40mb` per second.\n-`readonly`:: Makes repository read-only.  Defaults to `false`.\n-`max_number_of_snapshots`:: Limits the maximum number of snapshots that the repository may contain. Defaults to `500`. Note that snapshot repositories do not\n-scale indefinitely in size and might lead to master node performance and stability issues if they grow past a certain size. We do not recommend increasing this setting.\n-Instead you should delete older snapshots or use multiple repositories.", "originalCommit": "02e169b751748025e01629d4c7fb0d3ba81523f2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTg3OTExMA==", "url": "https://github.com/elastic/elasticsearch/pull/64668#discussion_r519879110", "bodyText": "We should really document it anyway, although I don't think it's been backported to 7.x yet.", "author": "DaveCTurner", "createdAt": "2020-11-09T15:01:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTgyNDc2Mg=="}], "type": "inlineReview"}, {"oid": "1617ce86478bd9e5f7d3c731921837e587847e1d", "url": "https://github.com/elastic/elasticsearch/commit/1617ce86478bd9e5f7d3c731921837e587847e1d", "message": "Make path plural", "committedDate": "2020-11-09T13:47:06Z", "type": "commit"}]}