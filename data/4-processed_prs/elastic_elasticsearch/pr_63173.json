{"pr_number": 63173, "pr_title": "Checkout dir should be available as artifact from bwc projects", "pr_createdAt": "2020-10-02T11:44:19Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/63173", "timeline": [{"oid": "b60a478e448ae4658129e9e5a12c006ba1b2a7b5", "url": "https://github.com/elastic/elasticsearch/commit/b60a478e448ae4658129e9e5a12c006ba1b2a7b5", "message": "Checkout dir should be available as artifact from bwc projects", "committedDate": "2020-10-08T12:38:14Z", "type": "commit"}, {"oid": "b60a478e448ae4658129e9e5a12c006ba1b2a7b5", "url": "https://github.com/elastic/elasticsearch/commit/b60a478e448ae4658129e9e5a12c006ba1b2a7b5", "message": "Checkout dir should be available as artifact from bwc projects", "committedDate": "2020-10-08T12:38:14Z", "type": "forcePushed"}, {"oid": "1807ec0436d6a7faac86eb68f11f2eb256a97e37", "url": "https://github.com/elastic/elasticsearch/commit/1807ec0436d6a7faac86eb68f11f2eb256a97e37", "message": "Fix merge issue", "committedDate": "2020-10-08T13:33:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTcyNzYwOQ==", "url": "https://github.com/elastic/elasticsearch/pull/63173#discussion_r501727609", "bodyText": "@jakelandis this functional test basically shows an example on how to resolve the checkoutDir as artifact. you can declare a dependency in the es build by declaring\ndependencies {\n    myConfig project(path:':distribution:bwc:minor', configuration:'checkoutDir')\n}", "author": "breskeby", "createdAt": "2020-10-08T13:38:34Z", "path": "buildSrc/src/integTest/groovy/org/elasticsearch/gradle/internal/InternalBwcGitPluginFuncTest.groovy", "diffHunk": "@@ -19,33 +19,60 @@\n \n package org.elasticsearch.gradle.internal\n \n-import org.elasticsearch.gradle.fixtures.AbstractGradleFuncTest\n+import org.elasticsearch.gradle.fixtures.AbstractGitAwareGradleFuncTest\n import org.gradle.testkit.runner.TaskOutcome\n \n-class InternalBwcGitPluginFuncTest extends AbstractGradleFuncTest {\n+class InternalBwcGitPluginFuncTest extends AbstractGitAwareGradleFuncTest {\n \n     def setup() {\n-        setupLocalGitRepo()\n-    }\n-\n-    def \"current repository can be cloned\"() {\n-        given:\n-        internalBuild();\n+        internalBuild()\n         buildFile << \"\"\"\n             import org.elasticsearch.gradle.Version;\n             apply plugin: org.elasticsearch.gradle.internal.InternalBwcGitPlugin  \n             \n             bwcGitConfig {\n-                 bwcVersion = project.provider { Version.fromString(\"7.10.0\") }\n-                 bwcBranch = project.provider { \"7.x\" }\n+                 bwcVersion = project.provider { Version.fromString(\"8.1.0\") }\n+                 bwcBranch = project.provider { \"8.0\" }\n                  checkoutDir = project.provider{file(\"build/checkout\")}\n             }\n         \"\"\"\n+    }\n+\n+    def \"current repository can be cloned\"() {\n         when:\n         def result = gradleRunner(\"createClone\", '--stacktrace').build()\n         then:\n         result.task(\":createClone\").outcome == TaskOutcome.SUCCESS\n-        file(\"build/checkout/build.gradle\").exists()\n-        file(\"build/checkout/settings.gradle\").exists()\n+        file(\"cloned/build/checkout/build.gradle\").exists()\n+        file(\"cloned/build/checkout/settings.gradle\").exists()\n+    }\n+\n+    def \"can resolve checkout folder as project artifact\"() {", "originalCommit": "1807ec0436d6a7faac86eb68f11f2eb256a97e37", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}