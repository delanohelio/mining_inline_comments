{"pr_number": 65398, "pr_title": "[DOCS] Add rollup V2 API docs", "pr_createdAt": "2020-11-23T22:48:56Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/65398", "timeline": [{"oid": "8d433342ad7beb7b91787343a4bd953841a2fe3d", "url": "https://github.com/elastic/elasticsearch/commit/8d433342ad7beb7b91787343a4bd953841a2fe3d", "message": "[DOCS] Add rollup API docs\n\n* Documents new `<index>/_rollup` API\n* Updates rollup APIs overview page\n* Enables rollups V2 in docs integ tests", "committedDate": "2020-11-23T23:38:49Z", "type": "forcePushed"}, {"oid": "d1e11d6c5113dffcd4f41b209b874a8734574b4e", "url": "https://github.com/elastic/elasticsearch/commit/d1e11d6c5113dffcd4f41b209b874a8734574b4e", "message": "[DOCS] Add rollup API docs\n\n* Documents new `<index>/_rollup` API\n* Updates rollup APIs overview page\n* Enables rollups V2 in docs integ tests", "committedDate": "2020-11-24T13:23:55Z", "type": "commit"}, {"oid": "d1e11d6c5113dffcd4f41b209b874a8734574b4e", "url": "https://github.com/elastic/elasticsearch/commit/d1e11d6c5113dffcd4f41b209b874a8734574b4e", "message": "[DOCS] Add rollup API docs\n\n* Documents new `<index>/_rollup` API\n* Updates rollup APIs overview page\n* Enables rollups V2 in docs integ tests", "committedDate": "2020-11-24T13:23:55Z", "type": "forcePushed"}, {"oid": "ff8bdbf109ea96ad8c435bce1de3e516f32787f2", "url": "https://github.com/elastic/elasticsearch/commit/ff8bdbf109ea96ad8c435bce1de3e516f32787f2", "message": "Undo run.gradle changes", "committedDate": "2020-11-24T13:52:18Z", "type": "commit"}, {"oid": "ff8bdbf109ea96ad8c435bce1de3e516f32787f2", "url": "https://github.com/elastic/elasticsearch/commit/ff8bdbf109ea96ad8c435bce1de3e516f32787f2", "message": "Undo run.gradle changes", "committedDate": "2020-11-24T13:52:18Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTU2MjMyMg==", "url": "https://github.com/elastic/elasticsearch/pull/65398#discussion_r529562322", "bodyText": "delay is also a valid param for date_histogram but seems to be inert. Let me know if I should document it here.", "author": "jrodewig", "createdAt": "2020-11-24T13:55:29Z", "path": "docs/reference/rollup/apis/rollup-api.asciidoc", "diffHunk": "@@ -0,0 +1,191 @@\n+[role=\"xpack\"]\n+[testenv=\"basic\"]\n+[[rollup-api]]\n+=== Rollup API\n+++++\n+<titleabbrev>Rollup</titleabbrev>\n+++++\n+\n+Aggregates an index's time-series data and stores the results in another index.\n+For example, you can roll up hourly data into daily or weekly summaries.\n+\n+[source,console]\n+----\n+POST /my-index-000001/_rollup\n+{\n+  \"rollup_index\": \"my-rollup-index\",\n+  \"groups\": {\n+    \"date_histogram\": {\n+      \"field\": \"@timestamp\",\n+      \"calendar_interval\": \"1d\"\n+    },\n+    \"terms\": {\n+      \"fields\": [\n+        \"my-keyword-field\",\n+        \"my-other-keyword-field\"\n+      ]\n+    }\n+  },\n+  \"metrics\": [\n+    {\n+      \"field\": \"my-numeric-field\",\n+      \"metrics\": [\n+        \"min\",\n+        \"max\",\n+        \"avg\"\n+      ]\n+    }\n+  ]\n+}\n+----\n+// TEST[setup:my_index]\n+\n+[[rollup-api-request]]\n+==== {api-request-title}\n+\n+`PUT /<index>/_rollup`\n+\n+[[rollup-api-prereqs]]\n+==== {api-prereq-title}\n+\n+If the {es} {security-features} are enabled, you must have the `manage` cluster\n+privilege to use this API. See <<security-privileges>>.\n+\n+[[rollup-api-path-params]]\n+==== {api-path-parms-title}\n+\n+`<index>`::\n+(Required, string)\n+Index to roll up. Does not support <<multi-index,multi-target syntax>> or\n+wildcards (`*`).\n++\n+You can't use this argument to directly target a <<data-streams,data stream>> or\n+<<indices-aliases,index alias>>. However, you can target their backing or\n+concrete indices.\n+\n+\n+[role=\"child_attributes\"]\n+[[rollup-api-request-body]]\n+==== {api-request-body-title}\n+\n+`rollup_index`::\n+(Required, index)\n+Index that stores the rollup results. Cannot be a <<data-streams,data stream>>\n+or <<indices-aliases,index alias>>.\n++\n+If this index does not exist, the request creates it. If the `<index>` is a\n+backing index for a data stream, this new index is a backing index of the same\n+stream.\n+\n+`groups`::\n+(Required, object)\n+Aggregates and stores fields in the rollup.\n++\n+.Properties of `groups`\n+[%collapsible%open]\n+====\n+`date_histogram`::\n+(Required,\n+<<search-aggregations-bucket-datehistogram-aggregation,`date_histogram`\n+aggregation>> object)\n+Groups documents in the original `<index>` based on a provided time interval.\n++\n+.Properties of `date_histogram`\n+[%collapsible%open]\n+=====\n+`field`::\n+(Required, string)\n+<<date,`date`>> or <<date_nanos,`date_nanos`>> field containing the `<index>`'s\n+timestamp. If you're rolling up a backing index or using the {ecs-ref}[Elastic\n+Common Schema (ECS)], we recommend using `@timestamp`.\n+\n+`calendar_interval` or `fixed_interval`::\n+(Required, <<time-units,time units>>)\n+Time interval used to group documents. For differences between\n+`calendar_interval` and `fixed_interval`, see <<calendar_and_fixed_intervals>>.\n++\n+TIP: Choose this value carefully. You won't be able to use a smaller interval\n+later. For example, you can't aggregate daily rollups into hourly\n+summaries. However, smaller time intervals can greatly increase the size of your\n+`rollup_index`.\n+\n+`time_zone`::\n+(Optional, string)\n+Time zone for the `field`. Valid values are ISO 8601 UTC offsets, such as\n+`+01:00` or `-08:00`, and IANA time zone IDs, such as `America/Los_Angeles`.\n+Defaults to `+00:00` (UTC).\n+=====", "originalCommit": "ff8bdbf109ea96ad8c435bce1de3e516f32787f2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTg5OTIyNw==", "url": "https://github.com/elastic/elasticsearch/pull/65398#discussion_r529899227", "bodyText": "This is one of those WIP leaks. the config is being re-used, but you're right, the delay option is not intended to be used in this action, so it should not be mentioned", "author": "talevy", "createdAt": "2020-11-24T21:47:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTU2MjMyMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTU2MjM4NQ==", "url": "https://github.com/elastic/elasticsearch/pull/65398#discussion_r529562385", "bodyText": "The manage_rollup privilege doesn't seem to have any effect on this API. Let me know if we plan to phase it out or only use it for legacy rollups. I'll update the privileges docs in another PR.", "author": "jrodewig", "createdAt": "2020-11-24T13:55:32Z", "path": "docs/reference/rollup/apis/rollup-api.asciidoc", "diffHunk": "@@ -0,0 +1,191 @@\n+[role=\"xpack\"]\n+[testenv=\"basic\"]\n+[[rollup-api]]\n+=== Rollup API\n+++++\n+<titleabbrev>Rollup</titleabbrev>\n+++++\n+\n+Aggregates an index's time-series data and stores the results in another index.\n+For example, you can roll up hourly data into daily or weekly summaries.\n+\n+[source,console]\n+----\n+POST /my-index-000001/_rollup\n+{\n+  \"rollup_index\": \"my-rollup-index\",\n+  \"groups\": {\n+    \"date_histogram\": {\n+      \"field\": \"@timestamp\",\n+      \"calendar_interval\": \"1d\"\n+    },\n+    \"terms\": {\n+      \"fields\": [\n+        \"my-keyword-field\",\n+        \"my-other-keyword-field\"\n+      ]\n+    }\n+  },\n+  \"metrics\": [\n+    {\n+      \"field\": \"my-numeric-field\",\n+      \"metrics\": [\n+        \"min\",\n+        \"max\",\n+        \"avg\"\n+      ]\n+    }\n+  ]\n+}\n+----\n+// TEST[setup:my_index]\n+\n+[[rollup-api-request]]\n+==== {api-request-title}\n+\n+`PUT /<index>/_rollup`\n+\n+[[rollup-api-prereqs]]\n+==== {api-prereq-title}\n+\n+If the {es} {security-features} are enabled, you must have the `manage` cluster\n+privilege to use this API. See <<security-privileges>>.", "originalCommit": "ff8bdbf109ea96ad8c435bce1de3e516f32787f2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTg5ODIwNQ==", "url": "https://github.com/elastic/elasticsearch/pull/65398#discussion_r529898205", "bodyText": "I think you found a bug :)", "author": "talevy", "createdAt": "2020-11-24T21:46:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTU2MjM4NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTkwMjAzNw==", "url": "https://github.com/elastic/elasticsearch/pull/65398#discussion_r529902037", "bodyText": "I'll open up an issue for that. Thanks, Tal!", "author": "jrodewig", "createdAt": "2020-11-24T21:50:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTU2MjM4NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTkxODY0NQ==", "url": "https://github.com/elastic/elasticsearch/pull/65398#discussion_r529918645", "bodyText": "opened #65469. should fix this", "author": "talevy", "createdAt": "2020-11-24T22:06:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTU2MjM4NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTkxOTgxNQ==", "url": "https://github.com/elastic/elasticsearch/pull/65398#discussion_r529919815", "bodyText": "Awesome! Saved me a step. Thanks.", "author": "jrodewig", "createdAt": "2020-11-24T22:07:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTU2MjM4NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTU2NjYyMQ==", "url": "https://github.com/elastic/elasticsearch/pull/65398#discussion_r529566621", "bodyText": "Prior to {es} 7.x, you could only create a rollup using a periodic cron jobs.\n\nI'll update with the actual release version once we're closer to that.", "author": "jrodewig", "createdAt": "2020-11-24T14:01:25Z", "path": "docs/reference/rollup/rollup-apis.asciidoc", "diffHunk": "@@ -0,0 +1,88 @@\n+[role=\"xpack\"]\n+[testenv=\"basic\"]\n+[[rollup-apis]]\n+== Rollup APIs\n+\n+ifdef::permanently-unreleased-branch[]\n+\n+A rollup aggregates an index's time-series data and stores the results in\n+another index, called a rollup index. For example, you can aggregate hourly data\n+into daily or weekly summaries.\n+\n+* <<rollup-api,Rollup API>>\n+\n+[discrete]\n+[[legacy-rollup-apis]]\n+=== Legacy rollup APIs\n+\n+Prior to {es} 7.x, you could only create a rollup using a periodic cron jobs.", "originalCommit": "ff8bdbf109ea96ad8c435bce1de3e516f32787f2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e81ff574cc802f45e13e9821ce07fbb70cbdbba4", "url": "https://github.com/elastic/elasticsearch/commit/e81ff574cc802f45e13e9821ce07fbb70cbdbba4", "message": "Consistent wording", "committedDate": "2020-11-24T15:17:41Z", "type": "commit"}, {"oid": "f8b4c24bda374ce8d7a7024f916d57cd931fb4f2", "url": "https://github.com/elastic/elasticsearch/commit/f8b4c24bda374ce8d7a7024f916d57cd931fb4f2", "message": "Reword", "committedDate": "2020-11-24T18:18:26Z", "type": "commit"}, {"oid": "8da43743bff262a6e4a8baf295374b9346115187", "url": "https://github.com/elastic/elasticsearch/commit/8da43743bff262a6e4a8baf295374b9346115187", "message": "Reword", "committedDate": "2020-11-24T18:19:07Z", "type": "commit"}, {"oid": "1c7360fad7866c3ca62f123bb541beca412234ee", "url": "https://github.com/elastic/elasticsearch/commit/1c7360fad7866c3ca62f123bb541beca412234ee", "message": "Fix whitespace", "committedDate": "2020-11-24T18:19:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTg5Nzk0OQ==", "url": "https://github.com/elastic/elasticsearch/pull/65398#discussion_r529897949", "bodyText": "now that I am seeing this, I may have to change how I've done this in my PRs.\nI feel it is safe to always set the system property in test clusters. I'll change all of them at a later point", "author": "talevy", "createdAt": "2020-11-24T21:45:35Z", "path": "docs/build.gradle", "diffHunk": "@@ -52,6 +52,9 @@ testClusters.integTest {\n   if (singleNode().testDistribution == DEFAULT) {\n     setting 'xpack.license.self_generated.type', 'trial'\n     setting 'indices.lifecycle.history_index_enabled', 'false'\n+    if (BuildParams.isSnapshotBuild() == true) {", "originalCommit": "1c7360fad7866c3ca62f123bb541beca412234ee", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTkwMDE0Nw==", "url": "https://github.com/elastic/elasticsearch/pull/65398#discussion_r529900147", "bodyText": "drop the \"a\"?", "author": "talevy", "createdAt": "2020-11-24T21:49:16Z", "path": "docs/reference/rollup/rollup-apis.asciidoc", "diffHunk": "@@ -0,0 +1,88 @@\n+[role=\"xpack\"]\n+[testenv=\"basic\"]\n+[[rollup-apis]]\n+== Rollup APIs\n+\n+ifdef::permanently-unreleased-branch[]\n+\n+A rollup aggregates an index's time-series data and stores the results in\n+another index, called a rollup index. For example, you can roll up hourly data\n+into daily or weekly summaries.\n+\n+* <<rollup-api,Rollup API>>\n+\n+[discrete]\n+[[legacy-rollup-apis]]\n+=== Legacy rollup APIs\n+\n+Prior to {es} 7.x, you could only create a rollup using a periodic cron jobs.", "originalCommit": "1c7360fad7866c3ca62f123bb541beca412234ee", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTkwMTYxNg==", "url": "https://github.com/elastic/elasticsearch/pull/65398#discussion_r529901616", "bodyText": "Good catch! Thanks!", "author": "jrodewig", "createdAt": "2020-11-24T21:50:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTkwMDE0Nw=="}], "type": "inlineReview"}, {"oid": "a233013a70284be4271fa35ca4e1e577bf7fe96e", "url": "https://github.com/elastic/elasticsearch/commit/a233013a70284be4271fa35ca4e1e577bf7fe96e", "message": "Fix typo", "committedDate": "2020-11-24T21:52:18Z", "type": "commit"}, {"oid": "c5b4d4c1e0f3503e03d6ab389af22d4e079fd425", "url": "https://github.com/elastic/elasticsearch/commit/c5b4d4c1e0f3503e03d6ab389af22d4e079fd425", "message": "Fix typos", "committedDate": "2020-11-24T23:05:36Z", "type": "commit"}]}