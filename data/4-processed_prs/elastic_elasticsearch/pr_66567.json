{"pr_number": 66567, "pr_title": "Update heap setting documentation in light of machine dependent heap", "pr_createdAt": "2020-12-17T22:19:14Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/66567", "timeline": [{"oid": "11a76404d1282d01e62116a1b5a5337945df70f6", "url": "https://github.com/elastic/elasticsearch/commit/11a76404d1282d01e62116a1b5a5337945df70f6", "message": "Update heap setting documentation in light of machine dependent heap", "committedDate": "2020-12-17T22:16:45Z", "type": "commit"}, {"oid": "50dd4da7499d2a96fc5e357e7cf088e57232bc8d", "url": "https://github.com/elastic/elasticsearch/commit/50dd4da7499d2a96fc5e357e7cf088e57232bc8d", "message": "Move advanced settings page", "committedDate": "2020-12-17T22:40:35Z", "type": "commit"}, {"oid": "dae25a763c4f7da9398c09e1062be969df4cf44b", "url": "https://github.com/elastic/elasticsearch/commit/dae25a763c4f7da9398c09e1062be969df4cf44b", "message": "Formatting", "committedDate": "2020-12-17T23:20:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTg2NDY0OQ==", "url": "https://github.com/elastic/elasticsearch/pull/66567#discussion_r545864649", "bodyText": "Tried to streamline this a bit to avoid auto-determine and future tense. Sizing seems like more common terminology.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            By default, {es} will auto-determine the appropriate heap size based on total system memory,\n          \n          \n            \n            and the set of roles assigned to the node. It is generally recommended that heap size determination\n          \n          \n            \n            be deferred to {es}. Should you have unique requirements that necessitate setting JVM heap size\n          \n          \n            \n            manually, refer to <<setting-jvm-heap-size,setting JVM heap size>> for additional guidance.\n          \n          \n            \n            By default, {es} automatically sizes JVM heap based on a node's\n          \n          \n            \n            <<node-roles,roles>> and total memory. We recommend this default sizing for most\n          \n          \n            \n            production environments. If needed, you can override default sizing by manually\n          \n          \n            \n            <<setting-jvm-heap-size,setting JVM heap size>>.\n          \n      \n    \n    \n  \n\nWe say \"total memory\" here, but we refer to \"physical RAM\" in the manual config section. Are these the same? If so, we may want to pick one term and use throughout.", "author": "jrodewig", "createdAt": "2020-12-18T14:28:16Z", "path": "docs/reference/setup/important-settings/heap-size.asciidoc", "diffHunk": "@@ -2,86 +2,10 @@\n [discrete]\n === Heap size settings\n \n-By default, {es} tells the JVM to use a heap with a minimum and maximum\n-size of 1 GB. When moving to production, it is important to configure heap size\n-to ensure that {es} has enough heap available.\n+By default, {es} will auto-determine the appropriate heap size based on total system memory,\n+and the set of roles assigned to the node. It is generally recommended that heap size determination\n+be deferred to {es}. Should you have unique requirements that necessitate setting JVM heap size\n+manually, refer to <<setting-jvm-heap-size,setting JVM heap size>> for additional guidance.", "originalCommit": "dae25a763c4f7da9398c09e1062be969df4cf44b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjAzMTk4OQ==", "url": "https://github.com/elastic/elasticsearch/pull/66567#discussion_r546031989", "bodyText": "These are \"generally\" the same. I've standardized on \"total system memory\" here and also added a note clairfying what this means in a containerized deployment.", "author": "mark-vieira", "createdAt": "2020-12-18T19:02:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTg2NDY0OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTg2Njg5Ng==", "url": "https://github.com/elastic/elasticsearch/pull/66567#discussion_r545866896", "bodyText": "Small suggestion to remove auto-determination.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            NOTE: Heap auto-determination requires the use of the <<jvm-version,bundled JDK>> or, if using\n          \n          \n            \n            NOTE: Automatic heap sizing requires the <<jvm-version,bundled JDK>> or, if using", "author": "jrodewig", "createdAt": "2020-12-18T14:31:47Z", "path": "docs/reference/setup/important-settings/heap-size.asciidoc", "diffHunk": "@@ -2,86 +2,10 @@\n [discrete]\n === Heap size settings\n \n-By default, {es} tells the JVM to use a heap with a minimum and maximum\n-size of 1 GB. When moving to production, it is important to configure heap size\n-to ensure that {es} has enough heap available.\n+By default, {es} will auto-determine the appropriate heap size based on total system memory,\n+and the set of roles assigned to the node. It is generally recommended that heap size determination\n+be deferred to {es}. Should you have unique requirements that necessitate setting JVM heap size\n+manually, refer to <<setting-jvm-heap-size,setting JVM heap size>> for additional guidance.\n \n-{es} will assign the entire heap specified in\n-<<jvm-options,jvm.options>> via the `Xms` (minimum heap size) and `Xmx` (maximum\n-heap size) settings. These two settings must be equal to each other.\n-\n-The value for these settings depends on the amount of RAM available on your\n-server:\n-\n-* Set `Xmx` and `Xms` to no more than 50% of your physical RAM. {es} requires\n-  memory for purposes other than the JVM heap and it is important to leave\n-  space for this. For instance, {es} uses off-heap buffers for efficient\n-  network communication, relies on the operating system's filesystem cache for\n-  efficient access to files, and the JVM itself requires some memory too. It is\n-  normal to observe the {es} process using more memory than the limit\n-  configured with the `Xmx` setting.\n-\n-* Set `Xmx` and `Xms` to no more than the threshold that the JVM uses for\n-  compressed object pointers (compressed oops). The exact threshold varies but\n-  is near 32 GB. You can verify that you are under the threshold by looking for a line in the logs like the following:\n-+\n-[source,txt]\n-----\n-heap size [1.9gb], compressed ordinary object pointers [true]\n-----\n-\n-* Set `Xmx` and `Xms` to no more than the threshold for zero-based\n-  compressed oops. The exact threshold varies but 26 GB is safe on most\n-  systems and can be as large as 30 GB on some systems. You can verify that\n-  you are under this threshold by starting {es} with the JVM options\n-  `-XX:+UnlockDiagnosticVMOptions -XX:+PrintCompressedOopsMode` and looking for\n-  a line like the following:\n-+\n-[source,txt]\n-----\n-heap address: 0x000000011be00000, size: 27648 MB, zero based Compressed Oops\n-----\n-+\n-This line shows that zero-based compressed oops are enabled. If zero-based\n-compressed oops are not enabled, you'll see a line like the following instead:\n-+\n-[source,txt]\n-----\n-heap address: 0x0000000118400000, size: 28672 MB, Compressed Oops with base: 0x00000001183ff000\n-----\n-\n-The more heap available to {es}, the more memory it can use for its internal\n-caches, but the less memory it leaves available for the operating system to use\n-for the filesystem cache. Also, larger heaps can cause longer garbage\n-collection pauses.\n-\n-Here is an example of how to set the heap size via a `jvm.options.d/` file:\n-\n-[source,txt]\n-------------------\n--Xms2g <1>\n--Xmx2g <2>\n-------------------\n-<1> Set the minimum heap size to 2g.\n-<2> Set the maximum heap size to 2g.\n-\n-Using `jvm.options.d` is the preferred method for configuring the heap size for\n-production deployments.\n-\n-It is also possible to set the heap size via the `ES_JAVA_OPTS` environment\n-variable. This is generally discouraged for production deployments but is useful\n-for testing because it overrides all other means of setting JVM options.\n-\n-[source,sh]\n-------------------\n-ES_JAVA_OPTS=\"-Xms2g -Xmx2g\" ./bin/elasticsearch <1>\n-ES_JAVA_OPTS=\"-Xms4000m -Xmx4000m\" ./bin/elasticsearch <2>\n-------------------\n-<1> Set the minimum and maximum heap size to 2 GB.\n-<2> Set the minimum and maximum heap size to 4000 MB.\n-\n-NOTE: Configuring the heap for the <<windows-service,Windows service>> is\n-different than the above. The values initially populated for the Windows\n-service can be configured as above but are different after the service has been\n-installed. Consult the <<windows-service,Windows service documentation>> for\n-additional details.\n+NOTE: Heap auto-determination requires the use of the <<jvm-version,bundled JDK>> or, if using", "originalCommit": "dae25a763c4f7da9398c09e1062be969df4cf44b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTg3MDY0OQ==", "url": "https://github.com/elastic/elasticsearch/pull/66567#discussion_r545870649", "bodyText": "You may want to add a couple brief sentences before the heap size heading. I'd just note:\n\nWe recommend using default settings in most production use cases\nThese settings are for experts only.\n\nIf someone lands on this page from Google, they should see \"There be dragons here.\"", "author": "jrodewig", "createdAt": "2020-12-18T14:38:01Z", "path": "docs/reference/setup/advanced-configuration.asciidoc", "diffHunk": "@@ -0,0 +1,89 @@\n+[[advanced-configuration]]\n+=== Advanced configuration settings\n+", "originalCommit": "dae25a763c4f7da9398c09e1062be969df4cf44b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjAzMjA1MA==", "url": "https://github.com/elastic/elasticsearch/pull/66567#discussion_r546032050", "bodyText": "I've added some language here.", "author": "mark-vieira", "createdAt": "2020-12-18T19:02:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTg3MDY0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjAzMjI2Ng==", "url": "https://github.com/elastic/elasticsearch/pull/66567#discussion_r546032266", "bodyText": "New copy looks great to me! Thanks!", "author": "jrodewig", "createdAt": "2020-12-18T19:03:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTg3MDY0OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTg3Mjk2NA==", "url": "https://github.com/elastic/elasticsearch/pull/66567#discussion_r545872964", "bodyText": "I don't think the second sentence is needed. It's already clear that you're overriding default settings.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Should you need to override the default <<heap-size-settings,heap size settings>>, you should consider\n          \n          \n            \n            the below recommendations. If any heap JVM options are provided those will be given\n          \n          \n            \n            preference over the default values provided by {es}.\n          \n          \n            \n            If you need to override the default <<heap-size-settings,heap size settings>>,\n          \n          \n            \n            follow the best practices below.", "author": "jrodewig", "createdAt": "2020-12-18T14:41:50Z", "path": "docs/reference/setup/advanced-configuration.asciidoc", "diffHunk": "@@ -0,0 +1,89 @@\n+[[advanced-configuration]]\n+=== Advanced configuration settings\n+\n+[[setting-jvm-heap-size]]\n+==== Setting JVM heap size\n+\n+Should you need to override the default <<heap-size-settings,heap size settings>>, you should consider\n+the below recommendations. If any heap JVM options are provided those will be given\n+preference over the default values provided by {es}.", "originalCommit": "dae25a763c4f7da9398c09e1062be969df4cf44b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTg3MzQxNg==", "url": "https://github.com/elastic/elasticsearch/pull/66567#discussion_r545873416", "bodyText": "Nit: Avoid future tense.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            {es} will assign the entire heap specified in\n          \n          \n            \n            <<jvm-options,jvm.options>> via the `Xms` (minimum heap size) and `Xmx` (maximum\n          \n          \n            \n            heap size) settings. These two settings must be equal to each other.\n          \n          \n            \n            {es} assigns the entire heap specified in\n          \n          \n            \n            <<jvm-options,jvm.options>> via the `Xms` (minimum heap size) and `Xmx` (maximum\n          \n          \n            \n            heap size) settings. These two settings must be equal to each other.", "author": "jrodewig", "createdAt": "2020-12-18T14:42:37Z", "path": "docs/reference/setup/advanced-configuration.asciidoc", "diffHunk": "@@ -0,0 +1,89 @@\n+[[advanced-configuration]]\n+=== Advanced configuration settings\n+\n+[[setting-jvm-heap-size]]\n+==== Setting JVM heap size\n+\n+Should you need to override the default <<heap-size-settings,heap size settings>>, you should consider\n+the below recommendations. If any heap JVM options are provided those will be given\n+preference over the default values provided by {es}.\n+\n+{es} will assign the entire heap specified in\n+<<jvm-options,jvm.options>> via the `Xms` (minimum heap size) and `Xmx` (maximum\n+heap size) settings. These two settings must be equal to each other.", "originalCommit": "dae25a763c4f7da9398c09e1062be969df4cf44b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTg3Mzc1Ng==", "url": "https://github.com/elastic/elasticsearch/pull/66567#discussion_r545873756", "bodyText": "Should we swap \"RAM\" for \"total memory\" and \"server\" for \"node\" here for consistency?", "author": "jrodewig", "createdAt": "2020-12-18T14:43:11Z", "path": "docs/reference/setup/advanced-configuration.asciidoc", "diffHunk": "@@ -0,0 +1,89 @@\n+[[advanced-configuration]]\n+=== Advanced configuration settings\n+\n+[[setting-jvm-heap-size]]\n+==== Setting JVM heap size\n+\n+Should you need to override the default <<heap-size-settings,heap size settings>>, you should consider\n+the below recommendations. If any heap JVM options are provided those will be given\n+preference over the default values provided by {es}.\n+\n+{es} will assign the entire heap specified in\n+<<jvm-options,jvm.options>> via the `Xms` (minimum heap size) and `Xmx` (maximum\n+heap size) settings. These two settings must be equal to each other.\n+\n+The value for these settings depends on the amount of RAM available on your\n+server:", "originalCommit": "dae25a763c4f7da9398c09e1062be969df4cf44b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTg3NzI3Nw==", "url": "https://github.com/elastic/elasticsearch/pull/66567#discussion_r545877277", "bodyText": "I don't think the sentence containing examples is needed. And repeat the above question about physical RAM.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            * Set `Xmx` and `Xms` to no more than 50% of your physical RAM. {es} requires\n          \n          \n            \n            memory for purposes other than the JVM heap and it is important to leave\n          \n          \n            \n            space for this. For instance, {es} uses off-heap buffers for efficient\n          \n          \n            \n            network communication, relies on the operating system's filesystem cache for\n          \n          \n            \n            efficient access to files, and the JVM itself requires some memory too. It is\n          \n          \n            \n            normal to observe the {es} process using more memory than the limit\n          \n          \n            \n            configured with the `Xmx` setting.\n          \n          \n            \n            * Set `Xmx` and `Xms` to no more than 50% of your physical RAM. {es} requires\n          \n          \n            \n            memory for purposes other than the JVM heap. It is normal to observe the {es}\n          \n          \n            \n            process using more memory than the limit configured with the `Xmx` setting.", "author": "jrodewig", "createdAt": "2020-12-18T14:46:45Z", "path": "docs/reference/setup/advanced-configuration.asciidoc", "diffHunk": "@@ -0,0 +1,89 @@\n+[[advanced-configuration]]\n+=== Advanced configuration settings\n+\n+[[setting-jvm-heap-size]]\n+==== Setting JVM heap size\n+\n+Should you need to override the default <<heap-size-settings,heap size settings>>, you should consider\n+the below recommendations. If any heap JVM options are provided those will be given\n+preference over the default values provided by {es}.\n+\n+{es} will assign the entire heap specified in\n+<<jvm-options,jvm.options>> via the `Xms` (minimum heap size) and `Xmx` (maximum\n+heap size) settings. These two settings must be equal to each other.\n+\n+The value for these settings depends on the amount of RAM available on your\n+server:\n+\n+* Set `Xmx` and `Xms` to no more than 50% of your physical RAM. {es} requires\n+memory for purposes other than the JVM heap and it is important to leave\n+space for this. For instance, {es} uses off-heap buffers for efficient\n+network communication, relies on the operating system's filesystem cache for\n+efficient access to files, and the JVM itself requires some memory too. It is\n+normal to observe the {es} process using more memory than the limit\n+configured with the `Xmx` setting.", "originalCommit": "dae25a763c4f7da9398c09e1062be969df4cf44b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTg4Mzg3Mw==", "url": "https://github.com/elastic/elasticsearch/pull/66567#discussion_r545883873", "bodyText": "Based on our shard sizing guide, this threshold may also be 50% of available node memory if that's lower than 32GB:\n\nTo use compressed pointers and save memory, we recommend each node have a maximum heap size of 32GB or 50% of the node\u2019s available memory, whichever is lower.\n\nWith our new defaults, we may want to remove that section from the shard sizing page though. That section also contains an xref to the heap size settings. We probably want to remove that too.", "author": "jrodewig", "createdAt": "2020-12-18T14:53:11Z", "path": "docs/reference/setup/advanced-configuration.asciidoc", "diffHunk": "@@ -0,0 +1,89 @@\n+[[advanced-configuration]]\n+=== Advanced configuration settings\n+\n+[[setting-jvm-heap-size]]\n+==== Setting JVM heap size\n+\n+Should you need to override the default <<heap-size-settings,heap size settings>>, you should consider\n+the below recommendations. If any heap JVM options are provided those will be given\n+preference over the default values provided by {es}.\n+\n+{es} will assign the entire heap specified in\n+<<jvm-options,jvm.options>> via the `Xms` (minimum heap size) and `Xmx` (maximum\n+heap size) settings. These two settings must be equal to each other.\n+\n+The value for these settings depends on the amount of RAM available on your\n+server:\n+\n+* Set `Xmx` and `Xms` to no more than 50% of your physical RAM. {es} requires\n+memory for purposes other than the JVM heap and it is important to leave\n+space for this. For instance, {es} uses off-heap buffers for efficient\n+network communication, relies on the operating system's filesystem cache for\n+efficient access to files, and the JVM itself requires some memory too. It is\n+normal to observe the {es} process using more memory than the limit\n+configured with the `Xmx` setting.\n+\n+* Set `Xmx` and `Xms` to no more than the threshold that the JVM uses for\n+compressed object pointers (compressed oops). The exact threshold varies but\n+is near 32 GB. You can verify that you are under the threshold by looking for a line in the logs like the following:\n++\n+[source,txt]\n+----\n+heap size [1.9gb], compressed ordinary object pointers [true]\n+----", "originalCommit": "dae25a763c4f7da9398c09e1062be969df4cf44b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTg4NjU0MA==", "url": "https://github.com/elastic/elasticsearch/pull/66567#discussion_r545886540", "bodyText": "Style nit\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            is near 32 GB. You can verify that you are under the threshold by looking for a line in the logs like the following:\n          \n          \n            \n            is near 32GB. You can verify that you are under the threshold by looking for a line in the logs like the following:", "author": "jrodewig", "createdAt": "2020-12-18T14:55:32Z", "path": "docs/reference/setup/advanced-configuration.asciidoc", "diffHunk": "@@ -0,0 +1,89 @@\n+[[advanced-configuration]]\n+=== Advanced configuration settings\n+\n+[[setting-jvm-heap-size]]\n+==== Setting JVM heap size\n+\n+Should you need to override the default <<heap-size-settings,heap size settings>>, you should consider\n+the below recommendations. If any heap JVM options are provided those will be given\n+preference over the default values provided by {es}.\n+\n+{es} will assign the entire heap specified in\n+<<jvm-options,jvm.options>> via the `Xms` (minimum heap size) and `Xmx` (maximum\n+heap size) settings. These two settings must be equal to each other.\n+\n+The value for these settings depends on the amount of RAM available on your\n+server:\n+\n+* Set `Xmx` and `Xms` to no more than 50% of your physical RAM. {es} requires\n+memory for purposes other than the JVM heap and it is important to leave\n+space for this. For instance, {es} uses off-heap buffers for efficient\n+network communication, relies on the operating system's filesystem cache for\n+efficient access to files, and the JVM itself requires some memory too. It is\n+normal to observe the {es} process using more memory than the limit\n+configured with the `Xmx` setting.\n+\n+* Set `Xmx` and `Xms` to no more than the threshold that the JVM uses for\n+compressed object pointers (compressed oops). The exact threshold varies but\n+is near 32 GB. You can verify that you are under the threshold by looking for a line in the logs like the following:", "originalCommit": "dae25a763c4f7da9398c09e1062be969df4cf44b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTg4NzQ1OQ==", "url": "https://github.com/elastic/elasticsearch/pull/66567#discussion_r545887459", "bodyText": "Style nits\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            compressed oops. The exact threshold varies but 26 GB is safe on most\n          \n          \n            \n            systems and can be as large as 30 GB on some systems. You can verify that\n          \n          \n            \n            compressed oops. The exact threshold varies but 26GB is safe on most\n          \n          \n            \n            systems and can be as large as 30GB on some systems. You can verify that", "author": "jrodewig", "createdAt": "2020-12-18T14:56:28Z", "path": "docs/reference/setup/advanced-configuration.asciidoc", "diffHunk": "@@ -0,0 +1,89 @@\n+[[advanced-configuration]]\n+=== Advanced configuration settings\n+\n+[[setting-jvm-heap-size]]\n+==== Setting JVM heap size\n+\n+Should you need to override the default <<heap-size-settings,heap size settings>>, you should consider\n+the below recommendations. If any heap JVM options are provided those will be given\n+preference over the default values provided by {es}.\n+\n+{es} will assign the entire heap specified in\n+<<jvm-options,jvm.options>> via the `Xms` (minimum heap size) and `Xmx` (maximum\n+heap size) settings. These two settings must be equal to each other.\n+\n+The value for these settings depends on the amount of RAM available on your\n+server:\n+\n+* Set `Xmx` and `Xms` to no more than 50% of your physical RAM. {es} requires\n+memory for purposes other than the JVM heap and it is important to leave\n+space for this. For instance, {es} uses off-heap buffers for efficient\n+network communication, relies on the operating system's filesystem cache for\n+efficient access to files, and the JVM itself requires some memory too. It is\n+normal to observe the {es} process using more memory than the limit\n+configured with the `Xmx` setting.\n+\n+* Set `Xmx` and `Xms` to no more than the threshold that the JVM uses for\n+compressed object pointers (compressed oops). The exact threshold varies but\n+is near 32 GB. You can verify that you are under the threshold by looking for a line in the logs like the following:\n++\n+[source,txt]\n+----\n+heap size [1.9gb], compressed ordinary object pointers [true]\n+----\n+\n+* Set `Xmx` and `Xms` to no more than the threshold for zero-based\n+compressed oops. The exact threshold varies but 26 GB is safe on most\n+systems and can be as large as 30 GB on some systems. You can verify that", "originalCommit": "dae25a763c4f7da9398c09e1062be969df4cf44b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTg4ODI0MA==", "url": "https://github.com/elastic/elasticsearch/pull/66567#discussion_r545888240", "bodyText": "Minor style nits.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            The more heap available to {es}, the more memory it can use for its internal\n          \n          \n            \n            caches, but the less memory it leaves available for the operating system to use\n          \n          \n            \n            for the filesystem cache. Also, larger heaps can cause longer garbage\n          \n          \n            \n            collection pauses.\n          \n          \n            \n            The more heap available to {es}, the more memory it can use for its internal\n          \n          \n            \n            caches. This leaves less memory for the operating system to use\n          \n          \n            \n            for the filesystem cache. Larger heaps can also cause longer garbage\n          \n          \n            \n            collection pauses.", "author": "jrodewig", "createdAt": "2020-12-18T14:57:40Z", "path": "docs/reference/setup/advanced-configuration.asciidoc", "diffHunk": "@@ -0,0 +1,89 @@\n+[[advanced-configuration]]\n+=== Advanced configuration settings\n+\n+[[setting-jvm-heap-size]]\n+==== Setting JVM heap size\n+\n+Should you need to override the default <<heap-size-settings,heap size settings>>, you should consider\n+the below recommendations. If any heap JVM options are provided those will be given\n+preference over the default values provided by {es}.\n+\n+{es} will assign the entire heap specified in\n+<<jvm-options,jvm.options>> via the `Xms` (minimum heap size) and `Xmx` (maximum\n+heap size) settings. These two settings must be equal to each other.\n+\n+The value for these settings depends on the amount of RAM available on your\n+server:\n+\n+* Set `Xmx` and `Xms` to no more than 50% of your physical RAM. {es} requires\n+memory for purposes other than the JVM heap and it is important to leave\n+space for this. For instance, {es} uses off-heap buffers for efficient\n+network communication, relies on the operating system's filesystem cache for\n+efficient access to files, and the JVM itself requires some memory too. It is\n+normal to observe the {es} process using more memory than the limit\n+configured with the `Xmx` setting.\n+\n+* Set `Xmx` and `Xms` to no more than the threshold that the JVM uses for\n+compressed object pointers (compressed oops). The exact threshold varies but\n+is near 32 GB. You can verify that you are under the threshold by looking for a line in the logs like the following:\n++\n+[source,txt]\n+----\n+heap size [1.9gb], compressed ordinary object pointers [true]\n+----\n+\n+* Set `Xmx` and `Xms` to no more than the threshold for zero-based\n+compressed oops. The exact threshold varies but 26 GB is safe on most\n+systems and can be as large as 30 GB on some systems. You can verify that\n+you are under this threshold by starting {es} with the JVM options\n+`-XX:+UnlockDiagnosticVMOptions -XX:+PrintCompressedOopsMode` and looking for\n+a line like the following:\n++\n+[source,txt]\n+----\n+heap address: 0x000000011be00000, size: 27648 MB, zero based Compressed Oops\n+----\n++\n+This line shows that zero-based compressed oops are enabled. If zero-based\n+compressed oops are not enabled, you'll see a line like the following instead:\n++\n+[source,txt]\n+----\n+heap address: 0x0000000118400000, size: 28672 MB, Compressed Oops with base: 0x00000001183ff000\n+----\n+\n+The more heap available to {es}, the more memory it can use for its internal\n+caches, but the less memory it leaves available for the operating system to use\n+for the filesystem cache. Also, larger heaps can cause longer garbage\n+collection pauses.", "originalCommit": "dae25a763c4f7da9398c09e1062be969df4cf44b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTg5MDc4NA==", "url": "https://github.com/elastic/elasticsearch/pull/66567#discussion_r545890784", "bodyText": "Tried to streamline this a bit:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Using `jvm.options.d` is the preferred method for configuring the heap size for\n          \n          \n            \n            production deployments.\n          \n          \n            \n            In production, we recommend using `jvm.options.d` to configure heap sizes.", "author": "jrodewig", "createdAt": "2020-12-18T15:00:16Z", "path": "docs/reference/setup/advanced-configuration.asciidoc", "diffHunk": "@@ -0,0 +1,89 @@\n+[[advanced-configuration]]\n+=== Advanced configuration settings\n+\n+[[setting-jvm-heap-size]]\n+==== Setting JVM heap size\n+\n+Should you need to override the default <<heap-size-settings,heap size settings>>, you should consider\n+the below recommendations. If any heap JVM options are provided those will be given\n+preference over the default values provided by {es}.\n+\n+{es} will assign the entire heap specified in\n+<<jvm-options,jvm.options>> via the `Xms` (minimum heap size) and `Xmx` (maximum\n+heap size) settings. These two settings must be equal to each other.\n+\n+The value for these settings depends on the amount of RAM available on your\n+server:\n+\n+* Set `Xmx` and `Xms` to no more than 50% of your physical RAM. {es} requires\n+memory for purposes other than the JVM heap and it is important to leave\n+space for this. For instance, {es} uses off-heap buffers for efficient\n+network communication, relies on the operating system's filesystem cache for\n+efficient access to files, and the JVM itself requires some memory too. It is\n+normal to observe the {es} process using more memory than the limit\n+configured with the `Xmx` setting.\n+\n+* Set `Xmx` and `Xms` to no more than the threshold that the JVM uses for\n+compressed object pointers (compressed oops). The exact threshold varies but\n+is near 32 GB. You can verify that you are under the threshold by looking for a line in the logs like the following:\n++\n+[source,txt]\n+----\n+heap size [1.9gb], compressed ordinary object pointers [true]\n+----\n+\n+* Set `Xmx` and `Xms` to no more than the threshold for zero-based\n+compressed oops. The exact threshold varies but 26 GB is safe on most\n+systems and can be as large as 30 GB on some systems. You can verify that\n+you are under this threshold by starting {es} with the JVM options\n+`-XX:+UnlockDiagnosticVMOptions -XX:+PrintCompressedOopsMode` and looking for\n+a line like the following:\n++\n+[source,txt]\n+----\n+heap address: 0x000000011be00000, size: 27648 MB, zero based Compressed Oops\n+----\n++\n+This line shows that zero-based compressed oops are enabled. If zero-based\n+compressed oops are not enabled, you'll see a line like the following instead:\n++\n+[source,txt]\n+----\n+heap address: 0x0000000118400000, size: 28672 MB, Compressed Oops with base: 0x00000001183ff000\n+----\n+\n+The more heap available to {es}, the more memory it can use for its internal\n+caches, but the less memory it leaves available for the operating system to use\n+for the filesystem cache. Also, larger heaps can cause longer garbage\n+collection pauses.\n+\n+Here is an example of how to set the heap size via a `jvm.options.d/` file:\n+\n+[source,txt]\n+------------------\n+-Xms2g <1>\n+-Xmx2g <2>\n+------------------\n+<1> Set the minimum heap size to 2g.\n+<2> Set the maximum heap size to 2g.\n+\n+Using `jvm.options.d` is the preferred method for configuring the heap size for\n+production deployments.", "originalCommit": "dae25a763c4f7da9398c09e1062be969df4cf44b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTg5MzQ3MA==", "url": "https://github.com/elastic/elasticsearch/pull/66567#discussion_r545893470", "bodyText": "Tried to streamline this. I'd combine with the previous para.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            It is also possible to set the heap size via the `ES_JAVA_OPTS` environment\n          \n          \n            \n            variable. This is generally discouraged for production deployments but is useful\n          \n          \n            \n            for testing because it overrides all other means of setting JVM options.\n          \n          \n            \n            For testing, you can also set the heap sizes using the `ES_JAVA_OPTS`\n          \n          \n            \n            environment variable. The `ES_JAVA_OPTS` variable overrides all other JVM\n          \n          \n            \n            options. We do not recommend using `ES_JAVA_OPTS` in production.", "author": "jrodewig", "createdAt": "2020-12-18T15:03:13Z", "path": "docs/reference/setup/advanced-configuration.asciidoc", "diffHunk": "@@ -0,0 +1,89 @@\n+[[advanced-configuration]]\n+=== Advanced configuration settings\n+\n+[[setting-jvm-heap-size]]\n+==== Setting JVM heap size\n+\n+Should you need to override the default <<heap-size-settings,heap size settings>>, you should consider\n+the below recommendations. If any heap JVM options are provided those will be given\n+preference over the default values provided by {es}.\n+\n+{es} will assign the entire heap specified in\n+<<jvm-options,jvm.options>> via the `Xms` (minimum heap size) and `Xmx` (maximum\n+heap size) settings. These two settings must be equal to each other.\n+\n+The value for these settings depends on the amount of RAM available on your\n+server:\n+\n+* Set `Xmx` and `Xms` to no more than 50% of your physical RAM. {es} requires\n+memory for purposes other than the JVM heap and it is important to leave\n+space for this. For instance, {es} uses off-heap buffers for efficient\n+network communication, relies on the operating system's filesystem cache for\n+efficient access to files, and the JVM itself requires some memory too. It is\n+normal to observe the {es} process using more memory than the limit\n+configured with the `Xmx` setting.\n+\n+* Set `Xmx` and `Xms` to no more than the threshold that the JVM uses for\n+compressed object pointers (compressed oops). The exact threshold varies but\n+is near 32 GB. You can verify that you are under the threshold by looking for a line in the logs like the following:\n++\n+[source,txt]\n+----\n+heap size [1.9gb], compressed ordinary object pointers [true]\n+----\n+\n+* Set `Xmx` and `Xms` to no more than the threshold for zero-based\n+compressed oops. The exact threshold varies but 26 GB is safe on most\n+systems and can be as large as 30 GB on some systems. You can verify that\n+you are under this threshold by starting {es} with the JVM options\n+`-XX:+UnlockDiagnosticVMOptions -XX:+PrintCompressedOopsMode` and looking for\n+a line like the following:\n++\n+[source,txt]\n+----\n+heap address: 0x000000011be00000, size: 27648 MB, zero based Compressed Oops\n+----\n++\n+This line shows that zero-based compressed oops are enabled. If zero-based\n+compressed oops are not enabled, you'll see a line like the following instead:\n++\n+[source,txt]\n+----\n+heap address: 0x0000000118400000, size: 28672 MB, Compressed Oops with base: 0x00000001183ff000\n+----\n+\n+The more heap available to {es}, the more memory it can use for its internal\n+caches, but the less memory it leaves available for the operating system to use\n+for the filesystem cache. Also, larger heaps can cause longer garbage\n+collection pauses.\n+\n+Here is an example of how to set the heap size via a `jvm.options.d/` file:\n+\n+[source,txt]\n+------------------\n+-Xms2g <1>\n+-Xmx2g <2>\n+------------------\n+<1> Set the minimum heap size to 2g.\n+<2> Set the maximum heap size to 2g.\n+\n+Using `jvm.options.d` is the preferred method for configuring the heap size for\n+production deployments.\n+\n+It is also possible to set the heap size via the `ES_JAVA_OPTS` environment\n+variable. This is generally discouraged for production deployments but is useful\n+for testing because it overrides all other means of setting JVM options.", "originalCommit": "dae25a763c4f7da9398c09e1062be969df4cf44b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTg5Mzk3NQ==", "url": "https://github.com/elastic/elasticsearch/pull/66567#discussion_r545893975", "bodyText": "Simplified the xref a little.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            installed. Consult the <<windows-service,Windows service documentation>> for\n          \n          \n            \n            additional details.\n          \n          \n            \n            installed. See <<windows-service>>.", "author": "jrodewig", "createdAt": "2020-12-18T15:04:06Z", "path": "docs/reference/setup/advanced-configuration.asciidoc", "diffHunk": "@@ -0,0 +1,89 @@\n+[[advanced-configuration]]\n+=== Advanced configuration settings\n+\n+[[setting-jvm-heap-size]]\n+==== Setting JVM heap size\n+\n+Should you need to override the default <<heap-size-settings,heap size settings>>, you should consider\n+the below recommendations. If any heap JVM options are provided those will be given\n+preference over the default values provided by {es}.\n+\n+{es} will assign the entire heap specified in\n+<<jvm-options,jvm.options>> via the `Xms` (minimum heap size) and `Xmx` (maximum\n+heap size) settings. These two settings must be equal to each other.\n+\n+The value for these settings depends on the amount of RAM available on your\n+server:\n+\n+* Set `Xmx` and `Xms` to no more than 50% of your physical RAM. {es} requires\n+memory for purposes other than the JVM heap and it is important to leave\n+space for this. For instance, {es} uses off-heap buffers for efficient\n+network communication, relies on the operating system's filesystem cache for\n+efficient access to files, and the JVM itself requires some memory too. It is\n+normal to observe the {es} process using more memory than the limit\n+configured with the `Xmx` setting.\n+\n+* Set `Xmx` and `Xms` to no more than the threshold that the JVM uses for\n+compressed object pointers (compressed oops). The exact threshold varies but\n+is near 32 GB. You can verify that you are under the threshold by looking for a line in the logs like the following:\n++\n+[source,txt]\n+----\n+heap size [1.9gb], compressed ordinary object pointers [true]\n+----\n+\n+* Set `Xmx` and `Xms` to no more than the threshold for zero-based\n+compressed oops. The exact threshold varies but 26 GB is safe on most\n+systems and can be as large as 30 GB on some systems. You can verify that\n+you are under this threshold by starting {es} with the JVM options\n+`-XX:+UnlockDiagnosticVMOptions -XX:+PrintCompressedOopsMode` and looking for\n+a line like the following:\n++\n+[source,txt]\n+----\n+heap address: 0x000000011be00000, size: 27648 MB, zero based Compressed Oops\n+----\n++\n+This line shows that zero-based compressed oops are enabled. If zero-based\n+compressed oops are not enabled, you'll see a line like the following instead:\n++\n+[source,txt]\n+----\n+heap address: 0x0000000118400000, size: 28672 MB, Compressed Oops with base: 0x00000001183ff000\n+----\n+\n+The more heap available to {es}, the more memory it can use for its internal\n+caches, but the less memory it leaves available for the operating system to use\n+for the filesystem cache. Also, larger heaps can cause longer garbage\n+collection pauses.\n+\n+Here is an example of how to set the heap size via a `jvm.options.d/` file:\n+\n+[source,txt]\n+------------------\n+-Xms2g <1>\n+-Xmx2g <2>\n+------------------\n+<1> Set the minimum heap size to 2g.\n+<2> Set the maximum heap size to 2g.\n+\n+Using `jvm.options.d` is the preferred method for configuring the heap size for\n+production deployments.\n+\n+It is also possible to set the heap size via the `ES_JAVA_OPTS` environment\n+variable. This is generally discouraged for production deployments but is useful\n+for testing because it overrides all other means of setting JVM options.\n+\n+[source,sh]\n+------------------\n+ES_JAVA_OPTS=\"-Xms2g -Xmx2g\" ./bin/elasticsearch <1>\n+ES_JAVA_OPTS=\"-Xms4000m -Xmx4000m\" ./bin/elasticsearch <2>\n+------------------\n+<1> Set the minimum and maximum heap size to 2 GB.\n+<2> Set the minimum and maximum heap size to 4000 MB.\n+\n+NOTE: Configuring the heap for the <<windows-service,Windows service>> is\n+different than the above. The values initially populated for the Windows\n+service can be configured as above but are different after the service has been\n+installed. Consult the <<windows-service,Windows service documentation>> for\n+additional details.", "originalCommit": "dae25a763c4f7da9398c09e1062be969df4cf44b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "2aed1b03730972e7c12132d9b615d7c6362a8b51", "url": "https://github.com/elastic/elasticsearch/commit/2aed1b03730972e7c12132d9b615d7c6362a8b51", "message": "Update docs/reference/setup/important-settings/heap-size.asciidoc\n\nCo-authored-by: James Rodewig <40268737+jrodewig@users.noreply.github.com>", "committedDate": "2020-12-18T18:53:35Z", "type": "commit"}, {"oid": "58868ddc0dbea5b2043883badd5ce23e4c20b80f", "url": "https://github.com/elastic/elasticsearch/commit/58868ddc0dbea5b2043883badd5ce23e4c20b80f", "message": "Update docs/reference/setup/important-settings/heap-size.asciidoc\n\nCo-authored-by: James Rodewig <40268737+jrodewig@users.noreply.github.com>", "committedDate": "2020-12-18T18:53:50Z", "type": "commit"}, {"oid": "258fb757404c326b608d8ca592eca82aa050827d", "url": "https://github.com/elastic/elasticsearch/commit/258fb757404c326b608d8ca592eca82aa050827d", "message": "Update docs/reference/setup/advanced-configuration.asciidoc\n\nCo-authored-by: James Rodewig <40268737+jrodewig@users.noreply.github.com>", "committedDate": "2020-12-18T18:54:11Z", "type": "commit"}, {"oid": "81ffe987e9fa554abe0ea843ed6b9014d083892c", "url": "https://github.com/elastic/elasticsearch/commit/81ffe987e9fa554abe0ea843ed6b9014d083892c", "message": "Update docs/reference/setup/advanced-configuration.asciidoc\n\nCo-authored-by: James Rodewig <40268737+jrodewig@users.noreply.github.com>", "committedDate": "2020-12-18T18:54:20Z", "type": "commit"}, {"oid": "0d2e65f487eb33b0a8ecddd86db86f15032cc5bb", "url": "https://github.com/elastic/elasticsearch/commit/0d2e65f487eb33b0a8ecddd86db86f15032cc5bb", "message": "Update docs/reference/setup/advanced-configuration.asciidoc\n\nCo-authored-by: James Rodewig <40268737+jrodewig@users.noreply.github.com>", "committedDate": "2020-12-18T18:54:32Z", "type": "commit"}, {"oid": "9407ccb3dc44bcce86e4d58a04b62e12682ed238", "url": "https://github.com/elastic/elasticsearch/commit/9407ccb3dc44bcce86e4d58a04b62e12682ed238", "message": "Update docs/reference/setup/advanced-configuration.asciidoc\n\nCo-authored-by: James Rodewig <40268737+jrodewig@users.noreply.github.com>", "committedDate": "2020-12-18T18:54:41Z", "type": "commit"}, {"oid": "c57a415d51f540aab86c497aeade628afc4df6f4", "url": "https://github.com/elastic/elasticsearch/commit/c57a415d51f540aab86c497aeade628afc4df6f4", "message": "Update docs/reference/setup/advanced-configuration.asciidoc\n\nCo-authored-by: James Rodewig <40268737+jrodewig@users.noreply.github.com>", "committedDate": "2020-12-18T18:54:53Z", "type": "commit"}, {"oid": "fa5772162282a1f62d040449c287298a7eda2f87", "url": "https://github.com/elastic/elasticsearch/commit/fa5772162282a1f62d040449c287298a7eda2f87", "message": "Update docs/reference/setup/advanced-configuration.asciidoc\n\nCo-authored-by: James Rodewig <40268737+jrodewig@users.noreply.github.com>", "committedDate": "2020-12-18T18:55:03Z", "type": "commit"}, {"oid": "d0c658ae95b0d2313d31f2ef04c7a266c7341a5a", "url": "https://github.com/elastic/elasticsearch/commit/d0c658ae95b0d2313d31f2ef04c7a266c7341a5a", "message": "Update docs/reference/setup/advanced-configuration.asciidoc\n\nCo-authored-by: James Rodewig <40268737+jrodewig@users.noreply.github.com>", "committedDate": "2020-12-18T18:55:09Z", "type": "commit"}, {"oid": "573bb2c42c127e58ec944903e6e8b76f1c9a0c9e", "url": "https://github.com/elastic/elasticsearch/commit/573bb2c42c127e58ec944903e6e8b76f1c9a0c9e", "message": "More minor tweaks", "committedDate": "2020-12-18T19:02:01Z", "type": "commit"}]}