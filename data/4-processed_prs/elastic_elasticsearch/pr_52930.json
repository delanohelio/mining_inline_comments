{"pr_number": 52930, "pr_title": "Deprecate undocumented alternatives to the nodes hot threads API (#52640)", "pr_createdAt": "2020-02-27T22:35:47Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/52930", "timeline": [{"oid": "5cecfc30d8c47a8ba620ffb4da523a42038aaf03", "url": "https://github.com/elastic/elasticsearch/commit/5cecfc30d8c47a8ba620ffb4da523a42038aaf03", "message": "Merge pull request #1 from elastic/master\n\nUpdate forked repository", "committedDate": "2020-02-27T20:40:37Z", "type": "commit"}, {"oid": "8c144dfd6f03da253c21bd45ae63f1fe756fb937", "url": "https://github.com/elastic/elasticsearch/commit/8c144dfd6f03da253c21bd45ae63f1fe756fb937", "message": "Deprecate undocumented alternatives to the nodes hot threads API", "committedDate": "2020-02-27T22:19:08Z", "type": "commit"}, {"oid": "3ce731cb475a6cbad837099bf8dcfb2a0fe9ccd3", "url": "https://github.com/elastic/elasticsearch/commit/3ce731cb475a6cbad837099bf8dcfb2a0fe9ccd3", "message": "Remove unused array of strings", "committedDate": "2020-02-27T22:20:32Z", "type": "commit"}, {"oid": "78f23e1ba889006f18712e4dc1ec1f4977f0dd0e", "url": "https://github.com/elastic/elasticsearch/commit/78f23e1ba889006f18712e4dc1ec1f4977f0dd0e", "message": "Modify the nodeId in the tests", "committedDate": "2020-02-27T22:34:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTQyMzgyNw==", "url": "https://github.com/elastic/elasticsearch/pull/52930#discussion_r385423827", "bodyText": "This complexity isn't necessary. You can override the deprecatedRoutes method.", "author": "jasontedor", "createdAt": "2020-02-27T23:09:57Z", "path": "server/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestNodesHotThreadsAction.java", "diffHunk": "@@ -60,6 +67,12 @@ public String getName() {\n \n     @Override\n     public RestChannelConsumer prepareRequest(final RestRequest request, final NodeClient client) throws IOException {\n+        if (request.rawPath().equals(\"/_cluster/nodes/hotthreads\") ", "originalCommit": "78f23e1ba889006f18712e4dc1ec1f4977f0dd0e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc4MjMyMQ==", "url": "https://github.com/elastic/elasticsearch/pull/52930#discussion_r385782321", "bodyText": "I see. Thanks!", "author": "muachilin", "createdAt": "2020-02-28T16:08:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTQyMzgyNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjU5Nzk3OQ==", "url": "https://github.com/elastic/elasticsearch/pull/52930#discussion_r386597979", "bodyText": "I have modified this part. Thanks!", "author": "muachilin", "createdAt": "2020-03-02T19:21:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTQyMzgyNw=="}], "type": "inlineReview"}, {"oid": "317e1d0d1e71645fad8fb9b32b0f632b6c08b752", "url": "https://github.com/elastic/elasticsearch/commit/317e1d0d1e71645fad8fb9b32b0f632b6c08b752", "message": "[feat] Override deprecatedRoutes", "committedDate": "2020-02-28T16:05:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjY1Njg0MQ==", "url": "https://github.com/elastic/elasticsearch/pull/52930#discussion_r386656841", "bodyText": "This shouldn't be needed as the REST infrastructure will handle for you when a deprecated path is invoked. Did you find some reason that you needed to add this?", "author": "jasontedor", "createdAt": "2020-03-02T21:20:31Z", "path": "server/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestNodesHotThreadsAction.java", "diffHunk": "@@ -60,6 +82,11 @@ public String getName() {\n \n     @Override\n     public RestChannelConsumer prepareRequest(final RestRequest request, final NodeClient client) throws IOException {\n+        List<String> deprecatedRoutesPath = deprecatedRoutes().stream().map(DeprecatedRoute::getPath).collect(Collectors.toList());\n+        int getDeprecatedRoutesPathIndex = deprecatedRoutesPath.indexOf(request.rawPath());", "originalCommit": "317e1d0d1e71645fad8fb9b32b0f632b6c08b752", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjY1OTEwMw==", "url": "https://github.com/elastic/elasticsearch/pull/52930#discussion_r386659103", "bodyText": "Because I want to set different warning message for each deprecated route.", "author": "muachilin", "createdAt": "2020-03-02T21:24:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjY1Njg0MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjY2MDAwMg==", "url": "https://github.com/elastic/elasticsearch/pull/52930#discussion_r386660002", "bodyText": "Besides, I want to call deprecationLogger to assert warnings when users use the deprecated path. Maybe I misinterpret something here...", "author": "muachilin", "createdAt": "2020-03-02T21:26:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjY1Njg0MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjY3Nzc1Ng==", "url": "https://github.com/elastic/elasticsearch/pull/52930#discussion_r386677756", "bodyText": "The REST infrastructure will do this for you, that's what you're passing to the DeprecatedRoute constructor.", "author": "jasontedor", "createdAt": "2020-03-02T22:02:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjY1Njg0MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjY5OTU4MQ==", "url": "https://github.com/elastic/elasticsearch/pull/52930#discussion_r386699581", "bodyText": "Oh I see. My main purpose of adding those lines is that I want to test them. If I delete those two lines, I cannot invoke deprecationLogger.deprecated to assert warnings.", "author": "muachilin", "createdAt": "2020-03-02T22:51:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjY1Njg0MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjcwMTA1MQ==", "url": "https://github.com/elastic/elasticsearch/pull/52930#discussion_r386701051", "bodyText": "If there is no deprecationLogger.deprecated in prepareRequest method, I cannot test if the given request contains the deprecated path, whether it will assert correct warning messages in RestNodesHotThreadsActionTests.java", "author": "muachilin", "createdAt": "2020-03-02T22:55:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjY1Njg0MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjcwMTc2Ng==", "url": "https://github.com/elastic/elasticsearch/pull/52930#discussion_r386701766", "bodyText": "I am quite confused about how to get rid of these two lines while maintaining the tests in RestNodesHotThreadsActionTests.java", "author": "muachilin", "createdAt": "2020-03-02T22:56:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjY1Njg0MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjczNjIwNg==", "url": "https://github.com/elastic/elasticsearch/pull/52930#discussion_r386736206", "bodyText": "I don\u2019t think the tests are important because it\u2019s basically testing the REST infrastructure which is tested elsewhere.", "author": "jasontedor", "createdAt": "2020-03-03T00:39:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjY1Njg0MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjgyMjQyNw==", "url": "https://github.com/elastic/elasticsearch/pull/52930#discussion_r386822427", "bodyText": "I added these tests in RestNodesHotThreadsActionTests.java because in issue #52640, @DaveCTurner mentioned the need for adding tests for warnings. Maybe I need to add the kind of tests that @DaveCTurner mentioned in other places?", "author": "muachilin", "createdAt": "2020-03-03T06:34:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjY1Njg0MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzAxMTMxMQ==", "url": "https://github.com/elastic/elasticsearch/pull/52930#discussion_r387011311", "bodyText": "Okay. You can add REST tests in rest-api-spec.", "author": "jasontedor", "createdAt": "2020-03-03T13:17:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjY1Njg0MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzcxNjk2Mw==", "url": "https://github.com/elastic/elasticsearch/pull/52930#discussion_r387716963", "bodyText": "Is there any reason that it is better for me to add tests by writing yml files instead of adding tests in RestNodesHotThreadsActionTests.java? @DaveCTurner mentioned the PR #50499 so I create tests in RestNodesHotThreadsActionTests.java. In that PR, the author create tests in server/src/main/java/org/elasticsearch/rest/action/cat/RestNodesAction.java. I am just wondering how I can write appropriate tests. Thanks!", "author": "muachilin", "createdAt": "2020-03-04T14:52:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjY1Njg0MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzcxOTg2OQ==", "url": "https://github.com/elastic/elasticsearch/pull/52930#discussion_r387719869", "bodyText": "I think the REST tests are more appropriate since this is about testing the deprecation of endpoints on the REST layer. One difference between the implementation here and in RestNodesAction as in the PR that you reference is that the deprecation is handled in different layers. Here, it's handled in the REST layer, there it's handled in the actual processing of the request (below the REST layer). That makes testing a little easier there. Here, you would have to wire up an entire REST layer (RestController) to get similar kind of coverage.\nYet, I still think that the REST tests are the best place to test REST layer changes.", "author": "jasontedor", "createdAt": "2020-03-04T14:57:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjY1Njg0MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTU1ODIwNw==", "url": "https://github.com/elastic/elasticsearch/pull/52930#discussion_r389558207", "bodyText": "I found that adding tests in rest-api-spec is kind of complicated to catch the warning corresponding to different paths. So I removed all the tests! Thanks!", "author": "muachilin", "createdAt": "2020-03-09T09:56:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjY1Njg0MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjY3NzkwMg==", "url": "https://github.com/elastic/elasticsearch/pull/52930#discussion_r386677902", "bodyText": "I think we should deprecate this endpoint as well, in favor of /_nodes/hot_threads.", "author": "jasontedor", "createdAt": "2020-03-02T22:02:48Z", "path": "server/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestNodesHotThreadsAction.java", "diffHunk": "@@ -34,22 +36,42 @@\n \n import java.io.IOException;\n import java.util.List;\n+import java.util.stream.Collectors;\n \n import static org.elasticsearch.rest.RestRequest.Method.GET;\n \n-\n public class RestNodesHotThreadsAction extends BaseRestHandler {\n \n+    private static final DeprecationLogger deprecationLogger = new DeprecationLogger(\n+        LogManager.getLogger(RestNodesHotThreadsAction.class));\n+    static final String DEPRECATED_MESSAGE_CLUSTER_NODES_HOTTHREADS = \"[/_cluster/nodes/hotthreads] is a deprecated endpoint. \" \n+        + \"Please use [/_cluster/nodes/hot_threads] instead.\";\n+    static final String DEPRECATED_MESSAGE_CLUSTER_NODES_NODEID_HOTTHREADS = \"[/_cluster/nodes/{nodeId}/hotthreads] is a deprecated endpoint. \"\n+        + \"Please use [/_cluster/nodes/{nodeId}/hot_threads] instead.\";\n+    static final String DEPRECATED_MESSAGE_NODES_HOTTHREADS = \"[/_nodes/hotthreads] is a deprecated endpoint. \"\n+        + \"Please use [/_nodes/hot_threads] instead.\";\n+    static final String DEPRECATED_MESSAGE_NODES_NODEID_HOTTHREADS = \"[/_nodes/{nodeId}/hotthreads] is a deprecated endpoint. \"\n+        + \"Please use [/_nodes/{nodeId}/hot_threads] instead.\";\n+\n+    @Override\n+    public List<DeprecatedRoute> deprecatedRoutes() {\n+        return List.of(\n+            new DeprecatedRoute(GET, \"/_cluster/nodes/hotthreads\",\n+                    DEPRECATED_MESSAGE_CLUSTER_NODES_HOTTHREADS),\n+            new DeprecatedRoute(GET, \"/_cluster/nodes/{nodeId}/hotthreads\",\n+                    DEPRECATED_MESSAGE_CLUSTER_NODES_NODEID_HOTTHREADS),\n+            new DeprecatedRoute(GET, \"/_nodes/hotthreads\",\n+                    DEPRECATED_MESSAGE_NODES_HOTTHREADS),\n+            new DeprecatedRoute(GET, \"/_nodes/{nodeId}/hotthreads\",\n+                    DEPRECATED_MESSAGE_NODES_NODEID_HOTTHREADS));\n+    }        \n+\n     @Override\n     public List<Route> routes() {\n         return List.of(\n-            new Route(GET, \"/_cluster/nodes/hotthreads\"),\n             new Route(GET, \"/_cluster/nodes/hot_threads\"),", "originalCommit": "317e1d0d1e71645fad8fb9b32b0f632b6c08b752", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjY3OTk2NQ==", "url": "https://github.com/elastic/elasticsearch/pull/52930#discussion_r386679965", "bodyText": "You mean /_cluster/nodes/hot_threads?", "author": "muachilin", "createdAt": "2020-03-02T22:07:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjY3NzkwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjY4MDc5Nw==", "url": "https://github.com/elastic/elasticsearch/pull/52930#discussion_r386680797", "bodyText": "To be clear, I left a comment on the line\n            new Route(GET, \"/_cluster/nodes/hot_threads\"),\n\nsaying that we should deprecate this, in favor of /_nodes/hot_threads. There's no need to keep around two endpoints that do the same thing. And /_cluster/nodes is odd when we use the /_nodes namespace for things that we want to invoke/collect at the node level.", "author": "jasontedor", "createdAt": "2020-03-02T22:08:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjY3NzkwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjY5NDMyMw==", "url": "https://github.com/elastic/elasticsearch/pull/52930#discussion_r386694323", "bodyText": "Thanks for your explanation!", "author": "muachilin", "createdAt": "2020-03-02T22:38:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjY3NzkwMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjY3ODEwNQ==", "url": "https://github.com/elastic/elasticsearch/pull/52930#discussion_r386678105", "bodyText": "I think we should deprecate this endpoint as well, in favor of /_nodes/{nodeId}/hot_threads.", "author": "jasontedor", "createdAt": "2020-03-02T22:03:12Z", "path": "server/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestNodesHotThreadsAction.java", "diffHunk": "@@ -34,22 +36,42 @@\n \n import java.io.IOException;\n import java.util.List;\n+import java.util.stream.Collectors;\n \n import static org.elasticsearch.rest.RestRequest.Method.GET;\n \n-\n public class RestNodesHotThreadsAction extends BaseRestHandler {\n \n+    private static final DeprecationLogger deprecationLogger = new DeprecationLogger(\n+        LogManager.getLogger(RestNodesHotThreadsAction.class));\n+    static final String DEPRECATED_MESSAGE_CLUSTER_NODES_HOTTHREADS = \"[/_cluster/nodes/hotthreads] is a deprecated endpoint. \" \n+        + \"Please use [/_cluster/nodes/hot_threads] instead.\";\n+    static final String DEPRECATED_MESSAGE_CLUSTER_NODES_NODEID_HOTTHREADS = \"[/_cluster/nodes/{nodeId}/hotthreads] is a deprecated endpoint. \"\n+        + \"Please use [/_cluster/nodes/{nodeId}/hot_threads] instead.\";\n+    static final String DEPRECATED_MESSAGE_NODES_HOTTHREADS = \"[/_nodes/hotthreads] is a deprecated endpoint. \"\n+        + \"Please use [/_nodes/hot_threads] instead.\";\n+    static final String DEPRECATED_MESSAGE_NODES_NODEID_HOTTHREADS = \"[/_nodes/{nodeId}/hotthreads] is a deprecated endpoint. \"\n+        + \"Please use [/_nodes/{nodeId}/hot_threads] instead.\";\n+\n+    @Override\n+    public List<DeprecatedRoute> deprecatedRoutes() {\n+        return List.of(\n+            new DeprecatedRoute(GET, \"/_cluster/nodes/hotthreads\",\n+                    DEPRECATED_MESSAGE_CLUSTER_NODES_HOTTHREADS),\n+            new DeprecatedRoute(GET, \"/_cluster/nodes/{nodeId}/hotthreads\",\n+                    DEPRECATED_MESSAGE_CLUSTER_NODES_NODEID_HOTTHREADS),\n+            new DeprecatedRoute(GET, \"/_nodes/hotthreads\",\n+                    DEPRECATED_MESSAGE_NODES_HOTTHREADS),\n+            new DeprecatedRoute(GET, \"/_nodes/{nodeId}/hotthreads\",\n+                    DEPRECATED_MESSAGE_NODES_NODEID_HOTTHREADS));\n+    }        \n+\n     @Override\n     public List<Route> routes() {\n         return List.of(\n-            new Route(GET, \"/_cluster/nodes/hotthreads\"),\n             new Route(GET, \"/_cluster/nodes/hot_threads\"),\n-            new Route(GET, \"/_cluster/nodes/{nodeId}/hotthreads\"),\n             new Route(GET, \"/_cluster/nodes/{nodeId}/hot_threads\"),", "originalCommit": "317e1d0d1e71645fad8fb9b32b0f632b6c08b752", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjY4MDE5Nw==", "url": "https://github.com/elastic/elasticsearch/pull/52930#discussion_r386680197", "bodyText": "Yo mean I also have to remove this line \"/_cluster/nodes/{nodeId}/hot_threads\"?", "author": "muachilin", "createdAt": "2020-03-02T22:07:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjY3ODEwNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTM1OTEzNg==", "url": "https://github.com/elastic/elasticsearch/pull/52930#discussion_r389359136", "bodyText": "Just question: Should we also use private here?\nConsider use String.format() rather than concat string due to better performance, better readability.", "author": "changjenyin", "createdAt": "2020-03-08T11:16:54Z", "path": "server/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestNodesHotThreadsAction.java", "diffHunk": "@@ -34,22 +36,42 @@\n \n import java.io.IOException;\n import java.util.List;\n+import java.util.stream.Collectors;\n \n import static org.elasticsearch.rest.RestRequest.Method.GET;\n \n-\n public class RestNodesHotThreadsAction extends BaseRestHandler {\n \n+    private static final DeprecationLogger deprecationLogger = new DeprecationLogger(\n+        LogManager.getLogger(RestNodesHotThreadsAction.class));\n+    static final String DEPRECATED_MESSAGE_CLUSTER_NODES_HOTTHREADS = \"[/_cluster/nodes/hotthreads] is a deprecated endpoint. \" ", "originalCommit": "317e1d0d1e71645fad8fb9b32b0f632b6c08b752", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTM1OTE4MA==", "url": "https://github.com/elastic/elasticsearch/pull/52930#discussion_r389359180", "bodyText": "Please avoid using non-const string all over the place, maybe consider to make repeatedly string const.", "author": "changjenyin", "createdAt": "2020-03-08T11:17:57Z", "path": "server/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestNodesHotThreadsAction.java", "diffHunk": "@@ -34,22 +36,42 @@\n \n import java.io.IOException;\n import java.util.List;\n+import java.util.stream.Collectors;\n \n import static org.elasticsearch.rest.RestRequest.Method.GET;\n \n-\n public class RestNodesHotThreadsAction extends BaseRestHandler {\n \n+    private static final DeprecationLogger deprecationLogger = new DeprecationLogger(\n+        LogManager.getLogger(RestNodesHotThreadsAction.class));\n+    static final String DEPRECATED_MESSAGE_CLUSTER_NODES_HOTTHREADS = \"[/_cluster/nodes/hotthreads] is a deprecated endpoint. \" \n+        + \"Please use [/_cluster/nodes/hot_threads] instead.\";\n+    static final String DEPRECATED_MESSAGE_CLUSTER_NODES_NODEID_HOTTHREADS = \"[/_cluster/nodes/{nodeId}/hotthreads] is a deprecated endpoint. \"\n+        + \"Please use [/_cluster/nodes/{nodeId}/hot_threads] instead.\";\n+    static final String DEPRECATED_MESSAGE_NODES_HOTTHREADS = \"[/_nodes/hotthreads] is a deprecated endpoint. \"\n+        + \"Please use [/_nodes/hot_threads] instead.\";\n+    static final String DEPRECATED_MESSAGE_NODES_NODEID_HOTTHREADS = \"[/_nodes/{nodeId}/hotthreads] is a deprecated endpoint. \"\n+        + \"Please use [/_nodes/{nodeId}/hot_threads] instead.\";\n+\n+    @Override\n+    public List<DeprecatedRoute> deprecatedRoutes() {\n+        return List.of(\n+            new DeprecatedRoute(GET, \"/_cluster/nodes/hotthreads\",\n+                    DEPRECATED_MESSAGE_CLUSTER_NODES_HOTTHREADS),\n+            new DeprecatedRoute(GET, \"/_cluster/nodes/{nodeId}/hotthreads\",\n+                    DEPRECATED_MESSAGE_CLUSTER_NODES_NODEID_HOTTHREADS),\n+            new DeprecatedRoute(GET, \"/_nodes/hotthreads\",\n+                    DEPRECATED_MESSAGE_NODES_HOTTHREADS),\n+            new DeprecatedRoute(GET, \"/_nodes/{nodeId}/hotthreads\",\n+                    DEPRECATED_MESSAGE_NODES_NODEID_HOTTHREADS));", "originalCommit": "317e1d0d1e71645fad8fb9b32b0f632b6c08b752", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTM1OTU5OQ==", "url": "https://github.com/elastic/elasticsearch/pull/52930#discussion_r389359599", "bodyText": "I see! Thanks :)", "author": "muachilin", "createdAt": "2020-03-08T11:23:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTM1OTE4MA=="}], "type": "inlineReview"}, {"oid": "ca5c7e969e0571cbb329822c809ab8adeb9cb88c", "url": "https://github.com/elastic/elasticsearch/commit/ca5c7e969e0571cbb329822c809ab8adeb9cb88c", "message": "Deprecate more routes and remove tests", "committedDate": "2020-03-09T10:38:34Z", "type": "commit"}, {"oid": "842e1f60601a3c3eab8bcbb10d80e18bc8d28925", "url": "https://github.com/elastic/elasticsearch/commit/842e1f60601a3c3eab8bcbb10d80e18bc8d28925", "message": "Refactor deprecateRoutes()", "committedDate": "2020-03-09T10:51:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDY5NTY0NA==", "url": "https://github.com/elastic/elasticsearch/pull/52930#discussion_r390695644", "bodyText": "What's the reason for declaring all of these local variables?", "author": "jasontedor", "createdAt": "2020-03-11T01:09:58Z", "path": "server/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestNodesHotThreadsAction.java", "diffHunk": "@@ -37,20 +37,46 @@\n \n import static org.elasticsearch.rest.RestRequest.Method.GET;\n \n-\n public class RestNodesHotThreadsAction extends BaseRestHandler {\n \n+    static final String formatDeprecatedMessageWithoutNodeID = \"%s is a deprecated endpoint. Please use [/nodes/hot_threads] instead.\";\n+    static final String formatDeprecatedMessageWithNodeID = \"%s is a deprecated endpoint. Please use [/nodes/{nodeId}/hot_threads] instead.\";\n+    static final String DEPRECATED_MESSAGE_CLUSTER_NODES_HOT_THREADS = String.format(formatDeprecatedMessageWithoutNodeID, \"[/_cluster/nodes/hot_threads]\"); \n+    static final String DEPRECATED_MESSAGE_CLUSTER_NODES_NODEID_HOT_THREADS = String.format(formatDeprecatedMessageWithNodeID, \"[/_cluster/nodes/{nodeId}/hot_threads]\");\n+    static final String DEPRECATED_MESSAGE_CLUSTER_NODES_HOTTHREADS = String.format(formatDeprecatedMessageWithoutNodeID, \"[/_cluster/nodes/hotthreads]\"); \n+    static final String DEPRECATED_MESSAGE_CLUSTER_NODES_NODEID_HOTTHREADS = String.format(formatDeprecatedMessageWithNodeID, \"[/_cluster/nodes/{nodeId}/hotthreads]\"); \n+    static final String DEPRECATED_MESSAGE_NODES_HOTTHREADS = String.format(formatDeprecatedMessageWithoutNodeID, \"[/_nodes/hotthreads]\"); \n+    static final String DEPRECATED_MESSAGE_NODES_NODEID_HOTTHREADS = String.format(formatDeprecatedMessageWithNodeID, \"[/_nodes/{nodeId}/hotthreads]\");\n+\n+    @Override\n+    public List<DeprecatedRoute> deprecatedRoutes() {\n+        final String DEPRECATED_PATH_CLUSTER_NODES_HOT_THREADS = \"/_cluster/nodes/hot_threads\";\n+        final String DEPRECATED_PATH_CLUSTER_NODES_NODEID_HOT_THREADS = \"/_cluster/nodes/{nodeId}/hot_threads\";\n+        final String DEPRECATED_PATH_CLUSTER_NODES_HOTTHREADS = \"/_cluster/nodes/hotthreads\";\n+        final String DEPRECATED_PATH_CLUSTER_NODES_NODEID_HOTTHREADS = \"/_cluster/nodes/{nodeId}/hotthreads\";\n+        final String DEPRECATED_PATH_NODES_HOTTHREADS = \"/_nodes/hotthreads\";\n+        final String DEPRECATED_PATH_NODES_NODEID_HOTTHREADS = \"/_nodes/{nodeId}/hotthreads\";", "originalCommit": "842e1f60601a3c3eab8bcbb10d80e18bc8d28925", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTA2MDkxNg==", "url": "https://github.com/elastic/elasticsearch/pull/52930#discussion_r391060916", "bodyText": "I originally thought that it is easier to read. But these local variables will not be used afterwards. So I removed them!", "author": "muachilin", "createdAt": "2020-03-11T15:34:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDY5NTY0NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDcwMjM5Mg==", "url": "https://github.com/elastic/elasticsearch/pull/52930#discussion_r390702392", "bodyText": "You'll need to use the locale version of String#format and pass Locale.ROOT.", "author": "jasontedor", "createdAt": "2020-03-11T01:39:42Z", "path": "server/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestNodesHotThreadsAction.java", "diffHunk": "@@ -37,20 +37,46 @@\n \n import static org.elasticsearch.rest.RestRequest.Method.GET;\n \n-\n public class RestNodesHotThreadsAction extends BaseRestHandler {\n \n+    static final String formatDeprecatedMessageWithoutNodeID = \"%s is a deprecated endpoint. Please use [/nodes/hot_threads] instead.\";\n+    static final String formatDeprecatedMessageWithNodeID = \"%s is a deprecated endpoint. Please use [/nodes/{nodeId}/hot_threads] instead.\";\n+    static final String DEPRECATED_MESSAGE_CLUSTER_NODES_HOT_THREADS = String.format(formatDeprecatedMessageWithoutNodeID, \"[/_cluster/nodes/hot_threads]\"); \n+    static final String DEPRECATED_MESSAGE_CLUSTER_NODES_NODEID_HOT_THREADS = String.format(formatDeprecatedMessageWithNodeID, \"[/_cluster/nodes/{nodeId}/hot_threads]\");\n+    static final String DEPRECATED_MESSAGE_CLUSTER_NODES_HOTTHREADS = String.format(formatDeprecatedMessageWithoutNodeID, \"[/_cluster/nodes/hotthreads]\"); \n+    static final String DEPRECATED_MESSAGE_CLUSTER_NODES_NODEID_HOTTHREADS = String.format(formatDeprecatedMessageWithNodeID, \"[/_cluster/nodes/{nodeId}/hotthreads]\"); \n+    static final String DEPRECATED_MESSAGE_NODES_HOTTHREADS = String.format(formatDeprecatedMessageWithoutNodeID, \"[/_nodes/hotthreads]\"); \n+    static final String DEPRECATED_MESSAGE_NODES_NODEID_HOTTHREADS = String.format(formatDeprecatedMessageWithNodeID, \"[/_nodes/{nodeId}/hotthreads]\");", "originalCommit": "842e1f60601a3c3eab8bcbb10d80e18bc8d28925", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTA2MTAwNw==", "url": "https://github.com/elastic/elasticsearch/pull/52930#discussion_r391061007", "bodyText": "Okay!", "author": "muachilin", "createdAt": "2020-03-11T15:34:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDcwMjM5Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTA2MTE5MQ==", "url": "https://github.com/elastic/elasticsearch/pull/52930#discussion_r391061191", "bodyText": "Thank you :)", "author": "muachilin", "createdAt": "2020-03-11T15:34:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDcwMjM5Mg=="}], "type": "inlineReview"}, {"oid": "8472ed407663f751f0e66e49e669420eb597f46d", "url": "https://github.com/elastic/elasticsearch/commit/8472ed407663f751f0e66e49e669420eb597f46d", "message": "Update forked elasticsearch\n\nUpdate forked repo", "committedDate": "2020-03-11T11:52:42Z", "type": "commit"}, {"oid": "31a650b468a13984e26dd74160d5384611981435", "url": "https://github.com/elastic/elasticsearch/commit/31a650b468a13984e26dd74160d5384611981435", "message": "Use locale version of String.format", "committedDate": "2020-03-11T12:01:08Z", "type": "commit"}, {"oid": "fe8638bd34632d3976612dea2114f00cdb490d70", "url": "https://github.com/elastic/elasticsearch/commit/fe8638bd34632d3976612dea2114f00cdb490d70", "message": "Use locale version of String.format", "committedDate": "2020-03-11T12:01:40Z", "type": "commit"}, {"oid": "f828b754c952b530dba65ec09d75a91dca985772", "url": "https://github.com/elastic/elasticsearch/commit/f828b754c952b530dba65ec09d75a91dca985772", "message": "Remove tests", "committedDate": "2020-03-11T12:03:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTk4NTI2NA==", "url": "https://github.com/elastic/elasticsearch/pull/52930#discussion_r391985264", "bodyText": "These can all be private now.", "author": "jasontedor", "createdAt": "2020-03-13T01:28:15Z", "path": "server/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestNodesHotThreadsAction.java", "diffHunk": "@@ -34,23 +34,62 @@\n \n import java.io.IOException;\n import java.util.List;\n+import java.util.Locale;\n \n import static org.elasticsearch.rest.RestRequest.Method.GET;\n \n-\n public class RestNodesHotThreadsAction extends BaseRestHandler {\n \n+    static final String formatDeprecatedMessageWithoutNodeID = \"[%s] is a deprecated endpoint. Please use [/nodes/hot_threads] instead.\";", "originalCommit": "f828b754c952b530dba65ec09d75a91dca985772", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjMwNzI5Ng==", "url": "https://github.com/elastic/elasticsearch/pull/52930#discussion_r392307296", "bodyText": "I have signed the CLA but I did not get any confirmation email or other notification to indicate that I have successfully signed it. Thanks!", "author": "muachilin", "createdAt": "2020-03-13T15:41:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTk4NTI2NA=="}], "type": "inlineReview"}, {"oid": "c2ca69dc35035668b8c3b66847dfea71e1b26d2a", "url": "https://github.com/elastic/elasticsearch/commit/c2ca69dc35035668b8c3b66847dfea71e1b26d2a", "message": "Declare string variables as private", "committedDate": "2020-03-13T17:02:13Z", "type": "commit"}, {"oid": "55a96a340e024c3bc46c103c9375bb0a0ef90ca7", "url": "https://github.com/elastic/elasticsearch/commit/55a96a340e024c3bc46c103c9375bb0a0ef90ca7", "message": "Merge branch 'master' into deprecate-hot-thread", "committedDate": "2020-03-14T22:56:25Z", "type": "commit"}, {"oid": "bc6fb6e619b5b43fa53786500ffc544d3d16818f", "url": "https://github.com/elastic/elasticsearch/commit/bc6fb6e619b5b43fa53786500ffc544d3d16818f", "message": "Solve style violation", "committedDate": "2020-03-15T12:25:47Z", "type": "commit"}, {"oid": "dc776d4d2df0e4ab0e1fa568385b96cfad4437c1", "url": "https://github.com/elastic/elasticsearch/commit/dc776d4d2df0e4ab0e1fa568385b96cfad4437c1", "message": "Solve style violation", "committedDate": "2020-03-15T12:26:52Z", "type": "commit"}, {"oid": "d900b6bd5bdf078be72f416faa413517f3264df7", "url": "https://github.com/elastic/elasticsearch/commit/d900b6bd5bdf078be72f416faa413517f3264df7", "message": "Merge branch 'master' into deprecate-hot-thread", "committedDate": "2020-03-15T20:51:26Z", "type": "commit"}, {"oid": "5f6b8d3c1e92aab6259d2d43cf25edd5887c66bf", "url": "https://github.com/elastic/elasticsearch/commit/5f6b8d3c1e92aab6259d2d43cf25edd5887c66bf", "message": "Merge branch 'master' into deprecate-hot-thread", "committedDate": "2020-03-16T11:12:39Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTM3NTM0OQ==", "url": "https://github.com/elastic/elasticsearch/pull/52930#discussion_r395375349", "bodyText": "Sorry, I just noticed this should say \"/_nodes\" and not \"/nodes\". Same for the next line.", "author": "jasontedor", "createdAt": "2020-03-19T23:30:39Z", "path": "server/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestNodesHotThreadsAction.java", "diffHunk": "@@ -34,23 +34,64 @@\n \n import java.io.IOException;\n import java.util.List;\n+import java.util.Locale;\n \n import static org.elasticsearch.rest.RestRequest.Method.GET;\n \n-\n public class RestNodesHotThreadsAction extends BaseRestHandler {\n \n+    private static final String formatDeprecatedMessageWithoutNodeID = \"[%s] is a deprecated endpoint. \" + \n+        \"Please use [/nodes/hot_threads] instead.\";", "originalCommit": "5f6b8d3c1e92aab6259d2d43cf25edd5887c66bf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjEwOTEyNA==", "url": "https://github.com/elastic/elasticsearch/pull/52930#discussion_r396109124", "bodyText": "No problem! Thanks.", "author": "muachilin", "createdAt": "2020-03-22T15:55:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTM3NTM0OQ=="}], "type": "inlineReview"}, {"oid": "81b514823202cab089ed39b41ceb11fea36f795a", "url": "https://github.com/elastic/elasticsearch/commit/81b514823202cab089ed39b41ceb11fea36f795a", "message": "Modify deprecated message", "committedDate": "2020-03-22T15:56:37Z", "type": "commit"}, {"oid": "d295478b62977fb79c71416d5d3b8b8aa1f7e856", "url": "https://github.com/elastic/elasticsearch/commit/d295478b62977fb79c71416d5d3b8b8aa1f7e856", "message": "Modify deprecated message", "committedDate": "2020-03-22T15:58:19Z", "type": "commit"}, {"oid": "ad9fe9ee85c33de04d55538108781ede93dd6c59", "url": "https://github.com/elastic/elasticsearch/commit/ad9fe9ee85c33de04d55538108781ede93dd6c59", "message": "Merge branch 'master' into deprecate-hot-thread", "committedDate": "2020-03-22T15:59:02Z", "type": "commit"}]}