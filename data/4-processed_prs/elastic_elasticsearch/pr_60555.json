{"pr_number": 60555, "pr_title": "[DOCS] Update CCR docs to focus on Kibana", "pr_createdAt": "2020-07-31T20:53:29Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/60555", "timeline": [{"oid": "35d245b6d4003a56e87ec1741060671d1fc2d8c7", "url": "https://github.com/elastic/elasticsearch/commit/35d245b6d4003a56e87ec1741060671d1fc2d8c7", "message": "First crack at rewriting the CCR introduction.", "committedDate": "2020-07-30T19:30:10Z", "type": "commit"}, {"oid": "2d9e08c92d13798bc6185a6a158b625b0d1b76da", "url": "https://github.com/elastic/elasticsearch/commit/2d9e08c92d13798bc6185a6a158b625b0d1b76da", "message": "Merge branch 'master' into docs__add-ccr-architecture", "committedDate": "2020-07-30T19:31:42Z", "type": "commit"}, {"oid": "3a9e95f811b401633dab97392aa49a844d822521", "url": "https://github.com/elastic/elasticsearch/commit/3a9e95f811b401633dab97392aa49a844d822521", "message": "Emphasizing Kibana in configuring CCR (part one).", "committedDate": "2020-07-30T21:21:53Z", "type": "commit"}, {"oid": "35f6e5311b9607dedb5fea2353aaa36481f5b149", "url": "https://github.com/elastic/elasticsearch/commit/35f6e5311b9607dedb5fea2353aaa36481f5b149", "message": "Many more edits, plus new files.", "committedDate": "2020-07-31T20:51:22Z", "type": "commit"}, {"oid": "f080e3964ac32050eec21fba6273973c4a6d87eb", "url": "https://github.com/elastic/elasticsearch/commit/f080e3964ac32050eec21fba6273973c4a6d87eb", "message": "Fixing test case.", "committedDate": "2020-08-03T14:52:58Z", "type": "commit"}, {"oid": "c7f8a5fe2c5663cd5acd1e8362465a45109de11f", "url": "https://github.com/elastic/elasticsearch/commit/c7f8a5fe2c5663cd5acd1e8362465a45109de11f", "message": "Removing overview page and consolidating that information in the main page.", "committedDate": "2020-08-03T18:48:01Z", "type": "commit"}, {"oid": "d4e1bfb8b0d3b5c9eff9b7f41d174ea1f578bc36", "url": "https://github.com/elastic/elasticsearch/commit/d4e1bfb8b0d3b5c9eff9b7f41d174ea1f578bc36", "message": "Adding redirects for moved and deleted pages.", "committedDate": "2020-08-03T20:17:14Z", "type": "commit"}, {"oid": "e5b337b2f43f49852854dfd8ad4a9f5d397d08eb", "url": "https://github.com/elastic/elasticsearch/commit/e5b337b2f43f49852854dfd8ad4a9f5d397d08eb", "message": "Removing, consolidating, and adding redirects.", "committedDate": "2020-08-03T22:15:15Z", "type": "commit"}, {"oid": "0dfd2c8c042ab87b0e350d72ff7e1ed18db954c0", "url": "https://github.com/elastic/elasticsearch/commit/0dfd2c8c042ab87b0e350d72ff7e1ed18db954c0", "message": "Fixing duplicate ID in redirects and removing outdated reference.", "committedDate": "2020-08-04T13:42:21Z", "type": "commit"}, {"oid": "f44cf6b32140f1408342d8a7bf73b513c4a92eac", "url": "https://github.com/elastic/elasticsearch/commit/f44cf6b32140f1408342d8a7bf73b513c4a92eac", "message": "Adding test case and steps for recreating a follower index.", "committedDate": "2020-08-04T14:31:40Z", "type": "commit"}, {"oid": "2b15caad9fd4edccd174e9be130d73d0c7ebd856", "url": "https://github.com/elastic/elasticsearch/commit/2b15caad9fd4edccd174e9be130d73d0c7ebd856", "message": "Adding steps for managing CCR tasks in Kibana.", "committedDate": "2020-08-04T18:01:53Z", "type": "commit"}, {"oid": "e3f918991225f1b145fc1a3346825f1b04dd7f93", "url": "https://github.com/elastic/elasticsearch/commit/e3f918991225f1b145fc1a3346825f1b04dd7f93", "message": "Adding tasks for managing auto-follow patterns.", "committedDate": "2020-08-04T21:06:25Z", "type": "commit"}, {"oid": "ea421ac1e3708550cf4071ad05fbc6b5656b857b", "url": "https://github.com/elastic/elasticsearch/commit/ea421ac1e3708550cf4071ad05fbc6b5656b857b", "message": "Fixing glossary link.", "committedDate": "2020-08-05T12:55:18Z", "type": "commit"}, {"oid": "f875f901519de5afe744f85fe093848d99a368e3", "url": "https://github.com/elastic/elasticsearch/commit/f875f901519de5afe744f85fe093848d99a368e3", "message": "Fixing glossary link, again.", "committedDate": "2020-08-05T13:10:39Z", "type": "commit"}, {"oid": "1004066782de3f6e5365a5a89b908bcf127d6085", "url": "https://github.com/elastic/elasticsearch/commit/1004066782de3f6e5365a5a89b908bcf127d6085", "message": "Updating the upgrade information and other stuff.", "committedDate": "2020-08-05T19:15:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjA2NjA3Nw==", "url": "https://github.com/elastic/elasticsearch/pull/60555#discussion_r466066077", "bodyText": "I think you could pare this down even more, and shift the emphasis more to the goal than the feature. Something like:\nTo replicate time series indices, you configure an auto-follow pattern so each new index in the series is replicated automatically. Whenever the name of a new index on the remote cluster matches the auto-follow pattern, a corresponding follower index is added to the local cluster.", "author": "debadair", "createdAt": "2020-08-05T23:51:02Z", "path": "docs/reference/ccr/auto-follow.asciidoc", "diffHunk": "@@ -1,32 +1,96 @@\n [role=\"xpack\"]\n [testenv=\"platinum\"]\n [[ccr-auto-follow]]\n-=== Automatically following indices\n+=== Manage auto-follow patterns\n \n In time series use cases where you want to follow new indices that are", "originalCommit": "1004066782de3f6e5365a5a89b908bcf127d6085", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjA3MTczNg==", "url": "https://github.com/elastic/elasticsearch/pull/60555#discussion_r466071736", "bodyText": "My preference would be to use Set up, rather than Configure. That's more consistent with how @dedemorton has reorged the Beats docs, and leaves us room to use \"Configure\" in the context of overall ES configuration/settings.", "author": "debadair", "createdAt": "2020-08-06T00:11:09Z", "path": "docs/reference/ccr/getting-started.asciidoc", "diffHunk": "@@ -1,47 +1,50 @@\n [role=\"xpack\"]\n [testenv=\"platinum\"]\n [[ccr-getting-started]]\n-=== Getting started with {ccr}\n+=== Configure {ccr}", "originalCommit": "1004066782de3f6e5365a5a89b908bcf127d6085", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjA3MjYxOA==", "url": "https://github.com/elastic/elasticsearch/pull/60555#discussion_r466072618", "bodyText": "I'd streamline this a bit more and emphasize the goal over the feature. Something like:\nYou can manually create follower indices to replicate specific indices on a remote cluster, or configure auto-follow patterns to automatically create follower indices for new time series.", "author": "debadair", "createdAt": "2020-08-06T00:14:38Z", "path": "docs/reference/ccr/getting-started.asciidoc", "diffHunk": "@@ -1,47 +1,50 @@\n [role=\"xpack\"]\n [testenv=\"platinum\"]\n [[ccr-getting-started]]\n-=== Getting started with {ccr}\n+=== Configure {ccr}\n+You configure {ccr} by manually creating specific follower indices or by automatically creating follower indices from auto-follow patterns. When you initiate replication, the follower index is created on the local cluster.", "originalCommit": "1004066782de3f6e5365a5a89b908bcf127d6085", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjA3MzI4NA==", "url": "https://github.com/elastic/elasticsearch/pull/60555#discussion_r466073284", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Complete the following tasks to configure {ccr}:\n          \n          \n            \n            To set up {ccr}:", "author": "debadair", "createdAt": "2020-08-06T00:16:53Z", "path": "docs/reference/ccr/getting-started.asciidoc", "diffHunk": "@@ -1,47 +1,50 @@\n [role=\"xpack\"]\n [testenv=\"platinum\"]\n [[ccr-getting-started]]\n-=== Getting started with {ccr}\n+=== Configure {ccr}\n+You configure {ccr} by manually creating specific follower indices or by automatically creating follower indices from auto-follow patterns. When you initiate replication, the follower index is created on the local cluster.\n+After the follower index is created, the <<ccr-remote-recovery, remote recovery>>\n+process copies all of the Lucene segment files from the remote cluster to the\n+local cluster.\n \n-This getting-started guide for {ccr} shows you how to:\n+Complete the following tasks to configure {ccr}:", "originalCommit": "1004066782de3f6e5365a5a89b908bcf127d6085", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjA3MzQ0NQ==", "url": "https://github.com/elastic/elasticsearch/pull/60555#discussion_r466073445", "bodyText": "This sort of implies that there's something special about a leader index. This is really more, identify the index (or series of indices) you want to replicate on the remote cluster.", "author": "debadair", "createdAt": "2020-08-06T00:17:26Z", "path": "docs/reference/ccr/getting-started.asciidoc", "diffHunk": "@@ -1,47 +1,50 @@\n [role=\"xpack\"]\n [testenv=\"platinum\"]\n [[ccr-getting-started]]\n-=== Getting started with {ccr}\n+=== Configure {ccr}\n+You configure {ccr} by manually creating specific follower indices or by automatically creating follower indices from auto-follow patterns. When you initiate replication, the follower index is created on the local cluster.\n+After the follower index is created, the <<ccr-remote-recovery, remote recovery>>\n+process copies all of the Lucene segment files from the remote cluster to the\n+local cluster.\n \n-This getting-started guide for {ccr} shows you how to:\n+Complete the following tasks to configure {ccr}:\n \n-* <<ccr-getting-started-remote-cluster,Connect a local cluster to a remote\n-  cluster>>\n-* <<ccr-getting-started-leader-index,Create a leader index>> in a remote cluster\n-* <<ccr-getting-started-follower-index,Create a follower index>> that replicates\n-  a leader index\n-* <<ccr-getting-started-auto-follow,Automatically create follower indices>>\n+. <<ccr-getting-started-security,Configure security roles>>\n+. <<ccr-getting-started-remote-cluster,Connect a local cluster to a remote cluster>>\n+. <<ccr-getting-started-leader-index,Create a leader index in a remote cluster>>", "originalCommit": "1004066782de3f6e5365a5a89b908bcf127d6085", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjA3MzYxMg==", "url": "https://github.com/elastic/elasticsearch/pull/60555#discussion_r466073612", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            . <<ccr-enable-soft-deletes,Enable soft deletes on leader indices>>\n          \n          \n            \n            . <<ccr-enable-soft-deletes,Enable soft deletes on the leader index>>", "author": "debadair", "createdAt": "2020-08-06T00:18:04Z", "path": "docs/reference/ccr/getting-started.asciidoc", "diffHunk": "@@ -1,47 +1,50 @@\n [role=\"xpack\"]\n [testenv=\"platinum\"]\n [[ccr-getting-started]]\n-=== Getting started with {ccr}\n+=== Configure {ccr}\n+You configure {ccr} by manually creating specific follower indices or by automatically creating follower indices from auto-follow patterns. When you initiate replication, the follower index is created on the local cluster.\n+After the follower index is created, the <<ccr-remote-recovery, remote recovery>>\n+process copies all of the Lucene segment files from the remote cluster to the\n+local cluster.\n \n-This getting-started guide for {ccr} shows you how to:\n+Complete the following tasks to configure {ccr}:\n \n-* <<ccr-getting-started-remote-cluster,Connect a local cluster to a remote\n-  cluster>>\n-* <<ccr-getting-started-leader-index,Create a leader index>> in a remote cluster\n-* <<ccr-getting-started-follower-index,Create a follower index>> that replicates\n-  a leader index\n-* <<ccr-getting-started-auto-follow,Automatically create follower indices>>\n+. <<ccr-getting-started-security,Configure security roles>>\n+. <<ccr-getting-started-remote-cluster,Connect a local cluster to a remote cluster>>\n+. <<ccr-getting-started-leader-index,Create a leader index in a remote cluster>>\n+. <<ccr-enable-soft-deletes,Enable soft deletes on leader indices>>", "originalCommit": "1004066782de3f6e5365a5a89b908bcf127d6085", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjA3Mzc2OA==", "url": "https://github.com/elastic/elasticsearch/pull/60555#discussion_r466073768", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            . <<ccr-getting-started-follower-index,Create a follower index that replicates a leader index>>\n          \n          \n            \n            . <<ccr-getting-started-follower-index,Create a follower index to replicate the leader index>>", "author": "debadair", "createdAt": "2020-08-06T00:18:38Z", "path": "docs/reference/ccr/getting-started.asciidoc", "diffHunk": "@@ -1,47 +1,50 @@\n [role=\"xpack\"]\n [testenv=\"platinum\"]\n [[ccr-getting-started]]\n-=== Getting started with {ccr}\n+=== Configure {ccr}\n+You configure {ccr} by manually creating specific follower indices or by automatically creating follower indices from auto-follow patterns. When you initiate replication, the follower index is created on the local cluster.\n+After the follower index is created, the <<ccr-remote-recovery, remote recovery>>\n+process copies all of the Lucene segment files from the remote cluster to the\n+local cluster.\n \n-This getting-started guide for {ccr} shows you how to:\n+Complete the following tasks to configure {ccr}:\n \n-* <<ccr-getting-started-remote-cluster,Connect a local cluster to a remote\n-  cluster>>\n-* <<ccr-getting-started-leader-index,Create a leader index>> in a remote cluster\n-* <<ccr-getting-started-follower-index,Create a follower index>> that replicates\n-  a leader index\n-* <<ccr-getting-started-auto-follow,Automatically create follower indices>>\n+. <<ccr-getting-started-security,Configure security roles>>\n+. <<ccr-getting-started-remote-cluster,Connect a local cluster to a remote cluster>>\n+. <<ccr-getting-started-leader-index,Create a leader index in a remote cluster>>\n+. <<ccr-enable-soft-deletes,Enable soft deletes on leader indices>>\n+. <<ccr-getting-started-follower-index,Create a follower index that replicates a leader index>>", "originalCommit": "1004066782de3f6e5365a5a89b908bcf127d6085", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjA3NjcyOA==", "url": "https://github.com/elastic/elasticsearch/pull/60555#discussion_r466076728", "bodyText": "This doesn't quite fit as a step in this sequence, it's more an alternative to the previous step. Maybe preface them with something like, \"To manually create a follower index...\" and \"To automatically follow time series indices, create an auto-follow pattern.", "author": "debadair", "createdAt": "2020-08-06T00:28:54Z", "path": "docs/reference/ccr/getting-started.asciidoc", "diffHunk": "@@ -1,47 +1,50 @@\n [role=\"xpack\"]\n [testenv=\"platinum\"]\n [[ccr-getting-started]]\n-=== Getting started with {ccr}\n+=== Configure {ccr}\n+You configure {ccr} by manually creating specific follower indices or by automatically creating follower indices from auto-follow patterns. When you initiate replication, the follower index is created on the local cluster.\n+After the follower index is created, the <<ccr-remote-recovery, remote recovery>>\n+process copies all of the Lucene segment files from the remote cluster to the\n+local cluster.\n \n-This getting-started guide for {ccr} shows you how to:\n+Complete the following tasks to configure {ccr}:\n \n-* <<ccr-getting-started-remote-cluster,Connect a local cluster to a remote\n-  cluster>>\n-* <<ccr-getting-started-leader-index,Create a leader index>> in a remote cluster\n-* <<ccr-getting-started-follower-index,Create a follower index>> that replicates\n-  a leader index\n-* <<ccr-getting-started-auto-follow,Automatically create follower indices>>\n+. <<ccr-getting-started-security,Configure security roles>>\n+. <<ccr-getting-started-remote-cluster,Connect a local cluster to a remote cluster>>\n+. <<ccr-getting-started-leader-index,Create a leader index in a remote cluster>>\n+. <<ccr-enable-soft-deletes,Enable soft deletes on leader indices>>\n+. <<ccr-getting-started-follower-index,Create a follower index that replicates a leader index>>\n+. <<ccr-getting-started-auto-follow,Automatically create follower indices>>", "originalCommit": "1004066782de3f6e5365a5a89b908bcf127d6085", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjUzNzYyNA==", "url": "https://github.com/elastic/elasticsearch/pull/60555#discussion_r466537624", "bodyText": "I think that providing the option makes sense:\n. Manually create a follower index or create an auto-follow pattern:\n\nTo replicate the leader index, <<ccr-getting-started-follower-index,manually create a follower index>>\nTo automatically follow time series indices, <<ccr-getting-started-auto-follow,create an auto-follow pattern>>", "author": "lockewritesdocs", "createdAt": "2020-08-06T16:31:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjA3NjcyOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjA4MjgwNw==", "url": "https://github.com/elastic/elasticsearch/pull/60555#discussion_r466082807", "bodyText": "We don't do this for other X-Pack features--I think I'd remove this section. It seems like saying you need to install ES is unnecessary to use an ES feature, and I think we want to be consistent about how/where we're making license references.", "author": "debadair", "createdAt": "2020-08-06T00:51:51Z", "path": "docs/reference/ccr/getting-started.asciidoc", "diffHunk": "@@ -1,47 +1,50 @@\n [role=\"xpack\"]\n [testenv=\"platinum\"]\n [[ccr-getting-started]]\n-=== Getting started with {ccr}\n+=== Configure {ccr}\n+You configure {ccr} by manually creating specific follower indices or by automatically creating follower indices from auto-follow patterns. When you initiate replication, the follower index is created on the local cluster.\n+After the follower index is created, the <<ccr-remote-recovery, remote recovery>>\n+process copies all of the Lucene segment files from the remote cluster to the\n+local cluster.\n \n-This getting-started guide for {ccr} shows you how to:\n+Complete the following tasks to configure {ccr}:\n \n-* <<ccr-getting-started-remote-cluster,Connect a local cluster to a remote\n-  cluster>>\n-* <<ccr-getting-started-leader-index,Create a leader index>> in a remote cluster\n-* <<ccr-getting-started-follower-index,Create a follower index>> that replicates\n-  a leader index\n-* <<ccr-getting-started-auto-follow,Automatically create follower indices>>\n+. <<ccr-getting-started-security,Configure security roles>>\n+. <<ccr-getting-started-remote-cluster,Connect a local cluster to a remote cluster>>\n+. <<ccr-getting-started-leader-index,Create a leader index in a remote cluster>>\n+. <<ccr-enable-soft-deletes,Enable soft deletes on leader indices>>\n+. <<ccr-getting-started-follower-index,Create a follower index that replicates a leader index>>\n+. <<ccr-getting-started-auto-follow,Automatically create follower indices>>\n \n \n [[ccr-getting-started-before-you-begin]]\n ==== Before you begin", "originalCommit": "1004066782de3f6e5365a5a89b908bcf127d6085", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjA4MzUyNw==", "url": "https://github.com/elastic/elasticsearch/pull/60555#discussion_r466083527", "bodyText": "This feels more like what we've treated as \"prerequisites\" in the API ref. I'd replace this with something more like that, and avoid any implication that using the elastic super user in production is something you'd want to do.", "author": "debadair", "createdAt": "2020-08-06T00:54:47Z", "path": "docs/reference/ccr/getting-started.asciidoc", "diffHunk": "@@ -1,47 +1,50 @@\n [role=\"xpack\"]\n [testenv=\"platinum\"]\n [[ccr-getting-started]]\n-=== Getting started with {ccr}\n+=== Configure {ccr}\n+You configure {ccr} by manually creating specific follower indices or by automatically creating follower indices from auto-follow patterns. When you initiate replication, the follower index is created on the local cluster.\n+After the follower index is created, the <<ccr-remote-recovery, remote recovery>>\n+process copies all of the Lucene segment files from the remote cluster to the\n+local cluster.\n \n-This getting-started guide for {ccr} shows you how to:\n+Complete the following tasks to configure {ccr}:\n \n-* <<ccr-getting-started-remote-cluster,Connect a local cluster to a remote\n-  cluster>>\n-* <<ccr-getting-started-leader-index,Create a leader index>> in a remote cluster\n-* <<ccr-getting-started-follower-index,Create a follower index>> that replicates\n-  a leader index\n-* <<ccr-getting-started-auto-follow,Automatically create follower indices>>\n+. <<ccr-getting-started-security,Configure security roles>>\n+. <<ccr-getting-started-remote-cluster,Connect a local cluster to a remote cluster>>\n+. <<ccr-getting-started-leader-index,Create a leader index in a remote cluster>>\n+. <<ccr-enable-soft-deletes,Enable soft deletes on leader indices>>\n+. <<ccr-getting-started-follower-index,Create a follower index that replicates a leader index>>\n+. <<ccr-getting-started-auto-follow,Automatically create follower indices>>\n \n \n [[ccr-getting-started-before-you-begin]]\n ==== Before you begin\n . {stack-gs}/get-started-elastic-stack.html#install-elasticsearch[Install {es}]\n   on your local and remote clusters.\n \n-. Obtain a license that includes the {ccr} features. See\n-  https://www.elastic.co/subscriptions[subscriptions] and\n-  {kibana-ref}/managing-licenses.html[License management].\n+. Obtain a   https://www.elastic.co/subscriptions[license] that includes the\n+{ccr} features. You can enable {ccr} features in {kib} through\n+{kibana-ref}/managing-licenses.html[License management].\n \n-. If the Elastic {security-features} are enabled in your local and remote\n-  clusters, you need a user that has appropriate authority to perform the steps\n-  in this tutorial.\n-+\n---\n [[ccr-getting-started-security]]\n+==== Configure security roles", "originalCommit": "1004066782de3f6e5365a5a89b908bcf127d6085", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjA4NDA2OQ==", "url": "https://github.com/elastic/elasticsearch/pull/60555#discussion_r466084069", "bodyText": "I generally avoid this sort of meta info & reference things as examples if need be.", "author": "debadair", "createdAt": "2020-08-06T00:56:47Z", "path": "docs/reference/ccr/getting-started.asciidoc", "diffHunk": "@@ -76,19 +79,36 @@ ccr_user:\n --------------------------------------------------\n \n If you are managing\n-<<ccr-getting-started-remote-cluster,connecting to the remote cluster>> via the\n-cluster update settings API, you will also need a user with the `all` cluster\n-privilege.\n---\n-\n+<<ccr-getting-started-remote-cluster,connecting to the remote cluster>> using\n+the cluster update settings API, you will also need a user with the `all`\n+cluster privilege.\n \n [[ccr-getting-started-remote-cluster]]\n-==== Connecting to a remote cluster\n+==== Connect to a remote cluster\n+\n+The {ccr} features require that you connect your local cluster to a\n+<<modules-remote-clusters,remote cluster>>. In this tutorial, you connect your\n+local cluster to a remote cluster with the cluster alias `leader`.", "originalCommit": "1004066782de3f6e5365a5a89b908bcf127d6085", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjA4NDg4Mw==", "url": "https://github.com/elastic/elasticsearch/pull/60555#discussion_r466084883", "bodyText": "Again, less emphasis on the features, more emphasis on what you need to do.", "author": "debadair", "createdAt": "2020-08-06T00:59:49Z", "path": "docs/reference/ccr/getting-started.asciidoc", "diffHunk": "@@ -76,19 +79,36 @@ ccr_user:\n --------------------------------------------------\n \n If you are managing\n-<<ccr-getting-started-remote-cluster,connecting to the remote cluster>> via the\n-cluster update settings API, you will also need a user with the `all` cluster\n-privilege.\n---\n-\n+<<ccr-getting-started-remote-cluster,connecting to the remote cluster>> using\n+the cluster update settings API, you will also need a user with the `all`\n+cluster privilege.\n \n [[ccr-getting-started-remote-cluster]]\n-==== Connecting to a remote cluster\n+==== Connect to a remote cluster\n+\n+The {ccr} features require that you connect your local cluster to a", "originalCommit": "1004066782de3f6e5365a5a89b908bcf127d6085", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjA4OTk0MQ==", "url": "https://github.com/elastic/elasticsearch/pull/60555#discussion_r466089941", "bodyText": "We try to minimize \"click by click\" instructions for using Kibana. I think we can safely assume that folks know they need to open a browser to access Kibana--the important thing is that you're doing this config on the local cluster.\nWhere I landed with the ILM docs was focusing on getting folks to the right place in Kibana, showing them what that looks like, and telling them what they need to specify.\nThe UI has changed in 7.9, so I think you could just say something like,\n\"To configure a remote cluster through Kibana, go to Management and click Remote Clusters. On the Add remote cluster page, specify...\"", "author": "debadair", "createdAt": "2020-08-06T01:19:18Z", "path": "docs/reference/ccr/getting-started.asciidoc", "diffHunk": "@@ -76,19 +79,36 @@ ccr_user:\n --------------------------------------------------\n \n If you are managing\n-<<ccr-getting-started-remote-cluster,connecting to the remote cluster>> via the\n-cluster update settings API, you will also need a user with the `all` cluster\n-privilege.\n---\n-\n+<<ccr-getting-started-remote-cluster,connecting to the remote cluster>> using\n+the cluster update settings API, you will also need a user with the `all`\n+cluster privilege.\n \n [[ccr-getting-started-remote-cluster]]\n-==== Connecting to a remote cluster\n+==== Connect to a remote cluster\n+\n+The {ccr} features require that you connect your local cluster to a\n+<<modules-remote-clusters,remote cluster>>. In this tutorial, you connect your\n+local cluster to a remote cluster with the cluster alias `leader`.\n+\n+Add a {kibana-ref}/working-remote-clusters.html[remote cluster] in {kib}:", "originalCommit": "1004066782de3f6e5365a5a89b908bcf127d6085", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjA5MDI1NA==", "url": "https://github.com/elastic/elasticsearch/pull/60555#discussion_r466090254", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            .Use the API\n          \n          \n            \n            .API example", "author": "debadair", "createdAt": "2020-08-06T01:20:14Z", "path": "docs/reference/ccr/getting-started.asciidoc", "diffHunk": "@@ -76,19 +79,36 @@ ccr_user:\n --------------------------------------------------\n \n If you are managing\n-<<ccr-getting-started-remote-cluster,connecting to the remote cluster>> via the\n-cluster update settings API, you will also need a user with the `all` cluster\n-privilege.\n---\n-\n+<<ccr-getting-started-remote-cluster,connecting to the remote cluster>> using\n+the cluster update settings API, you will also need a user with the `all`\n+cluster privilege.\n \n [[ccr-getting-started-remote-cluster]]\n-==== Connecting to a remote cluster\n+==== Connect to a remote cluster\n+\n+The {ccr} features require that you connect your local cluster to a\n+<<modules-remote-clusters,remote cluster>>. In this tutorial, you connect your\n+local cluster to a remote cluster with the cluster alias `leader`.\n+\n+Add a {kibana-ref}/working-remote-clusters.html[remote cluster] in {kib}:\n \n-The {ccr} features require that you\n-{ref}/modules-remote-clusters.html[connect your local cluster to a remote\n-cluster]. In this tutorial, we will connect our local cluster to a remote\n-cluster with the cluster alias `leader`.\n+. Open a browser to access {kib} on your _local_ cluster.\n+. From the {kib} menu, select *Management -> Stack Management*.\n+. Under *Data*, select *Remote Clusters* to access the Remote Clusters\n+page.\n+. Choose *Add a remote cluster*.\n+. Enter `leader` as the name for the remote cluster.\n+. Enter an IP address or host name, followed by the transport port of the\n+remote cluster.\n+. Click *Save*.\n+\n+[role=\"screenshot\"]\n+image::images/remote-clusters.png[\"The Remote Clusters page in {kib}\"]\n+\n+[%collapsible]\n+.Use the API", "originalCommit": "1004066782de3f6e5365a5a89b908bcf127d6085", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjA5MTIwNQ==", "url": "https://github.com/elastic/elasticsearch/pull/60555#discussion_r466091205", "bodyText": "Same as above--I think you can avoid the click-by-click & the UI has changed in 7.9.", "author": "debadair", "createdAt": "2020-08-06T01:23:42Z", "path": "docs/reference/ccr/getting-started.asciidoc", "diffHunk": "@@ -201,20 +219,70 @@ PUT /server-metrics\n }\n --------------------------------------------------\n // TEST[continued]\n+====\n \n+[[ccr-enable-soft-deletes]]\n+==== Enable soft deletes on leader indices\n+<<ccr-leader-requirements,Soft deletes>> must be enabled for indices that you want to\n+use as leader indices. Soft deletes are enabled by default on new indices\n+created on or after {es} 7.0.0, so no further action is required if your\n+cluster is running {es} 7.0.0 or later.\n \n-[[ccr-getting-started-follower-index]]\n-==== Creating a follower index\n+include::{es-ref-dir}/ccr/index.asciidoc[tag=ccr-existing-indices-tag]\n \n-Follower indices are created with the {ref}/ccr-put-follow.html[create follower\n-API]. When you create a follower index, you must reference the\n+To enable soft deletes on indices created on versions of\n+{es} between 6.5.0 and 7.0.0, set <<ccr-index-soft-deletes,`index.soft_deletes.enabled`>> to `true`.\n+\n+[[ccr-getting-started-follower-index]]\n+==== Create a follower index\n+When you create a {kibana-ref}/managing-cross-cluster-replication.html#_create_specific_follower_indices[follower index], you\n+must reference the\n <<ccr-getting-started-remote-cluster,remote cluster>> and the\n <<ccr-getting-started-leader-index,leader index>> that you created in the remote\n-cluster.\n+cluster:\n+\n+. Open a browser to access {kib} on your _local_ cluster.", "originalCommit": "1004066782de3f6e5365a5a89b908bcf127d6085", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjA5MTM2Mg==", "url": "https://github.com/elastic/elasticsearch/pull/60555#discussion_r466091362", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            .Use the API\n          \n          \n            \n            .API example", "author": "debadair", "createdAt": "2020-08-06T01:24:13Z", "path": "docs/reference/ccr/getting-started.asciidoc", "diffHunk": "@@ -201,20 +219,70 @@ PUT /server-metrics\n }\n --------------------------------------------------\n // TEST[continued]\n+====\n \n+[[ccr-enable-soft-deletes]]\n+==== Enable soft deletes on leader indices\n+<<ccr-leader-requirements,Soft deletes>> must be enabled for indices that you want to\n+use as leader indices. Soft deletes are enabled by default on new indices\n+created on or after {es} 7.0.0, so no further action is required if your\n+cluster is running {es} 7.0.0 or later.\n \n-[[ccr-getting-started-follower-index]]\n-==== Creating a follower index\n+include::{es-ref-dir}/ccr/index.asciidoc[tag=ccr-existing-indices-tag]\n \n-Follower indices are created with the {ref}/ccr-put-follow.html[create follower\n-API]. When you create a follower index, you must reference the\n+To enable soft deletes on indices created on versions of\n+{es} between 6.5.0 and 7.0.0, set <<ccr-index-soft-deletes,`index.soft_deletes.enabled`>> to `true`.\n+\n+[[ccr-getting-started-follower-index]]\n+==== Create a follower index\n+When you create a {kibana-ref}/managing-cross-cluster-replication.html#_create_specific_follower_indices[follower index], you\n+must reference the\n <<ccr-getting-started-remote-cluster,remote cluster>> and the\n <<ccr-getting-started-leader-index,leader index>> that you created in the remote\n-cluster.\n+cluster:\n+\n+. Open a browser to access {kib} on your _local_ cluster.\n+. From the {kib} menu, click *Management -> Stack Management*.\n+. Under *Data*, select *Cross Cluster Replication*.\n+. Choose the *Follower indices* tab.\n+. Click *Create a follower index*.\n+  . Choose the remote cluster containing the index you want to replicate, which\n+  is `leader` if you are following the tutorial.\n+  . Enter the name of the leader index, which is `server-metrics` if you are\n+  following the tutorial.\n+  . Enter a name for your follower index, such as `server-metrics-follower`.\n+  . Click *Create* to create the follower index.\n+\n+The follower index is initialized using the\n+<<ccr-remote-recovery, remote recovery>>\n+process, and the index status changes to *Paused*. When the\n+remote recovery process is complete, the index following begins and the status\n+changes to *Active*.\n+\n+The remote recovery process transfers the existing Lucene segment files from\n+the leader to the follower.\n+When you index documents into your leader index, these\n+documents are replicated in the follower index.\n+\n+[role=\"screenshot\"]\n+image::images/ccr-follower-index.png[\"The Cross-Cluster Replication page in {kib}\"]\n+\n+[%collapsible]\n+.Use the API", "originalCommit": "1004066782de3f6e5365a5a89b908bcf127d6085", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjA5MTgwMg==", "url": "https://github.com/elastic/elasticsearch/pull/60555#discussion_r466091802", "bodyText": "See previous comments re auto-follow patterns.", "author": "debadair", "createdAt": "2020-08-06T01:25:51Z", "path": "docs/reference/ccr/getting-started.asciidoc", "diffHunk": "@@ -235,53 +303,66 @@ PUT /server-metrics-copy/_ccr/follow?wait_for_active_shards=1\n \n //////////////////////////\n \n-The follower index is initialized using the <<remote-recovery, remote recovery>>\n-process. The remote recovery process transfers the existing Lucene segment files\n-from the leader to the follower. When the remote recovery process is complete,\n-the index following begins.\n-\n-Now when you index documents into your leader index, you will see these\n-documents replicated in the follower index. You can\n-inspect the status of replication using the\n-{ref}/ccr-get-follow-stats.html[get follower stats API].\n-\n-Alternatively, you can {kibana-ref}/managing-cross-cluster-replication.html#_create_specific_follower_indices[manage follower indices] using {kib}:\n-\n-. From the {kib} menu, click *Management -> Stack Management*.\n-. Under *Data*, select *Cross Cluster Replication*.\n-. Choose the *Follower indices* tab.\n-\n-[role=\"screenshot\"]\n-image::images/ccr-follower-index.png[\"The Cross-Cluster Replication page in {kib}\"]\n+Use the\n+<<ccr-get-follow-stats,get follower stats API>> to inspect the status of\n+replication\n \n //////////////////////////\n \n [source,console]\n --------------------------------------------------\n-POST /server-metrics-copy/_ccr/pause_follow\n+POST /server-metrics-follower/_ccr/pause_follow\n \n-POST /server-metrics-copy/_close\n+POST /server-metrics-follower/_close\n \n-POST /server-metrics-copy/_ccr/unfollow\n+POST /server-metrics-follower/_ccr/unfollow\n --------------------------------------------------\n // TEST[continued]\n \n //////////////////////////\n-\n+====\n \n [[ccr-getting-started-auto-follow]]\n ==== Automatically create follower indices\n+The <<ccr-auto-follow,auto-follow>> feature in {ccr} is useful for time series", "originalCommit": "1004066782de3f6e5365a5a89b908bcf127d6085", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjA5MTg2OQ==", "url": "https://github.com/elastic/elasticsearch/pull/60555#discussion_r466091869", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            .Use the API\n          \n          \n            \n            .API example", "author": "debadair", "createdAt": "2020-08-06T01:26:07Z", "path": "docs/reference/ccr/getting-started.asciidoc", "diffHunk": "@@ -235,53 +303,66 @@ PUT /server-metrics-copy/_ccr/follow?wait_for_active_shards=1\n \n //////////////////////////\n \n-The follower index is initialized using the <<remote-recovery, remote recovery>>\n-process. The remote recovery process transfers the existing Lucene segment files\n-from the leader to the follower. When the remote recovery process is complete,\n-the index following begins.\n-\n-Now when you index documents into your leader index, you will see these\n-documents replicated in the follower index. You can\n-inspect the status of replication using the\n-{ref}/ccr-get-follow-stats.html[get follower stats API].\n-\n-Alternatively, you can {kibana-ref}/managing-cross-cluster-replication.html#_create_specific_follower_indices[manage follower indices] using {kib}:\n-\n-. From the {kib} menu, click *Management -> Stack Management*.\n-. Under *Data*, select *Cross Cluster Replication*.\n-. Choose the *Follower indices* tab.\n-\n-[role=\"screenshot\"]\n-image::images/ccr-follower-index.png[\"The Cross-Cluster Replication page in {kib}\"]\n+Use the\n+<<ccr-get-follow-stats,get follower stats API>> to inspect the status of\n+replication\n \n //////////////////////////\n \n [source,console]\n --------------------------------------------------\n-POST /server-metrics-copy/_ccr/pause_follow\n+POST /server-metrics-follower/_ccr/pause_follow\n \n-POST /server-metrics-copy/_close\n+POST /server-metrics-follower/_close\n \n-POST /server-metrics-copy/_ccr/unfollow\n+POST /server-metrics-follower/_ccr/unfollow\n --------------------------------------------------\n // TEST[continued]\n \n //////////////////////////\n-\n+====\n \n [[ccr-getting-started-auto-follow]]\n ==== Automatically create follower indices\n+The <<ccr-auto-follow,auto-follow>> feature in {ccr} is useful for time series\n+use cases where you want to follow new indices that are periodically created in\n+the remote cluster, such as daily {beats} indices.\n \n-The <<ccr-auto-follow,auto-follow>> feature in {ccr} helps for time series use\n-cases where you want to follow new indices that are periodically created in the\n-remote cluster (such as daily Beats indices). Auto-following is configured using\n-the {ref}/ccr-put-auto-follow-pattern.html[create auto-follow pattern API]. With\n-an auto-follow pattern, you reference the\n-<<ccr-getting-started-remote-cluster,remote cluster>> that you connected your\n-local cluster to. You must also specify a collection of  patterns that match the\n+With an auto-follow pattern, you reference the\n+<<ccr-getting-started-remote-cluster,remote cluster>> connected to your\n+local cluster. You must also specify a collection of patterns that match the\n indices you want to automatically follow.\n \n-For example:\n+// tag::ccr-create-auto-follow-pattern-tag[]\n+Create follower indices from an {kibana-ref}/managing-cross-cluster-replication.html#_create_follower_indices_from_an_auto_follow_pattern[auto-follow pattern]:\n+\n+. Open a browser to access {kib} on your _remote_ cluster.\n+. From the {kib} menu, click *Management -> Stack Management*.\n+. Under *Data*, select *Cross Cluster Replication*.\n+. Choose the *Auto-follow patterns* tab.\n+. Click *Create an auto-follow pattern*.\n+  . Enter a name for the auto-follow pattern. For this tutorial, enter `beats`\n+  as the name.\n+  . Choose the remote cluster containing the index you want to replicate, which\n+  is `leader` if you are following the tutorial.\n+  . Enter one or more index patterns that identify the indices you want to\n+  replicate from the remote cluster. For this tutorial, type\n+  `metricbeat-*,packetbeat-*` as the index pattern and then press *Enter* or\n+  *Return* on your keyboard.\n+  +\n+  As new indices matching these patterns are\n+  created, they are replicated to follower indices on the local cluster.\n+  . Enter *copy-* in the Prefix field, and then click *Create*.\n+\n+[role=\"screenshot\"]\n+image::images/auto-follow-patterns.png[\"The Auto-follow patterns page in {kib}\"]\n+// end::ccr-create-auto-follow-pattern-tag[]\n+\n+[%collapsible]\n+.Use the API", "originalCommit": "1004066782de3f6e5365a5a89b908bcf127d6085", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjA5NzA5OA==", "url": "https://github.com/elastic/elasticsearch/pull/60555#discussion_r466097098", "bodyText": "I think this needs to be a stronger \"hook\" -- what's the benefit?\nSomething like:\nYou can replicate indices across clusters to:\n\nContinue handling search requests in the event of a data center outage.\nPrevent search volume from impacting indexing throughput.\nReduce search latency by processing search requests in geo-proximity to the user", "author": "debadair", "createdAt": "2020-08-06T01:44:53Z", "path": "docs/reference/ccr/index.asciidoc", "diffHunk": "@@ -3,27 +3,168 @@\n [[xpack-ccr]]\n == {ccr-cap}\n \n-The {ccr} (CCR) feature enables replication of indices in remote clusters to a\n-local cluster. This functionality can be used in some common production use\n-cases:\n+Use {ccr} (CCR) to enable replication of indices in remote clusters to a", "originalCommit": "1004066782de3f6e5365a5a89b908bcf127d6085", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjEwMDAyNQ==", "url": "https://github.com/elastic/elasticsearch/pull/60555#discussion_r466100025", "bodyText": "I'd be inclined to flip this around a bit--the active-passive model is kind of the key thing to understand, not that its configured on a per-index basis.\nCCR uses an active passive model. You index to a leader index, and the data is replicated to one or more read-only follower indices. Before you can add a follower index to a cluster, you must configure the remote cluster that contains the leader index.", "author": "debadair", "createdAt": "2020-08-06T01:56:04Z", "path": "docs/reference/ccr/index.asciidoc", "diffHunk": "@@ -3,27 +3,168 @@\n [[xpack-ccr]]\n == {ccr-cap}\n \n-The {ccr} (CCR) feature enables replication of indices in remote clusters to a\n-local cluster. This functionality can be used in some common production use\n-cases:\n+Use {ccr} (CCR) to enable replication of indices in remote clusters to a\n+local cluster.\n \n-* Disaster recovery in case a primary cluster fails. A secondary cluster can\n-  serve as a hot backup\n-* Geo-proximity so that reads can be served locally\n-* Prevent search load from interfering with indexing by offloading search to a secondary cluster\n+{ccr-cap} is done on an index-by-index basis, so replication is", "originalCommit": "1004066782de3f6e5365a5a89b908bcf127d6085", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjEwMDgxMg==", "url": "https://github.com/elastic/elasticsearch/pull/60555#discussion_r466100812", "bodyText": "I think this can be streamlined if you work in the notion of a remote cluster above. The key point is that data is pulled from the remote cluster by the follower's cluster. You might even be able to downplay the \"local cluster\" references, which are somewhat ambiguous.", "author": "debadair", "createdAt": "2020-08-06T01:59:15Z", "path": "docs/reference/ccr/index.asciidoc", "diffHunk": "@@ -3,27 +3,168 @@\n [[xpack-ccr]]\n == {ccr-cap}\n \n-The {ccr} (CCR) feature enables replication of indices in remote clusters to a\n-local cluster. This functionality can be used in some common production use\n-cases:\n+Use {ccr} (CCR) to enable replication of indices in remote clusters to a\n+local cluster.\n \n-* Disaster recovery in case a primary cluster fails. A secondary cluster can\n-  serve as a hot backup\n-* Geo-proximity so that reads can be served locally\n-* Prevent search load from interfering with indexing by offloading search to a secondary cluster\n+{ccr-cap} is done on an index-by-index basis, so replication is\n+configured at the index level. For each configured replica, there is a\n+replication source index called the _leader index_ and a replication target\n+index called the _follower index_.\n \n-This guide provides an overview of {ccr}:\n+{ccr-cap} is designed around an active-passive index model. While the leader\n+index can be directly written into, the follower index cannot directly receive\n+writes. The follower index drives replication, which simplifies state\n+management on the leader index and ensures that {ccr} does not interfere with\n+indexing on the leader index.\n+\n+Replication is pull-based, where the cluster that is pulling data is called", "originalCommit": "1004066782de3f6e5365a5a89b908bcf127d6085", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjEwMjY4Mg==", "url": "https://github.com/elastic/elasticsearch/pull/60555#discussion_r466102682", "bodyText": "This feels like a point-in-time statement that's a little misleading now--would be good to verify. Can you set up CCR for an existing index that does have soft deletes enabled?", "author": "debadair", "createdAt": "2020-08-06T02:05:57Z", "path": "docs/reference/ccr/index.asciidoc", "diffHunk": "@@ -3,27 +3,168 @@\n [[xpack-ccr]]\n == {ccr-cap}\n \n-The {ccr} (CCR) feature enables replication of indices in remote clusters to a\n-local cluster. This functionality can be used in some common production use\n-cases:\n+Use {ccr} (CCR) to enable replication of indices in remote clusters to a\n+local cluster.\n \n-* Disaster recovery in case a primary cluster fails. A secondary cluster can\n-  serve as a hot backup\n-* Geo-proximity so that reads can be served locally\n-* Prevent search load from interfering with indexing by offloading search to a secondary cluster\n+{ccr-cap} is done on an index-by-index basis, so replication is\n+configured at the index level. For each configured replica, there is a\n+replication source index called the _leader index_ and a replication target\n+index called the _follower index_.\n \n-This guide provides an overview of {ccr}:\n+{ccr-cap} is designed around an active-passive index model. While the leader\n+index can be directly written into, the follower index cannot directly receive\n+writes. The follower index drives replication, which simplifies state\n+management on the leader index and ensures that {ccr} does not interfere with\n+indexing on the leader index.\n+\n+Replication is pull-based, where the cluster that is pulling data is called\n+the _local cluster_, and the cluster being replicated is the _remote cluster_.\n+The {es} version of the local cluster must be **the same as or newer** than\n+the remote cluster. If newer, the versions must also be compatible as outlined\n+in the following matrix.\n+\n+[%collapsible]\n+[[ccr-version-compatibility]]\n+.Version compatibility matrix\n+====\n+include::../modules/remote-clusters.asciidoc[tag=remote-cluster-compatibility-matrix]\n+====\n+\n+{ccr-cap} enables several use cases within the Elastic Stack:\n+\n+* *Disaster recovery* in case a primary cluster fails, with a secondary\n+cluster serving as a hot backup\n+* *Data locality* to serve reads locally and reduce costly latency\n+* *Centralized reporting* for preventing search load from interfering with indexing by offloading search to a secondary cluster\n+\n+[discrete]\n+[[ccr-replication-mechanics]]\n+=== Replication mechanics\n+Although you <<ccr-getting-started,configure {ccr}>> at the index level, {es}\n+achieves replication at the shard level. When a follower index is created,\n+each shard in that index pulls changes form its corresponding shard in the\n+leader index, which means that a follower index has the same number of\n+shards as its leader index. All operations are replicated by the follower, so that operations to create, update, or delete a document are replicated.\n+These requests can be served from any copy of the leader shard (primary or\n+replica).\n+\n+When a follower shard sends a read request, the leader shard responds with\n+any new operations, limited by the read parameters that you establish when\n+configuring the follower index. If no new operations are available, the\n+leader shard waits up to the configured timeout for new operations. If the\n+timeout elapses, the leader shard responds to the follower shard that there\n+are no new operations. The follower shard updates shard statistics and\n+immediately sends another read request to the leader shard. This\n+communication model ensures that network connections between the remote\n+cluster and the local cluster are continually in use, avoiding forceful\n+termination from an external sources such as a firewall.\n+\n+If a read request fails, the cause of the failure is inspected. If the\n+cause of the failure is deemed to be recoverable (such as a network\n+failure), the follower shard enters into a retry loop. Otherwise, the\n+follower shard pauses\n+<<ccr-pause-replication,until you resume it>>.\n+\n+When a follower shard receives operations from the leader shard, it places\n+those operations in a write buffer. The follower shard uses the write buffer\n+to submit bulk write requests within the shard. If the write buffer exceeds\n+its configured limits, no additional read requests are sent. This configuration\n+provides a back-pressure against read requests, allowing the follower shard\n+to resume sending read requests when the write buffer is no longer full.\n+\n+To manage how operations are replicated from the leader index, you can\n+configure settings when\n+<<ccr-getting-started-follower-index,creating the follower index in {kib}>>.\n+\n+The follower index automatically retrieves some updates applied to the leader\n+index, while other updates are retrieved as needed:\n+\n+[cols=\"3\"]\n+|===\n+h| Update type h| Automatic  h| As needed\n+| Alias        | {yes-icon} | {no-icon}\n+| Mapping      | {no-icon}  | {yes-icon}\n+| Settings     | {no-icon}  | {yes-icon}\n+|===\n+\n+For example, changing the number of replicas on the leader index is not\n+replicated by the follower index, so that setting might not be retrieved.\n+\n+NOTE: You cannot manually modify the mapping or alias of a follower index.\n+\n+If you apply a non-dynamic settings change to the leader index that is\n+needed by the follower index, the follower index closes itself, applies the\n+settings update, and then re-opens itself. The follower index is unavailable\n+for reads and cannot replicate writes during this cycle.\n+\n+[discrete]\n+[[ccr-remote-recovery]]\n+=== Remote recovery process\n+When you create a follower index, you cannot use it until it is fully\n+initialized. The _remote recovery_ process builds a new copy of a shard on a\n+follower node by copying data from the primary shard in the leader cluster.\n+\n+{es} uses this remote recovery process to bootstrap a follower index using the\n+data from the leader index. This process provides the follower with a copy of\n+the current state of the leader index, even if a complete history of changes\n+is not available on the leader due to Lucene segment merging.\n+\n+Remote recovery is a network intensive process that transfers all of the Lucene\n+segment files from the leader cluster to the follower cluster. The follower\n+requests that a recovery session be initiated on the primary shard in the\n+leader cluster. The follower then requests file chunks concurrently from the\n+leader. By default, the process concurrently requests five 1MB file\n+chunks. This default behavior is designed to support leader and follower\n+clusters with high network latency between them.\n+\n+TIP: You can modify dynamic <<ccr-recovery-settings,remote recovery settings>>\n+to rate-limit the transmitted data and manage the resources consumed by remote\n+recoveries.\n+\n+Use the <<cat-recovery,recovery API>> on the follower cluster to obtain\n+information about an in-progress remote recovery. Because {es} implements\n+remote recoveries using the <<snapshot-restore,snapshot and restore>>\n+infrastructure, running remote recoveries are labelled as type\n+`snapshot` in the recovery API.\n+\n+[discrete]\n+[[ccr-leader-requirements]]\n+=== Requirements for leader indices\n+{ccr-cap} works by replaying the history of individual write\n+operations that were performed on the shards of the leader index. The history\n+of these operations needs to be retained on the leader shards\n+so that they can be pulled by the follower shard tasks. The underlying\n+mechanism used to retain these operations is _soft deletes_.\n+\n+A soft delete occurs whenever an existing document is deleted or updated. By\n+retaining these soft deletes up to configurable limits, the history of\n+operations can be retained on the leader shards and made available to the\n+follower shard tasks as it replays the history of operations.\n+\n+Soft deletes must be enabled for indices that you want to use as leader\n+indices. Soft deletes are enabled by default on new indices created on\n+or after {es} 7.0.0.\n+\n+// tag::ccr-existing-indices-tag[]\n+IMPORTANT: {ccr-cap} cannot be used on existing indices. If you have", "originalCommit": "1004066782de3f6e5365a5a89b908bcf127d6085", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjcxNjU3NQ==", "url": "https://github.com/elastic/elasticsearch/pull/60555#discussion_r466716575", "bodyText": "Verified with @dnhatn that this statement should read:\n\nIMPORTANT: Cross-cluster replication cannot be used on existing indices created using Elasticsearch\n7.0.0 or earlier, where soft deletes are disabled. You must reindex your data into a new index with soft deletes enabled.", "author": "lockewritesdocs", "createdAt": "2020-08-06T22:20:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjEwMjY4Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjEwMjgwMQ==", "url": "https://github.com/elastic/elasticsearch/pull/60555#discussion_r466102801", "bodyText": "See previous comments about the UI.", "author": "debadair", "createdAt": "2020-08-06T02:06:32Z", "path": "docs/reference/ccr/managing.asciidoc", "diffHunk": "@@ -0,0 +1,171 @@\n+[role=\"xpack\"]\n+[testenv=\"platinum\"]\n+\n+//////////////////////////\n+\n+[source,console]\n+--------------------------------------------------\n+PUT /follower_index/_ccr/follow?wait_for_active_shards=1\n+{\n+  \"remote_cluster\" : \"remote_cluster\",\n+  \"leader_index\" : \"leader_index\"\n+}\n+--------------------------------------------------\n+// TESTSETUP\n+// TEST[setup:remote_cluster_and_leader_index]\n+\n+[source,console]\n+--------------------------------------------------\n+POST /follower_index/_ccr/pause_follow\n+--------------------------------------------------\n+// TEARDOWN\n+\n+//////////////////////////\n+\n+[[ccr-managing]]\n+=== Manage {ccr}\n+Use the following information to manage {ccr} tasks, such as inspecting\n+replication progress, pausing and resuming replication, recreating a follower\n+index, and terminating replication.\n+\n+[[ccr-inspect-progress]]\n+==== Inspect replication statistics\n+You can inspect the progress of replication for a follower index and view\n+detailed shard statistics.\n+\n+. Open a browser to access {kib} on your _local_ cluster.", "originalCommit": "1004066782de3f6e5365a5a89b908bcf127d6085", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjEwMjg5MA==", "url": "https://github.com/elastic/elasticsearch/pull/60555#discussion_r466102890", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            .Use the API\n          \n          \n            \n            .API example", "author": "debadair", "createdAt": "2020-08-06T02:06:57Z", "path": "docs/reference/ccr/managing.asciidoc", "diffHunk": "@@ -0,0 +1,171 @@\n+[role=\"xpack\"]\n+[testenv=\"platinum\"]\n+\n+//////////////////////////\n+\n+[source,console]\n+--------------------------------------------------\n+PUT /follower_index/_ccr/follow?wait_for_active_shards=1\n+{\n+  \"remote_cluster\" : \"remote_cluster\",\n+  \"leader_index\" : \"leader_index\"\n+}\n+--------------------------------------------------\n+// TESTSETUP\n+// TEST[setup:remote_cluster_and_leader_index]\n+\n+[source,console]\n+--------------------------------------------------\n+POST /follower_index/_ccr/pause_follow\n+--------------------------------------------------\n+// TEARDOWN\n+\n+//////////////////////////\n+\n+[[ccr-managing]]\n+=== Manage {ccr}\n+Use the following information to manage {ccr} tasks, such as inspecting\n+replication progress, pausing and resuming replication, recreating a follower\n+index, and terminating replication.\n+\n+[[ccr-inspect-progress]]\n+==== Inspect replication statistics\n+You can inspect the progress of replication for a follower index and view\n+detailed shard statistics.\n+\n+. Open a browser to access {kib} on your _local_ cluster.\n+. From the {kib} menu, click *Management -> Stack Management*.\n+. Under *Data*, select *Cross Cluster Replication*.\n+  . Choose the *Follower indices* tab.\n+  . Select the name of the follower index you want to view replication details\n+  for.\n+\n+The slide-out panel shows settings and replication statistics for the follower\n+index, including read and write that are managed by the follower shard.\n+\n+To view more detailed statistics, click *View in Index Management*, and\n+then select the name of the follower index on the *Index Management* page. Choose the *Stats* tab to view detailed statistics at the shard level.\n+\n+[%collapsible]\n+.Use the API", "originalCommit": "1004066782de3f6e5365a5a89b908bcf127d6085", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjEwMzE4MQ==", "url": "https://github.com/elastic/elasticsearch/pull/60555#discussion_r466103181", "bodyText": "This should be clarified...it's not the follower indices that are replicated. :-)", "author": "debadair", "createdAt": "2020-08-06T02:07:53Z", "path": "docs/reference/ccr/managing.asciidoc", "diffHunk": "@@ -0,0 +1,171 @@\n+[role=\"xpack\"]\n+[testenv=\"platinum\"]\n+\n+//////////////////////////\n+\n+[source,console]\n+--------------------------------------------------\n+PUT /follower_index/_ccr/follow?wait_for_active_shards=1\n+{\n+  \"remote_cluster\" : \"remote_cluster\",\n+  \"leader_index\" : \"leader_index\"\n+}\n+--------------------------------------------------\n+// TESTSETUP\n+// TEST[setup:remote_cluster_and_leader_index]\n+\n+[source,console]\n+--------------------------------------------------\n+POST /follower_index/_ccr/pause_follow\n+--------------------------------------------------\n+// TEARDOWN\n+\n+//////////////////////////\n+\n+[[ccr-managing]]\n+=== Manage {ccr}\n+Use the following information to manage {ccr} tasks, such as inspecting\n+replication progress, pausing and resuming replication, recreating a follower\n+index, and terminating replication.\n+\n+[[ccr-inspect-progress]]\n+==== Inspect replication statistics\n+You can inspect the progress of replication for a follower index and view\n+detailed shard statistics.\n+\n+. Open a browser to access {kib} on your _local_ cluster.\n+. From the {kib} menu, click *Management -> Stack Management*.\n+. Under *Data*, select *Cross Cluster Replication*.\n+  . Choose the *Follower indices* tab.\n+  . Select the name of the follower index you want to view replication details\n+  for.\n+\n+The slide-out panel shows settings and replication statistics for the follower\n+index, including read and write that are managed by the follower shard.\n+\n+To view more detailed statistics, click *View in Index Management*, and\n+then select the name of the follower index on the *Index Management* page. Choose the *Stats* tab to view detailed statistics at the shard level.\n+\n+[%collapsible]\n+.Use the API\n+====\n+Use the <<ccr-get-follow-stats,get follower stats API>> to inspect replication\n+progress at the shard level. This API provides insight into the read and writes\n+managed by the follower shard. The API also reports read exceptions that can be\n+retried and fatal exceptions that require user intervention.\n+====\n+\n+[[ccr-pause-replication]]\n+==== Pause and resume replication\n+Pause and resume replication of follower indices. When resuming, you can choose", "originalCommit": "1004066782de3f6e5365a5a89b908bcf127d6085", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjEwMzMxMg==", "url": "https://github.com/elastic/elasticsearch/pull/60555#discussion_r466103312", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            .Use the API\n          \n          \n            \n            .API example", "author": "debadair", "createdAt": "2020-08-06T02:08:28Z", "path": "docs/reference/ccr/managing.asciidoc", "diffHunk": "@@ -0,0 +1,171 @@\n+[role=\"xpack\"]\n+[testenv=\"platinum\"]\n+\n+//////////////////////////\n+\n+[source,console]\n+--------------------------------------------------\n+PUT /follower_index/_ccr/follow?wait_for_active_shards=1\n+{\n+  \"remote_cluster\" : \"remote_cluster\",\n+  \"leader_index\" : \"leader_index\"\n+}\n+--------------------------------------------------\n+// TESTSETUP\n+// TEST[setup:remote_cluster_and_leader_index]\n+\n+[source,console]\n+--------------------------------------------------\n+POST /follower_index/_ccr/pause_follow\n+--------------------------------------------------\n+// TEARDOWN\n+\n+//////////////////////////\n+\n+[[ccr-managing]]\n+=== Manage {ccr}\n+Use the following information to manage {ccr} tasks, such as inspecting\n+replication progress, pausing and resuming replication, recreating a follower\n+index, and terminating replication.\n+\n+[[ccr-inspect-progress]]\n+==== Inspect replication statistics\n+You can inspect the progress of replication for a follower index and view\n+detailed shard statistics.\n+\n+. Open a browser to access {kib} on your _local_ cluster.\n+. From the {kib} menu, click *Management -> Stack Management*.\n+. Under *Data*, select *Cross Cluster Replication*.\n+  . Choose the *Follower indices* tab.\n+  . Select the name of the follower index you want to view replication details\n+  for.\n+\n+The slide-out panel shows settings and replication statistics for the follower\n+index, including read and write that are managed by the follower shard.\n+\n+To view more detailed statistics, click *View in Index Management*, and\n+then select the name of the follower index on the *Index Management* page. Choose the *Stats* tab to view detailed statistics at the shard level.\n+\n+[%collapsible]\n+.Use the API\n+====\n+Use the <<ccr-get-follow-stats,get follower stats API>> to inspect replication\n+progress at the shard level. This API provides insight into the read and writes\n+managed by the follower shard. The API also reports read exceptions that can be\n+retried and fatal exceptions that require user intervention.\n+====\n+\n+[[ccr-pause-replication]]\n+==== Pause and resume replication\n+Pause and resume replication of follower indices. When resuming, you can choose\n+to modify advanced settings.\n+\n+. Open a browser to access {kib} on your _local_ cluster.\n+. From the {kib} menu, click *Management -> Stack Management*.\n+. Under *Data*, select *Cross Cluster Replication*.\n+  . Choose the *Follower indices* tab.\n+  . Select the follower index you want to pause and\n+  choose *Manage -> Pause Replication*.\n+\n+The follower index status changes to *Paused*.\n+\n+To resume replication, select the follower index and choose\n+*Resume replication*.\n+\n+[%collapsible]\n+.Use the API", "originalCommit": "1004066782de3f6e5365a5a89b908bcf127d6085", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjEwMzkxNQ==", "url": "https://github.com/elastic/elasticsearch/pull/60555#discussion_r466103915", "bodyText": "It's probably worth mentioning up front that you can have bi-directional replication between clusters.", "author": "debadair", "createdAt": "2020-08-06T02:10:36Z", "path": "docs/reference/ccr/upgrading.asciidoc", "diffHunk": "@@ -1,49 +1,67 @@\n [role=\"xpack\"]\n [testenv=\"platinum\"]\n [[ccr-upgrading]]\n-=== Upgrading clusters\n+=== Upgrading clusters using {ccr}\n+++++\n+<titleabbrev>Upgrading clusters</titleabbrev>\n+++++\n \n Clusters that are actively using {ccr} require a careful approach to upgrades.\n-Otherwise index following may fail during a rolling upgrade, because of the\n-following reasons:\n+The following conditions could cause index following to fail during rolling\n+upgrades:\n \n-* If a new index setting or mapping type is replicated from an upgraded cluster\n-  to a non-upgraded cluster then the non-upgraded cluster will reject that and\n-  will fail index following.\n-* Lucene is not forwards compatible and when index following is falling back to\n-  file based recovery then a node in a non-upgraded cluster will reject index\n-  files from a newer Lucene version compared to what it is using.\n-\n-Rolling upgrading clusters with {ccr} is different in case of uni-directional\n-index following and bi-directional index following.\n+* Clusters that have not yet been upgraded will reject new index settings or\n+mapping types that are replicated from an upgraded cluster.\n+* Nodes in a cluster that has not been upgraded will reject index files from a\n+node in an upgraded cluster when index following tries to fall back to\n+file-based recovery. This limitation is due to Lucene not being forward\n+compatible.\n \n+The approach to running a rolling upgrade on clusters where {ccr} is\n+enabled differs based on uni-directional and bi-directional index following.\n \n+[[ccr-uni-directional-upgrade]]\n ==== Uni-directional index following\n \n-In a uni-directional setup between two clusters, one cluster contains only\n-leader indices, and the other cluster contains only follower indices following\n-indices in the first cluster.\n+In a uni-directional configuration, one cluster contains only", "originalCommit": "1004066782de3f6e5365a5a89b908bcf127d6085", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "726bef4cba0961d1a70aecfff5ff2c18af389565", "url": "https://github.com/elastic/elasticsearch/commit/726bef4cba0961d1a70aecfff5ff2c18af389565", "message": "Apply suggestions from code review\n\nCo-authored-by: debadair <debadair@elastic.co>", "committedDate": "2020-08-06T15:28:58Z", "type": "commit"}, {"oid": "4fdc33a641642f5e5e59874c343d5152b81bf076", "url": "https://github.com/elastic/elasticsearch/commit/4fdc33a641642f5e5e59874c343d5152b81bf076", "message": "Incorporating review feedback.", "committedDate": "2020-08-06T22:21:58Z", "type": "commit"}, {"oid": "af4ccdae29618a492916d9fe341c29f3aac87210", "url": "https://github.com/elastic/elasticsearch/commit/af4ccdae29618a492916d9fe341c29f3aac87210", "message": "Adding more edits.", "committedDate": "2020-08-10T18:54:24Z", "type": "commit"}, {"oid": "c8238ac94e3baed032d7460b6bbac208b17e7285", "url": "https://github.com/elastic/elasticsearch/commit/c8238ac94e3baed032d7460b6bbac208b17e7285", "message": "Fixing link reference.", "committedDate": "2020-08-10T19:49:11Z", "type": "commit"}, {"oid": "9162ca8a1168a6d7b57292344128cca94944f577", "url": "https://github.com/elastic/elasticsearch/commit/9162ca8a1168a6d7b57292344128cca94944f577", "message": "Merge branch 'master' into docs__add-ccr-architecture", "committedDate": "2020-08-11T16:42:15Z", "type": "commit"}, {"oid": "2aa6578823cdadc4e2057e160ce5ade344b55a33", "url": "https://github.com/elastic/elasticsearch/commit/2aa6578823cdadc4e2057e160ce5ade344b55a33", "message": "Adding use cases for #59812.", "committedDate": "2020-08-13T17:00:52Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDIwODI2MQ==", "url": "https://github.com/elastic/elasticsearch/pull/60555#discussion_r470208261", "bodyText": "Maybe mention \"This is especially useful with ILM (link), which may continually create new indices on the leader cluster.\"", "author": "zuketo", "createdAt": "2020-08-13T19:51:04Z", "path": "docs/reference/ccr/auto-follow.asciidoc", "diffHunk": "@@ -1,32 +1,80 @@\n [role=\"xpack\"]\n [testenv=\"platinum\"]\n [[ccr-auto-follow]]\n-=== Automatically following indices\n-\n-In time series use cases where you want to follow new indices that are\n-periodically created (such as daily Beats indices), manually configuring follower\n-indices for each new leader index can be an operational burden. The auto-follow\n-functionality in {ccr} is aimed at easing this burden. With the auto-follow\n-functionality, you can specify that new indices in a remote cluster that have a \n-name that matches a pattern are automatically followed.\n-\n-==== Managing auto-follow patterns\n-\n-You can add a new auto-follow pattern configuration with the\n-{ref}/ccr-put-auto-follow-pattern.html[create auto-follow pattern API].  When you create\n-a new auto-follow pattern configuration, you are configuring a collection of\n-patterns against a single remote cluster. Any time a new index with a name that \n-matches one of the patterns in the collection is created in the remote cluster,\n-a follower index is configured in the local cluster. The follower index uses the \n-new index as its leader index.\n-\n-You can inspect all configured auto-follow pattern collections with the\n-{ref}/ccr-get-auto-follow-pattern.html[get auto-follow pattern API]. Auto-follow patterns\n-can be paused using the {ref}/ccr-pause-auto-follow-pattern.html[pause auto-follow pattern API]\n- and can be resumed using the {ref}/ccr-resume-auto-follow-pattern.html[resume auto-follow pattern API].\n-  To delete a configured auto-follow pattern collection, use the\n-{ref}/ccr-delete-auto-follow-pattern.html[delete auto-follow pattern API].\n-\n-Since auto-follow functionality is handled automatically in the background on\n-your behalf, error reporting is done through logs on the elected master node\n-and through the {ref}/ccr-get-stats.html[{ccr} stats API].\n+=== Manage auto-follow patterns\n+To replicate time series indices, you configure an auto-follow pattern so that\n+each new index in the series is replicated automatically. Whenever the name of\n+a new index on the remote cluster matches the auto-follow pattern, a\n+corresponding follower index is added to the local cluster.", "originalCommit": "2aa6578823cdadc4e2057e160ce5ade344b55a33", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDIxMjQwNA==", "url": "https://github.com/elastic/elasticsearch/pull/60555#discussion_r470212404", "bodyText": "I'm wondering if it would be good to mention the settings at https://www.elastic.co/guide/en/elasticsearch/reference/master/index-modules-history-retention.html#_history_retention_settings here. This has come up a few times, e.g. \"how long can my leader cluster be offline?\" or \"how long can my network connection be down?\" By default, the answer is 12 hours, after that we will need to resync data (since we can no longer rely on soft deletes). This value can be configured, e.g. a cruise ship replicating an index back to land that is out at sea for up to 24 hours at a time would probably want to adjust the index.soft_deletes.retention_lease.period setting.", "author": "zuketo", "createdAt": "2020-08-13T19:58:39Z", "path": "docs/reference/ccr/index.asciidoc", "diffHunk": "@@ -2,28 +2,172 @@\n [testenv=\"platinum\"]\n [[xpack-ccr]]\n == {ccr-cap}\n+With {ccr}, you can enable several <<ccr-use-cases,use cases>> within the\n+Elastic Stack.\n \n-The {ccr} (CCR) feature enables replication of indices in remote clusters to a\n-local cluster. This functionality can be used in some common production use\n-cases:\n+You can replicate indices across clusters to:\n \n-* Disaster recovery in case a primary cluster fails. A secondary cluster can\n-  serve as a hot backup\n-* Geo-proximity so that reads can be served locally\n-* Prevent search load from interfering with indexing by offloading search to a secondary cluster\n+* Continue handling search requests in the event of a datacenter outage\n+* Prevent search volume from impacting indexing throughput\n+* Reduce search latency by processing search requests in geo-proximity to the\n+user\n \n-This guide provides an overview of {ccr}:\n+{ccr-cap} uses an active-passive model. You index to a _leader_ index, and the\n+data is replicated to one or more read-only _follower_ indices. Before you can add a follower index to a cluster, you must configure the _remote cluster_ that contains the leader index.\n \n-* <<ccr-overview>>\n-* <<ccr-requirements>>\n-* <<ccr-auto-follow>>\n+When the leader index receives writes, the follower indices pull changes from\n+the leader index on the remote cluster. You can manually create follower\n+indices, or configure auto-follow patterns to automatically create follower\n+indices for new time series.\n+\n+You configure {ccr} clusters in a uni-directional or bi-directional setup:\n+\n+* In a uni-directional configuration, one cluster contains only\n+leader indices, and the other cluster contains only follower indices.\n+* In a bi-directional configuration, each cluster contains both leader and\n+follower indices.\n+\n+In a uni-directional configuration, the cluster containing follower indices\n+must be running **the same or newer** version of {es} as the remote cluster.\n+If newer, the versions must also be compatible as outlined in the following matrix.\n+\n+[%collapsible]\n+[[ccr-version-compatibility]]\n+.Version compatibility matrix\n+====\n+include::../modules/remote-clusters.asciidoc[tag=remote-cluster-compatibility-matrix]\n+====\n+\n+[discrete]\n+[[ccr-replication-mechanics]]\n+=== Replication mechanics\n+Although you <<ccr-getting-started,set up {ccr}>> at the index level, {es}\n+achieves replication at the shard level. When a follower index is created,\n+each shard in that index pulls changes form its corresponding shard in the\n+leader index, which means that a follower index has the same number of\n+shards as its leader index. All operations are replicated by the follower, so that operations to create, update, or delete a document are replicated.\n+These requests can be served from any copy of the leader shard (primary or\n+replica).\n+\n+When a follower shard sends a read request, the leader shard responds with\n+any new operations, limited by the read parameters that you establish when\n+configuring the follower index. If no new operations are available, the\n+leader shard waits up to the configured timeout for new operations. If the\n+timeout elapses, the leader shard responds to the follower shard that there\n+are no new operations. The follower shard updates shard statistics and\n+immediately sends another read request to the leader shard. This\n+communication model ensures that network connections between the remote\n+cluster and the local cluster are continually in use, avoiding forceful\n+termination from an external sources such as a firewall.\n+\n+If a read request fails, the cause of the failure is inspected. If the\n+cause of the failure is deemed to be recoverable (such as a network\n+failure), the follower shard enters into a retry loop. Otherwise, the\n+follower shard pauses\n+<<ccr-pause-replication,until you resume it>>.\n+\n+When a follower shard receives operations from the leader shard, it places\n+those operations in a write buffer. The follower shard uses the write buffer\n+to submit bulk write requests within the shard. If the write buffer exceeds\n+its configured limits, no additional read requests are sent. This configuration\n+provides a back-pressure against read requests, allowing the follower shard\n+to resume sending read requests when the write buffer is no longer full.\n+\n+To manage how operations are replicated from the leader index, you can\n+configure settings when\n+<<ccr-getting-started-follower-index,creating the follower index>>.\n+\n+The follower index automatically retrieves some updates applied to the leader\n+index, while other updates are retrieved as needed:\n+\n+[cols=\"3\"]\n+|===\n+h| Update type h| Automatic  h| As needed\n+| Alias        | {yes-icon} | {no-icon}\n+| Mapping      | {no-icon}  | {yes-icon}\n+| Settings     | {no-icon}  | {yes-icon}\n+|===\n+\n+For example, changing the number of replicas on the leader index is not\n+replicated by the follower index, so that setting might not be retrieved.\n+\n+NOTE: You cannot manually modify the mapping or alias of a follower index.\n+\n+If you apply a non-dynamic settings change to the leader index that is\n+needed by the follower index, the follower index closes itself, applies the\n+settings update, and then re-opens itself. The follower index is unavailable\n+for reads and cannot replicate writes during this cycle.\n+\n+[discrete]\n+[[ccr-remote-recovery]]\n+=== Remote recovery process\n+When you create a follower index, you cannot use it until it is fully\n+initialized. The _remote recovery_ process builds a new copy of a shard on a\n+follower node by copying data from the primary shard in the leader cluster.\n+\n+{es} uses this remote recovery process to bootstrap a follower index using the\n+data from the leader index. This process provides the follower with a copy of\n+the current state of the leader index, even if a complete history of changes\n+is not available on the leader due to Lucene segment merging.\n+\n+Remote recovery is a network intensive process that transfers all of the Lucene\n+segment files from the leader cluster to the follower cluster. The follower\n+requests that a recovery session be initiated on the primary shard in the\n+leader cluster. The follower then requests file chunks concurrently from the\n+leader. By default, the process concurrently requests five 1MB file\n+chunks. This default behavior is designed to support leader and follower\n+clusters with high network latency between them.\n+\n+TIP: You can modify dynamic <<ccr-recovery-settings,remote recovery settings>>\n+to rate-limit the transmitted data and manage the resources consumed by remote\n+recoveries.\n+\n+Use the <<cat-recovery,recovery API>> on the cluster containing the follower\n+index to obtain information about an in-progress remote recovery. Because {es}\n+implements remote recoveries using the\n+<<snapshot-restore,snapshot and restore>> infrastructure, running remote\n+recoveries are labelled as type `snapshot` in the recovery API.\n+\n+[discrete]\n+[[ccr-leader-requirements]]\n+=== Requirements for leader indices", "originalCommit": "2aa6578823cdadc4e2057e160ce5ade344b55a33", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDcxMTEzOQ==", "url": "https://github.com/elastic/elasticsearch/pull/60555#discussion_r470711139", "bodyText": "Agreed -- it's good to provide a link for how users can configure this setting. I moved the history retention settings to the Index modules settings page, and then included them in the History retention page to single source the content.\nI think that this addition (with a link on the index.soft_deletes.retention_lease.period setting) provides more context:\n\nThe index.soft_deletes.retention_lease.period setting defines the maximum time to retain a shard history retention lease before it is considered expired. This setting determines how long the cluster containing your leader index can be offline, which is 12 hours by default. If a shard copy recovers after its retention lease expires, then {es} will fall back to copying the entire index, because it can no longer replay the missing history.", "author": "lockewritesdocs", "createdAt": "2020-08-14T15:54:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDIxMjQwNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDIxNDI5OA==", "url": "https://github.com/elastic/elasticsearch/pull/60555#discussion_r470214298", "bodyText": "How about expanding on this: \"to maintain multiple copies of the dataset close to the application servers (and users), to reduce costly latency.", "author": "zuketo", "createdAt": "2020-08-13T20:01:56Z", "path": "docs/reference/ccr/use-cases.asciidoc", "diffHunk": "@@ -0,0 +1,121 @@\n+[role=\"xpack\"]\n+[testenv=\"platinum\"]\n+[[ccr-use-cases]]\n+=== {ccr-cap} use cases\n+++++\n+<titleabbrev>Use cases</titleabbrev>\n+++++\n+\n+Use {ccr} to enable several use cases within the Elastic Stack:\n+\n+* <<ccr-disaster-recovery,Disaster recovery>> in case a primary cluster fails,\n+with a secondary cluster serving as a hot backup\n+* <<ccr-data-locality,Data locality>> to serve reads locally and reduce costly latency", "originalCommit": "2aa6578823cdadc4e2057e160ce5ade344b55a33", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDIxNTY4MA==", "url": "https://github.com/elastic/elasticsearch/pull/60555#discussion_r470215680", "bodyText": "\"for minimizing network traffic and latency in querying multiple geo-distributed ES clusters or for preventing search load from interfering with indexing by offloading search to a secondary cluster\"", "author": "zuketo", "createdAt": "2020-08-13T20:04:24Z", "path": "docs/reference/ccr/use-cases.asciidoc", "diffHunk": "@@ -0,0 +1,121 @@\n+[role=\"xpack\"]\n+[testenv=\"platinum\"]\n+[[ccr-use-cases]]\n+=== {ccr-cap} use cases\n+++++\n+<titleabbrev>Use cases</titleabbrev>\n+++++\n+\n+Use {ccr} to enable several use cases within the Elastic Stack:\n+\n+* <<ccr-disaster-recovery,Disaster recovery>> in case a primary cluster fails,\n+with a secondary cluster serving as a hot backup\n+* <<ccr-data-locality,Data locality>> to serve reads locally and reduce costly latency\n+* <<ccr-centralized-reporting,Centralized reporting>> for preventing search load from interfering with indexing by offloading search to a secondary cluster", "originalCommit": "2aa6578823cdadc4e2057e160ce5ade344b55a33", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDI3NTM5NA==", "url": "https://github.com/elastic/elasticsearch/pull/60555#discussion_r470275394", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            indices for new time series.\n          \n          \n            \n            indices for new time series indices.", "author": "debadair", "createdAt": "2020-08-13T22:06:45Z", "path": "docs/reference/ccr/index.asciidoc", "diffHunk": "@@ -2,28 +2,172 @@\n [testenv=\"platinum\"]\n [[xpack-ccr]]\n == {ccr-cap}\n+With {ccr}, you can enable several <<ccr-use-cases,use cases>> within the\n+Elastic Stack.\n \n-The {ccr} (CCR) feature enables replication of indices in remote clusters to a\n-local cluster. This functionality can be used in some common production use\n-cases:\n+You can replicate indices across clusters to:\n \n-* Disaster recovery in case a primary cluster fails. A secondary cluster can\n-  serve as a hot backup\n-* Geo-proximity so that reads can be served locally\n-* Prevent search load from interfering with indexing by offloading search to a secondary cluster\n+* Continue handling search requests in the event of a datacenter outage\n+* Prevent search volume from impacting indexing throughput\n+* Reduce search latency by processing search requests in geo-proximity to the\n+user\n \n-This guide provides an overview of {ccr}:\n+{ccr-cap} uses an active-passive model. You index to a _leader_ index, and the\n+data is replicated to one or more read-only _follower_ indices. Before you can add a follower index to a cluster, you must configure the _remote cluster_ that contains the leader index.\n \n-* <<ccr-overview>>\n-* <<ccr-requirements>>\n-* <<ccr-auto-follow>>\n+When the leader index receives writes, the follower indices pull changes from\n+the leader index on the remote cluster. You can manually create follower\n+indices, or configure auto-follow patterns to automatically create follower\n+indices for new time series.", "originalCommit": "2aa6578823cdadc4e2057e160ce5ade344b55a33", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDI3NjQwOQ==", "url": "https://github.com/elastic/elasticsearch/pull/60555#discussion_r470276409", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            termination from an external sources such as a firewall.\n          \n          \n            \n            termination by an external source such as a firewall.", "author": "debadair", "createdAt": "2020-08-13T22:09:27Z", "path": "docs/reference/ccr/index.asciidoc", "diffHunk": "@@ -2,28 +2,172 @@\n [testenv=\"platinum\"]\n [[xpack-ccr]]\n == {ccr-cap}\n+With {ccr}, you can enable several <<ccr-use-cases,use cases>> within the\n+Elastic Stack.\n \n-The {ccr} (CCR) feature enables replication of indices in remote clusters to a\n-local cluster. This functionality can be used in some common production use\n-cases:\n+You can replicate indices across clusters to:\n \n-* Disaster recovery in case a primary cluster fails. A secondary cluster can\n-  serve as a hot backup\n-* Geo-proximity so that reads can be served locally\n-* Prevent search load from interfering with indexing by offloading search to a secondary cluster\n+* Continue handling search requests in the event of a datacenter outage\n+* Prevent search volume from impacting indexing throughput\n+* Reduce search latency by processing search requests in geo-proximity to the\n+user\n \n-This guide provides an overview of {ccr}:\n+{ccr-cap} uses an active-passive model. You index to a _leader_ index, and the\n+data is replicated to one or more read-only _follower_ indices. Before you can add a follower index to a cluster, you must configure the _remote cluster_ that contains the leader index.\n \n-* <<ccr-overview>>\n-* <<ccr-requirements>>\n-* <<ccr-auto-follow>>\n+When the leader index receives writes, the follower indices pull changes from\n+the leader index on the remote cluster. You can manually create follower\n+indices, or configure auto-follow patterns to automatically create follower\n+indices for new time series.\n+\n+You configure {ccr} clusters in a uni-directional or bi-directional setup:\n+\n+* In a uni-directional configuration, one cluster contains only\n+leader indices, and the other cluster contains only follower indices.\n+* In a bi-directional configuration, each cluster contains both leader and\n+follower indices.\n+\n+In a uni-directional configuration, the cluster containing follower indices\n+must be running **the same or newer** version of {es} as the remote cluster.\n+If newer, the versions must also be compatible as outlined in the following matrix.\n+\n+[%collapsible]\n+[[ccr-version-compatibility]]\n+.Version compatibility matrix\n+====\n+include::../modules/remote-clusters.asciidoc[tag=remote-cluster-compatibility-matrix]\n+====\n+\n+[discrete]\n+[[ccr-replication-mechanics]]\n+=== Replication mechanics\n+Although you <<ccr-getting-started,set up {ccr}>> at the index level, {es}\n+achieves replication at the shard level. When a follower index is created,\n+each shard in that index pulls changes form its corresponding shard in the\n+leader index, which means that a follower index has the same number of\n+shards as its leader index. All operations are replicated by the follower, so that operations to create, update, or delete a document are replicated.\n+These requests can be served from any copy of the leader shard (primary or\n+replica).\n+\n+When a follower shard sends a read request, the leader shard responds with\n+any new operations, limited by the read parameters that you establish when\n+configuring the follower index. If no new operations are available, the\n+leader shard waits up to the configured timeout for new operations. If the\n+timeout elapses, the leader shard responds to the follower shard that there\n+are no new operations. The follower shard updates shard statistics and\n+immediately sends another read request to the leader shard. This\n+communication model ensures that network connections between the remote\n+cluster and the local cluster are continually in use, avoiding forceful\n+termination from an external sources such as a firewall.", "originalCommit": "2aa6578823cdadc4e2057e160ce5ade344b55a33", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDI3NzIyNQ==", "url": "https://github.com/elastic/elasticsearch/pull/60555#discussion_r470277225", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            NOTE: You cannot manually modify the mapping or alias of a follower index.\n          \n          \n            \n            NOTE: You cannot manually modify a follower index's mappings or aliases.", "author": "debadair", "createdAt": "2020-08-13T22:11:21Z", "path": "docs/reference/ccr/index.asciidoc", "diffHunk": "@@ -2,28 +2,172 @@\n [testenv=\"platinum\"]\n [[xpack-ccr]]\n == {ccr-cap}\n+With {ccr}, you can enable several <<ccr-use-cases,use cases>> within the\n+Elastic Stack.\n \n-The {ccr} (CCR) feature enables replication of indices in remote clusters to a\n-local cluster. This functionality can be used in some common production use\n-cases:\n+You can replicate indices across clusters to:\n \n-* Disaster recovery in case a primary cluster fails. A secondary cluster can\n-  serve as a hot backup\n-* Geo-proximity so that reads can be served locally\n-* Prevent search load from interfering with indexing by offloading search to a secondary cluster\n+* Continue handling search requests in the event of a datacenter outage\n+* Prevent search volume from impacting indexing throughput\n+* Reduce search latency by processing search requests in geo-proximity to the\n+user\n \n-This guide provides an overview of {ccr}:\n+{ccr-cap} uses an active-passive model. You index to a _leader_ index, and the\n+data is replicated to one or more read-only _follower_ indices. Before you can add a follower index to a cluster, you must configure the _remote cluster_ that contains the leader index.\n \n-* <<ccr-overview>>\n-* <<ccr-requirements>>\n-* <<ccr-auto-follow>>\n+When the leader index receives writes, the follower indices pull changes from\n+the leader index on the remote cluster. You can manually create follower\n+indices, or configure auto-follow patterns to automatically create follower\n+indices for new time series.\n+\n+You configure {ccr} clusters in a uni-directional or bi-directional setup:\n+\n+* In a uni-directional configuration, one cluster contains only\n+leader indices, and the other cluster contains only follower indices.\n+* In a bi-directional configuration, each cluster contains both leader and\n+follower indices.\n+\n+In a uni-directional configuration, the cluster containing follower indices\n+must be running **the same or newer** version of {es} as the remote cluster.\n+If newer, the versions must also be compatible as outlined in the following matrix.\n+\n+[%collapsible]\n+[[ccr-version-compatibility]]\n+.Version compatibility matrix\n+====\n+include::../modules/remote-clusters.asciidoc[tag=remote-cluster-compatibility-matrix]\n+====\n+\n+[discrete]\n+[[ccr-replication-mechanics]]\n+=== Replication mechanics\n+Although you <<ccr-getting-started,set up {ccr}>> at the index level, {es}\n+achieves replication at the shard level. When a follower index is created,\n+each shard in that index pulls changes form its corresponding shard in the\n+leader index, which means that a follower index has the same number of\n+shards as its leader index. All operations are replicated by the follower, so that operations to create, update, or delete a document are replicated.\n+These requests can be served from any copy of the leader shard (primary or\n+replica).\n+\n+When a follower shard sends a read request, the leader shard responds with\n+any new operations, limited by the read parameters that you establish when\n+configuring the follower index. If no new operations are available, the\n+leader shard waits up to the configured timeout for new operations. If the\n+timeout elapses, the leader shard responds to the follower shard that there\n+are no new operations. The follower shard updates shard statistics and\n+immediately sends another read request to the leader shard. This\n+communication model ensures that network connections between the remote\n+cluster and the local cluster are continually in use, avoiding forceful\n+termination from an external sources such as a firewall.\n+\n+If a read request fails, the cause of the failure is inspected. If the\n+cause of the failure is deemed to be recoverable (such as a network\n+failure), the follower shard enters into a retry loop. Otherwise, the\n+follower shard pauses\n+<<ccr-pause-replication,until you resume it>>.\n+\n+When a follower shard receives operations from the leader shard, it places\n+those operations in a write buffer. The follower shard uses the write buffer\n+to submit bulk write requests within the shard. If the write buffer exceeds\n+its configured limits, no additional read requests are sent. This configuration\n+provides a back-pressure against read requests, allowing the follower shard\n+to resume sending read requests when the write buffer is no longer full.\n+\n+To manage how operations are replicated from the leader index, you can\n+configure settings when\n+<<ccr-getting-started-follower-index,creating the follower index>>.\n+\n+The follower index automatically retrieves some updates applied to the leader\n+index, while other updates are retrieved as needed:\n+\n+[cols=\"3\"]\n+|===\n+h| Update type h| Automatic  h| As needed\n+| Alias        | {yes-icon} | {no-icon}\n+| Mapping      | {no-icon}  | {yes-icon}\n+| Settings     | {no-icon}  | {yes-icon}\n+|===\n+\n+For example, changing the number of replicas on the leader index is not\n+replicated by the follower index, so that setting might not be retrieved.\n+\n+NOTE: You cannot manually modify the mapping or alias of a follower index.", "originalCommit": "2aa6578823cdadc4e2057e160ce5ade344b55a33", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDI4MTYwNQ==", "url": "https://github.com/elastic/elasticsearch/pull/60555#discussion_r470281605", "bodyText": "It's not really Elasticsearch that can use the indexes replicated to the disaster recovery datacenter, it's that your application can access the replicated indices if the production cluster is unavailable.", "author": "debadair", "createdAt": "2020-08-13T22:22:57Z", "path": "docs/reference/ccr/use-cases.asciidoc", "diffHunk": "@@ -0,0 +1,121 @@\n+[role=\"xpack\"]\n+[testenv=\"platinum\"]\n+[[ccr-use-cases]]\n+=== {ccr-cap} use cases\n+++++\n+<titleabbrev>Use cases</titleabbrev>\n+++++\n+\n+Use {ccr} to enable several use cases within the Elastic Stack:\n+\n+* <<ccr-disaster-recovery,Disaster recovery>> in case a primary cluster fails,\n+with a secondary cluster serving as a hot backup\n+* <<ccr-data-locality,Data locality>> to serve reads locally and reduce costly latency\n+* <<ccr-centralized-reporting,Centralized reporting>> for preventing search load from interfering with indexing by offloading search to a secondary cluster\n+\n+Watch the\n+https://www.elastic.co/webinars/replicate-elasticsearch-data-with-cross-cluster-replication-ccr[{ccr} webinar] to learn more about the following use cases.\n+Then, <<ccr-getting-started,set up {ccr}>> on your local machine and work\n+through the demo from the webinar.\n+\n+[[ccr-disaster-recovery]]\n+==== Disaster recovery and high availability\n+Disaster recovery provides your mission-critical applications with the\n+tolerance to withstand datacenter or region outages. This use case is the\n+most common deployment of {ccr}. You can configure clusters in different\n+architectures to support disaster recovery and high availability:\n+\n+* <<ccr-single-datacenter-recovery>>\n+* <<ccr-multiple-datacenter-recovery>>\n+* <<ccr-chained-replication>>\n+* <<ccr-bi-directional-replication>>\n+\n+[discrete]\n+[[ccr-single-datacenter-recovery]]\n+===== Single disaster recovery datacenter\n+In this configuration, data is replicated from the production datacenter to the\n+disaster recovery datacenter. Because the follower indices replicate the leader\n+index, {es} can use the disaster recovery datacenter if the production", "originalCommit": "2aa6578823cdadc4e2057e160ce5ade344b55a33", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDY1NTg3MA==", "url": "https://github.com/elastic/elasticsearch/pull/60555#discussion_r470655870", "bodyText": "Changed to read:\n\nBecause the follower indices replicate the leader index, your application can use the disaster recovery datacenter if the production datacenter is unavailable.", "author": "lockewritesdocs", "createdAt": "2020-08-14T14:25:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDI4MTYwNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDI4Mjc5NA==", "url": "https://github.com/elastic/elasticsearch/pull/60555#discussion_r470282794", "bodyText": "The linear arrangement makes the distinction between this and the chained version less obvious. I'd stack the two DR datacenters so you don't have to trace the lines.", "author": "debadair", "createdAt": "2020-08-13T22:26:08Z", "path": "docs/reference/ccr/use-cases.asciidoc", "diffHunk": "@@ -0,0 +1,121 @@\n+[role=\"xpack\"]\n+[testenv=\"platinum\"]\n+[[ccr-use-cases]]\n+=== {ccr-cap} use cases\n+++++\n+<titleabbrev>Use cases</titleabbrev>\n+++++\n+\n+Use {ccr} to enable several use cases within the Elastic Stack:\n+\n+* <<ccr-disaster-recovery,Disaster recovery>> in case a primary cluster fails,\n+with a secondary cluster serving as a hot backup\n+* <<ccr-data-locality,Data locality>> to serve reads locally and reduce costly latency\n+* <<ccr-centralized-reporting,Centralized reporting>> for preventing search load from interfering with indexing by offloading search to a secondary cluster\n+\n+Watch the\n+https://www.elastic.co/webinars/replicate-elasticsearch-data-with-cross-cluster-replication-ccr[{ccr} webinar] to learn more about the following use cases.\n+Then, <<ccr-getting-started,set up {ccr}>> on your local machine and work\n+through the demo from the webinar.\n+\n+[[ccr-disaster-recovery]]\n+==== Disaster recovery and high availability\n+Disaster recovery provides your mission-critical applications with the\n+tolerance to withstand datacenter or region outages. This use case is the\n+most common deployment of {ccr}. You can configure clusters in different\n+architectures to support disaster recovery and high availability:\n+\n+* <<ccr-single-datacenter-recovery>>\n+* <<ccr-multiple-datacenter-recovery>>\n+* <<ccr-chained-replication>>\n+* <<ccr-bi-directional-replication>>\n+\n+[discrete]\n+[[ccr-single-datacenter-recovery]]\n+===== Single disaster recovery datacenter\n+In this configuration, data is replicated from the production datacenter to the\n+disaster recovery datacenter. Because the follower indices replicate the leader\n+index, {es} can use the disaster recovery datacenter if the production\n+datacenter is unavailable.\n+\n+image::images/ccr-arch-disaster-recovery.png[Production datacenter that replicates data to a disaster recovery datacenter]\n+\n+[discrete]\n+[[ccr-multiple-datacenter-recovery]]\n+===== Multiple disaster recovery datacenters\n+You can replicate data from one datacenter to multiple datacenters. This\n+configuration provides both disaster recovery and high availability, ensuring\n+that data is replicated in two datacenters if the primary datacenter is down\n+or unavailable.\n+\n+In the following diagram, data from Datacenter A is replicated to\n+Datacenter B and Datacenter C, which both have a read-only copy of the leader\n+index from Datacenter A.\n+\n+image::images/ccr-arch-multiple-dcs.png[Production datacenter that replicates data to two other datacenters]", "originalCommit": "2aa6578823cdadc4e2057e160ce5ade344b55a33", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDY0ODc0Mg==", "url": "https://github.com/elastic/elasticsearch/pull/60555#discussion_r470648742", "bodyText": "Agreed. I'm going to redo all of those diagrams for color and size consistency, and will update this one to show the flow better.", "author": "lockewritesdocs", "createdAt": "2020-08-14T14:13:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDI4Mjc5NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDI4MzUzOQ==", "url": "https://github.com/elastic/elasticsearch/pull/60555#discussion_r470283539", "bodyText": "This reverses the data flow from the earlier diagrams--I'd be consistent.", "author": "debadair", "createdAt": "2020-08-13T22:28:20Z", "path": "docs/reference/ccr/use-cases.asciidoc", "diffHunk": "@@ -0,0 +1,121 @@\n+[role=\"xpack\"]\n+[testenv=\"platinum\"]\n+[[ccr-use-cases]]\n+=== {ccr-cap} use cases\n+++++\n+<titleabbrev>Use cases</titleabbrev>\n+++++\n+\n+Use {ccr} to enable several use cases within the Elastic Stack:\n+\n+* <<ccr-disaster-recovery,Disaster recovery>> in case a primary cluster fails,\n+with a secondary cluster serving as a hot backup\n+* <<ccr-data-locality,Data locality>> to serve reads locally and reduce costly latency\n+* <<ccr-centralized-reporting,Centralized reporting>> for preventing search load from interfering with indexing by offloading search to a secondary cluster\n+\n+Watch the\n+https://www.elastic.co/webinars/replicate-elasticsearch-data-with-cross-cluster-replication-ccr[{ccr} webinar] to learn more about the following use cases.\n+Then, <<ccr-getting-started,set up {ccr}>> on your local machine and work\n+through the demo from the webinar.\n+\n+[[ccr-disaster-recovery]]\n+==== Disaster recovery and high availability\n+Disaster recovery provides your mission-critical applications with the\n+tolerance to withstand datacenter or region outages. This use case is the\n+most common deployment of {ccr}. You can configure clusters in different\n+architectures to support disaster recovery and high availability:\n+\n+* <<ccr-single-datacenter-recovery>>\n+* <<ccr-multiple-datacenter-recovery>>\n+* <<ccr-chained-replication>>\n+* <<ccr-bi-directional-replication>>\n+\n+[discrete]\n+[[ccr-single-datacenter-recovery]]\n+===== Single disaster recovery datacenter\n+In this configuration, data is replicated from the production datacenter to the\n+disaster recovery datacenter. Because the follower indices replicate the leader\n+index, {es} can use the disaster recovery datacenter if the production\n+datacenter is unavailable.\n+\n+image::images/ccr-arch-disaster-recovery.png[Production datacenter that replicates data to a disaster recovery datacenter]\n+\n+[discrete]\n+[[ccr-multiple-datacenter-recovery]]\n+===== Multiple disaster recovery datacenters\n+You can replicate data from one datacenter to multiple datacenters. This\n+configuration provides both disaster recovery and high availability, ensuring\n+that data is replicated in two datacenters if the primary datacenter is down\n+or unavailable.\n+\n+In the following diagram, data from Datacenter A is replicated to\n+Datacenter B and Datacenter C, which both have a read-only copy of the leader\n+index from Datacenter A.\n+\n+image::images/ccr-arch-multiple-dcs.png[Production datacenter that replicates data to two other datacenters]\n+\n+[discrete]\n+[[ccr-chained-replication]]\n+===== Chained replication\n+You can replicate data across multiple datacenters to form a replication\n+chain. In the following diagram, Datacenter A contains the leader index.\n+Datacenter B replicates data from Datacenter A, and Datacenter C replicates\n+from the follower indices in Datacenter B. The connection between these\n+datacenters forms a chained replication pattern.\n+\n+image::images/ccr-arch-chain-dcs.png[Three datacenters connected to form a replication chain]\n+\n+[discrete]\n+[[ccr-bi-directional-replication]]\n+===== Bi-directional replication\n+In a https://www.elastic.co/blog/bi-directional-replication-with-elasticsearch-cross-cluster-replication-ccr[bi-directional replication] setup, all clusters have access to view\n+all data, and all clusters have an index to write to without manually\n+implementing failover. Applications can write to the local index within each\n+datacenter, and read across multiple indices for a global view of all\n+information.\n+\n+This configuration requires no manual intervention when a cluster or datacenter\n+is unavailable. In the following diagram, if Datacenter A is unavailable, you can continue using Datacenter B without manual failover. When Datacenter A\n+comes online, replication resumes between the clusters.\n+\n+image::images/ccr-arch-bi-directional.png[Bi-directional configuration where each cluster contains both a leader index and follower indices]\n+\n+NOTE: This configuration is useful for index-only workloads, where no updates\n+to document values occur. In this configuration, documents indexed by {es} are\n+immutable. Clients are located in each datacenter alongside the {es}\n+cluster, and do not communicate with clusters in different datacenters.\n+\n+[[ccr-data-locality]]\n+==== Data locality\n+Bringing data closer to your users or application server can reduce latency\n+and response time. This methodology also applies when replicating data in {es}.\n+For example, you can replicate a product catalog or reference dataset to 20 or\n+more datacenters around the world to minimize the distance between the data and\n+the application server.\n+\n+In the following diagram, data is replicated from one datacenter to three\n+additional datacenters, each in their own region. The central datacenter\n+contains the leader index, and the additional datacenters contain follower\n+indices that replicate data in that particular region. This configuration\n+puts data closer to the application accessing it.\n+\n+image::images/ccr-arch-data-locality.png[A centralized datacenter replicated across three other datacenters, each in their own region]", "originalCommit": "2aa6578823cdadc4e2057e160ce5ade344b55a33", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDYyMDU3Ng==", "url": "https://github.com/elastic/elasticsearch/pull/60555#discussion_r470620576", "bodyText": "Good point. I'll reverse the diagram so that data flows left -> right.", "author": "lockewritesdocs", "createdAt": "2020-08-14T13:23:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDI4MzUzOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDI4ODc4MA==", "url": "https://github.com/elastic/elasticsearch/pull/60555#discussion_r470288780", "bodyText": "I think this level of information is super helpful. I'd be inclined to avoid \"use case\" (which has a strong application/solution connotation) in favor of something like \"Multi-cluster architectures\".\nI'm also wondering if this can be incorporated into the overview--it's really information that you are probably interested in before you read about the mechanics of the implementation.\nMaybe the overview could look something like:\nCross cluster replication\nReplication model\nMulti-cluster architectures\nReplication mechanics\nInitializing followers uses remote recovery\nReplicating a leader relies on soft deletes", "author": "debadair", "createdAt": "2020-08-13T22:43:30Z", "path": "docs/reference/ccr/use-cases.asciidoc", "diffHunk": "@@ -0,0 +1,121 @@\n+[role=\"xpack\"]", "originalCommit": "2aa6578823cdadc4e2057e160ce5ade344b55a33", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDg1MDQzNQ==", "url": "https://github.com/elastic/elasticsearch/pull/60555#discussion_r470850435", "bodyText": "I waffled on that idea, but I think you're right - integrating that information into the overview makes sense.", "author": "lockewritesdocs", "createdAt": "2020-08-14T20:27:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDI4ODc4MA=="}], "type": "inlineReview"}, {"oid": "6665a0584095371e93c6905e4d295a6bdbac2e6d", "url": "https://github.com/elastic/elasticsearch/commit/6665a0584095371e93c6905e4d295a6bdbac2e6d", "message": "Incorporating feedback from reviewers.", "committedDate": "2020-08-14T16:29:57Z", "type": "commit"}, {"oid": "2cad89a3519739a6788b7a8e9bb936dbe0adb4ba", "url": "https://github.com/elastic/elasticsearch/commit/2cad89a3519739a6788b7a8e9bb936dbe0adb4ba", "message": "Apply suggestions from code review\n\nCo-authored-by: debadair <debadair@elastic.co>", "committedDate": "2020-08-14T16:31:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDY3NDQ5OQ==", "url": "https://github.com/elastic/elasticsearch/pull/60555#discussion_r470674499", "bodyText": "Replace left with side.", "author": "gchaps", "createdAt": "2020-08-14T14:52:49Z", "path": "docs/reference/ccr/getting-started.asciidoc", "diffHunk": "@@ -76,19 +68,31 @@ ccr_user:\n --------------------------------------------------\n \n If you are managing\n-<<ccr-getting-started-remote-cluster,connecting to the remote cluster>> via the\n-cluster update settings API, you will also need a user with the `all` cluster\n-privilege.\n---\n-\n+<<ccr-getting-started-remote-cluster,connecting to the remote cluster>> using\n+the cluster update settings API, you will also need a user with the `all`\n+cluster privilege.\n \n [[ccr-getting-started-remote-cluster]]\n-==== Connecting to a remote cluster\n+==== Connect to a remote cluster\n+Connect your local cluster to a\n+<<modules-remote-clusters,remote cluster>> to begin using cross-cluster\n+replication.\n+\n+To configure a {kibana-ref}/working-remote-clusters.html[remote cluster],\n+access {kib} and go to\n+*Management > Stack Management*. In the left navigation, select", "originalCommit": "2aa6578823cdadc4e2057e160ce5ade344b55a33", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDY3NTI0OQ==", "url": "https://github.com/elastic/elasticsearch/pull/60555#discussion_r470675249", "bodyText": "Suggest removing \"to access the Remote Clusters page\" as it is implied when you click Remote Clusters.  Also, we try to avoid using \"page\".", "author": "gchaps", "createdAt": "2020-08-14T14:54:05Z", "path": "docs/reference/ccr/getting-started.asciidoc", "diffHunk": "@@ -76,19 +68,31 @@ ccr_user:\n --------------------------------------------------\n \n If you are managing\n-<<ccr-getting-started-remote-cluster,connecting to the remote cluster>> via the\n-cluster update settings API, you will also need a user with the `all` cluster\n-privilege.\n---\n-\n+<<ccr-getting-started-remote-cluster,connecting to the remote cluster>> using\n+the cluster update settings API, you will also need a user with the `all`\n+cluster privilege.\n \n [[ccr-getting-started-remote-cluster]]\n-==== Connecting to a remote cluster\n+==== Connect to a remote cluster\n+Connect your local cluster to a\n+<<modules-remote-clusters,remote cluster>> to begin using cross-cluster\n+replication.\n+\n+To configure a {kibana-ref}/working-remote-clusters.html[remote cluster],\n+access {kib} and go to\n+*Management > Stack Management*. In the left navigation, select\n+*Remote Clusters* to access the Remote Clusters page.", "originalCommit": "2aa6578823cdadc4e2057e160ce5ade344b55a33", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDY3Njg5MQ==", "url": "https://github.com/elastic/elasticsearch/pull/60555#discussion_r470676891", "bodyText": "This image is what you see when you open Remote Clusters.  Do you want to show the Add Remote Cluster page here instead so that it follows the text in the paragraph?", "author": "gchaps", "createdAt": "2020-08-14T14:56:51Z", "path": "docs/reference/ccr/getting-started.asciidoc", "diffHunk": "@@ -76,19 +68,31 @@ ccr_user:\n --------------------------------------------------\n \n If you are managing\n-<<ccr-getting-started-remote-cluster,connecting to the remote cluster>> via the\n-cluster update settings API, you will also need a user with the `all` cluster\n-privilege.\n---\n-\n+<<ccr-getting-started-remote-cluster,connecting to the remote cluster>> using\n+the cluster update settings API, you will also need a user with the `all`\n+cluster privilege.\n \n [[ccr-getting-started-remote-cluster]]\n-==== Connecting to a remote cluster\n+==== Connect to a remote cluster\n+Connect your local cluster to a\n+<<modules-remote-clusters,remote cluster>> to begin using cross-cluster\n+replication.\n+\n+To configure a {kibana-ref}/working-remote-clusters.html[remote cluster],\n+access {kib} and go to\n+*Management > Stack Management*. In the left navigation, select\n+*Remote Clusters* to access the Remote Clusters page.\n+\n+Add a remote cluster by specifying the IP address or host name, followed by the\n+transport port of the remote cluster.\n+\n+[role=\"screenshot\"]", "originalCommit": "2aa6578823cdadc4e2057e160ce5ade344b55a33", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDY5NTk2Ng==", "url": "https://github.com/elastic/elasticsearch/pull/60555#discussion_r470695966", "bodyText": "side navigation", "author": "gchaps", "createdAt": "2020-08-14T15:26:14Z", "path": "docs/reference/ccr/getting-started.asciidoc", "diffHunk": "@@ -201,20 +202,66 @@ PUT /server-metrics\n }\n --------------------------------------------------\n // TEST[continued]\n+====\n \n+[[ccr-enable-soft-deletes]]\n+==== Enable soft deletes on leader indices\n+<<ccr-leader-requirements,Soft deletes>> must be enabled for indices that you want to\n+use as leader indices. Soft deletes are enabled by default on new indices\n+created on or after {es} 7.0.0, so\n+*no further action is required if your cluster is running {es} 7.0.0 or later*.\n \n-[[ccr-getting-started-follower-index]]\n-==== Creating a follower index\n+include::{es-ref-dir}/ccr/index.asciidoc[tag=ccr-existing-indices-tag]\n \n-Follower indices are created with the {ref}/ccr-put-follow.html[create follower\n-API]. When you create a follower index, you must reference the\n+To enable soft deletes on indices created on versions of\n+{es} between 6.5.0 and 7.0.0, set <<ccr-index-soft-deletes,`index.soft_deletes.enabled`>> to `true`.\n+\n+[[ccr-getting-started-follower-index]]\n+==== Create a follower index\n+When you create a {kibana-ref}/managing-cross-cluster-replication.html#_create_specific_follower_indices[follower index], you\n+must reference the\n <<ccr-getting-started-remote-cluster,remote cluster>> and the\n <<ccr-getting-started-leader-index,leader index>> that you created in the remote\n cluster.\n \n+To create a follower index, access {kib} and go to\n+*Management > Stack Management*. In the left navigation, select", "originalCommit": "2aa6578823cdadc4e2057e160ce5ade344b55a33", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDY5OTI2MA==", "url": "https://github.com/elastic/elasticsearch/pull/60555#discussion_r470699260", "bodyText": "It would be useful if this image included more than one name.  However,  it might also be more interesting to the user to show the Add follower page with some default values and place it after step 2.", "author": "gchaps", "createdAt": "2020-08-14T15:32:21Z", "path": "docs/reference/ccr/getting-started.asciidoc", "diffHunk": "@@ -201,20 +202,66 @@ PUT /server-metrics\n }\n --------------------------------------------------\n // TEST[continued]\n+====\n \n+[[ccr-enable-soft-deletes]]\n+==== Enable soft deletes on leader indices\n+<<ccr-leader-requirements,Soft deletes>> must be enabled for indices that you want to\n+use as leader indices. Soft deletes are enabled by default on new indices\n+created on or after {es} 7.0.0, so\n+*no further action is required if your cluster is running {es} 7.0.0 or later*.\n \n-[[ccr-getting-started-follower-index]]\n-==== Creating a follower index\n+include::{es-ref-dir}/ccr/index.asciidoc[tag=ccr-existing-indices-tag]\n \n-Follower indices are created with the {ref}/ccr-put-follow.html[create follower\n-API]. When you create a follower index, you must reference the\n+To enable soft deletes on indices created on versions of\n+{es} between 6.5.0 and 7.0.0, set <<ccr-index-soft-deletes,`index.soft_deletes.enabled`>> to `true`.\n+\n+[[ccr-getting-started-follower-index]]\n+==== Create a follower index\n+When you create a {kibana-ref}/managing-cross-cluster-replication.html#_create_specific_follower_indices[follower index], you\n+must reference the\n <<ccr-getting-started-remote-cluster,remote cluster>> and the\n <<ccr-getting-started-leader-index,leader index>> that you created in the remote\n cluster.\n \n+To create a follower index, access {kib} and go to\n+*Management > Stack Management*. In the left navigation, select\n+*Cross Cluster Replication* and choose the *Follower Indices* tab.\n+\n+. Choose the remote cluster containing the index you want to replicate, which\n+is `leader` if you are following the tutorial.\n+. Enter the name of the leader index, which is `server-metrics` if you are\n+following the tutorial.\n+\n+The follower index is initialized using the\n+<<ccr-remote-recovery, remote recovery>>\n+process, which transfers the existing Lucene segment files from the leader\n+index to the follower index. The index status changes to *Paused*. When the\n+remote recovery process is complete, the index following begins and the status\n+changes to *Active*.\n+\n+When you index documents into your leader index, the documents are replicated\n+in the follower index.\n+\n+[role=\"screenshot\"]", "originalCommit": "2aa6578823cdadc4e2057e160ce5ade344b55a33", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDc3NjU3MQ==", "url": "https://github.com/elastic/elasticsearch/pull/60555#discussion_r470776571", "bodyText": "I'll add a screenshot after step 2 and also add more follower indices for this screenshot \ud83d\udc4d", "author": "lockewritesdocs", "createdAt": "2020-08-14T18:06:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDY5OTI2MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDcwMTQ3MA==", "url": "https://github.com/elastic/elasticsearch/pull/60555#discussion_r470701470", "bodyText": "Instead of this image, suggest showing the Add auto follow UI with the values filled out per your tutorial.", "author": "gchaps", "createdAt": "2020-08-14T15:36:39Z", "path": "docs/reference/ccr/getting-started.asciidoc", "diffHunk": "@@ -235,53 +282,65 @@ PUT /server-metrics-copy/_ccr/follow?wait_for_active_shards=1\n \n //////////////////////////\n \n-The follower index is initialized using the <<remote-recovery, remote recovery>>\n-process. The remote recovery process transfers the existing Lucene segment files\n-from the leader to the follower. When the remote recovery process is complete,\n-the index following begins.\n-\n-Now when you index documents into your leader index, you will see these\n-documents replicated in the follower index. You can\n-inspect the status of replication using the\n-{ref}/ccr-get-follow-stats.html[get follower stats API].\n-\n-Alternatively, you can {kibana-ref}/managing-cross-cluster-replication.html#_create_specific_follower_indices[manage follower indices] using {kib}:\n-\n-. From the {kib} menu, click *Management -> Stack Management*.\n-. Under *Data*, select *Cross Cluster Replication*.\n-. Choose the *Follower indices* tab.\n-\n-[role=\"screenshot\"]\n-image::images/ccr-follower-index.png[\"The Cross-Cluster Replication page in {kib}\"]\n+Use the\n+<<ccr-get-follow-stats,get follower stats API>> to inspect the status of\n+replication\n \n //////////////////////////\n \n [source,console]\n --------------------------------------------------\n-POST /server-metrics-copy/_ccr/pause_follow\n+POST /server-metrics-follower/_ccr/pause_follow\n \n-POST /server-metrics-copy/_close\n+POST /server-metrics-follower/_close\n \n-POST /server-metrics-copy/_ccr/unfollow\n+POST /server-metrics-follower/_ccr/unfollow\n --------------------------------------------------\n // TEST[continued]\n \n //////////////////////////\n-\n+====\n \n [[ccr-getting-started-auto-follow]]\n ==== Automatically create follower indices\n+Create <<ccr-auto-follow,auto-follow patterns>> to automatically follow time\n+series indices that are periodically created in a remote cluster (such as daily\n+{beats} indices).\n \n-The <<ccr-auto-follow,auto-follow>> feature in {ccr} helps for time series use\n-cases where you want to follow new indices that are periodically created in the\n-remote cluster (such as daily Beats indices). Auto-following is configured using\n-the {ref}/ccr-put-auto-follow-pattern.html[create auto-follow pattern API]. With\n-an auto-follow pattern, you reference the\n-<<ccr-getting-started-remote-cluster,remote cluster>> that you connected your\n-local cluster to. You must also specify a collection of  patterns that match the\n+With an auto-follow pattern, you reference the\n+<<ccr-getting-started-remote-cluster,remote cluster>> connected to your\n+local cluster. You must also specify a collection of patterns that match the\n indices you want to automatically follow.\n \n-For example:\n+// tag::ccr-create-auto-follow-pattern-tag[]\n+To create follower indices from an {kibana-ref}/managing-cross-cluster-replication.html#_create_follower_indices_from_an_auto_follow_pattern[auto-follow pattern],\n+access {kib} on your remote cluster and go to\n+*Management > Stack Management*. In the left navigation, select\n+*Cross Cluster Replication* and choose the *Auto-follow patterns* tab.\n+\n+[role=\"screenshot\"]", "originalCommit": "2aa6578823cdadc4e2057e160ce5ade344b55a33", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDcwMTg1MQ==", "url": "https://github.com/elastic/elasticsearch/pull/60555#discussion_r470701851", "bodyText": "Suggest making this a numbered list as in the previous section.", "author": "gchaps", "createdAt": "2020-08-14T15:37:22Z", "path": "docs/reference/ccr/getting-started.asciidoc", "diffHunk": "@@ -235,53 +282,65 @@ PUT /server-metrics-copy/_ccr/follow?wait_for_active_shards=1\n \n //////////////////////////\n \n-The follower index is initialized using the <<remote-recovery, remote recovery>>\n-process. The remote recovery process transfers the existing Lucene segment files\n-from the leader to the follower. When the remote recovery process is complete,\n-the index following begins.\n-\n-Now when you index documents into your leader index, you will see these\n-documents replicated in the follower index. You can\n-inspect the status of replication using the\n-{ref}/ccr-get-follow-stats.html[get follower stats API].\n-\n-Alternatively, you can {kibana-ref}/managing-cross-cluster-replication.html#_create_specific_follower_indices[manage follower indices] using {kib}:\n-\n-. From the {kib} menu, click *Management -> Stack Management*.\n-. Under *Data*, select *Cross Cluster Replication*.\n-. Choose the *Follower indices* tab.\n-\n-[role=\"screenshot\"]\n-image::images/ccr-follower-index.png[\"The Cross-Cluster Replication page in {kib}\"]\n+Use the\n+<<ccr-get-follow-stats,get follower stats API>> to inspect the status of\n+replication\n \n //////////////////////////\n \n [source,console]\n --------------------------------------------------\n-POST /server-metrics-copy/_ccr/pause_follow\n+POST /server-metrics-follower/_ccr/pause_follow\n \n-POST /server-metrics-copy/_close\n+POST /server-metrics-follower/_close\n \n-POST /server-metrics-copy/_ccr/unfollow\n+POST /server-metrics-follower/_ccr/unfollow\n --------------------------------------------------\n // TEST[continued]\n \n //////////////////////////\n-\n+====\n \n [[ccr-getting-started-auto-follow]]\n ==== Automatically create follower indices\n+Create <<ccr-auto-follow,auto-follow patterns>> to automatically follow time\n+series indices that are periodically created in a remote cluster (such as daily\n+{beats} indices).\n \n-The <<ccr-auto-follow,auto-follow>> feature in {ccr} helps for time series use\n-cases where you want to follow new indices that are periodically created in the\n-remote cluster (such as daily Beats indices). Auto-following is configured using\n-the {ref}/ccr-put-auto-follow-pattern.html[create auto-follow pattern API]. With\n-an auto-follow pattern, you reference the\n-<<ccr-getting-started-remote-cluster,remote cluster>> that you connected your\n-local cluster to. You must also specify a collection of  patterns that match the\n+With an auto-follow pattern, you reference the\n+<<ccr-getting-started-remote-cluster,remote cluster>> connected to your\n+local cluster. You must also specify a collection of patterns that match the\n indices you want to automatically follow.\n \n-For example:\n+// tag::ccr-create-auto-follow-pattern-tag[]\n+To create follower indices from an {kibana-ref}/managing-cross-cluster-replication.html#_create_follower_indices_from_an_auto_follow_pattern[auto-follow pattern],\n+access {kib} on your remote cluster and go to\n+*Management > Stack Management*. In the left navigation, select\n+*Cross Cluster Replication* and choose the *Auto-follow patterns* tab.\n+\n+[role=\"screenshot\"]\n+image::images/auto-follow-patterns.png[\"The Auto-follow patterns page in {kib}\"]\n+\n+* Enter a name for the auto-follow pattern. For this tutorial, enter `beats`", "originalCommit": "2aa6578823cdadc4e2057e160ce5ade344b55a33", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDcwMjAxMw==", "url": "https://github.com/elastic/elasticsearch/pull/60555#discussion_r470702013", "bodyText": "side navigation", "author": "gchaps", "createdAt": "2020-08-14T15:37:39Z", "path": "docs/reference/ccr/getting-started.asciidoc", "diffHunk": "@@ -235,53 +282,65 @@ PUT /server-metrics-copy/_ccr/follow?wait_for_active_shards=1\n \n //////////////////////////\n \n-The follower index is initialized using the <<remote-recovery, remote recovery>>\n-process. The remote recovery process transfers the existing Lucene segment files\n-from the leader to the follower. When the remote recovery process is complete,\n-the index following begins.\n-\n-Now when you index documents into your leader index, you will see these\n-documents replicated in the follower index. You can\n-inspect the status of replication using the\n-{ref}/ccr-get-follow-stats.html[get follower stats API].\n-\n-Alternatively, you can {kibana-ref}/managing-cross-cluster-replication.html#_create_specific_follower_indices[manage follower indices] using {kib}:\n-\n-. From the {kib} menu, click *Management -> Stack Management*.\n-. Under *Data*, select *Cross Cluster Replication*.\n-. Choose the *Follower indices* tab.\n-\n-[role=\"screenshot\"]\n-image::images/ccr-follower-index.png[\"The Cross-Cluster Replication page in {kib}\"]\n+Use the\n+<<ccr-get-follow-stats,get follower stats API>> to inspect the status of\n+replication\n \n //////////////////////////\n \n [source,console]\n --------------------------------------------------\n-POST /server-metrics-copy/_ccr/pause_follow\n+POST /server-metrics-follower/_ccr/pause_follow\n \n-POST /server-metrics-copy/_close\n+POST /server-metrics-follower/_close\n \n-POST /server-metrics-copy/_ccr/unfollow\n+POST /server-metrics-follower/_ccr/unfollow\n --------------------------------------------------\n // TEST[continued]\n \n //////////////////////////\n-\n+====\n \n [[ccr-getting-started-auto-follow]]\n ==== Automatically create follower indices\n+Create <<ccr-auto-follow,auto-follow patterns>> to automatically follow time\n+series indices that are periodically created in a remote cluster (such as daily\n+{beats} indices).\n \n-The <<ccr-auto-follow,auto-follow>> feature in {ccr} helps for time series use\n-cases where you want to follow new indices that are periodically created in the\n-remote cluster (such as daily Beats indices). Auto-following is configured using\n-the {ref}/ccr-put-auto-follow-pattern.html[create auto-follow pattern API]. With\n-an auto-follow pattern, you reference the\n-<<ccr-getting-started-remote-cluster,remote cluster>> that you connected your\n-local cluster to. You must also specify a collection of  patterns that match the\n+With an auto-follow pattern, you reference the\n+<<ccr-getting-started-remote-cluster,remote cluster>> connected to your\n+local cluster. You must also specify a collection of patterns that match the\n indices you want to automatically follow.\n \n-For example:\n+// tag::ccr-create-auto-follow-pattern-tag[]\n+To create follower indices from an {kibana-ref}/managing-cross-cluster-replication.html#_create_follower_indices_from_an_auto_follow_pattern[auto-follow pattern],\n+access {kib} on your remote cluster and go to\n+*Management > Stack Management*. In the left navigation, select", "originalCommit": "2aa6578823cdadc4e2057e160ce5ade344b55a33", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDcxMjIwMg==", "url": "https://github.com/elastic/elasticsearch/pull/60555#discussion_r470712202", "bodyText": "select the name of the follower index in Index Management.", "author": "gchaps", "createdAt": "2020-08-14T15:56:46Z", "path": "docs/reference/ccr/managing.asciidoc", "diffHunk": "@@ -0,0 +1,164 @@\n+[role=\"xpack\"]\n+[testenv=\"platinum\"]\n+\n+//////////////////////////\n+\n+[source,console]\n+--------------------------------------------------\n+PUT /follower_index/_ccr/follow?wait_for_active_shards=1\n+{\n+  \"remote_cluster\" : \"remote_cluster\",\n+  \"leader_index\" : \"leader_index\"\n+}\n+--------------------------------------------------\n+// TESTSETUP\n+// TEST[setup:remote_cluster_and_leader_index]\n+\n+[source,console]\n+--------------------------------------------------\n+POST /follower_index/_ccr/pause_follow\n+--------------------------------------------------\n+// TEARDOWN\n+\n+//////////////////////////\n+\n+[[ccr-managing]]\n+=== Manage {ccr}\n+Use the following information to manage {ccr} tasks, such as inspecting\n+replication progress, pausing and resuming replication, recreating a follower\n+index, and terminating replication.\n+\n+[[ccr-inspect-progress]]\n+==== Inspect replication statistics\n+To inspect the progress of replication for a follower index and view\n+detailed shard statistics, access {kib} and go to\n+*Management > Stack Management*. In the left navigation,\n+select *Cross Cluster Replication* and choose the *Follower indices* tab.\n+\n+Select the name of the follower index you want to view replication details\n+for. The slide-out panel shows settings and replication statistics for the\n+follower index, including read and write operations that are managed by the\n+follower shard.\n+\n+To view more detailed statistics, click *View in Index Management*, and\n+then select the name of the follower index on the Index Management page.", "originalCommit": "2aa6578823cdadc4e2057e160ce5ade344b55a33", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDcxMjU4OQ==", "url": "https://github.com/elastic/elasticsearch/pull/60555#discussion_r470712589", "bodyText": "Maybe \"Open the tabs for detailed statistics about the follower index.\"", "author": "gchaps", "createdAt": "2020-08-14T15:57:27Z", "path": "docs/reference/ccr/managing.asciidoc", "diffHunk": "@@ -0,0 +1,164 @@\n+[role=\"xpack\"]\n+[testenv=\"platinum\"]\n+\n+//////////////////////////\n+\n+[source,console]\n+--------------------------------------------------\n+PUT /follower_index/_ccr/follow?wait_for_active_shards=1\n+{\n+  \"remote_cluster\" : \"remote_cluster\",\n+  \"leader_index\" : \"leader_index\"\n+}\n+--------------------------------------------------\n+// TESTSETUP\n+// TEST[setup:remote_cluster_and_leader_index]\n+\n+[source,console]\n+--------------------------------------------------\n+POST /follower_index/_ccr/pause_follow\n+--------------------------------------------------\n+// TEARDOWN\n+\n+//////////////////////////\n+\n+[[ccr-managing]]\n+=== Manage {ccr}\n+Use the following information to manage {ccr} tasks, such as inspecting\n+replication progress, pausing and resuming replication, recreating a follower\n+index, and terminating replication.\n+\n+[[ccr-inspect-progress]]\n+==== Inspect replication statistics\n+To inspect the progress of replication for a follower index and view\n+detailed shard statistics, access {kib} and go to\n+*Management > Stack Management*. In the left navigation,\n+select *Cross Cluster Replication* and choose the *Follower indices* tab.\n+\n+Select the name of the follower index you want to view replication details\n+for. The slide-out panel shows settings and replication statistics for the\n+follower index, including read and write operations that are managed by the\n+follower shard.\n+\n+To view more detailed statistics, click *View in Index Management*, and\n+then select the name of the follower index on the Index Management page.\n+Each of the tabs provide detailed statistics about the follower index.", "originalCommit": "2aa6578823cdadc4e2057e160ce5ade344b55a33", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDcxNzA5Ng==", "url": "https://github.com/elastic/elasticsearch/pull/60555#discussion_r470717096", "bodyText": "side navigation", "author": "gchaps", "createdAt": "2020-08-14T16:06:09Z", "path": "docs/reference/ccr/managing.asciidoc", "diffHunk": "@@ -0,0 +1,164 @@\n+[role=\"xpack\"]\n+[testenv=\"platinum\"]\n+\n+//////////////////////////\n+\n+[source,console]\n+--------------------------------------------------\n+PUT /follower_index/_ccr/follow?wait_for_active_shards=1\n+{\n+  \"remote_cluster\" : \"remote_cluster\",\n+  \"leader_index\" : \"leader_index\"\n+}\n+--------------------------------------------------\n+// TESTSETUP\n+// TEST[setup:remote_cluster_and_leader_index]\n+\n+[source,console]\n+--------------------------------------------------\n+POST /follower_index/_ccr/pause_follow\n+--------------------------------------------------\n+// TEARDOWN\n+\n+//////////////////////////\n+\n+[[ccr-managing]]\n+=== Manage {ccr}\n+Use the following information to manage {ccr} tasks, such as inspecting\n+replication progress, pausing and resuming replication, recreating a follower\n+index, and terminating replication.\n+\n+[[ccr-inspect-progress]]\n+==== Inspect replication statistics\n+To inspect the progress of replication for a follower index and view\n+detailed shard statistics, access {kib} and go to\n+*Management > Stack Management*. In the left navigation,\n+select *Cross Cluster Replication* and choose the *Follower indices* tab.\n+\n+Select the name of the follower index you want to view replication details\n+for. The slide-out panel shows settings and replication statistics for the\n+follower index, including read and write operations that are managed by the\n+follower shard.\n+\n+To view more detailed statistics, click *View in Index Management*, and\n+then select the name of the follower index on the Index Management page.\n+Each of the tabs provide detailed statistics about the follower index.\n+\n+[%collapsible]\n+.API example\n+====\n+Use the <<ccr-get-follow-stats,get follower stats API>> to inspect replication\n+progress at the shard level. This API provides insight into the read and writes\n+managed by the follower shard. The API also reports read exceptions that can be\n+retried and fatal exceptions that require user intervention.\n+====\n+\n+[[ccr-pause-replication]]\n+==== Pause and resume replication\n+To pause and resume replication of the leader index, access {kib} and choose\n+*Management > Stack Management*. In the left navigation, select\n+*Cross Cluster Replication* and choose the *Follower indices* tab.\n+\n+Select the follower index you want to pause and choose *Manage > Pause Replication*. The follower index status changes to Paused.\n+\n+To resume replication, select the follower index and choose\n+*Resume replication*.\n+\n+[%collapsible]\n+.API example\n+====\n+You can pause replication with the\n+<<ccr-post-pause-follow,pause follower API>> and then later resume\n+replication with the <<ccr-post-resume-follow,resume follower API>>.\n+Using these APIs in tandem enables you to adjust the read and write parameters\n+on the follower shard task if your initial configuration is not suitable for\n+your use case.\n+====\n+\n+[[ccr-recreate-follower-index]]\n+==== Recreate a follower index\n+When a document is updated or deleted, the underlying operation is retained in\n+the Lucene index for a period of time defined by the\n+<<ccr-index-soft-deletes-retention-period,`index.soft_deletes.retention_lease.period`>> parameter. You configure\n+this setting on the <<ccr-leader-requirements,leader index>>.\n+\n+When a follower index starts, it acquires a retention lease from\n+the leader index. This lease informs the leader that it should not allow a soft\n+delete to be pruned until either the follower indicates that it has received\n+the operation, or until the lease expires.\n+\n+If a follower index falls sufficiently behind a leader and cannot\n+replicate operations, {es} reports an `indices[].fatal_exception` error. To\n+resolve the issue, recreate the follower index. When the new follow index\n+starts, the <<ccr-remote-recovery, remote recovery>> process recopies the\n+Lucene segment files from the leader.\n+\n+IMPORTANT: Recreating the follower index is a destructive action. All existing\n+Lucene segment files are deleted on the cluster containing the follower index.\n+\n+To recreate a follower index, access {kib} and choose\n+*Management > Stack Management*. In the left navigation, select\n+*Cross Cluster Replication* and choose the *Follower indices* tab.\n+\n+[role=\"screenshot\"]\n+image::images/ccr-follower-index.png[\"The Cross-Cluster Replication page in {kib}\"]\n+\n+Select the follower index and pause replication. When the follower index status\n+changes to Paused, reselect the follower index and choose to unfollow the\n+leader index.\n+\n+The follower index will be converted to a standard index and will no longer\n+display on the Cross-Cluster Replication page.\n+\n+In the left navigation, choose *Index Management*. Select the follower index", "originalCommit": "2aa6578823cdadc4e2057e160ce5ade344b55a33", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDcyMTE5MA==", "url": "https://github.com/elastic/elasticsearch/pull/60555#discussion_r470721190", "bodyText": "This info is also on a previous page.  Would a link suffice?", "author": "gchaps", "createdAt": "2020-08-14T16:14:11Z", "path": "docs/reference/ccr/auto-follow.asciidoc", "diffHunk": "@@ -1,32 +1,80 @@\n [role=\"xpack\"]\n [testenv=\"platinum\"]\n [[ccr-auto-follow]]\n-=== Automatically following indices\n-\n-In time series use cases where you want to follow new indices that are\n-periodically created (such as daily Beats indices), manually configuring follower\n-indices for each new leader index can be an operational burden. The auto-follow\n-functionality in {ccr} is aimed at easing this burden. With the auto-follow\n-functionality, you can specify that new indices in a remote cluster that have a \n-name that matches a pattern are automatically followed.\n-\n-==== Managing auto-follow patterns\n-\n-You can add a new auto-follow pattern configuration with the\n-{ref}/ccr-put-auto-follow-pattern.html[create auto-follow pattern API].  When you create\n-a new auto-follow pattern configuration, you are configuring a collection of\n-patterns against a single remote cluster. Any time a new index with a name that \n-matches one of the patterns in the collection is created in the remote cluster,\n-a follower index is configured in the local cluster. The follower index uses the \n-new index as its leader index.\n-\n-You can inspect all configured auto-follow pattern collections with the\n-{ref}/ccr-get-auto-follow-pattern.html[get auto-follow pattern API]. Auto-follow patterns\n-can be paused using the {ref}/ccr-pause-auto-follow-pattern.html[pause auto-follow pattern API]\n- and can be resumed using the {ref}/ccr-resume-auto-follow-pattern.html[resume auto-follow pattern API].\n-  To delete a configured auto-follow pattern collection, use the\n-{ref}/ccr-delete-auto-follow-pattern.html[delete auto-follow pattern API].\n-\n-Since auto-follow functionality is handled automatically in the background on\n-your behalf, error reporting is done through logs on the elected master node\n-and through the {ref}/ccr-get-stats.html[{ccr} stats API].\n+=== Manage auto-follow patterns\n+To replicate time series indices, you configure an auto-follow pattern so that\n+each new index in the series is replicated automatically. Whenever the name of\n+a new index on the remote cluster matches the auto-follow pattern, a\n+corresponding follower index is added to the local cluster.\n+\n+[[ccr-auto-follow-create]]\n+==== Create auto-follow patterns\n+When you create an auto-follow pattern, you are configuring a collection of\n+patterns against a single remote cluster. When an index is created in the\n+remote cluster with a name that matches one of the patterns in the collection,\n+a follower index is configured in the local cluster. The follower\n+index uses the new index as its leader index.\n+\n+include::{es-repo-dir}/ccr/getting-started.asciidoc[tag=ccr-create-auto-follow-pattern-tag]", "originalCommit": "2aa6578823cdadc4e2057e160ce5ade344b55a33", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDg0NTc3MQ==", "url": "https://github.com/elastic/elasticsearch/pull/60555#discussion_r470845771", "bodyText": "Hmm, I was going for completeness, but I think that a link to that task in the Set up CCR page works well.", "author": "lockewritesdocs", "createdAt": "2020-08-14T20:15:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDcyMTE5MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDcyNzQwMA==", "url": "https://github.com/elastic/elasticsearch/pull/60555#discussion_r470727400", "bodyText": "Cross-Cluster Replication", "author": "gchaps", "createdAt": "2020-08-14T16:26:02Z", "path": "docs/reference/ccr/getting-started.asciidoc", "diffHunk": "@@ -201,20 +202,66 @@ PUT /server-metrics\n }\n --------------------------------------------------\n // TEST[continued]\n+====\n \n+[[ccr-enable-soft-deletes]]\n+==== Enable soft deletes on leader indices\n+<<ccr-leader-requirements,Soft deletes>> must be enabled for indices that you want to\n+use as leader indices. Soft deletes are enabled by default on new indices\n+created on or after {es} 7.0.0, so\n+*no further action is required if your cluster is running {es} 7.0.0 or later*.\n \n-[[ccr-getting-started-follower-index]]\n-==== Creating a follower index\n+include::{es-ref-dir}/ccr/index.asciidoc[tag=ccr-existing-indices-tag]\n \n-Follower indices are created with the {ref}/ccr-put-follow.html[create follower\n-API]. When you create a follower index, you must reference the\n+To enable soft deletes on indices created on versions of\n+{es} between 6.5.0 and 7.0.0, set <<ccr-index-soft-deletes,`index.soft_deletes.enabled`>> to `true`.\n+\n+[[ccr-getting-started-follower-index]]\n+==== Create a follower index\n+When you create a {kibana-ref}/managing-cross-cluster-replication.html#_create_specific_follower_indices[follower index], you\n+must reference the\n <<ccr-getting-started-remote-cluster,remote cluster>> and the\n <<ccr-getting-started-leader-index,leader index>> that you created in the remote\n cluster.\n \n+To create a follower index, access {kib} and go to\n+*Management > Stack Management*. In the left navigation, select\n+*Cross Cluster Replication* and choose the *Follower Indices* tab.", "originalCommit": "2aa6578823cdadc4e2057e160ce5ade344b55a33", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "5300e480b7cde9f5dc8cf5a0cf23b32182ad7a6f", "url": "https://github.com/elastic/elasticsearch/commit/5300e480b7cde9f5dc8cf5a0cf23b32182ad7a6f", "message": "Incorporating more review comments.", "committedDate": "2020-08-14T18:07:16Z", "type": "commit"}, {"oid": "cb6d9c2c0dadf44ce5488cd8e7c1f8a2b16f223a", "url": "https://github.com/elastic/elasticsearch/commit/cb6d9c2c0dadf44ce5488cd8e7c1f8a2b16f223a", "message": "Condensing some of the steps for accessing Kibana.", "committedDate": "2020-08-14T21:07:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTUzOTI4Ng==", "url": "https://github.com/elastic/elasticsearch/pull/60555#discussion_r471539286", "bodyText": "form -> from?", "author": "dnhatn", "createdAt": "2020-08-17T15:00:22Z", "path": "docs/reference/ccr/index.asciidoc", "diffHunk": "@@ -2,28 +2,300 @@\n [testenv=\"platinum\"]\n [[xpack-ccr]]\n == {ccr-cap}\n+With {ccr}, you can replicate indices across clusters to:\n \n-The {ccr} (CCR) feature enables replication of indices in remote clusters to a\n-local cluster. This functionality can be used in some common production use\n-cases:\n+* Continue handling search requests in the event of a datacenter outage\n+* Prevent search volume from impacting indexing throughput\n+* Reduce search latency by processing search requests in geo-proximity to the\n+user\n \n-* Disaster recovery in case a primary cluster fails. A secondary cluster can\n-  serve as a hot backup\n-* Geo-proximity so that reads can be served locally\n-* Prevent search load from interfering with indexing by offloading search to a secondary cluster\n+{ccr-cap} uses an active-passive model. You index to a _leader_ index, and the\n+data is replicated to one or more read-only _follower_ indices. Before you can add a follower index to a cluster, you must configure the _remote cluster_ that contains the leader index.\n \n-This guide provides an overview of {ccr}:\n+When the leader index receives writes, the follower indices pull changes from\n+the leader index on the remote cluster. You can manually create follower\n+indices, or configure auto-follow patterns to automatically create follower\n+indices for new time series indices.\n+\n+You configure {ccr} clusters in a uni-directional or bi-directional setup:\n+\n+* In a uni-directional configuration, one cluster contains only\n+leader indices, and the other cluster contains only follower indices.\n+* In a bi-directional configuration, each cluster contains both leader and\n+follower indices.\n+\n+In a uni-directional configuration, the cluster containing follower indices\n+must be running **the same or newer** version of {es} as the remote cluster.\n+If newer, the versions must also be compatible as outlined in the following matrix.\n+\n+[%collapsible]\n+[[ccr-version-compatibility]]\n+.Version compatibility matrix\n+====\n+include::../modules/remote-clusters.asciidoc[tag=remote-cluster-compatibility-matrix]\n+====\n+\n+[discrete]\n+[[ccr-multi-cluster-architectures]]\n+=== Multi-cluster architectures\n+Use {ccr} to construct several multi-cluster architectures within the Elastic\n+Stack:\n+\n+* <<ccr-disaster-recovery,Disaster recovery>> in case a primary cluster fails,\n+with a secondary cluster serving as a hot backup\n+* <<ccr-data-locality,Data locality>> to maintain multiple copies of the\n+dataset close to the application servers (and users), and reduce costly latency\n+* <<ccr-centralized-reporting,Centralized reporting>> for minimizing network\n+traffic and latency in querying multiple geo-distributed {es} clusters, or for\n+preventing search load from interfering with indexing by offloading search to a\n+secondary cluster\n+\n+Watch the\n+https://www.elastic.co/webinars/replicate-elasticsearch-data-with-cross-cluster-replication-ccr[{ccr} webinar] to learn more about the following use cases.\n+Then, <<ccr-getting-started,set up {ccr}>> on your local machine and work\n+through the demo from the webinar.\n+\n+[discrete]\n+[[ccr-disaster-recovery]]\n+==== Disaster recovery and high availability\n+Disaster recovery provides your mission-critical applications with the\n+tolerance to withstand datacenter or region outages. This use case is the\n+most common deployment of {ccr}. You can configure clusters in different\n+architectures to support disaster recovery and high availability:\n+\n+* <<ccr-single-datacenter-recovery>>\n+* <<ccr-multiple-datacenter-recovery>>\n+* <<ccr-chained-replication>>\n+* <<ccr-bi-directional-replication>>\n+\n+[discrete]\n+[[ccr-single-datacenter-recovery]]\n+===== Single disaster recovery datacenter\n+In this configuration, data is replicated from the production datacenter to the\n+disaster recovery datacenter. Because the follower indices replicate the leader\n+index, your application can use the disaster recovery datacenter if the\n+production datacenter is unavailable.\n+\n+image::images/ccr-arch-disaster-recovery.png[Production datacenter that replicates data to a disaster recovery datacenter]\n+\n+[discrete]\n+[[ccr-multiple-datacenter-recovery]]\n+===== Multiple disaster recovery datacenters\n+You can replicate data from one datacenter to multiple datacenters. This\n+configuration provides both disaster recovery and high availability, ensuring\n+that data is replicated in two datacenters if the primary datacenter is down\n+or unavailable.\n+\n+In the following diagram, data from Datacenter A is replicated to\n+Datacenter B and Datacenter C, which both have a read-only copy of the leader\n+index from Datacenter A.\n+\n+image::images/ccr-arch-multiple-dcs.png[Production datacenter that replicates data to two other datacenters]\n+\n+[discrete]\n+[[ccr-chained-replication]]\n+===== Chained replication\n+You can replicate data across multiple datacenters to form a replication\n+chain. In the following diagram, Datacenter A contains the leader index.\n+Datacenter B replicates data from Datacenter A, and Datacenter C replicates\n+from the follower indices in Datacenter B. The connection between these\n+datacenters forms a chained replication pattern.\n+\n+image::images/ccr-arch-chain-dcs.png[Three datacenters connected to form a replication chain]\n+\n+[discrete]\n+[[ccr-bi-directional-replication]]\n+===== Bi-directional replication\n+In a https://www.elastic.co/blog/bi-directional-replication-with-elasticsearch-cross-cluster-replication-ccr[bi-directional replication] setup, all clusters have access to view\n+all data, and all clusters have an index to write to without manually\n+implementing failover. Applications can write to the local index within each\n+datacenter, and read across multiple indices for a global view of all\n+information.\n+\n+This configuration requires no manual intervention when a cluster or datacenter\n+is unavailable. In the following diagram, if Datacenter A is unavailable, you can continue using Datacenter B without manual failover. When Datacenter A\n+comes online, replication resumes between the clusters.\n+\n+image::images/ccr-arch-bi-directional.png[Bi-directional configuration where each cluster contains both a leader index and follower indices]\n+\n+NOTE: This configuration is useful for index-only workloads, where no updates\n+to document values occur. In this configuration, documents indexed by {es} are\n+immutable. Clients are located in each datacenter alongside the {es}\n+cluster, and do not communicate with clusters in different datacenters.\n+\n+[discrete]\n+[[ccr-data-locality]]\n+==== Data locality\n+Bringing data closer to your users or application server can reduce latency\n+and response time. This methodology also applies when replicating data in {es}.\n+For example, you can replicate a product catalog or reference dataset to 20 or\n+more datacenters around the world to minimize the distance between the data and\n+the application server.\n+\n+In the following diagram, data is replicated from one datacenter to three\n+additional datacenters, each in their own region. The central datacenter\n+contains the leader index, and the additional datacenters contain follower\n+indices that replicate data in that particular region. This configuration\n+puts data closer to the application accessing it.\n+\n+image::images/ccr-arch-data-locality.png[A centralized datacenter replicated across three other datacenters, each in their own region]\n+\n+[discrete]\n+[[ccr-centralized-reporting]]\n+==== Centralized reporting\n+Using a centralized reporting cluster is useful when querying across a large\n+network is inefficient. In this configuration, you replicate data from many\n+smaller clusters to the centralized reporting cluster.\n+\n+For example, a large global bank might have 100 {es} clusters around the world\n+that are distributed across different regions for each bank branch. Using\n+{ccr}, the bank can replicate events from all 100 banks to a central cluster to\n+analyze and aggregate events locally for reporting. Rather than maintaining a\n+mirrored cluster, the bank can use {ccr} to replicate specific indices.\n+\n+In the following diagram, data from three datacenters in different regions is\n+replicated to a centralized reporting cluster. This configuration enables you\n+to copy data from regional hubs to a central cluster, where you can run all\n+reports locally.\n+\n+image::images/ccr-arch-central-reporting.png[Three clusters in different regions sending data to a centralized reporting cluster for analysis]\n+\n+[discrete]\n+[[ccr-replication-mechanics]]\n+=== Replication mechanics\n+Although you <<ccr-getting-started,set up {ccr}>> at the index level, {es}\n+achieves replication at the shard level. When a follower index is created,\n+each shard in that index pulls changes form its corresponding shard in the", "originalCommit": "cb6d9c2c0dadf44ce5488cd8e7c1f8a2b16f223a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU0MTM5Ng==", "url": "https://github.com/elastic/elasticsearch/pull/60555#discussion_r471541396", "bodyText": "All operations are replicated by the follower, so that operations to create, update, or delete a document are replicated.`\n\nI am confused about this.", "author": "dnhatn", "createdAt": "2020-08-17T15:03:32Z", "path": "docs/reference/ccr/index.asciidoc", "diffHunk": "@@ -2,28 +2,300 @@\n [testenv=\"platinum\"]\n [[xpack-ccr]]\n == {ccr-cap}\n+With {ccr}, you can replicate indices across clusters to:\n \n-The {ccr} (CCR) feature enables replication of indices in remote clusters to a\n-local cluster. This functionality can be used in some common production use\n-cases:\n+* Continue handling search requests in the event of a datacenter outage\n+* Prevent search volume from impacting indexing throughput\n+* Reduce search latency by processing search requests in geo-proximity to the\n+user\n \n-* Disaster recovery in case a primary cluster fails. A secondary cluster can\n-  serve as a hot backup\n-* Geo-proximity so that reads can be served locally\n-* Prevent search load from interfering with indexing by offloading search to a secondary cluster\n+{ccr-cap} uses an active-passive model. You index to a _leader_ index, and the\n+data is replicated to one or more read-only _follower_ indices. Before you can add a follower index to a cluster, you must configure the _remote cluster_ that contains the leader index.\n \n-This guide provides an overview of {ccr}:\n+When the leader index receives writes, the follower indices pull changes from\n+the leader index on the remote cluster. You can manually create follower\n+indices, or configure auto-follow patterns to automatically create follower\n+indices for new time series indices.\n+\n+You configure {ccr} clusters in a uni-directional or bi-directional setup:\n+\n+* In a uni-directional configuration, one cluster contains only\n+leader indices, and the other cluster contains only follower indices.\n+* In a bi-directional configuration, each cluster contains both leader and\n+follower indices.\n+\n+In a uni-directional configuration, the cluster containing follower indices\n+must be running **the same or newer** version of {es} as the remote cluster.\n+If newer, the versions must also be compatible as outlined in the following matrix.\n+\n+[%collapsible]\n+[[ccr-version-compatibility]]\n+.Version compatibility matrix\n+====\n+include::../modules/remote-clusters.asciidoc[tag=remote-cluster-compatibility-matrix]\n+====\n+\n+[discrete]\n+[[ccr-multi-cluster-architectures]]\n+=== Multi-cluster architectures\n+Use {ccr} to construct several multi-cluster architectures within the Elastic\n+Stack:\n+\n+* <<ccr-disaster-recovery,Disaster recovery>> in case a primary cluster fails,\n+with a secondary cluster serving as a hot backup\n+* <<ccr-data-locality,Data locality>> to maintain multiple copies of the\n+dataset close to the application servers (and users), and reduce costly latency\n+* <<ccr-centralized-reporting,Centralized reporting>> for minimizing network\n+traffic and latency in querying multiple geo-distributed {es} clusters, or for\n+preventing search load from interfering with indexing by offloading search to a\n+secondary cluster\n+\n+Watch the\n+https://www.elastic.co/webinars/replicate-elasticsearch-data-with-cross-cluster-replication-ccr[{ccr} webinar] to learn more about the following use cases.\n+Then, <<ccr-getting-started,set up {ccr}>> on your local machine and work\n+through the demo from the webinar.\n+\n+[discrete]\n+[[ccr-disaster-recovery]]\n+==== Disaster recovery and high availability\n+Disaster recovery provides your mission-critical applications with the\n+tolerance to withstand datacenter or region outages. This use case is the\n+most common deployment of {ccr}. You can configure clusters in different\n+architectures to support disaster recovery and high availability:\n+\n+* <<ccr-single-datacenter-recovery>>\n+* <<ccr-multiple-datacenter-recovery>>\n+* <<ccr-chained-replication>>\n+* <<ccr-bi-directional-replication>>\n+\n+[discrete]\n+[[ccr-single-datacenter-recovery]]\n+===== Single disaster recovery datacenter\n+In this configuration, data is replicated from the production datacenter to the\n+disaster recovery datacenter. Because the follower indices replicate the leader\n+index, your application can use the disaster recovery datacenter if the\n+production datacenter is unavailable.\n+\n+image::images/ccr-arch-disaster-recovery.png[Production datacenter that replicates data to a disaster recovery datacenter]\n+\n+[discrete]\n+[[ccr-multiple-datacenter-recovery]]\n+===== Multiple disaster recovery datacenters\n+You can replicate data from one datacenter to multiple datacenters. This\n+configuration provides both disaster recovery and high availability, ensuring\n+that data is replicated in two datacenters if the primary datacenter is down\n+or unavailable.\n+\n+In the following diagram, data from Datacenter A is replicated to\n+Datacenter B and Datacenter C, which both have a read-only copy of the leader\n+index from Datacenter A.\n+\n+image::images/ccr-arch-multiple-dcs.png[Production datacenter that replicates data to two other datacenters]\n+\n+[discrete]\n+[[ccr-chained-replication]]\n+===== Chained replication\n+You can replicate data across multiple datacenters to form a replication\n+chain. In the following diagram, Datacenter A contains the leader index.\n+Datacenter B replicates data from Datacenter A, and Datacenter C replicates\n+from the follower indices in Datacenter B. The connection between these\n+datacenters forms a chained replication pattern.\n+\n+image::images/ccr-arch-chain-dcs.png[Three datacenters connected to form a replication chain]\n+\n+[discrete]\n+[[ccr-bi-directional-replication]]\n+===== Bi-directional replication\n+In a https://www.elastic.co/blog/bi-directional-replication-with-elasticsearch-cross-cluster-replication-ccr[bi-directional replication] setup, all clusters have access to view\n+all data, and all clusters have an index to write to without manually\n+implementing failover. Applications can write to the local index within each\n+datacenter, and read across multiple indices for a global view of all\n+information.\n+\n+This configuration requires no manual intervention when a cluster or datacenter\n+is unavailable. In the following diagram, if Datacenter A is unavailable, you can continue using Datacenter B without manual failover. When Datacenter A\n+comes online, replication resumes between the clusters.\n+\n+image::images/ccr-arch-bi-directional.png[Bi-directional configuration where each cluster contains both a leader index and follower indices]\n+\n+NOTE: This configuration is useful for index-only workloads, where no updates\n+to document values occur. In this configuration, documents indexed by {es} are\n+immutable. Clients are located in each datacenter alongside the {es}\n+cluster, and do not communicate with clusters in different datacenters.\n+\n+[discrete]\n+[[ccr-data-locality]]\n+==== Data locality\n+Bringing data closer to your users or application server can reduce latency\n+and response time. This methodology also applies when replicating data in {es}.\n+For example, you can replicate a product catalog or reference dataset to 20 or\n+more datacenters around the world to minimize the distance between the data and\n+the application server.\n+\n+In the following diagram, data is replicated from one datacenter to three\n+additional datacenters, each in their own region. The central datacenter\n+contains the leader index, and the additional datacenters contain follower\n+indices that replicate data in that particular region. This configuration\n+puts data closer to the application accessing it.\n+\n+image::images/ccr-arch-data-locality.png[A centralized datacenter replicated across three other datacenters, each in their own region]\n+\n+[discrete]\n+[[ccr-centralized-reporting]]\n+==== Centralized reporting\n+Using a centralized reporting cluster is useful when querying across a large\n+network is inefficient. In this configuration, you replicate data from many\n+smaller clusters to the centralized reporting cluster.\n+\n+For example, a large global bank might have 100 {es} clusters around the world\n+that are distributed across different regions for each bank branch. Using\n+{ccr}, the bank can replicate events from all 100 banks to a central cluster to\n+analyze and aggregate events locally for reporting. Rather than maintaining a\n+mirrored cluster, the bank can use {ccr} to replicate specific indices.\n+\n+In the following diagram, data from three datacenters in different regions is\n+replicated to a centralized reporting cluster. This configuration enables you\n+to copy data from regional hubs to a central cluster, where you can run all\n+reports locally.\n+\n+image::images/ccr-arch-central-reporting.png[Three clusters in different regions sending data to a centralized reporting cluster for analysis]\n+\n+[discrete]\n+[[ccr-replication-mechanics]]\n+=== Replication mechanics\n+Although you <<ccr-getting-started,set up {ccr}>> at the index level, {es}\n+achieves replication at the shard level. When a follower index is created,\n+each shard in that index pulls changes form its corresponding shard in the\n+leader index, which means that a follower index has the same number of\n+shards as its leader index. All operations are replicated by the follower, so that operations to create, update, or delete a document are replicated.", "originalCommit": "cb6d9c2c0dadf44ce5488cd8e7c1f8a2b16f223a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU4Nzc2MQ==", "url": "https://github.com/elastic/elasticsearch/pull/60555#discussion_r471587761", "bodyText": "@dnhatn, that sentence is confusing. How about this version instead?\n\nAll operations on the leader are replicated by the follower, such as operations to create, update, or delete a document.", "author": "lockewritesdocs", "createdAt": "2020-08-17T16:13:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU0MTM5Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTYxNjI1Nw==", "url": "https://github.com/elastic/elasticsearch/pull/60555#discussion_r471616257", "bodyText": "Should it be \"replicated to the follower\" instead of \"replicated by the follower\"?", "author": "dnhatn", "createdAt": "2020-08-17T17:03:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU0MTM5Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTY3NTUyOA==", "url": "https://github.com/elastic/elasticsearch/pull/60555#discussion_r471675528", "bodyText": "Hmm \ud83e\udd14 Isn't the follower index the one that is doing the replicating?\nI could go either way on this one if you feel more strongly about the revised text, or feel that it is more accurate.", "author": "lockewritesdocs", "createdAt": "2020-08-17T18:19:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU0MTM5Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTcxNDkxNg==", "url": "https://github.com/elastic/elasticsearch/pull/60555#discussion_r471714916", "bodyText": "I am fine with the current.", "author": "dnhatn", "createdAt": "2020-08-17T19:01:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU0MTM5Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU0Mzk5OA==", "url": "https://github.com/elastic/elasticsearch/pull/60555#discussion_r471543998", "bodyText": "The follower shard uses the write buffer to submit bulk write requests within the shard\n\nI think we need to adjust this sentence. The follower shard submits bulk write requests using operations from the write buffer.", "author": "dnhatn", "createdAt": "2020-08-17T15:07:30Z", "path": "docs/reference/ccr/index.asciidoc", "diffHunk": "@@ -2,28 +2,300 @@\n [testenv=\"platinum\"]\n [[xpack-ccr]]\n == {ccr-cap}\n+With {ccr}, you can replicate indices across clusters to:\n \n-The {ccr} (CCR) feature enables replication of indices in remote clusters to a\n-local cluster. This functionality can be used in some common production use\n-cases:\n+* Continue handling search requests in the event of a datacenter outage\n+* Prevent search volume from impacting indexing throughput\n+* Reduce search latency by processing search requests in geo-proximity to the\n+user\n \n-* Disaster recovery in case a primary cluster fails. A secondary cluster can\n-  serve as a hot backup\n-* Geo-proximity so that reads can be served locally\n-* Prevent search load from interfering with indexing by offloading search to a secondary cluster\n+{ccr-cap} uses an active-passive model. You index to a _leader_ index, and the\n+data is replicated to one or more read-only _follower_ indices. Before you can add a follower index to a cluster, you must configure the _remote cluster_ that contains the leader index.\n \n-This guide provides an overview of {ccr}:\n+When the leader index receives writes, the follower indices pull changes from\n+the leader index on the remote cluster. You can manually create follower\n+indices, or configure auto-follow patterns to automatically create follower\n+indices for new time series indices.\n+\n+You configure {ccr} clusters in a uni-directional or bi-directional setup:\n+\n+* In a uni-directional configuration, one cluster contains only\n+leader indices, and the other cluster contains only follower indices.\n+* In a bi-directional configuration, each cluster contains both leader and\n+follower indices.\n+\n+In a uni-directional configuration, the cluster containing follower indices\n+must be running **the same or newer** version of {es} as the remote cluster.\n+If newer, the versions must also be compatible as outlined in the following matrix.\n+\n+[%collapsible]\n+[[ccr-version-compatibility]]\n+.Version compatibility matrix\n+====\n+include::../modules/remote-clusters.asciidoc[tag=remote-cluster-compatibility-matrix]\n+====\n+\n+[discrete]\n+[[ccr-multi-cluster-architectures]]\n+=== Multi-cluster architectures\n+Use {ccr} to construct several multi-cluster architectures within the Elastic\n+Stack:\n+\n+* <<ccr-disaster-recovery,Disaster recovery>> in case a primary cluster fails,\n+with a secondary cluster serving as a hot backup\n+* <<ccr-data-locality,Data locality>> to maintain multiple copies of the\n+dataset close to the application servers (and users), and reduce costly latency\n+* <<ccr-centralized-reporting,Centralized reporting>> for minimizing network\n+traffic and latency in querying multiple geo-distributed {es} clusters, or for\n+preventing search load from interfering with indexing by offloading search to a\n+secondary cluster\n+\n+Watch the\n+https://www.elastic.co/webinars/replicate-elasticsearch-data-with-cross-cluster-replication-ccr[{ccr} webinar] to learn more about the following use cases.\n+Then, <<ccr-getting-started,set up {ccr}>> on your local machine and work\n+through the demo from the webinar.\n+\n+[discrete]\n+[[ccr-disaster-recovery]]\n+==== Disaster recovery and high availability\n+Disaster recovery provides your mission-critical applications with the\n+tolerance to withstand datacenter or region outages. This use case is the\n+most common deployment of {ccr}. You can configure clusters in different\n+architectures to support disaster recovery and high availability:\n+\n+* <<ccr-single-datacenter-recovery>>\n+* <<ccr-multiple-datacenter-recovery>>\n+* <<ccr-chained-replication>>\n+* <<ccr-bi-directional-replication>>\n+\n+[discrete]\n+[[ccr-single-datacenter-recovery]]\n+===== Single disaster recovery datacenter\n+In this configuration, data is replicated from the production datacenter to the\n+disaster recovery datacenter. Because the follower indices replicate the leader\n+index, your application can use the disaster recovery datacenter if the\n+production datacenter is unavailable.\n+\n+image::images/ccr-arch-disaster-recovery.png[Production datacenter that replicates data to a disaster recovery datacenter]\n+\n+[discrete]\n+[[ccr-multiple-datacenter-recovery]]\n+===== Multiple disaster recovery datacenters\n+You can replicate data from one datacenter to multiple datacenters. This\n+configuration provides both disaster recovery and high availability, ensuring\n+that data is replicated in two datacenters if the primary datacenter is down\n+or unavailable.\n+\n+In the following diagram, data from Datacenter A is replicated to\n+Datacenter B and Datacenter C, which both have a read-only copy of the leader\n+index from Datacenter A.\n+\n+image::images/ccr-arch-multiple-dcs.png[Production datacenter that replicates data to two other datacenters]\n+\n+[discrete]\n+[[ccr-chained-replication]]\n+===== Chained replication\n+You can replicate data across multiple datacenters to form a replication\n+chain. In the following diagram, Datacenter A contains the leader index.\n+Datacenter B replicates data from Datacenter A, and Datacenter C replicates\n+from the follower indices in Datacenter B. The connection between these\n+datacenters forms a chained replication pattern.\n+\n+image::images/ccr-arch-chain-dcs.png[Three datacenters connected to form a replication chain]\n+\n+[discrete]\n+[[ccr-bi-directional-replication]]\n+===== Bi-directional replication\n+In a https://www.elastic.co/blog/bi-directional-replication-with-elasticsearch-cross-cluster-replication-ccr[bi-directional replication] setup, all clusters have access to view\n+all data, and all clusters have an index to write to without manually\n+implementing failover. Applications can write to the local index within each\n+datacenter, and read across multiple indices for a global view of all\n+information.\n+\n+This configuration requires no manual intervention when a cluster or datacenter\n+is unavailable. In the following diagram, if Datacenter A is unavailable, you can continue using Datacenter B without manual failover. When Datacenter A\n+comes online, replication resumes between the clusters.\n+\n+image::images/ccr-arch-bi-directional.png[Bi-directional configuration where each cluster contains both a leader index and follower indices]\n+\n+NOTE: This configuration is useful for index-only workloads, where no updates\n+to document values occur. In this configuration, documents indexed by {es} are\n+immutable. Clients are located in each datacenter alongside the {es}\n+cluster, and do not communicate with clusters in different datacenters.\n+\n+[discrete]\n+[[ccr-data-locality]]\n+==== Data locality\n+Bringing data closer to your users or application server can reduce latency\n+and response time. This methodology also applies when replicating data in {es}.\n+For example, you can replicate a product catalog or reference dataset to 20 or\n+more datacenters around the world to minimize the distance between the data and\n+the application server.\n+\n+In the following diagram, data is replicated from one datacenter to three\n+additional datacenters, each in their own region. The central datacenter\n+contains the leader index, and the additional datacenters contain follower\n+indices that replicate data in that particular region. This configuration\n+puts data closer to the application accessing it.\n+\n+image::images/ccr-arch-data-locality.png[A centralized datacenter replicated across three other datacenters, each in their own region]\n+\n+[discrete]\n+[[ccr-centralized-reporting]]\n+==== Centralized reporting\n+Using a centralized reporting cluster is useful when querying across a large\n+network is inefficient. In this configuration, you replicate data from many\n+smaller clusters to the centralized reporting cluster.\n+\n+For example, a large global bank might have 100 {es} clusters around the world\n+that are distributed across different regions for each bank branch. Using\n+{ccr}, the bank can replicate events from all 100 banks to a central cluster to\n+analyze and aggregate events locally for reporting. Rather than maintaining a\n+mirrored cluster, the bank can use {ccr} to replicate specific indices.\n+\n+In the following diagram, data from three datacenters in different regions is\n+replicated to a centralized reporting cluster. This configuration enables you\n+to copy data from regional hubs to a central cluster, where you can run all\n+reports locally.\n+\n+image::images/ccr-arch-central-reporting.png[Three clusters in different regions sending data to a centralized reporting cluster for analysis]\n+\n+[discrete]\n+[[ccr-replication-mechanics]]\n+=== Replication mechanics\n+Although you <<ccr-getting-started,set up {ccr}>> at the index level, {es}\n+achieves replication at the shard level. When a follower index is created,\n+each shard in that index pulls changes form its corresponding shard in the\n+leader index, which means that a follower index has the same number of\n+shards as its leader index. All operations are replicated by the follower, so that operations to create, update, or delete a document are replicated.\n+These requests can be served from any copy of the leader shard (primary or\n+replica).\n+\n+When a follower shard sends a read request, the leader shard responds with\n+any new operations, limited by the read parameters that you establish when\n+configuring the follower index. If no new operations are available, the\n+leader shard waits up to the configured timeout for new operations. If the\n+timeout elapses, the leader shard responds to the follower shard that there\n+are no new operations. The follower shard updates shard statistics and\n+immediately sends another read request to the leader shard. This\n+communication model ensures that network connections between the remote\n+cluster and the local cluster are continually in use, avoiding forceful\n+termination by an external source such as a firewall.\n+\n+If a read request fails, the cause of the failure is inspected. If the\n+cause of the failure is deemed to be recoverable (such as a network\n+failure), the follower shard enters into a retry loop. Otherwise, the\n+follower shard pauses\n+<<ccr-pause-replication,until you resume it>>.\n+\n+When a follower shard receives operations from the leader shard, it places\n+those operations in a write buffer. The follower shard uses the write buffer\n+to submit bulk write requests within the shard. If the write buffer exceeds", "originalCommit": "cb6d9c2c0dadf44ce5488cd8e7c1f8a2b16f223a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU5NzEyMw==", "url": "https://github.com/elastic/elasticsearch/pull/60555#discussion_r471597123", "bodyText": "Changed to read:\n\nThe follower shard submits bulk write requests using operations from the write buffer.", "author": "lockewritesdocs", "createdAt": "2020-08-17T16:29:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU0Mzk5OA=="}], "type": "inlineReview"}, {"oid": "17854a6f72f9edaad984dd961db7154d153d5542", "url": "https://github.com/elastic/elasticsearch/commit/17854a6f72f9edaad984dd961db7154d153d5542", "message": "Incorporating small changes from reviewers.", "committedDate": "2020-08-17T19:06:58Z", "type": "commit"}]}