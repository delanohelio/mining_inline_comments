{"pr_number": 51006, "pr_title": "Fix MultiVersionRepository BwC Tests", "pr_createdAt": "2020-01-14T21:28:26Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/51006", "timeline": [{"oid": "14debdf591cf7bf579190fd1fba6d418b5f0a383", "url": "https://github.com/elastic/elasticsearch/commit/14debdf591cf7bf579190fd1fba6d418b5f0a383", "message": "Fix MultiVersionRepository BwC Tests\n\nThe HLRC doesn't like what its getting back from some older 6.x versions for the restore status\nso I moved that request to the low level client.\nCloses #50819", "committedDate": "2020-01-14T21:24:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Njg2Nzc2NQ==", "url": "https://github.com/elastic/elasticsearch/pull/51006#discussion_r366867765", "bodyText": "remove this?", "author": "ywelsch", "createdAt": "2020-01-15T13:14:05Z", "path": "qa/repository-multi-version/src/test/java/org/elasticsearch/upgrades/MultiVersionRepositoryAccessIT.java", "diffHunk": "@@ -269,14 +266,20 @@ private void deleteSnapshot(RestHighLevelClient client, String repoName, String\n         }\n     }\n \n-    private static void ensureSnapshotRestoreWorks(RestHighLevelClient client, String repoName, String name,\n-                                                   int shards) throws IOException {\n+    @SuppressWarnings(\"unchecked\")\n+    private void ensureSnapshotRestoreWorks(String repoName, String name, int shards) throws IOException {\n         wipeAllIndices();\n-        final RestoreInfo restoreInfo =\n-            client.snapshot().restore(new RestoreSnapshotRequest().repository(repoName).snapshot(name).waitForCompletion(true),\n-                RequestOptions.DEFAULT).getRestoreInfo();\n-        assertThat(restoreInfo.failedShards(), is(0));\n-        assertThat(restoreInfo.successfulShards(), equalTo(shards));\n+        try (InputStream entity = client().performRequest(\n+            new Request(\"POST\", \"/_snapshot/\" + repoName + \"/\" + name + \"/_restore?wait_for_completion=true\")).getEntity().getContent();\n+            XContentParser parser = JsonXContent.jsonXContent.createParser(\n+            xContentRegistry(), DeprecationHandler.THROW_UNSUPPORTED_OPERATION, entity)) {\n+            final Map<String, Object> raw = parser.map();\n+            logger.error(raw);", "originalCommit": "14debdf591cf7bf579190fd1fba6d418b5f0a383", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "01de4012250c5c5151dea1d8710b00648e5b69c3", "url": "https://github.com/elastic/elasticsearch/commit/01de4012250c5c5151dea1d8710b00648e5b69c3", "message": "Merge remote-tracking branch 'elastic/7.x' into 50819", "committedDate": "2020-01-15T13:31:40Z", "type": "commit"}, {"oid": "52a527328662bcc892ecda28b6b2bd027d2a2e80", "url": "https://github.com/elastic/elasticsearch/commit/52a527328662bcc892ecda28b6b2bd027d2a2e80", "message": "remove debug logging", "committedDate": "2020-01-15T13:32:01Z", "type": "commit"}]}