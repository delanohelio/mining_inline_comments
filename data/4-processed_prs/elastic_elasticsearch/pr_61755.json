{"pr_number": 61755, "pr_title": "Backport all Painless compiler extensibility changes", "pr_createdAt": "2020-08-31T18:53:33Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/61755", "timeline": [{"oid": "c07866879c3eac6a0e5bcd82fff22d65f52af057", "url": "https://github.com/elastic/elasticsearch/commit/c07866879c3eac6a0e5bcd82fff22d65f52af057", "message": "response to pr comments", "committedDate": "2020-09-03T16:35:15Z", "type": "forcePushed"}, {"oid": "4e601f5c9e2d21fcfb21d79f834d066c1f2c6860", "url": "https://github.com/elastic/elasticsearch/commit/4e601f5c9e2d21fcfb21d79f834d066c1f2c6860", "message": "backport all compiler extensibility changes", "committedDate": "2020-09-14T15:48:16Z", "type": "commit"}, {"oid": "9baf1d6483527d88e401712d9a9e3d44b8b4a67f", "url": "https://github.com/elastic/elasticsearch/commit/9baf1d6483527d88e401712d9a9e3d44b8b4a67f", "message": "fix node ordering for string concatenation in compound assignment", "committedDate": "2020-09-14T15:48:16Z", "type": "commit"}, {"oid": "ae614ddb40c90fb8cefd3c7a0a86c867bff66118", "url": "https://github.com/elastic/elasticsearch/commit/ae614ddb40c90fb8cefd3c7a0a86c867bff66118", "message": "fix string concatenation", "committedDate": "2020-09-14T15:48:17Z", "type": "commit"}, {"oid": "9242a62d4eaed403af95851a1de12db5de531694", "url": "https://github.com/elastic/elasticsearch/commit/9242a62d4eaed403af95851a1de12db5de531694", "message": "response to pr comments", "committedDate": "2020-09-14T15:48:17Z", "type": "commit"}, {"oid": "9242a62d4eaed403af95851a1de12db5de531694", "url": "https://github.com/elastic/elasticsearch/commit/9242a62d4eaed403af95851a1de12db5de531694", "message": "response to pr comments", "committedDate": "2020-09-14T15:48:17Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg1ODYxOQ==", "url": "https://github.com/elastic/elasticsearch/pull/61755#discussion_r488858619", "bodyText": "This is line.isBlank() in master, should master be updated?", "author": "stu-elastic", "createdAt": "2020-09-15T17:54:59Z", "path": "modules/lang-painless/spi/src/main/java/org/elasticsearch/painless/spi/WhitelistLoader.java", "diffHunk": "@@ -460,11 +460,11 @@ public static Whitelist loadFromResourceFiles(Class<?> resource, Map<String, Whi\n \n         List<Object> annotations;\n \n-        line = line.trim();\n-\n-        if (line.isEmpty()) {\n+        if (\"\".equals(line.replaceAll(\"\\\\s+\",\"\"))) {", "originalCommit": "9242a62d4eaed403af95851a1de12db5de531694", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg2OTY1OQ==", "url": "https://github.com/elastic/elasticsearch/pull/61755#discussion_r488869659", "bodyText": "isBlank isn't available in 8", "author": "jdconrad", "createdAt": "2020-09-15T18:15:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg1ODYxOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg2OTY5Ng==", "url": "https://github.com/elastic/elasticsearch/pull/61755#discussion_r488869696", "bodyText": "No, doesn't exist in 8.", "author": "stu-elastic", "createdAt": "2020-09-15T18:15:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg1ODYxOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg2MzAyOQ==", "url": "https://github.com/elastic/elasticsearch/pull/61755#discussion_r488863029", "bodyText": "Do we need to keep the 6.4 back compat code here?", "author": "stu-elastic", "createdAt": "2020-09-15T18:02:53Z", "path": "modules/lang-painless/src/main/java/org/elasticsearch/painless/action/PainlessExecuteAction.java", "diffHunk": "@@ -284,15 +284,8 @@ static Request parse(XContentParser parser) throws IOException {\n         Request(StreamInput in) throws IOException {\n             super(in);\n             script = new Script(in);\n-            if (in.getVersion().before(Version.V_6_4_0)) {", "originalCommit": "9242a62d4eaed403af95851a1de12db5de531694", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg2OTc4NQ==", "url": "https://github.com/elastic/elasticsearch/pull/61755#discussion_r488869785", "bodyText": "Good catch. Will change back.", "author": "jdconrad", "createdAt": "2020-09-15T18:15:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg2MzAyOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg2MzQ5NA==", "url": "https://github.com/elastic/elasticsearch/pull/61755#discussion_r488863494", "bodyText": "Do we need to keep the 6.4 back compat code here?", "author": "stu-elastic", "createdAt": "2020-09-15T18:03:50Z", "path": "modules/lang-painless/src/main/java/org/elasticsearch/painless/action/PainlessExecuteAction.java", "diffHunk": "@@ -328,12 +321,8 @@ public ActionRequestValidationException validate() {\n         public void writeTo(StreamOutput out) throws IOException {\n             super.writeTo(out);\n             script.writeTo(out);\n-            if (out.getVersion().before(Version.V_6_4_0)) {", "originalCommit": "9242a62d4eaed403af95851a1de12db5de531694", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg2OTg1NA==", "url": "https://github.com/elastic/elasticsearch/pull/61755#discussion_r488869854", "bodyText": "Same as above.", "author": "jdconrad", "createdAt": "2020-09-15T18:15:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg2MzQ5NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg3MDAwOQ==", "url": "https://github.com/elastic/elasticsearch/pull/61755#discussion_r488870009", "bodyText": "After we get this into 7.x, let's fix these up in master to cleanup future backport.", "author": "stu-elastic", "createdAt": "2020-09-15T18:15:45Z", "path": "modules/lang-painless/spi/src/main/java/org/elasticsearch/painless/spi/WhitelistLoader.java", "diffHunk": "@@ -502,20 +502,20 @@ public static Whitelist loadFromResourceFiles(Class<?> resource, Map<String, Whi\n                         if (argumentKeyValue.length != 2) {\n                             throw new IllegalArgumentException(\"invalid annotation: expected key=\\\"value\\\" [\" + line + \"]\");\n                         }\n-                        \n+", "originalCommit": "9242a62d4eaed403af95851a1de12db5de531694", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTUxMDA2OA==", "url": "https://github.com/elastic/elasticsearch/pull/61755#discussion_r489510068", "bodyText": "Agreed, we should just do an entire whitespace PR.", "author": "jdconrad", "createdAt": "2020-09-16T15:04:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg3MDAwOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg3NjEwNw==", "url": "https://github.com/elastic/elasticsearch/pull/61755#discussion_r488876107", "bodyText": "Take a pass on these yml changes.", "author": "stu-elastic", "createdAt": "2020-09-15T18:27:08Z", "path": "modules/lang-painless/src/yamlRestTest/resources/rest-api-spec/test/painless/110_script_score_boost.yml", "diffHunk": "@@ -1,8 +1,8 @@\n # Integration tests for ScriptScoreQuery using Painless\n setup:\n   - skip:\n-      version: \" - 7.6.99\"", "originalCommit": "9242a62d4eaed403af95851a1de12db5de531694", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTUzOTQ0OQ==", "url": "https://github.com/elastic/elasticsearch/pull/61755#discussion_r489539449", "bodyText": "Reverted.", "author": "jdconrad", "createdAt": "2020-09-16T15:43:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg3NjEwNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg3NjE3MA==", "url": "https://github.com/elastic/elasticsearch/pull/61755#discussion_r488876170", "bodyText": "Take a pass on these yml changes.", "author": "stu-elastic", "createdAt": "2020-09-15T18:27:13Z", "path": "modules/lang-painless/src/yamlRestTest/resources/rest-api-spec/test/painless/15_update.yml", "diffHunk": "@@ -20,7 +20,6 @@\n               params: { bar: 'xxx' }\n \n   - match: { _index:   test_1 }\n-  - match: { _type:    _doc   }", "originalCommit": "9242a62d4eaed403af95851a1de12db5de531694", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTUzODkwMA==", "url": "https://github.com/elastic/elasticsearch/pull/61755#discussion_r489538900", "bodyText": "Reverted.", "author": "jdconrad", "createdAt": "2020-09-16T15:42:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg3NjE3MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg3NjIzNA==", "url": "https://github.com/elastic/elasticsearch/pull/61755#discussion_r488876234", "bodyText": "Take a pass on these yml changes.", "author": "stu-elastic", "createdAt": "2020-09-15T18:27:21Z", "path": "modules/lang-painless/src/yamlRestTest/resources/rest-api-spec/test/painless/20_scriptfield.yml", "diffHunk": "@@ -151,6 +151,6 @@ setup:\n     - match: { error.type: \"search_phase_execution_exception\" }\n     - match: { error.reason: \"all shards failed\" }\n     - match: { error.failed_shards.0.reason.caused_by.type: \"illegal_argument_exception\" }\n-    - match: { error.failed_shards.0.reason.caused_by.reason: \"While loop has no escape.\" }", "originalCommit": "9242a62d4eaed403af95851a1de12db5de531694", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTUzOTExMQ==", "url": "https://github.com/elastic/elasticsearch/pull/61755#discussion_r489539111", "bodyText": "Required as the error message changed.", "author": "jdconrad", "createdAt": "2020-09-16T15:43:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg3NjIzNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg3NjI5NQ==", "url": "https://github.com/elastic/elasticsearch/pull/61755#discussion_r488876295", "bodyText": "Take a pass on these yml changes.", "author": "stu-elastic", "createdAt": "2020-09-15T18:27:28Z", "path": "modules/lang-painless/src/yamlRestTest/resources/rest-api-spec/test/painless/30_search.yml", "diffHunk": "@@ -452,10 +452,6 @@\n ---\n \n \"Exception on negative score\":\n-    - skip:", "originalCommit": "9242a62d4eaed403af95851a1de12db5de531694", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTUzOTIwNQ==", "url": "https://github.com/elastic/elasticsearch/pull/61755#discussion_r489539205", "bodyText": "Reverted.", "author": "jdconrad", "createdAt": "2020-09-16T15:43:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg3NjI5NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg3NjM1Nw==", "url": "https://github.com/elastic/elasticsearch/pull/61755#discussion_r488876357", "bodyText": "Take a pass on these yml changes.", "author": "stu-elastic", "createdAt": "2020-09-15T18:27:33Z", "path": "modules/lang-painless/src/yamlRestTest/resources/rest-api-spec/test/painless/70_mov_fn_agg.yml", "diffHunk": "@@ -1,9 +1,6 @@\n # Sanity integration test to make sure the custom context and whitelist work for moving_fn pipeline agg\n #\n setup:\n-  - skip:", "originalCommit": "9242a62d4eaed403af95851a1de12db5de531694", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTUzOTIyOA==", "url": "https://github.com/elastic/elasticsearch/pull/61755#discussion_r489539228", "bodyText": "Reverted.", "author": "jdconrad", "createdAt": "2020-09-16T15:43:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg3NjM1Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg3NjQxMw==", "url": "https://github.com/elastic/elasticsearch/pull/61755#discussion_r488876413", "bodyText": "Take a pass on these yml changes.", "author": "stu-elastic", "createdAt": "2020-09-15T18:27:39Z", "path": "modules/lang-painless/src/yamlRestTest/resources/rest-api-spec/test/painless/80_script_score.yml", "diffHunk": "@@ -1,10 +1,5 @@\n # Integration tests for ScriptScoreQuery using Painless\n \n-setup:", "originalCommit": "9242a62d4eaed403af95851a1de12db5de531694", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTUzOTM0MQ==", "url": "https://github.com/elastic/elasticsearch/pull/61755#discussion_r489539341", "bodyText": "Reverted.", "author": "jdconrad", "createdAt": "2020-09-16T15:43:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg3NjQxMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg3NjQ1OA==", "url": "https://github.com/elastic/elasticsearch/pull/61755#discussion_r488876458", "bodyText": "Take a pass on these yml changes.", "author": "stu-elastic", "createdAt": "2020-09-15T18:27:44Z", "path": "modules/lang-painless/src/yamlRestTest/resources/rest-api-spec/test/painless/90_interval_query_filter.yml", "diffHunk": "@@ -1,8 +1,4 @@\n setup:\n-  - skip:", "originalCommit": "9242a62d4eaed403af95851a1de12db5de531694", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTUzOTM2OQ==", "url": "https://github.com/elastic/elasticsearch/pull/61755#discussion_r489539369", "bodyText": "Reverted.", "author": "jdconrad", "createdAt": "2020-09-16T15:43:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg3NjQ1OA=="}], "type": "inlineReview"}, {"oid": "e752dad6717f154602f821d5d890aec393337828", "url": "https://github.com/elastic/elasticsearch/commit/e752dad6717f154602f821d5d890aec393337828", "message": "fix some changes", "committedDate": "2020-09-16T15:32:23Z", "type": "commit"}]}