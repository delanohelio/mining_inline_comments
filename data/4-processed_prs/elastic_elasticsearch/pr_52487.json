{"pr_number": 52487, "pr_title": "Use actual current commit id for build scan custom value", "pr_createdAt": "2020-02-18T17:52:27Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/52487", "timeline": [{"oid": "dd5603f4b88c68babdc69cd188756ba6e920b111", "url": "https://github.com/elastic/elasticsearch/commit/dd5603f4b88c68babdc69cd188756ba6e920b111", "message": "Use actual current commit id for build scan custom value\n\nSigned-off-by: Mark Vieira <portugee@gmail.com>", "committedDate": "2020-02-18T17:50:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDg0NTk4OQ==", "url": "https://github.com/elastic/elasticsearch/pull/52487#discussion_r380845989", "bodyText": "Should the use of GIT_COMMIT here also be replaced with BuildParams.gitRevision?", "author": "rjernst", "createdAt": "2020-02-18T18:10:49Z", "path": "gradle/build-scan.gradle", "diffHunk": "@@ -76,9 +77,9 @@ buildScan {\n         value 'Git Branch', branch\n         tag branch\n       }\n-      if (System.getenv('GIT_COMMIT')) {\n-        value 'Git Commit ID', System.getenv('GIT_COMMIT')\n-        link 'Source', \"https://github.com/elastic/elasticsearch/tree/${System.getenv('GIT_COMMIT')}\"\n+      value 'Git Commit ID', BuildParams.gitRevision\n+      link 'Source', \"https://github.com/elastic/elasticsearch/tree/${BuildParams.gitRevision}\"\n+      if (System.getenv('GIT_PREVIOUS_COMMIT')) {\n         background {\n           def changes = \"git diff --name-only ${System.getenv('GIT_PREVIOUS_COMMIT')}..${System.getenv('GIT_COMMIT')}\".execute().text.trim()", "originalCommit": "dd5603f4b88c68babdc69cd188756ba6e920b111", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDg3MTE4NQ==", "url": "https://github.com/elastic/elasticsearch/pull/52487#discussion_r380871185", "bodyText": "I didn't change this because GIT_PREVIOUS_COMMIT is subject to the same \"problem\". I think if anything we might just want to remove this entirely if it's not guaranteed to be accurate.", "author": "mark-vieira", "createdAt": "2020-02-18T18:59:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDg0NTk4OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDkwNzQ4NQ==", "url": "https://github.com/elastic/elasticsearch/pull/52487#discussion_r380907485", "bodyText": "So yeah, since we can't rely on GIT_COMMIT or GIT_PREVIOUS_COMMIT from Jenkins being actually correct I've just ditched this entirely.", "author": "mark-vieira", "createdAt": "2020-02-18T20:08:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDg0NTk4OQ=="}], "type": "inlineReview"}, {"oid": "45992f7c5e790ad5ff41315fef9549ff614f3995", "url": "https://github.com/elastic/elasticsearch/commit/45992f7c5e790ad5ff41315fef9549ff614f3995", "message": "Remove usages on unreliable GIT_PREVIOUS_COMMIT env variable\n\nSigned-off-by: Mark Vieira <portugee@gmail.com>", "committedDate": "2020-02-18T20:08:11Z", "type": "commit"}]}