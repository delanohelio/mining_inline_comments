{"pr_number": 53914, "pr_title": "Introduce aarch64 packaging", "pr_createdAt": "2020-03-21T01:30:44Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/53914", "timeline": [{"oid": "4b7aeb1c1b5766ec8211c0015771e5f047c92b3e", "url": "https://github.com/elastic/elasticsearch/commit/4b7aeb1c1b5766ec8211c0015771e5f047c92b3e", "message": "Introduce aarch64 packaging\n\nThis commit introduces aarch64 packaging, including bundling an aarch64\nJDK distribution. We had to make some interesting choices here:\n - ML binaries are not compiled for aarch64, so for now we disable ML on\n   aarch64 by default\n - depending on underlying page sizes, we have to disable class data\n   sharing", "committedDate": "2020-03-21T01:29:34Z", "type": "commit"}, {"oid": "2087a62a39d3b768253ec0e852d1e5211a76771d", "url": "https://github.com/elastic/elasticsearch/commit/2087a62a39d3b768253ec0e852d1e5211a76771d", "message": "Fix imports", "committedDate": "2020-03-21T01:39:54Z", "type": "commit"}, {"oid": "e69bfcbd9f99fa46ba2e070c4faf4d2312a78688", "url": "https://github.com/elastic/elasticsearch/commit/e69bfcbd9f99fa46ba2e070c4faf4d2312a78688", "message": "Fix checkstyle", "committedDate": "2020-03-21T01:47:29Z", "type": "commit"}, {"oid": "94ce7784809989278e5075804c14d91fa445c4f0", "url": "https://github.com/elastic/elasticsearch/commit/94ce7784809989278e5075804c14d91fa445c4f0", "message": "Formatting", "committedDate": "2020-03-21T02:05:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTk1MzY0Ng==", "url": "https://github.com/elastic/elasticsearch/pull/53914#discussion_r395953646", "bodyText": "Seems if we are running on arm we want this to always be false, not just default to false. Wouldn't this mean folks could enable ML explicitly causing funny result?", "author": "mark-vieira", "createdAt": "2020-03-21T02:36:46Z", "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/XPackSettings.java", "diffHunk": "@@ -65,8 +65,10 @@ private XPackSettings() {\n     public static final Setting<Boolean> GRAPH_ENABLED = Setting.boolSetting(\"xpack.graph.enabled\", true, Setting.Property.NodeScope);\n \n     /** Setting for enabling or disabling machine learning. Defaults to true. */\n-    public static final Setting<Boolean> MACHINE_LEARNING_ENABLED = Setting.boolSetting(\"xpack.ml.enabled\", true,\n-            Setting.Property.NodeScope);\n+    public static final Setting<Boolean> MACHINE_LEARNING_ENABLED = Setting.boolSetting(", "originalCommit": "94ce7784809989278e5075804c14d91fa445c4f0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjAyMzk5OQ==", "url": "https://github.com/elastic/elasticsearch/pull/53914#discussion_r396023999", "bodyText": "I pushed 7b81079.", "author": "jasontedor", "createdAt": "2020-03-21T19:57:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTk1MzY0Ng=="}], "type": "inlineReview"}, {"oid": "7b81079b0e3d5b92eef7cbb0dc100d0362e48e60", "url": "https://github.com/elastic/elasticsearch/commit/7b81079b0e3d5b92eef7cbb0dc100d0362e48e60", "message": "Do not allow ML on ARM 64", "committedDate": "2020-03-21T19:28:44Z", "type": "commit"}, {"oid": "12cc045fe1ecf4e19c8b2612274ac5b9f6868eaa", "url": "https://github.com/elastic/elasticsearch/commit/12cc045fe1ecf4e19c8b2612274ac5b9f6868eaa", "message": "FIx tests", "committedDate": "2020-03-21T19:32:04Z", "type": "commit"}, {"oid": "03b30f10e951f5227faa84931c19527551b4517d", "url": "https://github.com/elastic/elasticsearch/commit/03b30f10e951f5227faa84931c19527551b4517d", "message": "Fix RPM extraction test on different OS/architectures", "committedDate": "2020-03-21T20:41:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjE4NzgxOA==", "url": "https://github.com/elastic/elasticsearch/pull/53914#discussion_r396187818", "bodyText": "typo", "author": "drewr", "createdAt": "2020-03-23T02:39:05Z", "path": "buildSrc/src/testKit/jdk-download/reuse/build.gradle", "diffHunk": "@@ -7,5 +7,6 @@ jdks {\n     vendor = fakeJdkVendor\n     version = fakeJdkVersion\n     platform = \"linux\"\n+    architeecture = \"x64\"", "originalCommit": "03b30f10e951f5227faa84931c19527551b4517d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjY4OTI5Mg==", "url": "https://github.com/elastic/elasticsearch/pull/53914#discussion_r396689292", "bodyText": "Good catch, thanks!", "author": "jasontedor", "createdAt": "2020-03-23T19:04:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjE4NzgxOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjY5MTU4MA==", "url": "https://github.com/elastic/elasticsearch/pull/53914#discussion_r396691580", "bodyText": "I pushed 0d7b4ee directly, thanks for noticing.", "author": "jasontedor", "createdAt": "2020-03-23T19:08:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjE4NzgxOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjE4ODM1Mw==", "url": "https://github.com/elastic/elasticsearch/pull/53914#discussion_r396188353", "bodyText": "Copy/paste error? I think these should be aarch64.", "author": "drewr", "createdAt": "2020-03-23T02:42:06Z", "path": "distribution/archives/build.gradle", "diffHunk": "@@ -153,49 +153,61 @@ Closure commonTarConfig = {\n task buildDarwinTar(type: SymbolicLinkPreservingTar) {\n   configure(commonTarConfig)\n   archiveClassifier = 'darwin-x86_64'\n-  with archiveFiles(modulesFiles(false, 'darwin'), 'tar', 'darwin', false, true)\n+  with archiveFiles(modulesFiles(false, 'darwin'), 'tar', 'darwin', 'x64', false, true)\n }\n \n task buildOssDarwinTar(type: SymbolicLinkPreservingTar) {\n   configure(commonTarConfig)\n   archiveClassifier = 'darwin-x86_64'\n-  with archiveFiles(modulesFiles(true, 'darwin'), 'tar', 'darwin', true, true)\n+  with archiveFiles(modulesFiles(true, 'darwin'), 'tar', 'darwin', 'x64', true, true)\n }\n \n task buildNoJdkDarwinTar(type: SymbolicLinkPreservingTar) {\n   configure(commonTarConfig)\n   archiveClassifier = 'no-jdk-darwin-x86_64'\n-  with archiveFiles(modulesFiles(false, 'darwin'), 'tar', 'darwin', false, false)\n+  with archiveFiles(modulesFiles(false, 'darwin'), 'tar', 'darwin', 'x64', false, false)\n }\n \n task buildOssNoJdkDarwinTar(type: SymbolicLinkPreservingTar) {\n   configure(commonTarConfig)\n   archiveClassifier = 'no-jdk-darwin-x86_64'\n-  with archiveFiles(modulesFiles(true, 'darwin'), 'tar', 'darwin', true, false)\n+  with archiveFiles(modulesFiles(true, 'darwin'), 'tar', 'darwin', 'x64', true, false)\n+}\n+\n+task buildLinuxAarch64Tar(type: SymbolicLinkPreservingTar) {\n+  configure(commonTarConfig)\n+  archiveClassifier = 'linux-aarch64'\n+  with archiveFiles(modulesFiles(false, 'linux'), 'tar', 'linux', 'aarch64', false, true)\n }\n \n task buildLinuxTar(type: SymbolicLinkPreservingTar) {\n   configure(commonTarConfig)\n   archiveClassifier = 'linux-x86_64'\n-  with archiveFiles(modulesFiles(false, 'linux'), 'tar', 'linux', false, true)\n+  with archiveFiles(modulesFiles(false, 'linux'), 'tar', 'linux', 'x64', false, true)\n+}\n+\n+task buildOssLinuxAarch64Tar(type: SymbolicLinkPreservingTar) {\n+  configure(commonTarConfig)\n+  archiveClassifier = 'linux-x86_64'\n+  with archiveFiles(modulesFiles(true, 'linux'), 'tar', 'linux', 'x64', true, true)", "originalCommit": "03b30f10e951f5227faa84931c19527551b4517d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjY5MTQyNQ==", "url": "https://github.com/elastic/elasticsearch/pull/53914#discussion_r396691425", "bodyText": "I pushed 80c24a0 directly to address this. Thanks for noticing.", "author": "jasontedor", "createdAt": "2020-03-23T19:08:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjE4ODM1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc4NTcwNg==", "url": "https://github.com/elastic/elasticsearch/pull/53914#discussion_r396785706", "bodyText": "Does the archiveClassifier also need to be updated? I thought it would be linux-aarch64.", "author": "drewr", "createdAt": "2020-03-23T22:07:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjE4ODM1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc5MjEyMg==", "url": "https://github.com/elastic/elasticsearch/pull/53914#discussion_r396792122", "bodyText": "Thanks again. \ud83e\udd26\u200d\u2640\nI pushed ba431a0.", "author": "jasontedor", "createdAt": "2020-03-23T22:22:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjE4ODM1Mw=="}], "type": "inlineReview"}]}