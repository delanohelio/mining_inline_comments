{"pr_number": 54216, "pr_title": "[DOCS] EQL: Document `cidrMatch` function", "pr_createdAt": "2020-03-25T18:01:52Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/54216", "timeline": [{"oid": "5629888134baa800c99dbdc7585b5d6f63622765", "url": "https://github.com/elastic/elasticsearch/commit/5629888134baa800c99dbdc7585b5d6f63622765", "message": "[DOCS] EQL: Document `cidrMatch` function", "committedDate": "2020-04-08T16:15:10Z", "type": "commit"}, {"oid": "5629888134baa800c99dbdc7585b5d6f63622765", "url": "https://github.com/elastic/elasticsearch/commit/5629888134baa800c99dbdc7585b5d6f63622765", "message": "[DOCS] EQL: Document `cidrMatch` function", "committedDate": "2020-04-08T16:15:10Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTY1ODY4Mw==", "url": "https://github.com/elastic/elasticsearch/pull/54216#discussion_r405658683", "bodyText": "@aleksmaus When I tested this using the EQL search API, it didn't return results as expected. I included duplication steps below in case I made an error somewhere.\nCreate an index mapping to ensure source.address is an IP field.\nPUT /my_index\n{\n  \"mappings\": {\n    \"properties\": {\n      \"source\": {\n        \"properties\": {\n          \"address\": {\n            \"type\": \"ip\"\n          }\n        }\n      }\n    }\n  }\n}\n\nIndex \"192.168.152.12\" as a source.address value.\nPUT /my_index/_doc/1\n{\n  \"@timestamp\": \"2020-12-06T11:04:05.000Z\",\n  \"event\": {\n    \"category\": \"process\"\n  },\n  \"source\": {\n    \"address\": \"192.168.152.12\"\n  }\n}\n\nUse cidrMatch to search for \"192.168.152.12\" in the \"192.168.0.0/16\" CIDR block. This should be true and return _doc 1 as a result.\n{\nGET /my_index/_eql/search\n  \"query\": \"process where cidrMatch(source.address, \\\"192.168.0.0/16\\\") == true \"\n}\n\nInstead, I get no results.\n{\n  \"took\" : 2,\n  \"timed_out\" : false,\n  \"hits\" : {\n    \"total\" : {\n      \"value\" : 0,\n      \"relation\" : \"eq\"\n    },\n    \"events\" : [ ]\n  }\n}\n\nIf I change true to false, the _doc is returned.\n{\nGET /my_index/_eql/search\n  \"query\": \"process where cidrMatch(source.address, \\\"192.168.0.0/16\\\") == false \"\n}\n\nResults:\n{\n  \"took\" : 2,\n  \"timed_out\" : false,\n  \"hits\" : {\n    \"total\" : {\n      \"value\" : 1,\n      \"relation\" : \"eq\"\n    },\n    \"events\" : [\n      {\n        \"_index\" : \"my_index\",\n        \"_id\" : \"1\",\n        \"_score\" : null,\n        \"_source\" : {\n          \"@timestamp\" : \"2020-12-06T11:04:05.000Z\",\n          \"event\" : {\n            \"category\" : \"process\"\n          },\n          \"source\" : {\n            \"address\" : \"192.168.152.12\"\n          }\n        },\n        \"sort\" : [\n          1607252645000\n        ]\n      }\n    ]\n  }\n}", "author": "jrodewig", "createdAt": "2020-04-08T16:34:33Z", "path": "docs/reference/eql/functions.asciidoc", "diffHunk": "@@ -8,11 +8,60 @@ experimental::[]\n \n {es} supports the following EQL functions:\n \n+* <<eql-fn-cidrmatch>>\n * <<eql-fn-endswith>>\n * <<eql-fn-length>>\n * <<eql-fn-startswith>>\n * <<eql-fn-substring>>\n \n+[discrete]\n+[[eql-fn-cidrmatch]]\n+==== `cidrMatch`\n+\n+Returns `true` if an IP address is contained in one or more provided\n+https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing[CIDR] blocks.\n+\n+[%collapsible]\n+====\n+*Example*\n+\n+[source,eql]\n+----\n+// source.address = \"192.168.152.12\"\n+cidrMatch(source.address, \"192.168.0.0/16\")               // returns true\n+cidrMatch(source.address, \"192.168.0.0/16\", \"10.0.0.0/8\") // returns true\n+cidrMatch(source.address, \"10.0.0.0/8\")                   // returns false\n+cidrMatch(source.address, \"10.0.0.0/8\", \"10.128.0.0/9\")   // returns false", "originalCommit": "5629888134baa800c99dbdc7585b5d6f63622765", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDM4Njk1OA==", "url": "https://github.com/elastic/elasticsearch/pull/54216#discussion_r414386958", "bodyText": "I created #55709 to track this bug.", "author": "astefan", "createdAt": "2020-04-24T08:19:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTY1ODY4Mw=="}], "type": "inlineReview"}, {"oid": "b43818baf0a9233249a3601e27c75b1f012c3421", "url": "https://github.com/elastic/elasticsearch/commit/b43818baf0a9233249a3601e27c75b1f012c3421", "message": "Merge remote-tracking branch 'upstream/master' into docs__eql-cidrmatch-fn", "committedDate": "2020-04-08T17:47:54Z", "type": "commit"}, {"oid": "44fcd0f7088464c6d3699f2f9f594a50e7eedeba", "url": "https://github.com/elastic/elasticsearch/commit/44fcd0f7088464c6d3699f2f9f594a50e7eedeba", "message": "update null handling", "committedDate": "2020-04-10T13:28:50Z", "type": "commit"}, {"oid": "61fcf4eeef83abe3694b000b627cb5fab61f5205", "url": "https://github.com/elastic/elasticsearch/commit/61fcf4eeef83abe3694b000b627cb5fab61f5205", "message": "reword", "committedDate": "2020-04-10T15:37:20Z", "type": "commit"}]}