{"pr_number": 54854, "pr_title": "value_count Aggregation optimization", "pr_createdAt": "2020-04-07T01:38:51Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/54854", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDc3MDI3OA==", "url": "https://github.com/elastic/elasticsearch/pull/54854#discussion_r404770278", "bodyText": "I think it'd be nice to have a \"value counting\" member in ValuesSource but I'd be happy to merge this as is and open up a follow up myself to do that. Or you can, if you want @xjtushilei.", "author": "nik9000", "createdAt": "2020-04-07T12:31:10Z", "path": "server/src/main/java/org/elasticsearch/search/aggregations/metrics/ValueCountAggregator.java", "diffHunk": "@@ -66,6 +66,34 @@ public LeafBucketCollector getLeafCollector(LeafReaderContext ctx,\n             return LeafBucketCollector.NO_OP_COLLECTOR;\n         }\n         final BigArrays bigArrays = context.bigArrays();\n+\n+        if (valuesSource instanceof ValuesSource.Numeric) {", "originalCommit": "be80d94aa276a5c205994242676057651a464f37", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDc3MTUxMA==", "url": "https://github.com/elastic/elasticsearch/pull/54854#discussion_r404771510", "bodyText": "As much as it is annoying to put something just for one agg in ValuesSource, I think it'd be nice to have a something in there just so it is more obvious that we do these sorts of things to the values.\nAnother option is to use the values source refactor to plug in different count implementations. That'd probably be more in line with the direction we're going now.", "author": "nik9000", "createdAt": "2020-04-07T12:33:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDc3MDI3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDc3MjM0OA==", "url": "https://github.com/elastic/elasticsearch/pull/54854#discussion_r404772348", "bodyText": "Either way, I'm happy to take this as is and do the twisting around myself in a follow up change and ping you for review.", "author": "nik9000", "createdAt": "2020-04-07T12:34:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDc3MDI3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTI0OTI0Nw==", "url": "https://github.com/elastic/elasticsearch/pull/54854#discussion_r405249247", "bodyText": "I think it'd be nice to have a \"value counting\" member in ValuesSource but I'd be happy to merge this as is and open up a follow up myself to do that. Or you can, if you want @xjtushilei.\n\nyes, you can do it.", "author": "xjtushilei", "createdAt": "2020-04-08T04:19:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDc3MDI3OA=="}], "type": "inlineReview"}, {"oid": "f61904df3a39f5f72a5f28b7c7364300abfd452b", "url": "https://github.com/elastic/elasticsearch/commit/f61904df3a39f5f72a5f28b7c7364300abfd452b", "message": "count Aggregation optimization", "committedDate": "2020-04-09T01:26:14Z", "type": "commit"}, {"oid": "c241bd7f563dcdd1be064bb4283be8b9685f67bf", "url": "https://github.com/elastic/elasticsearch/commit/c241bd7f563dcdd1be064bb4283be8b9685f67bf", "message": "Scripts change slightly. neat!", "committedDate": "2020-04-09T18:35:07Z", "type": "commit"}]}