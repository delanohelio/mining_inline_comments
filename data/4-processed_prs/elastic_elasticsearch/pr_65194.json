{"pr_number": 65194, "pr_title": "Add retries to Docker build apk commands", "pr_createdAt": "2020-11-18T12:17:04Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/65194", "timeline": [{"oid": "8e95560642dacc0674f080089a401771ca1db782", "url": "https://github.com/elastic/elasticsearch/commit/8e95560642dacc0674f080089a401771ca1db782", "message": "Add retries to Docker apk cmd", "committedDate": "2020-11-18T12:08:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQwMzg3MQ==", "url": "https://github.com/elastic/elasticsearch/pull/65194#discussion_r526403871", "bodyText": "I wonder since we already treat this file as a groovy template, if we could define some kind of macro to wrap some arbitrary lines in this loop with some sugar.", "author": "mark-vieira", "createdAt": "2020-11-18T20:36:10Z", "path": "distribution/docker/src/docker/Dockerfile", "diffHunk": "@@ -74,7 +74,12 @@ ENV TARBALL_URL https://curl.haxx.se/download/curl-\\${VERSION}.tar.xz\n ENV TARBALL_PATH curl-\\${VERSION}.tar.xz\n \n # Install dependencies\n-RUN apk add gnupg gcc make musl-dev openssl-dev openssl-libs-static file\n+RUN for iter in {1..10}; do \\\\", "originalCommit": "8e95560642dacc0674f080089a401771ca1db782", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjgxMDM1OA==", "url": "https://github.com/elastic/elasticsearch/pull/65194#discussion_r526810358", "bodyText": "I've defined a retry_loop helper, and I think it's an improvement. What do you think?", "author": "pugnascotia", "createdAt": "2020-11-19T11:56:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQwMzg3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA5MzQxMg==", "url": "https://github.com/elastic/elasticsearch/pull/65194#discussion_r527093412", "bodyText": "Brilliant. That's much better.", "author": "mark-vieira", "createdAt": "2020-11-19T18:07:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQwMzg3MQ=="}], "type": "inlineReview"}, {"oid": "b93a81785fb49b3d9c6111a6a0b332c6f420849f", "url": "https://github.com/elastic/elasticsearch/commit/b93a81785fb49b3d9c6111a6a0b332c6f420849f", "message": "Define a helper to generate retry bash constructs", "committedDate": "2020-11-19T11:55:27Z", "type": "commit"}, {"oid": "9b92f789b8cc2db43c55d1470fb008dc8870a28e", "url": "https://github.com/elastic/elasticsearch/commit/9b92f789b8cc2db43c55d1470fb008dc8870a28e", "message": "Tweaks", "committedDate": "2020-11-19T12:15:57Z", "type": "commit"}]}