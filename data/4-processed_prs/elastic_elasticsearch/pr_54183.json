{"pr_number": 54183, "pr_title": "Java8 implementations of collection initializers", "pr_createdAt": "2020-03-25T13:36:18Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/54183", "timeline": [{"oid": "b6f29cdb22308fb3e683568a582c5f120392dad4", "url": "https://github.com/elastic/elasticsearch/commit/b6f29cdb22308fb3e683568a582c5f120392dad4", "message": "Java8 implementations of collection initializers", "committedDate": "2020-03-25T13:30:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODI3ODQyNg==", "url": "https://github.com/elastic/elasticsearch/pull/54183#discussion_r398278426", "bodyText": "The JDK 9 collections have specializations for empty, one, and two-element lists; I think we could have those too.", "author": "jasontedor", "createdAt": "2020-03-26T02:14:49Z", "path": "libs/core/src/main/java9/org/elasticsearch/common/collect/List.java", "diffHunk": "@@ -0,0 +1,35 @@\n+/*\n+ * Licensed to Elasticsearch under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.elasticsearch.common.collect;\n+\n+public class List {\n+\n+    /**\n+     * Delegates to the Java9 {@code List.of()} method.\n+     * @param entries the elements to be contained in the list\n+     * @param <T> the {@code List}'s element type\n+     * @return an unmodifiable list containing the specified elements.\n+     */\n+    @SafeVarargs\n+    @SuppressWarnings(\"varargs\")\n+    public static <T> java.util.List<T> of(T... entries) {\n+        return java.util.List.of(entries);", "originalCommit": "b6f29cdb22308fb3e683568a582c5f120392dad4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODI3ODkxNw==", "url": "https://github.com/elastic/elasticsearch/pull/54183#discussion_r398278917", "bodyText": "We probably want the Map.ofEntries method too, for both Java 8 and Java 9+.", "author": "jasontedor", "createdAt": "2020-03-26T02:16:40Z", "path": "libs/core/src/main/java9/org/elasticsearch/common/collect/Map.java", "diffHunk": "@@ -0,0 +1,98 @@\n+/*\n+ * Licensed to Elasticsearch under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.elasticsearch.common.collect;\n+\n+public class Map {", "originalCommit": "b6f29cdb22308fb3e683568a582c5f120392dad4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODI3OTE3MQ==", "url": "https://github.com/elastic/elasticsearch/pull/54183#discussion_r398279171", "bodyText": "Additionally, Map.copyOf.", "author": "jasontedor", "createdAt": "2020-03-26T02:17:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODI3ODkxNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODI3OTM1Mw==", "url": "https://github.com/elastic/elasticsearch/pull/54183#discussion_r398279353", "bodyText": "I think that we will want a specialization for the empty list (List.of() -> Collections.emptyList());", "author": "jasontedor", "createdAt": "2020-03-26T02:18:12Z", "path": "libs/core/src/main/java/org/elasticsearch/common/collect/List.java", "diffHunk": "@@ -0,0 +1,38 @@\n+/*\n+ * Licensed to Elasticsearch under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.elasticsearch.common.collect;\n+\n+import java.util.Arrays;\n+import java.util.Collections;\n+\n+public class List {\n+\n+    /**\n+     * A Java8 implementation of the Java9 {@code List.of()} method.\n+     * @param entries the elements to be contained in the list\n+     * @param <T> the {@code List}'s element type\n+     * @return an unmodifiable list containing the specified elements.\n+     */\n+    @SafeVarargs\n+    @SuppressWarnings(\"varargs\")\n+    public static <T> java.util.List<T> of(T... entries) {", "originalCommit": "b6f29cdb22308fb3e683568a582c5f120392dad4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODI3OTM4Mw==", "url": "https://github.com/elastic/elasticsearch/pull/54183#discussion_r398279383", "bodyText": "I think that we will want List.copyOf too.", "author": "jasontedor", "createdAt": "2020-03-26T02:18:20Z", "path": "libs/core/src/main/java/org/elasticsearch/common/collect/List.java", "diffHunk": "@@ -0,0 +1,38 @@\n+/*\n+ * Licensed to Elasticsearch under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.elasticsearch.common.collect;\n+\n+import java.util.Arrays;\n+import java.util.Collections;\n+\n+public class List {", "originalCommit": "b6f29cdb22308fb3e683568a582c5f120392dad4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODI3OTQ2NQ==", "url": "https://github.com/elastic/elasticsearch/pull/54183#discussion_r398279465", "bodyText": "We will want Map.copyOf and Map.ofEntries too.", "author": "jasontedor", "createdAt": "2020-03-26T02:18:40Z", "path": "libs/core/src/main/java/org/elasticsearch/common/collect/Map.java", "diffHunk": "@@ -0,0 +1,113 @@\n+/*\n+ * Licensed to Elasticsearch under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.elasticsearch.common.collect;\n+\n+import java.util.Collections;\n+import java.util.HashMap;\n+\n+public class Map {", "originalCommit": "b6f29cdb22308fb3e683568a582c5f120392dad4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODI3OTYxMQ==", "url": "https://github.com/elastic/elasticsearch/pull/54183#discussion_r398279611", "bodyText": "We probably want Set.copyOf.", "author": "jasontedor", "createdAt": "2020-03-26T02:19:07Z", "path": "libs/core/src/main/java/org/elasticsearch/common/collect/Set.java", "diffHunk": "@@ -0,0 +1,39 @@\n+/*\n+ * Licensed to Elasticsearch under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.elasticsearch.common.collect;\n+\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.HashSet;\n+\n+public class Set {", "originalCommit": "b6f29cdb22308fb3e683568a582c5f120392dad4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODI3OTcwMA==", "url": "https://github.com/elastic/elasticsearch/pull/54183#discussion_r398279700", "bodyText": "I think we will want a specialization for the empty set (Set.of() -> Collections.emptySet()).", "author": "jasontedor", "createdAt": "2020-03-26T02:19:27Z", "path": "libs/core/src/main/java/org/elasticsearch/common/collect/Set.java", "diffHunk": "@@ -0,0 +1,39 @@\n+/*\n+ * Licensed to Elasticsearch under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.elasticsearch.common.collect;\n+\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.HashSet;\n+\n+public class Set {\n+\n+    /**\n+     * A Java8 implementation of the Java9 {@code Set.of()} method.\n+     * @param entries the elements to be contained in the set\n+     * @param <T> the {@code Set}'s element type\n+     * @return an unmodifiable set containing the specified elements.\n+     */\n+    @SafeVarargs\n+    @SuppressWarnings(\"varargs\")\n+    public static <T> java.util.Set<T> of(T... entries) {", "originalCommit": "b6f29cdb22308fb3e683568a582c5f120392dad4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODI4MDYzOQ==", "url": "https://github.com/elastic/elasticsearch/pull/54183#discussion_r398280639", "bodyText": "I think we will want Set.copyOf.", "author": "jasontedor", "createdAt": "2020-03-26T02:22:22Z", "path": "libs/core/src/main/java9/org/elasticsearch/common/collect/Set.java", "diffHunk": "@@ -0,0 +1,36 @@\n+/*\n+ * Licensed to Elasticsearch under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.elasticsearch.common.collect;\n+\n+public class Set {", "originalCommit": "b6f29cdb22308fb3e683568a582c5f120392dad4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODI4MDY5Mw==", "url": "https://github.com/elastic/elasticsearch/pull/54183#discussion_r398280693", "bodyText": "I think we will want specializations for empty, one, and two-element sets.", "author": "jasontedor", "createdAt": "2020-03-26T02:22:33Z", "path": "libs/core/src/main/java9/org/elasticsearch/common/collect/Set.java", "diffHunk": "@@ -0,0 +1,36 @@\n+/*\n+ * Licensed to Elasticsearch under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.elasticsearch.common.collect;\n+\n+public class Set {\n+\n+    /**\n+     * Delegates to the Java9 {@code Set.of()} method.\n+     * @param entries the elements to be contained in the set\n+     * @param <T> the {@code Set}'s element type\n+     * @return an unmodifiable set containing the specified elements.\n+     */\n+    @SafeVarargs\n+    @SuppressWarnings(\"varargs\")\n+    public static <T> java.util.Set<T> of(T... entries) {", "originalCommit": "b6f29cdb22308fb3e683568a582c5f120392dad4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "a7fc7227ac9e9fe0f7520a54a914189ec13d82ca", "url": "https://github.com/elastic/elasticsearch/commit/a7fc7227ac9e9fe0f7520a54a914189ec13d82ca", "message": "review comments", "committedDate": "2020-03-26T19:02:17Z", "type": "commit"}, {"oid": "2f03e2832cf1b043fa538ce7e173130a16d345a7", "url": "https://github.com/elastic/elasticsearch/commit/2f03e2832cf1b043fa538ce7e173130a16d345a7", "message": "optimized paths for zero and one elements", "committedDate": "2020-03-26T19:27:09Z", "type": "commit"}, {"oid": "0f40f57ea08c95463df5d2998069c69613ba0e9e", "url": "https://github.com/elastic/elasticsearch/commit/0f40f57ea08c95463df5d2998069c69613ba0e9e", "message": "Merge branch '7.x' into java8_collection_utils", "committedDate": "2020-03-27T08:32:23Z", "type": "commit"}, {"oid": "b643df9051814d1d259a4b04dacb4aaea2d34135", "url": "https://github.com/elastic/elasticsearch/commit/b643df9051814d1d259a4b04dacb4aaea2d34135", "message": "two-element overrides", "committedDate": "2020-03-27T08:32:31Z", "type": "commit"}, {"oid": "2d00d269f3a8e4f1cc3cf8e70183a28e388ed403", "url": "https://github.com/elastic/elasticsearch/commit/2d00d269f3a8e4f1cc3cf8e70183a28e388ed403", "message": "Merge branch 'java8_collection_utils' of https://github.com/danhermann/elasticsearch into java8_collection_utils", "committedDate": "2020-03-27T08:32:46Z", "type": "commit"}, {"oid": "35ba4973eec75184ee240fe72e9760eec46a8a3a", "url": "https://github.com/elastic/elasticsearch/commit/35ba4973eec75184ee240fe72e9760eec46a8a3a", "message": "missing test", "committedDate": "2020-03-27T13:01:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTQ5OTQ5NQ==", "url": "https://github.com/elastic/elasticsearch/pull/54183#discussion_r399499495", "bodyText": "This should be compileJava11Java", "author": "jasontedor", "createdAt": "2020-03-27T19:40:26Z", "path": "libs/core/build.gradle", "diffHunk": "@@ -44,13 +44,13 @@ if (!isEclipse) {\n   }\n \n   compileJava9Java {", "originalCommit": "35ba4973eec75184ee240fe72e9760eec46a8a3a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTUwMDI0Nw==", "url": "https://github.com/elastic/elasticsearch/pull/54183#discussion_r399500247", "bodyText": "We also need to change the source sets above, etc.\nHere's what I suggest, let's make changing this to Java 11 a separate change, so it can be reviewed separately. Can you open another pull request for this? Then we can merge that one, and rebase this PR on top of that.", "author": "jasontedor", "createdAt": "2020-03-27T19:42:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTQ5OTQ5NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDg5MjExNw==", "url": "https://github.com/elastic/elasticsearch/pull/54183#discussion_r400892117", "bodyText": "@jasontedor, I've rebased this PR now that the separate PR to update the MRJARs to Java11 has been merged.", "author": "danhermann", "createdAt": "2020-03-31T12:58:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTQ5OTQ5NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTQ5OTU4Nw==", "url": "https://github.com/elastic/elasticsearch/pull/54183#discussion_r399499587", "bodyText": "This should be forbiddenApisJava11", "author": "jasontedor", "createdAt": "2020-03-27T19:40:39Z", "path": "libs/core/build.gradle", "diffHunk": "@@ -44,13 +44,13 @@ if (!isEclipse) {\n   }\n \n   compileJava9Java {\n-    sourceCompatibility = 9\n-    targetCompatibility = 9\n+    sourceCompatibility = 11\n+    targetCompatibility = 11\n   }\n \n   forbiddenApisJava9 {", "originalCommit": "35ba4973eec75184ee240fe72e9760eec46a8a3a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "271b687f4e3d2f7f5f818b305671a616e2dfe863", "url": "https://github.com/elastic/elasticsearch/commit/271b687f4e3d2f7f5f818b305671a616e2dfe863", "message": "revert build.gradle changes", "committedDate": "2020-03-31T11:51:20Z", "type": "commit"}, {"oid": "7bde3231685b6743a4f8761fd200fdc72daad98a", "url": "https://github.com/elastic/elasticsearch/commit/7bde3231685b6743a4f8761fd200fdc72daad98a", "message": "Merge branch '7.x' into java8_collection_utils", "committedDate": "2020-03-31T11:52:12Z", "type": "commit"}, {"oid": "91d0e9295cdf78f9d0966d407bbaec8c977dacc1", "url": "https://github.com/elastic/elasticsearch/commit/91d0e9295cdf78f9d0966d407bbaec8c977dacc1", "message": "move to java11 source set", "committedDate": "2020-03-31T11:54:34Z", "type": "commit"}]}