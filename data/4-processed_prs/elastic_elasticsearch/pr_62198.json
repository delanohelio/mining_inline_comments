{"pr_number": 62198, "pr_title": "Deprecate the 'local' parameter of `/_cat/indices`", "pr_createdAt": "2020-09-10T02:32:38Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/62198", "timeline": [{"oid": "4687421c7d7c5bd7f777f0da7eba0ad7a61665b6", "url": "https://github.com/elastic/elasticsearch/commit/4687421c7d7c5bd7f777f0da7eba0ad7a61665b6", "message": "Deprecate the 'local' parameter of /_cat/indices", "committedDate": "2020-09-10T02:23:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjgwOTE4Nw==", "url": "https://github.com/elastic/elasticsearch/pull/62198#discussion_r492809187", "bodyText": "This creates two entries for the local parameter, one pulled from the common-parms file and this one. I'll solicit some input from our documentation writers on how best to handle this.", "author": "danhermann", "createdAt": "2020-09-22T15:03:34Z", "path": "docs/reference/cat/indices.asciidoc", "diffHunk": "@@ -75,6 +75,14 @@ include::{es-repo-dir}/rest-api/common-parms.asciidoc[tag=help]\n include::{es-repo-dir}/rest-api/common-parms.asciidoc[tag=include-unloaded-segments]\n \n include::{es-repo-dir}/rest-api/common-parms.asciidoc[tag=local]\n++\n+--\n+`local`::\n+(Optional, boolean) If true, the request retrieves information from the local node\n+only. Defaults to false, which means information is retrieved from the master node.\n+deprecated::[8.0,This parameter does not cause this API to act locally. It will be\n+removed in version 8.0.]\n+--", "originalCommit": "4687421c7d7c5bd7f777f0da7eba0ad7a61665b6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjgxNTg1NQ==", "url": "https://github.com/elastic/elasticsearch/pull/62198#discussion_r492815855", "bodyText": "@jrodewig, do you have any suggestions on how to handle this documentation case where a parameter pulled in from a common file needs to be marked as deprecated on a specific API?", "author": "danhermann", "createdAt": "2020-09-22T15:11:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjgwOTE4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjg1ODM3Mg==", "url": "https://github.com/elastic/elasticsearch/pull/62198#discussion_r492858372", "bodyText": "I left a suggestion here: #62198 (comment)", "author": "jrodewig", "createdAt": "2020-09-22T16:05:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjgwOTE4Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjgxMzE0Nw==", "url": "https://github.com/elastic/elasticsearch/pull/62198#discussion_r492813147", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                static final String LOCAL_DEPRECATED_MESSAGE = \"Deprecated parameter [local] used. This parameter does not cause this API to act \" +\n          \n          \n            \n                    \"locally, and should not be used. It will be unsupported in version 8.0.\";\n          \n          \n            \n                static final String LOCAL_DEPRECATED_MESSAGE = \"The parameter [local] is deprecated and will be removed in a future release.\";", "author": "danhermann", "createdAt": "2020-09-22T15:08:24Z", "path": "server/src/main/java/org/elasticsearch/rest/action/cat/RestIndicesAction.java", "diffHunk": "@@ -66,6 +67,9 @@\n import static org.elasticsearch.rest.RestRequest.Method.GET;\n \n public class RestIndicesAction extends AbstractCatAction {\n+    private static final DeprecationLogger DEPRECATION_LOGGER = DeprecationLogger.getLogger(RestIndicesAction.class);\n+    static final String LOCAL_DEPRECATED_MESSAGE = \"Deprecated parameter [local] used. This parameter does not cause this API to act \" +\n+        \"locally, and should not be used. It will be unsupported in version 8.0.\";", "originalCommit": "4687421c7d7c5bd7f777f0da7eba0ad7a61665b6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjg1Nzk2OA==", "url": "https://github.com/elastic/elasticsearch/pull/62198#discussion_r492857968", "bodyText": "Shouldn't this be the release in which we deprecate the parameter? That should be before 8.0.0.", "author": "jrodewig", "createdAt": "2020-09-22T16:05:02Z", "path": "rest-api-spec/src/main/resources/rest-api-spec/api/cat.indices.json", "diffHunk": "@@ -51,7 +51,11 @@\n       },\n       \"local\":{\n         \"type\":\"boolean\",\n-        \"description\":\"Return local information, do not retrieve the state from master node (default: false)\"\n+        \"description\":\"Return local information, do not retrieve the state from master node (default: false)\",\n+        \"deprecated\":{\n+          \"version\":\"8.0.0\",", "originalCommit": "4687421c7d7c5bd7f777f0da7eba0ad7a61665b6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjg2NDQyOA==", "url": "https://github.com/elastic/elasticsearch/pull/62198#discussion_r492864428", "bodyText": "We typically update the version when backporting to a release branch and then come back and update the master branch.", "author": "danhermann", "createdAt": "2020-09-22T16:14:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjg1Nzk2OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjg1Nzk4NQ==", "url": "https://github.com/elastic/elasticsearch/pull/62198#discussion_r492857985", "bodyText": "@boicehuang @danhermann You can simply remove the include statement. Since this parameter is currently no-op, we can just expand the deprecation message. Note you'll need to update the deprecation release based on where we backport this.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            include::{es-repo-dir}/rest-api/common-parms.asciidoc[tag=local]\n          \n          \n            \n            +\n          \n          \n            \n            --\n          \n          \n            \n            `local`::\n          \n          \n            \n            (Optional, boolean) If true, the request retrieves information from the local node\n          \n          \n            \n            only. Defaults to false, which means information is retrieved from the master node.\n          \n          \n            \n            deprecated::[8.0,This parameter does not cause this API to act locally. It will be\n          \n          \n            \n            removed in version 8.0.]\n          \n          \n            \n            --\n          \n          \n            \n            `local`::\n          \n          \n            \n            (Optional, boolean)\n          \n          \n            \n            +\n          \n          \n            \n            deprecated::[7.10.0,\"This parameter does not affect the request. It will be removed in version 8.0.0.\"]", "author": "jrodewig", "createdAt": "2020-09-22T16:05:03Z", "path": "docs/reference/cat/indices.asciidoc", "diffHunk": "@@ -75,6 +75,14 @@ include::{es-repo-dir}/rest-api/common-parms.asciidoc[tag=help]\n include::{es-repo-dir}/rest-api/common-parms.asciidoc[tag=include-unloaded-segments]\n \n include::{es-repo-dir}/rest-api/common-parms.asciidoc[tag=local]\n++\n+--\n+`local`::\n+(Optional, boolean) If true, the request retrieves information from the local node\n+only. Defaults to false, which means information is retrieved from the master node.\n+deprecated::[8.0,This parameter does not cause this API to act locally. It will be\n+removed in version 8.0.]\n+--", "originalCommit": "4687421c7d7c5bd7f777f0da7eba0ad7a61665b6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjg2NTMyMQ==", "url": "https://github.com/elastic/elasticsearch/pull/62198#discussion_r492865321", "bodyText": "Ah, thank you, that makes sense. I see now that each include specifies a single tag from the file.", "author": "danhermann", "createdAt": "2020-09-22T16:15:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjg1Nzk4NQ=="}], "type": "inlineReview"}, {"oid": "00e4e36879c40c7e40ec2ac82482ee6b365a9a6c", "url": "https://github.com/elastic/elasticsearch/commit/00e4e36879c40c7e40ec2ac82482ee6b365a9a6c", "message": "fix indices.asciidoc", "committedDate": "2020-10-16T10:09:48Z", "type": "commit"}, {"oid": "4a4604b670f973851b8e5d50c23ca2d3e4bb34ed", "url": "https://github.com/elastic/elasticsearch/commit/4a4604b670f973851b8e5d50c23ca2d3e4bb34ed", "message": "fix deprecated log", "committedDate": "2020-10-16T10:11:34Z", "type": "commit"}, {"oid": "8f01c026c27577eafe6328a2696cb93d8221fac9", "url": "https://github.com/elastic/elasticsearch/commit/8f01c026c27577eafe6328a2696cb93d8221fac9", "message": "Merge remote-tracking branch 'upstream/master' into cat_indices_local", "committedDate": "2020-10-19T00:12:08Z", "type": "commit"}, {"oid": "a1376c765ba5313d67e94a263eae248858c73d6f", "url": "https://github.com/elastic/elasticsearch/commit/a1376c765ba5313d67e94a263eae248858c73d6f", "message": "fix description", "committedDate": "2020-10-28T07:37:05Z", "type": "commit"}, {"oid": "742df9f997c1c3f50e8facb172b30728aa326d4e", "url": "https://github.com/elastic/elasticsearch/commit/742df9f997c1c3f50e8facb172b30728aa326d4e", "message": "fix doc", "committedDate": "2020-10-29T10:02:05Z", "type": "commit"}, {"oid": "9021609e54aeb54be0432cc817dac0c1fb8e96b6", "url": "https://github.com/elastic/elasticsearch/commit/9021609e54aeb54be0432cc817dac0c1fb8e96b6", "message": "Merge remote-tracking branch 'upstream/master' into cat_indices_local", "committedDate": "2020-10-29T10:03:57Z", "type": "commit"}]}