{"pr_number": 58331, "pr_title": "[ML] Make regression training set predictable in size", "pr_createdAt": "2020-06-18T14:12:55Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/58331", "timeline": [{"oid": "9f256c34099362713af8cf1e1cd4f18d665f1d95", "url": "https://github.com/elastic/elasticsearch/commit/9f256c34099362713af8cf1e1cd4f18d665f1d95", "message": "[ML] Make regression training set predictable in size\n\nUnlike `classification`, which is using a cross validation splitter\nthat produces training sets whose size is predictable and equal to\n`training_percent * class_cardinality`, for regression we have been\nusing a random splitter that takes an independent decision for each\ndocument. This means we cannot predict the exact size of the training\nset. This poses a problem as we move towards performing test inference\non the java side as we need to be able to provide an accurate upper\nbound of the training set size to the c++ process.\n\nThis commit replaces the random splitter we use for regression with\nthe same streaming-reservoir approach we do for `classification`.", "committedDate": "2020-06-18T15:09:50Z", "type": "commit"}, {"oid": "9f256c34099362713af8cf1e1cd4f18d665f1d95", "url": "https://github.com/elastic/elasticsearch/commit/9f256c34099362713af8cf1e1cd4f18d665f1d95", "message": "[ML] Make regression training set predictable in size\n\nUnlike `classification`, which is using a cross validation splitter\nthat produces training sets whose size is predictable and equal to\n`training_percent * class_cardinality`, for regression we have been\nusing a random splitter that takes an independent decision for each\ndocument. This means we cannot predict the exact size of the training\nset. This poses a problem as we move towards performing test inference\non the java side as we need to be able to provide an accurate upper\nbound of the training set size to the c++ process.\n\nThis commit replaces the random splitter we use for regression with\nthe same streaming-reservoir approach we do for `classification`.", "committedDate": "2020-06-18T15:09:50Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjMwNjMyMQ==", "url": "https://github.com/elastic/elasticsearch/pull/58331#discussion_r442306321", "bodyText": "I always double take when I read cardinality in the SampleInfo and here in this class.\nThe scope what what cardinality we are checking is unclear. Usually when I read cardinality I associate it with the  number of classes. But in this case, cardinality is the count of documents in our specific class", "author": "benwtrent", "createdAt": "2020-06-18T15:18:32Z", "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/dataframe/process/crossvalidation/SingleClassReservoirCrossValidationSplitter.java", "diffHunk": "@@ -0,0 +1,25 @@\n+/*\n+ * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n+ * or more contributor license agreements. Licensed under the Elastic License;\n+ * you may not use this file except in compliance with the Elastic License.\n+ */\n+\n+package org.elasticsearch.xpack.ml.dataframe.process.crossvalidation;\n+\n+import java.util.List;\n+\n+public class SingleClassReservoirCrossValidationSplitter extends AbstractReservoirCrossValidationSplitter {\n+\n+    private final SampleInfo sampleInfo;\n+\n+    SingleClassReservoirCrossValidationSplitter(List<String> fieldNames, String dependentVariable, double trainingPercent,\n+                                                long randomizeSeed, long trainingCardinality) {", "originalCommit": "9f256c34099362713af8cf1e1cd4f18d665f1d95", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjMxNDUzNg==", "url": "https://github.com/elastic/elasticsearch/pull/58331#discussion_r442314536", "bodyText": "Yeah, I see what you mean. Shall I rename to docCount or something?", "author": "dimitris-athanasiou", "createdAt": "2020-06-18T15:30:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjMwNjMyMQ=="}], "type": "inlineReview"}, {"oid": "5cface2f9f4a081204380b03cc514c0cf39124c9", "url": "https://github.com/elastic/elasticsearch/commit/5cface2f9f4a081204380b03cc514c0cf39124c9", "message": "Use count instead of cardinality", "committedDate": "2020-06-23T13:33:02Z", "type": "commit"}, {"oid": "f2ebd034bb5eb30ab5cb68497065865ff70c4aa3", "url": "https://github.com/elastic/elasticsearch/commit/f2ebd034bb5eb30ab5cb68497065865ff70c4aa3", "message": "Merge branch 'master' into make-regression-training-set-predictable-in-size", "committedDate": "2020-06-23T14:17:51Z", "type": "commit"}]}