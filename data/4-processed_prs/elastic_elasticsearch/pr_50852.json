{"pr_number": 50852, "pr_title": "[ML][Inference] PUT API", "pr_createdAt": "2020-01-10T12:38:48Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/50852", "timeline": [{"oid": "5b5d2127ec1ea1eefb7e95f45945f614a8df6642", "url": "https://github.com/elastic/elasticsearch/commit/5b5d2127ec1ea1eefb7e95f45945f614a8df6642", "message": "[ML][Inference] PUT API", "committedDate": "2020-01-10T12:33:07Z", "type": "commit"}, {"oid": "206738642c1a8825dfcda7c970790f5205d0a501", "url": "https://github.com/elastic/elasticsearch/commit/206738642c1a8825dfcda7c970790f5205d0a501", "message": "fixing tests", "committedDate": "2020-01-10T13:15:46Z", "type": "commit"}, {"oid": "325ec13df2875cbfcf60898e13dd681ec0ef7e5b", "url": "https://github.com/elastic/elasticsearch/commit/325ec13df2875cbfcf60898e13dd681ec0ef7e5b", "message": "adding compression logic to hlrc for inference definitions", "committedDate": "2020-01-10T13:45:52Z", "type": "commit"}, {"oid": "48f2e5fef6a83661fd1fb32664cfd425210e297f", "url": "https://github.com/elastic/elasticsearch/commit/48f2e5fef6a83661fd1fb32664cfd425210e297f", "message": "fixing yaml test", "committedDate": "2020-01-10T14:36:05Z", "type": "commit"}, {"oid": "f04193f245dfe487e807961c6fbfba339f0c934a", "url": "https://github.com/elastic/elasticsearch/commit/f04193f245dfe487e807961c6fbfba339f0c934a", "message": "fixing yaml tests more", "committedDate": "2020-01-10T15:46:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTUxMzA0Mw==", "url": "https://github.com/elastic/elasticsearch/pull/50852#discussion_r365513043", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * Get trained model config asynchronously and notifies listener upon completion\n          \n          \n            \n                 * Put trained model config asynchronously and notifiy listener upon completion", "author": "davidkyle", "createdAt": "2020-01-11T10:24:14Z", "path": "client/rest-high-level/src/main/java/org/elasticsearch/client/MachineLearningClient.java", "diffHunk": "@@ -2340,6 +2342,48 @@ public Cancellable getTrainedModelsAsync(GetTrainedModelsRequest request,\n             Collections.emptySet());\n     }\n \n+    /**\n+     * Put trained model config\n+     * <p>\n+     * For additional info\n+     * see <a href=\"TODO\">\n+     *     PUT Trained Model Config documentation</a>\n+     *\n+     * @param request The {@link PutTrainedModelRequest}\n+     * @param options Additional request options (e.g. headers), use {@link RequestOptions#DEFAULT} if nothing needs to be customized\n+     * @return {@link PutTrainedModelResponse} response object\n+     */\n+    public PutTrainedModelResponse putTrainedModel(PutTrainedModelRequest request, RequestOptions options) throws IOException {\n+        return restHighLevelClient.performRequestAndParseEntity(request,\n+            MLRequestConverters::putTrainedModel,\n+            options,\n+            PutTrainedModelResponse::fromXContent,\n+            Collections.emptySet());\n+    }\n+\n+    /**\n+     * Get trained model config asynchronously and notifies listener upon completion", "originalCommit": "f04193f245dfe487e807961c6fbfba339f0c934a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTUxMzQ1NA==", "url": "https://github.com/elastic/elasticsearch/pull/50852#discussion_r365513454", "bodyText": "I think inflate isn't called anywhere apart from InferenceToXContentCompressorTests. If it goes SimpleBoundedInputStream could also be removed?", "author": "davidkyle", "createdAt": "2020-01-11T10:33:10Z", "path": "client/rest-high-level/src/main/java/org/elasticsearch/client/ml/inference/InferenceToXContentCompressor.java", "diffHunk": "@@ -0,0 +1,81 @@\n+/*\n+ * Licensed to Elasticsearch under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.elasticsearch.client.ml.inference;\n+\n+import org.elasticsearch.common.CheckedFunction;\n+import org.elasticsearch.common.bytes.BytesArray;\n+import org.elasticsearch.common.bytes.BytesReference;\n+import org.elasticsearch.common.io.Streams;\n+import org.elasticsearch.common.io.stream.BytesStreamOutput;\n+import org.elasticsearch.common.xcontent.DeprecationHandler;\n+import org.elasticsearch.common.xcontent.NamedXContentRegistry;\n+import org.elasticsearch.common.xcontent.ToXContentObject;\n+import org.elasticsearch.common.xcontent.XContentHelper;\n+import org.elasticsearch.common.xcontent.XContentParser;\n+import org.elasticsearch.common.xcontent.XContentType;\n+\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.io.OutputStream;\n+import java.nio.charset.StandardCharsets;\n+import java.util.Base64;\n+import java.util.zip.GZIPInputStream;\n+import java.util.zip.GZIPOutputStream;\n+\n+/**\n+ * Collection of helper methods. Similar to CompressedXContent, but this utilizes GZIP.\n+ */\n+public final class InferenceToXContentCompressor {\n+    private static final int BUFFER_SIZE = 4096;\n+    private static final long MAX_INFLATED_BYTES = 1_000_000_000; // 1 gb maximum\n+\n+    private InferenceToXContentCompressor() {}\n+\n+    public static <T extends ToXContentObject> String deflate(T objectToCompress) throws IOException {\n+        BytesReference reference = XContentHelper.toXContent(objectToCompress, XContentType.JSON, false);\n+        return deflate(reference);\n+    }\n+\n+    public static <T> T inflate(String compressedString,", "originalCommit": "f04193f245dfe487e807961c6fbfba339f0c934a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTUzODU4Ng==", "url": "https://github.com/elastic/elasticsearch/pull/50852#discussion_r365538586", "bodyText": "@davidkyle possibly...but I was thinking of users requesting the compressed format from elasticsearch (for faster retrieval) and only inflating locally.", "author": "benwtrent", "createdAt": "2020-01-11T19:45:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTUxMzQ1NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTUxMzYwNQ==", "url": "https://github.com/elastic/elasticsearch/pull/50852#discussion_r365513605", "bodyText": "createTime can't be null on the server side class. Are we going to set createTime automatically on PUT if not set?", "author": "davidkyle", "createdAt": "2020-01-11T10:36:54Z", "path": "client/rest-high-level/src/main/java/org/elasticsearch/client/ml/inference/TrainedModelConfig.java", "diffHunk": "@@ -111,7 +112,7 @@ public static TrainedModelConfig fromXContent(XContentParser parser) throws IOEx\n         this.modelId = modelId;\n         this.createdBy = createdBy;\n         this.version = version;\n-        this.createTime = Instant.ofEpochMilli(createTime.toEpochMilli());\n+        this.createTime = createTime == null ? null : Instant.ofEpochMilli(createTime.toEpochMilli());", "originalCommit": "f04193f245dfe487e807961c6fbfba339f0c934a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTUxNDc1Mw==", "url": "https://github.com/elastic/elasticsearch/pull/50852#discussion_r365514753", "bodyText": "I scrolled down \ud83d\udc4d", "author": "davidkyle", "createdAt": "2020-01-11T11:06:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTUxMzYwNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTUxNDU4Ng==", "url": "https://github.com/elastic/elasticsearch/pull/50852#discussion_r365514586", "bodyText": "validate() can only be called once on PUT as the builder will set these fields so if called on a built config it will error. Maybe add a isCreateTime flag or similar.\nPutJobAction has the same issue and does the validation of create time settings in the action", "author": "davidkyle", "createdAt": "2020-01-11T11:02:57Z", "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/inference/TrainedModelConfig.java", "diffHunk": "@@ -466,51 +488,89 @@ public Builder setLicenseLevel(String licenseLevel) {\n             return this;\n         }\n \n-        // TODO move to REST level instead of here in the builder\n-        public void validate() {\n+        /**\n+         * Runs validations against the builder.\n+         * @return The current builder object if validations are successful\n+         * @throws ActionRequestValidationException when there are validation failures.\n+         */\n+        public Builder validate() {\n             // We require a definition to be available here even though it will be stored in a different doc\n-            ExceptionsHelper.requireNonNull(definition, DEFINITION);\n-            ExceptionsHelper.requireNonNull(modelId, MODEL_ID);\n-\n-            if (MlStrings.isValidId(modelId) == false) {\n-                throw ExceptionsHelper.badRequestException(Messages.getMessage(Messages.INVALID_ID, MODEL_ID.getPreferredName(), modelId));\n+            ActionRequestValidationException validationException = null;\n+            if (definition == null) {\n+                validationException = addValidationError(\"[\" + DEFINITION.getPreferredName() + \"] must not be null.\", validationException);\n+            }\n+            if (modelId == null) {\n+                validationException = addValidationError(\"[\" + MODEL_ID.getPreferredName() + \"] must not be null.\", validationException);\n             }\n \n-            if (MlStrings.hasValidLengthForId(modelId) == false) {\n-                throw ExceptionsHelper.badRequestException(Messages.getMessage(Messages.ID_TOO_LONG,\n-                    MODEL_ID.getPreferredName(),\n+            if (modelId != null && MlStrings.isValidId(modelId) == false) {\n+                validationException = addValidationError(Messages.getMessage(Messages.INVALID_ID,\n+                    TrainedModelConfig.MODEL_ID.getPreferredName(),\n+                    modelId),\n+                    validationException);\n+            }\n+            if (modelId != null && MlStrings.hasValidLengthForId(modelId) == false) {\n+                validationException = addValidationError(Messages.getMessage(Messages.ID_TOO_LONG,\n+                    TrainedModelConfig.MODEL_ID.getPreferredName(),\n                     modelId,\n-                    MlStrings.ID_LENGTH_LIMIT));\n+                    MlStrings.ID_LENGTH_LIMIT), validationException);\n+            }\n+            List<String> badTags = tags.stream()\n+                .filter(tag -> (MlStrings.isValidId(tag) && MlStrings.hasValidLengthForId(tag)) == false)\n+                .collect(Collectors.toList());\n+            if (badTags.isEmpty() == false) {\n+                validationException = addValidationError(Messages.getMessage(Messages.INFERENCE_INVALID_TAGS,\n+                    badTags,\n+                    MlStrings.ID_LENGTH_LIMIT),\n+                    validationException);\n+            }\n+\n+            for(String tag : tags) {\n+                if (tag.equals(modelId)) {\n+                    validationException = addValidationError(\"none of the tags must equal the model_id\", validationException);\n+                    break;\n+                }\n+            }\n+\n+            validationException = checkIllegalSetting(version, VERSION.getPreferredName(), validationException);", "originalCommit": "f04193f245dfe487e807961c6fbfba339f0c934a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTUxNTQ3OQ==", "url": "https://github.com/elastic/elasticsearch/pull/50852#discussion_r365515479", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    \"  \\\"created_by\\\": \\\"es_test\\\",\\n\" +\n          \n          \n            \n                    \"  \\\"created_by\\\": \\\"benwtrent\\\",\\n\" +\n          \n      \n    \n    \n  \n\nTake the glory dude", "author": "davidkyle", "createdAt": "2020-01-11T11:21:39Z", "path": "x-pack/plugin/ml/qa/native-multi-node-tests/src/test/java/org/elasticsearch/xpack/ml/integration/InferenceIngestIT.java", "diffHunk": "@@ -518,38 +511,38 @@ public void testSimulateLangIdent() {\n         \"  }\\n\" +\n         \"}\";\n \n-    private static String buildClassificationModelDoc() throws IOException {\n-        String compressed =\n-            InferenceToXContentCompressor.deflate(new BytesArray(CLASSIFICATION_DEFINITION.getBytes(StandardCharsets.UTF_8)));\n-        return modelDocString(compressed, \"test_classification\");\n+    private TrainedModelConfig buildClassificationModel() throws IOException {\n+        try (XContentParser parser = XContentHelper.createParser(xContentRegistry(),\n+            DeprecationHandler.THROW_UNSUPPORTED_OPERATION,\n+            new BytesArray(CLASSIFICATION_CONFIG),\n+            XContentType.JSON)) {\n+            return TrainedModelConfig.LENIENT_PARSER.apply(parser, null).build();\n+        }\n     }\n \n-    private static String buildRegressionModelDoc() throws IOException {\n-        String compressed = InferenceToXContentCompressor.deflate(new BytesArray(REGRESSION_DEFINITION.getBytes(StandardCharsets.UTF_8)));\n-        return modelDocString(compressed, \"test_regression\");\n+    private TrainedModelConfig buildRegressionModel() throws IOException {\n+        try (XContentParser parser = XContentHelper.createParser(xContentRegistry(),\n+            DeprecationHandler.THROW_UNSUPPORTED_OPERATION,\n+            new BytesArray(REGRESSION_CONFIG),\n+            XContentType.JSON)) {\n+            return TrainedModelConfig.LENIENT_PARSER.apply(parser, null).build();\n+        }\n     }\n \n-    private static String modelDocString(String compressedDefinition, String modelId) {\n-        return \"\" +\n-            \"{\" +\n-            \"\\\"model_id\\\": \\\"\" + modelId + \"\\\",\\n\" +\n-            \"\\\"doc_num\\\": 0,\\n\" +\n-            \"\\\"doc_type\\\": \\\"trained_model_definition_doc\\\",\\n\" +\n-            \"  \\\"compression_version\\\": \" + 1 + \",\\n\" +\n-            \"  \\\"total_definition_length\\\": \" + compressedDefinition.length() + \",\\n\" +\n-            \"  \\\"definition_length\\\": \" + compressedDefinition.length() + \",\\n\" +\n-            \"\\\"definition\\\": \\\"\" + compressedDefinition + \"\\\"\\n\" +\n-            \"}\";\n+    @Override\n+    protected NamedXContentRegistry xContentRegistry() {\n+        return new NamedXContentRegistry(new MlInferenceNamedXContentProvider().getNamedXContentParsers());\n     }\n \n     private static final String CLASSIFICATION_CONFIG = \"\" +\n         \"{\\n\" +\n         \"  \\\"model_id\\\": \\\"test_classification\\\",\\n\" +\n         \"  \\\"input\\\":{\\\"field_names\\\":[\\\"col1\\\",\\\"col2\\\",\\\"col3\\\",\\\"col4\\\"]},\" +\n         \"  \\\"description\\\": \\\"test model for classification\\\",\\n\" +\n+        \"  \\\"definition\\\": \" + CLASSIFICATION_DEFINITION + \",\"+\n         \"  \\\"version\\\": \\\"8.0.0\\\",\\n\" +\n         \"  \\\"license_level\\\": \\\"platinum\\\",\\n\" +\n-        \"  \\\"created_by\\\": \\\"benwtrent\\\",\\n\" +\n+        \"  \\\"created_by\\\": \\\"es_test\\\",\\n\" +", "originalCommit": "f04193f245dfe487e807961c6fbfba339f0c934a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTUzODYzNg==", "url": "https://github.com/elastic/elasticsearch/pull/50852#discussion_r365538636", "bodyText": "HAHAHA", "author": "benwtrent", "createdAt": "2020-01-11T19:47:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTUxNTQ3OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTUxNjAzMA==", "url": "https://github.com/elastic/elasticsearch/pull/50852#discussion_r365516030", "bodyText": "I thought created by would be the users name (if security is enabled) but now I realise not. Maybe api rather than user. Or api_user. Our included models are createdBy: ml_admin", "author": "davidkyle", "createdAt": "2020-01-11T11:31:43Z", "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/action/TransportPutTrainedModelAction.java", "diffHunk": "@@ -0,0 +1,190 @@\n+/*\n+ * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n+ * or more contributor license agreements. Licensed under the Elastic License;\n+ * you may not use this file except in compliance with the Elastic License.\n+ */\n+package org.elasticsearch.xpack.ml.action;\n+\n+import org.elasticsearch.ElasticsearchException;\n+import org.elasticsearch.Version;\n+import org.elasticsearch.action.ActionListener;\n+import org.elasticsearch.action.search.SearchRequest;\n+import org.elasticsearch.action.search.SearchResponse;\n+import org.elasticsearch.action.support.ActionFilters;\n+import org.elasticsearch.action.support.master.TransportMasterNodeAction;\n+import org.elasticsearch.client.Client;\n+import org.elasticsearch.cluster.ClusterState;\n+import org.elasticsearch.cluster.block.ClusterBlockException;\n+import org.elasticsearch.cluster.block.ClusterBlockLevel;\n+import org.elasticsearch.cluster.metadata.IndexNameExpressionResolver;\n+import org.elasticsearch.cluster.service.ClusterService;\n+import org.elasticsearch.common.inject.Inject;\n+import org.elasticsearch.common.io.stream.StreamInput;\n+import org.elasticsearch.common.xcontent.NamedXContentRegistry;\n+import org.elasticsearch.index.query.QueryBuilder;\n+import org.elasticsearch.index.query.QueryBuilders;\n+import org.elasticsearch.license.License;\n+import org.elasticsearch.license.LicenseUtils;\n+import org.elasticsearch.license.XPackLicenseState;\n+import org.elasticsearch.search.builder.SearchSourceBuilder;\n+import org.elasticsearch.tasks.Task;\n+import org.elasticsearch.threadpool.ThreadPool;\n+import org.elasticsearch.transport.TransportService;\n+import org.elasticsearch.xpack.core.XPackField;\n+import org.elasticsearch.xpack.core.ml.action.PutTrainedModelAction;\n+import org.elasticsearch.xpack.core.ml.action.PutTrainedModelAction.Request;\n+import org.elasticsearch.xpack.core.ml.action.PutTrainedModelAction.Response;\n+import org.elasticsearch.xpack.core.ml.inference.TrainedModelConfig;\n+import org.elasticsearch.xpack.core.ml.inference.persistence.InferenceIndexConstants;\n+import org.elasticsearch.xpack.core.ml.job.messages.Messages;\n+import org.elasticsearch.xpack.core.ml.utils.ExceptionsHelper;\n+import org.elasticsearch.xpack.ml.inference.persistence.TrainedModelProvider;\n+\n+import java.io.IOException;\n+import java.time.Instant;\n+import java.util.List;\n+\n+import static org.elasticsearch.xpack.core.ClientHelper.ML_ORIGIN;\n+import static org.elasticsearch.xpack.core.ClientHelper.executeAsyncWithOrigin;\n+\n+public class TransportPutTrainedModelAction extends TransportMasterNodeAction<Request, Response> {\n+\n+    private final TrainedModelProvider trainedModelProvider;\n+    private final XPackLicenseState licenseState;\n+    private final NamedXContentRegistry xContentRegistry;\n+    private final Client client;\n+\n+    @Inject\n+    public TransportPutTrainedModelAction(TransportService transportService, ClusterService clusterService,\n+                                          ThreadPool threadPool, XPackLicenseState licenseState, ActionFilters actionFilters,\n+                                          IndexNameExpressionResolver indexNameExpressionResolver, Client client,\n+                                          TrainedModelProvider trainedModelProvider, NamedXContentRegistry xContentRegistry) {\n+        super(PutTrainedModelAction.NAME, transportService, clusterService, threadPool, actionFilters, Request::new,\n+            indexNameExpressionResolver);\n+        this.licenseState = licenseState;\n+        this.trainedModelProvider = trainedModelProvider;\n+        this.xContentRegistry = xContentRegistry;\n+        this.client = client;\n+    }\n+\n+    @Override\n+    protected String executor() {\n+        return ThreadPool.Names.SAME;\n+    }\n+\n+    @Override\n+    protected Response read(StreamInput in) throws IOException {\n+        return new Response(in);\n+    }\n+\n+    @Override\n+    protected void masterOperation(Task task,\n+                                   PutTrainedModelAction.Request request,\n+                                   ClusterState state,\n+                                   ActionListener<Response> listener) {\n+        try {\n+            request.getTrainedModelConfig().ensureParsedDefinition(xContentRegistry);\n+            request.getTrainedModelConfig().getModelDefinition().getTrainedModel().validate();\n+        } catch (IOException ex) {\n+            listener.onFailure(ExceptionsHelper.badRequestException(\"Failed to parse definition for [{}]\",\n+                ex,\n+                request.getTrainedModelConfig().getModelId()));\n+            return;\n+        } catch (ElasticsearchException ex) {\n+            listener.onFailure(ExceptionsHelper.badRequestException(\"Definition for [{}] has validation failures.\",\n+                ex,\n+                request.getTrainedModelConfig().getModelId()));\n+            return;\n+        }\n+\n+        TrainedModelConfig trainedModelConfig = new TrainedModelConfig.Builder(request.getTrainedModelConfig())\n+            .setVersion(Version.CURRENT)\n+            .setCreateTime(Instant.now())\n+            .setCreatedBy(\"user\")", "originalCommit": "f04193f245dfe487e807961c6fbfba339f0c934a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTUzODk1OA==", "url": "https://github.com/elastic/elasticsearch/pull/50852#discussion_r365538958", "bodyText": "api_user seems good to me.\nYeah, I don't think we should include the actual user name for security reasons. It seems like a potential to leak info. Somebody could have permissions to read trained models, but not permission to see all configured users.", "author": "benwtrent", "createdAt": "2020-01-11T19:54:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTUxNjAzMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTU0MDE2MQ==", "url": "https://github.com/elastic/elasticsearch/pull/50852#discussion_r365540161", "bodyText": "Maybe it would be best to match what we did for system created annotations. Otherwise we\u2019re just creating a plethora of imaginary users and eventually someone will ask why they\u2019re all different.", "author": "droberts195", "createdAt": "2020-01-11T20:20:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTUxNjAzMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTU0MDM5NA==", "url": "https://github.com/elastic/elasticsearch/pull/50852#discussion_r365540394", "bodyText": "@droberts195 for our internal created annotations, we use XPackUser.NAME which is _xpack. I am fine switching it to that in a subsequent PR.", "author": "benwtrent", "createdAt": "2020-01-11T20:26:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTUxNjAzMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTUxNjI3MA==", "url": "https://github.com/elastic/elasticsearch/pull/50852#discussion_r365516270", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    return \"xpack_ml_put_data_frame_analytics_action\";\n          \n          \n            \n                    return \"xpack_ml_put_trained_model_action\";", "author": "davidkyle", "createdAt": "2020-01-11T11:37:42Z", "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/inference/RestPutTrainedModelAction.java", "diffHunk": "@@ -0,0 +1,42 @@\n+/*\n+ * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n+ * or more contributor license agreements. Licensed under the Elastic License;\n+ * you may not use this file except in compliance with the Elastic License.\n+ */\n+package org.elasticsearch.xpack.ml.rest.inference;\n+\n+import org.elasticsearch.client.node.NodeClient;\n+import org.elasticsearch.common.xcontent.XContentParser;\n+import org.elasticsearch.rest.BaseRestHandler;\n+import org.elasticsearch.rest.RestController;\n+import org.elasticsearch.rest.RestRequest;\n+import org.elasticsearch.rest.action.RestToXContentListener;\n+import org.elasticsearch.xpack.core.ml.action.PutTrainedModelAction;\n+import org.elasticsearch.xpack.core.ml.inference.TrainedModelConfig;\n+import org.elasticsearch.xpack.ml.MachineLearning;\n+\n+import java.io.IOException;\n+\n+public class RestPutTrainedModelAction extends BaseRestHandler {\n+\n+    public RestPutTrainedModelAction(RestController controller) {\n+        controller.registerHandler(RestRequest.Method.PUT,\n+            MachineLearning.BASE_PATH + \"inference/{\" + TrainedModelConfig.MODEL_ID.getPreferredName() + \"}\",\n+            this);\n+    }\n+\n+    @Override\n+    public String getName() {\n+        return \"xpack_ml_put_data_frame_analytics_action\";", "originalCommit": "f04193f245dfe487e807961c6fbfba339f0c934a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "b102d375b26f0a22e3b2bb819c01091b38882cc4", "url": "https://github.com/elastic/elasticsearch/commit/b102d375b26f0a22e3b2bb819c01091b38882cc4", "message": "addressing PR comments", "committedDate": "2020-01-11T20:14:44Z", "type": "commit"}]}