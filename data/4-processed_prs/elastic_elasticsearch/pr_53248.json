{"pr_number": 53248, "pr_title": "Allow _cat indices & aliases to use indices options", "pr_createdAt": "2020-03-06T22:53:56Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/53248", "timeline": [{"oid": "8159e80b31f8564371d1fc7ce198cd7915315265", "url": "https://github.com/elastic/elasticsearch/commit/8159e80b31f8564371d1fc7ce198cd7915315265", "message": "Allow _cat indices & aliases to use indices options\n\nThis commit adjusts the _cat/indices and _cat/aliases APIs to allow\nspecifying indices options, so that these APIs can handle hidden\nindices/aliases in the same way as other APIs.", "committedDate": "2020-03-06T22:51:21Z", "type": "commit"}, {"oid": "a06ddb5bf856aaeca36cf2d198fd315dba553b7e", "url": "https://github.com/elastic/elasticsearch/commit/a06ddb5bf856aaeca36cf2d198fd315dba553b7e", "message": "Add \"hidden\" expand_wildcards option to YAML spec", "committedDate": "2020-03-10T21:44:33Z", "type": "commit"}, {"oid": "8308cf16944cc97a2d2687326fb3881ab3f469e6", "url": "https://github.com/elastic/elasticsearch/commit/8308cf16944cc97a2d2687326fb3881ab3f469e6", "message": "Update Get Alias API expand_wildcards default in spec", "committedDate": "2020-03-10T21:52:51Z", "type": "commit"}, {"oid": "373763472c39bed443c01791a03f48b93088b4ea", "url": "https://github.com/elastic/elasticsearch/commit/373763472c39bed443c01791a03f48b93088b4ea", "message": "Add expand_wildcards to _cat indices & aliases spec", "committedDate": "2020-03-10T23:06:05Z", "type": "commit"}, {"oid": "5fa1c2bea94bc8d0e2354920d271d4afae4d29a2", "url": "https://github.com/elastic/elasticsearch/commit/5fa1c2bea94bc8d0e2354920d271d4afae4d29a2", "message": "Merge branch 'master' into hidden/fix-cat-requests", "committedDate": "2020-03-11T18:52:05Z", "type": "commit"}, {"oid": "f0dc3623d750d4b814002280f96c47686e44aa68", "url": "https://github.com/elastic/elasticsearch/commit/f0dc3623d750d4b814002280f96c47686e44aa68", "message": "Integration tests with security", "committedDate": "2020-03-11T22:27:10Z", "type": "commit"}, {"oid": "7c305bccf60cbe77d078fec40683510ec264b833", "url": "https://github.com/elastic/elasticsearch/commit/7c305bccf60cbe77d078fec40683510ec264b833", "message": "YAML tests for _cat/indices with hidden indices/aliases", "committedDate": "2020-03-11T23:35:07Z", "type": "commit"}, {"oid": "1a3736b6e65854ba86468a25576445341919a43a", "url": "https://github.com/elastic/elasticsearch/commit/1a3736b6e65854ba86468a25576445341919a43a", "message": "YAML tests for _cat/aliases with hidden indices/aliases", "committedDate": "2020-03-11T23:35:35Z", "type": "commit"}, {"oid": "b5ae669fcf3857a02f804d6d9606651d944e5ec7", "url": "https://github.com/elastic/elasticsearch/commit/b5ae669fcf3857a02f804d6d9606651d944e5ec7", "message": "Merge branch 'master' into hidden/fix-cat-requests", "committedDate": "2020-03-11T23:35:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTMzMjI1NQ==", "url": "https://github.com/elastic/elasticsearch/pull/53248#discussion_r391332255", "bodyText": "I'm not sure if this is the right place in the filesystem to put this, but it should be easy enough to move.", "author": "gwbrown", "createdAt": "2020-03-11T23:47:30Z", "path": "x-pack/plugin/security/qa/security-basic/src/test/java/org/elasticsearch/xpack/security/CatIndicesWithSecurityIT.java", "diffHunk": "@@ -0,0 +1,126 @@\n+/*\n+ *\n+ *  * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n+ *  * or more contributor license agreements. Licensed under the Elastic License;\n+ *  * you may not use this file except in compliance with the Elastic License.\n+ *\n+ */\n+\n+package org.elasticsearch.xpack.security;", "originalCommit": "b5ae669fcf3857a02f804d6d9606651d944e5ec7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTgzMzMxNg==", "url": "https://github.com/elastic/elasticsearch/pull/53248#discussion_r391833316", "bodyText": "Hmm. I think it might be better placed under x-pack/plugin/src/test since it doesn't relate specifically to security with a basic license.", "author": "jaymode", "createdAt": "2020-03-12T19:07:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTMzMjI1NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTgyMzk3Nw==", "url": "https://github.com/elastic/elasticsearch/pull/53248#discussion_r391823977", "bodyText": "Just all?", "author": "jaymode", "createdAt": "2020-03-12T18:48:54Z", "path": "rest-api-spec/src/main/resources/rest-api-spec/api/cat.aliases.json", "diffHunk": "@@ -53,6 +53,18 @@\n         \"type\":\"boolean\",\n         \"description\":\"Verbose mode. Display column headers\",\n         \"default\":false\n+      },\n+      \"expand_wildcards\":{\n+        \"type\":\"enum\",\n+        \"options\":[\n+          \"open\",\n+          \"closed\",\n+          \"hidden\",\n+          \"none\",\n+          \"all\"\n+        ],\n+        \"default\": [\"all\", \"hidden\"],", "originalCommit": "b5ae669fcf3857a02f804d6d9606651d944e5ec7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTgzODQ5Mg==", "url": "https://github.com/elastic/elasticsearch/pull/53248#discussion_r391838492", "bodyText": "Thanks, for some reason I thought all just meant open,closed. Not sure where that came from, I'll fix.", "author": "gwbrown", "createdAt": "2020-03-12T19:17:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTgyMzk3Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTgyNTM4Nw==", "url": "https://github.com/elastic/elasticsearch/pull/53248#discussion_r391825387", "bodyText": "Just all?", "author": "jaymode", "createdAt": "2020-03-12T18:51:37Z", "path": "rest-api-spec/src/main/resources/rest-api-spec/api/indices.get_alias.json", "diffHunk": "@@ -69,10 +69,11 @@\n         \"options\":[\n           \"open\",\n           \"closed\",\n+          \"hidden\",\n           \"none\",\n           \"all\"\n         ],\n-        \"default\":\"all\",\n+        \"default\": [\"all\", \"hidden\"],", "originalCommit": "b5ae669fcf3857a02f804d6d9606651d944e5ec7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTgyODg3NA==", "url": "https://github.com/elastic/elasticsearch/pull/53248#discussion_r391828874", "bodyText": "the index is hidden but the test name indicates it should not be", "author": "jaymode", "createdAt": "2020-03-12T18:58:11Z", "path": "rest-api-spec/src/main/resources/rest-api-spec/test/cat.aliases/40_hidden.yml", "diffHunk": "@@ -0,0 +1,166 @@\n+---\n+\"Test cat aliases output with a hidden index with a hidden alias\":\n+  - skip:\n+      version: \"- 7.6.99\"\n+      reason: \"hidden indices and aliases were added in 7.7.0\"\n+\n+  - do:\n+      indices.create:\n+        index: test\n+        body:\n+          settings:\n+            number_of_shards: \"1\"\n+            number_of_replicas: \"0\"\n+            index:\n+              hidden: true\n+          aliases:\n+            test_alias:\n+              is_hidden: true\n+\n+  - do:\n+      cat.aliases: {}\n+\n+  - match:\n+      $body: |\n+        /^\n+            test_alias          \\s+\n+            test                \\s+\n+            -                   \\s+\n+            -                   \\s+\n+            -                   \\s+\n+            -                   \\s+\n+        $/\n+\n+  - do:\n+      cat.aliases:\n+        name: test_alias\n+\n+  - match:\n+      $body: |\n+        /^\n+            test_alias          \\s+\n+            test                \\s+\n+            -                   \\s+\n+            -                   \\s+\n+            -                   \\s+\n+            -                   \\s+\n+        $/\n+\n+\n+  - do:\n+      cat.aliases:\n+        expand_wildcards: [\"open\",\"closed\"]\n+\n+  - match:\n+      $body: |\n+        /^\n+        $/\n+---\n+\"Test cat aliases output with a hidden index with a visible alias\":\n+  - skip:\n+      version: \"- 7.6.99\"\n+      reason: \"hidden indices and aliases were added in 7.7.0\"\n+\n+  - do:\n+      indices.create:\n+        index: test\n+        body:\n+          settings:\n+            number_of_shards: \"1\"\n+            number_of_replicas: \"0\"\n+            index:\n+              hidden: true\n+          aliases:\n+            test_alias: {}\n+  - do:\n+      cat.aliases: {}\n+\n+  - match:\n+      $body: |\n+        /^\n+            test_alias          \\s+\n+            test                \\s+\n+            -                   \\s+\n+            -                   \\s+\n+            -                   \\s+\n+            -                   \\s+\n+        $/\n+\n+  - do:\n+      cat.aliases:\n+        name: test_alias\n+\n+  - match:\n+      $body: |\n+        /^\n+            test_alias          \\s+\n+            test                \\s+\n+            -                   \\s+\n+            -                   \\s+\n+            -                   \\s+\n+            -                   \\s+\n+        $/\n+\n+  - do:\n+      cat.aliases:\n+        expand_wildcards: [\"open\",\"closed\"]\n+\n+  - match:\n+      $body: |\n+        /^\n+        $/\n+---\n+\"Test cat aliases output with a visible index with a hidden alias\":\n+  - skip:\n+      version: \"- 7.6.99\"\n+      reason: \"hidden indices and aliases were added in 7.7.0\"\n+\n+  - do:\n+      indices.create:\n+        index: test\n+        body:\n+          settings:\n+            number_of_shards: \"1\"\n+            number_of_replicas: \"0\"\n+            index:\n+              hidden: true", "originalCommit": "b5ae669fcf3857a02f804d6d9606651d944e5ec7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTgyOTI2MQ==", "url": "https://github.com/elastic/elasticsearch/pull/53248#discussion_r391829261", "bodyText": "we shouldn't need both all and hidden", "author": "jaymode", "createdAt": "2020-03-12T18:58:56Z", "path": "rest-api-spec/src/main/resources/rest-api-spec/test/cat.indices/20_hidden.yml", "diffHunk": "@@ -0,0 +1,233 @@\n+---\n+\"Test cat indices output for hidden index\":\n+  - skip:\n+      version: \"- 7.6.99\"\n+      reason: \"hidden indices were added in 7.7.0\"\n+  - do:\n+      indices.create:\n+        index: index1\n+        body:\n+          settings:\n+            number_of_shards: \"1\"\n+            number_of_replicas: \"0\"\n+            index:\n+              hidden: true\n+  - do:\n+      cat.indices: {}\n+  - match:\n+      $body: |\n+        /^$/\n+\n+  - do:\n+      cat.indices:\n+        expand_wildcards: [\"all\", \"hidden\"]", "originalCommit": "b5ae669fcf3857a02f804d6d9606651d944e5ec7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTgyOTQ2OA==", "url": "https://github.com/elastic/elasticsearch/pull/53248#discussion_r391829468", "bodyText": "same comment about not needing hidden with all", "author": "jaymode", "createdAt": "2020-03-12T18:59:20Z", "path": "rest-api-spec/src/main/resources/rest-api-spec/test/cat.indices/20_hidden.yml", "diffHunk": "@@ -0,0 +1,233 @@\n+---\n+\"Test cat indices output for hidden index\":\n+  - skip:\n+      version: \"- 7.6.99\"\n+      reason: \"hidden indices were added in 7.7.0\"\n+  - do:\n+      indices.create:\n+        index: index1\n+        body:\n+          settings:\n+            number_of_shards: \"1\"\n+            number_of_replicas: \"0\"\n+            index:\n+              hidden: true\n+  - do:\n+      cat.indices: {}\n+  - match:\n+      $body: |\n+        /^$/\n+\n+  - do:\n+      cat.indices:\n+        expand_wildcards: [\"all\", \"hidden\"]\n+  - match:\n+      $body: |\n+        /^(green  \\s+\n+           open   \\s+\n+           index1 \\s+\n+           ([a-zA-Z0-9=/_+]|[\\\\\\-]){22} \\s+\n+           1      \\s+\n+           0      \\s+\n+           0      \\s+\n+           0      \\s+\n+           (\\d+|\\d+[.]\\d+)(kb|b) \\s+\n+           (\\d+|\\d+[.]\\d+)(kb|b) \\s*\n+         )\n+         $/\n+\n+---\n+\"Test cat indices output for dot-hidden index and dot-prefixed pattern\":\n+  - skip:\n+      version: \"- 7.6.99\"\n+      reason: \"hidden indices were added in 7.7.0\"\n+  - do:\n+      indices.create:\n+        index: .index1\n+        body:\n+          settings:\n+            number_of_shards: \"1\"\n+            number_of_replicas: \"0\"\n+            index:\n+              hidden: true\n+  - do:\n+      cat.indices: {}\n+  - match:\n+      $body: |\n+        /^$/\n+\n+  - do:\n+      cat.indices:\n+        index: \".*\"\n+  - match:\n+      $body: |\n+        /^(green  \\s+\n+           open   \\s+\n+           \\.index1 \\s+\n+           ([a-zA-Z0-9=/_+]|[\\\\\\-]){22} \\s+\n+           1      \\s+\n+           0      \\s+\n+           0      \\s+\n+           0      \\s+\n+           (\\d+|\\d+[.]\\d+)(kb|b) \\s+\n+           (\\d+|\\d+[.]\\d+)(kb|b) \\s*\n+         )\n+         $/\n+\n+---\n+\"Test cat indices output with a hidden index with a visible alias\":\n+  - skip:\n+      version: \"- 7.6.99\"\n+      reason: \"hidden indices were added in 7.7.0\"\n+\n+  - do:\n+      indices.create:\n+        index: index1\n+        body:\n+          settings:\n+            number_of_shards: \"1\"\n+            number_of_replicas: \"0\"\n+            index:\n+              hidden: true\n+          aliases:\n+            alias1: {}\n+  - do:\n+      cat.indices: {}\n+  - match:\n+      $body: |\n+        /^$/\n+\n+  - do:\n+      cat.indices:\n+        expand_wildcards: [\"all\", \"hidden\"]", "originalCommit": "b5ae669fcf3857a02f804d6d9606651d944e5ec7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTgzMDMyMg==", "url": "https://github.com/elastic/elasticsearch/pull/53248#discussion_r391830322", "bodyText": "same comment about not needing hidden with all", "author": "jaymode", "createdAt": "2020-03-12T19:01:02Z", "path": "rest-api-spec/src/main/resources/rest-api-spec/test/cat.indices/20_hidden.yml", "diffHunk": "@@ -0,0 +1,233 @@\n+---\n+\"Test cat indices output for hidden index\":\n+  - skip:\n+      version: \"- 7.6.99\"\n+      reason: \"hidden indices were added in 7.7.0\"\n+  - do:\n+      indices.create:\n+        index: index1\n+        body:\n+          settings:\n+            number_of_shards: \"1\"\n+            number_of_replicas: \"0\"\n+            index:\n+              hidden: true\n+  - do:\n+      cat.indices: {}\n+  - match:\n+      $body: |\n+        /^$/\n+\n+  - do:\n+      cat.indices:\n+        expand_wildcards: [\"all\", \"hidden\"]\n+  - match:\n+      $body: |\n+        /^(green  \\s+\n+           open   \\s+\n+           index1 \\s+\n+           ([a-zA-Z0-9=/_+]|[\\\\\\-]){22} \\s+\n+           1      \\s+\n+           0      \\s+\n+           0      \\s+\n+           0      \\s+\n+           (\\d+|\\d+[.]\\d+)(kb|b) \\s+\n+           (\\d+|\\d+[.]\\d+)(kb|b) \\s*\n+         )\n+         $/\n+\n+---\n+\"Test cat indices output for dot-hidden index and dot-prefixed pattern\":\n+  - skip:\n+      version: \"- 7.6.99\"\n+      reason: \"hidden indices were added in 7.7.0\"\n+  - do:\n+      indices.create:\n+        index: .index1\n+        body:\n+          settings:\n+            number_of_shards: \"1\"\n+            number_of_replicas: \"0\"\n+            index:\n+              hidden: true\n+  - do:\n+      cat.indices: {}\n+  - match:\n+      $body: |\n+        /^$/\n+\n+  - do:\n+      cat.indices:\n+        index: \".*\"\n+  - match:\n+      $body: |\n+        /^(green  \\s+\n+           open   \\s+\n+           \\.index1 \\s+\n+           ([a-zA-Z0-9=/_+]|[\\\\\\-]){22} \\s+\n+           1      \\s+\n+           0      \\s+\n+           0      \\s+\n+           0      \\s+\n+           (\\d+|\\d+[.]\\d+)(kb|b) \\s+\n+           (\\d+|\\d+[.]\\d+)(kb|b) \\s*\n+         )\n+         $/\n+\n+---\n+\"Test cat indices output with a hidden index with a visible alias\":\n+  - skip:\n+      version: \"- 7.6.99\"\n+      reason: \"hidden indices were added in 7.7.0\"\n+\n+  - do:\n+      indices.create:\n+        index: index1\n+        body:\n+          settings:\n+            number_of_shards: \"1\"\n+            number_of_replicas: \"0\"\n+            index:\n+              hidden: true\n+          aliases:\n+            alias1: {}\n+  - do:\n+      cat.indices: {}\n+  - match:\n+      $body: |\n+        /^$/\n+\n+  - do:\n+      cat.indices:\n+        expand_wildcards: [\"all\", \"hidden\"]\n+  - match:\n+      $body: |\n+        /^(green  \\s+\n+           open   \\s+\n+           index1 \\s+\n+           ([a-zA-Z0-9=/_+]|[\\\\\\-]){22} \\s+\n+           1      \\s+\n+           0      \\s+\n+           0      \\s+\n+           0      \\s+\n+           (\\d+|\\d+[.]\\d+)(kb|b) \\s+\n+           (\\d+|\\d+[.]\\d+)(kb|b) \\s*\n+         )\n+         $/\n+\n+  - do:\n+      cat.indices:\n+        index: alias1\n+  - match:\n+      $body: |\n+        /^(green  \\s+\n+           open   \\s+\n+           index1 \\s+\n+           ([a-zA-Z0-9=/_+]|[\\\\\\-]){22} \\s+\n+           1      \\s+\n+           0      \\s+\n+           0      \\s+\n+           0      \\s+\n+           (\\d+|\\d+[.]\\d+)(kb|b) \\s+\n+           (\\d+|\\d+[.]\\d+)(kb|b) \\s*\n+         )\n+         $/\n+---\n+\"Test cat indices output with a hidden index with a hidden alias\":\n+  - skip:\n+      version: \"- 7.6.99\"\n+      reason: \"hidden indices and aliases were added in 7.7.0\"\n+\n+  - do:\n+      indices.create:\n+        index: index1\n+        body:\n+          settings:\n+            number_of_shards: \"1\"\n+            number_of_replicas: \"0\"\n+            index:\n+              hidden: true\n+          aliases:\n+            alias1:\n+              is_hidden: true\n+  - do:\n+      cat.indices: {}\n+  - match:\n+      $body: |\n+        /^$/\n+\n+  - do:\n+      cat.indices:\n+        expand_wildcards: [\"all\", \"hidden\"]", "originalCommit": "b5ae669fcf3857a02f804d6d9606651d944e5ec7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "d1af58671c3953b1871a00a3c9022bcd66177f2f", "url": "https://github.com/elastic/elasticsearch/commit/d1af58671c3953b1871a00a3c9022bcd66177f2f", "message": "Remove a couple checks that don't work with security enabled", "committedDate": "2020-03-12T19:11:54Z", "type": "commit"}, {"oid": "748cb8bc56a4072d7f264dc9bd71b93f7aba9288", "url": "https://github.com/elastic/elasticsearch/commit/748cb8bc56a4072d7f264dc9bd71b93f7aba9288", "message": "Merge branch 'master' into hidden/fix-cat-requests", "committedDate": "2020-03-12T19:12:24Z", "type": "commit"}, {"oid": "641f4e33a40002fd3f2751c4d847b75c1e2df153", "url": "https://github.com/elastic/elasticsearch/commit/641f4e33a40002fd3f2751c4d847b75c1e2df153", "message": "Doh - this won't work on 7.7 until this PR is backported", "committedDate": "2020-03-12T20:18:31Z", "type": "commit"}, {"oid": "c50bd38f46f7d17edd1f1472331ac8ef38605ea2", "url": "https://github.com/elastic/elasticsearch/commit/c50bd38f46f7d17edd1f1472331ac8ef38605ea2", "message": "Fix redundant \"all,hidden\" to either \"all\" or \"open,hidden\"", "committedDate": "2020-03-12T20:21:04Z", "type": "commit"}, {"oid": "fa8c95b199688aa7b630e6444d41765985a4d82b", "url": "https://github.com/elastic/elasticsearch/commit/fa8c95b199688aa7b630e6444d41765985a4d82b", "message": "Remove accidental hidden setting", "committedDate": "2020-03-12T20:27:16Z", "type": "commit"}, {"oid": "7baa865c27169e5d251383114c956da1dfcdffad", "url": "https://github.com/elastic/elasticsearch/commit/7baa865c27169e5d251383114c956da1dfcdffad", "message": "Fix issue with test when security is enabled", "committedDate": "2020-03-12T22:29:11Z", "type": "commit"}, {"oid": "ddd8a5bf6416a9242f21db25547088779431f3b5", "url": "https://github.com/elastic/elasticsearch/commit/ddd8a5bf6416a9242f21db25547088779431f3b5", "message": "Merge branch 'master' into hidden/fix-cat-requests", "committedDate": "2020-03-12T22:29:34Z", "type": "commit"}, {"oid": "37ef19a3878210a4bc57babd43229520b850a14b", "url": "https://github.com/elastic/elasticsearch/commit/37ef19a3878210a4bc57babd43229520b850a14b", "message": "Relocate CatIndicesWithSecurityIT", "committedDate": "2020-03-12T23:57:46Z", "type": "commit"}, {"oid": "52bf3b6c294016baebd7885520365b3a924531f8", "url": "https://github.com/elastic/elasticsearch/commit/52bf3b6c294016baebd7885520365b3a924531f8", "message": "Merge branch 'master' into hidden/fix-cat-requests", "committedDate": "2020-03-13T16:58:36Z", "type": "commit"}]}