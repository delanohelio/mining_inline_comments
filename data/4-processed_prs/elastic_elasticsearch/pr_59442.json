{"pr_number": 59442, "pr_title": "[ML] data frame analytics inference improvements", "pr_createdAt": "2020-07-13T16:52:41Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/59442", "timeline": [{"oid": "8c7a2adc86beab30a49e01b1c2dc826d1da32f7b", "url": "https://github.com/elastic/elasticsearch/commit/8c7a2adc86beab30a49e01b1c2dc826d1da32f7b", "message": "[ML] data frame analytics inference improvements\nthis commit prevents the model from being cached unnecessarily.\nit also keeps the model bytes from being removed from the circuit breaker\nuntil inference is complete.", "committedDate": "2020-07-13T16:51:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDE1NzE2Mw==", "url": "https://github.com/elastic/elasticsearch/pull/59442#discussion_r454157163", "bodyText": "Would it make sense to change this line to:\ntry (LocalModel localModel = modelLoadingService.getModelForPipeline(modelId, localModelPlainActionFuture).actionGet()) {\n\n?", "author": "przemekwitek", "createdAt": "2020-07-14T07:26:04Z", "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/dataframe/inference/InferenceRunner.java", "diffHunk": "@@ -73,10 +73,12 @@ public void run(String modelId) {\n         LOGGER.info(\"[{}] Started inference on test data against model [{}]\", config.getId(), modelId);\n         try {\n             PlainActionFuture<LocalModel> localModelPlainActionFuture = new PlainActionFuture<>();\n-            modelLoadingService.getModelForSearch(modelId, localModelPlainActionFuture);\n+            modelLoadingService.getModelForPipeline(modelId, localModelPlainActionFuture);\n             LocalModel localModel = localModelPlainActionFuture.actionGet();\n             TestDocsIterator testDocsIterator = new TestDocsIterator(new OriginSettingClient(client, ClientHelper.ML_ORIGIN), config);\n-            inferTestDocs(localModel, testDocsIterator);\n+            try (localModel) {", "originalCommit": "8c7a2adc86beab30a49e01b1c2dc826d1da32f7b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDI4NjY5Mg==", "url": "https://github.com/elastic/elasticsearch/pull/59442#discussion_r454286692", "bodyText": "I did a slight refactor to take this comment into account.\nUltimately, it does not really matter.", "author": "benwtrent", "createdAt": "2020-07-14T11:24:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDE1NzE2Mw=="}], "type": "inlineReview"}, {"oid": "def698c8184763cd8598324ea73cdb2ca3fd862c", "url": "https://github.com/elastic/elasticsearch/commit/def698c8184763cd8598324ea73cdb2ca3fd862c", "message": "slight refactor", "committedDate": "2020-07-14T11:23:39Z", "type": "commit"}, {"oid": "e8f3ef489cccf95892b30c34238d6fb2f117b7c2", "url": "https://github.com/elastic/elasticsearch/commit/e8f3ef489cccf95892b30c34238d6fb2f117b7c2", "message": "Merge branch 'master' into feature/ml-fixing-dataframe-inference-model-reference", "committedDate": "2020-07-14T11:44:54Z", "type": "commit"}]}