{"pr_number": 53353, "pr_title": "Make lucene snapshot repository exclusive to lucene packages", "pr_createdAt": "2020-03-10T17:59:00Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/53353", "timeline": [{"oid": "0762fad8cdaef84af455db798b9d97805a2999a7", "url": "https://github.com/elastic/elasticsearch/commit/0762fad8cdaef84af455db798b9d97805a2999a7", "message": "Make lucene snapshot repository exclusive to lucene packages\n\nWhen depending on lucene snapshots we point maven at our own s3 backed\nrepository. However, in this case lucene packages should only be\nretrieved from this location, and no other packages should ever be found\nin that repo. This commit makes the maven repository exclusive to lucene\npackages.", "committedDate": "2020-03-10T17:56:10Z", "type": "commit"}, {"oid": "68ebb526c0ade035493dce16ba3d88a8cb37555e", "url": "https://github.com/elastic/elasticsearch/commit/68ebb526c0ade035493dce16ba3d88a8cb37555e", "message": "Merge branch 'master' into lucene_snapshot_filter", "committedDate": "2020-03-10T18:00:33Z", "type": "commit"}, {"oid": "c77429c0bf28d0daa0fb88cc51fcdedfde6d528e", "url": "https://github.com/elastic/elasticsearch/commit/c77429c0bf28d0daa0fb88cc51fcdedfde6d528e", "message": "sync with master", "committedDate": "2020-03-10T18:04:35Z", "type": "commit"}, {"oid": "bcbcd72939b722f978acbeae1107d3e447279b94", "url": "https://github.com/elastic/elasticsearch/commit/bcbcd72939b722f978acbeae1107d3e447279b94", "message": "add type", "committedDate": "2020-03-10T18:23:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDYwMzcyMw==", "url": "https://github.com/elastic/elasticsearch/pull/53353#discussion_r394603723", "bodyText": "Is this also specific only to snapshots? Do we ever use GA releases? And in that case, I assume we'd get those just from jcenter or maven central. If so, should we use a version regex filter here as well?", "author": "mark-vieira", "createdAt": "2020-03-18T19:56:55Z", "path": "buildSrc/src/main/groovy/org/elasticsearch/gradle/BuildPlugin.groovy", "diffHunk": "@@ -327,10 +328,14 @@ class BuildPlugin implements Plugin<Project> {\n             // extract the revision number from the version with a regex matcher\n             List<String> matches = (luceneVersion =~ /\\w+-snapshot-([a-z0-9]+)/).getAt(0) as List<String>\n             String revision = matches.get(1)\n-            repos.maven { MavenArtifactRepository repo ->\n+            MavenArtifactRepository luceneRepo = repos.maven { MavenArtifactRepository repo ->\n                 repo.name = 'lucene-snapshots'\n                 repo.url = \"https://s3.amazonaws.com/download.elasticsearch.org/lucenesnapshots/${revision}\"\n             }\n+            repos.exclusiveContent { ExclusiveContentRepository exclusiveRepo ->\n+                exclusiveRepo.filter { it.includeGroup('org.apache.lucene') }", "originalCommit": "bcbcd72939b722f978acbeae1107d3e447279b94", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "4a09aa84928bb82b56d52b4fc8e1a524b8956810", "url": "https://github.com/elastic/elasticsearch/commit/4a09aa84928bb82b56d52b4fc8e1a524b8956810", "message": "Merge branch 'master' into lucene_snapshot_filter", "committedDate": "2020-03-18T20:19:52Z", "type": "commit"}, {"oid": "4b7cbe5c1d4cdf9d0e25fc3c4bb0eb6abdcb34d8", "url": "https://github.com/elastic/elasticsearch/commit/4b7cbe5c1d4cdf9d0e25fc3c4bb0eb6abdcb34d8", "message": "use version filter too", "committedDate": "2020-03-18T20:31:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDYyNzg1Mw==", "url": "https://github.com/elastic/elasticsearch/pull/53353#discussion_r394627853", "bodyText": "FYI, since this is Groovy we can use regex literal notation to avoid all the nasty string escaping so this could be /org\\.apache\\.lucene/ instead avoiding the redundant escape character.", "author": "mark-vieira", "createdAt": "2020-03-18T20:43:32Z", "path": "buildSrc/src/main/groovy/org/elasticsearch/gradle/BuildPlugin.groovy", "diffHunk": "@@ -327,10 +328,16 @@ class BuildPlugin implements Plugin<Project> {\n             // extract the revision number from the version with a regex matcher\n             List<String> matches = (luceneVersion =~ /\\w+-snapshot-([a-z0-9]+)/).getAt(0) as List<String>\n             String revision = matches.get(1)\n-            repos.maven { MavenArtifactRepository repo ->\n+            MavenArtifactRepository luceneRepo = repos.maven { MavenArtifactRepository repo ->\n                 repo.name = 'lucene-snapshots'\n                 repo.url = \"https://s3.amazonaws.com/download.elasticsearch.org/lucenesnapshots/${revision}\"\n             }\n+            repos.exclusiveContent { ExclusiveContentRepository exclusiveRepo ->\n+                exclusiveRepo.filter {\n+                    it.includeVersionByRegex('org\\\\.apache\\\\.lucene', '.*', \".*-snapshot-${revision}\")", "originalCommit": "4b7cbe5c1d4cdf9d0e25fc3c4bb0eb6abdcb34d8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "14e8d5f03164ac69a9ef861011f4fc88ba291a99", "url": "https://github.com/elastic/elasticsearch/commit/14e8d5f03164ac69a9ef861011f4fc88ba291a99", "message": "use groovy regex string", "committedDate": "2020-03-18T22:47:45Z", "type": "commit"}]}