{"pr_number": 51192, "pr_title": "Account soft-deletes in FrozenEngine", "pr_createdAt": "2020-01-19T00:05:59Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/51192", "timeline": [{"oid": "4939693c6e4e3fbc4b4a279cd1f55335257b9921", "url": "https://github.com/elastic/elasticsearch/commit/4939693c6e4e3fbc4b4a279cd1f55335257b9921", "message": "Add test verify frozen index without soft-deletes", "committedDate": "2020-01-18T23:59:57Z", "type": "commit"}, {"oid": "00eb1c4f45325314c8cf0a4e18f2e7a088089e01", "url": "https://github.com/elastic/elasticsearch/commit/00eb1c4f45325314c8cf0a4e18f2e7a088089e01", "message": "fix indexing body", "committedDate": "2020-01-19T01:08:53Z", "type": "commit"}, {"oid": "1045b6b49679c2cb4f7567a188c573bd09960d4d", "url": "https://github.com/elastic/elasticsearch/commit/1045b6b49679c2cb4f7567a188c573bd09960d4d", "message": "assert response", "committedDate": "2020-01-19T02:46:10Z", "type": "commit"}, {"oid": "218183f165a872dec258ce7ba846b09be895fb98", "url": "https://github.com/elastic/elasticsearch/commit/218183f165a872dec258ce7ba846b09be895fb98", "message": "Account soft deletes in frozen engine", "committedDate": "2020-01-19T23:02:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODQwMjUwMA==", "url": "https://github.com/elastic/elasticsearch/pull/51192#discussion_r368402500", "bodyText": "In 7.x and below, this will be dependent on the soft-deletes setting, right?", "author": "ywelsch", "createdAt": "2020-01-20T07:40:45Z", "path": "server/src/main/java/org/elasticsearch/index/engine/ReadOnlyEngine.java", "diffHunk": "@@ -528,4 +528,8 @@ public void advanceMaxSeqNoOfUpdatesOrDeletes(long maxSeqNoOfUpdatesOnPrimary) {\n         assert maxSeqNoOfUpdatesOnPrimary <= getMaxSeqNoOfUpdatesOrDeletes() :\n             maxSeqNoOfUpdatesOnPrimary + \">\" + getMaxSeqNoOfUpdatesOrDeletes();\n     }\n+\n+    protected static DirectoryReader openDirectory(Directory dir) throws IOException {\n+        return new SoftDeletesDirectoryReaderWrapper(DirectoryReader.open(dir, OFF_HEAP_READER_ATTRIBUTES), Lucene.SOFT_DELETES_FIELD);", "originalCommit": "218183f165a872dec258ce7ba846b09be895fb98", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODU4NTI0OA==", "url": "https://github.com/elastic/elasticsearch/pull/51192#discussion_r368585248", "bodyText": "Yes", "author": "dnhatn", "createdAt": "2020-01-20T14:47:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODQwMjUwMA=="}], "type": "inlineReview"}, {"oid": "b5c7658fcc38b59054055431a7d59983127efa8c", "url": "https://github.com/elastic/elasticsearch/commit/b5c7658fcc38b59054055431a7d59983127efa8c", "message": "Merge branch 'master' into frozen-indices-restart", "committedDate": "2020-01-20T13:56:32Z", "type": "commit"}]}