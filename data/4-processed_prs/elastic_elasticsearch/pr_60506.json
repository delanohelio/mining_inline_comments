{"pr_number": 60506, "pr_title": "[doc] joda migration guide to v8", "pr_createdAt": "2020-07-31T11:15:41Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/60506", "timeline": [{"oid": "e04c7775e4e02929d7ba7e1d8f62f6c51f8797fd", "url": "https://github.com/elastic/elasticsearch/commit/e04c7775e4e02929d7ba7e1d8f62f6c51f8797fd", "message": "[doc] joda migration guide to v8\n\nindices created in v6 and not migrated earlier to java-time have to be\nupdated before upgrading to v8", "committedDate": "2020-07-31T11:12:02Z", "type": "commit"}, {"oid": "42563b4f6d0b32325e281f50e7d90e833c227102", "url": "https://github.com/elastic/elasticsearch/commit/42563b4f6d0b32325e281f50e7d90e833c227102", "message": "links", "committedDate": "2020-07-31T11:21:21Z", "type": "commit"}, {"oid": "a7217f338c305590cbe7030d14fb87e616b96a9a", "url": "https://github.com/elastic/elasticsearch/commit/a7217f338c305590cbe7030d14fb87e616b96a9a", "message": "wrong link", "committedDate": "2020-07-31T11:37:13Z", "type": "commit"}, {"oid": "183fd21abead4d0787a3befde069c317706aee1f", "url": "https://github.com/elastic/elasticsearch/commit/183fd21abead4d0787a3befde069c317706aee1f", "message": "missing include", "committedDate": "2020-07-31T12:13:14Z", "type": "commit"}, {"oid": "411f3331ce3d86f148692270cbf6b26a5a1860da", "url": "https://github.com/elastic/elasticsearch/commit/411f3331ce3d86f148692270cbf6b26a5a1860da", "message": "unused tag", "committedDate": "2020-07-31T14:05:52Z", "type": "commit"}, {"oid": "4433031f02f4bdcd2f96a65e8f9094df6cff5e71", "url": "https://github.com/elastic/elasticsearch/commit/4433031f02f4bdcd2f96a65e8f9094df6cff5e71", "message": "setup", "committedDate": "2020-08-17T14:36:56Z", "type": "commit"}, {"oid": "1107d2029bbb819f00c0defc3d68db870cac31c2", "url": "https://github.com/elastic/elasticsearch/commit/1107d2029bbb819f00c0defc3d68db870cac31c2", "message": "test continue", "committedDate": "2020-08-17T14:57:40Z", "type": "commit"}, {"oid": "2049ef1de4467b7d66a660435eb55ebc063fd357", "url": "https://github.com/elastic/elasticsearch/commit/2049ef1de4467b7d66a660435eb55ebc063fd357", "message": "fixes", "committedDate": "2020-08-19T08:12:40Z", "type": "commit"}, {"oid": "0611911178ab8c28339eda141e4b875983e3902c", "url": "https://github.com/elastic/elasticsearch/commit/0611911178ab8c28339eda141e4b875983e3902c", "message": "remove discrete", "committedDate": "2020-08-19T09:20:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzAxNTMzOQ==", "url": "https://github.com/elastic/elasticsearch/pull/60506#discussion_r473015339", "bodyText": "If we move this under the mapping changes, we won't need a new heading.\nIf you decide to keep the heading, I'd rename so it follows the pattern used for other breaking changes\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            [discrete]\n          \n          \n            \n            [[breaking_80_java_time_changes]]\n          \n          \n            \n            === Replacing Joda-Time with java time\n          \n          \n            \n            [discrete]\n          \n          \n            \n            [[breaking_80_date_format_changes]]\n          \n          \n            \n            === Date format changes", "author": "jrodewig", "createdAt": "2020-08-19T13:08:41Z", "path": "docs/reference/migration/migrate_8_0/java_time.asciidoc", "diffHunk": "@@ -0,0 +1,20 @@\n+//NOTE: The notable-breaking-changes tagged regions are re-used in the\n+//Installation and Upgrade Guide\n+\n+//tag::notable-breaking-changes[]\n+\n+// end::notable-breaking-changes[]\n+\n+[discrete]\n+[[breaking_80_java_time_changes]]\n+=== Replacing Joda-Time with java time", "originalCommit": "0611911178ab8c28339eda141e4b875983e3902c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mzg5OTA3MQ==", "url": "https://github.com/elastic/elasticsearch/pull/60506#discussion_r473899071", "bodyText": "will move to a mapping changes", "author": "pgomulka", "createdAt": "2020-08-20T11:26:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzAxNTMzOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzAxNTM1Ng==", "url": "https://github.com/elastic/elasticsearch/pull/60506#discussion_r473015356", "bodyText": "We already have a mapping changes section. I wonder if this would be a better fit there than it's own section.", "author": "jrodewig", "createdAt": "2020-08-19T13:08:42Z", "path": "docs/reference/migration/migrate_8_0.asciidoc", "diffHunk": "@@ -34,6 +34,7 @@ coming[8.0.0]\n * <<breaking_80_snapshots_changes>>\n * <<breaking_80_threadpool_changes>>\n * <<breaking_80_transport_changes>>\n+* <<breaking_80_java_time_changes>>", "originalCommit": "0611911178ab8c28339eda141e4b875983e3902c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mzg5OTExOA==", "url": "https://github.com/elastic/elasticsearch/pull/60506#discussion_r473899118", "bodyText": "will move to a mapping changes", "author": "pgomulka", "createdAt": "2020-08-20T11:26:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzAxNTM1Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzAyNTg0MQ==", "url": "https://github.com/elastic/elasticsearch/pull/60506#discussion_r473025841", "bodyText": "If you move the breaking change under mapping changes, I'd still leave this file include here.", "author": "jrodewig", "createdAt": "2020-08-19T13:24:01Z", "path": "docs/reference/migration/migrate_8_0.asciidoc", "diffHunk": "@@ -92,3 +93,4 @@ include::migrate_8_0/settings.asciidoc[]\n include::migrate_8_0/snapshots.asciidoc[]\n include::migrate_8_0/threadpool.asciidoc[]\n include::migrate_8_0/transport.asciidoc[]\n+include::migrate_8_0/java_time.asciidoc[]", "originalCommit": "0611911178ab8c28339eda141e4b875983e3902c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mzg5OTM3MQ==", "url": "https://github.com/elastic/elasticsearch/pull/60506#discussion_r473899371", "bodyText": "why would we need java_time.asciidoc file if I move it to mapping changes file?", "author": "pgomulka", "createdAt": "2020-08-20T11:27:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzAyNTg0MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzAyNjQ4MA==", "url": "https://github.com/elastic/elasticsearch/pull/60506#discussion_r473026480", "bodyText": "I'd add discrete tags. Otherwise, each of these headings creates its own page.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \n          \n          \n            \n            [[java-time-convert-date-formats]]\n          \n          \n            \n            === Convert date formats\n          \n          \n            \n            [discrete]\n          \n          \n            \n            [[java-time-convert-date-formats]]\n          \n          \n            \n            === Convert date formats", "author": "jrodewig", "createdAt": "2020-08-19T13:24:56Z", "path": "docs/reference/migration/migrate_8_0/migrate_to_java_time.asciidoc", "diffHunk": "@@ -0,0 +1,315 @@\n+[[migrate-to-java-time]]\n+=== Java time migration guide\n+\n+With 7.0, {es} switched from joda time to java time for date-related parsing,\n+formatting, and calculations. This guide is designed to help you determine\n+if your cluster is impacted and, if so, prepare for the upgrade.\n+\n+\n+\n+[[java-time-convert-date-formats]]\n+=== Convert date formats", "originalCommit": "0611911178ab8c28339eda141e4b875983e3902c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzAyNjY3Mg==", "url": "https://github.com/elastic/elasticsearch/pull/60506#discussion_r473026672", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            [[java-time-migration-impacted-features]]\n          \n          \n            \n            === Impacted features\n          \n          \n            \n            [discrete]\n          \n          \n            \n            [[java-time-migration-impacted-features]]\n          \n          \n            \n            === Impacted features", "author": "jrodewig", "createdAt": "2020-08-19T13:25:13Z", "path": "docs/reference/migration/migrate_8_0/migrate_to_java_time.asciidoc", "diffHunk": "@@ -0,0 +1,315 @@\n+[[migrate-to-java-time]]\n+=== Java time migration guide\n+\n+With 7.0, {es} switched from joda time to java time for date-related parsing,\n+formatting, and calculations. This guide is designed to help you determine\n+if your cluster is impacted and, if so, prepare for the upgrade.\n+\n+\n+\n+[[java-time-convert-date-formats]]\n+=== Convert date formats\n+\n+To upgrade to {es} 8, you'll need to convert any joda-time date formats\n+to their java-time equivalents.\n+\n+[[java-time-migration-impacted-features]]\n+=== Impacted features", "originalCommit": "0611911178ab8c28339eda141e4b875983e3902c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzAyNzIzNA==", "url": "https://github.com/elastic/elasticsearch/pull/60506#discussion_r473027234", "bodyText": "Rewords the section and updates it to use the standard breaking changes format.\nBecause breaking changes are re-used in our Stack Guides, we need to use\nthe external link syntax instead of internal xrefs.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            All indices created in {es} 7 are already using java-time so nothing needs to be done.\n          \n          \n            \n            However indices created in {es} 6 with joda-time patterns need to be reindexed with\n          \n          \n            \n            an updated mappings\n          \n          \n            \n            \n          \n          \n            \n            [discrete]\n          \n          \n            \n            ==== Migration guide\n          \n          \n            \n            For a detailed migration guide, see <<migrate-to-java-time>>.\n          \n          \n            \n            \n          \n          \n            \n            include::migrate_to_java_time.asciidoc[]\n          \n          \n            \n            //tag::notable-breaking-changes[]\n          \n          \n            \n            .Java-time date formats replace joda-time formats\n          \n          \n            \n            [%collapsible]\n          \n          \n            \n            ====\n          \n          \n            \n            *Details* +\n          \n          \n            \n            In 7.0, {es} switched from joda time to java time for date-related parsing,\n          \n          \n            \n            formatting, and calculations. Indices created in 7.0 and later versions are\n          \n          \n            \n            already required to use mappings with java-time date formats. However, \n          \n          \n            \n            earlier indices using joda-time formats must be reindexed to use\n          \n          \n            \n            mappings with java-time formats.\n          \n          \n            \n            \n          \n          \n            \n            *Impact* +\n          \n          \n            \n            For a detailed migration guide, see {ref}/migrate-to-java-time.html.\n          \n          \n            \n            ====\n          \n          \n            \n            \n          \n          \n            \n            // end::notable-breaking-changes[]", "author": "jrodewig", "createdAt": "2020-08-19T13:26:04Z", "path": "docs/reference/migration/migrate_8_0/java_time.asciidoc", "diffHunk": "@@ -0,0 +1,20 @@\n+//NOTE: The notable-breaking-changes tagged regions are re-used in the\n+//Installation and Upgrade Guide\n+\n+//tag::notable-breaking-changes[]\n+\n+// end::notable-breaking-changes[]\n+\n+[discrete]\n+[[breaking_80_java_time_changes]]\n+=== Replacing Joda-Time with java time\n+\n+All indices created in {es} 7 are already using java-time so nothing needs to be done.\n+However indices created in {es} 6 with joda-time patterns need to be reindexed with\n+an updated mappings\n+\n+[discrete]\n+==== Migration guide\n+For a detailed migration guide, see <<migrate-to-java-time>>.\n+\n+include::migrate_to_java_time.asciidoc[]", "originalCommit": "0611911178ab8c28339eda141e4b875983e3902c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzAyODQzNQ==", "url": "https://github.com/elastic/elasticsearch/pull/60506#discussion_r473028435", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \n          \n          \n            \n            [[java-time-migration-incompatible-date-formats]]\n          \n          \n            \n            === Incompatible date formats\n          \n          \n            \n            \n          \n          \n            \n            [discrete]\n          \n          \n            \n            [[java-time-migration-incompatible-date-formats]]\n          \n          \n            \n            === Incompatible date formats", "author": "jrodewig", "createdAt": "2020-08-19T13:27:48Z", "path": "docs/reference/migration/migrate_8_0/migrate_to_java_time.asciidoc", "diffHunk": "@@ -0,0 +1,315 @@\n+[[migrate-to-java-time]]\n+=== Java time migration guide\n+\n+With 7.0, {es} switched from joda time to java time for date-related parsing,\n+formatting, and calculations. This guide is designed to help you determine\n+if your cluster is impacted and, if so, prepare for the upgrade.\n+\n+\n+\n+[[java-time-convert-date-formats]]\n+=== Convert date formats\n+\n+To upgrade to {es} 8, you'll need to convert any joda-time date formats\n+to their java-time equivalents.\n+\n+[[java-time-migration-impacted-features]]\n+=== Impacted features\n+The switch to java time only impacts custom <<date,`date`>> and\n+<<date_nanos,`date_nanos`>> formats.\n+\n+These formats are commonly used in:\n+\n+* <<mapping,Index mappings>>\n+* <<indices-templates,Index templates>>\n+* <<pipeline,Ingest pipelines>>\n+\n+If you don't use custom date formats, you can skip the rest of this guide.\n+Most custom date formats are compatible. However, several require\n+an update.\n+\n+To see if your date format is impacted, use the <<migration-api-deprecation,deprecation info API>>\n+or the {kibana-ref}/upgrade-assistant.html[Kibana upgrade assistant].\n+\n+[[java-time-migration-incompatible-date-formats]]\n+=== Incompatible date formats", "originalCommit": "0611911178ab8c28339eda141e4b875983e3902c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzAyODk2MA==", "url": "https://github.com/elastic/elasticsearch/pull/60506#discussion_r473028960", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            [[java-time-migration-test]]\n          \n          \n            \n            === Test with your data\n          \n          \n            \n            [discrete]\n          \n          \n            \n            [[java-time-migration-test]]\n          \n          \n            \n            === Test with your data", "author": "jrodewig", "createdAt": "2020-08-19T13:28:32Z", "path": "docs/reference/migration/migrate_8_0/migrate_to_java_time.asciidoc", "diffHunk": "@@ -0,0 +1,315 @@\n+[[migrate-to-java-time]]\n+=== Java time migration guide\n+\n+With 7.0, {es} switched from joda time to java time for date-related parsing,\n+formatting, and calculations. This guide is designed to help you determine\n+if your cluster is impacted and, if so, prepare for the upgrade.\n+\n+\n+\n+[[java-time-convert-date-formats]]\n+=== Convert date formats\n+\n+To upgrade to {es} 8, you'll need to convert any joda-time date formats\n+to their java-time equivalents.\n+\n+[[java-time-migration-impacted-features]]\n+=== Impacted features\n+The switch to java time only impacts custom <<date,`date`>> and\n+<<date_nanos,`date_nanos`>> formats.\n+\n+These formats are commonly used in:\n+\n+* <<mapping,Index mappings>>\n+* <<indices-templates,Index templates>>\n+* <<pipeline,Ingest pipelines>>\n+\n+If you don't use custom date formats, you can skip the rest of this guide.\n+Most custom date formats are compatible. However, several require\n+an update.\n+\n+To see if your date format is impacted, use the <<migration-api-deprecation,deprecation info API>>\n+or the {kibana-ref}/upgrade-assistant.html[Kibana upgrade assistant].\n+\n+[[java-time-migration-incompatible-date-formats]]\n+=== Incompatible date formats\n+Custom date formats containing the following joda-time literals should be\n+migrated.\n+\n+`Y` (Year of era)::\n++\n+--\n+Replace with `y`.\n+\n+*Example:*\n+`YYYY-MM-dd` should become `yyyy-MM-dd`.\n+\n+In java time, `Y` is used for\n+https://docs.oracle.com/javase/8/docs/api/java/time/temporal/WeekFields.html[week-based year].\n+Using `Y` in place of `y` could result in off-by-one errors in year calculation.\n+\n+For pattern `YYYY-ww` and date `2019-01-01T00:00:00.000Z`  will give `2019-01`\n+For pattern `YYYY-ww` and date `2018-12-31T00:00:00.000Z`  will give `2019-01` (counter-intuitive) because there is >4 days of that week in 2019\n+--\n+\n+`y` (Year)::\n++\n+--\n+Replace with `u`.\n+\n+*Example:*\n+`yyyy-MM-dd` should become `uuuu-MM-dd`.\n+\n+In java time, `y` is used for year of era. `u` can contain non-positive\n+values while `y` cannot. `y` can also be associated with an era field.\n+--\n+\n+\n+`C` (Century of era)::\n++\n+--\n+Century of era is not supported in java time.\n+There is no replacement. Instead, we recommend you preprocess your input.\n+--\n+\n+`x` (Week year)::\n++\n+--\n+Replace with `Y`.\n+\n+In java time, `x` means https://docs.oracle.com/javase/8/docs/api/java/time/format/DateTimeFormatter.html[zone-offset].\n+\n+[WARNING]\n+====\n+Failure to properly convert `x` (Week year) to `Y` could result in data loss.\n+====\n+--\n+\n+`Z` (Zone offset/id)::\n++\n+--\n+Replace with multiple `X`'s.\n+\n+`Z` has a similar meaning in java time. However, java time expects different\n+numbers of literals to parse different forms.\n+\n+Consider migrating to `X`, which gives you more control over how time is parsed.\n+For example, the joda-time format `YYYY-MM-dd'T'hh:mm:ssZZ` accepts the following dates:\n+\n+```\n+2010-01-01T01:02:03Z\n+2010-01-01T01:02:03+01\n+2010-01-01T01:02:03+01:02\n+2010-01-01T01:02:03+01:02:03\n+```\n+\n+In java time, you cannot parse all these dates using a single format\n+Instead, you must specify 3 separate formats:\n+\n+```\n+2010-01-01T01:02:03Z\n+2010-01-01T01:02:03+01\n+both parsed with yyyy-MM-dd'T'hh:mm:ssX\n+\n+2010-01-01T01:02:03+01:02\n+yyyy-MM-dd'T'hh:mm:ssXXX\n+\n+2010-01-01T01:02:03+01:02:03\n+yyyy-MM-dd'T'hh:mm:ssXXXXX\n+```\n+\n+\n+The formats must then be delimited using `||`:\n+[source,txt]\n+--------------------------------------------------\n+yyyy-MM-dd'T'hh:mm:ssX||yyyy-MM-dd'T'hh:mm:ssXXX||yyyy-MM-dd'T'hh:mm:ssXXXXX\n+--------------------------------------------------\n+\n+The same applies if you expect your pattern to occur without a colon (`:`):\n+For example, the `YYYY-MM-dd'T'hh:mm:ssZ` format accepts the following date forms:\n+```\n+2010-01-01T01:02:03Z\n+2010-01-01T01:02:03+01\n+2010-01-01T01:02:03+0102\n+2010-01-01T01:02:03+010203\n+```\n+To accept all these forms in java time, you must use the `||` delimiter:\n+[source,txt]\n+--------------------------------------------------\n+yyyy-MM-dd'T'hh:mm:ssX||yyyy-MM-dd'T'hh:mm:ssXX||yyyy-MM-dd'T'hh:mm:ssXXXX\n+--------------------------------------------------\n+--\n+\n+`d` (Day)::\n++\n+--\n+In java time, `d` is still interpreted as \"day\" but is less flexible.\n+\n+For example, the joda-time date format `YYYY-MM-dd` accepts `2010-01-01` or\n+`2010-01-1`.\n+\n+In java time, you must use the `||` delimiter to provide specify each format:\n+\n+[source,txt]\n+--------------------------------------------------\n+yyyy-MM-dd||yyyy-MM-d\n+--------------------------------------------------\n+\n+In java time, `d` also does not accept more than 2 digits. To accept days with more\n+than two digits, you must include a text literal in your java-time date format.\n+For example, to parse `2010-01-00001`, you must use the following java-time date format:\n+\n+[source,txt]\n+--------------------------------------------------\n+yyyy-MM-'000'dd\n+--------------------------------------------------\n+--\n+\n+`e` (Name of day)::\n++\n+--\n+In java time, `e` is still interpreted as \"name of day\" but does not parse\n+short- or full-text forms.\n+\n+For example, the joda-time date format `EEE YYYY-MM` accepts both\n+`Wed 2020-01` and `Wednesday 2020-01`.\n+\n+To accept both of these dates in java time, you must specify each format using\n+the `||` delimiter:\n+\n+[source,txt]\n+--------------------------------------------------\n+cccc yyyy-MM||ccc yyyy-MM\n+--------------------------------------------------\n+\n+The joda-time literal `E` is interpreted as \"day of week.\"\n+The java-time literal `c` is interpreted as \"localized day of week.\"\n+`E` does not accept full-text day formats, such as `Wednesday`.\n+--\n+\n+`EEEE` and similar text forms::\n++\n+--\n+Support for full-text forms depends on the locale data provided with your Java\n+Development Kit (JDK) and other implementation details. We recommend you\n+test formats containing these patterns carefully before upgrading.\n+--\n+\n+`z` (Time zone text)::\n++\n+--\n+In java time, `z` outputs 'Z' for Zulu when given a UTC timezone.\n+--\n+\n+[[java-time-migration-test]]\n+=== Test with your data", "originalCommit": "0611911178ab8c28339eda141e4b875983e3902c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzAyOTE4OA==", "url": "https://github.com/elastic/elasticsearch/pull/60506#discussion_r473029188", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            [[java-time-migrate-update-mappings]]\n          \n          \n            \n            === Update index mappings\n          \n          \n            \n            [discrete]\n          \n          \n            \n            [[java-time-migrate-update-mappings]]\n          \n          \n            \n            === Update index mappings", "author": "jrodewig", "createdAt": "2020-08-19T13:28:49Z", "path": "docs/reference/migration/migrate_8_0/migrate_to_java_time.asciidoc", "diffHunk": "@@ -0,0 +1,315 @@\n+[[migrate-to-java-time]]\n+=== Java time migration guide\n+\n+With 7.0, {es} switched from joda time to java time for date-related parsing,\n+formatting, and calculations. This guide is designed to help you determine\n+if your cluster is impacted and, if so, prepare for the upgrade.\n+\n+\n+\n+[[java-time-convert-date-formats]]\n+=== Convert date formats\n+\n+To upgrade to {es} 8, you'll need to convert any joda-time date formats\n+to their java-time equivalents.\n+\n+[[java-time-migration-impacted-features]]\n+=== Impacted features\n+The switch to java time only impacts custom <<date,`date`>> and\n+<<date_nanos,`date_nanos`>> formats.\n+\n+These formats are commonly used in:\n+\n+* <<mapping,Index mappings>>\n+* <<indices-templates,Index templates>>\n+* <<pipeline,Ingest pipelines>>\n+\n+If you don't use custom date formats, you can skip the rest of this guide.\n+Most custom date formats are compatible. However, several require\n+an update.\n+\n+To see if your date format is impacted, use the <<migration-api-deprecation,deprecation info API>>\n+or the {kibana-ref}/upgrade-assistant.html[Kibana upgrade assistant].\n+\n+[[java-time-migration-incompatible-date-formats]]\n+=== Incompatible date formats\n+Custom date formats containing the following joda-time literals should be\n+migrated.\n+\n+`Y` (Year of era)::\n++\n+--\n+Replace with `y`.\n+\n+*Example:*\n+`YYYY-MM-dd` should become `yyyy-MM-dd`.\n+\n+In java time, `Y` is used for\n+https://docs.oracle.com/javase/8/docs/api/java/time/temporal/WeekFields.html[week-based year].\n+Using `Y` in place of `y` could result in off-by-one errors in year calculation.\n+\n+For pattern `YYYY-ww` and date `2019-01-01T00:00:00.000Z`  will give `2019-01`\n+For pattern `YYYY-ww` and date `2018-12-31T00:00:00.000Z`  will give `2019-01` (counter-intuitive) because there is >4 days of that week in 2019\n+--\n+\n+`y` (Year)::\n++\n+--\n+Replace with `u`.\n+\n+*Example:*\n+`yyyy-MM-dd` should become `uuuu-MM-dd`.\n+\n+In java time, `y` is used for year of era. `u` can contain non-positive\n+values while `y` cannot. `y` can also be associated with an era field.\n+--\n+\n+\n+`C` (Century of era)::\n++\n+--\n+Century of era is not supported in java time.\n+There is no replacement. Instead, we recommend you preprocess your input.\n+--\n+\n+`x` (Week year)::\n++\n+--\n+Replace with `Y`.\n+\n+In java time, `x` means https://docs.oracle.com/javase/8/docs/api/java/time/format/DateTimeFormatter.html[zone-offset].\n+\n+[WARNING]\n+====\n+Failure to properly convert `x` (Week year) to `Y` could result in data loss.\n+====\n+--\n+\n+`Z` (Zone offset/id)::\n++\n+--\n+Replace with multiple `X`'s.\n+\n+`Z` has a similar meaning in java time. However, java time expects different\n+numbers of literals to parse different forms.\n+\n+Consider migrating to `X`, which gives you more control over how time is parsed.\n+For example, the joda-time format `YYYY-MM-dd'T'hh:mm:ssZZ` accepts the following dates:\n+\n+```\n+2010-01-01T01:02:03Z\n+2010-01-01T01:02:03+01\n+2010-01-01T01:02:03+01:02\n+2010-01-01T01:02:03+01:02:03\n+```\n+\n+In java time, you cannot parse all these dates using a single format\n+Instead, you must specify 3 separate formats:\n+\n+```\n+2010-01-01T01:02:03Z\n+2010-01-01T01:02:03+01\n+both parsed with yyyy-MM-dd'T'hh:mm:ssX\n+\n+2010-01-01T01:02:03+01:02\n+yyyy-MM-dd'T'hh:mm:ssXXX\n+\n+2010-01-01T01:02:03+01:02:03\n+yyyy-MM-dd'T'hh:mm:ssXXXXX\n+```\n+\n+\n+The formats must then be delimited using `||`:\n+[source,txt]\n+--------------------------------------------------\n+yyyy-MM-dd'T'hh:mm:ssX||yyyy-MM-dd'T'hh:mm:ssXXX||yyyy-MM-dd'T'hh:mm:ssXXXXX\n+--------------------------------------------------\n+\n+The same applies if you expect your pattern to occur without a colon (`:`):\n+For example, the `YYYY-MM-dd'T'hh:mm:ssZ` format accepts the following date forms:\n+```\n+2010-01-01T01:02:03Z\n+2010-01-01T01:02:03+01\n+2010-01-01T01:02:03+0102\n+2010-01-01T01:02:03+010203\n+```\n+To accept all these forms in java time, you must use the `||` delimiter:\n+[source,txt]\n+--------------------------------------------------\n+yyyy-MM-dd'T'hh:mm:ssX||yyyy-MM-dd'T'hh:mm:ssXX||yyyy-MM-dd'T'hh:mm:ssXXXX\n+--------------------------------------------------\n+--\n+\n+`d` (Day)::\n++\n+--\n+In java time, `d` is still interpreted as \"day\" but is less flexible.\n+\n+For example, the joda-time date format `YYYY-MM-dd` accepts `2010-01-01` or\n+`2010-01-1`.\n+\n+In java time, you must use the `||` delimiter to provide specify each format:\n+\n+[source,txt]\n+--------------------------------------------------\n+yyyy-MM-dd||yyyy-MM-d\n+--------------------------------------------------\n+\n+In java time, `d` also does not accept more than 2 digits. To accept days with more\n+than two digits, you must include a text literal in your java-time date format.\n+For example, to parse `2010-01-00001`, you must use the following java-time date format:\n+\n+[source,txt]\n+--------------------------------------------------\n+yyyy-MM-'000'dd\n+--------------------------------------------------\n+--\n+\n+`e` (Name of day)::\n++\n+--\n+In java time, `e` is still interpreted as \"name of day\" but does not parse\n+short- or full-text forms.\n+\n+For example, the joda-time date format `EEE YYYY-MM` accepts both\n+`Wed 2020-01` and `Wednesday 2020-01`.\n+\n+To accept both of these dates in java time, you must specify each format using\n+the `||` delimiter:\n+\n+[source,txt]\n+--------------------------------------------------\n+cccc yyyy-MM||ccc yyyy-MM\n+--------------------------------------------------\n+\n+The joda-time literal `E` is interpreted as \"day of week.\"\n+The java-time literal `c` is interpreted as \"localized day of week.\"\n+`E` does not accept full-text day formats, such as `Wednesday`.\n+--\n+\n+`EEEE` and similar text forms::\n++\n+--\n+Support for full-text forms depends on the locale data provided with your Java\n+Development Kit (JDK) and other implementation details. We recommend you\n+test formats containing these patterns carefully before upgrading.\n+--\n+\n+`z` (Time zone text)::\n++\n+--\n+In java time, `z` outputs 'Z' for Zulu when given a UTC timezone.\n+--\n+\n+[[java-time-migration-test]]\n+=== Test with your data\n+\n+We strongly recommend you test any date format changes using real data before\n+deploying in production.\n+\n+For help with date debugging, consider using\n+https://esddd.herokuapp.com/[https://esddd.herokuapp.com/.]\n+\n+[[java-time-migrate-update-mappings]]\n+=== Update index mappings", "originalCommit": "0611911178ab8c28339eda141e4b875983e3902c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "79cb755f05a0861a2e31e0ed220a501ef7d46f7a", "url": "https://github.com/elastic/elasticsearch/commit/79cb755f05a0861a2e31e0ed220a501ef7d46f7a", "message": "Apply suggestions from code review\n\nCo-authored-by: James Rodewig <40268737+jrodewig@users.noreply.github.com>", "committedDate": "2020-08-20T11:28:09Z", "type": "commit"}, {"oid": "8634236b2f403f96df73de72b3a40ee6efcd99e3", "url": "https://github.com/elastic/elasticsearch/commit/8634236b2f403f96df73de72b3a40ee6efcd99e3", "message": "move javatime to mappings changes", "committedDate": "2020-08-20T11:53:19Z", "type": "commit"}, {"oid": "43e8927c88f2d6b2ca455bd777f3b239c558df39", "url": "https://github.com/elastic/elasticsearch/commit/43e8927c88f2d6b2ca455bd777f3b239c558df39", "message": "header rename", "committedDate": "2020-08-20T11:57:42Z", "type": "commit"}, {"oid": "2664187d33b97f9f79828c24ab37acd82406c8fd", "url": "https://github.com/elastic/elasticsearch/commit/2664187d33b97f9f79828c24ab37acd82406c8fd", "message": "wording", "committedDate": "2020-08-20T12:01:13Z", "type": "commit"}, {"oid": "693245164c2271724532a83bb1ff7ab4e1fdfbae", "url": "https://github.com/elastic/elasticsearch/commit/693245164c2271724532a83bb1ff7ab4e1fdfbae", "message": "clean migrate 8", "committedDate": "2020-08-20T12:04:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mzk0MzA3Mg==", "url": "https://github.com/elastic/elasticsearch/pull/60506#discussion_r473943072", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            For a detailed migration guide, see {ref}/migrate-to-java-time.html.\n          \n          \n            \n            For a detailed migration guide, see the {ref}/migrate-to-java-time.html[Java time migration guide].", "author": "jrodewig", "createdAt": "2020-08-20T12:48:18Z", "path": "docs/reference/migration/migrate_8_0/mappings.asciidoc", "diffHunk": "@@ -59,6 +59,21 @@ The setting has been deprecated with 7.5 and is no longer supported on new indic\n Mappings for older indices will continue to work but emit a deprecation warning.\n \n *Impact* +\n-The `enabled` setting for `_field_names` should be removed from templates and mappings. \n+The `enabled` setting for `_field_names` should be removed from templates and mappings.\n Disabling _field_names is not necessary because it no longer carries a large index overhead.\n ====\n+\n+//tag::notable-breaking-changes[]\n+Java-time date formats replace joda-time formats\n+[%collapsible]\n+====\n+*Details* +\n+In 7.0, {es} switched from joda time to java time for date-related parsing,\n+formatting, and calculations. Indices created in 7.0 and later versions are\n+already required to use mappings with java-time date formats. However,\n+earlier indices using joda-time formats must be reindexed to use\n+mappings with java-time formats.\n+*Impact* +\n+For a detailed migration guide, see {ref}/migrate-to-java-time.html.", "originalCommit": "693245164c2271724532a83bb1ff7ab4e1fdfbae", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "b3906faaa039d675e6fa0714eac3815782cc8170", "url": "https://github.com/elastic/elasticsearch/commit/b3906faaa039d675e6fa0714eac3815782cc8170", "message": "link fix", "committedDate": "2020-08-20T12:51:23Z", "type": "commit"}, {"oid": "b311577e9806ace75bbea08e079cf864df61985d", "url": "https://github.com/elastic/elasticsearch/commit/b311577e9806ace75bbea08e079cf864df61985d", "message": "Fix link to migration guide", "committedDate": "2020-08-20T13:11:43Z", "type": "commit"}]}