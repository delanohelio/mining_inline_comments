{"pr_number": 58794, "pr_title": "Use `getPortRange` in http server tests", "pr_createdAt": "2020-07-01T03:54:38Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/58794", "timeline": [{"oid": "d1da66d69f4868c276c3b18622262bea12e3ce93", "url": "https://github.com/elastic/elasticsearch/commit/d1da66d69f4868c276c3b18622262bea12e3ce93", "message": "Use `getPortRange` in http server tests\n\nCurrently we are leaving the settings to default port range in the nio\nand netty4 http server test. This has recently led to tests failing due\nto what appears to be a port conflict with other processes. This commit\nmodifies these tests to use the test case helper method to generate port\nranges.", "committedDate": "2020-07-01T03:49:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODE4NDUzMg==", "url": "https://github.com/elastic/elasticsearch/pull/58794#discussion_r448184532", "bodyText": "NIT: maybe extract Settings.builder().put(HttpTransportSettings.SETTING_HTTP_PORT.getKey(), getPortRange()).build() to a method somewhere in the test framework module to dry this up a little?", "author": "original-brownbear", "createdAt": "2020-07-01T07:56:42Z", "path": "modules/transport-netty4/src/test/java/org/elasticsearch/http/netty4/Netty4BadRequestTests.java", "diffHunk": "@@ -87,7 +88,8 @@ public void dispatchBadRequest(RestChannel channel, ThreadContext threadContext,\n             }\n         };\n \n-        try (HttpServerTransport httpServerTransport = new Netty4HttpServerTransport(Settings.EMPTY, networkService, bigArrays, threadPool,\n+        Settings settings = Settings.builder().put(HttpTransportSettings.SETTING_HTTP_PORT.getKey(), getPortRange()).build();", "originalCommit": "d1da66d69f4868c276c3b18622262bea12e3ce93", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "a0ab4a18e1bdcff2a3a164efdb00d60b1763dcad", "url": "https://github.com/elastic/elasticsearch/commit/a0ab4a18e1bdcff2a3a164efdb00d60b1763dcad", "message": "Merge remote-tracking branch 'upstream/master' into jvm_ports_http_tests", "committedDate": "2020-07-02T17:25:17Z", "type": "commit"}, {"oid": "669890e143d4cbcc9ef0e80e882d1040ceb7c436", "url": "https://github.com/elastic/elasticsearch/commit/669890e143d4cbcc9ef0e80e882d1040ceb7c436", "message": "Cleanup", "committedDate": "2020-07-02T17:37:58Z", "type": "commit"}]}