{"pr_number": 54086, "pr_title": "[DOCS] EQL: Document `wildcard` function", "pr_createdAt": "2020-03-24T13:38:19Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/54086", "timeline": [{"oid": "b00b0c7bc455bd68e813d27ec56001b72bdc5444", "url": "https://github.com/elastic/elasticsearch/commit/b00b0c7bc455bd68e813d27ec56001b72bdc5444", "message": "[DOCS] EQL: Document `wildcard` function", "committedDate": "2020-03-25T16:55:27Z", "type": "forcePushed"}, {"oid": "64c5028046f7c1d3ac4989b1d05d9c9c08f475cf", "url": "https://github.com/elastic/elasticsearch/commit/64c5028046f7c1d3ac4989b1d05d9c9c08f475cf", "message": "[DOCS] EQL: Document `wildcard` function", "committedDate": "2020-03-25T17:09:50Z", "type": "forcePushed"}, {"oid": "2380d7f751bfdcfdd8a90be105904b1f3d15ce18", "url": "https://github.com/elastic/elasticsearch/commit/2380d7f751bfdcfdd8a90be105904b1f3d15ce18", "message": "[DOCS] EQL: Document `wildcard` function", "committedDate": "2020-04-06T14:50:40Z", "type": "forcePushed"}, {"oid": "a3ac5cf1d35339c05ddbaaa8e950e832691a5a2d", "url": "https://github.com/elastic/elasticsearch/commit/a3ac5cf1d35339c05ddbaaa8e950e832691a5a2d", "message": "[DOCS] EQL: Document `wildcard` function", "committedDate": "2020-04-06T14:58:10Z", "type": "forcePushed"}, {"oid": "6e2662b56182485f72d69813a828e94168710057", "url": "https://github.com/elastic/elasticsearch/commit/6e2662b56182485f72d69813a828e94168710057", "message": "[DOCS] EQL: Document `wildcard` function", "committedDate": "2020-04-06T15:01:07Z", "type": "forcePushed"}, {"oid": "ce7a01e03145d55c358ee857041e68e87afc5b8e", "url": "https://github.com/elastic/elasticsearch/commit/ce7a01e03145d55c358ee857041e68e87afc5b8e", "message": "[DOCS] EQL: Document `wildcard` function", "committedDate": "2020-04-06T15:10:02Z", "type": "commit"}, {"oid": "ce7a01e03145d55c358ee857041e68e87afc5b8e", "url": "https://github.com/elastic/elasticsearch/commit/ce7a01e03145d55c358ee857041e68e87afc5b8e", "message": "[DOCS] EQL: Document `wildcard` function", "committedDate": "2020-04-06T15:10:02Z", "type": "forcePushed"}, {"oid": "d9116060341f8c736ca03ce5ed6eee96837e85a1", "url": "https://github.com/elastic/elasticsearch/commit/d9116060341f8c736ca03ce5ed6eee96837e85a1", "message": "clarifications", "committedDate": "2020-04-06T15:35:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDM1NDExMw==", "url": "https://github.com/elastic/elasticsearch/pull/54086#discussion_r404354113", "bodyText": "This behavior isn't consistent with other string functions, like startsWith: https://www.elastic.co/guide/en/elasticsearch/reference/master/eql-function-ref.html#eql-fn-startswith\nI wonder if it would be more consistent to just pass a null value?", "author": "jrodewig", "createdAt": "2020-04-06T20:03:33Z", "path": "docs/reference/eql/functions.asciidoc", "diffHunk": "@@ -276,4 +277,82 @@ function returns the remaining string.\n Positions are zero-indexed. Negative offsets are supported.\n \n *Returns:* string\n+====\n+\n+[discrete]\n+[[eql-fn-wildcard]]\n+=== `wildcard`\n+Returns `true` if a source string matches one or more provided wildcard\n+expressions. Matching is case sensitive.\n+\n+[%collapsible]\n+====\n+*Example*\n+[source,eql]\n+----\n+// The two following expressions are equivalent.\n+process.command_line == \"*start*\" or process.command_line == \"*config*\"\n+wildcard(process.command_line, \"*start*\", \"*config*\")\n+\n+// process.command_line = \"start explorer.exe\"\n+wildcard(process.command_line, \"*start*\")                // returns true\n+wildcard(process.command_line, \"*start*\", \"*config*\")    // returns true\n+wildcard(process.command_line, \"*config*\")               // returns false\n+wildcard(process.command_line, \"*config*\", \"*create*\")   // returns false\n+\n+// process.command_line = [ \"start explorer.exe\", \"create regsvr32.exe\" ]\n+wildcard(process.command_line, \"*create*\")              // returns true\n+wildcard(process.command_line, \"*create*\", \"*config*\")  // returns true\n+wildcard(process.command_line, \"*start*\")               // returns false\n+wildcard(process.command_line, \"*start*\", \"*create*\")   // returns true\n+wildcard(process.command_line, \"*start*\", \"*config*\")   // returns false\n+\n+// case sensitive matching\n+wildcard(\"start explorer.exe\", \"*start*\")                // returns true\n+wildcard(\"start explorer.exe\", \"*Start*\")                // returns false\n+\n+// null handling\n+wildcard(null, \"*start*\")                                // returns false\n+wildcard(null, null)                                     // returns 500 error\n+wildcard(\"start explorer.exe\", null)                     // returns 500 error\n+wildcard(\"start explorer.exe\", null, \"*start*\")          // returns 500 error\n+wildcard(\"\", null)                                       // returns 500 error", "originalCommit": "d9116060341f8c736ca03ce5ed6eee96837e85a1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQ5NTE3Ng==", "url": "https://github.com/elastic/elasticsearch/pull/54086#discussion_r404495176", "bodyText": "With wildcard all parameters after the first must be static strings, so these will get verification failures. With startswith and the other string functions, the second string argument isn't required to be static.", "author": "rw-access", "createdAt": "2020-04-07T02:10:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDM1NDExMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDc4MDMyNA==", "url": "https://github.com/elastic/elasticsearch/pull/54086#discussion_r404780324", "bodyText": "Makes sense.", "author": "jrodewig", "createdAt": "2020-04-07T12:47:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDM1NDExMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDM1NDI5Nw==", "url": "https://github.com/elastic/elasticsearch/pull/54086#discussion_r404354297", "bodyText": "If null, the function returns a 500 error.\n\nSee https://github.com/elastic/elasticsearch/pull/54086/files#r404354113", "author": "jrodewig", "createdAt": "2020-04-06T20:03:54Z", "path": "docs/reference/eql/functions.asciidoc", "diffHunk": "@@ -276,4 +277,82 @@ function returns the remaining string.\n Positions are zero-indexed. Negative offsets are supported.\n \n *Returns:* string\n+====\n+\n+[discrete]\n+[[eql-fn-wildcard]]\n+=== `wildcard`\n+Returns `true` if a source string matches one or more provided wildcard\n+expressions. Matching is case sensitive.\n+\n+[%collapsible]\n+====\n+*Example*\n+[source,eql]\n+----\n+// The two following expressions are equivalent.\n+process.command_line == \"*start*\" or process.command_line == \"*config*\"\n+wildcard(process.command_line, \"*start*\", \"*config*\")\n+\n+// process.command_line = \"start explorer.exe\"\n+wildcard(process.command_line, \"*start*\")                // returns true\n+wildcard(process.command_line, \"*start*\", \"*config*\")    // returns true\n+wildcard(process.command_line, \"*config*\")               // returns false\n+wildcard(process.command_line, \"*config*\", \"*create*\")   // returns false\n+\n+// process.command_line = [ \"start explorer.exe\", \"create regsvr32.exe\" ]\n+wildcard(process.command_line, \"*create*\")              // returns true\n+wildcard(process.command_line, \"*create*\", \"*config*\")  // returns true\n+wildcard(process.command_line, \"*start*\")               // returns false\n+wildcard(process.command_line, \"*start*\", \"*create*\")   // returns true\n+wildcard(process.command_line, \"*start*\", \"*config*\")   // returns false\n+\n+// case sensitive matching\n+wildcard(\"start explorer.exe\", \"*start*\")                // returns true\n+wildcard(\"start explorer.exe\", \"*Start*\")                // returns false\n+\n+// null handling\n+wildcard(null, \"*start*\")                                // returns false\n+wildcard(null, null)                                     // returns 500 error\n+wildcard(\"start explorer.exe\", null)                     // returns 500 error\n+wildcard(\"start explorer.exe\", null, \"*start*\")          // returns 500 error\n+wildcard(\"\", null)                                       // returns 500 error\n+wildcard(\"\", \"\")                                         // returns true\n+----\n+\n+*Syntax*\n+\n+[source,txt]\n+----\n+wildcard(<source>, <wildcard_exp>[, ...])\n+----\n+\n+*Parameters*\n+\n+`<source>`::\n++\n+--\n+(Required, string)\n+Source string.\n+\n+If using a field as the argument, this parameter only supports the following\n+field datatypes:\n+\n+* <<keyword,`keyword`>>\n+* <<constant-keyword,`constant_keyword`>>\n+* <<text,`text`>> field with a <<keyword,`keyword`>> or\n+  <<constant-keyword,`constant_keyword`>> sub-field\n+\n+Fields containing <<array,array values>> use the last array item only.\n+--\n+\n+`<wildcard_exp>`::\n++\n+--\n+(Required{multi-arg}, string)\n+Wildcard expression used to match the source string. Fields are not supported as\n+arguments. If `null`, the function returns a 500 error.", "originalCommit": "d9116060341f8c736ca03ce5ed6eee96837e85a1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDM1NTE5Mw==", "url": "https://github.com/elastic/elasticsearch/pull/54086#discussion_r404355193", "bodyText": "Fields containing <<array,array values>> use the last array item only.\n\nThis behavior seemed a little odd to me, but it's not consistent across functions. endsWith and startsWith only use the first array item. length doesn't support arrays at all.", "author": "jrodewig", "createdAt": "2020-04-06T20:05:37Z", "path": "docs/reference/eql/functions.asciidoc", "diffHunk": "@@ -276,4 +277,82 @@ function returns the remaining string.\n Positions are zero-indexed. Negative offsets are supported.\n \n *Returns:* string\n+====\n+\n+[discrete]\n+[[eql-fn-wildcard]]\n+=== `wildcard`\n+Returns `true` if a source string matches one or more provided wildcard\n+expressions. Matching is case sensitive.\n+\n+[%collapsible]\n+====\n+*Example*\n+[source,eql]\n+----\n+// The two following expressions are equivalent.\n+process.command_line == \"*start*\" or process.command_line == \"*config*\"\n+wildcard(process.command_line, \"*start*\", \"*config*\")\n+\n+// process.command_line = \"start explorer.exe\"\n+wildcard(process.command_line, \"*start*\")                // returns true\n+wildcard(process.command_line, \"*start*\", \"*config*\")    // returns true\n+wildcard(process.command_line, \"*config*\")               // returns false\n+wildcard(process.command_line, \"*config*\", \"*create*\")   // returns false\n+\n+// process.command_line = [ \"start explorer.exe\", \"create regsvr32.exe\" ]\n+wildcard(process.command_line, \"*create*\")              // returns true\n+wildcard(process.command_line, \"*create*\", \"*config*\")  // returns true\n+wildcard(process.command_line, \"*start*\")               // returns false\n+wildcard(process.command_line, \"*start*\", \"*create*\")   // returns true\n+wildcard(process.command_line, \"*start*\", \"*config*\")   // returns false\n+\n+// case sensitive matching\n+wildcard(\"start explorer.exe\", \"*start*\")                // returns true\n+wildcard(\"start explorer.exe\", \"*Start*\")                // returns false\n+\n+// null handling\n+wildcard(null, \"*start*\")                                // returns false\n+wildcard(null, null)                                     // returns 500 error\n+wildcard(\"start explorer.exe\", null)                     // returns 500 error\n+wildcard(\"start explorer.exe\", null, \"*start*\")          // returns 500 error\n+wildcard(\"\", null)                                       // returns 500 error\n+wildcard(\"\", \"\")                                         // returns true\n+----\n+\n+*Syntax*\n+\n+[source,txt]\n+----\n+wildcard(<source>, <wildcard_exp>[, ...])\n+----\n+\n+*Parameters*\n+\n+`<source>`::\n++\n+--\n+(Required, string)\n+Source string.\n+\n+If using a field as the argument, this parameter only supports the following\n+field datatypes:\n+\n+* <<keyword,`keyword`>>\n+* <<constant-keyword,`constant_keyword`>>\n+* <<text,`text`>> field with a <<keyword,`keyword`>> or\n+  <<constant-keyword,`constant_keyword`>> sub-field\n+\n+Fields containing <<array,array values>> use the last array item only.", "originalCommit": "d9116060341f8c736ca03ce5ed6eee96837e85a1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQ5NTk1OA==", "url": "https://github.com/elastic/elasticsearch/pull/54086#discussion_r404495958", "bodyText": "I don't know enough about arrays in ES to speak for this. But under the hood, wildcard gets converted to LIKE. This array behavior will be consistent with SQL LIKE.", "author": "rw-access", "createdAt": "2020-04-07T02:13:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDM1NTE5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDgwMDYyMg==", "url": "https://github.com/elastic/elasticsearch/pull/54086#discussion_r404800622", "bodyText": "@astefan @costin Would one of you mind verifying this statement?\n\nFields containing <<array,array values>> use the last array item only.\n\nI want to ensure this lines up with the behavior of SQL LIKE.\nI've tested the wildcard function using arrays of varying length. It seems to reliably use the last array item.", "author": "jrodewig", "createdAt": "2020-04-07T13:17:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDM1NTE5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjE4MjkxMA==", "url": "https://github.com/elastic/elasticsearch/pull/54086#discussion_r406182910", "bodyText": "@jrodewig @rw-access  I don't think I understand the array argument... wildcard gets converted to value LIKE array_value1 OR value LIKE array_value2 OR value LIKE array_value3......\nWith array values in ES, SQL is at the mercy of Lucene. Whatever \"first\" value Elasticsearch gives us, that's the one we return.\nIn SQL documentation we say about field_multi_value_leniency parameter: Throw an exception when encountering multiple values for a field (default) or be lenient and return the **first value from the list (without any guarantees of what that will be - typically the first in natural ascending order)**. So \"first\"/\"last\" has loose meanings in this context. And Elasticsearch itself doesn't offer any guarantees of the ordering of values in a potential array of values for a certain field, because ES doesn't care too much about the ordering. It's typically ascending order, but it's not guaranteed to be like this always and for every field/values.", "author": "astefan", "createdAt": "2020-04-09T12:55:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDM1NTE5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjE4NzA1OA==", "url": "https://github.com/elastic/elasticsearch/pull/54086#discussion_r406187058", "bodyText": "Thanks for the explanation @astefan.\nIn my opinion, it seems like documenting a limitation similar to the SQL one makes sense. Generally, we should discourage users from using array values with EQL and explain the perils.\nI raised #54970 as a discuss issue to get consensus before moving forward. If we decide to document the limitation, I'll remove the array value references from the wildcard function docs.", "author": "jrodewig", "createdAt": "2020-04-09T13:02:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDM1NTE5Mw=="}], "type": "inlineReview"}, {"oid": "9b1e6e077d7e20e180d2b3de988eae9d7d789dbb", "url": "https://github.com/elastic/elasticsearch/commit/9b1e6e077d7e20e180d2b3de988eae9d7d789dbb", "message": "update null and empty string examples", "committedDate": "2020-04-08T14:06:02Z", "type": "commit"}, {"oid": "184bd532f3775d8a480c8094eb72c985c202c4d7", "url": "https://github.com/elastic/elasticsearch/commit/184bd532f3775d8a480c8094eb72c985c202c4d7", "message": "Remove case sensitive references matching per ##54411.", "committedDate": "2020-04-08T17:12:55Z", "type": "commit"}, {"oid": "628906f0dd5f15d76a515d9f7a893e29acf48e08", "url": "https://github.com/elastic/elasticsearch/commit/628906f0dd5f15d76a515d9f7a893e29acf48e08", "message": "Simplify examples", "committedDate": "2020-04-08T17:19:26Z", "type": "commit"}, {"oid": "1c2ae7a0394a966ea43376c1ff9ba9b5bf6fa78a", "url": "https://github.com/elastic/elasticsearch/commit/1c2ae7a0394a966ea43376c1ff9ba9b5bf6fa78a", "message": "updates for array and null values", "committedDate": "2020-04-10T12:41:13Z", "type": "commit"}, {"oid": "77a0710fcd3ef848ff51fecdae391d5904a14b6f", "url": "https://github.com/elastic/elasticsearch/commit/77a0710fcd3ef848ff51fecdae391d5904a14b6f", "message": "fix double space", "committedDate": "2020-04-10T13:01:25Z", "type": "commit"}]}