{"pr_number": 57124, "pr_title": "Fix key usage in SamlAuthenticatorTests", "pr_createdAt": "2020-05-25T15:27:45Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/57124", "timeline": [{"oid": "83723015a1a82d11fc961ce245495178aed790ad", "url": "https://github.com/elastic/elasticsearch/commit/83723015a1a82d11fc961ce245495178aed790ad", "message": "Fix key usage in SamlAuthenticatorTests\n\nIn #51089 where SamlAuthenticatorTests were refactored, we missed\nto update one test case which meant that a single key would be\nused both for signing and encryption in the same run. As explained\nin #51089, and due to FIPS 140 requirements, BouncyCastle FIPS\nprovider will block RSA keys that have been used for signing from\nbeing used for encryption and vice versa\n\nThis commit changes testNoAttributesReturnedWhenTheyCannotBeDecrypted\nto always use the specific keys we have added for encryption.", "committedDate": "2020-05-25T15:23:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDE1Mjc1Mg==", "url": "https://github.com/elastic/elasticsearch/pull/57124#discussion_r430152752", "bodyText": "I could use some help to understand what is going on here: Is this necessary because RSA_4096_updated is used in other tests as a signing key, e.g. in testSigningKeyIsReloadedForEachRequest? Since the all tests run in the same JVM, once this key is added as a signing key, it can no longer be used as a encryption key here and vice versa (depends on which test runs first)?", "author": "ywangd", "createdAt": "2020-05-26T04:44:32Z", "path": "x-pack/plugin/security/src/test/java/org/elasticsearch/xpack/security/authc/saml/SamlAuthenticatorTests.java", "diffHunk": "@@ -403,7 +403,7 @@ public void testNoAttributesReturnedWhenTheyCannotBeDecrypted() throws Exception\n         final String xml = getSimpleResponseAsString(now);\n \n         // Encrypting with different cert instead of sp cert will mean that the SP cannot decrypt\n-        final Response encrypted = encryptAttributes(xml, readKeyPair(\"RSA_4096_updated\"));\n+        final Response encrypted = encryptAttributes(xml, readKeyPair(\"ENCRYPTION_RSA_4096_updated\"));", "originalCommit": "83723015a1a82d11fc961ce245495178aed790ad", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDE1MzU5MA==", "url": "https://github.com/elastic/elasticsearch/pull/57124#discussion_r430153590", "bodyText": "Correct!\n\nwhich meant that a single key would be\nused both for signing and encryption in the same run", "author": "jkakavas", "createdAt": "2020-05-26T04:48:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDE1Mjc1Mg=="}], "type": "inlineReview"}]}