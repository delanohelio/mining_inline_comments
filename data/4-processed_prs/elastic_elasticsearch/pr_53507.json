{"pr_number": 53507, "pr_title": "[ML] Add a model memory estimation endpoint for anomaly detection", "pr_createdAt": "2020-03-12T18:18:57Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/53507", "timeline": [{"oid": "5546bd2576b186671245a9f3655463da4cc28387", "url": "https://github.com/elastic/elasticsearch/commit/5546bd2576b186671245a9f3655463da4cc28387", "message": "[ML] Add a model memory estimation endpoint for anomaly detection\n\nThis PR completes the implementation of the model\nmemory estimation endpoint:\n\nPOST _ml/anomaly_detectors/estimate_model_memory\n\nCloses #53219", "committedDate": "2020-03-12T18:18:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTgxMDM3Ng==", "url": "https://github.com/elastic/elasticsearch/pull/53507#discussion_r391810376", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            === Estimate {anomaly-jobs} Model Memory API\n          \n          \n            \n            === Estimate {anomaly-jobs} model memory API", "author": "lcawl", "createdAt": "2020-03-12T18:23:35Z", "path": "docs/reference/ml/anomaly-detection/apis/estimate-model-memory.asciidoc", "diffHunk": "@@ -0,0 +1,74 @@\n+[role=\"xpack\"]\n+[testenv=\"platinum\"]\n+[[ml-estimate-model-memory]]\n+=== Estimate {anomaly-jobs} Model Memory API", "originalCommit": "5546bd2576b186671245a9f3655463da4cc28387", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTgxMjMzMw==", "url": "https://github.com/elastic/elasticsearch/pull/53507#discussion_r391812333", "bodyText": "Trying to work the concept of jobs into this intro:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Estimates the model memory an analysis config is likely to need given\n          \n          \n            \n            Estimates the model memory an {anomaly-job} is likely to need based on analysis configuration details and", "author": "lcawl", "createdAt": "2020-03-12T18:27:22Z", "path": "docs/reference/ml/anomaly-detection/apis/estimate-model-memory.asciidoc", "diffHunk": "@@ -0,0 +1,74 @@\n+[role=\"xpack\"]\n+[testenv=\"platinum\"]\n+[[ml-estimate-model-memory]]\n+=== Estimate {anomaly-jobs} Model Memory API\n+++++\n+<titleabbrev>Estimate Model Memory</titleabbrev>\n+++++\n+\n+Estimates the model memory an analysis config is likely to need given", "originalCommit": "5546bd2576b186671245a9f3655463da4cc28387", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTgxMzc3Mg==", "url": "https://github.com/elastic/elasticsearch/pull/53507#discussion_r391813772", "bodyText": "This API enables you....\n\nI think this sentence repeats what we've already said in the intro so unless we have more info to add we can omit this section.", "author": "lcawl", "createdAt": "2020-03-12T18:29:51Z", "path": "docs/reference/ml/anomaly-detection/apis/estimate-model-memory.asciidoc", "diffHunk": "@@ -0,0 +1,74 @@\n+[role=\"xpack\"]\n+[testenv=\"platinum\"]\n+[[ml-estimate-model-memory]]\n+=== Estimate {anomaly-jobs} Model Memory API\n+++++\n+<titleabbrev>Estimate Model Memory</titleabbrev>\n+++++\n+\n+Estimates the model memory an analysis config is likely to need given\n+cardinality estimates for the fields it references.\n+\n+[[ml-estimate-model-memory-request]]\n+==== {api-request-title}\n+\n+`POST _ml/anomaly_detectors/_estimate_model_memory`\n+\n+[[ml-estimate-model-memory-prereqs]]\n+==== {api-prereq-title}\n+\n+* If the {es} {security-features} are enabled, you must have `manage_ml` or\n+`manage` cluster privileges to use this API. See\n+<<security-privileges>>.\n+\n+[[ml-estimate-model-memory-desc]]\n+==== {api-description-title}\n+\n+This API enables you to estimate the model memory and {anomaly-job}", "originalCommit": "5546bd2576b186671245a9f3655463da4cc28387", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTgyMjUyMQ==", "url": "https://github.com/elastic/elasticsearch/pull/53507#discussion_r391822521", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            For a list of the properties that you can specify in the `analysis_config`\n          \n          \n            \n            `analysis_config`::  (Required, object) For a list of the properties that you can specify in the `analysis_config`", "author": "lcawl", "createdAt": "2020-03-12T18:46:07Z", "path": "docs/reference/ml/anomaly-detection/apis/estimate-model-memory.asciidoc", "diffHunk": "@@ -0,0 +1,74 @@\n+[role=\"xpack\"]\n+[testenv=\"platinum\"]\n+[[ml-estimate-model-memory]]\n+=== Estimate {anomaly-jobs} Model Memory API\n+++++\n+<titleabbrev>Estimate Model Memory</titleabbrev>\n+++++\n+\n+Estimates the model memory an analysis config is likely to need given\n+cardinality estimates for the fields it references.\n+\n+[[ml-estimate-model-memory-request]]\n+==== {api-request-title}\n+\n+`POST _ml/anomaly_detectors/_estimate_model_memory`\n+\n+[[ml-estimate-model-memory-prereqs]]\n+==== {api-prereq-title}\n+\n+* If the {es} {security-features} are enabled, you must have `manage_ml` or\n+`manage` cluster privileges to use this API. See\n+<<security-privileges>>.\n+\n+[[ml-estimate-model-memory-desc]]\n+==== {api-description-title}\n+\n+This API enables you to estimate the model memory and {anomaly-job}\n+configuration will require before you create the job.\n+\n+[[ml-estimate-model-memory-request-body]]\n+==== {api-request-body-title}\n+\n+For a list of the properties that you can specify in the `analysis_config`", "originalCommit": "5546bd2576b186671245a9f3655463da4cc28387", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTgyNDAxMw==", "url": "https://github.com/elastic/elasticsearch/pull/53507#discussion_r391824013", "bodyText": "We'll need descriptions of the other required objects too:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \n          \n          \n            \n            \n          \n          \n            \n            `max_bucket_cardinality`:: (Required, object) TBD\n          \n          \n            \n            \n          \n          \n            \n            `overall_cardinality`:: (Required, object) TBD", "author": "lcawl", "createdAt": "2020-03-12T18:48:58Z", "path": "docs/reference/ml/anomaly-detection/apis/estimate-model-memory.asciidoc", "diffHunk": "@@ -0,0 +1,74 @@\n+[role=\"xpack\"]\n+[testenv=\"platinum\"]\n+[[ml-estimate-model-memory]]\n+=== Estimate {anomaly-jobs} Model Memory API\n+++++\n+<titleabbrev>Estimate Model Memory</titleabbrev>\n+++++\n+\n+Estimates the model memory an analysis config is likely to need given\n+cardinality estimates for the fields it references.\n+\n+[[ml-estimate-model-memory-request]]\n+==== {api-request-title}\n+\n+`POST _ml/anomaly_detectors/_estimate_model_memory`\n+\n+[[ml-estimate-model-memory-prereqs]]\n+==== {api-prereq-title}\n+\n+* If the {es} {security-features} are enabled, you must have `manage_ml` or\n+`manage` cluster privileges to use this API. See\n+<<security-privileges>>.\n+\n+[[ml-estimate-model-memory-desc]]\n+==== {api-description-title}\n+\n+This API enables you to estimate the model memory and {anomaly-job}\n+configuration will require before you create the job.\n+\n+[[ml-estimate-model-memory-request-body]]\n+==== {api-request-body-title}\n+\n+For a list of the properties that you can specify in the `analysis_config`\n+component of the body of this API, see <<put-analysisconfig>>.\n+", "originalCommit": "5546bd2576b186671245a9f3655463da4cc28387", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "258a900ed71f0f57f3283f60c3136fcc432d503e", "url": "https://github.com/elastic/elasticsearch/commit/258a900ed71f0f57f3283f60c3136fcc432d503e", "message": "Addressing docs comments", "committedDate": "2020-03-13T13:30:05Z", "type": "commit"}, {"oid": "ce16b385665dc3e356be193cdad5ac4daf830e44", "url": "https://github.com/elastic/elasticsearch/commit/ce16b385665dc3e356be193cdad5ac4daf830e44", "message": "Adding numbers for more functions", "committedDate": "2020-03-19T15:45:28Z", "type": "commit"}, {"oid": "b5a2cceb2634e122a1af1f4ed1050fc7a09f0a97", "url": "https://github.com/elastic/elasticsearch/commit/b5a2cceb2634e122a1af1f4ed1050fc7a09f0a97", "message": "Merge branch 'master' into hlrc_for_estimate_model_memory", "committedDate": "2020-03-24T10:19:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzA5NTEwNA==", "url": "https://github.com/elastic/elasticsearch/pull/53507#discussion_r397095104", "bodyText": "Removing this setter and making this.analysisConfig final would be more in style with the HLRC code", "author": "davidkyle", "createdAt": "2020-03-24T11:53:24Z", "path": "client/rest-high-level/src/main/java/org/elasticsearch/client/ml/EstimateModelMemoryRequest.java", "diffHunk": "@@ -0,0 +1,114 @@\n+/*\n+ * Licensed to Elasticsearch under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.elasticsearch.client.ml;\n+\n+import org.elasticsearch.client.Validatable;\n+import org.elasticsearch.client.ValidationException;\n+import org.elasticsearch.client.ml.job.config.AnalysisConfig;\n+import org.elasticsearch.common.xcontent.ToXContentObject;\n+import org.elasticsearch.common.xcontent.XContentBuilder;\n+\n+import java.io.IOException;\n+import java.util.Collections;\n+import java.util.Map;\n+import java.util.Objects;\n+import java.util.Optional;\n+\n+/**\n+ * Request to estimate the model memory an analysis config is likely to need given supplied field cardinalities.\n+ */\n+public class EstimateModelMemoryRequest implements Validatable, ToXContentObject {\n+\n+    public static final String ANALYSIS_CONFIG = \"analysis_config\";\n+    public static final String OVERALL_CARDINALITY = \"overall_cardinality\";\n+    public static final String MAX_BUCKET_CARDINALITY = \"max_bucket_cardinality\";\n+\n+    private AnalysisConfig analysisConfig;\n+    private Map<String, Long> overallCardinality = Collections.emptyMap();\n+    private Map<String, Long> maxBucketCardinality = Collections.emptyMap();\n+\n+    @Override\n+    public Optional<ValidationException> validate() {\n+        return Optional.empty();\n+    }\n+\n+    public EstimateModelMemoryRequest(AnalysisConfig analysisConfig) {\n+        this.analysisConfig = Objects.requireNonNull(analysisConfig);\n+    }\n+\n+    public AnalysisConfig getAnalysisConfig() {\n+        return analysisConfig;\n+    }\n+\n+    public void setAnalysisConfig(AnalysisConfig analysisConfig) {\n+        this.analysisConfig = Objects.requireNonNull(analysisConfig);", "originalCommit": "b5a2cceb2634e122a1af1f4ed1050fc7a09f0a97", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzA5NzMzNQ==", "url": "https://github.com/elastic/elasticsearch/pull/53507#discussion_r397097335", "bodyText": "missing 'the'?  '... for the'", "author": "davidkyle", "createdAt": "2020-03-24T11:57:22Z", "path": "docs/java-rest/high-level/ml/estimate-model-memory.asciidoc", "diffHunk": "@@ -0,0 +1,42 @@\n+--\n+:api: estimate-model-memory\n+:request: EstimateModelMemoryRequest\n+:response: EstimateModelMemoryResponse\n+--\n+[role=\"xpack\"]\n+[id=\"{upid}-{api}\"]\n+=== Estimate {anomaly-job} Model Memory API\n+\n+Estimate the model memory an analysis config is likely to need for", "originalCommit": "b5a2cceb2634e122a1af1f4ed1050fc7a09f0a97", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "0caf242c5313ad39ca053c8824642fb7151cdc5b", "url": "https://github.com/elastic/elasticsearch/commit/0caf242c5313ad39ca053c8824642fb7151cdc5b", "message": "Address review comments", "committedDate": "2020-03-24T12:43:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzI4MzIxNQ==", "url": "https://github.com/elastic/elasticsearch/pull/53507#discussion_r397283215", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            <titleabbrev>Estimate Model Memory</titleabbrev>\n          \n          \n            \n            <titleabbrev>Estimate model memory</titleabbrev>", "author": "lcawl", "createdAt": "2020-03-24T16:19:15Z", "path": "docs/reference/ml/anomaly-detection/apis/estimate-model-memory.asciidoc", "diffHunk": "@@ -0,0 +1,87 @@\n+[role=\"xpack\"]\n+[testenv=\"platinum\"]\n+[[ml-estimate-model-memory]]\n+=== Estimate {anomaly-jobs} model memory API\n+++++\n+<titleabbrev>Estimate Model Memory</titleabbrev>", "originalCommit": "0caf242c5313ad39ca053c8824642fb7151cdc5b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzI4NDQzMg==", "url": "https://github.com/elastic/elasticsearch/pull/53507#discussion_r397284432", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            analyzes data for. To produce a good answer values must be provided for\n          \n          \n            \n            analyzes data. To produce a good answer, values must be provided for", "author": "lcawl", "createdAt": "2020-03-24T16:20:46Z", "path": "docs/reference/ml/anomaly-detection/apis/estimate-model-memory.asciidoc", "diffHunk": "@@ -0,0 +1,87 @@\n+[role=\"xpack\"]\n+[testenv=\"platinum\"]\n+[[ml-estimate-model-memory]]\n+=== Estimate {anomaly-jobs} model memory API\n+++++\n+<titleabbrev>Estimate Model Memory</titleabbrev>\n+++++\n+\n+Estimates the model memory an {anomaly-job} is likely to need based on analysis\n+configuration details and cardinality estimates for the fields it references.\n+\n+[[ml-estimate-model-memory-request]]\n+==== {api-request-title}\n+\n+`POST _ml/anomaly_detectors/_estimate_model_memory`\n+\n+[[ml-estimate-model-memory-prereqs]]\n+==== {api-prereq-title}\n+\n+* If the {es} {security-features} are enabled, you must have `manage_ml` or\n+`manage` cluster privileges to use this API. See\n+<<security-privileges>>.\n+\n+[[ml-estimate-model-memory-request-body]]\n+==== {api-request-body-title}\n+\n+`analysis_config`::\n+(Required, object) For a list of the properties that you can specify in the\n+`analysis_config` component of the body of this API, see <<put-analysisconfig>>.\n+\n+`max_bucket_cardinality`::\n+(Optional, object) Estimates of the highest cardinality in a single bucket\n+that will be observed for influencer fields over the time period the job\n+analyzes data for. To produce a good answer values must be provided for", "originalCommit": "0caf242c5313ad39ca053c8824642fb7151cdc5b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzI4NTMzMg==", "url": "https://github.com/elastic/elasticsearch/pull/53507#discussion_r397285332", "bodyText": "Rewriting to avoid ending sentence in \"for\".  Alternatively \"over the time period for which the job...\"\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            that will be observed for influencer fields over the time period the job\n          \n          \n            \n            that will be observed for influencer fields over the time period that the job", "author": "lcawl", "createdAt": "2020-03-24T16:21:56Z", "path": "docs/reference/ml/anomaly-detection/apis/estimate-model-memory.asciidoc", "diffHunk": "@@ -0,0 +1,87 @@\n+[role=\"xpack\"]\n+[testenv=\"platinum\"]\n+[[ml-estimate-model-memory]]\n+=== Estimate {anomaly-jobs} model memory API\n+++++\n+<titleabbrev>Estimate Model Memory</titleabbrev>\n+++++\n+\n+Estimates the model memory an {anomaly-job} is likely to need based on analysis\n+configuration details and cardinality estimates for the fields it references.\n+\n+[[ml-estimate-model-memory-request]]\n+==== {api-request-title}\n+\n+`POST _ml/anomaly_detectors/_estimate_model_memory`\n+\n+[[ml-estimate-model-memory-prereqs]]\n+==== {api-prereq-title}\n+\n+* If the {es} {security-features} are enabled, you must have `manage_ml` or\n+`manage` cluster privileges to use this API. See\n+<<security-privileges>>.\n+\n+[[ml-estimate-model-memory-request-body]]\n+==== {api-request-body-title}\n+\n+`analysis_config`::\n+(Required, object) For a list of the properties that you can specify in the\n+`analysis_config` component of the body of this API, see <<put-analysisconfig>>.\n+\n+`max_bucket_cardinality`::\n+(Optional, object) Estimates of the highest cardinality in a single bucket\n+that will be observed for influencer fields over the time period the job", "originalCommit": "0caf242c5313ad39ca053c8824642fb7151cdc5b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzI4NjQ0MA==", "url": "https://github.com/elastic/elasticsearch/pull/53507#discussion_r397286440", "bodyText": "Is \"safely\" required here?  It implies a danger that seems unfounded to me\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            `max_bucket_cardinality` can be safely omitted from the request.\n          \n          \n            \n            `max_bucket_cardinality` can be omitted from the request.", "author": "lcawl", "createdAt": "2020-03-24T16:23:14Z", "path": "docs/reference/ml/anomaly-detection/apis/estimate-model-memory.asciidoc", "diffHunk": "@@ -0,0 +1,87 @@\n+[role=\"xpack\"]\n+[testenv=\"platinum\"]\n+[[ml-estimate-model-memory]]\n+=== Estimate {anomaly-jobs} model memory API\n+++++\n+<titleabbrev>Estimate Model Memory</titleabbrev>\n+++++\n+\n+Estimates the model memory an {anomaly-job} is likely to need based on analysis\n+configuration details and cardinality estimates for the fields it references.\n+\n+[[ml-estimate-model-memory-request]]\n+==== {api-request-title}\n+\n+`POST _ml/anomaly_detectors/_estimate_model_memory`\n+\n+[[ml-estimate-model-memory-prereqs]]\n+==== {api-prereq-title}\n+\n+* If the {es} {security-features} are enabled, you must have `manage_ml` or\n+`manage` cluster privileges to use this API. See\n+<<security-privileges>>.\n+\n+[[ml-estimate-model-memory-request-body]]\n+==== {api-request-body-title}\n+\n+`analysis_config`::\n+(Required, object) For a list of the properties that you can specify in the\n+`analysis_config` component of the body of this API, see <<put-analysisconfig>>.\n+\n+`max_bucket_cardinality`::\n+(Optional, object) Estimates of the highest cardinality in a single bucket\n+that will be observed for influencer fields over the time period the job\n+analyzes data for. To produce a good answer values must be provided for\n+all influencer fields. It does not matter if values are provided for fields\n+that are not listed as `influencers`. If there are no `influencers` then\n+`max_bucket_cardinality` can be safely omitted from the request.", "originalCommit": "0caf242c5313ad39ca053c8824642fb7151cdc5b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzI4NzM1Nw==", "url": "https://github.com/elastic/elasticsearch/pull/53507#discussion_r397287357", "bodyText": "Per previous suggestion, I'd recommend trying to avoid ending with \"for\". E.g. either using \"that\" or \"for which\" instead:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            fields over the whole time period the job analyzes data for. To produce\n          \n          \n            \n            fields over the whole time period that the job analyzes data. To produce", "author": "lcawl", "createdAt": "2020-03-24T16:24:23Z", "path": "docs/reference/ml/anomaly-detection/apis/estimate-model-memory.asciidoc", "diffHunk": "@@ -0,0 +1,87 @@\n+[role=\"xpack\"]\n+[testenv=\"platinum\"]\n+[[ml-estimate-model-memory]]\n+=== Estimate {anomaly-jobs} model memory API\n+++++\n+<titleabbrev>Estimate Model Memory</titleabbrev>\n+++++\n+\n+Estimates the model memory an {anomaly-job} is likely to need based on analysis\n+configuration details and cardinality estimates for the fields it references.\n+\n+[[ml-estimate-model-memory-request]]\n+==== {api-request-title}\n+\n+`POST _ml/anomaly_detectors/_estimate_model_memory`\n+\n+[[ml-estimate-model-memory-prereqs]]\n+==== {api-prereq-title}\n+\n+* If the {es} {security-features} are enabled, you must have `manage_ml` or\n+`manage` cluster privileges to use this API. See\n+<<security-privileges>>.\n+\n+[[ml-estimate-model-memory-request-body]]\n+==== {api-request-body-title}\n+\n+`analysis_config`::\n+(Required, object) For a list of the properties that you can specify in the\n+`analysis_config` component of the body of this API, see <<put-analysisconfig>>.\n+\n+`max_bucket_cardinality`::\n+(Optional, object) Estimates of the highest cardinality in a single bucket\n+that will be observed for influencer fields over the time period the job\n+analyzes data for. To produce a good answer values must be provided for\n+all influencer fields. It does not matter if values are provided for fields\n+that are not listed as `influencers`. If there are no `influencers` then\n+`max_bucket_cardinality` can be safely omitted from the request.\n+\n+`overall_cardinality`::\n+(Optional, object) Estimates of the cardinality that will be observed for\n+fields over the whole time period the job analyzes data for. To produce", "originalCommit": "0caf242c5313ad39ca053c8824642fb7151cdc5b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzI4NzUxNg==", "url": "https://github.com/elastic/elasticsearch/pull/53507#discussion_r397287516", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            a good answer values must be provided for fields referenced in the\n          \n          \n            \n            a good answer, values must be provided for fields referenced in the", "author": "lcawl", "createdAt": "2020-03-24T16:24:34Z", "path": "docs/reference/ml/anomaly-detection/apis/estimate-model-memory.asciidoc", "diffHunk": "@@ -0,0 +1,87 @@\n+[role=\"xpack\"]\n+[testenv=\"platinum\"]\n+[[ml-estimate-model-memory]]\n+=== Estimate {anomaly-jobs} model memory API\n+++++\n+<titleabbrev>Estimate Model Memory</titleabbrev>\n+++++\n+\n+Estimates the model memory an {anomaly-job} is likely to need based on analysis\n+configuration details and cardinality estimates for the fields it references.\n+\n+[[ml-estimate-model-memory-request]]\n+==== {api-request-title}\n+\n+`POST _ml/anomaly_detectors/_estimate_model_memory`\n+\n+[[ml-estimate-model-memory-prereqs]]\n+==== {api-prereq-title}\n+\n+* If the {es} {security-features} are enabled, you must have `manage_ml` or\n+`manage` cluster privileges to use this API. See\n+<<security-privileges>>.\n+\n+[[ml-estimate-model-memory-request-body]]\n+==== {api-request-body-title}\n+\n+`analysis_config`::\n+(Required, object) For a list of the properties that you can specify in the\n+`analysis_config` component of the body of this API, see <<put-analysisconfig>>.\n+\n+`max_bucket_cardinality`::\n+(Optional, object) Estimates of the highest cardinality in a single bucket\n+that will be observed for influencer fields over the time period the job\n+analyzes data for. To produce a good answer values must be provided for\n+all influencer fields. It does not matter if values are provided for fields\n+that are not listed as `influencers`. If there are no `influencers` then\n+`max_bucket_cardinality` can be safely omitted from the request.\n+\n+`overall_cardinality`::\n+(Optional, object) Estimates of the cardinality that will be observed for\n+fields over the whole time period the job analyzes data for. To produce\n+a good answer values must be provided for fields referenced in the", "originalCommit": "0caf242c5313ad39ca053c8824642fb7151cdc5b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzI4Nzg1NQ==", "url": "https://github.com/elastic/elasticsearch/pull/53507#discussion_r397287855", "bodyText": "Ditto previous suggestion around \"safely\"\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            `partition_field_name` then `overall_cardinality` can be safely omitted\n          \n          \n            \n            `partition_field_name` then `overall_cardinality` can be omitted", "author": "lcawl", "createdAt": "2020-03-24T16:25:00Z", "path": "docs/reference/ml/anomaly-detection/apis/estimate-model-memory.asciidoc", "diffHunk": "@@ -0,0 +1,87 @@\n+[role=\"xpack\"]\n+[testenv=\"platinum\"]\n+[[ml-estimate-model-memory]]\n+=== Estimate {anomaly-jobs} model memory API\n+++++\n+<titleabbrev>Estimate Model Memory</titleabbrev>\n+++++\n+\n+Estimates the model memory an {anomaly-job} is likely to need based on analysis\n+configuration details and cardinality estimates for the fields it references.\n+\n+[[ml-estimate-model-memory-request]]\n+==== {api-request-title}\n+\n+`POST _ml/anomaly_detectors/_estimate_model_memory`\n+\n+[[ml-estimate-model-memory-prereqs]]\n+==== {api-prereq-title}\n+\n+* If the {es} {security-features} are enabled, you must have `manage_ml` or\n+`manage` cluster privileges to use this API. See\n+<<security-privileges>>.\n+\n+[[ml-estimate-model-memory-request-body]]\n+==== {api-request-body-title}\n+\n+`analysis_config`::\n+(Required, object) For a list of the properties that you can specify in the\n+`analysis_config` component of the body of this API, see <<put-analysisconfig>>.\n+\n+`max_bucket_cardinality`::\n+(Optional, object) Estimates of the highest cardinality in a single bucket\n+that will be observed for influencer fields over the time period the job\n+analyzes data for. To produce a good answer values must be provided for\n+all influencer fields. It does not matter if values are provided for fields\n+that are not listed as `influencers`. If there are no `influencers` then\n+`max_bucket_cardinality` can be safely omitted from the request.\n+\n+`overall_cardinality`::\n+(Optional, object) Estimates of the cardinality that will be observed for\n+fields over the whole time period the job analyzes data for. To produce\n+a good answer values must be provided for fields referenced in the\n+`by_field_name`, `over_field_name` and `partition_field_name` of any\n+detectors. It does not matter if values are provided for other fields.\n+If no detectors have a `by_field_name`, `over_field_name` or\n+`partition_field_name` then `overall_cardinality` can be safely omitted", "originalCommit": "0caf242c5313ad39ca053c8824642fb7151cdc5b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzI4OTY4NQ==", "url": "https://github.com/elastic/elasticsearch/pull/53507#discussion_r397289685", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            === Estimate {anomaly-job} Model Memory API\n          \n          \n            \n            === Estimate {anomaly-job} model memory API", "author": "lcawl", "createdAt": "2020-03-24T16:27:17Z", "path": "docs/java-rest/high-level/ml/estimate-model-memory.asciidoc", "diffHunk": "@@ -0,0 +1,42 @@\n+--\n+:api: estimate-model-memory\n+:request: EstimateModelMemoryRequest\n+:response: EstimateModelMemoryResponse\n+--\n+[role=\"xpack\"]\n+[id=\"{upid}-{api}\"]\n+=== Estimate {anomaly-job} Model Memory API", "originalCommit": "0caf242c5313ad39ca053c8824642fb7151cdc5b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzI4OTkwMQ==", "url": "https://github.com/elastic/elasticsearch/pull/53507#discussion_r397289901", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            ==== Estimate {anomaly-job} Model Memory request\n          \n          \n            \n            ==== Estimate {anomaly-job} model memory request", "author": "lcawl", "createdAt": "2020-03-24T16:27:34Z", "path": "docs/java-rest/high-level/ml/estimate-model-memory.asciidoc", "diffHunk": "@@ -0,0 +1,42 @@\n+--\n+:api: estimate-model-memory\n+:request: EstimateModelMemoryRequest\n+:response: EstimateModelMemoryResponse\n+--\n+[role=\"xpack\"]\n+[id=\"{upid}-{api}\"]\n+=== Estimate {anomaly-job} Model Memory API\n+\n+Estimate the model memory an analysis config is likely to need for\n+the given cardinality of the fields it references.\n+\n+[id=\"{upid}-{api}-request\"]\n+==== Estimate {anomaly-job} Model Memory request", "originalCommit": "0caf242c5313ad39ca053c8824642fb7151cdc5b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzI5MDQwMw==", "url": "https://github.com/elastic/elasticsearch/pull/53507#discussion_r397290403", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                `Detector`s, supply overall cardinality estimates\n          \n          \n            \n                detectors, supply overall cardinality estimates", "author": "lcawl", "createdAt": "2020-03-24T16:28:15Z", "path": "docs/java-rest/high-level/ml/estimate-model-memory.asciidoc", "diffHunk": "@@ -0,0 +1,42 @@\n+--\n+:api: estimate-model-memory\n+:request: EstimateModelMemoryRequest\n+:response: EstimateModelMemoryResponse\n+--\n+[role=\"xpack\"]\n+[id=\"{upid}-{api}\"]\n+=== Estimate {anomaly-job} Model Memory API\n+\n+Estimate the model memory an analysis config is likely to need for\n+the given cardinality of the fields it references.\n+\n+[id=\"{upid}-{api}-request\"]\n+==== Estimate {anomaly-job} Model Memory request\n+\n+A +{request}+ can be set up as follows:\n+\n+[\"source\",\"java\",subs=\"attributes,callouts,macros\"]\n+--------------------------------------------------\n+include-tagged::{doc-tests-file}[{api}-request]\n+--------------------------------------------------\n+<1> Pass an `AnalysisConfig` to the constructor.\n+<2> For any `by_field_name`, `over_field_name` or\n+    `partition_field_name` fields referenced by the\n+    `Detector`s, supply overall cardinality estimates", "originalCommit": "0caf242c5313ad39ca053c8824642fb7151cdc5b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzI5MjQ1OA==", "url": "https://github.com/elastic/elasticsearch/pull/53507#discussion_r397292458", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            ==== Estimate {anomaly-job} Model Memory response\n          \n          \n            \n            ==== Estimate {anomaly-job} model memory response", "author": "lcawl", "createdAt": "2020-03-24T16:30:54Z", "path": "docs/java-rest/high-level/ml/estimate-model-memory.asciidoc", "diffHunk": "@@ -0,0 +1,42 @@\n+--\n+:api: estimate-model-memory\n+:request: EstimateModelMemoryRequest\n+:response: EstimateModelMemoryResponse\n+--\n+[role=\"xpack\"]\n+[id=\"{upid}-{api}\"]\n+=== Estimate {anomaly-job} Model Memory API\n+\n+Estimate the model memory an analysis config is likely to need for\n+the given cardinality of the fields it references.\n+\n+[id=\"{upid}-{api}-request\"]\n+==== Estimate {anomaly-job} Model Memory request\n+\n+A +{request}+ can be set up as follows:\n+\n+[\"source\",\"java\",subs=\"attributes,callouts,macros\"]\n+--------------------------------------------------\n+include-tagged::{doc-tests-file}[{api}-request]\n+--------------------------------------------------\n+<1> Pass an `AnalysisConfig` to the constructor.\n+<2> For any `by_field_name`, `over_field_name` or\n+    `partition_field_name` fields referenced by the\n+    `Detector`s, supply overall cardinality estimates\n+    in a `Map`.\n+<3> For any `influencers`, supply a `Map` containing\n+    estimates of the highest cardinality expected in\n+    any single bucket.\n+\n+include::../execution.asciidoc[]\n+\n+[id=\"{upid}-{api}-response\"]\n+==== Estimate {anomaly-job} Model Memory response", "originalCommit": "0caf242c5313ad39ca053c8824642fb7151cdc5b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "95dede2d050ea49f2c50459878467e892f1acae3", "url": "https://github.com/elastic/elasticsearch/commit/95dede2d050ea49f2c50459878467e892f1acae3", "message": "Apply docs suggestions from code review\n\nCo-Authored-By: Lisa Cawley <lcawley@elastic.co>", "committedDate": "2020-03-24T16:39:10Z", "type": "commit"}, {"oid": "d51c6f4cdf232a9ebbea831e35795e44035ac119", "url": "https://github.com/elastic/elasticsearch/commit/d51c6f4cdf232a9ebbea831e35795e44035ac119", "message": "A few refinements", "committedDate": "2020-03-24T19:23:52Z", "type": "commit"}, {"oid": "2896f290a01153ffd1f3118020366c90903154db", "url": "https://github.com/elastic/elasticsearch/commit/2896f290a01153ffd1f3118020366c90903154db", "message": "Merge branch 'master' into hlrc_for_estimate_model_memory", "committedDate": "2020-03-24T20:33:18Z", "type": "commit"}]}