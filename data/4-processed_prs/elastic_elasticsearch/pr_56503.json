{"pr_number": 56503, "pr_title": "Push arch-specific logic from Gradle into Docker", "pr_createdAt": "2020-05-11T10:58:39Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/56503", "timeline": [{"oid": "758df1d4eeff113a3e83558ad6deb5e3caf42ea6", "url": "https://github.com/elastic/elasticsearch/commit/758df1d4eeff113a3e83558ad6deb5e3caf42ea6", "message": "Push arch-specific logic from Gradle into Docker\n\nDocker informed us that for official multi-arch Docker builds, there\nneeds to be a single Dockerfile and build context that can be used for\neach supported architecture. Therefore, rework the build to move the\nrelevant architecture logic into the Dockerfile, and merge the aarch64\n/ x64 docker context builds.", "committedDate": "2020-05-11T10:53:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI3NDQyNw==", "url": "https://github.com/elastic/elasticsearch/pull/56503#discussion_r423274427", "bodyText": "Because this is in a code block, this is not included in the final published file, right?", "author": "mark-vieira", "createdAt": "2020-05-11T19:40:32Z", "path": "distribution/docker/src/docker/Dockerfile", "diffHunk": "@@ -3,45 +3,53 @@\n #\n # Beginning of multi stage Dockerfile\n ################################################################################\n+<% /*", "originalCommit": "758df1d4eeff113a3e83558ad6deb5e3caf42ea6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI3NzM5OA==", "url": "https://github.com/elastic/elasticsearch/pull/56503#discussion_r423277398", "bodyText": "Exactly. I also escaped all the backslashes in the file, so that the final rendered Dockerfile is much improved.", "author": "pugnascotia", "createdAt": "2020-05-11T19:46:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI3NDQyNw=="}], "type": "inlineReview"}, {"oid": "87df12069067b6dcd59fcba3262ddaaff8ff20ad", "url": "https://github.com/elastic/elasticsearch/commit/87df12069067b6dcd59fcba3262ddaaff8ff20ad", "message": "Merge branch 'master' into consolidate-docker-contexts", "committedDate": "2020-05-11T20:14:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzQ0MTY4Mw==", "url": "https://github.com/elastic/elasticsearch/pull/56503#discussion_r423441683", "bodyText": "Nice touch. \ud83d\ude42", "author": "jasontedor", "createdAt": "2020-05-12T03:33:50Z", "path": "distribution/docker/src/docker/Dockerfile", "diffHunk": "@@ -81,32 +89,32 @@ ENV PATH /usr/share/elasticsearch/bin:\\$PATH\n \n COPY bin/docker-entrypoint.sh /usr/local/bin/docker-entrypoint.sh\n \n-RUN chmod g=u /etc/passwd && \\\n+RUN chmod g=u /etc/passwd && \\\\\n     chmod 0775 /usr/local/bin/docker-entrypoint.sh\n \n # Ensure that there are no files with setuid or setgid, in order to mitigate \"stackclash\" attacks.\n RUN find / -xdev -perm -4000 -exec chmod ug-s {} +\n \n EXPOSE 9200 9300\n \n-LABEL org.label-schema.build-date=\"${build_date}\" \\\n-  org.label-schema.license=\"${license}\" \\\n-  org.label-schema.name=\"Elasticsearch\" \\\n-  org.label-schema.schema-version=\"1.0\" \\\n-  org.label-schema.url=\"https://www.elastic.co/products/elasticsearch\" \\\n-  org.label-schema.usage=\"https://www.elastic.co/guide/en/elasticsearch/reference/index.html\" \\\n-  org.label-schema.vcs-ref=\"${git_revision}\" \\\n-  org.label-schema.vcs-url=\"https://github.com/elastic/elasticsearch\" \\\n-  org.label-schema.vendor=\"Elastic\" \\\n-  org.label-schema.version=\"${version}\" \\\n-  org.opencontainers.image.created=\"${build_date}\" \\\n-  org.opencontainers.image.documentation=\"https://www.elastic.co/guide/en/elasticsearch/reference/index.html\" \\\n-  org.opencontainers.image.licenses=\"${license}\" \\\n-  org.opencontainers.image.revision=\"${git_revision}\" \\\n-  org.opencontainers.image.source=\"https://github.com/elastic/elasticsearch\" \\\n-  org.opencontainers.image.title=\"Elasticsearch\" \\\n-  org.opencontainers.image.url=\"https://www.elastic.co/products/elasticsearch\" \\\n-  org.opencontainers.image.vendor=\"Elastic\" \\\n+LABEL org.label-schema.build-date=\"${build_date}\" \\\\\n+  org.label-schema.license=\"${license}\" \\\\\n+  org.label-schema.name=\"Elasticsearch\" \\\\\n+  org.label-schema.schema-version=\"1.0\" \\\\\n+  org.label-schema.url=\"https://www.elastic.co/products/elasticsearch\" \\\\\n+  org.label-schema.usage=\"https://www.elastic.co/guide/en/elasticsearch/reference/index.html\" \\\\\n+  org.label-schema.vcs-ref=\"${git_revision}\" \\\\\n+  org.label-schema.vcs-url=\"https://github.com/elastic/elasticsearch\" \\\\\n+  org.label-schema.vendor=\"Elastic\" \\\\\n+  org.label-schema.version=\"${version}\" \\\\\n+  org.opencontainers.image.created=\"${build_date}\" \\\\\n+  org.opencontainers.image.documentation=\"https://www.elastic.co/guide/en/elasticsearch/reference/index.html\" \\\\\n+  org.opencontainers.image.licenses=\"${license}\" \\\\\n+  org.opencontainers.image.revision=\"${git_revision}\" \\\\\n+  org.opencontainers.image.source=\"https://github.com/elastic/elasticsearch\" \\\\\n+  org.opencontainers.image.title=\"Elasticsearch\" \\\\\n+  org.opencontainers.image.url=\"https://www.elastic.co/products/elasticsearch\" \\\\\n+  org.opencontainers.image.vendor=\"Elastic\" \\\\", "originalCommit": "87df12069067b6dcd59fcba3262ddaaff8ff20ad", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}