{"pr_number": 53187, "pr_title": "EQL: Improve query folder test suite", "pr_createdAt": "2020-03-05T20:24:42Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/53187", "timeline": [{"oid": "332ddfb6784eb9cbda80fdb8b9d06a12f0b72f08", "url": "https://github.com/elastic/elasticsearch/commit/332ddfb6784eb9cbda80fdb8b9d06a12f0b72f08", "message": "EQL: Improve query folder test suite", "committedDate": "2020-03-05T20:21:55Z", "type": "commit"}, {"oid": "110c51f85e9f99926cdce06d69b617b2ed839ed5", "url": "https://github.com/elastic/elasticsearch/commit/110c51f85e9f99926cdce06d69b617b2ed839ed5", "message": "Refactor tests, change to substring match asserts per today's conversation", "committedDate": "2020-03-11T02:22:33Z", "type": "commit"}, {"oid": "9f291acdfe2f00a67376852ac19bacc0ea054f23", "url": "https://github.com/elastic/elasticsearch/commit/9f291acdfe2f00a67376852ac19bacc0ea054f23", "message": "Remove a couple of extra empty lines", "committedDate": "2020-03-11T02:26:49Z", "type": "commit"}, {"oid": "9f291acdfe2f00a67376852ac19bacc0ea054f23", "url": "https://github.com/elastic/elasticsearch/commit/9f291acdfe2f00a67376852ac19bacc0ea054f23", "message": "Remove a couple of extra empty lines", "committedDate": "2020-03-11T02:26:49Z", "type": "forcePushed"}, {"oid": "4c881465e33ed6b86c45b5724d37db5d9276b950", "url": "https://github.com/elastic/elasticsearch/commit/4c881465e33ed6b86c45b5724d37db5d9276b950", "message": "Merge branch 'master' into issue/52775_query_folder_tests", "committedDate": "2020-03-11T11:35:52Z", "type": "commit"}, {"oid": "15bf74820cb1bb39541935c68d9661066812d467", "url": "https://github.com/elastic/elasticsearch/commit/15bf74820cb1bb39541935c68d9661066812d467", "message": "Update QueryFolderOkTests for the latest master changes", "committedDate": "2020-03-11T16:00:10Z", "type": "commit"}, {"oid": "7c5c6af7bd130565bf2b51e9c231792f2b436288", "url": "https://github.com/elastic/elasticsearch/commit/7c5c6af7bd130565bf2b51e9c231792f2b436288", "message": "Merge branch 'master' into issue/52775_query_folder_tests", "committedDate": "2020-03-11T17:11:31Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTI4NDkyMg==", "url": "https://github.com/elastic/elasticsearch/pull/53187#discussion_r391284922", "bodyText": "This error message is confusing to the end user: there is no equality comparison in the query... I'm not saying the test is incorrect, but the way we report the error in the context of EQL is slightly incorrect.", "author": "astefan", "createdAt": "2020-03-11T21:42:20Z", "path": "x-pack/plugin/eql/src/test/java/org/elasticsearch/xpack/eql/planner/QueryFolderFailTests.java", "diffHunk": "@@ -0,0 +1,25 @@\n+/*\n+ * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n+ * or more contributor license agreements. Licensed under the Elastic License;\n+ * you may not use this file except in compliance with the Elastic License.\n+ */\n+\n+package org.elasticsearch.xpack.eql.planner;\n+\n+import org.elasticsearch.xpack.ql.QlIllegalArgumentException;\n+\n+public class QueryFolderFailTests extends AbstractQueryFolderTestCase {\n+    public void testPropertyEquationFilterUnsupported() {\n+        QlIllegalArgumentException e = expectThrows(QlIllegalArgumentException.class,\n+                () -> plan(\"process where (serial_event_id<9 and serial_event_id >= 7) or (opcode == pid)\"));\n+        String msg = e.getMessage();\n+        assertEquals(\"Line 1:74: Comparisons against variables are not (currently) supported; offender [pid] in [==]\", msg);\n+    }\n+\n+    public void testPropertyEquationInClauseFilterUnsupported() {\n+        QlIllegalArgumentException e = expectThrows(QlIllegalArgumentException.class,\n+                () -> plan(\"process where opcode in (1,3) and process_name in (parent_process_name, \\\"SYSTEM\\\")\"));\n+        String msg = e.getMessage();\n+        assertEquals(\"Line 1:52: Comparisons against variables are not (currently) supported; offender [parent_process_name] in [==]\", msg);", "originalCommit": "7c5c6af7bd130565bf2b51e9c231792f2b436288", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTM3MTYyOQ==", "url": "https://github.com/elastic/elasticsearch/pull/53187#discussion_r391371629", "bodyText": "Agreed. @costin thoughts?", "author": "aleksmaus", "createdAt": "2020-03-12T02:34:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTI4NDkyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTUyODY3MQ==", "url": "https://github.com/elastic/elasticsearch/pull/53187#discussion_r391528671", "bodyText": "I agree - to improve the message one could either look and check whether it's the first comparison (which might not work if any is added) or check whether the comparison is added against the event_type field and if so, mention that in the error message (e.g. offender eventy.category`).", "author": "costin", "createdAt": "2020-03-12T10:30:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTI4NDkyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTU4OTU2Mg==", "url": "https://github.com/elastic/elasticsearch/pull/53187#discussion_r391589562", "bodyText": "Will open a separate issue for the error message per conversation with Costin.", "author": "aleksmaus", "createdAt": "2020-03-12T12:34:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTI4NDkyMg=="}], "type": "inlineReview"}]}