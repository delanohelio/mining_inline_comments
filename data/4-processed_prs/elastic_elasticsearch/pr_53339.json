{"pr_number": 53339, "pr_title": "[DOCS] Add token graph concept docs", "pr_createdAt": "2020-03-10T13:54:57Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/53339", "timeline": [{"oid": "7e3b0186990b3b560bb5f17dc1a4697da2c12784", "url": "https://github.com/elastic/elasticsearch/commit/7e3b0186990b3b560bb5f17dc1a4697da2c12784", "message": "[DOCS] Add token graph concept docs\n\nAdds conceptual docs for token graphs.\nThese docs cover:\n\n* How a token graph is constructed from a token stream\n* How synonyms and multi-position tokens impact token graphs\n* How token graphs are used during search\n* Why some token filters produce invalid token graphs\n\nAlso makes the following supporting changes:\n* Adds anchors to the 'Anatomy of an Analyzer' docs for cross-linking\n* Adds several SVGs for token graph diagrams", "committedDate": "2020-03-10T13:42:49Z", "type": "commit"}, {"oid": "072dc1b9b4c90ad0e7487fe47bfd6c28d4a6884b", "url": "https://github.com/elastic/elasticsearch/commit/072dc1b9b4c90ad0e7487fe47bfd6c28d4a6884b", "message": "Add anchor to concepts", "committedDate": "2020-03-11T14:03:42Z", "type": "commit"}, {"oid": "5ebc210ce6167a53cfc52d2b0bd9dd336cc29e61", "url": "https://github.com/elastic/elasticsearch/commit/5ebc210ce6167a53cfc52d2b0bd9dd336cc29e61", "message": "reword", "committedDate": "2020-03-16T13:24:00Z", "type": "commit"}, {"oid": "f93876c5cbce9293f6ae8aa13f82fcd7d2a254f5", "url": "https://github.com/elastic/elasticsearch/commit/f93876c5cbce9293f6ae8aa13f82fcd7d2a254f5", "message": "Clarify positionLength recording", "committedDate": "2020-03-17T20:34:33Z", "type": "commit"}, {"oid": "88d2d673b7799b991289c3c279b31765cd460d67", "url": "https://github.com/elastic/elasticsearch/commit/88d2d673b7799b991289c3c279b31765cd460d67", "message": "reword", "committedDate": "2020-03-17T20:45:10Z", "type": "commit"}, {"oid": "3d16784f14b5f2f8638a131cd55335df63a601da", "url": "https://github.com/elastic/elasticsearch/commit/3d16784f14b5f2f8638a131cd55335df63a601da", "message": "fix typo", "committedDate": "2020-03-17T20:47:47Z", "type": "commit"}, {"oid": "d71c10347a5e34733637da28affda69156b6be8d", "url": "https://github.com/elastic/elasticsearch/commit/d71c10347a5e34733637da28affda69156b6be8d", "message": "reorder", "committedDate": "2020-03-17T20:50:51Z", "type": "commit"}, {"oid": "6ed82089086ccd9e8d16f2f86608f3deb35a86bd", "url": "https://github.com/elastic/elasticsearch/commit/6ed82089086ccd9e8d16f2f86608f3deb35a86bd", "message": "iter", "committedDate": "2020-03-17T20:52:39Z", "type": "commit"}, {"oid": "c88b9e818552b0124597ca89869b9d4bcdad0ced", "url": "https://github.com/elastic/elasticsearch/commit/c88b9e818552b0124597ca89869b9d4bcdad0ced", "message": "multi-word synonyms", "committedDate": "2020-03-18T20:36:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDYzMjU1OQ==", "url": "https://github.com/elastic/elasticsearch/pull/53339#discussion_r394632559", "bodyText": "match queries are also affected. The input ny city with a ny, new york expansion creates an incorrect (ny OR new) AND york AND city query with the synonym filter.", "author": "jimczi", "createdAt": "2020-03-18T20:52:39Z", "path": "docs/reference/analysis/token-graphs.asciidoc", "diffHunk": "@@ -0,0 +1,104 @@\n+[[token-graphs]]\n+=== Token graphs\n+\n+When a <<analyzer-anatomy-tokenizer,tokenizer>> converts a text into a stream of\n+tokens, it also records the following:\n+\n+* The `position` of each token in the stream\n+* The `positionLength`, the number of positions that a token spans\n+\n+Using these, you can create a\n+https://en.wikipedia.org/wiki/Directed_acyclic_graph[directed acyclic graph],\n+called a _token graph_, for a stream. In a token graph, each position represents\n+a node. Each token represents an edge or arc, pointing to the next position.\n+\n+image::images/analysis/token-graph-qbf-ex.svg[align=\"center\"]\n+\n+[[token-graphs-synonyms]]\n+==== Synonyms\n+\n+Some <<analyzer-anatomy-token-filters,token filters>> can add new tokens, like\n+synonyms, to an existing token stream. These synonyms often span the same\n+positions as existing tokens.\n+\n+In the following graph, `quick` and its synonym `fast` both have a position of\n+`0`. They span the same positions.\n+\n+image::images/analysis/token-graph-qbf-synonym-ex.svg[align=\"center\"]\n+\n+[[token-graphs-multi-position-tokens]]\n+==== Multi-position tokens\n+\n+Some token filters can add tokens that span multiple positions. These can\n+include tokens for multi-word synonyms, such as using \"atm\" as a synonym for\n+\"automatic teller machine.\"\n+\n+However, only some token filters, known as _graph token filters_, accurately\n+record the `positionLength` for multi-position tokens. This filters include:\n+\n+* <<analysis-synonym-graph-tokenfilter,`synonym_graph`>>\n+* <<analysis-word-delimiter-graph-tokenfilter,`word_delimiter_graph`>>\n+\n+In the following graph, `domain name system` and its synonym, `dns`, both have a\n+position of `0`. However, `dns` has a `positionLength` of `3`. Other tokens in\n+the graph have a default `positionLength` of `1`.\n+\n+image::images/analysis/token-graph-dns-synonym-ex.svg[align=\"center\"]\n+\n+[[token-graphs-token-graphs-search]]\n+===== Using token graphs for search \n+\n+<<analysis-index-search-time,Indexing>> ignores the `positionLength` attribute\n+and does not support token graphs containing multi-position tokens.\n+\n+However, queries, such as the <<query-dsl-match-query-phrase,`match_phrase`>>", "originalCommit": "c88b9e818552b0124597ca89869b9d4bcdad0ced", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDk1NzQwMg==", "url": "https://github.com/elastic/elasticsearch/pull/53339#discussion_r394957402", "bodyText": "I updated this with d4a711d to mention the match query.", "author": "jrodewig", "createdAt": "2020-03-19T11:25:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDYzMjU1OQ=="}], "type": "inlineReview"}, {"oid": "d4a711d615445d5bba48815a0575b1a4410fd87c", "url": "https://github.com/elastic/elasticsearch/commit/d4a711d615445d5bba48815a0575b1a4410fd87c", "message": "Add `match` query mention", "committedDate": "2020-03-19T11:23:55Z", "type": "commit"}, {"oid": "d2cad8487f1b1d2a7c7bd93d89f960f646b97509", "url": "https://github.com/elastic/elasticsearch/commit/d2cad8487f1b1d2a7c7bd93d89f960f646b97509", "message": "Add cross-links", "committedDate": "2020-03-19T11:27:43Z", "type": "commit"}]}