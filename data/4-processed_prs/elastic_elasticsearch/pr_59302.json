{"pr_number": 59302, "pr_title": "Default gateway.auto_import_dangling_indices to false", "pr_createdAt": "2020-07-09T13:33:13Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/59302", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzcyNjY1OQ==", "url": "https://github.com/elastic/elasticsearch/pull/59302#discussion_r453726659", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Dangling indices::\n          \n          \n            \n            * A new <<dangling-indices-api,Dangling indices API>> is now available. You\n          \n          \n            \n              can use it to list, import or delete\n          \n          \n            \n              <<dangling-indices,dangling indices>>. Because of this, automatically\n          \n          \n            \n              importing dangling indices is now disabled by default. There are several\n          \n          \n            \n              issues with this behavior, and you should use the dedicated API instead.\n          \n          \n            \n              If you need to re-enable auto-imports, set\n          \n          \n            \n              `gateway.auto_import_dangling_indices` to `true`.  Auto-imports are now\n          \n          \n            \n              deprecated and will be removed in 8.0 {es-pull}58176[#58176] {es-pull}58898[#58898] (issue: {es-issue}48366[#48366])\n          \n          \n            \n            Dangling indices::\n          \n          \n            \n            * A new <<dangling-indices-api,Dangling indices API>> is now available, which you\n          \n          \n            \n              can use to list, import, or delete\n          \n          \n            \n              <<dangling-indices,dangling indices>>. Because importing dangling indices\n          \n          \n            \n              into the cluster using `gateway.auto_import_dangling_indices` is unsafe, use the dedicated API instead.\n          \n          \n            \n              \n          \n          \n            \n              Automatically importing dangling indices is now deprecated, disabled by default, and will be removed in (es) 8.0. If you need to re-enable auto-imports, set\n          \n          \n            \n              `gateway.auto_import_dangling_indices` to `true`\n          \n          \n            \n               {es-pull}58176[#58176] {es-pull}58898[#58898] (issue: {es-issue}48366[#48366])", "author": "lockewritesdocs", "createdAt": "2020-07-13T15:17:48Z", "path": "docs/reference/release-notes/7.9.asciidoc", "diffHunk": "@@ -22,3 +22,13 @@ Snapshot restore throttling::\n   default that's used for `indices.recovery.max_bytes_per_sec`. This means\n   that no behavioral change will be observed by clusters where the recovery\n   and restore settings had not been adapted from the defaults. {es-pull}58658[#58658]\n+\n+Dangling indices::\n+* A new <<dangling-indices-api,Dangling indices API>> is now available. You\n+  can use it to list, import or delete\n+  <<dangling-indices,dangling indices>>. Because of this, automatically\n+  importing dangling indices is now disabled by default. There are several\n+  issues with this behavior, and you should use the dedicated API instead.\n+  If you need to re-enable auto-imports, set\n+  `gateway.auto_import_dangling_indices` to `true`.  Auto-imports are now\n+  deprecated and will be removed in 8.0 {es-pull}58176[#58176] {es-pull}58898[#58898] (issue: {es-issue}48366[#48366])", "originalCommit": "7a2769412bc9415de64ccc8552fdbc001c165c7a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzczNDA0Nw==", "url": "https://github.com/elastic/elasticsearch/pull/59302#discussion_r453734047", "bodyText": "Because of this, automatically\nimporting dangling indices is now disabled by default.\n\nI think that we should clarify this language to explain what \"this\" is. I reused some of the language from 58751, which emphasizes that using gateway.auto_import_dangling_indices is unsafe. Please let me know if I misconstrued the original meaning of this explanation.", "author": "lockewritesdocs", "createdAt": "2020-07-13T15:27:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzcyNjY1OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDIwNjE2Mw==", "url": "https://github.com/elastic/elasticsearch/pull/59302#discussion_r454206163", "bodyText": "Suggest this, since deprecating something isn't itself a breaking change:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            .Automatically importing dangling indices is deprecated.\n          \n          \n            \n            .Automatically importing dangling indices is disabled by default.", "author": "DaveCTurner", "createdAt": "2020-07-14T08:54:21Z", "path": "docs/reference/migration/migrate_7_9.asciidoc", "diffHunk": "@@ -67,5 +68,28 @@ setting. You may use `script.context.$CONTEXT.max_compilations_rate` for the par\n context.  For example, for the `processor_conditional` context, use\n `script.context.processor_conditional.max_compilations_rate`.\n \n+====\n+\n+[discrete]\n+[[breaking_79_settings_changes]]\n+=== Settings changes\n+\n+[[deprecate_auto_import_dangling_indices]]\n+.Automatically importing dangling indices is deprecated.", "originalCommit": "c4f08d18f8b6d5d7065c24a7cb95fc5f7177775d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDIxNzkwNg==", "url": "https://github.com/elastic/elasticsearch/pull/59302#discussion_r454217906", "bodyText": "I think it'd help to move some things around here: IMO the Details section describes the change and the Impact tells the user what to do about it. How about this:\ndiff --git a/docs/reference/migration/migrate_7_9.asciidoc b/docs/reference/migration/migrate_7_9.asciidoc\nindex e60c4f3588d..acfd11fc38b 100644\n--- a/docs/reference/migration/migrate_7_9.asciidoc\n+++ b/docs/reference/migration/migrate_7_9.asciidoc\n@@ -80,16 +80,18 @@ context.  For example, for the `processor_conditional` context, use\n [%collapsible]\n ====\n *Details* +\n-<<dangling-indices,Dangling indices>> will no longer be imported\n-automatically by default. A new\n-<<dangling-indices-api,Dangling indices API>> is now available, which you\n-can use to list, import, or delete. Because importing dangling indices\n-automatically into the cluster is unsafe, use the dedicated API instead.\n+Automatically importing <<dangling-indices,dangling indices>> into the cluster\n+is unsafe and is now disabled by default. This feature will be removed entirely\n+in {es} 8.0.0.\n\n *Impact* +\n-Automatically importing dangling indices is now deprecated, disabled by\n-default, and will be removed in (es) 8.0. If you need to re-enable\n-auto-imports, set `gateway.auto_import_dangling_indices` to `true`.\n+Use the <<dangling-indices-api,Dangling indices API>> to list, delete or import\n+any dangling indices manually.\n++\n+Alternatively you can enable automatic imports of dangling indices, recovering\n+the unsafe behaviour of earlier versions, by setting\n+`gateway.auto_import_dangling_indices` to `true`. This setting is deprecated\n+and will be removed in {es} 8.0.0. We do not recommend using this setting.\n\n ====\n //end::notable-breaking-changes[]", "author": "DaveCTurner", "createdAt": "2020-07-14T09:14:30Z", "path": "docs/reference/migration/migrate_7_9.asciidoc", "diffHunk": "@@ -67,5 +68,28 @@ setting. You may use `script.context.$CONTEXT.max_compilations_rate` for the par\n context.  For example, for the `processor_conditional` context, use\n `script.context.processor_conditional.max_compilations_rate`.\n \n+====\n+\n+[discrete]\n+[[breaking_79_settings_changes]]\n+=== Settings changes\n+\n+[[deprecate_auto_import_dangling_indices]]\n+.Automatically importing dangling indices is deprecated.\n+\n+[%collapsible]\n+====\n+*Details* +\n+<<dangling-indices,Dangling indices>> will no longer be imported", "originalCommit": "c4f08d18f8b6d5d7065c24a7cb95fc5f7177775d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDIxODEwMQ==", "url": "https://github.com/elastic/elasticsearch/pull/59302#discussion_r454218101", "bodyText": "I think you meant this:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              default, and will be removed in (es) 8.0. See the\n          \n          \n            \n              default, and will be removed in {es} 8.0. See the", "author": "DaveCTurner", "createdAt": "2020-07-14T09:14:49Z", "path": "docs/reference/release-notes/7.9.asciidoc", "diffHunk": "@@ -22,3 +22,9 @@ Snapshot restore throttling::\n   default that's used for `indices.recovery.max_bytes_per_sec`. This means\n   that no behavioral change will be observed by clusters where the recovery\n   and restore settings had not been adapted from the defaults. {es-pull}58658[#58658]\n+\n+Dangling indices::\n+* Automatically importing dangling indices is now deprecated, disabled by\n+  default, and will be removed in (es) 8.0. See the", "originalCommit": "c4f08d18f8b6d5d7065c24a7cb95fc5f7177775d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "af7a176af26f29582b5fa19eb0fbf5cde7a7bfec", "url": "https://github.com/elastic/elasticsearch/commit/af7a176af26f29582b5fa19eb0fbf5cde7a7bfec", "message": "Apply further suggestions", "committedDate": "2020-07-15T14:33:37Z", "type": "forcePushed"}, {"oid": "71e6b48ca417bd746aa3262c4aa9fbd509691a95", "url": "https://github.com/elastic/elasticsearch/commit/71e6b48ca417bd746aa3262c4aa9fbd509691a95", "message": "Default gateway.auto_import_dangling_indices to false (#58898)\n\nPart of #48366. Now that there is a dedicated API for dangling indices,\r\nthe auto-import behaviour can default to off.", "committedDate": "2020-07-15T14:44:11Z", "type": "commit"}, {"oid": "144d92a0a699e4f291a18d61314b3c9d1c134f21", "url": "https://github.com/elastic/elasticsearch/commit/144d92a0a699e4f291a18d61314b3c9d1c134f21", "message": "Add a breaking change note about dangling indices", "committedDate": "2020-07-15T14:44:11Z", "type": "commit"}, {"oid": "7f1b2df4e98fbeb3e0717d0a9463d215a6384189", "url": "https://github.com/elastic/elasticsearch/commit/7f1b2df4e98fbeb3e0717d0a9463d215a6384189", "message": "Update docs/reference/release-notes/7.9.asciidoc\n\nCo-authored-by: Adam Locke <adam.locke@elastic.co>", "committedDate": "2020-07-15T14:44:11Z", "type": "commit"}, {"oid": "df82c0cb00cf4357f27668a8d86413f04128298a", "url": "https://github.com/elastic/elasticsearch/commit/df82c0cb00cf4357f27668a8d86413f04128298a", "message": "Update 7.9 migration notes\n\nMove most of the breaking changes regarding dangling indices in the 7.9\nrelease notes to the 7.9 migration doc. Abbreviate the release ntoes\ncontent and point to the migration notes instead.", "committedDate": "2020-07-15T14:44:11Z", "type": "commit"}, {"oid": "f2185d9b11fa054c3761d77d61908fd603024885", "url": "https://github.com/elastic/elasticsearch/commit/f2185d9b11fa054c3761d77d61908fd603024885", "message": "Apply further suggestions", "committedDate": "2020-07-15T14:44:11Z", "type": "commit"}, {"oid": "6eb2c5f7aeb9b4f1a68fee39ae30ad5dc65890db", "url": "https://github.com/elastic/elasticsearch/commit/6eb2c5f7aeb9b4f1a68fee39ae30ad5dc65890db", "message": "fix typo", "committedDate": "2020-07-15T14:48:23Z", "type": "commit"}, {"oid": "6eb2c5f7aeb9b4f1a68fee39ae30ad5dc65890db", "url": "https://github.com/elastic/elasticsearch/commit/6eb2c5f7aeb9b4f1a68fee39ae30ad5dc65890db", "message": "fix typo", "committedDate": "2020-07-15T14:48:23Z", "type": "forcePushed"}]}