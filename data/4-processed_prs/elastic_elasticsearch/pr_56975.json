{"pr_number": 56975, "pr_title": "Move license checks back to BuildPlugin", "pr_createdAt": "2020-05-20T00:11:20Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/56975", "timeline": [{"oid": "235e3e818d6ddb1ddf3e46fad8db71abb7b53307", "url": "https://github.com/elastic/elasticsearch/commit/235e3e818d6ddb1ddf3e46fad8db71abb7b53307", "message": "Allow ElasticsearchJavaPlugin for non-jar based projects\n\nSome standalone projects such as :distribution:archives:integ-test-zip have tests\nbut are not intended to ever create a jar. Applying the new ElasticsearchJavaPlugin\nin favor over the elder \"Standalone*Plugin\" or BuildPlugin can result in these non-jar\nprojects erroring due to the lack of the license or notice file.\n\nTo avoid creating more permutations of ElasticsearchJavaPlugin\n(i.e. ElasticsearchJavaPluginWithoutJar), the conuming project should be able disable\nthe jar task (e.g. `jar.enabled = false`) and the license checks should be skipped as\nwell as the javadoc and sources jars.\n\nrelated: #56841", "committedDate": "2020-05-20T00:00:59Z", "type": "commit"}, {"oid": "b1f5a23608b481e78290afed93dcafd04d77d8f0", "url": "https://github.com/elastic/elasticsearch/commit/b1f5a23608b481e78290afed93dcafd04d77d8f0", "message": "remove unecessary enabled check", "committedDate": "2020-05-20T00:13:52Z", "type": "commit"}, {"oid": "fa86e2437a88465c759b51596a7f887ebd14f69f", "url": "https://github.com/elastic/elasticsearch/commit/fa86e2437a88465c759b51596a7f887ebd14f69f", "message": "Revert \"remove unecessary enabled check\"\n\nThis reverts commit b1f5a23608b481e78290afed93dcafd04d77d8f0.", "committedDate": "2020-05-21T14:00:55Z", "type": "commit"}, {"oid": "2e38b55350e69141d8c659572a59c30c099cd32a", "url": "https://github.com/elastic/elasticsearch/commit/2e38b55350e69141d8c659572a59c30c099cd32a", "message": "Revert \"Allow ElasticsearchJavaPlugin for non-jar based projects\"\n\nThis reverts commit 235e3e818d6ddb1ddf3e46fad8db71abb7b53307.", "committedDate": "2020-05-21T14:01:06Z", "type": "commit"}, {"oid": "8cff148487f19d191a64902f824457be274d95c2", "url": "https://github.com/elastic/elasticsearch/commit/8cff148487f19d191a64902f824457be274d95c2", "message": "Merge remote-tracking branch 'upstream/master' into allow_disable_jar", "committedDate": "2020-05-21T14:02:11Z", "type": "commit"}, {"oid": "845a2a8b7c4eee1f6c4ae6b0ae0e081242c7d9ae", "url": "https://github.com/elastic/elasticsearch/commit/845a2a8b7c4eee1f6c4ae6b0ae0e081242c7d9ae", "message": "remove license check from ElasticsearchJavaPlugin", "committedDate": "2020-05-21T14:03:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODc4NjY4OQ==", "url": "https://github.com/elastic/elasticsearch/pull/56975#discussion_r428786689", "bodyText": "We shouldn't be calling these methods statically; that is what we are trying to move away from. Can you please move the notice/license configuration to a new method in BuildPlugin, and leave the other stuff intact?", "author": "rjernst", "createdAt": "2020-05-21T17:01:19Z", "path": "buildSrc/src/main/groovy/org/elasticsearch/gradle/BuildPlugin.groovy", "diffHunk": "@@ -82,6 +82,7 @@ class BuildPlugin implements Plugin<Project> {\n             )\n         }\n         project.pluginManager.apply('elasticsearch.java')\n+        ElasticsearchJavaPlugin.configureJars(project)", "originalCommit": "845a2a8b7c4eee1f6c4ae6b0ae0e081242c7d9ae", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODc5MjkyMw==", "url": "https://github.com/elastic/elasticsearch/pull/56975#discussion_r428792923", "bodyText": "I can, however, aren't we also moving away from adding code to the Groovy parts of the build ?  (I can move the code to Groovy and keep in the code in idiomatic Java, but isn't it still is going the wrong way ?)\n\nWe shouldn't be calling these methods statically\n\nIn that case, should these methods not be public static ?", "author": "jakelandis", "createdAt": "2020-05-21T17:12:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODc4NjY4OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODc5NDE0OA==", "url": "https://github.com/elastic/elasticsearch/pull/56975#discussion_r428794148", "bodyText": "I will be finishing moving this code to java soon. I'll take care of re-javaizing it.", "author": "rjernst", "createdAt": "2020-05-21T17:14:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODc4NjY4OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODgxNzk4Nw==", "url": "https://github.com/elastic/elasticsearch/pull/56975#discussion_r428817987", "bodyText": "OK ... I pulled the groovy version from git history and removed the Java version. 908ee17", "author": "jakelandis", "createdAt": "2020-05-21T17:57:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODc4NjY4OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODgyMDM3NQ==", "url": "https://github.com/elastic/elasticsearch/pull/56975#discussion_r428820375", "bodyText": "Sorry that isn't what I meant. Only the notice/license code should be moved. That is the problem you are running into right?", "author": "rjernst", "createdAt": "2020-05-21T18:01:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODc4NjY4OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODgzODc2Ng==", "url": "https://github.com/elastic/elasticsearch/pull/56975#discussion_r428838766", "bodyText": "pulled only the license and notice parts back to the groovy plugin", "author": "jakelandis", "createdAt": "2020-05-21T18:36:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODc4NjY4OQ=="}], "type": "inlineReview"}, {"oid": "908ee17737f1a283cf0535d0bfe102fa65144fb4", "url": "https://github.com/elastic/elasticsearch/commit/908ee17737f1a283cf0535d0bfe102fa65144fb4", "message": "resurect Groovy configureJars and remove from Java", "committedDate": "2020-05-21T17:55:46Z", "type": "commit"}, {"oid": "5812825ca03da18918f8b817a8650840d6b97165", "url": "https://github.com/elastic/elasticsearch/commit/5812825ca03da18918f8b817a8650840d6b97165", "message": "only move license stuff back to groovy", "committedDate": "2020-05-21T18:19:38Z", "type": "commit"}, {"oid": "e504625e549ef9e7715772b8bea948e5bfd486d5", "url": "https://github.com/elastic/elasticsearch/commit/e504625e549ef9e7715772b8bea948e5bfd486d5", "message": "call java configureJars", "committedDate": "2020-05-21T18:34:02Z", "type": "commit"}]}