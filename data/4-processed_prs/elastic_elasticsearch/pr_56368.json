{"pr_number": 56368, "pr_title": "Upgrade forbidden apis to 3.0", "pr_createdAt": "2020-05-07T17:03:24Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/56368", "timeline": [{"oid": "540f1d2776aa206252da6e222c4444fbfa3132d2", "url": "https://github.com/elastic/elasticsearch/commit/540f1d2776aa206252da6e222c4444fbfa3132d2", "message": "Upgrade forbidden apis to 3.0\n\nThis commit upgrades forbidden apis to the latest version, which also\nmeans we now get task configuration avoidance.", "committedDate": "2020-05-07T17:01:48Z", "type": "commit"}, {"oid": "e1785a7366cfbe1cd839ed9f5da1f5fdee7643ac", "url": "https://github.com/elastic/elasticsearch/commit/e1785a7366cfbe1cd839ed9f5da1f5fdee7643ac", "message": "remove java 14 special case", "committedDate": "2020-05-07T19:18:39Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTg0NzExOQ==", "url": "https://github.com/elastic/elasticsearch/pull/56368#discussion_r421847119", "bodyText": "We test with JDK 15. Should we still check to cap this at 14?", "author": "mark-vieira", "createdAt": "2020-05-07T23:16:46Z", "path": "buildSrc/src/main/groovy/org/elasticsearch/gradle/precommit/PrecommitTasks.groovy", "diffHunk": "@@ -168,10 +168,6 @@ class PrecommitTasks {\n             classpath = project.files { sourceSet.runtimeClasspath.plus(sourceSet.compileClasspath) }\n \n             targetCompatibility = BuildParams.runtimeJavaVersion.majorVersion\n-            if (BuildParams.runtimeJavaVersion > JavaVersion.VERSION_13) {", "originalCommit": "e1785a7366cfbe1cd839ed9f5da1f5fdee7643ac", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTg3Mjg4NQ==", "url": "https://github.com/elastic/elasticsearch/pull/56368#discussion_r421872885", "bodyText": "Yep you are right. I added this back using Java 15. We should rethink using runtime java here. It isn't necessary; we only need the target version for each sourceset we are running against.", "author": "rjernst", "createdAt": "2020-05-08T00:42:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTg0NzExOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTg3NTYyMw==", "url": "https://github.com/elastic/elasticsearch/pull/56368#discussion_r421875623", "bodyText": "I agree. What we should be using is minimumRuntimeVersion since that is what we use as our target compatibility version and pass via -release to java. Just because we test with a new runtime version doesn't in any way change how we compile.", "author": "mark-vieira", "createdAt": "2020-05-08T00:52:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTg0NzExOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTg5NDU2NA==", "url": "https://github.com/elastic/elasticsearch/pull/56368#discussion_r421894564", "bodyText": "It does change for MRJARs, which is why I think we should set it to the compile version for the specific sourceset.", "author": "rjernst", "createdAt": "2020-05-08T02:01:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTg0NzExOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjA4MjgwNg==", "url": "https://github.com/elastic/elasticsearch/pull/56368#discussion_r422082806", "bodyText": "Exactly, thanks for this @mark-vieira. The target version passed to forbiddenapis should exactly be the same like passed to javac. By default the plugin also sets this up from the targetVersion property used also by javac (project.targetVersion: https://docs.gradle.org/current/userguide/java_plugin.html)\nFor MR-JARS this is not yet ideal in Gradle. IMHO, Gradle should define the target/sourceVersion on the sourceSet and not on the project. If this would be the case, you would set the sourceSet's targetVersion and forbiddenapis would automatically take it.\nIf there is any progress with changes to Gradle's support for MR-JARs, please open an issue in forbiddenapis, to adapt the defaults in plugin-init.gradle.", "author": "uschindler", "createdAt": "2020-05-08T11:05:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTg0NzExOQ=="}], "type": "inlineReview"}, {"oid": "0e92ee21eb402853bdc3c274bda15d48c7de5312", "url": "https://github.com/elastic/elasticsearch/commit/0e92ee21eb402853bdc3c274bda15d48c7de5312", "message": "add back guard for java 15", "committedDate": "2020-05-08T00:40:54Z", "type": "commit"}]}