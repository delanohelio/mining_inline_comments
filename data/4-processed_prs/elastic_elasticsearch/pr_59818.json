{"pr_number": 59818, "pr_title": "[DOCS] Fix data stream docs", "pr_createdAt": "2020-07-17T23:32:54Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/59818", "timeline": [{"oid": "731a46da84004729e4c0cc31324755067cf83aa7", "url": "https://github.com/elastic/elasticsearch/commit/731a46da84004729e4c0cc31324755067cf83aa7", "message": "[DOCS] Fix data stream docs", "committedDate": "2020-07-17T23:31:32Z", "type": "commit"}, {"oid": "03064508500cf32c56bf138f2ae58082486e4f29", "url": "https://github.com/elastic/elasticsearch/commit/03064508500cf32c56bf138f2ae58082486e4f29", "message": "Remove another collapsible section", "committedDate": "2020-07-17T23:44:48Z", "type": "commit"}, {"oid": "9848378c650e98cff38520fb81d6aa15d1b7cabb", "url": "https://github.com/elastic/elasticsearch/commit/9848378c650e98cff38520fb81d6aa15d1b7cabb", "message": "wording", "committedDate": "2020-07-18T00:54:48Z", "type": "commit"}, {"oid": "6bc1c21fda765b138a401c4a366b3330ec7b4184", "url": "https://github.com/elastic/elasticsearch/commit/6bc1c21fda765b138a401c4a366b3330ec7b4184", "message": "reword", "committedDate": "2020-07-18T01:52:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc0MjM4OQ==", "url": "https://github.com/elastic/elasticsearch/pull/59818#discussion_r457742389", "bodyText": "Would the more detailed information on supported APIs fit better in the 'Use a data stream' docs, to keep this shorter and high level?", "author": "jtibshirani", "createdAt": "2020-07-20T23:10:55Z", "path": "docs/reference/data-streams/data-streams.asciidoc", "diffHunk": "@@ -47,16 +46,152 @@ We recommend using data streams if you:\n \n \n [discrete]\n-[[data-streams-toc]]\n-== In this section\n+[[backing-indices]]\n+== Backing indices\n+A data stream consists of one or more _backing indices_. Backing indices are\n+<<index-hidden,hidden>>, auto-generated indices used to store a stream's\n+documents.\n \n-* <<data-streams-overview>>\n-* <<set-up-a-data-stream>>\n-* <<use-a-data-stream>>\n-* <<data-streams-change-mappings-and-settings>>\n+image::images/data-streams/data-streams-diagram.svg[align=\"center\"]\n \n+To create backing indices, each data stream requires a matching\n+<<indices-templates,index template>>. This template acts as a blueprint for the\n+stream's backing indices. It contains:\n+\n+* The mappings and settings applied to each backing index when it's created.\n+\n+* A name or wildcard (`*`) pattern that matches the data stream's name.\n+\n+* A `data_stream` object with an empty body (`{ }`). This object indicates the\n+template is used for data streams.\n+\n+A `@timestamp` field must be included in every document indexed to the data\n+stream. This field can be mapped as a <<date,`date`>> or\n+<<date_nanos,`date_nanos`>> field data type in the stream's matching index\n+template. If no mapping is specified in the template, the `date` field data type\n+with default options is used.\n+\n+The same index template can be used to create multiple data streams.\n+\n+\n+[discrete]\n+[[data-streams-generation]]\n+== Generation\n+\n+Each data stream tracks its _generation_: a six-digit, zero-padded integer\n+that acts as a cumulative count of the data stream's backing indices. This count\n+includes any deleted indices for the stream. The generation is incremented\n+whenever a new backing index is added to the stream.\n+\n+When a backing index is created, the index is named using the following\n+convention:\n+\n+[source,text]\n+----\n+.ds-<data-stream>-<generation>\n+----\n+\n+For example, the `web_server_logs` data stream has a generation of `34`. The\n+most recently created backing index for this data stream is named\n+`.ds-web_server_logs-000034`.\n+\n+Because the generation increments with each new backing index, backing indices\n+with a higher generation contain more recent data. Backing indices with a lower\n+generation contain older data.\n+\n+A backing index's name can change after its creation due to a\n+<<indices-shrink-index,shrink>>, <<snapshots-restore-snapshot,restore>>, or\n+other operations.\n+\n+[discrete]\n+[[data-stream-write-index]]\n+== Write index\n+\n+When a read request is sent to a data stream, it routes the request to all its\n+backing indices. For example, a search request sent to a data stream would query\n+all its backing indices.\n+\n+image::images/data-streams/data-streams-search-request.svg[align=\"center\"]\n+\n+However, the most recently created backing index is the data stream\u2019s only\n+_write index_. The data stream routes all indexing requests for new documents to\n+this index.\n+\n+image::images/data-streams/data-streams-index-request.svg[align=\"center\"]\n+\n+You cannot add new documents to a stream's other backing indices, even by\n+sending requests directly to the index. This means you cannot submit the\n+following requests directly to any backing index except the write index:\n+\n+* An <<docs-index_,index API>> request with an\n+  <<docs-index-api-op_type,`op_type`>> of `create`. The `op_type` parameter\n+  defaults to `create` when adding new documents.\n+* A <<docs-bulk,bulk API>> request using a `create` action\n+\n+Because it's the only index capable of ingesting new documents, you cannot\n+perform operations on a write index that might hinder indexing. These\n+prohibited operations include:\n+\n+* <<indices-clone-index,Clone>>\n+* <<indices-close,Close>>\n+* <<indices-delete-index,Delete>>\n+* <<freeze-index-api,Freeze>>\n+* <<indices-shrink-index,Shrink>>\n+* <<indices-split-index,Split>>\n+\n+[discrete]\n+[[data-streams-rollover]]\n+== Rollover\n+\n+When a data stream is created, one backing index is automatically created.\n+Because this single index is also the most recently created backing index, it\n+acts as the stream's write index.\n+\n+A <<indices-rollover-index,rollover>> creates a new backing index for a data\n+stream. This new backing index becomes the stream's write index, replacing\n+the current one, and increments the stream's generation.\n+\n+In most cases, we recommend using <<index-lifecycle-management,{ilm}\n+({ilm-init})>> to automate rollovers for data streams. This lets you\n+automatically roll over the current write index when it meets specified\n+criteria, such as a maximum age or size.\n+\n+However, you can also use the <<indices-rollover-index,rollover API>> to\n+manually perform a rollover. See <<manually-roll-over-a-data-stream>>.\n+\n+[discrete]\n+[[data-streams-append-only]]\n+== Append-only\n+\n+For most time-series use cases, existing data is rarely, if ever, updated.\n+Because of this, data streams are designed to be append-only.\n+\n+You can send <<add-documents-to-a-data-stream,indexing requests for new", "originalCommit": "6bc1c21fda765b138a401c4a366b3330ec7b4184", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzcyODAwNQ==", "url": "https://github.com/elastic/elasticsearch/pull/59818#discussion_r457728005", "bodyText": "I don't think \"scale\" is quite right here. Maybe \"to manage the backing indices associated with a data stream\"?\nAlso, it feels awkward to lead with an optional non-data stream step. I see why you did, but maybe if it's referenced from the template set up, it could be moved down?", "author": "debadair", "createdAt": "2020-07-20T22:30:33Z", "path": "docs/reference/data-streams/set-up-a-data-stream.asciidoc", "diffHunk": "@@ -52,9 +52,6 @@ triggers for such actions.\n TIP: While optional, we recommend using {ilm-init} to scale data streams in", "originalCommit": "6bc1c21fda765b138a401c4a366b3330ec7b4184", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzcyODY3NQ==", "url": "https://github.com/elastic/elasticsearch/pull/59818#discussion_r457728675", "bodyText": "I'd lead with why you need the template, rather than the fact that it's required. Something like:\nA data stream uses an index template to configure its backing indices. A template for a data stream must specify:\n\nAn index pattern that matches the name of the stream.\nAn empty data_stream object that indicates the template is for a data stream.\nThe settings, mappings, and aliases for the stream's backing indices.", "author": "debadair", "createdAt": "2020-07-20T22:32:34Z", "path": "docs/reference/data-streams/set-up-a-data-stream.asciidoc", "diffHunk": "@@ -86,83 +83,40 @@ PUT /_ilm/policy/logs_policy\n   }\n }\n ----\n-====\n \n \n [discrete]\n [[create-a-data-stream-template]]\n === Create an index template for a data stream\n \n-Each data stream requires an <<indices-templates,index template>>. The data\n-stream uses this template to create its backing indices.\n+Each data stream requires a matching <<indices-templates,index template>>. The", "originalCommit": "6bc1c21fda765b138a401c4a366b3330ec7b4184", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzczNjUwMw==", "url": "https://github.com/elastic/elasticsearch/pull/59818#discussion_r457736503", "bodyText": "I'd flip this around.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            A `@timestamp` field must be included in every document indexed to the data\n          \n          \n            \n            stream. This field can be mapped as a <<date,`date`>> or\n          \n          \n            \n            <<date_nanos,`date_nanos`>> field data type in the stream's matching index\n          \n          \n            \n            template. This mapping can include other <<mapping-params,mapping parameters>>,\n          \n          \n            \n            such as <<mapping-date-format,`format`>>. If no mapping is specified in the\n          \n          \n            \n            template, the `date` field data type with default options is used.\n          \n          \n            \n            Every document indexed to a data\n          \n          \n            \n            stream must have a `@timestamp` field. The timestamp can be mapped as a <<date,`date`>> or\n          \n          \n            \n            <<date_nanos,`date_nanos`>> field by the stream's index\n          \n          \n            \n            template. The template can also configure <<mapping-params,Mapping parameters>>,\n          \n          \n            \n            such as <<mapping-date-format,`format`>>. If the template does not define a mapping, the timestamp is mapped to a `date` field by default.", "author": "debadair", "createdAt": "2020-07-20T22:53:18Z", "path": "docs/reference/data-streams/set-up-a-data-stream.asciidoc", "diffHunk": "@@ -86,83 +83,40 @@ PUT /_ilm/policy/logs_policy\n   }\n }\n ----\n-====\n \n \n [discrete]\n [[create-a-data-stream-template]]\n === Create an index template for a data stream\n \n-Each data stream requires an <<indices-templates,index template>>. The data\n-stream uses this template to create its backing indices.\n+Each data stream requires a matching <<indices-templates,index template>>. The\n+data stream uses this template to apply settings and mappings to its backing\n+indices. This index template contains:\n \n-An index template for a data stream must contain:\n+* The mappings and settings you'd like to apply to the stream's backing indices.\n \n-* A name or wildcard (`*`) pattern for the data stream in the `index_patterns`\n-property.\n-+\n-You can use the resolve index API to check if the name or pattern\n-matches any existing indices, index aliases, or data streams. If so, you should\n-consider using another name or pattern.\n-+\n-.*Example*\n-[%collapsible]\n-====\n-The following resolve index API request checks for any existing indices, index\n-aliases, or data streams that start with `logs`. If not, the `logs*`\n-wildcard pattern can be used to create a new data stream.\n-\n-[source,console]\n-----\n-GET /_resolve/index/logs*\n-----\n-// TEST[continued]\n-\n-The API returns the following response, indicating no existing targets match\n-this pattern.\n-\n-[source,console-result]\n-----\n-{\n-  \"indices\" : [ ],\n-  \"aliases\" : [ ],\n-  \"data_streams\" : [ ]\n-}\n-----\n-====\n+* A name or wildcard (`*`) pattern that matches the data stream's name in the\n+`index_patterns` property.\n \n-* A `data_stream` object with an empty body (`{ }`).\n+* A required `data_stream` object with an empty body (`{ }`).  This object\n+indicates the template is used for data streams.\n \n-The template can also contain:\n+A `@timestamp` field must be included in every document indexed to the data\n+stream. This field can be mapped as a <<date,`date`>> or\n+<<date_nanos,`date_nanos`>> field data type in the stream's matching index\n+template. This mapping can include other <<mapping-params,mapping parameters>>,\n+such as <<mapping-date-format,`format`>>. If no mapping is specified in the\n+template, the `date` field data type with default options is used.", "originalCommit": "6bc1c21fda765b138a401c4a366b3330ec7b4184", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzczNzQ0OQ==", "url": "https://github.com/elastic/elasticsearch/pull/59818#discussion_r457737449", "bodyText": "Do we want to make a stronger statement here? \"We recommend using ILM to manage a data stream's backing indices. Specify the name of the lifecycle policy with the index.lifecycle.name setting.\"", "author": "debadair", "createdAt": "2020-07-20T22:56:05Z", "path": "docs/reference/data-streams/set-up-a-data-stream.asciidoc", "diffHunk": "@@ -86,83 +83,40 @@ PUT /_ilm/policy/logs_policy\n   }\n }\n ----\n-====\n \n \n [discrete]\n [[create-a-data-stream-template]]\n === Create an index template for a data stream\n \n-Each data stream requires an <<indices-templates,index template>>. The data\n-stream uses this template to create its backing indices.\n+Each data stream requires a matching <<indices-templates,index template>>. The\n+data stream uses this template to apply settings and mappings to its backing\n+indices. This index template contains:\n \n-An index template for a data stream must contain:\n+* The mappings and settings you'd like to apply to the stream's backing indices.\n \n-* A name or wildcard (`*`) pattern for the data stream in the `index_patterns`\n-property.\n-+\n-You can use the resolve index API to check if the name or pattern\n-matches any existing indices, index aliases, or data streams. If so, you should\n-consider using another name or pattern.\n-+\n-.*Example*\n-[%collapsible]\n-====\n-The following resolve index API request checks for any existing indices, index\n-aliases, or data streams that start with `logs`. If not, the `logs*`\n-wildcard pattern can be used to create a new data stream.\n-\n-[source,console]\n-----\n-GET /_resolve/index/logs*\n-----\n-// TEST[continued]\n-\n-The API returns the following response, indicating no existing targets match\n-this pattern.\n-\n-[source,console-result]\n-----\n-{\n-  \"indices\" : [ ],\n-  \"aliases\" : [ ],\n-  \"data_streams\" : [ ]\n-}\n-----\n-====\n+* A name or wildcard (`*`) pattern that matches the data stream's name in the\n+`index_patterns` property.\n \n-* A `data_stream` object with an empty body (`{ }`).\n+* A required `data_stream` object with an empty body (`{ }`).  This object\n+indicates the template is used for data streams.\n \n-The template can also contain:\n+A `@timestamp` field must be included in every document indexed to the data\n+stream. This field can be mapped as a <<date,`date`>> or\n+<<date_nanos,`date_nanos`>> field data type in the stream's matching index\n+template. This mapping can include other <<mapping-params,mapping parameters>>,\n+such as <<mapping-date-format,`format`>>. If no mapping is specified in the\n+template, the `date` field data type with default options is used.\n \n-* An optional field mapping for the `@timestamp` field. Both the <<date,`date`>> and\n-<<date_nanos,`date_nanos`>> field data types are supported. If no mapping is specified,\n-a <<date,`date`>> field data type with default options is used.\n-+\n-This mapping can include other <<mapping-params,mapping parameters>>, such as\n-<<mapping-date-format,`format`>>.\n-+\n-IMPORTANT: Carefully consider the `@timestamp` field's mapping, including\n-its <<mapping-params,mapping parameters>>.\n-Once the stream is created, you can only update the `@timestamp` field's mapping\n-by reindexing the data stream. See\n-<<data-streams-use-reindex-to-change-mappings-settings>>.\n-\n-* If you intend to use {ilm-init}, the\n-  <<configure-a-data-stream-ilm-policy,lifecycle policy>> in the\n-  `index.lifecycle.name` setting.\n-\n-You can also specify other mappings and settings you'd like to apply to the\n-stream's backing indices.\n+If you intend to use {ilm-init}, include the", "originalCommit": "6bc1c21fda765b138a401c4a366b3330ec7b4184", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzczODYxMQ==", "url": "https://github.com/elastic/elasticsearch/pull/59818#discussion_r457738611", "bodyText": "You don't really create a data stream with a template & needing a template for a data stream is kind of orthogonal to how you create a data stream. However, if attempting to create a data stream without a matching template fails, I'd call that out after the two options.", "author": "debadair", "createdAt": "2020-07-20T22:59:48Z", "path": "docs/reference/data-streams/set-up-a-data-stream.asciidoc", "diffHunk": "@@ -220,21 +173,24 @@ This would prevent the data stream from creating new backing indices.\n With an index template, you can create a data stream using one of two", "originalCommit": "6bc1c21fda765b138a401c4a366b3330ec7b4184", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc0MjcxNw==", "url": "https://github.com/elastic/elasticsearch/pull/59818#discussion_r457742717", "bodyText": "Maybe:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            A backing index's name can change after its creation due to a\n          \n          \n            \n            <<indices-shrink-index,shrink>>, <<snapshots-restore-snapshot,restore>>, or\n          \n          \n            \n            other operations.\n          \n          \n            \n            Performing operations such as a <<indices-shrink-index,shrink>> or <<snapshots-restore-snapshot,restore>> can change the name of a backing index.\n          \n      \n    \n    \n  \n\nIt feels like maybe there's another point here--like changing the name of a backing index sort of \"detaches\" it from the data stream.", "author": "debadair", "createdAt": "2020-07-20T23:11:59Z", "path": "docs/reference/data-streams/data-streams.asciidoc", "diffHunk": "@@ -47,16 +46,152 @@ We recommend using data streams if you:\n \n \n [discrete]\n-[[data-streams-toc]]\n-== In this section\n+[[backing-indices]]\n+== Backing indices\n+A data stream consists of one or more _backing indices_. Backing indices are\n+<<index-hidden,hidden>>, auto-generated indices used to store a stream's\n+documents.\n \n-* <<data-streams-overview>>\n-* <<set-up-a-data-stream>>\n-* <<use-a-data-stream>>\n-* <<data-streams-change-mappings-and-settings>>\n+image::images/data-streams/data-streams-diagram.svg[align=\"center\"]\n \n+To create backing indices, each data stream requires a matching\n+<<indices-templates,index template>>. This template acts as a blueprint for the\n+stream's backing indices. It contains:\n+\n+* The mappings and settings applied to each backing index when it's created.\n+\n+* A name or wildcard (`*`) pattern that matches the data stream's name.\n+\n+* A `data_stream` object with an empty body (`{ }`). This object indicates the\n+template is used for data streams.\n+\n+A `@timestamp` field must be included in every document indexed to the data\n+stream. This field can be mapped as a <<date,`date`>> or\n+<<date_nanos,`date_nanos`>> field data type in the stream's matching index\n+template. If no mapping is specified in the template, the `date` field data type\n+with default options is used.\n+\n+The same index template can be used to create multiple data streams.\n+\n+\n+[discrete]\n+[[data-streams-generation]]\n+== Generation\n+\n+Each data stream tracks its _generation_: a six-digit, zero-padded integer\n+that acts as a cumulative count of the data stream's backing indices. This count\n+includes any deleted indices for the stream. The generation is incremented\n+whenever a new backing index is added to the stream.\n+\n+When a backing index is created, the index is named using the following\n+convention:\n+\n+[source,text]\n+----\n+.ds-<data-stream>-<generation>\n+----\n+\n+For example, the `web_server_logs` data stream has a generation of `34`. The\n+most recently created backing index for this data stream is named\n+`.ds-web_server_logs-000034`.\n+\n+Because the generation increments with each new backing index, backing indices\n+with a higher generation contain more recent data. Backing indices with a lower\n+generation contain older data.\n+\n+A backing index's name can change after its creation due to a\n+<<indices-shrink-index,shrink>>, <<snapshots-restore-snapshot,restore>>, or\n+other operations.", "originalCommit": "6bc1c21fda765b138a401c4a366b3330ec7b4184", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc0MzQzMA==", "url": "https://github.com/elastic/elasticsearch/pull/59818#discussion_r457743430", "bodyText": "I would lead with this part and move the part about federating the search across all of the backing indices afterward. Otherwise, it's a bit jarring to start reading about read requests in a section about write requests.", "author": "debadair", "createdAt": "2020-07-20T23:14:21Z", "path": "docs/reference/data-streams/data-streams.asciidoc", "diffHunk": "@@ -47,16 +46,152 @@ We recommend using data streams if you:\n \n \n [discrete]\n-[[data-streams-toc]]\n-== In this section\n+[[backing-indices]]\n+== Backing indices\n+A data stream consists of one or more _backing indices_. Backing indices are\n+<<index-hidden,hidden>>, auto-generated indices used to store a stream's\n+documents.\n \n-* <<data-streams-overview>>\n-* <<set-up-a-data-stream>>\n-* <<use-a-data-stream>>\n-* <<data-streams-change-mappings-and-settings>>\n+image::images/data-streams/data-streams-diagram.svg[align=\"center\"]\n \n+To create backing indices, each data stream requires a matching\n+<<indices-templates,index template>>. This template acts as a blueprint for the\n+stream's backing indices. It contains:\n+\n+* The mappings and settings applied to each backing index when it's created.\n+\n+* A name or wildcard (`*`) pattern that matches the data stream's name.\n+\n+* A `data_stream` object with an empty body (`{ }`). This object indicates the\n+template is used for data streams.\n+\n+A `@timestamp` field must be included in every document indexed to the data\n+stream. This field can be mapped as a <<date,`date`>> or\n+<<date_nanos,`date_nanos`>> field data type in the stream's matching index\n+template. If no mapping is specified in the template, the `date` field data type\n+with default options is used.\n+\n+The same index template can be used to create multiple data streams.\n+\n+\n+[discrete]\n+[[data-streams-generation]]\n+== Generation\n+\n+Each data stream tracks its _generation_: a six-digit, zero-padded integer\n+that acts as a cumulative count of the data stream's backing indices. This count\n+includes any deleted indices for the stream. The generation is incremented\n+whenever a new backing index is added to the stream.\n+\n+When a backing index is created, the index is named using the following\n+convention:\n+\n+[source,text]\n+----\n+.ds-<data-stream>-<generation>\n+----\n+\n+For example, the `web_server_logs` data stream has a generation of `34`. The\n+most recently created backing index for this data stream is named\n+`.ds-web_server_logs-000034`.\n+\n+Because the generation increments with each new backing index, backing indices\n+with a higher generation contain more recent data. Backing indices with a lower\n+generation contain older data.\n+\n+A backing index's name can change after its creation due to a\n+<<indices-shrink-index,shrink>>, <<snapshots-restore-snapshot,restore>>, or\n+other operations.\n+\n+[discrete]\n+[[data-stream-write-index]]\n+== Write index\n+\n+When a read request is sent to a data stream, it routes the request to all its\n+backing indices. For example, a search request sent to a data stream would query\n+all its backing indices.\n+\n+image::images/data-streams/data-streams-search-request.svg[align=\"center\"]\n+\n+However, the most recently created backing index is the data stream\u2019s only", "originalCommit": "6bc1c21fda765b138a401c4a366b3330ec7b4184", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc0NTIwNQ==", "url": "https://github.com/elastic/elasticsearch/pull/59818#discussion_r457745205", "bodyText": "I might say, \"If necessary\" rather than \"Alternatively\". It seems like we don't want to encourage folks to directly poke at the backing indices. Their interactions should be almost always be through the data stream, I would think.", "author": "debadair", "createdAt": "2020-07-20T23:19:58Z", "path": "docs/reference/data-streams/data-streams.asciidoc", "diffHunk": "@@ -47,16 +46,152 @@ We recommend using data streams if you:\n \n \n [discrete]\n-[[data-streams-toc]]\n-== In this section\n+[[backing-indices]]\n+== Backing indices\n+A data stream consists of one or more _backing indices_. Backing indices are\n+<<index-hidden,hidden>>, auto-generated indices used to store a stream's\n+documents.\n \n-* <<data-streams-overview>>\n-* <<set-up-a-data-stream>>\n-* <<use-a-data-stream>>\n-* <<data-streams-change-mappings-and-settings>>\n+image::images/data-streams/data-streams-diagram.svg[align=\"center\"]\n \n+To create backing indices, each data stream requires a matching\n+<<indices-templates,index template>>. This template acts as a blueprint for the\n+stream's backing indices. It contains:\n+\n+* The mappings and settings applied to each backing index when it's created.\n+\n+* A name or wildcard (`*`) pattern that matches the data stream's name.\n+\n+* A `data_stream` object with an empty body (`{ }`). This object indicates the\n+template is used for data streams.\n+\n+A `@timestamp` field must be included in every document indexed to the data\n+stream. This field can be mapped as a <<date,`date`>> or\n+<<date_nanos,`date_nanos`>> field data type in the stream's matching index\n+template. If no mapping is specified in the template, the `date` field data type\n+with default options is used.\n+\n+The same index template can be used to create multiple data streams.\n+\n+\n+[discrete]\n+[[data-streams-generation]]\n+== Generation\n+\n+Each data stream tracks its _generation_: a six-digit, zero-padded integer\n+that acts as a cumulative count of the data stream's backing indices. This count\n+includes any deleted indices for the stream. The generation is incremented\n+whenever a new backing index is added to the stream.\n+\n+When a backing index is created, the index is named using the following\n+convention:\n+\n+[source,text]\n+----\n+.ds-<data-stream>-<generation>\n+----\n+\n+For example, the `web_server_logs` data stream has a generation of `34`. The\n+most recently created backing index for this data stream is named\n+`.ds-web_server_logs-000034`.\n+\n+Because the generation increments with each new backing index, backing indices\n+with a higher generation contain more recent data. Backing indices with a lower\n+generation contain older data.\n+\n+A backing index's name can change after its creation due to a\n+<<indices-shrink-index,shrink>>, <<snapshots-restore-snapshot,restore>>, or\n+other operations.\n+\n+[discrete]\n+[[data-stream-write-index]]\n+== Write index\n+\n+When a read request is sent to a data stream, it routes the request to all its\n+backing indices. For example, a search request sent to a data stream would query\n+all its backing indices.\n+\n+image::images/data-streams/data-streams-search-request.svg[align=\"center\"]\n+\n+However, the most recently created backing index is the data stream\u2019s only\n+_write index_. The data stream routes all indexing requests for new documents to\n+this index.\n+\n+image::images/data-streams/data-streams-index-request.svg[align=\"center\"]\n+\n+You cannot add new documents to a stream's other backing indices, even by\n+sending requests directly to the index. This means you cannot submit the\n+following requests directly to any backing index except the write index:\n+\n+* An <<docs-index_,index API>> request with an\n+  <<docs-index-api-op_type,`op_type`>> of `create`. The `op_type` parameter\n+  defaults to `create` when adding new documents.\n+* A <<docs-bulk,bulk API>> request using a `create` action\n+\n+Because it's the only index capable of ingesting new documents, you cannot\n+perform operations on a write index that might hinder indexing. These\n+prohibited operations include:\n+\n+* <<indices-clone-index,Clone>>\n+* <<indices-close,Close>>\n+* <<indices-delete-index,Delete>>\n+* <<freeze-index-api,Freeze>>\n+* <<indices-shrink-index,Shrink>>\n+* <<indices-split-index,Split>>\n+\n+[discrete]\n+[[data-streams-rollover]]\n+== Rollover\n+\n+When a data stream is created, one backing index is automatically created.\n+Because this single index is also the most recently created backing index, it\n+acts as the stream's write index.\n+\n+A <<indices-rollover-index,rollover>> creates a new backing index for a data\n+stream. This new backing index becomes the stream's write index, replacing\n+the current one, and increments the stream's generation.\n+\n+In most cases, we recommend using <<index-lifecycle-management,{ilm}\n+({ilm-init})>> to automate rollovers for data streams. This lets you\n+automatically roll over the current write index when it meets specified\n+criteria, such as a maximum age or size.\n+\n+However, you can also use the <<indices-rollover-index,rollover API>> to\n+manually perform a rollover. See <<manually-roll-over-a-data-stream>>.\n+\n+[discrete]\n+[[data-streams-append-only]]\n+== Append-only\n+\n+For most time-series use cases, existing data is rarely, if ever, updated.\n+Because of this, data streams are designed to be append-only.\n+\n+You can send <<add-documents-to-a-data-stream,indexing requests for new\n+documents>> directly to a data stream. However, you cannot send the following\n+requests for existing documents directly to a data stream:\n+\n+* An <<docs-index_,index API>> request with an\n+  <<docs-index-api-op_type,`op_type`>> of `index`. The `op_type` parameter\n+  defaults to `index` for existing documents.\n+\n+* A <<docs-bulk,bulk API>> request using the `delete`, `index`, or `update`\n+  action.\n+\n+* A <<docs-delete,delete API>> request\n+\n+Instead, you can use the <<docs-update-by-query,update by query>> and\n+<<docs-delete-by-query,delete by query>> APIs to update or delete existing\n+documents in a data stream. See <<update-docs-in-a-data-stream-by-query>> and <<delete-docs-in-a-data-stream-by-query>>.\n+\n+Alternatively, you can update or delete a document by submitting requests to the", "originalCommit": "6bc1c21fda765b138a401c4a366b3330ec7b4184", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc0ODc0OA==", "url": "https://github.com/elastic/elasticsearch/pull/59818#discussion_r457748748", "bodyText": "Maybe Data stream generations? On it's own, it brings to mind generating data streams.", "author": "debadair", "createdAt": "2020-07-20T23:31:24Z", "path": "docs/reference/data-streams/data-streams.asciidoc", "diffHunk": "@@ -47,16 +46,152 @@ We recommend using data streams if you:\n \n \n [discrete]\n-[[data-streams-toc]]\n-== In this section\n+[[backing-indices]]\n+== Backing indices\n+A data stream consists of one or more _backing indices_. Backing indices are\n+<<index-hidden,hidden>>, auto-generated indices used to store a stream's\n+documents.\n \n-* <<data-streams-overview>>\n-* <<set-up-a-data-stream>>\n-* <<use-a-data-stream>>\n-* <<data-streams-change-mappings-and-settings>>\n+image::images/data-streams/data-streams-diagram.svg[align=\"center\"]\n \n+To create backing indices, each data stream requires a matching\n+<<indices-templates,index template>>. This template acts as a blueprint for the\n+stream's backing indices. It contains:\n+\n+* The mappings and settings applied to each backing index when it's created.\n+\n+* A name or wildcard (`*`) pattern that matches the data stream's name.\n+\n+* A `data_stream` object with an empty body (`{ }`). This object indicates the\n+template is used for data streams.\n+\n+A `@timestamp` field must be included in every document indexed to the data\n+stream. This field can be mapped as a <<date,`date`>> or\n+<<date_nanos,`date_nanos`>> field data type in the stream's matching index\n+template. If no mapping is specified in the template, the `date` field data type\n+with default options is used.\n+\n+The same index template can be used to create multiple data streams.\n+\n+\n+[discrete]\n+[[data-streams-generation]]\n+== Generation", "originalCommit": "6bc1c21fda765b138a401c4a366b3330ec7b4184", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "7dce3369a1718adcbb803fb057e3be456f199f99", "url": "https://github.com/elastic/elasticsearch/commit/7dce3369a1718adcbb803fb057e3be456f199f99", "message": "Address feedback", "committedDate": "2020-07-21T15:58:58Z", "type": "commit"}, {"oid": "78ac57964da0d9a477398cffca497982444a967f", "url": "https://github.com/elastic/elasticsearch/commit/78ac57964da0d9a477398cffca497982444a967f", "message": "reword", "committedDate": "2020-07-21T16:01:44Z", "type": "commit"}, {"oid": "55bc76007a77d9dc0274931df6e246540af292c7", "url": "https://github.com/elastic/elasticsearch/commit/55bc76007a77d9dc0274931df6e246540af292c7", "message": "Merge branch 'master' into docs__ds-feedback", "committedDate": "2020-07-21T16:21:51Z", "type": "commit"}, {"oid": "249cb83671b2e247d95f2cc12940526cf8600f9b", "url": "https://github.com/elastic/elasticsearch/commit/249cb83671b2e247d95f2cc12940526cf8600f9b", "message": "reorg based on feedback", "committedDate": "2020-07-21T17:39:15Z", "type": "commit"}, {"oid": "e1351ace4052d5d9fc8dc8d18ee03844dba0aea7", "url": "https://github.com/elastic/elasticsearch/commit/e1351ace4052d5d9fc8dc8d18ee03844dba0aea7", "message": "fix xref", "committedDate": "2020-07-21T17:40:32Z", "type": "commit"}]}