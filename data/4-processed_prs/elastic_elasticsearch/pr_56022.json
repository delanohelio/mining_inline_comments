{"pr_number": 56022, "pr_title": "Get index includes parent data stream for backing indices", "pr_createdAt": "2020-04-30T12:57:39Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/56022", "timeline": [{"oid": "cf1f4a5dfcf9c6d437ac0d3273fa2a8ba91917a2", "url": "https://github.com/elastic/elasticsearch/commit/cf1f4a5dfcf9c6d437ac0d3273fa2a8ba91917a2", "message": " includes parent data stream for backing indices", "committedDate": "2020-04-30T12:54:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTMxOTYyNA==", "url": "https://github.com/elastic/elasticsearch/pull/56022#discussion_r419319624", "bodyText": "I think this de-serialization logic needs to be inside a version check.\nI think this is why the mixed cluster tests have failed.", "author": "martijnvg", "createdAt": "2020-05-04T09:41:01Z", "path": "server/src/main/java/org/elasticsearch/action/admin/indices/get/GetIndexResponse.java", "diffHunk": "@@ -126,6 +131,13 @@ public GetIndexResponse(String[] indices,\n             defaultSettingsMapBuilder.put(in.readString(), Settings.readSettingsFromStream(in));\n         }\n         defaultSettings = defaultSettingsMapBuilder.build();\n+\n+        ImmutableOpenMap.Builder<String, String> dataStreamsMapBuilder = ImmutableOpenMap.builder();\n+        int dataStreamsSize = in.readVInt();\n+        for (int i = 0; i < dataStreamsSize; i++) {\n+            dataStreamsMapBuilder.put(in.readString(), in.readOptionalString());\n+        }", "originalCommit": "cf1f4a5dfcf9c6d437ac0d3273fa2a8ba91917a2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTMxOTg0Mw==", "url": "https://github.com/elastic/elasticsearch/pull/56022#discussion_r419319843", "bodyText": "Same applies for this serialization logic.", "author": "martijnvg", "createdAt": "2020-05-04T09:41:22Z", "path": "server/src/main/java/org/elasticsearch/action/admin/indices/get/GetIndexResponse.java", "diffHunk": "@@ -233,6 +253,11 @@ public void writeTo(StreamOutput out) throws IOException {\n             out.writeString(indexEntry.key);\n             Settings.writeSettingsToStream(indexEntry.value, out);\n         }\n+        out.writeVInt(dataStreams.size());\n+        for (ObjectObjectCursor<String, String> indexEntry : dataStreams) {\n+            out.writeString(indexEntry.key);\n+            out.writeOptionalString(indexEntry.value);\n+        }", "originalCommit": "cf1f4a5dfcf9c6d437ac0d3273fa2a8ba91917a2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "3900ec86704f0002862597164f907d64e3046d7d", "url": "https://github.com/elastic/elasticsearch/commit/3900ec86704f0002862597164f907d64e3046d7d", "message": "versioning for response", "committedDate": "2020-05-04T13:33:47Z", "type": "commit"}, {"oid": "cbaca6f0d3b586a7f1d468f9417dbafa5dc0c9ed", "url": "https://github.com/elastic/elasticsearch/commit/cbaca6f0d3b586a7f1d468f9417dbafa5dc0c9ed", "message": "fix test", "committedDate": "2020-05-04T14:33:28Z", "type": "commit"}, {"oid": "ffdd65c80e307104cfc3e9d57efdc79a2ffbc5be", "url": "https://github.com/elastic/elasticsearch/commit/ffdd65c80e307104cfc3e9d57efdc79a2ffbc5be", "message": "Merge branch 'master' into get_parent_data_stream", "committedDate": "2020-05-04T14:50:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDM0NDc5NA==", "url": "https://github.com/elastic/elasticsearch/pull/56022#discussion_r420344794", "bodyText": "I wonder if this should not be a private method on TransportGetIndexAction instead? Seems it mainly translates from the lookup to the map structure.", "author": "henningandersen", "createdAt": "2020-05-05T19:12:34Z", "path": "server/src/main/java/org/elasticsearch/cluster/metadata/Metadata.java", "diffHunk": "@@ -401,6 +401,24 @@ public boolean equalsAliases(Metadata other) {\n         return indexMapBuilder.build();\n     }\n \n+    /**\n+     * Finds the parent data streams, if any, for the specified concrete indices.\n+     */\n+    public ImmutableOpenMap<String, IndexAbstraction.DataStream> findDataStreams(String[] concreteIndices) {", "originalCommit": "ffdd65c80e307104cfc3e9d57efdc79a2ffbc5be", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}