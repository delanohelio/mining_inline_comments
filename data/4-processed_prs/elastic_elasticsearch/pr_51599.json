{"pr_number": 51599, "pr_title": "Reindex rethrottle persistent task", "pr_createdAt": "2020-01-29T10:27:38Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/51599", "timeline": [{"oid": "7120dfc70d04d38b54428a9c06910cb090b3a6bd", "url": "https://github.com/elastic/elasticsearch/commit/7120dfc70d04d38b54428a9c06910cb090b3a6bd", "message": "Reindex rethrottle persistent task\n\nThis adds support for rethrottling resilient/persistent reindex\nthrough updating the .reindex index and notifying the task. This\nensures that the new throttle value sticks on failovers while\nalso ensuring that the task wakes up immediately if it had a very\nlow throttle value.\n\nRelated to #42612", "committedDate": "2020-01-29T10:21:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzI4Nzc5OA==", "url": "https://github.com/elastic/elasticsearch/pull/51599#discussion_r373287798", "bodyText": "Do we need this? I feel like adding the \"poll\" interaction model when we are doing all the working to implement the \"push\" component makes the interaction with the state updater and task more complicated that required.", "author": "tbrooks8", "createdAt": "2020-01-31T02:09:46Z", "path": "modules/reindex/src/main/java/org/elasticsearch/index/reindex/ReindexTaskStateUpdater.java", "diffHunk": "@@ -43,31 +45,36 @@\n \n     private final ReindexIndexClient reindexIndexClient;\n     private final ThreadPool threadPool;\n-    private final String taskId;\n+    private final String persistentTaskId;\n     private final long allocationId;\n+    private final TaskId ephemeralTaskId;\n     private final ActionListener<ReindexTaskStateDoc> finishedListener;\n     private final Runnable onCheckpointAssignmentConflict;\n+    private Consumer<Float> requestsPerSecondObserver;", "originalCommit": "7120dfc70d04d38b54428a9c06910cb090b3a6bd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDE2MjI5MA==", "url": "https://github.com/elastic/elasticsearch/pull/51599#discussion_r374162290", "bodyText": "Thanks, I agree, removed in b6096a9", "author": "henningandersen", "createdAt": "2020-02-03T15:20:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzI4Nzc5OA=="}], "type": "inlineReview"}, {"oid": "b6096a9398a458273c392fcb832e140eaaa73fb2", "url": "https://github.com/elastic/elasticsearch/commit/b6096a9398a458273c392fcb832e140eaaa73fb2", "message": "Review comments:\n\nModify reindex request instead of passing in requestsPerSecond\nRemove rethrottle on .reindex version conflict.", "committedDate": "2020-02-03T14:56:18Z", "type": "commit"}, {"oid": "01841aab22e4bc5489fcf39f4cc004fe3be2d9fc", "url": "https://github.com/elastic/elasticsearch/commit/01841aab22e4bc5489fcf39f4cc004fe3be2d9fc", "message": "checkstyle", "committedDate": "2020-02-03T15:00:46Z", "type": "commit"}, {"oid": "72dff96c1ddd9d5212b3afc1effa10b5b34ffbbd", "url": "https://github.com/elastic/elasticsearch/commit/72dff96c1ddd9d5212b3afc1effa10b5b34ffbbd", "message": "Formatting", "committedDate": "2020-02-03T15:15:51Z", "type": "commit"}, {"oid": "bfe93fb07a1955c4880f5a41999e293eaa99fd89", "url": "https://github.com/elastic/elasticsearch/commit/bfe93fb07a1955c4880f5a41999e293eaa99fd89", "message": "Add copy constructor test.", "committedDate": "2020-02-03T15:16:14Z", "type": "commit"}, {"oid": "ed7e78740bc692aa50cbbf8836a0c077fd4a40d4", "url": "https://github.com/elastic/elasticsearch/commit/ed7e78740bc692aa50cbbf8836a0c077fd4a40d4", "message": "Merge remote-tracking branch 'origin/reindex_v2' into enhance_reindex_rethrottle_via_index", "committedDate": "2020-02-03T19:21:17Z", "type": "commit"}, {"oid": "e18208d24cea4bcda1c557d1649b7625b8ddb6c9", "url": "https://github.com/elastic/elasticsearch/commit/e18208d24cea4bcda1c557d1649b7625b8ddb6c9", "message": "Merge remote-tracking branch 'origin/reindex_v2' into enhance_reindex_rethrottle_via_index", "committedDate": "2020-02-05T08:54:08Z", "type": "commit"}, {"oid": "f15970d716d5a110e03db6131016076a828ff4cd", "url": "https://github.com/elastic/elasticsearch/commit/f15970d716d5a110e03db6131016076a828ff4cd", "message": "Merge remote-tracking branch 'origin/reindex_v2' into enhance_reindex_rethrottle_via_index", "committedDate": "2020-02-05T12:34:44Z", "type": "commit"}]}