{"pr_number": 51456, "pr_title": "Convert ILM and SLM histories into hidden indices", "pr_createdAt": "2020-01-24T23:40:40Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/51456", "timeline": [{"oid": "2ce95f91fce10b462ed1b5cddbb78b84833bf6ea", "url": "https://github.com/elastic/elasticsearch/commit/2ce95f91fce10b462ed1b5cddbb78b84833bf6ea", "message": "Convert ILM and SLM histories into hidden indices\n\nModifies SLM's and ILM's history indices to be hidden indices for added\nprotection against accidental querying and deletion.\n\nAlso modifies the REST test cleanup to delete hidden indices.", "committedDate": "2020-01-24T23:37:51Z", "type": "commit"}, {"oid": "7444cf1990ca5d4909962a07b126973d354b0787", "url": "https://github.com/elastic/elasticsearch/commit/7444cf1990ca5d4909962a07b126973d354b0787", "message": "Merge branch 'master' into hidden/ilm-conversion", "committedDate": "2020-02-03T23:29:04Z", "type": "commit"}, {"oid": "25838802d3ad0a42346883515dbf6ab3b335faec", "url": "https://github.com/elastic/elasticsearch/commit/25838802d3ad0a42346883515dbf6ab3b335faec", "message": "Make IndexTemplateRegistry upgrade templates if necessary", "committedDate": "2020-02-04T01:37:01Z", "type": "commit"}, {"oid": "5751c884295c8b889cd04eda7823a4976cbd3bc8", "url": "https://github.com/elastic/elasticsearch/commit/5751c884295c8b889cd04eda7823a4976cbd3bc8", "message": "Update Javadoc", "committedDate": "2020-02-04T01:47:19Z", "type": "commit"}, {"oid": "668a565d1b5a02a924f43c85c9235229794f7188", "url": "https://github.com/elastic/elasticsearch/commit/668a565d1b5a02a924f43c85c9235229794f7188", "message": "Adjust hidden index cleanup logic to check versions", "committedDate": "2020-02-04T23:00:14Z", "type": "commit"}, {"oid": "d20ac8a4e76c07763aa88f2040210f04bd73e981", "url": "https://github.com/elastic/elasticsearch/commit/d20ac8a4e76c07763aa88f2040210f04bd73e981", "message": "Merge branch 'master' into hidden/ilm-conversion", "committedDate": "2020-02-04T23:00:36Z", "type": "commit"}, {"oid": "f3f1fe9e23ff0880cbfec770461347e412e17d9b", "url": "https://github.com/elastic/elasticsearch/commit/f3f1fe9e23ff0880cbfec770461347e412e17d9b", "message": "Merge branch 'master' into hidden/ilm-conversion", "committedDate": "2020-02-05T00:12:02Z", "type": "commit"}, {"oid": "6ea4847b34ffdc9ed8601fad7b637ee83399217c", "url": "https://github.com/elastic/elasticsearch/commit/6ea4847b34ffdc9ed8601fad7b637ee83399217c", "message": "Merge branch 'master' into hidden/ilm-conversion", "committedDate": "2020-02-05T18:05:04Z", "type": "commit"}, {"oid": "b798cf431b673f12735a012a5f9042825fa52e43", "url": "https://github.com/elastic/elasticsearch/commit/b798cf431b673f12735a012a5f9042825fa52e43", "message": "Add tests for Snapshot registry (& fix a bit of logic)", "committedDate": "2020-02-05T22:25:05Z", "type": "commit"}, {"oid": "7cbc95cd16c8987d8d4b8adabe1e6410381e8c35", "url": "https://github.com/elastic/elasticsearch/commit/7cbc95cd16c8987d8d4b8adabe1e6410381e8c35", "message": "Merge branch 'master' into hidden/ilm-conversion", "committedDate": "2020-02-05T22:42:06Z", "type": "commit"}, {"oid": "0f7fedc548d72c736293697aa3bbf508037df8ea", "url": "https://github.com/elastic/elasticsearch/commit/0f7fedc548d72c736293697aa3bbf508037df8ea", "message": "Fix Watcher tests", "committedDate": "2020-02-05T23:36:38Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTU3NTYzMQ==", "url": "https://github.com/elastic/elasticsearch/pull/51456#discussion_r375575631", "bodyText": "I'm curious about this change, why the change to validation post-filter? Was it causing an issue?", "author": "dakrone", "createdAt": "2020-02-05T23:59:39Z", "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/template/TemplateUtils.java", "diffHunk": "@@ -59,9 +59,10 @@ public static void loadTemplateIntoMap(String resource, Map<String, IndexTemplat\n     public static String loadTemplate(String resource, String version, String versionProperty) {\n         try {\n             BytesReference source = load(resource);\n-            validate(source);\n+            final String filteredJson = filter(source, version, versionProperty);\n+            validate(new BytesArray(filteredJson));", "originalCommit": "0f7fedc548d72c736293697aa3bbf508037df8ea", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTU3Njk5Nw==", "url": "https://github.com/elastic/elasticsearch/pull/51456#discussion_r375576997", "bodyText": "Yes, bare placeholders (e.g. \"version\": ${my.variable}) didn't work with the validation before the variable replacement because that's not valid JSON, and version must be a bare integer, not a string. Previously, all variables were strings (e.g. \"field\": \"${my.variable}\", note the quotes around the variable).\nBesides, it's more important that the JSON is valid after we do the variable replacement, rather than before, isn't it?", "author": "gwbrown", "createdAt": "2020-02-06T00:04:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTU3NTYzMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTU4MDA1Nw==", "url": "https://github.com/elastic/elasticsearch/pull/51456#discussion_r375580057", "bodyText": "The name \"filter\" makes it seem like the filteredJson is a subset of the original, in which case I would think it makes sense to validate the entire JSON instead of a subset. With your explanation it definitely makes sense (the name is just misleading).", "author": "dakrone", "createdAt": "2020-02-06T00:15:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTU3NTYzMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTU5NTk2Mw==", "url": "https://github.com/elastic/elasticsearch/pull/51456#discussion_r375595963", "bodyText": "It is a misleading name - I would have taken the opportunity to change it, but Dimitris is going to do so in #51765, as part of modifying IndexTemplateRegistry (and associated classes) to allow other variable substitutions in addition to the version.", "author": "gwbrown", "createdAt": "2020-02-06T01:14:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTU3NTYzMQ=="}], "type": "inlineReview"}, {"oid": "49a3f233ad1632b48e15ef1c3a2e6daf008e5d1d", "url": "https://github.com/elastic/elasticsearch/commit/49a3f233ad1632b48e15ef1c3a2e6daf008e5d1d", "message": "Get minimum node version using admin client", "committedDate": "2020-02-06T01:04:21Z", "type": "commit"}, {"oid": "e5912bae8c79f133b2feee3ddd4366fc3487559c", "url": "https://github.com/elastic/elasticsearch/commit/e5912bae8c79f133b2feee3ddd4366fc3487559c", "message": "Merge branch 'master' into hidden/ilm-conversion", "committedDate": "2020-02-06T17:43:25Z", "type": "commit"}, {"oid": "6151aabd1802ed3d0b16f7eafd41f12c8fdb6d91", "url": "https://github.com/elastic/elasticsearch/commit/6151aabd1802ed3d0b16f7eafd41f12c8fdb6d91", "message": "Merge branch 'master' into hidden/ilm-conversion", "committedDate": "2020-02-07T17:39:03Z", "type": "commit"}, {"oid": "ae2206f16f4453958e3d4e966a0235e4c4223c1a", "url": "https://github.com/elastic/elasticsearch/commit/ae2206f16f4453958e3d4e966a0235e4c4223c1a", "message": "Merge branch 'master' into hidden/ilm-conversion", "committedDate": "2020-02-10T23:10:23Z", "type": "commit"}, {"oid": "c38fa1dd4f14a57ca578bfb80b55ed59737fd9fa", "url": "https://github.com/elastic/elasticsearch/commit/c38fa1dd4f14a57ca578bfb80b55ed59737fd9fa", "message": "Remove SLM patterns from exclusion list", "committedDate": "2020-02-10T23:23:58Z", "type": "commit"}]}