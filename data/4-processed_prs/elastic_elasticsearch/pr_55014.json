{"pr_number": 55014, "pr_title": "Deprecate local parameter for get field mapping request", "pr_createdAt": "2020-04-09T14:42:08Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/55014", "timeline": [{"oid": "fb36a516d403186c362ba506e9fb060d30a34eba", "url": "https://github.com/elastic/elasticsearch/commit/fb36a516d403186c362ba506e9fb060d30a34eba", "message": "Add deprecation message for local parameter", "committedDate": "2020-04-09T14:05:07Z", "type": "commit"}, {"oid": "1a8bd104581e07e77285b4960ad1f4bee632092c", "url": "https://github.com/elastic/elasticsearch/commit/1a8bd104581e07e77285b4960ad1f4bee632092c", "message": "Add test for deprecation message", "committedDate": "2020-04-09T14:32:29Z", "type": "commit"}, {"oid": "f6b598e71a3ef7a44741ceef227214c603f6dd89", "url": "https://github.com/elastic/elasticsearch/commit/f6b598e71a3ef7a44741ceef227214c603f6dd89", "message": "Remove extra blank line", "committedDate": "2020-04-09T14:42:49Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjI5MzMzNg==", "url": "https://github.com/elastic/elasticsearch/pull/55014#discussion_r406293336", "bodyText": "Maybe add a space between the two sentences?", "author": "martijnvg", "createdAt": "2020-04-09T15:35:36Z", "path": "server/src/main/java/org/elasticsearch/rest/action/admin/indices/RestGetFieldMappingAction.java", "diffHunk": "@@ -63,6 +70,12 @@ public RestChannelConsumer prepareRequest(final RestRequest request, final NodeC\n         GetFieldMappingsRequest getMappingsRequest = new GetFieldMappingsRequest();\n         getMappingsRequest.indices(indices).fields(fields).includeDefaults(request.paramAsBoolean(\"include_defaults\", false));\n         getMappingsRequest.indicesOptions(IndicesOptions.fromRequest(request, getMappingsRequest.indicesOptions()));\n+\n+        if (request.hasParam(\"local\")) {\n+            deprecationLogger.deprecatedAndMaybeLog(\"get_field_mapping_local\",\n+                \"Use [local] in get field mapping requests is deprecated.\"\n+                    + \"The parameter will be removed in the next major version\");", "originalCommit": "f6b598e71a3ef7a44741ceef227214c603f6dd89", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjMwMjU1MQ==", "url": "https://github.com/elastic/elasticsearch/pull/55014#discussion_r406302551", "bodyText": "Yep, added.", "author": "ywangd", "createdAt": "2020-04-09T15:49:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjI5MzMzNg=="}], "type": "inlineReview"}, {"oid": "f560f342cec8f9dfea9d689834616f69d88efc5a", "url": "https://github.com/elastic/elasticsearch/commit/f560f342cec8f9dfea9d689834616f69d88efc5a", "message": "Fix test failures", "committedDate": "2020-04-09T15:44:37Z", "type": "commit"}, {"oid": "d9f69069063e08bb6d9f1de0b90b067109b79cc1", "url": "https://github.com/elastic/elasticsearch/commit/d9f69069063e08bb6d9f1de0b90b067109b79cc1", "message": "Address feedback", "committedDate": "2020-04-09T15:47:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjMxOTUyNg==", "url": "https://github.com/elastic/elasticsearch/pull/55014#discussion_r406319526", "bodyText": "I would add that the parameter currently is just a noop.\nCan you also update the migrate_7_8.asciidoc file when backporting this change to the 7.x branch?", "author": "martijnvg", "createdAt": "2020-04-09T16:16:25Z", "path": "docs/reference/indices/get-field-mapping.asciidoc", "diffHunk": "@@ -48,7 +48,11 @@ include::{docdir}/rest-api/common-parms.asciidoc[tag=index-ignore-unavailable]\n (Optional, boolean) If `true`, the response includes default mapping values.\n Defaults to `false`.\n \n-include::{docdir}/rest-api/common-parms.asciidoc[tag=local]\n+`local`::\n+deprecated:[7.8.0, Field mappings are always retrieved locally]\n+(Optional, boolean) If `true`, the request retrieves information from the local\n+node only. Defaults to `false`, which means information is retrieved from\n+the master node.", "originalCommit": "d9f69069063e08bb6d9f1de0b90b067109b79cc1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjU5NjEyOQ==", "url": "https://github.com/elastic/elasticsearch/pull/55014#discussion_r406596129", "bodyText": "Added.  Thanks for the heads up about the migrate doc. Will do for 7.x.", "author": "ywangd", "createdAt": "2020-04-10T04:23:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjMxOTUyNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjMxOTk1OQ==", "url": "https://github.com/elastic/elasticsearch/pull/55014#discussion_r406319959", "bodyText": "\ud83d\udc4d", "author": "martijnvg", "createdAt": "2020-04-09T16:17:04Z", "path": "client/rest-high-level/src/test/java/org/elasticsearch/client/documentation/IndicesClientDocumentationIT.java", "diffHunk": "@@ -705,11 +707,12 @@ public void testGetFieldMapping() throws IOException, InterruptedException {\n         request.local(true); // <1>\n         // end::get-field-mappings-request-local\n \n-        {\n+        final RequestOptions requestOptions = RequestOptions.DEFAULT.toBuilder().setWarningsHandler(WarningsHandler.PERMISSIVE).build();", "originalCommit": "d9f69069063e08bb6d9f1de0b90b067109b79cc1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjU5Njc2OA==", "url": "https://github.com/elastic/elasticsearch/pull/55014#discussion_r406596768", "bodyText": "Followed your suggestion to add deprecated annotation to GetFieldMappingsRequest#local(..) methods and removed it from the conversion.  It works better and this change to RequestOptions is no longer necessary.", "author": "ywangd", "createdAt": "2020-04-10T04:27:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjMxOTk1OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjMyMDE2Ng==", "url": "https://github.com/elastic/elasticsearch/pull/55014#discussion_r406320166", "bodyText": "I think a space would need to be added here, otherwise this test will fail.", "author": "martijnvg", "createdAt": "2020-04-09T16:17:27Z", "path": "rest-api-spec/src/main/resources/rest-api-spec/test/indices.get_field_mapping/10_basic.yml", "diffHunk": "@@ -50,3 +50,20 @@ setup:\n \n   - match: {test_index.mappings.text.mapping.text.type:     text}\n   - match: {test_index.mappings.text.mapping.text.analyzer: default}\n+\n+---\n+\"Get field mapping with local is deprecated\":\n+\n+  - skip:\n+      features: [\"warnings\", \"node_selector\"]\n+\n+  - do:\n+      node_selector:\n+        version: \"7.8.0 - \"\n+      warnings:\n+        - \"Use [local] in get field mapping requests is deprecated.The parameter will be removed in the next major version\"", "originalCommit": "d9f69069063e08bb6d9f1de0b90b067109b79cc1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjU5NjI1Mw==", "url": "https://github.com/elastic/elasticsearch/pull/55014#discussion_r406596253", "bodyText": "Good catch. It indeed failed for many of the CI tests ...", "author": "ywangd", "createdAt": "2020-04-10T04:23:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjMyMDE2Ng=="}], "type": "inlineReview"}, {"oid": "cd8b08f426c71ce1484f3d4c4c2b83f4960b9e47", "url": "https://github.com/elastic/elasticsearch/commit/cd8b08f426c71ce1484f3d4c4c2b83f4960b9e47", "message": "Fix tests and address feedback", "committedDate": "2020-04-10T04:21:16Z", "type": "commit"}, {"oid": "acb214020fdb1ec303a957f28b6fbc6c73710255", "url": "https://github.com/elastic/elasticsearch/commit/acb214020fdb1ec303a957f28b6fbc6c73710255", "message": "Fix test failure", "committedDate": "2020-04-10T04:42:08Z", "type": "commit"}, {"oid": "bf911a6207e7297dc4ba9750e0a3c68466ecacc0", "url": "https://github.com/elastic/elasticsearch/commit/bf911a6207e7297dc4ba9750e0a3c68466ecacc0", "message": "Test deprecation message only for v8.0.0 before backport", "committedDate": "2020-04-10T05:07:26Z", "type": "commit"}, {"oid": "64d718d7e41e4170013c3ae3eb064d2f50db01c3", "url": "https://github.com/elastic/elasticsearch/commit/64d718d7e41e4170013c3ae3eb064d2f50db01c3", "message": "Merge remote-tracking branch 'origin/master' into deprecate-get-field-mapping-local", "committedDate": "2020-04-12T01:28:10Z", "type": "commit"}]}