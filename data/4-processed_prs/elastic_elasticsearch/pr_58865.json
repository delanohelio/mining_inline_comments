{"pr_number": 58865, "pr_title": "[DOCS] Adding delete snapshot API docs.", "pr_createdAt": "2020-07-01T16:49:06Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/58865", "timeline": [{"oid": "3792da5ad72226e3905608c7f6a6d45981a644be", "url": "https://github.com/elastic/elasticsearch/commit/3792da5ad72226e3905608c7f6a6d45981a644be", "message": "[DOCS] Adding delete snapshot API docs.", "committedDate": "2020-07-01T16:46:21Z", "type": "commit"}, {"oid": "290d22acb63a9dffed9a78b855cd09ca7b590319", "url": "https://github.com/elastic/elasticsearch/commit/290d22acb63a9dffed9a78b855cd09ca7b590319", "message": "Adding TESTSETUP snippets and fixing original TEST.", "committedDate": "2020-07-01T17:18:56Z", "type": "commit"}, {"oid": "8e72065110091a6c4a0c8e23a3b092ac0631f501", "url": "https://github.com/elastic/elasticsearch/commit/8e72065110091a6c4a0c8e23a3b092ac0631f501", "message": "Removing extraneous TESTSETUP.", "committedDate": "2020-07-01T17:31:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODUxNDEwNw==", "url": "https://github.com/elastic/elasticsearch/pull/58865#discussion_r448514107", "bodyText": "This is a little confusing with the explicit mentioning of the unique name requirement. Maybe just say something along the lines of \"comma separated list of snapshot names to delete, accepts wild cards\"?", "author": "original-brownbear", "createdAt": "2020-07-01T17:30:56Z", "path": "docs/reference/snapshot-restore/apis/delete-snapshot-api.asciidoc", "diffHunk": "@@ -0,0 +1,92 @@\n+[[delete-snapshot-api]]\n+=== Delete snapshot API\n+++++\n+<titleabbrev>Delete snapshot</titleabbrev>\n+++++\n+\n+Deletes a <<snapshot-restore,snapshot>> of a cluster or specified data streams and\n+indices.\n+\n+////\n+[source,console]\n+----\n+PUT /_snapshot/my_repository\n+{\n+  \"type\": \"fs\",\n+  \"settings\": {\n+    \"location\": \"my_backup_location\"\n+  }\n+}\n+----\n+// TESTSETUP\n+////\n+\n+////\n+[source,console]\n+----\n+PUT /_snapshot/my_repository/snapshot_2?wait_for_completion=true\n+{\n+  \"indices\": [],\n+  \"ignore_unavailable\": true,\n+  \"include_global_state\": false,\n+  \"metadata\": {\n+    \"taken_by\": \"user123\",\n+    \"taken_because\": \"backup\"\n+  }\n+}\n+// TESTSETUP\n+////\n+\n+[source,console]\n+-----------------------------------\n+DELETE /_snapshot/my_repository/my_snapshot\n+-----------------------------------\n+// TEST[s/my_snapshot/my_snapshot]\n+\n+[[delete-snapshot-api-request]]\n+==== {api-request-title}\n+\n+`DELETE /_snapshot/<repository>/<snapshot>`\n+\n+[[delete-snapshot-api-desc]]\n+==== {api-description-title}\n+\n+Use the delete snapshot API to delete a <<snapshot-restore,snapshot>>, which is a backup taken from a running {es} cluster.\n+\n+When deleting a snapshot from a repository, {es} deletes all files that are associated with the snapshot and not used by any other snapshots. All files that are shared with at least one other existing snapshot are left intact.\n+\n+If you attempt to delete a snapshot while it is being created, the snapshot process aborts and all associated will be deleted.\n+\n+To delete multiple snapshots in a single request, separate the snapshot names with a comma or use a wildcard (`*`).\n+\n+TIP: Use the delete snapshot API to cancel long-running snapshot operations that were started by mistake.\n+\n+[[delete-snapshot-api-path-params]]\n+==== {api-path-parms-title}\n+\n+`<repository>`::\n+(Required, string)\n+Name of the repository to delete a snapshot from.\n+\n+`<snapshot>`::\n+(Required, string)\n+Name of the snapshot to delete. This name must be unique in the snapshot repository.", "originalCommit": "290d22acb63a9dffed9a78b855cd09ca7b590319", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODUxNjExOQ==", "url": "https://github.com/elastic/elasticsearch/pull/58865#discussion_r448516119", "bodyText": "Agreed. This revision seems more descriptive:\n\nComma-separated list of snapshot names to delete. Also accepts wildcards (*).", "author": "lockewritesdocs", "createdAt": "2020-07-01T17:34:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODUxNDEwNw=="}], "type": "inlineReview"}, {"oid": "e0585c4e50a2964cc5df940836091d0ee7cc58e3", "url": "https://github.com/elastic/elasticsearch/commit/e0585c4e50a2964cc5df940836091d0ee7cc58e3", "message": "Revising <snapshot> description.", "committedDate": "2020-07-01T17:35:52Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODUxNTY5NA==", "url": "https://github.com/elastic/elasticsearch/pull/58865#discussion_r448515694", "bodyText": "I don't think the snapshot contents are particularly relevant here.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Deletes a <<snapshot-restore,snapshot>> of a cluster or specified data streams and\n          \n          \n            \n            indices.\n          \n          \n            \n            Deletes a <<snapshot-restore,snapshot>>.", "author": "jrodewig", "createdAt": "2020-07-01T17:33:57Z", "path": "docs/reference/snapshot-restore/apis/delete-snapshot-api.asciidoc", "diffHunk": "@@ -0,0 +1,76 @@\n+[[delete-snapshot-api]]\n+=== Delete snapshot API\n+++++\n+<titleabbrev>Delete snapshot</titleabbrev>\n+++++\n+\n+Deletes a <<snapshot-restore,snapshot>> of a cluster or specified data streams and\n+indices.", "originalCommit": "8e72065110091a6c4a0c8e23a3b092ac0631f501", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODUxNjU2MA==", "url": "https://github.com/elastic/elasticsearch/pull/58865#discussion_r448516560", "bodyText": "You need to create the my_snapshot, snapshot_2, and snapshot_3 snapshots so you can delete them later.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            ----\n          \n          \n            \n            // TESTSETUP\n          \n          \n            \n            ////\n          \n          \n            \n            \n          \n          \n            \n            PUT /_snapshot/my_repository/my_snapshot?wait_for_completion=true\n          \n          \n            \n            \n          \n          \n            \n            PUT /_snapshot/my_repository/snapshot_2?wait_for_completion=true\n          \n          \n            \n            \n          \n          \n            \n            PUT /_snapshot/my_repository/snapshot_3?wait_for_completion=true\n          \n          \n            \n            ----\n          \n          \n            \n            // TESTSETUP\n          \n          \n            \n            ////", "author": "jrodewig", "createdAt": "2020-07-01T17:35:37Z", "path": "docs/reference/snapshot-restore/apis/delete-snapshot-api.asciidoc", "diffHunk": "@@ -0,0 +1,76 @@\n+[[delete-snapshot-api]]\n+=== Delete snapshot API\n+++++\n+<titleabbrev>Delete snapshot</titleabbrev>\n+++++\n+\n+Deletes a <<snapshot-restore,snapshot>> of a cluster or specified data streams and\n+indices.\n+\n+////\n+[source,console]\n+----\n+PUT /_snapshot/my_repository\n+{\n+  \"type\": \"fs\",\n+  \"settings\": {\n+    \"location\": \"my_backup_location\"\n+  }\n+}\n+----\n+// TESTSETUP\n+////", "originalCommit": "8e72065110091a6c4a0c8e23a3b092ac0631f501", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODUyOTY4OA==", "url": "https://github.com/elastic/elasticsearch/pull/58865#discussion_r448529688", "bodyText": "Ahhh, that was the issue. I knew that something was wrong with the TESTSETUP but couldn't pinpoint the issue. Thanks!", "author": "lockewritesdocs", "createdAt": "2020-07-01T18:00:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODUxNjU2MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODUxNjgxMg==", "url": "https://github.com/elastic/elasticsearch/pull/58865#discussion_r448516812", "bodyText": "I don't think this // TEST comment does anything. You can probably remove it.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            // TEST[s/my_snapshot/my_snapshot]", "author": "jrodewig", "createdAt": "2020-07-01T17:36:05Z", "path": "docs/reference/snapshot-restore/apis/delete-snapshot-api.asciidoc", "diffHunk": "@@ -0,0 +1,76 @@\n+[[delete-snapshot-api]]\n+=== Delete snapshot API\n+++++\n+<titleabbrev>Delete snapshot</titleabbrev>\n+++++\n+\n+Deletes a <<snapshot-restore,snapshot>> of a cluster or specified data streams and\n+indices.\n+\n+////\n+[source,console]\n+----\n+PUT /_snapshot/my_repository\n+{\n+  \"type\": \"fs\",\n+  \"settings\": {\n+    \"location\": \"my_backup_location\"\n+  }\n+}\n+----\n+// TESTSETUP\n+////\n+\n+[source,console]\n+-----------------------------------\n+DELETE /_snapshot/my_repository/my_snapshot\n+-----------------------------------\n+// TEST[s/my_snapshot/my_snapshot]", "originalCommit": "8e72065110091a6c4a0c8e23a3b092ac0631f501", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODUyMjI1Nw==", "url": "https://github.com/elastic/elasticsearch/pull/58865#discussion_r448522257", "bodyText": "Funny you say that, because I just removed that TEST \ud83d\ude06", "author": "lockewritesdocs", "createdAt": "2020-07-01T17:46:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODUxNjgxMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODUxNzYxMw==", "url": "https://github.com/elastic/elasticsearch/pull/58865#discussion_r448517613", "bodyText": "Technically, you can do both. DELETE /_snapshot/my_repository/test1*,*test2* should be valid.", "author": "jrodewig", "createdAt": "2020-07-01T17:37:39Z", "path": "docs/reference/snapshot-restore/apis/delete-snapshot-api.asciidoc", "diffHunk": "@@ -0,0 +1,76 @@\n+[[delete-snapshot-api]]\n+=== Delete snapshot API\n+++++\n+<titleabbrev>Delete snapshot</titleabbrev>\n+++++\n+\n+Deletes a <<snapshot-restore,snapshot>> of a cluster or specified data streams and\n+indices.\n+\n+////\n+[source,console]\n+----\n+PUT /_snapshot/my_repository\n+{\n+  \"type\": \"fs\",\n+  \"settings\": {\n+    \"location\": \"my_backup_location\"\n+  }\n+}\n+----\n+// TESTSETUP\n+////\n+\n+[source,console]\n+-----------------------------------\n+DELETE /_snapshot/my_repository/my_snapshot\n+-----------------------------------\n+// TEST[s/my_snapshot/my_snapshot]\n+\n+[[delete-snapshot-api-request]]\n+==== {api-request-title}\n+\n+`DELETE /_snapshot/<repository>/<snapshot>`\n+\n+[[delete-snapshot-api-desc]]\n+==== {api-description-title}\n+\n+Use the delete snapshot API to delete a <<snapshot-restore,snapshot>>, which is a backup taken from a running {es} cluster.\n+\n+When deleting a snapshot from a repository, {es} deletes all files that are associated with the snapshot and not used by any other snapshots. All files that are shared with at least one other existing snapshot are left intact.\n+\n+If you attempt to delete a snapshot while it is being created, the snapshot process aborts and all associated will be deleted.\n+\n+To delete multiple snapshots in a single request, separate the snapshot names with a comma or use a wildcard (`*`).", "originalCommit": "8e72065110091a6c4a0c8e23a3b092ac0631f501", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODUyMDM3Mg==", "url": "https://github.com/elastic/elasticsearch/pull/58865#discussion_r448520372", "bodyText": "Not a blocker for this PR, but we should probably discuss whether we want APIs to be sorted alphabetically or not in the docs.\nThe order you have here makes sense to me, but it doesn't work for every API suite. You mind raising this in the next ES writers meeting?", "author": "jrodewig", "createdAt": "2020-07-01T17:42:57Z", "path": "docs/reference/snapshot-restore/apis/snapshot-restore-apis.asciidoc", "diffHunk": "@@ -15,21 +15,22 @@ content may not be included yet.\n [discrete]\n [[snapshot-restore-repo-apis]]\n === Snapshot repository management APIs\n-\n-* <<clean-up-snapshot-repo-api,Clean up snapshot repository>>\n-* <<delete-snapshot-repo-api,Delete snapshot repository>>\n-* <<get-snapshot-repo-api,Get snapshot repository>>\n * <<put-snapshot-repo-api,Put snapshot repository>>\n * <<verify-snapshot-repo-api,Verify snapshot repository>>\n+* <<get-snapshot-repo-api,Get snapshot repository>>\n+* <<delete-snapshot-repo-api,Delete snapshot repository>>\n+* <<clean-up-snapshot-repo-api,Clean up snapshot repository>>", "originalCommit": "e0585c4e50a2964cc5df940836091d0ee7cc58e3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODUyMzkyNQ==", "url": "https://github.com/elastic/elasticsearch/pull/58865#discussion_r448523925", "bodyText": "My thinking is that we order the APIs in the way that they are used. For example, Delete comes before Put alphabetically, but you cannot delete a snapshot or a repository if you haven't first used a put operation first. I'll make a note to discuss at the meeting \ud83d\udc4d", "author": "lockewritesdocs", "createdAt": "2020-07-01T17:49:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODUyMDM3Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODUyNjA1MQ==", "url": "https://github.com/elastic/elasticsearch/pull/58865#discussion_r448526051", "bodyText": "That makes sense for CRUD-only APIs, but some of our resources support more complicated operations. Indices are a good example:\nhttps://www.elastic.co/guide/en/elasticsearch/reference/master/indices.html\nThat logic becomes harder to follow there.\nI don't feel strongly either way, but we probably want to be consistent.", "author": "jrodewig", "createdAt": "2020-07-01T17:53:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODUyMDM3Mg=="}], "type": "inlineReview"}, {"oid": "0d5795cb6152f1db107b7bdf9adb448d62f1d99d", "url": "https://github.com/elastic/elasticsearch/commit/0d5795cb6152f1db107b7bdf9adb448d62f1d99d", "message": "Removing TEST.", "committedDate": "2020-07-01T17:44:29Z", "type": "commit"}, {"oid": "c589fdfd446acc1c7b174b0f4b01b0730563a111", "url": "https://github.com/elastic/elasticsearch/commit/c589fdfd446acc1c7b174b0f4b01b0730563a111", "message": "Streamline delete API description.\n\nCo-authored-by: James Rodewig <james.rodewig@elastic.co>", "committedDate": "2020-07-01T17:54:32Z", "type": "commit"}, {"oid": "7311663bf6e5dfb05f6d8f33955fa3c4e4289633", "url": "https://github.com/elastic/elasticsearch/commit/7311663bf6e5dfb05f6d8f33955fa3c4e4289633", "message": "Improve TESTSETUP for snippets\n\nCo-authored-by: James Rodewig <james.rodewig@elastic.co>", "committedDate": "2020-07-01T18:02:31Z", "type": "commit"}]}