{"pr_number": 53962, "pr_title": "Upgrade to AWS SDK 1.11.749", "pr_createdAt": "2020-03-23T10:12:03Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/53962", "timeline": [{"oid": "6586f07e4fb0c87ab54401b6848ff7ca01a86562", "url": "https://github.com/elastic/elasticsearch/commit/6586f07e4fb0c87ab54401b6848ff7ca01a86562", "message": "Upgrade to AWS SDK 1.11.749\n\nUpgrading AWS SDK to v1.11.749.\nRequired building clients inside privileged contexts because some class loading that requires privileges now happens there\nand working around a new SDK bug in the S3 client builder.\n\nCloses #53191", "committedDate": "2020-03-23T10:11:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjM5NjEzMA==", "url": "https://github.com/elastic/elasticsearch/pull/53962#discussion_r396396130", "bodyText": ":(", "author": "tlrx", "createdAt": "2020-03-23T11:54:34Z", "path": "plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/S3Service.java", "diffHunk": "@@ -141,7 +141,12 @@ AmazonS3 buildClient(final S3ClientSettings clientSettings) {\n         builder.withCredentials(buildCredentials(logger, clientSettings));\n         builder.withClientConfiguration(buildConfiguration(clientSettings));\n \n-        final String endpoint = Strings.hasLength(clientSettings.endpoint) ? clientSettings.endpoint : Constants.S3_HOSTNAME;\n+        String endpoint = Strings.hasLength(clientSettings.endpoint) ? clientSettings.endpoint : Constants.S3_HOSTNAME;\n+        if ((endpoint.startsWith(\"http://\") || endpoint.startsWith(\"https://\")) == false) {\n+            // Manually add the schema to the endpoint to work around https://github.com/aws/aws-sdk-java/issues/2274\n+            // TODO: Remove this once fixed in the AWS SDK\n+            endpoint = clientSettings.protocol.toString() + \"://\" + endpoint;", "originalCommit": "6586f07e4fb0c87ab54401b6848ff7ca01a86562", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}