{"pr_number": 66616, "pr_title": "[DOCS] Clarify use of CCS on ML nodes", "pr_createdAt": "2020-12-18T17:43:33Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/66616", "timeline": [{"oid": "4bf0c290422306f6c1755434b89eac777cb40481", "url": "https://github.com/elastic/elasticsearch/commit/4bf0c290422306f6c1755434b89eac777cb40481", "message": "[DOCS] Clarify use of CCS on ML nodes", "committedDate": "2020-12-18T17:41:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjAxMzI1Mw==", "url": "https://github.com/elastic/elasticsearch/pull/66616#discussion_r546013253", "bodyText": "I think we need some clarification on whether a node with ml and remote_cluster_client is still considered a dedicated ML node.  I think it should still be:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            roles. See <<remote-node>>.\n          \n          \n            \n            roles. See <<remote-node>>.  A node with both the `ml` and `remote_cluster_client` roles\n          \n          \n            \n            but no others is still considered a dedicated {ml} node.", "author": "droberts195", "createdAt": "2020-12-18T18:29:23Z", "path": "docs/reference/modules/node.asciidoc", "diffHunk": "@@ -340,6 +340,9 @@ xpack.ml.enabled: true <1>\n ----\n <1> The `xpack.ml.enabled` setting is enabled by default.\n \n+If you want the node to use {ccs}, add `remote_cluster_client` to the list of\n+roles. See <<remote-node>>.", "originalCommit": "4bf0c290422306f6c1755434b89eac777cb40481", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjAxMzQ3Ng==", "url": "https://github.com/elastic/elasticsearch/pull/66616#discussion_r546013476", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            roles. See <<remote-node>>.\n          \n          \n            \n            roles. See <<remote-node>>.  A node with both the `transform` and `remote_cluster_client` roles\n          \n          \n            \n            but no others is still considered a dedicated {transform} node.", "author": "droberts195", "createdAt": "2020-12-18T18:29:53Z", "path": "docs/reference/modules/node.asciidoc", "diffHunk": "@@ -354,6 +357,9 @@ To create a dedicated {transform} node in the {default-dist}, set:\n node.roles: [ transform ]\n ----\n \n+If you want the node to use {ccs}, add `remote_cluster_client` to the list of\n+roles. See <<remote-node>>.", "originalCommit": "4bf0c290422306f6c1755434b89eac777cb40481", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjAxNjI3Mw==", "url": "https://github.com/elastic/elasticsearch/pull/66616#discussion_r546016273", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \n          \n          \n            \n            \n          \n          \n            \n            If you are using {ccs} in any way it is strongly recommended to allow {ml} nodes to do remote searches unless you have a very good reason not to. It will likely lead to confusion and frustration if cross cluster searches usually work perfectly but fail when used in {ml} job or {dfeed} configs.", "author": "droberts195", "createdAt": "2020-12-18T18:35:36Z", "path": "docs/reference/modules/node.asciidoc", "diffHunk": "@@ -340,6 +340,9 @@ xpack.ml.enabled: true <1>\n ----\n <1> The `xpack.ml.enabled` setting is enabled by default.\n \n+If you want the node to use {ccs}, add `remote_cluster_client` to the list of\n+roles. See <<remote-node>>.\n+", "originalCommit": "4bf0c290422306f6c1755434b89eac777cb40481", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjAxNjU3Ng==", "url": "https://github.com/elastic/elasticsearch/pull/66616#discussion_r546016576", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \n          \n          \n            \n            \n          \n          \n            \n            If you are using {ccs} in any way it is strongly recommended to allow {transform} nodes to do remote searches unless you have a very good reason not to. It will likely lead to confusion and frustration if cross cluster searches usually work perfectly but fail when used in {transform} configs.", "author": "droberts195", "createdAt": "2020-12-18T18:36:08Z", "path": "docs/reference/modules/node.asciidoc", "diffHunk": "@@ -354,6 +357,9 @@ To create a dedicated {transform} node in the {default-dist}, set:\n node.roles: [ transform ]\n ----\n \n+If you want the node to use {ccs}, add `remote_cluster_client` to the list of\n+roles. See <<remote-node>>.\n+", "originalCommit": "4bf0c290422306f6c1755434b89eac777cb40481", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "fceb692e140949105eab69f618ccbf9c94b91539", "url": "https://github.com/elastic/elasticsearch/commit/fceb692e140949105eab69f618ccbf9c94b91539", "message": "[DOCS] Add recommendation to ML and transform node settings", "committedDate": "2020-12-18T20:55:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjY3NzcwMw==", "url": "https://github.com/elastic/elasticsearch/pull/66616#discussion_r546677703", "bodyText": "This is now very complicated.  I don't think you should use the phrase \"generic data nodes\", because what does that mean?\nIf you specify node.data: true, don't specify node.roles at all and don't specify node.transform at all then the node is a transform node.  (node.data and node.transform are old deprecated settings that will not work at all in 8.x.  So the \"by default\" statement used to make sense before node.roles was introduced.)\nIf you specify node.roles: [ data ] then the node is not a transform node.\nIf you don't specify any node role settings (old or new) then the node is both a data node and a transform node (and every other type of node).  So the \"by default\" bit makes sense in this case, but for production it's an edge case.\nA data/transform node that specifies node.roles needs to explicitly say both, for example, node.roles: [ data, transform ] or node.roles: [ data_hot, transform, remote_cluster_client ].", "author": "droberts195", "createdAt": "2020-12-21T12:24:51Z", "path": "docs/reference/settings/transform-settings.asciidoc", "diffHunk": "@@ -17,13 +17,18 @@ default.\n `node.roles: [ transform ]`::\n (<<static-cluster-setting,Static>>) Set `node.roles` to contain `transform` to\n identify the node as a _transform node_. If you use the default settings for a\n-node, it does not have the `transform` role.\n+node, it does not have the `transform` role. However, by default all generic\n+data nodes are also {transform} nodes.", "originalCommit": "fceb692e140949105eab69f618ccbf9c94b91539", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njg3MzkwNQ==", "url": "https://github.com/elastic/elasticsearch/pull/66616#discussion_r546873905", "bodyText": "Thanks for the explanation!  I've removed \"All data nodes are also transform nodes\" from the node settings page and re-worked the details in the transform and ML settings pages to try to make this clearer.", "author": "lcawl", "createdAt": "2020-12-21T18:55:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjY3NzcwMw=="}], "type": "inlineReview"}, {"oid": "073e64d9ee681c70cd7a2e076a40d8c7a44c590f", "url": "https://github.com/elastic/elasticsearch/commit/073e64d9ee681c70cd7a2e076a40d8c7a44c590f", "message": "[DOCS] Clarifies default transform node behaviour", "committedDate": "2020-12-21T18:53:00Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzE3NDM4Mg==", "url": "https://github.com/elastic/elasticsearch/pull/66616#discussion_r547174382", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            {transform} and (if available) {ml}.\n          \n          \n            \n            {transform}, remote_cluster_client and (if available) {ml}.", "author": "droberts195", "createdAt": "2020-12-22T09:44:21Z", "path": "docs/reference/modules/node.asciidoc", "diffHunk": "@@ -15,7 +15,7 @@ All nodes know about all the other nodes in the cluster and can forward client\n requests to the appropriate node.\n \n By default, a node is all of the following types: master-eligible, data, ingest,\n-and (if available) machine learning. All data nodes are also transform nodes.\n+{transform} and (if available) {ml}.", "originalCommit": "073e64d9ee681c70cd7a2e076a40d8c7a44c590f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzI3Njg0MQ==", "url": "https://github.com/elastic/elasticsearch/pull/66616#discussion_r547276841", "bodyText": "I think this sentence:\n\nIf you set node.roles, however, you must explicitly specify all the required roles for the node.\n\nWould be better in docs/reference/modules/node.asciidoc", "author": "robin13", "createdAt": "2020-12-22T13:26:44Z", "path": "docs/reference/settings/ml-settings.asciidoc", "diffHunk": "@@ -22,15 +22,19 @@ hardware, you must disable {ml} (by setting `xpack.ml.enabled` to `false`).\n \n `node.roles: [ ml ]`::\n (<<static-cluster-setting,Static>>) Set `node.roles` to contain `ml` to identify\n-the node as a _{ml} node_ that is capable of running jobs. Every node is a {ml}\n-node by default.\n+the node as a _{ml} node_. If you want to run {ml} jobs, there must be at least\n+one {ml} node in your cluster. \n +\n-If you use the `node.roles` setting, then all required roles must be explicitly\n-set. Consult <<modules-node>> to learn more.\n+By default, every node is a {ml} node. If you set `node.roles`, however,\n+you must explicitly specify all the required roles for the node. To learn more, ", "originalCommit": "073e64d9ee681c70cd7a2e076a40d8c7a44c590f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzM4MzA0OA==", "url": "https://github.com/elastic/elasticsearch/pull/66616#discussion_r547383048", "bodyText": "I think it's already covered in the following sentence on that page: \"If you set node.roles, the node is assigned only the roles you specify.\"", "author": "lcawl", "createdAt": "2020-12-22T16:44:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzI3Njg0MQ=="}], "type": "inlineReview"}, {"oid": "c7ede462d87052759054041880ea08468e89705e", "url": "https://github.com/elastic/elasticsearch/commit/c7ede462d87052759054041880ea08468e89705e", "message": "Update docs/reference/modules/node.asciidoc\n\nCo-authored-by: David Roberts <dave.roberts@elastic.co>", "committedDate": "2020-12-22T16:23:50Z", "type": "commit"}, {"oid": "6ea1858e0f4d4a4ccac450d6096dde9d26206be5", "url": "https://github.com/elastic/elasticsearch/commit/6ea1858e0f4d4a4ccac450d6096dde9d26206be5", "message": "[DOCS] Removes duplicate list of default node roles", "committedDate": "2020-12-22T16:43:49Z", "type": "commit"}, {"oid": "51204ea3c65d217429b955d9f7c191808bcf575d", "url": "https://github.com/elastic/elasticsearch/commit/51204ea3c65d217429b955d9f7c191808bcf575d", "message": "[DOCS] Fixes typo", "committedDate": "2020-12-22T17:52:44Z", "type": "commit"}]}