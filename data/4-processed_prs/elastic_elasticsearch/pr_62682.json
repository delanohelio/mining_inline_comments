{"pr_number": 62682, "pr_title": "QL: Optimize Like/Rlike all", "pr_createdAt": "2020-09-21T06:35:43Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/62682", "timeline": [{"oid": "1febf98e7e7b3814eff87a0b4ca5750eab5d9bfd", "url": "https://github.com/elastic/elasticsearch/commit/1febf98e7e7b3814eff87a0b4ca5750eab5d9bfd", "message": "QL: Optimize Like/Rlike all\n\nReplace common Like and RLike queries that match all characters with\nIsNotNull (exists) queries\n\nFix #62585", "committedDate": "2020-09-21T06:34:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTg4MDIxNQ==", "url": "https://github.com/elastic/elasticsearch/pull/62682#discussion_r491880215", "bodyText": "Isn't the wildcard character a %? To my understanding the replacement of % -> * happens later here: https://github.com/elastic/elasticsearch/pull/62682/files#diff-cb6f05d0222f3291ea3df5d33525d6f6R80", "author": "matriv", "createdAt": "2020-09-21T08:47:34Z", "path": "x-pack/plugin/ql/src/main/java/org/elasticsearch/xpack/ql/expression/predicate/regex/LikePattern.java", "diffHunk": "@@ -48,6 +48,16 @@ public String asJavaRegex() {\n         return regex;\n     }\n \n+    @Override\n+    public boolean matchesAll() {\n+        for (int i = 0 ; i < pattern.length(); i++) {\n+            if (pattern.charAt(i) != '*') {", "originalCommit": "1febf98e7e7b3814eff87a0b4ca5750eab5d9bfd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTk3NzA1NQ==", "url": "https://github.com/elastic/elasticsearch/pull/62682#discussion_r491977055", "bodyText": "You are correct. Fixed this.", "author": "costin", "createdAt": "2020-09-21T11:45:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTg4MDIxNQ=="}], "type": "inlineReview"}, {"oid": "a5f5a2fa5ba6c3eddc1e455a6d4f19992b6d103a", "url": "https://github.com/elastic/elasticsearch/commit/a5f5a2fa5ba6c3eddc1e455a6d4f19992b6d103a", "message": "Fix query translation", "committedDate": "2020-09-21T11:45:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjAzODM2NQ==", "url": "https://github.com/elastic/elasticsearch/pull/62682#discussion_r492038365", "bodyText": "I think that now the \"problem\" is reversed since the ReplaceWildcards takes place before this rule, but the test seems to work: https://github.com/elastic/elasticsearch/pull/62682/files#diff-6dd3fd1d0809ee5978cdccbc6bb7d7e1R17 ? In any case I think we should have a comment mentioning the order of the rules are applied and the choice of % or * in this rule.", "author": "matriv", "createdAt": "2020-09-21T13:20:25Z", "path": "x-pack/plugin/ql/src/main/java/org/elasticsearch/xpack/ql/expression/predicate/regex/LikePattern.java", "diffHunk": "@@ -48,6 +48,16 @@ public String asJavaRegex() {\n         return regex;\n     }\n \n+    @Override\n+    public boolean matchesAll() {\n+        for (int i = 0 ; i < pattern.length(); i++) {\n+            if (pattern.charAt(i) != '%') {", "originalCommit": "a5f5a2fa5ba6c3eddc1e455a6d4f19992b6d103a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjUxNzg1Mw==", "url": "https://github.com/elastic/elasticsearch/pull/62682#discussion_r492517853", "bodyText": "LikePattern has several styles. In its constructor it accepts the % and _ characters instead of * and ?. The conversion is done internally and accessible.\nThe check above works on the raw pattern - I'll follow-up with a comment.", "author": "costin", "createdAt": "2020-09-22T07:13:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjAzODM2NQ=="}], "type": "inlineReview"}, {"oid": "8ba14257ea0312a0383e34f6fe84a8021c7d0302", "url": "https://github.com/elastic/elasticsearch/commit/8ba14257ea0312a0383e34f6fe84a8021c7d0302", "message": "Change pattern detection to Lucene automaton", "committedDate": "2020-09-22T21:37:30Z", "type": "commit"}, {"oid": "2f6900da3ca1cfd8f733b172234d20c7f08d47c2", "url": "https://github.com/elastic/elasticsearch/commit/2f6900da3ca1cfd8f733b172234d20c7f08d47c2", "message": "Merge branch 'master' into fix/62585", "committedDate": "2020-09-23T06:13:24Z", "type": "commit"}, {"oid": "f370368733a084dc9ac91ad4e6f2c109dd8fc9ae", "url": "https://github.com/elastic/elasticsearch/commit/f370368733a084dc9ac91ad4e6f2c109dd8fc9ae", "message": "Add left-over test", "committedDate": "2020-09-23T08:53:46Z", "type": "commit"}]}