{"pr_number": 66194, "pr_title": "[DOCS] Add dynamic runtime fields to docs", "pr_createdAt": "2020-12-10T22:53:14Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/66194", "timeline": [{"oid": "64cc39061affb9c577ec0c32a56cb2f234aab5b9", "url": "https://github.com/elastic/elasticsearch/commit/64cc39061affb9c577ec0c32a56cb2f234aab5b9", "message": "[DOCS] Add dynamic runtime fields to docs.", "committedDate": "2020-12-10T22:50:01Z", "type": "commit"}, {"oid": "00d9880582f353d17fd96fe6cb2049981e720cfe", "url": "https://github.com/elastic/elasticsearch/commit/00d9880582f353d17fd96fe6cb2049981e720cfe", "message": "Clarifying edits and example changes.", "committedDate": "2020-12-14T14:05:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjU2NzMwNw==", "url": "https://github.com/elastic/elasticsearch/pull/66194#discussion_r542567307", "bodyText": "What d you think about s/throws an exception/rejects the document/ ?  \"throws an exception\" is a very java-implementation level thing. The result of it is to reject the document.", "author": "nik9000", "createdAt": "2020-12-14T17:26:50Z", "path": "docs/reference/mapping/dynamic/field-mapping.asciidoc", "diffHunk": "@@ -1,35 +1,36 @@\n [[dynamic-field-mapping]]\n === Dynamic field mapping\n \n-By default, when a previously unseen field is found in a document,\n-Elasticsearch will add the new field to the type mapping.   This behaviour can\n-be disabled, both at the document and at the <<object,`object`>>  level, by\n-setting the <<dynamic,`dynamic`>> parameter to `false` (to ignore new fields) or to `strict` (to throw\n-an exception if an unknown field is encountered).\n+When {es} detects a new field in a document, it _dynamically_ adds the field to\n+the type mapping. The <<dynamic,`dynamic`>> parameter controls this behavior.\n \n-Assuming `dynamic` field mapping is enabled, some simple rules are used to\n-determine which data type the field should have:\n+You can disable dynamic mapping, both at the document and at the\n+<<object,`object`>> level. Setting the `dynamic` parameter to\n+`false` ignores new fields, and `strict` throws an exception if {es} encounters", "originalCommit": "00d9880582f353d17fd96fe6cb2049981e720cfe", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjcxMjAzNw==", "url": "https://github.com/elastic/elasticsearch/pull/66194#discussion_r542712037", "bodyText": "Definitely more clear. I'll make that substitution.", "author": "lockewritesdocs", "createdAt": "2020-12-14T19:56:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjU2NzMwNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjU2OTMxOQ==", "url": "https://github.com/elastic/elasticsearch/pull/66194#discussion_r542569319", "bodyText": "The probably should stay in a funny table format because its an \"if, elsif, else\" thing. Even worse now that we do different things if dynamic: runtime. Maybe this whole thing should turn into a big table with dynamic:true in one heading and dynamic:runtime in another? I dunno.", "author": "nik9000", "createdAt": "2020-12-14T17:29:25Z", "path": "docs/reference/mapping/dynamic/field-mapping.asciidoc", "diffHunk": "@@ -1,35 +1,36 @@\n [[dynamic-field-mapping]]\n === Dynamic field mapping\n \n-By default, when a previously unseen field is found in a document,\n-Elasticsearch will add the new field to the type mapping.   This behaviour can\n-be disabled, both at the document and at the <<object,`object`>>  level, by\n-setting the <<dynamic,`dynamic`>> parameter to `false` (to ignore new fields) or to `strict` (to throw\n-an exception if an unknown field is encountered).\n+When {es} detects a new field in a document, it _dynamically_ adds the field to\n+the type mapping. The <<dynamic,`dynamic`>> parameter controls this behavior.\n \n-Assuming `dynamic` field mapping is enabled, some simple rules are used to\n-determine which data type the field should have:\n+You can disable dynamic mapping, both at the document and at the\n+<<object,`object`>> level. Setting the `dynamic` parameter to\n+`false` ignores new fields, and `strict` throws an exception if {es} encounters\n+an unknown field.\n+\n+When dynamic field mapping is enabled, {es} uses the following rules to\n+determine how to map data types for each field.\n \n [horizontal]\n-*JSON data type*::                   *Elasticsearch data type*\n+*JSON data type*::                  *Elasticsearch data type*\n \n `null`::                            No field is added.\n `true` or `false`::                 <<boolean,`boolean`>> field\n-floating{nbsp}point{nbsp}number::   <<number,`float`>> field\n+floating{nbsp}point{nbsp}number::   <<number,`float`>> indexed field or <<number,`double`>> runtime field\n integer::                           <<number,`long`>> field\n object::                            <<object,`object`>> field\n++\n+NOTE: Objects are always mapped as part of the `properties` section, even when the `dynamic` parameter is set to `runtime`.\n+\n array::                             Depends on the first non-`null` value in the array.\n-string::                            Either a <<date,`date`>> field\n-                                        (if the value passes <<date-detection,date detection>>),\n-                                    a <<number,`double`>> or <<number,`long`>> field\n-                                        (if the value passes <<numeric-detection,numeric detection>>)\n-                                    or a <<text,`text`>> field, with a <<keyword,`keyword`>> sub-field.\n+string::                            Either a <<date,`date`>> field (if the value passes <<date-detection,date detection>>), a <<number,`double`>> or <<number,`long`>> field (if the value passes <<numeric-detection,numeric detection>>), or a <<text,`text`>> field with a <<keyword,`keyword`>> sub-field.", "originalCommit": "00d9880582f353d17fd96fe6cb2049981e720cfe", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjcwODQyNg==", "url": "https://github.com/elastic/elasticsearch/pull/66194#discussion_r542708426", "bodyText": "After we chatted briefly, I agree that a tri-column table is the better way to present this information.", "author": "lockewritesdocs", "createdAt": "2020-12-14T19:52:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjU2OTMxOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjU3MDI1OQ==", "url": "https://github.com/elastic/elasticsearch/pull/66194#discussion_r542570259", "bodyText": "Does this link to the page in the doc above? It feels like that'd be important.", "author": "nik9000", "createdAt": "2020-12-14T17:30:40Z", "path": "docs/reference/mapping/params/dynamic.asciidoc", "diffHunk": "@@ -1,24 +1,32 @@\n [[dynamic]]\n === `dynamic`\n \n-By default, fields can be added _dynamically_ to a document, or to\n-<<object,inner objects>> within a document, just by indexing a document\n-containing the new field.  For instance:\n+When you index a document containing a new field, {es} adds the", "originalCommit": "00d9880582f353d17fd96fe6cb2049981e720cfe", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjcxMDc0OQ==", "url": "https://github.com/elastic/elasticsearch/pull/66194#discussion_r542710749", "bodyText": "There's a link later in the page, but I'll move it here \ud83d\udc4d", "author": "lockewritesdocs", "createdAt": "2020-12-14T19:54:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjU3MDI1OQ=="}], "type": "inlineReview"}, {"oid": "217aaee1c46ac08d078aec0db6b68062b74e10ca", "url": "https://github.com/elastic/elasticsearch/commit/217aaee1c46ac08d078aec0db6b68062b74e10ca", "message": "Creating better table and incorporating review comments.", "committedDate": "2020-12-14T20:25:18Z", "type": "commit"}, {"oid": "1fa1d8fd052aa00e7196deca0d7279954d9bc6ae", "url": "https://github.com/elastic/elasticsearch/commit/1fa1d8fd052aa00e7196deca0d7279954d9bc6ae", "message": "Change numeral to superscript.", "committedDate": "2020-12-14T21:06:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDEyNzU5Mw==", "url": "https://github.com/elastic/elasticsearch/pull/66194#discussion_r544127593", "bodyText": "Is it clear to users that by \"enabled\" we don't only mean \"true\" but also \"runtime\". It becomes clearer with the following table but maybe that could be further clarified?", "author": "javanna", "createdAt": "2020-12-16T09:06:06Z", "path": "docs/reference/mapping/dynamic/field-mapping.asciidoc", "diffHunk": "@@ -1,35 +1,37 @@\n [[dynamic-field-mapping]]\n === Dynamic field mapping\n \n-By default, when a previously unseen field is found in a document,\n-Elasticsearch will add the new field to the type mapping.   This behaviour can\n-be disabled, both at the document and at the <<object,`object`>>  level, by\n-setting the <<dynamic,`dynamic`>> parameter to `false` (to ignore new fields) or to `strict` (to throw\n-an exception if an unknown field is encountered).\n-\n-Assuming `dynamic` field mapping is enabled, some simple rules are used to\n-determine which data type the field should have:\n-\n-[horizontal]\n-*JSON data type*::                   *Elasticsearch data type*\n-\n-`null`::                            No field is added.\n-`true` or `false`::                 <<boolean,`boolean`>> field\n-floating{nbsp}point{nbsp}number::   <<number,`float`>> field\n-integer::                           <<number,`long`>> field\n-object::                            <<object,`object`>> field\n-array::                             Depends on the first non-`null` value in the array.\n-string::                            Either a <<date,`date`>> field\n-                                        (if the value passes <<date-detection,date detection>>),\n-                                    a <<number,`double`>> or <<number,`long`>> field\n-                                        (if the value passes <<numeric-detection,numeric detection>>)\n-                                    or a <<text,`text`>> field, with a <<keyword,`keyword`>> sub-field.\n-\n-These are the only <<mapping-types,field data types>> that are dynamically\n-detected.  All other data types must be mapped explicitly.\n-\n-Besides the options listed below, dynamic field mapping rules can be further\n-customised with <<dynamic-templates,`dynamic_templates`>>.\n+When {es} detects a new field in a document, it _dynamically_ adds the field to\n+the type mapping. The <<dynamic,`dynamic`>> parameter controls this behavior.\n+\n+You can disable dynamic mapping, both at the document and at the\n+<<object,`object`>> level. Setting the `dynamic` parameter to\n+`false` ignores new fields, and `strict` rejects the document if {es}\n+encounters an unknown field.\n+\n+When dynamic field mapping is enabled, {es} uses the following rules to", "originalCommit": "1fa1d8fd052aa00e7196deca0d7279954d9bc6ae", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDU4NjA3MQ==", "url": "https://github.com/elastic/elasticsearch/pull/66194#discussion_r544586071", "bodyText": "I think we can expand to explicitly mention runtime here:\n\nDynamic field mapping is enabled by default, but can also be enabled by setting the dynamic parameter to runtime. When dynamic field mapping is enabled, Elasticsearch uses the rules in the following table to determine how to map data types for each field.", "author": "lockewritesdocs", "createdAt": "2020-12-16T20:02:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDEyNzU5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTA5ODE3Mw==", "url": "https://github.com/elastic/elasticsearch/pull/66194#discussion_r545098173", "bodyText": "If I read this I would wonder if dynamic:true and dynamic:runtime do the same thing. I think we should be more explicit that dynamic:true and dynamic:runtime are both going to dynamically create fields based on incoming documents, and that both are what we refer to as dynamic field mapping, as opposed to dynamic:false and dynamic:strict which don't create fields dynamically.", "author": "javanna", "createdAt": "2020-12-17T13:42:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDEyNzU5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTE2OTg1Mg==", "url": "https://github.com/elastic/elasticsearch/pull/66194#discussion_r545169852", "bodyText": "Thanks @javanna -- I'm moving this discussion to a draft PR so that we can collaborate on changes there. See #66530.", "author": "lockewritesdocs", "createdAt": "2020-12-17T15:17:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDEyNzU5Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDEyODk4Nw==", "url": "https://github.com/elastic/elasticsearch/pull/66194#discussion_r544128987", "bodyText": "Not directly related to this PR, but I was wondering if it would help users to have the dynamically generated mappings for the above documents in the docs, for both dynamic:true and dynamic:runtime.", "author": "javanna", "createdAt": "2020-12-16T09:08:12Z", "path": "docs/reference/mapping/params/dynamic.asciidoc", "diffHunk": "@@ -68,20 +64,32 @@ PUT my-index-000001\n           \"name\": {\n             \"type\": \"text\"\n           },\n-          \"social_networks\": { <3>\n-            \"dynamic\": true,\n+          \"social_networks\": {\n+            \"dynamic\": true, <3>\n             \"properties\": {}\n           }\n         }\n       }\n     }\n   }\n }\n---------------------------------------------------\n+----", "originalCommit": "1fa1d8fd052aa00e7196deca0d7279954d9bc6ae", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}