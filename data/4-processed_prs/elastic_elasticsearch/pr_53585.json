{"pr_number": 53585, "pr_title": "Add a QA project for identity provider module", "pr_createdAt": "2020-03-16T07:33:16Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/53585", "timeline": [{"oid": "059ce8100b5fe91246f483a8e956c6a593b3c593", "url": "https://github.com/elastic/elasticsearch/commit/059ce8100b5fe91246f483a8e956c6a593b3c593", "message": "Add a QA project for identity provider module\n\nThis adds a small QA project that starts up a cluster with the IdP\nenabled and performs a basic test of registering a service provider.\n\nIt also fixes a few bugs that were found along the way.", "committedDate": "2020-03-13T05:30:54Z", "type": "commit"}, {"oid": "89fa148042b1493a70ed7a770444dd751be5f232", "url": "https://github.com/elastic/elasticsearch/commit/89fa148042b1493a70ed7a770444dd751be5f232", "message": "Merge branch 'feature-internal-idp' into idp/qa-project", "committedDate": "2020-03-16T07:27:56Z", "type": "commit"}, {"oid": "09caec6d988b7dd94feba3701ecda424541c4467", "url": "https://github.com/elastic/elasticsearch/commit/09caec6d988b7dd94feba3701ecda424541c4467", "message": "Merge branch 'feature-internal-idp' into idp/qa-project", "committedDate": "2020-03-17T02:38:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzU0MjIxNA==", "url": "https://github.com/elastic/elasticsearch/pull/53585#discussion_r393542214", "bodyText": "nit suggestion : why not import static org.opensaml.saml.common.xml.SAMLConstants.SAML2_REDIRECT_BINDING_URI; ?", "author": "jkakavas", "createdAt": "2020-03-17T09:24:21Z", "path": "x-pack/plugin/identity-provider/qa/idp-rest-tests/src/test/java/org/elasticsearch/xpack/idp/ManageServiceProviderRestIT.java", "diffHunk": "@@ -0,0 +1,138 @@\n+/*\n+ * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n+ * or more contributor license agreements. Licensed under the Elastic License;\n+ * you may not use this file except in compliance with the Elastic License.\n+ */\n+package org.elasticsearch.xpack.idp;\n+\n+import org.elasticsearch.action.support.WriteRequest.RefreshPolicy;\n+import org.elasticsearch.client.Request;\n+import org.elasticsearch.client.Response;\n+import org.elasticsearch.client.ResponseException;\n+import org.elasticsearch.common.Strings;\n+import org.elasticsearch.common.xcontent.ObjectPath;\n+import org.elasticsearch.common.xcontent.json.JsonXContent;\n+import org.elasticsearch.xpack.idp.saml.sp.SamlServiceProviderIndex;\n+import org.elasticsearch.xpack.idp.saml.sp.SamlServiceProviderIndex.DocumentVersion;\n+\n+import java.io.IOException;\n+import java.net.URLEncoder;\n+import java.nio.charset.StandardCharsets;\n+import java.util.Map;\n+\n+import static org.hamcrest.Matchers.containsInAnyOrder;\n+import static org.hamcrest.Matchers.containsString;\n+import static org.hamcrest.Matchers.equalTo;\n+import static org.hamcrest.Matchers.greaterThanOrEqualTo;\n+import static org.hamcrest.Matchers.instanceOf;\n+import static org.hamcrest.Matchers.notNullValue;\n+\n+public class ManageServiceProviderRestIT extends IdpRestTestCase {\n+\n+    // From build.gradle\n+    private final String IDP_ENTITY_ID = \"https://idp.test.es.elasticsearch.org/\";\n+    // From SAMLConstants\n+    private final String REDIRECT_BINDING = \"urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect\";", "originalCommit": "09caec6d988b7dd94feba3701ecda424541c4467", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzY1NjU1Mg==", "url": "https://github.com/elastic/elasticsearch/pull/53585#discussion_r393656552", "bodyText": "Because the QA project doesn't currently import OpenSAML and it seemed like overkill to make it do that just for this constant.", "author": "tvernum", "createdAt": "2020-03-17T12:54:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzU0MjIxNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzU3ODM1MA==", "url": "https://github.com/elastic/elasticsearch/pull/53585#discussion_r393578350", "bodyText": "\ud83d\udc4d", "author": "jkakavas", "createdAt": "2020-03-17T10:27:04Z", "path": "x-pack/plugin/identity-provider/src/main/java/org/elasticsearch/xpack/idp/saml/rest/action/RestDeleteSamlServiceProviderAction.java", "diffHunk": "@@ -49,7 +49,7 @@ protected RestChannelConsumer prepareRequest(RestRequest restRequest, NodeClient\n                 @Override\n                 public RestResponse buildResponse(DeleteSamlServiceProviderResponse response, XContentBuilder builder) throws Exception {\n                     response.toXContent(builder, restRequest);\n-                    return new BytesRestResponse(RestStatus.OK, builder);\n+                    return new BytesRestResponse(response.found() ? RestStatus.OK : RestStatus.NOT_FOUND, builder);", "originalCommit": "09caec6d988b7dd94feba3701ecda424541c4467", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}