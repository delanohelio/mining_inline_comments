{"pr_number": 55537, "pr_title": "[ML] explicitly disallow partial results in datafeed extractors", "pr_createdAt": "2020-04-21T14:27:47Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/55537", "timeline": [{"oid": "64c46c5c62ace0cc41fd34c1a934c75018e5fef5", "url": "https://github.com/elastic/elasticsearch/commit/64c46c5c62ace0cc41fd34c1a934c75018e5fef5", "message": "[ML] explicitly disallow partial results in datafeed extractors", "committedDate": "2020-04-21T14:23:46Z", "type": "commit"}, {"oid": "f402b3151290ee67e7fbc54906ef812a5b69b947", "url": "https://github.com/elastic/elasticsearch/commit/f402b3151290ee67e7fbc54906ef812a5b69b947", "message": "Merge branch 'master' into feature/ml-df-explicitly-disallow-partial-results-in-datafeeds", "committedDate": "2020-04-21T17:19:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjcxNjk5Mg==", "url": "https://github.com/elastic/elasticsearch/pull/55537#discussion_r412716992", "bodyText": "what about adding .setAllowPartialSearchResults(false) on the output of buildSearchRequest(...) instead of doing it per sub-class? Seems cleaner to me.", "author": "hendrikmuhs", "createdAt": "2020-04-22T06:52:42Z", "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/datafeed/extractor/aggregation/AbstractAggregationDataExtractor.java", "diffHunk": "@@ -107,12 +107,11 @@ public long getEndTime() {\n         return Optional.ofNullable(processNextBatch());\n     }\n \n-    private Aggregations search() throws IOException {\n+    private Aggregations search() {\n         LOGGER.debug(\"[{}] Executing aggregated search\", context.jobId);\n         SearchResponse searchResponse = executeSearchRequest(buildSearchRequest(buildBaseSearchSource()));", "originalCommit": "f402b3151290ee67e7fbc54906ef812a5b69b947", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjc4NzYzMA==", "url": "https://github.com/elastic/elasticsearch/pull/55537#discussion_r412787630", "bodyText": "Although I see @hendrikmuhs 's point, I prefer the way it's done currently in this PR as it keeps all the settings on the search request together. Even though it means duplicating it, I think it helps readability as it brings all relevant info together when you're reading the buildSearchRequest methods.", "author": "dimitris-athanasiou", "createdAt": "2020-04-22T08:39:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjcxNjk5Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjc5OTc0Ng==", "url": "https://github.com/elastic/elasticsearch/pull/55537#discussion_r412799746", "bodyText": "Fair enough, your choice.\nTo address my concern, what about having an assert searchRequest.allowPartialSearchResults(). It's easy to forget otherwise and with the removed response handling its a candidate for a regression if the subclass is re-factored or a new one is introduced.", "author": "hendrikmuhs", "createdAt": "2020-04-22T08:55:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjcxNjk5Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjg5NTk5Mg==", "url": "https://github.com/elastic/elasticsearch/pull/55537#discussion_r412895992", "bodyText": "assert searchRequest.allowPartialSearchResults() sounds good. I will put that in", "author": "benwtrent", "createdAt": "2020-04-22T11:22:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjcxNjk5Mg=="}], "type": "inlineReview"}, {"oid": "283f9e01cd0323e56f41eef2463492cec95a7d90", "url": "https://github.com/elastic/elasticsearch/commit/283f9e01cd0323e56f41eef2463492cec95a7d90", "message": "adding assert", "committedDate": "2020-04-22T11:30:48Z", "type": "commit"}, {"oid": "6bd3334f94c2f4f89a221cbc0e0f198ac563a037", "url": "https://github.com/elastic/elasticsearch/commit/6bd3334f94c2f4f89a221cbc0e0f198ac563a037", "message": "Merge remote-tracking branch 'upstream/master' into feature/ml-df-explicitly-disallow-partial-results-in-datafeeds", "committedDate": "2020-04-22T11:31:02Z", "type": "commit"}]}