{"pr_number": 66597, "pr_title": "Fix IndexFoldersDeletionListenerIT", "pr_createdAt": "2020-12-18T14:02:00Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/66597", "timeline": [{"oid": "27182225d438502f85035479da6c0e74ebfcafb0", "url": "https://github.com/elastic/elasticsearch/commit/27182225d438502f85035479da6c0e74ebfcafb0", "message": "Fix IndexFoldersDeletionListenerIT", "committedDate": "2020-12-18T12:57:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjY3ODE1MQ==", "url": "https://github.com/elastic/elasticsearch/pull/66597#discussion_r546678151", "bodyText": "I am not sure I follow how number of shards/replicas interact with this test?", "author": "henningandersen", "createdAt": "2020-12-21T12:25:58Z", "path": "server/src/internalClusterTest/java/org/elasticsearch/plugins/IndexFoldersDeletionListenerIT.java", "diffHunk": "@@ -67,15 +67,24 @@\n         return plugins;\n     }\n \n+    @Override\n+    protected Settings nodeSettings(int nodeOrdinal) {\n+        return Settings.builder()\n+            .put(super.nodeSettings(nodeOrdinal))\n+            // prevent shards to move around after they got assigned the first time\n+            .put(EnableAllocationDecider.CLUSTER_ROUTING_REBALANCE_ENABLE_SETTING.getKey(), EnableAllocationDecider.Rebalance.NONE)\n+            .build();\n+    }\n+\n     public void testListenersInvokedWhenIndexIsDeleted() throws Exception {\n         final String masterNode = internalCluster().startMasterOnlyNode();\n         internalCluster().startDataOnlyNodes(2);\n         ensureStableCluster(2 + 1, masterNode);\n \n         final String indexName = randomAlphaOfLength(10).toLowerCase(Locale.ROOT);\n         createIndex(indexName, Settings.builder()\n-            .put(IndexMetadata.SETTING_NUMBER_OF_SHARDS, 2 * between(1, 2))\n-            .put(IndexMetadata.SETTING_NUMBER_OF_REPLICAS, between(0, 1))\n+            .put(IndexMetadata.SETTING_NUMBER_OF_SHARDS, 2)\n+            .put(IndexMetadata.SETTING_NUMBER_OF_REPLICAS, 0)", "originalCommit": "27182225d438502f85035479da6c0e74ebfcafb0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTIzOTc0NA==", "url": "https://github.com/elastic/elasticsearch/pull/66597#discussion_r551239744", "bodyText": "I've restored the randomized replicas.", "author": "tlrx", "createdAt": "2021-01-04T10:42:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjY3ODE1MQ=="}], "type": "inlineReview"}, {"oid": "270fd76067a9708f7efe4f055d7da66ca477b19c", "url": "https://github.com/elastic/elasticsearch/commit/270fd76067a9708f7efe4f055d7da66ca477b19c", "message": "Merge branch 'master' into fix-IndexFoldersDeletionListenerIT", "committedDate": "2021-01-04T09:26:22Z", "type": "commit"}, {"oid": "68deb68376f4abf8921b35a1f075cbcd38ab01a8", "url": "https://github.com/elastic/elasticsearch/commit/68deb68376f4abf8921b35a1f075cbcd38ab01a8", "message": "replicas", "committedDate": "2021-01-04T09:46:15Z", "type": "commit"}]}