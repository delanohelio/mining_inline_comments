{"pr_number": 63487, "pr_title": "Ensure field types consistency on supporting text queries", "pr_createdAt": "2020-10-08T13:46:51Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/63487", "timeline": [{"oid": "468db114783aabf4d039b1f79ded8829d4778c13", "url": "https://github.com/elastic/elasticsearch/commit/468db114783aabf4d039b1f79ded8829d4778c13", "message": "Add test to ensure consistency of our field types\n\nThis commit adds a test method to MapperTestCase, which verifies the consistency of a field type by verifying that it is not searchable whenever it uses TextSearchInfo.NONE, while it is otherwise.", "committedDate": "2020-10-08T13:29:38Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTc0ODEzNQ==", "url": "https://github.com/elastic/elasticsearch/pull/63487#discussion_r501748135", "bodyText": "Can we put this on FieldTypeTestCase rather than MapperTestCase? Given that we're explicitly checking things in MappedFieldType rather than FieldMapper I think it would work better there.", "author": "romseygeek", "createdAt": "2020-10-08T14:05:08Z", "path": "test/framework/src/main/java/org/elasticsearch/index/mapper/MapperTestCase.java", "diffHunk": "@@ -420,4 +429,24 @@ public void testUpdates() throws IOException {\n         assertParseMaximalWarnings();\n     }\n \n+    public final void testTextSearchInfoConsistency() throws IOException {", "originalCommit": "468db114783aabf4d039b1f79ded8829d4778c13", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTc2ODcwMg==", "url": "https://github.com/elastic/elasticsearch/pull/63487#discussion_r501768702", "bodyText": "that makes sense, but it would require replicating quite some logic in both test base classes. I am reusing some of the existing methods here that are missing in FieldTypeTestCase. What do you think?", "author": "javanna", "createdAt": "2020-10-08T14:31:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTc0ODEzNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTgzMDQxNg==", "url": "https://github.com/elastic/elasticsearch/pull/63487#discussion_r501830416", "bodyText": "cc @nik9000 - I think it's still worth trying to keep things separate?\nAnother possibility is to actually make this a constraint by moving the termQuery() etc factory functions onto TextSearchInfo.", "author": "romseygeek", "createdAt": "2020-10-08T15:53:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTc0ODEzNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTg3OTIxNA==", "url": "https://github.com/elastic/elasticsearch/pull/63487#discussion_r501879214", "bodyText": "I think it'd make sense to merge FieldTypeTestCase into MapperTestCase.  It might also make sense to move the query builder methods but one thing at a time!", "author": "nik9000", "createdAt": "2020-10-08T17:10:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTc0ODEzNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzc2ODc3MA==", "url": "https://github.com/elastic/elasticsearch/pull/63487#discussion_r503768770", "bodyText": "I would prefer addressing where the new test should be at a later stage. I am not sure it is worth duplicating all of the needed testing logic to FieldTypeTestCase, and the other proposed alternatives look like potential follow-ups too.", "author": "javanna", "createdAt": "2020-10-13T08:35:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTc0ODEzNQ=="}], "type": "inlineReview"}, {"oid": "de73db15f46394576f397d9c78b30dc790c7b7a4", "url": "https://github.com/elastic/elasticsearch/commit/de73db15f46394576f397d9c78b30dc790c7b7a4", "message": "fix tests", "committedDate": "2020-10-08T15:11:04Z", "type": "commit"}, {"oid": "aa95d9b5ac712b133d886d86bd421ea2b6b80d53", "url": "https://github.com/elastic/elasticsearch/commit/aa95d9b5ac712b133d886d86bd421ea2b6b80d53", "message": "iter", "committedDate": "2020-10-12T09:24:51Z", "type": "commit"}, {"oid": "7e1ebe8aedf6cb6ef184be526dcc69ffb34b1cc7", "url": "https://github.com/elastic/elasticsearch/commit/7e1ebe8aedf6cb6ef184be526dcc69ffb34b1cc7", "message": "iter", "committedDate": "2020-10-12T09:57:51Z", "type": "commit"}, {"oid": "e4f1448c04c995ad169f05790fc381530964d53a", "url": "https://github.com/elastic/elasticsearch/commit/e4f1448c04c995ad169f05790fc381530964d53a", "message": "Merge branch 'master' into test/text_search_info_consistency", "committedDate": "2020-10-12T09:58:04Z", "type": "commit"}, {"oid": "efb468986fa9c9a747cda1127364525dae35350b", "url": "https://github.com/elastic/elasticsearch/commit/efb468986fa9c9a747cda1127364525dae35350b", "message": "iter", "committedDate": "2020-10-12T10:09:01Z", "type": "commit"}, {"oid": "91ce1453dabd9ef489ece4021492c919314bca70", "url": "https://github.com/elastic/elasticsearch/commit/91ce1453dabd9ef489ece4021492c919314bca70", "message": "Merge branch 'master' into test/text_search_info_consistency", "committedDate": "2020-10-12T11:57:49Z", "type": "commit"}, {"oid": "7151efb18ced18b298dac38ef9ab01a609c1393e", "url": "https://github.com/elastic/elasticsearch/commit/7151efb18ced18b298dac38ef9ab01a609c1393e", "message": "iter", "committedDate": "2020-10-12T14:00:12Z", "type": "commit"}, {"oid": "a8239bd23f1da02b1a80432a00858566acbd8cfd", "url": "https://github.com/elastic/elasticsearch/commit/a8239bd23f1da02b1a80432a00858566acbd8cfd", "message": "Merge branch 'master' into test/text_search_info_consistency", "committedDate": "2020-10-12T18:59:11Z", "type": "commit"}, {"oid": "7f1e6b4c51ef8127f1f2ed2b3e2a27406214f75b", "url": "https://github.com/elastic/elasticsearch/commit/7f1e6b4c51ef8127f1f2ed2b3e2a27406214f75b", "message": "iter", "committedDate": "2020-10-12T19:07:27Z", "type": "commit"}]}