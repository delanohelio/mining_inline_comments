{"pr_number": 51105, "pr_title": "[DOCS] Expands the documentation of Node Query Cache", "pr_createdAt": "2020-01-16T14:38:41Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/51105", "timeline": [{"oid": "ac0204e94f9f5f1365d3bfe7d97a46bcb74eae6a", "url": "https://github.com/elastic/elasticsearch/commit/ac0204e94f9f5f1365d3bfe7d97a46bcb74eae6a", "message": "[DOCS] Expands the documentation of Node Query Cache.", "committedDate": "2020-01-16T14:35:39Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE4NzY5Mg==", "url": "https://github.com/elastic/elasticsearch/pull/51105#discussion_r368187692", "bodyText": "I'd take the opportunity to tighten this up a bit.\nThe results of queries used in the filter context are cached in the node query cache for fast lookup.\nThe cache uses an LRU eviction policy: when the cache is full, the least recently used query results are evicted to make way for new data. You cannot inspect the contents of the query cache.", "author": "debadair", "createdAt": "2020-01-18T00:26:39Z", "path": "docs/reference/modules/indices/query_cache.asciidoc", "diffHunk": "@@ -1,27 +1,35 @@\n [[query-cache]]\n === Node Query Cache\n \n-The query cache is responsible for caching the results of queries.\n-There is one queries cache per node that is shared by all shards.\n-The cache implements an LRU eviction policy: when a cache becomes full, the\n-least recently used data is evicted to make way for new data.\n-It is not possible to look at the contents being cached.\n+The query cache is responsible for caching the results of queries. There is one \n+queries cache per node that is shared by all shards. The cache implements an LRU \n+eviction policy: when a cache becomes full, the least recently used data is \n+evicted to make way for new data. It is not possible to look at the contents \n+being cached.\n ", "originalCommit": "ac0204e94f9f5f1365d3bfe7d97a46bcb74eae6a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE4ODMyOQ==", "url": "https://github.com/elastic/elasticsearch/pull/51105#discussion_r368188329", "bodyText": "If you mention that this cache is for queries used in a filter context above, you can probably just focus on the exceptions here:\nTerm queries and queries used outside of a filter context are not eligible for caching.", "author": "debadair", "createdAt": "2020-01-18T00:30:46Z", "path": "docs/reference/modules/indices/query_cache.asciidoc", "diffHunk": "@@ -1,27 +1,35 @@\n [[query-cache]]\n === Node Query Cache\n \n-The query cache is responsible for caching the results of queries.\n-There is one queries cache per node that is shared by all shards.\n-The cache implements an LRU eviction policy: when a cache becomes full, the\n-least recently used data is evicted to make way for new data.\n-It is not possible to look at the contents being cached.\n+The query cache is responsible for caching the results of queries. There is one \n+queries cache per node that is shared by all shards. The cache implements an LRU \n+eviction policy: when a cache becomes full, the least recently used data is \n+evicted to make way for new data. It is not possible to look at the contents \n+being cached.\n \n-The query cache only caches queries which are being used in a filter context.\n+The query cache only caches queries which are being used in a filter context. \n+However, term queries are not eligible for caching, not even in the filter \n+context.", "originalCommit": "ac0204e94f9f5f1365d3bfe7d97a46bcb74eae6a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE4ODU5MA==", "url": "https://github.com/elastic/elasticsearch/pull/51105#discussion_r368188590", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            It caches up to 10000 queries in up to 10% of the total heap space by default. \n          \n          \n            \n            By default, the cache holds a maximum of 10000 queries in up to 10% of the total heap space.", "author": "debadair", "createdAt": "2020-01-18T00:32:19Z", "path": "docs/reference/modules/indices/query_cache.asciidoc", "diffHunk": "@@ -1,27 +1,35 @@\n [[query-cache]]\n === Node Query Cache\n \n-The query cache is responsible for caching the results of queries.\n-There is one queries cache per node that is shared by all shards.\n-The cache implements an LRU eviction policy: when a cache becomes full, the\n-least recently used data is evicted to make way for new data.\n-It is not possible to look at the contents being cached.\n+The query cache is responsible for caching the results of queries. There is one \n+queries cache per node that is shared by all shards. The cache implements an LRU \n+eviction policy: when a cache becomes full, the least recently used data is \n+evicted to make way for new data. It is not possible to look at the contents \n+being cached.\n \n-The query cache only caches queries which are being used in a filter context.\n+The query cache only caches queries which are being used in a filter context. \n+However, term queries are not eligible for caching, not even in the filter \n+context.\n+\n+It caches up to 10000 queries in up to 10% of the total heap space by default. ", "originalCommit": "ac0204e94f9f5f1365d3bfe7d97a46bcb74eae6a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE4ODkwNQ==", "url": "https://github.com/elastic/elasticsearch/pull/51105#discussion_r368188905", "bodyText": "I'd probably switch this to the active voice:\nTo determine if a query is eligible for caching, Elasticsearch maintains a query history to track occurrences.", "author": "debadair", "createdAt": "2020-01-18T00:34:11Z", "path": "docs/reference/modules/indices/query_cache.asciidoc", "diffHunk": "@@ -1,27 +1,35 @@\n [[query-cache]]\n === Node Query Cache\n \n-The query cache is responsible for caching the results of queries.\n-There is one queries cache per node that is shared by all shards.\n-The cache implements an LRU eviction policy: when a cache becomes full, the\n-least recently used data is evicted to make way for new data.\n-It is not possible to look at the contents being cached.\n+The query cache is responsible for caching the results of queries. There is one \n+queries cache per node that is shared by all shards. The cache implements an LRU \n+eviction policy: when a cache becomes full, the least recently used data is \n+evicted to make way for new data. It is not possible to look at the contents \n+being cached.\n \n-The query cache only caches queries which are being used in a filter context.\n+The query cache only caches queries which are being used in a filter context. \n+However, term queries are not eligible for caching, not even in the filter \n+context.\n+\n+It caches up to 10000 queries in up to 10% of the total heap space by default. \n+To determine if a query is eligible for caching, a history of queries is \n+maintained to track occurrences.\n+", "originalCommit": "ac0204e94f9f5f1365d3bfe7d97a46bcb74eae6a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE4OTE1Nw==", "url": "https://github.com/elastic/elasticsearch/pull/51105#discussion_r368189157", "bodyText": "Maybe:\nBecause caching is per segment, merging segments can invalidate cached queries.", "author": "debadair", "createdAt": "2020-01-18T00:36:09Z", "path": "docs/reference/modules/indices/query_cache.asciidoc", "diffHunk": "@@ -1,27 +1,35 @@\n [[query-cache]]\n === Node Query Cache\n \n-The query cache is responsible for caching the results of queries.\n-There is one queries cache per node that is shared by all shards.\n-The cache implements an LRU eviction policy: when a cache becomes full, the\n-least recently used data is evicted to make way for new data.\n-It is not possible to look at the contents being cached.\n+The query cache is responsible for caching the results of queries. There is one \n+queries cache per node that is shared by all shards. The cache implements an LRU \n+eviction policy: when a cache becomes full, the least recently used data is \n+evicted to make way for new data. It is not possible to look at the contents \n+being cached.\n \n-The query cache only caches queries which are being used in a filter context.\n+The query cache only caches queries which are being used in a filter context. \n+However, term queries are not eligible for caching, not even in the filter \n+context.\n+\n+It caches up to 10000 queries in up to 10% of the total heap space by default. \n+To determine if a query is eligible for caching, a history of queries is \n+maintained to track occurrences.\n+\n+Caching is done on a per segment basis if a segment contains at least 10000 \n+documents and the segment has at least 3% of the total documents of a shard. Due \n+to the per segment basis, segment merging can invalidate a cached query.", "originalCommit": "ac0204e94f9f5f1365d3bfe7d97a46bcb74eae6a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "d5bd87d3f0cdd2ce20e512cfd99a719952a3b07c", "url": "https://github.com/elastic/elasticsearch/commit/d5bd87d3f0cdd2ce20e512cfd99a719952a3b07c", "message": "Update docs/reference/modules/indices/query_cache.asciidoc\n\nCo-Authored-By: debadair <debadair@elastic.co>", "committedDate": "2020-01-20T08:58:51Z", "type": "commit"}, {"oid": "bf8b83d4894b7cce70c8dba58690f4ee9ef0c8fd", "url": "https://github.com/elastic/elasticsearch/commit/bf8b83d4894b7cce70c8dba58690f4ee9ef0c8fd", "message": "[DOCS] Addresses feedback.", "committedDate": "2020-01-20T09:36:59Z", "type": "commit"}]}