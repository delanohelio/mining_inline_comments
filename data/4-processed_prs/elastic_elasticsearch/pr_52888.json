{"pr_number": 52888, "pr_title": "Fix roles parsing in client nodes sniffer", "pr_createdAt": "2020-02-27T12:58:43Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/52888", "timeline": [{"oid": "0b9f2583f44432e90dabe3b37341cf7193655194", "url": "https://github.com/elastic/elasticsearch/commit/0b9f2583f44432e90dabe3b37341cf7193655194", "message": "Fix roles parsing in client nodes sniffer\n\nWe mades roles pluggable, but never updated the client to account for\nthis. This means that when speaking to a modern cluster, application\nlogs are spammed with warning messages around unrecognized roles. This\ncommit addresses this by accounting for the fact that roles can extend\nbeyond master/data/ingest now.", "committedDate": "2020-02-27T12:56:41Z", "type": "commit"}, {"oid": "e3a76b315ddfa9022a4a0ec8da72e87bf73bc0a5", "url": "https://github.com/elastic/elasticsearch/commit/e3a76b315ddfa9022a4a0ec8da72e87bf73bc0a5", "message": "Merge branch 'master' into fix-roles-parsing-in-llrc", "committedDate": "2020-02-27T14:00:16Z", "type": "commit"}, {"oid": "b97eca169cd24ebf7c325ca722a6d9bdbde58fa2", "url": "https://github.com/elastic/elasticsearch/commit/b97eca169cd24ebf7c325ca722a6d9bdbde58fa2", "message": "Fix compilation", "committedDate": "2020-02-27T15:41:44Z", "type": "commit"}, {"oid": "124ac22745f9c254066d0eb60126aa7233e8af8c", "url": "https://github.com/elastic/elasticsearch/commit/124ac22745f9c254066d0eb60126aa7233e8af8c", "message": "Fix tests", "committedDate": "2020-02-27T15:57:33Z", "type": "commit"}, {"oid": "44ed4100480e331391690ad2b3beee50668384a9", "url": "https://github.com/elastic/elasticsearch/commit/44ed4100480e331391690ad2b3beee50668384a9", "message": "Fix compilation", "committedDate": "2020-02-27T16:02:09Z", "type": "commit"}, {"oid": "01ce6c6d0091f0a8a5b3f06a1363571eafad0653", "url": "https://github.com/elastic/elasticsearch/commit/01ce6c6d0091f0a8a5b3f06a1363571eafad0653", "message": "Fix test", "committedDate": "2020-02-27T16:08:12Z", "type": "commit"}, {"oid": "1700773fc153f4826563e3bfbefb639f185c137b", "url": "https://github.com/elastic/elasticsearch/commit/1700773fc153f4826563e3bfbefb639f185c137b", "message": "Fix line length", "committedDate": "2020-02-27T16:18:39Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTI1NTkzMQ==", "url": "https://github.com/elastic/elasticsearch/pull/52888#discussion_r385255931", "bodyText": "Out of curiosity, should we make these constants since they're hardcoded as strings all over the place? (in separate work, not this PR)", "author": "dakrone", "createdAt": "2020-02-27T17:22:39Z", "path": "client/rest/src/main/java/org/elasticsearch/client/Node.java", "diffHunk": "@@ -175,42 +176,35 @@ public int hashCode() {\n      * Role information about an Elasticsearch process.\n      */\n     public static final class Roles {\n-        private final boolean masterEligible;\n-        private final boolean data;\n-        private final boolean ingest;\n-\n-        public Roles(boolean masterEligible, boolean data, boolean ingest) {\n-            this.masterEligible = masterEligible;\n-            this.data = data;\n-            this.ingest = ingest;\n+\n+        private final Set<String> roles;\n+\n+        public Roles(final Set<String> roles) {\n+            this.roles = new TreeSet<>(roles);\n         }\n \n         /**\n          * Teturns whether or not the node <strong>could</strong> be elected master.\n          */\n         public boolean isMasterEligible() {\n-            return masterEligible;\n+            return roles.contains(\"master\");", "originalCommit": "1700773fc153f4826563e3bfbefb639f185c137b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}