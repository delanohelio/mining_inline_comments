{"pr_number": 58679, "pr_title": "[DOCS] Document delete/update by query for data streams", "pr_createdAt": "2020-06-29T15:18:45Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/58679", "timeline": [{"oid": "9bbe3adfd5c5f171a882f095ef8225789acc560a", "url": "https://github.com/elastic/elasticsearch/commit/9bbe3adfd5c5f171a882f095ef8225789acc560a", "message": "[DOCS] Document delete/update by query for data streams", "committedDate": "2020-06-29T15:27:38Z", "type": "commit"}, {"oid": "9bbe3adfd5c5f171a882f095ef8225789acc560a", "url": "https://github.com/elastic/elasticsearch/commit/9bbe3adfd5c5f171a882f095ef8225789acc560a", "message": "[DOCS] Document delete/update by query for data streams", "committedDate": "2020-06-29T15:27:38Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzA4NDg2NA==", "url": "https://github.com/elastic/elasticsearch/pull/58679#discussion_r447084864", "bodyText": "Minor: I thought the \"Update by query API requests containing...\" sequence read a little oddly.", "author": "danhermann", "createdAt": "2020-06-29T16:06:09Z", "path": "docs/reference/data-streams/use-a-data-stream.asciidoc", "diffHunk": "@@ -426,12 +431,98 @@ POST /_reindex\n [[update-delete-docs-in-a-data-stream]]\n === Update or delete documents in a data stream\n \n-Data streams are designed to be <<data-streams-append-only,append-only>>. This\n-means you cannot send update or deletion requests for existing documents to a\n-data stream. However, you can send update or deletion requests to the backing\n-index containing the document.\n+You can use the following requests to update or delete documents in a data\n+stream:\n+\n+* <<docs-update-by-query,Update by query API>> requests containing a query", "originalCommit": "9bbe3adfd5c5f171a882f095ef8225789acc560a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzA4NTM0OA==", "url": "https://github.com/elastic/elasticsearch/pull/58679#discussion_r447085348", "bodyText": "Minor: Same as above, I thought the \"Delete by query API requests containing...\" sequence was a little odd.", "author": "danhermann", "createdAt": "2020-06-29T16:06:56Z", "path": "docs/reference/data-streams/use-a-data-stream.asciidoc", "diffHunk": "@@ -426,12 +431,98 @@ POST /_reindex\n [[update-delete-docs-in-a-data-stream]]\n === Update or delete documents in a data stream\n \n-Data streams are designed to be <<data-streams-append-only,append-only>>. This\n-means you cannot send update or deletion requests for existing documents to a\n-data stream. However, you can send update or deletion requests to the backing\n-index containing the document.\n+You can use the following requests to update or delete documents in a data\n+stream:\n+\n+* <<docs-update-by-query,Update by query API>> requests containing a query\n+that matches documents in the data stream you'd like to update.\n++\n+.*Example*\n+[%collapsible]\n+====\n+The following update by query API request updates documents in the `logs` data\n+stream with a `user.id` of `i96BP1mA`. The request uses a\n+<<modules-scripting-using,script>> to assign matching documents a new `user.id`\n+value of `XgdX0NoX`.\n+\n+////\n+[source,console]\n+----\n+PUT /logs/_create/2?refresh=wait_for\n+{\n+  \"@timestamp\": \"2020-12-07T11:06:07.000Z\",\n+  \"user\": {\n+    \"id\": \"i96BP1mA\"\n+  }\n+}\n+----\n+// TEST[continued]\n+////\n+\n+[source,console]\n+----\n+POST /logs/_update_by_query\n+{\n+  \"query\": {\n+    \"match\": {\n+      \"user.id\": \"i96BP1mA\"\n+    }\n+  },\n+  \"script\": {\n+    \"source\": \"ctx._source.user.id = params.new_id\",\n+    \"params\": {\n+      \"new_id\": \"XgdX0NoX\"\n+    }\n+  }\n+}\n+----\n+// TEST[continued]\n+====\n+\n+* <<docs-delete-by-query,Delete by query API>> requests containing a query", "originalCommit": "9bbe3adfd5c5f171a882f095ef8225789acc560a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e111dfa322a1da57414b5f97fbdb42e528edd741", "url": "https://github.com/elastic/elasticsearch/commit/e111dfa322a1da57414b5f97fbdb42e528edd741", "message": "reword", "committedDate": "2020-06-29T20:08:18Z", "type": "commit"}]}