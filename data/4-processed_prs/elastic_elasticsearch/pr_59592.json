{"pr_number": 59592, "pr_title": "Decrease restore rate limit value to enforce its usage on SearchableSnapshotsIntegTests#testMaxRestoreBytesPerSecIsUsed", "pr_createdAt": "2020-07-15T08:47:15Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/59592", "timeline": [{"oid": "d753908cbf72095b07188e8ddee0464ff82cf04c", "url": "https://github.com/elastic/elasticsearch/commit/d753908cbf72095b07188e8ddee0464ff82cf04c", "message": "Decrease restore rate limit value to enforce its usage on SearchableSnapshotsIntegTests#testMaxRestoreBytesPerSecIsUsed", "committedDate": "2020-07-15T08:40:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDkxNTc5Nw==", "url": "https://github.com/elastic/elasticsearch/pull/59592#discussion_r454915797", "bodyText": "Do you think that we could find the \"best\" value here if we don't randomize anything when indexing documents later in this test so that we have more predictable shard file sizes?", "author": "tlrx", "createdAt": "2020-07-15T09:25:13Z", "path": "x-pack/plugin/searchable-snapshots/src/test/java/org/elasticsearch/xpack/searchablesnapshots/SearchableSnapshotsIntegTests.java", "diffHunk": "@@ -350,13 +350,12 @@ public void testCanMountSnapshotTakenWhileConcurrentlyIndexing() throws Exceptio\n         ensureGreen(restoredIndexName);\n     }\n \n-    @AwaitsFix(bugUrl = \"https://github.com/elastic/elasticsearch/issues/59287\")\n     public void testMaxRestoreBytesPerSecIsUsed() throws Exception {\n         final String repositoryName = randomAlphaOfLength(10).toLowerCase(Locale.ROOT);\n         final Settings.Builder repositorySettings = Settings.builder().put(\"location\", randomRepoPath());\n         final boolean useRateLimits = randomBoolean();\n         if (useRateLimits) {\n-            repositorySettings.put(\"max_restore_bytes_per_sec\", new ByteSizeValue(10, ByteSizeUnit.KB));\n+            repositorySettings.put(\"max_restore_bytes_per_sec\", new ByteSizeValue(5, ByteSizeUnit.KB));", "originalCommit": "d753908cbf72095b07188e8ddee0464ff82cf04c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDkxODg1OA==", "url": "https://github.com/elastic/elasticsearch/pull/59592#discussion_r454918858", "bodyText": "Alternatively, could we defer repository creation until after we've created the index and then compute a good value for the throttle based on the index size?", "author": "DaveCTurner", "createdAt": "2020-07-15T09:30:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDkxNTc5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDkyMDk0Ng==", "url": "https://github.com/elastic/elasticsearch/pull/59592#discussion_r454920946", "bodyText": "Good idea, it also takes care of any future Lucene change that would impact file sizes.", "author": "tlrx", "createdAt": "2020-07-15T09:33:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDkxNTc5Nw=="}], "type": "inlineReview"}, {"oid": "b0c17d1843926cfc28005c896dfba7e7d722f317", "url": "https://github.com/elastic/elasticsearch/commit/b0c17d1843926cfc28005c896dfba7e7d722f317", "message": "Use the actual shard sizes instead of an arbitrary value to set the rate\nlimiter value.", "committedDate": "2020-07-15T10:12:32Z", "type": "commit"}]}