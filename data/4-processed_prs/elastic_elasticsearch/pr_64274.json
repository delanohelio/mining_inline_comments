{"pr_number": 64274, "pr_title": "Make ES files inside Docker container world readable", "pr_createdAt": "2020-10-28T11:31:15Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/64274", "timeline": [{"oid": "09aa07aafd8d4bf9adf7b780c4058f065b2122a0", "url": "https://github.com/elastic/elasticsearch/commit/09aa07aafd8d4bf9adf7b780c4058f065b2122a0", "message": "Allow regular files in Docker images to be world-readable", "committedDate": "2020-10-27T15:56:36Z", "type": "commit"}, {"oid": "a779e90f437f21b89380d0883b163dac2b794371", "url": "https://github.com/elastic/elasticsearch/commit/a779e90f437f21b89380d0883b163dac2b794371", "message": "Document how to run ES in Docker with a custom UID + GID", "committedDate": "2020-10-27T16:12:37Z", "type": "commit"}, {"oid": "901f13c53bf8e5c3d11fe387bb09349a10573fb9", "url": "https://github.com/elastic/elasticsearch/commit/901f13c53bf8e5c3d11fe387bb09349a10573fb9", "message": "Simplify docs, add test for --group-add\n\nAlso refactor how we construct the `docker run` command into a builder\nobject, since the code was better unwieldly and I couldn't easy add\narbitrary docker CLI arguments.", "committedDate": "2020-10-28T11:11:53Z", "type": "commit"}, {"oid": "e65421f1c2d50521918429b4ca72fb8e658aebde", "url": "https://github.com/elastic/elasticsearch/commit/e65421f1c2d50521918429b4ca72fb8e658aebde", "message": "Checkstyle", "committedDate": "2020-10-28T13:40:33Z", "type": "commit"}, {"oid": "bbe20f1c7cd3a1f41196ce62fbe5187b221c7bf2", "url": "https://github.com/elastic/elasticsearch/commit/bbe20f1c7cd3a1f41196ce62fbe5187b221c7bf2", "message": "Merge remote-tracking branch 'upstream/master' into docker-files-world-readable", "committedDate": "2020-10-28T15:36:39Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDU3NjY5MA==", "url": "https://github.com/elastic/elasticsearch/pull/64274#discussion_r514576690", "bodyText": "I guess my only question is what is the point of this? I only assume running as a different user is something done by security conscious orgs that don't like the idea of running containers as root. Wouldn't then subsequently adding the user to the root group defeat the purpose?", "author": "mark-vieira", "createdAt": "2020-10-29T21:24:45Z", "path": "docs/reference/setup/install/docker.asciidoc", "diffHunk": "@@ -234,6 +235,12 @@ chmod g+rwx esdatadir\n chgrp 0 esdatadir\n --------------------------------------------\n \n+You can also run an {es} container using both a custom UID and GID. Unless you\n+bind-mount each of the `config`, data` and `logs` directories, you must pass\n+the command line option `--group-add 0` to `docker run`. This ensures that the user", "originalCommit": "bbe20f1c7cd3a1f41196ce62fbe5187b221c7bf2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA5NDM3OQ==", "url": "https://github.com/elastic/elasticsearch/pull/64274#discussion_r515094379", "bodyText": "It's mostly a convenience for users who might be experimenting with the image, or are only interested in capturing the stdout/stderr output of the container and don't want to bind-mount the logs directory. It also serves to document why someone might have problems running the image with a custom GID.\nNote that the container user is only added to the root group inside the container, but files in bind-mounted volumes are still written as the user-specified GID, so everything is still OK outside of the container.", "author": "pugnascotia", "createdAt": "2020-10-30T13:25:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDU3NjY5MA=="}], "type": "inlineReview"}]}