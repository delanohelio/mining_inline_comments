{"pr_number": 52964, "pr_title": "Clarify futher  the order for a rolling upgrade", "pr_createdAt": "2020-02-28T17:23:08Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/52964", "timeline": [{"oid": "cb062140f75b41d653b431ef6f2428f389fa74ed", "url": "https://github.com/elastic/elasticsearch/commit/cb062140f75b41d653b431ef6f2428f389fa74ed", "message": "Clarify futher  the order for a rolling upgrade\n\nExpands the \"master-ineligible then master-eligible\" sentence into a list and\nspecifies that within these subsets the order doesn't matter.", "committedDate": "2020-02-28T17:17:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTgzMDE5NA==", "url": "https://github.com/elastic/elasticsearch/pull/52964#discussion_r385830194", "bodyText": "I'd use direct voice here. It makes the sentence a bit stronger.\n\nWe strongly recommend you upgrade your cluster's nodes in the following order:", "author": "jrodewig", "createdAt": "2020-02-28T17:38:09Z", "path": "docs/reference/upgrade/rolling_upgrade.asciidoc", "diffHunk": "@@ -7,11 +7,23 @@ a time so upgrading does not interrupt service. Running multiple versions of\n not supported, as shards cannot be replicated from upgraded nodes to nodes\n running the older version.\n \n-It is best to upgrade the master-eligible nodes in your cluster after all of\n-the other nodes. Once you have started to upgrade the master-eligible nodes\n-they may form a cluster that nodes of older versions cannot join. If you\n-upgrade the master-eligible nodes last then all the other nodes will not be\n-running an older version and so they will be able to join the cluster.\n+It is strongly recommended to upgrade the nodes in your cluster in the\n+following order:", "originalCommit": "cb062140f75b41d653b431ef6f2428f389fa74ed", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTgzMDUzMQ==", "url": "https://github.com/elastic/elasticsearch/pull/52964#discussion_r385830531", "bodyText": "I would link to master-eligible here.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            . Nodes that are not master-eligible. You can retrieve a list of these nodes\n          \n          \n            \n            . Nodes that are not <<master-node,master-eligible>>. You can retrieve a list of these nodes", "author": "jrodewig", "createdAt": "2020-02-28T17:38:58Z", "path": "docs/reference/upgrade/rolling_upgrade.asciidoc", "diffHunk": "@@ -7,11 +7,23 @@ a time so upgrading does not interrupt service. Running multiple versions of\n not supported, as shards cannot be replicated from upgraded nodes to nodes\n running the older version.\n \n-It is best to upgrade the master-eligible nodes in your cluster after all of\n-the other nodes. Once you have started to upgrade the master-eligible nodes\n-they may form a cluster that nodes of older versions cannot join. If you\n-upgrade the master-eligible nodes last then all the other nodes will not be\n-running an older version and so they will be able to join the cluster.\n+It is strongly recommended to upgrade the nodes in your cluster in the\n+following order:\n+\n+. Nodes that are not master-eligible. You can retrieve a list of these nodes", "originalCommit": "cb062140f75b41d653b431ef6f2428f389fa74ed", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTgzMDU3MQ==", "url": "https://github.com/elastic/elasticsearch/pull/52964#discussion_r385830571", "bodyText": "This comma is unneeded. You can also remove \"which are\"\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            with `GET /_nodes/master:false`, or by finding all the nodes which are\n          \n          \n            \n            with `GET /_nodes/master:false` or by finding all the nodes", "author": "jrodewig", "createdAt": "2020-02-28T17:39:05Z", "path": "docs/reference/upgrade/rolling_upgrade.asciidoc", "diffHunk": "@@ -7,11 +7,23 @@ a time so upgrading does not interrupt service. Running multiple versions of\n not supported, as shards cannot be replicated from upgraded nodes to nodes\n running the older version.\n \n-It is best to upgrade the master-eligible nodes in your cluster after all of\n-the other nodes. Once you have started to upgrade the master-eligible nodes\n-they may form a cluster that nodes of older versions cannot join. If you\n-upgrade the master-eligible nodes last then all the other nodes will not be\n-running an older version and so they will be able to join the cluster.\n+It is strongly recommended to upgrade the nodes in your cluster in the\n+following order:\n+\n+. Nodes that are not master-eligible. You can retrieve a list of these nodes\n+with `GET /_nodes/master:false`, or by finding all the nodes which are", "originalCommit": "cb062140f75b41d653b431ef6f2428f389fa74ed", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTgzMTEwNw==", "url": "https://github.com/elastic/elasticsearch/pull/52964#discussion_r385831107", "bodyText": "I don't think \"your\" is needed here.\n\nconfigured with node.master: false. You may upgrade this subset of nodes", "author": "jrodewig", "createdAt": "2020-02-28T17:40:29Z", "path": "docs/reference/upgrade/rolling_upgrade.asciidoc", "diffHunk": "@@ -7,11 +7,23 @@ a time so upgrading does not interrupt service. Running multiple versions of\n not supported, as shards cannot be replicated from upgraded nodes to nodes\n running the older version.\n \n-It is best to upgrade the master-eligible nodes in your cluster after all of\n-the other nodes. Once you have started to upgrade the master-eligible nodes\n-they may form a cluster that nodes of older versions cannot join. If you\n-upgrade the master-eligible nodes last then all the other nodes will not be\n-running an older version and so they will be able to join the cluster.\n+It is strongly recommended to upgrade the nodes in your cluster in the\n+following order:\n+\n+. Nodes that are not master-eligible. You can retrieve a list of these nodes\n+with `GET /_nodes/master:false`, or by finding all the nodes which are\n+configured with `node.master: false`. You may upgrade this subset of your nodes", "originalCommit": "cb062140f75b41d653b431ef6f2428f389fa74ed", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTgzMTkxMQ==", "url": "https://github.com/elastic/elasticsearch/pull/52964#discussion_r385831911", "bodyText": "I'd reword this slightly:\n\nMaster-eligible nodes, which are all remaining nodes in the cluster.", "author": "jrodewig", "createdAt": "2020-02-28T17:42:19Z", "path": "docs/reference/upgrade/rolling_upgrade.asciidoc", "diffHunk": "@@ -7,11 +7,23 @@ a time so upgrading does not interrupt service. Running multiple versions of\n not supported, as shards cannot be replicated from upgraded nodes to nodes\n running the older version.\n \n-It is best to upgrade the master-eligible nodes in your cluster after all of\n-the other nodes. Once you have started to upgrade the master-eligible nodes\n-they may form a cluster that nodes of older versions cannot join. If you\n-upgrade the master-eligible nodes last then all the other nodes will not be\n-running an older version and so they will be able to join the cluster.\n+It is strongly recommended to upgrade the nodes in your cluster in the\n+following order:\n+\n+. Nodes that are not master-eligible. You can retrieve a list of these nodes\n+with `GET /_nodes/master:false`, or by finding all the nodes which are\n+configured with `node.master: false`. You may upgrade this subset of your nodes\n+in any order.\n+\n+. Nodes that are master-eligible, which is all the remaining nodes. You can", "originalCommit": "cb062140f75b41d653b431ef6f2428f389fa74ed", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTgzMjU1OQ==", "url": "https://github.com/elastic/elasticsearch/pull/52964#discussion_r385832559", "bodyText": "\"your\" is unneeded.\n\nthis subset of nodes in any order.", "author": "jrodewig", "createdAt": "2020-02-28T17:43:47Z", "path": "docs/reference/upgrade/rolling_upgrade.asciidoc", "diffHunk": "@@ -7,11 +7,23 @@ a time so upgrading does not interrupt service. Running multiple versions of\n not supported, as shards cannot be replicated from upgraded nodes to nodes\n running the older version.\n \n-It is best to upgrade the master-eligible nodes in your cluster after all of\n-the other nodes. Once you have started to upgrade the master-eligible nodes\n-they may form a cluster that nodes of older versions cannot join. If you\n-upgrade the master-eligible nodes last then all the other nodes will not be\n-running an older version and so they will be able to join the cluster.\n+It is strongly recommended to upgrade the nodes in your cluster in the\n+following order:\n+\n+. Nodes that are not master-eligible. You can retrieve a list of these nodes\n+with `GET /_nodes/master:false`, or by finding all the nodes which are\n+configured with `node.master: false`. You may upgrade this subset of your nodes\n+in any order.\n+\n+. Nodes that are master-eligible, which is all the remaining nodes. You can\n+retrieve a list of these nodes with `GET /_nodes/master:true`. You may upgrade\n+this subset of your nodes in any order.", "originalCommit": "cb062140f75b41d653b431ef6f2428f389fa74ed", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTgzMzgxOQ==", "url": "https://github.com/elastic/elasticsearch/pull/52964#discussion_r385833819", "bodyText": "I believe this sentence is stronger without \"The reason for ...\" and some rewording:\n\nNewer nodes can always join a cluster with an older master, but older nodes cannot always join a cluster with a newer master. This upgrade approach ensures all non-master-eligible nodes are first running a newer version. This means they can join the cluster, even if the cluster's master-eligible nodes have not been upgraded.\n\nIt may be helpful to add a sentence about what could happen otherwise.", "author": "jrodewig", "createdAt": "2020-02-28T17:46:31Z", "path": "docs/reference/upgrade/rolling_upgrade.asciidoc", "diffHunk": "@@ -7,11 +7,23 @@ a time so upgrading does not interrupt service. Running multiple versions of\n not supported, as shards cannot be replicated from upgraded nodes to nodes\n running the older version.\n \n-It is best to upgrade the master-eligible nodes in your cluster after all of\n-the other nodes. Once you have started to upgrade the master-eligible nodes\n-they may form a cluster that nodes of older versions cannot join. If you\n-upgrade the master-eligible nodes last then all the other nodes will not be\n-running an older version and so they will be able to join the cluster.\n+It is strongly recommended to upgrade the nodes in your cluster in the\n+following order:\n+\n+. Nodes that are not master-eligible. You can retrieve a list of these nodes\n+with `GET /_nodes/master:false`, or by finding all the nodes which are\n+configured with `node.master: false`. You may upgrade this subset of your nodes\n+in any order.\n+\n+. Nodes that are master-eligible, which is all the remaining nodes. You can\n+retrieve a list of these nodes with `GET /_nodes/master:true`. You may upgrade\n+this subset of your nodes in any order.\n+\n+The reason for this recommendation is that newer nodes can always join a\n+cluster with an older master, but older nodes cannot always join a cluster with\n+a newer master. By upgrading the master-eligible nodes last you ensure that all\n+the other nodes are running the newer version first and so they will be able to\n+join the cluster whether the master-eligible nodes have been upgraded or not.", "originalCommit": "cb062140f75b41d653b431ef6f2428f389fa74ed", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "14aa0731284b3998526ff6f4b5fa7acac9e6ff46", "url": "https://github.com/elastic/elasticsearch/commit/14aa0731284b3998526ff6f4b5fa7acac9e6ff46", "message": "Modified the text a little\n\nRemoved the duplicated text from the 2 \"groups\" of nodes", "committedDate": "2020-03-02T14:53:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODAwNTY1Mg==", "url": "https://github.com/elastic/elasticsearch/pull/52964#discussion_r388005652", "bodyText": "Nit: please wrap at 80 columns.", "author": "jasontedor", "createdAt": "2020-03-04T23:58:22Z", "path": "docs/reference/upgrade/rolling_upgrade.asciidoc", "diffHunk": "@@ -7,11 +7,20 @@ a time so upgrading does not interrupt service. Running multiple versions of\n not supported, as shards cannot be replicated from upgraded nodes to nodes\n running the older version.\n \n-It is best to upgrade the master-eligible nodes in your cluster after all of\n-the other nodes. Once you have started to upgrade the master-eligible nodes\n-they may form a cluster that nodes of older versions cannot join. If you\n-upgrade the master-eligible nodes last then all the other nodes will not be\n-running an older version and so they will be able to join the cluster.\n+It is strongly recommended to upgrade the nodes in your cluster by grouping the nodes into two groups, as shown below.  Nodes within each group may be upgraded in any order, as long as the last group is the master-eligable group:", "originalCommit": "14aa0731284b3998526ff6f4b5fa7acac9e6ff46", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODAwNTk2MA==", "url": "https://github.com/elastic/elasticsearch/pull/52964#discussion_r388005960", "bodyText": "Nit: please wrap at 80 columns.", "author": "jasontedor", "createdAt": "2020-03-04T23:59:35Z", "path": "docs/reference/upgrade/rolling_upgrade.asciidoc", "diffHunk": "@@ -7,11 +7,20 @@ a time so upgrading does not interrupt service. Running multiple versions of\n not supported, as shards cannot be replicated from upgraded nodes to nodes\n running the older version.\n \n-It is best to upgrade the master-eligible nodes in your cluster after all of\n-the other nodes. Once you have started to upgrade the master-eligible nodes\n-they may form a cluster that nodes of older versions cannot join. If you\n-upgrade the master-eligible nodes last then all the other nodes will not be\n-running an older version and so they will be able to join the cluster.\n+It is strongly recommended to upgrade the nodes in your cluster by grouping the nodes into two groups, as shown below.  Nodes within each group may be upgraded in any order, as long as the last group is the master-eligable group:\n+\n+. Nodes that are not master-eligible. You can retrieve a list of these nodes\n+with `GET /_nodes/master:false`, or by finding all the nodes which are\n+configured with `node.master: false`.\n+\n+. Nodes that are master-eligible, which is all the remaining nodes. You can\n+retrieve a list of these nodes with `GET /_nodes/master:true`.\n+\n+By upgrading in this order it ensures that unforeseen circumstances do not break the upgrade.  \n+Newer nodes can always join a cluster with an older master, but older nodes cannot always join a cluster with", "originalCommit": "14aa0731284b3998526ff6f4b5fa7acac9e6ff46", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "c48968890cf6fb9609b28362e300202e4fcb53c4", "url": "https://github.com/elastic/elasticsearch/commit/c48968890cf6fb9609b28362e300202e4fcb53c4", "message": "Merge branch 'master' into 2020-02-28-further-rolling-upgrade-docs", "committedDate": "2020-03-05T14:13:34Z", "type": "commit"}, {"oid": "1e5c4a363d1cd623517b768be56e190a1a1d5218", "url": "https://github.com/elastic/elasticsearch/commit/1e5c4a363d1cd623517b768be56e190a1a1d5218", "message": "Review suggestions", "committedDate": "2020-03-05T14:52:00Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM0NDM5Mg==", "url": "https://github.com/elastic/elasticsearch/pull/52964#discussion_r388344392", "bodyText": "\"We strongly recommend you upgrade you divide your cluster's nodes\" -> \"We strongly recommend that when you upgrade you divide your cluster's nodes\"", "author": "jasontedor", "createdAt": "2020-03-05T14:54:18Z", "path": "docs/reference/upgrade/rolling_upgrade.asciidoc", "diffHunk": "@@ -7,11 +7,27 @@ a time so upgrading does not interrupt service. Running multiple versions of\n not supported, as shards cannot be replicated from upgraded nodes to nodes\n running the older version.\n \n-It is best to upgrade the master-eligible nodes in your cluster after all of\n-the other nodes. Once you have started to upgrade the master-eligible nodes\n-they may form a cluster that nodes of older versions cannot join. If you\n-upgrade the master-eligible nodes last then all the other nodes will not be\n-running an older version and so they will be able to join the cluster.\n+We strongly recommend you upgrade you divide your cluster's nodes into the", "originalCommit": "1e5c4a363d1cd623517b768be56e190a1a1d5218", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM0ODY4OA==", "url": "https://github.com/elastic/elasticsearch/pull/52964#discussion_r388348688", "bodyText": "Good catch, thanks", "author": "DaveCTurner", "createdAt": "2020-03-05T15:00:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM0NDM5Mg=="}], "type": "inlineReview"}, {"oid": "6739c0d4ca20cbbfa20f58d36eb2cd621ddcc13b", "url": "https://github.com/elastic/elasticsearch/commit/6739c0d4ca20cbbfa20f58d36eb2cd621ddcc13b", "message": "Dedup", "committedDate": "2020-03-05T14:56:15Z", "type": "commit"}, {"oid": "695693515904f442469dca6c25f72f9b7eab704d", "url": "https://github.com/elastic/elasticsearch/commit/695693515904f442469dca6c25f72f9b7eab704d", "message": "Bah", "committedDate": "2020-03-05T14:59:58Z", "type": "commit"}]}