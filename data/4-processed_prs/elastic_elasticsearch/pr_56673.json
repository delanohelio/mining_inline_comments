{"pr_number": 56673, "pr_title": "Disable search context release checks after every test", "pr_createdAt": "2020-05-13T10:23:19Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/56673", "timeline": [{"oid": "ffcf46e1da0b5dc731b93e28f62b295a16851187", "url": "https://github.com/elastic/elasticsearch/commit/ffcf46e1da0b5dc731b93e28f62b295a16851187", "message": "Disable search context release checks after every test\n\nThis change adds a way to disable the checks that search contexts are all released\nafter each test in ESTestCase.\nThis is used by ESIntegTestCase to disable these checks if the cluster is shared\nacross all methods (SUITE scope). In this case, the contexts are checked at the end\nwhen the cluster is cleared. This fixes integration tests that starts components that\nperform search requests internally with a fixed delay (e.g.: async search maintenance service).\n\nFixes #55988", "committedDate": "2020-05-13T10:20:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU2MzcxNw==", "url": "https://github.com/elastic/elasticsearch/pull/56673#discussion_r424563717", "bodyText": "I think debugging would be easier if we return true here and false in AsyncSearchActionIT instead.", "author": "dnhatn", "createdAt": "2020-05-13T16:15:54Z", "path": "test/framework/src/main/java/org/elasticsearch/test/ESIntegTestCase.java", "diffHunk": "@@ -348,6 +348,14 @@ protected final boolean enableWarningsCheck() {\n         return false;\n     }\n \n+    @Override\n+    protected boolean enableSearchContextAfterCheck() {\n+        // We don't want to check the release of search contexts between tests if the cluster is shared.", "originalCommit": "ffcf46e1da0b5dc731b93e28f62b295a16851187", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDY5MTExNg==", "url": "https://github.com/elastic/elasticsearch/pull/56673#discussion_r424691116", "bodyText": "I reverted this since this solution doesn't work. Sorry for the trouble", "author": "jimczi", "createdAt": "2020-05-13T19:49:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU2MzcxNw=="}], "type": "inlineReview"}, {"oid": "59603cbd7e2866cf598570d5c7a14a6f6a71b92e", "url": "https://github.com/elastic/elasticsearch/commit/59603cbd7e2866cf598570d5c7a14a6f6a71b92e", "message": "start/stop the maintenance service between each test", "committedDate": "2020-05-13T19:45:10Z", "type": "commit"}, {"oid": "f8f223ca810f8a5b5f8784ffc33b61711e963442", "url": "https://github.com/elastic/elasticsearch/commit/f8f223ca810f8a5b5f8784ffc33b61711e963442", "message": "Merge branch 'master' into scope_search_context", "committedDate": "2020-05-13T19:45:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDcwNTg1MA==", "url": "https://github.com/elastic/elasticsearch/pull/56673#discussion_r424705850", "bodyText": "s/Maitenance/Maintenance here and below", "author": "javanna", "createdAt": "2020-05-13T20:17:11Z", "path": "x-pack/plugin/async-search/src/test/java/org/elasticsearch/xpack/search/AsyncSearchIntegTestCase.java", "diffHunk": "@@ -71,6 +75,25 @@ public SearchTestPlugin() {}\n         }\n     }\n \n+    @Before\n+    public void startMaitenanceService() {", "originalCommit": "f8f223ca810f8a5b5f8784ffc33b61711e963442", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "86a17aa450e57f464df7d57929079642aae1b571", "url": "https://github.com/elastic/elasticsearch/commit/86a17aa450e57f464df7d57929079642aae1b571", "message": "fix typo", "committedDate": "2020-05-13T20:57:11Z", "type": "commit"}, {"oid": "a4bdb6d9cd303d8eef578ec80e0a60c2e8e77e09", "url": "https://github.com/elastic/elasticsearch/commit/a4bdb6d9cd303d8eef578ec80e0a60c2e8e77e09", "message": "Merge branch 'master' into scope_search_context", "committedDate": "2020-05-14T08:11:27Z", "type": "commit"}]}