{"pr_number": 53521, "pr_title": "Improve top_metrics docs", "pr_createdAt": "2020-03-12T22:07:03Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/53521", "timeline": [{"oid": "e345e56bd0651b3a0a0d3a1e611d565b738cdbeb", "url": "https://github.com/elastic/elasticsearch/commit/e345e56bd0651b3a0a0d3a1e611d565b738cdbeb", "message": "Improve top_metrics docs\n\n* Removes experimental.\n* Replaces `\"v\"` (for value) with `\"m\"` (for metric).\n* Move the note about tiebreaking into the list of limitations of the\n  sort.\n* Explain how you ask for `metrics`.\n* Clean up some wording.\n* Link to the docs from `top_metrics`.\n\nCloses #51813", "committedDate": "2020-03-12T22:03:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzA3Mjk1NA==", "url": "https://github.com/elastic/elasticsearch/pull/53521#discussion_r393072954", "bodyText": "Is the behavior around ties deterministic, i.e. if no new documents are added will the aggregation always return the same results in the presence of ties?  Or do ties essentially result in random results?  Is it possible/worth it to return a flag indicating a tie happened, or do we not even know it at aggregation time?\nI have gotten burned hard by users who think millisecond resolution time stamps are unique identifiers...", "author": "not-napoleon", "createdAt": "2020-03-16T14:37:02Z", "path": "docs/reference/aggregations/metrics/top-metrics-aggregation.asciidoc", "diffHunk": "@@ -54,7 +52,7 @@ The `sort` field in the metric request functions exactly the same as the `sort`\n <<request-body-search-sort, search>> request except:\n * It can't be used on <<binary,binary>>, <<flattened,flattened>, <<ip,ip>>,\n <<keyword,keyword>>, or <<text,text>> fields.\n-* It only supports a single sort value.\n+* It only supports a single sort value so which document wins ties is not specified.", "originalCommit": "e345e56bd0651b3a0a0d3a1e611d565b738cdbeb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE5MDA3Mg==", "url": "https://github.com/elastic/elasticsearch/pull/53521#discussion_r393190072", "bodyText": "BucketedSort is deterministic, but Lucene is only sort of deterministic. If you don't write anything and it doesn't merge any segments then it'll return the same thing every time. But writes and merges are async from, well, everything.\nA flag for ties would require an extra bit for every bucket, I think. We'd need to store if the bottom entry hit a tie. We could derive whether or not there are ties from there. But that doesn't seem worth it.", "author": "nik9000", "createdAt": "2020-03-16T17:22:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzA3Mjk1NA=="}], "type": "inlineReview"}]}