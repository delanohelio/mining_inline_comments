{"pr_number": 53079, "pr_title": "Consolidate duplication of BWC testing task setup in script plugin", "pr_createdAt": "2020-03-03T20:33:46Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/53079", "timeline": [{"oid": "8b594a548cd667c6a694446a7c47b6f1388a8b52", "url": "https://github.com/elastic/elasticsearch/commit/8b594a548cd667c6a694446a7c47b6f1388a8b52", "message": "Consolidate duplication of BWC testing task setup in script plugin\n\nSigned-off-by: Mark Vieira <portugee@gmail.com>", "committedDate": "2020-03-03T20:28:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzMwMjA0OQ==", "url": "https://github.com/elastic/elasticsearch/pull/53079#discussion_r387302049", "bodyText": "Why would we be adding a test task if there are no unit tests?", "author": "rjernst", "createdAt": "2020-03-03T21:24:30Z", "path": "gradle/bwc-test.gradle", "diffHunk": "@@ -0,0 +1,30 @@\n+import org.elasticsearch.gradle.Version\n+\n+ext.bwcTaskName = { Version version ->\n+  return \"v${version}#bwcTest\"\n+}\n+\n+def bwcTestSnapshots = tasks.register(\"bwcTestSnapshots\") {\n+  if (project.bwc_tests_enabled) {\n+    dependsOn tasks.matching { task -> bwcVersions.unreleased.any { version -> bwcTaskName(version) == task.name } }\n+  }\n+}\n+\n+tasks.register(\"bwcTest\") {\n+  description = 'Runs backwards compatibility tests.'\n+  group = 'verification'\n+\n+  if (project.bwc_tests_enabled) {\n+    dependsOn tasks.matching { it.name ==~ /v[0-9\\.]+#bwcTest/ }\n+  }\n+}\n+\n+tasks.withType(Test).configureEach {\n+  onlyIf { project.bwc_tests_enabled }\n+}\n+\n+tasks.named(\"check\").configure {\n+  dependsOn(bwcTestSnapshots)\n+}\n+\n+test.enabled = false", "originalCommit": "8b594a548cd667c6a694446a7c47b6f1388a8b52", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzMyNTkxMw==", "url": "https://github.com/elastic/elasticsearch/pull/53079#discussion_r387325913", "bodyText": "Because the standalone test plugin creates it. Addressing that annoyance is out of the scope of the PR.", "author": "mark-vieira", "createdAt": "2020-03-03T22:12:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzMwMjA0OQ=="}], "type": "inlineReview"}]}