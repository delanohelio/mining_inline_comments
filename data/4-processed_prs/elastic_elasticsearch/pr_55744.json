{"pr_number": 55744, "pr_title": "[DOCS] Add UUID troubleshooting tip for stack monitoring", "pr_createdAt": "2020-04-24T19:00:55Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/55744", "timeline": [{"oid": "5e9fdc5d2190669015243792e9fddf1ba7c9d34e", "url": "https://github.com/elastic/elasticsearch/commit/5e9fdc5d2190669015243792e9fddf1ba7c9d34e", "message": "[DOCS] Add UUID troubleshooting tip for stack monitoring", "committedDate": "2020-04-24T18:55:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDgxODMyOA==", "url": "https://github.com/elastic/elasticsearch/pull/55744#discussion_r414818328", "bodyText": "I wonder if this is too vague, as it could apply to other situations as well, e.g. monitoring data is missing for some period of time. How about something along the lines of, \"Monitoring data for some stack nodes or instances is missing from {kib}\"", "author": "ycombinator", "createdAt": "2020-04-24T19:40:21Z", "path": "docs/reference/monitoring/troubleshooting.asciidoc", "diffHunk": "@@ -27,3 +30,14 @@ monitoring data by using {metricbeat} the indices have `-mb` in their names. If\n the indices do not exist, review your configuration. For example, see\n <<monitoring-production>>.\n \n+[[monitoring-troubleshooting-uuid]]\n+=== Some monitoring data is missing from {kib}", "originalCommit": "5e9fdc5d2190669015243792e9fddf1ba7c9d34e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDg3MzUwOA==", "url": "https://github.com/elastic/elasticsearch/pull/55744#discussion_r414873508", "bodyText": "Good point, thanks!", "author": "lcawl", "createdAt": "2020-04-24T21:27:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDgxODMyOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDgxODk1Mw==", "url": "https://github.com/elastic/elasticsearch/pull/55744#discussion_r414818953", "bodyText": "Perhaps @dedemorton can weigh in here: what term do we like to use for an individual running Beat process? An instance? A node? Something else?", "author": "ycombinator", "createdAt": "2020-04-24T19:41:23Z", "path": "docs/reference/monitoring/troubleshooting.asciidoc", "diffHunk": "@@ -27,3 +30,14 @@ monitoring data by using {metricbeat} the indices have `-mb` in their names. If\n the indices do not exist, review your configuration. For example, see\n <<monitoring-production>>.\n \n+[[monitoring-troubleshooting-uuid]]\n+=== Some monitoring data is missing from {kib}\n+\n+*Symptoms*:\n+The information about some nodes, instances, or Beats in your cluster are\n+missing from the *Stack Monitoring* page in {kib}.\n+\n+*Resolution*:\n+Verify that the missing items have unique UUIDs. Each {es} node, {ls} node,\n+{kib} instance, and Beat is considered unique based on its persistent UUID,", "originalCommit": "5e9fdc5d2190669015243792e9fddf1ba7c9d34e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDgyODE5MA==", "url": "https://github.com/elastic/elasticsearch/pull/55744#discussion_r414828190", "bodyText": "I prefer instance.", "author": "dedemorton", "createdAt": "2020-04-24T19:58:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDgxODk1Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDgyNTQ1Nw==", "url": "https://github.com/elastic/elasticsearch/pull/55744#discussion_r414825457", "bodyText": "For Beats and APM server, I'd say that the way to ensure that each Beat instance is seen as unique in the Stack Monitoring UI, the Beat's path.data folder must be non-existent or empty after installation.\n@jakelandis I imagine an ES node's UUID is stored somewhere in it's data folder? Is it sufficient to say (from a user's perspective) that for a node to be given a new UUID it's data folder would have to not exist or be empty - same as the statement I'm making above for Beats?\n@tylersmalley Same question as ES above, but for Kibana. I happen to know that the UUID is stored in data/uuid but, in general, we'd want a new Kibana instance to have an empty or non-existent data folder, right?\n@jsvd Same question as ES above, but for Logstash. I happen to know that the UUID is stored in data/uuid but, in general, we'd want a new Logstash node to have an empty or non-existent data folder, right?", "author": "ycombinator", "createdAt": "2020-04-24T19:53:32Z", "path": "docs/reference/monitoring/troubleshooting.asciidoc", "diffHunk": "@@ -27,3 +30,14 @@ monitoring data by using {metricbeat} the indices have `-mb` in their names. If\n the indices do not exist, review your configuration. For example, see\n <<monitoring-production>>.\n \n+[[monitoring-troubleshooting-uuid]]\n+=== Some monitoring data is missing from {kib}\n+\n+*Symptoms*:\n+The information about some nodes, instances, or Beats in your cluster are\n+missing from the *Stack Monitoring* page in {kib}.\n+\n+*Resolution*:\n+Verify that the missing items have unique UUIDs. Each {es} node, {ls} node,\n+{kib} instance, and Beat is considered unique based on its persistent UUID,\n+which is found in its `path.data` directory.", "originalCommit": "5e9fdc5d2190669015243792e9fddf1ba7c9d34e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDg3NTc5NQ==", "url": "https://github.com/elastic/elasticsearch/pull/55744#discussion_r414875795", "bodyText": "Thanks @ycombinator I agree this will be useful information to add for all of the products.", "author": "lcawl", "createdAt": "2020-04-24T21:33:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDgyNTQ1Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDg4Mjc1NQ==", "url": "https://github.com/elastic/elasticsearch/pull/55744#discussion_r414882755", "bodyText": "@ycombinator - We have a couple ways to reference the node, all of is stored in cluster state. Cluster state is technically stored in the data dir, but not a readable format. i.e. If you delete the data folder, you will get new a node id. The IDs are in the logs (at startup) and would suggest to reference the logs to get ids needed for troubleshooting.", "author": "jakelandis", "createdAt": "2020-04-24T21:48:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDgyNTQ1Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzMxOTY3NA==", "url": "https://github.com/elastic/elasticsearch/pull/55744#discussion_r417319674", "bodyText": "@ycombinator that is correct.", "author": "tylersmalley", "createdAt": "2020-04-29T13:36:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDgyNTQ1Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzM0NzQ2Nw==", "url": "https://github.com/elastic/elasticsearch/pull/55744#discussion_r417347467", "bodyText": "@ycombinator Logstash will check if the uuid file exists in path.data, and create it otherwise. For running instances one can also retrieve the id through LS' API (i.e. curl -s localhost:9600 | jq \".id\")", "author": "jsvd", "createdAt": "2020-04-29T14:13:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDgyNTQ1Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzM1MDAzMw==", "url": "https://github.com/elastic/elasticsearch/pull/55744#discussion_r417350033", "bodyText": "Maybe a followup step here would be to explain how to check if a uuid is showing up at all using a query in Elasticsearch. If the uuid doesn't show up at all then data isn't being generated or reaching the cluster, if it exists maybe we could do a second query to list ips associated with that uuid?", "author": "jsvd", "createdAt": "2020-04-29T14:16:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDgyNTQ1Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzM2NDUwMA==", "url": "https://github.com/elastic/elasticsearch/pull/55744#discussion_r417364500", "bodyText": "Thanks @jakelandis, @tylersmalley, and @jsvd for your inputs about ES, Kibana, and LS respectively.\nSo the context for this discussion is that we often see users copying over our product's install folders, including the data path. This leads to two instances/nodes having the same UUID and, as a result, users see fewer instances/nodes in the Stack Monitoring UI than they are expecting. So we're trying to add docs here about how to troubleshoot this issue.\n\nif it exists maybe we could do a second query to list ips associated with that uuid?\n\nYes! In fact, we could have a Cluster Alert for this situation. Just created elastic/kibana#64779 to track this feature. Let's continue any related discussion there. Thanks @jsvd!", "author": "ycombinator", "createdAt": "2020-04-29T14:34:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDgyNTQ1Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDgyOTY0Mg==", "url": "https://github.com/elastic/elasticsearch/pull/55744#discussion_r414829642", "bodyText": "If you're talking about ES nodes, LS nodes, etc here, then you should spell out the list like you do below.\nFor American English, the verb here should be singular (information...is missing).", "author": "dedemorton", "createdAt": "2020-04-24T20:01:11Z", "path": "docs/reference/monitoring/troubleshooting.asciidoc", "diffHunk": "@@ -27,3 +30,14 @@ monitoring data by using {metricbeat} the indices have `-mb` in their names. If\n the indices do not exist, review your configuration. For example, see\n <<monitoring-production>>.\n \n+[[monitoring-troubleshooting-uuid]]\n+=== Some monitoring data is missing from {kib}\n+\n+*Symptoms*:\n+The information about some nodes, instances, or Beats in your cluster are", "originalCommit": "5e9fdc5d2190669015243792e9fddf1ba7c9d34e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDg3NDg1NQ==", "url": "https://github.com/elastic/elasticsearch/pull/55744#discussion_r414874855", "bodyText": "I decided not to repeat all the terms, but I've reformatted the sentence and addressed the typo, thanks!", "author": "lcawl", "createdAt": "2020-04-24T21:31:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDgyOTY0Mg=="}], "type": "inlineReview"}, {"oid": "1919caf7821d20e5be4f31110ebd5d59f35828ca", "url": "https://github.com/elastic/elasticsearch/commit/1919caf7821d20e5be4f31110ebd5d59f35828ca", "message": "[DOCS] Adds discrete attributes", "committedDate": "2020-04-24T20:25:28Z", "type": "commit"}, {"oid": "93dfb34304d723a4c9fa5a46c905a49cc2f23ca2", "url": "https://github.com/elastic/elasticsearch/commit/93dfb34304d723a4c9fa5a46c905a49cc2f23ca2", "message": "[DOCS] Augments UUID troubleshooting tips", "committedDate": "2020-05-07T23:10:31Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjM3OTMyMw==", "url": "https://github.com/elastic/elasticsearch/pull/55744#discussion_r422379323", "bodyText": "I think this applies to all 5 monitorable stack products today: Kibana, any of the Beats, Logstash, Elasticsearch, and APM server. When they are installed, their path.data directories should either be empty or non-existent; they should not be copied over from other installs.", "author": "ycombinator", "createdAt": "2020-05-08T21:16:29Z", "path": "docs/reference/monitoring/troubleshooting.asciidoc", "diffHunk": "@@ -27,3 +31,26 @@ monitoring data by using {metricbeat} the indices have `-mb` in their names. If\n the indices do not exist, review your configuration. For example, see\n <<monitoring-production>>.\n \n+[discrete]\n+[[monitoring-troubleshooting-uuid]]\n+=== Monitoring data for some {stack} nodes or instances is missing from {kib}\n+\n+*Symptoms*:\n+The *Stack Monitoring* page in {kib} does not show information for some nodes or \n+instances in your cluster.\n+\n+*Resolution*:\n+Verify that the missing items have unique UUIDs. Each {es} node, {ls} node,\n+{kib} instance, and Beat instance is considered unique based on its persistent \n+UUID, which is found in its `path.data` directory. Alternatively, you can find\n+the UUIDs in the product logs at startup.\n+\n+For {ls} nodes, you can also determine the UUID from the `id` property returned\n+by the {logstash-ref}/monitoring-logstash.html[monitoring APIs root resource].\n+\n+\n+TIP: When you install {kib} or Beat instances, do not copy existing content into", "originalCommit": "93dfb34304d723a4c9fa5a46c905a49cc2f23ca2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjM3OTY5OQ==", "url": "https://github.com/elastic/elasticsearch/pull/55744#discussion_r422379699", "bodyText": "Should we add APM server to this list?", "author": "ycombinator", "createdAt": "2020-05-08T21:17:27Z", "path": "docs/reference/monitoring/troubleshooting.asciidoc", "diffHunk": "@@ -27,3 +31,26 @@ monitoring data by using {metricbeat} the indices have `-mb` in their names. If\n the indices do not exist, review your configuration. For example, see\n <<monitoring-production>>.\n \n+[discrete]\n+[[monitoring-troubleshooting-uuid]]\n+=== Monitoring data for some {stack} nodes or instances is missing from {kib}\n+\n+*Symptoms*:\n+The *Stack Monitoring* page in {kib} does not show information for some nodes or \n+instances in your cluster.\n+\n+*Resolution*:\n+Verify that the missing items have unique UUIDs. Each {es} node, {ls} node,\n+{kib} instance, and Beat instance is considered unique based on its persistent ", "originalCommit": "93dfb34304d723a4c9fa5a46c905a49cc2f23ca2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjM4MDk0NQ==", "url": "https://github.com/elastic/elasticsearch/pull/55744#discussion_r422380945", "bodyText": "For Beats instances, you can also determine the UUID from the uuid property returned by the info API's root resource: https://www.elastic.co/guide/en/beats/filebeat/master/http-endpoint.html#_info. Note that, unlike Logstash, the Beat's HTTP server has to be enabled first via http.enabled: true.", "author": "ycombinator", "createdAt": "2020-05-08T21:20:15Z", "path": "docs/reference/monitoring/troubleshooting.asciidoc", "diffHunk": "@@ -27,3 +31,26 @@ monitoring data by using {metricbeat} the indices have `-mb` in their names. If\n the indices do not exist, review your configuration. For example, see\n <<monitoring-production>>.\n \n+[discrete]\n+[[monitoring-troubleshooting-uuid]]\n+=== Monitoring data for some {stack} nodes or instances is missing from {kib}\n+\n+*Symptoms*:\n+The *Stack Monitoring* page in {kib} does not show information for some nodes or \n+instances in your cluster.\n+\n+*Resolution*:\n+Verify that the missing items have unique UUIDs. Each {es} node, {ls} node,\n+{kib} instance, and Beat instance is considered unique based on its persistent \n+UUID, which is found in its `path.data` directory. Alternatively, you can find\n+the UUIDs in the product logs at startup.\n+\n+For {ls} nodes, you can also determine the UUID from the `id` property returned\n+by the {logstash-ref}/monitoring-logstash.html[monitoring APIs root resource].", "originalCommit": "93dfb34304d723a4c9fa5a46c905a49cc2f23ca2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjM4NzY3NQ==", "url": "https://github.com/elastic/elasticsearch/pull/55744#discussion_r422387675", "bodyText": "Thanks, I've added that info!", "author": "lcawl", "createdAt": "2020-05-08T21:37:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjM4MDk0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjM4OTIxNQ==", "url": "https://github.com/elastic/elasticsearch/pull/55744#discussion_r422389215", "bodyText": "Similarly for Kibana, one can call the Kibana Status API and look at the uuid property returned in the API's response. I couldn't find documentation specifically for the API but it's mentioned as a note over here: https://www.elastic.co/guide/en/kibana/current/access.html#status.", "author": "ycombinator", "createdAt": "2020-05-08T21:41:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjM4MDk0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjQyMDEwMg==", "url": "https://github.com/elastic/elasticsearch/pull/55744#discussion_r422420102", "bodyText": "Done, thanks!", "author": "lcawl", "createdAt": "2020-05-08T23:37:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjM4MDk0NQ=="}], "type": "inlineReview"}, {"oid": "a2e760ad5a311e266fe2faa625e38eb2e04f3c7d", "url": "https://github.com/elastic/elasticsearch/commit/a2e760ad5a311e266fe2faa625e38eb2e04f3c7d", "message": "[DOCS] Add APM to monitoring tip", "committedDate": "2020-05-08T21:26:15Z", "type": "commit"}, {"oid": "5f07dc48995ae9b1d5165c2fc6cbfe62dd1f5a75", "url": "https://github.com/elastic/elasticsearch/commit/5f07dc48995ae9b1d5165c2fc6cbfe62dd1f5a75", "message": "[DOCS] Adds HTTP endpoint tip", "committedDate": "2020-05-08T21:37:10Z", "type": "commit"}, {"oid": "f3065c21efdeda202f8edb07f7142c32793a0ad3", "url": "https://github.com/elastic/elasticsearch/commit/f3065c21efdeda202f8edb07f7142c32793a0ad3", "message": "[DOCS] Add Kibana API tip", "committedDate": "2020-05-08T23:36:32Z", "type": "commit"}]}