{"pr_number": 62193, "pr_title": "Add \"synthetics-*-*\" templates for synthetics fleet data", "pr_createdAt": "2020-09-09T21:14:31Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/62193", "timeline": [{"oid": "af938d856a9e8a5af76ef52dcabfca30b90e4b4f", "url": "https://github.com/elastic/elasticsearch/commit/af938d856a9e8a5af76ef52dcabfca30b90e4b4f", "message": "Add \"synthetics-*-*\" templates for synthetics fleet data\n\nFor the Elastic Agent we currently have `logs` and `metrics`, however, synthetic data doesn't belong\nwith those and thus we should have a place for it to live. This would be data reported from\nheartbeat and under the 'monitoring' category.\n\nThis commit adds a composable index template for `synthetics-*-*` indices similar to the work in\n #56709 and #57629.\n\nResolves #61665", "committedDate": "2020-09-09T21:07:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjE5MzA2OQ==", "url": "https://github.com/elastic/elasticsearch/pull/62193#discussion_r486193069", "bodyText": "@andrewvc I assume this also works for synthetics for now?", "author": "ruflin", "createdAt": "2020-09-10T09:21:47Z", "path": "x-pack/plugin/core/src/main/resources/synthetics-policy.json", "diffHunk": "@@ -0,0 +1,12 @@\n+{\n+  \"phases\": {\n+    \"hot\": {\n+      \"actions\": {\n+        \"rollover\": {\n+          \"max_size\": \"50gb\",", "originalCommit": "af938d856a9e8a5af76ef52dcabfca30b90e4b4f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODIxNzM0Mw==", "url": "https://github.com/elastic/elasticsearch/pull/62193#discussion_r488217343", "bodyText": "TBH we haven't done enough benchmarking to know, but it seems reasonable", "author": "andrewvc", "createdAt": "2020-09-14T21:01:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjE5MzA2OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjE5MzQ0Nw==", "url": "https://github.com/elastic/elasticsearch/pull/62193#discussion_r486193447", "bodyText": "@jpountz I remember you wanted to \"not\" use components here. Perhaps it is a good time to adjust?", "author": "ruflin", "createdAt": "2020-09-10T09:22:24Z", "path": "x-pack/plugin/core/src/main/resources/synthetics-template.json", "diffHunk": "@@ -0,0 +1,14 @@\n+{\n+  \"index_patterns\": [\"synthetics-*-*\"],\n+  \"priority\": 100,\n+  \"data_stream\": {},\n+  \"composed_of\": [\n+    \"synthetics-mappings\",", "originalCommit": "af938d856a9e8a5af76ef52dcabfca30b90e4b4f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "ba48b6787b5d19eed9a113dfaaa98948a0af3611", "url": "https://github.com/elastic/elasticsearch/commit/ba48b6787b5d19eed9a113dfaaa98948a0af3611", "message": "Include synthetics things in isXPackTemplate method", "committedDate": "2020-09-10T14:17:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzg0ODM1MQ==", "url": "https://github.com/elastic/elasticsearch/pull/62193#discussion_r487848351", "bodyText": "This one feels wrong since synthetics don't have a message?", "author": "jpountz", "createdAt": "2020-09-14T11:44:10Z", "path": "x-pack/plugin/core/src/main/resources/synthetics-settings.json", "diffHunk": "@@ -0,0 +1,20 @@\n+{\n+  \"template\": {\n+    \"settings\": {\n+      \"index\": {\n+        \"lifecycle\": {\n+          \"name\": \"synthetics\"\n+        },\n+        \"codec\": \"best_compression\",\n+        \"query\": {\n+          \"default_field\": [\"message\"]", "originalCommit": "ba48b6787b5d19eed9a113dfaaa98948a0af3611", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzk4MTkzMQ==", "url": "https://github.com/elastic/elasticsearch/pull/62193#discussion_r487981931", "bodyText": "Good call, I'll remove the default_field and stick with implicit \"all\" then, since it doesn't seem like there's a good alternative for this?", "author": "dakrone", "createdAt": "2020-09-14T14:35:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzg0ODM1MQ=="}], "type": "inlineReview"}, {"oid": "9fab29fb63c2ed9f01bd15c2176ee221898d5407", "url": "https://github.com/elastic/elasticsearch/commit/9fab29fb63c2ed9f01bd15c2176ee221898d5407", "message": "Merge remote-tracking branch 'origin/master' into add-synthetics-templates", "committedDate": "2020-09-14T16:29:43Z", "type": "commit"}, {"oid": "d21aaac24303b6b76dc25d3be21738a19b49bbac", "url": "https://github.com/elastic/elasticsearch/commit/d21aaac24303b6b76dc25d3be21738a19b49bbac", "message": "Unset index.query.default_field\n\nThere is no \"message\" field for this to be the default for", "committedDate": "2020-09-14T16:30:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODIxNzA4NA==", "url": "https://github.com/elastic/elasticsearch/pull/62193#discussion_r488217084", "bodyText": "I'm actually wondering if we can drop this field. We don't use host.* but rather observer.* in synthetics. It's not a big deal (we could just ignore it), but it isn't going to be used.", "author": "andrewvc", "createdAt": "2020-09-14T21:00:38Z", "path": "x-pack/plugin/core/src/main/resources/synthetics-mappings.json", "diffHunk": "@@ -0,0 +1,57 @@\n+{\n+  \"template\": {\n+    \"mappings\": {\n+      \"dynamic_templates\": [\n+        {\n+          \"strings_as_keyword\": {\n+            \"mapping\": {\n+              \"ignore_above\": 1024,\n+              \"type\": \"keyword\"\n+            },\n+            \"match_mapping_type\": \"string\"\n+          }\n+        }\n+      ],\n+      \"date_detection\": false,\n+      \"properties\": {\n+        \"@timestamp\": {\n+          \"type\": \"date\"\n+        },\n+        \"data_stream\": {\n+          \"properties\": {\n+            \"type\": {\n+              \"type\": \"constant_keyword\",\n+              \"value\": \"synthetics\"\n+            },\n+            \"dataset\": {\n+              \"type\": \"constant_keyword\"\n+            },\n+            \"namespace\": {\n+              \"type\": \"constant_keyword\"\n+            }\n+          }\n+        },\n+        \"ecs\": {\n+          \"properties\": {\n+            \"version\": {\n+              \"ignore_above\": 1024,\n+              \"type\": \"keyword\"\n+            }\n+          }\n+        },\n+        \"host\": {", "originalCommit": "d21aaac24303b6b76dc25d3be21738a19b49bbac", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODIxODA1OQ==", "url": "https://github.com/elastic/elasticsearch/pull/62193#discussion_r488218059", "bodyText": "It makes sense to drop it if we're not going to use it. I will remove it", "author": "dakrone", "createdAt": "2020-09-14T21:02:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODIxNzA4NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODQzNjU4Nw==", "url": "https://github.com/elastic/elasticsearch/pull/62193#discussion_r488436587", "bodyText": "@dakrone The host.ip is here for safety reason that nobody ships data with host as keyword, so I would rather keep it. And to be double save, in the synthetics case it probably makes sense then to add observer.ip.", "author": "ruflin", "createdAt": "2020-09-15T07:10:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODIxNzA4NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODc3ODY5OQ==", "url": "https://github.com/elastic/elasticsearch/pull/62193#discussion_r488778699", "bodyText": "Alright, since this was already merged I'll open a different PR to re-add both of these fields", "author": "dakrone", "createdAt": "2020-09-15T15:54:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODIxNzA4NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODkyODc2OA==", "url": "https://github.com/elastic/elasticsearch/pull/62193#discussion_r488928768", "bodyText": "Opened #62412 for this.", "author": "dakrone", "createdAt": "2020-09-15T19:42:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODIxNzA4NA=="}], "type": "inlineReview"}, {"oid": "c17267f666de1c0132629e77f3482d1eb9d7fba8", "url": "https://github.com/elastic/elasticsearch/commit/c17267f666de1c0132629e77f3482d1eb9d7fba8", "message": "Remove unneeded 'host' field", "committedDate": "2020-09-14T21:03:08Z", "type": "commit"}, {"oid": "5f9fb0f953a1a4a3ab6d0b55131b2260d405f534", "url": "https://github.com/elastic/elasticsearch/commit/5f9fb0f953a1a4a3ab6d0b55131b2260d405f534", "message": "Merge branch 'master' into add-synthetics-templates", "committedDate": "2020-09-14T21:21:06Z", "type": "commit"}]}