{"pr_number": 54617, "pr_title": "Add validation to the usage service", "pr_createdAt": "2020-04-01T22:21:15Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/54617", "timeline": [{"oid": "9d37470dec62c045df0272a7340eec970ce4809d", "url": "https://github.com/elastic/elasticsearch/commit/9d37470dec62c045df0272a7340eec970ce4809d", "message": "Add validation to the usage service\n\nToday the usage service can let in some issues, such as handlers that do\nnot have a name, where the errors do not manifest until later (calling\nthe usage API), or conflicting handlers with the same name. This commit\naddresses this by adding some validation to the usage service.", "committedDate": "2020-04-01T22:19:07Z", "type": "commit"}, {"oid": "0dca4551d47d416db5ed55025bc872500fd68346", "url": "https://github.com/elastic/elasticsearch/commit/0dca4551d47d416db5ed55025bc872500fd68346", "message": "Fix test", "committedDate": "2020-04-02T00:17:10Z", "type": "commit"}, {"oid": "62a0b79f7023c2ff900d190668146e2b83a72a96", "url": "https://github.com/elastic/elasticsearch/commit/62a0b79f7023c2ff900d190668146e2b83a72a96", "message": "Fix typo in comment", "committedDate": "2020-04-02T01:43:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjE0Mjg3Nw==", "url": "https://github.com/elastic/elasticsearch/pull/54617#discussion_r402142877", "bodyText": "How do you feel about adding JavaDoc for these new test cases? We added something to the contribution guidelines about this, and I personally find it enormously useful to check that the stated purpose of the test matches the implementation.", "author": "pugnascotia", "createdAt": "2020-04-02T08:35:43Z", "path": "server/src/test/java/org/elasticsearch/usage/UsageServiceTests.java", "diffHunk": "@@ -41,6 +42,45 @@\n \n public class UsageServiceTests extends ESTestCase {\n \n+    public void testNullHandler() {", "originalCommit": "62a0b79f7023c2ff900d190668146e2b83a72a96", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjE1MDU4Ng==", "url": "https://github.com/elastic/elasticsearch/pull/54617#discussion_r402150586", "bodyText": "Also, and maybe this is just a preference, but I like to name my tests so that they contain the expectation - so testHandlerCannotBeNull, or testHandlerMustHaveAName, etc. Otherwise the test name says what the test is doing, but not what the outcome should be. There's overlap with the JavaDoc, but it might be useful in e.g. the Gradle UI.", "author": "pugnascotia", "createdAt": "2020-04-02T08:47:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjE0Mjg3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjI2MjM0Mg==", "url": "https://github.com/elastic/elasticsearch/pull/54617#discussion_r402262342", "bodyText": "I added Javadocs, and I adjusted the name of testHandlerCannotBeNull, but testAHandlerWithNoName I'm keeping because it's a reference to a song, and it's fun.", "author": "jasontedor", "createdAt": "2020-04-02T12:08:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjE0Mjg3Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjE0MzI2Nw==", "url": "https://github.com/elastic/elasticsearch/pull/54617#discussion_r402143267", "bodyText": "Quality variable name! \ud83d\udc4d\ud83d\udc34", "author": "pugnascotia", "createdAt": "2020-04-02T08:36:22Z", "path": "server/src/test/java/org/elasticsearch/usage/UsageServiceTests.java", "diffHunk": "@@ -41,6 +42,45 @@\n \n public class UsageServiceTests extends ESTestCase {\n \n+    public void testNullHandler() {\n+        final UsageService service = new UsageService();\n+        expectThrows(NullPointerException.class, () -> service.addRestHandler(null));\n+    }\n+\n+    public void testAHandlerWithNoName() {\n+        final UsageService service = new UsageService();\n+        final BaseRestHandler horse = new MockRestHandler(null);", "originalCommit": "62a0b79f7023c2ff900d190668146e2b83a72a96", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjI2Mjg3Ng==", "url": "https://github.com/elastic/elasticsearch/pull/54617#discussion_r402262876", "bodyText": "Little slice of American pie right there. \ud83d\ude09", "author": "jasontedor", "createdAt": "2020-04-02T12:09:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjE0MzI2Nw=="}], "type": "inlineReview"}, {"oid": "bcbf0015482023731a8d0b53a9c48962432767f9", "url": "https://github.com/elastic/elasticsearch/commit/bcbf0015482023731a8d0b53a9c48962432767f9", "message": "Add Javadocs", "committedDate": "2020-04-02T12:07:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjI3NzQ3Nw==", "url": "https://github.com/elastic/elasticsearch/pull/54617#discussion_r402277477", "bodyText": "\ud83e\udd23", "author": "pugnascotia", "createdAt": "2020-04-02T12:34:16Z", "path": "server/src/test/java/org/elasticsearch/usage/UsageServiceTests.java", "diffHunk": "@@ -56,15 +62,22 @@ public void testAHandlerWithNoName() {\n             equalTo(\"handler of type [org.elasticsearch.usage.UsageServiceTests$MockRestHandler] does not have a name\"));\n     }\n \n+    /**\n+     * Test that we can add the same instance of a {@link org.elasticsearch.rest.RestHandler} to the {@link UsageService} multiple times.\n+     */\n     public void testHandlerWithConflictingNamesButSameInstance() {\n         final UsageService service = new UsageService();\n         final String name = randomAlphaOfLength(8);\n         final BaseRestHandler first = new MockRestHandler(name);\n         service.addRestHandler(first);\n-        // nothing bad should happen\n+        // nothing bad ever happens to me", "originalCommit": "bcbf0015482023731a8d0b53a9c48962432767f9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}