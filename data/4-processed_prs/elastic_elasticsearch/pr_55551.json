{"pr_number": 55551, "pr_title": "Update rollover index API docs for data streams", "pr_createdAt": "2020-04-21T18:20:57Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/55551", "timeline": [{"oid": "5307e2215f1bd141121def4de34a3f6b02b6e7b5", "url": "https://github.com/elastic/elasticsearch/commit/5307e2215f1bd141121def4de34a3f6b02b6e7b5", "message": "docs for rolling over data streams", "committedDate": "2020-04-21T18:16:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzA5NjY1OA==", "url": "https://github.com/elastic/elasticsearch/pull/55551#discussion_r413096658", "bodyText": "indices-datastreams isn't a valid anchor in the docs right now. This is causing the docs CI to fail.\n\nor a <<indices-datastreams, data stream>>. When targeting an alias, the alias is updated to\n\nIt looks like we don't have data stream docs at all atm. It might be good to add those before merging this.", "author": "jrodewig", "createdAt": "2020-04-22T15:44:18Z", "path": "docs/reference/indices/rollover-index.asciidoc", "diffHunk": "@@ -4,8 +4,11 @@\n <titleabbrev>Rollover index</titleabbrev>\n ++++\n \n-Assigns an <<indices-aliases, index alias>> to a new index\n-when the alias's existing index meets a condition you provide.\n+Creates a new index for a rollover target when the target's existing index meets a\n+condition you provide. A rollover target can be either an <<indices-aliases, index alias>>\n+or a <<indices-datastreams, data stream>>. When targeting an alias, the alias is updated to", "originalCommit": "5307e2215f1bd141121def4de34a3f6b02b6e7b5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDUxOTg2OQ==", "url": "https://github.com/elastic/elasticsearch/pull/55551#discussion_r414519869", "bodyText": "@jrodewig, I've added those in #55557 if you would like to see them. I presume they will need to be merged first to create the appropriate data streams anchors.", "author": "danhermann", "createdAt": "2020-04-24T11:58:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzA5NjY1OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDUzODc4Nw==", "url": "https://github.com/elastic/elasticsearch/pull/55551#discussion_r414538787", "bodyText": "\ud83d\udc4d Awesome. And yes--- they'll need to be merged in before you can reference the anchor here. You may have to update this branch after #55557 merges to get the docs CI to pass.", "author": "jrodewig", "createdAt": "2020-04-24T12:30:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzA5NjY1OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzA5NzE2MQ==", "url": "https://github.com/elastic/elasticsearch/pull/55551#discussion_r413097161", "bodyText": "\ud83d\udc4d  I feel like 'rollover target' is a good term for this, and it's concisely explained here.", "author": "jrodewig", "createdAt": "2020-04-22T15:44:55Z", "path": "docs/reference/indices/rollover-index.asciidoc", "diffHunk": "@@ -4,8 +4,11 @@\n <titleabbrev>Rollover index</titleabbrev>\n ++++\n \n-Assigns an <<indices-aliases, index alias>> to a new index\n-when the alias's existing index meets a condition you provide.\n+Creates a new index for a rollover target when the target's existing index meets a", "originalCommit": "5307e2215f1bd141121def4de34a3f6b02b6e7b5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzA5ODU2Mw==", "url": "https://github.com/elastic/elasticsearch/pull/55551#discussion_r413098563", "bodyText": "nit: I think \"point\" is a bit more clear here.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            reference the new index. When targeting a data stream, the new index becomes the data stream's\n          \n          \n            \n            point to the new index. When targeting a data stream, the new index becomes the data stream's", "author": "jrodewig", "createdAt": "2020-04-22T15:46:35Z", "path": "docs/reference/indices/rollover-index.asciidoc", "diffHunk": "@@ -4,8 +4,11 @@\n <titleabbrev>Rollover index</titleabbrev>\n ++++\n \n-Assigns an <<indices-aliases, index alias>> to a new index\n-when the alias's existing index meets a condition you provide.\n+Creates a new index for a rollover target when the target's existing index meets a\n+condition you provide. A rollover target can be either an <<indices-aliases, index alias>>\n+or a <<indices-datastreams, data stream>>. When targeting an alias, the alias is updated to\n+reference the new index. When targeting a data stream, the new index becomes the data stream's", "originalCommit": "5307e2215f1bd141121def4de34a3f6b02b6e7b5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzA5OTgxOQ==", "url": "https://github.com/elastic/elasticsearch/pull/55551#discussion_r413099819", "bodyText": "nit: I don't think \"existing index\" is needed here. Also fixes the line wrapping.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            The rollover index API rolls an existing index for a rollover target to a new index when\n          \n          \n            \n            the existing index meets a condition you provide. You can use this API to retire\n          \n          \n            \n            an index that becomes too large or too old.\n          \n          \n            \n            The rollover index API rolls a rollover target to a new index when the existing\n          \n          \n            \n            index meets a condition you provide. You can use this API to retire an index\n          \n          \n            \n            that becomes too large or too old.", "author": "jrodewig", "createdAt": "2020-04-22T15:48:09Z", "path": "docs/reference/indices/rollover-index.asciidoc", "diffHunk": "@@ -25,15 +28,15 @@ POST /alias1/_rollover/twitter\n ==== {api-request-title}\n \n \n-`POST /<alias>/_rollover/<target-index>`\n+`POST /<rollover-target>/_rollover/<target-index>`\n \n-`POST /<alias>/_rollover/`\n+`POST /<rollover-target>/_rollover/`\n \n \n [[rollover-index-api-desc]]\n ==== {api-description-title}\n \n-The rollover index API rolls an <<indices-aliases, alias>> to a new index when\n+The rollover index API rolls an existing index for a rollover target to a new index when\n the existing index meets a condition you provide. You can use this API to retire\n an index that becomes too large or too old.", "originalCommit": "5307e2215f1bd141121def4de34a3f6b02b6e7b5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzEwMTkzNA==", "url": "https://github.com/elastic/elasticsearch/pull/55551#discussion_r413101934", "bodyText": "For parameters that are required in some situations, we typically add an asterisk.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            (Required, string)\n          \n          \n            \n            (Required*, string)", "author": "jrodewig", "createdAt": "2020-04-22T15:50:56Z", "path": "docs/reference/indices/rollover-index.asciidoc", "diffHunk": "@@ -73,10 +81,10 @@ index creation applies to the rollover action.\n [[rollover-index-api-path-params]]\n ==== {api-path-parms-title}\n \n-`<alias>`::\n+`<rollover-target>`::\n (Required, string)", "originalCommit": "5307e2215f1bd141121def4de34a3f6b02b6e7b5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzEwMjg4NQ==", "url": "https://github.com/elastic/elasticsearch/pull/55551#discussion_r413102885", "bodyText": "Good catch!", "author": "jrodewig", "createdAt": "2020-04-22T15:51:58Z", "path": "docs/reference/indices/rollover-index.asciidoc", "diffHunk": "@@ -127,7 +132,7 @@ include::{docdir}/rest-api/common-parms.asciidoc[tag=aliases]\n +\n --\n (Required, object)\n-Set of conditions the index alias's existing index must met to roll over.\n+Set of conditions the rollover target's existing index must meet to roll over.", "originalCommit": "5307e2215f1bd141121def4de34a3f6b02b6e7b5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzEwMzc5MA==", "url": "https://github.com/elastic/elasticsearch/pull/55551#discussion_r413103790", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            PUT _data_stream/my-data-stream <1>\n          \n          \n            \n            PUT /_data_stream/my-data-stream <1>", "author": "jrodewig", "createdAt": "2020-04-22T15:53:10Z", "path": "docs/reference/indices/rollover-index.asciidoc", "diffHunk": "@@ -206,13 +211,69 @@ The API returns the following response:\n <2> Whether the rollover was dry run.\n <3> The result of each condition.\n \n+\n+[[rollover-data-stream-ex]]\n+===== Roll over a data stream\n+\n+[source,console]\n+--------------------------------------------------\n+PUT _data_stream/my-data-stream <1>", "originalCommit": "5307e2215f1bd141121def4de34a3f6b02b6e7b5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzExMDU1OQ==", "url": "https://github.com/elastic/elasticsearch/pull/55551#discussion_r413110559", "bodyText": "Should we mention that it's also the write index?", "author": "jrodewig", "createdAt": "2020-04-22T16:01:40Z", "path": "docs/reference/indices/rollover-index.asciidoc", "diffHunk": "@@ -42,25 +45,30 @@ NOTE: To roll over an index, a condition must be met *when you call the API*.\n automatically roll over indices when a condition is met, you can use {es}'s\n <<index-lifecycle-management, index lifecycle management (ILM) policies>>.\n \n-The rollover index API accepts a single alias name\n+The rollover index API accepts a rollover target name\n and a list of `conditions`.\n \n-If the specified alias points to a single index,\n+If the specified rollover target is an alias pointing to a single index,\n the rollover request:\n \n . Creates a new index\n . Adds the alias to the new index\n . Removes the alias from the original index\n \n-If the specified alias points to multiple indices,\n+If the specified rollover target is an alias pointing to multiple indices,\n one of these indices must have `is_write_index` set to `true`.\n-In this case,\n-the rollover request:\n+In this case, the rollover request:\n \n . Creates a new index\n . Sets `is_write_index` to `true` for the new index\n . Sets `is_write_index` to `false` for the original index\n \n+If the specified rollover target is a data stream, the rollover request:\n+\n+. Creates a new index\n+. Adds the new index as a backing index on the data stream", "originalCommit": "5307e2215f1bd141121def4de34a3f6b02b6e7b5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzExMTU5Mw==", "url": "https://github.com/elastic/elasticsearch/pull/55551#discussion_r413111593", "bodyText": "The conditions become a bit hard to parse in a callout. I think breaking them out into a bulleted list might help>\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            <2> If the current index of `my-data-stream` was created 7 or more days ago, or\n          \n          \n            \n            contains 1,000 or more documents, or has an index size at least around 5GB, then\n          \n          \n            \n            a new backing index `my-data-stream-000002` index is created and added to the\n          \n          \n            \n            `my-data-stream` data stream.\n          \n          \n            \n            <2> This request creates a new backing index, `my-data-stream-000002`, and adds\n          \n          \n            \n            it as the write index for the `my-data-stream` data stream if the current\n          \n          \n            \n            write index meets at least one of the following conditions:\n          \n          \n            \n            +\n          \n          \n            \n            --\n          \n          \n            \n            * The index was created 7 or more days ago.\n          \n          \n            \n            * The index has an index size of 5GB or greater.\n          \n          \n            \n            * The index contains 1,000 or more documents.\n          \n          \n            \n            --", "author": "jrodewig", "createdAt": "2020-04-22T16:03:04Z", "path": "docs/reference/indices/rollover-index.asciidoc", "diffHunk": "@@ -206,13 +211,69 @@ The API returns the following response:\n <2> Whether the rollover was dry run.\n <3> The result of each condition.\n \n+\n+[[rollover-data-stream-ex]]\n+===== Roll over a data stream\n+\n+[source,console]\n+--------------------------------------------------\n+PUT _data_stream/my-data-stream <1>\n+{\n+  \"timestamp_field\": \"@timestamp\"\n+}\n+\n+# Add > 1000 documents to my-data-stream\n+\n+POST /my-data-stream/_rollover <2>\n+{\n+  \"conditions\" : {\n+  \"max_age\": \"7d\",\n+  \"max_docs\": 1000,\n+  \"max_size\": \"5gb\"\n+  }\n+}\n+--------------------------------------------------\n+<1> Creates a data stream called `my-data-stream` with one initial backing index\n+named `my-data-stream-000001`.\n+<2> If the current index of `my-data-stream` was created 7 or more days ago, or\n+contains 1,000 or more documents, or has an index size at least around 5GB, then\n+a new backing index `my-data-stream-000002` index is created and added to the\n+`my-data-stream` data stream.", "originalCommit": "5307e2215f1bd141121def4de34a3f6b02b6e7b5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzExMjIxMg==", "url": "https://github.com/elastic/elasticsearch/pull/55551#discussion_r413112212", "bodyText": "nit\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            If the rollover target is a data stream, you may not specify a target index\n          \n          \n            \n            If the rollover target is a data stream, you cannot specify a target index", "author": "jrodewig", "createdAt": "2020-04-22T16:03:56Z", "path": "docs/reference/indices/rollover-index.asciidoc", "diffHunk": "@@ -241,11 +302,14 @@ POST /logs_write/_rollover\n \n [[rollover-index-specify-index-ex]]\n ===== Specify a target index name\n+If the rollover target is a data stream, you may not specify a target index", "originalCommit": "5307e2215f1bd141121def4de34a3f6b02b6e7b5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "d02d3ec9a44f1fa1eaf7bb4c54ebbc625464c141", "url": "https://github.com/elastic/elasticsearch/commit/d02d3ec9a44f1fa1eaf7bb4c54ebbc625464c141", "message": "Update docs/reference/indices/rollover-index.asciidoc\n\nCo-Authored-By: James Rodewig <james.rodewig@elastic.co>", "committedDate": "2020-04-24T11:59:28Z", "type": "commit"}, {"oid": "0740fb9266ddd408b8411f5164d26e6f82b259fa", "url": "https://github.com/elastic/elasticsearch/commit/0740fb9266ddd408b8411f5164d26e6f82b259fa", "message": "Update docs/reference/indices/rollover-index.asciidoc\n\nCo-Authored-By: James Rodewig <james.rodewig@elastic.co>", "committedDate": "2020-04-24T12:00:04Z", "type": "commit"}, {"oid": "f31824583062b7714cec258f7b5706f5522c3221", "url": "https://github.com/elastic/elasticsearch/commit/f31824583062b7714cec258f7b5706f5522c3221", "message": "Update docs/reference/indices/rollover-index.asciidoc\n\nCo-Authored-By: James Rodewig <james.rodewig@elastic.co>", "committedDate": "2020-04-24T12:00:42Z", "type": "commit"}, {"oid": "963ab954bc2e3059e3a1b9153e51fbe5fa00a8da", "url": "https://github.com/elastic/elasticsearch/commit/963ab954bc2e3059e3a1b9153e51fbe5fa00a8da", "message": "Update docs/reference/indices/rollover-index.asciidoc\n\nCo-Authored-By: James Rodewig <james.rodewig@elastic.co>", "committedDate": "2020-04-24T12:00:58Z", "type": "commit"}, {"oid": "8009c92d746ef3b5149b14bd2e8dde666faf5f92", "url": "https://github.com/elastic/elasticsearch/commit/8009c92d746ef3b5149b14bd2e8dde666faf5f92", "message": "Update docs/reference/indices/rollover-index.asciidoc\n\nCo-Authored-By: James Rodewig <james.rodewig@elastic.co>", "committedDate": "2020-04-24T12:01:49Z", "type": "commit"}, {"oid": "3c598cb48f9c3c6c7011efcfae1107cce98c3d5a", "url": "https://github.com/elastic/elasticsearch/commit/3c598cb48f9c3c6c7011efcfae1107cce98c3d5a", "message": "review comments", "committedDate": "2020-04-24T12:29:01Z", "type": "commit"}, {"oid": "aee787ce70a3fd745850b722da97e5a8c07769cd", "url": "https://github.com/elastic/elasticsearch/commit/aee787ce70a3fd745850b722da97e5a8c07769cd", "message": "Merge branch 'master' into docs_rollover_data_streams", "committedDate": "2020-05-13T12:52:31Z", "type": "commit"}, {"oid": "04ce0034ef609e2c0946388d0d01a5d7b817b275", "url": "https://github.com/elastic/elasticsearch/commit/04ce0034ef609e2c0946388d0d01a5d7b817b275", "message": "fix anchors, review comments", "committedDate": "2020-05-13T13:12:51Z", "type": "commit"}, {"oid": "eee841c3413b04dbaaccd53ce32eefdd27efc04d", "url": "https://github.com/elastic/elasticsearch/commit/eee841c3413b04dbaaccd53ce32eefdd27efc04d", "message": "Merge remote-tracking branch 'es/master' into docs_rollover_data_streams", "committedDate": "2020-05-14T09:07:13Z", "type": "commit"}, {"oid": "940ed27721d731c0b0d2c3fb74e98e97c8afdd2f", "url": "https://github.com/elastic/elasticsearch/commit/940ed27721d731c0b0d2c3fb74e98e97c8afdd2f", "message": "fixed doc snippets", "committedDate": "2020-05-14T11:48:43Z", "type": "commit"}]}