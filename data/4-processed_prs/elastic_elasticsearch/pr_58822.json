{"pr_number": 58822, "pr_title": "Add `zero_terms_query` support to `match_phrase_prefix`", "pr_createdAt": "2020-07-01T10:35:35Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/58822", "timeline": [{"oid": "ad296855e9bff28883cc0014dce6d6cdef2915a5", "url": "https://github.com/elastic/elasticsearch/commit/ad296855e9bff28883cc0014dce6d6cdef2915a5", "message": "Add `zero_terms_query` support to `match_phrase_prefix`\n\nCurrently `match_phrase_prefix` doesn't support `zero_terms_query` like the\nother match-type queries. This change adds this support.\n\nCloses #58468", "committedDate": "2020-07-01T11:18:45Z", "type": "commit"}, {"oid": "ad296855e9bff28883cc0014dce6d6cdef2915a5", "url": "https://github.com/elastic/elasticsearch/commit/ad296855e9bff28883cc0014dce6d6cdef2915a5", "message": "Add `zero_terms_query` support to `match_phrase_prefix`\n\nCurrently `match_phrase_prefix` doesn't support `zero_terms_query` like the\nother match-type queries. This change adds this support.\n\nCloses #58468", "committedDate": "2020-07-01T11:18:45Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTMxNDE1Mw==", "url": "https://github.com/elastic/elasticsearch/pull/58822#discussion_r455314153", "bodyText": "As we are asserting Lucene queries there, I would make this test in reverse:\nif (queryBuilder.zeroTermsQuery().equals(ZeroTermsQuery.ALL)) {\n    assert that query instanceof MatchAllDocsQuery;\n}", "author": "mayya-sharipova", "createdAt": "2020-07-15T20:13:09Z", "path": "server/src/test/java/org/elasticsearch/index/query/MatchPhrasePrefixQueryBuilderTests.java", "diffHunk": "@@ -85,6 +91,12 @@ protected MatchPhrasePrefixQueryBuilder doCreateTestQueryBuilder() {\n     protected void doAssertLuceneQuery(MatchPhrasePrefixQueryBuilder queryBuilder, Query query, QueryShardContext context)\n             throws IOException {\n         assertThat(query, notNullValue());\n+\n+        if (query instanceof MatchAllDocsQuery) {", "originalCommit": "ad296855e9bff28883cc0014dce6d6cdef2915a5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTY2NTg5MA==", "url": "https://github.com/elastic/elasticsearch/pull/58822#discussion_r455665890", "bodyText": "I can understand the ask, but unfortunately there are several other conditions the random queryBuilder needs to fullfil to actually produce a MatchAllDocsQuery. Its quite difficult to get them all right, wheras the test the other way round is straight forward. Would you object to leaving it as is?", "author": "cbuescher", "createdAt": "2020-07-16T09:51:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTMxNDE1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTY2OTQxNw==", "url": "https://github.com/elastic/elasticsearch/pull/58822#discussion_r455669417", "bodyText": "An alternative would be not to test this here at all since we have another dedicated test for the zeroTermsQuery behaviour. In that case I'd just add MatchAllDocsQuery to the set of allowed and expected queries here.", "author": "cbuescher", "createdAt": "2020-07-16T09:57:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTMxNDE1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQ1ODQ4Mw==", "url": "https://github.com/elastic/elasticsearch/pull/58822#discussion_r456458483", "bodyText": "@cbuescher Thanks for the explanation, I am ok to leave it as is.", "author": "mayya-sharipova", "createdAt": "2020-07-17T13:56:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTMxNDE1Mw=="}], "type": "inlineReview"}]}