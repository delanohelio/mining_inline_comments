{"pr_number": 65510, "pr_title": "Add 6.8 branch to packer cache script", "pr_createdAt": "2020-11-25T18:11:09Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/65510", "timeline": [{"oid": "ec0fd02434e0f4e1f4d779d5726515e10e26e874", "url": "https://github.com/elastic/elasticsearch/commit/ec0fd02434e0f4e1f4d779d5726515e10e26e874", "message": "Add 6.8 branch to packer cache script", "committedDate": "2020-11-25T18:10:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDYzNzczMw==", "url": "https://github.com/elastic/elasticsearch/pull/65510#discussion_r530637733", "bodyText": "Maybe use git clone --reference ${SCRIPT}/../.git https://github.com/elastic/elasticsearch.git --branch 6.8 --single-branch checkout/6.8 to speed up the clone a bit?", "author": "nik9000", "createdAt": "2020-11-25T20:54:31Z", "path": ".ci/packer_cache.sh", "diffHunk": "@@ -16,12 +16,21 @@ while [ -h \"$SCRIPT\" ] ; do\n done\n \n source $(dirname \"${SCRIPT}\")/java-versions.properties\n-export JAVA_HOME=\"${HOME}\"/.java/${ES_BUILD_JAVA}\n-# We are caching BWC versions too, need these so we can build those\n+## We are caching BWC versions too, need these so we can build those\n export JAVA8_HOME=\"${HOME}\"/.java/java8\n export JAVA11_HOME=\"${HOME}\"/.java/java11\n export JAVA12_HOME=\"${HOME}\"/.java/openjdk12\n export JAVA13_HOME=\"${HOME}\"/.java/openjdk13\n export JAVA14_HOME=\"${HOME}\"/.java/openjdk14\n-./gradlew --parallel clean -s resolveAllDependencies\n \n+## 6.8 branch is not referenced from any bwc project in master so we need to\n+## resolve its dependencies explicitly\n+rm -rf checkout/6.8\n+git clone https://github.com/elastic/elasticsearch.git --branch 6.8 --single-branch checkout/6.8", "originalCommit": "ec0fd02434e0f4e1f4d779d5726515e10e26e874", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDkxNTY0Mw==", "url": "https://github.com/elastic/elasticsearch/pull/65510#discussion_r530915643", "bodyText": "Nice. didn't know about that one.", "author": "breskeby", "createdAt": "2020-11-26T10:10:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDYzNzczMw=="}], "type": "inlineReview"}, {"oid": "31a826c5b1e50a0ee5fb8f5aa108a53b7e159c41", "url": "https://github.com/elastic/elasticsearch/commit/31a826c5b1e50a0ee5fb8f5aa108a53b7e159c41", "message": "Apply review feedback\n\n- use --reference on cloning 6.8 brach to speed cloning up a bit", "committedDate": "2020-11-30T09:45:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjg1MjQzMQ==", "url": "https://github.com/elastic/elasticsearch/pull/65510#discussion_r532852431", "bodyText": "Maybe rm -rf checkout/6.8 just to keep the build image a little smaller.", "author": "nik9000", "createdAt": "2020-11-30T19:40:59Z", "path": ".ci/packer_cache.sh", "diffHunk": "@@ -16,12 +16,21 @@ while [ -h \"$SCRIPT\" ] ; do\n done\n \n source $(dirname \"${SCRIPT}\")/java-versions.properties\n-export JAVA_HOME=\"${HOME}\"/.java/${ES_BUILD_JAVA}\n-# We are caching BWC versions too, need these so we can build those\n+## We are caching BWC versions too, need these so we can build those\n export JAVA8_HOME=\"${HOME}\"/.java/java8\n export JAVA11_HOME=\"${HOME}\"/.java/java11\n export JAVA12_HOME=\"${HOME}\"/.java/openjdk12\n export JAVA13_HOME=\"${HOME}\"/.java/openjdk13\n export JAVA14_HOME=\"${HOME}\"/.java/openjdk14\n-./gradlew --parallel clean -s resolveAllDependencies\n \n+## 6.8 branch is not referenced from any bwc project in master so we need to\n+## resolve its dependencies explicitly\n+rm -rf checkout/6.8\n+git clone --reference $(dirname \"${SCRIPT}\")/../.git https://github.com/elastic/elasticsearch.git --branch 6.8 --single-branch checkout/6.8\n+export JAVA_HOME=\"${JAVA11_HOME}\"\n+./checkout/6.8/gradlew --project-dir ./checkout/6.8 --parallel clean --scan -Porg.elasticsearch.acceptScanTOS=true --stacktrace resolveAllDependencies\n+", "originalCommit": "31a826c5b1e50a0ee5fb8f5aa108a53b7e159c41", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzU0NDc2NA==", "url": "https://github.com/elastic/elasticsearch/pull/65510#discussion_r533544764", "bodyText": "added this", "author": "breskeby", "createdAt": "2020-12-01T16:22:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjg1MjQzMQ=="}], "type": "inlineReview"}, {"oid": "2d052c582f666ce6538646bfe98309b59a32d77b", "url": "https://github.com/elastic/elasticsearch/commit/2d052c582f666ce6538646bfe98309b59a32d77b", "message": "Remove 6.8 branch checkout after resolving deps to keep image small", "committedDate": "2020-11-30T20:46:37Z", "type": "commit"}]}