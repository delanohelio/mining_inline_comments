{"pr_number": 52879, "pr_title": "Document how to change GC logging behaviour", "pr_createdAt": "2020-02-27T10:39:19Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/52879", "timeline": [{"oid": "b05b25add4ef1dc17b5f8adb4e90ff2da159b8dd", "url": "https://github.com/elastic/elasticsearch/commit/b05b25add4ef1dc17b5f8adb4e90ff2da159b8dd", "message": "Document how to change GC logs in Docker\n\nCloses #43990.", "committedDate": "2020-02-27T10:36:44Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTYxNDg1Mw==", "url": "https://github.com/elastic/elasticsearch/pull/52879#discussion_r385614853", "bodyText": "This sounds a bit redundant:\n\ndefault to the same default location\n\nMaybe:\n\noutput to the same default location", "author": "jrodewig", "createdAt": "2020-02-28T10:20:21Z", "path": "docs/reference/setup/important-settings/gc-logging.asciidoc", "diffHunk": "@@ -1,7 +1,25 @@\n [[gc-logging]]\n === GC logging\n \n-By default, Elasticsearch enables GC logs. These are configured in\n-<<jvm-options,`jvm.options`>> and default to the same default location as the\n-Elasticsearch logs. The default configuration rotates the logs every 64 MB and\n-can consume up to 2 GB of disk space.\n+By default, {es} enables GC logs. These are configured in\n+<<jvm-options,`jvm.options`>> and default to the same default location as", "originalCommit": "b05b25add4ef1dc17b5f8adb4e90ff2da159b8dd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTYxNTA3OA==", "url": "https://github.com/elastic/elasticsearch/pull/52879#discussion_r385615078", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            the Elasticsearch logs. The default configuration rotates the logs every 64\n          \n          \n            \n            the {es} logs. The default configuration rotates the logs every 64", "author": "jrodewig", "createdAt": "2020-02-28T10:20:52Z", "path": "docs/reference/setup/important-settings/gc-logging.asciidoc", "diffHunk": "@@ -1,7 +1,25 @@\n [[gc-logging]]\n === GC logging\n \n-By default, Elasticsearch enables GC logs. These are configured in\n-<<jvm-options,`jvm.options`>> and default to the same default location as the\n-Elasticsearch logs. The default configuration rotates the logs every 64 MB and\n-can consume up to 2 GB of disk space.\n+By default, {es} enables GC logs. These are configured in\n+<<jvm-options,`jvm.options`>> and default to the same default location as\n+the Elasticsearch logs. The default configuration rotates the logs every 64", "originalCommit": "b05b25add4ef1dc17b5f8adb4e90ff2da159b8dd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTYxODM2NQ==", "url": "https://github.com/elastic/elasticsearch/pull/52879#discussion_r385618365", "bodyText": "I think a slight reorder and formatting would help here:\nWe do not recommend editing the default `jvm.options` file to change the GC\nlogging configuration. Instead, we recommend you:\n\n. Configure the JVM to disable GC logging using the default configuration.\n. Reconfigure JVM logging as described in\n  https://openjdk.java.net/jeps/158[JEP 158: Unified JVM Logging].\n. Re-enable GC logging.\n\nIt may also be helpful to briefly mention or link to:\n\nWhy we discourage editing the jvm.options file.\nHow to disable and re-enable GC logging.", "author": "jrodewig", "createdAt": "2020-02-28T10:28:04Z", "path": "docs/reference/setup/important-settings/gc-logging.asciidoc", "diffHunk": "@@ -1,7 +1,25 @@\n [[gc-logging]]\n === GC logging\n \n-By default, Elasticsearch enables GC logs. These are configured in\n-<<jvm-options,`jvm.options`>> and default to the same default location as the\n-Elasticsearch logs. The default configuration rotates the logs every 64 MB and\n-can consume up to 2 GB of disk space.\n+By default, {es} enables GC logs. These are configured in\n+<<jvm-options,`jvm.options`>> and default to the same default location as\n+the Elasticsearch logs. The default configuration rotates the logs every 64\n+MB and can consume up to 2 GB of disk space.\n+\n+You can change the default GC logging configuration. Since the preferred\n+method of <<jvm-options,configuring JVM options>> is not to edit the\n+default `jvm.options` file, you will need to configure the JVM first to\n+disable GC logging, in order to cancel out the default {es} configuration,\n+and then to re-enable logging as you require. See\n+https://openjdk.java.net/jeps/158[JEP 158: Unified JVM Logging] for details\n+of how to configure logging.", "originalCommit": "b05b25add4ef1dc17b5f8adb4e90ff2da159b8dd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTYyMDAyNw==", "url": "https://github.com/elastic/elasticsearch/pull/52879#discussion_r385620027", "bodyText": "Is there a reason why this is an example vs. regular guidance?\nIf it could just be regular guidance, I would change as follows:\nIf you use <<docker,Docker>> to run {es}, you can send GC logs to standard error\n(`stderr`) and let your container orchestrator handle the output. If using the\n`ES_JAVA_OPTS` environment variable, specify:\n\n...", "author": "jrodewig", "createdAt": "2020-02-28T10:31:17Z", "path": "docs/reference/setup/important-settings/gc-logging.asciidoc", "diffHunk": "@@ -1,7 +1,25 @@\n [[gc-logging]]\n === GC logging\n \n-By default, Elasticsearch enables GC logs. These are configured in\n-<<jvm-options,`jvm.options`>> and default to the same default location as the\n-Elasticsearch logs. The default configuration rotates the logs every 64 MB and\n-can consume up to 2 GB of disk space.\n+By default, {es} enables GC logs. These are configured in\n+<<jvm-options,`jvm.options`>> and default to the same default location as\n+the Elasticsearch logs. The default configuration rotates the logs every 64\n+MB and can consume up to 2 GB of disk space.\n+\n+You can change the default GC logging configuration. Since the preferred\n+method of <<jvm-options,configuring JVM options>> is not to edit the\n+default `jvm.options` file, you will need to configure the JVM first to\n+disable GC logging, in order to cancel out the default {es} configuration,\n+and then to re-enable logging as you require. See\n+https://openjdk.java.net/jeps/158[JEP 158: Unified JVM Logging] for details\n+of how to configure logging.\n+\n+For example, if you are running {es} using <<docker,Docker>>, you can\n+choose to send GC logs to standard error (`stderr`) and let your container\n+orchestrator handle the output. If you were using the `ES_JAVA_OPTS`\n+environment variable, you would specify:\n+\n+[source,sh]\n+--------------------------------------------\n+docker run -e ES_JAVA_OPTS=\"-Xlog:disable -Xlog:gc=debug:stderr\" # etc\n+--------------------------------------------", "originalCommit": "b05b25add4ef1dc17b5f8adb4e90ff2da159b8dd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "a6d4b7613ab72b1b00e67d2a45a1a641918eeed2", "url": "https://github.com/elastic/elasticsearch/commit/a6d4b7613ab72b1b00e67d2a45a1a641918eeed2", "message": "Rework to add file example and include default config\n\nThe previous docs didn't take care to insert the default logging\nconfiguration after disabling everything. Also, there was no example for\nusing a file in `jvm.options.d/`.", "committedDate": "2020-02-28T13:46:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTcxNjkzOQ==", "url": "https://github.com/elastic/elasticsearch/pull/52879#discussion_r385716939", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            change the default `jvm.options` file directly, you may find that the {es}\n          \n          \n            \n            default configuration is applied in addition to your own settings. In this\n          \n          \n            \n            case, you must first disable logging by supplying the `-Xlog:disable`\n          \n          \n            \n            change the default `jvm.options` file directly, the {es} default configuration\n          \n          \n            \n            is applied in addition to your own settings. To disable the default\n          \n          \n            \n            configuration, first disable logging by supplying the `-Xlog:disable`", "author": "jrodewig", "createdAt": "2020-02-28T14:14:10Z", "path": "docs/reference/setup/important-settings/gc-logging.asciidoc", "diffHunk": "@@ -1,7 +1,50 @@\n [[gc-logging]]\n === GC logging\n \n-By default, Elasticsearch enables GC logs. These are configured in\n-<<jvm-options,`jvm.options`>> and default to the same default location as the\n-Elasticsearch logs. The default configuration rotates the logs every 64 MB and\n+By default, {es} enables GC logs. These are configured in\n+<<jvm-options,`jvm.options`>> and output to the same default location as\n+the {es} logs. The default configuration rotates the logs every 64 MB and\n can consume up to 2 GB of disk space.\n+\n+You can reconfigure JVM logging using the command line options described in\n+https://openjdk.java.net/jeps/158[JEP 158: Unified JVM Logging]. Unless you\n+change the default `jvm.options` file directly, you may find that the {es}\n+default configuration is applied in addition to your own settings. In this\n+case, you must first disable logging by supplying the `-Xlog:disable`", "originalCommit": "a6d4b7613ab72b1b00e67d2a45a1a641918eeed2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTcxNzIyOA==", "url": "https://github.com/elastic/elasticsearch/pull/52879#discussion_r385717228", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            option, then supply your own command line options. Note that this disables\n          \n          \n            \n            option, then supply your own command line options. This disables", "author": "jrodewig", "createdAt": "2020-02-28T14:14:39Z", "path": "docs/reference/setup/important-settings/gc-logging.asciidoc", "diffHunk": "@@ -1,7 +1,50 @@\n [[gc-logging]]\n === GC logging\n \n-By default, Elasticsearch enables GC logs. These are configured in\n-<<jvm-options,`jvm.options`>> and default to the same default location as the\n-Elasticsearch logs. The default configuration rotates the logs every 64 MB and\n+By default, {es} enables GC logs. These are configured in\n+<<jvm-options,`jvm.options`>> and output to the same default location as\n+the {es} logs. The default configuration rotates the logs every 64 MB and\n can consume up to 2 GB of disk space.\n+\n+You can reconfigure JVM logging using the command line options described in\n+https://openjdk.java.net/jeps/158[JEP 158: Unified JVM Logging]. Unless you\n+change the default `jvm.options` file directly, you may find that the {es}\n+default configuration is applied in addition to your own settings. In this\n+case, you must first disable logging by supplying the `-Xlog:disable`\n+option, then supply your own command line options. Note that this disables", "originalCommit": "a6d4b7613ab72b1b00e67d2a45a1a641918eeed2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTcxNzQ0Mg==", "url": "https://github.com/elastic/elasticsearch/pull/52879#discussion_r385717442", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            See also\n          \n          \n            \n            See", "author": "jrodewig", "createdAt": "2020-02-28T14:15:04Z", "path": "docs/reference/setup/important-settings/gc-logging.asciidoc", "diffHunk": "@@ -1,7 +1,50 @@\n [[gc-logging]]\n === GC logging\n \n-By default, Elasticsearch enables GC logs. These are configured in\n-<<jvm-options,`jvm.options`>> and default to the same default location as the\n-Elasticsearch logs. The default configuration rotates the logs every 64 MB and\n+By default, {es} enables GC logs. These are configured in\n+<<jvm-options,`jvm.options`>> and output to the same default location as\n+the {es} logs. The default configuration rotates the logs every 64 MB and\n can consume up to 2 GB of disk space.\n+\n+You can reconfigure JVM logging using the command line options described in\n+https://openjdk.java.net/jeps/158[JEP 158: Unified JVM Logging]. Unless you\n+change the default `jvm.options` file directly, you may find that the {es}\n+default configuration is applied in addition to your own settings. In this\n+case, you must first disable logging by supplying the `-Xlog:disable`\n+option, then supply your own command line options. Note that this disables\n+__all__ JVM logging, so be sure to review the available options and enable\n+everything that you require.\n+\n+See also", "originalCommit": "a6d4b7613ab72b1b00e67d2a45a1a641918eeed2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTcxNzk3Ng==", "url": "https://github.com/elastic/elasticsearch/pull/52879#discussion_r385717976", "bodyText": ", which includes more options not contained in the original JEP.\n\nI'd inverse the order here:\n\nTo see more options not contained in the original JEP, see ...", "author": "jrodewig", "createdAt": "2020-02-28T14:16:05Z", "path": "docs/reference/setup/important-settings/gc-logging.asciidoc", "diffHunk": "@@ -1,7 +1,50 @@\n [[gc-logging]]\n === GC logging\n \n-By default, Elasticsearch enables GC logs. These are configured in\n-<<jvm-options,`jvm.options`>> and default to the same default location as the\n-Elasticsearch logs. The default configuration rotates the logs every 64 MB and\n+By default, {es} enables GC logs. These are configured in\n+<<jvm-options,`jvm.options`>> and output to the same default location as\n+the {es} logs. The default configuration rotates the logs every 64 MB and\n can consume up to 2 GB of disk space.\n+\n+You can reconfigure JVM logging using the command line options described in\n+https://openjdk.java.net/jeps/158[JEP 158: Unified JVM Logging]. Unless you\n+change the default `jvm.options` file directly, you may find that the {es}\n+default configuration is applied in addition to your own settings. In this\n+case, you must first disable logging by supplying the `-Xlog:disable`\n+option, then supply your own command line options. Note that this disables\n+__all__ JVM logging, so be sure to review the available options and enable\n+everything that you require.\n+\n+See also\n+https://docs.oracle.com/en/java/javase/13/docs/specs/man/java.html#enable-logging-with-the-jvm-unified-logging-framework[Enable\n+Logging with the JVM Unified Logging Framework], which includes more\n+options not contained in the original JEP.", "originalCommit": "a6d4b7613ab72b1b00e67d2a45a1a641918eeed2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTcxODQ3Mg==", "url": "https://github.com/elastic/elasticsearch/pull/52879#discussion_r385718472", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              standard error (`stderr`), in order to let the container orchestrator\n          \n          \n            \n              standard error (`stderr`). This lets the container orchestrator", "author": "jrodewig", "createdAt": "2020-02-28T14:17:02Z", "path": "docs/reference/setup/important-settings/gc-logging.asciidoc", "diffHunk": "@@ -1,7 +1,50 @@\n [[gc-logging]]\n === GC logging\n \n-By default, Elasticsearch enables GC logs. These are configured in\n-<<jvm-options,`jvm.options`>> and default to the same default location as the\n-Elasticsearch logs. The default configuration rotates the logs every 64 MB and\n+By default, {es} enables GC logs. These are configured in\n+<<jvm-options,`jvm.options`>> and output to the same default location as\n+the {es} logs. The default configuration rotates the logs every 64 MB and\n can consume up to 2 GB of disk space.\n+\n+You can reconfigure JVM logging using the command line options described in\n+https://openjdk.java.net/jeps/158[JEP 158: Unified JVM Logging]. Unless you\n+change the default `jvm.options` file directly, you may find that the {es}\n+default configuration is applied in addition to your own settings. In this\n+case, you must first disable logging by supplying the `-Xlog:disable`\n+option, then supply your own command line options. Note that this disables\n+__all__ JVM logging, so be sure to review the available options and enable\n+everything that you require.\n+\n+See also\n+https://docs.oracle.com/en/java/javase/13/docs/specs/man/java.html#enable-logging-with-the-jvm-unified-logging-framework[Enable\n+Logging with the JVM Unified Logging Framework], which includes more\n+options not contained in the original JEP.\n+\n+==== Examples\n+\n+* Change the default GC log output location to `/opt/my-app/gc.log` by\n+  creating `$ES_HOME/config/jvm.options.d/gc.options` with some sample\n+  options:\n++\n+[source,shell]\n+--------------------------------------------\n+# Turn off all previous logging configuratons\n+-Xlog:disable\n+\n+# Default settings from JEP 158, but with `utctime` instead of `uptime` to match the next line\n+-Xlog:all=warning:stderr:utctime,level,tags\n+\n+# Enable GC logging to a custom location with a variety of options\n+-Xlog:gc*,gc+age=trace,safepoint:file=/opt/my-app/gc.log:utctime,pid,tags:filecount=32,filesize=64m\n+--------------------------------------------\n+\n+* Configure an {es} <<docker,Docker container>> to send GC debug logs to\n+  standard error (`stderr`), in order to let the container orchestrator", "originalCommit": "a6d4b7613ab72b1b00e67d2a45a1a641918eeed2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "565c89c61ecf80c06b6fffd8338573b3a730a1b3", "url": "https://github.com/elastic/elasticsearch/commit/565c89c61ecf80c06b6fffd8338573b3a730a1b3", "message": "Address review feedback", "committedDate": "2020-02-28T21:09:39Z", "type": "commit"}, {"oid": "aa60d96f766a8ba5e639eef930589ebf90e8909a", "url": "https://github.com/elastic/elasticsearch/commit/aa60d96f766a8ba5e639eef930589ebf90e8909a", "message": "One last tweak", "committedDate": "2020-02-28T21:11:47Z", "type": "commit"}]}