{"pr_number": 62259, "pr_title": "Support the 'fields' option in inner_hits and top_hits.", "pr_createdAt": "2020-09-10T22:01:29Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/62259", "timeline": [{"oid": "3e49a00536950e94bde001999b9452d3f3576bf3", "url": "https://github.com/elastic/elasticsearch/commit/3e49a00536950e94bde001999b9452d3f3576bf3", "message": "Support the 'fields' option in top_hits.", "committedDate": "2020-09-10T22:32:39Z", "type": "forcePushed"}, {"oid": "ce161fb9cf7bf55bfba23955a4bea702e9d18089", "url": "https://github.com/elastic/elasticsearch/commit/ce161fb9cf7bf55bfba23955a4bea702e9d18089", "message": "Support the 'fields' option in top_hits.", "committedDate": "2020-09-10T22:42:31Z", "type": "forcePushed"}, {"oid": "1b9db99212747f75355b44ee216b8c541069af26", "url": "https://github.com/elastic/elasticsearch/commit/1b9db99212747f75355b44ee216b8c541069af26", "message": "Support the 'fields' option in top_hits.", "committedDate": "2020-09-11T00:15:13Z", "type": "forcePushed"}, {"oid": "391f7f9337d57bb819e5772fdc4f9ab79eb017a6", "url": "https://github.com/elastic/elasticsearch/commit/391f7f9337d57bb819e5772fdc4f9ab79eb017a6", "message": "Support the 'fields' option in inner_hits.", "committedDate": "2020-09-11T01:08:50Z", "type": "commit"}, {"oid": "53d6c58b52e439dcd017da61f9e15ba3bf734061", "url": "https://github.com/elastic/elasticsearch/commit/53d6c58b52e439dcd017da61f9e15ba3bf734061", "message": "Support the 'fields' option in top_hits.", "committedDate": "2020-09-11T01:08:52Z", "type": "commit"}, {"oid": "53d6c58b52e439dcd017da61f9e15ba3bf734061", "url": "https://github.com/elastic/elasticsearch/commit/53d6c58b52e439dcd017da61f9e15ba3bf734061", "message": "Support the 'fields' option in top_hits.", "committedDate": "2020-09-11T01:08:52Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzczMTg1MA==", "url": "https://github.com/elastic/elasticsearch/pull/62259#discussion_r487731850", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * Sets the stored fields to load from the docvalue and return.\n          \n          \n            \n                 * Sets the stored fields to load and return as part of the search request.", "author": "jimczi", "createdAt": "2020-09-14T08:16:56Z", "path": "server/src/main/java/org/elasticsearch/index/query/InnerHitBuilder.java", "diffHunk": "@@ -349,6 +367,41 @@ public InnerHitBuilder addDocValueField(String field) {\n         return addDocValueField(field, null);\n     }\n \n+    /**\n+     * Gets the fields to load and return as part of the search request.\n+     */\n+    public List<FieldAndFormat> getFetchFields() {\n+        return fetchFields;\n+    }\n+\n+    /**\n+     * Sets the stored fields to load from the docvalue and return.", "originalCommit": "53d6c58b52e439dcd017da61f9e15ba3bf734061", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzczMzg2MQ==", "url": "https://github.com/elastic/elasticsearch/pull/62259#discussion_r487733861", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        throw new IllegalArgumentException(\"[docValueField] must not be null: [\" + name + \"]\");\n          \n          \n            \n                        throw new IllegalArgumentException(\"[fetch_field] must not be null: [\" + name + \"]\");", "author": "jimczi", "createdAt": "2020-09-14T08:20:29Z", "path": "server/src/main/java/org/elasticsearch/search/aggregations/metrics/TopHitsAggregationBuilder.java", "diffHunk": "@@ -425,10 +439,38 @@ public TopHitsAggregationBuilder docValueField(String docValueField) {\n     /**\n      * Gets the field-data fields.\n      */\n-    public List<FieldAndFormat> fieldDataFields() {\n+    public List<FieldAndFormat> docValueFields() {\n         return docValueFields;\n     }\n \n+    /**\n+     * Adds a field to load and return as part of the search request.\n+     */\n+    public TopHitsAggregationBuilder fetchField(String field, String format) {\n+        if (field == null) {\n+            throw new IllegalArgumentException(\"[docValueField] must not be null: [\" + name + \"]\");", "originalCommit": "53d6c58b52e439dcd017da61f9e15ba3bf734061", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e0e266a3311e4eb2d7cd0171dd03bc273b6009dc", "url": "https://github.com/elastic/elasticsearch/commit/e0e266a3311e4eb2d7cd0171dd03bc273b6009dc", "message": "Fix some references to 'fields' in comments + messages.", "committedDate": "2020-09-14T16:19:45Z", "type": "commit"}]}