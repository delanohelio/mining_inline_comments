{"pr_number": 63878, "pr_title": "Convert parent-join mappers to parametrized form", "pr_createdAt": "2020-10-19T12:39:50Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/63878", "timeline": [{"oid": "5e8d9a2b1436d88e483960cea4da16af43dddd6f", "url": "https://github.com/elastic/elasticsearch/commit/5e8d9a2b1436d88e483960cea4da16af43dddd6f", "message": "WIP", "committedDate": "2020-10-12T17:26:43Z", "type": "commit"}, {"oid": "94677abf81f56bff6958fead064325eaf709c161", "url": "https://github.com/elastic/elasticsearch/commit/94677abf81f56bff6958fead064325eaf709c161", "message": "Merge remote-tracking branch 'origin/master' into mapper/join", "committedDate": "2020-10-15T07:47:27Z", "type": "commit"}, {"oid": "69e26177a1336738501ab3e711328136ca53f0e4", "url": "https://github.com/elastic/elasticsearch/commit/69e26177a1336738501ab3e711328136ca53f0e4", "message": "compiles", "committedDate": "2020-10-15T09:19:24Z", "type": "commit"}, {"oid": "d63079df3e8a3db09fa84dfb2fa8207750b303cd", "url": "https://github.com/elastic/elasticsearch/commit/d63079df3e8a3db09fa84dfb2fa8207750b303cd", "message": "Merge remote-tracking branch 'origin/master' into mapper/join", "committedDate": "2020-10-15T09:19:27Z", "type": "commit"}, {"oid": "4c6dc26dc8b1d091511e6640d2140a7b3e2d85a4", "url": "https://github.com/elastic/elasticsearch/commit/4c6dc26dc8b1d091511e6640d2140a7b3e2d85a4", "message": "Convert all to parametrized mappers; data shared via Joiner object on metadata field", "committedDate": "2020-10-15T10:47:44Z", "type": "commit"}, {"oid": "2bff02ef95c26b1c26d7bf8046903fc4939a2fce", "url": "https://github.com/elastic/elasticsearch/commit/2bff02ef95c26b1c26d7bf8046903fc4939a2fce", "message": "inner hits tests", "committedDate": "2020-10-15T12:39:37Z", "type": "commit"}, {"oid": "60fe6984334c75e3fd537c9444a8b5397d18a938", "url": "https://github.com/elastic/elasticsearch/commit/60fe6984334c75e3fd537c9444a8b5397d18a938", "message": "Merge remote-tracking branch 'origin/master' into mapper/join", "committedDate": "2020-10-15T13:23:40Z", "type": "commit"}, {"oid": "94881383264490f3fba12b851218a15b6d525e64", "url": "https://github.com/elastic/elasticsearch/commit/94881383264490f3fba12b851218a15b6d525e64", "message": "Undo parametrization; move LateParsingQuery back into HasChildQueryBuilder", "committedDate": "2020-10-15T14:54:39Z", "type": "commit"}, {"oid": "dc374f4c4dec20dd81059ccbe20806e432ee1741", "url": "https://github.com/elastic/elasticsearch/commit/dc374f4c4dec20dd81059ccbe20806e432ee1741", "message": "unwind a couple more changes", "committedDate": "2020-10-15T14:59:32Z", "type": "commit"}, {"oid": "a36a52c616904daa39f307afd42f4bea7329af82", "url": "https://github.com/elastic/elasticsearch/commit/a36a52c616904daa39f307afd42f4bea7329af82", "message": "Merge remote-tracking branch 'origin/master' into mapper/join", "committedDate": "2020-10-15T15:01:49Z", "type": "commit"}, {"oid": "ba97d3518d4f09bc8145a7cc6e0754eb6c6e90c5", "url": "https://github.com/elastic/elasticsearch/commit/ba97d3518d4f09bc8145a7cc6e0754eb6c6e90c5", "message": "imports", "committedDate": "2020-10-15T15:20:03Z", "type": "commit"}, {"oid": "c593a31662f7ce8e22e8a0cdb0ccf321a7e352ca", "url": "https://github.com/elastic/elasticsearch/commit/c593a31662f7ce8e22e8a0cdb0ccf321a7e352ca", "message": "javadocs", "committedDate": "2020-10-15T15:26:49Z", "type": "commit"}, {"oid": "3d9afe0c36a6fc0bf925be3ad2dbc5b765c4f1d1", "url": "https://github.com/elastic/elasticsearch/commit/3d9afe0c36a6fc0bf925be3ad2dbc5b765c4f1d1", "message": "Merge remote-tracking branch 'origin/master' into mapper/join", "committedDate": "2020-10-16T13:38:05Z", "type": "commit"}, {"oid": "9febddd2353ab3a6a7b4d47be30d99fea72b19e6", "url": "https://github.com/elastic/elasticsearch/commit/9febddd2353ab3a6a7b4d47be30d99fea72b19e6", "message": "deef", "committedDate": "2020-10-16T13:52:22Z", "type": "commit"}, {"oid": "cc2bbc2f08403a3e6e74f20be21ac28c02dcb09f", "url": "https://github.com/elastic/elasticsearch/commit/cc2bbc2f08403a3e6e74f20be21ac28c02dcb09f", "message": "Merge remote-tracking branch 'origin/master' into mapper/join", "committedDate": "2020-10-19T11:38:37Z", "type": "commit"}, {"oid": "5a9367c31f018b9397f698e6057c924e667ed6ef", "url": "https://github.com/elastic/elasticsearch/commit/5a9367c31f018b9397f698e6057c924e667ed6ef", "message": "Revert \"unwind a couple more changes\"\n\nThis reverts commit dc374f4c4dec20dd81059ccbe20806e432ee1741.", "committedDate": "2020-10-19T11:54:08Z", "type": "commit"}, {"oid": "27d5ee135f2bd06591b926f194c6fd90f5c6826f", "url": "https://github.com/elastic/elasticsearch/commit/27d5ee135f2bd06591b926f194c6fd90f5c6826f", "message": "Convert parent-join mappers to parametrized form", "committedDate": "2020-10-19T12:00:49Z", "type": "commit"}, {"oid": "1e9e6787b567c0abdf328ce25d0e9e97e04aa2a2", "url": "https://github.com/elastic/elasticsearch/commit/1e9e6787b567c0abdf328ce25d0e9e97e04aa2a2", "message": "derp", "committedDate": "2020-10-19T12:38:39Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzcyNjgyNQ==", "url": "https://github.com/elastic/elasticsearch/pull/63878#discussion_r507726825", "bodyText": "can you remind me why this goes away?", "author": "javanna", "createdAt": "2020-10-19T13:01:34Z", "path": "modules/parent-join/src/main/java/org/elasticsearch/join/mapper/ParentJoinFieldMapper.java", "diffHunk": "@@ -189,7 +160,6 @@ public String typeName() {\n \n         @Override\n         public IndexFieldData.Builder fielddataBuilder(String fullyQualifiedIndexName, Supplier<SearchLookup> searchLookup) {\n-            failIfNoDocValues();", "originalCommit": "1e9e6787b567c0abdf328ce25d0e9e97e04aa2a2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzczMDQ2Nw==", "url": "https://github.com/elastic/elasticsearch/pull/63878#discussion_r507730467", "bodyText": "you can't disable docvalues on the field mapper, so this never fails", "author": "romseygeek", "createdAt": "2020-10-19T13:07:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzcyNjgyNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzcyNzUzMw==", "url": "https://github.com/elastic/elasticsearch/pull/63878#discussion_r507727533", "bodyText": "does this need to be public?", "author": "javanna", "createdAt": "2020-10-19T13:02:47Z", "path": "modules/parent-join/src/main/java/org/elasticsearch/join/mapper/Relations.java", "diffHunk": "@@ -53,4 +61,20 @@ public int hashCode() {\n     public String toString() {\n         return parent + \"->\" + children;\n     }\n+\n+    public static List<Relations> parse(Object fieldNode) {", "originalCommit": "1e9e6787b567c0abdf328ce25d0e9e97e04aa2a2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzczMTE3NQ==", "url": "https://github.com/elastic/elasticsearch/pull/63878#discussion_r507731175", "bodyText": "It does not, I'll make it package-private.", "author": "romseygeek", "createdAt": "2020-10-19T13:08:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzcyNzUzMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzcyODQ1Mg==", "url": "https://github.com/elastic/elasticsearch/pull/63878#discussion_r507728452", "bodyText": "I am missing why this needs to change", "author": "javanna", "createdAt": "2020-10-19T13:04:15Z", "path": "modules/parent-join/src/main/java/org/elasticsearch/join/mapper/MetaJoinFieldMapper.java", "diffHunk": "@@ -92,22 +62,17 @@ public String typeName() {\n \n         @Override\n         public IndexFieldData.Builder fielddataBuilder(String fullyQualifiedIndexName, Supplier<SearchLookup> searchLookup) {\n-            failIfNoDocValues();\n-            return new SortedSetOrdinalsIndexFieldData.Builder(name(), CoreValuesSourceType.BYTES);\n+            throw new UnsupportedOperationException(\"Cannot load field data for metadata field [\" + NAME + \"]\");\n         }\n \n         @Override\n         public ValueFetcher valueFetcher(MapperService mapperService, SearchLookup searchLookup, String format) {\n-            throw new UnsupportedOperationException(\"Cannot fetch values for metadata field [\" + typeName() + \"].\");\n+            throw new UnsupportedOperationException(\"Cannot fetch values for metadata field [\" + NAME + \"].\");\n         }\n \n         @Override\n         public Object valueForDisplay(Object value) {\n-            if (value == null) {\n-                return null;\n-            }\n-            BytesRef binaryValue = (BytesRef) value;\n-            return binaryValue.utf8ToString();\n+            throw new UnsupportedOperationException();", "originalCommit": "1e9e6787b567c0abdf328ce25d0e9e97e04aa2a2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzczMTAzNw==", "url": "https://github.com/elastic/elasticsearch/pull/63878#discussion_r507731037", "bodyText": "It should never be called, as the mapper is just a placeholder for holding the Joiner.", "author": "romseygeek", "createdAt": "2020-10-19T13:08:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzcyODQ1Mg=="}], "type": "inlineReview"}, {"oid": "09deac04f982b2f20e485375a0bd051b64f8bad4", "url": "https://github.com/elastic/elasticsearch/commit/09deac04f982b2f20e485375a0bd051b64f8bad4", "message": "deef", "committedDate": "2020-10-19T13:10:00Z", "type": "commit"}]}