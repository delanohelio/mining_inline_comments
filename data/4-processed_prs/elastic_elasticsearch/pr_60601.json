{"pr_number": 60601, "pr_title": "Deprecate allow_no_jobs and allow_no_datafeeds in favor of allow_no_match", "pr_createdAt": "2020-08-03T13:52:50Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/60601", "timeline": [{"oid": "37983fa5e23aba3216e777f70c6d203ce5a7c52d", "url": "https://github.com/elastic/elasticsearch/commit/37983fa5e23aba3216e777f70c6d203ce5a7c52d", "message": "Deprecate allow_no_jobs and allow_no_datafeeds in favor of allow_no_match", "committedDate": "2020-08-04T09:28:36Z", "type": "forcePushed"}, {"oid": "c3bd05bb631164fe6c48bb5baa6971567731e102", "url": "https://github.com/elastic/elasticsearch/commit/c3bd05bb631164fe6c48bb5baa6971567731e102", "message": "Deprecate allow_no_jobs and allow_no_datafeeds in favor of allow_no_match", "committedDate": "2020-08-04T09:59:41Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDk5MjgwNA==", "url": "https://github.com/elastic/elasticsearch/pull/60601#discussion_r464992804", "bodyText": "Is there a \"deprecation\" field or something for these parameters? Clients generate their code from these specs and we probably don't want them generating with this parameter as an option.", "author": "benwtrent", "createdAt": "2020-08-04T11:50:05Z", "path": "x-pack/plugin/src/test/resources/rest-api-spec/api/ml.stop_datafeed.json", "diffHunk": "@@ -22,6 +22,11 @@\n       ]\n     },\n     \"params\":{\n+      \"allow_no_match\":{\n+        \"type\":\"boolean\",\n+        \"required\":false,\n+        \"description\":\"Whether to ignore if a wildcard expression matches no datafeeds. (This includes `_all` string or when no datafeeds have been specified)\"\n+      },\n       \"allow_no_datafeeds\":{", "originalCommit": "c3bd05bb631164fe6c48bb5baa6971567731e102", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDk5Mjk4NQ==", "url": "https://github.com/elastic/elasticsearch/pull/60601#discussion_r464992985", "bodyText": "This comment goes for ALL the changed rest specs", "author": "benwtrent", "createdAt": "2020-08-04T11:50:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDk5MjgwNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTAwNzY0Mg==", "url": "https://github.com/elastic/elasticsearch/pull/60601#discussion_r465007642", "bodyText": "If we don't want the clients to include this option we should just remove it from these specs.", "author": "droberts195", "createdAt": "2020-08-04T12:18:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDk5MjgwNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTAwOTc5Mg==", "url": "https://github.com/elastic/elasticsearch/pull/60601#discussion_r465009792", "bodyText": "Since most (if not all) clients are not BWC, it should probably be removed.", "author": "benwtrent", "createdAt": "2020-08-04T12:22:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDk5MjgwNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTAxNTk1Mg==", "url": "https://github.com/elastic/elasticsearch/pull/60601#discussion_r465015952", "bodyText": "Done.", "author": "przemekwitek", "createdAt": "2020-08-04T12:33:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDk5MjgwNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTU4NDY1OQ==", "url": "https://github.com/elastic/elasticsearch/pull/60601#discussion_r465584659", "bodyText": "I decided to keep those deprecated params as without them yml tests do not work and I do see a value in keeping the yml tests for those params.\nAdded deprecated flag so that those params stand out.", "author": "przemekwitek", "createdAt": "2020-08-05T09:09:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDk5MjgwNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDk5NTY3OA==", "url": "https://github.com/elastic/elasticsearch/pull/60601#discussion_r464995678", "bodyText": "it seems to me that the default way to use these parameters via an API is through the request parameter (not in the body).\nDoes this add a deprecation warning if the user provides allow_no_jobs as a URL param?", "author": "benwtrent", "createdAt": "2020-08-04T11:55:00Z", "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/rest/results/RestGetOverallBucketsAction.java", "diffHunk": "@@ -59,7 +59,10 @@ protected RestChannelConsumer prepareRequest(RestRequest restRequest, NodeClient\n             if (restRequest.hasParam(Request.END.getPreferredName())) {\n                 request.setEnd(restRequest.param(Request.END.getPreferredName()));\n             }\n-            request.setAllowNoJobs(restRequest.paramAsBoolean(Request.ALLOW_NO_JOBS.getPreferredName(), request.allowNoJobs()));\n+            request.setAllowNoMatch(\n+                restRequest.paramAsBoolean(\n+                    Request.ALLOW_NO_MATCH.getPreferredName(),\n+                    restRequest.paramAsBoolean(Request.ALLOW_NO_JOBS, request.allowNoMatch())));", "originalCommit": "c3bd05bb631164fe6c48bb5baa6971567731e102", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTAyMTMyNw==", "url": "https://github.com/elastic/elasticsearch/pull/60601#discussion_r465021327", "bodyText": "it seems to me that the default way to use these parameters via an API is through the request parameter (not in the body).\n\nThat's correct. Some of the API methods do not even support body.\n\nDoes this add a deprecation warning if the user provides allow_no_jobs as a URL param?\n\nIt did not add the warning. Now it does. Done.", "author": "przemekwitek", "createdAt": "2020-08-04T12:43:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDk5NTY3OA=="}], "type": "inlineReview"}, {"oid": "e0c7c5e096d56f172472ed982d826a5267b10ee6", "url": "https://github.com/elastic/elasticsearch/commit/e0c7c5e096d56f172472ed982d826a5267b10ee6", "message": "Deprecate allow_no_jobs and allow_no_datafeeds in favor of allow_no_match", "committedDate": "2020-08-05T09:42:23Z", "type": "commit"}, {"oid": "53dee5d2809227af4b8312eff234edcef8125b26", "url": "https://github.com/elastic/elasticsearch/commit/53dee5d2809227af4b8312eff234edcef8125b26", "message": "Apply review comment: remove deprecated parameters from json specs", "committedDate": "2020-08-05T09:42:23Z", "type": "commit"}, {"oid": "7b18fd61dd805edadc8450dcf7da7d2af7f5fc42", "url": "https://github.com/elastic/elasticsearch/commit/7b18fd61dd805edadc8450dcf7da7d2af7f5fc42", "message": "Apply review comment: Emit deprecation warnings for request params", "committedDate": "2020-08-05T09:42:23Z", "type": "commit"}, {"oid": "08aea5a28b684aa30f17f8ee736e84c421f2cb27", "url": "https://github.com/elastic/elasticsearch/commit/08aea5a28b684aa30f17f8ee736e84c421f2cb27", "message": "Restore deprecated params in .json files. Expect warnings in yml tests.", "committedDate": "2020-08-05T09:42:23Z", "type": "commit"}, {"oid": "08aea5a28b684aa30f17f8ee736e84c421f2cb27", "url": "https://github.com/elastic/elasticsearch/commit/08aea5a28b684aa30f17f8ee736e84c421f2cb27", "message": "Restore deprecated params in .json files. Expect warnings in yml tests.", "committedDate": "2020-08-05T09:42:23Z", "type": "forcePushed"}]}