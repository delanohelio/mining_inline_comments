{"pr_number": 55034, "pr_title": "Use task avoidance with forbidden apis", "pr_createdAt": "2020-04-09T22:21:12Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/55034", "timeline": [{"oid": "2e8d322c0f2f252090eb379118808836467e4a26", "url": "https://github.com/elastic/elasticsearch/commit/2e8d322c0f2f252090eb379118808836467e4a26", "message": "Use task avoidance with forbidden apis\n\nCurrently forbidden apis accounts for 800+ tasks in the build. These\ntasks are aggressively created by the plugin. In forbidden apis 3.0, we\nwill get task avoidance\n(https://github.com/policeman-tools/forbidden-apis/pull/162), but we\nneed to ourselves use the same task avoidance mechanisms to not trigger\nthese task creations. This commit does that for our foribdden apis\nusages, in preparation for upgrading to 3.0 when it is released.", "committedDate": "2020-04-09T22:18:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjUxMDM4Ng==", "url": "https://github.com/elastic/elasticsearch/pull/55034#discussion_r406510386", "bodyText": "Why the intermediary variable here? This can be simplified to ext.disableTasks = { String... taskNames ->...", "author": "mark-vieira", "createdAt": "2020-04-09T22:23:26Z", "path": "build.gradle", "diffHunk": "@@ -518,3 +518,12 @@ subprojects {\n     }\n   }\n }\n+\n+subprojects {\n+  Closure disableMethod = { String... tasknames ->\n+    for (String taskname : tasknames) {\n+      project.tasks.named(taskname).configure { onlyIf { false } }\n+    }\n+  }\n+  project.ext.disableTasks = disableMethod", "originalCommit": "2e8d322c0f2f252090eb379118808836467e4a26", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjUxMTA4Mg==", "url": "https://github.com/elastic/elasticsearch/pull/55034#discussion_r406511082", "bodyText": "Do we need to keep this?", "author": "mark-vieira", "createdAt": "2020-04-09T22:25:20Z", "path": "test/logger-usage/build.gradle", "diffHunk": "@@ -27,8 +27,7 @@ dependencies {\n \n loggerUsageCheck.enabled = false\n \n-forbiddenApisMain.enabled = true // disabled by parent project", "originalCommit": "2e8d322c0f2f252090eb379118808836467e4a26", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzY4ODU5NQ==", "url": "https://github.com/elastic/elasticsearch/pull/55034#discussion_r407688595", "bodyText": "No, I looked at the parent but did not see it being disabled there. Also, using onlyIf now, there would be no way to disable (using onlyIf) in the parent but then re-enable in the child project.", "author": "rjernst", "createdAt": "2020-04-13T20:04:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjUxMTA4Mg=="}], "type": "inlineReview"}, {"oid": "efeffaf24fde4f73990c16f3ea5ccc4ce04066f1", "url": "https://github.com/elastic/elasticsearch/commit/efeffaf24fde4f73990c16f3ea5ccc4ce04066f1", "message": "feedback", "committedDate": "2020-04-13T20:04:24Z", "type": "commit"}, {"oid": "4af78c18fca21f423d5dc17fa7e66d565434e778", "url": "https://github.com/elastic/elasticsearch/commit/4af78c18fca21f423d5dc17fa7e66d565434e778", "message": "fix bad testkit conversion", "committedDate": "2020-04-13T20:07:03Z", "type": "commit"}, {"oid": "6762e13edb86244d7a8ef6763f76030419c9c3a4", "url": "https://github.com/elastic/elasticsearch/commit/6762e13edb86244d7a8ef6763f76030419c9c3a4", "message": "Merge branch 'master' into taskavoidance1", "committedDate": "2020-04-15T19:21:33Z", "type": "commit"}]}