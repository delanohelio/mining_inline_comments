{"pr_number": 53979, "pr_title": "Add Accept & Content-Type headers to rest api spec", "pr_createdAt": "2020-03-23T13:53:02Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/53979", "timeline": [{"oid": "c6258c165e82f39c8642ebc9a58e31f3dd832d7b", "url": "https://github.com/elastic/elasticsearch/commit/c6258c165e82f39c8642ebc9a58e31f3dd832d7b", "message": "Rename response_accepts => response_types", "committedDate": "2020-03-25T16:00:55Z", "type": "forcePushed"}, {"oid": "9673665e576d724f3007f4ff9c50c1ef30f1296f", "url": "https://github.com/elastic/elasticsearch/commit/9673665e576d724f3007f4ff9c50c1ef30f1296f", "message": "Rename response_accepts => response_types", "committedDate": "2020-03-25T17:20:29Z", "type": "forcePushed"}, {"oid": "951846097b5ba62d002d63a33eda7ca683f512d7", "url": "https://github.com/elastic/elasticsearch/commit/951846097b5ba62d002d63a33eda7ca683f512d7", "message": "update schema.json", "committedDate": "2020-04-10T12:29:46Z", "type": "forcePushed"}, {"oid": "0debdcd9742d2af1e46100ea83f3bfc6747a2064", "url": "https://github.com/elastic/elasticsearch/commit/0debdcd9742d2af1e46100ea83f3bfc6747a2064", "message": "Add Accept & Content-Type headers to rest api spec\n\nThis documents the preferred Accept and Content Type headers to be\nsent with API calls.\n\nIn some cases the API returns two formats e.g cat API's in which case\nthe `headers.accept` documents both in order of preference.\n\nElasticsearch supports more content types e.g CBOR and smile but none of\nour REST clients actively support these so we don't make an active\neffort documenting these.", "committedDate": "2020-04-10T13:18:36Z", "type": "forcePushed"}, {"oid": "6525bfdd18a02f1f57a95c1d913d637379a0f20d", "url": "https://github.com/elastic/elasticsearch/commit/6525bfdd18a02f1f57a95c1d913d637379a0f20d", "message": "update unit tests", "committedDate": "2020-04-10T14:04:35Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTg5NjIwMQ==", "url": "https://github.com/elastic/elasticsearch/pull/53979#discussion_r409896201", "bodyText": "Since this technically supports sending application/json too, should we add it after the preferred application/x-ndjson? I can see an argument against not including it as even though the content-type header is application/json, the request body format must be newline delimited JSON", "author": "russcam", "createdAt": "2020-04-16T22:58:04Z", "path": "rest-api-spec/src/main/resources/rest-api-spec/api/bulk.json", "diffHunk": "@@ -5,6 +5,10 @@\n       \"description\":\"Allows to perform multiple index/update/delete operations in a single request.\"\n     },\n     \"stability\":\"stable\",\n+    \"headers\":{\n+      \"accept\": [ \"application/json\"],\n+      \"content_type\": [\"application/x-ndjson\"]", "originalCommit": "ca9ad7ed86c850dc9718e532e3a6689f334eebed", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTI3MzYzOA==", "url": "https://github.com/elastic/elasticsearch/pull/53979#discussion_r419273638", "bodyText": "Aye that's why I opted not to include it. This documents the preferred mimetypes, to be extended with API versioning headers later on as well. The fact the server is lenient here is not a feature for clients IMO.", "author": "Mpdreamz", "createdAt": "2020-05-04T08:11:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTg5NjIwMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTg5NzE3OQ==", "url": "https://github.com/elastic/elasticsearch/pull/53979#discussion_r409897179", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  \"accept\": [ \"text/plain\", \"application/json\"]\n          \n          \n            \n                  \"accept\": [ \"text/plain\" ]\n          \n      \n    \n    \n  \n\nCat help looks like it only supports text/plain", "author": "russcam", "createdAt": "2020-04-16T23:01:07Z", "path": "rest-api-spec/src/main/resources/rest-api-spec/api/cat.help.json", "diffHunk": "@@ -5,6 +5,9 @@\n       \"description\":\"Returns help for the Cat APIs.\"\n     },\n     \"stability\":\"stable\",\n+    \"headers\":{\n+      \"accept\": [ \"text/plain\", \"application/json\"]", "originalCommit": "ca9ad7ed86c850dc9718e532e3a6689f334eebed", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTg5ODEzOA==", "url": "https://github.com/elastic/elasticsearch/pull/53979#discussion_r409898138", "bodyText": "Since this technically supports sending application/json too, should we add it after the preferred application/x-ndjson? I can see an argument against not including it as even though the content-type header is application/json, the request body format must be newline delimited JSON", "author": "russcam", "createdAt": "2020-04-16T23:03:53Z", "path": "rest-api-spec/src/main/resources/rest-api-spec/api/msearch_template.json", "diffHunk": "@@ -5,6 +5,10 @@\n       \"description\":\"Allows to execute several search template operations in one request.\"\n     },\n     \"stability\":\"stable\",\n+    \"headers\":{\n+      \"accept\": [ \"application/json\"],\n+      \"content_type\": [\"application/x-ndjson\"]", "originalCommit": "ca9ad7ed86c850dc9718e532e3a6689f334eebed", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTg5OTM2Mw==", "url": "https://github.com/elastic/elasticsearch/pull/53979#discussion_r409899363", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  \"accept\": [ \"application/json\"]\n          \n          \n            \n                  \"accept\": [ \"application/json\"],\n          \n          \n            \n                  \"content_type\": [ \"application/json\" ]\n          \n      \n    \n    \n  \n\nTakes a body: https://www.elastic.co/guide/en/elasticsearch/reference/7.x/cluster-nodes-reload-secure-settings.html", "author": "russcam", "createdAt": "2020-04-16T23:07:21Z", "path": "rest-api-spec/src/main/resources/rest-api-spec/api/nodes.reload_secure_settings.json", "diffHunk": "@@ -5,6 +5,9 @@\n       \"description\":\"Reloads secure settings.\"\n     },\n     \"stability\":\"stable\",\n+    \"headers\":{\n+      \"accept\": [ \"application/json\"]", "originalCommit": "ca9ad7ed86c850dc9718e532e3a6689f334eebed", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTg5OTg5Ng==", "url": "https://github.com/elastic/elasticsearch/pull/53979#discussion_r409899896", "bodyText": "intentional to remove required: true?", "author": "russcam", "createdAt": "2020-04-16T23:08:50Z", "path": "rest-api-spec/src/main/resources/rest-api-spec/api/search_template.json", "diffHunk": "@@ -100,8 +104,7 @@\n       }\n     },\n     \"body\":{\n-      \"description\":\"The search definition template and its params\",\n-      \"required\":true\n+      \"description\":\"The search definition template and its params\"", "originalCommit": "ca9ad7ed86c850dc9718e532e3a6689f334eebed", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTI3ODIxNw==", "url": "https://github.com/elastic/elasticsearch/pull/53979#discussion_r419278217", "bodyText": "Thank you for catching this one \ud83d\udc4d", "author": "Mpdreamz", "createdAt": "2020-05-04T08:20:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTg5OTg5Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTkwMDgyMQ==", "url": "https://github.com/elastic/elasticsearch/pull/53979#discussion_r409900821", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        \"description\": \"Documents the headers the API supports, at a minimum this should document the Accept header and Content-Type header if the API supports a body\"\n          \n          \n            \n                        \"description\": \"Documents the headers the API supports, at a minimum this must document the Accept header. The Content-Type header should be documented if the API supports a body\"", "author": "russcam", "createdAt": "2020-04-16T23:11:27Z", "path": "rest-api-spec/src/main/resources/schema.json", "diffHunk": "@@ -142,7 +145,30 @@\n                 \"description\"\n             ],\n             \"title\": \"Documentation\",\n-            \"description\": \"API documentation including a link to the public reference and a short descritpion\"\n+            \"description\": \"API documentation including a link to the public reference and a short description\"\n+        },\n+        \"Headers\": {\n+            \"type\": \"object\",\n+            \"additionalProperties\": false,\n+            \"properties\": {\n+                \"accept\": {\n+                    \"type\": \"array\",\n+                    \"items\": {\n+                        \"type\": \"string\",\n+                        \"minItems\": 1\n+                    }\n+                },\n+                \"content_type\": {\n+                    \"type\": \"array\",\n+                    \"items\": {\n+                        \"type\": \"string\",\n+                        \"minItems\": 1\n+                    }\n+                }\n+            },\n+            \"required\": [\"accept\"],\n+            \"title\": \"Headers the API understands\",\n+            \"description\": \"Documents the headers the API supports, at a minimum this should document the Accept header and Content-Type header if the API supports a body\"", "originalCommit": "ca9ad7ed86c850dc9718e532e3a6689f334eebed", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTkwMjU4Mw==", "url": "https://github.com/elastic/elasticsearch/pull/53979#discussion_r409902583", "bodyText": "Similar to other APIs that expect newline delimited JSON request body - I think we should be consistent on whether we document application/json as accepted Content-Type across these APIs", "author": "russcam", "createdAt": "2020-04-16T23:16:58Z", "path": "x-pack/plugin/src/test/resources/rest-api-spec/api/ml.post_data.json", "diffHunk": "@@ -5,6 +5,10 @@\n       \"description\":\"Sends data to an anomaly detection job for analysis.\"\n     },\n     \"stability\":\"stable\",\n+    \"headers\":{\n+      \"accept\": [ \"application/json\"],\n+      \"content_type\": [\"application/x-ndjson\", \"application/json\"]", "originalCommit": "ca9ad7ed86c850dc9718e532e3a6689f334eebed", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTkwMzA1MQ==", "url": "https://github.com/elastic/elasticsearch/pull/53979#discussion_r409903051", "bodyText": "guess this change can be discarded?", "author": "russcam", "createdAt": "2020-04-16T23:18:26Z", "path": "x-pack/qa/full-cluster-restart/src/test/resources/org/elasticsearch/xpack/restart/funny-timeout-watch.json", "diffHunk": "@@ -35,4 +35,4 @@\n       }\n     }\n   }\n-}\n\\ No newline at end of file\n+}", "originalCommit": "ca9ad7ed86c850dc9718e532e3a6689f334eebed", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTI4MjE5Ng==", "url": "https://github.com/elastic/elasticsearch/pull/53979#discussion_r419282196", "bodyText": "reverting it back is hard inside the IDE, because the old invalidates editorconfig. I have to close the editor and edit it in vim to stop it automatically reverting back to the state in the PR. Leaving as is but good catch again!", "author": "Mpdreamz", "createdAt": "2020-05-04T08:28:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTkwMzA1MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTkwMzY0NQ==", "url": "https://github.com/elastic/elasticsearch/pull/53979#discussion_r409903645", "bodyText": "Since this technically supports sending application/json too, should we add it after the preferred application/x-ndjson? I can see an argument against not including it as even though the content-type header is application/json, the request body format must be newline delimited JSON", "author": "russcam", "createdAt": "2020-04-16T23:20:12Z", "path": "rest-api-spec/src/main/resources/rest-api-spec/api/msearch.json", "diffHunk": "@@ -5,6 +5,10 @@\n       \"description\":\"Allows to execute several search operations in one request.\"\n     },\n     \"stability\":\"stable\",\n+    \"headers\":{\n+      \"accept\": [ \"application/json\"],\n+      \"content_type\": [\"application/x-ndjson\"]", "originalCommit": "ca9ad7ed86c850dc9718e532e3a6689f334eebed", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTkwMzcxNQ==", "url": "https://github.com/elastic/elasticsearch/pull/53979#discussion_r409903715", "bodyText": "Since this technically supports sending application/json too, should we add it after the preferred application/x-ndjson? I can see an argument against not including it as even though the content-type header is application/json, the request body format must be newline delimited JSON", "author": "russcam", "createdAt": "2020-04-16T23:20:29Z", "path": "x-pack/plugin/src/test/resources/rest-api-spec/api/ml.find_file_structure.json", "diffHunk": "@@ -5,6 +5,10 @@\n       \"description\":\"Finds the structure of a text file. The text file must contain data that is suitable to be ingested into Elasticsearch.\"\n     },\n     \"stability\":\"experimental\",\n+    \"headers\":{\n+      \"accept\": [ \"application/json\"],\n+      \"content_type\": [\"application/x-ndjson\"]", "originalCommit": "ca9ad7ed86c850dc9718e532e3a6689f334eebed", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "cb31bb3424919901629c53bc51468ee563918660", "url": "https://github.com/elastic/elasticsearch/commit/cb31bb3424919901629c53bc51468ee563918660", "message": "Update rest-api-spec/src/main/resources/schema.json\n\nCo-authored-by: Russ Cam <russ.cam@elastic.co>\n(cherry picked from commit 1f872d5429c21f05e0f9d23fcc5fd3ef8703766e)", "committedDate": "2020-05-04T08:30:44Z", "type": "forcePushed"}, {"oid": "c8b16cf05b1203a33915860704d6561fc62572b0", "url": "https://github.com/elastic/elasticsearch/commit/c8b16cf05b1203a33915860704d6561fc62572b0", "message": "add headers to new API", "committedDate": "2020-08-05T14:17:26Z", "type": "forcePushed"}, {"oid": "77303fde1226461248959fa35eab5cebf70df119", "url": "https://github.com/elastic/elasticsearch/commit/77303fde1226461248959fa35eab5cebf70df119", "message": "Add Accept & Content-Type headers to rest api spec\n\nThis documents the preferred Accept and Content Type headers to be\nsent with API calls.\n\nIn some cases the API returns two formats e.g cat API's in which case\nthe `headers.accept` documents both in order of preference.\n\nElasticsearch supports more content types e.g CBOR and smile but none of\nour REST clients actively support these so we don't make an active\neffort documenting these.", "committedDate": "2020-12-07T12:03:11Z", "type": "commit"}, {"oid": "10cb26cc19ed7664f3250daf3ba6bca7f639319d", "url": "https://github.com/elastic/elasticsearch/commit/10cb26cc19ed7664f3250daf3ba6bca7f639319d", "message": "update unit tests", "committedDate": "2020-12-07T12:03:11Z", "type": "commit"}, {"oid": "4a478f147fabfb0a1a0252526744dc1adda78d70", "url": "https://github.com/elastic/elasticsearch/commit/4a478f147fabfb0a1a0252526744dc1adda78d70", "message": "fix find replace in funny-timeout-watch.json", "committedDate": "2020-12-07T12:03:11Z", "type": "commit"}, {"oid": "ac27ecd3f8b67491296be3bae72403e9d9a563c8", "url": "https://github.com/elastic/elasticsearch/commit/ac27ecd3f8b67491296be3bae72403e9d9a563c8", "message": "body required on search_template", "committedDate": "2020-12-07T12:03:12Z", "type": "commit"}, {"oid": "8332570295d47f35d4c6b0f96f11197249d3ae6f", "url": "https://github.com/elastic/elasticsearch/commit/8332570295d47f35d4c6b0f96f11197249d3ae6f", "message": "Update rest-api-spec/src/main/resources/rest-api-spec/api/cat.help.json\n\nCo-authored-by: Russ Cam <russ.cam@elastic.co>\n(cherry picked from commit a3b7283df310e61ba5a71fa1e3b788dfbec59420)", "committedDate": "2020-12-07T12:03:12Z", "type": "commit"}, {"oid": "bb4e887013f10be7ab3d2a97756b6d22fc4de50c", "url": "https://github.com/elastic/elasticsearch/commit/bb4e887013f10be7ab3d2a97756b6d22fc4de50c", "message": "Update rest-api-spec/src/main/resources/rest-api-spec/api/nodes.reload_secure_settings.json\n\nCo-authored-by: Russ Cam <russ.cam@elastic.co>\n(cherry picked from commit 4f0cf97157b795f3a476bd57df16fddfd72913fe)", "committedDate": "2020-12-07T12:03:12Z", "type": "commit"}, {"oid": "e973060f68eef2708c60a138958cf644fe574df1", "url": "https://github.com/elastic/elasticsearch/commit/e973060f68eef2708c60a138958cf644fe574df1", "message": "Update rest-api-spec/src/main/resources/schema.json\n\nCo-authored-by: Russ Cam <russ.cam@elastic.co>\n(cherry picked from commit 1f872d5429c21f05e0f9d23fcc5fd3ef8703766e)", "committedDate": "2020-12-07T12:03:12Z", "type": "commit"}, {"oid": "8090eabc555c07af34b4620abd065713c418c875", "url": "https://github.com/elastic/elasticsearch/commit/8090eabc555c07af34b4620abd065713c418c875", "message": "add headers to new API", "committedDate": "2020-12-07T12:18:07Z", "type": "commit"}, {"oid": "bdd4d964cef1b9f88dba1c2dfb80202922a496e1", "url": "https://github.com/elastic/elasticsearch/commit/bdd4d964cef1b9f88dba1c2dfb80202922a496e1", "message": "add headers to snapshot.clone", "committedDate": "2020-12-07T12:20:51Z", "type": "commit"}, {"oid": "bdd4d964cef1b9f88dba1c2dfb80202922a496e1", "url": "https://github.com/elastic/elasticsearch/commit/bdd4d964cef1b9f88dba1c2dfb80202922a496e1", "message": "add headers to snapshot.clone", "committedDate": "2020-12-07T12:20:51Z", "type": "forcePushed"}, {"oid": "f40219e9580e90d76d481f12a27524884e23b0c2", "url": "https://github.com/elastic/elasticsearch/commit/f40219e9580e90d76d481f12a27524884e23b0c2", "message": "validate xpack API's", "committedDate": "2020-12-07T12:38:09Z", "type": "commit"}]}