{"pr_number": 62351, "pr_title": "Add warning about derived API keys to docs", "pr_createdAt": "2020-09-15T03:33:17Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/62351", "timeline": [{"oid": "238a459b77a72da5c00bf0148aad8a02db8d0f2f", "url": "https://github.com/elastic/elasticsearch/commit/238a459b77a72da5c00bf0148aad8a02db8d0f2f", "message": "Add warning about derived API keys to docs\n\nThis updates the Create API Key reference document with\ninformation about the limitations of derived API keys.\n\nSince ES v7.6.0, API keys that are created from an API key (what we\nrefer to as \"derived API keys\" must be created with an empty\nprivileges list (to explicitly match the effective behaviour of all\nearlier versions).\n\nThis information was included in the release notes, but didn't get\nadded to the API reference.\n\nRelates: #53647, #54522, #60154", "committedDate": "2020-09-15T03:26:49Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg1NzI2OQ==", "url": "https://github.com/elastic/elasticsearch/pull/62351#discussion_r488857269", "bodyText": "Does the API return an error if you try to create a derived key with privileges? Maybe it's clearer to say something like this:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            an API key, then the derived API key that is created cannot have any privileges.\n          \n          \n            \n            an API key, the derived API key cannot have any privileges. If you specify privileges, the API returns an error.", "author": "lcawl", "createdAt": "2020-09-15T17:52:40Z", "path": "x-pack/docs/en/rest-api/security/create-api-keys.asciidoc", "diffHunk": "@@ -19,6 +19,10 @@ Creates an API key for access without requiring basic authentication.\n \n * To use this API, you must have at least the `manage_api_key` cluster privilege.\n \n+IMPORTANT: If the credential that is used to authenticate this request is\n+an API key, then the derived API key that is created cannot have any privileges.", "originalCommit": "238a459b77a72da5c00bf0148aad8a02db8d0f2f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTE2ODM2OQ==", "url": "https://github.com/elastic/elasticsearch/pull/62351#discussion_r489168369", "bodyText": "I like calling out explicity that an error will be generated if privileges are specified for the derived key. So let's add that sentence.\nBut for the sentence precedes it, I prefer Tim's version better because the phrase of \"the result is ...\" somehow feels like we would internally discard any privileges specified for the derived key and \"the result is no privilge\", which I personally feels a bit confusing when read together with \"If you specify ...\".", "author": "ywangd", "createdAt": "2020-09-16T05:17:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg1NzI2OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTY2NzAxNA==", "url": "https://github.com/elastic/elasticsearch/pull/62351#discussion_r489667014", "bodyText": "@ywangd I've altered my suggestion to try to address your comments.", "author": "lcawl", "createdAt": "2020-09-16T18:53:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg1NzI2OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg1OTIzOQ==", "url": "https://github.com/elastic/elasticsearch/pull/62351#discussion_r488859239", "bodyText": "Not mandatory, but I think this could be split into two sentences.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            role descriptor with no privileges, and the derived API key can be used for\n          \n          \n            \n            role descriptor with no privileges. The derived API key can be used for", "author": "lcawl", "createdAt": "2020-09-15T17:56:04Z", "path": "x-pack/docs/en/rest-api/security/create-api-keys.asciidoc", "diffHunk": "@@ -57,6 +61,12 @@ thereby limiting the access scope for API keys.\n The structure of role descriptor is the same as the request for create role API.\n For more details, see <<security-api-put-role, create or update roles API>>.\n \n+NOTE: Due to the way in which this permission intersection is calculated, it is not\n+possible to create an API key that is a child of another API key, unless the derived\n+key is created without any privileges. In this case, you must explicitly specify a\n+role descriptor with no privileges, and the derived API key can be used for", "originalCommit": "238a459b77a72da5c00bf0148aad8a02db8d0f2f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg2MDQzMw==", "url": "https://github.com/elastic/elasticsearch/pull/62351#discussion_r488860433", "bodyText": "I think \"but\" should be removed here. Should \"access\" also be changed to \"authority\"?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            authentication only, but will not have access to call {es} APIs.\n          \n          \n            \n            authentication; it will not have authority to call {es} APIs.", "author": "lcawl", "createdAt": "2020-09-15T17:58:13Z", "path": "x-pack/docs/en/rest-api/security/create-api-keys.asciidoc", "diffHunk": "@@ -57,6 +61,12 @@ thereby limiting the access scope for API keys.\n The structure of role descriptor is the same as the request for create role API.\n For more details, see <<security-api-put-role, create or update roles API>>.\n \n+NOTE: Due to the way in which this permission intersection is calculated, it is not\n+possible to create an API key that is a child of another API key, unless the derived\n+key is created without any privileges. In this case, you must explicitly specify a\n+role descriptor with no privileges, and the derived API key can be used for\n+authentication only, but will not have access to call {es} APIs.", "originalCommit": "238a459b77a72da5c00bf0148aad8a02db8d0f2f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTY2ODI5OA==", "url": "https://github.com/elastic/elasticsearch/pull/62351#discussion_r489668298", "bodyText": "Without complicating things too much by explaining all the details, maybe we could just drop the only bit.\n\nI've made that change in my suggestion, thanks!", "author": "lcawl", "createdAt": "2020-09-16T18:55:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg2MDQzMw=="}], "type": "inlineReview"}, {"oid": "b885b3a9ce4fc0321ea5340235924ed7b10d98f9", "url": "https://github.com/elastic/elasticsearch/commit/b885b3a9ce4fc0321ea5340235924ed7b10d98f9", "message": "[DOCS] Nests admonition block", "committedDate": "2020-09-15T18:03:43Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTE2OTU1OA==", "url": "https://github.com/elastic/elasticsearch/pull/62351#discussion_r489169558", "bodyText": "Technically, it is not \"only\" the authentication, but a few actions that requires \"the same user\", e.g. it can also call GET _security/api_key?owner=true. Without complicating things too much by explaining all the details, maybe we could just drop the only bit.", "author": "ywangd", "createdAt": "2020-09-16T05:21:27Z", "path": "x-pack/docs/en/rest-api/security/create-api-keys.asciidoc", "diffHunk": "@@ -56,6 +60,15 @@ would be an intersection of API keys permissions and authenticated user's permis\n thereby limiting the access scope for API keys.\n The structure of role descriptor is the same as the request for create role API.\n For more details, see <<security-api-put-role, create or update roles API>>.\n++\n+--\n+NOTE: Due to the way in which this permission intersection is calculated, it is not\n+possible to create an API key that is a child of another API key, unless the derived\n+key is created without any privileges. In this case, you must explicitly specify a\n+role descriptor with no privileges, and the derived API key can be used for\n+authentication only, but will not have access to call {es} APIs.", "originalCommit": "b885b3a9ce4fc0321ea5340235924ed7b10d98f9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "03c35a57476a827312f8a46ee34247e29bce191e", "url": "https://github.com/elastic/elasticsearch/commit/03c35a57476a827312f8a46ee34247e29bce191e", "message": "Apply suggestions from code review\n\nCo-authored-by: Lisa Cawley <lcawley@elastic.co>", "committedDate": "2020-09-17T12:03:09Z", "type": "commit"}, {"oid": "5c3c6e887776b53b61726a10f1111d90f81a0745", "url": "https://github.com/elastic/elasticsearch/commit/5c3c6e887776b53b61726a10f1111d90f81a0745", "message": "Merge branch 'master' into docs/derived-api-key", "committedDate": "2020-09-17T12:23:46Z", "type": "commit"}]}