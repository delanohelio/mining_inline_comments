{"pr_number": 52677, "pr_title": "\"Adding nodes\" instructions only work on localhost", "pr_createdAt": "2020-02-22T19:52:41Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/52677", "timeline": [{"oid": "b26489e34250db895e98cb4e1c720759bfe01f49", "url": "https://github.com/elastic/elasticsearch/commit/b26489e34250db895e98cb4e1c720759bfe01f49", "message": "\"Adding nodes\" instructions only work on localhost\n\nThe introductory sections of the reference manual contains some simplified\ninstructions for adding a node to the cluster. Unfortunately they are a little\ntoo simplified and only really work for clusters running on `localhost`. If you\ntry and follow these instructions for a distributed cluster then the new node\nwill, confusingly, auto-bootstrap itself into a distinct one-node cluster.\n\nMultiple nodes running on localhost is a valid config, of course, but we should\nspell out that these instructions are really only for experimentation and that\nit takes a bit more work to add nodes to a distributed cluster. This commit\ndoes so.\n\nAlso, the \"important config\" instructions for discovery say that you MUST set\n`discovery.seed_hosts` whereas in fact it is fine to ignore this setting and\nuse a dynamic discovery mechanism instead. This commit weakens this statement\nand links to the docs for dynamic discovery mechanisms.\n\nFinally, this section is also overloaded with some technical details that are\nnot important for this context and are adequately covered elsewhere, and\ncompletely fails to note that the default discovery port is 9300. This commit\naddresses this.", "committedDate": "2020-02-22T19:48:39Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzI1ODM1OA==", "url": "https://github.com/elastic/elasticsearch/pull/52677#discussion_r383258358", "bodyText": "The new info is great, but the user can't quickly scan to see which settings impact the port. I think some formatting and whitespace would help.\n`discovery.seed_hosts`::\n+\n--\nProvides a list of the addresses of the master-eligible nodes in the cluster.\nEach address has the format `host:port` or `host`.\n\nThe `port` is determined by checking the following settings in order:\n\n. `transport.profiles.default.port`\n. `transport.port`\n\nIf none of these settings are specified, the port defaults to `9300`.\n\nNote that IPv6 addresses must be bracketed. May also be a single string\ncontaining all the addresses separated by commas. The default value is\n`[\"127.0.0.1\", \"[::1]\"]`. See <<unicast.hosts>>.\n--", "author": "jrodewig", "createdAt": "2020-02-24T13:16:57Z", "path": "docs/reference/modules/discovery/discovery-settings.asciidoc", "diffHunk": "@@ -5,10 +5,13 @@ Discovery and cluster formation are affected by the following settings:\n \n `discovery.seed_hosts`::\n \n-    Provides a list of master-eligible nodes in the cluster. Each value has the\n-    format `host:port` or `host`, where `port` defaults to the setting\n-    `transport.profiles.default.port`. Note that IPv6 hosts must be bracketed.\n-    The default value is `[\"127.0.0.1\", \"[::1]\"]`. See <<unicast.hosts>>.\n+    Provides a list of the addresses of the master-eligible nodes in the\n+    cluster. Each address has the format `host:port` or `host`, where `port`\n+    defaults to the setting `transport.profiles.default.port` falling back to\n+    `transport.port` if not set; if neither is set then the default port is\n+    `9300`. Note that IPv6 addresses must be bracketed. May also be a single\n+    string containing all the addresses separated by commas. The default value\n+    is `[\"127.0.0.1\", \"[::1]\"]`. See <<unicast.hosts>>.", "originalCommit": "b26489e34250db895e98cb4e1c720759bfe01f49", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzczODc4Mw==", "url": "https://github.com/elastic/elasticsearch/pull/52677#discussion_r383738783", "bodyText": "Thanks, yes that's better. I'm never quite sure how to reformat these one-paragraph bits into more richly formatted text, so let's see if my changes worked there...", "author": "DaveCTurner", "createdAt": "2020-02-25T09:00:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzI1ODM1OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzI1ODY0Mw==", "url": "https://github.com/elastic/elasticsearch/pull/52677#discussion_r383258643", "bodyText": "May also be a single string containing all the addresses separated by commas.\n\nIt's unclear if this only applies to IPv6 addresses.", "author": "jrodewig", "createdAt": "2020-02-24T13:17:34Z", "path": "docs/reference/modules/discovery/discovery-settings.asciidoc", "diffHunk": "@@ -5,10 +5,13 @@ Discovery and cluster formation are affected by the following settings:\n \n `discovery.seed_hosts`::\n \n-    Provides a list of master-eligible nodes in the cluster. Each value has the\n-    format `host:port` or `host`, where `port` defaults to the setting\n-    `transport.profiles.default.port`. Note that IPv6 hosts must be bracketed.\n-    The default value is `[\"127.0.0.1\", \"[::1]\"]`. See <<unicast.hosts>>.\n+    Provides a list of the addresses of the master-eligible nodes in the\n+    cluster. Each address has the format `host:port` or `host`, where `port`\n+    defaults to the setting `transport.profiles.default.port` falling back to\n+    `transport.port` if not set; if neither is set then the default port is\n+    `9300`. Note that IPv6 addresses must be bracketed. May also be a single\n+    string containing all the addresses separated by commas. The default value", "originalCommit": "b26489e34250db895e98cb4e1c720759bfe01f49", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzczODg4OQ==", "url": "https://github.com/elastic/elasticsearch/pull/52677#discussion_r383738889", "bodyText": "Good point, I moved this sentence.", "author": "DaveCTurner", "createdAt": "2020-02-25T09:01:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzI1ODY0Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzI2NDk4OA==", "url": "https://github.com/elastic/elasticsearch/pull/52677#discussion_r383264988", "bodyText": "I would update the formatting/whitespace here as well:\n<1> The `port` is determined by checking the following settings in order:\n+\n--\n\n. `transport.profiles.default.port`\n. `transport.port`\n\nIf none of these settings are specified, the port defaults to `9300`.\n--", "author": "jrodewig", "createdAt": "2020-02-24T13:30:49Z", "path": "docs/reference/setup/important-settings/discovery-settings.asciidoc", "diffHunk": "@@ -55,8 +56,9 @@ cluster.initial_master_nodes: <3>\n    - master-node-b\n    - master-node-c\n --------------------------------------------------\n-<1> The port will default to `transport.profiles.default.port` and fallback to\n-    `transport.port` if not specified.\n+<1> The port will default to `transport.profiles.default.port` and fall back to\n+    `transport.port` if not specified. If neither of these settings is set then\n+    the default port is `9300`.", "originalCommit": "b26489e34250db895e98cb4e1c720759bfe01f49", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzczOTY0NA==", "url": "https://github.com/elastic/elasticsearch/pull/52677#discussion_r383739644", "bodyText": "Hmm. I think even this is too much for this introductory description; it is rare to need to adjust the default port, and this seems to cause more confusion than it saves. I elected to remove mention of these settings and say the port usually defaults to 9300 with a link to more detailed docs.", "author": "DaveCTurner", "createdAt": "2020-02-25T09:02:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzI2NDk4OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzgzNTA0MA==", "url": "https://github.com/elastic/elasticsearch/pull/52677#discussion_r383835040", "bodyText": "That works for me. Thanks @DaveCTurner.", "author": "jrodewig", "createdAt": "2020-02-25T11:58:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzI2NDk4OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzI2OTMxOQ==", "url": "https://github.com/elastic/elasticsearch/pull/52677#discussion_r383269319", "bodyText": "Suggestion:\n\nIf your master-eligible nodes do not have fixed addresses, use an <<built-in-hosts-providers,alternative hosts provider>> to find their addresses dynamically.", "author": "jrodewig", "createdAt": "2020-02-24T13:39:52Z", "path": "docs/reference/setup/important-settings/discovery-settings.asciidoc", "diffHunk": "@@ -14,19 +14,20 @@ each other and elect a master node.\n \n Out of the box, without any network configuration, Elasticsearch will bind to\n the available loopback addresses and will scan local ports 9300 to 9305 to try\n-to connect to other nodes running on the same server. This provides an auto-\n-clustering experience without having to do any configuration.\n+to connect to other nodes running on the same server. This provides an\n+auto-clustering experience without having to do any configuration.\n \n-When you want to form a cluster with nodes on other hosts, you must use the\n+When you want to form a cluster with nodes on other hosts, you should use the\n `discovery.seed_hosts` setting to provide a list of other nodes in the cluster\n that are master-eligible and likely to be live and contactable in order to seed\n-the <<modules-discovery-hosts-providers,discovery process>>. This setting\n-should normally contain the addresses of all the master-eligible nodes in the\n-cluster.  This setting contains either an array of hosts or a comma-delimited\n-string. Each value should be in the form of `host:port` or `host` (where `port`\n-defaults to the setting `transport.profiles.default.port` falling back to\n-`transport.port` if not set). Note that IPv6 hosts must be bracketed. The\n-default for this setting is `127.0.0.1, [::1]`.\n+the <<modules-discovery-hosts-providers,discovery process>>. This setting should\n+be a list of the addresses of all the master-eligible nodes in the cluster, each\n+of which can either be an IP address or a hostname that {es} resolves to IP\n+addresses using DNS. Note that IPv6 addresses must be bracketed.\n+\n+If the addresses of your master-eligible nodes are not fixed then you should\n+instead use an <<built-in-hosts-providers,alternative hosts provider>> to find\n+their addresses dynamically.", "originalCommit": "b26489e34250db895e98cb4e1c720759bfe01f49", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzczOTY3Nw==", "url": "https://github.com/elastic/elasticsearch/pull/52677#discussion_r383739677", "bodyText": "++ thanks", "author": "DaveCTurner", "createdAt": "2020-02-25T09:02:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzI2OTMxOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzI2OTMzMg==", "url": "https://github.com/elastic/elasticsearch/pull/52677#discussion_r383269332", "bodyText": "Suggestion:\n\nThis setting should contain an address for each master-eligible node in the\ncluster. Each address can be either an IP address or a hostname which resolves\nto an IP string.", "author": "jrodewig", "createdAt": "2020-02-24T13:39:54Z", "path": "docs/reference/setup/important-settings/discovery-settings.asciidoc", "diffHunk": "@@ -14,19 +14,20 @@ each other and elect a master node.\n \n Out of the box, without any network configuration, Elasticsearch will bind to\n the available loopback addresses and will scan local ports 9300 to 9305 to try\n-to connect to other nodes running on the same server. This provides an auto-\n-clustering experience without having to do any configuration.\n+to connect to other nodes running on the same server. This provides an\n+auto-clustering experience without having to do any configuration.\n \n-When you want to form a cluster with nodes on other hosts, you must use the\n+When you want to form a cluster with nodes on other hosts, you should use the\n `discovery.seed_hosts` setting to provide a list of other nodes in the cluster\n that are master-eligible and likely to be live and contactable in order to seed\n-the <<modules-discovery-hosts-providers,discovery process>>. This setting\n-should normally contain the addresses of all the master-eligible nodes in the\n-cluster.  This setting contains either an array of hosts or a comma-delimited\n-string. Each value should be in the form of `host:port` or `host` (where `port`\n-defaults to the setting `transport.profiles.default.port` falling back to\n-`transport.port` if not set). Note that IPv6 hosts must be bracketed. The\n-default for this setting is `127.0.0.1, [::1]`.\n+the <<modules-discovery-hosts-providers,discovery process>>. This setting should\n+be a list of the addresses of all the master-eligible nodes in the cluster, each\n+of which can either be an IP address or a hostname that {es} resolves to IP\n+addresses using DNS. Note that IPv6 addresses must be bracketed.", "originalCommit": "b26489e34250db895e98cb4e1c720759bfe01f49", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzczOTg0Nw==", "url": "https://github.com/elastic/elasticsearch/pull/52677#discussion_r383739847", "bodyText": "Yes, two sentences are nicer here, thanks.", "author": "DaveCTurner", "createdAt": "2020-02-25T09:02:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzI2OTMzMg=="}], "type": "inlineReview"}, {"oid": "9e5b0819ba2cdbfbde59ebf9a57a58599b5b2877", "url": "https://github.com/elastic/elasticsearch/commit/9e5b0819ba2cdbfbde59ebf9a57a58599b5b2877", "message": "Iteration on review comments", "committedDate": "2020-02-25T08:56:42Z", "type": "commit"}, {"oid": "4826de3cbafd9ce91418d40f8a6ef90f4faddfdf", "url": "https://github.com/elastic/elasticsearch/commit/4826de3cbafd9ce91418d40f8a6ef90f4faddfdf", "message": "Reformat", "committedDate": "2020-02-25T09:02:33Z", "type": "commit"}, {"oid": "28f3662239acbc0acd810224f3546119fa881aa0", "url": "https://github.com/elastic/elasticsearch/commit/28f3662239acbc0acd810224f3546119fa881aa0", "message": "Bah it's the other way round from Markdown", "committedDate": "2020-02-25T10:09:49Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzgzNzQwMg==", "url": "https://github.com/elastic/elasticsearch/pull/52677#discussion_r383837402", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            to be resolved by DNS, or an IPv4 address, or an IPv6 address. IPv6 addresses\n          \n          \n            \n            to be resolved by DNS, an IPv4 address, or an IPv6 address. IPv6 addresses", "author": "jrodewig", "createdAt": "2020-02-25T12:03:53Z", "path": "docs/reference/modules/discovery/discovery-settings.asciidoc", "diffHunk": "@@ -4,19 +4,32 @@\n Discovery and cluster formation are affected by the following settings:\n \n `discovery.seed_hosts`::\n-\n-    Provides a list of master-eligible nodes in the cluster. Each value has the\n-    format `host:port` or `host`, where `port` defaults to the setting\n-    `transport.profiles.default.port`. Note that IPv6 hosts must be bracketed.\n-    The default value is `[\"127.0.0.1\", \"[::1]\"]`. See <<unicast.hosts>>.\n++\n+--\n+Provides a list of the addresses of the master-eligible nodes in the cluster.\n+May also be a single string containing the addresses separated by commas. Each\n+address has the format `host:port` or `host`. The `host` is either a host name\n+to be resolved by DNS, or an IPv4 address, or an IPv6 address. IPv6 addresses", "originalCommit": "28f3662239acbc0acd810224f3546119fa881aa0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzgzNzU3OQ==", "url": "https://github.com/elastic/elasticsearch/pull/52677#discussion_r383837579", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            addresses then Elasticsearch uses all of them. DNS lookups are subject to\n          \n          \n            \n            addresses, {es} uses all of them. DNS lookups are subject to", "author": "jrodewig", "createdAt": "2020-02-25T12:04:16Z", "path": "docs/reference/modules/discovery/discovery-settings.asciidoc", "diffHunk": "@@ -4,19 +4,32 @@\n Discovery and cluster formation are affected by the following settings:\n \n `discovery.seed_hosts`::\n-\n-    Provides a list of master-eligible nodes in the cluster. Each value has the\n-    format `host:port` or `host`, where `port` defaults to the setting\n-    `transport.profiles.default.port`. Note that IPv6 hosts must be bracketed.\n-    The default value is `[\"127.0.0.1\", \"[::1]\"]`. See <<unicast.hosts>>.\n++\n+--\n+Provides a list of the addresses of the master-eligible nodes in the cluster.\n+May also be a single string containing the addresses separated by commas. Each\n+address has the format `host:port` or `host`. The `host` is either a host name\n+to be resolved by DNS, or an IPv4 address, or an IPv6 address. IPv6 addresses\n+must be enclosed in square brackets. If a host name resolves via DNS to multiple\n+addresses then Elasticsearch uses all of them. DNS lookups are subject to", "originalCommit": "28f3662239acbc0acd810224f3546119fa881aa0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "20d130d7b527ad350cb9169d12a16cc02ca6c134", "url": "https://github.com/elastic/elasticsearch/commit/20d130d7b527ad350cb9169d12a16cc02ca6c134", "message": "Update docs/reference/modules/discovery/discovery-settings.asciidoc\n\nCo-Authored-By: James Rodewig <james.rodewig@elastic.co>", "committedDate": "2020-02-27T07:41:19Z", "type": "commit"}, {"oid": "3500a1ac495ec39df7f7eacaa03e0a796dc8d4bc", "url": "https://github.com/elastic/elasticsearch/commit/3500a1ac495ec39df7f7eacaa03e0a796dc8d4bc", "message": "Update docs/reference/modules/discovery/discovery-settings.asciidoc\n\nCo-Authored-By: James Rodewig <james.rodewig@elastic.co>", "committedDate": "2020-02-27T07:41:26Z", "type": "commit"}]}