{"pr_number": 58751, "pr_title": "Dangling indices documentation", "pr_createdAt": "2020-06-30T14:00:40Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/58751", "timeline": [{"oid": "6fc50020b10c47b70a536def93f6b7bd48419caf", "url": "https://github.com/elastic/elasticsearch/commit/6fc50020b10c47b70a536def93f6b7bd48419caf", "message": "Initial dangling indices docs", "committedDate": "2020-06-24T12:10:38Z", "type": "commit"}, {"oid": "2dce37ca290316e3ef616b3253ff4ff71df1dcaa", "url": "https://github.com/elastic/elasticsearch/commit/2dce37ca290316e3ef616b3253ff4ff71df1dcaa", "message": "Fixes and polishing", "committedDate": "2020-06-24T14:02:12Z", "type": "commit"}, {"oid": "02ee01d38b7ad21c062b4426af2b9ef96d9c6feb", "url": "https://github.com/elastic/elasticsearch/commit/02ee01d38b7ad21c062b4426af2b9ef96d9c6feb", "message": "Disable auto_import_dangling_indices by default\n\nFurther docs fixes. Update gateways docs to cover the new\n`gateway.gateway.auto_import_dangling_indices` setting, and rework text\nsince the default behaviour is now not to import automatically.", "committedDate": "2020-06-30T13:17:33Z", "type": "commit"}, {"oid": "27f4bbc08abc0aac80c9136fa80b6869dd8c71ce", "url": "https://github.com/elastic/elasticsearch/commit/27f4bbc08abc0aac80c9136fa80b6869dd8c71ce", "message": "Merge remote-tracking branch 'upstream/master' into dangling-indices-docs", "committedDate": "2020-06-30T13:56:04Z", "type": "commit"}, {"oid": "e8470f41ebe174ab06e81ead9db283e423062e6a", "url": "https://github.com/elastic/elasticsearch/commit/e8470f41ebe174ab06e81ead9db283e423062e6a", "message": "Fixes", "committedDate": "2020-07-01T09:31:39Z", "type": "commit"}, {"oid": "4b1ab53ce4798ac3edf5f0af44791dc284306383", "url": "https://github.com/elastic/elasticsearch/commit/4b1ab53ce4798ac3edf5f0af44791dc284306383", "message": "Merge remote-tracking branch 'upstream/master' into dangling-indices-docs", "committedDate": "2020-07-01T09:57:39Z", "type": "commit"}, {"oid": "df0943f2bac7c152d349db4ee967c138e93894f9", "url": "https://github.com/elastic/elasticsearch/commit/df0943f2bac7c152d349db4ee967c138e93894f9", "message": "Revert server changes", "committedDate": "2020-07-02T10:40:51Z", "type": "commit"}, {"oid": "aefca75ab27cd518c19a38698964cb16be13455c", "url": "https://github.com/elastic/elasticsearch/commit/aefca75ab27cd518c19a38698964cb16be13455c", "message": "Merge remote-tracking branch 'upstream/master' into dangling-indices-docs", "committedDate": "2020-07-02T10:41:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTAzNjM0NQ==", "url": "https://github.com/elastic/elasticsearch/pull/58751#discussion_r449036345", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            This API lets you delete single dangling index from disk. You reference the\n          \n          \n            \n            This API lets you delete a single dangling index from disk. You reference the\n          \n      \n    \n    \n  \n\nor maybe just\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            This API lets you delete single dangling index from disk. You reference the\n          \n          \n            \n            This API lets you delete a dangling index. You reference the", "author": "DaveCTurner", "createdAt": "2020-07-02T14:19:19Z", "path": "docs/reference/indices/dangling-index-delete.asciidoc", "diffHunk": "@@ -0,0 +1,42 @@\n+[[dangling-index-delete]]\n+=== Delete dangling index API\n+++++\n+<titleabbrev>Delete dangling index</titleabbrev>\n+++++\n+\n+Deletes a dangling index.\n+\n+[[dangling-index-delete-api-request]]\n+==== {api-request-title}\n+\n+[source,console]\n+--------------------------------------------------\n+DELETE /_dangling/<index-uuid>?accept_data_loss=true\n+--------------------------------------------------\n+// TEST[skip:Difficult to set up]\n+\n+[[dangling-index-delete-api-desc]]\n+==== {api-description-title}\n+\n+include::{es-repo-dir}/indices/dangling-indices-list.asciidoc[tag=dangling-index-description]\n+\n+This API lets you delete single dangling index from disk. You reference the", "originalCommit": "aefca75ab27cd518c19a38698964cb16be13455c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTAzNjYzOA==", "url": "https://github.com/elastic/elasticsearch/pull/58751#discussion_r449036638", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            <<dangling-indices-list,dangling indices list API>>.\n          \n          \n            \n            <<dangling-indices-list,list dangling indices API>>.", "author": "DaveCTurner", "createdAt": "2020-07-02T14:19:45Z", "path": "docs/reference/indices/dangling-index-delete.asciidoc", "diffHunk": "@@ -0,0 +1,42 @@\n+[[dangling-index-delete]]\n+=== Delete dangling index API\n+++++\n+<titleabbrev>Delete dangling index</titleabbrev>\n+++++\n+\n+Deletes a dangling index.\n+\n+[[dangling-index-delete-api-request]]\n+==== {api-request-title}\n+\n+[source,console]\n+--------------------------------------------------\n+DELETE /_dangling/<index-uuid>?accept_data_loss=true\n+--------------------------------------------------\n+// TEST[skip:Difficult to set up]\n+\n+[[dangling-index-delete-api-desc]]\n+==== {api-description-title}\n+\n+include::{es-repo-dir}/indices/dangling-indices-list.asciidoc[tag=dangling-index-description]\n+\n+This API lets you delete single dangling index from disk. You reference the\n+index by its UUID, which you can find using the\n+<<dangling-indices-list,list API>>. You can also\n+<<dangling-index-import,import>> a dangling index.\n+\n+[[dangling-index-delete-api-path-params]]\n+==== {api-path-parms-title}\n+\n+`<index-uuid>`::\n+(Required, string)\n+UUID of the index to delete. You can find this using the\n+<<dangling-indices-list,dangling indices list API>>.", "originalCommit": "aefca75ab27cd518c19a38698964cb16be13455c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTAzNzM3OA==", "url": "https://github.com/elastic/elasticsearch/pull/58751#discussion_r449037378", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            cannot know where the dangling index data came from, e.g.  copying around\n          \n          \n            \n            does not know where the dangling index data came from, nor does it know which shard copies are fresh and which are stale,", "author": "DaveCTurner", "createdAt": "2020-07-02T14:20:44Z", "path": "docs/reference/indices/dangling-index-import.asciidoc", "diffHunk": "@@ -0,0 +1,44 @@\n+[[dangling-index-import]]\n+=== Import dangling index API\n+++++\n+<titleabbrev>Import dangling index</titleabbrev>\n+++++\n+\n+Imports a dangling index.\n+\n+[[dangling-index-import-api-request]]\n+==== {api-request-title}\n+\n+[source,console]\n+--------------------------------------------------\n+POST /_dangling/<index-uuid>?accept_data_loss=true\n+--------------------------------------------------\n+// TEST[skip:Difficult to set up]\n+\n+[[dangling-index-import-api-desc]]\n+==== {api-description-title}\n+\n+include::{es-repo-dir}/indices/dangling-indices-list.asciidoc[tag=dangling-index-description]\n+\n+This API lets you import a single index into the cluster. You reference the\n+index by its UUID, which you can find using the\n+<<dangling-indices-list,list API>>. You can also\n+<<dangling-index-delete,delete>> a dangling index.\n+\n+[[dangling-index-import-api-path-params]]\n+==== {api-path-parms-title}\n+\n+`<index-uuid>`::\n+(Required, string)\n+UUID of the index to import. You can find this using the\n+<<dangling-indices-list,list API>>.\n+\n+[[dangling-index-import-api-query-params]]\n+==== {api-query-parms-title}\n+\n+`accept_data_loss`::\n+(Required, boolean)\n+This field must be set to `true` in order to carry out the import. {es}\n+cannot know where the dangling index data came from, e.g.  copying around", "originalCommit": "aefca75ab27cd518c19a38698964cb16be13455c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTAzNzUxNA==", "url": "https://github.com/elastic/elasticsearch/pull/58751#discussion_r449037514", "bodyText": "Let's not suggest that this is a thing one might want to do \ud83d\ude01\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            data directories, and so can offer no guarantees about the data being\n          \n          \n            \n            so it can offer no guarantees about the data being", "author": "DaveCTurner", "createdAt": "2020-07-02T14:20:56Z", "path": "docs/reference/indices/dangling-index-import.asciidoc", "diffHunk": "@@ -0,0 +1,44 @@\n+[[dangling-index-import]]\n+=== Import dangling index API\n+++++\n+<titleabbrev>Import dangling index</titleabbrev>\n+++++\n+\n+Imports a dangling index.\n+\n+[[dangling-index-import-api-request]]\n+==== {api-request-title}\n+\n+[source,console]\n+--------------------------------------------------\n+POST /_dangling/<index-uuid>?accept_data_loss=true\n+--------------------------------------------------\n+// TEST[skip:Difficult to set up]\n+\n+[[dangling-index-import-api-desc]]\n+==== {api-description-title}\n+\n+include::{es-repo-dir}/indices/dangling-indices-list.asciidoc[tag=dangling-index-description]\n+\n+This API lets you import a single index into the cluster. You reference the\n+index by its UUID, which you can find using the\n+<<dangling-indices-list,list API>>. You can also\n+<<dangling-index-delete,delete>> a dangling index.\n+\n+[[dangling-index-import-api-path-params]]\n+==== {api-path-parms-title}\n+\n+`<index-uuid>`::\n+(Required, string)\n+UUID of the index to import. You can find this using the\n+<<dangling-indices-list,list API>>.\n+\n+[[dangling-index-import-api-query-params]]\n+==== {api-query-parms-title}\n+\n+`accept_data_loss`::\n+(Required, boolean)\n+This field must be set to `true` in order to carry out the import. {es}\n+cannot know where the dangling index data came from, e.g.  copying around\n+data directories, and so can offer no guarantees about the data being", "originalCommit": "aefca75ab27cd518c19a38698964cb16be13455c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTAzODQwMA==", "url": "https://github.com/elastic/elasticsearch/pull/58751#discussion_r449038400", "bodyText": "Let's not suggest this is a thing you might want to do \ud83d\ude01\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            state, those indices are considered to be dangling. For example, copying a\n          \n          \n            \n            state, those indices are considered to be dangling. For example,", "author": "DaveCTurner", "createdAt": "2020-07-02T14:22:05Z", "path": "docs/reference/indices/dangling-indices-list.asciidoc", "diffHunk": "@@ -0,0 +1,49 @@\n+[[dangling-indices-list]]\n+=== List dangling indices API\n+++++\n+<titleabbrev>List dangling indices</titleabbrev>\n+++++\n+\n+Lists dangling indices.\n+\n+[[dangling-indices-list-api-request]]\n+==== {api-request-title}\n+\n+[source,console]\n+--------------------------------------------------\n+GET /_dangling\n+--------------------------------------------------\n+// TEST[skip:TBD]\n+\n+[[dangling-indices-list-api-desc]]\n+==== {api-description-title}\n+\n+// tag::dangling-index-description[]\n+If {es} encounters index data that is absent from the current cluster\n+state, those indices are considered to be dangling. For example, copying a", "originalCommit": "aefca75ab27cd518c19a38698964cb16be13455c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTAzOTA5Ng==", "url": "https://github.com/elastic/elasticsearch/pull/58751#discussion_r449039096", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            data directory between clusters, or deleting more than\n          \n          \n            \n            this can happen if you delete more than", "author": "DaveCTurner", "createdAt": "2020-07-02T14:23:06Z", "path": "docs/reference/indices/dangling-indices-list.asciidoc", "diffHunk": "@@ -0,0 +1,49 @@\n+[[dangling-indices-list]]\n+=== List dangling indices API\n+++++\n+<titleabbrev>List dangling indices</titleabbrev>\n+++++\n+\n+Lists dangling indices.\n+\n+[[dangling-indices-list-api-request]]\n+==== {api-request-title}\n+\n+[source,console]\n+--------------------------------------------------\n+GET /_dangling\n+--------------------------------------------------\n+// TEST[skip:TBD]\n+\n+[[dangling-indices-list-api-desc]]\n+==== {api-description-title}\n+\n+// tag::dangling-index-description[]\n+If {es} encounters index data that is absent from the current cluster\n+state, those indices are considered to be dangling. For example, copying a\n+data directory between clusters, or deleting more than", "originalCommit": "aefca75ab27cd518c19a38698964cb16be13455c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTAzOTUyNQ==", "url": "https://github.com/elastic/elasticsearch/pull/58751#discussion_r449039525", "bodyText": "Let's not suggest this is a thing you might want to do \ud83d\ude01\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            state, those indices are considered to be dangling. For example, copying a\n          \n          \n            \n            state, those indices are considered to be dangling. For example,", "author": "DaveCTurner", "createdAt": "2020-07-02T14:23:40Z", "path": "docs/reference/modules/cluster/misc.asciidoc", "diffHunk": "@@ -107,6 +107,13 @@ increase it if you expect nodes to be absent from the cluster and miss more\n than 500 deletes. We think that is rare, thus the default. Tombstones don't take\n up much space, but we also think that a number like 50,000 is probably too big.\n \n+If {es} encounters index data that is absent from the current cluster\n+state, those indices are considered to be dangling. For example, copying a", "originalCommit": "aefca75ab27cd518c19a38698964cb16be13455c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTAzOTc4NA==", "url": "https://github.com/elastic/elasticsearch/pull/58751#discussion_r449039784", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            data directory between clusters, or deleting more than\n          \n          \n            \n            this can happen if you delete more than", "author": "DaveCTurner", "createdAt": "2020-07-02T14:24:01Z", "path": "docs/reference/modules/cluster/misc.asciidoc", "diffHunk": "@@ -107,6 +107,13 @@ increase it if you expect nodes to be absent from the cluster and miss more\n than 500 deletes. We think that is rare, thus the default. Tombstones don't take\n up much space, but we also think that a number like 50,000 is probably too big.\n \n+If {es} encounters index data that is absent from the current cluster\n+state, those indices are considered to be dangling. For example, copying a\n+data directory between clusters, or deleting more than", "originalCommit": "aefca75ab27cd518c19a38698964cb16be13455c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "a625812fc4eaf505b194436156643a1ea5c57edb", "url": "https://github.com/elastic/elasticsearch/commit/a625812fc4eaf505b194436156643a1ea5c57edb", "message": "Apply suggestions from code review\n\nCo-authored-by: David Turner <david.turner@elastic.co>", "committedDate": "2020-07-02T15:38:49Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTE4NTM4Nw==", "url": "https://github.com/elastic/elasticsearch/pull/58751#discussion_r449185387", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            The API returns a response in the following shape:\n          \n          \n            \n            The API returns the following response:", "author": "lockewritesdocs", "createdAt": "2020-07-02T18:02:22Z", "path": "docs/reference/indices/dangling-indices-list.asciidoc", "diffHunk": "@@ -0,0 +1,49 @@\n+[[dangling-indices-list]]\n+=== List dangling indices API\n+++++\n+<titleabbrev>List dangling indices</titleabbrev>\n+++++\n+\n+Lists dangling indices.\n+\n+[[dangling-indices-list-api-request]]\n+==== {api-request-title}\n+\n+[source,console]\n+--------------------------------------------------\n+GET /_dangling\n+--------------------------------------------------\n+// TEST[skip:TBD]\n+\n+[[dangling-indices-list-api-desc]]\n+==== {api-description-title}\n+\n+// tag::dangling-index-description[]\n+If {es} encounters index data that is absent from the current cluster\n+state, those indices are considered to be dangling. For example,\n+this can happen if you delete more than\n+`cluster.indices.tombstones.size` indices while an {es} node is offline.\n+// end::dangling-index-description[]\n+\n+This API lets you find such indices, which you can then\n+<<dangling-index-import,import>> or <<dangling-index-delete,delete>>.\n+\n+\n+[[dangling-indices-list-api-example]]\n+==== {api-examples-title}\n+\n+The API returns a response in the following shape:", "originalCommit": "a625812fc4eaf505b194436156643a1ea5c57edb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTE4NjE2Mg==", "url": "https://github.com/elastic/elasticsearch/pull/58751#discussion_r449186162", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            This API lets you find such indices, which you can then\n          \n          \n            \n            Use this API to list dangling indices, which you can then", "author": "lockewritesdocs", "createdAt": "2020-07-02T18:04:04Z", "path": "docs/reference/indices/dangling-indices-list.asciidoc", "diffHunk": "@@ -0,0 +1,49 @@\n+[[dangling-indices-list]]\n+=== List dangling indices API\n+++++\n+<titleabbrev>List dangling indices</titleabbrev>\n+++++\n+\n+Lists dangling indices.\n+\n+[[dangling-indices-list-api-request]]\n+==== {api-request-title}\n+\n+[source,console]\n+--------------------------------------------------\n+GET /_dangling\n+--------------------------------------------------\n+// TEST[skip:TBD]\n+\n+[[dangling-indices-list-api-desc]]\n+==== {api-description-title}\n+\n+// tag::dangling-index-description[]\n+If {es} encounters index data that is absent from the current cluster\n+state, those indices are considered to be dangling. For example,\n+this can happen if you delete more than\n+`cluster.indices.tombstones.size` indices while an {es} node is offline.\n+// end::dangling-index-description[]\n+\n+This API lets you find such indices, which you can then", "originalCommit": "a625812fc4eaf505b194436156643a1ea5c57edb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTE4ODUzNw==", "url": "https://github.com/elastic/elasticsearch/pull/58751#discussion_r449188537", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            This API lets you import a single index into the cluster. You reference the\n          \n          \n            \n            index by its UUID, which you can find using the\n          \n          \n            \n            <<dangling-indices-list,list API>>. You can also\n          \n          \n            \n            <<dangling-index-delete,delete>> a dangling index.\n          \n          \n            \n            \n          \n          \n            \n            Import a single index into the cluster by referencing its UUID. Use the\n          \n          \n            \n            <<dangling-indices-list,List dangling indices API>> to locate the UUID of an index.", "author": "lockewritesdocs", "createdAt": "2020-07-02T18:08:53Z", "path": "docs/reference/indices/dangling-index-import.asciidoc", "diffHunk": "@@ -0,0 +1,44 @@\n+[[dangling-index-import]]\n+=== Import dangling index API\n+++++\n+<titleabbrev>Import dangling index</titleabbrev>\n+++++\n+\n+Imports a dangling index.\n+\n+[[dangling-index-import-api-request]]\n+==== {api-request-title}\n+\n+[source,console]\n+--------------------------------------------------\n+POST /_dangling/<index-uuid>?accept_data_loss=true\n+--------------------------------------------------\n+// TEST[skip:Difficult to set up]\n+\n+[[dangling-index-import-api-desc]]\n+==== {api-description-title}\n+\n+include::{es-repo-dir}/indices/dangling-indices-list.asciidoc[tag=dangling-index-description]\n+\n+This API lets you import a single index into the cluster. You reference the\n+index by its UUID, which you can find using the\n+<<dangling-indices-list,list API>>. You can also\n+<<dangling-index-delete,delete>> a dangling index.", "originalCommit": "a625812fc4eaf505b194436156643a1ea5c57edb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTE5MTA0Mg==", "url": "https://github.com/elastic/elasticsearch/pull/58751#discussion_r449191042", "bodyText": "This change isn't necessary, but I think focuses more on the API function.", "author": "lockewritesdocs", "createdAt": "2020-07-02T18:14:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTE4ODUzNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTE5MjkwMQ==", "url": "https://github.com/elastic/elasticsearch/pull/58751#discussion_r449192901", "bodyText": "Consider using the same include:: directive from the import dangling API page:\ninclude::{es-repo-dir}/indices/dangling-indices-list.asciidoc[tag=dangling-index-description]", "author": "lockewritesdocs", "createdAt": "2020-07-02T18:18:02Z", "path": "docs/reference/modules/cluster/misc.asciidoc", "diffHunk": "@@ -107,6 +107,13 @@ increase it if you expect nodes to be absent from the cluster and miss more\n than 500 deletes. We think that is rare, thus the default. Tombstones don't take\n up much space, but we also think that a number like 50,000 is probably too big.\n \n+If {es} encounters index data that is absent from the current cluster\n+state, those indices are considered to be dangling. For example,\n+this can happen if you delete more than\n+`cluster.indices.tombstones.size` indices while an {es} node is offline.\n+You can use the <<dangling-indices-api,Dangling indices API>> to manage\n+this situation.\n+", "originalCommit": "a625812fc4eaf505b194436156643a1ea5c57edb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTUwNjI4OA==", "url": "https://github.com/elastic/elasticsearch/pull/58751#discussion_r449506288", "bodyText": "I've added the same include:: directive from the import dangling API page.", "author": "pugnascotia", "createdAt": "2020-07-03T10:20:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTE5MjkwMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTIwMDY4OQ==", "url": "https://github.com/elastic/elasticsearch/pull/58751#discussion_r449200689", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            This API lets you delete a dangling index. You reference the\n          \n          \n            \n            index by its UUID, which you can find using the\n          \n          \n            \n            <<dangling-indices-list,list API>>. You can also\n          \n          \n            \n            <<dangling-index-import,import>> a dangling index.\n          \n          \n            \n            \n          \n          \n            \n            Deletes a dangling index by referencing its UUID. Use the\n          \n          \n            \n            <<dangling-indices-list,List dangling indices API>> to locate the UUID of an index.", "author": "lockewritesdocs", "createdAt": "2020-07-02T18:34:30Z", "path": "docs/reference/indices/dangling-index-delete.asciidoc", "diffHunk": "@@ -0,0 +1,42 @@\n+[[dangling-index-delete]]\n+=== Delete dangling index API\n+++++\n+<titleabbrev>Delete dangling index</titleabbrev>\n+++++\n+\n+Deletes a dangling index.\n+\n+[[dangling-index-delete-api-request]]\n+==== {api-request-title}\n+\n+[source,console]\n+--------------------------------------------------\n+DELETE /_dangling/<index-uuid>?accept_data_loss=true\n+--------------------------------------------------\n+// TEST[skip:Difficult to set up]\n+\n+[[dangling-index-delete-api-desc]]\n+==== {api-description-title}\n+\n+include::{es-repo-dir}/indices/dangling-indices-list.asciidoc[tag=dangling-index-description]\n+\n+This API lets you delete a dangling index. You reference the\n+index by its UUID, which you can find using the\n+<<dangling-indices-list,list API>>. You can also\n+<<dangling-index-import,import>> a dangling index.", "originalCommit": "a625812fc4eaf505b194436156643a1ea5c57edb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTIwMDg5Ng==", "url": "https://github.com/elastic/elasticsearch/pull/58751#discussion_r449200896", "bodyText": "This change isn't necessary, but I think focuses more on the API function.", "author": "lockewritesdocs", "createdAt": "2020-07-02T18:34:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTIwMDY4OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTIwMTQ1Mg==", "url": "https://github.com/elastic/elasticsearch/pull/58751#discussion_r449201452", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            UUID of the index to import. You can find this using the\n          \n          \n            \n            <<dangling-indices-list,list API>>.\n          \n          \n            \n            UUID of the index to import, which you can find using the\n          \n          \n            \n            <<dangling-indices-list,List dangling indices API>>.", "author": "lockewritesdocs", "createdAt": "2020-07-02T18:36:07Z", "path": "docs/reference/indices/dangling-index-import.asciidoc", "diffHunk": "@@ -0,0 +1,44 @@\n+[[dangling-index-import]]\n+=== Import dangling index API\n+++++\n+<titleabbrev>Import dangling index</titleabbrev>\n+++++\n+\n+Imports a dangling index.\n+\n+[[dangling-index-import-api-request]]\n+==== {api-request-title}\n+\n+[source,console]\n+--------------------------------------------------\n+POST /_dangling/<index-uuid>?accept_data_loss=true\n+--------------------------------------------------\n+// TEST[skip:Difficult to set up]\n+\n+[[dangling-index-import-api-desc]]\n+==== {api-description-title}\n+\n+include::{es-repo-dir}/indices/dangling-indices-list.asciidoc[tag=dangling-index-description]\n+\n+This API lets you import a single index into the cluster. You reference the\n+index by its UUID, which you can find using the\n+<<dangling-indices-list,list API>>. You can also\n+<<dangling-index-delete,delete>> a dangling index.\n+\n+[[dangling-index-import-api-path-params]]\n+==== {api-path-parms-title}\n+\n+`<index-uuid>`::\n+(Required, string)\n+UUID of the index to import. You can find this using the\n+<<dangling-indices-list,list API>>.", "originalCommit": "a625812fc4eaf505b194436156643a1ea5c57edb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTIwMzA4Nw==", "url": "https://github.com/elastic/elasticsearch/pull/58751#discussion_r449203087", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            This field must be set to `true` in order to carry out the import. {es}\n          \n          \n            \n            does not know where the dangling index data came from, nor does it know which shard copies are fresh and which are stale,\n          \n          \n            \n            so it can offer no guarantees about the data being\n          \n          \n            \n            imported.\n          \n          \n            \n            This field must be set to `true` to import a dangling index. Because {es}\n          \n          \n            \n            cannot know where the dangling index data came from or determine which shard copies are fresh and which are stale,\n          \n          \n            \n            it cannot guarantee the data being\n          \n          \n            \n            imported.", "author": "lockewritesdocs", "createdAt": "2020-07-02T18:39:41Z", "path": "docs/reference/indices/dangling-index-import.asciidoc", "diffHunk": "@@ -0,0 +1,44 @@\n+[[dangling-index-import]]\n+=== Import dangling index API\n+++++\n+<titleabbrev>Import dangling index</titleabbrev>\n+++++\n+\n+Imports a dangling index.\n+\n+[[dangling-index-import-api-request]]\n+==== {api-request-title}\n+\n+[source,console]\n+--------------------------------------------------\n+POST /_dangling/<index-uuid>?accept_data_loss=true\n+--------------------------------------------------\n+// TEST[skip:Difficult to set up]\n+\n+[[dangling-index-import-api-desc]]\n+==== {api-description-title}\n+\n+include::{es-repo-dir}/indices/dangling-indices-list.asciidoc[tag=dangling-index-description]\n+\n+This API lets you import a single index into the cluster. You reference the\n+index by its UUID, which you can find using the\n+<<dangling-indices-list,list API>>. You can also\n+<<dangling-index-delete,delete>> a dangling index.\n+\n+[[dangling-index-import-api-path-params]]\n+==== {api-path-parms-title}\n+\n+`<index-uuid>`::\n+(Required, string)\n+UUID of the index to import. You can find this using the\n+<<dangling-indices-list,list API>>.\n+\n+[[dangling-index-import-api-query-params]]\n+==== {api-query-parms-title}\n+\n+`accept_data_loss`::\n+(Required, boolean)\n+This field must be set to `true` in order to carry out the import. {es}\n+does not know where the dangling index data came from, nor does it know which shard copies are fresh and which are stale,\n+so it can offer no guarantees about the data being\n+imported.", "originalCommit": "a625812fc4eaf505b194436156643a1ea5c57edb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTIwNzUwNQ==", "url": "https://github.com/elastic/elasticsearch/pull/58751#discussion_r449207505", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            shards to be \"dangling\". You can automatically import dangling indices\n          \n          \n            \n            into the cluster using the following setting, however this is not safe, and\n          \n          \n            \n            you should use the <<dangling-indices-api,Dangling indices API>> instead.\n          \n          \n            \n            shards to be \"dangling\". Importing dangling indices\n          \n          \n            \n            into the cluster using `gateway.auto_import_dangling_indices` is not safe. \n          \n          \n            \n            Instead, use the <<dangling-indices-api,Dangling indices API>>.", "author": "lockewritesdocs", "createdAt": "2020-07-02T18:49:14Z", "path": "docs/reference/modules/gateway.asciidoc", "diffHunk": "@@ -56,9 +56,22 @@ NOTE: These settings only take effect on a full cluster restart.\n [[dangling-indices]]\n ==== Dangling indices\n \n-When a node joins the cluster, any shards stored in its local data\n-directory which do not already exist in the cluster will be imported into the\n-cluster. This functionality is intended as a best effort to help users who\n-lose all master nodes. If a new master node is started which is unaware of\n-the other indices in the cluster, adding the old nodes will cause the old\n-indices to be imported, instead of being deleted.\n+When a node joins the cluster, if it finds any shards stored in its local data\n+directory that do not already exist in the cluster, it will consider those\n+shards to be \"dangling\". You can automatically import dangling indices\n+into the cluster using the following setting, however this is not safe, and\n+you should use the <<dangling-indices-api,Dangling indices API>> instead.", "originalCommit": "a625812fc4eaf505b194436156643a1ea5c57edb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTIwNzc3Mw==", "url": "https://github.com/elastic/elasticsearch/pull/58751#discussion_r449207773", "bodyText": "I think that this revision is more strongly worded and indicates that users should definitely avoid this setting in favor of the API.", "author": "lockewritesdocs", "createdAt": "2020-07-02T18:49:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTIwNzUwNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTQwMTg4Ng==", "url": "https://github.com/elastic/elasticsearch/pull/58751#discussion_r449401886", "bodyText": "I'm a bit confused by the \"this is not safe\". Without further qualification, this would leave a reader puzzled as well.", "author": "ywelsch", "createdAt": "2020-07-03T06:37:40Z", "path": "docs/reference/modules/gateway.asciidoc", "diffHunk": "@@ -56,9 +56,22 @@ NOTE: These settings only take effect on a full cluster restart.\n [[dangling-indices]]\n ==== Dangling indices\n \n-When a node joins the cluster, any shards stored in its local data\n-directory which do not already exist in the cluster will be imported into the\n-cluster. This functionality is intended as a best effort to help users who\n-lose all master nodes. If a new master node is started which is unaware of\n-the other indices in the cluster, adding the old nodes will cause the old\n-indices to be imported, instead of being deleted.\n+When a node joins the cluster, if it finds any shards stored in its local data\n+directory that do not already exist in the cluster, it will consider those\n+shards to be \"dangling\". You can automatically import dangling indices\n+into the cluster using the following setting, however this is not safe, and", "originalCommit": "a625812fc4eaf505b194436156643a1ea5c57edb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTQwMzg0Mg==", "url": "https://github.com/elastic/elasticsearch/pull/58751#discussion_r449403842", "bodyText": "I'm wondering if we should add that that scenario (losing all master nodes) should be avoided at all cost, as it puts the cluster's metadata and data at risk. Also worth pointing out above (when talking about \"this is not safe\") that importing dangling indices does not provide any guarantees as to whether the data that's imported truly represents the latest state of the data as it was when the index was still part of the cluster.", "author": "ywelsch", "createdAt": "2020-07-03T06:42:58Z", "path": "docs/reference/modules/gateway.asciidoc", "diffHunk": "@@ -56,9 +56,22 @@ NOTE: These settings only take effect on a full cluster restart.\n [[dangling-indices]]\n ==== Dangling indices\n \n-When a node joins the cluster, any shards stored in its local data\n-directory which do not already exist in the cluster will be imported into the\n-cluster. This functionality is intended as a best effort to help users who\n-lose all master nodes. If a new master node is started which is unaware of\n-the other indices in the cluster, adding the old nodes will cause the old\n-indices to be imported, instead of being deleted.\n+When a node joins the cluster, if it finds any shards stored in its local data\n+directory that do not already exist in the cluster, it will consider those\n+shards to be \"dangling\". You can automatically import dangling indices\n+into the cluster using the following setting, however this is not safe, and\n+you should use the <<dangling-indices-api,Dangling indices API>> instead.\n+\n+`gateway.auto_import_dangling_indices`::\n+\n+    deprecated:[7.9.0, This setting will be removed in 8.0. You should use the dedicated dangling indices API instead.]\n+    Whether to automatically import dangling indices into the cluster\n+    state, provided no indices already exist with the same name. Defaults\n+    to `false`.\n+\n+WARNING: The auto-import functionality was intended as a best effort to help users\n+who lose all master nodes. For example, if a new master node were to be", "originalCommit": "a625812fc4eaf505b194436156643a1ea5c57edb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTUwNjU0Mw==", "url": "https://github.com/elastic/elasticsearch/pull/58751#discussion_r449506543", "bodyText": "@ywelsch I've reworked the text to and address your points.", "author": "pugnascotia", "createdAt": "2020-07-03T10:21:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTQwMzg0Mg=="}], "type": "inlineReview"}, {"oid": "8135376508301adff02a7757c11747a7e9956d36", "url": "https://github.com/elastic/elasticsearch/commit/8135376508301adff02a7757c11747a7e9956d36", "message": "Apply suggestions from code review\n\nCo-authored-by: Adam Locke <adam.locke@elastic.co>", "committedDate": "2020-07-03T08:53:46Z", "type": "commit"}, {"oid": "5188297ca89e893a7145406420ffefab0e22253b", "url": "https://github.com/elastic/elasticsearch/commit/5188297ca89e893a7145406420ffefab0e22253b", "message": "Reference snippet instead of duplicating content", "committedDate": "2020-07-03T09:20:51Z", "type": "commit"}, {"oid": "5bd84b5598520eec18fb78cf780f1bd33281e19d", "url": "https://github.com/elastic/elasticsearch/commit/5bd84b5598520eec18fb78cf780f1bd33281e19d", "message": "Strengthen warnings around dangling index imports", "committedDate": "2020-07-03T09:32:46Z", "type": "commit"}, {"oid": "873d8651c88b159ec6024306f8fb3615414766c9", "url": "https://github.com/elastic/elasticsearch/commit/873d8651c88b159ec6024306f8fb3615414766c9", "message": "Add an example of importing an dangling index", "committedDate": "2020-07-03T10:17:12Z", "type": "commit"}, {"oid": "6c931a8f32f1bc2e5151923923142794c5b560cb", "url": "https://github.com/elastic/elasticsearch/commit/6c931a8f32f1bc2e5151923923142794c5b560cb", "message": "Add missing params to delete page", "committedDate": "2020-07-03T10:18:45Z", "type": "commit"}, {"oid": "f0b53eb2bbd9472af52969621f7d52f444c942af", "url": "https://github.com/elastic/elasticsearch/commit/f0b53eb2bbd9472af52969621f7d52f444c942af", "message": "Typo", "committedDate": "2020-07-03T10:19:43Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTUwNzA2Mw==", "url": "https://github.com/elastic/elasticsearch/pull/58751#discussion_r449507063", "bodyText": "@lockewritesdocs Is it overkill to have two WARNING: sections? I felt that they were making separate points, and all the content here ought to be scary.", "author": "pugnascotia", "createdAt": "2020-07-03T10:22:14Z", "path": "docs/reference/modules/gateway.asciidoc", "diffHunk": "@@ -56,9 +56,29 @@ NOTE: These settings only take effect on a full cluster restart.\n [[dangling-indices]]\n ==== Dangling indices\n \n-When a node joins the cluster, any shards stored in its local data\n-directory which do not already exist in the cluster will be imported into the\n-cluster. This functionality is intended as a best effort to help users who\n-lose all master nodes. If a new master node is started which is unaware of\n-the other indices in the cluster, adding the old nodes will cause the old\n-indices to be imported, instead of being deleted.\n+When a node joins the cluster, if it finds any shards stored in its local data\n+directory that do not already exist in the cluster, it will consider those\n+shards to be \"dangling\". Importing dangling indices\n+into the cluster using `gateway.auto_import_dangling_indices` is not safe.\n+Instead, use the <<dangling-indices-api,Dangling indices API>>. Neither\n+mechanism provides any guarantees as to whether the imported data truly\n+represents the latest state of the data when the index was still part of\n+the cluster.\n+\n+`gateway.auto_import_dangling_indices`::\n+\n+    deprecated:[7.9.0, This setting will be removed in 8.0. You should use the dedicated dangling indices API instead.]\n+    Whether to automatically import dangling indices into the cluster\n+    state, provided no indices already exist with the same name. Defaults\n+    to `false`.\n+\n+WARNING: The auto-import functionality was intended as a best effort to help users\n+who lose all master nodes. For example, if a new master node were to be\n+started which was unaware of the other indices in the cluster, adding the\n+old nodes would cause the old indices to be imported, instead of being\n+deleted. However there are several issues with automatic importing, and\n+its use is strongly discouraged in favour of the\n+<<dangling-indices-api,dedicated API>.\n+\n+WARNING: Losing all master nodes is a situation that should be avoided at", "originalCommit": "f0b53eb2bbd9472af52969621f7d52f444c942af", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}