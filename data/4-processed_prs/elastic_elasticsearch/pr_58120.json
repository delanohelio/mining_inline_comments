{"pr_number": 58120, "pr_title": "Document supported scenarios for CCS", "pr_createdAt": "2020-06-15T15:13:08Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/58120", "timeline": [{"oid": "5f79e03331d998a91cf0cc7311eeaf2b98c73b3f", "url": "https://github.com/elastic/elasticsearch/commit/5f79e03331d998a91cf0cc7311eeaf2b98c73b3f", "message": "Document supported scenarios for CCS\n\nAdds a table documenting the \"shape\" of the versions that we support for\nCCS. In particular, we don't support \"chaining\" across major versions.\n\nRelates to #54375", "committedDate": "2020-06-15T15:12:04Z", "type": "commit"}, {"oid": "97e9bf42a7860a2d6e2735ce0556f3ae80f6f2dd", "url": "https://github.com/elastic/elasticsearch/commit/97e9bf42a7860a2d6e2735ce0556f3ae80f6f2dd", "message": "Compile plz", "committedDate": "2020-06-15T16:59:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDkwODMwOA==", "url": "https://github.com/elastic/elasticsearch/pull/58120#discussion_r440908308", "bodyText": "I wonder if we should rather start with talking about clusters rather than nodes, and mostly leave gateway nodes out to begin with. I think talking about nodes may tempt users to have different versions in the same cluster on purpose to use CCS in some unsupported way. I would start describing the scenario that we supported with three versions, where the middle one is the CCS cluster that may or may not have data. Then I would expand talking about edge cases, meaning rolling upgrades hence different versions within the same cluster, hence gateway nodes and what may or may not happen.", "author": "javanna", "createdAt": "2020-06-16T14:45:42Z", "path": "docs/reference/modules/cross-cluster-search.asciidoc", "diffHunk": "@@ -372,3 +372,42 @@ image:images/ccs/ccs-dont-min-roundtrip-shard-results.svg[]\n final results in the {ccs} response.\n +\n image:images/ccs/ccs-min-roundtrip-client-response.svg[]\n+\n+[float]\n+[[ccs-supported-configurations]]\n+==== Supported configurations\n+\n+<<gateway-nodes-selection, Remote clusters>> shows which versions can talk\n+to which other versions but there are at least three nodes involved The\n+\"coordinating node\" receives your search request and sends it to a\n+\"gateway node\" in each cluster. The \"gateway nodes\" in turn send your search\n+request to \"data nodes\" that have a copy of the shards.\n+\n+During a <<rolling-upgrades, rolling upgrade>> all three nodes could be running\n+a different version of Elasticsearch! This is supported *but* it gets less\n+testing than the more common scenarios where the remote cluster is on the same\n+version. Everything should work either way, but don't tempt fate, ok?", "originalCommit": "97e9bf42a7860a2d6e2735ce0556f3ae80f6f2dd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDk3MDM2Ng==", "url": "https://github.com/elastic/elasticsearch/pull/58120#discussion_r440970366", "bodyText": "I think I understand what you are asking for. I'll give it a shot!", "author": "nik9000", "createdAt": "2020-06-16T16:07:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDkwODMwOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTg0MDM2Nw==", "url": "https://github.com/elastic/elasticsearch/pull/58120#discussion_r445840367", "bodyText": "+1, I like the idea of describing in terms of clusters (instead of nodes) too, easier to understand.", "author": "zuketo", "createdAt": "2020-06-25T21:11:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDkwODMwOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDQ4MDc4Mw==", "url": "https://github.com/elastic/elasticsearch/pull/58120#discussion_r440480783", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            to which other versions but there are at least three nodes involved The\n          \n          \n            \n            to which other versions but there are at least three nodes involved. The", "author": "mark-vieira", "createdAt": "2020-06-15T22:25:48Z", "path": "docs/reference/modules/cross-cluster-search.asciidoc", "diffHunk": "@@ -372,3 +372,42 @@ image:images/ccs/ccs-dont-min-roundtrip-shard-results.svg[]\n final results in the {ccs} response.\n +\n image:images/ccs/ccs-min-roundtrip-client-response.svg[]\n+\n+[float]\n+[[ccs-supported-configurations]]\n+==== Supported configurations\n+\n+<<gateway-nodes-selection, Remote clusters>> shows which versions can talk\n+to which other versions but there are at least three nodes involved The", "originalCommit": "97e9bf42a7860a2d6e2735ce0556f3ae80f6f2dd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDQ4MTk4MQ==", "url": "https://github.com/elastic/elasticsearch/pull/58120#discussion_r440481981", "bodyText": "Should we clarify what we mean by \"during the upgrade\"?", "author": "mark-vieira", "createdAt": "2020-06-15T22:29:08Z", "path": "docs/reference/modules/cross-cluster-search.asciidoc", "diffHunk": "@@ -372,3 +372,42 @@ image:images/ccs/ccs-dont-min-roundtrip-shard-results.svg[]\n final results in the {ccs} response.\n +\n image:images/ccs/ccs-min-roundtrip-client-response.svg[]\n+\n+[float]\n+[[ccs-supported-configurations]]\n+==== Supported configurations\n+\n+<<gateway-nodes-selection, Remote clusters>> shows which versions can talk\n+to which other versions but there are at least three nodes involved The\n+\"coordinating node\" receives your search request and sends it to a\n+\"gateway node\" in each cluster. The \"gateway nodes\" in turn send your search\n+request to \"data nodes\" that have a copy of the shards.\n+\n+During a <<rolling-upgrades, rolling upgrade>> all three nodes could be running\n+a different version of Elasticsearch! This is supported *but* it gets less\n+testing than the more common scenarios where the remote cluster is on the same\n+version. Everything should work either way, but don't tempt fate, ok?\n+\n+Here are some examples:\n+\n+[cols=\"^,^,^,^\"]\n+|====\n+| Coordinating Node | Gateway Node | Data Node | Supported\n+| 7.8.0             | 7.3.0        | 7.3.0     | Yes\n+| 7.3.0             | 7.8.0        | 7.8.0     | Yes\n+| 7.8.0             | 6.8.10       | 6.8.10    | Yes\n+| 6.8.10            | 7.8.0        | 7.8.0     | Yes\n+| 7.8.0             | 7.3.0        | 7.8.0     | During the upgrade", "originalCommit": "97e9bf42a7860a2d6e2735ce0556f3ae80f6f2dd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTg0MTg0NQ==", "url": "https://github.com/elastic/elasticsearch/pull/58120#discussion_r445841845", "bodyText": "How about we remove the \"During the upgrade\" rows, and add a note below the table about our upgrade guarantees? Less rows in the table will make it easier to view.", "author": "zuketo", "createdAt": "2020-06-25T21:14:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDQ4MTk4MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDQ4MjczOQ==", "url": "https://github.com/elastic/elasticsearch/pull/58120#discussion_r440482739", "bodyText": "Would it be better to refer to version ranges like we do for the remote cluster compatibility table rather than concrete versions that are likely to be constantly changing?", "author": "mark-vieira", "createdAt": "2020-06-15T22:31:07Z", "path": "docs/reference/modules/cross-cluster-search.asciidoc", "diffHunk": "@@ -372,3 +372,42 @@ image:images/ccs/ccs-dont-min-roundtrip-shard-results.svg[]\n final results in the {ccs} response.\n +\n image:images/ccs/ccs-min-roundtrip-client-response.svg[]\n+\n+[float]\n+[[ccs-supported-configurations]]\n+==== Supported configurations\n+\n+<<gateway-nodes-selection, Remote clusters>> shows which versions can talk\n+to which other versions but there are at least three nodes involved The\n+\"coordinating node\" receives your search request and sends it to a\n+\"gateway node\" in each cluster. The \"gateway nodes\" in turn send your search\n+request to \"data nodes\" that have a copy of the shards.\n+\n+During a <<rolling-upgrades, rolling upgrade>> all three nodes could be running\n+a different version of Elasticsearch! This is supported *but* it gets less\n+testing than the more common scenarios where the remote cluster is on the same\n+version. Everything should work either way, but don't tempt fate, ok?\n+\n+Here are some examples:\n+\n+[cols=\"^,^,^,^\"]\n+|====\n+| Coordinating Node | Gateway Node | Data Node | Supported", "originalCommit": "97e9bf42a7860a2d6e2735ce0556f3ae80f6f2dd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDk3MDY3NQ==", "url": "https://github.com/elastic/elasticsearch/pull/58120#discussion_r440970675", "bodyText": "I probably should, but I don't think this example will be exhaustive.", "author": "nik9000", "createdAt": "2020-06-16T16:07:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDQ4MjczOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTg0MjYzMw==", "url": "https://github.com/elastic/elasticsearch/pull/58120#discussion_r445842633", "bodyText": "Can we sort the table by the first column, will just make it easier to read", "author": "zuketo", "createdAt": "2020-06-25T21:15:55Z", "path": "docs/reference/modules/cross-cluster-search.asciidoc", "diffHunk": "@@ -372,3 +372,42 @@ image:images/ccs/ccs-dont-min-roundtrip-shard-results.svg[]\n final results in the {ccs} response.\n +\n image:images/ccs/ccs-min-roundtrip-client-response.svg[]\n+\n+[float]\n+[[ccs-supported-configurations]]\n+==== Supported configurations\n+\n+<<gateway-nodes-selection, Remote clusters>> shows which versions can talk\n+to which other versions but there are at least three nodes involved. The\n+\"coordinating node\" receives your search request and sends it to a\n+\"gateway node\" in each cluster. The \"gateway nodes\" in turn send your search\n+request to \"data nodes\" that have a copy of the shards.\n+\n+During a <<rolling-upgrades, rolling upgrade>> all three nodes could be running\n+a different version of Elasticsearch! This is supported *but* it gets less\n+testing than the more common scenarios where the remote cluster is on the same\n+version. Everything should work either way, but don't tempt fate, ok?\n+\n+Here are some examples:\n+\n+[cols=\"^,^,^,^\"]\n+|====\n+| Coordinating Node | Gateway Node | Data Node | Supported", "originalCommit": "318c265e79bb228bfca880b361c05a2b237f31e1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "5027a9109f039e71d6d6f7a2df01f80f4b6cd60f", "url": "https://github.com/elastic/elasticsearch/commit/5027a9109f039e71d6d6f7a2df01f80f4b6cd60f", "message": "Merge branch 'master' into dont_tempt_fate_with_ccs", "committedDate": "2020-07-06T14:15:42Z", "type": "commit"}, {"oid": "e2e0b7a65d1974170850fefe0a02e661e54d152c", "url": "https://github.com/elastic/elasticsearch/commit/e2e0b7a65d1974170850fefe0a02e661e54d152c", "message": "Rewrite in terms of clusters", "committedDate": "2020-07-06T14:27:53Z", "type": "commit"}, {"oid": "e2e0b7a65d1974170850fefe0a02e661e54d152c", "url": "https://github.com/elastic/elasticsearch/commit/e2e0b7a65d1974170850fefe0a02e661e54d152c", "message": "Rewrite in terms of clusters", "committedDate": "2020-07-06T14:27:53Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzg4NDA4MA==", "url": "https://github.com/elastic/elasticsearch/pull/58120#discussion_r453884080", "bodyText": "gateway nodes ? gateway does not need to be plural I guess", "author": "javanna", "createdAt": "2020-07-13T19:33:45Z", "path": "docs/reference/modules/cross-cluster-search.asciidoc", "diffHunk": "@@ -372,3 +372,16 @@ image:images/ccs/ccs-dont-min-roundtrip-shard-results.svg[]\n final results in the {ccs} response.\n +\n image:images/ccs/ccs-min-roundtrip-client-response.svg[]\n+\n+[float]\n+[[ccs-supported-configurations]]\n+==== Supported configurations\n+\n+<<gateway-nodes-selection, Generally>> a gateway node can search remote\n+clusters that are one major version ahead or behind the gateway node's version.\n+Gateways nodes can also search remote clusters that are being", "originalCommit": "e2e0b7a65d1974170850fefe0a02e661e54d152c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjYwNTcwOA==", "url": "https://github.com/elastic/elasticsearch/pull/58120#discussion_r456605708", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            <<gateway-nodes-selection, Generally>> a gateway node can search remote\n          \n          \n            \n            Generally, <<gateway-nodes-selection,gateway node>> can search remote", "author": "lockewritesdocs", "createdAt": "2020-07-17T18:26:27Z", "path": "docs/reference/modules/cross-cluster-search.asciidoc", "diffHunk": "@@ -372,3 +372,16 @@ image:images/ccs/ccs-dont-min-roundtrip-shard-results.svg[]\n final results in the {ccs} response.\n +\n image:images/ccs/ccs-min-roundtrip-client-response.svg[]\n+\n+[float]\n+[[ccs-supported-configurations]]\n+==== Supported configurations\n+\n+<<gateway-nodes-selection, Generally>> a gateway node can search remote", "originalCommit": "e2e0b7a65d1974170850fefe0a02e661e54d152c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjYwNTgzOQ==", "url": "https://github.com/elastic/elasticsearch/pull/58120#discussion_r456605839", "bodyText": "Suggest putting the link on \"gateway node\".", "author": "lockewritesdocs", "createdAt": "2020-07-17T18:26:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjYwNTcwOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjYxMDUzMw==", "url": "https://github.com/elastic/elasticsearch/pull/58120#discussion_r456610533", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            [float]\n          \n          \n            \n            [[ccs-supported-configurations]]\n          \n          \n            \n            ==== Supported configurations\n          \n          \n            \n            [discrete]\n          \n          \n            \n            [[ccs-supported-configurations]]\n          \n          \n            \n            === Supported configurations", "author": "lockewritesdocs", "createdAt": "2020-07-17T18:36:09Z", "path": "docs/reference/modules/cross-cluster-search.asciidoc", "diffHunk": "@@ -372,3 +372,16 @@ image:images/ccs/ccs-dont-min-roundtrip-shard-results.svg[]\n final results in the {ccs} response.\n +\n image:images/ccs/ccs-min-roundtrip-client-response.svg[]\n+\n+[float]\n+[[ccs-supported-configurations]]\n+==== Supported configurations", "originalCommit": "e2e0b7a65d1974170850fefe0a02e661e54d152c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjYxMDk1Nw==", "url": "https://github.com/elastic/elasticsearch/pull/58120#discussion_r456610957", "bodyText": "Suggest changing the heading to level 3 === so that the section displays in the right-hand navigation. Otherwise, users have to scroll all the way to the bottom of this page.", "author": "lockewritesdocs", "createdAt": "2020-07-17T18:37:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjYxMDUzMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjYxMzY4Mw==", "url": "https://github.com/elastic/elasticsearch/pull/58120#discussion_r456613683", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \n          \n          \n            \n            For example, a gateway node running {es} 6.0 can search a remote cluster running {es} 7.0, but cannot search a remote cluster running {es} 7.1.", "author": "lockewritesdocs", "createdAt": "2020-07-17T18:42:53Z", "path": "docs/reference/modules/cross-cluster-search.asciidoc", "diffHunk": "@@ -372,3 +372,16 @@ image:images/ccs/ccs-dont-min-roundtrip-shard-results.svg[]\n final results in the {ccs} response.\n +\n image:images/ccs/ccs-min-roundtrip-client-response.svg[]\n+\n+[float]\n+[[ccs-supported-configurations]]\n+==== Supported configurations\n+\n+<<gateway-nodes-selection, Generally>> a gateway node can search remote\n+clusters that are one major version ahead or behind the gateway node's version.\n+Gateways nodes can also search remote clusters that are being\n+<<rolling-upgrades, upgraded>> so long as both the \"upgrade from\" and\n+\"upgrade to\" version are compatible with the gateway node.\n+", "originalCommit": "e2e0b7a65d1974170850fefe0a02e661e54d152c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjYxNDAxOA==", "url": "https://github.com/elastic/elasticsearch/pull/58120#discussion_r456614018", "bodyText": "I think that an explicit example is helpful to clarify the previous statement. Something along these lines \u261d\ufe0f", "author": "lockewritesdocs", "createdAt": "2020-07-17T18:43:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjYxMzY4Mw=="}], "type": "inlineReview"}, {"oid": "de16c6054c74255e179b5eb7ac85b7a460cc37e9", "url": "https://github.com/elastic/elasticsearch/commit/de16c6054c74255e179b5eb7ac85b7a460cc37e9", "message": "Apply suggestions from code review\n\nCo-authored-by: Adam Locke <adam.locke@elastic.co>", "committedDate": "2020-07-20T12:58:44Z", "type": "commit"}, {"oid": "ec29bdb9cf427ad061b986bea09d204f1a5719be", "url": "https://github.com/elastic/elasticsearch/commit/ec29bdb9cf427ad061b986bea09d204f1a5719be", "message": "iter", "committedDate": "2020-07-20T13:01:41Z", "type": "commit"}, {"oid": "8234dc8279139c024cccd245970816c01d2b7110", "url": "https://github.com/elastic/elasticsearch/commit/8234dc8279139c024cccd245970816c01d2b7110", "message": "Rework example", "committedDate": "2020-07-20T13:28:47Z", "type": "commit"}, {"oid": "b61290470ec9aacc419607eb0e905502c6d55c9a", "url": "https://github.com/elastic/elasticsearch/commit/b61290470ec9aacc419607eb0e905502c6d55c9a", "message": "EXAMPLE", "committedDate": "2020-07-20T13:45:37Z", "type": "commit"}]}