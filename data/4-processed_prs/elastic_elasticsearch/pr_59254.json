{"pr_number": 59254, "pr_title": "[ML] Data frame analytics max_num_threads setting", "pr_createdAt": "2020-07-08T20:45:00Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/59254", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTgyMjcyNg==", "url": "https://github.com/elastic/elasticsearch/pull/59254#discussion_r451822726", "bodyText": "since it is being serialized as vint, a validation should be made that it is  >= 0", "author": "benwtrent", "createdAt": "2020-07-08T21:01:02Z", "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/dataframe/DataFrameAnalyticsConfigUpdate.java", "diffHunk": "@@ -33,29 +34,37 @@\n             DataFrameAnalyticsConfig.MODEL_MEMORY_LIMIT,\n             VALUE);\n         PARSER.declareBoolean(Builder::setAllowLazyStart, DataFrameAnalyticsConfig.ALLOW_LAZY_START);\n-\n+        PARSER.declareInt(Builder::setMaxNumThreads, DataFrameAnalyticsConfig.MAX_NUM_THREADS);\n     }\n \n     private final String id;\n     private final String description;\n     private final ByteSizeValue modelMemoryLimit;\n     private final Boolean allowLazyStart;\n+    private final Integer maxNumThreads;\n \n     private DataFrameAnalyticsConfigUpdate(String id,\n                                            @Nullable String description,\n                                            @Nullable ByteSizeValue modelMemoryLimit,\n-                                           @Nullable Boolean allowLazyStart) {\n+                                           @Nullable Boolean allowLazyStart,\n+                                           @Nullable Integer maxNumThreads) {\n         this.id = id;\n         this.description = description;\n         this.modelMemoryLimit = modelMemoryLimit;\n         this.allowLazyStart = allowLazyStart;\n+        this.maxNumThreads = maxNumThreads;", "originalCommit": "4491a5102121fb4b94c4b11440a3035b2143d1a7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTgyMzU4MA==", "url": "https://github.com/elastic/elasticsearch/pull/59254#discussion_r451823580", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              - m atch: { dest.index: \"index-dest\" }\n          \n          \n            \n              - match: { dest.index: \"index-dest\" }", "author": "benwtrent", "createdAt": "2020-07-08T21:02:39Z", "path": "x-pack/plugin/src/test/resources/rest-api-spec/test/ml/data_frame_analytics_crud.yml", "diffHunk": "@@ -199,7 +199,7 @@ setup:\n   - match: { id: \"custom-outlier-detection\" }\n   - match: { source.index: [\"index-source\"] }\n   - match: { source.query: {\"match_all\" : {} } }\n-  - match: { dest.index: \"index-dest\" }\n+  - m atch: { dest.index: \"index-dest\" }", "originalCommit": "4491a5102121fb4b94c4b11440a3035b2143d1a7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjEzNTUyMA==", "url": "https://github.com/elastic/elasticsearch/pull/59254#discussion_r452135520", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            <8> The max number of threads to be used by the analysis. Defaults to 1.\n          \n          \n            \n            <8> The maximum number of threads to be used by the analysis. Defaults to 1.", "author": "przemekwitek", "createdAt": "2020-07-09T10:59:11Z", "path": "docs/java-rest/high-level/ml/put-data-frame-analytics.asciidoc", "diffHunk": "@@ -38,6 +38,7 @@ include-tagged::{doc-tests-file}[{api}-config]\n <5> The fields to be included in / excluded from the analysis\n <6> The memory limit for the model created as part of the analysis process\n <7> Optionally, a human-readable description\n+<8> The max number of threads to be used by the analysis. Defaults to 1.", "originalCommit": "776af53e73aed06dd0bfba63a02bb317d440084b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjEzNTc2MQ==", "url": "https://github.com/elastic/elasticsearch/pull/59254#discussion_r452135761", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            <4> The max number of threads to be used by the analysis\n          \n          \n            \n            <4> The maximum number of threads to be used by the analysis", "author": "przemekwitek", "createdAt": "2020-07-09T10:59:36Z", "path": "docs/java-rest/high-level/ml/update-data-frame-analytics.asciidoc", "diffHunk": "@@ -34,6 +34,7 @@ include-tagged::{doc-tests-file}[{api}-config-update]\n <1> The {dfanalytics-job} ID\n <2> The human-readable description\n <3> The memory limit for the model created as part of the analysis process\n+<4> The max number of threads to be used by the analysis", "originalCommit": "776af53e73aed06dd0bfba63a02bb317d440084b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjEzNTk5NQ==", "url": "https://github.com/elastic/elasticsearch/pull/59254#discussion_r452135995", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Note that the process may use a additional threads for operational\n          \n          \n            \n            Note that the process may use additional threads for operational", "author": "przemekwitek", "createdAt": "2020-07-09T11:00:05Z", "path": "docs/reference/ml/df-analytics/apis/put-dfanalytics.asciidoc", "diffHunk": "@@ -326,6 +326,14 @@ include::{es-repo-dir}/ml/ml-shared.asciidoc[tag=description-dfa]\n `dest`::\n (Required, object)\n include::{es-repo-dir}/ml/ml-shared.asciidoc[tag=dest]\n+\n+`max_num_threads`::\n+(Optional, integer)\n+The maximum number of threads to be used by the analysis.\n+The default value is `1`. Using more threads may decrease the time\n+necessary to complete the analysis at the cost of using more CPU.\n+Note that the process may use a additional threads for operational", "originalCommit": "776af53e73aed06dd0bfba63a02bb317d440084b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjEzNjIxNQ==", "url": "https://github.com/elastic/elasticsearch/pull/59254#discussion_r452136215", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Note that the process may use a additional threads for operational\n          \n          \n            \n            Note that the process may use additional threads for operational", "author": "przemekwitek", "createdAt": "2020-07-09T11:00:29Z", "path": "docs/reference/ml/df-analytics/apis/update-dfanalytics.asciidoc", "diffHunk": "@@ -71,6 +71,14 @@ the `starting` state until sufficient {ml} node capacity is available.\n (Optional, string)\n include::{es-repo-dir}/ml/ml-shared.asciidoc[tag=description-dfa]\n \n+`max_num_threads`::\n+(Optional, integer)\n+The maximum number of threads to be used by the analysis.\n+The default value is `1`. Using more threads may decrease the time\n+necessary to complete the analysis at the cost of using more CPU.\n+Note that the process may use a additional threads for operational", "originalCommit": "776af53e73aed06dd0bfba63a02bb317d440084b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e715406920f992a9a2c84fc85b45ae860666fb10", "url": "https://github.com/elastic/elasticsearch/commit/e715406920f992a9a2c84fc85b45ae860666fb10", "message": "[ML] Data frame analytics max_number_threads setting\n\nThis adds a setting to data frame analytics jobs called\n`max_number_threads`. The setting expects a positive integer.\nWhen used the user specifies the max number of threads that may\nbe used by the analysis. Note that the actual number of threads\nused is limited by the number of processors on the node where\nthe job is assigned. Also, the process may use a couple more threads\nfor operational functionality that is not the analysis itself.\n\nThis setting may also be updated for a stopped job.\n\nMore threads may reduce the time it takes to complete the job at the cost\nof using more CPU.", "committedDate": "2020-07-09T12:42:20Z", "type": "commit"}, {"oid": "807a53ed393972541324b480238c324f71f0891d", "url": "https://github.com/elastic/elasticsearch/commit/807a53ed393972541324b480238c324f71f0891d", "message": "Fix YAML test and add validation on update", "committedDate": "2020-07-09T12:42:20Z", "type": "commit"}, {"oid": "ada72b853de771eb7f3b10101a39b4457342bf75", "url": "https://github.com/elastic/elasticsearch/commit/ada72b853de771eb7f3b10101a39b4457342bf75", "message": "Fix doc test", "committedDate": "2020-07-09T12:42:20Z", "type": "commit"}, {"oid": "186c86ce7cde294b7ef4a347497c5bf2004f4ec2", "url": "https://github.com/elastic/elasticsearch/commit/186c86ce7cde294b7ef4a347497c5bf2004f4ec2", "message": "Docs should have max_num_threads", "committedDate": "2020-07-09T12:42:20Z", "type": "commit"}, {"oid": "e77dae924f89f8297139564b18b26aa6878487ad", "url": "https://github.com/elastic/elasticsearch/commit/e77dae924f89f8297139564b18b26aa6878487ad", "message": "Rename client update to maxNumThreads", "committedDate": "2020-07-09T12:42:20Z", "type": "commit"}, {"oid": "9e5e9b48b6319d6ce51fc149db58b5582d165bdb", "url": "https://github.com/elastic/elasticsearch/commit/9e5e9b48b6319d6ce51fc149db58b5582d165bdb", "message": "Address more review comments plus add to YAML test", "committedDate": "2020-07-09T13:01:16Z", "type": "commit"}, {"oid": "9e5e9b48b6319d6ce51fc149db58b5582d165bdb", "url": "https://github.com/elastic/elasticsearch/commit/9e5e9b48b6319d6ce51fc149db58b5582d165bdb", "message": "Address more review comments plus add to YAML test", "committedDate": "2020-07-09T13:01:16Z", "type": "forcePushed"}]}