{"pr_number": 56339, "pr_title": "[ML] Ensure phase progress may only increase", "pr_createdAt": "2020-05-07T13:03:27Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/56339", "timeline": [{"oid": "16516b330530d4b3db9160cb86e0921093142873", "url": "https://github.com/elastic/elasticsearch/commit/16516b330530d4b3db9160cb86e0921093142873", "message": "[ML] Ensure phase progress may only increase\n\nDue to multi-threading it is possible that phase progress\nupdates written from the c++ process arrive reordered.\nWe can address this by ensuring that progress may only increase.\n\nCloses #56282", "committedDate": "2020-05-07T12:56:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTQ5NDMxMQ==", "url": "https://github.com/elastic/elasticsearch/pull/56339#discussion_r421494311", "bodyText": "Could you also add the same assertion after line 90?\nThat would make the test stronger.", "author": "przemekwitek", "createdAt": "2020-05-07T13:15:55Z", "path": "x-pack/plugin/ml/src/test/java/org/elasticsearch/xpack/ml/dataframe/stats/ProgressTrackerTests.java", "diffHunk": "@@ -79,4 +79,15 @@ public void testUpdatePhase_GivenUnknownPhase() {\n         assertThat(phases.stream().map(PhaseProgress::getPhase).collect(Collectors.toList()),\n             contains(\"reindexing\", \"loading_data\", \"foo\", \"writing_results\"));\n     }\n+\n+    public void testUpdatePhase_GivenLowerValueThanCurrentProgress() {\n+        ProgressTracker progressTracker = ProgressTracker.fromZeroes(Collections.singletonList(\"foo\"));\n+        progressTracker.updateReindexingProgress(10);\n+\n+        progressTracker.updateReindexingProgress(11);\n+        assertThat(progressTracker.getReindexingProgressPercent(), equalTo(11));", "originalCommit": "16516b330530d4b3db9160cb86e0921093142873", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTUyNjY3OQ==", "url": "https://github.com/elastic/elasticsearch/pull/56339#discussion_r421526679", "bodyText": "Ah! That's what it meant to be. Thanks for spotting!", "author": "dimitris-athanasiou", "createdAt": "2020-05-07T13:59:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTQ5NDMxMQ=="}], "type": "inlineReview"}, {"oid": "24f4542ceaddc14890f71b57de536cd39744c24a", "url": "https://github.com/elastic/elasticsearch/commit/24f4542ceaddc14890f71b57de536cd39744c24a", "message": "Fix test assertion", "committedDate": "2020-05-07T13:59:08Z", "type": "commit"}, {"oid": "88c4b9ee4baefee3e0a3c6a30609a5afedce55c0", "url": "https://github.com/elastic/elasticsearch/commit/88c4b9ee4baefee3e0a3c6a30609a5afedce55c0", "message": "Make it actually work", "committedDate": "2020-05-07T14:18:50Z", "type": "commit"}]}