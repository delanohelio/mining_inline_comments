{"pr_number": 56654, "pr_title": "Prevent connection races in testEnsureWeReconnect", "pr_createdAt": "2020-05-13T00:13:41Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/56654", "timeline": [{"oid": "e69a5ca350e6bccc1eed34e1f8281a812ad55f5a", "url": "https://github.com/elastic/elasticsearch/commit/e69a5ca350e6bccc1eed34e1f8281a812ad55f5a", "message": "Prevent connection races in testEnsureWeReconnect\n\nCurrently it is possible that a sniff connection round is occurring as\nwe enter another test loop in testEnsureWeReconnect. The problem is that\nonce we enter another loop, closing the connection manually can cause\nthis pre-existing connection round to fail. This round failing can fail\nthe test. This commit fixes the issue by ensuring that there are no\nin-progress connections before entering another loop.", "committedDate": "2020-05-12T22:36:02Z", "type": "commit"}, {"oid": "f96a7f29600083e79d437654531f31e2b530ddf6", "url": "https://github.com/elastic/elasticsearch/commit/f96a7f29600083e79d437654531f31e2b530ddf6", "message": "Change", "committedDate": "2020-05-12T22:38:57Z", "type": "commit"}, {"oid": "5ae61c50c4053de4259164601cffebddb2b92a87", "url": "https://github.com/elastic/elasticsearch/commit/5ae61c50c4053de4259164601cffebddb2b92a87", "message": "Merge remote-tracking branch 'upstream/master' into fix_ensure_connected_test", "committedDate": "2020-05-13T00:12:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE3OTY5MQ==", "url": "https://github.com/elastic/elasticsearch/pull/56654#discussion_r424179691", "bodyText": "Maybe if we care about the actual class in the logger here, just make this instead of manually passing the logger through the constructors?:\n    protected Logger logger = LogManager.getLogger(getClass());", "author": "original-brownbear", "createdAt": "2020-05-13T05:25:27Z", "path": "server/src/main/java/org/elasticsearch/transport/RemoteConnectionStrategy.java", "diffHunk": "@@ -111,7 +110,7 @@ public int getNumberOfChannels() {\n \n     private final int maxPendingConnectionListeners;\n \n-    private static final Logger logger = LogManager.getLogger(RemoteConnectionStrategy.class);\n+    private final Logger logger;", "originalCommit": "5ae61c50c4053de4259164601cffebddb2b92a87", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "8327dd14656d406e87e0576920e0e02635b98f95", "url": "https://github.com/elastic/elasticsearch/commit/8327dd14656d406e87e0576920e0e02635b98f95", "message": "Changes", "committedDate": "2020-05-13T21:57:12Z", "type": "commit"}, {"oid": "9987e94567a46d19ecf00d853f0f59792ebe93be", "url": "https://github.com/elastic/elasticsearch/commit/9987e94567a46d19ecf00d853f0f59792ebe93be", "message": "Merge remote-tracking branch 'upstream/master' into fix_ensure_connected_test", "committedDate": "2020-05-13T22:09:38Z", "type": "commit"}]}