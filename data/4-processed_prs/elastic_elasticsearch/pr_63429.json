{"pr_number": 63429, "pr_title": "Add explanation to runtime field query", "pr_createdAt": "2020-10-07T16:55:51Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/63429", "timeline": [{"oid": "df80fdbb20ce53d2d5fb4c74f240de00e4a62a48", "url": "https://github.com/elastic/elasticsearch/commit/df80fdbb20ce53d2d5fb4c74f240de00e4a62a48", "message": "Add explanation to runtime field query\n\nThis adds a `detail` to the output of `explain` for runtime fields\nqueries that makes it clear that their score is entirely based on their\nboost. We don't have any tf/idf/norms/whatever to do any scoring - we\njust score `boost`.", "committedDate": "2020-10-07T16:54:44Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTE2NzM0Nw==", "url": "https://github.com/elastic/elasticsearch/pull/63429#discussion_r501167347", "bodyText": "I went with fairly simple integration tests for this instead of unit tests because it felt easier. I could go either way, but I think this gets the job done.", "author": "nik9000", "createdAt": "2020-10-07T16:56:36Z", "path": "x-pack/plugin/src/test/resources/rest-api-spec/test/runtime_fields/10_keyword.yml", "diffHunk": "@@ -155,6 +155,21 @@ setup:\n   - match: {hits.total.value: 1}\n   - match: {hits.hits.0._source.voltage: 5.8}\n \n+---\n+\"explain term query\":\n+  - do:\n+      search:\n+        index: sensor\n+        explain: true\n+        body:\n+          query:\n+            term:\n+              day_of_week: Monday\n+  - match: {hits.hits.0._explanation.description: day_of_week:Monday}\n+  - match: {hits.hits.0._explanation.details.0.value: 1.0}\n+  - match: {hits.hits.0._explanation.details.0.description: 'runtime field query scoring boost'}\n+  - match: {hits.hits.0._explanation.details.0.details: []}\n+", "originalCommit": "df80fdbb20ce53d2d5fb4c74f240de00e4a62a48", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUxMDYzNQ==", "url": "https://github.com/elastic/elasticsearch/pull/63429#discussion_r501510635", "bodyText": "thats fine with me, maybe a small unit test for the lucene query would be also useful?", "author": "javanna", "createdAt": "2020-10-08T07:41:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTE2NzM0Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUxMDM0Mg==", "url": "https://github.com/elastic/elasticsearch/pull/63429#discussion_r501510342", "bodyText": "I am being picky about the description: the boost is provided with a query right? I am wondering if the boost itself has anything special, specifically related to runtime fields. It feels to me that the boost is just a boost, what is special is that with runtime fields it's the only factor in scoring calculation. What I am getting to is that we could make the detail even clearer, probably. Thinking out loud: should we have two items in details, one that is a constant, that explains that the field is a runtime fields, and the other one that is the actual query boost?\nMaybe we should have a couple more tests around providing a boost with the query, and customizing the score with a script?", "author": "javanna", "createdAt": "2020-10-08T07:40:44Z", "path": "x-pack/plugin/src/test/resources/rest-api-spec/test/runtime_fields/10_keyword.yml", "diffHunk": "@@ -155,6 +155,21 @@ setup:\n   - match: {hits.total.value: 1}\n   - match: {hits.hits.0._source.voltage: 5.8}\n \n+---\n+\"explain term query\":\n+  - do:\n+      search:\n+        index: sensor\n+        explain: true\n+        body:\n+          query:\n+            term:\n+              day_of_week: Monday\n+  - match: {hits.hits.0._explanation.description: day_of_week:Monday}\n+  - match: {hits.hits.0._explanation.details.0.value: 1.0}\n+  - match: {hits.hits.0._explanation.details.0.description: 'runtime field query scoring boost'}", "originalCommit": "df80fdbb20ce53d2d5fb4c74f240de00e4a62a48", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTcyOTY0NA==", "url": "https://github.com/elastic/elasticsearch/pull/63429#discussion_r501729644", "bodyText": "Your proposal for the details makes sense to me. I'll make that change. I'll add a test with a boost certainly. What are you thinking as far as scripting changing the score? I think we usually do that by wrapping the query in a script score, right?", "author": "nik9000", "createdAt": "2020-10-08T13:41:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUxMDM0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTczNDgyMw==", "url": "https://github.com/elastic/elasticsearch/pull/63429#discussion_r501734823", "bodyText": "I think we usually do that by wrapping the query in a script score, right?\n\nyes that is what I meant", "author": "javanna", "createdAt": "2020-10-08T13:47:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUxMDM0Mg=="}], "type": "inlineReview"}, {"oid": "35a7d647690cb62eed04a4cc6346e2a052f835a0", "url": "https://github.com/elastic/elasticsearch/commit/35a7d647690cb62eed04a4cc6346e2a052f835a0", "message": "call out boost", "committedDate": "2020-10-08T14:24:53Z", "type": "commit"}, {"oid": "6ed0d5a71258f51aa6c30103e9cee6acb0d5c4d1", "url": "https://github.com/elastic/elasticsearch/commit/6ed0d5a71258f51aa6c30103e9cee6acb0d5c4d1", "message": "Add test for script score", "committedDate": "2020-10-08T15:23:20Z", "type": "commit"}]}