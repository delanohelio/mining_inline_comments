{"pr_number": 60024, "pr_title": "DOC Mapping updates are deprecated for ingestion privileges", "pr_createdAt": "2020-07-21T21:57:18Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/60024", "timeline": [{"oid": "d2ebd508455857a91acb4c7da68ae67a651e2d2f", "url": "https://github.com/elastic/elasticsearch/commit/d2ebd508455857a91acb4c7da68ae67a651e2d2f", "message": "Doc for Disallow mapping updates for doc ingestion privileges", "committedDate": "2020-07-21T21:45:46Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODg1ODIxMQ==", "url": "https://github.com/elastic/elasticsearch/pull/60024#discussion_r458858211", "bodyText": "This doesn't render properly as-is. The title needs to be on one line and right above the [%collapsible] attribute.\nI also cut the part about this being allowed on indices but not data streams until 8.0.0.\nSince data streams and this change are being introduced in the same release, it\ndoesn't seem worth mentioning.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            [discrete]\n          \n          \n            \n            [[deprecate_mapping_updates_for_ingest_privileges]]\n          \n          \n            \n            .The `create_doc`, `create`, `index` and `write` privileges deprecated allowing access\n          \n          \n            \n            to the update mapping action on indices. `create_doc`, `create` and `index`\n          \n          \n            \n            privileges also deprecated allowing {ref}/dynamic-mapping.html[dynamic mapping updates]\n          \n          \n            \n            on indices, which occur when ingesting documents with unmapped fields.\n          \n          \n            \n            \n          \n          \n            \n            [%collapsible]\n          \n          \n            \n            ====\n          \n          \n            \n            *Details* +\n          \n          \n            \n            The update mapping action on indices and data streams is not granted by the\n          \n          \n            \n            `create_doc`, `create`, `index` and `write` privileges in {es} 8.0.0. The action\n          \n          \n            \n            is however still allowed over indices (but not over data streams), on all\n          \n          \n            \n            releases until version 8.0.0, but a deprecation warning is hence issued.\n          \n          \n            \n            Moreover, the `create_doc`, `create` and `index` privileges do not grant\n          \n          \n            \n            the internal mapping action from {ref}/dynamic-mapping.html[dynamic mappings]\n          \n          \n            \n            in {es} 8.0.0. However, dynamic mapping updates are still allowed on all releases\n          \n          \n            \n            until version 8.0.0, but only on indices, in which case a deprecation warning is issued.\n          \n          \n            \n            \n          \n          \n            \n            *Impact* +\n          \n          \n            \n            Deprecation warnings are generated if mapping updates are granted only due to the\n          \n          \n            \n            deprecated behaviour described above.\n          \n          \n            \n            In most cases, the recommended alternative approach is to rely on index templates\n          \n          \n            \n            together with the `auto_configure` privilege, to only allow dynamic mapping updates\n          \n          \n            \n            according to the template mapping configuration and hence disallow explicit mapping\n          \n          \n            \n            update actions via the API.\n          \n          \n            \n            If explicit mapping updates must be allowed, the `manage` privilege must be granted.\n          \n          \n            \n            \n          \n          \n            \n            ====\n          \n          \n            \n            [discrete]\n          \n          \n            \n            [[deprecate_mapping_updates_for_ingest_privileges]]\n          \n          \n            \n            .Mapping actions have been deprecated for the `create_doc`, `create`, `index` and `write` privileges.\n          \n          \n            \n            [%collapsible]\n          \n          \n            \n            ====\n          \n          \n            \n            *Details* +\n          \n          \n            \n            In {es} 8.0.0, the following privileges will no longer allow users to\n          \n          \n            \n            explicitly update the mapping of an index:\n          \n          \n            \n            \n          \n          \n            \n            * `create_doc`\n          \n          \n            \n            * `create`\n          \n          \n            \n            * `index`\n          \n          \n            \n            * `write`\n          \n          \n            \n            \n          \n          \n            \n            Additionally, in {es} 8.0.0, the following privileges will no longer allow users to\n          \n          \n            \n            {ref}/dynamic-mapping.html[dynamic update the mapping] of an index \n          \n          \n            \n            during indexing or ingest:\n          \n          \n            \n            \n          \n          \n            \n            * `create_doc`\n          \n          \n            \n            * `create`\n          \n          \n            \n            * `index`\n          \n          \n            \n            \n          \n          \n            \n            These privileges will continue to allow mapping actions on indices until {es} 8.0.0. However,\n          \n          \n            \n            deprecation warnings will be returned.\n          \n          \n            \n            \n          \n          \n            \n            *Impact* +\n          \n          \n            \n            To allow users to explicitly update the mapping of an index,\n          \n          \n            \n            grant the `manage` privilege.\n          \n          \n            \n            \n          \n          \n            \n            To dynamically update the mapping of an index during indexing or\n          \n          \n            \n            ingest, grant the `auto_configure` privilege and use index templates. This lets\n          \n          \n            \n            you dynamically update the index mapping based on the template's mapping configuration.\n          \n          \n            \n            ====", "author": "jrodewig", "createdAt": "2020-07-22T14:58:57Z", "path": "docs/reference/migration/migrate_7_9.asciidoc", "diffHunk": "@@ -70,6 +70,36 @@ context.  For example, for the `processor_conditional` context, use\n \n ====\n \n+[discrete]\n+[[deprecate_mapping_updates_for_ingest_privileges]]\n+.The `create_doc`, `create`, `index` and `write` privileges deprecated allowing access\n+to the update mapping action on indices. `create_doc`, `create` and `index`\n+privileges also deprecated allowing {ref}/dynamic-mapping.html[dynamic mapping updates]\n+on indices, which occur when ingesting documents with unmapped fields.\n+\n+[%collapsible]\n+====\n+*Details* +\n+The update mapping action on indices and data streams is not granted by the\n+`create_doc`, `create`, `index` and `write` privileges in {es} 8.0.0. The action\n+is however still allowed over indices (but not over data streams), on all\n+releases until version 8.0.0, but a deprecation warning is hence issued.\n+Moreover, the `create_doc`, `create` and `index` privileges do not grant\n+the internal mapping action from {ref}/dynamic-mapping.html[dynamic mappings]\n+in {es} 8.0.0. However, dynamic mapping updates are still allowed on all releases\n+until version 8.0.0, but only on indices, in which case a deprecation warning is issued.\n+\n+*Impact* +\n+Deprecation warnings are generated if mapping updates are granted only due to the\n+deprecated behaviour described above.\n+In most cases, the recommended alternative approach is to rely on index templates\n+together with the `auto_configure` privilege, to only allow dynamic mapping updates\n+according to the template mapping configuration and hence disallow explicit mapping\n+update actions via the API.\n+If explicit mapping updates must be allowed, the `manage` privilege must be granted.\n+\n+====\n+", "originalCommit": "d2ebd508455857a91acb4c7da68ae67a651e2d2f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODg2Njc5NA==", "url": "https://github.com/elastic/elasticsearch/pull/60024#discussion_r458866794", "bodyText": "Just a minor formatting change.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            not permitting updating one.\n          \n          \n            \n            _Deprecated:_ Also grants the permission to update the index mapping (but not\n          \n          \n            \n            not permitting updating one.\n          \n          \n            \n            +\n          \n          \n            \n            deprecated:[7.9] Also grants the permission to update the index mapping (but not", "author": "jrodewig", "createdAt": "2020-07-22T15:10:38Z", "path": "x-pack/docs/en/security/authorization/privileges.asciidoc", "diffHunk": "@@ -162,8 +162,12 @@ bulk request on an index or data stream that contains new fields that may\n be mapped rather than an explicit <<indices-put-mapping,put mapping>> request.\n \n `create`::\n-Privilege to index documents. Also grants access to the update mapping\n-action.\n+Privilege to index documents, allowing overwriting any existing document, but\n+not permitting updating one.\n+_Deprecated:_ Also grants the permission to update the index mapping (but not", "originalCommit": "d2ebd508455857a91acb4c7da68ae67a651e2d2f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTIyMDE1NQ==", "url": "https://github.com/elastic/elasticsearch/pull/60024#discussion_r459220155", "bodyText": "Aargh, I knew about the deprecated:[x.x] marker.", "author": "albertzaharovits", "createdAt": "2020-07-23T05:22:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODg2Njc5NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODg2Njk1NA==", "url": "https://github.com/elastic/elasticsearch/pull/60024#discussion_r458866954", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            existing ones.\n          \n          \n            \n            _Deprecated:_ Also grants the permission to update the index mapping (but not\n          \n          \n            \n            existing ones.\n          \n          \n            \n            +\n          \n          \n            \n            deprecated:[7.9] Also grants the permission to update the index mapping (but not", "author": "jrodewig", "createdAt": "2020-07-22T15:10:52Z", "path": "x-pack/docs/en/security/authorization/privileges.asciidoc", "diffHunk": "@@ -174,8 +178,12 @@ privilege for an alternative.\n --\n \n `create_doc`::\n-Privilege to index documents. Also grants access to the update mapping action.\n-However, it does not enable a user to update existing documents.\n+Privilege to index new documents, without allowing overwriting or updating\n+existing ones.\n+_Deprecated:_ Also grants the permission to update the index mapping (but not", "originalCommit": "d2ebd508455857a91acb4c7da68ae67a651e2d2f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODg2NzE3OA==", "url": "https://github.com/elastic/elasticsearch/pull/60024#discussion_r458867178", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Privilege to index (overwriting included) and update documents.\n          \n          \n            \n            _Deprecated:_ Also grants the permission to update the index mapping (but not\n          \n          \n            \n            Privilege to index (overwriting included) and update documents.\n          \n          \n            \n            +\n          \n          \n            \n            deprecated:[7.9] Also grants the permission to update the index mapping (but not", "author": "jrodewig", "createdAt": "2020-07-22T15:11:09Z", "path": "x-pack/docs/en/security/authorization/privileges.asciidoc", "diffHunk": "@@ -205,8 +213,11 @@ Privilege to delete documents.\n Privilege to delete an index.\n \n `index`::\n-Privilege to index and update documents. Also grants access to the update\n-mapping action.\n+Privilege to index (overwriting included) and update documents.\n+_Deprecated:_ Also grants the permission to update the index mapping (but not", "originalCommit": "d2ebd508455857a91acb4c7da68ae67a651e2d2f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODg2NzM0OA==", "url": "https://github.com/elastic/elasticsearch/pull/60024#discussion_r458867348", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            as a result of these.\n          \n          \n            \n            _Deprecated:_ Until the next major release, this also grants access to the\n          \n          \n            \n            as a result of these.\n          \n          \n            \n            +\n          \n          \n            \n            deprecated:[7.9] Until the next major release, this also grants access to the", "author": "jrodewig", "createdAt": "2020-07-22T15:11:22Z", "path": "x-pack/docs/en/security/authorization/privileges.asciidoc", "diffHunk": "@@ -252,8 +263,10 @@ privilege is primarily available for use by {kib} users.\n `write`::\n Privilege to perform all write operations to documents, which includes the\n permission to index, update, and delete documents as well as performing bulk\n-operations. Also grants access to the update mapping action.\n-\n+operations, and allows the {ref}/dynamic-mapping.html[dynamic mapping updates]\n+as a result of these.\n+_Deprecated:_ Until the next major release, this also grants access to the", "originalCommit": "d2ebd508455857a91acb4c7da68ae67a651e2d2f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "cedadd5e869d87d7d49cdd1e85b4ea710a61c3a1", "url": "https://github.com/elastic/elasticsearch/commit/cedadd5e869d87d7d49cdd1e85b4ea710a61c3a1", "message": "Update docs/reference/migration/migrate_7_9.asciidoc\n\nCo-authored-by: James Rodewig <james.rodewig@elastic.co>", "committedDate": "2020-07-23T05:21:37Z", "type": "commit"}, {"oid": "1f8ad06a4e334e69ded7c3d60f337b7ba9f59e97", "url": "https://github.com/elastic/elasticsearch/commit/1f8ad06a4e334e69ded7c3d60f337b7ba9f59e97", "message": "Update x-pack/docs/en/security/authorization/privileges.asciidoc\n\nCo-authored-by: James Rodewig <james.rodewig@elastic.co>", "committedDate": "2020-07-23T05:23:03Z", "type": "commit"}, {"oid": "54e1a14d9112c7d3eb7f8044818a829ac693af45", "url": "https://github.com/elastic/elasticsearch/commit/54e1a14d9112c7d3eb7f8044818a829ac693af45", "message": "Update x-pack/docs/en/security/authorization/privileges.asciidoc\n\nCo-authored-by: James Rodewig <james.rodewig@elastic.co>", "committedDate": "2020-07-23T05:23:15Z", "type": "commit"}, {"oid": "59aada46c0ae63dd3b662cee054c91618936c111", "url": "https://github.com/elastic/elasticsearch/commit/59aada46c0ae63dd3b662cee054c91618936c111", "message": "Update x-pack/docs/en/security/authorization/privileges.asciidoc\n\nCo-authored-by: James Rodewig <james.rodewig@elastic.co>", "committedDate": "2020-07-23T05:23:24Z", "type": "commit"}, {"oid": "056e6bf763abbd471b6bddb3c1e62d9ae05c2f89", "url": "https://github.com/elastic/elasticsearch/commit/056e6bf763abbd471b6bddb3c1e62d9ae05c2f89", "message": "Update x-pack/docs/en/security/authorization/privileges.asciidoc\n\nCo-authored-by: James Rodewig <james.rodewig@elastic.co>", "committedDate": "2020-07-23T05:23:31Z", "type": "commit"}, {"oid": "57e86c335456ecdfbe0c843304cecc38e8fb887f", "url": "https://github.com/elastic/elasticsearch/commit/57e86c335456ecdfbe0c843304cecc38e8fb887f", "message": "Merge branch '7.x' into docs_deprecate_79_mapping_updates_for_ingest_privs", "committedDate": "2020-07-23T05:37:36Z", "type": "commit"}, {"oid": "233a026173c523036d5d6f937c204696213cba24", "url": "https://github.com/elastic/elasticsearch/commit/233a026173c523036d5d6f937c204696213cba24", "message": "but not on data streams", "committedDate": "2020-07-23T05:43:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTI2OTQ5NA==", "url": "https://github.com/elastic/elasticsearch/pull/60024#discussion_r459269494", "bodyText": "maybe\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            {ref}/dynamic-mapping.html[dynamic update the mapping] of an index \n          \n          \n            \n            {ref}/dynamic-mapping.html[dynamically update the mapping] of an index \n          \n      \n    \n    \n  \n\nor\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            {ref}/dynamic-mapping.html[dynamic update the mapping] of an index \n          \n          \n            \n            perform a {ref}/dynamic-mapping.html[dynamic update of the mapping] of an index \n          \n      \n    \n    \n  \n\n?", "author": "tvernum", "createdAt": "2020-07-23T07:45:56Z", "path": "docs/reference/migration/migrate_7_9.asciidoc", "diffHunk": "@@ -70,6 +70,40 @@ context.  For example, for the `processor_conditional` context, use\n \n ====\n \n+[discrete]\n+[[deprecate_mapping_updates_for_ingest_privileges]]\n+.Mapping actions have been deprecated for the `create_doc`, `create`, `index` and `write` privileges.\n+[%collapsible]\n+====\n+*Details* +\n+In {es} 8.0.0, the following privileges will no longer allow users to\n+explicitly update the mapping of an index:\n+\n+* `create_doc`\n+* `create`\n+* `index`\n+* `write`\n+\n+Additionally, in {es} 8.0.0, the following privileges will no longer allow users to\n+{ref}/dynamic-mapping.html[dynamic update the mapping] of an index ", "originalCommit": "233a026173c523036d5d6f937c204696213cba24", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTQyMjU2MQ==", "url": "https://github.com/elastic/elasticsearch/pull/60024#discussion_r459422561", "bodyText": "Thank you Tim!", "author": "albertzaharovits", "createdAt": "2020-07-23T12:48:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTI2OTQ5NA=="}], "type": "inlineReview"}, {"oid": "d83791169d7b8b93218b820a966a429edb22828c", "url": "https://github.com/elastic/elasticsearch/commit/d83791169d7b8b93218b820a966a429edb22828c", "message": "Update docs/reference/migration/migrate_7_9.asciidoc\n\nCo-authored-by: Tim Vernum <tim@adjective.org>", "committedDate": "2020-07-23T12:48:26Z", "type": "commit"}]}