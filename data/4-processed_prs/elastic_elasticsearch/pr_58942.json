{"pr_number": 58942, "pr_title": "Submit async search to not require read privilege", "pr_createdAt": "2020-07-02T16:47:05Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/58942", "timeline": [{"oid": "2d0113edc1a9ba56a9200020ece5fd270467ecca", "url": "https://github.com/elastic/elasticsearch/commit/2d0113edc1a9ba56a9200020ece5fd270467ecca", "message": "Submit async search to not require read privilege\n\nWhen we execute search against remote indices, the remote indices are authorized on the remote cluster and not on the CCS cluster. When we introduced submit async search we added a check that requires that the user running it has the privilege to execute it on some index. That prevents users from executing async searches against remote indices unless they also have read access on the CCS cluster, which is common when the CCS cluster holds no data.", "committedDate": "2020-07-02T16:45:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTE0NzE3Mw==", "url": "https://github.com/elastic/elasticsearch/pull/58942#discussion_r449147173", "bodyText": "Can you add a test for delete too ?", "author": "jimczi", "createdAt": "2020-07-02T16:49:45Z", "path": "x-pack/qa/multi-cluster-search-security/src/test/resources/rest-api-spec/test/multi_cluster/10_basic.yml", "diffHunk": "@@ -246,3 +306,34 @@ teardown:\n   - is_true: hits.hits.0._source.secure\n   - match: { hits.hits.0._index: \"my_remote_cluster:secured_via_alias\" }\n \n+---\n+\"Async search against filtered alias on the remote cluster\":\n+\n+  - do:\n+      headers: { Authorization: \"Basic cmVtb3RlOnMza3JpdA==\" }\n+      async_search.submit:\n+        index: my_remote_cluster:aliased_test_index\n+        wait_for_completion_timeout: 10s\n+        keep_on_completion: true\n+\n+  - set:  { id: id }\n+  - match: { is_partial: false }\n+  - match: { response._clusters.total: 1}\n+  - match: { response._clusters.successful: 1}\n+  - match: { response._shards.total: 3 }\n+  - length: { response.hits.hits: 2 }\n+  - match: { response.hits.hits.0._source.filter_field: 1 }\n+  - match: { response.hits.hits.0._index: \"my_remote_cluster:test_index\" }\n+\n+  - do:\n+      headers: { Authorization: \"Basic cmVtb3RlOnMza3JpdA==\" }\n+      async_search.get:\n+        id: \"$id\"\n+\n+  - match: { is_partial: false }\n+  - is_true: response._clusters\n+  - match: { response._shards.total: 3 }\n+  - length: { response.hits.hits: 2 }\n+  - match: { response.hits.hits.0._source.filter_field: 1 }\n+  - match: { response.hits.hits.0._index: \"my_remote_cluster:test_index\" }\n+", "originalCommit": "2d0113edc1a9ba56a9200020ece5fd270467ecca", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "dbae5b9832d33c90160cf71da34ea77f0b3337ed", "url": "https://github.com/elastic/elasticsearch/commit/dbae5b9832d33c90160cf71da34ea77f0b3337ed", "message": "add delete async search tests", "committedDate": "2020-07-02T19:08:31Z", "type": "commit"}]}