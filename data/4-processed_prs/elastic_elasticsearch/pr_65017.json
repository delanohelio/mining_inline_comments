{"pr_number": 65017, "pr_title": "[DOCS] Data stream migration API", "pr_createdAt": "2020-11-12T19:55:35Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/65017", "timeline": [{"oid": "ed5b45883440692fcc45ff781c1a02cfe6d66ce5", "url": "https://github.com/elastic/elasticsearch/commit/ed5b45883440692fcc45ff781c1a02cfe6d66ce5", "message": "docs for data stream mirgration API", "committedDate": "2020-11-12T19:53:34Z", "type": "commit"}, {"oid": "684e1d4ccd2f2b0fe4f72e5f2faa359877510401", "url": "https://github.com/elastic/elasticsearch/commit/684e1d4ccd2f2b0fe4f72e5f2faa359877510401", "message": "correct PUT to POST", "committedDate": "2020-11-12T20:09:39Z", "type": "commit"}, {"oid": "b6935ccf80270a31d37fe86c02d5f86b44261570", "url": "https://github.com/elastic/elasticsearch/commit/b6935ccf80270a31d37fe86c02d5f86b44261570", "message": "add setup for doc tests", "committedDate": "2020-11-12T20:30:26Z", "type": "commit"}, {"oid": "0ba8e8aee9cc0ea476253008d419d0e14d8c8584", "url": "https://github.com/elastic/elasticsearch/commit/0ba8e8aee9cc0ea476253008d419d0e14d8c8584", "message": "fix typo <sigh>", "committedDate": "2020-11-12T20:45:26Z", "type": "commit"}, {"oid": "31c50e821795f60dd518cc5c8b3b3c171bcf9bd8", "url": "https://github.com/elastic/elasticsearch/commit/31c50e821795f60dd518cc5c8b3b3c171bcf9bd8", "message": "additional criteria", "committedDate": "2020-11-12T20:52:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjQ1MDk2Ng==", "url": "https://github.com/elastic/elasticsearch/pull/65017#discussion_r522450966", "bodyText": "\"Convert\" sounds a bit more natural here and adds some word variety.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Migrates an existing alias with its indices to a new\n          \n          \n            \n            <<data-streams,data stream>>.\n          \n          \n            \n            Converts an <<indices-aliases,index alias>> to a <<data-streams,data stream>>.", "author": "jrodewig", "createdAt": "2020-11-12T21:56:16Z", "path": "docs/reference/indices/migrate-to-data-stream.asciidoc", "diffHunk": "@@ -0,0 +1,94 @@\n+[role=\"xpack\"]\n+[[indices-migrate-to-data-stream]]\n+=== Migrate to data stream API\n+++++\n+<titleabbrev>Migrate to data stream</titleabbrev>\n+++++\n+\n+Migrates an existing alias with its indices to a new\n+<<data-streams,data stream>>.", "originalCommit": "31c50e821795f60dd518cc5c8b3b3c171bcf9bd8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjQ2NDg1Mg==", "url": "https://github.com/elastic/elasticsearch/pull/65017#discussion_r522464852", "bodyText": "I'd reorder this slightly so the required criteria comes first. I also added a sentence about the write index after conversion.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            (Required, string) Name of the alias to be migrated to a data stream. The\n          \n          \n            \n            alias's indices will be hidden and converted to backing indices for the\n          \n          \n            \n            new data stream. The alias will be removed, and the new data stream will\n          \n          \n            \n            be named `<alias>`.\n          \n          \n            \n            \n          \n          \n            \n            Aliases must meet the following criteria to be migrated to a data stream:\n          \n          \n            \n            \n          \n          \n            \n            - Must have an index defined as the <<aliases-write-index,write index>>\n          \n          \n            \n            - All indices associated with the alias must have a mapping for the\n          \n          \n            \n            `@timestamp` field of type `date` or `date_nanos`\n          \n          \n            \n            - Must not have any <<filtered,filters>>\n          \n          \n            \n            - Must not have any <<aliases-routing,custom routing>>\n          \n          \n            \n            (Required, string)\n          \n          \n            \n            Name of the index alias to convert to a data stream. The alias must meet the\n          \n          \n            \n            following criteria:\n          \n          \n            \n            \n          \n          \n            \n            - The alias must have a <<aliases-write-index,write index>>.\n          \n          \n            \n            - All indices for the alias have a `@timestamp` field mapping of a `date` or `date_nanos` field type.\n          \n          \n            \n            - The alias must not have any <<filtered,filters>>.\n          \n          \n            \n            - The alias must not use <<aliases-routing,custom routing>>.\n          \n          \n            \n            \n          \n          \n            \n            If successful, the request removes the alias and creates a data stream with the\n          \n          \n            \n            same name. The alias's indices become hidden backing indices for the stream. The\n          \n          \n            \n            alias's write index becomes the stream's write index.", "author": "jrodewig", "createdAt": "2020-11-12T22:18:09Z", "path": "docs/reference/indices/migrate-to-data-stream.asciidoc", "diffHunk": "@@ -0,0 +1,94 @@\n+[role=\"xpack\"]\n+[[indices-migrate-to-data-stream]]\n+=== Migrate to data stream API\n+++++\n+<titleabbrev>Migrate to data stream</titleabbrev>\n+++++\n+\n+Migrates an existing alias with its indices to a new\n+<<data-streams,data stream>>.\n+\n+Data streams require a matching <<indices-templates,index template>>.\n+See <<set-up-a-data-stream>>.\n+\n+////\n+[source,console]\n+----\n+POST idx1/_doc/\n+{\n+    \"message\" : \"testing\",\n+    \"@timestamp\" : \"2020-01-01\"\n+}\n+\n+POST idx2/_doc/\n+{\n+    \"message\" : \"testing2\",\n+    \"@timestamp\" : \"2020-01-01\"\n+}\n+\n+POST /_aliases\n+{\n+  \"actions\": [\n+    {\n+      \"add\": {\n+        \"index\": \"idx1\",\n+        \"alias\": \"my-logs\",\n+        \"is_write_index\": true\n+      }\n+    },\n+    {\n+      \"add\": {\n+        \"index\": \"idx2\",\n+        \"alias\": \"my-logs\"\n+      }\n+    }\n+  ]\n+}\n+\n+PUT /_index_template/template\n+{\n+  \"index_patterns\": [\"my-logs*\"],\n+  \"data_stream\": { }\n+}\n+----\n+////\n+\n+[source,console]\n+----\n+POST /_data_stream/_migrate/my-logs\n+----\n+// TEST[continued]\n+\n+////\n+[source,console]\n+-----------------------------------\n+DELETE /_data_stream/my-logs\n+DELETE /_index_template/template\n+-----------------------------------\n+// TEST[continued]\n+////\n+\n+[[indices-migrate-to-data-stream-request]]\n+==== {api-request-title}\n+\n+`POST /_data_stream/_migrate/<alias>`\n+\n+[[indices-migrate-to-data-stream-api-path-params]]\n+==== {api-path-parms-title}\n+\n+`<alias>`::\n++\n+--\n+(Required, string) Name of the alias to be migrated to a data stream. The\n+alias's indices will be hidden and converted to backing indices for the\n+new data stream. The alias will be removed, and the new data stream will\n+be named `<alias>`.\n+\n+Aliases must meet the following criteria to be migrated to a data stream:\n+\n+- Must have an index defined as the <<aliases-write-index,write index>>\n+- All indices associated with the alias must have a mapping for the\n+`@timestamp` field of type `date` or `date_nanos`\n+- Must not have any <<filtered,filters>>\n+- Must not have any <<aliases-routing,custom routing>>", "originalCommit": "31c50e821795f60dd518cc5c8b3b3c171bcf9bd8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "2569349ed8ae186ea9d1c93130984b1bfcc78bfd", "url": "https://github.com/elastic/elasticsearch/commit/2569349ed8ae186ea9d1c93130984b1bfcc78bfd", "message": "Update docs/reference/indices/migrate-to-data-stream.asciidoc\n\nCo-authored-by: James Rodewig <40268737+jrodewig@users.noreply.github.com>", "committedDate": "2020-11-13T13:49:26Z", "type": "commit"}, {"oid": "4c07203ef0d00845307c9ce2c3e341eca42f5f29", "url": "https://github.com/elastic/elasticsearch/commit/4c07203ef0d00845307c9ce2c3e341eca42f5f29", "message": "Update docs/reference/indices/migrate-to-data-stream.asciidoc\n\nCo-authored-by: James Rodewig <40268737+jrodewig@users.noreply.github.com>", "committedDate": "2020-11-13T13:50:30Z", "type": "commit"}, {"oid": "18f33058043fc3acc0f1db058f8d4ac9a2c101fd", "url": "https://github.com/elastic/elasticsearch/commit/18f33058043fc3acc0f1db058f8d4ac9a2c101fd", "message": "Merge branch 'master' into 61046_docs2", "committedDate": "2020-11-13T22:27:56Z", "type": "commit"}]}