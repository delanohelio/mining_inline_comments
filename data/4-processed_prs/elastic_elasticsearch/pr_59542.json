{"pr_number": 59542, "pr_title": "[ML] add new `custom` field to trained model processors", "pr_createdAt": "2020-07-14T14:52:56Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/59542", "timeline": [{"oid": "781ba88060cbe5ca5a90f6bc20bf64d944588a04", "url": "https://github.com/elastic/elasticsearch/commit/781ba88060cbe5ca5a90f6bc20bf64d944588a04", "message": "[ML] add new fields to trained model processors", "committedDate": "2020-07-14T14:45:43Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTIxNTY5Mg==", "url": "https://github.com/elastic/elasticsearch/pull/59542#discussion_r455215692", "bodyText": "@elastic/ml-docs what do y'all think?", "author": "benwtrent", "createdAt": "2020-07-15T17:28:47Z", "path": "docs/reference/ml/df-analytics/apis/put-inference.asciidoc", "diffHunk": "@@ -94,6 +94,14 @@ The field name to encode.\n `frequency_map`::\n (Required, object map of string:double)\n Object that maps the field value to the frequency encoded value.\n+\n+`custom`::\n+(Optional, boolean)\n+Boolean value indicating if the analytics job created the preprocessor\n+or if a user provided it. This adjusts the feature importance calculation.\n+When `true`, the feature importance calculation returns importance for the\n+processed feature. When `false`, the total importance of the original field\n+is returned. Default is `false`.", "originalCommit": "781ba88060cbe5ca5a90f6bc20bf64d944588a04", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTcxMjIxNw==", "url": "https://github.com/elastic/elasticsearch/pull/59542#discussion_r455712217", "bodyText": "@benwtrent The text looks good to me. As you use it in multiple places, maybe it would be good to define custom in the ml-shared.asciidoc and reference it from there. Please let me know if I can help.", "author": "szabosteve", "createdAt": "2020-07-16T11:18:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTIxNTY5Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTY1NzI3OQ==", "url": "https://github.com/elastic/elasticsearch/pull/59542#discussion_r455657279", "bodyText": "Why not add setCustom(Boolean isCustom) to the builder?\nThe builder is public whereas the ctor is package private, if the intention is to allow HLRC users to define custom preprocessors then why hide it. Or is there more work required to enable this?", "author": "davidkyle", "createdAt": "2020-07-16T09:37:22Z", "path": "client/rest-high-level/src/main/java/org/elasticsearch/client/ml/inference/preprocessing/FrequencyEncoding.java", "diffHunk": "@@ -154,7 +166,7 @@ public Builder addFrequency(String valueName, double frequency) {\n         }\n \n         public FrequencyEncoding build() {\n-            return new FrequencyEncoding(field, featureName, frequencyMap);\n+            return new FrequencyEncoding(field, featureName, frequencyMap, null);", "originalCommit": "781ba88060cbe5ca5a90f6bc20bf64d944588a04", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTcxMzk1MQ==", "url": "https://github.com/elastic/elasticsearch/pull/59542#discussion_r455713951", "bodyText": "@davidkyle I wanted to wait on this until we have support for custom processors in analytics. Then we can see how it all plays together.\nAdding a builder setter is not a big deal. I can add one now.", "author": "benwtrent", "createdAt": "2020-07-16T11:22:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTY1NzI3OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTczMjk4Mw==", "url": "https://github.com/elastic/elasticsearch/pull/59542#discussion_r455732983", "bodyText": "Then we can see how it all plays together.\n\nThat's good.", "author": "davidkyle", "createdAt": "2020-07-16T11:59:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTY1NzI3OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTY2OTgxMw==", "url": "https://github.com/elastic/elasticsearch/pull/59542#discussion_r455669813", "bodyText": "Put this in ml-shared", "author": "davidkyle", "createdAt": "2020-07-16T09:58:21Z", "path": "docs/reference/ml/df-analytics/apis/put-inference.asciidoc", "diffHunk": "@@ -138,6 +154,14 @@ The field name to encode.\n `target_map`:::\n (Required, object map of string:double)\n Object that maps the field value to the target mean value.\n+\n+`custom`::\n+(Optional, boolean)\n+Boolean value indicating if the analytics job created the preprocessor", "originalCommit": "781ba88060cbe5ca5a90f6bc20bf64d944588a04", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "0aa05235b646f254f42aa43f3cff1e026602ea0d", "url": "https://github.com/elastic/elasticsearch/commit/0aa05235b646f254f42aa43f3cff1e026602ea0d", "message": "addressing PR comments", "committedDate": "2020-07-16T12:04:38Z", "type": "commit"}, {"oid": "18f12dbb07e805e6f3f9b7dfe8d494dc7b710742", "url": "https://github.com/elastic/elasticsearch/commit/18f12dbb07e805e6f3f9b7dfe8d494dc7b710742", "message": "Merge remote-tracking branch 'upstream/master' into feature/ml-add-processor-fields", "committedDate": "2020-07-16T12:05:03Z", "type": "commit"}]}