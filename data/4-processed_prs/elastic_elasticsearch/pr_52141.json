{"pr_number": 52141, "pr_title": "Add a new async search security origin", "pr_createdAt": "2020-02-10T12:32:41Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/52141", "timeline": [{"oid": "aba72789fee0fb53c14df5fa5126c2f35acc17bb", "url": "https://github.com/elastic/elasticsearch/commit/aba72789fee0fb53c14df5fa5126c2f35acc17bb", "message": "Async search security origin", "committedDate": "2020-02-10T12:14:38Z", "type": "commit"}, {"oid": "62a2ff2d11eb3822e02d1ee3a2358d6ab63be3bb", "url": "https://github.com/elastic/elasticsearch/commit/62a2ff2d11eb3822e02d1ee3a2358d6ab63be3bb", "message": "Merge branch 'master' into async-search-security-origin", "committedDate": "2020-02-11T10:20:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzU0OTM5MQ==", "url": "https://github.com/elastic/elasticsearch/pull/52141#discussion_r377549391", "bodyText": "\ud83d\udc4d", "author": "tvernum", "createdAt": "2020-02-11T10:27:14Z", "path": "x-pack/plugin/security/src/test/java/org/elasticsearch/xpack/security/authz/AuthorizationUtilsTests.java", "diffHunk": "@@ -95,9 +97,15 @@ public void testSwitchAndExecuteXpackSecurityUser() throws Exception {\n     }\n \n     public void testSwitchAndExecuteXpackUser() throws Exception {\n-        String origin = randomFrom(ClientHelper.ML_ORIGIN, ClientHelper.WATCHER_ORIGIN, ClientHelper.DEPRECATION_ORIGIN,\n-                ClientHelper.MONITORING_ORIGIN, ClientHelper.PERSISTENT_TASK_ORIGIN, ClientHelper.INDEX_LIFECYCLE_ORIGIN);\n-        assertSwitchBasedOnOriginAndExecute(origin, XPackUser.INSTANCE);\n+        for (String origin : Arrays.asList(ClientHelper.ML_ORIGIN, ClientHelper.WATCHER_ORIGIN, ClientHelper.DEPRECATION_ORIGIN,", "originalCommit": "aba72789fee0fb53c14df5fa5126c2f35acc17bb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzU0OTU1OA==", "url": "https://github.com/elastic/elasticsearch/pull/52141#discussion_r377549558", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    // test AyncSearch user short circuits to its onw reserved role\n          \n          \n            \n                    // test AyncSearch user short circuits to its own reserved role", "author": "tvernum", "createdAt": "2020-02-11T10:27:30Z", "path": "x-pack/plugin/security/src/test/java/org/elasticsearch/xpack/security/authz/store/CompositeRolesStoreTests.java", "diffHunk": "@@ -959,13 +960,23 @@ public void testDoesNotUseRolesStoreForXPackUser() {\n                 rds -> effectiveRoleDescriptors.set(rds));\n         verify(fileRolesStore).addListener(any(Consumer.class)); // adds a listener in ctor\n \n+        // test Xpack user short circuits to its own reserved role\n         PlainActionFuture<Role> rolesFuture = new PlainActionFuture<>();\n         Authentication auth = new Authentication(XPackUser.INSTANCE, new RealmRef(\"name\", \"type\", \"node\"), null);\n         compositeRolesStore.getRoles(XPackUser.INSTANCE, auth, rolesFuture);\n-        final Role roles = rolesFuture.actionGet();\n+        Role roles = rolesFuture.actionGet();\n         assertThat(roles, equalTo(XPackUser.ROLE));\n         assertThat(effectiveRoleDescriptors.get(), is(nullValue()));\n         verifyNoMoreInteractions(fileRolesStore, nativeRolesStore, reservedRolesStore);\n+\n+        // test AyncSearch user short circuits to its onw reserved role", "originalCommit": "aba72789fee0fb53c14df5fa5126c2f35acc17bb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "66cb72276c1d2682cf9268cfa34a4620950b1aa6", "url": "https://github.com/elastic/elasticsearch/commit/66cb72276c1d2682cf9268cfa34a4620950b1aa6", "message": "Update x-pack/plugin/security/src/test/java/org/elasticsearch/xpack/security/authz/store/CompositeRolesStoreTests.java\n\nCo-Authored-By: Tim Vernum <tim@adjective.org>", "committedDate": "2020-02-11T10:45:45Z", "type": "commit"}]}