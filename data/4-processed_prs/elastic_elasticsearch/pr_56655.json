{"pr_number": 56655, "pr_title": "[DOCS] Add info about ILM and unallocated shards.", "pr_createdAt": "2020-05-13T00:33:32Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/56655", "timeline": [{"oid": "08b4d362a312eed05ed44dd5618b0ded3fa0824a", "url": "https://github.com/elastic/elasticsearch/commit/08b4d362a312eed05ed44dd5618b0ded3fa0824a", "message": "[DOCS] Add info about ILM and unallocated shards.", "committedDate": "2020-05-13T00:29:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU3MzYxNQ==", "url": "https://github.com/elastic/elasticsearch/pull/56655#discussion_r424573615", "bodyText": "Might as well link to the index template documentation here?", "author": "dakrone", "createdAt": "2020-05-13T16:30:49Z", "path": "docs/reference/ilm/actions/ilm-allocate.asciidoc", "diffHunk": "@@ -7,16 +7,16 @@ Phases allowed: warm, cold.\n Updates the index settings to change which nodes are allowed to host the index shards\n and change the number of replicas.\n \n+The allocate action is not allowed in the hot phase. \n+The initial allocation for the index must be done manually or via index templates.", "originalCommit": "08b4d362a312eed05ed44dd5618b0ded3fa0824a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU3NTM0Nw==", "url": "https://github.com/elastic/elasticsearch/pull/56655#discussion_r424575347", "bodyText": "This sentence is confusing for me, and I even know what's going on. To me it sounds mutually exclusive with the previous sentence, saying things like \"we don't delete shards that haven't moved over\" right after saying \"there may be unexpected side effects\"", "author": "dakrone", "createdAt": "2020-05-13T16:33:38Z", "path": "docs/reference/ilm/ilm-index-lifecycle.asciidoc", "diffHunk": "@@ -36,6 +36,17 @@ the index must be older than the minimum age of the next phase.\n The minimum age defaults to zero, which causes {ilm-init} to move indices to the next phase\n as soon as all actions in the current phase complete. \n \n+If an index has unallocated shards and the cluster is in the _yellow_ state, \n+the index can still transition from one phase to the next according to its {ilm} policy, \n+but there might be unexpected side effects because {es} can only perform \n+certain clean up tasks on a healthy cluster. \n+For example, if you have a policy that moves shards to warm nodes when \n+the index transitions out of the hot phase, {es} won't delete shards that \n+weren't fully replicated from the hot nodes. ", "originalCommit": "08b4d362a312eed05ed44dd5618b0ded3fa0824a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDczNjQwMw==", "url": "https://github.com/elastic/elasticsearch/pull/56655#discussion_r424736403", "bodyText": "I could be missing something, but is this sentence needed? Seems like a restatement of the first one in the para. Feel free to leave in if I'm wrong.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            {ilm-init} doesn't handle index allocation during the hot phase.", "author": "jrodewig", "createdAt": "2020-05-13T21:17:15Z", "path": "docs/reference/ilm/actions/ilm-allocate.asciidoc", "diffHunk": "@@ -7,16 +7,16 @@ Phases allowed: warm, cold.\n Updates the index settings to change which nodes are allowed to host the index shards\n and change the number of replicas.\n \n+The allocate action is not allowed in the hot phase. \n+The initial allocation for the index must be done manually or via index templates.\n+{ilm-init} doesn't handle index allocation during the hot phase.", "originalCommit": "08b4d362a312eed05ed44dd5618b0ded3fa0824a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDczNzM4Mw==", "url": "https://github.com/elastic/elasticsearch/pull/56655#discussion_r424737383", "bodyText": "It may be helpful to disambiguate between this and the general cluster state.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            If an index has unallocated shards and the cluster is in the _yellow_ state, \n          \n          \n            \n            If an index has unallocated shards and the <<cluster-health,cluster health status>> is yellow,", "author": "jrodewig", "createdAt": "2020-05-13T21:19:17Z", "path": "docs/reference/ilm/ilm-index-lifecycle.asciidoc", "diffHunk": "@@ -36,6 +36,17 @@ the index must be older than the minimum age of the next phase.\n The minimum age defaults to zero, which causes {ilm-init} to move indices to the next phase\n as soon as all actions in the current phase complete. \n \n+If an index has unallocated shards and the cluster is in the _yellow_ state, ", "originalCommit": "08b4d362a312eed05ed44dd5618b0ded3fa0824a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDczODYzNA==", "url": "https://github.com/elastic/elasticsearch/pull/56655#discussion_r424738634", "bodyText": "Some rewording suggestions here to shorten and change order. Feel free to ignore if wanted.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            the index can still transition from one phase to the next according to its {ilm} policy, \n          \n          \n            \n            but there might be unexpected side effects because {es} can only perform \n          \n          \n            \n            certain clean up tasks on a healthy cluster. \n          \n          \n            \n            the index can still transition to the next phase according to its {ilm} policy.\n          \n          \n            \n            However, because {es} can only perform certain clean up tasks on a green\n          \n          \n            \n            cluster, there may be unexpected side effects.", "author": "jrodewig", "createdAt": "2020-05-13T21:21:57Z", "path": "docs/reference/ilm/ilm-index-lifecycle.asciidoc", "diffHunk": "@@ -36,6 +36,17 @@ the index must be older than the minimum age of the next phase.\n The minimum age defaults to zero, which causes {ilm-init} to move indices to the next phase\n as soon as all actions in the current phase complete. \n \n+If an index has unallocated shards and the cluster is in the _yellow_ state, \n+the index can still transition from one phase to the next according to its {ilm} policy, \n+but there might be unexpected side effects because {es} can only perform \n+certain clean up tasks on a healthy cluster. ", "originalCommit": "08b4d362a312eed05ed44dd5618b0ded3fa0824a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDc0MjM2Mw==", "url": "https://github.com/elastic/elasticsearch/pull/56655#discussion_r424742363", "bodyText": "I took a stab at the suggestion, but feel free to ignore if I'm off base.\nI think this might benefit from being in its own para.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            For example, if you have a policy that moves shards to warm nodes when \n          \n          \n            \n            the index transitions out of the hot phase, {es} won't delete shards that \n          \n          \n            \n            weren't fully replicated from the hot nodes. \n          \n          \n            \n            \n          \n          \n            \n            For example, when an index transitions from the hot phase to the warm phase,\n          \n          \n            \n            your policy moves shards from hot nodes to warm ones. For a yellow cluster,\n          \n          \n            \n            {es} won't clean up any shards on hot nodes that weren't fully replicated. For\n          \n          \n            \n            a healthy green cluster, these shards would be deleted as part of cleanup.", "author": "jrodewig", "createdAt": "2020-05-13T21:29:52Z", "path": "docs/reference/ilm/ilm-index-lifecycle.asciidoc", "diffHunk": "@@ -36,6 +36,17 @@ the index must be older than the minimum age of the next phase.\n The minimum age defaults to zero, which causes {ilm-init} to move indices to the next phase\n as soon as all actions in the current phase complete. \n \n+If an index has unallocated shards and the cluster is in the _yellow_ state, \n+the index can still transition from one phase to the next according to its {ilm} policy, \n+but there might be unexpected side effects because {es} can only perform \n+certain clean up tasks on a healthy cluster. \n+For example, if you have a policy that moves shards to warm nodes when \n+the index transitions out of the hot phase, {es} won't delete shards that \n+weren't fully replicated from the hot nodes. ", "originalCommit": "08b4d362a312eed05ed44dd5618b0ded3fa0824a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDc2NTkyMA==", "url": "https://github.com/elastic/elasticsearch/pull/56655#discussion_r424765920", "bodyText": "I think the example is just making this more complicated than it needs to be. The key takeaway is that the index will still move through the lifecycle, but bad things can happen.", "author": "debadair", "createdAt": "2020-05-13T22:25:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDc0MjM2Mw=="}], "type": "inlineReview"}, {"oid": "0e6635a741e4cbe0b52e1134b3c44e239994e9ad", "url": "https://github.com/elastic/elasticsearch/commit/0e6635a741e4cbe0b52e1134b3c44e239994e9ad", "message": "Incorporated review feedback.", "committedDate": "2020-05-13T21:33:58Z", "type": "commit"}, {"oid": "d79d031ef73d88981e1feb62910da3010383d200", "url": "https://github.com/elastic/elasticsearch/commit/d79d031ef73d88981e1feb62910da3010383d200", "message": "Update docs/reference/ilm/actions/ilm-allocate.asciidoc\n\nCo-authored-by: James Rodewig <james.rodewig@elastic.co>", "committedDate": "2020-05-13T22:03:54Z", "type": "commit"}, {"oid": "8c69b11feca6443d4a0c0984d49858fd2ea06d79", "url": "https://github.com/elastic/elasticsearch/commit/8c69b11feca6443d4a0c0984d49858fd2ea06d79", "message": "Apply suggestions from code review\n\nCo-authored-by: James Rodewig <james.rodewig@elastic.co>", "committedDate": "2020-05-13T22:05:38Z", "type": "commit"}, {"oid": "be191b3b5d2ed73656fb3ff799b954c992a17174", "url": "https://github.com/elastic/elasticsearch/commit/be191b3b5d2ed73656fb3ff799b954c992a17174", "message": "Fix xref", "committedDate": "2020-05-13T22:35:05Z", "type": "commit"}]}