{"pr_number": 65862, "pr_title": "[DOCS] Document hidden data streams and naming restrictions", "pr_createdAt": "2020-12-03T23:32:13Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/65862", "timeline": [{"oid": "171950445a500d568ca6d275c049fc7b83b88394", "url": "https://github.com/elastic/elasticsearch/commit/171950445a500d568ca6d275c049fc7b83b88394", "message": "[DOCS] Document hidden data streams and naming restrictions", "committedDate": "2020-12-04T02:10:22Z", "type": "commit"}, {"oid": "171950445a500d568ca6d275c049fc7b83b88394", "url": "https://github.com/elastic/elasticsearch/commit/171950445a500d568ca6d275c049fc7b83b88394", "message": "[DOCS] Document hidden data streams and naming restrictions", "committedDate": "2020-12-04T02:10:22Z", "type": "forcePushed"}, {"oid": "302526144926341e8b24b0a9ce879c4abdc14d28", "url": "https://github.com/elastic/elasticsearch/commit/302526144926341e8b24b0a9ce879c4abdc14d28", "message": "fixes", "committedDate": "2020-12-04T02:14:46Z", "type": "commit"}, {"oid": "86070932e7414e3903701d3360a0974aaf9c2cff", "url": "https://github.com/elastic/elasticsearch/commit/86070932e7414e3903701d3360a0974aaf9c2cff", "message": "make expand wildcards consistent", "committedDate": "2020-12-04T02:27:50Z", "type": "commit"}, {"oid": "aeb28d27da095f9517f28bd6901415e907c1e6f4", "url": "https://github.com/elastic/elasticsearch/commit/aeb28d27da095f9517f28bd6901415e907c1e6f4", "message": "reword", "committedDate": "2020-12-04T02:33:57Z", "type": "commit"}, {"oid": "e24418851eb15647f2d125ee6f3a82dcae9913e4", "url": "https://github.com/elastic/elasticsearch/commit/e24418851eb15647f2d125ee6f3a82dcae9913e4", "message": "Edit", "committedDate": "2020-12-04T03:23:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1Mjk3NjY2Nw==", "url": "https://github.com/elastic/elasticsearch/pull/65862#discussion_r552976667", "bodyText": "In my testing, open and closed match hidden indices and data streams though I'm not sure why.", "author": "danhermann", "createdAt": "2021-01-06T21:46:16Z", "path": "docs/reference/rest-api/common-parms.asciidoc", "diffHunk": "@@ -209,22 +209,24 @@ tag::expand-wildcards[]\n `expand_wildcards`::\n +\n --\n-(Optional, string) Controls what kind of indices that wildcard expressions can\n-expand to. Multiple values are accepted when separated by a comma, as in\n-`open,hidden`. Valid values are:\n+(Optional, string)\n+Type of index that wildcard expressions can match. If the request can target\n+data streams, this argument determines whether wildcard expressions match\n+hidden data streams. Supports comma-separated values, such as `open,hidden`.\n+Valid values are:\n \n `all`::\n-Expand to open and closed indices, including <<hidden-indices,hidden indices>>.\n+Match any data stream or index, including <<hidden-indices,hidden>> ones.\n \n `open`::\n-Expand only to open indices.\n+Match non-hidden data streams and open, non-hidden indices.", "originalCommit": "e24418851eb15647f2d125ee6f3a82dcae9913e4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzAxNDIzNg==", "url": "https://github.com/elastic/elasticsearch/pull/65862#discussion_r553014236", "bodyText": "Thanks @danhermann. That sounds like a big regression, but I wasn't able to reproduce. Here's how I tested when running the latest master branch locally using ./gradlew run -Dtests.es.xpack.security.enabled=false:\n### 1. Create a non-hidden data stream.\n\nPUT _index_template/visible-data-stream-template\n{\n  \"index_patterns\": [ \"visible-data-stream\" ],\n  \"data_stream\": { },\n  \"priority\": 200\n}\nPUT _data_stream/visible-data-stream\n\n### 2. Create hidden data stream.\n\nPUT _index_template/hidden-data-stream-template\n{\n  \"index_patterns\": [ \"hidden-data-stream\" ],\n  \"data_stream\": {\n    \"hidden\": true\n  },\n  \"priority\": 200\n}\nPUT _data_stream/hidden-data-stream\n\n### 3. Get request with `expand_wildcards=open`.\n\nGET *-data-stream?expand_wildcards=open\n\n# Returns info for `visible-data-stream` only.\n\n### 4. Get data streams with `expand_wildcards=open,hidden`.\n\nGET *-data-stream?expand_wildcards=open,hidden\n\n# Returns info for `visible-data-stream` and `hidden-data-stream`.\n\n### 5. Create an open, hidden index.\n\nPUT hidden-index\n{\n  \"settings\": {\n    \"index.hidden\": true\n  }\n}\n\n### 6. Create and close an index.\n\nPUT closed-index\nPOST closed-index/_close\n\n### 7. Get request with `expand_wildcards=closed`.\n\nGET *-data-stream,*-index?expand_wildcards=closed\n\n# Returns info for `closed-index` only.", "author": "jrodewig", "createdAt": "2021-01-06T23:21:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1Mjk3NjY2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzAyMDA0OA==", "url": "https://github.com/elastic/elasticsearch/pull/65862#discussion_r553020048", "bodyText": "Hmm, interesting. I was testing primarily with * as the wildcard. With a more restrictive wildcard, it does appear to work as you've described.", "author": "danhermann", "createdAt": "2021-01-06T23:40:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1Mjk3NjY2Nw=="}], "type": "inlineReview"}, {"oid": "def8366c643a0db5a2e35d4f106244aa914295b8", "url": "https://github.com/elastic/elasticsearch/commit/def8366c643a0db5a2e35d4f106244aa914295b8", "message": "Fix typo", "committedDate": "2021-01-06T23:26:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTQxNTM1OQ==", "url": "https://github.com/elastic/elasticsearch/pull/65862#discussion_r555415359", "bodyText": "For data streams API (get, delete, stats etc) both open and closed will return all data streams (excluding hidden with hidden is not specified) - we don't have a concept of closed and open data streams. I'm not really sure how to point that out in the documentation", "author": "probakowski", "createdAt": "2021-01-11T23:58:58Z", "path": "docs/reference/rest-api/common-parms.asciidoc", "diffHunk": "@@ -209,22 +209,24 @@ tag::expand-wildcards[]\n `expand_wildcards`::\n +\n --\n-(Optional, string) Controls what kind of indices that wildcard expressions can\n-expand to. Multiple values are accepted when separated by a comma, as in\n-`open,hidden`. Valid values are:\n+(Optional, string)\n+Type of index that wildcard expressions can match. If the request can target\n+data streams, this argument determines whether wildcard expressions match\n+hidden data streams. Supports comma-separated values, such as `open,hidden`.\n+Valid values are:\n \n `all`::\n-Expand to open and closed indices, including <<hidden-indices,hidden indices>>.\n+Match any data stream or index, including <<hidden-indices,hidden>> ones.\n \n `open`::\n-Expand only to open indices.\n+Match non-hidden data streams and open, non-hidden indices.\n \n `closed`::\n-Expand only to closed indices.\n+Match closed indices.", "originalCommit": "def8366c643a0db5a2e35d4f106244aa914295b8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTQ4MDIwOQ==", "url": "https://github.com/elastic/elasticsearch/pull/65862#discussion_r555480209", "bodyText": "Good point. I was initially side-stepping this, but it may be better to be explicit.\nWith 04cd440, we now note that data streams cannot be closed. I don't think we need that for open, but let me know.", "author": "jrodewig", "createdAt": "2021-01-12T03:01:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTQxNTM1OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTQxNjY5MA==", "url": "https://github.com/elastic/elasticsearch/pull/65862#discussion_r555416690", "bodyText": "For data streams API (get, delete, stats etc) there's a shortcut - if you provide only hidden it will work as open,hidden -  we don't have a concept of closed and open data streams so forcing user to add it seems unnecessary. Of course it's not the case for search APIs where open and closed apply to the backing indices of data stream.", "author": "probakowski", "createdAt": "2021-01-12T00:03:13Z", "path": "docs/reference/rest-api/common-parms.asciidoc", "diffHunk": "@@ -209,22 +209,24 @@ tag::expand-wildcards[]\n `expand_wildcards`::\n +\n --\n-(Optional, string) Controls what kind of indices that wildcard expressions can\n-expand to. Multiple values are accepted when separated by a comma, as in\n-`open,hidden`. Valid values are:\n+(Optional, string)\n+Type of index that wildcard expressions can match. If the request can target\n+data streams, this argument determines whether wildcard expressions match\n+hidden data streams. Supports comma-separated values, such as `open,hidden`.\n+Valid values are:\n \n `all`::\n-Expand to open and closed indices, including <<hidden-indices,hidden indices>>.\n+Match any data stream or index, including <<hidden-indices,hidden>> ones.\n \n `open`::\n-Expand only to open indices.\n+Match non-hidden data streams and open, non-hidden indices.\n \n `closed`::\n-Expand only to closed indices.\n+Match closed indices.\n \n `hidden`::\n-Expansion of wildcards will include hidden indices.\n-Must be combined with `open`, `closed`, or both.\n+Match hidden data streams and hidden indices. Must be combined with `open`,\n+`closed`, or both.", "originalCommit": "def8366c643a0db5a2e35d4f106244aa914295b8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTQ4MDUxOQ==", "url": "https://github.com/elastic/elasticsearch/pull/65862#discussion_r555480519", "bodyText": "To address this in 04cd440, I added a new definition specifically for the data stream APIs.", "author": "jrodewig", "createdAt": "2021-01-12T03:02:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTQxNjY5MA=="}], "type": "inlineReview"}, {"oid": "04cd44009a2f27b9f2ef93f1125d5f17edd76a13", "url": "https://github.com/elastic/elasticsearch/commit/04cd44009a2f27b9f2ef93f1125d5f17edd76a13", "message": "Add separate def for DS expand wildcards", "committedDate": "2021-01-12T02:59:20Z", "type": "commit"}, {"oid": "477cbd0ab0cdf713eb7fb03dee0d4fcf5116c4c8", "url": "https://github.com/elastic/elasticsearch/commit/477cbd0ab0cdf713eb7fb03dee0d4fcf5116c4c8", "message": "Consistent wording", "committedDate": "2021-01-12T03:01:10Z", "type": "commit"}, {"oid": "d3472d533afe2a8d791c293e4011ed1670eca587", "url": "https://github.com/elastic/elasticsearch/commit/d3472d533afe2a8d791c293e4011ed1670eca587", "message": "Update DS expand wildcards def", "committedDate": "2021-01-12T14:18:05Z", "type": "commit"}, {"oid": "c4521e01bd39de4d127c68858d799f396d4075f8", "url": "https://github.com/elastic/elasticsearch/commit/c4521e01bd39de4d127c68858d799f396d4075f8", "message": "Condense values", "committedDate": "2021-01-12T14:19:16Z", "type": "commit"}, {"oid": "a489215ac07251ae4db7957b4600bee878c29ea0", "url": "https://github.com/elastic/elasticsearch/commit/a489215ac07251ae4db7957b4600bee878c29ea0", "message": "Reword", "committedDate": "2021-01-12T14:20:00Z", "type": "commit"}, {"oid": "493720624c30e5a3e11630c58e05829822d3234e", "url": "https://github.com/elastic/elasticsearch/commit/493720624c30e5a3e11630c58e05829822d3234e", "message": "Remove fragment", "committedDate": "2021-01-13T13:47:37Z", "type": "commit"}]}