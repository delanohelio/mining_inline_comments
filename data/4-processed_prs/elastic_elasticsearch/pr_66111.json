{"pr_number": 66111, "pr_title": "[DOCS] Fix timeout parameter defaults", "pr_createdAt": "2020-12-09T15:03:44Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/66111", "timeline": [{"oid": "3fd87b3e0eb248401f6dc68678cdfa55b982d679", "url": "https://github.com/elastic/elasticsearch/commit/3fd87b3e0eb248401f6dc68678cdfa55b982d679", "message": "[DOCS] Fix timeout parameter defaults", "committedDate": "2020-12-09T14:58:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTM5MDQzNQ==", "url": "https://github.com/elastic/elasticsearch/pull/66111#discussion_r539390435", "bodyText": "I'd like to get confirmation on this default. I had a hard time tracing/parsing it:\n\n  \n    \n      elasticsearch/server/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestClusterStatsAction.java\n    \n    \n         Line 50\n      in\n      0b536a7\n    \n    \n    \n    \n\n        \n          \n           clusterStatsRequest.timeout(request.param(\"timeout\")); \n        \n    \n  \n\n\nGoes to:\n\n  \n    \n      elasticsearch/server/src/main/java/org/elasticsearch/action/admin/cluster/stats/ClusterStatsRequest.java\n    \n    \n         Line 31\n      in\n      41b2b2e\n    \n    \n    \n    \n\n        \n          \n           public class ClusterStatsRequest extends BaseNodesRequest<ClusterStatsRequest> { \n        \n    \n  \n\n\nGoes to:\n\n  \n    \n      elasticsearch/server/src/main/java/org/elasticsearch/action/support/nodes/BaseNodesRequest.java\n    \n    \n         Line 91\n      in\n      41b2b2e\n    \n    \n    \n    \n\n        \n          \n           this.timeout = TimeValue.parseTimeValue(timeout, null, getClass().getSimpleName() + \".timeout\"); \n        \n    \n  \n\n\nI interpreted this as no default timeout, but it's very possible I'm incorrect.", "author": "jrodewig", "createdAt": "2020-12-09T15:14:12Z", "path": "docs/reference/cluster/stats.asciidoc", "diffHunk": "@@ -34,7 +34,10 @@ include::{es-repo-dir}/rest-api/common-parms.asciidoc[tag=node-filter]\n [[cluster-stats-api-query-params]]\n ==== {api-query-parms-title}\n \n-include::{es-repo-dir}/rest-api/common-parms.asciidoc[tag=timeout]\n+`timeout`::\n+(Optional, <<time-units, time units>>) Time period to wait for\n+a response. If no response is received before the timeout expires, the request\n+fails and returns an error. Defaults to no timeout.", "originalCommit": "3fd87b3e0eb248401f6dc68678cdfa55b982d679", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTM5NTkyNw==", "url": "https://github.com/elastic/elasticsearch/pull/66111#discussion_r539395927", "bodyText": "Meant to tag @jbaiera ^", "author": "jrodewig", "createdAt": "2020-12-09T15:20:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTM5MDQzNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDA1NzExNg==", "url": "https://github.com/elastic/elasticsearch/pull/66111#discussion_r540057116", "bodyText": "I believe you are right.\nThe timeout here is for getting a stats response from the nodes in the cluster. It should respond 200 OK also when some of the nodes time out.", "author": "henningandersen", "createdAt": "2020-12-10T10:34:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTM5MDQzNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTM5NDE1NA==", "url": "https://github.com/elastic/elasticsearch/pull/66111#discussion_r539394154", "bodyText": "Previously, these tags were pulling the master_timeout query param into several APIs that didn't support it.", "author": "jrodewig", "createdAt": "2020-12-09T15:18:30Z", "path": "docs/reference/rest-api/common-parms.asciidoc", "diffHunk": "@@ -1005,17 +1005,16 @@ Unit used to display time values.\n end::time[]\n \n tag::timeoutparms[]\n-\n-tag::timeout[]\n tag::master-timeout[]\n `master_timeout`::\n-(Optional, <<time-units, time units>>) Specifies the period of time to wait for\n+(Optional, <<time-units, time units>>) Time period to wait for\n a connection to the master node. If no response is received before the timeout\n expires, the request fails and returns an error. Defaults to `30s`.\n end::master-timeout[]\n \n+tag::timeout[]\n `timeout`::\n-(Optional, <<time-units, time units>>) Specifies the period of time to wait for\n+(Optional, <<time-units, time units>>) Time period to wait for\n a response. If no response is received before the timeout expires, the request\n fails and returns an error. Defaults to `30s`.\n end::timeout[]", "originalCommit": "3fd87b3e0eb248401f6dc68678cdfa55b982d679", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDA0NDYwOQ==", "url": "https://github.com/elastic/elasticsearch/pull/66111#discussion_r540044609", "bodyText": "This timeout is unlike other timeouts. It is passed to the underlying bulk requests. See my comment on bulk.", "author": "henningandersen", "createdAt": "2020-12-10T10:15:52Z", "path": "docs/reference/docs/reindex.asciidoc", "diffHunk": "@@ -436,7 +436,10 @@ POST _reindex\n \n include::{es-repo-dir}/rest-api/common-parms.asciidoc[tag=refresh]\n \n-include::{es-repo-dir}/rest-api/common-parms.asciidoc[tag=timeout]\n+`timeout`::\n+(Optional, <<time-units, time units>>) Time period to wait for", "originalCommit": "3fd87b3e0eb248401f6dc68678cdfa55b982d679", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDA1MTQ0NA==", "url": "https://github.com/elastic/elasticsearch/pull/66111#discussion_r540051444", "bodyText": "This is passed to bulk and has same semantics (except dynamic mapping update and auto-create index does not apply for deletes).", "author": "henningandersen", "createdAt": "2020-12-10T10:25:54Z", "path": "docs/reference/docs/delete.asciidoc", "diffHunk": "@@ -155,7 +155,10 @@ include::{es-repo-dir}/rest-api/common-parms.asciidoc[tag=refresh]\n \n include::{es-repo-dir}/rest-api/common-parms.asciidoc[tag=routing]\n \n-include::{es-repo-dir}/rest-api/common-parms.asciidoc[tag=timeout]\n+`timeout`::\n+(Optional, <<time-units, time units>>) Time period to wait for", "originalCommit": "3fd87b3e0eb248401f6dc68678cdfa55b982d679", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDA1MjI2MQ==", "url": "https://github.com/elastic/elasticsearch/pull/66111#discussion_r540052261", "bodyText": "The timeout is only used for waiting for active shards, auto-index creation (not relevant for delete though, that does not auto-create) or waiting for dynamic mapping updates. There is (currently) no timeout for regular indexing.", "author": "henningandersen", "createdAt": "2020-12-10T10:27:00Z", "path": "docs/reference/docs/bulk.asciidoc", "diffHunk": "@@ -219,7 +219,10 @@ include::{es-repo-dir}/rest-api/common-parms.asciidoc[tag=source_excludes]\n \n include::{es-repo-dir}/rest-api/common-parms.asciidoc[tag=source_includes]\n \n-include::{es-repo-dir}/rest-api/common-parms.asciidoc[tag=timeout]\n+`timeout`::\n+(Optional, <<time-units, time units>>) Time period to wait for", "originalCommit": "3fd87b3e0eb248401f6dc68678cdfa55b982d679", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDA1MzY2MQ==", "url": "https://github.com/elastic/elasticsearch/pull/66111#discussion_r540053661", "bodyText": "This timeout is unlike other timeouts. It is passed to the underlying bulk requests. See my comment on bulk (and delete).", "author": "henningandersen", "createdAt": "2020-12-10T10:29:00Z", "path": "docs/reference/docs/delete-by-query.asciidoc", "diffHunk": "@@ -229,7 +229,10 @@ include::{es-repo-dir}/rest-api/common-parms.asciidoc[tag=stats]\n \n include::{es-repo-dir}/rest-api/common-parms.asciidoc[tag=terminate_after]\n \n-include::{es-repo-dir}/rest-api/common-parms.asciidoc[tag=timeout]\n+`timeout`::\n+(Optional, <<time-units, time units>>) Time period to wait for", "originalCommit": "3fd87b3e0eb248401f6dc68678cdfa55b982d679", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "c386e7ae82093839f488c14536c81afb62db25d8", "url": "https://github.com/elastic/elasticsearch/commit/c386e7ae82093839f488c14536c81afb62db25d8", "message": "Update timeout defs", "committedDate": "2020-12-10T17:50:47Z", "type": "commit"}, {"oid": "c216aaab944440471bcd59ad3bb2dc749a62b3be", "url": "https://github.com/elastic/elasticsearch/commit/c216aaab944440471bcd59ad3bb2dc749a62b3be", "message": "Consistent wording and whitespace", "committedDate": "2020-12-10T17:57:06Z", "type": "commit"}, {"oid": "126aaa80940819fd2f24772b3c531efd6d6a136f", "url": "https://github.com/elastic/elasticsearch/commit/126aaa80940819fd2f24772b3c531efd6d6a136f", "message": "Consistent wording", "committedDate": "2020-12-10T17:57:35Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDM4MTA4NQ==", "url": "https://github.com/elastic/elasticsearch/pull/66111#discussion_r540381085", "bodyText": "I don't believe that an update-by-query can trigger automatic index creation.", "author": "jrodewig", "createdAt": "2020-12-10T17:59:29Z", "path": "docs/reference/docs/update-by-query.asciidoc", "diffHunk": "@@ -229,7 +229,17 @@ include::{es-repo-dir}/rest-api/common-parms.asciidoc[tag=stats]\n \n include::{es-repo-dir}/rest-api/common-parms.asciidoc[tag=terminate_after]\n \n-include::{es-repo-dir}/rest-api/common-parms.asciidoc[tag=timeout]\n+`timeout`::\n++\n+--\n+(Optional, <<time-units, time units>>)\n+Period each update request waits for the following operations:\n+\n+* Dynamic mapping updates\n+* <<index-wait-for-active-shards,Waiting for active shards>>\n+", "originalCommit": "126aaa80940819fd2f24772b3c531efd6d6a136f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjYyNzQwMw==", "url": "https://github.com/elastic/elasticsearch/pull/66111#discussion_r546627403", "bodyText": "\ud83d\udc4d", "author": "henningandersen", "createdAt": "2020-12-21T10:28:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDM4MTA4NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDM4MTQxNQ==", "url": "https://github.com/elastic/elasticsearch/pull/66111#discussion_r540381415", "bodyText": "Same as above. I don't think an update request can trigger automatic index creation.", "author": "jrodewig", "createdAt": "2020-12-10T17:59:56Z", "path": "docs/reference/docs/update.asciidoc", "diffHunk": "@@ -73,7 +73,17 @@ You can also specify a comma-separated list of the fields you want to retrieve.\n `_source_includes`::\n (Optional, list) Specify the source fields you want to retrieve.\n \n-include::{es-repo-dir}/rest-api/common-parms.asciidoc[tag=timeoutparms]\n+`timeout`::\n++\n+--\n+(Optional, <<time-units, time units>>)\n+Period to wait for the following operations:\n+\n+* <<dynamic-mapping,Dynamic mapping>> updates\n+* <<index-wait-for-active-shards,Waiting for active shards>>", "originalCommit": "126aaa80940819fd2f24772b3c531efd6d6a136f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjYxNjE3OA==", "url": "https://github.com/elastic/elasticsearch/pull/66111#discussion_r546616178", "bodyText": "The timeout is used when reaching out to all nodes in the cluster, setting a timeout per node. If any of the nodes fail to respond within the timeout, the stats from that node is left out of the response. A failure indication is embedded into the response in the _nodes field.\n\nthe request fails and returns an error.\n\nI think this is incorrect or at least imprecise. The request succeeds but includes information about nodes that failed to respond.", "author": "henningandersen", "createdAt": "2020-12-21T10:05:32Z", "path": "docs/reference/cluster/stats.asciidoc", "diffHunk": "@@ -34,7 +34,10 @@ include::{es-repo-dir}/rest-api/common-parms.asciidoc[tag=node-filter]\n [[cluster-stats-api-query-params]]\n ==== {api-query-parms-title}\n \n-include::{es-repo-dir}/rest-api/common-parms.asciidoc[tag=timeout]\n+`timeout`::\n+(Optional, <<time-units, time units>>)\n+Period to wait for a response. If no response is received before the timeout\n+expires, the request fails and returns an error. Defaults to no timeout.", "originalCommit": "126aaa80940819fd2f24772b3c531efd6d6a136f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjYyNDQyNA==", "url": "https://github.com/elastic/elasticsearch/pull/66111#discussion_r546624424", "bodyText": "While correct, I think we should define this a bit more loosely to be able to change this without calling it a breaking change. Something like:\nDefaults to `1m` (one minute). This guarantees that {es} will wait for at least the timeout before failing, but the actual wait time could be longer (in particular when multiple waits occur).", "author": "henningandersen", "createdAt": "2020-12-21T10:22:13Z", "path": "docs/reference/docs/bulk.asciidoc", "diffHunk": "@@ -219,7 +219,18 @@ include::{es-repo-dir}/rest-api/common-parms.asciidoc[tag=source_excludes]\n \n include::{es-repo-dir}/rest-api/common-parms.asciidoc[tag=source_includes]\n \n-include::{es-repo-dir}/rest-api/common-parms.asciidoc[tag=timeout]\n+`timeout`::\n++\n+--\n+(Optional, <<time-units, time units>>)\n+Period each action waits for the following operations:\n+\n+* <<index-creation,Automatic index creation>>\n+* <<dynamic-mapping,Dynamic mapping>> updates\n+* <<index-wait-for-active-shards,Waiting for active shards>>\n+\n+The timeout applies to each operation separately. Defaults to `1m` (one minute).", "originalCommit": "126aaa80940819fd2f24772b3c531efd6d6a136f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjYyNTQ3OA==", "url": "https://github.com/elastic/elasticsearch/pull/66111#discussion_r546625478", "bodyText": "This is really the same timeout as under bulk, I suggest to copy the same text here.", "author": "henningandersen", "createdAt": "2020-12-21T10:24:25Z", "path": "docs/reference/docs/index_.asciidoc", "diffHunk": "@@ -86,7 +86,9 @@ include::{es-repo-dir}/rest-api/common-parms.asciidoc[tag=refresh]\n \n include::{es-repo-dir}/rest-api/common-parms.asciidoc[tag=routing]\n \n-include::{es-repo-dir}/rest-api/common-parms.asciidoc[tag=timeoutparms]\n+`timeout`::\n+Period to wait for a response. If no response is received before the timeout", "originalCommit": "126aaa80940819fd2f24772b3c531efd6d6a136f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjYyNTc4MQ==", "url": "https://github.com/elastic/elasticsearch/pull/66111#discussion_r546625781", "bodyText": "Same comment on loosening the statement a bit as for bulk.", "author": "henningandersen", "createdAt": "2020-12-21T10:25:02Z", "path": "docs/reference/docs/reindex.asciidoc", "diffHunk": "@@ -436,7 +436,18 @@ POST _reindex\n \n include::{es-repo-dir}/rest-api/common-parms.asciidoc[tag=refresh]\n \n-include::{es-repo-dir}/rest-api/common-parms.asciidoc[tag=timeout]\n+`timeout`::\n++\n+--\n+(Optional, <<time-units, time units>>)\n+Period each indexing request waits for the following operations:\n+\n+* <<index-creation,Automatic index creation>>\n+* <<dynamic-mapping,Dynamic mapping>> updates\n+* <<index-wait-for-active-shards,Waiting for active shards>>\n+\n+The timeout applies to each operation separately. Defaults to `1m` (one minute).", "originalCommit": "126aaa80940819fd2f24772b3c531efd6d6a136f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjYyNzYwNQ==", "url": "https://github.com/elastic/elasticsearch/pull/66111#discussion_r546627605", "bodyText": "Same comment on loosening this as for bulk requests.", "author": "henningandersen", "createdAt": "2020-12-21T10:28:29Z", "path": "docs/reference/docs/update-by-query.asciidoc", "diffHunk": "@@ -229,7 +229,17 @@ include::{es-repo-dir}/rest-api/common-parms.asciidoc[tag=stats]\n \n include::{es-repo-dir}/rest-api/common-parms.asciidoc[tag=terminate_after]\n \n-include::{es-repo-dir}/rest-api/common-parms.asciidoc[tag=timeout]\n+`timeout`::\n++\n+--\n+(Optional, <<time-units, time units>>)\n+Period each update request waits for the following operations:\n+\n+* Dynamic mapping updates\n+* <<index-wait-for-active-shards,Waiting for active shards>>\n+\n+The timeout applies to each operation separately. Defaults to `1m` (one minute).", "originalCommit": "126aaa80940819fd2f24772b3c531efd6d6a136f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjYyNzgyMA==", "url": "https://github.com/elastic/elasticsearch/pull/66111#discussion_r546627820", "bodyText": "Same comment as for bulk about loosening this statement.", "author": "henningandersen", "createdAt": "2020-12-21T10:28:58Z", "path": "docs/reference/docs/update.asciidoc", "diffHunk": "@@ -73,7 +73,17 @@ You can also specify a comma-separated list of the fields you want to retrieve.\n `_source_includes`::\n (Optional, list) Specify the source fields you want to retrieve.\n \n-include::{es-repo-dir}/rest-api/common-parms.asciidoc[tag=timeoutparms]\n+`timeout`::\n++\n+--\n+(Optional, <<time-units, time units>>)\n+Period to wait for the following operations:\n+\n+* <<dynamic-mapping,Dynamic mapping>> updates\n+* <<index-wait-for-active-shards,Waiting for active shards>>\n+\n+The timeout applies to each operation separately. Defaults to `1m` (one minute).", "originalCommit": "126aaa80940819fd2f24772b3c531efd6d6a136f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "536058985467b5a5a538c7787a931b9c1414d773", "url": "https://github.com/elastic/elasticsearch/commit/536058985467b5a5a538c7787a931b9c1414d773", "message": "Review feedback", "committedDate": "2020-12-21T13:44:14Z", "type": "commit"}, {"oid": "5170431c86196ec1975559592a24eacf91c11316", "url": "https://github.com/elastic/elasticsearch/commit/5170431c86196ec1975559592a24eacf91c11316", "message": "Reword", "committedDate": "2020-12-21T13:46:17Z", "type": "commit"}]}