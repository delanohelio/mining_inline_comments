{"pr_number": 53410, "pr_title": "Create set-based interface for NodesInfoRequest", "pr_createdAt": "2020-03-11T13:54:46Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/53410", "timeline": [{"oid": "568e79db1b3e6567b77cefe8e7e6e50fb3a4948d", "url": "https://github.com/elastic/elasticsearch/commit/568e79db1b3e6567b77cefe8e7e6e50fb3a4948d", "message": "Add set-based API to NodesInfoRequest\n\nThis commit begins the work of removing the \"hard-coded\" metric getters\nand setters from the NodesInfoRequest classes. We start by providing new\nflexible getters and setters. We then update the test classes to remove\nthe old getters, and then remove those getters.", "committedDate": "2020-03-10T20:17:53Z", "type": "commit"}, {"oid": "6fe9d71c21542eb279c8c994134fa325b44b0d09", "url": "https://github.com/elastic/elasticsearch/commit/6fe9d71c21542eb279c8c994134fa325b44b0d09", "message": "Protect against unknown metric names\n\nThrow an IllegalStateException if an unknown metric is added or removed.\n\nReplace some of the infrequently used setters.", "committedDate": "2020-03-10T20:17:53Z", "type": "commit"}, {"oid": "a3035ff77ccb069a7d61e5f5efbce315160c6b74", "url": "https://github.com/elastic/elasticsearch/commit/a3035ff77ccb069a7d61e5f5efbce315160c6b74", "message": "Remove old getters and some magic strings", "committedDate": "2020-03-10T20:17:53Z", "type": "commit"}, {"oid": "4e5083dc625a56cc8d880a84b8d1d74e280c6f95", "url": "https://github.com/elastic/elasticsearch/commit/4e5083dc625a56cc8d880a84b8d1d74e280c6f95", "message": "Cleanup", "committedDate": "2020-03-10T20:17:53Z", "type": "commit"}, {"oid": "aba731fc2e729b682f4405df2a59338506d6dddd", "url": "https://github.com/elastic/elasticsearch/commit/aba731fc2e729b682f4405df2a59338506d6dddd", "message": "Add test coverage", "committedDate": "2020-03-10T20:17:53Z", "type": "commit"}, {"oid": "112679a5431e9bd1e3a8e3095568c591845d9790", "url": "https://github.com/elastic/elasticsearch/commit/112679a5431e9bd1e3a8e3095568c591845d9790", "message": "Singularize enum name", "committedDate": "2020-03-10T20:20:27Z", "type": "commit"}, {"oid": "9d001d1a3bcf3cdd0a6716e5b041301ac29a42a0", "url": "https://github.com/elastic/elasticsearch/commit/9d001d1a3bcf3cdd0a6716e5b041301ac29a42a0", "message": "Remove TODO comment", "committedDate": "2020-03-10T20:32:27Z", "type": "commit"}, {"oid": "f3baadaa2f5600e087f8966949e6041731894b63", "url": "https://github.com/elastic/elasticsearch/commit/f3baadaa2f5600e087f8966949e6041731894b63", "message": "Add an addMetrics(String...) method\n\nBased on some of the refactoring I'm doing, it seems like it's\nconvenient to be have an addMetrics(String ...) method.\n\nAlso add some more test coverage.", "committedDate": "2020-03-10T20:49:53Z", "type": "commit"}, {"oid": "4c6c40d29d8b09fab0accc5375d8cc08b0a453a6", "url": "https://github.com/elastic/elasticsearch/commit/4c6c40d29d8b09fab0accc5375d8cc08b0a453a6", "message": "Add TODO for further work", "committedDate": "2020-03-11T13:43:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDk4NzUyNA==", "url": "https://github.com/elastic/elasticsearch/pull/53410#discussion_r390987524", "bodyText": "This method is now only used for backwards-compatible deserialization, and doesn't need to be able to remove metrics anymore.", "author": "williamrandolph", "createdAt": "2020-03-11T13:56:31Z", "path": "server/src/main/java/org/elasticsearch/action/admin/cluster/node/info/NodesInfoRequest.java", "diffHunk": "@@ -84,174 +85,68 @@ public NodesInfoRequest clear() {\n      * Sets to return all the data.\n      */\n     public NodesInfoRequest all() {\n-        requestedMetrics.addAll(Metrics.allMetrics());\n+        requestedMetrics.addAll(Metric.allMetrics());\n         return this;\n     }\n \n     /**\n-     * Should the node settings be returned.\n+     * Get the names of requested metrics\n      */\n-    public boolean settings() {\n-        return Metrics.SETTINGS.containedIn(requestedMetrics);\n+    public Set<String> requestedMetrics() {\n+        return Set.copyOf(requestedMetrics);\n     }\n \n     /**\n-     * Should the node settings be returned.\n+     * Add metric\n      */\n-    public NodesInfoRequest settings(boolean settings) {\n-        addOrRemoveMetric(settings, Metrics.SETTINGS.metricName());\n-        return this;\n-    }\n-\n-    /**\n-     * Should the node OS be returned.\n-     */\n-    public boolean os() {\n-        return Metrics.OS.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Should the node OS be returned.\n-     */\n-    public NodesInfoRequest os(boolean os) {\n-        addOrRemoveMetric(os, Metrics.OS.metricName());\n-        return this;\n-    }\n-\n-    /**\n-     * Should the node Process be returned.\n-     */\n-    public boolean process() {\n-        return Metrics.PROCESS.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Should the node Process be returned.\n-     */\n-    public NodesInfoRequest process(boolean process) {\n-        addOrRemoveMetric(process, Metrics.PROCESS.metricName());\n-        return this;\n-    }\n-\n-    /**\n-     * Should the node JVM be returned.\n-     */\n-    public boolean jvm() {\n-        return Metrics.JVM.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Should the node JVM be returned.\n-     */\n-    public NodesInfoRequest jvm(boolean jvm) {\n-        addOrRemoveMetric(jvm, Metrics.JVM.metricName());\n-        return this;\n-    }\n-\n-    /**\n-     * Should the node Thread Pool info be returned.\n-     */\n-    public boolean threadPool() {\n-        return Metrics.THREAD_POOL.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Should the node Thread Pool info be returned.\n-     */\n-    public NodesInfoRequest threadPool(boolean threadPool) {\n-        addOrRemoveMetric(threadPool, Metrics.THREAD_POOL.metricName());\n-        return this;\n-    }\n-\n-    /**\n-     * Should the node Transport be returned.\n-     */\n-    public boolean transport() {\n-        return Metrics.TRANSPORT.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Should the node Transport be returned.\n-     */\n-    public NodesInfoRequest transport(boolean transport) {\n-        addOrRemoveMetric(transport, Metrics.TRANSPORT.metricName());\n-        return this;\n-    }\n-\n-    /**\n-     * Should the node HTTP be returned.\n-     */\n-    public boolean http() {\n-        return Metrics.HTTP.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Should the node HTTP be returned.\n-     */\n-    public NodesInfoRequest http(boolean http) {\n-        addOrRemoveMetric(http, Metrics.HTTP.metricName());\n+    public NodesInfoRequest addMetric(String metric) {\n+        if (Metric.allMetrics().contains(metric) == false) {\n+            throw new IllegalStateException(\"Used an illegal metric: \" + metric);\n+        }\n+        requestedMetrics.add(metric);\n         return this;\n     }\n \n     /**\n-     * Should information about plugins be returned\n-     * @param plugins true if you want info\n-     * @return The request\n+     * Add collection of metrics\n      */\n-    public NodesInfoRequest plugins(boolean plugins) {\n-        addOrRemoveMetric(plugins, Metrics.PLUGINS.metricName());\n+    public NodesInfoRequest addMetrics(Collection<String> metrics) {\n+        if (Metric.allMetrics().containsAll(metrics) == false) {\n+            throw new IllegalStateException(\"Used an illegal metric: \" + metrics);\n+        }\n+        requestedMetrics.addAll(metrics);\n         return this;\n     }\n \n     /**\n-     * @return true if information about plugins is requested\n+     * Add String array of metrics\n      */\n-    public boolean plugins() {\n-        return Metrics.PLUGINS.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Should information about ingest be returned\n-     * @param ingest true if you want info\n-     */\n-    public NodesInfoRequest ingest(boolean ingest) {\n-        addOrRemoveMetric(ingest, Metrics.INGEST.metricName());\n+    public NodesInfoRequest addMetrics(String... metrics) {\n+        addMetrics(Arrays.stream(metrics).collect(Collectors.toSet()));\n         return this;\n     }\n \n     /**\n-     * @return true if information about ingest is requested\n+     * Remove metric\n      */\n-    public boolean ingest() {\n-        return Metrics.INGEST.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Should information about indices (currently just indexing buffers) be returned\n-     * @param indices true if you want info\n-     */\n-    public NodesInfoRequest indices(boolean indices) {\n-        addOrRemoveMetric(indices, Metrics.INDICES.metricName());\n+    public NodesInfoRequest removeMetric(String metric) {\n+        if (Metric.allMetrics().contains(metric) == false) {\n+            throw new IllegalStateException(\"Used an illegal metric: \" + metric);\n+        }\n+        requestedMetrics.remove(metric);\n         return this;\n     }\n \n     /**\n-     * @return true if information about indices (currently just indexing buffers)\n-     */\n-    public boolean indices() {\n-        return Metrics.INDICES.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Helper method for adding and removing metrics.\n-     * @param includeMetric Whether or not to include a metric.\n+     * Helper method for adding and removing metrics. Used when deserializing\n+     * a NodesInfoRequest from an ordered list of booleans.\n+     *\n+     * @param addMetric Whether or not to include a metric.\n      * @param metricName Name of the metric to include or remove.\n      */\n-    private void addOrRemoveMetric(boolean includeMetric, String metricName) {\n-        if (includeMetric) {\n+    private void optionallyAddMetric(boolean addMetric, String metricName) {", "originalCommit": "4c6c40d29d8b09fab0accc5375d8cc08b0a453a6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTM1ODUyMA==", "url": "https://github.com/elastic/elasticsearch/pull/53410#discussion_r391358520", "bodyText": "Ah, this change leads to a bwc problem. I'm going to make a separate PR to handle the bwc aspects of this, for simplicity.", "author": "williamrandolph", "createdAt": "2020-03-12T01:34:27Z", "path": "server/src/main/java/org/elasticsearch/action/admin/cluster/node/info/NodesInfoRequest.java", "diffHunk": "@@ -281,12 +176,12 @@ public void writeTo(StreamOutput out) throws IOException {\n      * from the nodes information endpoint. Eventually this list list will be\n      * pluggable.\n      */\n-    enum Metrics {\n+    public enum Metric {\n         SETTINGS(\"settings\"),\n         OS(\"os\"),\n         PROCESS(\"process\"),\n         JVM(\"jvm\"),\n-        THREAD_POOL(\"threadPool\"),\n+        THREAD_POOL(\"thread_pool\"),", "originalCommit": "4c6c40d29d8b09fab0accc5375d8cc08b0a453a6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTg1MDc3Mw==", "url": "https://github.com/elastic/elasticsearch/pull/53410#discussion_r391850773", "bodyText": "Why do we need 2 variants of this method?", "author": "rjernst", "createdAt": "2020-03-12T19:43:06Z", "path": "server/src/main/java/org/elasticsearch/action/admin/cluster/node/info/NodesInfoRequest.java", "diffHunk": "@@ -84,174 +85,68 @@ public NodesInfoRequest clear() {\n      * Sets to return all the data.\n      */\n     public NodesInfoRequest all() {\n-        requestedMetrics.addAll(Metrics.allMetrics());\n+        requestedMetrics.addAll(Metric.allMetrics());\n         return this;\n     }\n \n     /**\n-     * Should the node settings be returned.\n+     * Get the names of requested metrics\n      */\n-    public boolean settings() {\n-        return Metrics.SETTINGS.containedIn(requestedMetrics);\n+    public Set<String> requestedMetrics() {\n+        return Set.copyOf(requestedMetrics);\n     }\n \n     /**\n-     * Should the node settings be returned.\n+     * Add metric\n      */\n-    public NodesInfoRequest settings(boolean settings) {\n-        addOrRemoveMetric(settings, Metrics.SETTINGS.metricName());\n-        return this;\n-    }\n-\n-    /**\n-     * Should the node OS be returned.\n-     */\n-    public boolean os() {\n-        return Metrics.OS.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Should the node OS be returned.\n-     */\n-    public NodesInfoRequest os(boolean os) {\n-        addOrRemoveMetric(os, Metrics.OS.metricName());\n-        return this;\n-    }\n-\n-    /**\n-     * Should the node Process be returned.\n-     */\n-    public boolean process() {\n-        return Metrics.PROCESS.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Should the node Process be returned.\n-     */\n-    public NodesInfoRequest process(boolean process) {\n-        addOrRemoveMetric(process, Metrics.PROCESS.metricName());\n-        return this;\n-    }\n-\n-    /**\n-     * Should the node JVM be returned.\n-     */\n-    public boolean jvm() {\n-        return Metrics.JVM.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Should the node JVM be returned.\n-     */\n-    public NodesInfoRequest jvm(boolean jvm) {\n-        addOrRemoveMetric(jvm, Metrics.JVM.metricName());\n-        return this;\n-    }\n-\n-    /**\n-     * Should the node Thread Pool info be returned.\n-     */\n-    public boolean threadPool() {\n-        return Metrics.THREAD_POOL.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Should the node Thread Pool info be returned.\n-     */\n-    public NodesInfoRequest threadPool(boolean threadPool) {\n-        addOrRemoveMetric(threadPool, Metrics.THREAD_POOL.metricName());\n-        return this;\n-    }\n-\n-    /**\n-     * Should the node Transport be returned.\n-     */\n-    public boolean transport() {\n-        return Metrics.TRANSPORT.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Should the node Transport be returned.\n-     */\n-    public NodesInfoRequest transport(boolean transport) {\n-        addOrRemoveMetric(transport, Metrics.TRANSPORT.metricName());\n-        return this;\n-    }\n-\n-    /**\n-     * Should the node HTTP be returned.\n-     */\n-    public boolean http() {\n-        return Metrics.HTTP.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Should the node HTTP be returned.\n-     */\n-    public NodesInfoRequest http(boolean http) {\n-        addOrRemoveMetric(http, Metrics.HTTP.metricName());\n+    public NodesInfoRequest addMetric(String metric) {\n+        if (Metric.allMetrics().contains(metric) == false) {\n+            throw new IllegalStateException(\"Used an illegal metric: \" + metric);\n+        }\n+        requestedMetrics.add(metric);\n         return this;\n     }\n \n     /**\n-     * Should information about plugins be returned\n-     * @param plugins true if you want info\n-     * @return The request\n+     * Add collection of metrics\n      */\n-    public NodesInfoRequest plugins(boolean plugins) {\n-        addOrRemoveMetric(plugins, Metrics.PLUGINS.metricName());\n+    public NodesInfoRequest addMetrics(Collection<String> metrics) {\n+        if (Metric.allMetrics().containsAll(metrics) == false) {\n+            throw new IllegalStateException(\"Used an illegal metric: \" + metrics);\n+        }\n+        requestedMetrics.addAll(metrics);\n         return this;\n     }\n \n     /**\n-     * @return true if information about plugins is requested\n+     * Add String array of metrics\n      */\n-    public boolean plugins() {\n-        return Metrics.PLUGINS.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Should information about ingest be returned\n-     * @param ingest true if you want info\n-     */\n-    public NodesInfoRequest ingest(boolean ingest) {\n-        addOrRemoveMetric(ingest, Metrics.INGEST.metricName());\n+    public NodesInfoRequest addMetrics(String... metrics) {", "originalCommit": "4c6c40d29d8b09fab0accc5375d8cc08b0a453a6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTg5NDAzNg==", "url": "https://github.com/elastic/elasticsearch/pull/53410#discussion_r391894036", "bodyText": "This one made some of the invocations \"look cleaner\" to me, but it's not at all necessary and I'm fine with removing it.", "author": "williamrandolph", "createdAt": "2020-03-12T21:07:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTg1MDc3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjIzNjIwMw==", "url": "https://github.com/elastic/elasticsearch/pull/53410#discussion_r392236203", "bodyText": "I've removed it.", "author": "williamrandolph", "createdAt": "2020-03-13T13:45:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTg1MDc3Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTg1MTY0NA==", "url": "https://github.com/elastic/elasticsearch/pull/53410#discussion_r391851644", "bodyText": "Aren't unknown metrics an error case?", "author": "rjernst", "createdAt": "2020-03-12T19:44:57Z", "path": "server/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestNodesInfoAction.java", "diffHunk": "@@ -108,16 +98,9 @@ static NodesInfoRequest prepareRequest(final RestRequest request) {\n             nodesInfoRequest.all();\n         } else {\n             nodesInfoRequest.clear();\n-            nodesInfoRequest.settings(metrics.contains(\"settings\"));\n-            nodesInfoRequest.os(metrics.contains(\"os\"));\n-            nodesInfoRequest.process(metrics.contains(\"process\"));\n-            nodesInfoRequest.jvm(metrics.contains(\"jvm\"));\n-            nodesInfoRequest.threadPool(metrics.contains(\"thread_pool\"));\n-            nodesInfoRequest.transport(metrics.contains(\"transport\"));\n-            nodesInfoRequest.http(metrics.contains(\"http\"));\n-            nodesInfoRequest.plugins(metrics.contains(\"plugins\"));\n-            nodesInfoRequest.ingest(metrics.contains(\"ingest\"));\n-            nodesInfoRequest.indices(metrics.contains(\"indices\"));\n+            // disregard unknown metrics", "originalCommit": "4c6c40d29d8b09fab0accc5375d8cc08b0a453a6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTg5NTMwMA==", "url": "https://github.com/elastic/elasticsearch/pull/53410#discussion_r391895300", "bodyText": "The current behavior of the Nodes Info API is to silently disregard invalid metrics (or node ids). The Nodes Stats endpoint, on the other hand, will return an error if you request an unknown metric.\nArguably, the Nodes Info API should return an error for unknown metrics, but that would go beyond just refactoring.", "author": "williamrandolph", "createdAt": "2020-03-12T21:09:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTg1MTY0NA=="}], "type": "inlineReview"}, {"oid": "bffdfe667dbd17feb59f22402398bdb10f3a59d5", "url": "https://github.com/elastic/elasticsearch/commit/bffdfe667dbd17feb59f22402398bdb10f3a59d5", "message": "Merge branch 'master' into nodes-info-request-refactor-2", "committedDate": "2020-03-13T13:35:08Z", "type": "commit"}, {"oid": "24f252b8f292331b0eecbea49b7584650a13a00e", "url": "https://github.com/elastic/elasticsearch/commit/24f252b8f292331b0eecbea49b7584650a13a00e", "message": "Remove redundant convenience method", "committedDate": "2020-03-13T13:45:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjQwMjA2NQ==", "url": "https://github.com/elastic/elasticsearch/pull/53410#discussion_r392402065", "bodyText": "I liked having the variatic version. Is there a reason we need a collection version? It would make it easier to read in the rest of the code if the Set building part was isolated to the internals of this method.", "author": "rjernst", "createdAt": "2020-03-13T18:31:01Z", "path": "server/src/main/java/org/elasticsearch/action/admin/cluster/node/info/NodesInfoRequest.java", "diffHunk": "@@ -84,174 +85,60 @@ public NodesInfoRequest clear() {\n      * Sets to return all the data.\n      */\n     public NodesInfoRequest all() {\n-        requestedMetrics.addAll(Metrics.allMetrics());\n+        requestedMetrics.addAll(Metric.allMetrics());\n         return this;\n     }\n \n     /**\n-     * Should the node settings be returned.\n+     * Get the names of requested metrics\n      */\n-    public boolean settings() {\n-        return Metrics.SETTINGS.containedIn(requestedMetrics);\n+    public Set<String> requestedMetrics() {\n+        return Set.copyOf(requestedMetrics);\n     }\n \n     /**\n-     * Should the node settings be returned.\n+     * Add metric\n      */\n-    public NodesInfoRequest settings(boolean settings) {\n-        addOrRemoveMetric(settings, Metrics.SETTINGS.metricName());\n-        return this;\n-    }\n-\n-    /**\n-     * Should the node OS be returned.\n-     */\n-    public boolean os() {\n-        return Metrics.OS.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Should the node OS be returned.\n-     */\n-    public NodesInfoRequest os(boolean os) {\n-        addOrRemoveMetric(os, Metrics.OS.metricName());\n-        return this;\n-    }\n-\n-    /**\n-     * Should the node Process be returned.\n-     */\n-    public boolean process() {\n-        return Metrics.PROCESS.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Should the node Process be returned.\n-     */\n-    public NodesInfoRequest process(boolean process) {\n-        addOrRemoveMetric(process, Metrics.PROCESS.metricName());\n-        return this;\n-    }\n-\n-    /**\n-     * Should the node JVM be returned.\n-     */\n-    public boolean jvm() {\n-        return Metrics.JVM.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Should the node JVM be returned.\n-     */\n-    public NodesInfoRequest jvm(boolean jvm) {\n-        addOrRemoveMetric(jvm, Metrics.JVM.metricName());\n-        return this;\n-    }\n-\n-    /**\n-     * Should the node Thread Pool info be returned.\n-     */\n-    public boolean threadPool() {\n-        return Metrics.THREAD_POOL.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Should the node Thread Pool info be returned.\n-     */\n-    public NodesInfoRequest threadPool(boolean threadPool) {\n-        addOrRemoveMetric(threadPool, Metrics.THREAD_POOL.metricName());\n-        return this;\n-    }\n-\n-    /**\n-     * Should the node Transport be returned.\n-     */\n-    public boolean transport() {\n-        return Metrics.TRANSPORT.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Should the node Transport be returned.\n-     */\n-    public NodesInfoRequest transport(boolean transport) {\n-        addOrRemoveMetric(transport, Metrics.TRANSPORT.metricName());\n-        return this;\n-    }\n-\n-    /**\n-     * Should the node HTTP be returned.\n-     */\n-    public boolean http() {\n-        return Metrics.HTTP.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Should the node HTTP be returned.\n-     */\n-    public NodesInfoRequest http(boolean http) {\n-        addOrRemoveMetric(http, Metrics.HTTP.metricName());\n-        return this;\n-    }\n-\n-    /**\n-     * Should information about plugins be returned\n-     * @param plugins true if you want info\n-     * @return The request\n-     */\n-    public NodesInfoRequest plugins(boolean plugins) {\n-        addOrRemoveMetric(plugins, Metrics.PLUGINS.metricName());\n+    public NodesInfoRequest addMetric(String metric) {\n+        if (Metric.allMetrics().contains(metric) == false) {\n+            throw new IllegalStateException(\"Used an illegal metric: \" + metric);\n+        }\n+        requestedMetrics.add(metric);\n         return this;\n     }\n \n     /**\n-     * @return true if information about plugins is requested\n-     */\n-    public boolean plugins() {\n-        return Metrics.PLUGINS.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Should information about ingest be returned\n-     * @param ingest true if you want info\n+     * Add collection of metrics\n      */\n-    public NodesInfoRequest ingest(boolean ingest) {\n-        addOrRemoveMetric(ingest, Metrics.INGEST.metricName());\n+    public NodesInfoRequest addMetrics(Collection<String> metrics) {", "originalCommit": "24f252b8f292331b0eecbea49b7584650a13a00e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjUyODM0Ng==", "url": "https://github.com/elastic/elasticsearch/pull/53410#discussion_r392528346", "bodyText": "That makes sense. I'll swap to the variatic version.", "author": "williamrandolph", "createdAt": "2020-03-13T23:35:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjQwMjA2NQ=="}], "type": "inlineReview"}, {"oid": "c8780fdc001683746b6544edff42f921f5f325cb", "url": "https://github.com/elastic/elasticsearch/commit/c8780fdc001683746b6544edff42f921f5f325cb", "message": "Make setter variatic instead of set-based", "committedDate": "2020-03-16T16:58:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE3ODg3OQ==", "url": "https://github.com/elastic/elasticsearch/pull/53410#discussion_r393178879", "bodyText": "TODO: Fix javadoc for accuracy", "author": "williamrandolph", "createdAt": "2020-03-16T17:05:05Z", "path": "server/src/main/java/org/elasticsearch/action/admin/cluster/node/info/NodesInfoRequest.java", "diffHunk": "@@ -84,174 +88,70 @@ public NodesInfoRequest clear() {\n      * Sets to return all the data.\n      */\n     public NodesInfoRequest all() {\n-        requestedMetrics.addAll(Metrics.allMetrics());\n+        requestedMetrics.addAll(Metric.allMetrics());\n         return this;\n     }\n \n     /**\n-     * Should the node settings be returned.\n+     * Get the names of requested metrics\n      */\n-    public boolean settings() {\n-        return Metrics.SETTINGS.containedIn(requestedMetrics);\n+    public Set<String> requestedMetrics() {\n+        return Set.copyOf(requestedMetrics);\n     }\n \n     /**\n-     * Should the node settings be returned.\n+     * Add metric\n      */\n-    public NodesInfoRequest settings(boolean settings) {\n-        addOrRemoveMetric(settings, Metrics.SETTINGS.metricName());\n-        return this;\n-    }\n-\n-    /**\n-     * Should the node OS be returned.\n-     */\n-    public boolean os() {\n-        return Metrics.OS.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Should the node OS be returned.\n-     */\n-    public NodesInfoRequest os(boolean os) {\n-        addOrRemoveMetric(os, Metrics.OS.metricName());\n-        return this;\n-    }\n-\n-    /**\n-     * Should the node Process be returned.\n-     */\n-    public boolean process() {\n-        return Metrics.PROCESS.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Should the node Process be returned.\n-     */\n-    public NodesInfoRequest process(boolean process) {\n-        addOrRemoveMetric(process, Metrics.PROCESS.metricName());\n-        return this;\n-    }\n-\n-    /**\n-     * Should the node JVM be returned.\n-     */\n-    public boolean jvm() {\n-        return Metrics.JVM.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Should the node JVM be returned.\n-     */\n-    public NodesInfoRequest jvm(boolean jvm) {\n-        addOrRemoveMetric(jvm, Metrics.JVM.metricName());\n-        return this;\n-    }\n-\n-    /**\n-     * Should the node Thread Pool info be returned.\n-     */\n-    public boolean threadPool() {\n-        return Metrics.THREAD_POOL.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Should the node Thread Pool info be returned.\n-     */\n-    public NodesInfoRequest threadPool(boolean threadPool) {\n-        addOrRemoveMetric(threadPool, Metrics.THREAD_POOL.metricName());\n-        return this;\n-    }\n-\n-    /**\n-     * Should the node Transport be returned.\n-     */\n-    public boolean transport() {\n-        return Metrics.TRANSPORT.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Should the node Transport be returned.\n-     */\n-    public NodesInfoRequest transport(boolean transport) {\n-        addOrRemoveMetric(transport, Metrics.TRANSPORT.metricName());\n-        return this;\n-    }\n-\n-    /**\n-     * Should the node HTTP be returned.\n-     */\n-    public boolean http() {\n-        return Metrics.HTTP.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Should the node HTTP be returned.\n-     */\n-    public NodesInfoRequest http(boolean http) {\n-        addOrRemoveMetric(http, Metrics.HTTP.metricName());\n-        return this;\n-    }\n-\n-    /**\n-     * Should information about plugins be returned\n-     * @param plugins true if you want info\n-     * @return The request\n-     */\n-    public NodesInfoRequest plugins(boolean plugins) {\n-        addOrRemoveMetric(plugins, Metrics.PLUGINS.metricName());\n+    public NodesInfoRequest addMetric(String metric) {\n+        if (Metric.allMetrics().contains(metric) == false) {\n+            throw new IllegalStateException(\"Used an illegal metric: \" + metric);\n+        }\n+        requestedMetrics.add(metric);\n         return this;\n     }\n \n     /**\n-     * @return true if information about plugins is requested\n-     */\n-    public boolean plugins() {\n-        return Metrics.PLUGINS.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Should information about ingest be returned\n-     * @param ingest true if you want info\n+     * Add collection of metrics", "originalCommit": "c8780fdc001683746b6544edff42f921f5f325cb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "d3665f95c6d7a37e3d0246b6c9d577264a56ddd3", "url": "https://github.com/elastic/elasticsearch/commit/d3665f95c6d7a37e3d0246b6c9d577264a56ddd3", "message": "Fixup comments and imports", "committedDate": "2020-03-16T18:16:27Z", "type": "commit"}, {"oid": "2f7d1c14769689c188b796caeee3f5a90c1365bc", "url": "https://github.com/elastic/elasticsearch/commit/2f7d1c14769689c188b796caeee3f5a90c1365bc", "message": "Merge branch 'master' into nodes-info-request-refactor-2", "committedDate": "2020-03-16T19:43:40Z", "type": "commit"}, {"oid": "43e8bbe4200273ff8290ba717edee618983b3d01", "url": "https://github.com/elastic/elasticsearch/commit/43e8bbe4200273ff8290ba717edee618983b3d01", "message": "Merge branch 'master' into nodes-info-request-refactor-2", "committedDate": "2020-03-16T22:24:53Z", "type": "commit"}, {"oid": "e3b13906cfcd46a945d451bd7c19005249e89e23", "url": "https://github.com/elastic/elasticsearch/commit/e3b13906cfcd46a945d451bd7c19005249e89e23", "message": "Merge branch 'master' into nodes-info-request-refactor-2", "committedDate": "2020-03-23T22:03:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzQ1MzgxMw==", "url": "https://github.com/elastic/elasticsearch/pull/53410#discussion_r397453813", "bodyText": "This can be simplified in the same way I suggested in the response PR?", "author": "rjernst", "createdAt": "2020-03-24T20:53:27Z", "path": "server/src/main/java/org/elasticsearch/action/admin/cluster/node/info/NodesInfoRequest.java", "diffHunk": "@@ -84,174 +87,70 @@ public NodesInfoRequest clear() {\n      * Sets to return all the data.\n      */\n     public NodesInfoRequest all() {\n-        requestedMetrics.addAll(Metrics.allMetrics());\n+        requestedMetrics.addAll(Metric.allMetrics());\n         return this;\n     }\n \n     /**\n-     * Should the node settings be returned.\n+     * Get the names of requested metrics\n      */\n-    public boolean settings() {\n-        return Metrics.SETTINGS.containedIn(requestedMetrics);\n+    public Set<String> requestedMetrics() {\n+        return Set.copyOf(requestedMetrics);\n     }\n \n     /**\n-     * Should the node settings be returned.\n+     * Add metric\n      */\n-    public NodesInfoRequest settings(boolean settings) {\n-        addOrRemoveMetric(settings, Metrics.SETTINGS.metricName());\n-        return this;\n-    }\n-\n-    /**\n-     * Should the node OS be returned.\n-     */\n-    public boolean os() {\n-        return Metrics.OS.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Should the node OS be returned.\n-     */\n-    public NodesInfoRequest os(boolean os) {\n-        addOrRemoveMetric(os, Metrics.OS.metricName());\n-        return this;\n-    }\n-\n-    /**\n-     * Should the node Process be returned.\n-     */\n-    public boolean process() {\n-        return Metrics.PROCESS.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Should the node Process be returned.\n-     */\n-    public NodesInfoRequest process(boolean process) {\n-        addOrRemoveMetric(process, Metrics.PROCESS.metricName());\n-        return this;\n-    }\n-\n-    /**\n-     * Should the node JVM be returned.\n-     */\n-    public boolean jvm() {\n-        return Metrics.JVM.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Should the node JVM be returned.\n-     */\n-    public NodesInfoRequest jvm(boolean jvm) {\n-        addOrRemoveMetric(jvm, Metrics.JVM.metricName());\n-        return this;\n-    }\n-\n-    /**\n-     * Should the node Thread Pool info be returned.\n-     */\n-    public boolean threadPool() {\n-        return Metrics.THREAD_POOL.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Should the node Thread Pool info be returned.\n-     */\n-    public NodesInfoRequest threadPool(boolean threadPool) {\n-        addOrRemoveMetric(threadPool, Metrics.THREAD_POOL.metricName());\n-        return this;\n-    }\n-\n-    /**\n-     * Should the node Transport be returned.\n-     */\n-    public boolean transport() {\n-        return Metrics.TRANSPORT.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Should the node Transport be returned.\n-     */\n-    public NodesInfoRequest transport(boolean transport) {\n-        addOrRemoveMetric(transport, Metrics.TRANSPORT.metricName());\n-        return this;\n-    }\n-\n-    /**\n-     * Should the node HTTP be returned.\n-     */\n-    public boolean http() {\n-        return Metrics.HTTP.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Should the node HTTP be returned.\n-     */\n-    public NodesInfoRequest http(boolean http) {\n-        addOrRemoveMetric(http, Metrics.HTTP.metricName());\n-        return this;\n-    }\n-\n-    /**\n-     * Should information about plugins be returned\n-     * @param plugins true if you want info\n-     * @return The request\n-     */\n-    public NodesInfoRequest plugins(boolean plugins) {\n-        addOrRemoveMetric(plugins, Metrics.PLUGINS.metricName());\n+    public NodesInfoRequest addMetric(String metric) {\n+        if (Metric.allMetrics().contains(metric) == false) {\n+            throw new IllegalStateException(\"Used an illegal metric: \" + metric);\n+        }\n+        requestedMetrics.add(metric);\n         return this;\n     }\n \n     /**\n-     * @return true if information about plugins is requested\n-     */\n-    public boolean plugins() {\n-        return Metrics.PLUGINS.containedIn(requestedMetrics);\n-    }\n-\n-    /**\n-     * Should information about ingest be returned\n-     * @param ingest true if you want info\n+     * Add multiple metrics\n      */\n-    public NodesInfoRequest ingest(boolean ingest) {\n-        addOrRemoveMetric(ingest, Metrics.INGEST.metricName());\n+    public NodesInfoRequest addMetrics(String... metrics) {\n+        SortedSet<String> illegalMetrics = new TreeSet<>();", "originalCommit": "e3b13906cfcd46a945d451bd7c19005249e89e23", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzQ1NDQwOQ==", "url": "https://github.com/elastic/elasticsearch/pull/53410#discussion_r397454409", "bodyText": "Will do!", "author": "williamrandolph", "createdAt": "2020-03-24T20:54:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzQ1MzgxMw=="}], "type": "inlineReview"}, {"oid": "984d9857b293643c366fe781563fac17d4b7367a", "url": "https://github.com/elastic/elasticsearch/commit/984d9857b293643c366fe781563fac17d4b7367a", "message": "Merge branch 'master' into nodes-info-request-refactor-2", "committedDate": "2020-03-25T00:59:13Z", "type": "commit"}, {"oid": "824e5715eea170f3a5e3e67c2f11a076a2044dec", "url": "https://github.com/elastic/elasticsearch/commit/824e5715eea170f3a5e3e67c2f11a076a2044dec", "message": "Streamline set-checking logic", "committedDate": "2020-03-25T01:06:23Z", "type": "commit"}, {"oid": "014385cb49ed787884b7d756459c9b00385c7174", "url": "https://github.com/elastic/elasticsearch/commit/014385cb49ed787884b7d756459c9b00385c7174", "message": "Remove unused import", "committedDate": "2020-03-25T02:09:40Z", "type": "commit"}, {"oid": "20cccb9e2db6a9cae0913669366c63c48169b641", "url": "https://github.com/elastic/elasticsearch/commit/20cccb9e2db6a9cae0913669366c63c48169b641", "message": "Merge branch 'master' into nodes-info-request-refactor-2", "committedDate": "2020-03-25T03:04:22Z", "type": "commit"}, {"oid": "73ff77644bbf2773d83bdfe851eca3e1f2624b72", "url": "https://github.com/elastic/elasticsearch/commit/73ff77644bbf2773d83bdfe851eca3e1f2624b72", "message": "Merge branch 'master' into nodes-info-request-refactor-2", "committedDate": "2020-03-25T12:58:05Z", "type": "commit"}]}