{"pr_number": 65590, "pr_title": "Remove support of creating CA on the fly when generating certificates", "pr_createdAt": "2020-11-30T11:11:26Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/65590", "timeline": [{"oid": "c554d4eb3f04c25c405ba8f0b4400dce05479a0e", "url": "https://github.com/elastic/elasticsearch/commit/c554d4eb3f04c25c405ba8f0b4400dce05479a0e", "message": "Remove keep-ca-key option for certutil.\n\nGenerating certs now always require a CA to be provided or to be\nself-signed.", "committedDate": "2020-11-30T10:59:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzAzNDY5NQ==", "url": "https://github.com/elastic/elasticsearch/pull/65590#discussion_r543034695", "bodyText": "I would drop the sentence about --self-signed.", "author": "tvernum", "createdAt": "2020-12-15T04:20:40Z", "path": "x-pack/plugin/security/cli/src/main/java/org/elasticsearch/xpack/security/cli/CertificateTool.java", "diffHunk": "@@ -145,6 +146,22 @@ public static void main(String[] args) throws Exception {\n         subcommands.put(\"http\", new HttpCertificateCommand());\n     }\n \n+    @Override\n+    protected void execute(Terminal terminal, OptionSet options) throws Exception {\n+        try {\n+            super.execute(terminal, options);\n+        } catch (OptionException e) {\n+            if (e.options().size() == 1 && e.options().contains(\"keep-ca-key\")) {\n+                throw new UserException(ExitCodes.USAGE,\n+                    \"Generating certificates without providing a CA is no longer supported.\\n\" +\n+                        \"Please first generate a CA with the 'ca' sub-command and provide the ca file \\n\" +\n+                        \"with either --ca or --ca-cert/--ca-key to generate certificates.\\n\" +\n+                        \"Alternatively, you can also generate self-signed certificates with --self-signed.\");", "originalCommit": "c554d4eb3f04c25c405ba8f0b4400dce05479a0e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "16d51d3c0b292c33aee76531c4a21a0698204f71", "url": "https://github.com/elastic/elasticsearch/commit/16d51d3c0b292c33aee76531c4a21a0698204f71", "message": "address feedback", "committedDate": "2020-12-16T00:43:21Z", "type": "commit"}, {"oid": "36b9acbc2a84bc7f108dd5716e1674190de35140", "url": "https://github.com/elastic/elasticsearch/commit/36b9acbc2a84bc7f108dd5716e1674190de35140", "message": "Merge remote-tracking branch 'origin/master' into es-61884-certutil-remove-no-ca", "committedDate": "2020-12-16T00:43:25Z", "type": "commit"}]}