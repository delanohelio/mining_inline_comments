{"pr_number": 63748, "pr_title": "[DOCS] EQL: Update `allow_no_indices` default", "pr_createdAt": "2020-10-15T14:47:28Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/63748", "timeline": [{"oid": "3a2c251be85037ce2871693b5f3c42b43b7b0abd", "url": "https://github.com/elastic/elasticsearch/commit/3a2c251be85037ce2871693b5f3c42b43b7b0abd", "message": "[DOCS] EQL: Update `allow_no_indices` default", "committedDate": "2020-10-15T14:46:38Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTYwODA2MQ==", "url": "https://github.com/elastic/elasticsearch/pull/63748#discussion_r505608061", "bodyText": "@astefan Let me know if I missed anything here. I'm not sure there is much value in users changing this arg as there will be an error either way.", "author": "jrodewig", "createdAt": "2020-10-15T14:52:55Z", "path": "docs/reference/eql/eql-search-api.asciidoc", "diffHunk": "@@ -56,9 +56,13 @@ To search all data streams and indices in a cluster, use\n [[eql-search-api-query-params]]\n ==== {api-query-parms-title}\n \n-include::{es-repo-dir}/rest-api/common-parms.asciidoc[tag=allow-no-indices]\n-+\n-Defaults to `false`.\n+`allow_no_indices`::\n+(Optional, boolean)\n+If `false`, the request returns a `mapping_exception` error when a wildcard\n+expression, <<indices-aliases,index alias>>, or `_all` value targets only\n+missing or closed indices. If `true`, the request returns a\n+`verification_exception` error when targeting only missing or closed indices.\n+Defaults to `true`.", "originalCommit": "3a2c251be85037ce2871693b5f3c42b43b7b0abd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTYzNDI4Mw==", "url": "https://github.com/elastic/elasticsearch/pull/63748#discussion_r505634283", "bodyText": "It is correct what you have here, but incomplete. The situation is a bit more complicated and it matters if the cluster is secured or not. With Security enabled and allow_no_indices=false for a inexistent*,existent search there is a index_not_found_exception and this one comes from Security itself if I'm not mistaken.\nWhat we have in eql atm is a variation of allow_no_indices behavior in ES itself. We do obey the default allow_no_indices behavior BUT in case the entire pattern doesn't have any index, no matter the value of allow_no_indices, EQL complains. Elasticsearch, on the other hand, has scenarios where it returns an empty response whereas we return a verification_exception.", "author": "astefan", "createdAt": "2020-10-15T15:25:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTYwODA2MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTc2MzI1OQ==", "url": "https://github.com/elastic/elasticsearch/pull/63748#discussion_r505763259", "bodyText": "Thanks for the clarification @astefan. After doing some testing, I'm not sure that having security enabled is a big differentiator. I also don't think I need to call out the individual exception names. Instead, I focused on scenarios that would generate an error vs. those that would not.", "author": "jrodewig", "createdAt": "2020-10-15T18:43:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTYwODA2MQ=="}], "type": "inlineReview"}, {"oid": "edeca29649df84779bb8d7f7527c210017b7b2d3", "url": "https://github.com/elastic/elasticsearch/commit/edeca29649df84779bb8d7f7527c210017b7b2d3", "message": "Fix param def", "committedDate": "2020-10-15T18:40:55Z", "type": "commit"}, {"oid": "8a05814eaf2fffe4f290220b87f82b09496238bb", "url": "https://github.com/elastic/elasticsearch/commit/8a05814eaf2fffe4f290220b87f82b09496238bb", "message": "reword", "committedDate": "2020-10-15T20:14:04Z", "type": "commit"}, {"oid": "fd2b39fd120cb858601a15e1ce939f16bb648b13", "url": "https://github.com/elastic/elasticsearch/commit/fd2b39fd120cb858601a15e1ce939f16bb648b13", "message": "Clarify examples", "committedDate": "2020-10-16T12:43:29Z", "type": "commit"}, {"oid": "90047f2fcc44d077fefd2f67a7ab1197b77966ee", "url": "https://github.com/elastic/elasticsearch/commit/90047f2fcc44d077fefd2f67a7ab1197b77966ee", "message": "Reword note", "committedDate": "2020-10-16T12:44:54Z", "type": "commit"}, {"oid": "76d2793c445685fffa5dc5e878bb346165160b46", "url": "https://github.com/elastic/elasticsearch/commit/76d2793c445685fffa5dc5e878bb346165160b46", "message": "Add clarification", "committedDate": "2020-10-16T12:49:02Z", "type": "commit"}, {"oid": "8554d4afe0ce64bac1529554fd1b8b9abb7268f3", "url": "https://github.com/elastic/elasticsearch/commit/8554d4afe0ce64bac1529554fd1b8b9abb7268f3", "message": "Revise note", "committedDate": "2020-10-16T12:51:26Z", "type": "commit"}, {"oid": "b02e2ab17db0d3bf31a2363b1db420fb2f323902", "url": "https://github.com/elastic/elasticsearch/commit/b02e2ab17db0d3bf31a2363b1db420fb2f323902", "message": "Revise note again", "committedDate": "2020-10-16T13:50:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjQ3MjcxMw==", "url": "https://github.com/elastic/elasticsearch/pull/63748#discussion_r506472713", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            If `false`, any wildcard expression, <<indices-aliases,index alias>>, or `_all`\n          \n          \n            \n            value that targets only missing or closed indices returns an error. This applies\n          \n          \n            \n            even if the request targets other open indices. For example, if an index starts\n          \n          \n            \n            with `foo` but no index starts with `bar`, a request targeting `foo*,bar*`\n          \n          \n            \n            returns an error.\n          \n          \n            \n            If `false`, requests return an error if any wildcard expression, <<indices-aliases,index alias>>, or `_all`\n          \n          \n            \n            value targets only missing or closed indices. This behavior applies\n          \n          \n            \n            even if the request targets other open indices. For example, a request\n          \n          \n            \n            targeting `foo*,bar*` returns an error if any index starts with `foo`, but no\n          \n          \n            \n            index starts with `bar`.", "author": "lockewritesdocs", "createdAt": "2020-10-16T14:14:47Z", "path": "docs/reference/eql/eql-search-api.asciidoc", "diffHunk": "@@ -56,9 +56,26 @@ To search all data streams and indices in a cluster, use\n [[eql-search-api-query-params]]\n ==== {api-query-parms-title}\n \n-include::{es-repo-dir}/rest-api/common-parms.asciidoc[tag=allow-no-indices]\n+`allow_no_indices`::\n+(Optional, boolean)\n++\n+NOTE: This parameter's behavior differs from the `allow_no_indices` parameter\n+used in other <<multi-index,multi-target APIs>>.\n++\n+If `false`, any wildcard expression, <<indices-aliases,index alias>>, or `_all`\n+value that targets only missing or closed indices returns an error. This applies\n+even if the request targets other open indices. For example, if an index starts\n+with `foo` but no index starts with `bar`, a request targeting `foo*,bar*`\n+returns an error.", "originalCommit": "b02e2ab17db0d3bf31a2363b1db420fb2f323902", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjQ3OTc1NQ==", "url": "https://github.com/elastic/elasticsearch/pull/63748#discussion_r506479755", "bodyText": "I moved \"requests return an error\" to the beginning of the first sentence, which I think reads easier. \"You'll get an error if X, Y, or Z\" feels more natural than \"If X, Y, or Z, you'll get an error.\" Apologies for such subjective logic, but I kept stumbling on that first sentence.", "author": "lockewritesdocs", "createdAt": "2020-10-16T14:23:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjQ3MjcxMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjQ3NTI0OA==", "url": "https://github.com/elastic/elasticsearch/pull/63748#discussion_r506475248", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            If `true`, only requests that exclusively target missing or closed indices\n          \n          \n            \n            return an error. If the request targets any open index, it does not return an\n          \n          \n            \n            error. For example, if an index starts with `foo` but no index starts with\n          \n          \n            \n            `bar`, a request targeting `foo*,bar*` does not return an error. However, a\n          \n          \n            \n            request that targets only `bar*` still returns an error.\n          \n          \n            \n            +\n          \n          \n            \n            If `true`, requests that exclusively target missing or closed indices\n          \n          \n            \n            return an error, unless the request targets an open index.\n          \n          \n            \n            For example, a request targeting `foo*,bar*` does not return an error\n          \n          \n            \n            if any index starts with `foo`, but no index starts with\n          \n          \n            \n            `bar`. However, a request that targets only `bar*` still returns an error.\n          \n          \n            \n            +", "author": "lockewritesdocs", "createdAt": "2020-10-16T14:17:51Z", "path": "docs/reference/eql/eql-search-api.asciidoc", "diffHunk": "@@ -56,9 +56,26 @@ To search all data streams and indices in a cluster, use\n [[eql-search-api-query-params]]\n ==== {api-query-parms-title}\n \n-include::{es-repo-dir}/rest-api/common-parms.asciidoc[tag=allow-no-indices]\n+`allow_no_indices`::\n+(Optional, boolean)\n++\n+NOTE: This parameter's behavior differs from the `allow_no_indices` parameter\n+used in other <<multi-index,multi-target APIs>>.\n++\n+If `false`, any wildcard expression, <<indices-aliases,index alias>>, or `_all`\n+value that targets only missing or closed indices returns an error. This applies\n+even if the request targets other open indices. For example, if an index starts\n+with `foo` but no index starts with `bar`, a request targeting `foo*,bar*`\n+returns an error.\n +\n-Defaults to `false`.\n+If `true`, only requests that exclusively target missing or closed indices\n+return an error. If the request targets any open index, it does not return an\n+error. For example, if an index starts with `foo` but no index starts with\n+`bar`, a request targeting `foo*,bar*` does not return an error. However, a\n+request that targets only `bar*` still returns an error.\n++", "originalCommit": "b02e2ab17db0d3bf31a2363b1db420fb2f323902", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjQ3NzA1NQ==", "url": "https://github.com/elastic/elasticsearch/pull/63748#discussion_r506477055", "bodyText": "I think that combining the second sentence into the first helps to highlight the conditional statement.", "author": "lockewritesdocs", "createdAt": "2020-10-16T14:20:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjQ3NTI0OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjQ4MTIxNg==", "url": "https://github.com/elastic/elasticsearch/pull/63748#discussion_r506481216", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            If `false`, any wildcard expression, <<indices-aliases,index alias>>, or `_all`\n          \n          \n            \n            value that targets only missing or closed indices returns an error. This applies\n          \n          \n            \n            even if the request targets other open indices. For example, if an index starts\n          \n          \n            \n            with `foo` but no index starts with `bar`, a request targeting `foo*,bar*`\n          \n          \n            \n            returns an error.\n          \n          \n            \n            If `false`, requests return an error if any wildcard expression, <<indices-aliases,index alias>>, or `_all`\n          \n          \n            \n            value targets only missing or closed indices. This behavior applies\n          \n          \n            \n            even if the request targets other open indices. For example, a request\n          \n          \n            \n            targeting `foo*,bar*` returns an error if any index starts with `foo`, but no\n          \n          \n            \n            index starts with `bar`.", "author": "lockewritesdocs", "createdAt": "2020-10-16T14:25:07Z", "path": "docs/reference/rest-api/common-parms.asciidoc", "diffHunk": "@@ -38,9 +38,12 @@ end::target-index-aliases[]\n \n tag::allow-no-indices[]\n `allow_no_indices`::\n-(Optional, boolean) If `false`, the request returns an error when a\n-wildcard expression, <<indices-aliases,index alias>>, or `_all` value targets\n-only missing or closed indices.\n+(Optional, boolean)\n+If `false`, any wildcard expression, <<indices-aliases,index alias>>, or `_all`\n+value that targets only missing or closed indices returns an error. This applies\n+even if the request targets other open indices. For example, if an index starts\n+with `foo` but no index starts with `bar`, a request targeting `foo*,bar*`\n+returns an error.", "originalCommit": "b02e2ab17db0d3bf31a2363b1db420fb2f323902", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjQ4MjMyNw==", "url": "https://github.com/elastic/elasticsearch/pull/63748#discussion_r506482327", "bodyText": "\u261d\ufe0f same suggested edits as in the previous file.", "author": "lockewritesdocs", "createdAt": "2020-10-16T14:26:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjQ4MTIxNg=="}], "type": "inlineReview"}, {"oid": "803494cc7a6bc8a941a2ab98fa0e128c1666ccd7", "url": "https://github.com/elastic/elasticsearch/commit/803494cc7a6bc8a941a2ab98fa0e128c1666ccd7", "message": "Apply suggestions from code review\n\nCo-authored-by: Adam Locke <adam.locke@elastic.co>", "committedDate": "2020-10-16T14:49:13Z", "type": "commit"}, {"oid": "1877c16b6c593255c62e9343cd044c0045f9c50c", "url": "https://github.com/elastic/elasticsearch/commit/1877c16b6c593255c62e9343cd044c0045f9c50c", "message": "Minor cleanup", "committedDate": "2020-10-16T14:53:45Z", "type": "commit"}, {"oid": "8cf99d2433cb6537eb7df7e49ad6265ae0fb41a0", "url": "https://github.com/elastic/elasticsearch/commit/8cf99d2433cb6537eb7df7e49ad6265ae0fb41a0", "message": "sync changes", "committedDate": "2020-10-16T15:04:42Z", "type": "commit"}]}