{"pr_number": 58217, "pr_title": "Display enterprise license as platinum in /_xpack", "pr_createdAt": "2020-06-17T05:44:38Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/58217", "timeline": [{"oid": "de46256782c5c5a10533d3ea9f3ac20c1b5d77e7", "url": "https://github.com/elastic/elasticsearch/commit/de46256782c5c5a10533d3ea9f3ac20c1b5d77e7", "message": "Display enterprise license as platinum in /_xpack\n\nThe GET /_license endpoint displays \"enterprise\" licenses as\n\"platinum\" by default so that old clients (including beats, kibana and\nlogstash) know to interpret this new license type as if it were a\nplatinum license.\n\nHowever, this compatibility layer was not applied to the GET /_xpack/\nendpoint which also displays a license type & mode.\n\nThis commit causes the _xpack API to mimic the _license API and treat\nenterprise as platinum by default, with a new accept_enterprise\nparameter that will cause the API to return the correct \"enterprise\"\nvalue.\n\nThis BWC layer exists only for the 7.x branch.\nThis is a breaking change because, since 7.6, the _xpack API has\nreturned \"enterprise\" for enterprise liceses, but this has been found\nto break old versions of beats and logstash so needs to be corrected.", "committedDate": "2020-06-17T05:35:52Z", "type": "commit"}, {"oid": "a101fed0b9bf9cb8532c87e0cc418ba466e00597", "url": "https://github.com/elastic/elasticsearch/commit/a101fed0b9bf9cb8532c87e0cc418ba466e00597", "message": "Restore lost test", "committedDate": "2020-06-17T06:28:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTMyMjYyNg==", "url": "https://github.com/elastic/elasticsearch/pull/58217#discussion_r441322626", "bodyText": "Would it be better to use enums here, e.g. License.LicenseType.ENTERPRISE.getTypeName()? It is rather verbose but safer.", "author": "ywangd", "createdAt": "2020-06-17T06:59:47Z", "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/action/TransportXPackInfoAction.java", "diffHunk": "@@ -49,8 +49,18 @@ protected void doExecute(Task task, XPackInfoRequest request, ActionListener<XPa\n         if (request.getCategories().contains(XPackInfoRequest.Category.LICENSE)) {\n             License license = licenseService.getLicense();\n             if (license != null) {\n-                licenseInfo = new LicenseInfo(license.uid(), license.type(), license.operationMode().description(),\n-                        license.status(), license.expiryDate());\n+                String type = license.type();\n+                License.OperationMode mode = license.operationMode();\n+                if (request.getLicenseVersion() < License.VERSION_ENTERPRISE) {\n+                    if (\"enterprise\".equals(type)) {\n+                        type = \"platinum\";", "originalCommit": "a101fed0b9bf9cb8532c87e0cc418ba466e00597", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njc2MDExMg==", "url": "https://github.com/elastic/elasticsearch/pull/58217#discussion_r446760112", "bodyText": "I didn't because the existing code for the License endpoint didn't, but I think we should.", "author": "tvernum", "createdAt": "2020-06-29T04:04:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTMyMjYyNg=="}], "type": "inlineReview"}, {"oid": "09da1b0dffbcc841f18e7a16c95de6a7d484ad7f", "url": "https://github.com/elastic/elasticsearch/commit/09da1b0dffbcc841f18e7a16c95de6a7d484ad7f", "message": "Merge branch '7.x' into xpack-license-type-enterprise-bwc", "committedDate": "2020-06-29T03:25:15Z", "type": "commit"}, {"oid": "93f3cb7cb4262f04b841d06132a75bc82d632566", "url": "https://github.com/elastic/elasticsearch/commit/93f3cb7cb4262f04b841d06132a75bc82d632566", "message": "Switch license type to use enum", "committedDate": "2020-06-29T05:07:13Z", "type": "commit"}, {"oid": "ed8d52306309918b9dbf3a3b6b5ed3b1db5fe409", "url": "https://github.com/elastic/elasticsearch/commit/ed8d52306309918b9dbf3a3b6b5ed3b1db5fe409", "message": "Use 7.8.1 constant and skip test during backport", "committedDate": "2020-06-29T06:47:08Z", "type": "commit"}]}