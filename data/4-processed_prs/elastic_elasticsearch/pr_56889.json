{"pr_number": 56889, "pr_title": "Adjust reload keystore test to pass in FIPS", "pr_createdAt": "2020-05-18T09:50:38Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/56889", "timeline": [{"oid": "c620ba75b9cc3387d86cffa528efd93ceda94a97", "url": "https://github.com/elastic/elasticsearch/commit/c620ba75b9cc3387d86cffa528efd93ceda94a97", "message": "Adjust reload keystore test to pass in FIPS\n\nIn KeystoreWrapper class we determine if the error to decrypt a\ngiven keystore is caused by a wrong password based on the exception\nthat the SunJCE implementation of AES is\nthrowing(AEADBadTagException). Other implementations from other\nSecurity Providers fail with a different exception and as such we\ncannot differentiate between a corrupted file and a wrong password\nin a foolproof way.\nIn other tests such as in\nKeyStoreWrapperTests#testDecryptKeyStoreWithWrongPassword we handle\nthis by matching both possible exception messages but it is not as\neasy to do in the REST yml tests. What's more, we don't have a way\nto skip YAML tests in FIPS mode, thus this change removes the\nmatching of the exception string entirely so that the test can\nrun successfully in FIPS mode.", "committedDate": "2020-05-18T09:42:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzAxNjU1OQ==", "url": "https://github.com/elastic/elasticsearch/pull/56889#discussion_r427016559", "bodyText": "FWIW, it is possible to test for both error texts with regex\n  - match: { nodes.$node_id.reload_exception.reason:\n               /^(Provided\\skeystore\\spassword\\swas\\sincorrect|\n               Keystore\\shas\\sbeen\\scorrupted\\sor\\stampered\\swith)$/ }", "author": "ywangd", "createdAt": "2020-05-19T03:59:21Z", "path": "rest-api-spec/src/main/resources/rest-api-spec/test/nodes.reload_secure_settings/10_basic.yml", "diffHunk": "@@ -18,7 +18,6 @@ setup:\n   - is_true: nodes\n   - is_true: cluster_name\n   - match: { nodes.$node_id.reload_exception.type: \"security_exception\" }\n-  - match: { nodes.$node_id.reload_exception.reason: \"Provided keystore password was incorrect\" }", "originalCommit": "c620ba75b9cc3387d86cffa528efd93ceda94a97", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "6cf2e205264e0057e8d7be155de56f39359dc258", "url": "https://github.com/elastic/elasticsearch/commit/6cf2e205264e0057e8d7be155de56f39359dc258", "message": "address feedback", "committedDate": "2020-05-19T10:17:01Z", "type": "commit"}]}