{"pr_number": 58695, "pr_title": "[DOCS] Add data streams to API conventions", "pr_createdAt": "2020-06-29T19:20:42Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/58695", "timeline": [{"oid": "9d0796b1ba5f62daa5be858552e57484957d338b", "url": "https://github.com/elastic/elasticsearch/commit/9d0796b1ba5f62daa5be858552e57484957d338b", "message": "[DOCS] Add data streams to API conventions\n\nUpdates the existing API conventions docs to make them aware of data\nstreams.", "committedDate": "2020-06-29T19:19:01Z", "type": "commit"}, {"oid": "f35883fd6d3131034c715531a7cf61e2cada22a4", "url": "https://github.com/elastic/elasticsearch/commit/f35883fd6d3131034c715531a7cf61e2cada22a4", "message": "Change multi-index to multi-target", "committedDate": "2020-06-29T19:44:42Z", "type": "commit"}, {"oid": "c9dc8d583c4ec9c00a97578172f40e0e362a31e5", "url": "https://github.com/elastic/elasticsearch/commit/c9dc8d583c4ec9c00a97578172f40e0e362a31e5", "message": "reword", "committedDate": "2020-06-30T13:28:46Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzg3ODU2NQ==", "url": "https://github.com/elastic/elasticsearch/pull/58695#discussion_r447878565", "bodyText": "Just a heads-up, but data stream names don't support date math since a single data stream is supposed to handle a potentially infinite stream of data and the data stream's backing indices are named according to their generation and not the date on which they were created.", "author": "danhermann", "createdAt": "2020-06-30T18:01:49Z", "path": "docs/reference/api-conventions.asciidoc", "diffHunk": "@@ -30,27 +38,32 @@ include::{es-repo-dir}/rest-api/common-parms.asciidoc[tag=expand-wildcards]\n \n The defaults settings for the above parameters depend on the API being used.\n \n-Some multi index APIs also support the following url query string parameter:\n+Some multi-target APIs that can target indices also support the following query\n+string parameter:\n \n include::{es-repo-dir}/rest-api/common-parms.asciidoc[tag=ignore_throttled]\n \n-NOTE: Single index APIs such as the <<docs>> and the\n-<<indices-aliases,single-index `alias` APIs>> do not support multiple indices.\n+NOTE: Single index APIs, such as the <<docs>> and the\n+<<indices-aliases,single-index `alias` APIs>>, do not support multi-target\n+syntax.\n \n [[date-math-index-names]]\n-=== Date math support in index names\n+=== Date math support in target names\n+\n+Most APIs that accept a `<data-stream>`, `<index>`, or `<target>` request path\n+parameter support _date math_.", "originalCommit": "c9dc8d583c4ec9c00a97578172f40e0e362a31e5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzg5NjA0NA==", "url": "https://github.com/elastic/elasticsearch/pull/58695#discussion_r447896044", "bodyText": "Thanks @danhermann. I've removed my changes to this section/page.\nTechnically, you can still search a data stream name using date math. For example, GET /%3Clogs-%7Bnow%2Fd%7D%3E/_search would search the logs-2020.06.30 data stream.\nBut users would first need to create a data stream with a date component , which we probably shouldn't encourage. It seems like a corner case we'd be better off not mentioning.", "author": "jrodewig", "createdAt": "2020-06-30T18:31:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzg3ODU2NQ=="}], "type": "inlineReview"}, {"oid": "6770a542704a6dc665974b2d0ecb76c6a0074fa7", "url": "https://github.com/elastic/elasticsearch/commit/6770a542704a6dc665974b2d0ecb76c6a0074fa7", "message": "Remove date name changes", "committedDate": "2020-06-30T18:26:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzk0ODk0MA==", "url": "https://github.com/elastic/elasticsearch/pull/58695#discussion_r447948940", "bodyText": "I'd probably take the opportunity to get rid of the e.g.s.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            In multi-target syntax, you can use a comma-separated list (e.g.,\n          \n          \n            \n            `test1,test2,test3`) to execute a request across multiple resources, such as\n          \n          \n            \n            data streams, indices, or index aliases. You can also use\n          \n          \n            \n            https://en.wikipedia.org/wiki/Glob_(programming)[glob-like] wildcard (`*`)\n          \n          \n            \n            expressions (e.g., `test*` or `*test` or `te*t` or `*test*`) to target any\n          \n          \n            \n            resources that match the pattern.\n          \n          \n            \n            \n          \n          \n            \n            You can exclude targets using the `-` character (e.g., `test*,-test3`).\n          \n          \n            \n            In multi-target syntax, you can use a comma-separated list to execute a request across multiple resources, such as\n          \n          \n            \n            data streams, indices, or index aliases: `test1,test2,test3`. You can also use\n          \n          \n            \n            https://en.wikipedia.org/wiki/Glob_(programming)[glob-like] wildcard (`*`)\n          \n          \n            \n            expressions to target any\n          \n          \n            \n            resources that match the pattern: `test*` or `*test` or `te*t` or `*test*.\n          \n          \n            \n            \n          \n          \n            \n            You can exclude targets using the `-` character: `test*,-test3`.", "author": "debadair", "createdAt": "2020-06-30T20:08:18Z", "path": "docs/reference/api-conventions.asciidoc", "diffHunk": "@@ -13,14 +13,22 @@ API, unless otherwise specified.\n * <<url-access-control>>\n \n [[multi-index]]\n-=== Multiple indices\n+=== Multi-target syntax\n \n-Most APIs that refer to an `index` parameter support execution across multiple indices,\n-using simple `test1,test2,test3` notation (or `_all` for all indices). It also\n-supports wildcards, for example: `test*` or `*test` or `te*t` or `*test*`, and the\n-ability to \"exclude\" (`-`), for example: `test*,-test3`.\n+Most APIs that accept a `<data-stream>`, `<index>`, or `<target>` request path\n+parameter also support _multi-target syntax_.\n \n-All multi index APIs support the following url query string parameters:\n+In multi-target syntax, you can use a comma-separated list (e.g.,\n+`test1,test2,test3`) to execute a request across multiple resources, such as\n+data streams, indices, or index aliases. You can also use\n+https://en.wikipedia.org/wiki/Glob_(programming)[glob-like] wildcard (`*`)\n+expressions (e.g., `test*` or `*test` or `te*t` or `*test*`) to target any\n+resources that match the pattern.\n+\n+You can exclude targets using the `-` character (e.g., `test*,-test3`).", "originalCommit": "6770a542704a6dc665974b2d0ecb76c6a0074fa7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzk0OTU2Ng==", "url": "https://github.com/elastic/elasticsearch/pull/58695#discussion_r447949566", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            NOTE: Single index APIs, such as the <<docs>> and the\n          \n          \n            \n            NOTE: Single index APIs, such as the <<docs>> and", "author": "debadair", "createdAt": "2020-06-30T20:09:28Z", "path": "docs/reference/api-conventions.asciidoc", "diffHunk": "@@ -30,12 +38,14 @@ include::{es-repo-dir}/rest-api/common-parms.asciidoc[tag=expand-wildcards]\n \n The defaults settings for the above parameters depend on the API being used.\n \n-Some multi index APIs also support the following url query string parameter:\n+Some multi-target APIs that can target indices also support the following query\n+string parameter:\n \n include::{es-repo-dir}/rest-api/common-parms.asciidoc[tag=ignore_throttled]\n \n-NOTE: Single index APIs such as the <<docs>> and the\n-<<indices-aliases,single-index `alias` APIs>> do not support multiple indices.\n+NOTE: Single index APIs, such as the <<docs>> and the", "originalCommit": "6770a542704a6dc665974b2d0ecb76c6a0074fa7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzk1MTY1OA==", "url": "https://github.com/elastic/elasticsearch/pull/58695#discussion_r447951658", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            To prevent the user from overriding the data stream or index which has been specified in the\n          \n          \n            \n            URL, add this setting to the `elasticsearch.yml` file:\n          \n          \n            \n            \n          \n          \n            \n                rest.action.multi.allow_explicit_index: false\n          \n          \n            \n            To prevent the user from overriding the data stream or index specified in the\n          \n          \n            \n            URL, set `rest.action.multi.allow_explicit_index` to `false` in `elasticsearch.yml`.", "author": "debadair", "createdAt": "2020-06-30T20:13:41Z", "path": "docs/reference/api-conventions.asciidoc", "diffHunk": "@@ -660,15 +670,15 @@ string parameter.\n === URL-based access control\n \n Many users use a proxy with URL-based access control to secure access to\n-Elasticsearch indices. For <<search-multi-search,multi-search>>,\n+{es} data streams and indices. For <<search-multi-search,multi-search>>,\n <<docs-multi-get,multi-get>>, and <<docs-bulk,bulk>> requests, the user has\n-the choice of specifying an index in the URL and on each individual request\n+the choice of specifying a data stream or  index in the URL and on each individual request\n within the request body. This can make URL-based access control challenging.\n \n-To prevent the user from overriding the index which has been specified in the\n+To prevent the user from overriding the data stream or index which has been specified in the\n URL, add this setting to the `elasticsearch.yml` file:\n \n     rest.action.multi.allow_explicit_index: false", "originalCommit": "6770a542704a6dc665974b2d0ecb76c6a0074fa7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzk1MjU0NQ==", "url": "https://github.com/elastic/elasticsearch/pull/58695#discussion_r447952545", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            The default value is `true`, but when set to `false`, {es} will\n          \n          \n            \n            reject requests that have an explicit data stream or index specified in the request body.\n          \n          \n            \n            This causes  {es} to\n          \n          \n            \n            reject requests that explicitly specfiy a data stream or index in the request body.", "author": "debadair", "createdAt": "2020-06-30T20:15:30Z", "path": "docs/reference/api-conventions.asciidoc", "diffHunk": "@@ -660,15 +670,15 @@ string parameter.\n === URL-based access control\n \n Many users use a proxy with URL-based access control to secure access to\n-Elasticsearch indices. For <<search-multi-search,multi-search>>,\n+{es} data streams and indices. For <<search-multi-search,multi-search>>,\n <<docs-multi-get,multi-get>>, and <<docs-bulk,bulk>> requests, the user has\n-the choice of specifying an index in the URL and on each individual request\n+the choice of specifying a data stream or  index in the URL and on each individual request\n within the request body. This can make URL-based access control challenging.\n \n-To prevent the user from overriding the index which has been specified in the\n+To prevent the user from overriding the data stream or index which has been specified in the\n URL, add this setting to the `elasticsearch.yml` file:\n \n     rest.action.multi.allow_explicit_index: false\n \n-The default value is `true`, but when set to `false`, Elasticsearch will\n-reject requests that have an explicit index specified in the request body.\n+The default value is `true`, but when set to `false`, {es} will\n+reject requests that have an explicit data stream or index specified in the request body.", "originalCommit": "6770a542704a6dc665974b2d0ecb76c6a0074fa7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzk1NzI2Nw==", "url": "https://github.com/elastic/elasticsearch/pull/58695#discussion_r447957267", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            The list of indices that should be included into the snapshot can be specified using the `indices` parameter that\n          \n          \n            \n            Use the `indices` parameter, which supports <<multi-index,multi-target syntax>>, to specify the list of indices to include in the snapshot.", "author": "lockewritesdocs", "createdAt": "2020-06-30T20:24:35Z", "path": "docs/reference/snapshot-restore/take-snapshot.asciidoc", "diffHunk": "@@ -52,7 +52,7 @@ PUT /_snapshot/my_backup/snapshot_2?wait_for_completion=true\n // TEST[skip:cannot complete subsequent snapshot]\n \n The list of indices that should be included into the snapshot can be specified using the `indices` parameter that", "originalCommit": "6770a542704a6dc665974b2d0ecb76c6a0074fa7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzk2NTIwOA==", "url": "https://github.com/elastic/elasticsearch/pull/58695#discussion_r447965208", "bodyText": "As this PR is primarily concerned with the multi-index xref, I'm going to leave this as-is for now. It'll create fewer merge conflicts for me in #58513.", "author": "jrodewig", "createdAt": "2020-06-30T20:40:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzk1NzI2Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzk1OTc3NA==", "url": "https://github.com/elastic/elasticsearch/pull/58695#discussion_r447959774", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            supports <<multi-index,multi-target syntax>>, although the options which control the behavior of multi index syntax\n          \n          \n            \n            must be supplied in the body of the request, rather than as request parameters. The snapshot request also supports the\n          \n          \n            \n            You specify the options that control the behavior of multi-target syntax\n          \n          \n            \n            in the body of the request, rather than as request parameters. The snapshot request also supports the", "author": "lockewritesdocs", "createdAt": "2020-06-30T20:29:24Z", "path": "docs/reference/snapshot-restore/take-snapshot.asciidoc", "diffHunk": "@@ -52,7 +52,7 @@ PUT /_snapshot/my_backup/snapshot_2?wait_for_completion=true\n // TEST[skip:cannot complete subsequent snapshot]\n \n The list of indices that should be included into the snapshot can be specified using the `indices` parameter that\n-supports <<multi-index,multi index syntax>>, although the options which control the behavior of multi index syntax\n+supports <<multi-index,multi-target syntax>>, although the options which control the behavior of multi index syntax\n must be supplied in the body of the request, rather than as request parameters. The snapshot request also supports the", "originalCommit": "6770a542704a6dc665974b2d0ecb76c6a0074fa7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzk2NTI1Mw==", "url": "https://github.com/elastic/elasticsearch/pull/58695#discussion_r447965253", "bodyText": "Same as above.", "author": "jrodewig", "createdAt": "2020-06-30T20:40:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzk1OTc3NA=="}], "type": "inlineReview"}, {"oid": "06c6972ee35a129ac1f3fd2d9da7d6853b1c52be", "url": "https://github.com/elastic/elasticsearch/commit/06c6972ee35a129ac1f3fd2d9da7d6853b1c52be", "message": "Apply suggestions from code review\n\nCo-authored-by: debadair <debadair@elastic.co>", "committedDate": "2020-06-30T20:37:48Z", "type": "commit"}]}