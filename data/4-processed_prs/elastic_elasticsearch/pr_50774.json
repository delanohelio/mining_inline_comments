{"pr_number": 50774, "pr_title": "Allow proxy mode server name to be configured", "pr_createdAt": "2020-01-08T23:30:37Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/50774", "timeline": [{"oid": "de3cc7cd2e8cbecd9cef5060d3859ddd86d2b964", "url": "https://github.com/elastic/elasticsearch/commit/de3cc7cd2e8cbecd9cef5060d3859ddd86d2b964", "message": "Allow proxy mode server name to be configured\n\nCurrently, proxy mode allows a remote cluster connection to be setup by\nexpecting all open connections to be routed through an intermediate\nproxy. The proxy must use some logic to ensure that the connections end\nup on the correct remote cluster. One mechanism provided is that the\ndefault distribution TLS implementations will forward the host component\nof the configured address to the remote connection using the SNI\nextension. This is limiting as it requires that the proxy be configured\nin a way that always uses a valid hostname as the proxy address.\n\nInstead, this commit adds an additional setting to allow the server_name\nto be configured independently. This allows the proxy address to be\nspecified as a IP literal, but the server_name specified as an arbitrary\nstring which still must be a valid hostname. It also decouples the\nserver_name from the requirement of being a DNS resolvable domain.", "committedDate": "2020-01-08T23:19:20Z", "type": "commit"}, {"oid": "568602585cb91809b7b278ffda0a1ed06a18fa28", "url": "https://github.com/elastic/elasticsearch/commit/568602585cb91809b7b278ffda0a1ed06a18fa28", "message": "Fix", "committedDate": "2020-01-08T23:30:22Z", "type": "commit"}, {"oid": "f4f980c0600a9e50283d88f59a045cc5be578091", "url": "https://github.com/elastic/elasticsearch/commit/f4f980c0600a9e50283d88f59a045cc5be578091", "message": "Merge remote-tracking branch 'upstream/master' into new_sni_setting", "committedDate": "2020-01-09T23:36:12Z", "type": "commit"}, {"oid": "207c3acb589953ddca269b149fc7fbd4180e0926", "url": "https://github.com/elastic/elasticsearch/commit/207c3acb589953ddca269b149fc7fbd4180e0926", "message": "Merge remote-tracking branch 'upstream/master' into new_sni_setting", "committedDate": "2020-01-10T01:17:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTc0NDQzNg==", "url": "https://github.com/elastic/elasticsearch/pull/50774#discussion_r365744436", "bodyText": "what's the upgrade path here?", "author": "ywelsch", "createdAt": "2020-01-13T10:57:46Z", "path": "server/src/main/java/org/elasticsearch/transport/ProxyConnectionStrategy.java", "diffHunk": "@@ -75,12 +72,12 @@\n             Setting.Property.Dynamic, Setting.Property.NodeScope));\n \n     /**\n-     * Whether to include the hostname as a server_name attribute\n+     * A configurable server_name attribute\n      */\n-    public static final Setting.AffixSetting<Boolean> INCLUDE_SERVER_NAME = Setting.affixKeySetting(\n+    public static final Setting.AffixSetting<String> SERVER_NAME = Setting.affixKeySetting(\n         \"cluster.remote.\",\n-        \"include_server_name\",\n-        (ns, key) -> boolSetting(key, false, new StrategyValidator<>(ns, key, ConnectionStrategy.PROXY),\n+        \"server_name\",", "originalCommit": "207c3acb589953ddca269b149fc7fbd4180e0926", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTkxMjQyMQ==", "url": "https://github.com/elastic/elasticsearch/pull/50774#discussion_r365912421", "bodyText": "I'm not sure I understand the question here. Upgrade from a prior version? These settings are all new in 7.6.", "author": "tbrooks8", "createdAt": "2020-01-13T16:52:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTc0NDQzNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTkyNTQzMw==", "url": "https://github.com/elastic/elasticsearch/pull/50774#discussion_r365925433", "bodyText": "my bad, I did not see that this was in ProxyConnectionStrategy.", "author": "ywelsch", "createdAt": "2020-01-13T17:18:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTc0NDQzNg=="}], "type": "inlineReview"}]}