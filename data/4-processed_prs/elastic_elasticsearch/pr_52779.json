{"pr_number": 52779, "pr_title": "Add documentation for remote cluster proxy mode", "pr_createdAt": "2020-02-25T16:48:36Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/52779", "timeline": [{"oid": "3674bbb011690f62cfed4c4a9e96e6b7cc1c58a9", "url": "https://github.com/elastic/elasticsearch/commit/3674bbb011690f62cfed4c4a9e96e6b7cc1c58a9", "message": "Add documentation for remote cluster proxy mode\n\nThis is related to #49067.", "committedDate": "2020-02-25T16:29:44Z", "type": "commit"}, {"oid": "0a691a413f93fd8e1b8e577263554202e5f7aa44", "url": "https://github.com/elastic/elasticsearch/commit/0a691a413f93fd8e1b8e577263554202e5f7aa44", "message": "Merge remote-tracking branch 'upstream/master' into proxy_mode_documentation", "committedDate": "2020-02-25T16:49:30Z", "type": "commit"}, {"oid": "93eed4b0c46b8d808b95c010ffc8f9daefa4a22d", "url": "https://github.com/elastic/elasticsearch/commit/93eed4b0c46b8d808b95c010ffc8f9daefa4a22d", "message": "Change", "committedDate": "2020-02-25T17:02:56Z", "type": "commit"}, {"oid": "275d9d56596b0a4d30058c644e5f78265e913fd6", "url": "https://github.com/elastic/elasticsearch/commit/275d9d56596b0a4d30058c644e5f78265e913fd6", "message": "Reference", "committedDate": "2020-02-25T17:20:45Z", "type": "commit"}, {"oid": "99c16800a8949dfb09f7665d9a7f5ca5b685315f", "url": "https://github.com/elastic/elasticsearch/commit/99c16800a8949dfb09f7665d9a7f5ca5b685315f", "message": "Merge remote-tracking branch 'upstream/master' into proxy_mode_documentation", "committedDate": "2020-02-26T15:13:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDk0NTAxNg==", "url": "https://github.com/elastic/elasticsearch/pull/52779#discussion_r384945016", "bodyText": "I would remove the word \"potential\" here.", "author": "ywelsch", "createdAt": "2020-02-27T07:06:59Z", "path": "docs/reference/modules/remote-clusters.asciidoc", "diffHunk": "@@ -15,21 +15,32 @@ endif::[]\n \n // tag::how-remote-clusters-work[]\n Remote cluster connections work by configuring a remote cluster and connecting\n-only to a limited number of nodes in that remote cluster. Each remote cluster\n-is referenced by a name and a list of seed nodes. When a remote cluster is\n-registered, its cluster state is retrieved from one of the seed nodes and up\n-to three _gateway nodes_ are selected to be connected to as part of remote\n-cluster requests.\n-// end::how-remote-clusters-work[]\n+only to a limited number of nodes in that remote cluster. There are two\n+potential modes for remote cluster connections: sniff mode and proxy mode.", "originalCommit": "99c16800a8949dfb09f7665d9a7f5ca5b685315f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDk0Njg1MA==", "url": "https://github.com/elastic/elasticsearch/pull/52779#discussion_r384946850", "bodyText": "also, perhaps link sniff and proxy to the corresponding sections below?", "author": "ywelsch", "createdAt": "2020-02-27T07:12:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDk0NTAxNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDk0NzgzMw==", "url": "https://github.com/elastic/elasticsearch/pull/52779#discussion_r384947833", "bodyText": "Perhaps add a sentence above the first setting stating that this section is covering settings that apply to both sniff and proxy mode, and that mode-specific settings are coming later.", "author": "ywelsch", "createdAt": "2020-02-27T07:16:01Z", "path": "docs/reference/modules/remote-clusters.asciidoc", "diffHunk": "@@ -201,23 +246,15 @@ PUT _cluster/settings\n [[remote-cluster-settings]]\n === Remote cluster settings\n \n-`cluster.remote.connections_per_cluster`::\n-\n-  The number of gateway nodes to connect to per remote cluster. The default is\n-  `3`.\n+`cluster.remote.${cluster_alias}.mode`::", "originalCommit": "99c16800a8949dfb09f7665d9a7f5ca5b685315f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDk0ODI0MQ==", "url": "https://github.com/elastic/elasticsearch/pull/52779#discussion_r384948241", "bodyText": "Remote cluster settings for all modes?", "author": "ywelsch", "createdAt": "2020-02-27T07:17:22Z", "path": "docs/reference/modules/remote-clusters.asciidoc", "diffHunk": "@@ -201,23 +246,15 @@ PUT _cluster/settings\n [[remote-cluster-settings]]\n === Remote cluster settings", "originalCommit": "99c16800a8949dfb09f7665d9a7f5ca5b685315f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDk0ODI3NA==", "url": "https://github.com/elastic/elasticsearch/pull/52779#discussion_r384948274", "bodyText": "Remote cluster settings for sniff mode?", "author": "ywelsch", "createdAt": "2020-02-27T07:17:28Z", "path": "docs/reference/modules/remote-clusters.asciidoc", "diffHunk": "@@ -251,6 +288,49 @@ PUT _cluster/settings\n   Elasticsearch compresses the response. If unset, the global\n   `transport.compress` is used as the fallback setting.\n \n+[float]\n+[[remote-cluster-sniff-settings]]\n+=== Remote cluster sniff mode settings", "originalCommit": "99c16800a8949dfb09f7665d9a7f5ca5b685315f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTAzNTg5Ng==", "url": "https://github.com/elastic/elasticsearch/pull/52779#discussion_r385035896", "bodyText": "I think we should also link to the detailed sniff and proxy mode sections from here.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                The configured connection mode for the remote cluster. Will be `sniff` or\n          \n          \n            \n                Connection mode for the remote cluster. Returned values are `sniff` and", "author": "jrodewig", "createdAt": "2020-02-27T10:23:39Z", "path": "docs/reference/cluster/remote-info.asciidoc", "diffHunk": "@@ -17,29 +17,47 @@ Returns configured remote cluster information.\n ==== {api-description-title}\n \n The cluster remote info API allows you to retrieve all of the configured\n-remote cluster information. It returns connection and endpoint information keyed \n+remote cluster information. It returns connection and endpoint information keyed\n by the configured remote cluster alias.\n \n \n [[cluster-remote-info-api-response-body]]\n ==== {api-response-body-title}\n \n-`seeds`::\n-\tThe configured initial seed transport addresses of the remote cluster.\n+`mode`::\n+    The configured connection mode for the remote cluster. Will be `sniff` or", "originalCommit": "99c16800a8949dfb09f7665d9a7f5ca5b685315f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTAzNzg2MQ==", "url": "https://github.com/elastic/elasticsearch/pull/52779#discussion_r385037861", "bodyText": "This looks like it was double indented.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            `seeds`::\n          \n          \n            \n            \tThe configured initial seed transport addresses of the remote cluster when\n          \n          \n            \n            \tsniff mode is configured.\n          \n          \n            \n            `seeds`::\n          \n          \n            \n                Initial seed transport addresses of the remote cluster when\n          \n          \n            \n                sniff mode is configured.", "author": "jrodewig", "createdAt": "2020-02-27T10:27:12Z", "path": "docs/reference/cluster/remote-info.asciidoc", "diffHunk": "@@ -17,29 +17,47 @@ Returns configured remote cluster information.\n ==== {api-description-title}\n \n The cluster remote info API allows you to retrieve all of the configured\n-remote cluster information. It returns connection and endpoint information keyed \n+remote cluster information. It returns connection and endpoint information keyed\n by the configured remote cluster alias.\n \n \n [[cluster-remote-info-api-response-body]]\n ==== {api-response-body-title}\n \n-`seeds`::\n-\tThe configured initial seed transport addresses of the remote cluster.\n+`mode`::\n+    The configured connection mode for the remote cluster. Will be `sniff` or\n+    `proxy`.\n \n `connected`::\n \tTrue if there is at least one connection to the remote cluster.\n \n-`num_nodes_connected`::\n-    The number of connected nodes in the remote cluster.\n-\n-`max_connections_per_cluster`::\n-\tThe maximum number of connections maintained for the remote cluster.\n-\n `initial_connect_timeout`::\n \tThe initial connect timeout for remote cluster connections.\n \n [[skip-unavailable]]\n `skip_unavailable`::\n     Whether the remote cluster is skipped in case it is searched through\n     a {ccs} request but none of its nodes are available.\n+\n+`seeds`::\n+\tThe configured initial seed transport addresses of the remote cluster when\n+\tsniff mode is configured.", "originalCommit": "99c16800a8949dfb09f7665d9a7f5ca5b685315f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTAzODE2MA==", "url": "https://github.com/elastic/elasticsearch/pull/52779#discussion_r385038160", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                The number of connected nodes in the remote cluster when sniff mode is\n          \n          \n            \n                configured.\n          \n          \n            \n                Number of connected nodes in the remote cluster when sniff mode is\n          \n          \n            \n                configured.", "author": "jrodewig", "createdAt": "2020-02-27T10:27:43Z", "path": "docs/reference/cluster/remote-info.asciidoc", "diffHunk": "@@ -17,29 +17,47 @@ Returns configured remote cluster information.\n ==== {api-description-title}\n \n The cluster remote info API allows you to retrieve all of the configured\n-remote cluster information. It returns connection and endpoint information keyed \n+remote cluster information. It returns connection and endpoint information keyed\n by the configured remote cluster alias.\n \n \n [[cluster-remote-info-api-response-body]]\n ==== {api-response-body-title}\n \n-`seeds`::\n-\tThe configured initial seed transport addresses of the remote cluster.\n+`mode`::\n+    The configured connection mode for the remote cluster. Will be `sniff` or\n+    `proxy`.\n \n `connected`::\n \tTrue if there is at least one connection to the remote cluster.\n \n-`num_nodes_connected`::\n-    The number of connected nodes in the remote cluster.\n-\n-`max_connections_per_cluster`::\n-\tThe maximum number of connections maintained for the remote cluster.\n-\n `initial_connect_timeout`::\n \tThe initial connect timeout for remote cluster connections.\n \n [[skip-unavailable]]\n `skip_unavailable`::\n     Whether the remote cluster is skipped in case it is searched through\n     a {ccs} request but none of its nodes are available.\n+\n+`seeds`::\n+\tThe configured initial seed transport addresses of the remote cluster when\n+\tsniff mode is configured.\n+\n+`num_nodes_connected`::\n+    The number of connected nodes in the remote cluster when sniff mode is\n+    configured.", "originalCommit": "99c16800a8949dfb09f7665d9a7f5ca5b685315f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTAzODY4Mg==", "url": "https://github.com/elastic/elasticsearch/pull/52779#discussion_r385038682", "bodyText": "Double indented.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            `max_connections_per_cluster`::\n          \n          \n            \n            \tThe maximum number of connections maintained for the remote cluster when\n          \n          \n            \n            \tsniff mode is configured.\n          \n          \n            \n            `max_connections_per_cluster`::\n          \n          \n            \n                  Maximum number of connections maintained for the remote cluster when\n          \n          \n            \n                  sniff mode is configured.", "author": "jrodewig", "createdAt": "2020-02-27T10:28:40Z", "path": "docs/reference/cluster/remote-info.asciidoc", "diffHunk": "@@ -17,29 +17,47 @@ Returns configured remote cluster information.\n ==== {api-description-title}\n \n The cluster remote info API allows you to retrieve all of the configured\n-remote cluster information. It returns connection and endpoint information keyed \n+remote cluster information. It returns connection and endpoint information keyed\n by the configured remote cluster alias.\n \n \n [[cluster-remote-info-api-response-body]]\n ==== {api-response-body-title}\n \n-`seeds`::\n-\tThe configured initial seed transport addresses of the remote cluster.\n+`mode`::\n+    The configured connection mode for the remote cluster. Will be `sniff` or\n+    `proxy`.\n \n `connected`::\n \tTrue if there is at least one connection to the remote cluster.\n \n-`num_nodes_connected`::\n-    The number of connected nodes in the remote cluster.\n-\n-`max_connections_per_cluster`::\n-\tThe maximum number of connections maintained for the remote cluster.\n-\n `initial_connect_timeout`::\n \tThe initial connect timeout for remote cluster connections.\n \n [[skip-unavailable]]\n `skip_unavailable`::\n     Whether the remote cluster is skipped in case it is searched through\n     a {ccs} request but none of its nodes are available.\n+\n+`seeds`::\n+\tThe configured initial seed transport addresses of the remote cluster when\n+\tsniff mode is configured.\n+\n+`num_nodes_connected`::\n+    The number of connected nodes in the remote cluster when sniff mode is\n+    configured.\n+\n+`max_connections_per_cluster`::\n+\tThe maximum number of connections maintained for the remote cluster when\n+\tsniff mode is configured.", "originalCommit": "99c16800a8949dfb09f7665d9a7f5ca5b685315f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTAzOTA3OA==", "url": "https://github.com/elastic/elasticsearch/pull/52779#discussion_r385039078", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                The configured address for remote connections when proxy mode is configured.\n          \n          \n            \n                Address for remote connections when proxy mode is configured.", "author": "jrodewig", "createdAt": "2020-02-27T10:29:15Z", "path": "docs/reference/cluster/remote-info.asciidoc", "diffHunk": "@@ -17,29 +17,47 @@ Returns configured remote cluster information.\n ==== {api-description-title}\n \n The cluster remote info API allows you to retrieve all of the configured\n-remote cluster information. It returns connection and endpoint information keyed \n+remote cluster information. It returns connection and endpoint information keyed\n by the configured remote cluster alias.\n \n \n [[cluster-remote-info-api-response-body]]\n ==== {api-response-body-title}\n \n-`seeds`::\n-\tThe configured initial seed transport addresses of the remote cluster.\n+`mode`::\n+    The configured connection mode for the remote cluster. Will be `sniff` or\n+    `proxy`.\n \n `connected`::\n \tTrue if there is at least one connection to the remote cluster.\n \n-`num_nodes_connected`::\n-    The number of connected nodes in the remote cluster.\n-\n-`max_connections_per_cluster`::\n-\tThe maximum number of connections maintained for the remote cluster.\n-\n `initial_connect_timeout`::\n \tThe initial connect timeout for remote cluster connections.\n \n [[skip-unavailable]]\n `skip_unavailable`::\n     Whether the remote cluster is skipped in case it is searched through\n     a {ccs} request but none of its nodes are available.\n+\n+`seeds`::\n+\tThe configured initial seed transport addresses of the remote cluster when\n+\tsniff mode is configured.\n+\n+`num_nodes_connected`::\n+    The number of connected nodes in the remote cluster when sniff mode is\n+    configured.\n+\n+`max_connections_per_cluster`::\n+\tThe maximum number of connections maintained for the remote cluster when\n+\tsniff mode is configured.\n+\n+`address`::\n+    The configured address for remote connections when proxy mode is configured.", "originalCommit": "99c16800a8949dfb09f7665d9a7f5ca5b685315f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTAzOTM1Nw==", "url": "https://github.com/elastic/elasticsearch/pull/52779#discussion_r385039357", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                The number of open socket connections to the remote cluster when proxy mode\n          \n          \n            \n                is configured.\n          \n          \n            \n                Number of open socket connections to the remote cluster when proxy mode\n          \n          \n            \n                is configured.", "author": "jrodewig", "createdAt": "2020-02-27T10:29:44Z", "path": "docs/reference/cluster/remote-info.asciidoc", "diffHunk": "@@ -17,29 +17,47 @@ Returns configured remote cluster information.\n ==== {api-description-title}\n \n The cluster remote info API allows you to retrieve all of the configured\n-remote cluster information. It returns connection and endpoint information keyed \n+remote cluster information. It returns connection and endpoint information keyed\n by the configured remote cluster alias.\n \n \n [[cluster-remote-info-api-response-body]]\n ==== {api-response-body-title}\n \n-`seeds`::\n-\tThe configured initial seed transport addresses of the remote cluster.\n+`mode`::\n+    The configured connection mode for the remote cluster. Will be `sniff` or\n+    `proxy`.\n \n `connected`::\n \tTrue if there is at least one connection to the remote cluster.\n \n-`num_nodes_connected`::\n-    The number of connected nodes in the remote cluster.\n-\n-`max_connections_per_cluster`::\n-\tThe maximum number of connections maintained for the remote cluster.\n-\n `initial_connect_timeout`::\n \tThe initial connect timeout for remote cluster connections.\n \n [[skip-unavailable]]\n `skip_unavailable`::\n     Whether the remote cluster is skipped in case it is searched through\n     a {ccs} request but none of its nodes are available.\n+\n+`seeds`::\n+\tThe configured initial seed transport addresses of the remote cluster when\n+\tsniff mode is configured.\n+\n+`num_nodes_connected`::\n+    The number of connected nodes in the remote cluster when sniff mode is\n+    configured.\n+\n+`max_connections_per_cluster`::\n+\tThe maximum number of connections maintained for the remote cluster when\n+\tsniff mode is configured.\n+\n+`address`::\n+    The configured address for remote connections when proxy mode is configured.\n+\n+`num_sockets_connected`::\n+    The number of open socket connections to the remote cluster when proxy mode\n+    is configured.", "originalCommit": "99c16800a8949dfb09f7665d9a7f5ca5b685315f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTAzOTU4Nw==", "url": "https://github.com/elastic/elasticsearch/pull/52779#discussion_r385039587", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            `max_socket_connections`::\n          \n          \n            \n            \tThe maximum number of socket connections to the remote cluster when proxy\n          \n          \n            \n            \tmode is configured.\n          \n          \n            \n            `max_socket_connections`::\n          \n          \n            \n                Maximum number of socket connections to the remote cluster when proxy\n          \n          \n            \n                mode is configured.", "author": "jrodewig", "createdAt": "2020-02-27T10:30:12Z", "path": "docs/reference/cluster/remote-info.asciidoc", "diffHunk": "@@ -17,29 +17,47 @@ Returns configured remote cluster information.\n ==== {api-description-title}\n \n The cluster remote info API allows you to retrieve all of the configured\n-remote cluster information. It returns connection and endpoint information keyed \n+remote cluster information. It returns connection and endpoint information keyed\n by the configured remote cluster alias.\n \n \n [[cluster-remote-info-api-response-body]]\n ==== {api-response-body-title}\n \n-`seeds`::\n-\tThe configured initial seed transport addresses of the remote cluster.\n+`mode`::\n+    The configured connection mode for the remote cluster. Will be `sniff` or\n+    `proxy`.\n \n `connected`::\n \tTrue if there is at least one connection to the remote cluster.\n \n-`num_nodes_connected`::\n-    The number of connected nodes in the remote cluster.\n-\n-`max_connections_per_cluster`::\n-\tThe maximum number of connections maintained for the remote cluster.\n-\n `initial_connect_timeout`::\n \tThe initial connect timeout for remote cluster connections.\n \n [[skip-unavailable]]\n `skip_unavailable`::\n     Whether the remote cluster is skipped in case it is searched through\n     a {ccs} request but none of its nodes are available.\n+\n+`seeds`::\n+\tThe configured initial seed transport addresses of the remote cluster when\n+\tsniff mode is configured.\n+\n+`num_nodes_connected`::\n+    The number of connected nodes in the remote cluster when sniff mode is\n+    configured.\n+\n+`max_connections_per_cluster`::\n+\tThe maximum number of connections maintained for the remote cluster when\n+\tsniff mode is configured.\n+\n+`address`::\n+    The configured address for remote connections when proxy mode is configured.\n+\n+`num_sockets_connected`::\n+    The number of open socket connections to the remote cluster when proxy mode\n+    is configured.\n+\n+`max_socket_connections`::\n+\tThe maximum number of socket connections to the remote cluster when proxy\n+\tmode is configured.", "originalCommit": "99c16800a8949dfb09f7665d9a7f5ca5b685315f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTA0MDg0Nw==", "url": "https://github.com/elastic/elasticsearch/pull/52779#discussion_r385040847", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            only to a limited number of nodes in that remote cluster. There are two\n          \n          \n            \n            to a limited number of nodes in that remote cluster. There are two", "author": "jrodewig", "createdAt": "2020-02-27T10:32:28Z", "path": "docs/reference/modules/remote-clusters.asciidoc", "diffHunk": "@@ -15,21 +15,32 @@ endif::[]\n \n // tag::how-remote-clusters-work[]\n Remote cluster connections work by configuring a remote cluster and connecting\n-only to a limited number of nodes in that remote cluster. Each remote cluster\n-is referenced by a name and a list of seed nodes. When a remote cluster is\n-registered, its cluster state is retrieved from one of the seed nodes and up\n-to three _gateway nodes_ are selected to be connected to as part of remote\n-cluster requests.\n-// end::how-remote-clusters-work[]\n+only to a limited number of nodes in that remote cluster. There are two", "originalCommit": "99c16800a8949dfb09f7665d9a7f5ca5b685315f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTA0MTM2MQ==", "url": "https://github.com/elastic/elasticsearch/pull/52779#discussion_r385041361", "bodyText": "It doesn't look like this section is reused anywhere. I would remove the tags until the content is actually reused.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            // tag::how-sniff-mode-works[]", "author": "jrodewig", "createdAt": "2020-02-27T10:33:26Z", "path": "docs/reference/modules/remote-clusters.asciidoc", "diffHunk": "@@ -15,21 +15,32 @@ endif::[]\n \n // tag::how-remote-clusters-work[]\n Remote cluster connections work by configuring a remote cluster and connecting\n-only to a limited number of nodes in that remote cluster. Each remote cluster\n-is referenced by a name and a list of seed nodes. When a remote cluster is\n-registered, its cluster state is retrieved from one of the seed nodes and up\n-to three _gateway nodes_ are selected to be connected to as part of remote\n-cluster requests.\n-// end::how-remote-clusters-work[]\n+only to a limited number of nodes in that remote cluster. There are two\n+potential modes for remote cluster connections: sniff mode and proxy mode.\n \n All the communication required between different clusters\n goes through the <<modules-transport,transport layer>>. Remote cluster\n connections consist of uni-directional connections from the coordinating\n-node to the selected remote _gateway nodes_ only.\n+node to the remote remote connections.\n+// end::how-remote-clusters-work[]\n+\n+[float]\n+[[sniff-mode]]\n+=== Sniff mode\n+\n+// tag::how-sniff-mode-works[]", "originalCommit": "99c16800a8949dfb09f7665d9a7f5ca5b685315f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTA0MTQyOA==", "url": "https://github.com/elastic/elasticsearch/pull/52779#discussion_r385041428", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            // end::how-sniff-mode-works[]", "author": "jrodewig", "createdAt": "2020-02-27T10:33:33Z", "path": "docs/reference/modules/remote-clusters.asciidoc", "diffHunk": "@@ -15,21 +15,32 @@ endif::[]\n \n // tag::how-remote-clusters-work[]\n Remote cluster connections work by configuring a remote cluster and connecting\n-only to a limited number of nodes in that remote cluster. Each remote cluster\n-is referenced by a name and a list of seed nodes. When a remote cluster is\n-registered, its cluster state is retrieved from one of the seed nodes and up\n-to three _gateway nodes_ are selected to be connected to as part of remote\n-cluster requests.\n-// end::how-remote-clusters-work[]\n+only to a limited number of nodes in that remote cluster. There are two\n+potential modes for remote cluster connections: sniff mode and proxy mode.\n \n All the communication required between different clusters\n goes through the <<modules-transport,transport layer>>. Remote cluster\n connections consist of uni-directional connections from the coordinating\n-node to the selected remote _gateway nodes_ only.\n+node to the remote remote connections.\n+// end::how-remote-clusters-work[]\n+\n+[float]\n+[[sniff-mode]]\n+=== Sniff mode\n+\n+// tag::how-sniff-mode-works[]\n+A cluster in sniff mode is created by a name and a list of seed nodes. When a\n+remote cluster is registered, its cluster state is retrieved from one of the\n+seed nodes and up to three _gateway nodes_ are selected to be connected to as\n+part of remote cluster requests. This mode requires that the _gateway node_\n+publish addresses are exposed to the local cluster.\n+\n+The sniff mode is the default connection mode.\n+// end::how-sniff-mode-works[]", "originalCommit": "99c16800a8949dfb09f7665d9a7f5ca5b685315f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTA0MTcxMA==", "url": "https://github.com/elastic/elasticsearch/pull/52779#discussion_r385041710", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            A cluster in sniff mode is created by a name and a list of seed nodes. When a\n          \n          \n            \n            In sniff mode,  a cluster is created using a name and a list of seed nodes. When a", "author": "jrodewig", "createdAt": "2020-02-27T10:34:06Z", "path": "docs/reference/modules/remote-clusters.asciidoc", "diffHunk": "@@ -15,21 +15,32 @@ endif::[]\n \n // tag::how-remote-clusters-work[]\n Remote cluster connections work by configuring a remote cluster and connecting\n-only to a limited number of nodes in that remote cluster. Each remote cluster\n-is referenced by a name and a list of seed nodes. When a remote cluster is\n-registered, its cluster state is retrieved from one of the seed nodes and up\n-to three _gateway nodes_ are selected to be connected to as part of remote\n-cluster requests.\n-// end::how-remote-clusters-work[]\n+only to a limited number of nodes in that remote cluster. There are two\n+potential modes for remote cluster connections: sniff mode and proxy mode.\n \n All the communication required between different clusters\n goes through the <<modules-transport,transport layer>>. Remote cluster\n connections consist of uni-directional connections from the coordinating\n-node to the selected remote _gateway nodes_ only.\n+node to the remote remote connections.\n+// end::how-remote-clusters-work[]\n+\n+[float]\n+[[sniff-mode]]\n+=== Sniff mode\n+\n+// tag::how-sniff-mode-works[]\n+A cluster in sniff mode is created by a name and a list of seed nodes. When a", "originalCommit": "99c16800a8949dfb09f7665d9a7f5ca5b685315f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTA0NDM2NA==", "url": "https://github.com/elastic/elasticsearch/pull/52779#discussion_r385044364", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            seed nodes and up to three _gateway nodes_ are selected to be connected to as\n          \n          \n            \n            part of remote cluster requests. This mode requires that the _gateway node_\n          \n          \n            \n            seed nodes and up to three _gateway nodes_ are selected as\n          \n          \n            \n            part of remote cluster requests. This mode requires that the gateway node's", "author": "jrodewig", "createdAt": "2020-02-27T10:38:55Z", "path": "docs/reference/modules/remote-clusters.asciidoc", "diffHunk": "@@ -15,21 +15,32 @@ endif::[]\n \n // tag::how-remote-clusters-work[]\n Remote cluster connections work by configuring a remote cluster and connecting\n-only to a limited number of nodes in that remote cluster. Each remote cluster\n-is referenced by a name and a list of seed nodes. When a remote cluster is\n-registered, its cluster state is retrieved from one of the seed nodes and up\n-to three _gateway nodes_ are selected to be connected to as part of remote\n-cluster requests.\n-// end::how-remote-clusters-work[]\n+only to a limited number of nodes in that remote cluster. There are two\n+potential modes for remote cluster connections: sniff mode and proxy mode.\n \n All the communication required between different clusters\n goes through the <<modules-transport,transport layer>>. Remote cluster\n connections consist of uni-directional connections from the coordinating\n-node to the selected remote _gateway nodes_ only.\n+node to the remote remote connections.\n+// end::how-remote-clusters-work[]\n+\n+[float]\n+[[sniff-mode]]\n+=== Sniff mode\n+\n+// tag::how-sniff-mode-works[]\n+A cluster in sniff mode is created by a name and a list of seed nodes. When a\n+remote cluster is registered, its cluster state is retrieved from one of the\n+seed nodes and up to three _gateway nodes_ are selected to be connected to as\n+part of remote cluster requests. This mode requires that the _gateway node_", "originalCommit": "99c16800a8949dfb09f7665d9a7f5ca5b685315f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTA0NTE0OA==", "url": "https://github.com/elastic/elasticsearch/pull/52779#discussion_r385045148", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            A cluster in proxy mode is created by a name and a single proxy address. When\n          \n          \n            \n            In proxy mode, a cluster is created using a name and a single proxy address. When", "author": "jrodewig", "createdAt": "2020-02-27T10:40:27Z", "path": "docs/reference/modules/remote-clusters.asciidoc", "diffHunk": "@@ -62,9 +73,26 @@ communicate with 6.7. The matrix below summarizes compatibility as described abo\n (see <<remote-cluster-settings>>), though such tagged nodes still have\n to satisfy the two above requirements.\n \n+[float]\n+[[proxy-mode]]\n+=== Proxy mode\n+\n+// tag::how-proxy-mode-works[]\n+A cluster in proxy mode is created by a name and a single proxy address. When", "originalCommit": "99c16800a8949dfb09f7665d9a7f5ca5b685315f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTA0NTU3NQ==", "url": "https://github.com/elastic/elasticsearch/pull/52779#discussion_r385045575", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            the remote cluster. Proxy mode does not require that the remote cluster nodes\n          \n          \n            \n            publish addresses are accessible.\n          \n          \n            \n            the remote cluster. Proxy mode does not require remote cluster nodes\n          \n          \n            \n            to have accessible publish addresses.", "author": "jrodewig", "createdAt": "2020-02-27T10:41:12Z", "path": "docs/reference/modules/remote-clusters.asciidoc", "diffHunk": "@@ -62,9 +73,26 @@ communicate with 6.7. The matrix below summarizes compatibility as described abo\n (see <<remote-cluster-settings>>), though such tagged nodes still have\n to satisfy the two above requirements.\n \n+[float]\n+[[proxy-mode]]\n+=== Proxy mode\n+\n+// tag::how-proxy-mode-works[]\n+A cluster in proxy mode is created by a name and a single proxy address. When\n+a remote cluster is registered, a configurable number of socket connections are\n+opened to the proxy address. The proxy is required to route those connections to\n+the remote cluster. Proxy mode does not require that the remote cluster nodes\n+publish addresses are accessible.", "originalCommit": "99c16800a8949dfb09f7665d9a7f5ca5b685315f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTA0NzE0NA==", "url": "https://github.com/elastic/elasticsearch/pull/52779#discussion_r385047144", "bodyText": "I'd remove this unneeded tag.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            // tag::how-proxy-mode-works[]", "author": "jrodewig", "createdAt": "2020-02-27T10:44:02Z", "path": "docs/reference/modules/remote-clusters.asciidoc", "diffHunk": "@@ -62,9 +73,26 @@ communicate with 6.7. The matrix below summarizes compatibility as described abo\n (see <<remote-cluster-settings>>), though such tagged nodes still have\n to satisfy the two above requirements.\n \n+[float]\n+[[proxy-mode]]\n+=== Proxy mode\n+\n+// tag::how-proxy-mode-works[]", "originalCommit": "99c16800a8949dfb09f7665d9a7f5ca5b685315f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTA0NzIwNw==", "url": "https://github.com/elastic/elasticsearch/pull/52779#discussion_r385047207", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            // end::how-proxy-mode-works[]", "author": "jrodewig", "createdAt": "2020-02-27T10:44:09Z", "path": "docs/reference/modules/remote-clusters.asciidoc", "diffHunk": "@@ -62,9 +73,26 @@ communicate with 6.7. The matrix below summarizes compatibility as described abo\n (see <<remote-cluster-settings>>), though such tagged nodes still have\n to satisfy the two above requirements.\n \n+[float]\n+[[proxy-mode]]\n+=== Proxy mode\n+\n+// tag::how-proxy-mode-works[]\n+A cluster in proxy mode is created by a name and a single proxy address. When\n+a remote cluster is registered, a configurable number of socket connections are\n+opened to the proxy address. The proxy is required to route those connections to\n+the remote cluster. Proxy mode does not require that the remote cluster nodes\n+publish addresses are accessible.\n+\n+The proxy mode is not the default connection mode and must be configured. Similar\n+to the sniff <<gateway-nodes-selection,gateway nodes>>, the remote\n+connections are subject to the same version compatibility rules as\n+<<rolling-upgrades>>.\n+// end::how-proxy-mode-works[]", "originalCommit": "99c16800a8949dfb09f7665d9a7f5ca5b685315f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTA0OTYzMA==", "url": "https://github.com/elastic/elasticsearch/pull/52779#discussion_r385049630", "bodyText": "The content in this tagged region gets re-used here:\nhttps://www.elastic.co/guide/en/elasticsearch/reference/master/modules-cross-cluster-search.html#ccs-works\nOriginally, that was intended to explain the concept of gateway nodes before the recommendations outlined here:\nhttps://www.elastic.co/guide/en/elasticsearch/reference/master/modules-cross-cluster-search.html#ccs-gateway-seed-nodes\nWith these changes, I don't think this re-use makes sense anymore. I'm also not sure if those recommendations would work with proxy mode.\nCould you advise on how these changes would impact those CCS recommendations? After that, you can either update those docs as a part of this PR or I can update them as part of a separate PR. Thanks!", "author": "jrodewig", "createdAt": "2020-02-27T10:48:31Z", "path": "docs/reference/modules/remote-clusters.asciidoc", "diffHunk": "@@ -15,21 +15,32 @@ endif::[]\n \n // tag::how-remote-clusters-work[]", "originalCommit": "99c16800a8949dfb09f7665d9a7f5ca5b685315f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e97d0216ce7062aedced50f47a1a7ae3929baece", "url": "https://github.com/elastic/elasticsearch/commit/e97d0216ce7062aedced50f47a1a7ae3929baece", "message": "Update CCS docs", "committedDate": "2020-02-28T19:41:36Z", "type": "commit"}, {"oid": "5aaca4afe8626a9d76e6f31bf993d4e9d4c0da3f", "url": "https://github.com/elastic/elasticsearch/commit/5aaca4afe8626a9d76e6f31bf993d4e9d4c0da3f", "message": "Changes", "committedDate": "2020-03-03T19:23:51Z", "type": "commit"}, {"oid": "ee8fa9ce0896002c0b9d061fda554fe02075789f", "url": "https://github.com/elastic/elasticsearch/commit/ee8fa9ce0896002c0b9d061fda554fe02075789f", "message": "Merge remote-tracking branch 'upstream/master' into proxy_mode_documentation", "committedDate": "2020-03-03T19:37:18Z", "type": "commit"}, {"oid": "0ec618aa8607dd77cbdabf01168a5df0a12dc214", "url": "https://github.com/elastic/elasticsearch/commit/0ec618aa8607dd77cbdabf01168a5df0a12dc214", "message": "Fix", "committedDate": "2020-03-03T19:38:32Z", "type": "commit"}, {"oid": "13f22e849601c57c34de60bf5b5c34303dfaec16", "url": "https://github.com/elastic/elasticsearch/commit/13f22e849601c57c34de60bf5b5c34303dfaec16", "message": "Changes", "committedDate": "2020-03-03T20:33:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU0MTIxMQ==", "url": "https://github.com/elastic/elasticsearch/pull/52779#discussion_r387541211", "bodyText": "This is required for the link to render properly.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            For remote clusters using the <<sniff-mode,sniff connection> mode, gateway and\n          \n          \n            \n            For remote clusters using the <<sniff-mode,sniff connection>> mode, gateway and", "author": "jrodewig", "createdAt": "2020-03-04T09:26:24Z", "path": "docs/reference/modules/cross-cluster-search.asciidoc", "diffHunk": "@@ -253,30 +253,33 @@ PUT _cluster/settings\n If `cluster_two` is disconnected or unavailable during a {ccs}, {es} won't\n include matching documents from that cluster in the final results.\n \n-[discrete]\n-[[ccs-works]]\n-== How {ccs} works\n-\n-include::./remote-clusters.asciidoc[tag=how-remote-clusters-work]\n-\n [discrete]\n [[ccs-gateway-seed-nodes]]\n-=== Selecting gateway and seed nodes\n+== Selecting gateway and seed nodes in sniff mode\n \n-Gateway and seed nodes need to be accessible from the local cluster via your\n-network.\n+For remote clusters using the <<sniff-mode,sniff connection> mode, gateway and", "originalCommit": "13f22e849601c57c34de60bf5b5c34303dfaec16", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU0MTY0Mg==", "url": "https://github.com/elastic/elasticsearch/pull/52779#discussion_r387541642", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            connections will connect to the configured `proxy_address`. Any desired\n          \n          \n            \n            connections connect to the configured `proxy_address`. Any desired", "author": "jrodewig", "createdAt": "2020-03-04T09:27:11Z", "path": "docs/reference/modules/cross-cluster-search.asciidoc", "diffHunk": "@@ -253,30 +253,33 @@ PUT _cluster/settings\n If `cluster_two` is disconnected or unavailable during a {ccs}, {es} won't\n include matching documents from that cluster in the final results.\n \n-[discrete]\n-[[ccs-works]]\n-== How {ccs} works\n-\n-include::./remote-clusters.asciidoc[tag=how-remote-clusters-work]\n-\n [discrete]\n [[ccs-gateway-seed-nodes]]\n-=== Selecting gateway and seed nodes\n+== Selecting gateway and seed nodes in sniff mode\n \n-Gateway and seed nodes need to be accessible from the local cluster via your\n-network.\n+For remote clusters using the <<sniff-mode,sniff connection> mode, gateway and\n+seed nodes need to be accessible from the local cluster via your network.\n \n-By default, any master-ineligible node can act as a gateway node. If wanted,\n-you can define the gateway nodes for a cluster by setting\n-`cluster.remote.node.attr.gateway` to `true`.\n+By default, any non-<<master-node,master-eligible>> node can act as a\n+gateway node. If wanted, you can define the gateway nodes for a cluster by\n+setting `cluster.remote.node.attr.gateway` to `true`.\n \n For {ccs}, we recommend you use gateway nodes that are capable of serving as\n <<coordinating-node,coordinating nodes>> for search requests. If\n wanted, the seed nodes for a cluster can be a subset of these gateway nodes.\n \n+[discrete]\n+[[ccs-proxy-mode]]\n+== {ccs} in proxy mode\n+\n+<<proxy-mode,Proxy mode>> remote cluster connections support {ccs}. All remote\n+connections will connect to the configured `proxy_address`. Any desired", "originalCommit": "13f22e849601c57c34de60bf5b5c34303dfaec16", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU0MzM1MQ==", "url": "https://github.com/elastic/elasticsearch/pull/52779#discussion_r387543351", "bodyText": "\"accessible\" is more consistent with what's stated in \"proxy\" mode and has less of a negative connotation.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            cluster requests. This mode requires that the gateway node's publish addresses\n          \n          \n            \n            are exposed to the local cluster.\n          \n          \n            \n            cluster requests. This mode requires that the gateway node's publish addresses\n          \n          \n            \n            are accessible by the local cluster.", "author": "jrodewig", "createdAt": "2020-03-04T09:30:23Z", "path": "docs/reference/modules/remote-clusters.asciidoc", "diffHunk": "@@ -13,23 +13,31 @@ connections to a remote cluster. This functionality is used in\n <<modules-cross-cluster-search,{ccs}>>.\n endif::[]\n \n-// tag::how-remote-clusters-work[]\n Remote cluster connections work by configuring a remote cluster and connecting\n-only to a limited number of nodes in that remote cluster. Each remote cluster\n-is referenced by a name and a list of seed nodes. When a remote cluster is\n-registered, its cluster state is retrieved from one of the seed nodes and up\n-to three _gateway nodes_ are selected to be connected to as part of remote\n-cluster requests.\n-// end::how-remote-clusters-work[]\n+to a limited number of nodes in that remote cluster. There are two modes for\n+remote cluster connections: <<sniff-mode,sniff mode>> and\n+<<proxy-mode,proxy mode>>.\n \n All the communication required between different clusters\n goes through the <<modules-transport,transport layer>>. Remote cluster\n connections consist of uni-directional connections from the coordinating\n-node to the selected remote _gateway nodes_ only.\n+node to the remote remote connections.\n+\n+[float]\n+[[sniff-mode]]\n+=== Sniff mode\n+\n+In sniff mode, a cluster is created using a name and a list of seed nodes. When\n+a remote cluster is registered, its cluster state is retrieved from one of the\n+seed nodes and up to three _gateway nodes_ are selected as part of remote\n+cluster requests. This mode requires that the gateway node's publish addresses\n+are exposed to the local cluster.", "originalCommit": "13f22e849601c57c34de60bf5b5c34303dfaec16", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU0NDA4Mg==", "url": "https://github.com/elastic/elasticsearch/pull/52779#discussion_r387544082", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            <4> The configured connection mode. By default it is <<sniff-mode,sniff>>, so\n          \n          \n            \n            <4> The configured connection mode. By default, this is <<sniff-mode,`sniff`>>, so", "author": "jrodewig", "createdAt": "2020-03-04T09:31:32Z", "path": "docs/reference/modules/remote-clusters.asciidoc", "diffHunk": "@@ -83,23 +106,32 @@ cluster:\n         cluster_one: <1>\n             seeds: 127.0.0.1:9300 <2>\n             transport.ping_schedule: 30s <3>\n-        cluster_two: \n-            seeds: 127.0.0.1:9301\n-            transport.compress: true <4>\n-            skip_unavailable: true <5>\n+        cluster_two: <1>\n+            mode: sniff <4>\n+            seeds: 127.0.0.1:9301 <2>\n+            transport.compress: true <5>\n+            skip_unavailable: true <6>\n+        cluster_three: <1>\n+            mode: proxy <4>\n+            proxy_address: 127.0.0.1:9302 <7>\n \n --------------------------------\n-<1> `cluster_one` and `cluster_two` are arbitrary _cluster aliases_ representing\n-the connection to each cluster. These names are subsequently used to distinguish\n-between local and remote indices.\n+<1> `cluster_one`, `cluster_two`, and `cluster_three` are arbitrary _cluster aliases_\n+representing the connection to each cluster. These names are subsequently used to\n+distinguish between local and remote indices.\n <2> The hostname and <<modules-transport,transport>> port (default: 9300) of a\n seed node in the remote cluster.\n <3> A keep-alive ping is configured for `cluster_one`.\n-<4> Compression is explicitly enabled for requests to `cluster_two`.\n-<5> Disconnected remote clusters are optional for `cluster_two`.\n+<4> The configured connection mode. By default it is <<sniff-mode,sniff>>, so", "originalCommit": "13f22e849601c57c34de60bf5b5c34303dfaec16", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU0NTM2OA==", "url": "https://github.com/elastic/elasticsearch/pull/52779#discussion_r387545368", "bodyText": "Our docs typically use the <variable> convention.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            `cluster.remote.${cluster_alias}.seeds`::\n          \n          \n            \n            `cluster.remote.<cluster_alias>.seeds`::", "author": "jrodewig", "createdAt": "2020-03-04T09:33:45Z", "path": "docs/reference/modules/remote-clusters.asciidoc", "diffHunk": "@@ -251,6 +287,49 @@ PUT _cluster/settings\n   Elasticsearch compresses the response. If unset, the global\n   `transport.compress` is used as the fallback setting.\n \n+[float]\n+[[remote-cluster-sniff-settings]]\n+=== Remote cluster settings for sniff mode\n+\n+`cluster.remote.${cluster_alias}.seeds`::", "originalCommit": "13f22e849601c57c34de60bf5b5c34303dfaec16", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU0NTUzNg==", "url": "https://github.com/elastic/elasticsearch/pull/52779#discussion_r387545536", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            `cluster.remote.${cluster_alias}.node_connections`::\n          \n          \n            \n            `cluster.remote.<cluster_alias>.node_connections`::", "author": "jrodewig", "createdAt": "2020-03-04T09:34:05Z", "path": "docs/reference/modules/remote-clusters.asciidoc", "diffHunk": "@@ -251,6 +287,49 @@ PUT _cluster/settings\n   Elasticsearch compresses the response. If unset, the global\n   `transport.compress` is used as the fallback setting.\n \n+[float]\n+[[remote-cluster-sniff-settings]]\n+=== Remote cluster settings for sniff mode\n+\n+`cluster.remote.${cluster_alias}.seeds`::\n+\n+  The list of seed nodes used to sniff the remote cluster state.\n+\n+`cluster.remote.${cluster_alias}.node_connections`::", "originalCommit": "13f22e849601c57c34de60bf5b5c34303dfaec16", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU0NTc1Mg==", "url": "https://github.com/elastic/elasticsearch/pull/52779#discussion_r387545752", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            `cluster.remote.${cluster_alias}.proxy_address`::\n          \n          \n            \n            `cluster.remote.<cluster_alias>.proxy_address`::", "author": "jrodewig", "createdAt": "2020-03-04T09:34:31Z", "path": "docs/reference/modules/remote-clusters.asciidoc", "diffHunk": "@@ -251,6 +287,49 @@ PUT _cluster/settings\n   Elasticsearch compresses the response. If unset, the global\n   `transport.compress` is used as the fallback setting.\n \n+[float]\n+[[remote-cluster-sniff-settings]]\n+=== Remote cluster settings for sniff mode\n+\n+`cluster.remote.${cluster_alias}.seeds`::\n+\n+  The list of seed nodes used to sniff the remote cluster state.\n+\n+`cluster.remote.${cluster_alias}.node_connections`::\n+\n+  The number of gateway nodes to connect to for this remote cluster. The default\n+  is `3`.\n+\n+`cluster.remote.node.attr`::\n+\n+  A node attribute to filter out nodes that are eligible as a gateway node in\n+  the remote cluster. For instance a node can have a node attribute\n+  `node.attr.gateway: true` such that only nodes with this attribute will be\n+  connected to if `cluster.remote.node.attr` is set to `gateway`.\n+\n+[float]\n+[[remote-cluster-proxy-settings]]\n+=== Remote cluster settings for proxy mode\n+\n+`cluster.remote.${cluster_alias}.proxy_address`::", "originalCommit": "13f22e849601c57c34de60bf5b5c34303dfaec16", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU0NTg1OA==", "url": "https://github.com/elastic/elasticsearch/pull/52779#discussion_r387545858", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            `cluster.remote.${cluster_alias}.proxy_socket_connections`::\n          \n          \n            \n            `cluster.remote.<cluster_alias>.proxy_socket_connections`::", "author": "jrodewig", "createdAt": "2020-03-04T09:34:43Z", "path": "docs/reference/modules/remote-clusters.asciidoc", "diffHunk": "@@ -251,6 +287,49 @@ PUT _cluster/settings\n   Elasticsearch compresses the response. If unset, the global\n   `transport.compress` is used as the fallback setting.\n \n+[float]\n+[[remote-cluster-sniff-settings]]\n+=== Remote cluster settings for sniff mode\n+\n+`cluster.remote.${cluster_alias}.seeds`::\n+\n+  The list of seed nodes used to sniff the remote cluster state.\n+\n+`cluster.remote.${cluster_alias}.node_connections`::\n+\n+  The number of gateway nodes to connect to for this remote cluster. The default\n+  is `3`.\n+\n+`cluster.remote.node.attr`::\n+\n+  A node attribute to filter out nodes that are eligible as a gateway node in\n+  the remote cluster. For instance a node can have a node attribute\n+  `node.attr.gateway: true` such that only nodes with this attribute will be\n+  connected to if `cluster.remote.node.attr` is set to `gateway`.\n+\n+[float]\n+[[remote-cluster-proxy-settings]]\n+=== Remote cluster settings for proxy mode\n+\n+`cluster.remote.${cluster_alias}.proxy_address`::\n+\n+  The address used for all remote connections.\n+\n+`cluster.remote.${cluster_alias}.proxy_socket_connections`::", "originalCommit": "13f22e849601c57c34de60bf5b5c34303dfaec16", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU1MDY0MQ==", "url": "https://github.com/elastic/elasticsearch/pull/52779#discussion_r387550641", "bodyText": "I think this should be ifdef, not ifndef.\nI'm also not sure if it's necessary to do ifdef::include-xpack[]. Adding [role=\"xpack\"] before the setting def should suffice. From what I understand, ifdef::include-xpack[] and ifndef::include-xpack[] have not been functional for some time.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            ifndef::include-xpack[]\n          \n          \n            \n            \n          \n          \n            \n            `cluster.remote.${cluster_alias}.server_name`::\n          \n          \n            \n            \n          \n          \n            \n            [role=\"xpack\"]\n          \n          \n            \n            `cluster.remote.${cluster_alias}.server_name`::", "author": "jrodewig", "createdAt": "2020-03-04T09:43:12Z", "path": "docs/reference/modules/remote-clusters.asciidoc", "diffHunk": "@@ -251,6 +287,49 @@ PUT _cluster/settings\n   Elasticsearch compresses the response. If unset, the global\n   `transport.compress` is used as the fallback setting.\n \n+[float]\n+[[remote-cluster-sniff-settings]]\n+=== Remote cluster settings for sniff mode\n+\n+`cluster.remote.${cluster_alias}.seeds`::\n+\n+  The list of seed nodes used to sniff the remote cluster state.\n+\n+`cluster.remote.${cluster_alias}.node_connections`::\n+\n+  The number of gateway nodes to connect to for this remote cluster. The default\n+  is `3`.\n+\n+`cluster.remote.node.attr`::\n+\n+  A node attribute to filter out nodes that are eligible as a gateway node in\n+  the remote cluster. For instance a node can have a node attribute\n+  `node.attr.gateway: true` such that only nodes with this attribute will be\n+  connected to if `cluster.remote.node.attr` is set to `gateway`.\n+\n+[float]\n+[[remote-cluster-proxy-settings]]\n+=== Remote cluster settings for proxy mode\n+\n+`cluster.remote.${cluster_alias}.proxy_address`::\n+\n+  The address used for all remote connections.\n+\n+`cluster.remote.${cluster_alias}.proxy_socket_connections`::\n+\n+  The number of socket connections to open per remote cluster. The default is\n+  `18`.\n+ifndef::include-xpack[]\n+\n+`cluster.remote.${cluster_alias}.server_name`::", "originalCommit": "13f22e849601c57c34de60bf5b5c34303dfaec16", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU1MDc0Mw==", "url": "https://github.com/elastic/elasticsearch/pull/52779#discussion_r387550743", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            endif::[]", "author": "jrodewig", "createdAt": "2020-03-04T09:43:22Z", "path": "docs/reference/modules/remote-clusters.asciidoc", "diffHunk": "@@ -251,6 +287,49 @@ PUT _cluster/settings\n   Elasticsearch compresses the response. If unset, the global\n   `transport.compress` is used as the fallback setting.\n \n+[float]\n+[[remote-cluster-sniff-settings]]\n+=== Remote cluster settings for sniff mode\n+\n+`cluster.remote.${cluster_alias}.seeds`::\n+\n+  The list of seed nodes used to sniff the remote cluster state.\n+\n+`cluster.remote.${cluster_alias}.node_connections`::\n+\n+  The number of gateway nodes to connect to for this remote cluster. The default\n+  is `3`.\n+\n+`cluster.remote.node.attr`::\n+\n+  A node attribute to filter out nodes that are eligible as a gateway node in\n+  the remote cluster. For instance a node can have a node attribute\n+  `node.attr.gateway: true` such that only nodes with this attribute will be\n+  connected to if `cluster.remote.node.attr` is set to `gateway`.\n+\n+[float]\n+[[remote-cluster-proxy-settings]]\n+=== Remote cluster settings for proxy mode\n+\n+`cluster.remote.${cluster_alias}.proxy_address`::\n+\n+  The address used for all remote connections.\n+\n+`cluster.remote.${cluster_alias}.proxy_socket_connections`::\n+\n+  The number of socket connections to open per remote cluster. The default is\n+  `18`.\n+ifndef::include-xpack[]\n+\n+`cluster.remote.${cluster_alias}.server_name`::\n+\n+  An optional hostname string which will be sent in the server_name field of\n+  the TLS Server Name Indication extension if\n+  <<configuring-tls,{TLS is enabled}>>. The TLS transport will fail to open\n+  remote connections if this field is not a valid hostname as defined by the\n+  TLS SNI specification.\n+endif::[]", "originalCommit": "13f22e849601c57c34de60bf5b5c34303dfaec16", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU1MDkzMw==", "url": "https://github.com/elastic/elasticsearch/pull/52779#discussion_r387550933", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              An optional hostname string which will be sent in the server_name field of\n          \n          \n            \n              An optional hostname string which is sent in the `server_name` field of", "author": "jrodewig", "createdAt": "2020-03-04T09:43:45Z", "path": "docs/reference/modules/remote-clusters.asciidoc", "diffHunk": "@@ -251,6 +287,49 @@ PUT _cluster/settings\n   Elasticsearch compresses the response. If unset, the global\n   `transport.compress` is used as the fallback setting.\n \n+[float]\n+[[remote-cluster-sniff-settings]]\n+=== Remote cluster settings for sniff mode\n+\n+`cluster.remote.${cluster_alias}.seeds`::\n+\n+  The list of seed nodes used to sniff the remote cluster state.\n+\n+`cluster.remote.${cluster_alias}.node_connections`::\n+\n+  The number of gateway nodes to connect to for this remote cluster. The default\n+  is `3`.\n+\n+`cluster.remote.node.attr`::\n+\n+  A node attribute to filter out nodes that are eligible as a gateway node in\n+  the remote cluster. For instance a node can have a node attribute\n+  `node.attr.gateway: true` such that only nodes with this attribute will be\n+  connected to if `cluster.remote.node.attr` is set to `gateway`.\n+\n+[float]\n+[[remote-cluster-proxy-settings]]\n+=== Remote cluster settings for proxy mode\n+\n+`cluster.remote.${cluster_alias}.proxy_address`::\n+\n+  The address used for all remote connections.\n+\n+`cluster.remote.${cluster_alias}.proxy_socket_connections`::\n+\n+  The number of socket connections to open per remote cluster. The default is\n+  `18`.\n+ifndef::include-xpack[]\n+\n+`cluster.remote.${cluster_alias}.server_name`::\n+\n+  An optional hostname string which will be sent in the server_name field of", "originalCommit": "13f22e849601c57c34de60bf5b5c34303dfaec16", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU1MTMzMw==", "url": "https://github.com/elastic/elasticsearch/pull/52779#discussion_r387551333", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              <<configuring-tls,{TLS is enabled}>>. The TLS transport will fail to open\n          \n          \n            \n              <<configuring-tls,TLS is enabled>>. The TLS transport will fail to open", "author": "jrodewig", "createdAt": "2020-03-04T09:44:22Z", "path": "docs/reference/modules/remote-clusters.asciidoc", "diffHunk": "@@ -251,6 +287,49 @@ PUT _cluster/settings\n   Elasticsearch compresses the response. If unset, the global\n   `transport.compress` is used as the fallback setting.\n \n+[float]\n+[[remote-cluster-sniff-settings]]\n+=== Remote cluster settings for sniff mode\n+\n+`cluster.remote.${cluster_alias}.seeds`::\n+\n+  The list of seed nodes used to sniff the remote cluster state.\n+\n+`cluster.remote.${cluster_alias}.node_connections`::\n+\n+  The number of gateway nodes to connect to for this remote cluster. The default\n+  is `3`.\n+\n+`cluster.remote.node.attr`::\n+\n+  A node attribute to filter out nodes that are eligible as a gateway node in\n+  the remote cluster. For instance a node can have a node attribute\n+  `node.attr.gateway: true` such that only nodes with this attribute will be\n+  connected to if `cluster.remote.node.attr` is set to `gateway`.\n+\n+[float]\n+[[remote-cluster-proxy-settings]]\n+=== Remote cluster settings for proxy mode\n+\n+`cluster.remote.${cluster_alias}.proxy_address`::\n+\n+  The address used for all remote connections.\n+\n+`cluster.remote.${cluster_alias}.proxy_socket_connections`::\n+\n+  The number of socket connections to open per remote cluster. The default is\n+  `18`.\n+ifndef::include-xpack[]\n+\n+`cluster.remote.${cluster_alias}.server_name`::\n+\n+  An optional hostname string which will be sent in the server_name field of\n+  the TLS Server Name Indication extension if\n+  <<configuring-tls,{TLS is enabled}>>. The TLS transport will fail to open", "originalCommit": "13f22e849601c57c34de60bf5b5c34303dfaec16", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU1MTY3OA==", "url": "https://github.com/elastic/elasticsearch/pull/52779#discussion_r387551678", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            you must re-include seeds or proxy_address in the settings update request.\n          \n          \n            \n            you must re-include seeds or a `proxy_address` in the settings update request.", "author": "jrodewig", "createdAt": "2020-03-04T09:44:59Z", "path": "docs/reference/modules/remote-clusters.asciidoc", "diffHunk": "@@ -139,7 +171,8 @@ PUT _cluster/settings\n // TEST[s/127.0.0.1:9300/\\${transport_host}/]\n \n You can dynamically update the compression and ping schedule settings. However,\n-you must re-include seeds in the settings update request. For example:\n+you must re-include seeds or proxy_address in the settings update request.", "originalCommit": "13f22e849601c57c34de60bf5b5c34303dfaec16", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU1MzE5Ng==", "url": "https://github.com/elastic/elasticsearch/pull/52779#discussion_r387553196", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            The sniff mode is the default connection mode.\n          \n          \n            \n            Sniff mode is the default connection mode.", "author": "jrodewig", "createdAt": "2020-03-04T09:47:34Z", "path": "docs/reference/modules/remote-clusters.asciidoc", "diffHunk": "@@ -13,23 +13,31 @@ connections to a remote cluster. This functionality is used in\n <<modules-cross-cluster-search,{ccs}>>.\n endif::[]\n \n-// tag::how-remote-clusters-work[]\n Remote cluster connections work by configuring a remote cluster and connecting\n-only to a limited number of nodes in that remote cluster. Each remote cluster\n-is referenced by a name and a list of seed nodes. When a remote cluster is\n-registered, its cluster state is retrieved from one of the seed nodes and up\n-to three _gateway nodes_ are selected to be connected to as part of remote\n-cluster requests.\n-// end::how-remote-clusters-work[]\n+to a limited number of nodes in that remote cluster. There are two modes for\n+remote cluster connections: <<sniff-mode,sniff mode>> and\n+<<proxy-mode,proxy mode>>.\n \n All the communication required between different clusters\n goes through the <<modules-transport,transport layer>>. Remote cluster\n connections consist of uni-directional connections from the coordinating\n-node to the selected remote _gateway nodes_ only.\n+node to the remote remote connections.\n+\n+[float]\n+[[sniff-mode]]\n+=== Sniff mode\n+\n+In sniff mode, a cluster is created using a name and a list of seed nodes. When\n+a remote cluster is registered, its cluster state is retrieved from one of the\n+seed nodes and up to three _gateway nodes_ are selected as part of remote\n+cluster requests. This mode requires that the gateway node's publish addresses\n+are exposed to the local cluster.\n+\n+The sniff mode is the default connection mode.", "originalCommit": "13f22e849601c57c34de60bf5b5c34303dfaec16", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "b2b7a43e5eb53c04a8c821f2a6d64fde8c1c823c", "url": "https://github.com/elastic/elasticsearch/commit/b2b7a43e5eb53c04a8c821f2a6d64fde8c1c823c", "message": "Changes", "committedDate": "2020-03-09T16:18:22Z", "type": "commit"}]}