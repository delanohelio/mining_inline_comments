{"pr_number": 59730, "pr_title": "[DOCS] Updating snapshot/restore pages to align with API changes", "pr_createdAt": "2020-07-16T20:28:35Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/59730", "timeline": [{"oid": "50ddf450fedd9d0c4d1e2550ca232515479d88e2", "url": "https://github.com/elastic/elasticsearch/commit/50ddf450fedd9d0c4d1e2550ca232515479d88e2", "message": "Updating snapshot/restore pages to align with API changes.", "committedDate": "2020-07-16T20:21:50Z", "type": "commit"}, {"oid": "45fab5ab7144a1e44d024758a09e727950178664", "url": "https://github.com/elastic/elasticsearch/commit/45fab5ab7144a1e44d024758a09e727950178664", "message": "Fixing texts in delete snapshot page.", "committedDate": "2020-07-16T21:11:47Z", "type": "commit"}, {"oid": "52d6ffce6264d8cc0a23d53923850bb170be3a0d", "url": "https://github.com/elastic/elasticsearch/commit/52d6ffce6264d8cc0a23d53923850bb170be3a0d", "message": "Removing duplicate code sample and making editorial changes.", "committedDate": "2020-07-16T21:57:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjI2Nzg3Nw==", "url": "https://github.com/elastic/elasticsearch/pull/59730#discussion_r456267877", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            snapshot and not used by any other snapshots. If the deleted snapshot operation is started while the snapshot is being\n          \n          \n            \n            snapshot and not used by any other snapshots. If the delete snapshot operation is started while the snapshot is being", "author": "original-brownbear", "createdAt": "2020-07-17T07:28:49Z", "path": "docs/reference/snapshot-restore/delete-snapshot.asciidoc", "diffHunk": "@@ -0,0 +1,48 @@\n+[[delete-snapshots]]\n+== Delete a snapshot\n+++++\n+<titleabbrev>Delete snapshot</titleabbrev>\n+++++\n+\n+////\n+[source,console]\n+-----------------------------------\n+PUT /_snapshot/my_backup\n+{\n+  \"type\": \"fs\",\n+  \"settings\": {\n+    \"location\": \"my_backup_location\"\n+  }\n+}\n+\n+PUT /_snapshot/my_backup/snapshot_1?wait_for_completion=true\n+\n+PUT /_snapshot/my_backup/snapshot_2?wait_for_completion=true\n+\n+PUT /_snapshot/my_backup/snapshot_3?wait_for_completion=true\n+-----------------------------------\n+// TESTSETUP\n+\n+////\n+\n+Use the <<delete-snapshot-api,Delete snapshot API>> to delete a snapshot\n+from the repository:\n+\n+[source,console]\n+-----------------------------------\n+DELETE /_snapshot/my_backup/snapshot_1\n+-----------------------------------\n+\n+When a snapshot is deleted from a repository, {es} deletes all files that are associated with the deleted\n+snapshot and not used by any other snapshots. If the deleted snapshot operation is started while the snapshot is being", "originalCommit": "52d6ffce6264d8cc0a23d53923850bb170be3a0d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjI2OTI5MQ==", "url": "https://github.com/elastic/elasticsearch/pull/59730#discussion_r456269291", "bodyText": "Hmm, this is a weird sentence now but it wasn't great before either. We simply don't have a good API to monitor restores yet (I'm on it though in #59233). Maybe just remove the restore bit from this sentence for now?", "author": "original-brownbear", "createdAt": "2020-07-17T07:31:41Z", "path": "docs/reference/snapshot-restore/monitor-snapshot-restore.asciidoc", "diffHunk": "@@ -1,11 +1,10 @@\n [[snapshots-monitor-snapshot-restore]]\n == Monitor snapshot and restore progress\n-\n ++++\n <titleabbrev>Monitor snapshot and restore</titleabbrev>\n ++++\n \n-There are several ways to monitor the progress of the snapshot and restore processes while they are running. Both\n+Use the <<get-snapshot-api,Get snapshot API>> or the <<get-snapshot-status-api,Get snapshot status API>> to monitor the progress of the snapshot and restore processes while they are running. Both", "originalCommit": "52d6ffce6264d8cc0a23d53923850bb170be3a0d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQwMDM0OQ==", "url": "https://github.com/elastic/elasticsearch/pull/59730#discussion_r456400349", "bodyText": "Thanks for the heads up on #59233 -- I'll keep an eye on it. For now, let's amend this statement to read:\n\nUse the <<get-snapshot-api,Get snapshot API>> or the\n<<get-snapshot-status-api,Get snapshot status API>> to monitor the\nprogress of snapshot operations. Both APIs support the\nwait_for_completion parameter that blocks the client until the\noperation finishes, which is the simplest method of being notified\nabout operation completion.", "author": "lockewritesdocs", "createdAt": "2020-07-17T12:07:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjI2OTI5MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjI3MDMwMA==", "url": "https://github.com/elastic/elasticsearch/pull/59730#discussion_r456270300", "bodyText": "status information\n\nThis is not true, you get the status. You just don't get the error message(s) in case it's not SUCCESS.", "author": "original-brownbear", "createdAt": "2020-07-17T07:33:53Z", "path": "docs/reference/snapshot-restore/monitor-snapshot-restore.asciidoc", "diffHunk": "@@ -20,71 +19,152 @@ PUT /_snapshot/my_backup\n   }\n }\n \n+PUT /_snapshot/my_fs_backup\n+{\n+  \"type\": \"fs\",\n+  \"settings\": {\n+    \"location\": \"my_other_backup_location\"\n+  }\n+}\n+\n PUT /_snapshot/my_backup/snapshot_1?wait_for_completion=true\n -----------------------------------\n // TESTSETUP\n \n ////\n \n-The snapshot operation can be also monitored by periodic calls to the snapshot info:\n+Use the `_current` parameter to retrieve all currently running\n+snapshots in the cluster:\n+\n+[source,console]\n+-----------------------------------\n+GET /_snapshot/my_backup/_current\n+-----------------------------------\n+\n+Including a snapshot name in the request retrieves information about a single snapshot:\n \n [source,console]\n -----------------------------------\n GET /_snapshot/my_backup/snapshot_1\n -----------------------------------\n \n-Please note that snapshot info operation uses the same resources and thread pool as the snapshot operation. So,\n-executing a snapshot info operation while large shards are being snapshotted can cause the snapshot info operation to wait\n-for available resources before returning the result. On very large shards the wait time can be significant.\n+This request retrieves basic information about the snapshot, including start and end time, version of\n+{es} that created the snapshot, the list of included data streams and indices, the current state of the\n+snapshot and the list of failures that occurred during the snapshot.\n \n-To get more immediate and complete information about snapshots the snapshot status command can be used instead:\n+Similar to repositories, you can retrieve information about multiple snapshots in a single request, and wildcards are supported:\n \n [source,console]\n -----------------------------------\n-GET /_snapshot/my_backup/snapshot_1/_status\n+GET /_snapshot/my_backup/snapshot_*,some_other_snapshot\n+-----------------------------------\n+\n+Separate repository names with commas or use wildcards to retrieve snapshots from multiple repositories:\n+\n+[source,console]\n+-----------------------------------\n+GET /_snapshot/_all\n+GET /_snapshot/my_backup,my_fs_backup\n+GET /_snapshot/my*/snap*\n+-----------------------------------\n+\n+Add the `_all` parameter to the request to list all snapshots currently stored in the repository:\n+\n+[source,console]\n+-----------------------------------\n+GET /_snapshot/my_backup/_all\n -----------------------------------\n-// TEST[continued]\n \n-While snapshot info method returns only basic information about the snapshot in progress, the snapshot status returns\n+This request fails if some of the snapshots are unavailable. Use the boolean parameter `ignore_unavailable` to\n+return all snapshots that are currently available.\n+\n+Getting all snapshots in the repository can be costly on cloud-based repositories,\n+both from a cost and performance perspective.  If the only information required is\n+the snapshot names or UUIDs in the repository and the data streams and indices in each snapshot, then\n+the optional boolean parameter `verbose` can be set to `false` to execute a more\n+performant and cost-effective retrieval of the snapshots in the repository.\n+\n+NOTE: Setting `verbose` to `false` will omit all other information\n+about the snapshot, such as status information and the number of", "originalCommit": "52d6ffce6264d8cc0a23d53923850bb170be3a0d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQxOTgzNQ==", "url": "https://github.com/elastic/elasticsearch/pull/59730#discussion_r456419835", "bodyText": "Thanks for pointing out this discrepancy. A suggested revision:\n\nNOTE: Setting verbose to false omits additional information\nabout the snapshot, such as metadata, start and end time, number of shards that include the snapshot, and error messages. The default value of the verbose parameter is true.", "author": "lockewritesdocs", "createdAt": "2020-07-17T12:47:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjI3MDMwMA=="}], "type": "inlineReview"}, {"oid": "9b80aece7d30c432e63ed954b3be783615e4e92d", "url": "https://github.com/elastic/elasticsearch/commit/9b80aece7d30c432e63ed954b3be783615e4e92d", "message": "Change \"deleted\" to \"delete\"\n\nCo-authored-by: Armin Braun <me@obrown.io>", "committedDate": "2020-07-17T12:03:55Z", "type": "commit"}, {"oid": "2abba42e4152c1704fa43c81a14c1049f56d41f8", "url": "https://github.com/elastic/elasticsearch/commit/2abba42e4152c1704fa43c81a14c1049f56d41f8", "message": "Incorporating review feedback and making minor editorial changes.", "committedDate": "2020-07-17T14:10:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQ4MDU5MQ==", "url": "https://github.com/elastic/elasticsearch/pull/59730#discussion_r456480591", "bodyText": "We may want to be clearer by what we mean by expensive here. Memory consumption, storage space, latency, etc.", "author": "jrodewig", "createdAt": "2020-07-17T14:32:41Z", "path": "docs/reference/snapshot-restore/apis/get-snapshot-status-api.asciidoc", "diffHunk": "@@ -88,9 +88,12 @@ Use the get snapshot status API to retrieve detailed information about snapshots\n \n If you specify both the repository name and snapshot, the request retrieves detailed status information for the given snapshot, even if not currently running.\n \n-WARNING: Using this API to return any status results other than the currently running snapshots (`_current`) can be very expensive. Each request to retrieve snapshot status results in file reads from every shard in a snapshot, for each snapshot.\n-+\n+[WARNING]\n+====\n+Using this API to return any status results other than the currently running snapshots (`_current`) can be very expensive. Each request to retrieve snapshot status results in file reads from every shard in a snapshot, for each snapshot.", "originalCommit": "2abba42e4152c1704fa43c81a14c1049f56d41f8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjUzODkxOQ==", "url": "https://github.com/elastic/elasticsearch/pull/59730#discussion_r456538919", "bodyText": "Agreed. I consulted with Armin, and these requests can be expensive both for machine resources and cloud costs. Here's a revised rendition:\n\nUsing the get snapshot status API to return any status results other than the currently running snapshots (_current) can be very expensive. Each request to retrieve snapshot status results in file reads from every shard in a snapshot, for each snapshot. Such requests are taxing to machine resources and can also incur high processing costs when running in the cloud.", "author": "lockewritesdocs", "createdAt": "2020-07-17T16:12:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQ4MDU5MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQ4MTQwMw==", "url": "https://github.com/elastic/elasticsearch/pull/59730#discussion_r456481403", "bodyText": "I'd remove the title abbrev. Other pages in this section don't use them.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            ++++\n          \n          \n            \n            <titleabbrev>Delete snapshot</titleabbrev>\n          \n          \n            \n            ++++", "author": "jrodewig", "createdAt": "2020-07-17T14:34:03Z", "path": "docs/reference/snapshot-restore/delete-snapshot.asciidoc", "diffHunk": "@@ -0,0 +1,48 @@\n+[[delete-snapshots]]\n+== Delete a snapshot\n+++++\n+<titleabbrev>Delete snapshot</titleabbrev>\n+++++", "originalCommit": "2abba42e4152c1704fa43c81a14c1049f56d41f8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQ4MTgyMQ==", "url": "https://github.com/elastic/elasticsearch/pull/59730#discussion_r456481821", "bodyText": "We don't capitalize API names unless they contain a proper noun.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Use the <<delete-snapshot-api,Delete snapshot API>> to delete a snapshot\n          \n          \n            \n            Use the <<delete-snapshot-api,delete snapshot API>> to delete a snapshot", "author": "jrodewig", "createdAt": "2020-07-17T14:34:49Z", "path": "docs/reference/snapshot-restore/delete-snapshot.asciidoc", "diffHunk": "@@ -0,0 +1,48 @@\n+[[delete-snapshots]]\n+== Delete a snapshot\n+++++\n+<titleabbrev>Delete snapshot</titleabbrev>\n+++++\n+\n+////\n+[source,console]\n+-----------------------------------\n+PUT /_snapshot/my_backup\n+{\n+  \"type\": \"fs\",\n+  \"settings\": {\n+    \"location\": \"my_backup_location\"\n+  }\n+}\n+\n+PUT /_snapshot/my_backup/snapshot_1?wait_for_completion=true\n+\n+PUT /_snapshot/my_backup/snapshot_2?wait_for_completion=true\n+\n+PUT /_snapshot/my_backup/snapshot_3?wait_for_completion=true\n+-----------------------------------\n+// TESTSETUP\n+\n+////\n+\n+Use the <<delete-snapshot-api,Delete snapshot API>> to delete a snapshot", "originalCommit": "2abba42e4152c1704fa43c81a14c1049f56d41f8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQ4MjI0Mg==", "url": "https://github.com/elastic/elasticsearch/pull/59730#discussion_r456482242", "bodyText": "I don't think the longer delimiters here help. I keep it to the minimum, which is four.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            -----------------------------------\n          \n          \n            \n            DELETE /_snapshot/my_backup/snapshot_1\n          \n          \n            \n            -----------------------------------\n          \n          \n            \n            ----\n          \n          \n            \n            DELETE /_snapshot/my_backup/snapshot_1\n          \n          \n            \n            ----", "author": "jrodewig", "createdAt": "2020-07-17T14:35:30Z", "path": "docs/reference/snapshot-restore/delete-snapshot.asciidoc", "diffHunk": "@@ -0,0 +1,48 @@\n+[[delete-snapshots]]\n+== Delete a snapshot\n+++++\n+<titleabbrev>Delete snapshot</titleabbrev>\n+++++\n+\n+////\n+[source,console]\n+-----------------------------------\n+PUT /_snapshot/my_backup\n+{\n+  \"type\": \"fs\",\n+  \"settings\": {\n+    \"location\": \"my_backup_location\"\n+  }\n+}\n+\n+PUT /_snapshot/my_backup/snapshot_1?wait_for_completion=true\n+\n+PUT /_snapshot/my_backup/snapshot_2?wait_for_completion=true\n+\n+PUT /_snapshot/my_backup/snapshot_3?wait_for_completion=true\n+-----------------------------------\n+// TESTSETUP\n+\n+////\n+\n+Use the <<delete-snapshot-api,Delete snapshot API>> to delete a snapshot\n+from the repository:\n+\n+[source,console]\n+-----------------------------------\n+DELETE /_snapshot/my_backup/snapshot_1\n+-----------------------------------", "originalCommit": "2abba42e4152c1704fa43c81a14c1049f56d41f8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQ4MzE3Mg==", "url": "https://github.com/elastic/elasticsearch/pull/59730#discussion_r456483172", "bodyText": "I'd break the para here. Seems like a different set of thoughts.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            When a snapshot is deleted from a repository, {es} deletes all files that are associated with the deleted\n          \n          \n            \n            snapshot and not used by any other snapshots. If the delete snapshot operation is started while the snapshot is being\n          \n          \n            \n            When a snapshot is deleted from a repository, {es} deletes all files associated with the\n          \n          \n            \n            snapshot that are not in-use by other snapshots.\n          \n          \n            \n            \n          \n          \n            \n            If the delete snapshot operation starts while the snapshot is being", "author": "jrodewig", "createdAt": "2020-07-17T14:36:56Z", "path": "docs/reference/snapshot-restore/delete-snapshot.asciidoc", "diffHunk": "@@ -0,0 +1,48 @@\n+[[delete-snapshots]]\n+== Delete a snapshot\n+++++\n+<titleabbrev>Delete snapshot</titleabbrev>\n+++++\n+\n+////\n+[source,console]\n+-----------------------------------\n+PUT /_snapshot/my_backup\n+{\n+  \"type\": \"fs\",\n+  \"settings\": {\n+    \"location\": \"my_backup_location\"\n+  }\n+}\n+\n+PUT /_snapshot/my_backup/snapshot_1?wait_for_completion=true\n+\n+PUT /_snapshot/my_backup/snapshot_2?wait_for_completion=true\n+\n+PUT /_snapshot/my_backup/snapshot_3?wait_for_completion=true\n+-----------------------------------\n+// TESTSETUP\n+\n+////\n+\n+Use the <<delete-snapshot-api,Delete snapshot API>> to delete a snapshot\n+from the repository:\n+\n+[source,console]\n+-----------------------------------\n+DELETE /_snapshot/my_backup/snapshot_1\n+-----------------------------------\n+\n+When a snapshot is deleted from a repository, {es} deletes all files that are associated with the deleted\n+snapshot and not used by any other snapshots. If the delete snapshot operation is started while the snapshot is being", "originalCommit": "2abba42e4152c1704fa43c81a14c1049f56d41f8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQ4MzMzMA==", "url": "https://github.com/elastic/elasticsearch/pull/59730#discussion_r456483330", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            created, the snapshot process halts and all files created as part of the snapshotting process are\n          \n          \n            \n            created, the snapshot process halts and all files created as part of the process are", "author": "jrodewig", "createdAt": "2020-07-17T14:37:10Z", "path": "docs/reference/snapshot-restore/delete-snapshot.asciidoc", "diffHunk": "@@ -0,0 +1,48 @@\n+[[delete-snapshots]]\n+== Delete a snapshot\n+++++\n+<titleabbrev>Delete snapshot</titleabbrev>\n+++++\n+\n+////\n+[source,console]\n+-----------------------------------\n+PUT /_snapshot/my_backup\n+{\n+  \"type\": \"fs\",\n+  \"settings\": {\n+    \"location\": \"my_backup_location\"\n+  }\n+}\n+\n+PUT /_snapshot/my_backup/snapshot_1?wait_for_completion=true\n+\n+PUT /_snapshot/my_backup/snapshot_2?wait_for_completion=true\n+\n+PUT /_snapshot/my_backup/snapshot_3?wait_for_completion=true\n+-----------------------------------\n+// TESTSETUP\n+\n+////\n+\n+Use the <<delete-snapshot-api,Delete snapshot API>> to delete a snapshot\n+from the repository:\n+\n+[source,console]\n+-----------------------------------\n+DELETE /_snapshot/my_backup/snapshot_1\n+-----------------------------------\n+\n+When a snapshot is deleted from a repository, {es} deletes all files that are associated with the deleted\n+snapshot and not used by any other snapshots. If the delete snapshot operation is started while the snapshot is being\n+created, the snapshot process halts and all files created as part of the snapshotting process are", "originalCommit": "2abba42e4152c1704fa43c81a14c1049f56d41f8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQ4MzgwMw==", "url": "https://github.com/elastic/elasticsearch/pull/59730#discussion_r456483803", "bodyText": "The second link seems redundant. I also think your Use the... sentence probably belongs before the proceeding one.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            removed. Use the <<delete-snapshot-api,Delete snapshot API>> to cancel long running snapshot operations that were\n          \n          \n            \n            removed. Use the delete snapshot API to cancel long running snapshot operations that were", "author": "jrodewig", "createdAt": "2020-07-17T14:38:00Z", "path": "docs/reference/snapshot-restore/delete-snapshot.asciidoc", "diffHunk": "@@ -0,0 +1,48 @@\n+[[delete-snapshots]]\n+== Delete a snapshot\n+++++\n+<titleabbrev>Delete snapshot</titleabbrev>\n+++++\n+\n+////\n+[source,console]\n+-----------------------------------\n+PUT /_snapshot/my_backup\n+{\n+  \"type\": \"fs\",\n+  \"settings\": {\n+    \"location\": \"my_backup_location\"\n+  }\n+}\n+\n+PUT /_snapshot/my_backup/snapshot_1?wait_for_completion=true\n+\n+PUT /_snapshot/my_backup/snapshot_2?wait_for_completion=true\n+\n+PUT /_snapshot/my_backup/snapshot_3?wait_for_completion=true\n+-----------------------------------\n+// TESTSETUP\n+\n+////\n+\n+Use the <<delete-snapshot-api,Delete snapshot API>> to delete a snapshot\n+from the repository:\n+\n+[source,console]\n+-----------------------------------\n+DELETE /_snapshot/my_backup/snapshot_1\n+-----------------------------------\n+\n+When a snapshot is deleted from a repository, {es} deletes all files that are associated with the deleted\n+snapshot and not used by any other snapshots. If the delete snapshot operation is started while the snapshot is being\n+created, the snapshot process halts and all files created as part of the snapshotting process are\n+removed. Use the <<delete-snapshot-api,Delete snapshot API>> to cancel long running snapshot operations that were", "originalCommit": "2abba42e4152c1704fa43c81a14c1049f56d41f8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQ4NTIwNA==", "url": "https://github.com/elastic/elasticsearch/pull/59730#discussion_r456485204", "bodyText": "Wildcards and comma-separated values aren't mutually exclusive. snapshot*,my_other_snapshot* is valid. However, you could interpret this section that way.\nI'd reword and maybe add an example of two comma-separated wildcard expressions.", "author": "jrodewig", "createdAt": "2020-07-17T14:40:22Z", "path": "docs/reference/snapshot-restore/delete-snapshot.asciidoc", "diffHunk": "@@ -0,0 +1,48 @@\n+[[delete-snapshots]]\n+== Delete a snapshot\n+++++\n+<titleabbrev>Delete snapshot</titleabbrev>\n+++++\n+\n+////\n+[source,console]\n+-----------------------------------\n+PUT /_snapshot/my_backup\n+{\n+  \"type\": \"fs\",\n+  \"settings\": {\n+    \"location\": \"my_backup_location\"\n+  }\n+}\n+\n+PUT /_snapshot/my_backup/snapshot_1?wait_for_completion=true\n+\n+PUT /_snapshot/my_backup/snapshot_2?wait_for_completion=true\n+\n+PUT /_snapshot/my_backup/snapshot_3?wait_for_completion=true\n+-----------------------------------\n+// TESTSETUP\n+\n+////\n+\n+Use the <<delete-snapshot-api,Delete snapshot API>> to delete a snapshot\n+from the repository:\n+\n+[source,console]\n+-----------------------------------\n+DELETE /_snapshot/my_backup/snapshot_1\n+-----------------------------------\n+\n+When a snapshot is deleted from a repository, {es} deletes all files that are associated with the deleted\n+snapshot and not used by any other snapshots. If the delete snapshot operation is started while the snapshot is being\n+created, the snapshot process halts and all files created as part of the snapshotting process are\n+removed. Use the <<delete-snapshot-api,Delete snapshot API>> to cancel long running snapshot operations that were\n+started by mistake.\n+\n+To delete multiple snapshots from a repository, separate snapshot names by commas or use wildcards:\n+\n+[source,console]\n+-----------------------------------\n+DELETE /_snapshot/my_backup/snapshot_2,snapshot_3\n+DELETE /_snapshot/my_backup/snap*\n+-----------------------------------", "originalCommit": "2abba42e4152c1704fa43c81a14c1049f56d41f8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQ4NjIwMw==", "url": "https://github.com/elastic/elasticsearch/pull/59730#discussion_r456486203", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Use the <<get-snapshot-api,Get snapshot API>> or the\n          \n          \n            \n            <<get-snapshot-status-api,Get snapshot status API>> to monitor the\n          \n          \n            \n            Use the <<get-snapshot-api,get snapshot API>> or the\n          \n          \n            \n            <<get-snapshot-status-api,get snapshot status API>> to monitor the", "author": "jrodewig", "createdAt": "2020-07-17T14:42:03Z", "path": "docs/reference/snapshot-restore/monitor-snapshot-restore.asciidoc", "diffHunk": "@@ -1,13 +1,15 @@\n [[snapshots-monitor-snapshot-restore]]\n == Monitor snapshot and restore progress\n-\n ++++\n <titleabbrev>Monitor snapshot and restore</titleabbrev>\n ++++\n \n-There are several ways to monitor the progress of the snapshot and restore processes while they are running. Both\n-operations support `wait_for_completion` parameter that would block client until the operation is completed. This is\n-the simplest method that can be used to get notified about operation completion.\n+Use the <<get-snapshot-api,Get snapshot API>> or the\n+<<get-snapshot-status-api,Get snapshot status API>> to monitor the", "originalCommit": "2abba42e4152c1704fa43c81a14c1049f56d41f8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQ4Njc1OQ==", "url": "https://github.com/elastic/elasticsearch/pull/59730#discussion_r456486759", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Use the `_current` parameter to retrieve all currently running\n          \n          \n            \n            Use the `_current` parameter to retrieve information about all currently running", "author": "jrodewig", "createdAt": "2020-07-17T14:42:58Z", "path": "docs/reference/snapshot-restore/monitor-snapshot-restore.asciidoc", "diffHunk": "@@ -20,71 +22,151 @@ PUT /_snapshot/my_backup\n   }\n }\n \n+PUT /_snapshot/my_fs_backup\n+{\n+  \"type\": \"fs\",\n+  \"settings\": {\n+    \"location\": \"my_other_backup_location\"\n+  }\n+}\n+\n PUT /_snapshot/my_backup/snapshot_1?wait_for_completion=true\n -----------------------------------\n // TESTSETUP\n \n ////\n \n-The snapshot operation can be also monitored by periodic calls to the snapshot info:\n+Use the `_current` parameter to retrieve all currently running", "originalCommit": "2abba42e4152c1704fa43c81a14c1049f56d41f8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQ4NzA0Mg==", "url": "https://github.com/elastic/elasticsearch/pull/59730#discussion_r456487042", "bodyText": "Bulleted list?", "author": "jrodewig", "createdAt": "2020-07-17T14:43:27Z", "path": "docs/reference/snapshot-restore/monitor-snapshot-restore.asciidoc", "diffHunk": "@@ -20,71 +22,151 @@ PUT /_snapshot/my_backup\n   }\n }\n \n+PUT /_snapshot/my_fs_backup\n+{\n+  \"type\": \"fs\",\n+  \"settings\": {\n+    \"location\": \"my_other_backup_location\"\n+  }\n+}\n+\n PUT /_snapshot/my_backup/snapshot_1?wait_for_completion=true\n -----------------------------------\n // TESTSETUP\n \n ////\n \n-The snapshot operation can be also monitored by periodic calls to the snapshot info:\n+Use the `_current` parameter to retrieve all currently running\n+snapshots in the cluster:\n+\n+[source,console]\n+-----------------------------------\n+GET /_snapshot/my_backup/_current\n+-----------------------------------\n+\n+Including a snapshot name in the request retrieves information about a single snapshot:\n \n [source,console]\n -----------------------------------\n GET /_snapshot/my_backup/snapshot_1\n -----------------------------------\n \n-Please note that snapshot info operation uses the same resources and thread pool as the snapshot operation. So,\n-executing a snapshot info operation while large shards are being snapshotted can cause the snapshot info operation to wait\n-for available resources before returning the result. On very large shards the wait time can be significant.\n+This request retrieves basic information about the snapshot, including start and end time, version of\n+{es} that created the snapshot, the list of included data streams and indices, the current state of the\n+snapshot and the list of failures that occurred during the snapshot.", "originalCommit": "2abba42e4152c1704fa43c81a14c1049f56d41f8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQ4NzYxMA==", "url": "https://github.com/elastic/elasticsearch/pull/59730#discussion_r456487610", "bodyText": "Similar to repositories,\n\nSince you don't mention repositories earlier on this page, I would cut this.", "author": "jrodewig", "createdAt": "2020-07-17T14:44:27Z", "path": "docs/reference/snapshot-restore/monitor-snapshot-restore.asciidoc", "diffHunk": "@@ -20,71 +22,151 @@ PUT /_snapshot/my_backup\n   }\n }\n \n+PUT /_snapshot/my_fs_backup\n+{\n+  \"type\": \"fs\",\n+  \"settings\": {\n+    \"location\": \"my_other_backup_location\"\n+  }\n+}\n+\n PUT /_snapshot/my_backup/snapshot_1?wait_for_completion=true\n -----------------------------------\n // TESTSETUP\n \n ////\n \n-The snapshot operation can be also monitored by periodic calls to the snapshot info:\n+Use the `_current` parameter to retrieve all currently running\n+snapshots in the cluster:\n+\n+[source,console]\n+-----------------------------------\n+GET /_snapshot/my_backup/_current\n+-----------------------------------\n+\n+Including a snapshot name in the request retrieves information about a single snapshot:\n \n [source,console]\n -----------------------------------\n GET /_snapshot/my_backup/snapshot_1\n -----------------------------------\n \n-Please note that snapshot info operation uses the same resources and thread pool as the snapshot operation. So,\n-executing a snapshot info operation while large shards are being snapshotted can cause the snapshot info operation to wait\n-for available resources before returning the result. On very large shards the wait time can be significant.\n+This request retrieves basic information about the snapshot, including start and end time, version of\n+{es} that created the snapshot, the list of included data streams and indices, the current state of the\n+snapshot and the list of failures that occurred during the snapshot.\n \n-To get more immediate and complete information about snapshots the snapshot status command can be used instead:\n+Similar to repositories, you can retrieve information about multiple snapshots in a single request, and wildcards are supported:", "originalCommit": "2abba42e4152c1704fa43c81a14c1049f56d41f8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQ4Nzk0OA==", "url": "https://github.com/elastic/elasticsearch/pull/59730#discussion_r456487948", "bodyText": "See earlier comment.", "author": "jrodewig", "createdAt": "2020-07-17T14:44:56Z", "path": "docs/reference/snapshot-restore/monitor-snapshot-restore.asciidoc", "diffHunk": "@@ -20,71 +22,151 @@ PUT /_snapshot/my_backup\n   }\n }\n \n+PUT /_snapshot/my_fs_backup\n+{\n+  \"type\": \"fs\",\n+  \"settings\": {\n+    \"location\": \"my_other_backup_location\"\n+  }\n+}\n+\n PUT /_snapshot/my_backup/snapshot_1?wait_for_completion=true\n -----------------------------------\n // TESTSETUP\n \n ////\n \n-The snapshot operation can be also monitored by periodic calls to the snapshot info:\n+Use the `_current` parameter to retrieve all currently running\n+snapshots in the cluster:\n+\n+[source,console]\n+-----------------------------------\n+GET /_snapshot/my_backup/_current\n+-----------------------------------\n+\n+Including a snapshot name in the request retrieves information about a single snapshot:\n \n [source,console]\n -----------------------------------\n GET /_snapshot/my_backup/snapshot_1\n -----------------------------------\n \n-Please note that snapshot info operation uses the same resources and thread pool as the snapshot operation. So,\n-executing a snapshot info operation while large shards are being snapshotted can cause the snapshot info operation to wait\n-for available resources before returning the result. On very large shards the wait time can be significant.\n+This request retrieves basic information about the snapshot, including start and end time, version of\n+{es} that created the snapshot, the list of included data streams and indices, the current state of the\n+snapshot and the list of failures that occurred during the snapshot.\n \n-To get more immediate and complete information about snapshots the snapshot status command can be used instead:\n+Similar to repositories, you can retrieve information about multiple snapshots in a single request, and wildcards are supported:\n \n [source,console]\n -----------------------------------\n-GET /_snapshot/my_backup/snapshot_1/_status\n+GET /_snapshot/my_backup/snapshot_*,some_other_snapshot\n+-----------------------------------\n+\n+Separate repository names with commas or use wildcards to retrieve snapshots from multiple repositories:\n+\n+[source,console]\n+-----------------------------------\n+GET /_snapshot/_all\n+GET /_snapshot/my_backup,my_fs_backup\n+GET /_snapshot/my*/snap*\n+-----------------------------------", "originalCommit": "2abba42e4152c1704fa43c81a14c1049f56d41f8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQ4ODI3OQ==", "url": "https://github.com/elastic/elasticsearch/pull/59730#discussion_r456488279", "bodyText": "An example snippet would help.", "author": "jrodewig", "createdAt": "2020-07-17T14:45:25Z", "path": "docs/reference/snapshot-restore/monitor-snapshot-restore.asciidoc", "diffHunk": "@@ -20,71 +22,151 @@ PUT /_snapshot/my_backup\n   }\n }\n \n+PUT /_snapshot/my_fs_backup\n+{\n+  \"type\": \"fs\",\n+  \"settings\": {\n+    \"location\": \"my_other_backup_location\"\n+  }\n+}\n+\n PUT /_snapshot/my_backup/snapshot_1?wait_for_completion=true\n -----------------------------------\n // TESTSETUP\n \n ////\n \n-The snapshot operation can be also monitored by periodic calls to the snapshot info:\n+Use the `_current` parameter to retrieve all currently running\n+snapshots in the cluster:\n+\n+[source,console]\n+-----------------------------------\n+GET /_snapshot/my_backup/_current\n+-----------------------------------\n+\n+Including a snapshot name in the request retrieves information about a single snapshot:\n \n [source,console]\n -----------------------------------\n GET /_snapshot/my_backup/snapshot_1\n -----------------------------------\n \n-Please note that snapshot info operation uses the same resources and thread pool as the snapshot operation. So,\n-executing a snapshot info operation while large shards are being snapshotted can cause the snapshot info operation to wait\n-for available resources before returning the result. On very large shards the wait time can be significant.\n+This request retrieves basic information about the snapshot, including start and end time, version of\n+{es} that created the snapshot, the list of included data streams and indices, the current state of the\n+snapshot and the list of failures that occurred during the snapshot.\n \n-To get more immediate and complete information about snapshots the snapshot status command can be used instead:\n+Similar to repositories, you can retrieve information about multiple snapshots in a single request, and wildcards are supported:\n \n [source,console]\n -----------------------------------\n-GET /_snapshot/my_backup/snapshot_1/_status\n+GET /_snapshot/my_backup/snapshot_*,some_other_snapshot\n+-----------------------------------\n+\n+Separate repository names with commas or use wildcards to retrieve snapshots from multiple repositories:\n+\n+[source,console]\n+-----------------------------------\n+GET /_snapshot/_all\n+GET /_snapshot/my_backup,my_fs_backup\n+GET /_snapshot/my*/snap*\n+-----------------------------------\n+\n+Add the `_all` parameter to the request to list all snapshots currently stored in the repository:\n+\n+[source,console]\n+-----------------------------------\n+GET /_snapshot/my_backup/_all\n -----------------------------------\n-// TEST[continued]\n \n-While snapshot info method returns only basic information about the snapshot in progress, the snapshot status returns\n+This request fails if some of the snapshots are unavailable. Use the boolean parameter `ignore_unavailable` to\n+return all snapshots that are currently available.", "originalCommit": "2abba42e4152c1704fa43c81a14c1049f56d41f8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQ4ODQ5MQ==", "url": "https://github.com/elastic/elasticsearch/pull/59730#discussion_r456488491", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            both from a cost and performance perspective.  If the only information required is\n          \n          \n            \n            both from a cost and performance perspective. If the only information required is", "author": "jrodewig", "createdAt": "2020-07-17T14:45:44Z", "path": "docs/reference/snapshot-restore/monitor-snapshot-restore.asciidoc", "diffHunk": "@@ -20,71 +22,151 @@ PUT /_snapshot/my_backup\n   }\n }\n \n+PUT /_snapshot/my_fs_backup\n+{\n+  \"type\": \"fs\",\n+  \"settings\": {\n+    \"location\": \"my_other_backup_location\"\n+  }\n+}\n+\n PUT /_snapshot/my_backup/snapshot_1?wait_for_completion=true\n -----------------------------------\n // TESTSETUP\n \n ////\n \n-The snapshot operation can be also monitored by periodic calls to the snapshot info:\n+Use the `_current` parameter to retrieve all currently running\n+snapshots in the cluster:\n+\n+[source,console]\n+-----------------------------------\n+GET /_snapshot/my_backup/_current\n+-----------------------------------\n+\n+Including a snapshot name in the request retrieves information about a single snapshot:\n \n [source,console]\n -----------------------------------\n GET /_snapshot/my_backup/snapshot_1\n -----------------------------------\n \n-Please note that snapshot info operation uses the same resources and thread pool as the snapshot operation. So,\n-executing a snapshot info operation while large shards are being snapshotted can cause the snapshot info operation to wait\n-for available resources before returning the result. On very large shards the wait time can be significant.\n+This request retrieves basic information about the snapshot, including start and end time, version of\n+{es} that created the snapshot, the list of included data streams and indices, the current state of the\n+snapshot and the list of failures that occurred during the snapshot.\n \n-To get more immediate and complete information about snapshots the snapshot status command can be used instead:\n+Similar to repositories, you can retrieve information about multiple snapshots in a single request, and wildcards are supported:\n \n [source,console]\n -----------------------------------\n-GET /_snapshot/my_backup/snapshot_1/_status\n+GET /_snapshot/my_backup/snapshot_*,some_other_snapshot\n+-----------------------------------\n+\n+Separate repository names with commas or use wildcards to retrieve snapshots from multiple repositories:\n+\n+[source,console]\n+-----------------------------------\n+GET /_snapshot/_all\n+GET /_snapshot/my_backup,my_fs_backup\n+GET /_snapshot/my*/snap*\n+-----------------------------------\n+\n+Add the `_all` parameter to the request to list all snapshots currently stored in the repository:\n+\n+[source,console]\n+-----------------------------------\n+GET /_snapshot/my_backup/_all\n -----------------------------------\n-// TEST[continued]\n \n-While snapshot info method returns only basic information about the snapshot in progress, the snapshot status returns\n+This request fails if some of the snapshots are unavailable. Use the boolean parameter `ignore_unavailable` to\n+return all snapshots that are currently available.\n+\n+Getting all snapshots in the repository can be costly on cloud-based repositories,\n+both from a cost and performance perspective.  If the only information required is", "originalCommit": "2abba42e4152c1704fa43c81a14c1049f56d41f8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQ4OTAxMA==", "url": "https://github.com/elastic/elasticsearch/pull/59730#discussion_r456489010", "bodyText": "A snippet example would be helpful here.", "author": "jrodewig", "createdAt": "2020-07-17T14:46:34Z", "path": "docs/reference/snapshot-restore/monitor-snapshot-restore.asciidoc", "diffHunk": "@@ -20,71 +22,151 @@ PUT /_snapshot/my_backup\n   }\n }\n \n+PUT /_snapshot/my_fs_backup\n+{\n+  \"type\": \"fs\",\n+  \"settings\": {\n+    \"location\": \"my_other_backup_location\"\n+  }\n+}\n+\n PUT /_snapshot/my_backup/snapshot_1?wait_for_completion=true\n -----------------------------------\n // TESTSETUP\n \n ////\n \n-The snapshot operation can be also monitored by periodic calls to the snapshot info:\n+Use the `_current` parameter to retrieve all currently running\n+snapshots in the cluster:\n+\n+[source,console]\n+-----------------------------------\n+GET /_snapshot/my_backup/_current\n+-----------------------------------\n+\n+Including a snapshot name in the request retrieves information about a single snapshot:\n \n [source,console]\n -----------------------------------\n GET /_snapshot/my_backup/snapshot_1\n -----------------------------------\n \n-Please note that snapshot info operation uses the same resources and thread pool as the snapshot operation. So,\n-executing a snapshot info operation while large shards are being snapshotted can cause the snapshot info operation to wait\n-for available resources before returning the result. On very large shards the wait time can be significant.\n+This request retrieves basic information about the snapshot, including start and end time, version of\n+{es} that created the snapshot, the list of included data streams and indices, the current state of the\n+snapshot and the list of failures that occurred during the snapshot.\n \n-To get more immediate and complete information about snapshots the snapshot status command can be used instead:\n+Similar to repositories, you can retrieve information about multiple snapshots in a single request, and wildcards are supported:\n \n [source,console]\n -----------------------------------\n-GET /_snapshot/my_backup/snapshot_1/_status\n+GET /_snapshot/my_backup/snapshot_*,some_other_snapshot\n+-----------------------------------\n+\n+Separate repository names with commas or use wildcards to retrieve snapshots from multiple repositories:\n+\n+[source,console]\n+-----------------------------------\n+GET /_snapshot/_all\n+GET /_snapshot/my_backup,my_fs_backup\n+GET /_snapshot/my*/snap*\n+-----------------------------------\n+\n+Add the `_all` parameter to the request to list all snapshots currently stored in the repository:\n+\n+[source,console]\n+-----------------------------------\n+GET /_snapshot/my_backup/_all\n -----------------------------------\n-// TEST[continued]\n \n-While snapshot info method returns only basic information about the snapshot in progress, the snapshot status returns\n+This request fails if some of the snapshots are unavailable. Use the boolean parameter `ignore_unavailable` to\n+return all snapshots that are currently available.\n+\n+Getting all snapshots in the repository can be costly on cloud-based repositories,\n+both from a cost and performance perspective.  If the only information required is\n+the snapshot names or UUIDs in the repository and the data streams and indices in each snapshot, then\n+the optional boolean parameter `verbose` can be set to `false` to execute a more\n+performant and cost-effective retrieval of the snapshots in the repository.", "originalCommit": "2abba42e4152c1704fa43c81a14c1049f56d41f8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQ4OTM0NQ==", "url": "https://github.com/elastic/elasticsearch/pull/59730#discussion_r456489345", "bodyText": "I don't think this needs to be in a note.", "author": "jrodewig", "createdAt": "2020-07-17T14:47:03Z", "path": "docs/reference/snapshot-restore/monitor-snapshot-restore.asciidoc", "diffHunk": "@@ -20,71 +22,151 @@ PUT /_snapshot/my_backup\n   }\n }\n \n+PUT /_snapshot/my_fs_backup\n+{\n+  \"type\": \"fs\",\n+  \"settings\": {\n+    \"location\": \"my_other_backup_location\"\n+  }\n+}\n+\n PUT /_snapshot/my_backup/snapshot_1?wait_for_completion=true\n -----------------------------------\n // TESTSETUP\n \n ////\n \n-The snapshot operation can be also monitored by periodic calls to the snapshot info:\n+Use the `_current` parameter to retrieve all currently running\n+snapshots in the cluster:\n+\n+[source,console]\n+-----------------------------------\n+GET /_snapshot/my_backup/_current\n+-----------------------------------\n+\n+Including a snapshot name in the request retrieves information about a single snapshot:\n \n [source,console]\n -----------------------------------\n GET /_snapshot/my_backup/snapshot_1\n -----------------------------------\n \n-Please note that snapshot info operation uses the same resources and thread pool as the snapshot operation. So,\n-executing a snapshot info operation while large shards are being snapshotted can cause the snapshot info operation to wait\n-for available resources before returning the result. On very large shards the wait time can be significant.\n+This request retrieves basic information about the snapshot, including start and end time, version of\n+{es} that created the snapshot, the list of included data streams and indices, the current state of the\n+snapshot and the list of failures that occurred during the snapshot.\n \n-To get more immediate and complete information about snapshots the snapshot status command can be used instead:\n+Similar to repositories, you can retrieve information about multiple snapshots in a single request, and wildcards are supported:\n \n [source,console]\n -----------------------------------\n-GET /_snapshot/my_backup/snapshot_1/_status\n+GET /_snapshot/my_backup/snapshot_*,some_other_snapshot\n+-----------------------------------\n+\n+Separate repository names with commas or use wildcards to retrieve snapshots from multiple repositories:\n+\n+[source,console]\n+-----------------------------------\n+GET /_snapshot/_all\n+GET /_snapshot/my_backup,my_fs_backup\n+GET /_snapshot/my*/snap*\n+-----------------------------------\n+\n+Add the `_all` parameter to the request to list all snapshots currently stored in the repository:\n+\n+[source,console]\n+-----------------------------------\n+GET /_snapshot/my_backup/_all\n -----------------------------------\n-// TEST[continued]\n \n-While snapshot info method returns only basic information about the snapshot in progress, the snapshot status returns\n+This request fails if some of the snapshots are unavailable. Use the boolean parameter `ignore_unavailable` to\n+return all snapshots that are currently available.\n+\n+Getting all snapshots in the repository can be costly on cloud-based repositories,\n+both from a cost and performance perspective.  If the only information required is\n+the snapshot names or UUIDs in the repository and the data streams and indices in each snapshot, then\n+the optional boolean parameter `verbose` can be set to `false` to execute a more\n+performant and cost-effective retrieval of the snapshots in the repository.\n+\n+NOTE: Setting `verbose` to `false` omits additional information\n+about the snapshot, such as metadata, start and end time, number of shards that include the snapshot, and error messages. The default value of the `verbose` parameter is `true`.", "originalCommit": "2abba42e4152c1704fa43c81a14c1049f56d41f8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQ4OTY5MQ==", "url": "https://github.com/elastic/elasticsearch/pull/59730#discussion_r456489691", "bodyText": "We try to avoid gerund titles if possible\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            === Retrieving snapshot status\n          \n          \n            \n            === Retrieve snapshot status", "author": "jrodewig", "createdAt": "2020-07-17T14:47:35Z", "path": "docs/reference/snapshot-restore/monitor-snapshot-restore.asciidoc", "diffHunk": "@@ -20,71 +22,151 @@ PUT /_snapshot/my_backup\n   }\n }\n \n+PUT /_snapshot/my_fs_backup\n+{\n+  \"type\": \"fs\",\n+  \"settings\": {\n+    \"location\": \"my_other_backup_location\"\n+  }\n+}\n+\n PUT /_snapshot/my_backup/snapshot_1?wait_for_completion=true\n -----------------------------------\n // TESTSETUP\n \n ////\n \n-The snapshot operation can be also monitored by periodic calls to the snapshot info:\n+Use the `_current` parameter to retrieve all currently running\n+snapshots in the cluster:\n+\n+[source,console]\n+-----------------------------------\n+GET /_snapshot/my_backup/_current\n+-----------------------------------\n+\n+Including a snapshot name in the request retrieves information about a single snapshot:\n \n [source,console]\n -----------------------------------\n GET /_snapshot/my_backup/snapshot_1\n -----------------------------------\n \n-Please note that snapshot info operation uses the same resources and thread pool as the snapshot operation. So,\n-executing a snapshot info operation while large shards are being snapshotted can cause the snapshot info operation to wait\n-for available resources before returning the result. On very large shards the wait time can be significant.\n+This request retrieves basic information about the snapshot, including start and end time, version of\n+{es} that created the snapshot, the list of included data streams and indices, the current state of the\n+snapshot and the list of failures that occurred during the snapshot.\n \n-To get more immediate and complete information about snapshots the snapshot status command can be used instead:\n+Similar to repositories, you can retrieve information about multiple snapshots in a single request, and wildcards are supported:\n \n [source,console]\n -----------------------------------\n-GET /_snapshot/my_backup/snapshot_1/_status\n+GET /_snapshot/my_backup/snapshot_*,some_other_snapshot\n+-----------------------------------\n+\n+Separate repository names with commas or use wildcards to retrieve snapshots from multiple repositories:\n+\n+[source,console]\n+-----------------------------------\n+GET /_snapshot/_all\n+GET /_snapshot/my_backup,my_fs_backup\n+GET /_snapshot/my*/snap*\n+-----------------------------------\n+\n+Add the `_all` parameter to the request to list all snapshots currently stored in the repository:\n+\n+[source,console]\n+-----------------------------------\n+GET /_snapshot/my_backup/_all\n -----------------------------------\n-// TEST[continued]\n \n-While snapshot info method returns only basic information about the snapshot in progress, the snapshot status returns\n+This request fails if some of the snapshots are unavailable. Use the boolean parameter `ignore_unavailable` to\n+return all snapshots that are currently available.\n+\n+Getting all snapshots in the repository can be costly on cloud-based repositories,\n+both from a cost and performance perspective.  If the only information required is\n+the snapshot names or UUIDs in the repository and the data streams and indices in each snapshot, then\n+the optional boolean parameter `verbose` can be set to `false` to execute a more\n+performant and cost-effective retrieval of the snapshots in the repository.\n+\n+NOTE: Setting `verbose` to `false` omits additional information\n+about the snapshot, such as metadata, start and end time, number of shards that include the snapshot, and error messages. The default value of the `verbose` parameter is `true`.\n+\n+[discrete]\n+[[get-snapshot-detailed-status]]\n+=== Retrieving snapshot status", "originalCommit": "2abba42e4152c1704fa43c81a14c1049f56d41f8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQ5MDM3NA==", "url": "https://github.com/elastic/elasticsearch/pull/59730#discussion_r456490374", "bodyText": "Missing some articles here.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            To retrieve more detailed information about snapshots, use the <<get-snapshot-status-api,Get snapshot status API>>. While snapshot request returns only basic information about the snapshot in progress, the snapshot status request returns\n          \n          \n            \n            To retrieve more detailed information about snapshots, use the <<get-snapshot-status-api,get snapshot status API>>. While a snapshot request returns basic information about the snapshot in progress, the snapshot status request returns a", "author": "jrodewig", "createdAt": "2020-07-17T14:48:33Z", "path": "docs/reference/snapshot-restore/monitor-snapshot-restore.asciidoc", "diffHunk": "@@ -20,71 +22,151 @@ PUT /_snapshot/my_backup\n   }\n }\n \n+PUT /_snapshot/my_fs_backup\n+{\n+  \"type\": \"fs\",\n+  \"settings\": {\n+    \"location\": \"my_other_backup_location\"\n+  }\n+}\n+\n PUT /_snapshot/my_backup/snapshot_1?wait_for_completion=true\n -----------------------------------\n // TESTSETUP\n \n ////\n \n-The snapshot operation can be also monitored by periodic calls to the snapshot info:\n+Use the `_current` parameter to retrieve all currently running\n+snapshots in the cluster:\n+\n+[source,console]\n+-----------------------------------\n+GET /_snapshot/my_backup/_current\n+-----------------------------------\n+\n+Including a snapshot name in the request retrieves information about a single snapshot:\n \n [source,console]\n -----------------------------------\n GET /_snapshot/my_backup/snapshot_1\n -----------------------------------\n \n-Please note that snapshot info operation uses the same resources and thread pool as the snapshot operation. So,\n-executing a snapshot info operation while large shards are being snapshotted can cause the snapshot info operation to wait\n-for available resources before returning the result. On very large shards the wait time can be significant.\n+This request retrieves basic information about the snapshot, including start and end time, version of\n+{es} that created the snapshot, the list of included data streams and indices, the current state of the\n+snapshot and the list of failures that occurred during the snapshot.\n \n-To get more immediate and complete information about snapshots the snapshot status command can be used instead:\n+Similar to repositories, you can retrieve information about multiple snapshots in a single request, and wildcards are supported:\n \n [source,console]\n -----------------------------------\n-GET /_snapshot/my_backup/snapshot_1/_status\n+GET /_snapshot/my_backup/snapshot_*,some_other_snapshot\n+-----------------------------------\n+\n+Separate repository names with commas or use wildcards to retrieve snapshots from multiple repositories:\n+\n+[source,console]\n+-----------------------------------\n+GET /_snapshot/_all\n+GET /_snapshot/my_backup,my_fs_backup\n+GET /_snapshot/my*/snap*\n+-----------------------------------\n+\n+Add the `_all` parameter to the request to list all snapshots currently stored in the repository:\n+\n+[source,console]\n+-----------------------------------\n+GET /_snapshot/my_backup/_all\n -----------------------------------\n-// TEST[continued]\n \n-While snapshot info method returns only basic information about the snapshot in progress, the snapshot status returns\n+This request fails if some of the snapshots are unavailable. Use the boolean parameter `ignore_unavailable` to\n+return all snapshots that are currently available.\n+\n+Getting all snapshots in the repository can be costly on cloud-based repositories,\n+both from a cost and performance perspective.  If the only information required is\n+the snapshot names or UUIDs in the repository and the data streams and indices in each snapshot, then\n+the optional boolean parameter `verbose` can be set to `false` to execute a more\n+performant and cost-effective retrieval of the snapshots in the repository.\n+\n+NOTE: Setting `verbose` to `false` omits additional information\n+about the snapshot, such as metadata, start and end time, number of shards that include the snapshot, and error messages. The default value of the `verbose` parameter is `true`.\n+\n+[discrete]\n+[[get-snapshot-detailed-status]]\n+=== Retrieving snapshot status\n+To retrieve more detailed information about snapshots, use the <<get-snapshot-status-api,Get snapshot status API>>. While snapshot request returns only basic information about the snapshot in progress, the snapshot status request returns", "originalCommit": "2abba42e4152c1704fa43c81a14c1049f56d41f8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQ5MDY2Mw==", "url": "https://github.com/elastic/elasticsearch/pull/59730#discussion_r456490663", "bodyText": "See earlier comment re: expensive.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Using the Get snapshot status API to return any status results other than the currently running snapshots (`_current`) can be very expensive. Each request to retrieve snapshot status results in file reads from every shard in a snapshot, for each snapshot.\n          \n          \n            \n            Using the get snapshot status API to retrieve any status results other than the currently running snapshots (`_current`) can be very expensive. Each request to retrieve snapshot status results in file reads from every shard in a snapshot, for each snapshot.", "author": "jrodewig", "createdAt": "2020-07-17T14:49:02Z", "path": "docs/reference/snapshot-restore/monitor-snapshot-restore.asciidoc", "diffHunk": "@@ -20,71 +22,151 @@ PUT /_snapshot/my_backup\n   }\n }\n \n+PUT /_snapshot/my_fs_backup\n+{\n+  \"type\": \"fs\",\n+  \"settings\": {\n+    \"location\": \"my_other_backup_location\"\n+  }\n+}\n+\n PUT /_snapshot/my_backup/snapshot_1?wait_for_completion=true\n -----------------------------------\n // TESTSETUP\n \n ////\n \n-The snapshot operation can be also monitored by periodic calls to the snapshot info:\n+Use the `_current` parameter to retrieve all currently running\n+snapshots in the cluster:\n+\n+[source,console]\n+-----------------------------------\n+GET /_snapshot/my_backup/_current\n+-----------------------------------\n+\n+Including a snapshot name in the request retrieves information about a single snapshot:\n \n [source,console]\n -----------------------------------\n GET /_snapshot/my_backup/snapshot_1\n -----------------------------------\n \n-Please note that snapshot info operation uses the same resources and thread pool as the snapshot operation. So,\n-executing a snapshot info operation while large shards are being snapshotted can cause the snapshot info operation to wait\n-for available resources before returning the result. On very large shards the wait time can be significant.\n+This request retrieves basic information about the snapshot, including start and end time, version of\n+{es} that created the snapshot, the list of included data streams and indices, the current state of the\n+snapshot and the list of failures that occurred during the snapshot.\n \n-To get more immediate and complete information about snapshots the snapshot status command can be used instead:\n+Similar to repositories, you can retrieve information about multiple snapshots in a single request, and wildcards are supported:\n \n [source,console]\n -----------------------------------\n-GET /_snapshot/my_backup/snapshot_1/_status\n+GET /_snapshot/my_backup/snapshot_*,some_other_snapshot\n+-----------------------------------\n+\n+Separate repository names with commas or use wildcards to retrieve snapshots from multiple repositories:\n+\n+[source,console]\n+-----------------------------------\n+GET /_snapshot/_all\n+GET /_snapshot/my_backup,my_fs_backup\n+GET /_snapshot/my*/snap*\n+-----------------------------------\n+\n+Add the `_all` parameter to the request to list all snapshots currently stored in the repository:\n+\n+[source,console]\n+-----------------------------------\n+GET /_snapshot/my_backup/_all\n -----------------------------------\n-// TEST[continued]\n \n-While snapshot info method returns only basic information about the snapshot in progress, the snapshot status returns\n+This request fails if some of the snapshots are unavailable. Use the boolean parameter `ignore_unavailable` to\n+return all snapshots that are currently available.\n+\n+Getting all snapshots in the repository can be costly on cloud-based repositories,\n+both from a cost and performance perspective.  If the only information required is\n+the snapshot names or UUIDs in the repository and the data streams and indices in each snapshot, then\n+the optional boolean parameter `verbose` can be set to `false` to execute a more\n+performant and cost-effective retrieval of the snapshots in the repository.\n+\n+NOTE: Setting `verbose` to `false` omits additional information\n+about the snapshot, such as metadata, start and end time, number of shards that include the snapshot, and error messages. The default value of the `verbose` parameter is `true`.\n+\n+[discrete]\n+[[get-snapshot-detailed-status]]\n+=== Retrieving snapshot status\n+To retrieve more detailed information about snapshots, use the <<get-snapshot-status-api,Get snapshot status API>>. While snapshot request returns only basic information about the snapshot in progress, the snapshot status request returns\n complete breakdown of the current state for each shard participating in the snapshot.\n \n-The restore process piggybacks on the standard recovery mechanism of the\n-Elasticsearch. As a result, standard recovery monitoring services can be used\n-to monitor the state of restore. When the restore operation is executed the\n+[WARNING]\n+====\n+Using the Get snapshot status API to return any status results other than the currently running snapshots (`_current`) can be very expensive. Each request to retrieve snapshot status results in file reads from every shard in a snapshot, for each snapshot.", "originalCommit": "2abba42e4152c1704fa43c81a14c1049f56d41f8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQ5MTE2Nw==", "url": "https://github.com/elastic/elasticsearch/pull/59730#discussion_r456491167", "bodyText": "Avoid gerund titles. This also needs an explicit anchor, like [[monitor-restore-operations]].\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            === Monitoring restore operations\n          \n          \n            \n            === Monitor restore operations", "author": "jrodewig", "createdAt": "2020-07-17T14:49:42Z", "path": "docs/reference/snapshot-restore/monitor-snapshot-restore.asciidoc", "diffHunk": "@@ -20,71 +22,151 @@ PUT /_snapshot/my_backup\n   }\n }\n \n+PUT /_snapshot/my_fs_backup\n+{\n+  \"type\": \"fs\",\n+  \"settings\": {\n+    \"location\": \"my_other_backup_location\"\n+  }\n+}\n+\n PUT /_snapshot/my_backup/snapshot_1?wait_for_completion=true\n -----------------------------------\n // TESTSETUP\n \n ////\n \n-The snapshot operation can be also monitored by periodic calls to the snapshot info:\n+Use the `_current` parameter to retrieve all currently running\n+snapshots in the cluster:\n+\n+[source,console]\n+-----------------------------------\n+GET /_snapshot/my_backup/_current\n+-----------------------------------\n+\n+Including a snapshot name in the request retrieves information about a single snapshot:\n \n [source,console]\n -----------------------------------\n GET /_snapshot/my_backup/snapshot_1\n -----------------------------------\n \n-Please note that snapshot info operation uses the same resources and thread pool as the snapshot operation. So,\n-executing a snapshot info operation while large shards are being snapshotted can cause the snapshot info operation to wait\n-for available resources before returning the result. On very large shards the wait time can be significant.\n+This request retrieves basic information about the snapshot, including start and end time, version of\n+{es} that created the snapshot, the list of included data streams and indices, the current state of the\n+snapshot and the list of failures that occurred during the snapshot.\n \n-To get more immediate and complete information about snapshots the snapshot status command can be used instead:\n+Similar to repositories, you can retrieve information about multiple snapshots in a single request, and wildcards are supported:\n \n [source,console]\n -----------------------------------\n-GET /_snapshot/my_backup/snapshot_1/_status\n+GET /_snapshot/my_backup/snapshot_*,some_other_snapshot\n+-----------------------------------\n+\n+Separate repository names with commas or use wildcards to retrieve snapshots from multiple repositories:\n+\n+[source,console]\n+-----------------------------------\n+GET /_snapshot/_all\n+GET /_snapshot/my_backup,my_fs_backup\n+GET /_snapshot/my*/snap*\n+-----------------------------------\n+\n+Add the `_all` parameter to the request to list all snapshots currently stored in the repository:\n+\n+[source,console]\n+-----------------------------------\n+GET /_snapshot/my_backup/_all\n -----------------------------------\n-// TEST[continued]\n \n-While snapshot info method returns only basic information about the snapshot in progress, the snapshot status returns\n+This request fails if some of the snapshots are unavailable. Use the boolean parameter `ignore_unavailable` to\n+return all snapshots that are currently available.\n+\n+Getting all snapshots in the repository can be costly on cloud-based repositories,\n+both from a cost and performance perspective.  If the only information required is\n+the snapshot names or UUIDs in the repository and the data streams and indices in each snapshot, then\n+the optional boolean parameter `verbose` can be set to `false` to execute a more\n+performant and cost-effective retrieval of the snapshots in the repository.\n+\n+NOTE: Setting `verbose` to `false` omits additional information\n+about the snapshot, such as metadata, start and end time, number of shards that include the snapshot, and error messages. The default value of the `verbose` parameter is `true`.\n+\n+[discrete]\n+[[get-snapshot-detailed-status]]\n+=== Retrieving snapshot status\n+To retrieve more detailed information about snapshots, use the <<get-snapshot-status-api,Get snapshot status API>>. While snapshot request returns only basic information about the snapshot in progress, the snapshot status request returns\n complete breakdown of the current state for each shard participating in the snapshot.\n \n-The restore process piggybacks on the standard recovery mechanism of the\n-Elasticsearch. As a result, standard recovery monitoring services can be used\n-to monitor the state of restore. When the restore operation is executed the\n+[WARNING]\n+====\n+Using the Get snapshot status API to return any status results other than the currently running snapshots (`_current`) can be very expensive. Each request to retrieve snapshot status results in file reads from every shard in a snapshot, for each snapshot.\n+\n+For example, if you have 100 snapshots with 1,000 shards each, the API request will result in 100,000 file reads (100 snapshots * 1,000 shards). Depending on the latency of your file storage, the request can take extremely long to retrieve results.\n+====\n+\n+The following request retrieves all currently running snapshots with\n+detailed status information:\n+\n+[source,console]\n+-----------------------------------\n+GET /_snapshot/_status\n+-----------------------------------\n+\n+By specifying a repository name, it's possible\n+to limit the results to a particular repository:\n+\n+[source,console]\n+-----------------------------------\n+GET /_snapshot/my_backup/_status\n+-----------------------------------\n+\n+If both repository name and snapshot name are specified, the request\n+returns detailed status information for the given snapshot, even\n+if not currently running:\n+\n+[source,console]\n+-----------------------------------\n+GET /_snapshot/my_backup/snapshot_1/_status\n+-----------------------------------\n+\n+[discrete]\n+=== Monitoring restore operations", "originalCommit": "2abba42e4152c1704fa43c81a14c1049f56d41f8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQ5MTU0NA==", "url": "https://github.com/elastic/elasticsearch/pull/59730#discussion_r456491544", "bodyText": "Needs an explicit anchor too.", "author": "jrodewig", "createdAt": "2020-07-17T14:50:16Z", "path": "docs/reference/snapshot-restore/monitor-snapshot-restore.asciidoc", "diffHunk": "@@ -20,71 +22,151 @@ PUT /_snapshot/my_backup\n   }\n }\n \n+PUT /_snapshot/my_fs_backup\n+{\n+  \"type\": \"fs\",\n+  \"settings\": {\n+    \"location\": \"my_other_backup_location\"\n+  }\n+}\n+\n PUT /_snapshot/my_backup/snapshot_1?wait_for_completion=true\n -----------------------------------\n // TESTSETUP\n \n ////\n \n-The snapshot operation can be also monitored by periodic calls to the snapshot info:\n+Use the `_current` parameter to retrieve all currently running\n+snapshots in the cluster:\n+\n+[source,console]\n+-----------------------------------\n+GET /_snapshot/my_backup/_current\n+-----------------------------------\n+\n+Including a snapshot name in the request retrieves information about a single snapshot:\n \n [source,console]\n -----------------------------------\n GET /_snapshot/my_backup/snapshot_1\n -----------------------------------\n \n-Please note that snapshot info operation uses the same resources and thread pool as the snapshot operation. So,\n-executing a snapshot info operation while large shards are being snapshotted can cause the snapshot info operation to wait\n-for available resources before returning the result. On very large shards the wait time can be significant.\n+This request retrieves basic information about the snapshot, including start and end time, version of\n+{es} that created the snapshot, the list of included data streams and indices, the current state of the\n+snapshot and the list of failures that occurred during the snapshot.\n \n-To get more immediate and complete information about snapshots the snapshot status command can be used instead:\n+Similar to repositories, you can retrieve information about multiple snapshots in a single request, and wildcards are supported:\n \n [source,console]\n -----------------------------------\n-GET /_snapshot/my_backup/snapshot_1/_status\n+GET /_snapshot/my_backup/snapshot_*,some_other_snapshot\n+-----------------------------------\n+\n+Separate repository names with commas or use wildcards to retrieve snapshots from multiple repositories:\n+\n+[source,console]\n+-----------------------------------\n+GET /_snapshot/_all\n+GET /_snapshot/my_backup,my_fs_backup\n+GET /_snapshot/my*/snap*\n+-----------------------------------\n+\n+Add the `_all` parameter to the request to list all snapshots currently stored in the repository:\n+\n+[source,console]\n+-----------------------------------\n+GET /_snapshot/my_backup/_all\n -----------------------------------\n-// TEST[continued]\n \n-While snapshot info method returns only basic information about the snapshot in progress, the snapshot status returns\n+This request fails if some of the snapshots are unavailable. Use the boolean parameter `ignore_unavailable` to\n+return all snapshots that are currently available.\n+\n+Getting all snapshots in the repository can be costly on cloud-based repositories,\n+both from a cost and performance perspective.  If the only information required is\n+the snapshot names or UUIDs in the repository and the data streams and indices in each snapshot, then\n+the optional boolean parameter `verbose` can be set to `false` to execute a more\n+performant and cost-effective retrieval of the snapshots in the repository.\n+\n+NOTE: Setting `verbose` to `false` omits additional information\n+about the snapshot, such as metadata, start and end time, number of shards that include the snapshot, and error messages. The default value of the `verbose` parameter is `true`.\n+\n+[discrete]\n+[[get-snapshot-detailed-status]]\n+=== Retrieving snapshot status\n+To retrieve more detailed information about snapshots, use the <<get-snapshot-status-api,Get snapshot status API>>. While snapshot request returns only basic information about the snapshot in progress, the snapshot status request returns\n complete breakdown of the current state for each shard participating in the snapshot.\n \n-The restore process piggybacks on the standard recovery mechanism of the\n-Elasticsearch. As a result, standard recovery monitoring services can be used\n-to monitor the state of restore. When the restore operation is executed the\n+[WARNING]\n+====\n+Using the Get snapshot status API to return any status results other than the currently running snapshots (`_current`) can be very expensive. Each request to retrieve snapshot status results in file reads from every shard in a snapshot, for each snapshot.\n+\n+For example, if you have 100 snapshots with 1,000 shards each, the API request will result in 100,000 file reads (100 snapshots * 1,000 shards). Depending on the latency of your file storage, the request can take extremely long to retrieve results.\n+====\n+\n+The following request retrieves all currently running snapshots with\n+detailed status information:\n+\n+[source,console]\n+-----------------------------------\n+GET /_snapshot/_status\n+-----------------------------------\n+\n+By specifying a repository name, it's possible\n+to limit the results to a particular repository:\n+\n+[source,console]\n+-----------------------------------\n+GET /_snapshot/my_backup/_status\n+-----------------------------------\n+\n+If both repository name and snapshot name are specified, the request\n+returns detailed status information for the given snapshot, even\n+if not currently running:\n+\n+[source,console]\n+-----------------------------------\n+GET /_snapshot/my_backup/snapshot_1/_status\n+-----------------------------------\n+\n+[discrete]\n+=== Monitoring restore operations\n+\n+The restore process piggybacks on the standard recovery mechanism of\n+{es}. As a result, standard recovery monitoring services can be used\n+to monitor the state of restore. When the restore operation starts, the\n cluster typically goes into `yellow` state because the restore operation works\n-by recovering primary shards of the restored indices. Once the recovery of the\n-primary shards is completed Elasticsearch switches to the standard replication\n-process that creates the required number of replicas. Once all required\n+by recovering primary shards of the restored indices. After the recovery of the\n+primary shards is completed, {es} switches to the standard replication\n+process that creates the required number of replicas. When all required\n replicas are created, the cluster switches to the `green` states.\n \n The cluster health operation provides only a high level status of the restore process. It's possible to get more\n detailed insight into the current state of the recovery process by using <<indices-recovery, index recovery>> and\n <<cat-recovery, cat recovery>> APIs.\n \n-[float]\n+[discrete]", "originalCommit": "2abba42e4152c1704fa43c81a14c1049f56d41f8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQ5MTY0Mw==", "url": "https://github.com/elastic/elasticsearch/pull/59730#discussion_r456491643", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            running snapshot was started by mistake, or takes unusually long, it can be stopped using the <<delete-snapshot-api,Delete snapshot API>>.\n          \n          \n            \n            running snapshot was started by mistake, or takes unusually long, it can be stopped using the <<delete-snapshot-api,delete snapshot API>>.", "author": "jrodewig", "createdAt": "2020-07-17T14:50:26Z", "path": "docs/reference/snapshot-restore/monitor-snapshot-restore.asciidoc", "diffHunk": "@@ -20,71 +22,151 @@ PUT /_snapshot/my_backup\n   }\n }\n \n+PUT /_snapshot/my_fs_backup\n+{\n+  \"type\": \"fs\",\n+  \"settings\": {\n+    \"location\": \"my_other_backup_location\"\n+  }\n+}\n+\n PUT /_snapshot/my_backup/snapshot_1?wait_for_completion=true\n -----------------------------------\n // TESTSETUP\n \n ////\n \n-The snapshot operation can be also monitored by periodic calls to the snapshot info:\n+Use the `_current` parameter to retrieve all currently running\n+snapshots in the cluster:\n+\n+[source,console]\n+-----------------------------------\n+GET /_snapshot/my_backup/_current\n+-----------------------------------\n+\n+Including a snapshot name in the request retrieves information about a single snapshot:\n \n [source,console]\n -----------------------------------\n GET /_snapshot/my_backup/snapshot_1\n -----------------------------------\n \n-Please note that snapshot info operation uses the same resources and thread pool as the snapshot operation. So,\n-executing a snapshot info operation while large shards are being snapshotted can cause the snapshot info operation to wait\n-for available resources before returning the result. On very large shards the wait time can be significant.\n+This request retrieves basic information about the snapshot, including start and end time, version of\n+{es} that created the snapshot, the list of included data streams and indices, the current state of the\n+snapshot and the list of failures that occurred during the snapshot.\n \n-To get more immediate and complete information about snapshots the snapshot status command can be used instead:\n+Similar to repositories, you can retrieve information about multiple snapshots in a single request, and wildcards are supported:\n \n [source,console]\n -----------------------------------\n-GET /_snapshot/my_backup/snapshot_1/_status\n+GET /_snapshot/my_backup/snapshot_*,some_other_snapshot\n+-----------------------------------\n+\n+Separate repository names with commas or use wildcards to retrieve snapshots from multiple repositories:\n+\n+[source,console]\n+-----------------------------------\n+GET /_snapshot/_all\n+GET /_snapshot/my_backup,my_fs_backup\n+GET /_snapshot/my*/snap*\n+-----------------------------------\n+\n+Add the `_all` parameter to the request to list all snapshots currently stored in the repository:\n+\n+[source,console]\n+-----------------------------------\n+GET /_snapshot/my_backup/_all\n -----------------------------------\n-// TEST[continued]\n \n-While snapshot info method returns only basic information about the snapshot in progress, the snapshot status returns\n+This request fails if some of the snapshots are unavailable. Use the boolean parameter `ignore_unavailable` to\n+return all snapshots that are currently available.\n+\n+Getting all snapshots in the repository can be costly on cloud-based repositories,\n+both from a cost and performance perspective.  If the only information required is\n+the snapshot names or UUIDs in the repository and the data streams and indices in each snapshot, then\n+the optional boolean parameter `verbose` can be set to `false` to execute a more\n+performant and cost-effective retrieval of the snapshots in the repository.\n+\n+NOTE: Setting `verbose` to `false` omits additional information\n+about the snapshot, such as metadata, start and end time, number of shards that include the snapshot, and error messages. The default value of the `verbose` parameter is `true`.\n+\n+[discrete]\n+[[get-snapshot-detailed-status]]\n+=== Retrieving snapshot status\n+To retrieve more detailed information about snapshots, use the <<get-snapshot-status-api,Get snapshot status API>>. While snapshot request returns only basic information about the snapshot in progress, the snapshot status request returns\n complete breakdown of the current state for each shard participating in the snapshot.\n \n-The restore process piggybacks on the standard recovery mechanism of the\n-Elasticsearch. As a result, standard recovery monitoring services can be used\n-to monitor the state of restore. When the restore operation is executed the\n+[WARNING]\n+====\n+Using the Get snapshot status API to return any status results other than the currently running snapshots (`_current`) can be very expensive. Each request to retrieve snapshot status results in file reads from every shard in a snapshot, for each snapshot.\n+\n+For example, if you have 100 snapshots with 1,000 shards each, the API request will result in 100,000 file reads (100 snapshots * 1,000 shards). Depending on the latency of your file storage, the request can take extremely long to retrieve results.\n+====\n+\n+The following request retrieves all currently running snapshots with\n+detailed status information:\n+\n+[source,console]\n+-----------------------------------\n+GET /_snapshot/_status\n+-----------------------------------\n+\n+By specifying a repository name, it's possible\n+to limit the results to a particular repository:\n+\n+[source,console]\n+-----------------------------------\n+GET /_snapshot/my_backup/_status\n+-----------------------------------\n+\n+If both repository name and snapshot name are specified, the request\n+returns detailed status information for the given snapshot, even\n+if not currently running:\n+\n+[source,console]\n+-----------------------------------\n+GET /_snapshot/my_backup/snapshot_1/_status\n+-----------------------------------\n+\n+[discrete]\n+=== Monitoring restore operations\n+\n+The restore process piggybacks on the standard recovery mechanism of\n+{es}. As a result, standard recovery monitoring services can be used\n+to monitor the state of restore. When the restore operation starts, the\n cluster typically goes into `yellow` state because the restore operation works\n-by recovering primary shards of the restored indices. Once the recovery of the\n-primary shards is completed Elasticsearch switches to the standard replication\n-process that creates the required number of replicas. Once all required\n+by recovering primary shards of the restored indices. After the recovery of the\n+primary shards is completed, {es} switches to the standard replication\n+process that creates the required number of replicas. When all required\n replicas are created, the cluster switches to the `green` states.\n \n The cluster health operation provides only a high level status of the restore process. It's possible to get more\n detailed insight into the current state of the recovery process by using <<indices-recovery, index recovery>> and\n <<cat-recovery, cat recovery>> APIs.\n \n-[float]\n+[discrete]\n === Stop snapshot and restore operations\n \n The snapshot and restore framework allows running only one snapshot or one restore operation at a time. If a currently\n-running snapshot was executed by mistake, or takes unusually long, it can be terminated using the snapshot delete operation.\n-The snapshot delete operation checks if the deleted snapshot is currently running and if it does, the delete operation stops\n+running snapshot was started by mistake, or takes unusually long, it can be stopped using the <<delete-snapshot-api,Delete snapshot API>>.", "originalCommit": "2abba42e4152c1704fa43c81a14c1049f56d41f8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQ5MTk2Mw==", "url": "https://github.com/elastic/elasticsearch/pull/59730#discussion_r456491963", "bodyText": "Needs an explicit anchor.", "author": "jrodewig", "createdAt": "2020-07-17T14:50:55Z", "path": "docs/reference/snapshot-restore/monitor-snapshot-restore.asciidoc", "diffHunk": "@@ -20,71 +22,151 @@ PUT /_snapshot/my_backup\n   }\n }\n \n+PUT /_snapshot/my_fs_backup\n+{\n+  \"type\": \"fs\",\n+  \"settings\": {\n+    \"location\": \"my_other_backup_location\"\n+  }\n+}\n+\n PUT /_snapshot/my_backup/snapshot_1?wait_for_completion=true\n -----------------------------------\n // TESTSETUP\n \n ////\n \n-The snapshot operation can be also monitored by periodic calls to the snapshot info:\n+Use the `_current` parameter to retrieve all currently running\n+snapshots in the cluster:\n+\n+[source,console]\n+-----------------------------------\n+GET /_snapshot/my_backup/_current\n+-----------------------------------\n+\n+Including a snapshot name in the request retrieves information about a single snapshot:\n \n [source,console]\n -----------------------------------\n GET /_snapshot/my_backup/snapshot_1\n -----------------------------------\n \n-Please note that snapshot info operation uses the same resources and thread pool as the snapshot operation. So,\n-executing a snapshot info operation while large shards are being snapshotted can cause the snapshot info operation to wait\n-for available resources before returning the result. On very large shards the wait time can be significant.\n+This request retrieves basic information about the snapshot, including start and end time, version of\n+{es} that created the snapshot, the list of included data streams and indices, the current state of the\n+snapshot and the list of failures that occurred during the snapshot.\n \n-To get more immediate and complete information about snapshots the snapshot status command can be used instead:\n+Similar to repositories, you can retrieve information about multiple snapshots in a single request, and wildcards are supported:\n \n [source,console]\n -----------------------------------\n-GET /_snapshot/my_backup/snapshot_1/_status\n+GET /_snapshot/my_backup/snapshot_*,some_other_snapshot\n+-----------------------------------\n+\n+Separate repository names with commas or use wildcards to retrieve snapshots from multiple repositories:\n+\n+[source,console]\n+-----------------------------------\n+GET /_snapshot/_all\n+GET /_snapshot/my_backup,my_fs_backup\n+GET /_snapshot/my*/snap*\n+-----------------------------------\n+\n+Add the `_all` parameter to the request to list all snapshots currently stored in the repository:\n+\n+[source,console]\n+-----------------------------------\n+GET /_snapshot/my_backup/_all\n -----------------------------------\n-// TEST[continued]\n \n-While snapshot info method returns only basic information about the snapshot in progress, the snapshot status returns\n+This request fails if some of the snapshots are unavailable. Use the boolean parameter `ignore_unavailable` to\n+return all snapshots that are currently available.\n+\n+Getting all snapshots in the repository can be costly on cloud-based repositories,\n+both from a cost and performance perspective.  If the only information required is\n+the snapshot names or UUIDs in the repository and the data streams and indices in each snapshot, then\n+the optional boolean parameter `verbose` can be set to `false` to execute a more\n+performant and cost-effective retrieval of the snapshots in the repository.\n+\n+NOTE: Setting `verbose` to `false` omits additional information\n+about the snapshot, such as metadata, start and end time, number of shards that include the snapshot, and error messages. The default value of the `verbose` parameter is `true`.\n+\n+[discrete]\n+[[get-snapshot-detailed-status]]\n+=== Retrieving snapshot status\n+To retrieve more detailed information about snapshots, use the <<get-snapshot-status-api,Get snapshot status API>>. While snapshot request returns only basic information about the snapshot in progress, the snapshot status request returns\n complete breakdown of the current state for each shard participating in the snapshot.\n \n-The restore process piggybacks on the standard recovery mechanism of the\n-Elasticsearch. As a result, standard recovery monitoring services can be used\n-to monitor the state of restore. When the restore operation is executed the\n+[WARNING]\n+====\n+Using the Get snapshot status API to return any status results other than the currently running snapshots (`_current`) can be very expensive. Each request to retrieve snapshot status results in file reads from every shard in a snapshot, for each snapshot.\n+\n+For example, if you have 100 snapshots with 1,000 shards each, the API request will result in 100,000 file reads (100 snapshots * 1,000 shards). Depending on the latency of your file storage, the request can take extremely long to retrieve results.\n+====\n+\n+The following request retrieves all currently running snapshots with\n+detailed status information:\n+\n+[source,console]\n+-----------------------------------\n+GET /_snapshot/_status\n+-----------------------------------\n+\n+By specifying a repository name, it's possible\n+to limit the results to a particular repository:\n+\n+[source,console]\n+-----------------------------------\n+GET /_snapshot/my_backup/_status\n+-----------------------------------\n+\n+If both repository name and snapshot name are specified, the request\n+returns detailed status information for the given snapshot, even\n+if not currently running:\n+\n+[source,console]\n+-----------------------------------\n+GET /_snapshot/my_backup/snapshot_1/_status\n+-----------------------------------\n+\n+[discrete]\n+=== Monitoring restore operations\n+\n+The restore process piggybacks on the standard recovery mechanism of\n+{es}. As a result, standard recovery monitoring services can be used\n+to monitor the state of restore. When the restore operation starts, the\n cluster typically goes into `yellow` state because the restore operation works\n-by recovering primary shards of the restored indices. Once the recovery of the\n-primary shards is completed Elasticsearch switches to the standard replication\n-process that creates the required number of replicas. Once all required\n+by recovering primary shards of the restored indices. After the recovery of the\n+primary shards is completed, {es} switches to the standard replication\n+process that creates the required number of replicas. When all required\n replicas are created, the cluster switches to the `green` states.\n \n The cluster health operation provides only a high level status of the restore process. It's possible to get more\n detailed insight into the current state of the recovery process by using <<indices-recovery, index recovery>> and\n <<cat-recovery, cat recovery>> APIs.\n \n-[float]\n+[discrete]\n === Stop snapshot and restore operations\n \n The snapshot and restore framework allows running only one snapshot or one restore operation at a time. If a currently\n-running snapshot was executed by mistake, or takes unusually long, it can be terminated using the snapshot delete operation.\n-The snapshot delete operation checks if the deleted snapshot is currently running and if it does, the delete operation stops\n+running snapshot was started by mistake, or takes unusually long, it can be stopped using the <<delete-snapshot-api,Delete snapshot API>>.\n+This operation checks whether the deleted snapshot is currently running. If it is, the delete snapshot operation stops\n that snapshot before deleting the snapshot data from the repository.\n \n [source,console]\n -----------------------------------\n DELETE /_snapshot/my_backup/snapshot_1\n -----------------------------------\n-// TEST[continued]\n \n The restore operation uses the standard shard recovery mechanism. Therefore, any currently running restore operation can\n-be canceled by deleting data streams and indices that are being restored. Please note that data for all deleted data streams and indices will be removed\n+be canceled by deleting data streams and indices that are being restored. Data for all deleted data streams and indices will be removed\n from the cluster as a result of this operation.\n \n-[float]\n-=== Effect of cluster blocks on snapshot and restore \n+[discrete]", "originalCommit": "2abba42e4152c1704fa43c81a14c1049f56d41f8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjUzODUzMg==", "url": "https://github.com/elastic/elasticsearch/pull/59730#discussion_r456538532", "bodyText": "Good catch! I added anchors for that section and the others that were without.", "author": "lockewritesdocs", "createdAt": "2020-07-17T16:11:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQ5MTk2Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQ5MjIwNQ==", "url": "https://github.com/elastic/elasticsearch/pull/59730#discussion_r456492205", "bodyText": "I don't this is needed.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            ++++\n          \n          \n            \n            <titleabbrev>Restore snapshot</titleabbrev>\n          \n          \n            \n            ++++", "author": "jrodewig", "createdAt": "2020-07-17T14:51:18Z", "path": "docs/reference/snapshot-restore/restore-snapshot.asciidoc", "diffHunk": "@@ -1,5 +1,8 @@\n [[snapshots-restore-snapshot]]\n == Restore a snapshot\n+++++\n+<titleabbrev>Restore snapshot</titleabbrev>\n+++++", "originalCommit": "2abba42e4152c1704fa43c81a14c1049f56d41f8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQ5MjMyOA==", "url": "https://github.com/elastic/elasticsearch/pull/59730#discussion_r456492328", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            ++++\n          \n          \n            \n            <titleabbrev>Create snapshot</titleabbrev>\n          \n          \n            \n            ++++", "author": "jrodewig", "createdAt": "2020-07-17T14:51:30Z", "path": "docs/reference/snapshot-restore/take-snapshot.asciidoc", "diffHunk": "@@ -1,9 +1,15 @@\n [[snapshots-take-snapshot]]\n-== Take a snapshot\n+== Create a snapshot\n+++++\n+<titleabbrev>Create snapshot</titleabbrev>\n+++++", "originalCommit": "2abba42e4152c1704fa43c81a14c1049f56d41f8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQ5MjQ1OA==", "url": "https://github.com/elastic/elasticsearch/pull/59730#discussion_r456492458", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Use the <<put-snapshot-repo-api,Put snapshot repository API>> to register or update a snapshot repository, and then use the <<create-snapshot-api,Create snapshot API>> to create a snapshot in a repository.\n          \n          \n            \n            Use the <<put-snapshot-repo-api,put snapshot repository API>> to register or update a snapshot repository, and then use the <<create-snapshot-api,create snapshot API>> to create a snapshot in a repository.", "author": "jrodewig", "createdAt": "2020-07-17T14:51:42Z", "path": "docs/reference/snapshot-restore/take-snapshot.asciidoc", "diffHunk": "@@ -1,9 +1,15 @@\n [[snapshots-take-snapshot]]\n-== Take a snapshot\n+== Create a snapshot\n+++++\n+<titleabbrev>Create snapshot</titleabbrev>\n+++++\n \n A repository can contain multiple snapshots of the same cluster. Snapshots are identified by unique names within the\n-cluster. A snapshot with the name `snapshot_1` in the repository `my_backup` can be created by executing the following\n-command:\n+cluster.\n+\n+Use the <<put-snapshot-repo-api,Put snapshot repository API>> to register or update a snapshot repository, and then use the <<create-snapshot-api,Create snapshot API>> to create a snapshot in a repository.", "originalCommit": "2abba42e4152c1704fa43c81a14c1049f56d41f8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQ5Mjc5OA==", "url": "https://github.com/elastic/elasticsearch/pull/59730#discussion_r456492798", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            For example, use the <<create-snapshot-api,Create snapshot API>> to create\n          \n          \n            \n            For example, use the <<create-snapshot-api,create snapshot API>> to create", "author": "jrodewig", "createdAt": "2020-07-17T14:52:15Z", "path": "docs/reference/snapshot-restore/take-snapshot.asciidoc", "diffHunk": "@@ -47,167 +53,78 @@ PUT /_snapshot/my_backup/snapshot_2?wait_for_completion=true\n -----------------------------------\n // TEST[skip:cannot complete subsequent snapshot]\n \n-The list of data streams and indices that should be included into the snapshot can be specified using the `indices` parameter that\n-supports <<multi-index,multi-target syntax>>, although the options which control the behavior of multi index syntax\n+Use the `indices` parameter to list the data streams and indices that should be included in the snapshot. This parameter supports\n+<<multi-index,multi-target syntax>>, although the options that control the behavior of multi-index syntax\n must be supplied in the body of the request, rather than as request parameters.\n \n-Data stream backups include the stream's backing indices and metadata, such as \n+Data stream backups include the stream's backing indices and metadata, such as\n the current <<data-streams-generation,generation>> and timestamp field.\n \n You can also choose to include only specific backing indices in a snapshot.\n However, these backups do not include the associated data stream's\n metadata or its other backing indices.\n \n-The snapshot request also supports the\n-`ignore_unavailable` option. Setting it to `true` will cause data streams and indices that do not exist to be ignored during snapshot\n-creation. By default, when the `ignore_unavailable` option is not set and a data stream or index is missing, the snapshot request will fail.\n-\n-By setting `include_global_state` to false it's possible to prevent the cluster global state to be stored as part of\n-the snapshot.\n-\n-IMPORTANT: The global cluster state includes the cluster's index\n-templates, such as those <<create-a-data-stream-template,matching a data\n-streams>>. If your snapshot includes data streams, we recommend storing the\n-cluster state as part of the snapshot. This lets you later restored any\n-templates required for a data stream.\n-\n-By default, the entire snapshot will fail if one or more indices participating in the snapshot don't have\n-all primary shards available. This behaviour can be changed by setting `partial` to `true`. The `expand_wildcards`\n-option can be used to control whether hidden and closed indices will be included in the snapshot, and defaults to `all`.\n-\n-The `metadata` field can be used to attach arbitrary metadata to the snapshot. This may be a record of who took the snapshot,\n-why it was taken, or any other data that might be useful.\n-\n-Snapshot names can be automatically derived using <<date-math-index-names,date math expressions>>, similarly as when creating\n-new data streams or indices. Note that special characters need to be URI encoded.\n-\n-For example, creating a snapshot with the current day in the name, like `snapshot-2018.05.11`, can be achieved with\n-the following command:\n-\n-[source,console]\n------------------------------------\n-# PUT /_snapshot/my_backup/<snapshot-{now/d}>\n-PUT /_snapshot/my_backup/%3Csnapshot-%7Bnow%2Fd%7D%3E\n------------------------------------\n-// TEST[continued]\n-\n-\n+[discrete]\n+[[create-snapshot-process-details]]\n+=== Snapshot process details\n The snapshot process is incremental. In the process of making the snapshot, {es} analyses\n the list of the data stream and index files that are already stored in the repository and copies only files that were created or\n-changed since the last snapshot. That allows multiple snapshots to be preserved in the repository in a compact form.\n-Snapshotting process is executed in non-blocking fashion. All indexing and searching operation can continue to be\n-executed against the data stream or index that is being snapshotted. However, a snapshot represents a point-in-time view\n+changed since the last snapshot. This process allows multiple snapshots to be preserved in the repository in a compact form.\n+\n+The snapshot process is executed in non-blocking fashion. All indexing and searching operations can continue to run against the data stream or index\n+that is being snapshotted. However, a snapshot represents a point-in-time view\n at the moment when snapshot was created, so no records that were added to the data stream or index after the snapshot process was started\n-will be present in the snapshot. The snapshot process starts immediately for the primary shards that has been started\n-and are not relocating at the moment. Before version 1.2.0, the snapshot operation fails if the cluster has any relocating or\n-initializing primaries of indices participating in the snapshot. Starting with version 1.2.0, Elasticsearch waits for\n+will be included in the snapshot.\n+\n+The snapshot process starts immediately for the primary shards that have been started and are not relocating at the moment. {es} waits for\n relocation or initialization of shards to complete before snapshotting them.\n \n Besides creating a copy of each data stream and index, the snapshot process can also store global cluster metadata, which includes persistent\n cluster settings and templates. The transient settings and registered snapshot repositories are not stored as part of\n the snapshot.\n \n-Only one snapshot process can be executed in the cluster at any time. While snapshot of a particular shard is being\n-created this shard cannot be moved to another node, which can interfere with rebalancing process and allocation\n-filtering. Elasticsearch will only be able to move a shard to another node (according to the current allocation\n-filtering settings and rebalancing algorithm) once the snapshot is finished.\n-\n-Once a snapshot is created information about this snapshot can be obtained using the following command:\n-\n-[source,console]\n------------------------------------\n-GET /_snapshot/my_backup/snapshot_1\n------------------------------------\n-// TEST[continued]\n-\n-This command returns basic information about the snapshot including start and end time, version of\n-Elasticsearch that created the snapshot, the list of included data streams and indices, the current state of the\n-snapshot and the list of failures that occurred during the snapshot. The snapshot `state` can be\n-\n-[horizontal]\n-`IN_PROGRESS`::\n-  The snapshot is currently running.\n-\n-`SUCCESS`::\n-  The snapshot finished and all shards were stored successfully.\n-\n-`FAILED`::\n-  The snapshot finished with an error and failed to store any data.\n+Only one snapshot process can be started in the cluster at any time. While a\n+snapshot of a particular shard is being\n+created, this shard cannot be moved to another node, which can interfere with rebalancing and allocation\n+filtering. {es} can only move a shard to another node (according to the current allocation\n+filtering settings and rebalancing algorithm) after the snapshot process\n+is finished.\n \n-`PARTIAL`::\n-  The global cluster state was stored, but data of at least one shard was not stored successfully.\n-  The `failures` section of the response contains more detailed information about shards\n-  that were not processed correctly.\n+After a snapshot is created, use the <<get-snapshot-api,Get snapshot API>> to retrieve information about a snapshot. See <<snapshots-monitor-snapshot-restore,Monitor snapshot and restore progress>> to learn more about retrieving snapshot status.\n \n-`INCOMPATIBLE`::\n-  The snapshot was created with an old version of {es} and is incompatible with\n-  the current version of the cluster.\n-\n-Similar as for repositories, information about multiple snapshots can be queried in a single request, supporting wildcards as well:\n-\n-[source,console]\n------------------------------------\n-GET /_snapshot/my_backup/snapshot_*,some_other_snapshot\n------------------------------------\n-// TEST[continued]\n-\n-All snapshots currently stored in the repository can be listed using the following command:\n-\n-[source,console]\n------------------------------------\n-GET /_snapshot/my_backup/_all\n------------------------------------\n-// TEST[continued]\n-\n-The command fails if some of the snapshots are unavailable. The boolean parameter `ignore_unavailable` can be used to\n-return all snapshots that are currently available.\n+[discrete]\n+[[create-snapshot-options]]\n+=== Options for creating a snapshot\n+The create snapshot request supports the\n+`ignore_unavailable` option. Setting it to `true` will cause data streams and indices that do not exist to be ignored during snapshot\n+creation. By default, when the `ignore_unavailable` option is not set and a data stream or index is missing, the snapshot request will fail.\n \n-Getting all snapshots in the repository can be costly on cloud-based repositories,\n-both from a cost and performance perspective.  If the only information required is\n-the snapshot names/uuids in the repository and the data streams and indices in each snapshot, then\n-the optional boolean parameter `verbose` can be set to `false` to execute a more\n-performant and cost-effective retrieval of the snapshots in the repository.  Note\n-that setting `verbose` to `false` will omit all other information about the snapshot\n-such as status information, the number of snapshotted shards, etc.  The default\n-value of the `verbose` parameter is `true`.\n+By setting `include_global_state` to `false` it's possible to prevent the cluster global state to be stored as part of\n+the snapshot.\n \n-It is also possible to retrieve snapshots from multiple repositories in one go, for example:\n+IMPORTANT: The global cluster state includes the cluster's index\n+templates, such as those <<create-a-data-stream-template,matching a data\n+stream>>. If your snapshot includes data streams, we recommend storing the\n+cluster state as part of the snapshot. This lets you later restored any\n+templates required for a data stream.\n \n-[source,console]\n------------------------------------\n-GET /_snapshot/_all\n-GET /_snapshot/my_backup,my_fs_backup\n-GET /_snapshot/my*/snap*\n------------------------------------\n-// TEST[skip:no my_fs_backup]\n+By default, the entire snapshot will fail if one or more indices participating in the snapshot do not have\n+all primary shards available. You can change this behaviour by setting `partial` to `true`. The `expand_wildcards`\n+option can be used to control whether hidden and closed indices will be included in the snapshot, and defaults to `all`.\n \n-A currently running snapshot can be retrieved using the following command:\n+Use the `metadata` field to attach arbitrary metadata to the snapsho,\n+such as who took the snapshot,\n+why it was taken, or any other data that might be useful.\n \n-[source,console]\n------------------------------------\n-GET /_snapshot/my_backup/_current\n------------------------------------\n-// TEST[continued]\n+Snapshot names can be automatically derived using <<date-math-index-names,date math expressions>>, similarly as when creating\n+new data streams or indices. Special characters must be URI encoded.\n \n-A snapshot can be deleted from the repository using the following command:\n+For example, use the <<create-snapshot-api,Create snapshot API>> to create", "originalCommit": "2abba42e4152c1704fa43c81a14c1049f56d41f8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "628b4786fadf14df3d1bccd95765573ae47f3d90", "url": "https://github.com/elastic/elasticsearch/commit/628b4786fadf14df3d1bccd95765573ae47f3d90", "message": "Remove titleabbrev\n\nCo-authored-by: James Rodewig <james.rodewig@elastic.co>", "committedDate": "2020-07-17T15:31:30Z", "type": "commit"}, {"oid": "1469d847e177dedbc5d1717ecce1b12716217daa", "url": "https://github.com/elastic/elasticsearch/commit/1469d847e177dedbc5d1717ecce1b12716217daa", "message": "Add paragraph break\n\nCo-authored-by: James Rodewig <james.rodewig@elastic.co>", "committedDate": "2020-07-17T15:31:56Z", "type": "commit"}, {"oid": "c62a2bc03fa5e4f4e13a964916fe07b84a66cce4", "url": "https://github.com/elastic/elasticsearch/commit/c62a2bc03fa5e4f4e13a964916fe07b84a66cce4", "message": "Remove titleabbrev from restore page\n\nCo-authored-by: James Rodewig <james.rodewig@elastic.co>", "committedDate": "2020-07-17T15:32:36Z", "type": "commit"}, {"oid": "262cdf2893c12fcb6444da64dd54406bd4707e68", "url": "https://github.com/elastic/elasticsearch/commit/262cdf2893c12fcb6444da64dd54406bd4707e68", "message": "Remove titleabbrev from create page\n\nCo-authored-by: James Rodewig <james.rodewig@elastic.co>", "committedDate": "2020-07-17T15:32:53Z", "type": "commit"}, {"oid": "74d4d2056b578cfda585fd4a73659aac914edc1b", "url": "https://github.com/elastic/elasticsearch/commit/74d4d2056b578cfda585fd4a73659aac914edc1b", "message": "Change \"Create\" to lowercase\n\nCo-authored-by: James Rodewig <james.rodewig@elastic.co>", "committedDate": "2020-07-17T15:33:23Z", "type": "commit"}, {"oid": "c0e5704b3b88ab563c178784ebf38542843d594a", "url": "https://github.com/elastic/elasticsearch/commit/c0e5704b3b88ab563c178784ebf38542843d594a", "message": "Change API names to lowercase\n\nCo-authored-by: James Rodewig <james.rodewig@elastic.co>", "committedDate": "2020-07-17T15:33:52Z", "type": "commit"}, {"oid": "56d75c9758390b34ece3cd982ef7ffd8649210cc", "url": "https://github.com/elastic/elasticsearch/commit/56d75c9758390b34ece3cd982ef7ffd8649210cc", "message": "Remove extraneous delimiters\n\nCo-authored-by: James Rodewig <james.rodewig@elastic.co>", "committedDate": "2020-07-17T15:34:12Z", "type": "commit"}, {"oid": "4b259b78951d58d83172c453b2b93d77543e9137", "url": "https://github.com/elastic/elasticsearch/commit/4b259b78951d58d83172c453b2b93d77543e9137", "message": "Change \"Delete\" to lowercase\n\nCo-authored-by: James Rodewig <james.rodewig@elastic.co>", "committedDate": "2020-07-17T15:34:27Z", "type": "commit"}, {"oid": "598c06c29c74eb71cc3e49cb708cb6f05ce242b4", "url": "https://github.com/elastic/elasticsearch/commit/598c06c29c74eb71cc3e49cb708cb6f05ce242b4", "message": "Single-sourcing warning and clarifying warning text.", "committedDate": "2020-07-17T16:40:56Z", "type": "commit"}]}