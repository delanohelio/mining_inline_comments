{"pr_number": 59279, "pr_title": "Remove Artificially Low Chunk Size Limits from GCS + Azure Blob Stores", "pr_createdAt": "2020-07-09T08:19:20Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/59279", "timeline": [{"oid": "2600205bbdaaee8cb0b01e443ae6055b16a39a8b", "url": "https://github.com/elastic/elasticsearch/commit/2600205bbdaaee8cb0b01e443ae6055b16a39a8b", "message": "Remove Artificially Low Chunk Size Limits from GCS + Azure Blob Stores\n\nRemoving these limits as they cause unnecessarily many object in the blob stores.\nWe do not have to worry about BwC of this change since we do not support any 3rd party\nimplementations of Azure or GCS.\nAlso, since there is no valid reason to set a different than the default maximum chunk size at this\npoint, removing the documentation (which was incorrect in the case of Azure to begin with) for the setting\nfrom the docs.\n\nCloses #56018", "committedDate": "2020-07-09T08:16:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDI4MDEyNQ==", "url": "https://github.com/elastic/elasticsearch/pull/59279#discussion_r454280125", "bodyText": "I think we should still keep the docs for chunk_size. Perhaps we can mention that lowering this value can result in much more files in the repo. Still, it's a valid option and should be documented.", "author": "ywelsch", "createdAt": "2020-07-14T11:11:01Z", "path": "docs/plugins/repository-azure.asciidoc", "diffHunk": "@@ -162,12 +162,6 @@ The Azure repository supports following settings:\n     Specifies the path within container to repository data. Defaults to empty\n     (root directory).\n \n-`chunk_size`::", "originalCommit": "2600205bbdaaee8cb0b01e443ae6055b16a39a8b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDM2Mzc2OQ==", "url": "https://github.com/elastic/elasticsearch/pull/59279#discussion_r454363769", "bodyText": "Still, it's a valid option and should be documented.\n\nIs it though? Setting this option has no advantages whatsoever doesn't it? And we had a few cases both internal and external where people mistook this option as some sort of buffer size.", "author": "original-brownbear", "createdAt": "2020-07-14T13:40:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDI4MDEyNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDM3MTQxNw==", "url": "https://github.com/elastic/elasticsearch/pull/59279#discussion_r454371417", "bodyText": "Setting this option has no advantages whatsoever doesn't it?\n\nIn the searchable snapshot case, it allows parallel downloads of file chunks. Not saying that that's a good use case, just  that there might be some that we don't know about.\n\nAnd we had a few cases both internal and external where people mistook this option as some sort of buffer size.\n\nThis could be fixed by improving the documentation :)\nI prefer full transparency on this setting (saying what it's default is and why), and actively recommend against tuning it, but not hide it from the docs (as folks might otherwise set it based on old docs / S3  docs and have completely wrong expectations).", "author": "ywelsch", "createdAt": "2020-07-14T13:51:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDI4MDEyNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDM4NjkyNA==", "url": "https://github.com/elastic/elasticsearch/pull/59279#discussion_r454386924", "bodyText": "Makes sense, I pushed f45a4f7 :)", "author": "original-brownbear", "createdAt": "2020-07-14T14:13:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDI4MDEyNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDI4MDI5Mg==", "url": "https://github.com/elastic/elasticsearch/pull/59279#discussion_r454280292", "bodyText": "same here", "author": "ywelsch", "createdAt": "2020-07-14T11:11:23Z", "path": "docs/plugins/repository-gcs.asciidoc", "diffHunk": "@@ -226,12 +226,6 @@ The following settings are supported:\n     Specifies the path within bucket to repository data. Defaults to\n     the root of the bucket.\n \n-`chunk_size`::", "originalCommit": "2600205bbdaaee8cb0b01e443ae6055b16a39a8b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "76a3b0b29e12ebf3dd98643effdcdc2887c4fd78", "url": "https://github.com/elastic/elasticsearch/commit/76a3b0b29e12ebf3dd98643effdcdc2887c4fd78", "message": "Merge remote-tracking branch 'elastic/master' into 56018", "committedDate": "2020-07-14T13:56:55Z", "type": "commit"}, {"oid": "076281a505144ef4d768f300ea3874840d735530", "url": "https://github.com/elastic/elasticsearch/commit/076281a505144ef4d768f300ea3874840d735530", "message": "Merge remote-tracking branch 'elastic/master' into 56018", "committedDate": "2020-07-14T13:57:26Z", "type": "commit"}, {"oid": "f45a4f7511bedb26087812f864d9458c7eb08232", "url": "https://github.com/elastic/elasticsearch/commit/f45a4f7511bedb26087812f864d9458c7eb08232", "message": "CR: docs", "committedDate": "2020-07-14T14:11:48Z", "type": "commit"}, {"oid": "a0cd3394f579f3f955f6bd8f3956b63f0568c865", "url": "https://github.com/elastic/elasticsearch/commit/a0cd3394f579f3f955f6bd8f3956b63f0568c865", "message": "Merge remote-tracking branch 'elastic/master' into 56018", "committedDate": "2020-07-14T14:44:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQxMzk4NQ==", "url": "https://github.com/elastic/elasticsearch/pull/59279#discussion_r454413985", "bodyText": "let's spell out what the value is (same for GCS)", "author": "ywelsch", "createdAt": "2020-07-14T14:48:57Z", "path": "docs/plugins/repository-azure.asciidoc", "diffHunk": "@@ -164,9 +164,13 @@ The Azure repository supports following settings:\n \n `chunk_size`::\n \n-    Big files can be broken down into chunks during snapshotting if needed.\n+    Big files can be broken down into multiple smaller blobs in the blob store during snapshotting.\n+    It is not recommended to change this value from its default unless there is an explicit reason for limiting the\n+    size of blobs in the repository. Setting a value lower than the default can result in an increased number of API\n+    calls to the Azure blob store during snapshot create as well as restore operations compared to using the default\n+    value and thus make both operations slower as well as more costly.\n     Specify the chunk size as a value and unit, for example:\n-    `10MB`, `5KB`, `500B`. Defaults to `64MB` (64MB max).\n+    `10MB`, `5KB`, `500B`. Defaults to the maximum size of a blob in the Azure blob store.", "originalCommit": "a0cd3394f579f3f955f6bd8f3956b63f0568c865", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "a63e5cef91240130ae769b0266661b78de58a051", "url": "https://github.com/elastic/elasticsearch/commit/a63e5cef91240130ae769b0266661b78de58a051", "message": "CR: spell out defaults", "committedDate": "2020-07-14T15:26:46Z", "type": "commit"}]}