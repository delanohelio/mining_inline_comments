{"pr_number": 66554, "pr_title": "Allow test-with-ssl-plugin to be used in FIPS", "pr_createdAt": "2020-12-17T19:42:49Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/66554", "timeline": [{"oid": "6641d23f607b280eeedd73061cfe5ef75b66c96d", "url": "https://github.com/elastic/elasticsearch/commit/6641d23f607b280eeedd73061cfe5ef75b66c96d", "message": "Allow test-with-ssl-plugin to be used in FIPS\n\nSelectively use PEM files instead of keystores so that the plugin\ncan be applied to projects even if these would run in fips mode", "committedDate": "2020-12-17T19:40:08Z", "type": "commit"}, {"oid": "c8f8d54c9a39329fd3361e44258ee7990bc3bca8", "url": "https://github.com/elastic/elasticsearch/commit/c8f8d54c9a39329fd3361e44258ee7990bc3bca8", "message": "fix format", "committedDate": "2020-12-17T22:04:58Z", "type": "commit"}, {"oid": "51b1b3565354d49f9baacb8fac5347d3bb34145d", "url": "https://github.com/elastic/elasticsearch/commit/51b1b3565354d49f9baacb8fac5347d3bb34145d", "message": "Merge branch 'master' into test-with-ssl-plugin-fips", "committedDate": "2020-12-18T07:33:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzkyNjU1Nw==", "url": "https://github.com/elastic/elasticsearch/pull/66554#discussion_r547926557", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            8. Export the client's private key\n          \n          \n            \n            8. Export the node's private key", "author": "ywangd", "createdAt": "2020-12-23T12:05:56Z", "path": "buildSrc/src/main/resources/test/ssl/README.md", "diffHunk": "@@ -18,3 +18,11 @@ The certificates are generated using catch-all SAN in the following procedure:\n    `keytool -export -alias test-client -keystore test-client.jks -storepass keypass -file test-client.crt`\n 6. Import the client certificate in the node's keystore:\n    `keytool -import -alias test-client -keystore test-node.jks -storepass keypass -file test-client.crt -noprompt`\n+7. Convert the node's keystore to PKCS#12 temporarily so that we can export the private key ( as keytool doesn't allow this)\n+   `keytool -importkeystore -srckeystore test-node.jks -srcstorepass keypass -destkeystore test-node.p12 -deststoretype PKCS12 -deststorepass keypass`\n+8. Export the client's private key", "originalCommit": "51b1b3565354d49f9baacb8fac5347d3bb34145d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzkyNjY3Mg==", "url": "https://github.com/elastic/elasticsearch/pull/66554#discussion_r547926672", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            9. Convert the node's keystore to PKCS#12 temporarily so that we can export the private key ( as keytool doesn't allow this)\n          \n          \n            \n            9. Convert the client's keystore to PKCS#12 temporarily so that we can export the private key ( as keytool doesn't allow this)", "author": "ywangd", "createdAt": "2020-12-23T12:06:13Z", "path": "buildSrc/src/main/resources/test/ssl/README.md", "diffHunk": "@@ -18,3 +18,11 @@ The certificates are generated using catch-all SAN in the following procedure:\n    `keytool -export -alias test-client -keystore test-client.jks -storepass keypass -file test-client.crt`\n 6. Import the client certificate in the node's keystore:\n    `keytool -import -alias test-client -keystore test-node.jks -storepass keypass -file test-client.crt -noprompt`\n+7. Convert the node's keystore to PKCS#12 temporarily so that we can export the private key ( as keytool doesn't allow this)\n+   `keytool -importkeystore -srckeystore test-node.jks -srcstorepass keypass -destkeystore test-node.p12 -deststoretype PKCS12 -deststorepass keypass`\n+8. Export the client's private key\n+   `openssl pkcs12 -in test-node.p12 -passin pass:keypass -nocerts -nodes -out test-node.key`\n+9. Convert the node's keystore to PKCS#12 temporarily so that we can export the private key ( as keytool doesn't allow this)", "originalCommit": "51b1b3565354d49f9baacb8fac5347d3bb34145d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzkzMDE3MA==", "url": "https://github.com/elastic/elasticsearch/pull/66554#discussion_r547930170", "bodyText": "Is there any value to have encryption here? Since this file is mainly used for testing FIPS, so most likely the private key will be encrypted in the wild.", "author": "ywangd", "createdAt": "2020-12-23T12:15:33Z", "path": "buildSrc/src/main/resources/test/ssl/README.md", "diffHunk": "@@ -18,3 +18,11 @@ The certificates are generated using catch-all SAN in the following procedure:\n    `keytool -export -alias test-client -keystore test-client.jks -storepass keypass -file test-client.crt`\n 6. Import the client certificate in the node's keystore:\n    `keytool -import -alias test-client -keystore test-node.jks -storepass keypass -file test-client.crt -noprompt`\n+7. Convert the node's keystore to PKCS#12 temporarily so that we can export the private key ( as keytool doesn't allow this)\n+   `keytool -importkeystore -srckeystore test-node.jks -srcstorepass keypass -destkeystore test-node.p12 -deststoretype PKCS12 -deststorepass keypass`\n+8. Export the client's private key\n+   `openssl pkcs12 -in test-node.p12 -passin pass:keypass -nocerts -nodes -out test-node.key`", "originalCommit": "51b1b3565354d49f9baacb8fac5347d3bb34145d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NjU0NTgwNA==", "url": "https://github.com/elastic/elasticsearch/pull/66554#discussion_r556545804", "bodyText": "I think we have enough coverage for this in unit tests, but on the other hand, why not ? :)", "author": "jkakavas", "createdAt": "2021-01-13T14:09:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzkzMDE3MA=="}], "type": "inlineReview"}, {"oid": "b09119ee3352f462ad86486db8990ef4ac10137c", "url": "https://github.com/elastic/elasticsearch/commit/b09119ee3352f462ad86486db8990ef4ac10137c", "message": "address feedback", "committedDate": "2021-01-13T14:25:16Z", "type": "commit"}, {"oid": "47e4c59b593650f30065dd3eb86513701bfe0118", "url": "https://github.com/elastic/elasticsearch/commit/47e4c59b593650f30065dd3eb86513701bfe0118", "message": "Merge remote-tracking branch 'origin/master' into test-with-ssl-plugin-fips", "committedDate": "2021-01-13T14:25:20Z", "type": "commit"}, {"oid": "d6750ed058770b4560a587cb94f4934da0c7ddc4", "url": "https://github.com/elastic/elasticsearch/commit/d6750ed058770b4560a587cb94f4934da0c7ddc4", "message": "Merge branch 'master' into test-with-ssl-plugin-fips", "committedDate": "2021-01-13T15:58:47Z", "type": "commit"}, {"oid": "598a3b3fd57235608bc26877a53e4a4dc9eaa0ab", "url": "https://github.com/elastic/elasticsearch/commit/598a3b3fd57235608bc26877a53e4a4dc9eaa0ab", "message": "Merge branch 'master' into test-with-ssl-plugin-fips", "committedDate": "2021-01-14T09:54:59Z", "type": "commit"}]}