{"pr_number": 54268, "pr_title": "[DOCS] Reformat `flatten_graph` token filter", "pr_createdAt": "2020-03-26T13:19:07Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/54268", "timeline": [{"oid": "130f60917352061ce2a554bcaea46e7d6a77a5f4", "url": "https://github.com/elastic/elasticsearch/commit/130f60917352061ce2a554bcaea46e7d6a77a5f4", "message": "[DOCS] Reformat `flatten_graph` token filter\n\nMakes the following changes to the `flatten_graph` token filter docs:\n\n* Rewrites description and adds Lucene link\n* Adds detailed analyze example\n* Adds analyzer example", "committedDate": "2020-03-26T13:15:04Z", "type": "commit"}, {"oid": "65f5922b211aaf78202e4410591a38a0e0456df1", "url": "https://github.com/elastic/elasticsearch/commit/65f5922b211aaf78202e4410591a38a0e0456df1", "message": "reword", "committedDate": "2020-03-26T13:38:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTU5OTQwOQ==", "url": "https://github.com/elastic/elasticsearch/pull/54268#discussion_r401599409", "bodyText": "I think it would be good to reword this to strongly advise against using these at index time at all - generally speaking, filters that could produce graphs should be used at query time instead.  flatten_graph is a kind of shonky workaround for a problem that really should be fixed elsewhere.", "author": "romseygeek", "createdAt": "2020-04-01T13:06:20Z", "path": "docs/reference/analysis/tokenfilters/flatten-graph-tokenfilter.asciidoc", "diffHunk": "@@ -4,18 +4,232 @@\n <titleabbrev>Flatten graph</titleabbrev>\n ++++\n \n-The `flatten_graph` token filter accepts an arbitrary graph token\n-stream, such as that produced by\n-<<analysis-synonym-graph-tokenfilter>>, and flattens it into a single\n-linear chain of tokens suitable for indexing.\n-\n-This is a lossy process, as separate side paths are squashed on top of\n-one another, but it is necessary if you use a graph token stream\n-during indexing because a Lucene index cannot currently represent a\n-graph.  For this reason, it's best to apply graph analyzers only at\n-search time because that preserves the full graph structure and gives\n-correct matches for proximity queries.\n-\n-For more information on this topic and its various complexities,\n-please read the http://blog.mikemccandless.com/2012/04/lucenes-tokenstreams-are-actually.html[Lucene's\n-TokenStreams are actually graphs] blog post.\n+Flattens a <<token-graphs,token graph>> produced by a graph token filter, such\n+as <<analysis-synonym-graph-tokenfilter,`synonym_graph`>> or\n+<<analysis-word-delimiter-graph-tokenfilter,`word_delimiter_graph`>>.\n+\n+Flattening a token graph containing\n+<<token-graphs-multi-position-tokens,multi-position tokens>> makes the graph\n+suitable for <<analysis-index-search-time,indexing>>. Otherwise, indexing does\n+not support token graphs containing multi-position tokens.\n+\n+[WARNING]\n+====\n+Flattening graphs containing multi-position tokens is a lossy process.\n+Flattening collapses the side paths of a token graph into a linear path.\n+\n+If possible, avoid using graph token filters in\n+<<analysis-index-search-time,index analyzers>>. Use the respective\n+<<analysis-synonym-tokenfilter,`synonym`>> or\n+<<analysis-word-delimiter-tokenfilter,`word_delimiter`>> filters instead.", "originalCommit": "65f5922b211aaf78202e4410591a38a0e0456df1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTc5ODIxOQ==", "url": "https://github.com/elastic/elasticsearch/pull/54268#discussion_r401798219", "bodyText": "Thanks for the feedback @romseygeek!\nWith afcbebf, I reworded the warning to remove the recommendation for the synonym and word_delimiter filters. It also recommends that token graph filters only be used in search analyzers.\nLet me know if you see any other needed changes!", "author": "jrodewig", "createdAt": "2020-04-01T17:47:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTU5OTQwOQ=="}], "type": "inlineReview"}, {"oid": "afcbebfb5ea49d3fe008d371fedd3ffb3e85cc0e", "url": "https://github.com/elastic/elasticsearch/commit/afcbebfb5ea49d3fe008d371fedd3ffb3e85cc0e", "message": "address feedback", "committedDate": "2020-04-01T17:46:27Z", "type": "commit"}, {"oid": "afcbebfb5ea49d3fe008d371fedd3ffb3e85cc0e", "url": "https://github.com/elastic/elasticsearch/commit/afcbebfb5ea49d3fe008d371fedd3ffb3e85cc0e", "message": "address feedback", "committedDate": "2020-04-01T17:46:27Z", "type": "forcePushed"}]}