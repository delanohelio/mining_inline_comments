{"pr_number": 55753, "pr_title": "Scripting: Deprecate general cache settings", "pr_createdAt": "2020-04-24T20:51:45Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/55753", "timeline": [{"oid": "ef543b026e8ede60faa7570179d0ddf69911358b", "url": "https://github.com/elastic/elasticsearch/commit/ef543b026e8ede60faa7570179d0ddf69911358b", "message": "Scripting: Deprecate general cache settings (#55038)\n\n* Test: don't modify defaultConfig on upgrade", "committedDate": "2020-04-23T19:34:19Z", "type": "commit"}, {"oid": "cd28c33ec2f03bd4259033f57859b19dd4bfd92d", "url": "https://github.com/elastic/elasticsearch/commit/cd28c33ec2f03bd4259033f57859b19dd4bfd92d", "message": "Add deprecation api and docs", "committedDate": "2020-04-24T20:37:19Z", "type": "commit"}, {"oid": "35eed33c8b20469b2b7592c2a2ff366b54b37e78", "url": "https://github.com/elastic/elasticsearch/commit/35eed33c8b20469b2b7592c2a2ff366b54b37e78", "message": "Revert bad merge in docker-compose.yml", "committedDate": "2020-04-24T20:49:02Z", "type": "commit"}, {"oid": "e31eed3b0d25c61c64aa334e70f1a6761aa43180", "url": "https://github.com/elastic/elasticsearch/commit/e31eed3b0d25c61c64aa334e70f1a6761aa43180", "message": "Breaking changes formatting", "committedDate": "2020-04-24T20:50:48Z", "type": "commit"}, {"oid": "261167370f493e8ebccb5ae925935dcbf6493779", "url": "https://github.com/elastic/elasticsearch/commit/261167370f493e8ebccb5ae925935dcbf6493779", "message": "Fix up deprecation tests", "committedDate": "2020-04-30T16:27:22Z", "type": "commit"}, {"oid": "edcfdeb7fda1401446bcae1f2cfb98a4e35184b8", "url": "https://github.com/elastic/elasticsearch/commit/edcfdeb7fda1401446bcae1f2cfb98a4e35184b8", "message": "Remove unused import and edit long line in ScriptCacheTests", "committedDate": "2020-04-30T17:30:20Z", "type": "commit"}, {"oid": "9760d5053a4aca5291bedb394e0cf25449c7ea4b", "url": "https://github.com/elastic/elasticsearch/commit/9760d5053a4aca5291bedb394e0cf25449c7ea4b", "message": "Merge branch '7.x' of github.com:elastic/elasticsearch into 7.x-fix/50152-painless-limit-per-context__05__deprecate", "committedDate": "2020-05-04T20:03:11Z", "type": "commit"}, {"oid": "2b3aa6b12fb1b38dbb7f0108de52994770606d0a", "url": "https://github.com/elastic/elasticsearch/commit/2b3aa6b12fb1b38dbb7f0108de52994770606d0a", "message": "[[ -> <<", "committedDate": "2020-05-04T20:28:21Z", "type": "commit"}, {"oid": "c6b5df20e59d75fba0c330e3437cb20cde87d5aa", "url": "https://github.com/elastic/elasticsearch/commit/c6b5df20e59d75fba0c330e3437cb20cde87d5aa", "message": "Painless contexts is in another book", "committedDate": "2020-05-04T20:35:41Z", "type": "commit"}, {"oid": "b9cb8597570b72f4d3ff0564f53aeee07eb0b129", "url": "https://github.com/elastic/elasticsearch/commit/b9cb8597570b72f4d3ff0564f53aeee07eb0b129", "message": "Merge branch '7.x' of github.com:elastic/elasticsearch into 7.x-fix/50152-painless-limit-per-context__05__deprecate", "committedDate": "2020-06-15T20:38:12Z", "type": "commit"}, {"oid": "eab6df7ffae29ccaf4d14f73e92f54d683442b84", "url": "https://github.com/elastic/elasticsearch/commit/eab6df7ffae29ccaf4d14f73e92f54d683442b84", "message": "Change to 7.9 in docs", "committedDate": "2020-06-15T21:38:16Z", "type": "commit"}, {"oid": "a5e1f4fd70e070c73c4c379bd1b344ac56711a55", "url": "https://github.com/elastic/elasticsearch/commit/a5e1f4fd70e070c73c4c379bd1b344ac56711a55", "message": "Issue typo in docs", "committedDate": "2020-06-15T22:37:55Z", "type": "commit"}, {"oid": "8e587326f5791422151a58944f1504d964250171", "url": "https://github.com/elastic/elasticsearch/commit/8e587326f5791422151a58944f1504d964250171", "message": "Merge branch '7.x' of github.com:elastic/elasticsearch into 7.x-fix/50152-painless-limit-per-context__05__deprecate", "committedDate": "2020-06-15T23:05:38Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDkxODAyMA==", "url": "https://github.com/elastic/elasticsearch/pull/55753#discussion_r440918020", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            For example, for the `update` context, use `script.context.update.context_max_size`.\n          \n          \n            \n            For example, for the `update` context, use `script.context.update.cache_expire`.", "author": "jrodewig", "createdAt": "2020-06-16T14:57:53Z", "path": "docs/reference/migration/migrate_7_9.asciidoc", "diffHunk": "@@ -0,0 +1,71 @@\n+[[breaking-changes-7.9]]\n+== Breaking changes in 7.9\n+++++\n+<titleabbrev>7.9</titleabbrev>\n+++++\n+\n+This section discusses the changes that you need to be aware of when migrating\n+your application to {es} 7.9.\n+\n+See also <<release-highlights>> and <<es-release-notes>>.\n+\n+* <<breaking_79_script_cache_changes>>\n+\n+//NOTE: The notable-breaking-changes tagged regions are re-used in the\n+//Installation and Upgrade Guide\n+\n+//tag::notable-breaking-changes[]\n+[discrete]\n+[[breaking_79_script_cache_changes]]\n+=== Script cache changes\n+[[deprecate_general_script_cache_size]]\n+.The `script.cache.max_size` setting is deprecated.\n+\n+[%collapsible]\n+====\n+*Details* +\n+The `script.cache.max_size` setting is deprecated. In {es} 8.0.0, this is\n+set per-context.\n+\n+*Impact* +\n+To avoid deprecation warnings, discontinue use of the `script.cache.max_size`\n+setting. You may use `script.context.$CONTEXT.context_max_size` for the particular context.\n+For example, for the `ingest` context, use `script.context.ingest.context_max_size`.\n+\n+====\n+\n+[discrete]\n+[[deprecate_general_script_expire]]\n+.The `script.cache.expire` setting is deprecated.\n+\n+[%collapsible]\n+====\n+*Details* +\n+The `script.cache.expire` setting is deprecated. In {es} 8.0.0, this is\n+set per-context.\n+\n+*Impact* +\n+To avoid deprecation warnings, discontinue use of the `script.cache.expire`\n+setting. You may use `script.context.$CONTEXT.cache_expire` for the particular context.\n+For example, for the `update` context, use `script.context.update.context_max_size`.", "originalCommit": "8e587326f5791422151a58944f1504d964250171", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDk2MTE2NA==", "url": "https://github.com/elastic/elasticsearch/pull/55753#discussion_r440961164", "bodyText": "good catch, changed.", "author": "stu-elastic", "createdAt": "2020-06-16T15:53:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDkxODAyMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDkyMDk4Mw==", "url": "https://github.com/elastic/elasticsearch/pull/55753#discussion_r440920983", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            `script.context.processor_conditional.context_max_size`.\n          \n          \n            \n            `script.context.processor_conditional.max_compilations_rate`.", "author": "jrodewig", "createdAt": "2020-06-16T15:01:37Z", "path": "docs/reference/migration/migrate_7_9.asciidoc", "diffHunk": "@@ -0,0 +1,71 @@\n+[[breaking-changes-7.9]]\n+== Breaking changes in 7.9\n+++++\n+<titleabbrev>7.9</titleabbrev>\n+++++\n+\n+This section discusses the changes that you need to be aware of when migrating\n+your application to {es} 7.9.\n+\n+See also <<release-highlights>> and <<es-release-notes>>.\n+\n+* <<breaking_79_script_cache_changes>>\n+\n+//NOTE: The notable-breaking-changes tagged regions are re-used in the\n+//Installation and Upgrade Guide\n+\n+//tag::notable-breaking-changes[]\n+[discrete]\n+[[breaking_79_script_cache_changes]]\n+=== Script cache changes\n+[[deprecate_general_script_cache_size]]\n+.The `script.cache.max_size` setting is deprecated.\n+\n+[%collapsible]\n+====\n+*Details* +\n+The `script.cache.max_size` setting is deprecated. In {es} 8.0.0, this is\n+set per-context.\n+\n+*Impact* +\n+To avoid deprecation warnings, discontinue use of the `script.cache.max_size`\n+setting. You may use `script.context.$CONTEXT.context_max_size` for the particular context.\n+For example, for the `ingest` context, use `script.context.ingest.context_max_size`.\n+\n+====\n+\n+[discrete]\n+[[deprecate_general_script_expire]]\n+.The `script.cache.expire` setting is deprecated.\n+\n+[%collapsible]\n+====\n+*Details* +\n+The `script.cache.expire` setting is deprecated. In {es} 8.0.0, this is\n+set per-context.\n+\n+*Impact* +\n+To avoid deprecation warnings, discontinue use of the `script.cache.expire`\n+setting. You may use `script.context.$CONTEXT.cache_expire` for the particular context.\n+For example, for the `update` context, use `script.context.update.context_max_size`.\n+\n+====\n+\n+[discrete]\n+[[deprecate_general_script_compile_rate]]\n+.The `script.max_compilations_rate` setting is deprecated.\n+\n+[%collapsible]\n+====\n+*Details* +\n+The `script.max_compilations_rate` setting is deprecated. In {es} 8.0.0, this is\n+set per-context.\n+\n+*Impact* +\n+To avoid deprecation warnings, discontinue use of the `script.max_compilations_rate`\n+setting. You may use `script.context.$CONTEXT.max_compilations_rate` for the particular\n+context.  For example, for the `processor_conditional` context, use\n+`script.context.processor_conditional.context_max_size`.", "originalCommit": "8e587326f5791422151a58944f1504d964250171", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDk2MTMxNQ==", "url": "https://github.com/elastic/elasticsearch/pull/55753#discussion_r440961315", "bodyText": "ty, changed.", "author": "stu-elastic", "createdAt": "2020-06-16T15:54:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDkyMDk4Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDkyNjAxNA==", "url": "https://github.com/elastic/elasticsearch/pull/55753#discussion_r440926014", "bodyText": "As this is empty, I don't think we need to add it. I believe the release-notes/highlights.asciidoc file is intended to now take the place of this file.\n@debadair may have more context.", "author": "jrodewig", "createdAt": "2020-06-16T15:08:26Z", "path": "docs/reference/release-notes/highlights-7.9.0.asciidoc", "diffHunk": "@@ -0,0 +1,13 @@\n+[[release-highlights-7.9.0]]\n+== 7.9.0 release highlights\n+++++\n+<titleabbrev>7.9.0</titleabbrev>\n+++++\n+\n+coming[7.9.0]\n+//NOTE: The notable-highlights tagged regions are re-used in the\n+//Installation and Upgrade Guide\n+\n+// tag::notable-highlights[]\n+\n+// end::notable-highlights[]", "originalCommit": "8e587326f5791422151a58944f1504d964250171", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDk2MTU0OQ==", "url": "https://github.com/elastic/elasticsearch/pull/55753#discussion_r440961549", "bodyText": "Removed, if necessary it can be added in a later commit.", "author": "stu-elastic", "createdAt": "2020-06-16T15:54:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDkyNjAxNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDkyNjIzMA==", "url": "https://github.com/elastic/elasticsearch/pull/55753#discussion_r440926230", "bodyText": "Extra space\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            <<release-notes-{elasticsearch_version}, Release notes >>  and\n          \n          \n            \n            <<release-notes-{elasticsearch_version}, Release notes >> and", "author": "jrodewig", "createdAt": "2020-06-16T15:08:43Z", "path": "docs/reference/release-notes/highlights.asciidoc", "diffHunk": "@@ -3,16 +3,16 @@\n \n coming[{minor-version}]\n \n-Here are the highlights of what's new and improved in {es} {minor-version}! \n+Here are the highlights of what's new and improved in {es} {minor-version}!\n ifeval::[\"{release-state}\"!=\"unreleased\"]\n-For detailed information about this release, see the \n-<<release-notes-{elasticsearch_version}, Release notes >>  and \n+For detailed information about this release, see the\n+<<release-notes-{elasticsearch_version}, Release notes >>  and", "originalCommit": "8e587326f5791422151a58944f1504d964250171", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDk2MTc2MA==", "url": "https://github.com/elastic/elasticsearch/pull/55753#discussion_r440961760", "bodyText": "Removed.", "author": "stu-elastic", "createdAt": "2020-06-16T15:54:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDkyNjIzMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDkyNzc3Mw==", "url": "https://github.com/elastic/elasticsearch/pull/55753#discussion_r440927773", "bodyText": "Adds period and comma.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            `script.context.$CONTEXT.max_compilations_rate` eg.\n          \n          \n            \n            `script.context.field.max_compilations_rate=100/10m`.\n          \n          \n            \n            `script.context.$CONTEXT.max_compilations_rate` e.g.,\n          \n          \n            \n            `script.context.field.max_compilations_rate=100/10m`.", "author": "jrodewig", "createdAt": "2020-06-16T15:10:50Z", "path": "docs/reference/scripting/using.asciidoc", "diffHunk": "@@ -98,9 +98,11 @@ second version is only compiled once.\n \n If you compile too many unique scripts within a small amount of time,\n Elasticsearch will reject the new dynamic scripts with a\n-`circuit_breaking_exception` error. By default, up to 15 inline scripts per\n-minute will be compiled. You can change this setting dynamically by setting\n-`script.max_compilations_rate`.\n+`circuit_breaking_exception` error. By default, up to 75 scripts per\n+5 minutes will be compiled for most contexts and 375 scripts per 5 minutes\n+for ingest contexts. You can change these settings dynamically by setting\n+`script.context.$CONTEXT.max_compilations_rate` eg.\n+`script.context.field.max_compilations_rate=100/10m`.", "originalCommit": "8e587326f5791422151a58944f1504d964250171", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDk2MTk5Mw==", "url": "https://github.com/elastic/elasticsearch/pull/55753#discussion_r440961993", "bodyText": "perioded and commad", "author": "stu-elastic", "createdAt": "2020-06-16T15:55:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDkyNzc3Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDkyNzk2Nw==", "url": "https://github.com/elastic/elasticsearch/pull/55753#discussion_r440927967", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            you can configure the size of this cache by using the \n          \n          \n            \n            you can configure the size of this cache using the", "author": "jrodewig", "createdAt": "2020-06-16T15:11:05Z", "path": "docs/reference/scripting/using.asciidoc", "diffHunk": "@@ -241,9 +243,10 @@ templating language]. See <<search-template>> for more information and examples.\n \n All scripts are cached by default so that they only need to be recompiled\n when updates occur. By default, scripts do not have a time-based expiration, but\n-you can change this behavior by using the `script.cache.expire` setting.\n-You can configure the size of this cache by using the `script.cache.max_size` setting.\n-By default, the cache size is `100`.\n+you can configure the size of this cache by using the ", "originalCommit": "8e587326f5791422151a58944f1504d964250171", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDk2MjU2NA==", "url": "https://github.com/elastic/elasticsearch/pull/55753#discussion_r440962564", "bodyText": "by-bye", "author": "stu-elastic", "createdAt": "2020-06-16T15:55:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDkyNzk2Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDkyODMyNQ==", "url": "https://github.com/elastic/elasticsearch/pull/55753#discussion_r440928325", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            for ingest contexts. You can change these settings dynamically by setting\n          \n          \n            \n            for `ingest` contexts. You can change these settings dynamically by setting", "author": "jrodewig", "createdAt": "2020-06-16T15:11:27Z", "path": "docs/reference/scripting/using.asciidoc", "diffHunk": "@@ -98,9 +98,11 @@ second version is only compiled once.\n \n If you compile too many unique scripts within a small amount of time,\n Elasticsearch will reject the new dynamic scripts with a\n-`circuit_breaking_exception` error. By default, up to 15 inline scripts per\n-minute will be compiled. You can change this setting dynamically by setting\n-`script.max_compilations_rate`.\n+`circuit_breaking_exception` error. By default, up to 75 scripts per\n+5 minutes will be compiled for most contexts and 375 scripts per 5 minutes\n+for ingest contexts. You can change these settings dynamically by setting", "originalCommit": "8e587326f5791422151a58944f1504d964250171", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDk2MjMzMQ==", "url": "https://github.com/elastic/elasticsearch/pull/55753#discussion_r440962331", "bodyText": "backticked", "author": "stu-elastic", "createdAt": "2020-06-16T15:55:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDkyODMyNQ=="}], "type": "inlineReview"}, {"oid": "3bf377ebab469c891e669014c4b2f6e98ad81a63", "url": "https://github.com/elastic/elasticsearch/commit/3bf377ebab469c891e669014c4b2f6e98ad81a63", "message": "Correct settings names in migration, rm extra spaces and articles", "committedDate": "2020-06-16T15:52:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDk2MDczNQ==", "url": "https://github.com/elastic/elasticsearch/pull/55753#discussion_r440960735", "bodyText": "Consider making this a table. It might be easier to see the immediate differences, especially if we customize more contexts.", "author": "jdconrad", "createdAt": "2020-06-16T15:53:17Z", "path": "docs/reference/scripting/using.asciidoc", "diffHunk": "@@ -241,9 +243,10 @@ templating language]. See <<search-template>> for more information and examples.\n \n All scripts are cached by default so that they only need to be recompiled\n when updates occur. By default, scripts do not have a time-based expiration, but\n-you can change this behavior by using the `script.cache.expire` setting.\n-You can configure the size of this cache by using the `script.cache.max_size` setting.\n-By default, the cache size is `100`.\n+you can configure the size of this cache by using the \n+`script.context.$CONTEXT.cache_expire` setting.\n+By default, the cache size is `100` for all contexts except the `ingest` and the", "originalCommit": "8e587326f5791422151a58944f1504d964250171", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTA1NTA2Ng==", "url": "https://github.com/elastic/elasticsearch/pull/55753#discussion_r441055066", "bodyText": "tabled", "author": "stu-elastic", "createdAt": "2020-06-16T18:22:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDk2MDczNQ=="}], "type": "inlineReview"}, {"oid": "6eee3bb96908d45bd15f06b0cecb8bd5903e206c", "url": "https://github.com/elastic/elasticsearch/commit/6eee3bb96908d45bd15f06b0cecb8bd5903e206c", "message": "Use cache size table", "committedDate": "2020-06-16T17:43:59Z", "type": "commit"}]}