{"pr_number": 6358, "pr_title": "Refactoring windows and padding for assembly and genotyping", "pr_createdAt": "2020-01-08T16:13:01Z", "pr_url": "https://github.com/broadinstitute/gatk/pull/6358", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzY2ODc4Ng==", "url": "https://github.com/broadinstitute/gatk/pull/6358#discussion_r373668786", "bodyText": "Awesome documentation! Thanks for doing this", "author": "takutosato", "createdAt": "2020-01-31T20:21:10Z", "path": "src/main/java/org/broadinstitute/hellbender/engine/spark/AssemblyRegionArgumentCollection.java", "diffHunk": "@@ -24,19 +25,51 @@\n     public static final int DEFAULT_MAX_READS_PER_ALIGNMENT = 50;\n     public static final double DEFAULT_ACTIVE_PROB_THRESHOLD = 0.002;\n     public static final int DEFAULT_MAX_PROB_PROPAGATION_DISTANCE = 50;\n+    public static final String INDEL_PADDING_LONG_NAME = \"padding-around-indels\";\n+    public static final String SNP_PADDING_LONG_NAME = \"padding-around-snps\";\n+\n+    /**", "originalCommit": "b1cb3133c368f2572d9e6114ad891022c37891f5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDk0NDIzOA==", "url": "https://github.com/broadinstitute/gatk/pull/6358#discussion_r374944238", "bodyText": "\"within those bounds are determined...\"\nMaybe this sentence could be clearer?", "author": "takutosato", "createdAt": "2020-02-04T21:53:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzY2ODc4Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDk0NDMzMQ==", "url": "https://github.com/broadinstitute/gatk/pull/6358#discussion_r374944331", "bodyText": "\"excusively\" -> \"exclusively\"", "author": "takutosato", "createdAt": "2020-02-04T21:53:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzY2ODc4Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTA0NzEwNg==", "url": "https://github.com/broadinstitute/gatk/pull/6358#discussion_r375047106", "bodyText": "done, done", "author": "davidbenjamin", "createdAt": "2020-02-05T03:50:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzY2ODc4Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDkyODUyNg==", "url": "https://github.com/broadinstitute/gatk/pull/6358#discussion_r374928526", "bodyText": "This is great", "author": "takutosato", "createdAt": "2020-02-04T21:18:59Z", "path": "src/main/java/org/broadinstitute/hellbender/engine/AssemblyRegion.java", "diffHunk": "@@ -44,20 +44,20 @@\n     private final List<GATKRead> reads;\n \n     /**\n-     * The raw span of this assembly region, not including the region extension\n+     * The active span in which this AssemblyRegion is responsible for calling variants", "originalCommit": "3f12fb3606d823b1351a0b154481db98acf83df4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDk0OTIxNQ==", "url": "https://github.com/broadinstitute/gatk/pull/6358#discussion_r374949215", "bodyText": "I think mentioning the defaults here (snp genotyping padding = 25, indel genotyping padding = 75, assembly region padding = 100) would be helpful for the reader (i.e. me)", "author": "takutosato", "createdAt": "2020-02-04T22:04:14Z", "path": "src/main/java/org/broadinstitute/hellbender/engine/spark/AssemblyRegionArgumentCollection.java", "diffHunk": "@@ -24,19 +25,51 @@\n     public static final int DEFAULT_MAX_READS_PER_ALIGNMENT = 50;\n     public static final double DEFAULT_ACTIVE_PROB_THRESHOLD = 0.002;\n     public static final int DEFAULT_MAX_PROB_PROPAGATION_DISTANCE = 50;\n+    public static final String INDEL_PADDING_LONG_NAME = \"padding-around-indels\";\n+    public static final String SNP_PADDING_LONG_NAME = \"padding-around-snps\";\n+\n+    /**\n+     * The following parameters can be confusing due to the overlap between active regions, assembly regions, and genotyping regions,\n+     * all of which are implemented as the {@link org.broadinstitute.hellbender.engine.AssemblyRegion} class.\n+     *\n+     * An active region is a genomic interval in which we call variants.  In order to output phased calls we try to put nearby variants\n+     * in the same active region.  The size of active regions are bounded by the {@code minAssemblyRegionSize} and {@code maxAssemblyRegionSize}\n+     * parameters, and within those bounds are determined by the variants present and the {@code activeProbThreshold} and {@code maxProbPropagationDistance}.\n+     * Importantly active regions are excusively a matter of delegating responsibility for calling and have nothing to do with the size\n+     * of the span over which we perform local assembly and pair-HMM.\n+     *\n+     * An assembly region is the padded interval surrounding an active region over which we perform local assembly.  Padding is useful to phase with\n+     * any variation that may be just outside the active region, to avoid dangling ends in the assembly region, and to resolve indels.  The\n+     * {@code assemblyRegionPadding} parameter determines the number of extra bases as assembly region contains on either side of the active region\n+     * it surrounds.\n+     *\n+     * A genotyping region is an interval surrounding an active region in which we perform pair-HMM and Smith-Waterman alignment.  Even though\n+     * we ultimately only genotype and call variants within the active region, we call entire haplotypes as an intermediate step, hence the\n+     * needed for an expanded genotyping region.  The parameters {@code snpPaddingForGenotyping} and {@code indelPaddingForGenotyping} determine", "originalCommit": "b1cb3133c368f2572d9e6114ad891022c37891f5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTA0ODE0NQ==", "url": "https://github.com/broadinstitute/gatk/pull/6358#discussion_r375048145", "bodyText": "I'm nervous about hard-coding numbers -- what if they change? -- but I replaced the {@code }s with {@link }s so the reader can quickly navigate to the defaults in the IDE.", "author": "davidbenjamin", "createdAt": "2020-02-05T03:56:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDk0OTIxNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTI5ODkyMA==", "url": "https://github.com/broadinstitute/gatk/pull/6358#discussion_r375298920", "bodyText": "Thanks these links work great", "author": "takutosato", "createdAt": "2020-02-05T14:47:38Z", "path": "src/main/java/org/broadinstitute/hellbender/engine/spark/AssemblyRegionArgumentCollection.java", "diffHunk": "@@ -34,19 +34,21 @@\n      * all of which are implemented as the {@link org.broadinstitute.hellbender.engine.AssemblyRegion} class.\n      *\n      * An active region is a genomic interval in which we call variants.  In order to output phased calls we try to put nearby variants\n-     * in the same active region.  The size of active regions are bounded by the {@code minAssemblyRegionSize} and {@code maxAssemblyRegionSize}\n-     * parameters, and within those bounds are determined by the variants present and the {@code activeProbThreshold} and {@code maxProbPropagationDistance}.\n-     * Importantly active regions are excusively a matter of delegating responsibility for calling and have nothing to do with the size\n-     * of the span over which we perform local assembly and pair-HMM.\n+     * in the same active region.  The size of active regions are determined by the variants present, {@link AssemblyRegionArgumentCollection.activeProbThreshold},\n+     * and {@link AssemblyRegionArgumentCollection.maxProbPropagationDistance}, and are bounded by the parameters {@link AssemblyRegionArgumentCollection.minAssemblyRegionSize}", "originalCommit": "47a90c4bb9aa432f91767b3d04102aba9f97b70e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f1dd527e7459b8660d08819c9d55268a2b77edb0", "url": "https://github.com/broadinstitute/gatk/commit/f1dd527e7459b8660d08819c9d55268a2b77edb0", "message": "expanded javadoc for AssemblyRegion", "committedDate": "2020-02-05T14:57:29Z", "type": "commit"}, {"oid": "3d3396f970af269e239693bfec0eff833250f338", "url": "https://github.com/broadinstitute/gatk/commit/3d3396f970af269e239693bfec0eff833250f338", "message": "Delete unused methods from AssemblyRegion", "committedDate": "2020-02-05T14:57:29Z", "type": "commit"}, {"oid": "a515248b5431749fe0b7ca7b4e2b4c5ee05080fa", "url": "https://github.com/broadinstitute/gatk/commit/a515248b5431749fe0b7ca7b4e2b4c5ee05080fa", "message": "removed always-true includeReadsWithDeletions parameter", "committedDate": "2020-02-05T14:57:29Z", "type": "commit"}, {"oid": "c85d2d695a0e13637696fda753d3ae8736b39e5f", "url": "https://github.com/broadinstitute/gatk/commit/c85d2d695a0e13637696fda753d3ae8736b39e5f", "message": "eliminated needless difference between GVCF and non-GVCF mode trimming", "committedDate": "2020-02-05T14:57:29Z", "type": "commit"}, {"oid": "28d843088611f6b5e08d5f940fed046b8464e24e", "url": "https://github.com/broadinstitute/gatk/commit/28d843088611f6b5e08d5f940fed046b8464e24e", "message": "Removing unused cruft from AssemblyResultTrimmer.Result", "committedDate": "2020-02-05T14:57:29Z", "type": "commit"}, {"oid": "072acb699fc513b952f469fb19285e060622a760", "url": "https://github.com/broadinstitute/gatk/commit/072acb699fc513b952f469fb19285e060622a760", "message": "Renaming different types of spans", "committedDate": "2020-02-05T14:57:29Z", "type": "commit"}, {"oid": "edc92d60f957e326c9126387af4ba23b41af3236", "url": "https://github.com/broadinstitute/gatk/commit/edc92d60f957e326c9126387af4ba23b41af3236", "message": "got rid of arcane no-trimming option", "committedDate": "2020-02-05T14:57:29Z", "type": "commit"}, {"oid": "2b63990250f9c04d29859a48553958f55000e881", "url": "https://github.com/broadinstitute/gatk/commit/2b63990250f9c04d29859a48553958f55000e881", "message": "Assorted minor polishing", "committedDate": "2020-02-05T14:57:29Z", "type": "commit"}, {"oid": "a42cb2e99aaf4aac82267bd00323949b99f177a1", "url": "https://github.com/broadinstitute/gatk/commit/a42cb2e99aaf4aac82267bd00323949b99f177a1", "message": "removed never-used restrictToIntervals in ActivityProfile", "committedDate": "2020-02-05T14:57:29Z", "type": "commit"}, {"oid": "fe471056ebba69549035cd9829b28df62e13519f", "url": "https://github.com/broadinstitute/gatk/commit/fe471056ebba69549035cd9829b28df62e13519f", "message": "refactored non-variant flanks", "committedDate": "2020-02-05T14:57:29Z", "type": "commit"}, {"oid": "efec867437c1297410964e943050dcb5260c0293", "url": "https://github.com/broadinstitute/gatk/commit/efec867437c1297410964e943050dcb5260c0293", "message": "more refactoring of trimming", "committedDate": "2020-02-05T14:57:29Z", "type": "commit"}, {"oid": "ce2afef9b8511cacf473dc395997611354dd768f", "url": "https://github.com/broadinstitute/gatk/commit/ce2afef9b8511cacf473dc395997611354dd768f", "message": "consolidating assembly region arguments", "committedDate": "2020-02-05T15:02:13Z", "type": "commit"}, {"oid": "6894bb8f36cfc88b4ff1506fbadd80e21a31c09b", "url": "https://github.com/broadinstitute/gatk/commit/6894bb8f36cfc88b4ff1506fbadd80e21a31c09b", "message": "Making the different types of padding more transparent", "committedDate": "2020-02-05T15:02:16Z", "type": "commit"}, {"oid": "400cfb32cb19931131cab213fd8912e2d9e9d68f", "url": "https://github.com/broadinstitute/gatk/commit/400cfb32cb19931131cab213fd8912e2d9e9d68f", "message": "read start edge case", "committedDate": "2020-02-05T15:02:16Z", "type": "commit"}, {"oid": "7c4079a88d19be8993fed97aeb36d9b6a6dab9c4", "url": "https://github.com/broadinstitute/gatk/commit/7c4079a88d19be8993fed97aeb36d9b6a6dab9c4", "message": "smarter, STR-aware padding for genotyping", "committedDate": "2020-02-05T15:02:16Z", "type": "commit"}, {"oid": "454333928a6977c43a133e63f8ddf0bd62ba43f8", "url": "https://github.com/broadinstitute/gatk/commit/454333928a6977c43a133e63f8ddf0bd62ba43f8", "message": "Update tests", "committedDate": "2020-02-05T15:06:06Z", "type": "commit"}, {"oid": "457734c3fc7ba4da390135c331dccb551ab5a6a1", "url": "https://github.com/broadinstitute/gatk/commit/457734c3fc7ba4da390135c331dccb551ab5a6a1", "message": "review edits", "committedDate": "2020-02-05T15:06:09Z", "type": "commit"}, {"oid": "0cade93b8a32e2da6f7f9ebd16a37a5485f507a7", "url": "https://github.com/broadinstitute/gatk/commit/0cade93b8a32e2da6f7f9ebd16a37a5485f507a7", "message": "reconciling test files after rebase", "committedDate": "2020-02-05T15:31:04Z", "type": "commit"}, {"oid": "0cade93b8a32e2da6f7f9ebd16a37a5485f507a7", "url": "https://github.com/broadinstitute/gatk/commit/0cade93b8a32e2da6f7f9ebd16a37a5485f507a7", "message": "reconciling test files after rebase", "committedDate": "2020-02-05T15:31:04Z", "type": "forcePushed"}, {"oid": "3107b40b03941b396c4cf4c3e7f255170b9e8101", "url": "https://github.com/broadinstitute/gatk/commit/3107b40b03941b396c4cf4c3e7f255170b9e8101", "message": "wdl extra args", "committedDate": "2020-02-05T16:54:29Z", "type": "commit"}]}