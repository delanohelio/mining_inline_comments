{"pr_number": 6969, "pr_title": "support for multiple PET/VETs", "pr_createdAt": "2020-11-19T14:16:46Z", "pr_url": "https://github.com/broadinstitute/gatk/pull/6969", "timeline": [{"oid": "d4e53fb7da427531084188783ffbea78c665d836", "url": "https://github.com/broadinstitute/gatk/commit/d4e53fb7da427531084188783ffbea78c665d836", "message": "support for multiple PET/VETs", "committedDate": "2020-11-19T14:12:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjkyNTM4MQ==", "url": "https://github.com/broadinstitute/gatk/pull/6969#discussion_r526925381", "bodyText": "Does Cromwell wait until the full scatter of CreateImportTsvs is complete? Or will this run as soon as the first shard is done?", "author": "meganshand", "createdAt": "2020-11-19T14:23:41Z", "path": "scripts/variantstore/wdl/ImportGenomes.wdl", "diffHunk": "@@ -43,50 +46,76 @@ workflow ImportGenomes {\n     }\n   }\n \n-  call LoadData as LoadMetadataTsvs{\n-    input:\n-      done = CreateImportTsvs.done[0],\n-      project_id = project_id,\n-      dataset_name = dataset_name,\n-      storage_location = output_directory,\n-      datatype = \"metadata\",\n-      numbered = \"false\",\n-      partitioned = \"false\",\n-      table_id = table_id,\n-      schema = metadata_schema,\n-      preemptible_tries = preemptible_tries,\n-      docker = docker_final\n-  }\n+  scatter (i in range(GetMaxTableId.max_table_id)) {\n+    call LoadData as LoadMetadataTsvs{\n+      input:\n+        done = CreateImportTsvs.done[0],\n+        project_id = project_id,\n+        dataset_name = dataset_name,\n+        storage_location = output_directory,\n+        datatype = \"metadata\",\n+        numbered = \"false\",\n+        partitioned = \"false\",\n+        table_id = i + 1,\n+        schema = metadata_schema,\n+        preemptible_tries = preemptible_tries,\n+        docker = docker_final\n+    }\n \n     call LoadData as LoadPetTsvs{\n-    input:\n-      done = CreateImportTsvs.done[0],\n-      project_id = project_id,\n-      dataset_name = dataset_name,\n-      storage_location = output_directory,\n-      datatype = \"pet\",\n-      table_id = table_id,\n-      schema = pet_schema,\n-      preemptible_tries = preemptible_tries,\n-      docker = docker_final\n+      input:\n+        done = CreateImportTsvs.done[0],", "originalCommit": "d4e53fb7da427531084188783ffbea78c665d836", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjk0Nzg4Mw==", "url": "https://github.com/broadinstitute/gatk/pull/6969#discussion_r526947883", "bodyText": "I didn't change this -- so I assumed it was doing the right thing before (it does seem to wait) but I wonder if instead if \"done\" should be an array of all the inputs?   @ahaessly how did you arrive at this solution?", "author": "kcibul", "createdAt": "2020-11-19T14:52:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjkyNTM4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjk5Mjk2MA==", "url": "https://github.com/broadinstitute/gatk/pull/6969#discussion_r526992960", "bodyText": "@kcibul i think that when i used done, it was just a true/false that was set at the end of a task. i don't think i used it after a scatter. but i think passing the array would be safest. i guess we would change the input param to be an Array of String? (if it's an array of file, we should set the meta param for localizationOptional to true so it doesn't try to localize them all)", "author": "ahaessly", "createdAt": "2020-11-19T15:48:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjkyNTM4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA1MjM4OA==", "url": "https://github.com/broadinstitute/gatk/pull/6969#discussion_r527052388", "bodyText": "Yeah I agree, we should pass in the whole Array.", "author": "meganshand", "createdAt": "2020-11-19T17:05:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjkyNTM4MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjkyNjcyMg==", "url": "https://github.com/broadinstitute/gatk/pull/6969#discussion_r526926722", "bodyText": "Does this still fail with a nice error message if there's no dataset? (Nice enough that I'll realize I forgot to make one)", "author": "meganshand", "createdAt": "2020-11-19T14:25:25Z", "path": "scripts/variantstore/wdl/ImportGenomes.wdl", "diffHunk": "@@ -178,10 +207,6 @@ task LoadData {\n \n   command <<<\n     set -x\n-    set +e\n-    # make sure dataset exists\n-    bq ls --project_id ~{project_id} ~{dataset_name} > /dev/null", "originalCommit": "d4e53fb7da427531084188783ffbea78c665d836", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjkzNjY2NA==", "url": "https://github.com/broadinstitute/gatk/pull/6969#discussion_r526936664", "bodyText": "I removed this because later on when you go to make the table, it fails will a clear error message if the dataset doesn't exist", "author": "kcibul", "createdAt": "2020-11-19T14:38:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjkyNjcyMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjkyOTg1NQ==", "url": "https://github.com/broadinstitute/gatk/pull/6969#discussion_r526929855", "bodyText": "Why does loading the data need so much disk? Isn't it just importing what's in a separate google bucket?", "author": "meganshand", "createdAt": "2020-11-19T14:29:34Z", "path": "scripts/variantstore/wdl/ImportGenomes.wdl", "diffHunk": "@@ -230,8 +264,8 @@ task LoadData {\n   >>>\n   runtime {\n     docker: docker\n-    memory: \"4 GB\"\n-    disks: \"local-disk 10 HDD\"\n+    memory: \"10 GB\"\n+    disks: \"local-disk 1000 HDD\"", "originalCommit": "d4e53fb7da427531084188783ffbea78c665d836", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjkzNjE5Nw==", "url": "https://github.com/broadinstitute/gatk/pull/6969#discussion_r526936197", "bodyText": "no idea -- I changed it to match Terra, but you're right.  I'm going to change it back :D", "author": "kcibul", "createdAt": "2020-11-19T14:37:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjkyOTg1NQ=="}], "type": "inlineReview"}, {"oid": "6b93ec6b84be36b1cc3c7295449a58274e718de4", "url": "https://github.com/broadinstitute/gatk/commit/6b93ec6b84be36b1cc3c7295449a58274e718de4", "message": "PR comments", "committedDate": "2020-11-19T14:39:39Z", "type": "commit"}, {"oid": "4e0f4e004c210b4d712b80018604f45bf4ac2547", "url": "https://github.com/broadinstitute/gatk/commit/4e0f4e004c210b4d712b80018604f45bf4ac2547", "message": "fixed to use latest GATK JAR, eliminate odd java NoSuchMethod error", "committedDate": "2020-11-19T20:34:22Z", "type": "commit"}, {"oid": "868c6521188a51b2a49684bb8e79a038ac2c1846", "url": "https://github.com/broadinstitute/gatk/commit/868c6521188a51b2a49684bb8e79a038ac2c1846", "message": "PR feedback", "committedDate": "2020-11-19T20:38:03Z", "type": "commit"}]}