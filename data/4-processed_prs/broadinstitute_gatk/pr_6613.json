{"pr_number": 6613, "pr_title": "DetermineGermlineContigPloidy can now process interval lists with a single contig", "pr_createdAt": "2020-05-20T17:12:38Z", "pr_url": "https://github.com/broadinstitute/gatk/pull/6613", "timeline": [{"oid": "1c922071a8753e6a3b22f4e0c196d7d251f15227", "url": "https://github.com/broadinstitute/gatk/commit/1c922071a8753e6a3b22f4e0c196d7d251f15227", "message": "DetermineGermlineContigPloidy can now process interval lists with a single contig", "committedDate": "2020-05-20T17:09:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODI4MzA3NQ==", "url": "https://github.com/broadinstitute/gatk/pull/6613#discussion_r428283075", "bodyText": "Actually, despite our back and forth on Slack, I'm not convinced there's a good argument either way for\ntt.switch(tt.eq(mu_den_sjk, 0.0), 0.0, mu_num_sjk / mu_den_sjk)\nvs.\ntt.switch(tt.eq(mu_den_sjk, 0.0), 1.0, mu_num_sjk / mu_den_sjk).\nIn the first, we heavily penalize the k = 0 case by saying the Poisson rate is eps_mapping * n_s, whereas the likelihood is flat and the Poisson rate is n_s for k > 0.  In the second, the likelihood is flat and the Poisson rate is n_s for all k.\nTo me, it seems strange to treat k = 0 specially.  So I think I might actually favor the second.  But in either case, in practice (where k = 0 is already heavily penalized by the prior), inference is completely determined by the prior, since mean bias and ploidy cancel out of the likelihood.\nAnd in any case, we should check behavior with some simple tests to make sure we've got things straight!", "author": "samuelklee", "createdAt": "2020-05-20T20:17:54Z", "path": "src/main/python/org/broadinstitute/hellbender/gcnvkernel/models/model_ploidy.py", "diffHunk": "@@ -252,7 +252,10 @@ def __init__(self,\n                       * ploidy_k.dimshuffle('x', 'x', 0))\n         mu_den_sjk = gamma_rest_sj.dimshuffle(0, 1, 'x') + mu_num_sjk\n         eps_mapping_j = eps_mapping * t_j / tt.sum(t_j)  # average number of reads erroneously mapped to contig j\n-        mu_sjk = ((1.0 - eps_mapping) * (mu_num_sjk / mu_den_sjk)\n+\n+        # the switch is required for a single contig edge case\n+        mu_ratio_sjk = tt.switch(tt.eq(mu_den_sjk, 0.0), 0.0, mu_num_sjk / mu_den_sjk)", "originalCommit": "1c922071a8753e6a3b22f4e0c196d7d251f15227", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "48f240530e333513551aa577821816d6c2da3265", "url": "https://github.com/broadinstitute/gatk/commit/48f240530e333513551aa577821816d6c2da3265", "message": "Added warning and documentation notes", "committedDate": "2020-05-20T22:21:12Z", "type": "commit"}]}