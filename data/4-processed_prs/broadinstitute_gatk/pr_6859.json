{"pr_number": 6859, "pr_title": "Fix to quality score calculation for sites with spanning deletions", "pr_createdAt": "2020-10-01T19:00:28Z", "pr_url": "https://github.com/broadinstitute/gatk/pull/6859", "timeline": [{"oid": "fca9609ba4314e5d37380585c45b50ab0ebebd21", "url": "https://github.com/broadinstitute/gatk/commit/fca9609ba4314e5d37380585c45b50ab0ebebd21", "message": "update HaplotypeCallerSparkIntegrationTest result file", "committedDate": "2020-10-14T14:16:37Z", "type": "forcePushed"}, {"oid": "2a4263bf78679135f7748742bc6964e494e22393", "url": "https://github.com/broadinstitute/gatk/commit/2a4263bf78679135f7748742bc6964e494e22393", "message": "fix off-by one error that was causing the qual calculation to miss probability assigned to homozygous star allele genotypes", "committedDate": "2020-10-23T13:17:57Z", "type": "commit"}, {"oid": "0e7733e1c0b243bd706c0a3fb54317e3a9d456d3", "url": "https://github.com/broadinstitute/gatk/commit/0e7733e1c0b243bd706c0a3fb54317e3a9d456d3", "message": "update intgration test files", "committedDate": "2020-10-23T13:18:12Z", "type": "commit"}, {"oid": "5ad032d07fcfa5431a1a8d2b54a45b82862aceb0", "url": "https://github.com/broadinstitute/gatk/commit/5ad032d07fcfa5431a1a8d2b54a45b82862aceb0", "message": "add update expected results option", "committedDate": "2020-10-23T13:18:12Z", "type": "commit"}, {"oid": "ec9311375a0172e162e9b381ac7dcab72c89dc74", "url": "https://github.com/broadinstitute/gatk/commit/ec9311375a0172e162e9b381ac7dcab72c89dc74", "message": "updates to handle the case where the only alleles are ref and star", "committedDate": "2020-10-23T13:18:12Z", "type": "commit"}, {"oid": "ed6de8d4c606352fa5aaa58b51a183639f0dddd1", "url": "https://github.com/broadinstitute/gatk/commit/ed6de8d4c606352fa5aaa58b51a183639f0dddd1", "message": "update expected result files for GenotypeGVCFsIntegrationTest", "committedDate": "2020-10-23T13:18:12Z", "type": "commit"}, {"oid": "31f6ae7399430c7704102944428bc0785dba66ab", "url": "https://github.com/broadinstitute/gatk/commit/31f6ae7399430c7704102944428bc0785dba66ab", "message": "make sure we output all sites if forceOutput it true", "committedDate": "2020-10-23T13:18:13Z", "type": "commit"}, {"oid": "2c15d8e36760988b91e3f26775c2d4d893767235", "url": "https://github.com/broadinstitute/gatk/commit/2c15d8e36760988b91e3f26775c2d4d893767235", "message": "update HaplotypeCallerSparkIntegrationTest result file", "committedDate": "2020-10-23T13:18:13Z", "type": "commit"}, {"oid": "2c15d8e36760988b91e3f26775c2d4d893767235", "url": "https://github.com/broadinstitute/gatk/commit/2c15d8e36760988b91e3f26775c2d4d893767235", "message": "update HaplotypeCallerSparkIntegrationTest result file", "committedDate": "2020-10-23T13:18:13Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzU2MzQyMA==", "url": "https://github.com/broadinstitute/gatk/pull/6859#discussion_r513563420", "bodyText": "I understand why the HaplotypeCaller outputs changed at SpanningDeletion sites. What about these files? This one looks like it has neither spanning deletions to genotype nor has its input file changed.  Can you explain why there was so much jitter with the old outputs?", "author": "jamesemery", "createdAt": "2020-10-28T15:58:58Z", "path": "src/test/resources/org/broadinstitute/hellbender/tools/walkers/GenotypeGVCFs/AS_Annotations.gatk3.7_30_ga4f720357.expected.vcf", "diffHunk": "@@ -133,29 +133,28 @@\n ##contig=<ID=GL000192.1,length=547496>\n ##contig=<ID=NC_007605,length=171823>\n ##reference=file:///seq/references/Homo_sapiens_assembly19/v1/Homo_sapiens_assembly19.fasta\n-##source=GenotypeGVCFs\n #CHROM\tPOS\tID\tREF\tALT\tQUAL\tFILTER\tINFO\tFORMAT\tNA12878\n-20\t10087820\t.\tC\tCAG\t294.64\t.\tAC=1;AF=0.500;AN=2;AS_BaseQRankSum=-2.100;AS_FS=2.811;AS_MQ=60.00;AS_MQRankSum=0.600;AS_QD=6.15;AS_ReadPosRankSum=-0.400;AS_SOR=1.147;BaseQRankSum=-2.273e+00;DP=93;ExcessHet=3.0103;FS=4.432;MLEAC=1;MLEAF=0.500;MQ=59.55;MQRankSum=0.678;QD=6.14;RAW_MQ=329810.00;ReadPosRankSum=-4.920e-01;SOR=1.302\tGT:AD:GQ:PL\t0/1:35,13:99:302,0,1079", "originalCommit": "2c15d8e36760988b91e3f26775c2d4d893767235", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzYwMTkyNw==", "url": "https://github.com/broadinstitute/gatk/pull/6859#discussion_r513601927", "bodyText": "No, I have no idea. The behavior of HaplotypeCaller must have changed slightly over time to create this jitter without a corresponding update to the integration test files. These changes of e.g. 0.03 or 0.04 to qual score didn't cause the test to fail, I think given the DEFAULT_FLOAT_TOLERANCE in BaseTest. Since I added automatic update of expected test results to the GenotypeGVCFsIntegrationTest, the jitter was passed along to the expected files in this PR. If there's a historical reason that we need to preserve these test files exactly as is, I can revert the automatic-update feature in the test and manually update only the files that have spanning deletion in them -- otherwise I think updating them to account for current jitter is the price of implementing an auto-update.", "author": "cwhelan", "createdAt": "2020-10-28T16:47:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzU2MzQyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzY0MjA1MA==", "url": "https://github.com/broadinstitute/gatk/pull/6859#discussion_r513642050", "bodyText": "Ahh that makes a lot of sense. In that case \ud83d\udc4d", "author": "jamesemery", "createdAt": "2020-10-28T17:43:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzU2MzQyMA=="}], "type": "inlineReview"}]}