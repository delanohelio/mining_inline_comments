{"pr_number": 409, "pr_title": "fix(auth): Ensuring test user account cleanup with a Rule", "pr_createdAt": "2020-05-11T23:02:00Z", "pr_url": "https://github.com/firebase/firebase-admin-java/pull/409", "timeline": [{"oid": "b466fc6cf7ddfc6d84660eef6619602182a2833f", "url": "https://github.com/firebase/firebase-admin-java/commit/b466fc6cf7ddfc6d84660eef6619602182a2833f", "message": "fix(auth): Ensuring test user account cleanup with a Rule", "committedDate": "2020-05-11T22:58:52Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzM3MzQ1MA==", "url": "https://github.com/firebase/firebase-admin-java/pull/409#discussion_r423373450", "bodyText": "Copyright 2020 Google LLC", "author": "micahstairs", "createdAt": "2020-05-11T23:18:53Z", "path": "src/test/java/com/google/firebase/auth/TenantManagerIT.java", "diffHunk": "@@ -0,0 +1,155 @@\n+/*\n+ * Copyright 2020 Google Inc.", "originalCommit": "b466fc6cf7ddfc6d84660eef6619602182a2833f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzk0Nzg3NQ==", "url": "https://github.com/firebase/firebase-admin-java/pull/409#discussion_r423947875", "bodyText": "Done", "author": "hiranya911", "createdAt": "2020-05-12T18:32:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzM3MzQ1MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzM5OTAyNQ==", "url": "https://github.com/firebase/firebase-admin-java/pull/409#discussion_r423399025", "bodyText": "Are you planning on adding a similar rule for tenants or should I take care of that?", "author": "micahstairs", "createdAt": "2020-05-12T00:43:40Z", "path": "src/test/java/com/google/firebase/auth/FirebaseAuthIT.java", "diffHunk": "@@ -80,13 +81,11 @@\n   private static final HttpTransport transport = Utils.getDefaultTransport();\n   private static final String ACTION_LINK_CONTINUE_URL = \"http://localhost/?a=1&b=2#c=3\";\n \n-  private static FirebaseAuth auth;\n+  private static final FirebaseAuth auth = FirebaseAuth.getInstance(\n+      IntegrationTestUtils.ensureDefaultApp());\n \n-  @BeforeClass\n-  public static void setUpClass() {\n-    FirebaseApp masterApp = IntegrationTestUtils.ensureDefaultApp();\n-    auth = FirebaseAuth.getInstance(masterApp);\n-  }\n+  @Rule\n+  public final TemporaryUser temporaryUser = new TemporaryUser();", "originalCommit": "b466fc6cf7ddfc6d84660eef6619602182a2833f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzc4ODcyNg==", "url": "https://github.com/firebase/firebase-admin-java/pull/409#discussion_r423788726", "bodyText": "I might as well do it so that we don't step on each others' toes. I'm also planning on doing this for the provider configs.", "author": "micahstairs", "createdAt": "2020-05-12T14:40:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzM5OTAyNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzk0NzM0MQ==", "url": "https://github.com/firebase/firebase-admin-java/pull/409#discussion_r423947341", "bodyText": "I didn't find that many instances where we create and delete provider configs. But if that's something we do repeatedly, then might be useful to make a similar change.", "author": "hiranya911", "createdAt": "2020-05-12T18:31:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzM5OTAyNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzk2MzU3MQ==", "url": "https://github.com/firebase/firebase-admin-java/pull/409#discussion_r423963571", "bodyText": "It's not only a matter of reducing how many times we repeat the setup/cleanup. As it currently stands, if an assertion fails right after creating the provider config, it hasn't entered the \"try\" block yet, so the \"finally\" won't be executed. So we would either need to extend the try block back further, or we can use temporary provider configs. The temporary objects are nice because it is less of a burden on the developer writing integration tests, and it reduces the required nesting.", "author": "micahstairs", "createdAt": "2020-05-12T18:59:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzM5OTAyNQ=="}], "type": "inlineReview"}, {"oid": "cfd3fee44f81ad797a2c7f48b466a65484c29ef7", "url": "https://github.com/firebase/firebase-admin-java/commit/cfd3fee44f81ad797a2c7f48b466a65484c29ef7", "message": "Updated copyright holder", "committedDate": "2020-05-12T18:32:13Z", "type": "commit"}]}