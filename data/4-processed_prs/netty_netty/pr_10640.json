{"pr_number": 10640, "pr_title": "Fix possible bugs in HTTP/2 Codec", "pr_createdAt": "2020-10-06T07:18:14Z", "pr_url": "https://github.com/netty/netty/pull/10640", "timeline": [{"oid": "51a0af605ffbc80de1de9bc012e226cee638e18f", "url": "https://github.com/netty/netty/commit/51a0af605ffbc80de1de9bc012e226cee638e18f", "message": "fix possible bugs", "committedDate": "2020-10-06T07:01:37Z", "type": "commit"}, {"oid": "74e9af11f36413e49b218a78ef37fea7c350866e", "url": "https://github.com/netty/netty/commit/74e9af11f36413e49b218a78ef37fea7c350866e", "message": "add return statement for null `name`", "committedDate": "2020-10-06T07:14:50Z", "type": "commit"}, {"oid": "75447260c2e262798c85e49f7a7eca63856684db", "url": "https://github.com/netty/netty/commit/75447260c2e262798c85e49f7a7eca63856684db", "message": "check array size before accessing it to prevent array out of bound exception", "committedDate": "2020-10-06T08:13:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA5NTY4NA==", "url": "https://github.com/netty/netty/pull/10640#discussion_r503095684", "bodyText": "nit: revert... this is not needed", "author": "normanmaurer", "createdAt": "2020-10-12T07:39:28Z", "path": "codec-http2/src/main/java/io/netty/handler/codec/http2/DefaultHttp2Headers.java", "diffHunk": "@@ -43,6 +43,7 @@ public void validateName(CharSequence name) {\n             if (name == null || name.length() == 0) {\n                 PlatformDependent.throwException(connectionError(PROTOCOL_ERROR,\n                         \"empty headers are not allowed [%s]\", name));\n+                return;", "originalCommit": "75447260c2e262798c85e49f7a7eca63856684db", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA5NTg3NA==", "url": "https://github.com/netty/netty/pull/10640#discussion_r503095874", "bodyText": "nit revert formatting changes", "author": "normanmaurer", "createdAt": "2020-10-12T07:39:54Z", "path": "codec-http2/src/main/java/io/netty/handler/codec/http2/DefaultHttp2Headers.java", "diffHunk": "@@ -58,14 +59,14 @@ public void validateName(CharSequence name) {\n                 }\n \n                 if (index != -1) {\n-                    PlatformDependent.throwException(connectionError(PROTOCOL_ERROR,\n-                            \"invalid header name [%s]\", name));\n+                    PlatformDependent.throwException(connectionError(PROTOCOL_ERROR, \"invalid header name [%s]\",\n+                            name));", "originalCommit": "75447260c2e262798c85e49f7a7eca63856684db", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "7d52aa162b7940ce7a29ecdf962d300adf73c0b9", "url": "https://github.com/netty/netty/commit/7d52aa162b7940ce7a29ecdf962d300adf73c0b9", "message": "Revert formatting", "committedDate": "2020-10-12T07:41:44Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA5NjAxNA==", "url": "https://github.com/netty/netty/pull/10640#discussion_r503096014", "bodyText": "nit revert formatting changes", "author": "normanmaurer", "createdAt": "2020-10-12T07:40:07Z", "path": "codec-http2/src/main/java/io/netty/handler/codec/http2/DefaultHttp2Headers.java", "diffHunk": "@@ -58,14 +59,14 @@ public void validateName(CharSequence name) {\n                 }\n \n                 if (index != -1) {\n-                    PlatformDependent.throwException(connectionError(PROTOCOL_ERROR,\n-                            \"invalid header name [%s]\", name));\n+                    PlatformDependent.throwException(connectionError(PROTOCOL_ERROR, \"invalid header name [%s]\",\n+                            name));\n                 }\n             } else {\n                 for (int i = 0; i < name.length(); ++i) {\n                     if (isUpperCase(name.charAt(i))) {\n-                        PlatformDependent.throwException(connectionError(PROTOCOL_ERROR,\n-                                \"invalid header name [%s]\", name));\n+                        PlatformDependent.throwException(connectionError(PROTOCOL_ERROR, \"invalid header name [%s]\",\n+                                name));", "originalCommit": "75447260c2e262798c85e49f7a7eca63856684db", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA5NjkyMw==", "url": "https://github.com/netty/netty/pull/10640#discussion_r503096923", "bodyText": "revert... I think this still needs to remain here.", "author": "normanmaurer", "createdAt": "2020-10-12T07:41:36Z", "path": "codec-http2/src/main/java/io/netty/handler/codec/http2/ReadOnlyHttp2Headers.java", "diffHunk": "@@ -823,12 +823,14 @@ private void calculateNext() {\n             for (; i < current.length; i += 2) {\n                 AsciiString roName = current[i];\n                 if (roName.hashCode() == nameHash && roName.contentEqualsIgnoreCase(name)) {\n-                    next = current[i + 1];\n-                    i += 2;\n+                    if (i + 1 < current.length) {\n+                        next = current[i + 1];\n+                        i += 2;\n+                    }\n                     return;\n                 }\n             }\n-            if (i >= current.length && current == pseudoHeaders) {\n+            if (current == pseudoHeaders) {", "originalCommit": "75447260c2e262798c85e49f7a7eca63856684db", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA5NzUyNw==", "url": "https://github.com/netty/netty/pull/10640#discussion_r503097527", "bodyText": "LGTM and IDE both give warnings for always true.", "author": "hyperxpro", "createdAt": "2020-10-12T07:42:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA5NjkyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzEwMDI1Mw==", "url": "https://github.com/netty/netty/pull/10640#discussion_r503100253", "bodyText": "https://lgtm.com/projects/g/netty/netty/snapshot/a2994f5265f7bd7c4bf206d95b643a3c68d4f3c3/files/codec-http2/src/main/java/io/netty/handler/codec/http2/ReadOnlyHttp2Headers.java?sort=name&dir=ASC&mode=heatmap#xe38ef04bb58e4:1\n\nWhat to do?", "author": "hyperxpro", "createdAt": "2020-10-12T07:47:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA5NjkyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzEwMjgxNQ==", "url": "https://github.com/netty/netty/pull/10640#discussion_r503102815", "bodyText": "fine then...", "author": "normanmaurer", "createdAt": "2020-10-12T07:52:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA5NjkyMw=="}], "type": "inlineReview"}, {"oid": "25b060765311c575463e18141b7d3e4a81a3f85d", "url": "https://github.com/netty/netty/commit/25b060765311c575463e18141b7d3e4a81a3f85d", "message": "Revert more", "committedDate": "2020-10-12T07:43:46Z", "type": "commit"}]}