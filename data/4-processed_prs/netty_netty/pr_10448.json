{"pr_number": 10448, "pr_title": "Fix DnsNameResolver may have LEAK ByteBuf after cancelling the return\u2026", "pr_createdAt": "2020-08-02T04:59:56Z", "pr_url": "https://github.com/netty/netty/pull/10448", "timeline": [{"oid": "e55a40de3cb1e370294ca25b949ed22d4380889b", "url": "https://github.com/netty/netty/commit/e55a40de3cb1e370294ca25b949ed22d4380889b", "message": "Fix DnsNameResolver may have LEAK ByteBuf after cancelling the returned future\n\nMotivation:\n\nIf we cancel the returned future of resolve query, we may get LEAK. Try to release the ByteBuf if netty can't pass the DnsRawRecord to the caller.", "committedDate": "2020-08-02T05:06:54Z", "type": "commit"}, {"oid": "e55a40de3cb1e370294ca25b949ed22d4380889b", "url": "https://github.com/netty/netty/commit/e55a40de3cb1e370294ca25b949ed22d4380889b", "message": "Fix DnsNameResolver may have LEAK ByteBuf after cancelling the returned future\n\nMotivation:\n\nIf we cancel the returned future of resolve query, we may get LEAK. Try to release the ByteBuf if netty can't pass the DnsRawRecord to the caller.", "committedDate": "2020-08-02T05:06:54Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDAzMjUwNg==", "url": "https://github.com/netty/netty/pull/10448#discussion_r464032506", "bodyText": "Should I remove the content of finalResult? Also, I'm not sure if finalResult will be reused or not.", "author": "kojilin", "createdAt": "2020-08-02T05:08:41Z", "path": "resolver-dns/src/main/java/io/netty/resolver/dns/DnsResolveContext.java", "diffHunk": "@@ -966,7 +971,12 @@ private void finishResolve(Promise<List<T>> promise, Throwable cause) {\n         if (finalResult != null) {\n             if (!promise.isDone()) {\n                 // Found at least one resolved record.\n-                DnsNameResolver.trySuccess(promise, filterResults(finalResult));\n+                final List<T> result = filterResults(finalResult);\n+                if (!DnsNameResolver.trySuccess(promise, result)) {\n+                    for (T item : result) {\n+                        ReferenceCountUtil.safeRelease(item);", "originalCommit": "e55a40de3cb1e370294ca25b949ed22d4380889b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDA5ODM3OQ==", "url": "https://github.com/netty/netty/pull/10448#discussion_r464098379", "bodyText": "its fine to just keep it...", "author": "normanmaurer", "createdAt": "2020-08-02T16:42:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDAzMjUwNg=="}], "type": "inlineReview"}]}