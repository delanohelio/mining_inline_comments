{"pr_number": 10689, "pr_title": "Fix or suppress LGTM findings", "pr_createdAt": "2020-10-15T08:27:46Z", "pr_url": "https://github.com/netty/netty/pull/10689", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTM2MDU5MA==", "url": "https://github.com/netty/netty/pull/10689#discussion_r505360590", "bodyText": "why was this changed ?", "author": "normanmaurer", "createdAt": "2020-10-15T08:49:31Z", "path": "transport-native-epoll/src/main/java/io/netty/channel/epoll/EpollEventArray.java", "diffHunk": "@@ -109,7 +109,8 @@ int fd(int index) {\n \n     private int getInt(int index, int offset) {\n         if (PlatformDependent.hasUnsafe()) {\n-            return PlatformDependent.getInt(memoryAddress + index * EPOLL_EVENT_SIZE + offset);\n+            long n = index * EPOLL_EVENT_SIZE;\n+            return PlatformDependent.getInt(memoryAddress + n + offset);", "originalCommit": "809427182ac8cefcbb5133e310e453a97850258b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTQyMjgwNA==", "url": "https://github.com/netty/netty/pull/10689#discussion_r505422804", "bodyText": "LGTM reports a potential integer overflow for index * EPOL_EVENT_SIZE:\nhttps://lgtm.com/projects/g/netty/netty/snapshot/46cad8a5db67884faf2f41f99ed3a74ffa3735f9/files/transport-native-epoll/src/main/java/io/netty/channel/epoll/EpollEventArray.java?sort=name&dir=ASC&mode=heatmap#x3b93cf5f22ba2792:1\nI should have converted index and the constant to long as well. Now it's fixed.", "author": "artem-smotrakov", "createdAt": "2020-10-15T10:08:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTM2MDU5MA=="}], "type": "inlineReview"}, {"oid": "018fb936d906997d5323b7171f23ed0f2885c142", "url": "https://github.com/netty/netty/commit/018fb936d906997d5323b7171f23ed0f2885c142", "message": "Fix or suppress LGTM findings\n\nMotivation:\n\nLGTM reports multiple issues. They need to be triaged,\nand real ones should be fixed.\n\nModifications:\n- Fixed multiple issues reported by LGTM, such as redundant conditions,\n  resource leaks, typos, possible integer overflows.\n- Suppressed false-positives.\n- Added a few testcases.\n\nResult:\n\nFixed several possible issues, get rid of false alarms in the LGTM report.", "committedDate": "2020-10-15T10:07:33Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTQ5MzQyMg==", "url": "https://github.com/netty/netty/pull/10689#discussion_r505493422", "bodyText": "I think we should throw if closed is true as otherwise we may create a new instance that is never closed again .", "author": "normanmaurer", "createdAt": "2020-10-15T12:17:08Z", "path": "buffer/src/main/java/io/netty/buffer/ByteBufOutputStream.java", "diffHunk": "@@ -133,7 +134,8 @@ public void writeShort(int v) throws IOException {\n     public void writeUTF(String s) throws IOException {\n         DataOutputStream out = utf8out;\n         if (out == null) {\n-            utf8out = out = new DataOutputStream(this);\n+            // Suppress a warning since the stream is closed in the close() method\n+            utf8out = out = new DataOutputStream(this); // lgtm[java/output-resource-leak]", "originalCommit": "018fb936d906997d5323b7171f23ed0f2885c142", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTQ5MzY5NQ==", "url": "https://github.com/netty/netty/pull/10689#discussion_r505493695", "bodyText": "move this in a finally block ?", "author": "normanmaurer", "createdAt": "2020-10-15T12:17:37Z", "path": "buffer/src/main/java/io/netty/buffer/ByteBufOutputStream.java", "diffHunk": "@@ -144,4 +146,17 @@ public void writeUTF(String s) throws IOException {\n     public ByteBuf buffer() {\n         return buffer;\n     }\n+\n+    @Override\n+    public void close() throws IOException {\n+        if (closed) {\n+            return;\n+        }\n+        closed = true;\n+\n+        super.close();\n+        if (utf8out != null) {\n+            utf8out.close();", "originalCommit": "018fb936d906997d5323b7171f23ed0f2885c142", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "157ee2a8029c70cc9cc26356c3abeb913724fca6", "url": "https://github.com/netty/netty/commit/157ee2a8029c70cc9cc26356c3abeb913724fca6", "message": "Fix or suppress LGTM findings\n\nMotivation:\n\nLGTM reports multiple issues. They need to be triaged,\nand real ones should be fixed.\n\nModifications:\n- Fixed multiple issues reported by LGTM, such as redundant conditions,\n  resource leaks, typos, possible integer overflows.\n- Suppressed false-positives.\n- Added a few testcases.\n\nResult:\n\nFixed several possible issues, get rid of false alarms in the LGTM report.", "committedDate": "2020-10-15T12:37:21Z", "type": "commit"}, {"oid": "157ee2a8029c70cc9cc26356c3abeb913724fca6", "url": "https://github.com/netty/netty/commit/157ee2a8029c70cc9cc26356c3abeb913724fca6", "message": "Fix or suppress LGTM findings\n\nMotivation:\n\nLGTM reports multiple issues. They need to be triaged,\nand real ones should be fixed.\n\nModifications:\n- Fixed multiple issues reported by LGTM, such as redundant conditions,\n  resource leaks, typos, possible integer overflows.\n- Suppressed false-positives.\n- Added a few testcases.\n\nResult:\n\nFixed several possible issues, get rid of false alarms in the LGTM report.", "committedDate": "2020-10-15T12:37:21Z", "type": "forcePushed"}]}