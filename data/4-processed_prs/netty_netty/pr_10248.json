{"pr_number": 10248, "pr_title": "Don't reuse ChannelPromise in WebSocketProtocolHandler", "pr_createdAt": "2020-05-05T10:10:41Z", "pr_url": "https://github.com/netty/netty/pull/10248", "timeline": [{"oid": "3aaea4874ce4659709dcd53b9a496502b8a37491", "url": "https://github.com/netty/netty/commit/3aaea4874ce4659709dcd53b9a496502b8a37491", "message": "Don't reuse ChannelPromise in WebSocketProtocolHandler\n\nMotivation:\n\nWe cant reuse the ChannelPromise as it will cause an error when trying to ful-fill it multiple times.\n\nModifications:\n\n- Use a new promise and chain it with the old one\n- Add unit test\n\nResult:\n\nFixes https://github.com/netty/netty/issues/10240", "committedDate": "2020-05-05T10:11:57Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDIwNzE5Ng==", "url": "https://github.com/netty/netty/pull/10248#discussion_r420207196", "bodyText": "do we need to unvoid..?", "author": "johnou", "createdAt": "2020-05-05T15:39:27Z", "path": "codec-http/src/main/java/io/netty/handler/codec/http/websocketx/WebSocketProtocolHandler.java", "diffHunk": "@@ -110,13 +111,12 @@ public void write(final ChannelHandlerContext ctx, Object msg, ChannelPromise pr\n         if (closeSent != null) {\n             ReferenceCountUtil.release(msg);\n             promise.setFailure(new ClosedChannelException());\n-            return;\n-        }\n-        if (msg instanceof CloseWebSocketFrame) {\n-            promise = promise.unvoid();\n+        } else if (msg instanceof CloseWebSocketFrame) {\n             closeSent = promise;", "originalCommit": "3aaea4874ce4659709dcd53b9a496502b8a37491", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDIxMDczOQ==", "url": "https://github.com/netty/netty/pull/10248#discussion_r420210739", "bodyText": "Yeah lets do it...", "author": "normanmaurer", "createdAt": "2020-05-05T15:44:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDIwNzE5Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDIwODMwMQ==", "url": "https://github.com/netty/netty/pull/10248#discussion_r420208301", "bodyText": "@normanmaurer do we risk an NPE here? https://github.com/netty/netty/pull/10248/files#diff-1eb10f9889aa482b57792f4cb001aa2dL99", "author": "johnou", "createdAt": "2020-05-05T15:40:51Z", "path": "codec-http/src/main/java/io/netty/handler/codec/http/websocketx/WebSocketProtocolHandler.java", "diffHunk": "@@ -110,13 +111,12 @@ public void write(final ChannelHandlerContext ctx, Object msg, ChannelPromise pr\n         if (closeSent != null) {\n             ReferenceCountUtil.release(msg);\n             promise.setFailure(new ClosedChannelException());\n-            return;", "originalCommit": "3aaea4874ce4659709dcd53b9a496502b8a37491", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDIwOTI3OQ==", "url": "https://github.com/netty/netty/pull/10248#discussion_r420209279", "bodyText": "", "author": "johnou", "createdAt": "2020-05-05T15:42:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDIwODMwMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDIxMDU0Mw==", "url": "https://github.com/netty/netty/pull/10248#discussion_r420210543", "bodyText": "nope as write will set closeSent I think ?", "author": "normanmaurer", "createdAt": "2020-05-05T15:44:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDIwODMwMQ=="}], "type": "inlineReview"}, {"oid": "652df83821e4be57955769b3dbafedbc1a73b33b", "url": "https://github.com/netty/netty/commit/652df83821e4be57955769b3dbafedbc1a73b33b", "message": "Don't reuse ChannelPromise in WebSocketProtocolHandler\n\nMotivation:\n\nWe cant reuse the ChannelPromise as it will cause an error when trying to ful-fill it multiple times.\n\nModifications:\n\n- Use a new promise and chain it with the old one\n- Add unit test\n\nResult:\n\nFixes https://github.com/netty/netty/issues/10240", "committedDate": "2020-05-05T16:05:27Z", "type": "commit"}, {"oid": "652df83821e4be57955769b3dbafedbc1a73b33b", "url": "https://github.com/netty/netty/commit/652df83821e4be57955769b3dbafedbc1a73b33b", "message": "Don't reuse ChannelPromise in WebSocketProtocolHandler\n\nMotivation:\n\nWe cant reuse the ChannelPromise as it will cause an error when trying to ful-fill it multiple times.\n\nModifications:\n\n- Use a new promise and chain it with the old one\n- Add unit test\n\nResult:\n\nFixes https://github.com/netty/netty/issues/10240", "committedDate": "2020-05-05T16:05:27Z", "type": "forcePushed"}]}