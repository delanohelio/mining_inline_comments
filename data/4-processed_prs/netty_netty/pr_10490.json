{"pr_number": 10490, "pr_title": "Expose a LoggingDnsQueryLifeCycleObserverFactory", "pr_createdAt": "2020-08-19T13:37:34Z", "pr_url": "https://github.com/netty/netty/pull/10490", "timeline": [{"oid": "d1f3b63cf0130679797ecb9cc5eb8f6025ceb5fc", "url": "https://github.com/netty/netty/commit/d1f3b63cf0130679797ecb9cc5eb8f6025ceb5fc", "message": "Expose a LoggingDnsQueryLifeCycleObserverFactory\n\nMotivation:\n There is a use case for having logging in the DnsNameResolver, similar to the LoggingHandler.\n Previously, one could set `traceEnabled` on the DnsNameResolverBuilder, but this is not very configurable.\n Specifically, the log level and the logger context cannot be changed.\n\nModification:\n Expose a LoggingDnsQueryLifeCycleObserverFactory, that permit changing the log-level\n and logger context.\n\nResult:\n It is now possible to get logging in the DnsNameResolver at a custom log level and logger,\n without very much effort.\n\nFixes #10485", "committedDate": "2020-08-19T13:32:29Z", "type": "commit"}, {"oid": "c4f599a7a158a8624e1be364195316204709aaf5", "url": "https://github.com/netty/netty/commit/c4f599a7a158a8624e1be364195316204709aaf5", "message": "Fix PR comments", "committedDate": "2020-08-19T13:44:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzEwMDY3Nw==", "url": "https://github.com/netty/netty/pull/10490#discussion_r473100677", "bodyText": "Is there any particular concern to use checkNotNull  instead of requireNonNull. The latter is used in the version for Netty 5.", "author": "violetagg", "createdAt": "2020-08-19T15:05:31Z", "path": "resolver-dns/src/main/java/io/netty/resolver/dns/LoggingDnsQueryLifeCycleObserverFactory.java", "diffHunk": "@@ -0,0 +1,85 @@\n+/*\n+ * Copyright 2020 The Netty Project\n+ *\n+ * The Netty Project licenses this file to you under the Apache License,\n+ * version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package io.netty.resolver.dns;\n+\n+import io.netty.handler.codec.dns.DnsQuestion;\n+import io.netty.handler.logging.LogLevel;\n+import io.netty.util.internal.logging.InternalLogLevel;\n+import io.netty.util.internal.logging.InternalLogger;\n+import io.netty.util.internal.logging.InternalLoggerFactory;\n+\n+import static io.netty.util.internal.ObjectUtil.checkNotNull;\n+\n+/**\n+ * A {@link DnsQueryLifecycleObserverFactory} that enables detailed logging in the {@link DnsNameResolver}.\n+ * <p>\n+ * When {@linkplain DnsNameResolverBuilder#dnsQueryLifecycleObserverFactory(DnsQueryLifecycleObserverFactory)\n+ * configured on the resolver}, detailed trace information will be generated so that it is easier to understand the\n+ * cause of resolution failure.\n+ */\n+public final class LoggingDnsQueryLifeCycleObserverFactory implements DnsQueryLifecycleObserverFactory {\n+    private static final InternalLogger DEFAULT_LOGGER =\n+            InternalLoggerFactory.getInstance(LoggingDnsQueryLifeCycleObserverFactory.class);\n+    private final InternalLogger logger;\n+    private final InternalLogLevel level;\n+\n+    /**\n+     * Create {@link DnsQueryLifecycleObserver} instances that log events at the default {@link LogLevel#DEBUG} level.\n+     */\n+    public LoggingDnsQueryLifeCycleObserverFactory() {\n+        this(LogLevel.DEBUG);\n+    }\n+\n+    /**\n+     * Create {@link DnsQueryLifecycleObserver} instances that log events at the given log level.\n+     * @param level The log level to use for logging resolver events.\n+     */\n+    public LoggingDnsQueryLifeCycleObserverFactory(LogLevel level) {\n+        this.level = checkAndConvertLevel(level);\n+        logger = DEFAULT_LOGGER;\n+    }\n+\n+    /**\n+     * Create {@link DnsQueryLifecycleObserver} instances that log events to a logger with the given class context,\n+     * at the given log level.\n+     * @param classContext The class context for the logger to use.\n+     * @param level The log level to use for logging resolver events.\n+     */\n+    public LoggingDnsQueryLifeCycleObserverFactory(Class<?> classContext, LogLevel level) {\n+        this.level = checkAndConvertLevel(level);\n+        logger = InternalLoggerFactory.getInstance(checkNotNull(classContext, \"classContext\"));", "originalCommit": "c4f599a7a158a8624e1be364195316204709aaf5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzEwNDA0NQ==", "url": "https://github.com/netty/netty/pull/10490#discussion_r473104045", "bodyText": "Because it not depends on java8!", "author": "normanmaurer", "createdAt": "2020-08-19T15:10:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzEwMDY3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzEwNTQxNw==", "url": "https://github.com/netty/netty/pull/10490#discussion_r473105417", "bodyText": "ops ... true", "author": "violetagg", "createdAt": "2020-08-19T15:12:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzEwMDY3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzExMDAyMQ==", "url": "https://github.com/netty/netty/pull/10490#discussion_r473110021", "bodyText": "Netty 4.1 needs to support Java 6 at runtime where requireNonNull is not available.", "author": "chrisvest", "createdAt": "2020-08-19T15:18:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzEwMDY3Nw=="}], "type": "inlineReview"}]}