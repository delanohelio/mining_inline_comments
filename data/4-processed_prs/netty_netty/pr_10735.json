{"pr_number": 10735, "pr_title": "Use netty-jni-util and so remove a lot of duplication", "pr_createdAt": "2020-10-27T12:56:13Z", "pr_url": "https://github.com/netty/netty/pull/10735", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjY2OTEzMg==", "url": "https://github.com/netty/netty/pull/10735#discussion_r512669132", "bodyText": "Before we merge this one we should tag a version for netty-jni-util and use it. I just wanted to verify first that it works for netty and netty-tcnative", "author": "normanmaurer", "createdAt": "2020-10-27T12:57:47Z", "path": "transport-native-unix-common/pom.xml", "diffHunk": "@@ -46,6 +48,31 @@\n \n   <build>\n     <plugins>\n+      <!-- Download the netty-jni-util source -->\n+      <plugin>\n+        <artifactId>maven-scm-plugin</artifactId>\n+        <version>1.11.2</version>\n+        <executions>\n+          <execution>\n+            <id>get-netty-jni-util</id>\n+            <phase>generate-sources</phase>\n+            <goals>\n+              <goal>checkout</goal>\n+            </goals>\n+            <configuration>\n+              <checkoutDirectory>${jniUtilCheckoutDir}</checkoutDirectory>\n+              <connectionType>developerConnection</connectionType>\n+              <developerConnectionUrl>scm:git:https://github.com/netty/netty-jni-util.git</developerConnectionUrl>\n+              <!-- TODO: Change this to a release tag once we did a release -->\n+              <scmVersion>main</scmVersion>", "originalCommit": "41a2560cc40178383a76c3dd3b2a7fe55692ec1a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzczMTkyNA==", "url": "https://github.com/netty/netty/pull/10735#discussion_r513731924", "bodyText": "looks like this changed to NETTY_JNI_UTIL_BUILD_STATIC? be sure to call this out in release notes.", "author": "Scottmitch", "createdAt": "2020-10-28T20:14:33Z", "path": "transport-native-kqueue/src/main/c/netty_kqueue_native.c", "diffHunk": "@@ -381,69 +379,26 @@ static void netty_kqueue_native_JNI_OnUnLoad(JNIEnv* env, const char* staticPack\n     netty_kqueue_eventarray_JNI_OnUnLoad(env, staticPackagePrefix);\n }\n \n-static jint JNI_OnLoad_netty_transport_native_kqueue0(JavaVM* vm, void* reserved) {\n-    JNIEnv* env;\n-    if ((*vm)->GetEnv(vm, (void**) &env, NETTY_JNI_VERSION) != JNI_OK) {\n-        return JNI_ERR;\n-    }\n-\n-    char* packagePrefix = NULL;\n-#ifndef NETTY_BUILD_STATIC", "originalCommit": "c850877af159f6f3f8d9b17c83ca50a34c75b67d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDEyMTY1Mw==", "url": "https://github.com/netty/netty/pull/10735#discussion_r514121653", "bodyText": "I did ensure to define  NETTY_JNI_UTIL_BUILD_STATIC if NETTY_BUILD_STATIC is defined . so it will just work as before", "author": "normanmaurer", "createdAt": "2020-10-29T09:35:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzczMTkyNA=="}], "type": "inlineReview"}, {"oid": "cc3c97c195ec67d0c7ec6fef968228be71e46cfa", "url": "https://github.com/netty/netty/commit/cc3c97c195ec67d0c7ec6fef968228be71e46cfa", "message": "Use netty-jni-util and so remove a lot of duplication\n\nMotivation:\n\nWe had a lot of duplication in our jni code which was mostly due macros but also related to how we support shading. By using netty-jni-util we can share all the code between netty and netty-tcnative ( and possible other jni based netty projects in the future).\n\nModifications:\n\n- Use netty-jni-util and re-use its macros / functions\n- Remove duplicated code\n- Adjust build files\n\nResult:\n\nLess code duplication for JNI", "committedDate": "2020-10-29T13:43:02Z", "type": "commit"}, {"oid": "cc3c97c195ec67d0c7ec6fef968228be71e46cfa", "url": "https://github.com/netty/netty/commit/cc3c97c195ec67d0c7ec6fef968228be71e46cfa", "message": "Use netty-jni-util and so remove a lot of duplication\n\nMotivation:\n\nWe had a lot of duplication in our jni code which was mostly due macros but also related to how we support shading. By using netty-jni-util we can share all the code between netty and netty-tcnative ( and possible other jni based netty projects in the future).\n\nModifications:\n\n- Use netty-jni-util and re-use its macros / functions\n- Remove duplicated code\n- Adjust build files\n\nResult:\n\nLess code duplication for JNI", "committedDate": "2020-10-29T13:43:02Z", "type": "forcePushed"}]}