{"pr_number": 932, "pr_title": "AF-2432 :  Restoring an old asset version doesn't work outside master branch", "pr_createdAt": "2020-03-23T09:21:28Z", "pr_url": "https://github.com/kiegroup/appformer/pull/932", "timeline": [{"oid": "21181efe317ad2ec3d3ce9277be3f3ad6368a33e", "url": "https://github.com/kiegroup/appformer/commit/21181efe317ad2ec3d3ce9277be3f3ad6368a33e", "message": "AF-2432 :  Restoring an old asset version doesn't work outside master branch\n\n * Added CurrentBranch class to track current modifying branch in editor", "committedDate": "2020-03-23T18:31:48Z", "type": "forcePushed"}, {"oid": "b462e717972ee5271722583a6a029f9b68bcfdfe", "url": "https://github.com/kiegroup/appformer/commit/b462e717972ee5271722583a6a029f9b68bcfdfe", "message": "AF-2432 :  Restoring an old asset version doesn't work outside master branch\n\n * Added CurrentBranch class to track current modifying branch in editor", "committedDate": "2020-03-24T06:14:49Z", "type": "forcePushed"}, {"oid": "14c81f2e0e1e5f8a5792bdfdf430bf14a0d52d26", "url": "https://github.com/kiegroup/appformer/commit/14c81f2e0e1e5f8a5792bdfdf430bf14a0d52d26", "message": "AF-2432 :  Restoring an old asset version doesn't work outside master branch\n\n * Added CurrentBranch class to track current modifying branch in editor", "committedDate": "2020-03-24T09:06:21Z", "type": "forcePushed"}, {"oid": "3b5d629140fe77eb7a82823e576e99868e0d5ab4", "url": "https://github.com/kiegroup/appformer/commit/3b5d629140fe77eb7a82823e576e99868e0d5ab4", "message": "AF-2432 :  Restoring an old asset version doesn't work outside master branch\n\n * Added CurrentBranch class to track current modifying branch in editor", "committedDate": "2020-03-31T05:50:36Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjE3ODI3OQ==", "url": "https://github.com/kiegroup/appformer/pull/932#discussion_r402178279", "bodyText": "please make this filed static", "author": "sthundat", "createdAt": "2020-04-02T09:32:11Z", "path": "uberfire-extensions/uberfire-commons-editor/uberfire-commons-editor-client/src/main/java/org/uberfire/ext/editor/commons/client/menu/common/CurrentBranchImpl.java", "diffHunk": "@@ -0,0 +1,28 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.uberfire.ext.editor.commons.client.menu.common;\n+\n+public class CurrentBranchImpl implements CurrentBranch {\n+\n+    private final String DEFAULT_BRANCH = \"master\";", "originalCommit": "3b5d629140fe77eb7a82823e576e99868e0d5ab4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjE5NDg5MQ==", "url": "https://github.com/kiegroup/appformer/pull/932#discussion_r402194891", "bodyText": "Done", "author": "akumar074", "createdAt": "2020-04-02T09:59:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjE3ODI3OQ=="}], "type": "inlineReview"}, {"oid": "cc3e4d0bec1baf57d9db51bec3959bc5d80db524", "url": "https://github.com/kiegroup/appformer/commit/cc3e4d0bec1baf57d9db51bec3959bc5d80db524", "message": "AF-2432 :  Restoring an old asset version doesn't work outside master branch\n\n * Added CurrentBranch class to track current modifying branch in editor", "committedDate": "2020-04-02T09:58:12Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQyODQyNQ==", "url": "https://github.com/kiegroup/appformer/pull/932#discussion_r402428425", "bodyText": "Can we use this method instead to get the target path?\n\n  \n    \n      appformer/uberfire-extensions/uberfire-commons-editor/uberfire-commons-editor-backend/src/main/java/org/uberfire/ext/editor/commons/backend/version/VersionUtil.java\n    \n    \n         Line 49\n      in\n      ae323c0\n    \n    \n    \n    \n\n        \n          \n           public Path getPath(Path path, \n        \n    \n  \n\n\nThe version parameter would be the branch name.", "author": "caponetto", "createdAt": "2020-04-02T16:01:24Z", "path": "uberfire-extensions/uberfire-commons-editor/uberfire-commons-editor-backend/src/main/java/org/uberfire/ext/editor/commons/backend/version/VersionServiceImpl.java", "diffHunk": "@@ -70,12 +70,14 @@ public Path getPathToPreviousVersion(String uri) {\n \n     @Override\n     public Path restore(final Path _path,\n-                        final String comment) {\n+                        final String comment,\n+                        final String currentBranch) {\n         try {\n             ioService.startBatch(Paths.convert(_path).getFileSystem());\n \n             final org.uberfire.java.nio.file.Path path = pathResolver.resolveMainFilePath(convert(_path));\n-            final org.uberfire.java.nio.file.Path target = path.getFileSystem().getPath(path.toString());\n+            final org.uberfire.java.nio.file.Path target = path.getFileSystem().getPath(currentBranch,", "originalCommit": "cc3e4d0bec1baf57d9db51bec3959bc5d80db524", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDA2NjUyOA==", "url": "https://github.com/kiegroup/appformer/pull/932#discussion_r404066528", "bodyText": "This is a good suggestion. I have changed the use of getPath from FS to VersionUtil. We can get the same target path now.", "author": "akumar074", "createdAt": "2020-04-06T12:53:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQyODQyNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQzMDkyNA==", "url": "https://github.com/kiegroup/appformer/pull/932#discussion_r402430924", "bodyText": "I'd go with branchName instead of currentBranch for the variable name because this service method could be used on other situations where the given branch is not the current one. Same applies to the interface.", "author": "caponetto", "createdAt": "2020-04-02T16:05:02Z", "path": "uberfire-extensions/uberfire-commons-editor/uberfire-commons-editor-backend/src/main/java/org/uberfire/ext/editor/commons/backend/version/VersionServiceImpl.java", "diffHunk": "@@ -70,12 +70,14 @@ public Path getPathToPreviousVersion(String uri) {\n \n     @Override\n     public Path restore(final Path _path,\n-                        final String comment) {\n+                        final String comment,\n+                        final String currentBranch) {", "originalCommit": "cc3e4d0bec1baf57d9db51bec3959bc5d80db524", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDA3MzAxNw==", "url": "https://github.com/kiegroup/appformer/pull/932#discussion_r404073017", "bodyText": "I agree branchName would be more appropriate for other situations.", "author": "akumar074", "createdAt": "2020-04-06T13:03:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQzMDkyNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQzOTE5OA==", "url": "https://github.com/kiegroup/appformer/pull/932#discussion_r402439198", "bodyText": "Consider putting this new parameter in a new line, just to follow the pattern.", "author": "caponetto", "createdAt": "2020-04-02T16:17:01Z", "path": "uberfire-extensions/uberfire-commons-editor/uberfire-commons-editor-client/src/main/java/org/uberfire/ext/editor/commons/client/menu/BasicFileMenuBuilder.java", "diffHunk": "@@ -77,7 +78,7 @@ BasicFileMenuBuilder addCopy(final PathProvider provider,\n \n     BasicFileMenuBuilder addValidate(final Command command);\n \n-    BasicFileMenuBuilder addRestoreVersion(final Path path);\n+    BasicFileMenuBuilder addRestoreVersion(final Path path, final CurrentBranch currentBranch);", "originalCommit": "cc3e4d0bec1baf57d9db51bec3959bc5d80db524", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDA3MzE5MQ==", "url": "https://github.com/kiegroup/appformer/pull/932#discussion_r404073191", "bodyText": "Done.", "author": "akumar074", "createdAt": "2020-04-06T13:04:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQzOTE5OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQzOTM5Nw==", "url": "https://github.com/kiegroup/appformer/pull/932#discussion_r402439397", "bodyText": "Consider putting this new parameter in a new line, just to follow the pattern.", "author": "caponetto", "createdAt": "2020-04-02T16:17:19Z", "path": "uberfire-extensions/uberfire-commons-editor/uberfire-commons-editor-client/src/main/java/org/uberfire/ext/editor/commons/client/menu/BasicFileMenuBuilderImpl.java", "diffHunk": "@@ -343,8 +344,8 @@ public BasicFileMenuBuilder addValidate(final Command validateCommand) {\n     }\n \n     @Override\n-    public BasicFileMenuBuilder addRestoreVersion(final Path path) {\n-        this.restoreCommand = restoreVersionCommandProvider.getCommand(path);\n+    public BasicFileMenuBuilder addRestoreVersion(final Path path, final CurrentBranch currentBranch) {", "originalCommit": "cc3e4d0bec1baf57d9db51bec3959bc5d80db524", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDA3MzI4Nw==", "url": "https://github.com/kiegroup/appformer/pull/932#discussion_r404073287", "bodyText": "Done.", "author": "akumar074", "createdAt": "2020-04-06T13:04:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQzOTM5Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQ0MzcyMA==", "url": "https://github.com/kiegroup/appformer/pull/932#discussion_r402443720", "bodyText": "Consider annotating this class with @FallbackImplementation.\nI understood this implementation is the fallback in case the other implementation from kie-wb-common is not found.", "author": "caponetto", "createdAt": "2020-04-02T16:23:50Z", "path": "uberfire-extensions/uberfire-commons-editor/uberfire-commons-editor-client/src/main/java/org/uberfire/ext/editor/commons/client/menu/common/CurrentBranchImpl.java", "diffHunk": "@@ -0,0 +1,28 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.uberfire.ext.editor.commons.client.menu.common;\n+\n+public class CurrentBranchImpl implements CurrentBranch {", "originalCommit": "cc3e4d0bec1baf57d9db51bec3959bc5d80db524", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDA3NTA3Mw==", "url": "https://github.com/kiegroup/appformer/pull/932#discussion_r404075073", "bodyText": "Thanks @caponetto for this one. I was unaware of this annotation. It is really helpful.", "author": "akumar074", "createdAt": "2020-04-06T13:07:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQ0MzcyMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQ0NjQzNQ==", "url": "https://github.com/kiegroup/appformer/pull/932#discussion_r402446435", "bodyText": "I guess you don't need this method since you are injecting the CurrentBranch on VersionRecordManager.", "author": "caponetto", "createdAt": "2020-04-02T16:28:05Z", "path": "uberfire-extensions/uberfire-commons-editor/uberfire-commons-editor-client/src/main/java/org/uberfire/ext/editor/commons/client/BaseEditor.java", "diffHunk": "@@ -792,4 +793,8 @@ public VersionRecordManager getVersionRecordManager() {\n     public void setMetadataOriginalHash(final Integer metadataOriginalHash) {\n         this.metadataOriginalHash = metadataOriginalHash;\n     }\n+\n+    public void setCurrentBranch(final CurrentBranch currentBranch) {\n+        versionRecordManager.setCurrentBranch(currentBranch);\n+    }", "originalCommit": "cc3e4d0bec1baf57d9db51bec3959bc5d80db524", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDA3NTQ5MQ==", "url": "https://github.com/kiegroup/appformer/pull/932#discussion_r404075491", "bodyText": "Removed from the VersionRecordManager class.", "author": "akumar074", "createdAt": "2020-04-06T13:07:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQ0NjQzNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQ0ODEwOQ==", "url": "https://github.com/kiegroup/appformer/pull/932#discussion_r402448109", "bodyText": "I guess you don't need this method since you are injecting the CurrentBranch on VersionRecordManager.", "author": "caponetto", "createdAt": "2020-04-02T16:30:24Z", "path": "uberfire-extensions/uberfire-commons-editor/uberfire-commons-editor-client/src/main/java/org/uberfire/ext/editor/commons/client/history/VersionRecordManager.java", "diffHunk": "@@ -296,6 +302,14 @@ private void onRestore(final @Observes RestoreEvent restore) {\n         }\n     }\n \n+    public void setCurrentBranch(final CurrentBranch currentBranch) {\n+        this.currentBranch = currentBranch;\n+    }\n+\n+    public CurrentBranch getCurrentBranch() {\n+        return currentBranch;\n+    }\n+", "originalCommit": "cc3e4d0bec1baf57d9db51bec3959bc5d80db524", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDA3NTU3OA==", "url": "https://github.com/kiegroup/appformer/pull/932#discussion_r404075578", "bodyText": "Removed from the VersionRecordManager class.", "author": "akumar074", "createdAt": "2020-04-06T13:07:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQ0ODEwOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQ1MTU2Ng==", "url": "https://github.com/kiegroup/appformer/pull/932#discussion_r402451566", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                                   getCurrentBranch());\n          \n          \n            \n                                                   this.currentBranch.getName());", "author": "caponetto", "createdAt": "2020-04-02T16:35:41Z", "path": "uberfire-extensions/uberfire-commons-editor/uberfire-commons-editor-client/src/main/java/org/uberfire/ext/editor/commons/client/history/VersionRecordManager.java", "diffHunk": "@@ -226,10 +230,12 @@ private VersionRecord getCurrentVersionRecord() {\n     public void restoreToCurrentVersion(boolean withComments) {\n         if (withComments)\n             restorePopUpPresenter.show(getCurrentPath(),\n-                                       getCurrentVersionRecordUri());\n+                                       getCurrentVersionRecordUri(),\n+                                       getCurrentBranch());", "originalCommit": "cc3e4d0bec1baf57d9db51bec3959bc5d80db524", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDA3NTczNg==", "url": "https://github.com/kiegroup/appformer/pull/932#discussion_r404075736", "bodyText": "Done.", "author": "akumar074", "createdAt": "2020-04-06T13:08:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQ1MTU2Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQ1MTcxMA==", "url": "https://github.com/kiegroup/appformer/pull/932#discussion_r402451710", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                                             getCurrentBranch())\n          \n          \n            \n                                                             this.currentBranch.getName())", "author": "caponetto", "createdAt": "2020-04-02T16:35:56Z", "path": "uberfire-extensions/uberfire-commons-editor/uberfire-commons-editor-client/src/main/java/org/uberfire/ext/editor/commons/client/history/VersionRecordManager.java", "diffHunk": "@@ -226,10 +230,12 @@ private VersionRecord getCurrentVersionRecord() {\n     public void restoreToCurrentVersion(boolean withComments) {\n         if (withComments)\n             restorePopUpPresenter.show(getCurrentPath(),\n-                                       getCurrentVersionRecordUri());\n+                                       getCurrentVersionRecordUri(),\n+                                       getCurrentBranch());\n         else {\n             restorePopUpPresenter.restoreCommand(getCurrentPath(),\n-                                                 getCurrentVersionRecordUri())\n+                                                 getCurrentVersionRecordUri(),\n+                                                 getCurrentBranch())", "originalCommit": "cc3e4d0bec1baf57d9db51bec3959bc5d80db524", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDA3NTgzNQ==", "url": "https://github.com/kiegroup/appformer/pull/932#discussion_r404075835", "bodyText": "Done.", "author": "akumar074", "createdAt": "2020-04-06T13:08:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQ1MTcxMA=="}], "type": "inlineReview"}, {"oid": "20c3f441bb295a00377f529ed2272bc2d192df0e", "url": "https://github.com/kiegroup/appformer/commit/20c3f441bb295a00377f529ed2272bc2d192df0e", "message": "AF-2432 :  Restoring an old asset version doesn't work outside master branch\n\n * Added CurrentBranch class to track current modifying branch in editor", "committedDate": "2020-04-06T12:37:53Z", "type": "forcePushed"}, {"oid": "cb1b66b4cb6a0098d4ad48b0506e03a5fbb52e3b", "url": "https://github.com/kiegroup/appformer/commit/cb1b66b4cb6a0098d4ad48b0506e03a5fbb52e3b", "message": "AF-2432 :  Restoring an old asset version doesn't work outside master branch\n\n * Added CurrentBranch class to track current modifying branch in editor", "committedDate": "2020-04-07T06:22:35Z", "type": "commit"}, {"oid": "cb1b66b4cb6a0098d4ad48b0506e03a5fbb52e3b", "url": "https://github.com/kiegroup/appformer/commit/cb1b66b4cb6a0098d4ad48b0506e03a5fbb52e3b", "message": "AF-2432 :  Restoring an old asset version doesn't work outside master branch\n\n * Added CurrentBranch class to track current modifying branch in editor", "committedDate": "2020-04-07T06:22:35Z", "type": "forcePushed"}]}