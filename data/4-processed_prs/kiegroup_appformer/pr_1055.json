{"pr_number": 1055, "pr_title": "AF-2638: Index page is not updated when changing models", "pr_createdAt": "2020-09-21T21:27:04Z", "pr_url": "https://github.com/kiegroup/appformer/pull/1055", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODkzNjU0MA==", "url": "https://github.com/kiegroup/appformer/pull/1055#discussion_r498936540", "bodyText": "Suggested change", "author": "caponetto", "createdAt": "2020-10-02T16:51:35Z", "path": "dashbuilder/dashbuilder-runtime/src/main/java/org/dashbuilder/client/perspective/generator/RuntimePerspectiveGenerator.java", "diffHunk": "@@ -50,10 +52,17 @@\n     private LayoutGenerator layoutGenerator;\n \n     public PerspectiveEditorActivity generatePerspective(LayoutTemplate layoutTemplate) {\n-        PerspectiveEditorScreenActivity screen = createNewScreen(layoutTemplate);\n-        return createNewPerspective(layoutTemplate, screen);\n+        if (isANewPerspective(layoutTemplate)) {\n+            PerspectiveEditorScreenActivity screen = createNewScreen(layoutTemplate);\n+            return createNewPerspective(layoutTemplate,\n+                                 screen);\n+        } else {\n+            PerspectiveEditorScreenActivity screen = updateScreen(layoutTemplate);\n+            return updatePerspective(layoutTemplate,\n+                              screen);\n+        }\n     }\n-\n+    ", "originalCommit": "ea45475968ab52800f64bfe8494b39e261333230", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODkzODUzMA==", "url": "https://github.com/kiegroup/appformer/pull/1055#discussion_r498938530", "bodyText": "Please indent this piece of code.", "author": "caponetto", "createdAt": "2020-10-02T16:55:39Z", "path": "dashbuilder/dashbuilder-runtime/src/main/java/org/dashbuilder/client/perspective/generator/RuntimePerspectiveGenerator.java", "diffHunk": "@@ -95,5 +104,28 @@ private PerspectiveEditorActivity createNewPerspective(LayoutTemplate perspectiv\n         activityBeansCache.addNewPerspectiveActivity(beanManager.lookupBeans(perspectiveName).iterator().next());\n         return activity;\n     }\n+    \n+    private PerspectiveEditorScreenActivity updateScreen(LayoutTemplate layoutTemplate) {\n+        final String perspectiveScreenId = PerspectiveEditorScreenActivity.buildScreenId(layoutTemplate.getName());\n+        final SyncBeanDef<Activity> activity = activityBeansCache.getActivity(perspectiveScreenId);\n+        final PerspectiveEditorScreenActivity screenActivity = (PerspectiveEditorScreenActivity) activity.getInstance();\n+        screenActivity.setLayoutTemplate(layoutTemplate);\n+        return screenActivity;\n+    }\n+    \n+    private PerspectiveEditorActivity updatePerspective(LayoutTemplate layoutTemplate,\n+                                                        PerspectiveEditorScreenActivity screen) {\n+                             final SyncBeanDef<Activity> activity = activityBeansCache.getActivity(layoutTemplate.getName());\n+                             final PerspectiveEditorActivity perspectiveEditorActivity = (PerspectiveEditorActivity) activity.getInstance();\n+                             perspectiveEditorActivity.update(layoutTemplate,\n+                                                              screen);\n+                             return perspectiveEditorActivity;\n+                         }", "originalCommit": "ea45475968ab52800f64bfe8494b39e261333230", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODkzOTEwNg==", "url": "https://github.com/kiegroup/appformer/pull/1055#discussion_r498939106", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    final IOCBeanDef<Activity> activity = activityBeansCache.getActivity(layoutTemplate.getName());\n          \n          \n            \n                    return activity == null;\n          \n          \n            \n                    return activityBeansCache.getActivity(layoutTemplate.getName()) == null;", "author": "caponetto", "createdAt": "2020-10-02T16:56:47Z", "path": "dashbuilder/dashbuilder-runtime/src/main/java/org/dashbuilder/client/perspective/generator/RuntimePerspectiveGenerator.java", "diffHunk": "@@ -95,5 +104,28 @@ private PerspectiveEditorActivity createNewPerspective(LayoutTemplate perspectiv\n         activityBeansCache.addNewPerspectiveActivity(beanManager.lookupBeans(perspectiveName).iterator().next());\n         return activity;\n     }\n+    \n+    private PerspectiveEditorScreenActivity updateScreen(LayoutTemplate layoutTemplate) {\n+        final String perspectiveScreenId = PerspectiveEditorScreenActivity.buildScreenId(layoutTemplate.getName());\n+        final SyncBeanDef<Activity> activity = activityBeansCache.getActivity(perspectiveScreenId);\n+        final PerspectiveEditorScreenActivity screenActivity = (PerspectiveEditorScreenActivity) activity.getInstance();\n+        screenActivity.setLayoutTemplate(layoutTemplate);\n+        return screenActivity;\n+    }\n+    \n+    private PerspectiveEditorActivity updatePerspective(LayoutTemplate layoutTemplate,\n+                                                        PerspectiveEditorScreenActivity screen) {\n+                             final SyncBeanDef<Activity> activity = activityBeansCache.getActivity(layoutTemplate.getName());\n+                             final PerspectiveEditorActivity perspectiveEditorActivity = (PerspectiveEditorActivity) activity.getInstance();\n+                             perspectiveEditorActivity.update(layoutTemplate,\n+                                                              screen);\n+                             return perspectiveEditorActivity;\n+                         }\n+    \n+    \n+    private boolean isANewPerspective(LayoutTemplate layoutTemplate) {\n+        final IOCBeanDef<Activity> activity = activityBeansCache.getActivity(layoutTemplate.getName());\n+        return activity == null;", "originalCommit": "ea45475968ab52800f64bfe8494b39e261333230", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "35129d34cbfb0894ee2f19503976881dd6cefe1d", "url": "https://github.com/kiegroup/appformer/commit/35129d34cbfb0894ee2f19503976881dd6cefe1d", "message": "AF-2638: Index page is not updated when changing models", "committedDate": "2020-10-05T16:13:43Z", "type": "commit"}, {"oid": "4b3cb98a5d69f99abe0f90d743beeada3c86694d", "url": "https://github.com/kiegroup/appformer/commit/4b3cb98a5d69f99abe0f90d743beeada3c86694d", "message": "Improvements", "committedDate": "2020-10-05T16:16:15Z", "type": "commit"}, {"oid": "4b3cb98a5d69f99abe0f90d743beeada3c86694d", "url": "https://github.com/kiegroup/appformer/commit/4b3cb98a5d69f99abe0f90d743beeada3c86694d", "message": "Improvements", "committedDate": "2020-10-05T16:16:15Z", "type": "forcePushed"}]}