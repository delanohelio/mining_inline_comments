{"pr_number": 2581, "pr_title": "Show pool/volume informations where possible", "pr_createdAt": "2020-09-08T15:47:40Z", "pr_url": "https://github.com/uyuni-project/uyuni/pull/2581", "timeline": [{"oid": "5a2bd4cf5d14534d3af446e5d9efba8e946f124b", "url": "https://github.com/uyuni-project/uyuni/commit/5a2bd4cf5d14534d3af446e5d9efba8e946f124b", "message": "Show pool/volume informations where possible\n\nAt least for Xen the disks of volume types aren't supported but\nconverted by Salt into their file or block equivalents. In order to show\nthe selected volume and pool when possible, try to get those\ninformations from Salt's virt.vm_info output.", "committedDate": "2020-09-22T09:34:02Z", "type": "forcePushed"}, {"oid": "81dbf23a97edfa190bef55fdaa96154dd7f5f6e2", "url": "https://github.com/uyuni-project/uyuni/commit/81dbf23a97edfa190bef55fdaa96154dd7f5f6e2", "message": "Fix the Xen tests disks handling\n\nSince Xen doesn't handle disk volumes, Salt generates the equivalent\nfile or block disk device.", "committedDate": "2020-09-23T06:56:17Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTEzNTMzNw==", "url": "https://github.com/uyuni-project/uyuni/pull/2581#discussion_r501135337", "bodyText": "Pattern is immutable so you could make it a static member of this class.", "author": "mateiw", "createdAt": "2020-10-07T16:08:11Z", "path": "java/code/src/com/suse/manager/virtualization/GuestDiskDef.java", "diffHunk": "@@ -216,6 +218,16 @@ else if (\"cdrom\".equals(disk.getDevice())) {\n                         source.put(\"file\", info.getFile());\n                     }\n                 }\n+                else if (Arrays.asList(\"block\", \"file\").contains(disk.getType())) {\n+                    Pattern regex = Pattern.compile(\"([^/]+)/([^/]+)\");", "originalCommit": "81dbf23a97edfa190bef55fdaa96154dd7f5f6e2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUwODUxNw==", "url": "https://github.com/uyuni-project/uyuni/pull/2581#discussion_r501508517", "bodyText": "done. Thanks for the suggestion", "author": "cbosdo", "createdAt": "2020-10-08T07:37:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTEzNTMzNw=="}], "type": "inlineReview"}, {"oid": "b3b2aa92a1f42d1b8975bed5407e624cebc06716", "url": "https://github.com/uyuni-project/uyuni/commit/b3b2aa92a1f42d1b8975bed5407e624cebc06716", "message": "fixup! Show pool/volume informations where possible", "committedDate": "2020-10-08T07:20:33Z", "type": "forcePushed"}, {"oid": "f8ae050f0b3e0a350dbd2bfc4ce3ad63ffd2a784", "url": "https://github.com/uyuni-project/uyuni/commit/f8ae050f0b3e0a350dbd2bfc4ce3ad63ffd2a784", "message": "Fix the Xen tests disks handling\n\nSince Xen doesn't handle disk volumes, Salt generates the equivalent\nfile or block disk device.", "committedDate": "2020-10-26T15:34:02Z", "type": "forcePushed"}, {"oid": "2104ab302b2e6ca24dece6dcc6a7f28a2af775c7", "url": "https://github.com/uyuni-project/uyuni/commit/2104ab302b2e6ca24dece6dcc6a7f28a2af775c7", "message": "Show pool/volume informations where possible\n\nAt least for Xen the disks of volume types aren't supported but\nconverted by Salt into their file or block equivalents. In order to show\nthe selected volume and pool when possible, try to get those\ninformations from Salt's virt.vm_info output.", "committedDate": "2020-10-27T13:23:35Z", "type": "commit"}, {"oid": "d953e2cb61e0ff0bf3f0dd422f10ce0b823d3b9d", "url": "https://github.com/uyuni-project/uyuni/commit/d953e2cb61e0ff0bf3f0dd422f10ce0b823d3b9d", "message": "Fix Xen spice graphical console test\n\nSpice only works on HVM virtual machines on Xen. Don't test spice on a\nPV guest. Also remove the spice choice in the UI for Xen PV and PVH\ncases.", "committedDate": "2020-10-27T13:23:35Z", "type": "forcePushed"}, {"oid": "cd68217da22a868fb1d2ab25c5212055324b340e", "url": "https://github.com/uyuni-project/uyuni/commit/cd68217da22a868fb1d2ab25c5212055324b340e", "message": "Fix Xen spice graphical console test\n\nSpice only works on HVM virtual machines on Xen. Don't test spice on a\nPV guest. Also remove the spice choice in the UI for Xen PV and PVH\ncases.", "committedDate": "2020-10-27T13:42:10Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjc1MzIzMg==", "url": "https://github.com/uyuni-project/uyuni/pull/2581#discussion_r512753232", "bodyText": "scsi is an abbreviation: SCSI", "author": "Bischoff", "createdAt": "2020-10-27T14:44:01Z", "path": "testsuite/features/secondary/minkvm_guests.feature", "diffHunk": "@@ -129,7 +129,7 @@ Feature: Be able to manage KVM virtual machines via the GUI\n     And \"test-vm\" virtual machine on \"kvm_server\" should have spice graphics device\n     And \"test-vm\" virtual machine on \"kvm_server\" should have 1 NIC using \"test-net1\" network\n     And \"test-vm\" virtual machine on \"kvm_server\" should have a NIC with 02:34:56:78:9a:bc MAC address\n-    And \"test-vm\" virtual machine on \"kvm_server\" should have a \"test-vm_disk.qcow2\" scsi disk\n+    And \"test-vm\" virtual machine on \"kvm_server\" should have a \"test-vm_disk.qcow2\" scsi disk from pool \"tmp\"", "originalCommit": "cd68217da22a868fb1d2ab25c5212055324b340e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjc2MjgxMw==", "url": "https://github.com/uyuni-project/uyuni/pull/2581#discussion_r512762813", "bodyText": "OK, I'll lowercase it in the step then", "author": "cbosdo", "createdAt": "2020-10-27T14:55:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjc1MzIzMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjc1Mzg2OA==", "url": "https://github.com/uyuni-project/uyuni/pull/2581#discussion_r512753868", "bodyText": "could be \"And\"", "author": "Bischoff", "createdAt": "2020-10-27T14:44:45Z", "path": "testsuite/features/secondary/minxen_guests.feature", "diffHunk": "@@ -192,21 +186,21 @@ Feature: Be able to manage XEN virtual machines via the GUI\n     And I enter \"512\" as \"memory\"\n     And I enter \"/var/testsuite-data/disk-image-template-xenpv.qcow2\" as \"disk0_source_template\"\n     And I select \"test-net0\" from \"network0_source\"\n-    And I select \"Spice\" from \"graphicsType\"\n+    And I select \"VNC\" from \"graphicsType\"\n     And I click on \"Create\"\n     Then I should see a \"Hosted Virtual Systems\" text\n     When I wait until I see \"test-vm2\" text\n     And I wait at most 500 seconds until table row for \"test-vm2\" contains button \"Stop\"\n     And \"test-vm2\" virtual machine on \"xen_server\" should have 512MB memory and 1 vcpus\n     And \"test-vm2\" virtual machine on \"xen_server\" should have 1 NIC using \"test-net0\" network\n-    And \"test-vm2\" virtual machine on \"xen_server\" should have a \"test-vm2_system\" xen disk from pool \"test-pool0\"\n+    And \"test-vm2\" virtual machine on \"xen_server\" should have a \"/var/lib/libvirt/images/test-pool0/test-vm2_system\" xen disk\n \n @virthost_xen\n-  Scenario: Show the Spice graphical console for Xen\n+  Scenario: Show the VNC graphical console for Xen\n     Given I am on the \"Virtualization\" page of this \"xen_server\"\n     When I click on \"Graphical Console\" in row \"test-vm2\"\n     And I switch to last opened window\n-    Then I wait until I see the spice graphical console\n+    Then I wait until I see the VNC graphical console", "originalCommit": "cd68217da22a868fb1d2ab25c5212055324b340e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjc2MzA2NQ==", "url": "https://github.com/uyuni-project/uyuni/pull/2581#discussion_r512763065", "bodyText": "OK", "author": "cbosdo", "createdAt": "2020-10-27T14:55:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjc1Mzg2OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjc1NDM2MQ==", "url": "https://github.com/uyuni-project/uyuni/pull/2581#discussion_r512754361", "bodyText": "\"Then\"", "author": "Bischoff", "createdAt": "2020-10-27T14:45:18Z", "path": "testsuite/features/secondary/minxen_guests.feature", "diffHunk": "@@ -218,13 +212,21 @@ Feature: Be able to manage XEN virtual machines via the GUI\n     And I enter \"512\" as \"memory\"\n     And I enter \"/var/testsuite-data/disk-image-template.qcow2\" as \"disk0_source_template\"\n     And I select \"test-net0\" from \"network0_source\"\n+    And I select \"Spice\" from \"graphicsType\"\n     And I click on \"Create\"\n     Then I should see a \"Hosted Virtual Systems\" text\n     When I wait until I see \"test-vm3\" text\n     And I wait at most 500 seconds until table row for \"test-vm3\" contains button \"Stop\"\n     And \"test-vm3\" virtual machine on \"xen_server\" should have 512MB memory and 1 vcpus", "originalCommit": "cd68217da22a868fb1d2ab25c5212055324b340e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjc2MzQxMQ==", "url": "https://github.com/uyuni-project/uyuni/pull/2581#discussion_r512763411", "bodyText": "That one is not new ;)", "author": "cbosdo", "createdAt": "2020-10-27T14:55:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjc1NDM2MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjc1NDYzMQ==", "url": "https://github.com/uyuni-project/uyuni/pull/2581#discussion_r512754631", "bodyText": "Could be \"And\"", "author": "Bischoff", "createdAt": "2020-10-27T14:45:37Z", "path": "testsuite/features/secondary/minxen_guests.feature", "diffHunk": "@@ -218,13 +212,21 @@ Feature: Be able to manage XEN virtual machines via the GUI\n     And I enter \"512\" as \"memory\"\n     And I enter \"/var/testsuite-data/disk-image-template.qcow2\" as \"disk0_source_template\"\n     And I select \"test-net0\" from \"network0_source\"\n+    And I select \"Spice\" from \"graphicsType\"\n     And I click on \"Create\"\n     Then I should see a \"Hosted Virtual Systems\" text\n     When I wait until I see \"test-vm3\" text\n     And I wait at most 500 seconds until table row for \"test-vm3\" contains button \"Stop\"\n     And \"test-vm3\" virtual machine on \"xen_server\" should have 512MB memory and 1 vcpus\n     And \"test-vm3\" virtual machine on \"xen_server\" should have 1 NIC using \"test-net0\" network\n-    And \"test-vm3\" virtual machine on \"xen_server\" should have a \"test-vm3_system\" xen disk from pool \"test-pool0\"\n+    And \"test-vm3\" virtual machine on \"xen_server\" should have a \"/var/lib/libvirt/images/test-pool0/test-vm3_system\" xen disk\n+\n+@virthost_xen\n+  Scenario: Show the Spice graphical console for Xen\n+    Given I am on the \"Virtualization\" page of this \"xen_server\"\n+    When I click on \"Graphical Console\" in row \"test-vm3\"\n+    And I switch to last opened window\n+    Then I wait until I see the spice graphical console", "originalCommit": "cd68217da22a868fb1d2ab25c5212055324b340e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjc2Nzc2OQ==", "url": "https://github.com/uyuni-project/uyuni/pull/2581#discussion_r512767769", "bodyText": "Actually, I prefer it as Then :D I think we agreed to don't consider the \"I wait until\" part, sometime in the past.", "author": "srbarrios", "createdAt": "2020-10-27T15:00:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjc1NDYzMQ=="}], "type": "inlineReview"}, {"oid": "a29f90b08bbdec839777808d663e8c3804bf565e", "url": "https://github.com/uyuni-project/uyuni/commit/a29f90b08bbdec839777808d663e8c3804bf565e", "message": "Fix the Xen tests disks handling\n\nSince Xen doesn't handle disk volumes, Salt generates the equivalent\nfile or block disk device.", "committedDate": "2020-10-27T15:08:15Z", "type": "commit"}, {"oid": "c66f519de2966d80cd4bf5660408a0b8180c3b8b", "url": "https://github.com/uyuni-project/uyuni/commit/c66f519de2966d80cd4bf5660408a0b8180c3b8b", "message": "Fix Xen spice graphical console test\n\nSpice only works on HVM virtual machines on Xen. Don't test spice on a\nPV guest. Also remove the spice choice in the UI for Xen PV and PVH\ncases.", "committedDate": "2020-10-27T15:08:15Z", "type": "commit"}, {"oid": "c66f519de2966d80cd4bf5660408a0b8180c3b8b", "url": "https://github.com/uyuni-project/uyuni/commit/c66f519de2966d80cd4bf5660408a0b8180c3b8b", "message": "Fix Xen spice graphical console test\n\nSpice only works on HVM virtual machines on Xen. Don't test spice on a\nPV guest. Also remove the spice choice in the UI for Xen PV and PVH\ncases.", "committedDate": "2020-10-27T15:08:15Z", "type": "forcePushed"}]}