{"pr_number": 1818, "pr_title": "Also check python[2]-Jinja when installing python2-salt at buildhosts", "pr_createdAt": "2020-01-22T08:28:28Z", "pr_url": "https://github.com/uyuni-project/uyuni/pull/1818", "timeline": [{"oid": "4babd416bee1d2c3549fe2657726b3b9f0b59421", "url": "https://github.com/uyuni-project/uyuni/commit/4babd416bee1d2c3549fe2657726b3b9f0b59421", "message": "Also check python[2]-Jinja when installing python2-salt at buildhosts", "committedDate": "2020-01-22T08:23:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQyNDc0Mg==", "url": "https://github.com/uyuni-project/uyuni/pull/1818#discussion_r369424742", "bodyText": "salt['pkg.info_available']('python-Jinja2', 'python2-Jinja2')\nSo it works with both SLE15 and SLE12:\nSLE-Module-Python2_15-SP1_x86_64/_channel:    <binary name=\"python2-Jinja2\" package=\"python-Jinja2\" supportstatus=\"l3\"/>\nSLE-Module-Basesystem_15_x86_64/_channel:    <binary name=\"python2-Jinja2\" package=\"python-Jinja2\" supportstatus=\"l3\"/>\nSLE-Manager-Tools_12_x86_64/_channel:    <binary package=\"python-Jinja2\"             name=\"python-Jinja2\"                    supportstatus=\"l3\"/>", "author": "juliogonzalez", "createdAt": "2020-01-22T08:33:11Z", "path": "susemanager-utils/susemanager-sls/salt/services/docker.sls", "diffHunk": "@@ -15,7 +15,7 @@ mgr_install_docker:\n {%- endif %}\n {%- if grains['saltversioninfo'][0] >= 2018 %}\n       - python3-salt\n-    {%- if salt['pkg.info_available']('python', 'python2') and salt['pkg.info_available']('python2-salt') %}\n+    {%- if salt['pkg.info_available']('python', 'python2') and salt['pkg.info_available']('python2-salt') and salt['pkg.info_available']('python-Jinja2', 'python2-Jinja2') %}", "originalCommit": "4babd416bee1d2c3549fe2657726b3b9f0b59421", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQyODcxNQ==", "url": "https://github.com/uyuni-project/uyuni/pull/1818#discussion_r369428715", "bodyText": "performance: maybe it's faster to do a series of nested {% ifs (I'm not sure that jinja short-circuits boolean expressions)\nother possibility: pkg.info_available takes several arguments. Are they joined with a OR or a AND? If it's a AND, you could list all packages in one single call\n\nMy 2 cents", "author": "Bischoff", "createdAt": "2020-01-22T08:42:45Z", "path": "susemanager-utils/susemanager-sls/salt/services/docker.sls", "diffHunk": "@@ -15,7 +15,7 @@ mgr_install_docker:\n {%- endif %}\n {%- if grains['saltversioninfo'][0] >= 2018 %}\n       - python3-salt\n-    {%- if salt['pkg.info_available']('python', 'python2') and salt['pkg.info_available']('python2-salt') %}\n+    {%- if salt['pkg.info_available']('python', 'python2') and salt['pkg.info_available']('python2-salt') and salt['pkg.info_available']('python-Jinja2', 'python2-Jinja2') %}", "originalCommit": "4babd416bee1d2c3549fe2657726b3b9f0b59421", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQzMDQ1NQ==", "url": "https://github.com/uyuni-project/uyuni/pull/1818#discussion_r369430455", "bodyText": "Seems to behave as an OR:\njuliogonzalez@juliogonzalez:~/Documents/development/obs/suse/Devel:Galaxy:Manager:Head/salt$ sudo salt-call --local pkg.info_available python pythonblah\nlocal:\n    ----------\n    python:\n        ----------\n        arch:\n            x86_64\n        installed:\n            True\n        installed size:\n            1.4 MiB\n        repository:\n            openSUSE-Leap-15.1-Update\n        source package:\n            python-2.7.14-lp151.10.13.1.src\n        status:\n            up-to-date\n        summary:\n            Python Interpreter\n        vendor:\n            openSUSE\n        version:\n            2.7.14-lp151.10.13.1\njuliogonzalez@juliogonzalez:~/Documents/development/obs/suse/Devel:Galaxy:Manager:Head/salt$ echo $?\n0", "author": "juliogonzalez", "createdAt": "2020-01-22T08:46:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQyODcxNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQzMjI2OQ==", "url": "https://github.com/uyuni-project/uyuni/pull/1818#discussion_r369432269", "bodyText": "Apparently it's a OR, so you can forget second suggestion", "author": "Bischoff", "createdAt": "2020-01-22T08:51:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQyODcxNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQzNDQ0MA==", "url": "https://github.com/uyuni-project/uyuni/pull/1818#discussion_r369434440", "bodyText": "As for the if even if jinja doesn't short-circuits boolean expressions, I think having nested ifs make things easier to understand. Will change it.", "author": "juliogonzalez", "createdAt": "2020-01-22T08:56:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQyODcxNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQzNjgyOQ==", "url": "https://github.com/uyuni-project/uyuni/pull/1818#discussion_r369436829", "bodyText": "After trying, nesting seems to things harder to understand, so let's keep it as it is.", "author": "juliogonzalez", "createdAt": "2020-01-22T09:01:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQyODcxNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQ3ODExNg==", "url": "https://github.com/uyuni-project/uyuni/pull/1818#discussion_r369478116", "bodyText": "I think the interpreter should evaluate the first statement and only if this is true the next statement is executed. So I would suggest to put the Jinja test first.", "author": "mcalmer", "createdAt": "2020-01-22T10:25:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQyODcxNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQ4MDE0OA==", "url": "https://github.com/uyuni-project/uyuni/pull/1818#discussion_r369480148", "bodyText": "Sorry, didn't notice the comment in time.\nI will issue a new PR and merge it right away.", "author": "juliogonzalez", "createdAt": "2020-01-22T10:29:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQyODcxNQ=="}], "type": "inlineReview"}]}