{"pr_number": 2290, "pr_title": "Verify packages index with best checksum algorithm", "pr_createdAt": "2020-06-04T16:22:59Z", "pr_url": "https://github.com/uyuni-project/uyuni/pull/2290", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTQxMTE1OQ==", "url": "https://github.com/uyuni-project/uyuni/pull/2290#discussion_r435411159", "bodyText": "You need to adapt the parser as well. Currently only \"sha256\", \"sha1\", \"md5\" are supported.\nMaybe currently debian do not use better algorithms, but sooner or later they will. So why not support them already.", "author": "mcalmer", "createdAt": "2020-06-04T17:01:45Z", "path": "backend/common/repo.py", "diffHunk": "@@ -214,19 +214,22 @@ def is_flat(self) -> bool:\n \n     def verify_packages_index(self) -> bool:\n         \"\"\"\n-        Verify Packages index against all listed checksum algorithms.\n+        Verify Packages index with the best available checksum algorithm.\n \n-        :param name: name of the packages index\n         :return: result (boolean)\n         \"\"\"\n         name, data = self.get_pkg_index_raw()\n         entry = self.get_release_index().get(name)\n-        for algorithm in [\"md5\", \"sha1\", \"sha256\"]:\n-            if entry is None:\n-                res = False\n-            else:\n-                res = getattr(hashlib, algorithm)(data).hexdigest() == getattr(entry.checksum, algorithm)\n-            if not res:\n+        if entry is None:\n+            return False\n+\n+        result = False\n+        for algorithm in (\"sha512\", \"sha384\", \"sha256\", \"sha1\", \"md5\"):", "originalCommit": "ddf97f96d6662b5d720445f5ffdbc25e3321045a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "da0d7f9a17798a74d523bd4ff6b8ec93fea82b24", "url": "https://github.com/uyuni-project/uyuni/commit/da0d7f9a17798a74d523bd4ff6b8ec93fea82b24", "message": "Verify packages index with best checksum algorithm\n\nIterating over checksum algorithms, the best that is available is used\nto do the verification. It is not needed to repeat the checksum\nverification with weaker algorithms afterwards.\n\nFixes https://github.com/uyuni-project/uyuni/issues/2283", "committedDate": "2020-06-05T12:40:00Z", "type": "forcePushed"}, {"oid": "1326f0f68fd35e7b2ebebd875f3391831e0c67ad", "url": "https://github.com/uyuni-project/uyuni/commit/1326f0f68fd35e7b2ebebd875f3391831e0c67ad", "message": "Verify packages index with best checksum algorithm\n\nIterating over checksum algorithms, the best that is available is used\nto do the verification. It is not needed to repeat the checksum\nverification with weaker algorithms afterwards.\n\nFixes https://github.com/uyuni-project/uyuni/issues/2283", "committedDate": "2020-06-05T13:18:53Z", "type": "forcePushed"}, {"oid": "b82cdba9c8c827f8407aa6722349c8a24caf4268", "url": "https://github.com/uyuni-project/uyuni/commit/b82cdba9c8c827f8407aa6722349c8a24caf4268", "message": "Remove test_get_pkg_index_raw_exception\n\nRaising this exception was 536787d and the test now fails 100% of the\ntime.", "committedDate": "2020-06-08T14:23:38Z", "type": "forcePushed"}, {"oid": "d0dc6c2804c055966302da22785c1c1ea5d9d2e1", "url": "https://github.com/uyuni-project/uyuni/commit/d0dc6c2804c055966302da22785c1c1ea5d9d2e1", "message": "Remove test_get_pkg_index_raw_exception\n\nRaising this exception was removed in 536787d and the test now fails\n100% of the time.", "committedDate": "2020-06-08T14:28:24Z", "type": "forcePushed"}, {"oid": "e5aa8822ac10e2704fbb422f49e3c18e2bc9f3d6", "url": "https://github.com/uyuni-project/uyuni/commit/e5aa8822ac10e2704fbb422f49e3c18e2bc9f3d6", "message": "Remove test_get_pkg_index_raw_exception\n\nRaising this exception was removed in 536787d and the test now fails\n100% of the time.", "committedDate": "2020-06-12T09:45:39Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTMyNTMxOA==", "url": "https://github.com/uyuni-project/uyuni/pull/2290#discussion_r439325318", "bodyText": "This entry needs to be added to the top of the file. It got placed in the wrong place probably after last rebase.", "author": "meaksh", "createdAt": "2020-06-12T09:58:51Z", "path": "backend/spacewalk-backend.changes", "diffHunk": "@@ -6,6 +6,7 @@ Wed Jun 10 12:14:57 CEST 2020 - jgonzalez@suse.com\n - supportconfig speedup fixes, add option to not compress spacewalk-debug output dir\n - Prevent failure when syncing from RHEL CDN due extra params (bsc#1171885)\n - Ubuntu repos sync uses http proxy (bsc#1168845)\n+- Only check strongest available Ubuntu/Debian repository index checksum", "originalCommit": "e5aa8822ac10e2704fbb422f49e3c18e2bc9f3d6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTMyNjgzOQ==", "url": "https://github.com/uyuni-project/uyuni/pull/2290#discussion_r439326839", "bodyText": "Oh, I did not know that. I used https://github.com/uyuni-project/uyuni/pull/2278/files as reference and it was added at the bottom in that PR. I'll move it to the top", "author": "agraul", "createdAt": "2020-06-12T10:02:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTMyNTMxOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTMyNzM0MA==", "url": "https://github.com/uyuni-project/uyuni/pull/2290#discussion_r439327340", "bodyText": "Oh, you man above that entry. Now I got it.", "author": "agraul", "createdAt": "2020-06-12T10:03:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTMyNTMxOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTMyODc3Nw==", "url": "https://github.com/uyuni-project/uyuni/pull/2290#discussion_r439328777", "bodyText": "As a general rule, you need to add it to the top of the file. In the case of https://github.com/uyuni-project/uyuni/pull/2278/files , that's not true but it's not really a problem because there is no release on top of the new entry.\nThis is not the case here on this PR, where you're adding the changelog entry below an already release version of this package.\nSo, general rule, always on top :)", "author": "meaksh", "createdAt": "2020-06-12T10:06:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTMyNTMxOA=="}], "type": "inlineReview"}, {"oid": "112fde88ac153c0babdd29396969188653d487e6", "url": "https://github.com/uyuni-project/uyuni/commit/112fde88ac153c0babdd29396969188653d487e6", "message": "Verify packages index with best checksum algorithm\n\nIterating over checksum algorithms, the best that is available is used\nto do the verification. It is not needed to repeat the checksum\nverification with weaker algorithms afterwards.\n\nFixes https://github.com/uyuni-project/uyuni/issues/2283", "committedDate": "2020-06-12T10:05:14Z", "type": "commit"}, {"oid": "d8d04f0e899523fff63c6c698160804a78bdf425", "url": "https://github.com/uyuni-project/uyuni/commit/d8d04f0e899523fff63c6c698160804a78bdf425", "message": "Remove test_get_pkg_index_raw_exception\n\nRaising this exception was removed in 536787d and the test now fails\n100% of the time.", "committedDate": "2020-06-12T10:05:14Z", "type": "commit"}, {"oid": "d8d04f0e899523fff63c6c698160804a78bdf425", "url": "https://github.com/uyuni-project/uyuni/commit/d8d04f0e899523fff63c6c698160804a78bdf425", "message": "Remove test_get_pkg_index_raw_exception\n\nRaising this exception was removed in 536787d and the test now fails\n100% of the time.", "committedDate": "2020-06-12T10:05:14Z", "type": "forcePushed"}]}