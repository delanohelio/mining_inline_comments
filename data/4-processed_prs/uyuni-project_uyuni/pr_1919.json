{"pr_number": 1919, "pr_title": "Support for Amazon Linux 2", "pr_createdAt": "2020-02-14T17:21:29Z", "pr_url": "https://github.com/uyuni-project/uyuni/pull/1919", "timeline": [{"oid": "e9c0525aa2f631b6edc4b344693da67f6f6d3d66", "url": "https://github.com/uyuni-project/uyuni/commit/e9c0525aa2f631b6edc4b344693da67f6f6d3d66", "message": "Support for Amazon Linux 2 (PoC)", "committedDate": "2021-03-22T09:11:19Z", "type": "forcePushed"}, {"oid": "49b6a7febd7a3e6d0a2848cdd86ffd0919ad14dd", "url": "https://github.com/uyuni-project/uyuni/commit/49b6a7febd7a3e6d0a2848cdd86ffd0919ad14dd", "message": "Support for Amazon Linux 2 (PoC)", "committedDate": "2021-03-22T09:13:14Z", "type": "forcePushed"}, {"oid": "b3d6669581f9da4325213cfeacc60c903406bb6b", "url": "https://github.com/uyuni-project/uyuni/commit/b3d6669581f9da4325213cfeacc60c903406bb6b", "message": "Support for Amazon Linux 2 (PoC)", "committedDate": "2021-03-22T11:04:31Z", "type": "forcePushed"}, {"oid": "ebaefd08ef44037dcf47b7b76b2e36c15858f20d", "url": "https://github.com/uyuni-project/uyuni/commit/ebaefd08ef44037dcf47b7b76b2e36c15858f20d", "message": "Support for Amazon Linux 2 (PoC)", "committedDate": "2021-03-22T11:17:44Z", "type": "forcePushed"}, {"oid": "43842b9d9c6d79ec3e7db81bfb75e8d5ca619b1d", "url": "https://github.com/uyuni-project/uyuni/commit/43842b9d9c6d79ec3e7db81bfb75e8d5ca619b1d", "message": "Support for Amazon Linux 2 (PoC)", "committedDate": "2021-03-22T11:27:39Z", "type": "forcePushed"}, {"oid": "f7e2c6c10773f04ce28e11b6a35ef4775145fd2a", "url": "https://github.com/uyuni-project/uyuni/commit/f7e2c6c10773f04ce28e11b6a35ef4775145fd2a", "message": "Support for Amazon Linux 2 (PoC)", "committedDate": "2021-03-22T11:48:46Z", "type": "forcePushed"}, {"oid": "b6e450f4c40759e5b4c361ddfc34e3883e7c18c9", "url": "https://github.com/uyuni-project/uyuni/commit/b6e450f4c40759e5b4c361ddfc34e3883e7c18c9", "message": "Support for Amazon Linux 2 (PoC)", "committedDate": "2021-03-22T12:54:57Z", "type": "forcePushed"}, {"oid": "8c792de5ffec6c92b3ad38c704b7417d019e39a3", "url": "https://github.com/uyuni-project/uyuni/commit/8c792de5ffec6c92b3ad38c704b7417d019e39a3", "message": "Support for Amazon Linux 2 (PoC)", "committedDate": "2021-03-22T13:24:07Z", "type": "forcePushed"}, {"oid": "2a3fc2032f6e2d936e6a82c7ac4dd4002a5a7ea8", "url": "https://github.com/uyuni-project/uyuni/commit/2a3fc2032f6e2d936e6a82c7ac4dd4002a5a7ea8", "message": "Support for Amazon Linux 2 (PoC)", "committedDate": "2021-03-22T13:26:37Z", "type": "forcePushed"}, {"oid": "a652c158dfc76cef094754428e296cfef468346d", "url": "https://github.com/uyuni-project/uyuni/commit/a652c158dfc76cef094754428e296cfef468346d", "message": "Support for Amazon Linux 2 (PoC)", "committedDate": "2021-03-22T15:39:15Z", "type": "forcePushed"}, {"oid": "2d099c579ef67d198208fc4d437713b1032ff02b", "url": "https://github.com/uyuni-project/uyuni/commit/2d099c579ef67d198208fc4d437713b1032ff02b", "message": "Support for Amazon Linux 2 (PoC)", "committedDate": "2021-03-22T15:48:14Z", "type": "forcePushed"}, {"oid": "ae45b1103ac947eef4b945edb911ab66ab048151", "url": "https://github.com/uyuni-project/uyuni/commit/ae45b1103ac947eef4b945edb911ab66ab048151", "message": "Support for Amazon Linux 2 (PoC)", "committedDate": "2021-03-22T15:56:20Z", "type": "forcePushed"}, {"oid": "315f348e2efa595ef9af6df9431851ea1f7b79e6", "url": "https://github.com/uyuni-project/uyuni/commit/315f348e2efa595ef9af6df9431851ea1f7b79e6", "message": "Support for Amazon Linux 2 (PoC)", "committedDate": "2021-03-22T16:09:09Z", "type": "forcePushed"}, {"oid": "c43f19ab8ffd09a55765d91ca473c786da181a74", "url": "https://github.com/uyuni-project/uyuni/commit/c43f19ab8ffd09a55765d91ca473c786da181a74", "message": "Support for Amazon Linux 2 (PoC)", "committedDate": "2021-03-22T16:16:07Z", "type": "forcePushed"}, {"oid": "7323e80548ca3e8a14c56ae44981090a14abaf9a", "url": "https://github.com/uyuni-project/uyuni/commit/7323e80548ca3e8a14c56ae44981090a14abaf9a", "message": "Support for Amazon Linux 2 (PoC)", "committedDate": "2021-03-22T16:19:30Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5OTU2Nzk0NA==", "url": "https://github.com/uyuni-project/uyuni/pull/1919#discussion_r599567944", "bodyText": "I think you need to create a new Amazon2.sls file here if you want to install the Amazon Linux 2 repo key. See https://github.com/paususe/uyuni/blob/492f64fca41f1292444690e8b42e16a812b28970/susemanager-utils/susemanager-sls/salt/certs/Alibaba2.sls", "author": "paususe", "createdAt": "2021-03-23T13:29:44Z", "path": "susemanager-utils/susemanager-sls/salt/certs/Amazon2.sls", "diffHunk": "@@ -0,0 +1 @@\n+RedHat7.sls", "originalCommit": "7323e80548ca3e8a14c56ae44981090a14abaf9a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5OTg4ODU3Ng==", "url": "https://github.com/uyuni-project/uyuni/pull/1919#discussion_r599888576", "bodyText": "Not really. We don't need the Amazon Linux 2 repo key. That's trusted by default by the instance. I am not wrong this RedHat7.sls is the RES7 client tools GPG key. What we should have is this or the correct GPG Key for the Uyuni client tools, with the links adjusted by the SPEC depending on the base OS used to build susemanager-sls.\nBut I will not do this work on this PR to avoid making it more complicate, and also because it should affect all OS.", "author": "juliogonzalez", "createdAt": "2021-03-23T19:56:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5OTU2Nzk0NA=="}], "type": "inlineReview"}, {"oid": "224fcaac9a681f9fb0c8000fccd1231ef344b908", "url": "https://github.com/uyuni-project/uyuni/commit/224fcaac9a681f9fb0c8000fccd1231ef344b908", "message": "Support for Amazon Linux 2 (PoC)", "committedDate": "2021-03-24T14:41:15Z", "type": "forcePushed"}, {"oid": "c1abc99a74e391fc70140913a32ee1c930ef9e52", "url": "https://github.com/uyuni-project/uyuni/commit/c1abc99a74e391fc70140913a32ee1c930ef9e52", "message": "Support for Amazon Linux 2 (PoC)", "committedDate": "2021-03-24T15:25:40Z", "type": "forcePushed"}, {"oid": "a2c9fe02c445ec2d8c2265ab5721916410a3275c", "url": "https://github.com/uyuni-project/uyuni/commit/a2c9fe02c445ec2d8c2265ab5721916410a3275c", "message": "Support for Amazon Linux 2", "committedDate": "2021-03-24T15:34:05Z", "type": "commit"}, {"oid": "a2c9fe02c445ec2d8c2265ab5721916410a3275c", "url": "https://github.com/uyuni-project/uyuni/commit/a2c9fe02c445ec2d8c2265ab5721916410a3275c", "message": "Support for Amazon Linux 2", "committedDate": "2021-03-24T15:34:05Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMDY1NjE1Mw==", "url": "https://github.com/uyuni-project/uyuni/pull/1919#discussion_r600656153", "bodyText": "We really need to decide what to do here. Personally I'd add Amazon Linux to OBS and build separate client tools, as Amazon Linux is not a clone of CentOS7, even if it's very similar.\nBesides, if we add Amazon Linux to OBS, we'll be able to support aarch64 as well, which is being used more and more because the EC2 instances with Amazon Linux aarch64 are cheaper.", "author": "juliogonzalez", "createdAt": "2021-03-24T16:32:53Z", "path": "utils/spacewalk-common-channels.ini", "diffHunk": "@@ -2164,3 +2164,41 @@ repo_type = deb\n checksum = sha256\n base_channels = astralinux-orel-pool-amd64\n repo_url = https://download.astralinux.ru/astra/stable/orel/repository/dists/orel/non-free/binary-amd64/\n+\n+[amazonlinux2-core]\n+archs    =  x86_64, aarch64\n+name     = Amazon Linux 2 Core %(arch)s\n+label    = amazonlinux2-core-%(arch)s\n+checksum  = sha256\n+gpgkey_url =\n+gpgkey_id = C87F5B1A\n+gpgkey_fingerprint = 99E6 17FE 5DB5 27C0 D8BD  5F8E 11CF 1F95 C87F 5B1A\n+repo_url = http://amazonlinux.default.amazonaws.com/2/core/latest/%(arch)s/mirror.list\n+\n+[amazonlinux2-extra-docker]\n+archs    =  x86_64, aarch64\n+name     = Amazon Extras 2 repo for Docker %(arch)s\n+label    = amazonlinux2-extras-docker-%(arch)s\n+base_channels = amazonlinux2-core-%(arch)s\n+checksum = sha256\n+gpgkey_id = C87F5B1A\n+gpgkey_fingerprint = 99E6 17FE 5DB5 27C0 D8BD  5F8E 11CF 1F95 C87F 5B1A\n+repo_url = http://amazonlinux.default.amazonaws.com/2/extras/docker/latest/%(arch)s/mirror.list\n+\n+[amazonlinux2-uyuni-client]\n+name     = Uyuni Client Tools for %(base_channel_name)s\n+archs    =  x86_64, aarch64\n+base_channels = amazonlinux2-core-%(arch)s\n+gpgkey_url = https://download.opensuse.org/repositories/systemsmanagement:/Uyuni:/Stable:/CentOS7-Uyuni-Client-Tools/CentOS_7/repodata/repomd.xml.key\n+gpgkey_id = %(_uyuni_gpgkey_id)s\n+gpgkey_fingerprint = %(_uyuni_gpgkey_fingerprint)s\n+repo_url = https://download.opensuse.org/repositories/systemsmanagement:/Uyuni:/Stable:/CentOS7-Uyuni-Client-Tools/CentOS_7/", "originalCommit": "a2c9fe02c445ec2d8c2265ab5721916410a3275c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMjgwODA1NQ==", "url": "https://github.com/uyuni-project/uyuni/pull/1919#discussion_r602808055", "bodyText": "We can also build aarch64 using CentOS 7", "author": "paususe", "createdAt": "2021-03-28T00:07:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMDY1NjE1Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMDY1NjI4MA==", "url": "https://github.com/uyuni-project/uyuni/pull/1919#discussion_r600656280", "bodyText": "Same here, of course.", "author": "juliogonzalez", "createdAt": "2021-03-24T16:33:03Z", "path": "utils/spacewalk-common-channels.ini", "diffHunk": "@@ -2164,3 +2164,41 @@ repo_type = deb\n checksum = sha256\n base_channels = astralinux-orel-pool-amd64\n repo_url = https://download.astralinux.ru/astra/stable/orel/repository/dists/orel/non-free/binary-amd64/\n+\n+[amazonlinux2-core]\n+archs    =  x86_64, aarch64\n+name     = Amazon Linux 2 Core %(arch)s\n+label    = amazonlinux2-core-%(arch)s\n+checksum  = sha256\n+gpgkey_url =\n+gpgkey_id = C87F5B1A\n+gpgkey_fingerprint = 99E6 17FE 5DB5 27C0 D8BD  5F8E 11CF 1F95 C87F 5B1A\n+repo_url = http://amazonlinux.default.amazonaws.com/2/core/latest/%(arch)s/mirror.list\n+\n+[amazonlinux2-extra-docker]\n+archs    =  x86_64, aarch64\n+name     = Amazon Extras 2 repo for Docker %(arch)s\n+label    = amazonlinux2-extras-docker-%(arch)s\n+base_channels = amazonlinux2-core-%(arch)s\n+checksum = sha256\n+gpgkey_id = C87F5B1A\n+gpgkey_fingerprint = 99E6 17FE 5DB5 27C0 D8BD  5F8E 11CF 1F95 C87F 5B1A\n+repo_url = http://amazonlinux.default.amazonaws.com/2/extras/docker/latest/%(arch)s/mirror.list\n+\n+[amazonlinux2-uyuni-client]\n+name     = Uyuni Client Tools for %(base_channel_name)s\n+archs    =  x86_64, aarch64\n+base_channels = amazonlinux2-core-%(arch)s\n+gpgkey_url = https://download.opensuse.org/repositories/systemsmanagement:/Uyuni:/Stable:/CentOS7-Uyuni-Client-Tools/CentOS_7/repodata/repomd.xml.key\n+gpgkey_id = %(_uyuni_gpgkey_id)s\n+gpgkey_fingerprint = %(_uyuni_gpgkey_fingerprint)s\n+repo_url = https://download.opensuse.org/repositories/systemsmanagement:/Uyuni:/Stable:/CentOS7-Uyuni-Client-Tools/CentOS_7/\n+\n+[amazonlinux2-uyuni-client-devel]\n+name     = Uyuni Client Tools for %(base_channel_name)s (Development)\n+archs    =  x86_64, aarch64\n+base_channels = amazonlinux2-core-%(arch)s\n+gpgkey_url = https://download.opensuse.org/repositories/systemsmanagement:/Uyuni:/Master:/CentOS7-Uyuni-Client-Tools/CentOS_7/repodata/repomd.xml.key\n+gpgkey_id = %(_uyuni_gpgkey_id)s\n+gpgkey_fingerprint = %(_uyuni_gpgkey_fingerprint)s\n+repo_url = https://download.opensuse.org/repositories/systemsmanagement:/Uyuni:/Master:/CentOS7-Uyuni-Client-Tools/CentOS_7/", "originalCommit": "a2c9fe02c445ec2d8c2265ab5721916410a3275c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMDY1NzUzNw==", "url": "https://github.com/uyuni-project/uyuni/pull/1919#discussion_r600657537", "bodyText": "This is required for the WebUI bootstrap, where system-rpm-config is required.", "author": "juliogonzalez", "createdAt": "2021-03-24T16:34:35Z", "path": "susemanager/src/mgr_bootstrap_data.py", "diffHunk": "@@ -389,6 +389,40 @@\n     \"dmidecode\"\n ]\n \n+AMAZONLINUX2 = [", "originalCommit": "a2c9fe02c445ec2d8c2265ab5721916410a3275c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMjEyMTQ2NQ==", "url": "https://github.com/uyuni-project/uyuni/pull/1919#discussion_r602121465", "bodyText": "suseRegisterInfo is AFAIK only used for traditional clients. Not sure if you want to support it?", "author": "mcalmer", "createdAt": "2021-03-26T09:10:56Z", "path": "suseRegisterInfo/suseRegister/info.py", "diffHunk": "@@ -49,6 +49,10 @@ def getRedHatLikeProducts():\n         ret = parseReleaseInfo(release='/etc/centos-release')\n         if ret:\n             ret['name'] = \"CentOS\"\n+    elif os.path.exists('/etc/system-release'):\n+        ret = parseReleaseInfo(release='/etc/system-release')\n+        if ret:\n+            ret['name'] = \"AmazonLinux\"", "originalCommit": "a2c9fe02c445ec2d8c2265ab5721916410a3275c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMjEyMzk5OQ==", "url": "https://github.com/uyuni-project/uyuni/pull/1919#discussion_r602123999", "bodyText": "When you change this, you should check the java part of the product detection. I think it requires also changes.", "author": "mcalmer", "createdAt": "2021-03-26T09:14:57Z", "path": "susemanager-utils/susemanager-sls/salt/packages/redhatproductinfo.sls", "diffHunk": "@@ -11,6 +11,10 @@ oraclerelease:\n   cmd.run:\n     - name: cat /etc/oracle-release\n     - onlyif: test -f /etc/oracle-release\n+amazonrelease:\n+  cmd.run:\n+    - name: cat /etc/system-release\n+    - onlyif: test -f /etc/system-release", "originalCommit": "a2c9fe02c445ec2d8c2265ab5721916410a3275c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMjIxNDgxNg==", "url": "https://github.com/uyuni-project/uyuni/pull/1919#discussion_r602214816", "bodyText": "Well, I did this in preparation for the Java product detection (that someone else will handle later). As far as I could see, it doesn't break anything if it's already done, right?", "author": "juliogonzalez", "createdAt": "2021-03-26T11:40:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMjEyMzk5OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMjIyOTQ1NA==", "url": "https://github.com/uyuni-project/uyuni/pull/1919#discussion_r602229454", "bodyText": "Right. If product detection is not yer wanted we can leave it in.", "author": "mcalmer", "createdAt": "2021-03-26T12:07:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMjEyMzk5OQ=="}], "type": "inlineReview"}]}