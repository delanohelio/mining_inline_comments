{"pr_number": 2981, "pr_title": "Faster and more robust checkbox test", "pr_createdAt": "2020-12-07T15:52:47Z", "pr_url": "https://github.com/uyuni-project/uyuni/pull/2981", "timeline": [{"oid": "f28791a067eeae3677a82d127fcf479528a44d5e", "url": "https://github.com/uyuni-project/uyuni/commit/f28791a067eeae3677a82d127fcf479528a44d5e", "message": "Faster and more robust checkbox test", "committedDate": "2020-12-07T16:17:37Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzcyNTYxMg==", "url": "https://github.com/uyuni-project/uyuni/pull/2981#discussion_r537725612", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              product = find(:xpath, xpath)\n          \n          \n            \n              selected = product.find(:xpath, \"./div/input[@type='checkbox']\").checked?\n          \n          \n            \n              raise \"#{product['data-identifier']} is not checked\" unless selected\n          \n          \n            \n            within(xpath) do\n          \n          \n            \n              raise \"#{product} is not checked\" unless find(:xpath, \"./div/input[@type='checkbox']\").checked?\n          \n          \n            \n            end", "author": "srbarrios", "createdAt": "2020-12-07T18:20:15Z", "path": "testsuite/features/step_definitions/common_steps.rb", "diffHunk": "@@ -511,8 +511,9 @@\n \n Then(/^I should see the \"(.*?)\" selected$/) do |product|\n   xpath = \"//span[contains(text(), '#{product}')]/ancestor::div[contains(@class, 'product-details-wrapper')]\"\n-  product_identifier = find(:xpath, xpath)['data-identifier']\n-  raise \"#{product_identifier} is not checked\" unless has_checked_field?('checkbox-for-' + product_identifier)\n+  product = find(:xpath, xpath)\n+  selected = product.find(:xpath, \"./div/input[@type='checkbox']\").checked?\n+  raise \"#{product['data-identifier']} is not checked\" unless selected", "originalCommit": "f28791a067eeae3677a82d127fcf479528a44d5e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODMzMDYwNA==", "url": "https://github.com/uyuni-project/uyuni/pull/2981#discussion_r538330604", "bodyText": "why not, it's indeed more elegant with within\nBUT what you want in the error message is find(:xpath, '.')['data-identifier'], because product is undefined in your solution\nok, i have to redo my test :-(", "author": "Bischoff", "createdAt": "2020-12-08T12:50:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzcyNTYxMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODQ1NDYwNA==", "url": "https://github.com/uyuni-project/uyuni/pull/2981#discussion_r538454604", "bodyText": "Done.", "author": "Bischoff", "createdAt": "2020-12-08T14:48:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzcyNTYxMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODUxOTk3MA==", "url": "https://github.com/uyuni-project/uyuni/pull/2981#discussion_r538519970", "bodyText": "@Bischoff it is impossible that product is undefined, we are passing a value as a parameter in the step definition.\nWith your extra change, we are adding an extra find, anyhow, as it is only called on a raise, fine with this approach.\nNote: Be caution to reuse variables like 'product' to store completely different values, even if possible, can bring confusion.", "author": "srbarrios", "createdAt": "2020-12-08T15:47:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzcyNTYxMg=="}], "type": "inlineReview"}, {"oid": "86ce225a67e5acae89a5cb0e5a0396bd28902fe1", "url": "https://github.com/uyuni-project/uyuni/commit/86ce225a67e5acae89a5cb0e5a0396bd28902fe1", "message": "Faster and more robust checkbox test", "committedDate": "2020-12-08T12:42:31Z", "type": "forcePushed"}, {"oid": "41c72c3192a1a52fbde428212be262baf35d01d3", "url": "https://github.com/uyuni-project/uyuni/commit/41c72c3192a1a52fbde428212be262baf35d01d3", "message": "Faster and more robust checkbox test", "committedDate": "2020-12-08T12:43:32Z", "type": "forcePushed"}, {"oid": "fb68e93080289238f2e670b7f9da5d02dca1003c", "url": "https://github.com/uyuni-project/uyuni/commit/fb68e93080289238f2e670b7f9da5d02dca1003c", "message": "Faster and more robust checkbox test", "committedDate": "2020-12-08T14:37:21Z", "type": "commit"}, {"oid": "fb68e93080289238f2e670b7f9da5d02dca1003c", "url": "https://github.com/uyuni-project/uyuni/commit/fb68e93080289238f2e670b7f9da5d02dca1003c", "message": "Faster and more robust checkbox test", "committedDate": "2020-12-08T14:37:21Z", "type": "forcePushed"}]}