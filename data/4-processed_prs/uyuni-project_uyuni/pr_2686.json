{"pr_number": 2686, "pr_title": "Fix: do not break when pod status is empty (bsc#1161903)", "pr_createdAt": "2020-10-04T12:26:45Z", "pr_url": "https://github.com/uyuni-project/uyuni/pull/2686", "timeline": [{"oid": "8bfa6281fa26e50ac15a9682eb475988f0235902", "url": "https://github.com/uyuni-project/uyuni/commit/8bfa6281fa26e50ac15a9682eb475988f0235902", "message": "Fix: do not break when pod status is empty (bsc#1161903)", "committedDate": "2020-10-04T12:24:20Z", "type": "commit"}, {"oid": "bca8be3ae869745f8e80ba159dd21e71ec187d41", "url": "https://github.com/uyuni-project/uyuni/commit/bca8be3ae869745f8e80ba159dd21e71ec187d41", "message": "Chore: announce changes", "committedDate": "2020-10-04T12:26:38Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTEyMDA2Mg==", "url": "https://github.com/uyuni-project/uyuni/pull/2686#discussion_r501120062", "bodyText": "Could you also log the exception?", "author": "mateiw", "createdAt": "2020-10-07T15:47:29Z", "path": "susemanager-utils/susemanager-sls/modules/runners/mgrk8s.py", "diffHunk": "@@ -44,13 +47,16 @@ def get_all_containers(kubeconfig=None, context=None):\n     pods = api.list_pod_for_all_namespaces(watch=False)\n     output = dict(containers=[])\n     for pod in pods.items:\n-        for container in pod.status.container_statuses:\n-            res_cont = dict()\n-            res_cont['container_id'] = container.container_id\n-            res_cont['image'] = container.image\n-            res_cont['image_id'] = container.image_id\n-            res_cont['pod_name'] = pod.metadata.name\n-            res_cont['pod_namespace'] = pod.metadata.namespace\n-            output['containers'].append(res_cont)\n+        try:\n+            for container in pod.status.container_statuses:\n+                res_cont = dict()\n+                res_cont['container_id'] = container.container_id\n+                res_cont['image'] = container.image\n+                res_cont['image_id'] = container.image_id\n+                res_cont['pod_name'] = pod.metadata.name\n+                res_cont['pod_namespace'] = pod.metadata.namespace\n+                output['containers'].append(res_cont)\n+        except:\n+            log.error(\"Failed to parse pod container statuses\")", "originalCommit": "bca8be3ae869745f8e80ba159dd21e71ec187d41", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTEyMTM4OQ==", "url": "https://github.com/uyuni-project/uyuni/pull/2686#discussion_r501121389", "bodyText": "IIUC container_statuses is empty? In this case maybe in addition to the try...except block, a check could be added to avoid the exception altogether.", "author": "mateiw", "createdAt": "2020-10-07T15:49:23Z", "path": "susemanager-utils/susemanager-sls/modules/runners/mgrk8s.py", "diffHunk": "@@ -44,13 +47,16 @@ def get_all_containers(kubeconfig=None, context=None):\n     pods = api.list_pod_for_all_namespaces(watch=False)\n     output = dict(containers=[])\n     for pod in pods.items:\n-        for container in pod.status.container_statuses:\n-            res_cont = dict()\n-            res_cont['container_id'] = container.container_id\n-            res_cont['image'] = container.image\n-            res_cont['image_id'] = container.image_id\n-            res_cont['pod_name'] = pod.metadata.name\n-            res_cont['pod_namespace'] = pod.metadata.namespace\n-            output['containers'].append(res_cont)\n+        try:\n+            for container in pod.status.container_statuses:", "originalCommit": "bca8be3ae869745f8e80ba159dd21e71ec187d41", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTc1NDQ5MQ==", "url": "https://github.com/uyuni-project/uyuni/pull/2686#discussion_r501754491", "bodyText": "Yes, you are right", "author": "mbologna", "createdAt": "2020-10-08T14:13:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTEyMTM4OQ=="}], "type": "inlineReview"}, {"oid": "1757ace4fdbb435a52eb6789094a5c0fa1c2e380", "url": "https://github.com/uyuni-project/uyuni/commit/1757ace4fdbb435a52eb6789094a5c0fa1c2e380", "message": "Fix: after review changes", "committedDate": "2020-10-14T08:28:56Z", "type": "commit"}, {"oid": "1757ace4fdbb435a52eb6789094a5c0fa1c2e380", "url": "https://github.com/uyuni-project/uyuni/commit/1757ace4fdbb435a52eb6789094a5c0fa1c2e380", "message": "Fix: after review changes", "committedDate": "2020-10-14T08:28:56Z", "type": "forcePushed"}]}