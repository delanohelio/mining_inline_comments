{"pr_number": 2344, "pr_title": "for the base channel use generated metadata", "pr_createdAt": "2020-06-20T11:18:27Z", "pr_url": "https://github.com/uyuni-project/uyuni/pull/2344", "timeline": [{"oid": "a64be6fe4f5ff8811509884562d47278c47910c0", "url": "https://github.com/uyuni-project/uyuni/commit/a64be6fe4f5ff8811509884562d47278c47910c0", "message": "update changelog", "committedDate": "2020-06-24T09:38:08Z", "type": "forcePushed"}, {"oid": "83149c162a47e5c60a9dbdedca1658966b76bdd6", "url": "https://github.com/uyuni-project/uyuni/commit/83149c162a47e5c60a9dbdedca1658966b76bdd6", "message": "fixup! deliver media.1/products file when requested", "committedDate": "2020-06-24T14:37:14Z", "type": "forcePushed"}, {"oid": "cac3c59798a5b75ac39de0101547e7f19da61e5a", "url": "https://github.com/uyuni-project/uyuni/commit/cac3c59798a5b75ac39de0101547e7f19da61e5a", "message": "download media.1/products when available and store it in DB", "committedDate": "2020-06-25T12:46:07Z", "type": "forcePushed"}, {"oid": "b890ce2cd3571991a1bab4c4b7386c7765cbc296", "url": "https://github.com/uyuni-project/uyuni/commit/b890ce2cd3571991a1bab4c4b7386c7765cbc296", "message": "update changelogs", "committedDate": "2020-06-25T13:36:51Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTU3OTQ4OQ==", "url": "https://github.com/uyuni-project/uyuni/pull/2344#discussion_r445579489", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        # no mirror list found continue without\n          \n          \n            \n                        # no 'media.1/products' file found", "author": "meaksh", "createdAt": "2020-06-25T13:58:29Z", "path": "backend/satellite_tools/repo_plugins/yum_src.py", "diffHunk": "@@ -964,6 +964,30 @@ def get_modules(self):\n             modules = self._retrieve_md_path('modules')\n         return modules\n \n+    def get_mediaproducts(self):\n+        \"\"\"\n+        Return path to media.1/products file if available\n+\n+        :returns: str\n+        \"\"\"\n+        media_products_path = os.path.join(self._get_repodata_path(), 'media.1/products')\n+        try:\n+            (s,b,p,q,f,o) = urlparse(self.url)\n+            if p[-1] != '/':\n+                p = p + '/'\n+            p = p + 'media.1/products'\n+        except (ValueError, IndexError, KeyError) as e:\n+            return None\n+        url = urlunparse((s,b,p,q,f,o))\n+        try:\n+            urlgrabber_opts = {}\n+            self.set_download_parameters(urlgrabber_opts, url, media_products_path)\n+            urlgrabber.urlgrab(url, media_products_path, **urlgrabber_opts)\n+        except Exception as exc:\n+            # no mirror list found continue without", "originalCommit": "b890ce2cd3571991a1bab4c4b7386c7765cbc296", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTU3OTc5Nw==", "url": "https://github.com/uyuni-project/uyuni/pull/2344#discussion_r445579797", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                def import_mediaproducts(self, plug):\n          \n          \n            \n                    mediaproducts = plug.get_mediaproducts()\n          \n          \n            \n                    if mediaproducts:\n          \n          \n            \n                        self.copy_metadata_file(plug, mediaproducts, 'mediaproducts', relative_mediaproducts_dir)\n          \n          \n            \n            \n          \n          \n            \n                def import_mediaproducts(self, plug):\n          \n          \n            \n                    mediaproducts = plug.get_mediaproducts()\n          \n          \n            \n                    if mediaproducts:\n          \n          \n            \n                        self.copy_metadata_file(plug, mediaproducts, 'mediaproducts', relative_mediaproducts_dir)", "author": "meaksh", "createdAt": "2020-06-25T13:58:52Z", "path": "backend/satellite_tools/reposync.py", "diffHunk": "@@ -813,6 +816,11 @@ def import_modules(self, plug):\n         modulesfile = plug.get_modules()\n         if modulesfile:\n             self.copy_metadata_file(plug, modulesfile, 'modules', relative_modules_dir)\n+    def import_mediaproducts(self, plug):\n+        mediaproducts = plug.get_mediaproducts()\n+        if mediaproducts:\n+            self.copy_metadata_file(plug, mediaproducts, 'mediaproducts', relative_mediaproducts_dir)\n+", "originalCommit": "b890ce2cd3571991a1bab4c4b7386c7765cbc296", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTU4NjExOQ==", "url": "https://github.com/uyuni-project/uyuni/pull/2344#discussion_r445586119", "bodyText": "I do not see a difference? Is there a tab vs. space thingy?", "author": "mcalmer", "createdAt": "2020-06-25T14:08:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTU3OTc5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTU4ODA5Nw==", "url": "https://github.com/uyuni-project/uyuni/pull/2344#discussion_r445588097", "bodyText": "Got it. The extra line.", "author": "mcalmer", "createdAt": "2020-06-25T14:10:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTU3OTc5Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTU4NDIyMw==", "url": "https://github.com/uyuni-project/uyuni/pull/2344#discussion_r445584223", "bodyText": "Does this correspond to the mount point for repomd cache? This is configurable (repomd_cache_mount_point global option). Maybe you can also pull the value out of config instead of hardcoding.", "author": "hustodemon", "createdAt": "2020-06-25T14:05:09Z", "path": "java/code/src/com/redhat/rhn/frontend/action/common/DownloadFile.java", "diffHunk": "@@ -619,7 +619,18 @@ private StreamInfo getStreamInfoKickstart(ActionMapping mapping, ActionForm form\n             // my $dp = File::Spec->catfile($kickstart_mount, $tree->base_path, $path);\n \n             if (child == null) {\n-                diskPath = kickstartMount + \"/\" + tree.getBasePath() + path;\n+                if (path.contains(\"repodata/\") && tree.getKernelOptions().contains(\"useonlinerepo\")) {\n+                    String[] split = StringUtils.split(path, '/');\n+                    if (split[0].equals(\"repodata\")) {\n+                        split[0] = tree.getChannel().getLabel();\n+                    }\n+                    diskPath = \"/var/cache/\" +", "originalCommit": "fbc049378ba0f9e78d3d1c18f8cfea6d64167e95", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTYxMzA2MQ==", "url": "https://github.com/uyuni-project/uyuni/pull/2344#discussion_r445613061", "bodyText": "Seems so. I just copied the code from some lines below.", "author": "mcalmer", "createdAt": "2020-06-25T14:44:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTU4NDIyMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTU4OTI4OQ==", "url": "https://github.com/uyuni-project/uyuni/pull/2344#discussion_r445589289", "bodyText": "These are quite explicit conditions, I'd suggest adding some logging here, which could simplify debugging (at least the final diskPath, if it's not logged by something else). That could simplify debugging, in case of problems.", "author": "hustodemon", "createdAt": "2020-06-25T14:12:30Z", "path": "java/code/src/com/redhat/rhn/frontend/action/common/DownloadFile.java", "diffHunk": "@@ -619,7 +619,18 @@ private StreamInfo getStreamInfoKickstart(ActionMapping mapping, ActionForm form\n             // my $dp = File::Spec->catfile($kickstart_mount, $tree->base_path, $path);\n \n             if (child == null) {\n-                diskPath = kickstartMount + \"/\" + tree.getBasePath() + path;\n+                if (path.contains(\"repodata/\") && tree.getKernelOptions().contains(\"useonlinerepo\")) {\n+                    String[] split = StringUtils.split(path, '/');\n+                    if (split[0].equals(\"repodata\")) {", "originalCommit": "fbc049378ba0f9e78d3d1c18f8cfea6d64167e95", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTYxNzk5OA==", "url": "https://github.com/uyuni-project/uyuni/pull/2344#discussion_r445617998", "bodyText": "diskPath is logged in line 658", "author": "mcalmer", "createdAt": "2020-06-25T14:50:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTU4OTI4OQ=="}], "type": "inlineReview"}, {"oid": "76020bce73f5fe12c9747b3f8d72e55391a11b00", "url": "https://github.com/uyuni-project/uyuni/commit/76020bce73f5fe12c9747b3f8d72e55391a11b00", "message": "use cache dir from config", "committedDate": "2020-06-26T13:24:51Z", "type": "forcePushed"}, {"oid": "0d975fb25e9a5b85e5cd3a06d8ca3d729e8180dc", "url": "https://github.com/uyuni-project/uyuni/commit/0d975fb25e9a5b85e5cd3a06d8ca3d729e8180dc", "message": "for the base channel use generated metadata", "committedDate": "2020-06-26T13:43:58Z", "type": "commit"}, {"oid": "4c583fa62640f64b01840a6b748bfa94d1f0bd0e", "url": "https://github.com/uyuni-project/uyuni/commit/4c583fa62640f64b01840a6b748bfa94d1f0bd0e", "message": "new comps type mediaproducts for media.1/products files", "committedDate": "2020-06-26T13:43:58Z", "type": "commit"}, {"oid": "421d5a002248720ab97fd2813ba4feca1a4a3ac0", "url": "https://github.com/uyuni-project/uyuni/commit/421d5a002248720ab97fd2813ba4feca1a4a3ac0", "message": "deliver media.1/products file when requested", "committedDate": "2020-06-26T13:43:59Z", "type": "commit"}, {"oid": "77a37a8d8d46784259f60fcaddd36dd1527e663d", "url": "https://github.com/uyuni-project/uyuni/commit/77a37a8d8d46784259f60fcaddd36dd1527e663d", "message": "download media.1/products when available and store it in DB", "committedDate": "2020-06-26T13:43:59Z", "type": "commit"}, {"oid": "7861601b29192ac730e708664aa74ea21ebb910e", "url": "https://github.com/uyuni-project/uyuni/commit/7861601b29192ac730e708664aa74ea21ebb910e", "message": "update changelogs", "committedDate": "2020-06-26T13:44:54Z", "type": "commit"}, {"oid": "411e77e977f43e7c6c319632927d361a8d4bf242", "url": "https://github.com/uyuni-project/uyuni/commit/411e77e977f43e7c6c319632927d361a8d4bf242", "message": "Update Comment\n\nCo-authored-by: Pablo Su\u00e1rez Hern\u00e1ndez <psuarezhernandez@suse.com>", "committedDate": "2020-06-26T13:44:56Z", "type": "commit"}, {"oid": "ef4e7477b54459cd8ff17c9750cd679598d27d8f", "url": "https://github.com/uyuni-project/uyuni/commit/ef4e7477b54459cd8ff17c9750cd679598d27d8f", "message": "Add extra line\n\nCo-authored-by: Pablo Su\u00e1rez Hern\u00e1ndez <psuarezhernandez@suse.com>", "committedDate": "2020-06-26T13:44:56Z", "type": "commit"}, {"oid": "92fd27cf3dd4960c175839c748201c970efc8e9f", "url": "https://github.com/uyuni-project/uyuni/commit/92fd27cf3dd4960c175839c748201c970efc8e9f", "message": "fix unit tests", "committedDate": "2020-06-26T13:44:56Z", "type": "commit"}, {"oid": "2dd0673d9d7d34274cf7e058630e80e8389e3293", "url": "https://github.com/uyuni-project/uyuni/commit/2dd0673d9d7d34274cf7e058630e80e8389e3293", "message": "use cache dir from config", "committedDate": "2020-06-26T13:44:56Z", "type": "commit"}, {"oid": "2dd0673d9d7d34274cf7e058630e80e8389e3293", "url": "https://github.com/uyuni-project/uyuni/commit/2dd0673d9d7d34274cf7e058630e80e8389e3293", "message": "use cache dir from config", "committedDate": "2020-06-26T13:44:56Z", "type": "forcePushed"}]}