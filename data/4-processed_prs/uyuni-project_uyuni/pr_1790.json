{"pr_number": 1790, "pr_title": "Manager bsc1132576", "pr_createdAt": "2020-01-15T10:19:09Z", "pr_url": "https://github.com/uyuni-project/uyuni/pull/1790", "timeline": [{"oid": "af96698acbca7d25e9f3ae900ca668429600c774", "url": "https://github.com/uyuni-project/uyuni/commit/af96698acbca7d25e9f3ae900ca668429600c774", "message": "fix detection of SLES ES6 systems (bsc#1132576)", "committedDate": "2020-01-15T10:12:35Z", "type": "commit"}, {"oid": "ebc2bdd0c5b9be81092e25489d2666ca5b6e11ec", "url": "https://github.com/uyuni-project/uyuni/commit/ebc2bdd0c5b9be81092e25489d2666ca5b6e11ec", "message": "fix detection of SLES ES6 systems (bsc#1132576)", "committedDate": "2020-01-15T10:12:46Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjgxNTk5MQ==", "url": "https://github.com/uyuni-project/uyuni/pull/1790#discussion_r366815991", "bodyText": "Does SLES ES7 has this file as well?", "author": "mcalmer", "createdAt": "2020-01-15T11:01:54Z", "path": "spacewalk/certs-tools/rhn_bootstrap_strings.py", "diffHunk": "@@ -358,12 +358,22 @@ def getRegistrationStackSh(saltEnabled):\n     function getY_CLIENT_CODE_BASE() {{\n         local BASE=\"\"\n         local VERSION=\"\"\n-        if [ -f /etc/redhat-release ]; then\n-            grep -v '^#' /etc/redhat-release | grep -q '\\(Red Hat\\)' && BASE=\"res\"\n-            VERSION=`grep -v '^#' /etc/redhat-release | grep -Po '(?<=release )\\d+'`\n+        # SLES ES6 is a special case; it will install a symlink named\n+        # centos-release pointing to redhat-release which will make the\n+        # original test fail; reverting the checks does not help as this\n+        # will break genuine CentOS systems. So use the poor man's approach\n+        # to detect this special case. SLES ES7 does not have this issue\n+        # https://bugzilla.suse.com/show_bug.cgi?id=1132576\n+        # https://bugzilla.suse.com/show_bug.cgi?id=1152795\n+        if [ -L /usr/share/doc/sles_es-release ]; then", "originalCommit": "ebc2bdd0c5b9be81092e25489d2666ca5b6e11ec", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Njg1ODAzNQ==", "url": "https://github.com/uyuni-project/uyuni/pull/1790#discussion_r366858035", "bodyText": "No, they have the symlink in /usr/share instead (not in the doc directory). But SLES ES7 is not affected anyway as it does not contain the bogus /etc/centos-release link in the sles_es-release-server package. So SLES ES7 gets correctly detected as \"res\" as we expect.", "author": "mantel", "createdAt": "2020-01-15T12:51:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjgxNTk5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Njg2MjQ5Ng==", "url": "https://github.com/uyuni-project/uyuni/pull/1790#discussion_r366862496", "bodyText": "ok", "author": "mcalmer", "createdAt": "2020-01-15T13:01:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjgxNTk5MQ=="}], "type": "inlineReview"}]}