{"pr_number": 2095, "pr_title": "Bootstrap minions using an SSH private key via Web UI", "pr_createdAt": "2020-04-03T13:29:09Z", "pr_url": "https://github.com/uyuni-project/uyuni/pull/2095", "timeline": [{"oid": "fcfe7bf14d86fa9e2d9ee8bffdfff61fad893ba7", "url": "https://github.com/uyuni-project/uyuni/commit/fcfe7bf14d86fa9e2d9ee8bffdfff61fad893ba7", "message": "Changelog", "committedDate": "2020-04-03T13:34:05Z", "type": "forcePushed"}, {"oid": "de0a5725263645537df44c8102efcf5ac1330ef5", "url": "https://github.com/uyuni-project/uyuni/commit/de0a5725263645537df44c8102efcf5ac1330ef5", "message": "Changelog", "committedDate": "2020-04-03T13:39:55Z", "type": "forcePushed"}, {"oid": "425a2eefa0907c4159cf652d433a00c340875570", "url": "https://github.com/uyuni-project/uyuni/commit/425a2eefa0907c4159cf652d433a00c340875570", "message": "Changelog", "committedDate": "2020-04-03T13:42:25Z", "type": "forcePushed"}, {"oid": "81bd4caab7dce8a9042d97fb5eed92d30aa9bd83", "url": "https://github.com/uyuni-project/uyuni/commit/81bd4caab7dce8a9042d97fb5eed92d30aa9bd83", "message": "Changelog", "committedDate": "2020-04-03T13:45:10Z", "type": "forcePushed"}, {"oid": "203f3fb9b7e86509c55ca07a8d2174024f181368", "url": "https://github.com/uyuni-project/uyuni/commit/203f3fb9b7e86509c55ca07a8d2174024f181368", "message": "Complete the javadoc", "committedDate": "2020-04-06T06:36:55Z", "type": "forcePushed"}, {"oid": "292f6a5de0aab87ba881ab874ad024e949d57758", "url": "https://github.com/uyuni-project/uyuni/commit/292f6a5de0aab87ba881ab874ad024e949d57758", "message": "Complete the javadoc", "committedDate": "2020-04-06T06:47:30Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzk4MTY2Nw==", "url": "https://github.com/uyuni-project/uyuni/pull/2095#discussion_r403981667", "bodyText": "Suggested change", "author": "renner", "createdAt": "2020-04-06T10:19:14Z", "path": "web/html/src/manager/systems/bootstrap/bootstrap-minions.js", "diffHunk": "@@ -158,10 +201,15 @@ class BootstrapMinions extends React.Component {\n           messages = <Messages items={[{severity: \"info\", text:\n               <p>{t('Your system is bootstrapping: waiting for a response..')}</p>\n           }]}/>;\n+        } else if (this.state.privKeyLoading) {\n+          messages = <Messages items={[{severity: \"info\", text:\n+              <p>{t('Loading SSH Private Key..')}</p>\n+          }]}/>;\n         }\n \n+", "originalCommit": "83cd2ef17d67278984a0ae25f863a17b0fbf5763", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzk4NTQ0MA==", "url": "https://github.com/uyuni-project/uyuni/pull/2095#discussion_r403985440", "bodyText": "Maybe, as all the labels are upper-cased in this form, should we also uppercase this one as Authentication Method:?", "author": "renner", "createdAt": "2020-04-06T10:25:47Z", "path": "web/html/src/manager/systems/bootstrap/bootstrap-minions.js", "diffHunk": "@@ -198,11 +236,43 @@ class BootstrapMinions extends React.Component {\n                     </div>\n                 </div>\n                 <div className=\"form-group\">\n+                    <label className=\"col-md-3 control-label\">Authentication method:</label>", "originalCommit": "937fcec18b61dea3e4295e7477d8c779050b83cc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTU2MjUyMw==", "url": "https://github.com/uyuni-project/uyuni/pull/2095#discussion_r405562523", "bodyText": "Done.", "author": "hustodemon", "createdAt": "2020-04-08T14:20:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzk4NTQ0MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDM4NjgxNw==", "url": "https://github.com/uyuni-project/uyuni/pull/2095#discussion_r404386817", "bodyText": "What about creating a conditional HTML content variable before the return and just showing it here instead?\nSomething like:\nconst conditionalAuthContent = this.state.authMethod === \"password\" ?\n    <div>\n      // the password input box\n    </div>\n    :\n    <div>\n      // the  ssh-key box content (privKeyFile and privKeyPwd inputs)\n    </div>\nand then in the return body just use {conditionalAuthContent}.", "author": "ncounter", "createdAt": "2020-04-06T21:03:40Z", "path": "web/html/src/manager/systems/bootstrap/bootstrap-minions.js", "diffHunk": "@@ -198,11 +246,43 @@ class BootstrapMinions extends React.Component {\n                     </div>\n                 </div>\n                 <div className=\"form-group\">\n+                    <label className=\"col-md-3 control-label\">Authentication method:</label>\n+\n+                    <div className=\"col-md-6\">\n+                        <div className=\"radio col-md-3\">\n+                            <label>\n+                                <input name=\"authMethod\" type=\"radio\" value=\"password\" checked={this.state.authMethod === \"password\"} onChange={this.authMethodChanged}/>\n+                                <span>{t(\"Password\")}</span>\n+                            </label>\n+                        </div>\n+                        <div className=\"radio col-md-3\">\n+                            <label>\n+                                <input name=\"authMethod\" type=\"radio\" value=\"ssh-key\" checked={this.state.authMethod === \"ssh-key\"} onChange={this.authMethodChanged}/>\n+                                <span>{t(\"SSH Private Key\")}</span>\n+                            </label>\n+                        </div>\n+                    </div>\n+                </div>\n+                <div className=\"form-group\" style={this.state.authMethod === \"password\" ? {} : {display: \"none\"} } >", "originalCommit": "83cd2ef17d67278984a0ae25f863a17b0fbf5763", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTU3NTUwMQ==", "url": "https://github.com/uyuni-project/uyuni/pull/2095#discussion_r405575501", "bodyText": "I did that in the original version, but for some reason React was complaining about changing controlled elements to uncontrolled and vice versa, but this is not the case anymore. I've changed as your suggested.", "author": "hustodemon", "createdAt": "2020-04-08T14:38:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDM4NjgxNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDM4ODY3MQ==", "url": "https://github.com/uyuni-project/uyuni/pull/2095#discussion_r404388671", "bodyText": "This is not used more than once. Maybe you can just do this inline three lines below\nreader.readAsText(event.target.files[0].", "author": "ncounter", "createdAt": "2020-04-06T21:07:22Z", "path": "web/html/src/manager/systems/bootstrap/bootstrap-minions.js", "diffHunk": "@@ -48,12 +51,41 @@ class BootstrapMinions extends React.Component {\n         });\n     }\n \n+    authMethodChanged(event) {\n+        this.setState({\n+            authMethod: event.target.value\n+        });\n+    }\n+\n     passwordChanged(event) {\n         this.setState({\n             password: event.target.value\n         });\n     }\n \n+    privKeyFileChanged(event) {\n+        const file = event.target.files[0];", "originalCommit": "83cd2ef17d67278984a0ae25f863a17b0fbf5763", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTU4MjczMQ==", "url": "https://github.com/uyuni-project/uyuni/pull/2095#discussion_r405582731", "bodyText": "But many of the <something>Changed methods are only used once. I personally find it uglier, to do it all-in once (or maybe I didn't completely got your intention):\n    privKeyFileChanged(event) {\n        this.setState({\n            privKeyLoading: true\n        });\n        const file = event.target.files[0];\n        const reader = new FileReader();\n        reader.onload = (e) => this.setState({\n            privKey: keyString,\n            privKeyLoading: false\n        });\n        reader.readAsText(file);\n    }\nLet me know if this ^ is what you meant.", "author": "hustodemon", "createdAt": "2020-04-08T14:48:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDM4ODY3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTc4NzMwNg==", "url": "https://github.com/uyuni-project/uyuni/pull/2095#discussion_r405787306", "bodyText": "Oh, no no sorry, probably I was not that clear, but it was also not that important.\nThe render.onload is fine as it was, recalling the this.privKeyLoaded is fine.\nWhat I meant was only about dropping line\nconst file = event.target.files[0];\nbecause file variable is used only once, and just do it at\nreader.readAsText(event.target.files[0]);\nFeel free to keep it or change it, it's not a big deal in the end.", "author": "ncounter", "createdAt": "2020-04-08T20:15:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDM4ODY3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODI0NTY3OQ==", "url": "https://github.com/uyuni-project/uyuni/pull/2095#discussion_r408245679", "bodyText": "I see! Ok, I inlined that const.", "author": "hustodemon", "createdAt": "2020-04-14T15:51:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDM4ODY3MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDM4OTk2Mg==", "url": "https://github.com/uyuni-project/uyuni/pull/2095#discussion_r404389962", "bodyText": "Whenever it turns to use a flag as a loading traffic-light or condition, I prefer to do it at the very beginning of the function to make sure the info is properly communicated to the user, and to prevent any unexpected behavior from the function body without having the flag set yet. Please move this setState right after the privateKeyFileChanged(event) { line.", "author": "ncounter", "createdAt": "2020-04-06T21:10:00Z", "path": "web/html/src/manager/systems/bootstrap/bootstrap-minions.js", "diffHunk": "@@ -48,12 +51,41 @@ class BootstrapMinions extends React.Component {\n         });\n     }\n \n+    authMethodChanged(event) {\n+        this.setState({\n+            authMethod: event.target.value\n+        });\n+    }\n+\n     passwordChanged(event) {\n         this.setState({\n             password: event.target.value\n         });\n     }\n \n+    privKeyFileChanged(event) {\n+        const file = event.target.files[0];\n+        const reader = new FileReader();\n+        reader.onload = (e) => this.privKeyLoaded(e.target.result);\n+        reader.readAsText(file);\n+        this.setState({\n+            privKeyLoading: true", "originalCommit": "83cd2ef17d67278984a0ae25f863a17b0fbf5763", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "8ac6818ac7f91929ce07fd4f603140ac700f1b66", "url": "https://github.com/uyuni-project/uyuni/commit/8ac6818ac7f91929ce07fd4f603140ac700f1b66", "message": "Address comments", "committedDate": "2020-04-08T14:47:44Z", "type": "forcePushed"}, {"oid": "d39b74678f1cee45bb5b1cc8d88c7bd5e4ab06ad", "url": "https://github.com/uyuni-project/uyuni/commit/d39b74678f1cee45bb5b1cc8d88c7bd5e4ab06ad", "message": "Address comments", "committedDate": "2020-04-14T15:50:56Z", "type": "forcePushed"}, {"oid": "7b7c709adfd98dd8a072750c0f0fa008f01718da", "url": "https://github.com/uyuni-project/uyuni/commit/7b7c709adfd98dd8a072750c0f0fa008f01718da", "message": "Refactor: Use the BootstrapParameters directly in bootstrappers\n\n- previously BootstrapHostsJson was used for this, but this class was\n  originally written for the web UI only and shouldn't leak to other\n  packages (XMLRPC)\n- also rename the validation method validateJsonInput to\n  validateParamsPerContactMethod to better reflect its intent", "committedDate": "2020-04-17T15:36:25Z", "type": "commit"}, {"oid": "3ebd77d26153b99ee71cbaf4ab521696f4a57172", "url": "https://github.com/uyuni-project/uyuni/commit/3ebd77d26153b99ee71cbaf4ab521696f4a57172", "message": "Adjust tests to BootstrapParameters usage", "committedDate": "2020-04-17T15:36:25Z", "type": "commit"}, {"oid": "0f61a51c25cf09b688820f5075c7b9a816aa707c", "url": "https://github.com/uyuni-project/uyuni/commit/0f61a51c25cf09b688820f5075c7b9a816aa707c", "message": "Mock activation key in tests", "committedDate": "2020-04-17T15:36:25Z", "type": "commit"}, {"oid": "5c41a7c7971ee24cd43aa8483829db959a15cdd2", "url": "https://github.com/uyuni-project/uyuni/commit/5c41a7c7971ee24cd43aa8483829db959a15cdd2", "message": "Use the params in the XMLRPC", "committedDate": "2020-04-17T15:36:25Z", "type": "commit"}, {"oid": "caca1521a8232cf755076f7ef70996db7bffe018", "url": "https://github.com/uyuni-project/uyuni/commit/caca1521a8232cf755076f7ef70996db7bffe018", "message": "Sacrifice extreme corner case test\n\nThe test checks that ssh port for bootstrap is numeric, however:\n- in the UI we have a numeric text field, which hugely minimizes the\n  chances of incorrect input\n- in the XMLRPC we have the port declared as integer, which means the\n  incorrect value is already handled by the xmlrpc library", "committedDate": "2020-04-17T15:36:25Z", "type": "commit"}, {"oid": "a7153b7ca1a853ccdd786abf83bd78a53e7ce609", "url": "https://github.com/uyuni-project/uyuni/commit/a7153b7ca1a853ccdd786abf83bd78a53e7ce609", "message": "Add the auth method to BootstrapHostsJson, turn priv key/password to Strings", "committedDate": "2020-04-17T15:36:25Z", "type": "commit"}, {"oid": "bc9cbe1ed612449cbfb89a41c24bf40ce4b9b79a", "url": "https://github.com/uyuni-project/uyuni/commit/bc9cbe1ed612449cbfb89a41c24bf40ce4b9b79a", "message": "BootstrapParameters: constructors for usage for bootstrapping with pwd or key", "committedDate": "2020-04-17T15:36:25Z", "type": "commit"}, {"oid": "3a1d6989b84dcd2d00c57687cdbd8e41402703e0", "url": "https://github.com/uyuni-project/uyuni/commit/3a1d6989b84dcd2d00c57687cdbd8e41402703e0", "message": "Remove unused constuctors\n\nthe BootstrapHostsJson objects are created by GSON", "committedDate": "2020-04-17T15:36:25Z", "type": "commit"}, {"oid": "1cf7d884e2eb1c875d06077918ed91a61b7fee5d", "url": "https://github.com/uyuni-project/uyuni/commit/1cf7d884e2eb1c875d06077918ed91a61b7fee5d", "message": "Web UI: Add UI for bootstrapping with ssh private keys", "committedDate": "2020-04-17T15:36:25Z", "type": "commit"}, {"oid": "db19445ca177a19c7cba04508ab90bb63897d7b4", "url": "https://github.com/uyuni-project/uyuni/commit/db19445ca177a19c7cba04508ab90bb63897d7b4", "message": "Disallow bootstrapping with too long keys", "committedDate": "2020-04-17T15:36:25Z", "type": "commit"}, {"oid": "3dc136be3f3f1bc6e115ef241ba317e7bbecc31b", "url": "https://github.com/uyuni-project/uyuni/commit/3dc136be3f3f1bc6e115ef241ba317e7bbecc31b", "message": "Refactor: use a common constant for resetting bootstrap component state", "committedDate": "2020-04-17T15:36:25Z", "type": "commit"}, {"oid": "ec6fb0904f8f22ca341a8004280af2d4515f1f9a", "url": "https://github.com/uyuni-project/uyuni/commit/ec6fb0904f8f22ca341a8004280af2d4515f1f9a", "message": "Minor: Break horribly long line into multiple lines", "committedDate": "2020-04-17T15:36:25Z", "type": "commit"}, {"oid": "cd85fb1291fd45dfd2fe1dc1ec862d1849492a86", "url": "https://github.com/uyuni-project/uyuni/commit/cd85fb1291fd45dfd2fe1dc1ec862d1849492a86", "message": "Changelog", "committedDate": "2020-04-17T15:36:58Z", "type": "commit"}, {"oid": "f01d448def43f8c71c9edd106b44b1fff3a524a9", "url": "https://github.com/uyuni-project/uyuni/commit/f01d448def43f8c71c9edd106b44b1fff3a524a9", "message": "Complete the javadoc", "committedDate": "2020-04-17T15:36:58Z", "type": "commit"}, {"oid": "71844774b2c513537311a9f26bb12662fe3bbccd", "url": "https://github.com/uyuni-project/uyuni/commit/71844774b2c513537311a9f26bb12662fe3bbccd", "message": "Minor: Integer .toString() can't lead to empty string", "committedDate": "2020-04-17T15:36:58Z", "type": "commit"}, {"oid": "c867eea3e00fdcd1f49136fe01d0726f3f0055e5", "url": "https://github.com/uyuni-project/uyuni/commit/c867eea3e00fdcd1f49136fe01d0726f3f0055e5", "message": "Address comments", "committedDate": "2020-04-17T15:36:58Z", "type": "commit"}, {"oid": "edf19e7839a52e9870104a8652ca98d849de16d1", "url": "https://github.com/uyuni-project/uyuni/commit/edf19e7839a52e9870104a8652ca98d849de16d1", "message": "Inject SystemQuery to the tests, adjust the JSON input mocking", "committedDate": "2020-04-17T15:36:58Z", "type": "commit"}, {"oid": "edf19e7839a52e9870104a8652ca98d849de16d1", "url": "https://github.com/uyuni-project/uyuni/commit/edf19e7839a52e9870104a8652ca98d849de16d1", "message": "Inject SystemQuery to the tests, adjust the JSON input mocking", "committedDate": "2020-04-17T15:36:58Z", "type": "forcePushed"}]}