{"pr_number": 2532, "pr_title": "Server side pagination with maintenance schedule system list page", "pr_createdAt": "2020-08-26T17:35:50Z", "pr_url": "https://github.com/uyuni-project/uyuni/pull/2532", "timeline": [{"oid": "bede2040d96496875186b3a57a97612727378901", "url": "https://github.com/uyuni-project/uyuni/commit/bede2040d96496875186b3a57a97612727378901", "message": "Redesign maintenance schedule systems table to use paginated data from server", "committedDate": "2020-08-26T18:25:51Z", "type": "forcePushed"}, {"oid": "979851c98d51bc714280b61eda8b5de2d6121c4a", "url": "https://github.com/uyuni-project/uyuni/commit/979851c98d51bc714280b61eda8b5de2d6121c4a", "message": "Redesign maintenance schedule systems table to use paginated data from server", "committedDate": "2020-08-27T10:53:30Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODk5NTgzNg==", "url": "https://github.com/uyuni-project/uyuni/pull/2532#discussion_r478995836", "bodyText": "would be better to not use the global. New pages tend to get it as a parameter of the renderer. I would leave that variable in the top levels components to ease removal of it in the future.", "author": "cbosdo", "createdAt": "2020-08-28T09:11:53Z", "path": "web/html/src/utils/data-endpoint.js", "diffHunk": "@@ -0,0 +1,131 @@\n+// @flow\n+\n+import {debounce} from 'lodash';\n+import {get} from './network';\n+\n+import type {Cancelable} from \"../utils/functions\";\n+\n+declare var userPrefPageSize: number;", "originalCommit": "c956da08dc6f2fdd8cef9c1cdbdf6a4dd38d0689", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTI1NzExNw==", "url": "https://github.com/uyuni-project/uyuni/pull/2532#discussion_r479257117", "bodyText": "Can you point me to an example page?", "author": "cbbayburt", "createdAt": "2020-08-28T12:52:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODk5NTgzNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQxMTQ3MA==", "url": "https://github.com/uyuni-project/uyuni/pull/2532#discussion_r479411470", "bodyText": "Here you go: https://github.com/uyuni-project/uyuni/blob/master/web/html/src/manager/virtualization/guests/list/guests-list.renderer.js", "author": "cbosdo", "createdAt": "2020-08-28T16:28:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODk5NTgzNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTAxNTkxOA==", "url": "https://github.com/uyuni-project/uyuni/pull/2532#discussion_r479015918", "bodyText": "Not sure that is of any use here, but usually REST paginated APIs embed an URL to the next and/or previous pages and the page number.", "author": "cbosdo", "createdAt": "2020-08-28T09:25:16Z", "path": "java/code/src/com/suse/manager/webui/utils/gson/PagedDataResultJson.java", "diffHunk": "@@ -0,0 +1,51 @@\n+/**\n+ * Copyright (c) 2020 SUSE LLC\n+ *\n+ * This software is licensed to you under the GNU General Public License,\n+ * version 2 (GPLv2). There is NO WARRANTY for this software, express or\n+ * implied, including the implied warranties of MERCHANTABILITY or FITNESS\n+ * FOR A PARTICULAR PURPOSE. You should have received a copy of GPLv2\n+ * along with this software; if not, see\n+ * http://www.gnu.org/licenses/old-licenses/gpl-2.0.txt.\n+ *\n+ * Red Hat trademarks are not licensed under GPLv2. No permission is\n+ * granted to use or replicate Red Hat trademarks that are incorporated\n+ * in this software or its documentation.\n+ */\n+\n+package com.suse.manager.webui.utils.gson;\n+\n+import com.redhat.rhn.common.db.datasource.DataResult;\n+\n+import java.util.List;\n+\n+/**\n+ * JSON wrapper class to hold paginated data\n+ *\n+ * @param <T> the type of the data items\n+ */\n+public class PagedDataResultJson<T> {\n+\n+    private List<T> items;\n+    private long total;", "originalCommit": "c60cc5fba0b1d2f5cc8f0b7e66b61bb544fb62a7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTI1NjUwMQ==", "url": "https://github.com/uyuni-project/uyuni/pull/2532#discussion_r479256501", "bodyText": "We also need it to display the total number in the UI, and in this case, this is enough to calculate the next/prev pages", "author": "cbbayburt", "createdAt": "2020-08-28T12:52:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTAxNTkxOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTI1MDQzNQ==", "url": "https://github.com/uyuni-project/uyuni/pull/2532#discussion_r479250435", "bodyText": "I know it's a copy/paste from TableDataHandler but would be nice to get rid of the UNSAFE_* functions in that code", "author": "cbosdo", "createdAt": "2020-08-28T12:44:43Z", "path": "web/html/src/components/table/AsyncDataHandler.js", "diffHunk": "@@ -0,0 +1,318 @@\n+// @flow\n+import * as React from 'react';\n+\n+import {Utils} from \"utils/functions\";\n+import {ApiDataEndpoint, PageControl} from '../../utils/data-endpoint';\n+import { StatePersistedContext } from '../utils/StatePersistedContext';\n+\n+import { ItemsPerPageSelector } from '../pagination';\n+import { PaginationBlock } from '../pagination';\n+import { SearchPanel } from './SearchPanel';\n+import { SearchField } from './SearchField';\n+import { Header } from './Header';\n+\n+type ChildrenArgsProps = {\n+  currItems: Array<any>,\n+  headers: React.Node,\n+  handleSelect: Function,\n+  selectable: boolean,\n+  selectedItems: Array<any>,\n+  criteria?: string,\n+}\n+\n+type Props = {\n+  columns: Array<React.ElementRef<any>>,\n+  /** the async resource endpoint to retrieve the paged data from */\n+  resource: string,\n+  /** Function extracting the unique key of the row from the data object */\n+  identifier: Function,\n+  /** the column key name of the initial sorted column */\n+  initialSortColumnKey?: string,\n+  /** 1 for ascending, -1 for descending */\n+  initialSortDirection?: number,\n+  /** the React Object that contains the filter search field */\n+  searchField?: React.Element<typeof SearchField>,\n+  /** the initial number of how many row-per-page to show. If it's 0 table header and footer are hidden */\n+  initialItemsPerPage?: number,\n+  /** enables item selection */\n+  selectable: boolean,\n+  /** the handler to call when the table selection is updated. If not provided, the select boxes won't be rendered */\n+  onSelect?: (items: Array<any>) => void,\n+  /** the identifiers for selected items */\n+  selectedItems?: Array<any>,\n+  /** The message which is shown when there are no rows to display */\n+  emptyText?: string,\n+  /** The message which is shown when the data is loading */\n+  loadingText?: string,\n+  /** Children node in the table */\n+  children: (args: ChildrenArgsProps) => React.Node,\n+};\n+\n+type State = {\n+  data: Array<any>,\n+  currentPage: number,\n+  itemsPerPage: number,\n+  totalItems: number,\n+  criteria?: string,\n+  sortColumnKey: string | null,\n+  sortDirection: number,\n+  selectedItems: Array<any>,\n+  selectable: boolean,\n+  loading: boolean,\n+  endpoint: ApiDataEndpoint\n+};\n+\n+export class AsyncDataHandler extends React.Component<Props, State> {\n+  static defaultProps = {\n+    selectable: false,\n+    columns: [],\n+  };\n+\n+  static contextType = StatePersistedContext;\n+\n+  constructor(props: Props) {\n+    super(props);\n+    this.state = {\n+      data: [],\n+      currentPage: 1,\n+      itemsPerPage: this.props.initialItemsPerPage || 15,\n+      totalItems: 0,\n+      criteria: undefined,\n+      sortColumnKey: this.props.initialSortColumnKey || null,\n+      sortDirection: this.props.initialSortDirection || 1,\n+      selectedItems: this.props.selectedItems || [],\n+      selectable: this.props.selectable,\n+      loading: false,\n+      endpoint: new ApiDataEndpoint(new URL(this.props.resource, window.location.origin))\n+    };\n+  };\n+\n+  getData() {\n+    const currPage = (this.state.currentPage - 1) * this.state.itemsPerPage + 1;\n+    const pageControl = new PageControl(currPage, this.state.itemsPerPage,\n+      this.state.criteria, this.state.sortColumnKey, this.state.sortDirection);\n+\n+    this.setState({loading: true}, () => {\n+      this.state.endpoint.get(promise => {\n+        promise.then(data => this.updateData(data))\n+          .finally(() => this.setState({loading: false}));\n+        }, pageControl);\n+    });\n+  }\n+\n+  updateData({items, total}: {items: Array<any>, total: number}) {\n+    this.setState({data: items, totalItems: total}, () => {\n+      const lastPage = this.getLastPage();\n+      if (this.state.currentPage > lastPage) {\n+        this.setState({currentPage: lastPage});\n+      }\n+    });\n+  }\n+\n+  UNSAFE_componentWillReceiveProps(nextProps: Props) {\n+    this.setState({\n+        selectedItems: nextProps.selectedItems || [],\n+        selectable: Boolean(nextProps.selectable)\n+    });\n+  };", "originalCommit": "2463a2c170835a1d203b815c58086d222cb35044", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTI1MzUxMg==", "url": "https://github.com/uyuni-project/uyuni/pull/2532#discussion_r479253512", "bodyText": "Most of these are common with TableDataHandler. I would rather see the TableDataHandler code refactored to accept something like a dataProvider property pointing to another component responsible for getting the data either asynchronously with your code or using preprovided data as we already have.", "author": "cbosdo", "createdAt": "2020-08-28T12:48:18Z", "path": "web/html/src/components/table/AsyncDataHandler.js", "diffHunk": "@@ -0,0 +1,318 @@\n+// @flow\n+import * as React from 'react';\n+\n+import {Utils} from \"utils/functions\";\n+import {ApiDataEndpoint, PageControl} from '../../utils/data-endpoint';\n+import { StatePersistedContext } from '../utils/StatePersistedContext';\n+\n+import { ItemsPerPageSelector } from '../pagination';\n+import { PaginationBlock } from '../pagination';\n+import { SearchPanel } from './SearchPanel';\n+import { SearchField } from './SearchField';\n+import { Header } from './Header';\n+\n+type ChildrenArgsProps = {\n+  currItems: Array<any>,\n+  headers: React.Node,\n+  handleSelect: Function,\n+  selectable: boolean,\n+  selectedItems: Array<any>,\n+  criteria?: string,\n+}\n+\n+type Props = {\n+  columns: Array<React.ElementRef<any>>,\n+  /** the async resource endpoint to retrieve the paged data from */\n+  resource: string,\n+  /** Function extracting the unique key of the row from the data object */\n+  identifier: Function,\n+  /** the column key name of the initial sorted column */\n+  initialSortColumnKey?: string,\n+  /** 1 for ascending, -1 for descending */\n+  initialSortDirection?: number,\n+  /** the React Object that contains the filter search field */\n+  searchField?: React.Element<typeof SearchField>,\n+  /** the initial number of how many row-per-page to show. If it's 0 table header and footer are hidden */\n+  initialItemsPerPage?: number,\n+  /** enables item selection */\n+  selectable: boolean,\n+  /** the handler to call when the table selection is updated. If not provided, the select boxes won't be rendered */\n+  onSelect?: (items: Array<any>) => void,\n+  /** the identifiers for selected items */\n+  selectedItems?: Array<any>,\n+  /** The message which is shown when there are no rows to display */\n+  emptyText?: string,\n+  /** The message which is shown when the data is loading */\n+  loadingText?: string,\n+  /** Children node in the table */\n+  children: (args: ChildrenArgsProps) => React.Node,\n+};\n+\n+type State = {\n+  data: Array<any>,\n+  currentPage: number,\n+  itemsPerPage: number,\n+  totalItems: number,\n+  criteria?: string,\n+  sortColumnKey: string | null,\n+  sortDirection: number,\n+  selectedItems: Array<any>,\n+  selectable: boolean,\n+  loading: boolean,\n+  endpoint: ApiDataEndpoint\n+};", "originalCommit": "2463a2c170835a1d203b815c58086d222cb35044", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODk0MTQ0MQ==", "url": "https://github.com/uyuni-project/uyuni/pull/2532#discussion_r478941441", "bodyText": "Awesome. Thanks for adding tests. We need more of these \ud83d\ude04", "author": "parlt91", "createdAt": "2020-08-28T08:30:30Z", "path": "web/html/src/utils/data-endpoint.test.js", "diffHunk": "@@ -0,0 +1,148 @@\n+// Fix for node 8. Can be removed on node 10 or later\n+import \"@babel/polyfill\";\n+\n+import {ApiDataEndpoint, PageControl} from './data-endpoint';\n+import {Utils} from './functions';\n+import * as Network from './network';\n+\n+jest.mock('./network');\n+\n+const PATH = \"/my/test/url\";\n+const ORIGIN = \"https://my.domain\";\n+\n+test(\"Page control initialization\", () => {", "originalCommit": "c956da08dc6f2fdd8cef9c1cdbdf6a4dd38d0689", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjEyNzY3OA==", "url": "https://github.com/uyuni-project/uyuni/pull/2532#discussion_r486127678", "bodyText": "Yeah, kudos to that! I hope this is going to become a standard for all front-end contributions soon!", "author": "hustodemon", "createdAt": "2020-09-10T07:35:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODk0MTQ0MQ=="}], "type": "inlineReview"}, {"oid": "703fb9b168a659d1bc16df18215282f52de67f67", "url": "https://github.com/uyuni-project/uyuni/commit/703fb9b168a659d1bc16df18215282f52de67f67", "message": "Merge table implementations using data providers", "committedDate": "2020-09-04T13:47:08Z", "type": "forcePushed"}, {"oid": "e61a30f3009a829d19e3e036d7c5cf220030dff9", "url": "https://github.com/uyuni-project/uyuni/commit/e61a30f3009a829d19e3e036d7c5cf220030dff9", "message": "Merge table implementations using data providers", "committedDate": "2020-09-04T15:18:14Z", "type": "forcePushed"}, {"oid": "2b95382e86828712ccc46d2842cab1c5f30458e2", "url": "https://github.com/uyuni-project/uyuni/commit/2b95382e86828712ccc46d2842cab1c5f30458e2", "message": "Merge table implementations using data providers", "committedDate": "2020-09-09T12:43:26Z", "type": "forcePushed"}, {"oid": "cf15ccf9ba2f7a5a9a008f149920f01a1761732d", "url": "https://github.com/uyuni-project/uyuni/commit/cf15ccf9ba2f7a5a9a008f149920f01a1761732d", "message": "Merge table implementations using data providers", "committedDate": "2020-09-09T12:45:29Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjExNjE3Mw==", "url": "https://github.com/uyuni-project/uyuni/pull/2532#discussion_r486116173", "bodyText": "Shouldn't the 2nd page only contain one item? 2 items on the 1st page, 1 item on the 2nd one.", "author": "hustodemon", "createdAt": "2020-09-10T07:14:32Z", "path": "java/code/src/com/suse/manager/webui/utils/test/PageControlHelperTest.java", "diffHunk": "@@ -0,0 +1,289 @@\n+package com.suse.manager.webui.utils.test;\n+\n+import com.redhat.rhn.common.db.datasource.DataResult;\n+import com.redhat.rhn.frontend.listview.PageControl;\n+import com.suse.manager.webui.utils.PageControlHelper;\n+import com.suse.manager.webui.utils.SparkTestUtils;\n+import junit.framework.TestCase;\n+\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+public class PageControlHelperTest extends TestCase {\n+\n+    private static final String REQUEST_URL = \"https://pagecontrol.test\";\n+\n+    public void testRequestWithNoParams() {\n+        PageControlHelper helper = new PageControlHelper(SparkTestUtils.createMockRequest(REQUEST_URL));\n+\n+        assertEquals(1, helper.getStart());\n+        assertEquals(0, helper.getPageSize());\n+        assertNull(helper.getQuery());\n+        assertNull(helper.getQueryColumn());\n+        assertNull(helper.getSortDirection());\n+        assertNull(helper.getSortColumn());\n+        assertNull(helper.getFunction());\n+    }\n+\n+    public void testRequestWithPageParams() {\n+        Map<String, String> queryParams = new HashMap<>();\n+        // Start index and page size\n+        queryParams.put(\"p\", \"5\");\n+        queryParams.put(\"ps\", \"10\");\n+\n+        PageControlHelper helper = new PageControlHelper(SparkTestUtils.createMockRequestWithParams(REQUEST_URL,\n+                queryParams),\"mydefaultproperty\");\n+\n+        assertEquals(5, helper.getStart());\n+        assertEquals(10, helper.getPageSize());\n+        assertNull(helper.getQuery());\n+        assertNull(helper.getQueryColumn());\n+        assertNull(helper.getSortDirection());\n+        assertNull(helper.getSortColumn());\n+        assertNull(helper.getFunction());\n+    }\n+\n+    public void testRequestWithFilterParams() {\n+        Map<String, String> queryParams = new HashMap<>();\n+        // Start index and page size\n+        queryParams.put(\"p\", \"5\");\n+        queryParams.put(\"ps\", \"10\");\n+        // Filter string and column\n+        queryParams.put(\"q\", \"mystring\");\n+        queryParams.put(\"qc\", \"myproperty\");\n+\n+        PageControlHelper helper = new PageControlHelper(SparkTestUtils.createMockRequestWithParams(REQUEST_URL,\n+                queryParams), \"mydefaultproperty\");\n+\n+        assertEquals(5, helper.getStart());\n+        assertEquals(10, helper.getPageSize());\n+        assertEquals(\"mystring\", helper.getQuery());\n+        assertEquals(\"myproperty\", helper.getQueryColumn());\n+        assertNull(helper.getSortDirection());\n+        assertNull(helper.getSortColumn());\n+        assertNull(helper.getFunction());\n+    }\n+\n+    public void testRequestWithSortParams() {\n+        Map<String, String> queryParams = new HashMap<>();\n+        // Start index and page size\n+        queryParams.put(\"p\", \"5\");\n+        queryParams.put(\"ps\", \"10\");\n+        // Sort direction and column\n+        queryParams.put(\"s\", \"1\");\n+        queryParams.put(\"sc\", \"mysortproperty\");\n+\n+        PageControlHelper helper = new PageControlHelper(SparkTestUtils.createMockRequestWithParams(REQUEST_URL,\n+                queryParams), \"mydefaultproperty\");\n+\n+        assertEquals(5, helper.getStart());\n+        assertEquals(10, helper.getPageSize());\n+        assertNull(helper.getQuery());\n+        assertNull(helper.getQueryColumn());\n+        assertEquals(\"1\", helper.getSortDirection());\n+        assertEquals(\"mysortproperty\", helper.getSortColumn());\n+        assertNull(helper.getFunction());\n+    }\n+\n+    public void testRequestWithFunctionParam() {\n+        Map<String, String> queryParams = new HashMap<>();\n+        // Function\n+        queryParams.put(\"f\", \"myfunction\");\n+\n+        PageControlHelper helper = new PageControlHelper(SparkTestUtils.createMockRequestWithParams(REQUEST_URL,\n+                queryParams), \"mydefaultproperty\");\n+\n+        assertEquals(1, helper.getStart());\n+        assertEquals(0, helper.getPageSize());\n+        assertNull(helper.getQuery());\n+        assertNull(helper.getQueryColumn());\n+        assertNull(helper.getSortDirection());\n+        assertNull(helper.getSortColumn());\n+        assertEquals(\"myfunction\", helper.getFunction());\n+    }\n+\n+    public void testRequestWithDefaultFilterColumn() {\n+        Map<String, String> queryParams = new HashMap<>();\n+        // Start index and page size\n+        queryParams.put(\"p\", \"5\");\n+        queryParams.put(\"ps\", \"10\");\n+        // Filter string\n+        queryParams.put(\"q\", \"mystring\");\n+\n+        PageControlHelper helper = new PageControlHelper(SparkTestUtils.createMockRequestWithParams(REQUEST_URL,\n+                queryParams), \"mydefaultproperty\");\n+\n+        assertEquals(5, helper.getStart());\n+        assertEquals(10, helper.getPageSize());\n+        assertEquals(\"mystring\", helper.getQuery());\n+        assertEquals(\"mydefaultproperty\", helper.getQueryColumn());\n+    }\n+\n+    public void testPageControlWithNoParams() {\n+        PageControlHelper helper = new PageControlHelper(SparkTestUtils.createMockRequest(REQUEST_URL));\n+        PageControl pc = helper.getPageControl();\n+\n+        assertEquals(1, pc.getStart());\n+        assertEquals(0, pc.getEnd());\n+        assertFalse(pc.hasFilter());\n+        assertNull(pc.getFilterData());\n+        assertNull(pc.getFilterColumn());\n+    }\n+\n+    public void testPageControlWithPageParams() {\n+        Map<String, String> queryParams = new HashMap<>();\n+        // Start index and page size\n+        queryParams.put(\"p\", \"5\");\n+        queryParams.put(\"ps\", \"10\");\n+\n+        PageControlHelper helper = new PageControlHelper(SparkTestUtils.createMockRequestWithParams(REQUEST_URL,\n+                queryParams),\"mydefaultproperty\");\n+        PageControl pc = helper.getPageControl();\n+\n+        assertEquals(5, pc.getStart());\n+        assertEquals(14, pc.getEnd());\n+        assertFalse(pc.hasFilter());\n+        assertNull(pc.getFilterData());\n+        assertNull(pc.getFilterColumn());\n+    }\n+\n+    public void testPageControlWithFilterParams() {\n+        Map<String, String> queryParams = new HashMap<>();\n+        // Start index and page size\n+        queryParams.put(\"p\", \"5\");\n+        queryParams.put(\"ps\", \"10\");\n+        // Filter string and column\n+        queryParams.put(\"q\", \"mystring\");\n+        queryParams.put(\"qc\", \"myproperty\");\n+\n+        PageControlHelper helper = new PageControlHelper(SparkTestUtils.createMockRequestWithParams(REQUEST_URL,\n+                queryParams), \"mydefaultproperty\");\n+        PageControl pc = helper.getPageControl();\n+\n+        assertEquals(5, pc.getStart());\n+        assertEquals(14, pc.getEnd());\n+        assertTrue(pc.hasFilter());\n+        assertEquals(\"mystring\", pc.getFilterData());\n+        assertEquals(\"myproperty\", pc.getFilterColumn());\n+    }\n+\n+    public class PagedDataItem {\n+        private int firstProperty;\n+        private String secondProperty;\n+\n+        PagedDataItem(int firstProperty, String secondProperty) {\n+            this.firstProperty = firstProperty;\n+            this.secondProperty = secondProperty;\n+        }\n+\n+        public int getFirstProperty() {\n+            return firstProperty;\n+        }\n+\n+        public String getSecondProperty() {\n+            return secondProperty;\n+        }\n+    }\n+\n+    public void testApplySort() {\n+        Map<String, String> queryParams = new HashMap<>();\n+        // Start index and page size\n+        queryParams.put(\"p\", \"5\");\n+        queryParams.put(\"ps\", \"10\");\n+\n+        PageControlHelper helper = new PageControlHelper(SparkTestUtils.createMockRequestWithParams(REQUEST_URL,\n+                queryParams), \"mydefaultproperty\");\n+\n+        List<PagedDataItem> unsortedList = Arrays.asList(\n+                new PagedDataItem(2, \"two\"),\n+                new PagedDataItem(1, \"one\"),\n+                new PagedDataItem(3, \"three\"));\n+\n+        List<PagedDataItem> listToSort = new ArrayList<>(unsortedList);\n+        helper.applySort(listToSort);\n+\n+        // No sorting should be performed unless the sort column is specified\n+        assertEquals(unsortedList, listToSort);\n+\n+        // Sort column (number)\n+        queryParams.put(\"sc\", \"firstProperty\");\n+        helper = new PageControlHelper(SparkTestUtils.createMockRequestWithParams(REQUEST_URL, queryParams),\n+                \"mydefaultproperty\");\n+        helper.applySort(listToSort);\n+\n+        // Should be sorted in ascending order by default\n+        assertEquals(1, listToSort.get(0).firstProperty);\n+        assertEquals(2, listToSort.get(1).firstProperty);\n+        assertEquals(3, listToSort.get(2).firstProperty);\n+\n+        // Sort direction (descending) and column (alpha)\n+        queryParams.put(\"s\", \"-1\");\n+        queryParams.put(\"sc\", \"secondProperty\");\n+        helper = new PageControlHelper(SparkTestUtils.createMockRequestWithParams(REQUEST_URL, queryParams),\n+                \"mydefaultproperty\");\n+        listToSort = new ArrayList<>(unsortedList);\n+        helper.applySort(listToSort);\n+\n+        assertEquals(\"two\", listToSort.get(0).secondProperty);\n+        assertEquals(\"three\", listToSort.get(1).secondProperty);\n+        assertEquals(\"one\", listToSort.get(2).secondProperty);\n+    }\n+\n+    public void testProcessPageControl() {\n+        DataResult<PagedDataItem> testData = new DataResult<>(Arrays.asList(\n+                new PagedDataItem(1, \"angel\"),\n+                new PagedDataItem(2, \"apple\"),\n+                new PagedDataItem(3, \"orange\"),\n+                new PagedDataItem(4, \"ranger\")\n+        ));\n+\n+        Map<String, String> queryParams = new HashMap<>();\n+        // Start index and page size\n+        queryParams.put(\"p\", \"2\");\n+        queryParams.put(\"ps\", \"2\");\n+\n+        PageControlHelper helper = new PageControlHelper(SparkTestUtils.createMockRequestWithParams(REQUEST_URL,\n+                queryParams), \"mydefaultproperty\");\n+\n+        DataResult<PagedDataItem> result = helper.processPageControl(testData);\n+\n+        assertEquals(2, result.size());\n+        assertEquals(4, result.getTotalSize());\n+        assertEquals(2, result.getStart());\n+        assertEquals(3, result.getEnd());\n+        assertEquals(\"apple\", result.get(0).secondProperty);\n+        assertEquals(\"orange\", result.get(1).secondProperty);\n+    }\n+\n+    public void testProcessPageControlFiltered() {\n+        DataResult<PagedDataItem> testData = new DataResult<>(Arrays.asList(\n+                new PagedDataItem(1, \"angel\"),\n+                new PagedDataItem(2, \"apple\"),\n+                new PagedDataItem(3, \"orange\"),\n+                new PagedDataItem(4, \"ranger\")\n+        ));\n+\n+        Map<String, String> queryParams = new HashMap<>();\n+        // Start index and page size\n+        queryParams.put(\"p\", \"2\");\n+        queryParams.put(\"ps\", \"2\");\n+        // Filter string and column\n+        queryParams.put(\"q\", \"ang\");\n+        queryParams.put(\"qc\", \"secondProperty\");\n+\n+        PageControlHelper helper = new PageControlHelper(SparkTestUtils.createMockRequestWithParams(REQUEST_URL,\n+                queryParams), \"mydefaultproperty\");\n+\n+        DataResult<PagedDataItem> result = helper.processPageControl(testData);\n+\n+        assertEquals(2, result.size());", "originalCommit": "1416a5759e326688434bc9f7b8d156ccc1a17b83", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjc4NjQzMw==", "url": "https://github.com/uyuni-project/uyuni/pull/2532#discussion_r492786433", "bodyText": "No, the parameter p is actually for the start index (counting from 1), not the actual page number.", "author": "cbbayburt", "createdAt": "2020-09-22T14:35:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjExNjE3Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjgxNDY5NA==", "url": "https://github.com/uyuni-project/uyuni/pull/2532#discussion_r486814694", "bodyText": "Would it make sense to make the applySort part of processPageControl (and even make it private (or \"public for testing only\"))?", "author": "hustodemon", "createdAt": "2020-09-11T07:02:10Z", "path": "java/code/src/com/suse/manager/webui/controllers/maintenance/MaintenanceScheduleController.java", "diffHunk": "@@ -255,11 +266,112 @@ public static String delete(Request request, Response response, User user) {\n         return json(response, ResultJson.success());\n     }\n \n+    /**\n+     * Returns a list of system IDs assigned to a specified maintenance schedule\n+     *\n+     * @param request the Spark request\n+     * @param response the Spark response\n+     * @param user the authorized user\n+     * @return the JSON list of system IDs\n+     */\n+    public static String assignedSystems(Request request, Response response, User user) {\n+        response.type(\"application/json\");\n+        Long scheduleId = Long.parseLong(request.params(\"id\"));\n+        List<Long> systemIds = new ArrayList<>();\n+        MM.lookupScheduleByUserAndId(user, scheduleId).ifPresentOrElse(\n+                schedule -> {\n+                    List<EssentialServerDto> systems = SystemManager.systemsInSchedule(user, schedule, null);\n+                    systemIds.addAll(systems.stream().map(EssentialServerDto::getId).collect(Collectors.toList()));\n+                },\n+                () -> Spark.halt(HttpStatus.SC_NOT_FOUND)\n+        );\n+        return json(response, systemIds);\n+    }\n+\n+    /**\n+     * Returns a paged list of systems visible to a user and their assigned schedules\n+     *\n+     * @param request the Spark request\n+     * @param response the Spark response\n+     * @param user the authorized user\n+     * @return the JSON response\n+     */\n+    public static String systemSchedules(Request request, Response response, User user) {\n+        response.type(\"application/json\");\n+        PageControlHelper pageHelper = new PageControlHelper(request, \"name\");\n+\n+        DataResult<SystemScheduleDto> systems = SystemManager.systemListWithSchedules(user, null);\n+\n+        if (\"id\".equals(pageHelper.getFunction())) {\n+            // Return only IDs for \"select all\" function\n+            return json(response, systems.stream().map(SystemScheduleDto::getId).collect(Collectors.toList()));\n+        }\n+\n+        pageHelper.applySort(systems);\n+        systems = pageHelper.processPageControl(systems, new HashMap<>());", "originalCommit": "cf15ccf9ba2f7a5a9a008f149920f01a1761732d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjc5MjUxMA==", "url": "https://github.com/uyuni-project/uyuni/pull/2532#discussion_r492792510", "bodyText": "Right, I guess I had a reason for this in the early implementation, but it doesn't seem to be valid anymore. Thanks!", "author": "cbbayburt", "createdAt": "2020-09-22T14:43:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjgxNDY5NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQwNzg5Nw==", "url": "https://github.com/uyuni-project/uyuni/pull/2532#discussion_r489407897", "bodyText": "Again the ugly global... \ud83e\udd22", "author": "cbosdo", "createdAt": "2020-09-16T12:45:54Z", "path": "web/html/src/utils/data-providers/page-control.js", "diffHunk": "@@ -0,0 +1,29 @@\n+// @flow\n+\n+declare var userPrefPageSize: number;", "originalCommit": "8cf47291563e4f91a5611cf64208ba4e8b2b48ac", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjc5Nzk0Ng==", "url": "https://github.com/uyuni-project/uyuni/pull/2532#discussion_r492797946", "bodyText": "Now I'm using the mixin provided from jade \ud83d\udc4d", "author": "cbbayburt", "createdAt": "2020-09-22T14:49:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQwNzg5Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQwOTg3OA==", "url": "https://github.com/uyuni-project/uyuni/pull/2532#discussion_r489409878", "bodyText": "Would be easier to read with a ComparatorType. And that type would be reused further down too", "author": "cbosdo", "createdAt": "2020-09-16T12:49:09Z", "path": "web/html/src/utils/data-providers/simple-data-provider.js", "diffHunk": "@@ -0,0 +1,59 @@\n+// @flow\n+\n+import PageControl from './page-control';\n+\n+type PagedData = {\n+  items: Array<any>,\n+  total: number\n+};\n+\n+export default class SimpleDataProvider {\n+  data: Array<any>;\n+  identifier: (row: any) => any;\n+  filter: ?(row: any, criteria: string) => boolean;\n+  comparators: ?{column: (a: any, b: any, key: string, direction: number) => number};", "originalCommit": "8cf47291563e4f91a5611cf64208ba4e8b2b48ac", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjc5NzY2NA==", "url": "https://github.com/uyuni-project/uyuni/pull/2532#discussion_r492797664", "bodyText": "\ud83d\udc4d", "author": "cbbayburt", "createdAt": "2020-09-22T14:49:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQwOTg3OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQxNjMxNw==", "url": "https://github.com/uyuni-project/uyuni/pull/2532#discussion_r489416317", "bodyText": "I like that approach. Thanks for the hard work on it \ud83d\udc4f", "author": "cbosdo", "createdAt": "2020-09-16T12:58:57Z", "path": "web/html/src/components/table/TableDataHandler.js", "diffHunk": "@@ -18,16 +21,27 @@ type ChildrenArgsProps = {\n \n type Props = {\n   columns: Array<React.ElementRef<any>>,\n-  /** any type of data in an array, where each element is a row data */\n-  data: Array<any>,\n+  /**\n+   * Either an array of data items of any type where each element is a row data,\n+   * or a URI string to a resource endpoint that returns a paged list of data items.\n+   *\n+   * The data returned from the endpoint must be in paginated form as the following:\n+   * ```\n+   * {\n+   *    items: [..],\n+   *    total: TOTAL_ITEMS\n+   * }\n+   * ```\n+   *\n+   * See: utils/data-providers/paged-data-endpoint.js for async usage", "originalCommit": "cf15ccf9ba2f7a5a9a008f149920f01a1761732d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "ece622fced5ade987b5ffaaa7d4e09ee36aef755", "url": "https://github.com/uyuni-project/uyuni/commit/ece622fced5ade987b5ffaaa7d4e09ee36aef755", "message": "Reuse types from 'data-providers' module", "committedDate": "2020-09-22T14:46:23Z", "type": "forcePushed"}, {"oid": "e9fb413ba40f53475f993b0b861afc7d8c3ab2dc", "url": "https://github.com/uyuni-project/uyuni/commit/e9fb413ba40f53475f993b0b861afc7d8c3ab2dc", "message": "Reuse types from 'data-providers' module", "committedDate": "2020-09-22T15:28:24Z", "type": "forcePushed"}, {"oid": "bc0c3007846892d18495734e327ad913cf18c45f", "url": "https://github.com/uyuni-project/uyuni/commit/bc0c3007846892d18495734e327ad913cf18c45f", "message": "Implement ApiDataEndpoint JS module to make paginated data requests", "committedDate": "2020-09-22T20:42:35Z", "type": "commit"}, {"oid": "474a683052954cc6cf1a11576d9fea459a997b7b", "url": "https://github.com/uyuni-project/uyuni/commit/474a683052954cc6cf1a11576d9fea459a997b7b", "message": "Add Java backend helpers for ApiDataEndpoint module", "committedDate": "2020-09-22T20:42:39Z", "type": "commit"}, {"oid": "9856119719d25c20e2498b6629cc1f2c185763ed", "url": "https://github.com/uyuni-project/uyuni/commit/9856119719d25c20e2498b6629cc1f2c185763ed", "message": "Implement AsyncTable component using ApiDataEndpoint for server-side pagination\n\nMost logic for AsyncTable.js and AsyncDataHandler.js was duplicated from\nTable.js and TableDataHandler.js", "committedDate": "2020-09-22T20:42:39Z", "type": "commit"}, {"oid": "901b87a9213335fad4688945356eec8440265c17", "url": "https://github.com/uyuni-project/uyuni/commit/901b87a9213335fad4688945356eec8440265c17", "message": "Redesign maintenance schedule systems table to use paginated data from server", "committedDate": "2020-09-22T20:43:15Z", "type": "commit"}, {"oid": "1492cf7a17152d31941f7ce9b7c80ed17f3787ff", "url": "https://github.com/uyuni-project/uyuni/commit/1492cf7a17152d31941f7ce9b7c80ed17f3787ff", "message": "Implement 'data-providers' module", "committedDate": "2020-09-22T20:43:16Z", "type": "commit"}, {"oid": "becb0234330fa55ca2730da273e0bfa0d7d0fe9d", "url": "https://github.com/uyuni-project/uyuni/commit/becb0234330fa55ca2730da273e0bfa0d7d0fe9d", "message": "Merge table implementations using data providers", "committedDate": "2020-09-22T20:43:16Z", "type": "commit"}, {"oid": "e66b23c02e67734e0536e518d510e213abc38632", "url": "https://github.com/uyuni-project/uyuni/commit/e66b23c02e67734e0536e518d510e213abc38632", "message": "Use 'userPreferences' jade mixin for default page size in tables", "committedDate": "2020-09-22T20:43:16Z", "type": "commit"}, {"oid": "cd06fadcda0a0d8974727ee578c0bae16db60010", "url": "https://github.com/uyuni-project/uyuni/commit/cd06fadcda0a0d8974727ee578c0bae16db60010", "message": "Reuse types from 'data-providers' module", "committedDate": "2020-09-22T20:43:17Z", "type": "commit"}, {"oid": "cd06fadcda0a0d8974727ee578c0bae16db60010", "url": "https://github.com/uyuni-project/uyuni/commit/cd06fadcda0a0d8974727ee578c0bae16db60010", "message": "Reuse types from 'data-providers' module", "committedDate": "2020-09-22T20:43:17Z", "type": "forcePushed"}]}