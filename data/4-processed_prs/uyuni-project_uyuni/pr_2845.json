{"pr_number": 2845, "pr_title": "QA: Refactor extraction of logs to support QAM clients", "pr_createdAt": "2020-11-12T15:37:11Z", "pr_url": "https://github.com/uyuni-project/uyuni/pull/2845", "timeline": [{"oid": "3a4c3ce26476058280ddf171da55eae5c5ada62c", "url": "https://github.com/uyuni-project/uyuni/commit/3a4c3ce26476058280ddf171da55eae5c5ada62c", "message": "QA: Refactor extraction of logs to support QAM clients", "committedDate": "2020-11-12T15:38:46Z", "type": "forcePushed"}, {"oid": "ef2a0d7d41379eb392221d33d28418b72a9629d8", "url": "https://github.com/uyuni-project/uyuni/commit/ef2a0d7d41379eb392221d33d28418b72a9629d8", "message": "QA: Refactor extraction of logs to support QAM clients", "committedDate": "2020-11-12T15:39:09Z", "type": "forcePushed"}, {"oid": "28568207ba7d532741f68f23a5d0de4e6719b27f", "url": "https://github.com/uyuni-project/uyuni/commit/28568207ba7d532741f68f23a5d0de4e6719b27f", "message": "QA: Refactor extraction of logs to support QAM clients", "committedDate": "2020-11-12T15:41:01Z", "type": "forcePushed"}, {"oid": "e9345b5c90d79d581fd3a5a835b28a2265c4b4f5", "url": "https://github.com/uyuni-project/uyuni/commit/e9345b5c90d79d581fd3a5a835b28a2265c4b4f5", "message": "QA: Refactor extraction of logs to support QAM clients", "committedDate": "2020-11-12T15:42:31Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjIwNTg4Mw==", "url": "https://github.com/uyuni-project/uyuni/pull/2845#discussion_r522205883", "bodyText": "This might fail in SLES11 nodes, right? \ud83e\udd14", "author": "srbarrios", "createdAt": "2020-11-12T15:44:35Z", "path": "testsuite/features/support/commonlib.rb", "diffHunk": "@@ -228,3 +228,16 @@ def generate_repository_name(repo_url)\n   repo_name.delete_prefix! 'http://minima-mirror-qam.mgr.prv.suse.net/ibs/SUSE:/Maintenance:/'\n   repo_name\n end\n+\n+def extract_logs_from_node(node)\n+  _os_version, os_family = get_os_version(node)\n+  if os_family =~ /^opensuse/\n+    node.run('zypper mr --enable os_pool_repo os_update_repo') unless $qam_test\n+    node.run('zypper --non-interactive install tar')\n+    node.run('zypper mr --disable os_pool_repo os_update_repo') unless $qam_test\n+  end\n+  node.run(\"journalctl > /var/log/messages && (tar cfvJP /tmp/#{node.full_hostname}-logs.tar.xz /var/log/ || [[ $? -eq 1 ]])\")", "originalCommit": "e9345b5c90d79d581fd3a5a835b28a2265c4b4f5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjIxMTYwNA==", "url": "https://github.com/uyuni-project/uyuni/pull/2845#discussion_r522211604", "bodyText": "No idea.", "author": "Bischoff", "createdAt": "2020-11-12T15:51:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjIwNTg4Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjIxMjQ5MQ==", "url": "https://github.com/uyuni-project/uyuni/pull/2845#discussion_r522212491", "bodyText": "I don't think we have used until now a global variable $nodes.\nThis PR gives a good point to add one.", "author": "calancha", "createdAt": "2020-11-12T15:52:37Z", "path": "testsuite/features/step_definitions/command_steps.rb", "diffHunk": "@@ -324,16 +324,12 @@\n   raise \"Download debug file failed\" unless code.zero?\n end\n \n-Then(/^I get logfiles from \"([^\"]*)\"$/) do |target|\n-  node = get_target(target)\n-  os_version, os_family = get_os_version(node)\n-  if os_family =~ /^opensuse/\n-    node.run('zypper mr --enable os_pool_repo os_update_repo && zypper --non-interactive install tar')\n-  end\n-  node.run(\"journalctl > /var/log/messages && (tar cfvJP /tmp/#{target}-logs.tar.xz /var/log/ || [[ $? -eq 1 ]])\")\n-  `mkdir logs` unless Dir.exist?('logs')\n-  code = file_extract(node, \"/tmp/#{target}-logs.tar.xz\", \"logs/#{target}-logs.tar.xz\")\n-  raise \"Download log archive failed\" unless code.zero?\n+When(/^I extract the log files from all our active nodes$/) do\n+  $nodes.each do |node|", "originalCommit": "e9345b5c90d79d581fd3a5a835b28a2265c4b4f5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjIyMjczOQ==", "url": "https://github.com/uyuni-project/uyuni/pull/2845#discussion_r522222739", "bodyText": "Thank you, indeed, missed.", "author": "srbarrios", "createdAt": "2020-11-12T16:05:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjIxMjQ5MQ=="}], "type": "inlineReview"}, {"oid": "a3c687cff1a41d14431f5278ba4cab639a9d8177", "url": "https://github.com/uyuni-project/uyuni/commit/a3c687cff1a41d14431f5278ba4cab639a9d8177", "message": "QA: Refactor extraction of logs to support QAM clients", "committedDate": "2020-11-12T15:58:04Z", "type": "forcePushed"}, {"oid": "7988541ad47f2d3e03aab2e2e8023e98ab103377", "url": "https://github.com/uyuni-project/uyuni/commit/7988541ad47f2d3e03aab2e2e8023e98ab103377", "message": "QA: Refactor extraction of logs to support QAM clients", "committedDate": "2020-11-12T16:00:01Z", "type": "forcePushed"}, {"oid": "e335745c542649c510d616a616fce92729e76972", "url": "https://github.com/uyuni-project/uyuni/commit/e335745c542649c510d616a616fce92729e76972", "message": "QA: Refactor extraction of logs to support QAM clients", "committedDate": "2020-11-12T16:32:17Z", "type": "commit"}, {"oid": "e335745c542649c510d616a616fce92729e76972", "url": "https://github.com/uyuni-project/uyuni/commit/e335745c542649c510d616a616fce92729e76972", "message": "QA: Refactor extraction of logs to support QAM clients", "committedDate": "2020-11-12T16:32:17Z", "type": "forcePushed"}]}