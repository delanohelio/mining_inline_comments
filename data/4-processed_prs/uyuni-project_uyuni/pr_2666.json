{"pr_number": 2666, "pr_title": "Salt configuration modules for Activation Keys", "pr_createdAt": "2020-09-29T11:46:17Z", "pr_url": "https://github.com/uyuni-project/uyuni/pull/2666", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzM3ODQwNg==", "url": "https://github.com/uyuni-project/uyuni/pull/2666#discussion_r497378406", "bodyText": ", and (strange English rule)", "author": "Bischoff", "createdAt": "2020-09-30T09:41:27Z", "path": "testsuite/features/secondary/srv_user_configuration_salt_states.feature", "diffHunk": "@@ -1,7 +1,7 @@\n # Copyright (c) 2020 SUSE LLC\n # Licensed under the terms of the MIT license.\n \n-Feature: Create organizations, users and groups using Salt states\n+Feature: Create organizations, users, groups and activation keys using Salt states", "originalCommit": "23f93dfb6df95a08a15079bc6b069b74db954c18", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzM3ODc0MA==", "url": "https://github.com/uyuni-project/uyuni/pull/2666#discussion_r497378740", "bodyText": "Activation key (with capital)", "author": "Bischoff", "createdAt": "2020-09-30T09:41:56Z", "path": "testsuite/features/secondary/srv_user_configuration_salt_states.feature", "diffHunk": "@@ -51,6 +51,15 @@ Feature: Create organizations, users and groups using Salt states\n     And I should see \"role_channel_admin\" as unchecked\n     And I should see \"role_system_group_admin\" as unchecked\n \n+  Scenario: activation was correctly created", "originalCommit": "23f93dfb6df95a08a15079bc6b069b74db954c18", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "0c06bf36dbe991af813b11341416b567ec58d7e8", "url": "https://github.com/uyuni-project/uyuni/commit/0c06bf36dbe991af813b11341416b567ec58d7e8", "message": "Bugfix: return correct code if activation key does not exist", "committedDate": "2020-09-30T11:29:14Z", "type": "commit"}, {"oid": "0dfa2fc5a7657e8eea559a04c781eae971668ea5", "url": "https://github.com/uyuni-project/uyuni/commit/0dfa2fc5a7657e8eea559a04c781eae971668ea5", "message": "Add support for activationkey.absent", "committedDate": "2020-09-30T11:29:14Z", "type": "commit"}, {"oid": "8e77fe298a4344392ff3a9b61ea4dc370a9d2db6", "url": "https://github.com/uyuni-project/uyuni/commit/8e77fe298a4344392ff3a9b61ea4dc370a9d2db6", "message": "unit test for activation key absent salt state\n\nSigned-off-by: Ricardo Mateus <rmateus@suse.com>", "committedDate": "2020-09-30T11:29:14Z", "type": "commit"}, {"oid": "177d5a983385c921d4c819249755b6267d5431f6", "url": "https://github.com/uyuni-project/uyuni/commit/177d5a983385c921d4c819249755b6267d5431f6", "message": "hub salt states: activation key present\n\nSigned-off-by: Ricardo Mateus <rmateus@suse.com>", "committedDate": "2020-09-30T11:29:14Z", "type": "commit"}, {"oid": "b3b5324a316a863d086ead2a4cfd387be3b17aa7", "url": "https://github.com/uyuni-project/uyuni/commit/b3b5324a316a863d086ead2a4cfd387be3b17aa7", "message": "updata changes file\n\nSigned-off-by: Ricardo Mateus <rmateus@suse.com>", "committedDate": "2020-09-30T11:29:52Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzQ0NDA4Ng==", "url": "https://github.com/uyuni-project/uyuni/pull/2666#discussion_r497444086", "bodyText": "IIUC this should be a list of strings. Why does the compiler not complain?", "author": "moio", "createdAt": "2020-09-30T11:44:03Z", "path": "susemanager-utils/susemanager-sls/src/modules/uyuni_config.py", "diffHunk": "@@ -600,6 +607,226 @@ def get_minion_id_map(self, refresh: bool = False) -> Dict[str, int]:\n         return __context__[minions_token_key]\n \n \n+class UyuniActivationKey(UyuniRemoteObject):\n+    \"\"\"\n+    CRUD operations on Activation Keys.\n+    \"\"\"\n+\n+    def get_details(self, id: str) -> Dict[str, Any]:\n+        \"\"\"\n+        Get details of an Uyuni Activation Key\n+\n+        :param id: the Activation Key ID\n+\n+        :return: Activation Key information\n+        \"\"\"\n+        return self.client(\"activationkey.getDetails\", id)\n+\n+    def delete(self, id: str) -> bool:\n+        \"\"\"\n+        Deletes an Uyuni Activation Key\n+\n+        :param id: the Activation Key ID\n+\n+        :return: boolean, True indicates success\n+        \"\"\"\n+        return self._convert_bool_response(self.client(\"activationkey.delete\", id))\n+\n+    def create(self, key: str, description: str,\n+               base_channel_label: str = '',\n+               usage_limit: int = 0,\n+               system_types: List[int] = [],", "originalCommit": "b3b5324a316a863d086ead2a4cfd387be3b17aa7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzUyOTIwMg==", "url": "https://github.com/uyuni-project/uyuni/pull/2666#discussion_r497529202", "bodyText": "It should be string. Compiler doesn't catch because the method who calls this one is written in python 2, for salt compatibility.", "author": "rjmateus", "createdAt": "2020-09-30T13:55:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzQ0NDA4Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzQ3NTI4MA==", "url": "https://github.com/uyuni-project/uyuni/pull/2666#discussion_r497475280", "bodyText": "Not sure I understand the doubt here, let's clarify this before merging.", "author": "moio", "createdAt": "2020-09-30T12:38:56Z", "path": "susemanager-utils/susemanager-sls/src/modules/uyuni_config.py", "diffHunk": "@@ -1116,6 +1343,19 @@ def systemgroup_create(name, descr, org_admin_user=None, org_admin_password=None\n     return UyuniSystemgroup(org_admin_user, org_admin_password).create(name=name, description=descr)\n \n \n+# FIXME: Should we keep the fallback mechanism to the admin user in the authentication?\n+#        That could be dangerous if we didn't pass any authentication on some methods", "originalCommit": "b3b5324a316a863d086ead2a4cfd387be3b17aa7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzQ5ODc0Mg==", "url": "https://github.com/uyuni-project/uyuni/pull/2666#discussion_r497498742", "bodyText": "Doesn't make sense anymore, can be removed", "author": "rjmateus", "createdAt": "2020-09-30T13:14:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzQ3NTI4MA=="}], "type": "inlineReview"}, {"oid": "4c5c25c720f3898e3df9d8044015fa79c27d5a75", "url": "https://github.com/uyuni-project/uyuni/commit/4c5c25c720f3898e3df9d8044015fa79c27d5a75", "message": "hub salt modules: activation key system types\n\nSigned-off-by: Ricardo Mateus <rmateus@suse.com>", "committedDate": "2020-09-30T12:42:15Z", "type": "commit"}, {"oid": "dc8dc6ad2bb3f289f3434a3a14f1d45876b0b62a", "url": "https://github.com/uyuni-project/uyuni/commit/dc8dc6ad2bb3f289f3434a3a14f1d45876b0b62a", "message": "hub salt states: activation keys support\n\nSigned-off-by: Ricardo Mateus <rmateus@suse.com>", "committedDate": "2020-09-30T12:42:15Z", "type": "commit"}, {"oid": "30478b1ff74cdd9cf57c3a5d13a1f9061fc6c66e", "url": "https://github.com/uyuni-project/uyuni/commit/30478b1ff74cdd9cf57c3a5d13a1f9061fc6c66e", "message": "config salt state: activation key with packages definition\n\nSigned-off-by: Ricardo Mateus <rmateus@suse.com>", "committedDate": "2020-09-30T12:42:15Z", "type": "commit"}, {"oid": "14a0db39aaedaa35dbd4274bc978a8bff1a5cf45", "url": "https://github.com/uyuni-project/uyuni/commit/14a0db39aaedaa35dbd4274bc978a8bff1a5cf45", "message": "Rewording of some documentation comments", "committedDate": "2020-09-30T12:44:49Z", "type": "forcePushed"}, {"oid": "29e1c17233b094230a3c04d5ca53a0ba471c7c0a", "url": "https://github.com/uyuni-project/uyuni/commit/29e1c17233b094230a3c04d5ca53a0ba471c7c0a", "message": "config salt state activation key support for groups\n\nSigned-off-by: Ricardo Mateus <rmateus@suse.com>", "committedDate": "2020-09-30T14:09:40Z", "type": "commit"}, {"oid": "f12c6ec1288a581b02a3a0f5f65fd36c37c2f1f5", "url": "https://github.com/uyuni-project/uyuni/commit/f12c6ec1288a581b02a3a0f5f65fd36c37c2f1f5", "message": "addo support for configuration channels\n\nSigned-off-by: Ricardo Mateus <rmateus@suse.com>", "committedDate": "2020-09-30T14:09:49Z", "type": "commit"}, {"oid": "32008b4e66c96e6a5bb540efa79dd909ec00ee6f", "url": "https://github.com/uyuni-project/uyuni/commit/32008b4e66c96e6a5bb540efa79dd909ec00ee6f", "message": "salt configuration modules: rename output changes labels\n\nSigned-off-by: Ricardo Mateus <rmateus@suse.com>", "committedDate": "2020-09-30T14:09:49Z", "type": "commit"}, {"oid": "f5ce7663da11f563f1d0f5af23c23c89ac2dcc6b", "url": "https://github.com/uyuni-project/uyuni/commit/f5ce7663da11f563f1d0f5af23c23c89ac2dcc6b", "message": "uyuni config salt states: display groups names on changes\n\nSigned-off-by: Ricardo Mateus <rmateus@suse.com>", "committedDate": "2020-09-30T14:09:49Z", "type": "commit"}, {"oid": "8b2794e0619dc9a26ce49255c114645e1682ae44", "url": "https://github.com/uyuni-project/uyuni/commit/8b2794e0619dc9a26ce49255c114645e1682ae44", "message": "refactoring of server groups map variables\n\nSigned-off-by: Ricardo Mateus <rmateus@suse.com>", "committedDate": "2020-09-30T14:09:49Z", "type": "commit"}, {"oid": "8d35ba09ef443d357b9fa884af7b1c4379ef434f", "url": "https://github.com/uyuni-project/uyuni/commit/8d35ba09ef443d357b9fa884af7b1c4379ef434f", "message": "Rewording of some documentation comments", "committedDate": "2020-09-30T14:09:50Z", "type": "forcePushed"}, {"oid": "e743764618ef7951ec605038155f45a35a2d073e", "url": "https://github.com/uyuni-project/uyuni/commit/e743764618ef7951ec605038155f45a35a2d073e", "message": "activation key salt module: code review and documentation\n\nSigned-off-by: Ricardo Mateus <rmateus@suse.com>", "committedDate": "2020-09-30T14:18:21Z", "type": "commit"}, {"oid": "43a35df740e361568f1bfa23d94723aff29ff305", "url": "https://github.com/uyuni-project/uyuni/commit/43a35df740e361568f1bfa23d94723aff29ff305", "message": "salt configuration modules: test for activation key\n\nSigned-off-by: Ricardo Mateus <rmateus@suse.com>", "committedDate": "2020-09-30T14:18:29Z", "type": "commit"}, {"oid": "a3115887a070c628e9234b55c7ee2c73bde31708", "url": "https://github.com/uyuni-project/uyuni/commit/a3115887a070c628e9234b55c7ee2c73bde31708", "message": "salt configuration modules: test for activation key\n\nSigned-off-by: Ricardo Mateus <rmateus@suse.com>", "committedDate": "2020-09-30T14:18:29Z", "type": "commit"}, {"oid": "028b722c626b2f0682187eee0619eab249e2bff1", "url": "https://github.com/uyuni-project/uyuni/commit/028b722c626b2f0682187eee0619eab249e2bff1", "message": "salt config states: activation key tests\n\nSigned-off-by: Ricardo Mateus <rmateus@suse.com>", "committedDate": "2020-09-30T14:18:29Z", "type": "commit"}, {"oid": "2223636d7a63c2f2eb153d97e21a8021f28f1901", "url": "https://github.com/uyuni-project/uyuni/commit/2223636d7a63c2f2eb153d97e21a8021f28f1901", "message": "salt config state: activaton key update example\n\nSigned-off-by: Ricardo Mateus <rmateus@suse.com>", "committedDate": "2020-09-30T14:18:29Z", "type": "commit"}, {"oid": "de3e5e6d31f895e3599107a4a6390e75593af831", "url": "https://github.com/uyuni-project/uyuni/commit/de3e5e6d31f895e3599107a4a6390e75593af831", "message": "config salt states: activation key Cucumber test\n\nSigned-off-by: Ricardo Mateus <rmateus@suse.com>", "committedDate": "2020-09-30T14:18:29Z", "type": "commit"}, {"oid": "6a8606936b8963f4a2e6618e2066403ac9372eae", "url": "https://github.com/uyuni-project/uyuni/commit/6a8606936b8963f4a2e6618e2066403ac9372eae", "message": "config salt states: add code documentation\n\nSigned-off-by: Ricardo Mateus <rmateus@suse.com>", "committedDate": "2020-09-30T14:18:29Z", "type": "commit"}, {"oid": "b6d003224b042a1c3137656a53a18446433e7929", "url": "https://github.com/uyuni-project/uyuni/commit/b6d003224b042a1c3137656a53a18446433e7929", "message": "update of changes file\n\nSigned-off-by: Ricardo Mateus <rmateus@suse.com>", "committedDate": "2020-09-30T14:18:29Z", "type": "commit"}, {"oid": "062b4e048b4b366a995953b1b8500c4bbbea63ee", "url": "https://github.com/uyuni-project/uyuni/commit/062b4e048b4b366a995953b1b8500c4bbbea63ee", "message": "Rewording of some documentation comments", "committedDate": "2020-09-30T14:18:29Z", "type": "commit"}, {"oid": "062b4e048b4b366a995953b1b8500c4bbbea63ee", "url": "https://github.com/uyuni-project/uyuni/commit/062b4e048b4b366a995953b1b8500c4bbbea63ee", "message": "Rewording of some documentation comments", "committedDate": "2020-09-30T14:18:29Z", "type": "forcePushed"}]}