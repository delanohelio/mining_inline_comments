{"pr_number": 2759, "pr_title": "Testsuite: Clean up sle_ssh_tunnel_minion as well", "pr_createdAt": "2020-10-27T09:17:53Z", "pr_url": "https://github.com/uyuni-project/uyuni/pull/2759", "timeline": [{"oid": "5a3b9fa1f5ed58c605c5e273c73fe8b2a2a5cff4", "url": "https://github.com/uyuni-project/uyuni/commit/5a3b9fa1f5ed58c605c5e273c73fe8b2a2a5cff4", "message": "Testsuite: Clean up sle_ssh_tunnel_minion as well", "committedDate": "2020-10-27T09:12:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjUzNDIzOQ==", "url": "https://github.com/uyuni-project/uyuni/pull/2759#discussion_r512534239", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              if %w[sle_minion sle_ssh_tunnel_minion].include?(minion)\n          \n          \n            \n              if minion.include? 'minion'", "author": "srbarrios", "createdAt": "2020-10-27T09:27:47Z", "path": "testsuite/features/step_definitions/salt_steps.rb", "diffHunk": "@@ -721,7 +721,7 @@ def pillar_get(key, minion)\n \n And(/^I cleanup minion \"([^\"]*)\"$/) do |minion|\n   node = get_target(minion)\n-  if minion == 'sle_minion'\n+  if %w[sle_minion sle_ssh_tunnel_minion].include?(minion)", "originalCommit": "5a3b9fa1f5ed58c605c5e273c73fe8b2a2a5cff4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjUzNDg2Ng==", "url": "https://github.com/uyuni-project/uyuni/pull/2759#discussion_r512534866", "bodyText": "No. I think that's incorrect, this string comparaison will also catch \"ceos_minion\" etc.\nAlso the list construct is consistent with the line that just follows.", "author": "Bischoff", "createdAt": "2020-10-27T09:28:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjUzNDIzOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjUzNDk2OA==", "url": "https://github.com/uyuni-project/uyuni/pull/2759#discussion_r512534968", "bodyText": "I would make it more generic like that, so next time we add a new host name we don't need to touch this line", "author": "srbarrios", "createdAt": "2020-10-27T09:28:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjUzNDIzOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjUzNTk3NA==", "url": "https://github.com/uyuni-project/uyuni/pull/2759#discussion_r512535974", "bodyText": "Well, and what's the problem to also match \"ceos_minion\"?\nWe are already using this construction in other steps, like in the \"I apply highstate on\"", "author": "srbarrios", "createdAt": "2020-10-27T09:30:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjUzNDIzOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjUzNzIwMA==", "url": "https://github.com/uyuni-project/uyuni/pull/2759#discussion_r512537200", "bodyText": "I see, I just not read the next elseif... well, I would reconsider the other block, are we sure we can't make a unique block? Why we can't use node.run('systemctl stop salt-minion') in our SLE 12 SP3 < 15 SP2 clients?", "author": "srbarrios", "createdAt": "2020-10-27T09:32:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjUzNDIzOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjU0NTEyNQ==", "url": "https://github.com/uyuni-project/uyuni/pull/2759#discussion_r512545125", "bodyText": "No, that would include the second branch of the if.  We use systemd for Ubuntu/Centos minions.\nSee the full lines:\n  if %w[sle_minion sle_ssh_tunnel_minion].include?(minion)\n    node.run('rcsalt-minion stop')\n    node.run('rm -Rf /var/cache/salt/minion')\n  elsif %w[ceos_minion ceos_ssh_minion ubuntu_minion ubuntu_ssh_minion].include?(minion)\n    node.run('systemctl stop salt-minion')\n    node.run('rm -Rf /var/cache/salt/minion')\n  end", "author": "calancha", "createdAt": "2020-10-27T09:44:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjUzNDIzOQ=="}], "type": "inlineReview"}]}