{"pr_number": 2328, "pr_title": "Maintenance windows - action schedule react component", "pr_createdAt": "2020-06-17T09:24:15Z", "pr_url": "https://github.com/uyuni-project/uyuni/pull/2328", "timeline": [{"oid": "1dc657a267dcf4c323128d249f33338ec2277332", "url": "https://github.com/uyuni-project/uyuni/commit/1dc657a267dcf4c323128d249f33338ec2277332", "message": "Checkstyle", "committedDate": "2020-06-17T12:21:12Z", "type": "forcePushed"}, {"oid": "4a8026150adfa1c9f8c0f5bf963ed15e9860dfeb", "url": "https://github.com/uyuni-project/uyuni/commit/4a8026150adfa1c9f8c0f5bf963ed15e9860dfeb", "message": "Revert \"JSP: Support for greying out date picker\"\n\nThis reverts commit 612c78fef76237c5038f91c92ab84b344c3be9a3.\n\nThis is to be consintent with the React schedule component, that _hides_\nthe date picker in case maint. windows are defined.", "committedDate": "2020-06-17T12:25:40Z", "type": "forcePushed"}, {"oid": "bb40a511f9d145ee47241856d9f2098bdc8fd292", "url": "https://github.com/uyuni-project/uyuni/commit/bb40a511f9d145ee47241856d9f2098bdc8fd292", "message": "Remove unnecessary check from action chains renderer", "committedDate": "2020-06-17T14:18:01Z", "type": "forcePushed"}, {"oid": "adee7ff089ba8e4de899ebf2ff29fba706b125e0", "url": "https://github.com/uyuni-project/uyuni/commit/adee7ff089ba8e4de899ebf2ff29fba706b125e0", "message": "Remove unnecessary check from action chains renderer", "committedDate": "2020-06-17T14:20:06Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjM0MjE4OA==", "url": "https://github.com/uyuni-project/uyuni/pull/2328#discussion_r442342188", "bodyText": "Please just add a comment on top of this usage: Object.assign for this.state is deprecated outside of the constructor. Outside of it we should always use this.setState because React knows what to do properly in the state. I am totally fine using it here, but make sure to add the comment to clarify to not use it elsewhere. Thanks", "author": "ncounter", "createdAt": "2020-06-18T16:11:00Z", "path": "web/html/src/components/action-schedule.js", "diffHunk": "@@ -55,31 +55,26 @@ class ActionSchedule extends React.Component<ActionScheduleProps, ActionSchedule\n   constructor(props: ActionScheduleProps) {\n     super(props);\n \n+    const commonState = {\n+      loading: true,\n+      type: \"earliest\",\n+      earliest: props.earliest,\n+      isMaintenanceModeEnabled: false,\n+      maintenanceWindow: {},\n+      maintenanceWindows: [],\n+      systemIds: props.systemIds ? props.systemIds : [],\n+      actionType: props.actionType ? props.actionType : \"\",\n+    }\n+\n+    let actionChainsState = {};\n     if (props.actionChains) {\n-      this.state = {\n-        loading: true,\n-        type: \"earliest\",\n-        earliest: props.earliest,\n+      actionChainsState = {\n         actionChain: props.actionChains.length > 0 ? props.actionChains[0] : this.newActionChainOpt,\n         actionChains: props.actionChains.length > 0 ? props.actionChains : [this.newActionChainOpt],\n-        maintenanceWindow: {}, // todo deuglify\n-        maintenanceWindows: [],\n-        systemIds: props.systemIds ? props.systemIds : [],\n-        actionType: props.actionType ? props.actionType : \"\",\n-      };\n-    } else {\n-      this.state = {\n-        loading: true,\n-        type: \"earliest\",\n-        earliest: props.earliest,\n-        isMaintenanceModeEnabled: false,\n-        maintenanceWindow: {},\n-        maintenanceWindows: [],\n-        systemIds: props.systemIds ? props.systemIds : [],\n-        actionType: props.actionType ? props.actionType : \"\",\n       };\n     }\n \n+    this.state = Object.assign(commonState, actionChainsState);", "originalCommit": "4e251d669f7739e388776ea8698af1bcb9496a4e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDIwMzA5MA==", "url": "https://github.com/uyuni-project/uyuni/pull/2328#discussion_r444203090", "bodyText": "Fixing.", "author": "hustodemon", "createdAt": "2020-06-23T12:59:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjM0MjE4OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjM0NTA2MQ==", "url": "https://github.com/uyuni-project/uyuni/pull/2328#discussion_r442345061", "bodyText": "Isn't it enough to check for the single this.state.actionChain? IIUC if it is present there will always be a this.state.actionChains array (in some case an Array(1), but still). Am I missing something?", "author": "ncounter", "createdAt": "2020-06-18T16:15:33Z", "path": "web/html/src/components/action-schedule.js", "diffHunk": "@@ -190,43 +263,13 @@ class ActionSchedule extends React.Component<ActionScheduleProps, ActionSchedule\n       <div className=\"spacewalk-scheduler\">\n         <div className=\"form-horizontal\">\n           <div className=\"form-group\">\n-            <div className=\"col-sm-3 control-label\">\n-              { (this.state.actionChains && this.state.actionChain) &&\n-                <input type=\"radio\" name=\"use_date\" value=\"true\" checked={this.state.type == \"earliest\"} id=\"schedule-by-date\" onChange={this.onSelectEarliest}/> }\n-              <label htmlFor=\"schedule-by-date\">{!this.state.isMaintenanceModeEnabled ?t(\"Earliest:\") : t(\"Maintenance Window:\")}</label>\n-            </div>\n-              {\n-                !this.state.isMaintenanceModeEnabled ?\n-                  <div className=\"col-sm-6\">\n-                    <DateTimePicker onChange={this.onDateTimeChanged} value={this.state.earliest} timezone={this.props.timezone} />\n-                  </div>\n-                  :\n-                  <div className=\"col-sm-6\">\n-                    <select\n-                        id=\"maintenance-window\"\n-                        className=\"form-control\"\n-                        name=\"maintenance_window\"\n-                        onChange={this.onSelectMaintenanceWindow}\n-                        onFocus={this.onFocusMaintenanceWindow}>\n-                      { this.state.maintenanceWindows.map(mw =><option key={mw.id} value={mw.id}> {mw.from + \" - \" + mw.to}</option>) }\n-                    </select>\n-                  </div>\n-              }\n-          </div>\n-          { (this.state.actionChains && this.state.actionChain) &&\n-            <div className=\"form-group\">\n-              <div className=\"col-sm-3 control-label\">\n-                <input type=\"radio\" name=\"action_chain\" value=\"false\" checked={this.state.type == \"actionChain\"} id=\"schedule-by-action-chain\" onChange={this.onFocusActionChain}/>\n-                <label htmlFor=\"schedule-by-action-chain\">{t(\"Add to:\")}</label>\n-              </div>\n-              <div className=\"col-sm-3\">\n-                { (this.state.actionChains && this.state.actionChain) &&\n-                  <Combobox id=\"action-chain\" name=\"action_chain\" selectedId={this.state.actionChain.id}\n-                            data={this.state.actionChains} onSelect={this.onSelectActionChain}\n-                            onFocus={this.onFocusActionChain} />}\n-              </div>\n-            </div>\n+            { \n+              this.renderPickers()\n+            }\n+            {\n+              this.state.actionChains && this.state.actionChain && this.renderActionChainPicker()", "originalCommit": "22ccd2a8be8505df784a69c44fd5225ce4eb1f91", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDIzMjY1MA==", "url": "https://github.com/uyuni-project/uyuni/pull/2328#discussion_r444232650", "bodyText": "I'd rather not touch this code in this PR. This was only meant as a refactoring and I used condition from the original code.", "author": "hustodemon", "createdAt": "2020-06-23T13:41:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjM0NTA2MQ=="}], "type": "inlineReview"}, {"oid": "7bfe4e5692e24351a10e37271552725b2b91e16e", "url": "https://github.com/uyuni-project/uyuni/commit/7bfe4e5692e24351a10e37271552725b2b91e16e", "message": "ActionSchedule React component for MaintenanceWindows\n\nThe patch consists of the following parts:\n- Add endpoint to fetch maintenance windows data\n- Fetch maintenance windows from the backend\n- Use maintenance windows in highstate action scheduler\n- Use maintenance windows in single system subscribe channel action scheduler\n- [WIP] Use maintenance windows in ssm subscribe channel action scheduler", "committedDate": "2020-06-23T12:11:15Z", "type": "commit"}, {"oid": "8eedf627d8b38b9d24f88e57f43af2d7f44ddea7", "url": "https://github.com/uyuni-project/uyuni/commit/8eedf627d8b38b9d24f88e57f43af2d7f44ddea7", "message": "Use POJO for passing parameters from frontend", "committedDate": "2020-06-23T12:11:16Z", "type": "commit"}, {"oid": "19b38583732726dce413af5ea89cb8caa2652b8a", "url": "https://github.com/uyuni-project/uyuni/commit/19b38583732726dce413af5ea89cb8caa2652b8a", "message": "Refactor: Create a POJO for passing maintenance window data to frontend", "committedDate": "2020-06-23T12:11:16Z", "type": "commit"}, {"oid": "d5b839a67cfa9a3974d59d53e3a6b693a11f8f39", "url": "https://github.com/uyuni-project/uyuni/commit/d5b839a67cfa9a3974d59d53e3a6b693a11f8f39", "message": "Adjustments in the JS scheduler", "committedDate": "2020-06-23T12:11:16Z", "type": "commit"}, {"oid": "c9aeee0e7ad2b41e6ae3f2caf29765010f2b11b9", "url": "https://github.com/uyuni-project/uyuni/commit/c9aeee0e7ad2b41e6ae3f2caf29765010f2b11b9", "message": "Fix system id computation in SSM channel assignment UI", "committedDate": "2020-06-23T12:11:16Z", "type": "commit"}, {"oid": "84689ffc75ef42792df79fd2bb8f69ca7119f5a2", "url": "https://github.com/uyuni-project/uyuni/commit/84689ffc75ef42792df79fd2bb8f69ca7119f5a2", "message": "Make image build UI maintenance-windows aware", "committedDate": "2020-06-23T12:11:16Z", "type": "commit"}, {"oid": "949c48e1668619ed5155380cb84ae1850e5dd6bf", "url": "https://github.com/uyuni-project/uyuni/commit/949c48e1668619ed5155380cb84ae1850e5dd6bf", "message": "Make cluster UI maintenance-windows aware", "committedDate": "2020-06-23T12:11:16Z", "type": "commit"}, {"oid": "d08ca7f0a8bc90c346fcd45d3fa67de65571f50a", "url": "https://github.com/uyuni-project/uyuni/commit/d08ca7f0a8bc90c346fcd45d3fa67de65571f50a", "message": "Slighly improve the state assignment; Make the maint. window picker wider", "committedDate": "2020-06-23T12:11:16Z", "type": "commit"}, {"oid": "2cfb0250c9dad3aad35657f89103bd3ad9118c95", "url": "https://github.com/uyuni-project/uyuni/commit/2cfb0250c9dad3aad35657f89103bd3ad9118c95", "message": "Checkstyle", "committedDate": "2020-06-23T12:11:16Z", "type": "commit"}, {"oid": "32bf9a038868c8341cc487da07d2f4645c547456", "url": "https://github.com/uyuni-project/uyuni/commit/32bf9a038868c8341cc487da07d2f4645c547456", "message": "Revert \"JSP: Support for greying out date picker\"\n\nThis reverts commit 612c78fef76237c5038f91c92ab84b344c3be9a3.\n\nThis is to be consintent with the React schedule component, that _hides_\nthe date picker in case maint. windows are defined.", "committedDate": "2020-06-23T12:11:16Z", "type": "commit"}, {"oid": "7f65283a5257bbf88dfdd633ca99b10725922ccc", "url": "https://github.com/uyuni-project/uyuni/commit/7f65283a5257bbf88dfdd633ca99b10725922ccc", "message": "Refactor: Extract rendering action scheduler fragments to separate functions", "committedDate": "2020-06-23T12:11:16Z", "type": "commit"}, {"oid": "0308bf78c5b5341ea61f86e37ed0264d1fab8113", "url": "https://github.com/uyuni-project/uyuni/commit/0308bf78c5b5341ea61f86e37ed0264d1fab8113", "message": "Add UI warning when dealing with multiple maintenance schedules", "committedDate": "2020-06-23T12:11:16Z", "type": "commit"}, {"oid": "41700b89d2d732447d61499df086ea4d04d769f8", "url": "https://github.com/uyuni-project/uyuni/commit/41700b89d2d732447d61499df086ea4d04d769f8", "message": "Remove unnecessary check from action chains renderer", "committedDate": "2020-06-23T12:11:16Z", "type": "commit"}, {"oid": "8e7ac191c136e98a3fad51f6e7a02a1a41fe5cb6", "url": "https://github.com/uyuni-project/uyuni/commit/8e7ac191c136e98a3fad51f6e7a02a1a41fe5cb6", "message": "Fix JS lint error", "committedDate": "2020-06-23T12:11:16Z", "type": "commit"}, {"oid": "20bb605118dcec82986bedad8b1a375ac2d7807a", "url": "https://github.com/uyuni-project/uyuni/commit/20bb605118dcec82986bedad8b1a375ac2d7807a", "message": "Adjust the Maint. controller to use POJO instead of Triple for maint. windows", "committedDate": "2020-06-23T12:21:47Z", "type": "commit"}, {"oid": "64f3c6973c42d8984831519d7a56ae82040808e3", "url": "https://github.com/uyuni-project/uyuni/commit/64f3c6973c42d8984831519d7a56ae82040808e3", "message": "Unify the Maintenance windows controllers", "committedDate": "2020-06-23T12:38:38Z", "type": "commit"}, {"oid": "64f3c6973c42d8984831519d7a56ae82040808e3", "url": "https://github.com/uyuni-project/uyuni/commit/64f3c6973c42d8984831519d7a56ae82040808e3", "message": "Unify the Maintenance windows controllers", "committedDate": "2020-06-23T12:38:38Z", "type": "forcePushed"}, {"oid": "1770b4eaa34be824234bd87b2b363ee3899c472c", "url": "https://github.com/uyuni-project/uyuni/commit/1770b4eaa34be824234bd87b2b363ee3899c472c", "message": "Set state using setState in the React component", "committedDate": "2020-06-23T12:59:43Z", "type": "commit"}]}