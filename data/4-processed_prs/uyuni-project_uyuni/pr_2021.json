{"pr_number": 2021, "pr_title": "Read modularity tag", "pr_createdAt": "2020-03-16T16:25:49Z", "pr_url": "https://github.com/uyuni-project/uyuni/pull/2021", "timeline": [{"oid": "dca4b8273083239b284f2956a7e8eae0d04a8c8b", "url": "https://github.com/uyuni-project/uyuni/commit/dca4b8273083239b284f2956a7e8eae0d04a8c8b", "message": "Add modularitylabel tag support", "committedDate": "2020-03-16T16:17:02Z", "type": "commit"}, {"oid": "78c14c4aefce2b46a2852044497a440e40b6513f", "url": "https://github.com/uyuni-project/uyuni/commit/78c14c4aefce2b46a2852044497a440e40b6513f", "message": "Populate extra-tags (currently only modularitylabel)", "committedDate": "2020-03-16T16:17:24Z", "type": "commit"}, {"oid": "c9787a3ba24eb9033c3ff3190fb595e7cb8178b9", "url": "https://github.com/uyuni-project/uyuni/commit/c9787a3ba24eb9033c3ff3190fb595e7cb8178b9", "message": "Fix typo", "committedDate": "2020-03-17T11:08:31Z", "type": "commit"}, {"oid": "d2c119680e097bd007123c16c4bc943912727399", "url": "https://github.com/uyuni-project/uyuni/commit/d2c119680e097bd007123c16c4bc943912727399", "message": "Fix hdr object has no .get method", "committedDate": "2020-03-17T11:08:58Z", "type": "commit"}, {"oid": "292e98b7ff962c350e1c8276d7b3563872431cf8", "url": "https://github.com/uyuni-project/uyuni/commit/292e98b7ff962c350e1c8276d7b3563872431cf8", "message": "Move extra tag population method to the base class", "committedDate": "2020-03-17T12:58:01Z", "type": "commit"}, {"oid": "d33ce78f3b2bdd083bbb73d5ad7329462c4db3fa", "url": "https://github.com/uyuni-project/uyuni/commit/d33ce78f3b2bdd083bbb73d5ad7329462c4db3fa", "message": "Update CL", "committedDate": "2020-03-17T12:59:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzY2OTc4Mg==", "url": "https://github.com/uyuni-project/uyuni/pull/2021#discussion_r393669782", "bodyText": "You are missing an entry at uyuni-common-libs.changes", "author": "juliogonzalez", "createdAt": "2020-03-17T13:16:02Z", "path": "uyuni/common-libs/common/rhn_rpm.py", "diffHunk": "@@ -47,6 +47,7 @@\n \n # need this for rpm-pyhon < 4.6 (e.g. on RHEL5)\n rpm.RPMTAG_FILEDIGESTALGO = 5011\n+rpm.RPMTAG_MODULARITYLABEL = 5096", "originalCommit": "d33ce78f3b2bdd083bbb73d5ad7329462c4db3fa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzY3Mjk3MQ==", "url": "https://github.com/uyuni-project/uyuni/pull/2021#discussion_r393672971", "bodyText": "ah, different packages, right.", "author": "isbm", "createdAt": "2020-03-17T13:20:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzY2OTc4Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzY3MzU3MQ==", "url": "https://github.com/uyuni-project/uyuni/pull/2021#discussion_r393673571", "bodyText": "done", "author": "isbm", "createdAt": "2020-03-17T13:21:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzY2OTc4Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzY2ODU3MQ==", "url": "https://github.com/uyuni-project/uyuni/pull/2021#discussion_r393668571", "bodyText": "I think this is only initialized in case of a rpmBinaryPackage. When this is a rpmSourcePackage extra_tags is not part of the tagMap.\nI would suggest to do a similar thing as build_time which is available in both tagMaps.\nJust add extra_tags to rpmSourcePackage tagMap.\nclass rpmSourcePackage(SourcePackage, rpmPackage):\n    tagMap = rpmPackage.tagMap.copy()\n    tagMap.update({\n        'package_group': 'group',\n        'rpm_version': 'rpmversion',\n        'payload_size': 'archivesize',\n        'build_host': 'buildhost',\n        'build_time': 'buildtime',\n        'source_rpm': 'sourcerpm',\n        # Arrays: require a different mapping\n        # We set them differently\n        'package_size': None,\n        'org_id': None,\n        'md5sum': None,\n        'path': None,\n        # Unsupported\n        'payload_format': None,\n        'channels': None,\n        'package_id': None,\n    })", "author": "mcalmer", "createdAt": "2020-03-17T13:14:01Z", "path": "backend/server/importlib/headerSource.py", "diffHunk": "@@ -98,8 +98,21 @@ def populate(self, header, size, checksum_type, checksum, path=None, org_id=None\n             self['payload_format'] = 'cpio'\n         if self['payload_size'] is None:\n             self['payload_size'] = 0\n+        # Extra tags\n+        self._populateExtraTags(header)\n+\n         return self\n \n+    def _populateExtraTags(self, header):\n+        \"\"\"\n+        Populate extra tags. Currently only \"modularitylabel\".\n+        \"\"\"\n+        mlabel = header.modularity_label()\n+        if mlabel is not None:\n+            self[\"extra_tags\"] = [", "originalCommit": "d33ce78f3b2bdd083bbb73d5ad7329462c4db3fa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzY4MjUyNQ==", "url": "https://github.com/uyuni-project/uyuni/pull/2021#discussion_r393682525", "bodyText": "@mcalmer Well, to be honest I am not sure why this is at all done that way. Normally, populator should either add stuff or not at all. And so the importer should .get(\"extra_tags, []) instead of checking \"if it is None? and if it is non-empty?\" and trying to iterate over e.g. int or float mistakenly put there and thus crash. \ud83d\ude09 Anyway, this is something to cleanup in a future.\nFor now I've added \"extra_tags\": None, similar as it is implemented for Debian, but I think this is a wrong approach.", "author": "isbm", "createdAt": "2020-03-17T13:34:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzY2ODU3MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzY3MDAzOA==", "url": "https://github.com/uyuni-project/uyuni/pull/2021#discussion_r393670038", "bodyText": "We need also a changelog entry for uyuni-common-libs", "author": "mcalmer", "createdAt": "2020-03-17T13:16:26Z", "path": "backend/spacewalk-backend.changes", "diffHunk": "@@ -1,3 +1,5 @@\n+- Read MODULARITYLABEL tag from RPM packages", "originalCommit": "d33ce78f3b2bdd083bbb73d5ad7329462c4db3fa", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "9f952611ae67fb5901e4c5f8be74a3978d48fb51", "url": "https://github.com/uyuni-project/uyuni/commit/9f952611ae67fb5901e4c5f8be74a3978d48fb51", "message": "Update CL", "committedDate": "2020-03-17T13:21:32Z", "type": "commit"}, {"oid": "ae00a3584f035b475f21199a1e677cf645bebe23", "url": "https://github.com/uyuni-project/uyuni/commit/ae00a3584f035b475f21199a1e677cf645bebe23", "message": "Initialise extra_tags key for src packages (consistency)", "committedDate": "2020-03-17T13:30:53Z", "type": "commit"}]}