{"pr_number": 2444, "pr_title": "testsuite: Run most of the time with centos/ubuntu normal minions", "pr_createdAt": "2020-07-24T15:18:46Z", "pr_url": "https://github.com/uyuni-project/uyuni/pull/2444", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDY5MjkwNw==", "url": "https://github.com/uyuni-project/uyuni/pull/2444#discussion_r460692907", "bodyText": "For traditional clients sure, but for SSH minion I'm not sure that we need to install those packages. They will not hurt anyway :)", "author": "srbarrios", "createdAt": "2020-07-27T07:21:32Z", "path": "testsuite/features/secondary/min_centos_salt.feature", "diffHunk": "@@ -65,12 +65,22 @@ Feature: Be able to bootstrap a CentOS minion and do some basic operations on it\n     And I wait until event \"Subscribe channels scheduled by admin\" is completed\n \n @centos_minion\n-  Scenario: Detect latest Salt changes on the CentOS minion\n-    When I query latest Salt changes on \"ceos_minion\"\n+  Scenario: Prepare the SSH-managed CentOS minion\n+    Given I am authorized\n+    When I enable SUSE Manager tools repositories on \"ceos_ssh_minion\"\n+    And  I enable repository \"CentOS-Base\" on this \"ceos_ssh_minion\"\n+    And  I install package \"hwdata m2crypto wget\" on this \"ceos_ssh_minion\"\n+    And  I install package \"spacewalk-client-tools spacewalk-check spacewalk-client-setup mgr-daemon mgr-osad mgr-cfg-actions\" on this \"ceos_ssh_minion\"", "originalCommit": "e5c5008cdad1f9f098016bca15e6f44885fe6fb4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDY5MzQ4OA==", "url": "https://github.com/uyuni-project/uyuni/pull/2444#discussion_r460693488", "bodyText": "We probably need both tags here (if you ask me, better at feature level, once), centos_minion and centos_ssh_minion", "author": "srbarrios", "createdAt": "2020-07-27T07:22:48Z", "path": "testsuite/features/secondary/min_centos_salt.feature", "diffHunk": "@@ -1,58 +1,58 @@\n-# Copyright (c) 2017-2019 SUSE LLC\n+# Copyright (c) 2017-2020 SUSE LLC\n # Licensed under the terms of the MIT license.\n #\n-# 1) delete CentOS SSH minion and register as Centos minion\n+# 1) delete CentOS minion and register as Centos SSH minion\n # 2) run a remote command\n # 3) try an openscap scan\n-# 4) delete CentOS minion client and register as Centos SSH minion\n+# 4) delete CentOS SSH minion client and register as Centos minion\n \n-Feature: Be able to bootstrap a CentOS minion and do some basic operations on it\n+Feature: Bootstrap a SSH-managed CentOS minion and do some basic operations on it\n \n @centos_minion", "originalCommit": "e5c5008cdad1f9f098016bca15e6f44885fe6fb4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDY5ODQxNA==", "url": "https://github.com/uyuni-project/uyuni/pull/2444#discussion_r460698414", "bodyText": "Ah nothing sorry, we only have one VM, got confused", "author": "srbarrios", "createdAt": "2020-07-27T07:32:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDY5MzQ4OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDY5NTM1Nw==", "url": "https://github.com/uyuni-project/uyuni/pull/2444#discussion_r460695357", "bodyText": "I wonder why we delete the centos minion, to test centos ssh minion, apparently, we are not reusing the same VM \ud83e\udd14", "author": "srbarrios", "createdAt": "2020-07-27T07:26:40Z", "path": "testsuite/features/secondary/min_centos_salt.feature", "diffHunk": "@@ -1,58 +1,58 @@\n-# Copyright (c) 2017-2019 SUSE LLC\n+# Copyright (c) 2017-2020 SUSE LLC\n # Licensed under the terms of the MIT license.\n #\n-# 1) delete CentOS SSH minion and register as Centos minion\n+# 1) delete CentOS minion and register as Centos SSH minion\n # 2) run a remote command\n # 3) try an openscap scan\n-# 4) delete CentOS minion client and register as Centos SSH minion\n+# 4) delete CentOS SSH minion client and register as Centos minion\n \n-Feature: Be able to bootstrap a CentOS minion and do some basic operations on it\n+Feature: Bootstrap a SSH-managed CentOS minion and do some basic operations on it\n \n @centos_minion\n-  Scenario: Delete the CentOS SSH minion before normal minion tests\n-    When I am on the Systems overview page of this \"ceos_ssh_minion\"\n+  Scenario: Delete the CentOS minion before SSH minion tests", "originalCommit": "e5c5008cdad1f9f098016bca15e6f44885fe6fb4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDY5ODAwMQ==", "url": "https://github.com/uyuni-project/uyuni/pull/2444#discussion_r460698001", "bodyText": "We are using two tags, but currently the VMs are the same, that's why we need to delete in that step.\nSee here:\ntestsuite/features/support/twopence_init.rb\n$node_by_host = { 'server'                => $server,\n                  'proxy'                 => $proxy,\n                  'ceos_minion'           => $ceos_minion,\n                  'ceos_ssh_minion'       => $ceos_minion,\n                  'ceos_client'           => $ceos_minion,", "author": "calancha", "createdAt": "2020-07-27T07:32:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDY5NTM1Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDY5ODY0Mg==", "url": "https://github.com/uyuni-project/uyuni/pull/2444#discussion_r460698642", "bodyText": "Cool, got confused, all good then", "author": "srbarrios", "createdAt": "2020-07-27T07:33:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDY5NTM1Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDY5NzQ2Mw==", "url": "https://github.com/uyuni-project/uyuni/pull/2444#discussion_r460697463", "bodyText": "Out of scope: Not sure about it, but if that target is looking for the name of the VM, we might want to refactor it, so we pass \"centos_ssh_minion\" hostname as a target. Just thinking in the future if we have someday more VMs matching \"centos\" in this feature's test.", "author": "srbarrios", "createdAt": "2020-07-27T07:30:53Z", "path": "testsuite/features/secondary/min_centos_salt.feature", "diffHunk": "@@ -80,23 +90,23 @@ Feature: Be able to bootstrap a CentOS minion and do some basic operations on it\n     And I wait until event \"OpenSCAP xccdf scanning\" is completed\n \n @centos_minion\n-  Scenario: Run a remote command on the CentOS minion\n+  Scenario: Run a remote command on the SSH-managed CentOS minion\n     Given I am authorized as \"testing\" with password \"testing\"\n     When I follow the left menu \"Salt > Remote Commands\"\n     Then I should see a \"Remote Commands\" text in the content area\n     When I enter command \"cat /etc/os-release\"\n     And I enter target \"*centos*\"", "originalCommit": "e5c5008cdad1f9f098016bca15e6f44885fe6fb4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDcwMDQzMA==", "url": "https://github.com/uyuni-project/uyuni/pull/2444#discussion_r460700430", "bodyText": "We should also rename both feature files named as min_centos/ubuntu_salt.feature", "author": "srbarrios", "createdAt": "2020-07-27T07:36:49Z", "path": "testsuite/run_sets/refhost.yml", "diffHunk": "@@ -20,8 +20,8 @@\n - features/init_clients/sle_client.feature\n - features/init_clients/sle_minion.feature\n - features/init_clients/sle_ssh_minion.feature\n-- features/init_clients/centos_ssh_minion.feature\n-- features/init_clients/ubuntu_ssh_minion.feature\n+- features/init_clients/centos_minion.feature", "originalCommit": "e5c5008cdad1f9f098016bca15e6f44885fe6fb4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDc2MzIyMQ==", "url": "https://github.com/uyuni-project/uyuni/pull/2444#discussion_r460763221", "bodyText": "Done.  Renamed as:\n\ntestsuite/features/init_clients/min_centos_salt.feature\ntestsuite/features/init_clients/min_ubuntu_salt.feature\ntestsuite/features/secondary/min_centos_ssh.feature\ntestsuite/features/secondary/min_ubuntu_ssh.feature", "author": "calancha", "createdAt": "2020-07-27T09:28:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDcwMDQzMA=="}], "type": "inlineReview"}, {"oid": "f81a52044f795914a7324b305c430116b2d755e3", "url": "https://github.com/uyuni-project/uyuni/commit/f81a52044f795914a7324b305c430116b2d755e3", "message": "testsuite: Run most of the time with centos/ubuntu normal minions\n\nSee spacewalk#11972\n\n- testsuite/features/core/allcli_sanity.feature\n- testsuite/features/secondary/allcli_config_channel.feature\n- testsuite/features/secondary/allcli_overview_systems_details.feature\n- testsuite/features/secondary/allcli_reboot.feature\n- testsuite/features/secondary/allcli_software_channels.feature\n- testsuite/features/secondary/allcli_system_group.feature\n- testsuite/features/secondary/min_centos_monitoring.feature\n- testsuite/features/secondary/min_centos_salt.feature\n- testsuite/features/secondary/min_ubuntu_salt.feature\n- testsuite/features/secondary/min_ubuntu_salt_install_package.feature\n- testsuite/features/secondary/minssh_centos_salt_install_package_and_patch.feature\n- testsuite/features/secondary/srv_group_union_intersection.feature\n- testsuite/features/secondary/trad_centos_client.feature\n\n- testsuite/features/init_clients/min_centos_salt.feature\n  Rename it from centos_minion.feature\n- testsuite/features/init_clients/min_ubuntu_salt.feature:\n  Rename it from ubuntu_ssh_minion.feature\n- testsuite/features/secondary/min_centos_ssh.feature\n  Rename it from min_centos_salt.feature\n- testsuite/features/secondary/min_ubuntu_ssh.feature\n  Rename from min_ubuntu_salt.feature\n\n- testsuite/run_sets/init_clients.yml\n- testsuite/run_sets/refhost.yml\n- testsuite/run_sets/secondary.yml\n- testsuite/run_sets/sle-updates.yml:\nUpdate with the new file names.", "committedDate": "2020-07-27T10:00:49Z", "type": "commit"}, {"oid": "f81a52044f795914a7324b305c430116b2d755e3", "url": "https://github.com/uyuni-project/uyuni/commit/f81a52044f795914a7324b305c430116b2d755e3", "message": "testsuite: Run most of the time with centos/ubuntu normal minions\n\nSee spacewalk#11972\n\n- testsuite/features/core/allcli_sanity.feature\n- testsuite/features/secondary/allcli_config_channel.feature\n- testsuite/features/secondary/allcli_overview_systems_details.feature\n- testsuite/features/secondary/allcli_reboot.feature\n- testsuite/features/secondary/allcli_software_channels.feature\n- testsuite/features/secondary/allcli_system_group.feature\n- testsuite/features/secondary/min_centos_monitoring.feature\n- testsuite/features/secondary/min_centos_salt.feature\n- testsuite/features/secondary/min_ubuntu_salt.feature\n- testsuite/features/secondary/min_ubuntu_salt_install_package.feature\n- testsuite/features/secondary/minssh_centos_salt_install_package_and_patch.feature\n- testsuite/features/secondary/srv_group_union_intersection.feature\n- testsuite/features/secondary/trad_centos_client.feature\n\n- testsuite/features/init_clients/min_centos_salt.feature\n  Rename it from centos_minion.feature\n- testsuite/features/init_clients/min_ubuntu_salt.feature:\n  Rename it from ubuntu_ssh_minion.feature\n- testsuite/features/secondary/min_centos_ssh.feature\n  Rename it from min_centos_salt.feature\n- testsuite/features/secondary/min_ubuntu_ssh.feature\n  Rename from min_ubuntu_salt.feature\n\n- testsuite/run_sets/init_clients.yml\n- testsuite/run_sets/refhost.yml\n- testsuite/run_sets/secondary.yml\n- testsuite/run_sets/sle-updates.yml:\nUpdate with the new file names.", "committedDate": "2020-07-27T10:00:49Z", "type": "forcePushed"}]}