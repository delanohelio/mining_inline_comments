{"pr_number": 1859, "pr_title": "TESTSUITE: Add tests for content staging in Ubuntu minion", "pr_createdAt": "2020-02-03T12:28:06Z", "pr_url": "https://github.com/uyuni-project/uyuni/pull/1859", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDA4MDczMQ==", "url": "https://github.com/uyuni-project/uyuni/pull/1859#discussion_r374080731", "bodyText": "Don't re-add this file please.", "author": "Bischoff", "createdAt": "2020-02-03T12:42:59Z", "path": "testsuite/run_sets/testsuite.yml", "diffHunk": "@@ -0,0 +1,143 @@\n+# This file describes the order of features in a normal testsuite run.", "originalCommit": "d1b56972f793192b8ba0b3d1225b4afe9df8d86f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDEwMDcyOA==", "url": "https://github.com/uyuni-project/uyuni/pull/1859#discussion_r374100728", "bodyText": "In order to cover other clients could you please do that?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              if host == 'sle_minion'\n          \n          \n            \n              if host.include? 'ubuntu'\n          \n          \n            \n                cmd = \"ls /var/cache/apt/archives/#{pkg_name}*.deb\"\n          \n          \n            \n              else\n          \n          \n            \n                cmd = \"ls /var/cache/zypp/packages/susemanager:test-channel-x86_64/getPackage/*/*/#{pkg_name}*.rpm\"\n          \n          \n            \n              end", "author": "srbarrios", "createdAt": "2020-02-03T13:28:42Z", "path": "testsuite/features/step_definitions/command_steps.rb", "diffHunk": "@@ -703,7 +703,11 @@\n \n When(/^I wait until the package \"(.*?)\" has been cached on this \"(.*?)\"$/) do |pkg_name, host|\n   node = get_target(host)\n-  cmd = \"ls /var/cache/zypp/packages/susemanager:test-channel-x86_64/getPackage/*/*/#{pkg_name}*.rpm\"\n+  if host == 'sle_minion'", "originalCommit": "d1b56972f793192b8ba0b3d1225b4afe9df8d86f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDExMTM0MQ==", "url": "https://github.com/uyuni-project/uyuni/pull/1859#discussion_r374111341", "bodyText": "I already quickly raised this issue with Marcelo. This PR is part of a port, so that change would need to happen in the other branches as well.\nMarcelo? It would mean to port back that change to 4.0 after that.", "author": "Bischoff", "createdAt": "2020-02-03T13:50:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDEwMDcyOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDExMDQ3NA==", "url": "https://github.com/uyuni-project/uyuni/pull/1859#discussion_r374110474", "bodyText": "2017-2020", "author": "Bischoff", "createdAt": "2020-02-03T13:48:29Z", "path": "testsuite/features/secondary/min_ubuntu_salt_install_with_staging.feature", "diffHunk": "@@ -0,0 +1,66 @@\n+# Copyright (c) 2017-2019 SUSE LLC", "originalCommit": "d1b56972f793192b8ba0b3d1225b4afe9df8d86f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDExMDYxOA==", "url": "https://github.com/uyuni-project/uyuni/pull/1859#discussion_r374110618", "bodyText": "I install old package \"virgo-dummy=1.0\"", "author": "Bischoff", "createdAt": "2020-02-03T13:48:46Z", "path": "testsuite/features/secondary/min_ubuntu_salt_install_with_staging.feature", "diffHunk": "@@ -0,0 +1,66 @@\n+# Copyright (c) 2017-2019 SUSE LLC\n+# Licensed under the terms of the MIT license.\n+#\n+# This feature relies on having properly configured\n+#   /etc/rhn/rhn.conf\n+# file on your SUSE Manager server.\n+#\n+# For the scope of these tests, we configure it as follows:\n+#   java.salt_content_staging_window = 0.033 (2 minutes)\n+#   java.salt_content_staging_advance = 0.05 (3 minutes)\n+# which means \"between 3 and 1 minutes before package installation or patching\"\n+\n+@ubuntu_minion\n+Feature: Install a package on the Ubuntu minion with staging enabled\n+\n+  Scenario: Pre-requisite: install virgo-dummy-1.0 package, make sure orion-dummy is not present on Ubuntu minion\n+    When I enable repository \"test_repo_deb_pool\" on this \"ubuntu_minion\"\n+    And I run \"apt update\" on \"ubuntu_minion\"\n+    And I remove package \"orion-dummy\" from this \"ubuntu_minion\"\n+    And I install package \"virgo-dummy=1.0\" on this \"ubuntu_minion\"", "originalCommit": "d1b56972f793192b8ba0b3d1225b4afe9df8d86f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f581e8c7a2098681a19cdb182e4cb0a00ed9a551", "url": "https://github.com/uyuni-project/uyuni/commit/f581e8c7a2098681a19cdb182e4cb0a00ed9a551", "message": "TESTSUITE: Add tests for content staging in Ubuntu minion", "committedDate": "2020-06-10T10:22:39Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODAyODAzMQ==", "url": "https://github.com/uyuni-project/uyuni/pull/1859#discussion_r438028031", "bodyText": "elsif", "author": "Bischoff", "createdAt": "2020-06-10T10:39:39Z", "path": "testsuite/features/step_definitions/command_steps.rb", "diffHunk": "@@ -770,7 +770,11 @@\n \n When(/^I wait until the package \"(.*?)\" has been cached on this \"(.*?)\"$/) do |pkg_name, host|\n   node = get_target(host)\n-  cmd = \"ls /var/cache/zypp/packages/susemanager:test-channel-x86_64/getPackage/*/*/#{pkg_name}*.rpm\"\n+  if host == 'sle_minion'\n+    cmd = \"ls /var/cache/zypp/packages/susemanager:test-channel-x86_64/getPackage/*/*/#{pkg_name}*.rpm\"\n+  if host.include? 'ubuntu'", "originalCommit": "f581e8c7a2098681a19cdb182e4cb0a00ed9a551", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f58680fcb35ccd3216a5d2f019cb16385dd76f24", "url": "https://github.com/uyuni-project/uyuni/commit/f58680fcb35ccd3216a5d2f019cb16385dd76f24", "message": "TESTSUITE: Add tests for content staging in Ubuntu minion", "committedDate": "2020-06-10T10:41:05Z", "type": "commit"}, {"oid": "f58680fcb35ccd3216a5d2f019cb16385dd76f24", "url": "https://github.com/uyuni-project/uyuni/commit/f58680fcb35ccd3216a5d2f019cb16385dd76f24", "message": "TESTSUITE: Add tests for content staging in Ubuntu minion", "committedDate": "2020-06-10T10:41:05Z", "type": "forcePushed"}]}