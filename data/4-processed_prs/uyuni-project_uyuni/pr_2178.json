{"pr_number": 2178, "pr_title": "Manager bsc1169535", "pr_createdAt": "2020-04-30T14:32:12Z", "pr_url": "https://github.com/uyuni-project/uyuni/pull/2178", "timeline": [{"oid": "e05eef3cb3b6e59e926cbc4f8e85e5af7faea1bf", "url": "https://github.com/uyuni-project/uyuni/commit/e05eef3cb3b6e59e926cbc4f8e85e5af7faea1bf", "message": "ensure correct /etc/apache2/conf.d/susemanager-tftpsync-recv.conf after upgrade (bsc#1169535)", "committedDate": "2020-04-30T14:22:49Z", "type": "commit"}, {"oid": "d4ab64dcaf2075628a5f6c3f5013b79060d22665", "url": "https://github.com/uyuni-project/uyuni/commit/d4ab64dcaf2075628a5f6c3f5013b79060d22665", "message": "ensure correct /etc/apache2/conf.d/susemanager-tftpsync-recv.conf after upgrade (bsc#1169535)", "committedDate": "2020-04-30T14:23:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODEyNzE2MQ==", "url": "https://github.com/uyuni-project/uyuni/pull/2178#discussion_r418127161", "bodyText": "Wasn't there a rule that RPM post scripts should never fail?\nAFAIK RPM would see this as a broken package.\nReporting the error is ok, but I think it should still \"exit 0\".\nMaybe check back with @mlandres", "author": "mcalmer", "createdAt": "2020-04-30T16:13:19Z", "path": "tftpsync/susemanager-tftpsync-recv/susemanager-tftpsync-recv.spec", "diffHunk": "@@ -70,6 +70,20 @@ if [ -d /srv/tftpboot ]; then\n     chmod 750 /srv/tftpboot\n     chown wwwrun:tftp /srv/tftpboot\n fi\n+if [ -f /etc/apache2/conf.d/susemanager-tftpsync-recv.conf.rpmnew ]; then\n+    PARENT_FQDN=$( egrep -m1 \"^proxy.rhn_parent[[:space:]]*=\" /etc/rhn/rhn.conf | sed 's/^proxy.rhn_parent[[:space:]]*=[[:space:]]*\\(.*\\)/\\1/' || echo \"\" )\n+    if [ -z \"$PARENT_FQDN\" ]; then\n+            echo \"Could not determine SUSE Manager Parent Hostname! Got /etc/rhn/rhn.conf vanished?\" >&2;\n+            exit 1;", "originalCommit": "d4ab64dcaf2075628a5f6c3f5013b79060d22665", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTIzNDA3OQ==", "url": "https://github.com/uyuni-project/uyuni/pull/2178#discussion_r419234079", "bodyText": "If %post exits !=0 rpm will nevertheless consider the package as being installed. It's been successfully extracted to disk and remembered in the rpm database. A failed %post won't undo this. Rpm exits 0.\nZypper however may return 107 - ZYPPER_EXIT_INF_RPM_SCRIPT_FAILED if it detects a failed %post.", "author": "mlandres", "createdAt": "2020-05-04T06:32:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODEyNzE2MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTI4NDE4OA==", "url": "https://github.com/uyuni-project/uyuni/pull/2178#discussion_r419284188", "bodyText": "So what should we do here? In any case the functionality will be broken, so I think we should leave it as it is!?", "author": "mantel", "createdAt": "2020-05-04T08:32:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODEyNzE2MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTMyMzU2Mw==", "url": "https://github.com/uyuni-project/uyuni/pull/2178#discussion_r419323563", "bodyText": "I am fine if it does not create a problem with RPM.", "author": "mcalmer", "createdAt": "2020-05-04T09:48:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODEyNzE2MQ=="}], "type": "inlineReview"}]}