{"pr_number": 1856, "pr_title": "Testsuite - accessing element to trigger DOM refresh", "pr_createdAt": "2020-02-03T10:05:57Z", "pr_url": "https://github.com/uyuni-project/uyuni/pull/1856", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDAyNzA1Ng==", "url": "https://github.com/uyuni-project/uyuni/pull/1856#discussion_r374027056", "bodyText": "Could it be the first assignment (the one with the comment) is enough, and we do not need the other two?\nAfter all, if the problem is to force access to DOM tree, once is enough, isn't it?", "author": "Bischoff", "createdAt": "2020-02-03T10:31:43Z", "path": "testsuite/features/step_definitions/salt_steps.rb", "diffHunk": "@@ -271,14 +271,16 @@\n   # Complicated code because the checkbox is not a <input type=checkbox> but an <i>\n   xpath_query = \"//a[@id = '#{formula}']/i[@class = 'fa fa-lg fa-square-o']\" if action == 'check'\n   xpath_query = \"//a[@id = '#{formula}']/i[@class = 'fa fa-lg fa-check-square-o']\" if action == 'uncheck'\n-  puts \"Selected formulas [beginning]:\\n#{find('#chooseFormulas')['innerHTML']}\"\n+  # WORKAROUND\n+  # DOM refreshes content of chooseFormulas element by accessing it. Then conditions are evaluated properly.\n+  _inner_element = find('#chooseFormulas')['innerHTML']\n   if all(:xpath, xpath_query, wait: DEFAULT_TIMEOUT).any?\n-    puts \"Selected formulas [if]:\\n#{find('#chooseFormulas')['innerHTML']}\"\n+    _inner_element = find('#chooseFormulas')['innerHTML']", "originalCommit": "9087cc4b55a91d7b18771cf5f9834ffb053bc166", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDAzMjQ4MA==", "url": "https://github.com/uyuni-project/uyuni/pull/1856#discussion_r374032480", "bodyText": "we just need to access the element not the assignment, we could just use:\nfind('#chooseFormulas')['innerHTML']", "author": "calancha", "createdAt": "2020-02-03T10:43:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDAyNzA1Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDA0NjA1MQ==", "url": "https://github.com/uyuni-project/uyuni/pull/1856#discussion_r374046051", "bodyText": "That too, yes", "author": "Bischoff", "createdAt": "2020-02-03T11:14:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDAyNzA1Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDA1MTE0Mg==", "url": "https://github.com/uyuni-project/uyuni/pull/1856#discussion_r374051142", "bodyText": "@calancha @Bischoff I know :-) It came to my mind too. My first intention was to keep this solution as close as possible to the previous one. But it is also true, that the other two additional puts were present only for debug print. So... I will change it ;-)", "author": "lkotek", "createdAt": "2020-02-03T11:27:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDAyNzA1Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDA1MjIxMg==", "url": "https://github.com/uyuni-project/uyuni/pull/1856#discussion_r374052212", "bodyText": "@lkotek maybe give it an extra testing shot with those changes, just in case?", "author": "Bischoff", "createdAt": "2020-02-03T11:29:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDAyNzA1Ng=="}], "type": "inlineReview"}, {"oid": "e62bda984ea6686a6146cc153c83dc9c71544f9c", "url": "https://github.com/uyuni-project/uyuni/commit/e62bda984ea6686a6146cc153c83dc9c71544f9c", "message": "accessing element to trigger DOM refresh", "committedDate": "2020-02-03T11:33:33Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDA1OTI2OA==", "url": "https://github.com/uyuni-project/uyuni/pull/1856#discussion_r374059268", "bodyText": "Interesting, I thought that rubocop complains if we don't add a newline after a raise.", "author": "srbarrios", "createdAt": "2020-02-03T11:47:27Z", "path": "testsuite/features/step_definitions/salt_steps.rb", "diffHunk": "@@ -271,15 +271,19 @@\n   # Complicated code because the checkbox is not a <input type=checkbox> but an <i>\n   xpath_query = \"//a[@id = '#{formula}']/i[@class = 'fa fa-lg fa-square-o']\" if action == 'check'\n   xpath_query = \"//a[@id = '#{formula}']/i[@class = 'fa fa-lg fa-check-square-o']\" if action == 'uncheck'\n-  puts \"Selected formulas [beginning]:\\n#{find('#chooseFormulas')['innerHTML']}\"\n+  # WORKAROUND\n+  # DOM refreshes content of chooseFormulas element by accessing it. Then conditions are evaluated properly.\n+  find('#chooseFormulas')['innerHTML']\n   if all(:xpath, xpath_query, wait: DEFAULT_TIMEOUT).any?\n-    puts \"Selected formulas [if]:\\n#{find('#chooseFormulas')['innerHTML']}\"\n-    raise \"xpath: #{xpath_query} not found\" unless find(:xpath, xpath_query, wait: DEFAULT_TIMEOUT).click\n+    element = find(:xpath, xpath_query, match: :first ,wait: DEFAULT_TIMEOUT) if find('#chooseFormulas')\n+    raise \"xpath: #{xpath_query} not found\" unless element.nil?    ", "originalCommit": "90b9685846397f7f3e5e9b8d8bc8078c6a437085", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDA3NDU1Mw==", "url": "https://github.com/uyuni-project/uyuni/pull/1856#discussion_r374074553", "bodyText": "Remove the `if find(#chooseFormulas) i.e. revert to original code", "author": "Bischoff", "createdAt": "2020-02-03T12:27:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDA1OTI2OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDA1OTY1NA==", "url": "https://github.com/uyuni-project/uyuni/pull/1856#discussion_r374059654", "bodyText": "We can get rid of that one, as we are already acting through it later on.", "author": "srbarrios", "createdAt": "2020-02-03T11:48:29Z", "path": "testsuite/features/step_definitions/salt_steps.rb", "diffHunk": "@@ -271,15 +271,19 @@\n   # Complicated code because the checkbox is not a <input type=checkbox> but an <i>\n   xpath_query = \"//a[@id = '#{formula}']/i[@class = 'fa fa-lg fa-square-o']\" if action == 'check'\n   xpath_query = \"//a[@id = '#{formula}']/i[@class = 'fa fa-lg fa-check-square-o']\" if action == 'uncheck'\n-  puts \"Selected formulas [beginning]:\\n#{find('#chooseFormulas')['innerHTML']}\"\n+  # WORKAROUND\n+  # DOM refreshes content of chooseFormulas element by accessing it. Then conditions are evaluated properly.\n+  find('#chooseFormulas')['innerHTML']", "originalCommit": "90b9685846397f7f3e5e9b8d8bc8078c6a437085", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDA3NDA4Mg==", "url": "https://github.com/uyuni-project/uyuni/pull/1856#discussion_r374074082", "bodyText": "No. We must keep the first one and remove the others.", "author": "Bischoff", "createdAt": "2020-02-03T12:25:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDA1OTY1NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDA3OTQ1Mw==", "url": "https://github.com/uyuni-project/uyuni/pull/1856#discussion_r374079453", "bodyText": "Yep, this is important. Well if there is one single important line in this PR, it is this one :-D", "author": "lkotek", "createdAt": "2020-02-03T12:39:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDA1OTY1NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDA3NTA3Mg==", "url": "https://github.com/uyuni-project/uyuni/pull/1856#discussion_r374075072", "bodyText": "Remove the `if find(#chooseFormulas) i.e. revert to original code", "author": "Bischoff", "createdAt": "2020-02-03T12:28:15Z", "path": "testsuite/features/step_definitions/salt_steps.rb", "diffHunk": "@@ -271,15 +271,19 @@\n   # Complicated code because the checkbox is not a <input type=checkbox> but an <i>\n   xpath_query = \"//a[@id = '#{formula}']/i[@class = 'fa fa-lg fa-square-o']\" if action == 'check'\n   xpath_query = \"//a[@id = '#{formula}']/i[@class = 'fa fa-lg fa-check-square-o']\" if action == 'uncheck'\n-  puts \"Selected formulas [beginning]:\\n#{find('#chooseFormulas')['innerHTML']}\"\n+  # WORKAROUND\n+  # DOM refreshes content of chooseFormulas element by accessing it. Then conditions are evaluated properly.\n+  find('#chooseFormulas')['innerHTML']\n   if all(:xpath, xpath_query, wait: DEFAULT_TIMEOUT).any?\n-    puts \"Selected formulas [if]:\\n#{find('#chooseFormulas')['innerHTML']}\"\n-    raise \"xpath: #{xpath_query} not found\" unless find(:xpath, xpath_query, wait: DEFAULT_TIMEOUT).click\n+    element = find(:xpath, xpath_query, match: :first ,wait: DEFAULT_TIMEOUT) if find('#chooseFormulas')\n+    raise \"xpath: #{xpath_query} not found\" unless element.nil?    \n+    element.click   \n   else\n     xpath_query = \"//a[@id = '#{formula}']/i[@class = 'fa fa-lg fa-check-square-o']\" if action == 'check'\n     xpath_query = \"//a[@id = '#{formula}']/i[@class = 'fa fa-lg fa-square-o']\" if action == 'uncheck'\n-    puts \"Selected formulas [else]:\\n#{find('#chooseFormulas')['innerHTML']}\"\n-    raise \"xpath: #{xpath_query} not found\" unless all(:xpath, xpath_query, wait: DEFAULT_TIMEOUT).any?\n+    element = find(:xpath, xpath_query, match: :first ,wait: DEFAULT_TIMEOUT) if find('#chooseFormulas')\n+    raise \"xpath: #{xpath_query} not found\" unless element.nil?    ", "originalCommit": "90b9685846397f7f3e5e9b8d8bc8078c6a437085", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDA4MjQxNQ==", "url": "https://github.com/uyuni-project/uyuni/pull/1856#discussion_r374082415", "bodyText": "@Bischoff Yep, it just failed in run 1034. Sorry @srbarrios :-(", "author": "lkotek", "createdAt": "2020-02-03T12:47:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDA3NTA3Mg=="}], "type": "inlineReview"}, {"oid": "cd24b37f0bd3f34604d8458779617026872ed356", "url": "https://github.com/uyuni-project/uyuni/commit/cd24b37f0bd3f34604d8458779617026872ed356", "message": "reintroduction of previous exception raise", "committedDate": "2020-02-03T15:01:28Z", "type": "forcePushed"}, {"oid": "ae13a2288e1b6eb3f3dddaa4f76bffb2d86706ec", "url": "https://github.com/uyuni-project/uyuni/commit/ae13a2288e1b6eb3f3dddaa4f76bffb2d86706ec", "message": "accessing element to trigger DOM refresh", "committedDate": "2020-02-04T08:39:04Z", "type": "commit"}, {"oid": "ae13a2288e1b6eb3f3dddaa4f76bffb2d86706ec", "url": "https://github.com/uyuni-project/uyuni/commit/ae13a2288e1b6eb3f3dddaa4f76bffb2d86706ec", "message": "accessing element to trigger DOM refresh", "committedDate": "2020-02-04T08:39:04Z", "type": "forcePushed"}]}