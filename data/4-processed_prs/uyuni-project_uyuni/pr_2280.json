{"pr_number": 2280, "pr_title": "Drop unpublished errata functionality (Web UI)", "pr_createdAt": "2020-06-03T16:35:54Z", "pr_url": "https://github.com/uyuni-project/uyuni/pull/2280", "timeline": [{"oid": "3de78fcc64ae72761bc59ab4311b87b45aa2e865", "url": "https://github.com/uyuni-project/uyuni/commit/3de78fcc64ae72761bc59ab4311b87b45aa2e865", "message": "Clone patches as published in the UI", "committedDate": "2020-06-05T20:59:54Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjU1ODc3NA==", "url": "https://github.com/uyuni-project/uyuni/pull/2280#discussion_r436558774", "bodyText": "makes sense to use com.redhat.rhn.frontend.struts.RequestContext.ERRATA_ID here as well", "author": "chiaradiamarcelo", "createdAt": "2020-06-08T09:13:03Z", "path": "java/code/src/com/redhat/rhn/frontend/action/errata/ChannelAction.java", "diffHunk": "@@ -246,18 +246,20 @@ protected void processMethodKeys(Map<String, String> map) {\n      * {@inheritDoc}\n      * Add eid to our parameter map\n      */\n-    protected void processParamMap(ActionForm formIn,\n+    public void processParamMap(ActionForm formIn,\n                                    HttpServletRequest request,\n                                    Map<String, Object> params) {\n         //keep eid in params\n-        Long eid = new RequestContext(request).getRequiredParam(\"eid\");\n+        Long eid = new RequestContext(request).getParamAsLong(\"eid\");", "originalCommit": "31bfd0fcb0a191f58eccd8fd9ccd772f8963a1c2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjc1NTQwMw==", "url": "https://github.com/uyuni-project/uyuni/pull/2280#discussion_r436755403", "bodyText": "Addressed", "author": "moio", "createdAt": "2020-06-08T14:33:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjU1ODc3NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjU1ODg2Nw==", "url": "https://github.com/uyuni-project/uyuni/pull/2280#discussion_r436558867", "bodyText": "same here", "author": "chiaradiamarcelo", "createdAt": "2020-06-08T09:13:15Z", "path": "java/code/src/com/redhat/rhn/frontend/action/errata/ChannelAction.java", "diffHunk": "@@ -246,18 +246,20 @@ protected void processMethodKeys(Map<String, String> map) {\n      * {@inheritDoc}\n      * Add eid to our parameter map\n      */\n-    protected void processParamMap(ActionForm formIn,\n+    public void processParamMap(ActionForm formIn,\n                                    HttpServletRequest request,\n                                    Map<String, Object> params) {\n         //keep eid in params\n-        Long eid = new RequestContext(request).getRequiredParam(\"eid\");\n+        Long eid = new RequestContext(request).getParamAsLong(\"eid\");\n+        if (eid != null) {\n+            params.put(\"eid\", eid);", "originalCommit": "31bfd0fcb0a191f58eccd8fd9ccd772f8963a1c2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjc1NTUxMw==", "url": "https://github.com/uyuni-project/uyuni/pull/2280#discussion_r436755513", "bodyText": "Addressed", "author": "moio", "createdAt": "2020-06-08T14:33:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjU1ODg2Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjU1OTk0Mg==", "url": "https://github.com/uyuni-project/uyuni/pull/2280#discussion_r436559942", "bodyText": "might make sense to return an optional here if Errata can be null. Maybe for a next PR", "author": "chiaradiamarcelo", "createdAt": "2020-06-08T09:15:14Z", "path": "java/code/src/com/redhat/rhn/frontend/action/errata/ChannelSetupAction.java", "diffHunk": "@@ -65,7 +68,8 @@ public ActionForward execute(ActionMapping mapping,\n         clampListBounds(pc, request, user);\n \n         //Get the errata object\n-        Errata e = requestContext.lookupErratum();\n+        Long errataId = requestContext.getParamAsLong(ERRATA_ID);\n+        Errata e = ErrataManager.lookupErrata(errataId, requestContext.getCurrentUser());", "originalCommit": "31bfd0fcb0a191f58eccd8fd9ccd772f8963a1c2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjc1MjUzMg==", "url": "https://github.com/uyuni-project/uyuni/pull/2280#discussion_r436752532", "bodyText": "Yes, I am adding that to the list for the follow-up cleanup PR.", "author": "moio", "createdAt": "2020-06-08T14:28:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjU1OTk0Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjU2Mzk2MA==", "url": "https://github.com/uyuni-project/uyuni/pull/2280#discussion_r436563960", "bodyText": "is the whole concept of \"publishing an errata\" still valid? can it be an errata in another state that is \"not published\"?\nshouldn't we do this as part of the creation of the errata?", "author": "chiaradiamarcelo", "createdAt": "2020-06-08T09:22:12Z", "path": "java/code/src/com/redhat/rhn/frontend/action/errata/CreateAction.java", "diffHunk": "@@ -134,6 +148,7 @@ public ActionForward execute(ActionMapping mapping,\n         e.setOrg(user.getOrg());\n \n         ErrataManager.storeErrata(e);\n+        ErrataManager.publish(e, channelAction.getChannelIdsFromRhnSet(set), user);", "originalCommit": "31bfd0fcb0a191f58eccd8fd9ccd772f8963a1c2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjc1NDY2NQ==", "url": "https://github.com/uyuni-project/uyuni/pull/2280#discussion_r436754665", "bodyText": "The concept of publishing an errata per se remains - it's just that before, one could publish both an unpublished or a published errata - now unpublished errata cease to exist. So the only remaining option is to re-publish something that was already published before - which is a valid thing to do.\nOn a high level, I completely agree the \"first publishing\" should be part of errata creation. Whether that means to wrap those methods together in this specific case is something I would leave for the follow up PR.\nSo see you there, if you agree.", "author": "moio", "createdAt": "2020-06-08T14:31:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjU2Mzk2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjc3OTU0OQ==", "url": "https://github.com/uyuni-project/uyuni/pull/2280#discussion_r436779549", "bodyText": "It would be nice to address this in a follow up PR for clarify. Thanks", "author": "chiaradiamarcelo", "createdAt": "2020-06-08T15:05:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjU2Mzk2MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjU2NTA1NQ==", "url": "https://github.com/uyuni-project/uyuni/pull/2280#discussion_r436565055", "bodyText": "Should we still use the \"publish\" word in the UI? to me it gives some sense of \"an errata can be in another state than 'published'\"", "author": "chiaradiamarcelo", "createdAt": "2020-06-08T09:24:14Z", "path": "java/code/src/com/redhat/rhn/frontend/strings/jsp/StringResource_en_US.xml", "diffHunk": "@@ -3384,7 +3384,7 @@ button below, and &lt;b&gt;will be unable to log back in&lt;/b&gt;.</source>\n         </context-group>\n       </trans-unit>\n       <trans-unit id=\"errata.publish.nochannelsselected\">\n-        <source>A published patch must belong to at least one channel.</source>\n+        <source>At least one channel must be selected for publishing.</source>", "originalCommit": "31bfd0fcb0a191f58eccd8fd9ccd772f8963a1c2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjc1NTI5NA==", "url": "https://github.com/uyuni-project/uyuni/pull/2280#discussion_r436755294", "bodyText": "Reworded.", "author": "moio", "createdAt": "2020-06-08T14:32:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjU2NTA1NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjU2NjE5Nw==", "url": "https://github.com/uyuni-project/uyuni/pull/2280#discussion_r436566197", "bodyText": "same here. I would remove the the \"publish\":\n\"The patches listed here will be cloned in the channels selected below. Once they are cloned, they will appear in each channel's patch list.\"", "author": "chiaradiamarcelo", "createdAt": "2020-06-08T09:26:25Z", "path": "java/code/src/com/redhat/rhn/frontend/strings/jsp/StringResource_en_US.xml", "diffHunk": "@@ -7191,7 +7191,7 @@ organization management tools if you choose to remove this role from your login.\n         </context-group>\n       </trans-unit>\n       <trans-unit id=\"cloneconfirm.jsp.pagesummary\">\n-        <source>The patches listed below will be cloned. Once they are cloned, they will appear in your &lt;a href=&quot;{0}&quot;&gt;unpublished patches list&lt;/a&gt;. From there you can verify the text and associated packages for each patch. Once you are ready, you can publish the patches so they are available to users in your organization.</source>\n+        <source>The patches listed here will be cloned and published in the channels selected below. Once they are cloned, they will appear in each channel's patch list.</source>", "originalCommit": "3de78fcc64ae72761bc59ab4311b87b45aa2e865", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjc1NTkwNA==", "url": "https://github.com/uyuni-project/uyuni/pull/2280#discussion_r436755904", "bodyText": "Reworded", "author": "moio", "createdAt": "2020-06-08T14:33:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjU2NjE5Nw=="}], "type": "inlineReview"}, {"oid": "75fcb39d0bb037ce1ccc0979899024cb714051e2", "url": "https://github.com/uyuni-project/uyuni/commit/75fcb39d0bb037ce1ccc0979899024cb714051e2", "message": "Bugfix: fallback did not work in all cases", "committedDate": "2020-06-08T13:57:39Z", "type": "forcePushed"}, {"oid": "33eba668b7dd94979c39c6efd64c9e29798ee4b3", "url": "https://github.com/uyuni-project/uyuni/commit/33eba668b7dd94979c39c6efd64c9e29798ee4b3", "message": "Bugfix: fallback did not work in all cases", "committedDate": "2020-06-08T14:51:57Z", "type": "forcePushed"}, {"oid": "88f8eb18c11c4e37405c8a8c18adca061ec6494d", "url": "https://github.com/uyuni-project/uyuni/commit/88f8eb18c11c4e37405c8a8c18adca061ec6494d", "message": "Drop errata_is_published ACL", "committedDate": "2020-06-08T15:15:41Z", "type": "commit"}, {"oid": "74e3ea0384f70ad203901ffa5bec18342e6a629b", "url": "https://github.com/uyuni-project/uyuni/commit/74e3ea0384f70ad203901ffa5bec18342e6a629b", "message": "Allow to create published patches in the UI\n\nPreviously, any patch had to be created unpublished first, and then\npublished to channels. This patch allows to create published patches\nright away.", "committedDate": "2020-06-08T15:15:41Z", "type": "commit"}, {"oid": "b9c8fe5f6c2250c958abb520c3452b45835ba342", "url": "https://github.com/uyuni-project/uyuni/commit/b9c8fe5f6c2250c958abb520c3452b45835ba342", "message": "Remove unpublished errata from menu", "committedDate": "2020-06-08T15:15:41Z", "type": "commit"}, {"oid": "c2c4256b63f8117889ddc1264c8e88968dccbd5f", "url": "https://github.com/uyuni-project/uyuni/commit/c2c4256b63f8117889ddc1264c8e88968dccbd5f", "message": "Adapt Cucumber tests", "committedDate": "2020-06-08T15:15:41Z", "type": "commit"}, {"oid": "fcf6fe28710975804d61fd5092c9730ae6990b8a", "url": "https://github.com/uyuni-project/uyuni/commit/fcf6fe28710975804d61fd5092c9730ae6990b8a", "message": "Clone patches as published in the UI", "committedDate": "2020-06-08T15:15:41Z", "type": "commit"}, {"oid": "5ff85c8b8d70e615bad7f1f11deb83219bbdea6f", "url": "https://github.com/uyuni-project/uyuni/commit/5ff85c8b8d70e615bad7f1f11deb83219bbdea6f", "message": "Adapt JUnit tests", "committedDate": "2020-06-08T15:15:41Z", "type": "commit"}, {"oid": "67bfec9757b53c778d87f68613ac3575b9e84276", "url": "https://github.com/uyuni-project/uyuni/commit/67bfec9757b53c778d87f68613ac3575b9e84276", "message": "Bugfix: fallback did not work in all cases", "committedDate": "2020-06-08T15:15:41Z", "type": "commit"}, {"oid": "67bfec9757b53c778d87f68613ac3575b9e84276", "url": "https://github.com/uyuni-project/uyuni/commit/67bfec9757b53c778d87f68613ac3575b9e84276", "message": "Bugfix: fallback did not work in all cases", "committedDate": "2020-06-08T15:15:41Z", "type": "forcePushed"}, {"oid": "f5f253582323b6eb08c81758dd5fe384764fa531", "url": "https://github.com/uyuni-project/uyuni/commit/f5f253582323b6eb08c81758dd5fe384764fa531", "message": "Port translations", "committedDate": "2020-06-08T15:57:26Z", "type": "commit"}]}