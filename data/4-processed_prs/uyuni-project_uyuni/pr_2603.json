{"pr_number": 2603, "pr_title": "Testsuite: Hide internal details from Cucumber", "pr_createdAt": "2020-09-15T11:16:40Z", "pr_url": "https://github.com/uyuni-project/uyuni/pull/2603", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODYyOTcxMQ==", "url": "https://github.com/uyuni-project/uyuni/pull/2603#discussion_r488629711", "bodyText": "This PR has two different topics imho.\nI like the idea of hiding some navigation steps, to reduce lines in our scenarios, as far they are clear, as in this PR. So, from that topic LGTM.\nBut then, I would prefer to stick with the previous step definitions of the selected lines, I don't care about the \"timeouts\", fine to hide this part. I'm also fine to hide the user who scheduled the event if we log-in smartly.\nBut I think we should still continue making it parametrizable and visible to the user the \"suse_os_image\" text, so the image name.\nAbout the smart login for kiwi, in a different PR... we can for instance refactor this step:\n    Given I am authorized as \"kiwikiwi\" with password \"kiwikiwi\"\t\n\nFor something that we can handle better, and let us hide the user from the steps we are changing in this PR.\nFor instance, we can add here a new \"Image Build\" entry here, and authorize it as kiwikiwi.\n# Menu permission check\nGiven(/^I am authorized for the \"([^\"]*)\" section$/) do |section|\n  case section\n  when 'Admin'\n    step %(I am authorized as \"admin\" with password \"admin\")\n  end\nend", "author": "srbarrios", "createdAt": "2020-09-15T12:34:58Z", "path": "testsuite/features/secondary/buildhost_osimage_build_image.feature", "diffHunk": "@@ -37,9 +37,8 @@ Feature: Build OS images\n   Scenario: Check the OS image built as Kiwi image administrator\n     Given I am on the Systems overview page of this \"build_host\"\n     Then I should see a \"[OS Image Build Host]\" text\n-    When I wait at most 3300 seconds until event \"Image Build suse_os_image scheduled by kiwikiwi\" is completed\n-    And I wait at most 300 seconds until event \"Image Inspect 1//suse_os_image:latest scheduled by kiwikiwi\" is completed\n-    And I navigate to \"os-images/1/\" page\n+    When I wait until the image build is completed\n+    And I am on the new image page", "originalCommit": "2556fe32fd5d8b5d69102021f8a1afb10b936f50", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODY3MjA0NQ==", "url": "https://github.com/uyuni-project/uyuni/pull/2603#discussion_r488672045", "bodyText": "Good idea, that way we can finally get the second case in that switch.", "author": "calancha", "createdAt": "2020-09-15T13:35:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODYyOTcxMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODYzMDc0Mg==", "url": "https://github.com/uyuni-project/uyuni/pull/2603#discussion_r488630742", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                When I wait until the image build is completed\n          \n          \n            \n                When I wait until the image build \"suse_os_image\" is completed", "author": "srbarrios", "createdAt": "2020-09-15T12:36:38Z", "path": "testsuite/features/secondary/buildhost_osimage_build_image.feature", "diffHunk": "@@ -37,9 +37,8 @@ Feature: Build OS images\n   Scenario: Check the OS image built as Kiwi image administrator\n     Given I am on the Systems overview page of this \"build_host\"\n     Then I should see a \"[OS Image Build Host]\" text\n-    When I wait at most 3300 seconds until event \"Image Build suse_os_image scheduled by kiwikiwi\" is completed\n-    And I wait at most 300 seconds until event \"Image Inspect 1//suse_os_image:latest scheduled by kiwikiwi\" is completed\n-    And I navigate to \"os-images/1/\" page\n+    When I wait until the image build is completed", "originalCommit": "2556fe32fd5d8b5d69102021f8a1afb10b936f50", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODYzMTIyMQ==", "url": "https://github.com/uyuni-project/uyuni/pull/2603#discussion_r488631221", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                And I am on the new image page\n          \n          \n            \n                And I am on the image page of \"suse_os_image\"", "author": "srbarrios", "createdAt": "2020-09-15T12:37:26Z", "path": "testsuite/features/secondary/buildhost_osimage_build_image.feature", "diffHunk": "@@ -37,9 +37,8 @@ Feature: Build OS images\n   Scenario: Check the OS image built as Kiwi image administrator\n     Given I am on the Systems overview page of this \"build_host\"\n     Then I should see a \"[OS Image Build Host]\" text\n-    When I wait at most 3300 seconds until event \"Image Build suse_os_image scheduled by kiwikiwi\" is completed\n-    And I wait at most 300 seconds until event \"Image Inspect 1//suse_os_image:latest scheduled by kiwikiwi\" is completed\n-    And I navigate to \"os-images/1/\" page\n+    When I wait until the image build is completed\n+    And I am on the new image page", "originalCommit": "2556fe32fd5d8b5d69102021f8a1afb10b936f50", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODY0MzM2NQ==", "url": "https://github.com/uyuni-project/uyuni/pull/2603#discussion_r488643365", "bodyText": "Thank you, your addition looks much better.", "author": "calancha", "createdAt": "2020-09-15T12:55:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODYzMTIyMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODYzNTc1MA==", "url": "https://github.com/uyuni-project/uyuni/pull/2603#discussion_r488635750", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Then(/^I wait until the image build is completed$/) do\n          \n          \n            \n              step %(I wait at most 3300 seconds until event \"Image Build suse_os_image scheduled by kiwikiwi\" is completed)\n          \n          \n            \n              step %(I wait at most 300 seconds until event \"Image Inspect 1//suse_os_image:latest scheduled by kiwikiwi\" is completed)\n          \n          \n            \n            end\n          \n          \n            \n            Then(/^I wait until the image build \"([^\"]*)\" is completed$/) do |image_name|\n          \n          \n            \n              steps %(\n          \n          \n            \n                When I wait at most 3300 seconds until event \"Image Build #{image_name} scheduled by kiwikiwi\" is completed\n          \n          \n            \n                And I wait at most 300 seconds until event \"Image Inspect 1//#{image_name}:latest scheduled by kiwikiwi\" is completed\n          \n          \n            \n              )\n          \n          \n            \n            end", "author": "srbarrios", "createdAt": "2020-09-15T12:44:34Z", "path": "testsuite/features/step_definitions/docker_steps.rb", "diffHunk": "@@ -30,6 +31,19 @@ def retrieve_build_host_id\n   visit(\"https://#{$server.full_hostname}/rhn/manager/cm/build\")\n end\n \n+Then(/^I wait until the image build is completed$/) do\n+  step %(I wait at most 3300 seconds until event \"Image Build suse_os_image scheduled by kiwikiwi\" is completed)\n+  step %(I wait at most 300 seconds until event \"Image Inspect 1//suse_os_image:latest scheduled by kiwikiwi\" is completed)\n+end", "originalCommit": "2556fe32fd5d8b5d69102021f8a1afb10b936f50", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODYzNjkxOA==", "url": "https://github.com/uyuni-project/uyuni/pull/2603#discussion_r488636918", "bodyText": "We might want to research a different way to navigate here, based on the image name or the cmpute image name.", "author": "srbarrios", "createdAt": "2020-09-15T12:46:28Z", "path": "testsuite/features/step_definitions/docker_steps.rb", "diffHunk": "@@ -30,6 +31,19 @@ def retrieve_build_host_id\n   visit(\"https://#{$server.full_hostname}/rhn/manager/cm/build\")\n end\n \n+Then(/^I wait until the image build is completed$/) do\n+  step %(I wait at most 3300 seconds until event \"Image Build suse_os_image scheduled by kiwikiwi\" is completed)\n+  step %(I wait at most 300 seconds until event \"Image Inspect 1//suse_os_image:latest scheduled by kiwikiwi\" is completed)\n+end\n+\n+Then(/^I am on the new image page$/) do\n+  step %(I navigate to \"os-images/1/\" page)", "originalCommit": "2556fe32fd5d8b5d69102021f8a1afb10b936f50", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "6168fa885a407c99803f39d8b018c64487cca40b", "url": "https://github.com/uyuni-project/uyuni/commit/6168fa885a407c99803f39d8b018c64487cca40b", "message": "Testsuite: Hide internal details from Cucumber\n\nConsistently, use step \"I am on the System Overview page\" when appropriate.\nPrefer step \"I follow the left menu ...\" over step \"I navigate to ...\"\n\n- testsuite/features/step_definitions/common_steps.rb\nAdd steps \"I wait until the image build is completed\"\nand \"I am on the new image page\".\nMove stuff for os image build here.\n\n- testsuite/features/secondary/buildhost_osimage_build_image.feature:\nUse the new steps.\n\nCo-authored-by: Oscar Barrios <obarrios@suse.com>", "committedDate": "2020-09-15T13:05:26Z", "type": "forcePushed"}, {"oid": "09a75642f273588f53963380fd29c186ca7b1f42", "url": "https://github.com/uyuni-project/uyuni/commit/09a75642f273588f53963380fd29c186ca7b1f42", "message": "Testsuite: Hide internal details from Cucumber\n\nConsistently, use step \"I am on the System Overview page\" when appropriate.\nPrefer step \"I follow the left menu ...\" over step \"I navigate to ...\"\n\n- testsuite/features/step_definitions/common_steps.rb\nAdd steps \"I wait until the image build is completed\"\nand \"I am on the new image page\".\nMove stuff for os image build here.\n\n- testsuite/features/secondary/buildhost_osimage_build_image.feature:\nUse the new steps.\n\nCo-authored-by: Oscar Barrios <obarrios@suse.com>", "committedDate": "2020-09-15T13:18:57Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODk4MjE1MQ==", "url": "https://github.com/uyuni-project/uyuni/pull/2603#discussion_r488982151", "bodyText": "This step is not implemented yet, right? \ud83e\udd14", "author": "srbarrios", "createdAt": "2020-09-15T21:25:37Z", "path": "testsuite/features/step_definitions/docker_steps.rb", "diffHunk": "@@ -30,6 +31,21 @@ def retrieve_build_host_id\n   visit(\"https://#{$server.full_hostname}/rhn/manager/cm/build\")\n end\n \n+Then(/^I wait until the image build \"([^\"]*)\" is completed$/) do |image_name|\n+  steps %(\n+    When I wait at most 3300 seconds until event \"Image Build #{image_name} scheduled by kiwikiwi\" is completed\n+    And I wait at most 300 seconds until event \"Image Inspect 1//#{image_name}:latest scheduled by kiwikiwi\" is completed\n+  )\n+end\n+\n+Then(/^I am on the image page of \"([^\"]*)\"$/) do |image_name|\n+  step %(I navigate to \"#{image_name}\" page)", "originalCommit": "09a75642f273588f53963380fd29c186ca7b1f42", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDAwNzk4NQ==", "url": "https://github.com/uyuni-project/uyuni/pull/2603#discussion_r490007985", "bodyText": "Right.  Thank you.\nActually, for this step we don't need to pass the name of the image.\nI have few ideas, what do you prefer?\n\n\nJust keep the original step:\nAnd I navigate to \"os-images/1/\" page\n\n\nAdd a step to hide 'os-images/1/':\nAnd I am on the ...\n\n\nWrap the last 2 steps of the scenario in one step:\n`Then the image should exist on server", "author": "calancha", "createdAt": "2020-09-17T06:46:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODk4MjE1MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDA3MTk4OA==", "url": "https://github.com/uyuni-project/uyuni/pull/2603#discussion_r490071988", "bodyText": "I would try to map somehow the \"suse_os_image\" into \"os-images/1/\", so you can then do something like...\nimage_path = get_image_path(image_name)\nstep %(I navigate to \"#{image_path}\" page)\n\nOr maybe using more navigation \"clicks\"? First looking for the image name in a list, then clicking on it, and some how arrive where we need?", "author": "srbarrios", "createdAt": "2020-09-17T08:39:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODk4MjE1MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDA5MzAyNw==", "url": "https://github.com/uyuni-project/uyuni/pull/2603#discussion_r490093027", "bodyText": "Good idea!\nI have added the function compute_image_url", "author": "calancha", "createdAt": "2020-09-17T09:12:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODk4MjE1MQ=="}], "type": "inlineReview"}, {"oid": "686b97c8171420d38005c6aa8d2ff8bda02e33b2", "url": "https://github.com/uyuni-project/uyuni/commit/686b97c8171420d38005c6aa8d2ff8bda02e33b2", "message": "Use rubocop v0.83.0", "committedDate": "2020-09-16T13:43:07Z", "type": "forcePushed"}, {"oid": "e9c1030876e21503a27ab4f7aa151201c15f5ddf", "url": "https://github.com/uyuni-project/uyuni/commit/e9c1030876e21503a27ab4f7aa151201c15f5ddf", "message": "Follow a more dynamical approach in the navigation\n\nThis way can be extended if we add otehr kind of images in the future.", "committedDate": "2020-09-17T09:08:13Z", "type": "forcePushed"}, {"oid": "a505462fe7e800e145fc2e9b75f85755f0a6bf2d", "url": "https://github.com/uyuni-project/uyuni/commit/a505462fe7e800e145fc2e9b75f85755f0a6bf2d", "message": "Follow a more dynamical approach in the navigation\n\nThis way can be extended if we add otehr kind of images in the future.", "committedDate": "2020-09-17T10:25:25Z", "type": "forcePushed"}, {"oid": "88d3bde2b51b28effb54183af72e6fe6fa680318", "url": "https://github.com/uyuni-project/uyuni/commit/88d3bde2b51b28effb54183af72e6fe6fa680318", "message": "Follow a more dynamical approach in the navigation\n\nThis way can be extended if we add otehr kind of images in the future.", "committedDate": "2020-09-17T10:30:19Z", "type": "forcePushed"}, {"oid": "c23195b9ff2f4da5d84fa3a81d73c41e5bd2ec58", "url": "https://github.com/uyuni-project/uyuni/commit/c23195b9ff2f4da5d84fa3a81d73c41e5bd2ec58", "message": "Testsuite: Hide internal details from Cucumber\n\nConsistently, use step \"I am on the System Overview page\" when appropriate.\nPrefer step \"I follow the left menu ...\" over step \"I navigate to ...\"\n\n- testsuite/features/step_definitions/common_steps.rb\nAdd steps 'I wait until the image build is completed'\nand 'I am on the image page of \"([^\"]*)\"$/'\nMove stuff for os image build here.\n\n- testsuite/features/secondary/buildhost_osimage_build_image.feature:\nUse the new steps.\n\nCo-authored-by: Oscar Barrios <obarrios@suse.com>", "committedDate": "2020-09-17T11:31:23Z", "type": "forcePushed"}, {"oid": "793b2206c72f506316665c8b8a07cf009dbcd2c6", "url": "https://github.com/uyuni-project/uyuni/commit/793b2206c72f506316665c8b8a07cf009dbcd2c6", "message": "Testsuite: Hide internal details from Cucumber\n\nConsistently, use step \"I am on the System Overview page\" when appropriate.\nPrefer step \"I follow the left menu ...\" over step \"I navigate to ...\"\n\n- testsuite/features/step_definitions/common_steps.rb\nAdd steps 'I wait until the image build is completed'\nand 'I am on the image page of \"([^\"]*)\"$/'\nMove stuff for os image build here.\n\n- testsuite/features/secondary/buildhost_osimage_build_image.feature:\nUse the new steps.\n\nCo-authored-by: Oscar Barrios <obarrios@suse.com>", "committedDate": "2020-09-18T10:34:19Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTY1NjU1OQ==", "url": "https://github.com/uyuni-project/uyuni/pull/2603#discussion_r491656559", "bodyText": "Hmm let's ask the others what they think about this strategy of NotImplementedException a la Java code.\n@Bischoff @lkotek @ktsamis", "author": "srbarrios", "createdAt": "2020-09-20T05:55:34Z", "path": "testsuite/features/support/commonlib.rb", "diffHunk": "@@ -63,6 +63,11 @@ def compute_image_name\n   end\n end\n \n+def compute_image_url(image_name)\n+  raise \"Unknown image #{image_name}\" unless image_name == 'suse_os_image'", "originalCommit": "793b2206c72f506316665c8b8a07cf009dbcd2c6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTY1NjgyMg==", "url": "https://github.com/uyuni-project/uyuni/pull/2603#discussion_r491656822", "bodyText": "I wonder if using navigation steps (finds and clicks) there is a way to end at the same web page for any image name. I'm not a supporter of the use of URI paths to jump to a page directly.", "author": "srbarrios", "createdAt": "2020-09-20T05:59:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTY1NjU1OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjAxMjY0Mg==", "url": "https://github.com/uyuni-project/uyuni/pull/2603#discussion_r492012642", "bodyText": "To me, passing a parameter that can take only one authorized value does not make much sense. Is it a case of YAGNI?", "author": "Bischoff", "createdAt": "2020-09-21T12:42:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTY1NjU1OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzI0NDI3OA==", "url": "https://github.com/uyuni-project/uyuni/pull/2603#discussion_r493244278", "bodyText": "Since the ports were already merged, I will do the same with uyuni.\nFeel free to open a card to request a refactor if you wish.", "author": "calancha", "createdAt": "2020-09-23T07:05:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTY1NjU1OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzYzMDUxMA==", "url": "https://github.com/uyuni-project/uyuni/pull/2603#discussion_r493630510", "bodyText": "Yes, we need a refactor of that. Otherwise the whole refactor is limited to the use of ''suse_os_image' and became useless, fmpov.", "author": "srbarrios", "createdAt": "2020-09-23T14:17:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTY1NjU1OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzYzMTc5Nw==", "url": "https://github.com/uyuni-project/uyuni/pull/2603#discussion_r493631797", "bodyText": "SUSE/spacewalk#12540", "author": "srbarrios", "createdAt": "2020-09-23T14:19:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTY1NjU1OQ=="}], "type": "inlineReview"}, {"oid": "787f69c4e42624bc9d075527d13ddb32c0b6728d", "url": "https://github.com/uyuni-project/uyuni/commit/787f69c4e42624bc9d075527d13ddb32c0b6728d", "message": "Testsuite: Hide internal details from Cucumber\n\nConsistently, use step \"I am on the System Overview page\" when appropriate.\nPrefer step \"I follow the left menu ...\" over step \"I navigate to ...\"\n\n- testsuite/features/step_definitions/common_steps.rb\nAdd steps 'I wait until the image build is completed'\nand 'I am on the image page of \"([^\"]*)\"$/'\nMove stuff for os image build here.\n\n- testsuite/features/secondary/buildhost_osimage_build_image.feature:\nUse the new steps.\n\nCo-authored-by: Oscar Barrios <obarrios@suse.com>", "committedDate": "2020-09-20T08:55:39Z", "type": "forcePushed"}, {"oid": "b18a9cc6d80ce35f17ebe940fbe675dd1de81bcf", "url": "https://github.com/uyuni-project/uyuni/commit/b18a9cc6d80ce35f17ebe940fbe675dd1de81bcf", "message": "Testsuite: Hide internal details from Cucumber\n\nConsistently, use step \"I am on the System Overview page\" when appropriate.\nPrefer step \"I follow the left menu ...\" over step \"I navigate to ...\"\n\n- testsuite/features/step_definitions/common_steps.rb\nAdd steps 'I wait until the image build is completed'\nand 'I am on the image page of \"([^\"]*)\"$/'\nMove stuff for os image build here.\n\n- testsuite/features/secondary/buildhost_osimage_build_image.feature:\nUse the new steps.\n\nCo-authored-by: Oscar Barrios <obarrios@suse.com>", "committedDate": "2020-09-21T07:00:28Z", "type": "commit"}, {"oid": "b18a9cc6d80ce35f17ebe940fbe675dd1de81bcf", "url": "https://github.com/uyuni-project/uyuni/commit/b18a9cc6d80ce35f17ebe940fbe675dd1de81bcf", "message": "Testsuite: Hide internal details from Cucumber\n\nConsistently, use step \"I am on the System Overview page\" when appropriate.\nPrefer step \"I follow the left menu ...\" over step \"I navigate to ...\"\n\n- testsuite/features/step_definitions/common_steps.rb\nAdd steps 'I wait until the image build is completed'\nand 'I am on the image page of \"([^\"]*)\"$/'\nMove stuff for os image build here.\n\n- testsuite/features/secondary/buildhost_osimage_build_image.feature:\nUse the new steps.\n\nCo-authored-by: Oscar Barrios <obarrios@suse.com>", "committedDate": "2020-09-21T07:00:28Z", "type": "forcePushed"}]}