{"pr_number": 761, "pr_title": "fix: grpc-alts is used not only in tests", "pr_createdAt": "2020-12-21T05:20:08Z", "pr_url": "https://github.com/googleapis/java-spanner/pull/761", "timeline": [{"oid": "ab037367bbea16422f6ad5d4ac783a17ebf14038", "url": "https://github.com/googleapis/java-spanner/commit/ab037367bbea16422f6ad5d4ac783a17ebf14038", "message": "fix: grpc-alts is used not only in tests\n\nThis reverts commit c8ef46f2637b58cc71d023764cdc11a7414d855f.", "committedDate": "2020-12-21T05:15:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjU0NTczMA==", "url": "https://github.com/googleapis/java-spanner/pull/761#discussion_r546545730", "bodyText": "grpc-alts is already a compile time dependency as it is a transitive dependency of gax-grpc. This degrades it to a runtime dependency. Is there a reason that we need to downgrade it here, and that we can't just let it be a compile time dependency?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  <scope>runtime</scope>\n          \n      \n    \n    \n  \n\nThis is the dependency tree completely without the grpc-alts dependency declaration:\n[INFO] Scanning for projects...\n[INFO] Inspecting build with total of 1 modules...\n[INFO] Installing Nexus Staging features:\n[INFO]   ... total of 1 executions of maven-deploy-plugin replaced with nexus-staging-maven-plugin\n[INFO] \n[INFO] ---------------< com.google.cloud:google-cloud-spanner >----------------\n[INFO] Building Google Cloud Spanner 3.1.4-SNAPSHOT\n[INFO] --------------------------------[ jar ]---------------------------------\n[INFO] \n[INFO] --- maven-dependency-plugin:3.1.2:tree (default-cli) @ google-cloud-spanner ---\n[INFO] com.google.cloud:google-cloud-spanner:jar:3.1.4-SNAPSHOT\n[INFO] +- io.grpc:grpc-api:jar:1.34.1:compile\n[INFO] |  +- com.google.errorprone:error_prone_annotations:jar:2.4.0:compile\n[INFO] |  \\- org.codehaus.mojo:animal-sniffer-annotations:jar:1.19:runtime\n[INFO] +- io.grpc:grpc-auth:jar:1.34.1:compile\n[INFO] +- io.grpc:grpc-context:jar:1.34.1:compile\n[INFO] +- io.grpc:grpc-core:jar:1.34.1:compile\n[INFO] |  +- com.google.android:annotations:jar:4.1.1.4:runtime\n[INFO] |  \\- io.perfmark:perfmark-api:jar:0.19.0:runtime\n[INFO] +- io.grpc:grpc-netty-shaded:jar:1.34.1:compile\n[INFO] +- io.grpc:grpc-protobuf:jar:1.34.1:compile\n[INFO] |  \\- io.grpc:grpc-protobuf-lite:jar:1.34.1:compile\n[INFO] +- io.grpc:grpc-stub:jar:1.34.1:compile\n[INFO] +- com.google.api:api-common:jar:1.10.1:compile\n[INFO] |  \\- com.google.auto.value:auto-value-annotations:jar:1.7.4:compile\n[INFO] +- com.google.protobuf:protobuf-java:jar:3.14.0:compile\n[INFO] +- com.google.protobuf:protobuf-java-util:jar:3.14.0:compile\n[INFO] +- com.google.api.grpc:proto-google-common-protos:jar:2.0.1:compile\n[INFO] +- com.google.api.grpc:grpc-google-common-protos:jar:2.0.1:compile\n[INFO] |  +- com.google.guava:failureaccess:jar:1.0.1:compile\n[INFO] |  +- com.google.guava:listenablefuture:jar:9999.0-empty-to-avoid-conflict-with-guava:compile\n[INFO] |  +- org.checkerframework:checker-compat-qual:jar:2.5.5:compile\n[INFO] |  \\- com.google.j2objc:j2objc-annotations:jar:1.3:compile\n[INFO] +- com.google.api.grpc:proto-google-iam-v1:jar:1.0.5:compile\n[INFO] +- com.google.cloud:google-cloud-core:jar:1.94.0:compile\n[INFO] |  \\- com.google.http-client:google-http-client-jackson2:jar:1.38.0:compile\n[INFO] |     \\- com.fasterxml.jackson.core:jackson-core:jar:2.12.0:compile\n[INFO] +- com.google.cloud:google-cloud-core-grpc:jar:1.94.0:compile\n[INFO] +- io.opencensus:opencensus-api:jar:0.24.0:compile\n[INFO] +- io.opencensus:opencensus-contrib-grpc-util:jar:0.24.0:compile\n[INFO] +- com.google.auth:google-auth-library-oauth2-http:jar:0.22.2:compile\n[INFO] +- com.google.http-client:google-http-client:jar:1.38.0:compile\n[INFO] |  +- org.apache.httpcomponents:httpclient:jar:4.5.13:compile\n[INFO] |  |  +- commons-logging:commons-logging:jar:1.2:compile\n[INFO] |  |  \\- commons-codec:commons-codec:jar:1.11:compile\n[INFO] |  +- org.apache.httpcomponents:httpcore:jar:4.4.13:compile\n[INFO] |  \\- io.opencensus:opencensus-contrib-http-util:jar:0.24.0:compile\n[INFO] +- com.google.api.grpc:proto-google-cloud-spanner-admin-instance-v1:jar:3.1.4-SNAPSHOT:compile\n[INFO] +- com.google.api.grpc:proto-google-cloud-spanner-v1:jar:3.1.4-SNAPSHOT:compile\n[INFO] +- com.google.api.grpc:proto-google-cloud-spanner-admin-database-v1:jar:3.1.4-SNAPSHOT:compile\n[INFO] +- com.google.api.grpc:grpc-google-cloud-spanner-admin-instance-v1:jar:3.1.4-SNAPSHOT:compile\n[INFO] +- com.google.api.grpc:grpc-google-cloud-spanner-v1:jar:3.1.4-SNAPSHOT:compile\n[INFO] +- com.google.api.grpc:grpc-google-cloud-spanner-admin-database-v1:jar:3.1.4-SNAPSHOT:compile\n[INFO] +- com.google.guava:guava:jar:30.1-android:compile\n[INFO] +- com.google.api:gax:jar:1.60.1:compile\n[INFO] +- com.google.api:gax-grpc:jar:1.60.1:compile\n[INFO] |  \\- io.grpc:grpc-alts:jar:1.34.1:compile\n[INFO] |     +- io.grpc:grpc-grpclb:jar:1.34.1:compile\n[INFO] |     +- org.apache.commons:commons-lang3:jar:3.5:compile\n[INFO] |     \\- org.conscrypt:conscrypt-openjdk-uber:jar:2.5.1:compile\n[INFO] +- org.threeten:threetenbp:jar:1.5.0:compile\n[INFO] +- com.google.code.findbugs:jsr305:jar:3.0.2:compile\n[INFO] +- com.google.code.gson:gson:jar:2.8.6:compile\n[INFO] +- com.google.auth:google-auth-library-credentials:jar:0.22.2:compile\n[INFO] +- junit:junit:jar:4.13.1:test\n[INFO] |  \\- org.hamcrest:hamcrest-core:jar:1.3:test\n[INFO] +- com.google.api:gax-grpc:jar:testlib:1.60.1:test\n[INFO] +- com.google.truth:truth:jar:1.1:test\n[INFO] |  +- org.checkerframework:checker-qual:jar:3.7.0:test\n[INFO] |  \\- org.ow2.asm:asm:jar:9.0:test\n[INFO] +- org.mockito:mockito-all:jar:1.10.19:test\n[INFO] +- org.json:json:jar:20201115:test\n[INFO] +- com.google.guava:guava-testlib:jar:30.1-android:test\n[INFO] +- org.hamcrest:hamcrest:jar:2.2:test\n[INFO] +- org.openjdk.jmh:jmh-core:jar:1.27:test\n[INFO] |  +- net.sf.jopt-simple:jopt-simple:jar:4.6:test\n[INFO] |  \\- org.apache.commons:commons-math3:jar:3.2:test\n[INFO] +- org.openjdk.jmh:jmh-generator-annprocess:jar:1.27:test\n[INFO] \\- javax.annotation:javax.annotation-api:jar:1.3.2:compile\n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD SUCCESS\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time: 2.470 s\n[INFO] Finished at: 2020-12-21T08:17:23+01:00\n[INFO] ------------------------------------------------------------------------", "author": "olavloite", "createdAt": "2020-12-21T07:20:52Z", "path": "google-cloud-spanner/pom.xml", "diffHunk": "@@ -142,6 +142,16 @@\n       <groupId>io.grpc</groupId>\n       <artifactId>grpc-protobuf</artifactId>\n     </dependency>\n+    <dependency>\n+      <groupId>io.grpc</groupId>\n+      <artifactId>grpc-alts</artifactId>\n+      <scope>runtime</scope>", "originalCommit": "ab037367bbea16422f6ad5d4ac783a17ebf14038", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e3d816ffabde7a01fb495498ae500497765bbeff", "url": "https://github.com/googleapis/java-spanner/commit/e3d816ffabde7a01fb495498ae500497765bbeff", "message": "fix: adds grpc-alts as compile time dependency", "committedDate": "2020-12-22T22:59:41Z", "type": "commit"}, {"oid": "874ec0ccb26fc8ed76dc1db9474c2a0f644be061", "url": "https://github.com/googleapis/java-spanner/commit/874ec0ccb26fc8ed76dc1db9474c2a0f644be061", "message": "fix: removes duplicate dependency\n\nRemoves duplicate grpc-alts dependency", "committedDate": "2021-01-04T23:05:26Z", "type": "commit"}]}