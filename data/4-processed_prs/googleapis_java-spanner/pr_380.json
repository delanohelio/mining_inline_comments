{"pr_number": 380, "pr_title": "fix: enables emulator tests", "pr_createdAt": "2020-08-12T06:01:14Z", "pr_url": "https://github.com/googleapis/java-spanner/pull/380", "timeline": [{"oid": "e6e4424cfb2140e9191842e3653161a81668f85d", "url": "https://github.com/googleapis/java-spanner/commit/e6e4424cfb2140e9191842e3653161a81668f85d", "message": "fix: enables emulator tests\n\nEnables emulator for integration tests that were previously being\nskipped. The emulator now provides the features for theses tests to run\nwith it.", "committedDate": "2020-08-12T06:06:14Z", "type": "commit"}, {"oid": "e6e4424cfb2140e9191842e3653161a81668f85d", "url": "https://github.com/googleapis/java-spanner/commit/e6e4424cfb2140e9191842e3653161a81668f85d", "message": "fix: enables emulator tests\n\nEnables emulator for integration tests that were previously being\nskipped. The emulator now provides the features for theses tests to run\nwith it.", "committedDate": "2020-08-12T06:06:14Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTAyMzQ2Mw==", "url": "https://github.com/googleapis/java-spanner/pull/380#discussion_r469023463", "bodyText": "This needed to be updated so that the tests run properly with the emulator. This enables a new spanner instance to be created when running with the emulator.", "author": "thiagotnunes", "createdAt": "2020-08-12T06:02:54Z", "path": "google-cloud-spanner/src/test/java/com/google/cloud/spanner/IntegrationTestEnv.java", "diffHunk": "@@ -79,7 +80,7 @@ protected void before() throws Throwable {\n     SpannerOptions options = config.spannerOptions();\n     String instanceProperty = System.getProperty(TEST_INSTANCE_PROPERTY, \"\");\n     InstanceId instanceId;\n-    if (!instanceProperty.isEmpty()) {\n+    if (!instanceProperty.isEmpty() && !isUsingEmulator()) {", "originalCommit": "ff377ce6c5aef90307bc6704745e30d136c166c5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTAyMzU4NA==", "url": "https://github.com/googleapis/java-spanner/pull/380#discussion_r469023584", "bodyText": "Enables this test to use the emulator.", "author": "thiagotnunes", "createdAt": "2020-08-12T06:03:21Z", "path": "google-cloud-spanner/src/test/java/com/google/cloud/spanner/it/ITAsyncAPITest.java", "diffHunk": "@@ -279,9 +278,6 @@ public void columnNotFound() throws Exception {\n \n   @Test\n   public void asyncRunnerFireAndForgetInvalidUpdate() throws Exception {\n-    assumeFalse(", "originalCommit": "ff377ce6c5aef90307bc6704745e30d136c166c5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTAyMzYzMg==", "url": "https://github.com/googleapis/java-spanner/pull/380#discussion_r469023632", "bodyText": "Enables this test to use the emulator.", "author": "thiagotnunes", "createdAt": "2020-08-12T06:03:28Z", "path": "google-cloud-spanner/src/test/java/com/google/cloud/spanner/it/ITClosedSessionTest.java", "diffHunk": "@@ -61,10 +60,6 @@\n \n   @BeforeClass\n   public static void setUpDatabase() {\n-    // TODO: Enable when the emulator returns ResourceInfo for Session not found errors.", "originalCommit": "ff377ce6c5aef90307bc6704745e30d136c166c5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTAyMzgzOQ==", "url": "https://github.com/googleapis/java-spanner/pull/380#discussion_r469023839", "bodyText": "Enables this test to use the emulator.", "author": "thiagotnunes", "createdAt": "2020-08-12T06:04:08Z", "path": "google-cloud-spanner/src/test/java/com/google/cloud/spanner/it/ITCommitTimestampTest.java", "diffHunk": "@@ -336,8 +336,6 @@ public void interleavedTableHierarchy1() {\n   // allowed if child tables are not allow_commmit_timestamp=true\n   @Test\n   public void interleavedTableHierarchy2() {\n-    // TODO: Remove the following line once the emulator is as strict as Cloud Spanner.", "originalCommit": "ff377ce6c5aef90307bc6704745e30d136c166c5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTAyNDk4MA==", "url": "https://github.com/googleapis/java-spanner/pull/380#discussion_r469024980", "bodyText": "Enables this test to use the emulator.", "author": "thiagotnunes", "createdAt": "2020-08-12T06:07:11Z", "path": "google-cloud-spanner/src/test/java/com/google/cloud/spanner/it/ITCommitTimestampTest.java", "diffHunk": "@@ -325,19 +324,14 @@ public void interleavedTableHierarchy1() {\n                   .build()));\n       fail(\"missing expected exception\");\n     } catch (SpannerException e) {\n-      // TODO: Remove when the emulator returns the same error code as Cloud Spanner.\n-      if (!env.getTestHelper().isEmulator()) {", "originalCommit": "e6e4424cfb2140e9191842e3653161a81668f85d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "49921046645696f44a7c13b20866ea7d74157608", "url": "https://github.com/googleapis/java-spanner/commit/49921046645696f44a7c13b20866ea7d74157608", "message": "fix: formatting\n\nFixes formatting of code", "committedDate": "2020-08-12T06:14:35Z", "type": "commit"}, {"oid": "75197c65e64c33a8b1361755aa88170b7ead3e5d", "url": "https://github.com/googleapis/java-spanner/commit/75197c65e64c33a8b1361755aa88170b7ead3e5d", "message": "fix: deprecates method for emulator check\n\nDeprecates method to check for the emulator and uses the new\nSpannerEmulatorHelper class.", "committedDate": "2020-08-12T06:21:34Z", "type": "commit"}, {"oid": "11dc86f2f3c472dcccd2da00e7bb19b453be0069", "url": "https://github.com/googleapis/java-spanner/commit/11dc86f2f3c472dcccd2da00e7bb19b453be0069", "message": "refactor: renames class\n\nRenames helper class", "committedDate": "2020-08-12T06:27:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTAzNjM4Ng==", "url": "https://github.com/googleapis/java-spanner/pull/380#discussion_r469036386", "bodyText": "Refactors: deprecate this method and use the newly created method.", "author": "thiagotnunes", "createdAt": "2020-08-12T06:38:04Z", "path": "google-cloud-spanner/src/main/java/com/google/cloud/spanner/testing/RemoteSpannerHelper.java", "diffHunk": "@@ -58,8 +57,15 @@ public SpannerOptions getOptions() {\n     return options;\n   }\n \n+  /**\n+   * Checks whether the emulator is being used.\n+   *\n+   * @deprecated use {@link EmulatorSpannerHelper#isUsingEmulator()} instead.\n+   * @return true if the emulator is being used. Returns false otherwise.\n+   */\n+  @Deprecated", "originalCommit": "11dc86f2f3c472dcccd2da00e7bb19b453be0069", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}