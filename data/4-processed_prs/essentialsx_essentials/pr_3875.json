{"pr_number": 3875, "pr_title": "Add WarpModifyEvent", "pr_createdAt": "2020-12-27T01:50:03Z", "pr_url": "https://github.com/EssentialsX/Essentials/pull/3875", "timeline": [{"oid": "a891e5f5f8433a8d09f84173f40574015ed3997e", "url": "https://github.com/EssentialsX/Essentials/commit/a891e5f5f8433a8d09f84173f40574015ed3997e", "message": "Add WarpModifyEvent event", "committedDate": "2020-12-26T22:00:08Z", "type": "commit"}, {"oid": "6ffec5783e0ae1b67f039cd5eff8a5a5ea183e04", "url": "https://github.com/EssentialsX/Essentials/commit/6ffec5783e0ae1b67f039cd5eff8a5a5ea183e04", "message": "Make the event not trigger if the warp does not exist.", "committedDate": "2020-12-26T22:09:46Z", "type": "commit"}, {"oid": "4d2570a918290e7a7502c7374aed7f7813eab4e6", "url": "https://github.com/EssentialsX/Essentials/commit/4d2570a918290e7a7502c7374aed7f7813eab4e6", "message": "Add javadoc and fix check violations", "committedDate": "2020-12-27T15:38:43Z", "type": "commit"}, {"oid": "eea00e41b06a6d5dc5236d45378e2d960c1d72cc", "url": "https://github.com/EssentialsX/Essentials/commit/eea00e41b06a6d5dc5236d45378e2d960c1d72cc", "message": "Check if cancelled after the event is called...", "committedDate": "2021-01-01T23:11:10Z", "type": "commit"}, {"oid": "60b51c4efc4fb89ca68393b5c27b3d2339b89d83", "url": "https://github.com/EssentialsX/Essentials/commit/60b51c4efc4fb89ca68393b5c27b3d2339b89d83", "message": "Moved event to V2 and made WarpModifyCause an inner class", "committedDate": "2021-01-01T23:16:43Z", "type": "commit"}, {"oid": "3a02229894532c606b4a95d74eb2eac754ade35f", "url": "https://github.com/EssentialsX/Essentials/commit/3a02229894532c606b4a95d74eb2eac754ade35f", "message": "Added new and old location parameters", "committedDate": "2021-01-02T00:11:14Z", "type": "commit"}, {"oid": "c9405936e4c15b2ec71cebe0091551fbdab47a88", "url": "https://github.com/EssentialsX/Essentials/commit/c9405936e4c15b2ec71cebe0091551fbdab47a88", "message": "Merge branch '2.x' into warpevent", "committedDate": "2021-01-02T00:30:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDgyNDQxMg==", "url": "https://github.com/EssentialsX/Essentials/pull/3875#discussion_r550824412", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    Location location = ess.getWarps().getWarp(args[0]);\n          \n          \n            \n                    final Location location = ess.getWarps().getWarp(args[0]);", "author": "JRoy", "createdAt": "2021-01-02T00:30:24Z", "path": "Essentials/src/main/java/com/earth2me/essentials/commands/Commanddelwarp.java", "diffHunk": "@@ -19,9 +22,18 @@ public void run(final Server server, final CommandSource sender, final String co\n         if (args.length == 0) {\n             throw new NotEnoughArgumentsException();\n         }\n-\n-        ess.getWarps().removeWarp(args[0]);\n-        sender.sendMessage(tl(\"deleteWarp\", args[0]));\n+        //Check if warp exists before calling the event\n+        Location location = ess.getWarps().getWarp(args[0]);", "originalCommit": "c9405936e4c15b2ec71cebe0091551fbdab47a88", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDgyNDQ0MQ==", "url": "https://github.com/EssentialsX/Essentials/pull/3875#discussion_r550824441", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        if (event.isCancelled()) {\n          \n          \n            \n                            return;\n          \n          \n            \n                        }\n          \n          \n            \n                        Bukkit.getServer().getPluginManager().callEvent(event);\n          \n          \n            \n                        Bukkit.getServer().getPluginManager().callEvent(event);\n          \n          \n            \n                        if (event.isCancelled()) {\n          \n          \n            \n                            return;\n          \n          \n            \n                        }", "author": "JRoy", "createdAt": "2021-01-02T00:30:44Z", "path": "Essentials/src/main/java/com/earth2me/essentials/commands/Commanddelwarp.java", "diffHunk": "@@ -19,9 +22,18 @@ public void run(final Server server, final CommandSource sender, final String co\n         if (args.length == 0) {\n             throw new NotEnoughArgumentsException();\n         }\n-\n-        ess.getWarps().removeWarp(args[0]);\n-        sender.sendMessage(tl(\"deleteWarp\", args[0]));\n+        //Check if warp exists before calling the event\n+        Location location = ess.getWarps().getWarp(args[0]);\n+        if (location != null) {\n+            final WarpModifyEvent event = new WarpModifyEvent(sender.getUser(this.ess), args[0], location, null, WarpModifyEvent.WarpModifyCause.DELETE);\n+            if (event.isCancelled()) {\n+                return;\n+            }\n+            Bukkit.getServer().getPluginManager().callEvent(event);", "originalCommit": "c9405936e4c15b2ec71cebe0091551fbdab47a88", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDgyNDQ4Mw==", "url": "https://github.com/EssentialsX/Essentials/pull/3875#discussion_r550824483", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        if (event.isCancelled()) {\n          \n          \n            \n                            return;\n          \n          \n            \n                        }\n          \n          \n            \n                        Bukkit.getServer().getPluginManager().callEvent(event);\n          \n          \n            \n                        Bukkit.getServer().getPluginManager().callEvent(event);\n          \n          \n            \n                        if (event.isCancelled()) {\n          \n          \n            \n                            return;\n          \n          \n            \n                        }", "author": "JRoy", "createdAt": "2021-01-02T00:31:28Z", "path": "Essentials/src/main/java/com/earth2me/essentials/commands/Commandsetwarp.java", "diffHunk": "@@ -32,8 +34,19 @@ public void run(final Server server, final User user, final String commandLabel,\n             warpLoc = warps.getWarp(args[0]);\n         } catch (final WarpNotFoundException | InvalidWorldException ignored) {\n         }\n-\n-        if (warpLoc == null || user.isAuthorized(\"essentials.warp.overwrite.\" + StringUtil.safeString(args[0]))) {\n+        if (warpLoc == null) {\n+            final WarpModifyEvent event = new WarpModifyEvent(user, args[0], null, user.getLocation(), WarpModifyEvent.WarpModifyCause.CREATE);\n+            if (event.isCancelled()) {\n+                return;\n+            }\n+            Bukkit.getServer().getPluginManager().callEvent(event);", "originalCommit": "c9405936e4c15b2ec71cebe0091551fbdab47a88", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDgyNDU1Nw==", "url": "https://github.com/EssentialsX/Essentials/pull/3875#discussion_r550824557", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \n          \n          \n            \n                private static final HandlerList handlers = new HandlerList();\n          \n          \n            \n                private static final HandlerList handlers = new HandlerList();", "author": "JRoy", "createdAt": "2021-01-02T00:32:32Z", "path": "Essentials/src/main/java/net/essentialsx/api/v2/events/WarpModifyEvent.java", "diffHunk": "@@ -0,0 +1,84 @@\n+package net.essentialsx.api.v2.events;\n+\n+import net.ess3.api.IUser;\n+import org.bukkit.Location;\n+import org.bukkit.event.Cancellable;\n+import org.bukkit.event.Event;\n+import org.bukkit.event.HandlerList;\n+\n+/**\n+ * Called when a warp is about to be modified.\n+ * Includes creation and deletion as described in {@link WarpModifyCause}.\n+ */\n+public class WarpModifyEvent extends Event implements Cancellable {\n+\n+    private static final HandlerList handlers = new HandlerList();", "originalCommit": "c9405936e4c15b2ec71cebe0091551fbdab47a88", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDgyNTUwNA==", "url": "https://github.com/EssentialsX/Essentials/pull/3875#discussion_r550825504", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \n          \n          \n            \n                public HandlerList getHandlers() {\n          \n          \n            \n                    return handlers;\n          \n          \n            \n                }\n          \n          \n            \n            \n          \n          \n            \n                public static HandlerList getHandlerList() {\n          \n          \n            \n                    return handlers;\n          \n          \n            \n                }", "author": "JRoy", "createdAt": "2021-01-02T00:45:28Z", "path": "Essentials/src/main/java/net/essentialsx/api/v2/events/WarpModifyEvent.java", "diffHunk": "@@ -0,0 +1,84 @@\n+package net.essentialsx.api.v2.events;\n+\n+import net.ess3.api.IUser;\n+import org.bukkit.Location;\n+import org.bukkit.event.Cancellable;\n+import org.bukkit.event.Event;\n+import org.bukkit.event.HandlerList;\n+\n+/**\n+ * Called when a warp is about to be modified.\n+ * Includes creation and deletion as described in {@link WarpModifyCause}.\n+ */\n+public class WarpModifyEvent extends Event implements Cancellable {\n+\n+    private static final HandlerList handlers = new HandlerList();\n+    private final IUser issuer;\n+    private final String warpName;\n+    private final Location oldLocation;\n+    private final Location newLocation;\n+    private final WarpModifyCause cause;\n+    private boolean cancelled;\n+\n+\n+    /**\n+     * @param issuer      the {@link IUser} issuing the command\n+     * @param warpName    the name of the warp that's being altered\n+     * @param oldLocation the old location before being modified. Null if {@link WarpModifyCause#CREATE}.\n+     * @param newLocation the new location after being modified. Null if {@link WarpModifyCause#DELETE}.\n+     * @param cause       the cause of change.\n+     */\n+    public WarpModifyEvent(IUser issuer, String warpName, Location oldLocation, Location newLocation, WarpModifyCause cause) {\n+        this.issuer = issuer;\n+        this.warpName = warpName;\n+        this.oldLocation = oldLocation;\n+        this.newLocation = newLocation;\n+        this.cause = cause;\n+    }\n+\n+    public HandlerList getHandlers() {\n+        return handlers;\n+    }\n+\n+    public static HandlerList getHandlerList() {\n+        return handlers;\n+    }", "originalCommit": "c9405936e4c15b2ec71cebe0091551fbdab47a88", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDgyNTU0MQ==", "url": "https://github.com/EssentialsX/Essentials/pull/3875#discussion_r550825541", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                }\n          \n          \n            \n                }\n          \n          \n            \n                \n          \n          \n            \n                public HandlerList getHandlers() {\n          \n          \n            \n                    return handlers;\n          \n          \n            \n                }\n          \n          \n            \n            \n          \n          \n            \n                public static HandlerList getHandlerList() {\n          \n          \n            \n                    return handlers;\n          \n          \n            \n                }", "author": "JRoy", "createdAt": "2021-01-02T00:46:01Z", "path": "Essentials/src/main/java/net/essentialsx/api/v2/events/WarpModifyEvent.java", "diffHunk": "@@ -0,0 +1,84 @@\n+package net.essentialsx.api.v2.events;\n+\n+import net.ess3.api.IUser;\n+import org.bukkit.Location;\n+import org.bukkit.event.Cancellable;\n+import org.bukkit.event.Event;\n+import org.bukkit.event.HandlerList;\n+\n+/**\n+ * Called when a warp is about to be modified.\n+ * Includes creation and deletion as described in {@link WarpModifyCause}.\n+ */\n+public class WarpModifyEvent extends Event implements Cancellable {\n+\n+    private static final HandlerList handlers = new HandlerList();\n+    private final IUser issuer;\n+    private final String warpName;\n+    private final Location oldLocation;\n+    private final Location newLocation;\n+    private final WarpModifyCause cause;\n+    private boolean cancelled;\n+\n+\n+    /**\n+     * @param issuer      the {@link IUser} issuing the command\n+     * @param warpName    the name of the warp that's being altered\n+     * @param oldLocation the old location before being modified. Null if {@link WarpModifyCause#CREATE}.\n+     * @param newLocation the new location after being modified. Null if {@link WarpModifyCause#DELETE}.\n+     * @param cause       the cause of change.\n+     */\n+    public WarpModifyEvent(IUser issuer, String warpName, Location oldLocation, Location newLocation, WarpModifyCause cause) {\n+        this.issuer = issuer;\n+        this.warpName = warpName;\n+        this.oldLocation = oldLocation;\n+        this.newLocation = newLocation;\n+        this.cause = cause;\n+    }\n+\n+    public HandlerList getHandlers() {\n+        return handlers;\n+    }\n+\n+    public static HandlerList getHandlerList() {\n+        return handlers;\n+    }\n+\n+    @Override\n+    public boolean isCancelled() {\n+        return cancelled;\n+    }\n+\n+    @Override\n+    public void setCancelled(boolean cancel) {\n+        this.cancelled = cancel;\n+    }\n+\n+    public IUser getIssuer() {\n+        return issuer;\n+    }\n+\n+    public WarpModifyCause getCause() {\n+        return cause;\n+    }\n+\n+    public String getWarpName() {\n+        return warpName;\n+    }", "originalCommit": "c9405936e4c15b2ec71cebe0091551fbdab47a88", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "636d0d5f27600ff29119c27e906e3cec980b498f", "url": "https://github.com/EssentialsX/Essentials/commit/636d0d5f27600ff29119c27e906e3cec980b498f", "message": "Apply suggestions from code review", "committedDate": "2021-01-02T02:35:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDgzNDAxNA==", "url": "https://github.com/EssentialsX/Essentials/pull/3875#discussion_r550834014", "bodyText": "Suggested change", "author": "JRoy", "createdAt": "2021-01-02T02:38:30Z", "path": "Essentials/src/main/java/net/essentialsx/api/v2/events/WarpModifyEvent.java", "diffHunk": "@@ -0,0 +1,83 @@\n+package net.essentialsx.api.v2.events;\n+\n+import net.ess3.api.IUser;\n+import org.bukkit.Location;\n+import org.bukkit.event.Cancellable;\n+import org.bukkit.event.Event;\n+import org.bukkit.event.HandlerList;\n+\n+/**\n+ * Called when a warp is about to be modified.\n+ * Includes creation and deletion as described in {@link WarpModifyCause}.\n+ */\n+public class WarpModifyEvent extends Event implements Cancellable {\n+    private static final HandlerList handlers = new HandlerList();\n+    private final IUser issuer;\n+    private final String warpName;\n+    private final Location oldLocation;\n+    private final Location newLocation;\n+    private final WarpModifyCause cause;\n+    private boolean cancelled;\n+\n+", "originalCommit": "636d0d5f27600ff29119c27e906e3cec980b498f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "4af92668080c6d6730675b538d70afd3375663dc", "url": "https://github.com/EssentialsX/Essentials/commit/4af92668080c6d6730675b538d70afd3375663dc", "message": "Update Essentials/src/main/java/net/essentialsx/api/v2/events/WarpModifyEvent.java", "committedDate": "2021-01-02T02:38:33Z", "type": "commit"}, {"oid": "e18b424b83e8edc5fe41442015fba9ae7d8879ab", "url": "https://github.com/EssentialsX/Essentials/commit/e18b424b83e8edc5fe41442015fba9ae7d8879ab", "message": "Update WarpModifyEvent.java", "committedDate": "2021-01-02T02:44:08Z", "type": "commit"}, {"oid": "b7575089ff46085a07a49c0b6f73f236c5e77094", "url": "https://github.com/EssentialsX/Essentials/commit/b7575089ff46085a07a49c0b6f73f236c5e77094", "message": "Update WarpModifyEvent.java", "committedDate": "2021-01-02T02:46:41Z", "type": "commit"}, {"oid": "eed861788624437f93911c1f0ece5e2d4e35292d", "url": "https://github.com/EssentialsX/Essentials/commit/eed861788624437f93911c1f0ece5e2d4e35292d", "message": "Update WarpModifyEvent.java", "committedDate": "2021-01-02T02:46:58Z", "type": "commit"}, {"oid": "a14ae8625e08bc6cd3e16e23afaf6c7c86dfb4c8", "url": "https://github.com/EssentialsX/Essentials/commit/a14ae8625e08bc6cd3e16e23afaf6c7c86dfb4c8", "message": "Merge branch '2.x' into warpevent", "committedDate": "2021-01-08T20:17:16Z", "type": "commit"}]}