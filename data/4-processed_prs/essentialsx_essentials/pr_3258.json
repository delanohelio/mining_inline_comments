{"pr_number": 3258, "pr_title": "Improve backup functionality", "pr_createdAt": "2020-05-11T07:17:35Z", "pr_url": "https://github.com/EssentialsX/Essentials/pull/3258", "timeline": [{"oid": "ca5ad04ff75db404dc7dea01985977b6082fc536", "url": "https://github.com/EssentialsX/Essentials/commit/ca5ad04ff75db404dc7dea01985977b6082fc536", "message": "Finish backup tasks before disabling plugin", "committedDate": "2020-05-11T07:03:18Z", "type": "commit"}, {"oid": "5d2b822cb2b05ca573b18747659b02977484feae", "url": "https://github.com/EssentialsX/Essentials/commit/5d2b822cb2b05ca573b18747659b02977484feae", "message": "Don't schedule new tasks when we're shutting down", "committedDate": "2020-05-11T07:13:08Z", "type": "commit"}, {"oid": "27dfa7b7b99b1bac04039d867ddd639b5b217f3c", "url": "https://github.com/EssentialsX/Essentials/commit/27dfa7b7b99b1bac04039d867ddd639b5b217f3c", "message": "Add config option to run backup task even when players are offline", "committedDate": "2020-05-11T07:13:39Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjg1NTMwOQ==", "url": "https://github.com/EssentialsX/Essentials/pull/3258#discussion_r422855309", "bodyText": "I see what you're trying to do, but as Aikar pointed out this would probably be done much better with a future. If that's too much work here, I'd at least change this to only sleep for one second at a time, to avoid superfluous waiting. The main thread doesn't have anything better to do at this point anyways.", "author": "pop4959", "createdAt": "2020-05-11T08:01:29Z", "path": "Essentials/src/com/earth2me/essentials/Essentials.java", "diffHunk": "@@ -381,6 +383,13 @@ public void onDisable() {\n         getUserMap().getUUIDMap().shutdown();\n \n         HandlerList.unregisterAll(this);\n+        while (getBackup().isActive()) {\n+            try {\n+                Thread.sleep(10);", "originalCommit": "27dfa7b7b99b1bac04039d867ddd639b5b217f3c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjg2MTM5Mg==", "url": "https://github.com/EssentialsX/Essentials/pull/3258#discussion_r422861392", "bodyText": "I agree this should wait on a future. We should also print a message informing that we're waiting for the backup to finish.", "author": "mdcfe", "createdAt": "2020-05-11T08:12:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjg1NTMwOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjg2MzY0MA==", "url": "https://github.com/EssentialsX/Essentials/pull/3258#discussion_r422863640", "bodyText": "Good point on the info message, that'd definitely be good feedback to give", "author": "pop4959", "createdAt": "2020-05-11T08:16:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjg1NTMwOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjg1NjM1MQ==", "url": "https://github.com/EssentialsX/Essentials/pull/3258#discussion_r422856351", "bodyText": "I suggest changing this from always-run-backup to simply always-run to avoid redundancy since this config option is already a child of backup.", "author": "pop4959", "createdAt": "2020-05-11T08:03:15Z", "path": "Essentials/src/config.yml", "diffHunk": "@@ -371,6 +371,8 @@ unprotected-sign-names:\n backup:\n   # Interval in minutes.\n   interval: 30\n+  # If true, the backup task will run even if there are no players online.\n+  always-run-backup: false", "originalCommit": "27dfa7b7b99b1bac04039d867ddd639b5b217f3c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "adb2e6d51392ba2efd2e8111a8a2465bf5585861", "url": "https://github.com/EssentialsX/Essentials/commit/adb2e6d51392ba2efd2e8111a8a2465bf5585861", "message": "Change config node", "committedDate": "2020-05-11T12:38:23Z", "type": "commit"}, {"oid": "6cc4e3bbef50b6275204ec5e276a22eaca56886f", "url": "https://github.com/EssentialsX/Essentials/commit/6cc4e3bbef50b6275204ec5e276a22eaca56886f", "message": "Use future because sleeping is scary!", "committedDate": "2020-05-11T13:15:45Z", "type": "commit"}, {"oid": "f0c6d1815c36a40843525b554d04f4fd3567883a", "url": "https://github.com/EssentialsX/Essentials/commit/f0c6d1815c36a40843525b554d04f4fd3567883a", "message": "Merge branch '2.x' into bug/stupid-broken-feature", "committedDate": "2020-05-11T14:04:08Z", "type": "commit"}, {"oid": "9247c8b1764dc7f4acf852ef246a92178047fe8d", "url": "https://github.com/EssentialsX/Essentials/commit/9247c8b1764dc7f4acf852ef246a92178047fe8d", "message": "Yell and shame users using the /reload command", "committedDate": "2020-05-11T14:15:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzEzMDg5Mw==", "url": "https://github.com/EssentialsX/Essentials/pull/3258#discussion_r423130893", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            serverReloading=There's a good chance you're probably reloading your server right now. If that's the case, why do you hate yourself? Except no support from the Essentials team when using /reload\n          \n          \n            \n            serverReloading=There's a good chance you're probably reloading your server right now. If that's the case, why do you hate yourself? Expect no support from the EssentialsX team when using /reload.\n          \n      \n    \n    \n  \n\nOthers might have other suggestions on wording.", "author": "mdcfe", "createdAt": "2020-05-11T15:37:53Z", "path": "Essentials/src/messages.properties", "diffHunk": "@@ -484,6 +485,7 @@ seenOnline=\\u00a76Player\\u00a7c {0} \\u00a76has been \\u00a7aonline\\u00a76 since \\\n sellBulkPermission=\\u00a76You do not have permission to bulk sell.\n sellHandPermission=\\u00a76You do not have permission to hand sell.\n serverFull=Server is full\\!\n+serverReloading=There's a good chance you're probably reloading your server right now. If that's the case, why do you hate yourself? Except no support from the Essentials team when using /reload", "originalCommit": "9247c8b1764dc7f4acf852ef246a92178047fe8d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzEzMzc4Mg==", "url": "https://github.com/EssentialsX/Essentials/pull/3258#discussion_r423133782", "bodyText": "https://ptb.discordapp.com/channels/390942438061113344/395279435538104320/709404997560959077", "author": "JRoy", "createdAt": "2020-05-11T15:42:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzEzMDg5Mw=="}], "type": "inlineReview"}, {"oid": "b30dbc20e26343cc499cc0e5a9aa87f0963b0701", "url": "https://github.com/EssentialsX/Essentials/commit/b30dbc20e26343cc499cc0e5a9aa87f0963b0701", "message": "Update Essentials/src/messages.properties\n\nCo-authored-by: md678685 <1917406+md678685@users.noreply.github.com>", "committedDate": "2020-05-11T15:42:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzEzOTU1MA==", "url": "https://github.com/EssentialsX/Essentials/pull/3258#discussion_r423139550", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            serverReloading=There's a good chance you're probably reloading your server right now. If that's the case, why do you hate yourself? Expect no support from the EssentialsX team when using /reload.\n          \n          \n            \n            serverReloading=There's a good chance you're reloading your server right now. If that's the case, why do you hate yourself? Expect no support from the EssentialsX team when using /reload.", "author": "mdcfe", "createdAt": "2020-05-11T15:50:36Z", "path": "Essentials/src/messages.properties", "diffHunk": "@@ -484,6 +485,7 @@ seenOnline=\\u00a76Player\\u00a7c {0} \\u00a76has been \\u00a7aonline\\u00a76 since \\\n sellBulkPermission=\\u00a76You do not have permission to bulk sell.\n sellHandPermission=\\u00a76You do not have permission to hand sell.\n serverFull=Server is full\\!\n+serverReloading=There's a good chance you're probably reloading your server right now. If that's the case, why do you hate yourself? Expect no support from the EssentialsX team when using /reload.", "originalCommit": "b30dbc20e26343cc499cc0e5a9aa87f0963b0701", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "55fdc45422ef9746b45f931c747afe4562fd601b", "url": "https://github.com/EssentialsX/Essentials/commit/55fdc45422ef9746b45f931c747afe4562fd601b", "message": "Update Essentials/src/messages.properties", "committedDate": "2020-05-11T15:50:51Z", "type": "commit"}]}