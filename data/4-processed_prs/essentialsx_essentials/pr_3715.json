{"pr_number": 3715, "pr_title": "Fix /clear <player> <item> not clearing offhand", "pr_createdAt": "2020-10-08T07:48:24Z", "pr_url": "https://github.com/EssentialsX/Essentials/pull/3715", "timeline": [{"oid": "1811f12430e69bc2503f6e7b25e357084f4fe152", "url": "https://github.com/EssentialsX/Essentials/commit/1811f12430e69bc2503f6e7b25e357084f4fe152", "message": "Fixed /clear command in the second hand for additional parameters :p", "committedDate": "2020-10-08T07:27:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUxNzc5Mg==", "url": "https://github.com/EssentialsX/Essentials/pull/3715#discussion_r501517792", "bodyText": "This if will always return true, therefore making no need for it", "author": "l1ttleO", "createdAt": "2020-10-08T07:53:47Z", "path": "Essentials/src/com/earth2me/essentials/craftbukkit/InventoryWorkaround.java", "diffHunk": "@@ -267,4 +263,22 @@ public static void setItemInOffHand(final Player p, final ItemStack item) {\n             }\n         }\n     }\n+\n+    public static int clearItemInOffHand(final Player p, final ItemStack item) {\n+        if (hasMainHandSupport == null || hasMainHandSupport) {", "originalCommit": "1811f12430e69bc2503f6e7b25e357084f4fe152", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUxODYzOA==", "url": "https://github.com/EssentialsX/Essentials/pull/3715#discussion_r501518638", "bodyText": "Don't make changes that aren't associated with your PR", "author": "l1ttleO", "createdAt": "2020-10-08T07:55:11Z", "path": "Essentials/src/com/earth2me/essentials/craftbukkit/InventoryWorkaround.java", "diffHunk": "@@ -12,10 +12,6 @@\n import java.util.HashMap;\n import java.util.Map;\n \n-/*\n- * This class can be removed when https://github.com/Bukkit/CraftBukkit/pull/193 is accepted to CraftBukkit\n- */\n-", "originalCommit": "1811f12430e69bc2503f6e7b25e357084f4fe152", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "fa430f704e850a900cd51baae16f384c758e80c1", "url": "https://github.com/EssentialsX/Essentials/commit/fa430f704e850a900cd51baae16f384c758e80c1", "message": "Fixed the if always returning true. Added back the message in InventoryWorkaround.", "committedDate": "2020-10-08T08:18:49Z", "type": "commit"}, {"oid": "d071ea7081eaf117287b25b5bddb6d07731ea8ea", "url": "https://github.com/EssentialsX/Essentials/commit/d071ea7081eaf117287b25b5bddb6d07731ea8ea", "message": "Forgot to add the return statement. Added it.", "committedDate": "2020-10-08T08:23:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTg2ODg4Ng==", "url": "https://github.com/EssentialsX/Essentials/pull/3715#discussion_r501868886", "bodyText": "This is redundant?", "author": "mdcfe", "createdAt": "2020-10-08T16:53:10Z", "path": "Essentials/src/com/earth2me/essentials/craftbukkit/InventoryWorkaround.java", "diffHunk": "@@ -267,4 +267,17 @@ public static void setItemInOffHand(final Player p, final ItemStack item) {\n             }\n         }\n     }\n+\n+    public static int clearItemInOffHand(final Player p, final ItemStack item) {\n+        if (hasMainHandSupport) {\n+            int removedAmount = 0;\n+            if (p.getInventory().getItemInOffHand().getType().equals(item.getType())) {\n+                removedAmount = p.getInventory().getItemInOffHand().getAmount();\n+                p.getInventory().setItemInOffHand(null);\n+            }\n+            hasMainHandSupport = true;", "originalCommit": "d071ea7081eaf117287b25b5bddb6d07731ea8ea", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjA3NDMwMA==", "url": "https://github.com/EssentialsX/Essentials/pull/3715#discussion_r502074300", "bodyText": "Forgot to remove that when I removed hasMainHandSupport == null. Will fix.", "author": "Kenichycmd", "createdAt": "2020-10-08T23:24:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTg2ODg4Ng=="}], "type": "inlineReview"}, {"oid": "3b220f0d5f60c0f924f9fe0630087105282f6132", "url": "https://github.com/EssentialsX/Essentials/commit/3b220f0d5f60c0f924f9fe0630087105282f6132", "message": "Added a config for the offhand slot + bug fixes.", "committedDate": "2020-10-10T00:35:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzEzMTUzMg==", "url": "https://github.com/EssentialsX/Essentials/pull/3715#discussion_r503131532", "bodyText": "It makes more sense to keep the old behaviour for old configs and change the behaviour for fresh configs, but this does the opposite?", "author": "mdcfe", "createdAt": "2020-10-12T08:39:44Z", "path": "Essentials/src/config.yml", "diffHunk": "@@ -141,6 +141,9 @@ warn-on-smite: true\n # Shall we drop items instead of adding to inventory if the target inventory is full?\n drop-items-if-full: false\n \n+# Shall we clear the offhand slot when executing the command /clear [player] [item]\n+clear-offhand-slot: false", "originalCommit": "3b220f0d5f60c0f924f9fe0630087105282f6132", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzE4OTI2Nw==", "url": "https://github.com/EssentialsX/Essentials/pull/3715#discussion_r503189267", "bodyText": "Wdym by that?", "author": "Kenichycmd", "createdAt": "2020-10-12T10:12:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzEzMTUzMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzI1MDEwNg==", "url": "https://github.com/EssentialsX/Essentials/pull/3715#discussion_r503250106", "bodyText": "He wanted that for new configs, it will be true (basically change this to true), however for existing ones it will be false (defined in Settings.java, change it to false there)", "author": "l1ttleO", "createdAt": "2020-10-12T12:07:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzEzMTUzMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzY4NTM0NQ==", "url": "https://github.com/EssentialsX/Essentials/pull/3715#discussion_r503685345", "bodyText": "I'm so dumb, I forgot to change the isOffHandSlotClearingEnabled() in Settings.java to false when I was thinking of changing clear-offhand-slot to false xD. Thanks!", "author": "Kenichycmd", "createdAt": "2020-10-13T06:00:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzEzMTUzMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzEzMjUyMw==", "url": "https://github.com/EssentialsX/Essentials/pull/3715#discussion_r503132523", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            # Shall we clear the offhand slot when executing the command /clear [player] [item]\n          \n          \n            \n            # Shall we clear the offhand slot when executing the command /clear [player] [item]?\n          \n          \n            \n            # Note that running /clear on its own will clear your offhand regardless of this setting.\n          \n      \n    \n    \n  \n\nClarifies the meaning of this option.", "author": "mdcfe", "createdAt": "2020-10-12T08:41:17Z", "path": "Essentials/src/config.yml", "diffHunk": "@@ -141,6 +141,9 @@ warn-on-smite: true\n # Shall we drop items instead of adding to inventory if the target inventory is full?\n drop-items-if-full: false\n \n+# Shall we clear the offhand slot when executing the command /clear [player] [item]", "originalCommit": "3b220f0d5f60c0f924f9fe0630087105282f6132", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "25492cf87c2c4f93263c05442aa76272fee6c992", "url": "https://github.com/EssentialsX/Essentials/commit/25492cf87c2c4f93263c05442aa76272fee6c992", "message": "Fixed config error and also added a notice to clear-offhand-slot.", "committedDate": "2020-10-13T06:21:34Z", "type": "commit"}, {"oid": "bb4e8159145b6b168bd0f4ca51450acc9f17ac58", "url": "https://github.com/EssentialsX/Essentials/commit/bb4e8159145b6b168bd0f4ca51450acc9f17ac58", "message": "Removed Config for the Clear Command.", "committedDate": "2020-10-13T08:11:17Z", "type": "commit"}, {"oid": "7852ee6b12b6163179ddf76586ea4cb510a3322c", "url": "https://github.com/EssentialsX/Essentials/commit/7852ee6b12b6163179ddf76586ea4cb510a3322c", "message": "Undo unnecessary formatting change", "committedDate": "2020-11-09T16:41:16Z", "type": "commit"}]}