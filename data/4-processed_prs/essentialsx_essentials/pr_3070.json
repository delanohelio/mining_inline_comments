{"pr_number": 3070, "pr_title": "Add default enchantment level for enchant sign", "pr_createdAt": "2020-03-13T15:38:47Z", "pr_url": "https://github.com/EssentialsX/Essentials/pull/3070", "timeline": [{"oid": "0278e716a318bc3184384c7efee3df26f08b08e8", "url": "https://github.com/EssentialsX/Essentials/commit/0278e716a318bc3184384c7efee3df26f08b08e8", "message": "Add default enchantment level for enchant sign", "committedDate": "2020-03-13T15:37:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDY4MDEyMw==", "url": "https://github.com/EssentialsX/Essentials/pull/3070#discussion_r400680123", "bodyText": "This logic opens up a weird validation corner case that probably doesn't matter but I'll still complain about....\nenchant:level:somejunk is valid, but even if level > 1, level will always only be 1. This should be a validation error.", "author": "Ichbinjoe", "createdAt": "2020-03-31T06:51:18Z", "path": "Essentials/src/com/earth2me/essentials/signs/SignEnchant.java", "diffHunk": "@@ -28,21 +28,19 @@ protected boolean onSignCreate(final ISign sign, final User player, final String\n             throw e;\n         }\n         final String[] enchantLevel = sign.getLine(2).split(\":\");\n-        if (enchantLevel.length != 2) {\n-            sign.setLine(2, \"\u00a7c<enchant>\");\n-            throw new SignException(tl(\"invalidSignLine\", 3));\n-        }\n+        int level = 1;\n         final Enchantment enchantment = Enchantments.getByName(enchantLevel[0]);\n         if (enchantment == null) {\n             sign.setLine(2, \"\u00a7c<enchant>\");\n             throw new SignException(tl(\"enchantmentNotFound\"));\n         }\n-        int level;\n-        try {\n-            level = Integer.parseInt(enchantLevel[1]);\n-        } catch (NumberFormatException ex) {\n-            sign.setLine(2, \"\u00a7c<enchant>\");\n-            throw new SignException(ex.getMessage(), ex);\n+        if (enchantLevel.length == 2) {", "originalCommit": "0278e716a318bc3184384c7efee3df26f08b08e8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDY4MDUwMA==", "url": "https://github.com/EssentialsX/Essentials/pull/3070#discussion_r400680500", "bodyText": "I don't like this default. I know you didn't do it, but this just feels clowny.", "author": "Ichbinjoe", "createdAt": "2020-03-31T06:52:11Z", "path": "Essentials/src/com/earth2me/essentials/signs/SignEnchant.java", "diffHunk": "@@ -70,18 +68,17 @@ protected boolean onSignInteract(ISign sign, User player, String username, IEsse\n         final Trade charge = getTrade(sign, 3, ess);\n         charge.isAffordableFor(player);\n         final String[] enchantLevel = sign.getLine(2).split(\":\");\n-        if (enchantLevel.length != 2) {\n-            throw new SignException(tl(\"invalidSignLine\", 3));\n-        }\n         final Enchantment enchantment = Enchantments.getByName(enchantLevel[0]);\n         if (enchantment == null) {\n             throw new SignException(tl(\"enchantmentNotFound\"));\n         }\n-        int level;\n-        try {\n-            level = Integer.parseInt(enchantLevel[1]);\n-        } catch (NumberFormatException ex) {\n-            level = enchantment.getMaxLevel();\n+        int level = 1;\n+        if (enchantLevel.length == 2) {\n+            try {\n+                level = Integer.parseInt(enchantLevel[1]);\n+            } catch (NumberFormatException ex) {\n+                level = enchantment.getMaxLevel();", "originalCommit": "0278e716a318bc3184384c7efee3df26f08b08e8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTAzNTQ0NA==", "url": "https://github.com/EssentialsX/Essentials/pull/3070#discussion_r401035444", "bodyText": "Would you rather it be 1?", "author": "JRoy", "createdAt": "2020-03-31T16:07:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDY4MDUwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDg3NTIyMw==", "url": "https://github.com/EssentialsX/Essentials/pull/3070#discussion_r414875223", "bodyText": "This currently retains the previous behaviour, where if the sign included a level but it was invalid, the sign would enchant at the max level. However, this case shouldn't ever get reached, as the sign is validated in onSignCreate above. If we've managed to get to this point, someone has deliberately bypassed validation, and I'd rather throw an error here than make assumptions about what the sign should do.", "author": "mdcfe", "createdAt": "2020-04-24T21:31:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDY4MDUwMA=="}], "type": "inlineReview"}, {"oid": "19c285989964680bcbfdd7caa26a163299a646cf", "url": "https://github.com/EssentialsX/Essentials/commit/19c285989964680bcbfdd7caa26a163299a646cf", "message": "Review changes", "committedDate": "2020-03-31T16:09:22Z", "type": "commit"}, {"oid": "8e34635ac73d6e8303463dd69afaed88807e7507", "url": "https://github.com/EssentialsX/Essentials/commit/8e34635ac73d6e8303463dd69afaed88807e7507", "message": "Remove max enchantment default", "committedDate": "2020-04-27T21:46:37Z", "type": "commit"}]}