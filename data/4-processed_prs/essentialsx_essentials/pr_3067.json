{"pr_number": 3067, "pr_title": "Cleanup code", "pr_createdAt": "2020-03-13T03:16:16Z", "pr_url": "https://github.com/EssentialsX/Essentials/pull/3067", "timeline": [{"oid": "55784954dda6c01857a8be5507a4feac6f6d66e7", "url": "https://github.com/EssentialsX/Essentials/commit/55784954dda6c01857a8be5507a4feac6f6d66e7", "message": "Cleanup code", "committedDate": "2020-03-13T03:13:12Z", "type": "commit"}, {"oid": "e1c0d9f04ec471d9957a70442c6283a8d22f481f", "url": "https://github.com/EssentialsX/Essentials/commit/e1c0d9f04ec471d9957a70442c6283a8d22f481f", "message": "Merge branch '2.x' into feature/code-improvments", "committedDate": "2020-04-23T18:30:21Z", "type": "commit"}, {"oid": "cf7acb5b6a2f6ecc5a2bdbb23bc7e0a887ba4c8a", "url": "https://github.com/EssentialsX/Essentials/commit/cf7acb5b6a2f6ecc5a2bdbb23bc7e0a887ba4c8a", "message": "Fix", "committedDate": "2020-04-23T18:33:25Z", "type": "commit"}, {"oid": "ded1d10d0f0d9016e5790ed31206679863ae28fb", "url": "https://github.com/EssentialsX/Essentials/commit/ded1d10d0f0d9016e5790ed31206679863ae28fb", "message": "More changes lol", "committedDate": "2020-04-23T19:00:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDY3NTA3Mg==", "url": "https://github.com/EssentialsX/Essentials/pull/3067#discussion_r414675072", "bodyText": "This looks like it introduces rounding errors and change the amount that the signs give - does this still function the same or does it change?", "author": "mdcfe", "createdAt": "2020-04-24T15:42:54Z", "path": "Essentials/src/com/earth2me/essentials/signs/SignSell.java", "diffHunk": "@@ -40,7 +41,7 @@ protected boolean onSignInteract(final ISign sign, final User player, final Stri\n                 charge = new Trade(item, ess);\n \n                 BigDecimal chargeAmount = money.getMoney();\n-                BigDecimal pricePerSingleItem = chargeAmount.divide(new BigDecimal(initialItemAmount));\n+                BigDecimal pricePerSingleItem = chargeAmount.divide(new BigDecimal(initialItemAmount), RoundingMode.HALF_EVEN);", "originalCommit": "ded1d10d0f0d9016e5790ed31206679863ae28fb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDY3NTMxMw==", "url": "https://github.com/EssentialsX/Essentials/pull/3067#discussion_r414675313", "bodyText": "Same as SignSell - doesn't this change the amount charged?", "author": "mdcfe", "createdAt": "2020-04-24T15:43:15Z", "path": "Essentials/src/com/earth2me/essentials/signs/SignBuy.java", "diffHunk": "@@ -39,7 +40,7 @@ protected boolean onSignInteract(final ISign sign, final User player, final Stri\n                 items = new Trade(item, ess);\n \n                 BigDecimal chargeAmount = charge.getMoney();\n-                BigDecimal pricePerSingleItem = chargeAmount.divide(new BigDecimal(initialItemAmount));\n+                BigDecimal pricePerSingleItem = chargeAmount.divide(new BigDecimal(initialItemAmount), RoundingMode.HALF_EVEN);", "originalCommit": "ded1d10d0f0d9016e5790ed31206679863ae28fb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDY5NjA1NA==", "url": "https://github.com/EssentialsX/Essentials/pull/3067#discussion_r414696054", "bodyText": "Is this definitely safe to do? bStats can be turned on/off; I'm not sure if there are any variants of the class that might expect this field to not be final.", "author": "mdcfe", "createdAt": "2020-04-24T16:13:18Z", "path": "Essentials/src/com/earth2me/essentials/metrics/Metrics.java", "diffHunk": "@@ -50,7 +50,7 @@\n     private static final String URL = \"https://bStats.org/submitData/bukkit\";\n \n     // Is bStats enabled on this server?\n-    private boolean enabled;\n+    private final boolean enabled;", "originalCommit": "ded1d10d0f0d9016e5790ed31206679863ae28fb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDgwNzI1Ng==", "url": "https://github.com/EssentialsX/Essentials/pull/3067#discussion_r414807256", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                    buffer.rewind();\n          \n          \n            \n                                    ((Buffer) buffer).rewind();\n          \n      \n    \n    \n  \n\nThese casts are necessary, otherwise builds on Java 9+ won't run on Java 8 (some people ran into issues with this).", "author": "mdcfe", "createdAt": "2020-04-24T19:19:20Z", "path": "Essentials/src/com/earth2me/essentials/EssentialsConf.java", "diffHunk": "@@ -125,20 +111,20 @@ public synchronized void load() {\n                         ByteBuffer resize = ByteBuffer.allocate(buffer.capacity() + length - buffer.remaining());\n                         int resizePosition = buffer.position();\n                         // Fix builds compiled against Java 9+ breaking on Java 8\n-                        ((Buffer) buffer).rewind();\n+                        buffer.rewind();", "originalCommit": "ded1d10d0f0d9016e5790ed31206679863ae28fb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDgwNzQxMw==", "url": "https://github.com/EssentialsX/Essentials/pull/3067#discussion_r414807413", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            buffer.rewind();\n          \n          \n            \n                            ((Buffer) buffer).rewind();", "author": "mdcfe", "createdAt": "2020-04-24T19:19:40Z", "path": "Essentials/src/com/earth2me/essentials/EssentialsConf.java", "diffHunk": "@@ -125,20 +111,20 @@ public synchronized void load() {\n                         ByteBuffer resize = ByteBuffer.allocate(buffer.capacity() + length - buffer.remaining());\n                         int resizePosition = buffer.position();\n                         // Fix builds compiled against Java 9+ breaking on Java 8\n-                        ((Buffer) buffer).rewind();\n+                        buffer.rewind();\n                         resize.put(buffer);\n                         resize.position(resizePosition);\n                         buffer = resize;\n                     }\n                     buffer.put(bytebuffer, 0, length);\n                 }\n-                ((Buffer) buffer).rewind();\n+                buffer.rewind();", "originalCommit": "ded1d10d0f0d9016e5790ed31206679863ae28fb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDgwNzYzOQ==", "url": "https://github.com/EssentialsX/Essentials/pull/3067#discussion_r414807639", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                buffer.rewind();\n          \n          \n            \n                                data.clear();\n          \n          \n            \n                                ((Buffer) buffer).rewind();\n          \n          \n            \n                                ((Buffer) data).clear();", "author": "mdcfe", "createdAt": "2020-04-24T19:20:10Z", "path": "Essentials/src/com/earth2me/essentials/EssentialsConf.java", "diffHunk": "@@ -125,20 +111,20 @@ public synchronized void load() {\n                         ByteBuffer resize = ByteBuffer.allocate(buffer.capacity() + length - buffer.remaining());\n                         int resizePosition = buffer.position();\n                         // Fix builds compiled against Java 9+ breaking on Java 8\n-                        ((Buffer) buffer).rewind();\n+                        buffer.rewind();\n                         resize.put(buffer);\n                         resize.position(resizePosition);\n                         buffer = resize;\n                     }\n                     buffer.put(bytebuffer, 0, length);\n                 }\n-                ((Buffer) buffer).rewind();\n+                buffer.rewind();\n                 final CharBuffer data = CharBuffer.allocate(buffer.capacity());\n                 CharsetDecoder decoder = UTF8.newDecoder();\n                 CoderResult result = decoder.decode(buffer, data, true);\n                 if (result.isError()) {\n-                    ((Buffer) buffer).rewind();\n-                    ((Buffer) data).clear();\n+                    buffer.rewind();\n+                    data.clear();", "originalCommit": "ded1d10d0f0d9016e5790ed31206679863ae28fb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDgwNzg1OA==", "url": "https://github.com/EssentialsX/Essentials/pull/3067#discussion_r414807858", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            data.rewind();\n          \n          \n            \n                            ((Buffer) data).rewind();", "author": "mdcfe", "createdAt": "2020-04-24T19:20:30Z", "path": "Essentials/src/com/earth2me/essentials/EssentialsConf.java", "diffHunk": "@@ -151,7 +137,7 @@ public synchronized void load() {\n                     decoder.flush(data);\n                 }\n                 final int end = data.position();\n-                ((Buffer) data).rewind();\n+                data.rewind();", "originalCommit": "ded1d10d0f0d9016e5790ed31206679863ae28fb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDgxOTgyMA==", "url": "https://github.com/EssentialsX/Essentials/pull/3067#discussion_r414819820", "bodyText": "Where is this used?", "author": "mdcfe", "createdAt": "2020-04-24T19:42:58Z", "path": "Essentials/src/com/earth2me/essentials/PlayerList.java", "diffHunk": "@@ -60,17 +60,14 @@ public static String listSummary(final IEssentials ess, final User user, final b\n \n     // Build the basic player list, divided by groups.\n     public static Map<String, List<User>> getPlayerLists(final IEssentials ess, final User sender, final boolean showHidden) {\n+        Server server = ess.getServer();", "originalCommit": "ded1d10d0f0d9016e5790ed31206679863ae28fb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "7c5d086e090c2efbf4d4c1c1b0e0c78156f4ae23", "url": "https://github.com/EssentialsX/Essentials/commit/7c5d086e090c2efbf4d4c1c1b0e0c78156f4ae23", "message": "Revert Buffer cast fix\n\nCo-Authored-By: md678685 <1917406+md678685@users.noreply.github.com>", "committedDate": "2020-04-24T20:32:05Z", "type": "commit"}, {"oid": "69515d20fe7fb6c877dd78adfd5087afe35b9483", "url": "https://github.com/EssentialsX/Essentials/commit/69515d20fe7fb6c877dd78adfd5087afe35b9483", "message": "Revert buffer cast fix\n\nCo-Authored-By: md678685 <1917406+md678685@users.noreply.github.com>", "committedDate": "2020-04-24T20:32:39Z", "type": "commit"}, {"oid": "527e9bf413fea001263de636d122465856b3aac7", "url": "https://github.com/EssentialsX/Essentials/commit/527e9bf413fea001263de636d122465856b3aac7", "message": "Revert buffer cast fix\n\nCo-Authored-By: md678685 <1917406+md678685@users.noreply.github.com>", "committedDate": "2020-04-24T20:32:56Z", "type": "commit"}, {"oid": "387cd242877bcd1876ed8378c06a98cd7617b1b3", "url": "https://github.com/EssentialsX/Essentials/commit/387cd242877bcd1876ed8378c06a98cd7617b1b3", "message": "Revert buffer cast fix\n\nCo-Authored-By: md678685 <1917406+md678685@users.noreply.github.com>", "committedDate": "2020-04-24T20:33:03Z", "type": "commit"}, {"oid": "1be9b111c19da7d724d87ea1fefeb534ba76f7d3", "url": "https://github.com/EssentialsX/Essentials/commit/1be9b111c19da7d724d87ea1fefeb534ba76f7d3", "message": "Fix unused server variable", "committedDate": "2020-04-24T20:41:34Z", "type": "commit"}, {"oid": "69695992ec950158ad987cebd64d7eac5b7f279d", "url": "https://github.com/EssentialsX/Essentials/commit/69695992ec950158ad987cebd64d7eac5b7f279d", "message": "Remove explicit RoundingModes", "committedDate": "2020-04-24T20:42:55Z", "type": "commit"}, {"oid": "4dd8a655d541d22e77ddef3478f27c1f28158881", "url": "https://github.com/EssentialsX/Essentials/commit/4dd8a655d541d22e77ddef3478f27c1f28158881", "message": "Don't change Metrics class", "committedDate": "2020-04-24T20:43:46Z", "type": "commit"}, {"oid": "354a5b40af1e7b5f6dfc2c88c0581abe0a12d65c", "url": "https://github.com/EssentialsX/Essentials/commit/354a5b40af1e7b5f6dfc2c88c0581abe0a12d65c", "message": "Merge branch 'feature/code-improvments' of https://github.com/schlatt-co/Essentials into feature/code-improvments", "committedDate": "2020-04-24T20:44:05Z", "type": "commit"}]}