{"pr_number": 470, "pr_title": "Add addTrait method to ModelAssembler", "pr_createdAt": "2020-06-19T22:39:56Z", "pr_url": "https://github.com/awslabs/smithy/pull/470", "timeline": [{"oid": "6dfbc28f7fe9239eb6f6faf8c42242f3e94e4e02", "url": "https://github.com/awslabs/smithy/commit/6dfbc28f7fe9239eb6f6faf8c42242f3e94e4e02", "message": "Add addTrait method to ModelAssembler", "committedDate": "2020-06-19T22:36:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzA3Nzc4NA==", "url": "https://github.com/awslabs/smithy/pull/470#discussion_r443077784", "bodyText": "A simpler test case could just directly create a SuppressTrait rather than needing to use a TraitFactory. Seems like the TraitFactory bit isn't under test here.", "author": "mtdowling", "createdAt": "2020-06-19T23:35:35Z", "path": "smithy-model/src/test/java/software/amazon/smithy/model/loader/ModelAssemblerTest.java", "diffHunk": "@@ -88,6 +92,26 @@ public void addsExplicitShapes() {\n         assertThat(result.unwrap().getShape(ShapeId.from(\"ns.foo#Bar\")), is(Optional.of(shape)));\n     }\n \n+    @Test\n+    public void addsExplicitTraits() {\n+        StringShape shape = StringShape.builder().id(\"ns.foo#Bar\").build();\n+\n+        Node node = Node.fromStrings(\"validator\");\n+        TraitFactory provider = TraitFactory.createServiceFactory();", "originalCommit": "6dfbc28f7fe9239eb6f6faf8c42242f3e94e4e02", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzA4MjcxNA==", "url": "https://github.com/awslabs/smithy/pull/470#discussion_r443082714", "bodyText": "Fixed.", "author": "srchase", "createdAt": "2020-06-20T00:14:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzA3Nzc4NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzA3Nzk2Nw==", "url": "https://github.com/awslabs/smithy/pull/470#discussion_r443077967", "bodyText": "Then here you could test both for the concrete trait class, no? (i.e., shape.getTrait(SuppressTrait.class))", "author": "mtdowling", "createdAt": "2020-06-19T23:36:22Z", "path": "smithy-model/src/test/java/software/amazon/smithy/model/loader/ModelAssemblerTest.java", "diffHunk": "@@ -88,6 +92,26 @@ public void addsExplicitShapes() {\n         assertThat(result.unwrap().getShape(ShapeId.from(\"ns.foo#Bar\")), is(Optional.of(shape)));\n     }\n \n+    @Test\n+    public void addsExplicitTraits() {\n+        StringShape shape = StringShape.builder().id(\"ns.foo#Bar\").build();\n+\n+        Node node = Node.fromStrings(\"validator\");\n+        TraitFactory provider = TraitFactory.createServiceFactory();\n+        Optional<Trait> trait = provider.createTrait(\n+                ShapeId.from(\"smithy.api#suppress\"), shape.toShapeId(), node);\n+\n+        SuppressTrait suppress = (SuppressTrait) trait.get();\n+        ValidatedResult<Model> result = new ModelAssembler()\n+                .addShape(shape)\n+                .addTrait(shape.toShapeId(), suppress)\n+                .assemble();\n+\n+        assertThat(result.getValidationEvents(), empty());\n+        Shape resultShape = result.unwrap().getShape(ShapeId.from(\"ns.foo#Bar\")).get();\n+        assertTrue(resultShape.findTrait(\"smithy.api#suppress\").isPresent());", "originalCommit": "6dfbc28f7fe9239eb6f6faf8c42242f3e94e4e02", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzA3ODEzOA==", "url": "https://github.com/awslabs/smithy/pull/470#discussion_r443078138", "bodyText": "Nit, personal taste -- I know this comes right after some forEach calls, but I prefer a normal for loop when possible.", "author": "mtdowling", "createdAt": "2020-06-19T23:37:34Z", "path": "smithy-model/src/main/java/software/amazon/smithy/model/loader/ModelAssembler.java", "diffHunk": "@@ -499,6 +517,9 @@ private LoaderVisitor createLoaderVisitor() {\n \n         shapes.forEach(visitor::onShape);\n         metadata.forEach(visitor::onMetadata);\n+        pendingTraits.forEach(pendingTrait -> {", "originalCommit": "6dfbc28f7fe9239eb6f6faf8c42242f3e94e4e02", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzA4MjcyNg==", "url": "https://github.com/awslabs/smithy/pull/470#discussion_r443082726", "bodyText": "Fixed.", "author": "srchase", "createdAt": "2020-06-20T00:14:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzA3ODEzOA=="}], "type": "inlineReview"}, {"oid": "d34bdc4f0f73c172b736e8adf2fd4abbdd71ead3", "url": "https://github.com/awslabs/smithy/commit/d34bdc4f0f73c172b736e8adf2fd4abbdd71ead3", "message": "Simplify test, use for loop", "committedDate": "2020-06-20T00:13:57Z", "type": "commit"}]}