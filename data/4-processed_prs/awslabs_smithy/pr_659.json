{"pr_number": 659, "pr_title": "Fix Access-Control-Expose-Headers", "pr_createdAt": "2020-12-07T21:47:07Z", "pr_url": "https://github.com/awslabs/smithy/pull/659", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzg5NTEzNA==", "url": "https://github.com/awslabs/smithy/pull/659#discussion_r537895134", "bodyText": "This now uses postProcessOperation, not updateOperation.", "author": "kstich", "createdAt": "2020-12-07T22:54:13Z", "path": "smithy-aws-apigateway-openapi/src/main/java/software/amazon/smithy/aws/apigateway/openapi/AddCorsResponseHeaders.java", "diffHunk": "@@ -47,26 +49,46 @@\n         return ListUtils.of(ApiGatewayConfig.ApiType.REST);\n     }\n \n+    // Because this needs to update responses and have a reference to the\n+    // OperationObject, updateOperation is used instead of updateResponse.", "originalCommit": "b84b5450d7d837a2daac23ddb8e302bf925e68fb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODYxMDMwOA==", "url": "https://github.com/awslabs/smithy/pull/659#discussion_r538610308", "bodyText": "Oh weird, this is probably some kind of inadvertent IntelliJ refactor.", "author": "mtdowling", "createdAt": "2020-12-08T17:06:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzg5NTEzNA=="}], "type": "inlineReview"}, {"oid": "304600306c973fe51ed1555c8e42994d58204bf9", "url": "https://github.com/awslabs/smithy/commit/304600306c973fe51ed1555c8e42994d58204bf9", "message": "Fix Access-Control-Expose-Headers\n\nThis commit ensures that Access-Control-Expose-Headers is correctly\npopulated based on all of the headers used in an operation, including\nany headers that might be  added manually during the OpenAPI conversion\nindependent of a Smithy shape.\n\nI added a new ApiGatewayMapper method called postProcessOperation to\nallow transformations to better control when they are applied, in\nparticular, transforms sometimes need to occur on an operation after the\nthings that the operation contains have been transformed. This was not\npreviously possible even with the ordering semantics that already exist.\nThis change was necessary in order to ensure that the correct CORs\nheaders are added to operations based on all of the transforms applied\nto the operation, and it makes it easier to separate CORS headers from\nmodeled headers when constructing Access-Control-Expose-Headers.", "committedDate": "2020-12-08T17:07:29Z", "type": "commit"}, {"oid": "304600306c973fe51ed1555c8e42994d58204bf9", "url": "https://github.com/awslabs/smithy/commit/304600306c973fe51ed1555c8e42994d58204bf9", "message": "Fix Access-Control-Expose-Headers\n\nThis commit ensures that Access-Control-Expose-Headers is correctly\npopulated based on all of the headers used in an operation, including\nany headers that might be  added manually during the OpenAPI conversion\nindependent of a Smithy shape.\n\nI added a new ApiGatewayMapper method called postProcessOperation to\nallow transformations to better control when they are applied, in\nparticular, transforms sometimes need to occur on an operation after the\nthings that the operation contains have been transformed. This was not\npreviously possible even with the ordering semantics that already exist.\nThis change was necessary in order to ensure that the correct CORs\nheaders are added to operations based on all of the transforms applied\nto the operation, and it makes it easier to separate CORS headers from\nmodeled headers when constructing Access-Control-Expose-Headers.", "committedDate": "2020-12-08T17:07:29Z", "type": "forcePushed"}]}