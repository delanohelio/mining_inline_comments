{"pr_number": 628, "pr_title": "Add methods for retrieving full paginator output token and item paths.", "pr_createdAt": "2020-11-09T19:14:15Z", "pr_url": "https://github.com/awslabs/smithy/pull/628", "timeline": [{"oid": "c7dd86498bc5477caacb787f18329fda2aeda1ad", "url": "https://github.com/awslabs/smithy/commit/c7dd86498bc5477caacb787f18329fda2aeda1ad", "message": "Add methods for retrieving full paginator output and item paths.", "committedDate": "2020-11-09T21:17:25Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTU1MTUxNQ==", "url": "https://github.com/awslabs/smithy/pull/628#discussion_r521551515", "bodyText": "This breaks a public method contract. This should be a new method, with updated documentation, instead of replacing the current one. If the old method shouldn't be used, it should be marked as @deprecated, its existing functionality routed through the new method, usages of it removed where possible, and explicit tests of its functionality added if not already present.\nWhen splitting this out, the return type should just be a List instead of an Optional<List<>>. An empty list should indicate an unresolvable path, instead of needing to check both the Optional and List for emptiness. This will need to account for partially resolved paths as well, where leading segment(s) of the path are present but not all segments are present.", "author": "kstich", "createdAt": "2020-11-11T18:19:09Z", "path": "smithy-model/src/main/java/software/amazon/smithy/model/traits/PaginatedTrait.java", "diffHunk": "@@ -90,23 +92,26 @@ private PaginatedTrait(Builder builder) {\n      *              of an operation.\n      * @return The optional member shape that the path resolves to.\n      */\n-    public static Optional<MemberShape> resolvePath(\n+    public static Optional<List<MemberShape>> resolvePath(", "originalCommit": "c7dd86498bc5477caacb787f18329fda2aeda1ad", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTU1MzEwOA==", "url": "https://github.com/awslabs/smithy/pull/628#discussion_r521553108", "bodyText": "The updates to this file should have tests, enforcing the behavior of the existing methods before the change (if none are present already around multi-segment paths) and the behavior of the new methods.", "author": "kstich", "createdAt": "2020-11-11T18:22:04Z", "path": "smithy-model/src/main/java/software/amazon/smithy/model/knowledge/PaginationInfo.java", "diffHunk": "@@ -88,11 +89,35 @@ public MemberShape getInputTokenMember() {\n         return inputToken;\n     }\n \n+    /**\n+     * @return the last {@link MemberShape} of the output path.\n+     * @deprecated See getOutputTokenPath.\n+     */\n     public MemberShape getOutputTokenMember() {", "originalCommit": "c7dd86498bc5477caacb787f18329fda2aeda1ad", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTU2NDgyMw==", "url": "https://github.com/awslabs/smithy/pull/628#discussion_r521564823", "bodyText": "Having a resolved output token is required for pagination, I think you can assume that size will be >= 1.\n\nWhen contained within a service, a paginated operation MUST either configure outputToken on the operation itself or inherit it from the service that contains the operation.", "author": "kstich", "createdAt": "2020-11-11T18:43:31Z", "path": "smithy-model/src/main/java/software/amazon/smithy/model/knowledge/PaginationInfo.java", "diffHunk": "@@ -88,11 +89,35 @@ public MemberShape getInputTokenMember() {\n         return inputToken;\n     }\n \n+    /**\n+     * @return the last {@link MemberShape} of the output path.\n+     * @deprecated See getOutputTokenPath.\n+     */\n     public MemberShape getOutputTokenMember() {\n+        int size = outputToken.size();\n+        if (size == 0) {\n+            return null;", "originalCommit": "c7dd86498bc5477caacb787f18329fda2aeda1ad", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTU2NTg1NA==", "url": "https://github.com/awslabs/smithy/pull/628#discussion_r521565854", "bodyText": "See other notes around using an empty list instead of Optional<List<>>.", "author": "kstich", "createdAt": "2020-11-11T18:45:24Z", "path": "smithy-model/src/main/java/software/amazon/smithy/model/knowledge/PaginationInfo.java", "diffHunk": "@@ -88,11 +89,35 @@ public MemberShape getInputTokenMember() {\n         return inputToken;\n     }\n \n+    /**\n+     * @return the last {@link MemberShape} of the output path.\n+     * @deprecated See getOutputTokenPath.\n+     */\n     public MemberShape getOutputTokenMember() {\n+        int size = outputToken.size();\n+        if (size == 0) {\n+            return null;\n+        }\n+        return outputToken.get(size - 1);\n+    }\n+\n+    public List<MemberShape> getOutputTokenPath() {\n         return outputToken;\n     }\n \n+    /**\n+     * @return the last {@link MemberShape} of the items path.\n+     * @deprecated See getItemsMemberPath\n+     */\n     public Optional<MemberShape> getItemsMember() {\n+        int size = items.size();\n+        if (size == 0) {\n+            return Optional.empty();\n+        }\n+        return Optional.ofNullable(items.get(size - 1));\n+    }\n+\n+    public Optional<List<MemberShape>> getItemsMemberPath() {", "originalCommit": "c7dd86498bc5477caacb787f18329fda2aeda1ad", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTU2NjYyMw==", "url": "https://github.com/awslabs/smithy/pull/628#discussion_r521566623", "bodyText": "This should resolve to an empty list (ListUtils.of()) and check if the list is empty instead of working with a nullable list.", "author": "kstich", "createdAt": "2020-11-11T18:46:53Z", "path": "smithy-model/src/main/java/software/amazon/smithy/model/knowledge/PaginatedIndex.java", "diffHunk": "@@ -81,22 +82,22 @@ public static PaginatedIndex of(Model model) {\n         }\n \n         MemberShape inputToken = trait.getInputToken().flatMap(input::getMember).orElse(null);\n-        MemberShape outputToken = trait.getOutputToken()\n+        List<MemberShape> outputTokenPath = trait.getOutputToken()\n                 .flatMap(path -> PaginatedTrait.resolvePath(path, model, output))\n                 .orElse(null);", "originalCommit": "c7dd86498bc5477caacb787f18329fda2aeda1ad", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTU2Njc4NA==", "url": "https://github.com/awslabs/smithy/pull/628#discussion_r521566784", "bodyText": "This should resolve to an empty list instead.", "author": "kstich", "createdAt": "2020-11-11T18:47:09Z", "path": "smithy-model/src/main/java/software/amazon/smithy/model/knowledge/PaginatedIndex.java", "diffHunk": "@@ -81,22 +82,22 @@ public static PaginatedIndex of(Model model) {\n         }\n \n         MemberShape inputToken = trait.getInputToken().flatMap(input::getMember).orElse(null);\n-        MemberShape outputToken = trait.getOutputToken()\n+        List<MemberShape> outputTokenPath = trait.getOutputToken()\n                 .flatMap(path -> PaginatedTrait.resolvePath(path, model, output))\n                 .orElse(null);\n \n-        if (inputToken == null || outputToken == null) {\n+        if (inputToken == null || outputTokenPath == null) {\n             return Optional.empty();\n         }\n \n         MemberShape pageSizeMember = trait.getPageSize().flatMap(input::getMember).orElse(null);\n-        MemberShape itemsMember = trait.getItems()\n+        List<MemberShape> itemsMemberPath = trait.getItems()\n                 .flatMap(path -> PaginatedTrait.resolvePath(path, model, output))\n                 .orElse(null);", "originalCommit": "c7dd86498bc5477caacb787f18329fda2aeda1ad", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "13c7ac27506d36d11e2232166c3b3f20cf5078c7", "url": "https://github.com/awslabs/smithy/commit/13c7ac27506d36d11e2232166c3b3f20cf5078c7", "message": "Add methods for retrieving full paginator output and item paths.", "committedDate": "2020-11-11T20:42:48Z", "type": "commit"}, {"oid": "ec4443147b7fc34d5b8682bb190e5a153df4277f", "url": "https://github.com/awslabs/smithy/commit/ec4443147b7fc34d5b8682bb190e5a153df4277f", "message": "Address Feedback", "committedDate": "2020-11-11T21:58:34Z", "type": "forcePushed"}, {"oid": "b209eb354a52bab46fdf67ee95d3d04d5f5d8444", "url": "https://github.com/awslabs/smithy/commit/b209eb354a52bab46fdf67ee95d3d04d5f5d8444", "message": "Address Feedback", "committedDate": "2020-11-11T22:02:12Z", "type": "commit"}, {"oid": "b209eb354a52bab46fdf67ee95d3d04d5f5d8444", "url": "https://github.com/awslabs/smithy/commit/b209eb354a52bab46fdf67ee95d3d04d5f5d8444", "message": "Address Feedback", "committedDate": "2020-11-11T22:02:12Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjQyOTE1Ng==", "url": "https://github.com/awslabs/smithy/pull/628#discussion_r522429156", "bodyText": "You should also decorate the method with @Deprecated", "author": "JordonPhillips", "createdAt": "2020-11-12T21:12:10Z", "path": "smithy-model/src/main/java/software/amazon/smithy/model/knowledge/PaginationInfo.java", "diffHunk": "@@ -91,14 +91,11 @@ public MemberShape getInputTokenMember() {\n \n     /**\n      * @return the last {@link MemberShape} of the output path.\n-     * @deprecated See getOutputTokenPath.\n+     *\n+     * @deprecated See {@link PaginationInfo#getOutputTokenPath} to retrieve the full path.\n      */\n     public MemberShape getOutputTokenMember() {", "originalCommit": "b209eb354a52bab46fdf67ee95d3d04d5f5d8444", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjQyOTM1MQ==", "url": "https://github.com/awslabs/smithy/pull/628#discussion_r522429351", "bodyText": "This needs docs", "author": "JordonPhillips", "createdAt": "2020-11-12T21:12:37Z", "path": "smithy-model/src/main/java/software/amazon/smithy/model/knowledge/PaginationInfo.java", "diffHunk": "@@ -117,8 +115,8 @@ public MemberShape getOutputTokenMember() {\n         return Optional.ofNullable(items.get(size - 1));\n     }\n \n-    public Optional<List<MemberShape>> getItemsMemberPath() {\n-        return Optional.ofNullable(items);\n+    public List<MemberShape> getItemsMemberPath() {", "originalCommit": "b209eb354a52bab46fdf67ee95d3d04d5f5d8444", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjQyOTc3Mg==", "url": "https://github.com/awslabs/smithy/pull/628#discussion_r522429772", "bodyText": "nit: resolveFullPath would be a better name", "author": "JordonPhillips", "createdAt": "2020-11-12T21:13:31Z", "path": "smithy-model/src/main/java/software/amazon/smithy/model/traits/PaginatedTrait.java", "diffHunk": "@@ -86,13 +87,40 @@ private PaginatedTrait(Builder builder) {\n      * <p>A path is a series of identifiers separated by dots (`.`) where each identifier\n      * represents a member name in a structure.\n      *\n-     * @param path The path to resolve.\n+     * @param path  The path to resolve.\n      * @param model The model to be searched when resolving the path.\n      * @param shape The shape where path resolution should start, e.g. the output shape\n      *              of an operation.\n      * @return The optional member shape that the path resolves to.\n+     * @deprecated This method only returns the last {@link MemberShape} of an output path. To resolve each path\n+     * identifier to it's respective {@link MemberShape} see {@link PaginatedTrait#resolvePathToMember}\n      */\n-    public static Optional<List<MemberShape>> resolvePath(\n+    public static Optional<MemberShape> resolvePath(\n+            String path,\n+            Model model,\n+            StructureShape shape\n+    ) {\n+        List<MemberShape> memberShapes = resolvePathToMember(path, model, shape);\n+        if (memberShapes.size() == 0) {\n+            return Optional.empty();\n+        }\n+        return Optional.of(memberShapes.get(memberShapes.size() - 1));\n+    }\n+\n+    /**\n+     * Resolves an output path to a list of {@link MemberShape}.\n+     *\n+     * <p>A path is a series of identifiers separated by dots (`.`) where each identifier\n+     * represents a member name in a structure.\n+     *\n+     * @param path  The path to resolve.\n+     * @param model The model to be searched when resolving the path.\n+     * @param shape The shape where path resolution should start, e.g. the output shape\n+     *              of an operation.\n+     * @return The list of member shapes corresponding to each path identifier. An unresolvable path will be returned\n+     * as an empty list.\n+     */\n+    public static List<MemberShape> resolvePathToMember(", "originalCommit": "b209eb354a52bab46fdf67ee95d3d04d5f5d8444", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e311a06223f876236a1915dbbc2dcfe31228d4b5", "url": "https://github.com/awslabs/smithy/commit/e311a06223f876236a1915dbbc2dcfe31228d4b5", "message": "Additional feedback from @JordonPhillips", "committedDate": "2020-11-12T22:03:27Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDUxNjMzNQ==", "url": "https://github.com/awslabs/smithy/pull/628#discussion_r524516335", "bodyText": "Can replace the .size() == 0 comparison with .isEmpty()", "author": "kstich", "createdAt": "2020-11-16T19:23:45Z", "path": "smithy-model/src/main/java/software/amazon/smithy/model/knowledge/PaginatedIndex.java", "diffHunk": "@@ -81,22 +83,22 @@ public static PaginatedIndex of(Model model) {\n         }\n \n         MemberShape inputToken = trait.getInputToken().flatMap(input::getMember).orElse(null);\n-        MemberShape outputToken = trait.getOutputToken()\n-                .flatMap(path -> PaginatedTrait.resolvePath(path, model, output))\n-                .orElse(null);\n+        List<MemberShape> outputTokenPath = trait.getOutputToken()\n+                .map(path -> PaginatedTrait.resolveFullPath(path, model, output))\n+                .orElse(ListUtils.of());\n \n-        if (inputToken == null || outputToken == null) {\n+        if (inputToken == null || outputTokenPath.size() == 0) {", "originalCommit": "e311a06223f876236a1915dbbc2dcfe31228d4b5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDUxOTQxOQ==", "url": "https://github.com/awslabs/smithy/pull/628#discussion_r524519419", "bodyText": "The method names on these are inconsistent:\ngetOutputTokenMember -> getOutputTokenPath\ngetItemsMember -> getItemsMemberPath\nSince the original names are intact, I'd make this one getOutputTokenMemberPath.", "author": "kstich", "createdAt": "2020-11-16T19:29:15Z", "path": "smithy-model/src/main/java/software/amazon/smithy/model/knowledge/PaginationInfo.java", "diffHunk": "@@ -88,12 +89,46 @@ public MemberShape getInputTokenMember() {\n         return inputToken;\n     }\n \n+    /**\n+     * @return the last {@link MemberShape} of the output path.\n+     *\n+     * @deprecated See {@link PaginationInfo#getOutputTokenPath} to retrieve the full path.\n+     */\n+    @Deprecated\n     public MemberShape getOutputTokenMember() {\n+        return outputToken.get(outputToken.size() - 1);\n+    }\n+\n+    /**\n+     * Get the resolved output path identifiers as a list of {@link MemberShape}.\n+     *\n+     * @return A list of {@link MemberShape}.\n+     */\n+    public List<MemberShape> getOutputTokenPath() {", "originalCommit": "e311a06223f876236a1915dbbc2dcfe31228d4b5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "a739e7ed01bda8ca0c897ecd1c1d7a0c8bbab848", "url": "https://github.com/awslabs/smithy/commit/a739e7ed01bda8ca0c897ecd1c1d7a0c8bbab848", "message": "Address @kstich feedback", "committedDate": "2020-11-16T21:26:28Z", "type": "commit"}]}