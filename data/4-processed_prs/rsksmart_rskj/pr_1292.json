{"pr_number": 1292, "pr_title": "Fix index DB shutdown NPE", "pr_createdAt": "2020-08-12T19:19:56Z", "pr_url": "https://github.com/rsksmart/rskj/pull/1292", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE3Mzc5Ng==", "url": "https://github.com/rsksmart/rskj/pull/1292#discussion_r470173796", "bodyText": "Should we add  trieStore.dispose()?", "author": "ajlopezrsk", "createdAt": "2020-08-13T18:51:15Z", "path": "rskj-core/src/main/java/co/rsk/core/bc/BlockChainFlusher.java", "diffHunk": "@@ -67,6 +67,13 @@ public void start() {\n     public void stop() {\n         emitter.removeListener(listener);\n         flushAll();\n+        closeAll();\n+    }\n+\n+    private void closeAll() {\n+        logger.trace(\"closing blockStore.\");\n+        blockStore.close();\n+        logger.trace(\"blockStore closed.\");", "originalCommit": "8e7bde44a8833e37eecf3204287352e1321c8c9d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE4NTcwNA==", "url": "https://github.com/rsksmart/rskj/pull/1292#discussion_r470185704", "bodyText": "Well... DataSourceWithCache does that job. I wouldn\u2019t analyse that in the scope of this PR.", "author": "patogallaiovlabs", "createdAt": "2020-08-13T19:10:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE3Mzc5Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDYxODc3OQ==", "url": "https://github.com/rsksmart/rskj/pull/1292#discussion_r470618779", "bodyText": "Seems that DataSource.close() is not called on shutdown, and, as a result, LevelDB instances are not getting disposed gracefully.\nIn the examples here they do close db.\nI guess we should investigate this more deeply in scope of this or another task.", "author": "Vovchyk", "createdAt": "2020-08-14T13:20:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE3Mzc5Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDY2MTQ1Ng==", "url": "https://github.com/rsksmart/rskj/pull/1292#discussion_r470661456", "bodyText": "Yep, totally agreed. I will add another task to make a deep analysis.", "author": "patogallaiovlabs", "createdAt": "2020-08-14T14:34:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE3Mzc5Ng=="}], "type": "inlineReview"}, {"oid": "be6323a3bd8fbf96b51d78fe5340e8538696b0bb", "url": "https://github.com/rsksmart/rskj/commit/be6323a3bd8fbf96b51d78fe5340e8538696b0bb", "message": "Fix logback", "committedDate": "2020-08-19T14:49:10Z", "type": "forcePushed"}, {"oid": "ca0909f6e23a69c8b537318fecfcf7ca4383b99e", "url": "https://github.com/rsksmart/rskj/commit/ca0909f6e23a69c8b537318fecfcf7ca4383b99e", "message": "Fix logback", "committedDate": "2020-08-27T15:48:00Z", "type": "forcePushed"}, {"oid": "fea70b842961ceb43f6268be5d46336f8e4e6697", "url": "https://github.com/rsksmart/rskj/commit/fea70b842961ceb43f6268be5d46336f8e4e6697", "message": "Fix index DB shutdown issue", "committedDate": "2020-09-03T20:28:07Z", "type": "commit"}, {"oid": "352e9331e9ee794f3b20587b167f54a4e23436b5", "url": "https://github.com/rsksmart/rskj/commit/352e9331e9ee794f3b20587b167f54a4e23436b5", "message": "Fix logback", "committedDate": "2020-09-03T20:28:07Z", "type": "commit"}, {"oid": "352e9331e9ee794f3b20587b167f54a4e23436b5", "url": "https://github.com/rsksmart/rskj/commit/352e9331e9ee794f3b20587b167f54a4e23436b5", "message": "Fix logback", "committedDate": "2020-09-03T20:28:07Z", "type": "forcePushed"}]}