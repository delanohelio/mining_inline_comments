{"pr_number": 1338, "pr_title": "Add new data of (Fast Bridge Federation P2SH, Derivation Arguments ha\u2026", "pr_createdAt": "2020-10-13T19:07:43Z", "pr_url": "https://github.com/rsksmart/rskj/pull/1338", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDIzMDg4OA==", "url": "https://github.com/rsksmart/rskj/pull/1338#discussion_r504230888", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            public class FastBridgeFederationP2SH {\n          \n          \n            \n                private byte[] fastBridgeFederationP2SH;\n          \n          \n            \n                private byte[] federationP2SH;\n          \n          \n            \n            public class FastBridgeFederationInformation {\n          \n          \n            \n                private byte[] fastBridgeFederationScriptHash;\n          \n          \n            \n                private byte[] federationScriptHash;", "author": "josedahlquist", "createdAt": "2020-10-13T20:18:22Z", "path": "rskj-core/src/main/java/co/rsk/peg/fastBridge/FastBridgeFederationP2SH.java", "diffHunk": "@@ -0,0 +1,21 @@\n+package co.rsk.peg.fastBridge;\n+\n+import co.rsk.bitcoinj.core.Sha256Hash;\n+\n+public class FastBridgeFederationP2SH {\n+    private byte[] fastBridgeFederationP2SH;\n+    private byte[] federationP2SH;", "originalCommit": "dc5f76e0985be0bf4691d019bde315e66409f7c1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "93ef7625dc3ac4fe6243be7c8527a6fad66a603f", "url": "https://github.com/rsksmart/rskj/commit/93ef7625dc3ac4fe6243be7c8527a6fad66a603f", "message": "Add new data of  (Fast Bridge Federation P2SH, Derivation Arguments hash, Federation P2SH) in StorageProvider.\n\nSave the data of (Fast Bridge Federation P2SH, Derivation Arguments hash, Federation P2SH) in Storage Provider\nReturns an object whitch included the info of (Fast Bridge Federation P2SH, Federation P2SH) when a Derivation Arguments hash is given.", "committedDate": "2020-10-15T15:57:10Z", "type": "forcePushed"}, {"oid": "4944a2f2e10e46eea3cbb064271530d900a95515", "url": "https://github.com/rsksmart/rskj/commit/4944a2f2e10e46eea3cbb064271530d900a95515", "message": "Add new data of  (Fast Bridge Federation P2SH, Derivation Arguments hash, Federation P2SH) in StorageProvider.\n\nSave the data of (Fast Bridge Federation P2SH, Derivation Arguments hash, Federation P2SH) in Storage Provider\nReturns an object whitch included the info of (Fast Bridge Federation P2SH, Federation P2SH) when a Derivation Arguments hash is given.", "committedDate": "2020-10-15T17:44:39Z", "type": "forcePushed"}, {"oid": "216a81858332343552e49147d02872169d5451cc", "url": "https://github.com/rsksmart/rskj/commit/216a81858332343552e49147d02872169d5451cc", "message": "Add new data of  (Fast Bridge Federation P2SH, Derivation Arguments hash, Federation P2SH) in StorageProvider.\n\nSave the data of (Fast Bridge Federation P2SH, Derivation Arguments hash, Federation P2SH) in Storage Provider\nReturns an object whitch included the info of (Fast Bridge Federation P2SH, Federation P2SH) when a Derivation Arguments hash is given.", "committedDate": "2020-10-15T19:16:29Z", "type": "forcePushed"}, {"oid": "98f82286a4a135d8fc6e2cfaea6cf02acc1d12e5", "url": "https://github.com/rsksmart/rskj/commit/98f82286a4a135d8fc6e2cfaea6cf02acc1d12e5", "message": "Add new data of  (Fast Bridge Federation P2SH, Derivation Arguments hash, Federation P2SH) in StorageProvider.\n\nSave the data of (Fast Bridge Federation P2SH, Derivation Arguments hash, Federation P2SH) in Storage Provider\nReturns an object whitch included the info of (Fast Bridge Federation P2SH, Federation P2SH) when a Derivation Arguments hash is given.", "committedDate": "2020-10-16T14:54:46Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTg1OTMwOQ==", "url": "https://github.com/rsksmart/rskj/pull/1338#discussion_r505859309", "bodyText": "maybe throw an exception?", "author": "josedahlquist", "createdAt": "2020-10-15T21:16:37Z", "path": "rskj-core/src/main/java/co/rsk/peg/BridgeSerializationUtils.java", "diffHunk": "@@ -743,6 +744,34 @@ public static CoinbaseInformation deserializeCoinbaseInformation(byte[] data) {\n         return RLP.encodeList(rlpElements);\n     }\n \n+    public static FastBridgeFederationInformation deserializeFederationBridge(byte[] data) {\n+        if ((data == null) || (data.length == 0)) {\n+            return null;", "originalCommit": "216a81858332343552e49147d02872169d5451cc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTg2MDAyMg==", "url": "https://github.com/rsksmart/rskj/pull/1338#discussion_r505860022", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public static byte[] serializeFederationBridge(FastBridgeFederationInformation fastBridgeFederationP2SH) {\n          \n          \n            \n                public static byte[] serializeFastBridgeInformation(FastBridgeFederationInformation fastBridgeFederationInformation) {", "author": "josedahlquist", "createdAt": "2020-10-15T21:17:31Z", "path": "rskj-core/src/main/java/co/rsk/peg/BridgeSerializationUtils.java", "diffHunk": "@@ -743,6 +744,34 @@ public static CoinbaseInformation deserializeCoinbaseInformation(byte[] data) {\n         return RLP.encodeList(rlpElements);\n     }\n \n+    public static FastBridgeFederationInformation deserializeFederationBridge(byte[] data) {\n+        if ((data == null) || (data.length == 0)) {\n+            return null;\n+        }\n+\n+        RLPList rlpList = (RLPList)RLP.decode2(data).get(0);\n+\n+        if (rlpList.size() != 2) {\n+            throw new RuntimeException(String.format(\"Invalid serialized Federation Bridge: expected 2 value but got %n\", rlpList.size()));\n+        }\n+\n+        byte[] fastBridgeFederationP2SH = rlpList.get(0).getRLPData();\n+        byte[] federationP2SH = rlpList.get(1).getRLPData();\n+\n+        return new FastBridgeFederationInformation(fastBridgeFederationP2SH, federationP2SH);\n+    }\n+\n+    public static byte[] serializeFederationBridge(FastBridgeFederationInformation fastBridgeFederationP2SH) {", "originalCommit": "216a81858332343552e49147d02872169d5451cc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTg2MTEyNg==", "url": "https://github.com/rsksmart/rskj/pull/1338#discussion_r505861126", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    FastBridgeFederationInformation fastBridgeFedP2SH = this.safeGetFromRepository(\n          \n          \n            \n                            getStorageKeyForfastBridgeFederationInformation(derivationArgsHash),\n          \n          \n            \n                            BridgeSerializationUtils::deserializeFederationBridge\n          \n          \n            \n                    );\n          \n          \n            \n                    if (fastBridgeFedP2SH == null) {\n          \n          \n            \n                        return Optional.empty();\n          \n          \n            \n                    }\n          \n          \n            \n            \n          \n          \n            \n                    return Optional.of(fastBridgeFedP2SH);\n          \n          \n            \n                    FastBridgeFederationInformation fastBridgeFederationInformation = this.safeGetFromRepository(\n          \n          \n            \n                            getStorageKeyForfastBridgeFederationInformation(derivationArgsHash),\n          \n          \n            \n                            BridgeSerializationUtils::deserializeFederationBridge\n          \n          \n            \n                    );\n          \n          \n            \n                    if (fastBridgeFederationInformation == null) {\n          \n          \n            \n                        return Optional.empty();\n          \n          \n            \n                    }\n          \n          \n            \n            \n          \n          \n            \n                    return Optional.of(fastBridgeFederationInformation);", "author": "josedahlquist", "createdAt": "2020-10-15T21:18:58Z", "path": "rskj-core/src/main/java/co/rsk/peg/BridgeStorageProvider.java", "diffHunk": "@@ -594,39 +596,79 @@ private void saveCoinbaseInformations() {\n             safeSaveToRepository(getStorageKeyForCoinbaseInformation(blockHash), data, BridgeSerializationUtils::serializeCoinbaseInformation));\n     }\n \n-    public byte[] getFastBridgeFederationP2SH(Sha256Hash derivationArgsHash) {\n+    public Optional<byte[]> getFastBridgeFederationScriptHash(Sha256Hash derivationArgsHash) {\n         if (!activations.isActive(RSKIP176)) {\n-            return null;\n+            return Optional.empty();\n         }\n \n         byte[] fastBridgeFedP2SH = repository.getStorageBytes(contractAddress, getStorageKeyForDerivationP2SHByHash(derivationArgsHash));\n \n-        return fastBridgeFedP2SH;\n+        if (fastBridgeFedP2SH == null ) {\n+            return Optional.empty();\n+        }\n+\n+        return Optional.of(fastBridgeFedP2SH);\n     }\n \n-    public void setDerivationArgumentsP2SH(Sha256Hash derivationArgsHash, byte[] fastBridgeFedP2SH) {\n+    public void setDerivationArgumentsScriptHash(Sha256Hash derivationArgsHash, byte[] fastBridgeFedP2SH) {\n         if (activations.isActive(RSKIP176)) {\n-            if (derivationArgumentsP2SHToSave == null) {\n-                derivationArgumentsP2SHToSave = new HashMap<>();\n+            if (fastBridgeDerivationArgumentsScriptHashToSave == null) {\n+                fastBridgeDerivationArgumentsScriptHashToSave = new HashMap<>();\n             }\n-            derivationArgumentsP2SHToSave.put(derivationArgsHash, fastBridgeFedP2SH);\n+            fastBridgeDerivationArgumentsScriptHashToSave.put(derivationArgsHash, fastBridgeFedP2SH);\n         }\n     }\n \n-    protected Map<Sha256Hash, byte[]> getDerivationArgumentsP2SHToSave() {\n-        return derivationArgumentsP2SHToSave;\n+    private void saveDerivationArgumentsScriptHash() {\n+        if (fastBridgeDerivationArgumentsScriptHashToSave == null) {\n+            return;\n+        }\n+\n+        fastBridgeDerivationArgumentsScriptHashToSave.forEach((derivationArgsHash, fastBridgeFedP2SH) ->\n+                repository.addStorageBytes(contractAddress, getStorageKeyForDerivationP2SHByHash(derivationArgsHash), fastBridgeFedP2SH)\n+        );\n     }\n \n-    private void saveDerivationArgumentsP2SH() {\n-        if (derivationArgumentsP2SHToSave == null) {\n+    public Optional<FastBridgeFederationInformation> getFastBridgeFederationInformation(Sha256Hash derivationArgsHash) {\n+        if (!activations.isActive(RSKIP176)) {\n+            return Optional.empty();\n+        }\n+\n+        FastBridgeFederationInformation fastBridgeFedP2SH = this.safeGetFromRepository(\n+                getStorageKeyForfastBridgeFederationInformation(derivationArgsHash),\n+                BridgeSerializationUtils::deserializeFederationBridge\n+        );\n+        if (fastBridgeFedP2SH == null) {\n+            return Optional.empty();\n+        }\n+\n+        return Optional.of(fastBridgeFedP2SH);", "originalCommit": "216a81858332343552e49147d02872169d5451cc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTg2MTM4NA==", "url": "https://github.com/rsksmart/rskj/pull/1338#discussion_r505861384", "bodyText": "same comment regarding naming", "author": "josedahlquist", "createdAt": "2020-10-15T21:19:18Z", "path": "rskj-core/src/main/java/co/rsk/peg/BridgeStorageProvider.java", "diffHunk": "@@ -594,39 +596,79 @@ private void saveCoinbaseInformations() {\n             safeSaveToRepository(getStorageKeyForCoinbaseInformation(blockHash), data, BridgeSerializationUtils::serializeCoinbaseInformation));\n     }\n \n-    public byte[] getFastBridgeFederationP2SH(Sha256Hash derivationArgsHash) {\n+    public Optional<byte[]> getFastBridgeFederationScriptHash(Sha256Hash derivationArgsHash) {\n         if (!activations.isActive(RSKIP176)) {\n-            return null;\n+            return Optional.empty();\n         }\n \n         byte[] fastBridgeFedP2SH = repository.getStorageBytes(contractAddress, getStorageKeyForDerivationP2SHByHash(derivationArgsHash));\n \n-        return fastBridgeFedP2SH;\n+        if (fastBridgeFedP2SH == null ) {\n+            return Optional.empty();\n+        }\n+\n+        return Optional.of(fastBridgeFedP2SH);\n     }\n \n-    public void setDerivationArgumentsP2SH(Sha256Hash derivationArgsHash, byte[] fastBridgeFedP2SH) {\n+    public void setDerivationArgumentsScriptHash(Sha256Hash derivationArgsHash, byte[] fastBridgeFedP2SH) {\n         if (activations.isActive(RSKIP176)) {\n-            if (derivationArgumentsP2SHToSave == null) {\n-                derivationArgumentsP2SHToSave = new HashMap<>();\n+            if (fastBridgeDerivationArgumentsScriptHashToSave == null) {\n+                fastBridgeDerivationArgumentsScriptHashToSave = new HashMap<>();\n             }\n-            derivationArgumentsP2SHToSave.put(derivationArgsHash, fastBridgeFedP2SH);\n+            fastBridgeDerivationArgumentsScriptHashToSave.put(derivationArgsHash, fastBridgeFedP2SH);\n         }\n     }\n \n-    protected Map<Sha256Hash, byte[]> getDerivationArgumentsP2SHToSave() {\n-        return derivationArgumentsP2SHToSave;\n+    private void saveDerivationArgumentsScriptHash() {\n+        if (fastBridgeDerivationArgumentsScriptHashToSave == null) {\n+            return;\n+        }\n+\n+        fastBridgeDerivationArgumentsScriptHashToSave.forEach((derivationArgsHash, fastBridgeFedP2SH) ->\n+                repository.addStorageBytes(contractAddress, getStorageKeyForDerivationP2SHByHash(derivationArgsHash), fastBridgeFedP2SH)\n+        );\n     }\n \n-    private void saveDerivationArgumentsP2SH() {\n-        if (derivationArgumentsP2SHToSave == null) {\n+    public Optional<FastBridgeFederationInformation> getFastBridgeFederationInformation(Sha256Hash derivationArgsHash) {\n+        if (!activations.isActive(RSKIP176)) {\n+            return Optional.empty();\n+        }\n+\n+        FastBridgeFederationInformation fastBridgeFedP2SH = this.safeGetFromRepository(\n+                getStorageKeyForfastBridgeFederationInformation(derivationArgsHash),\n+                BridgeSerializationUtils::deserializeFederationBridge\n+        );\n+        if (fastBridgeFedP2SH == null) {\n+            return Optional.empty();\n+        }\n+\n+        return Optional.of(fastBridgeFedP2SH);\n+    }\n+\n+    public void setFastBridgeFederationInformation(Sha256Hash derivationArgsHash, FastBridgeFederationInformation fastBridgeFedP2SH) {", "originalCommit": "216a81858332343552e49147d02872169d5451cc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTg2MTk3Nw==", "url": "https://github.com/rsksmart/rskj/pull/1338#discussion_r505861977", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public FastBridgeFederationInformation(byte[] fastBridgeFederationP2SH, byte[] federationP2SH) {\n          \n          \n            \n                public FastBridgeFederationInformation(byte[] fastBridgeFederationScriptHash, byte[] federationScriptHash) {", "author": "josedahlquist", "createdAt": "2020-10-15T21:20:03Z", "path": "rskj-core/src/main/java/co/rsk/peg/fastbridge/FastBridgeFederationInformation.java", "diffHunk": "@@ -0,0 +1,19 @@\n+package co.rsk.peg.fastbridge;\n+\n+public class FastBridgeFederationInformation {\n+    private byte[] fastBridgeFederationScriptHash;\n+    private byte[] federationScriptHash;\n+\n+    public FastBridgeFederationInformation(byte[] fastBridgeFederationP2SH, byte[] federationP2SH) {", "originalCommit": "216a81858332343552e49147d02872169d5451cc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTg2MzE0Ng==", "url": "https://github.com/rsksmart/rskj/pull/1338#discussion_r505863146", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public static FastBridgeFederationInformation deserializeFederationBridge(byte[] data) {\n          \n          \n            \n                public static FastBridgeFederationInformation deserializeFastBridgeInformation(byte[] data) {", "author": "josedahlquist", "createdAt": "2020-10-15T21:21:28Z", "path": "rskj-core/src/main/java/co/rsk/peg/BridgeSerializationUtils.java", "diffHunk": "@@ -743,6 +744,34 @@ public static CoinbaseInformation deserializeCoinbaseInformation(byte[] data) {\n         return RLP.encodeList(rlpElements);\n     }\n \n+    public static FastBridgeFederationInformation deserializeFederationBridge(byte[] data) {", "originalCommit": "216a81858332343552e49147d02872169d5451cc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f678e85fa843af87ab66915b130e4a563a2d9e87", "url": "https://github.com/rsksmart/rskj/commit/f678e85fa843af87ab66915b130e4a563a2d9e87", "message": "Add new data of  (Fast Bridge Federation P2SH, Derivation Arguments hash, Federation P2SH) in StorageProvider.\n\nSave the data of (Fast Bridge Federation P2SH, Derivation Arguments hash, Federation P2SH) in Storage Provider\nReturns an object whitch included the info of (Fast Bridge Federation P2SH, Federation P2SH) when a Derivation Arguments hash is given.", "committedDate": "2020-10-16T19:25:55Z", "type": "forcePushed"}, {"oid": "7f1511635581e6c4713a2e6e0a0ca2de9075ab53", "url": "https://github.com/rsksmart/rskj/commit/7f1511635581e6c4713a2e6e0a0ca2de9075ab53", "message": "Add new data of  (Fast Bridge Federation P2SH, Derivation Arguments hash, Federation P2SH) in StorageProvider.\n\nSave the data of (Fast Bridge Federation P2SH, Derivation Arguments hash, Federation P2SH) in Storage Provider\nReturns an object whitch included the info of (Fast Bridge Federation P2SH, Federation P2SH) when a Derivation Arguments hash is given.", "committedDate": "2020-10-18T22:25:51Z", "type": "forcePushed"}, {"oid": "32f677341fd7c06e7f39e33d60d3683ee2ad6711", "url": "https://github.com/rsksmart/rskj/commit/32f677341fd7c06e7f39e33d60d3683ee2ad6711", "message": "Add new data of  (Fast Bridge Federation P2SH, Derivation Arguments hash, Federation P2SH) in StorageProvider.\n\nSave the data of (Fast Bridge Federation P2SH, Derivation Arguments hash, Federation P2SH) in Storage Provider\nReturns an object whitch included the info of (Fast Bridge Federation P2SH, Federation P2SH) when a Derivation Arguments hash is given.", "committedDate": "2020-10-18T22:47:24Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzcxOTc5MA==", "url": "https://github.com/rsksmart/rskj/pull/1338#discussion_r507719790", "bodyText": "should call deserializeFastBridgeInformation method", "author": "guidohernan93", "createdAt": "2020-10-19T12:50:47Z", "path": "rskj-core/src/main/java/co/rsk/peg/BridgeStorageProvider.java", "diffHunk": "@@ -626,6 +630,49 @@ private void saveDerivationArgumentsScriptHash() {\n         );\n     }\n \n+    public Optional<FastBridgeFederationInformation> getFastBridgeFederationInformation(byte[] fastBridgeFederationP2SH) {\n+        if (!activations.isActive(RSKIP176)) {\n+            return Optional.empty();\n+        }\n+\n+        if (fastBridgeFederationP2SH == null || fastBridgeFederationP2SH.length == 0) {\n+            return Optional.empty();\n+        }\n+\n+        FastBridgeFederationInformation fastBridgeFederationInformation = this.safeGetFromRepository(\n+                getStorageKeyForfastBridgeFederationInformation(fastBridgeFederationP2SH),\n+                BridgeSerializationUtils::deserializeFederationBridge", "originalCommit": "32f677341fd7c06e7f39e33d60d3683ee2ad6711", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "6415b7ee922668b36b074f978b88f6e220584311", "url": "https://github.com/rsksmart/rskj/commit/6415b7ee922668b36b074f978b88f6e220584311", "message": "Add new data of  (Fast Bridge Federation P2SH, Derivation Arguments hash, Federation P2SH) in StorageProvider.\n\nSave the data of (Fast Bridge Federation P2SH, Derivation Arguments hash, Federation P2SH) in Storage Provider\nReturns an object whitch included the info of (Fast Bridge Federation P2SH, Federation P2SH) when a Derivation Arguments hash is given.", "committedDate": "2020-10-19T13:46:50Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzgyMzIwMQ==", "url": "https://github.com/rsksmart/rskj/pull/1338#discussion_r507823201", "bodyText": "%n should be %d I think", "author": "guidohernan93", "createdAt": "2020-10-19T14:59:07Z", "path": "rskj-core/src/main/java/co/rsk/peg/BridgeSerializationUtils.java", "diffHunk": "@@ -743,6 +744,33 @@ public static CoinbaseInformation deserializeCoinbaseInformation(byte[] data) {\n         return RLP.encodeList(rlpElements);\n     }\n \n+    public static FastBridgeFederationInformation deserializeFastBridgeInformation(byte[] data) {\n+        if ((data == null) || (data.length == 0)) {\n+            throw new RuntimeException(\"Invalid serialized Fast Bridge Federation: null data or no data to deserialize\");\n+        }\n+\n+        RLPList rlpList = (RLPList)RLP.decode2(data).get(0);\n+\n+        if (rlpList.size() != 2) {\n+            throw new RuntimeException(String.format(\"Invalid serialized Fast Bridge Federation: expected 2 value but got %n\", rlpList.size()));", "originalCommit": "6415b7ee922668b36b074f978b88f6e220584311", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzgyMzk0OA==", "url": "https://github.com/rsksmart/rskj/pull/1338#discussion_r507823948", "bodyText": "Should we check if rlpList is null?", "author": "guidohernan93", "createdAt": "2020-10-19T14:59:58Z", "path": "rskj-core/src/main/java/co/rsk/peg/BridgeSerializationUtils.java", "diffHunk": "@@ -743,6 +744,33 @@ public static CoinbaseInformation deserializeCoinbaseInformation(byte[] data) {\n         return RLP.encodeList(rlpElements);\n     }\n \n+    public static FastBridgeFederationInformation deserializeFastBridgeInformation(byte[] data) {\n+        if ((data == null) || (data.length == 0)) {\n+            throw new RuntimeException(\"Invalid serialized Fast Bridge Federation: null data or no data to deserialize\");\n+        }\n+\n+        RLPList rlpList = (RLPList)RLP.decode2(data).get(0);", "originalCommit": "6415b7ee922668b36b074f978b88f6e220584311", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzgyODExMA==", "url": "https://github.com/rsksmart/rskj/pull/1338#discussion_r507828110", "bodyText": "decode2 function can returns empty list or a list populates with values. If data is null, then return empty list.", "author": "pamgonzalez", "createdAt": "2020-10-19T15:05:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzgyMzk0OA=="}], "type": "inlineReview"}, {"oid": "278d52c8e237960e1fc9b573ed2f54a120cb5c98", "url": "https://github.com/rsksmart/rskj/commit/278d52c8e237960e1fc9b573ed2f54a120cb5c98", "message": "Add new data of  (Fast Bridge Federation P2SH, Derivation Arguments hash, Federation P2SH) in StorageProvider.\n\nSave the data of (Fast Bridge Federation P2SH, Derivation Arguments hash, Federation P2SH) in Storage Provider\nReturns an object whitch included the info of (Fast Bridge Federation P2SH, Federation P2SH) when a Derivation Arguments hash is given.", "committedDate": "2020-10-19T15:31:32Z", "type": "commit"}, {"oid": "278d52c8e237960e1fc9b573ed2f54a120cb5c98", "url": "https://github.com/rsksmart/rskj/commit/278d52c8e237960e1fc9b573ed2f54a120cb5c98", "message": "Add new data of  (Fast Bridge Federation P2SH, Derivation Arguments hash, Federation P2SH) in StorageProvider.\n\nSave the data of (Fast Bridge Federation P2SH, Derivation Arguments hash, Federation P2SH) in Storage Provider\nReturns an object whitch included the info of (Fast Bridge Federation P2SH, Federation P2SH) when a Derivation Arguments hash is given.", "committedDate": "2020-10-19T15:31:32Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODc1MzIwMA==", "url": "https://github.com/rsksmart/rskj/pull/1338#discussion_r508753200", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public void setFastBridgeFederationInformation(byte[] fastBridgeScriptHash, FastBridgeFederationInformation fastBridgeFedP2SH) {\n          \n          \n            \n                public void setFastBridgeFederationInformation(byte[] fastBridgeScriptHash, FastBridgeFederationInformation fastBridgeFederationInformation) {", "author": "josedahlquist", "createdAt": "2020-10-20T18:37:07Z", "path": "rskj-core/src/main/java/co/rsk/peg/BridgeStorageProvider.java", "diffHunk": "@@ -626,6 +630,49 @@ private void saveDerivationArgumentsScriptHash() {\n         );\n     }\n \n+    public Optional<FastBridgeFederationInformation> getFastBridgeFederationInformation(byte[] fastBridgeFederationP2SH) {\n+        if (!activations.isActive(RSKIP176)) {\n+            return Optional.empty();\n+        }\n+\n+        if (fastBridgeFederationP2SH == null || fastBridgeFederationP2SH.length == 0) {\n+            return Optional.empty();\n+        }\n+\n+        FastBridgeFederationInformation fastBridgeFederationInformation = this.safeGetFromRepository(\n+                getStorageKeyForfastBridgeFederationInformation(fastBridgeFederationP2SH),\n+                BridgeSerializationUtils::deserializeFastBridgeInformation\n+        );\n+        if (fastBridgeFederationInformation == null) {\n+            return Optional.empty();\n+        }\n+\n+        return Optional.of(fastBridgeFederationInformation);\n+    }\n+\n+    public void setFastBridgeFederationInformation(byte[] fastBridgeScriptHash, FastBridgeFederationInformation fastBridgeFedP2SH) {", "originalCommit": "278d52c8e237960e1fc9b573ed2f54a120cb5c98", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}