{"pr_number": 1026, "pr_title": "RDM-9095 - Filter out cross-jurisdiction roles when determining user jurisdictions", "pr_createdAt": "2020-07-22T15:10:54Z", "pr_url": "https://github.com/hmcts/ccd-data-store-api/pull/1026", "timeline": [{"oid": "3167744a924f449e3a6d6d72a9735fb34856eaee", "url": "https://github.com/hmcts/ccd-data-store-api/commit/3167744a924f449e3a6d6d72a9735fb34856eaee", "message": "RDM-9095 - Filter out cross-jurisdictional roles when determining user jurisdictions", "committedDate": "2020-07-22T15:09:48Z", "type": "commit"}, {"oid": "9bf95d491ad3801a3eb6f883da43ba3a69e0b46d", "url": "https://github.com/hmcts/ccd-data-store-api/commit/9bf95d491ad3801a3eb6f883da43ba3a69e0b46d", "message": "Typos/simplification", "committedDate": "2020-07-22T16:05:41Z", "type": "commit"}, {"oid": "db454cb6e4b6f820fd3cba2707a66ba8499157d1", "url": "https://github.com/hmcts/ccd-data-store-api/commit/db454cb6e4b6f820fd3cba2707a66ba8499157d1", "message": "Typo", "committedDate": "2020-07-22T16:09:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTI5NzU4MA==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1026#discussion_r459297580", "bodyText": "I was thinking whether we can take this opportunity to also make the method a bit more precise.\nWith the current implementation any role of the form part1-part2-....partN will be considered a \"jurisidictional\" role for a jurisdiction \"part2\".\nIn reality this (not written) rule applies only for caseworkers (as far as I know!).\nSo was wondering if it would be better applying this method only to caseworkers roles (maybe using a regex?), and rename it to getCaseworkerUserRolesJurisdictions?", "author": "mario-paniccia", "createdAt": "2020-07-23T08:40:13Z", "path": "src/main/java/uk/gov/hmcts/ccd/data/user/DefaultUserRepository.java", "diffHunk": "@@ -179,7 +180,9 @@ public String getUserId() {\n     public List<String> getUserRolesJurisdictions() {\n         String[] roles = this.getUserDetails().getRoles();\n \n-        return Arrays.stream(roles).map(role ->  role.split(\"-\"))\n+        return Arrays.stream(roles)", "originalCommit": "db454cb6e4b6f820fd3cba2707a66ba8499157d1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "6c3de2e6408a58adefba2226c40b14ebef0853c5", "url": "https://github.com/hmcts/ccd-data-store-api/commit/6c3de2e6408a58adefba2226c40b14ebef0853c5", "message": "Review comments", "committedDate": "2020-07-23T15:10:10Z", "type": "commit"}, {"oid": "64ab73ff0f4eac703c06ed6db2545537c743e652", "url": "https://github.com/hmcts/ccd-data-store-api/commit/64ab73ff0f4eac703c06ed6db2545537c743e652", "message": "Merge branch 'develop' into RDM-9095", "committedDate": "2020-07-23T16:19:41Z", "type": "commit"}, {"oid": "a7cd401aee0f52791c8fe83dcf0f51048ba7f421", "url": "https://github.com/hmcts/ccd-data-store-api/commit/a7cd401aee0f52791c8fe83dcf0f51048ba7f421", "message": "Cleanup", "committedDate": "2020-07-23T17:37:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTk2MTcyMQ==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1026#discussion_r459961721", "bodyText": "I'd suggest we make this a public method", "author": "mario-paniccia", "createdAt": "2020-07-24T09:59:49Z", "path": "src/main/java/uk/gov/hmcts/ccd/data/user/DefaultUserRepository.java", "diffHunk": "@@ -234,4 +223,12 @@ private IdamUser toIdamUser(UserInfo userInfo) {\n         return idamUser;\n     }\n \n+    private boolean isCrossJurisdictionRole(String role) {\n+        return applicationParams.getCcdAccessControlCrossJurisdictionRoles().contains(role);\n+    }", "originalCommit": "a7cd401aee0f52791c8fe83dcf0f51048ba7f421", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTk2NTk1MA==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1026#discussion_r459965950", "bodyText": "I appreciate the intent to make this configurable.\nBut I think the rules around the format of the caseworker IDAM role format are very unlikely to change now. I doubt we'll ever need to use a delimiter different that - and a jur position different than 1. Also if that was the case CCD would break in many other places already. We can therefore simplify things a bit removing these 2 config options if we wanted.", "author": "mario-paniccia", "createdAt": "2020-07-24T10:09:48Z", "path": "src/main/resources/application.properties", "diffHunk": "@@ -179,3 +179,6 @@ ccd.conditional-apis.case-assigned-users-and-roles.enabled=${CCD_CONDITIONAL_API\n # (Note SecurityLoggingFilter logs at debug)\n security.logging.filter.path.regex=${DATA_STORE_SECURITY_LOGGING_FILTER_PATH_REGEX:.*}\n \n+caseworker.role.regex=${CASEWORKER_ROLE_REGEX:caseworker.+}\n+caseworker.role.delimiter=${CASEWORKER_ROLE_DELIMITER:-}\n+caseworker.role.jurisdiction.element.index=${CASEWORKER_ROLE_JURISDICTION_ELEMENT_INDEX:1}", "originalCommit": "a7cd401aee0f52791c8fe83dcf0f51048ba7f421", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTk3MDA4OA==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1026#discussion_r459970088", "bodyText": "or, to simplify, couldn't we combine these 3 properties into one property called:\nccd.access-control.caseworker-jurisdiction.regex-group:caseworker-(.+)-.*  (unverified, probably needs refinement)\n?", "author": "mario-paniccia", "createdAt": "2020-07-24T10:20:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTk2NTk1MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTk2ODM1OA==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1026#discussion_r459968358", "bodyText": "can you add these under a new section with comment:\n#ccd access control\nand prefix them with:\nccd.access-control\nThen move the already existing\n\n  \n    \n      ccd-data-store-api/src/main/resources/application.properties\n    \n    \n         Line 173\n      in\n      b90fc31\n    \n    \n    \n    \n\n        \n          \n           ccd.access-control.cross-jurisdictional-roles=${DATA_STORE_CROSS_JURISDICTIONAL_ROLES:caseworker-caa} \n        \n    \n  \n\n\nthere as well", "author": "mario-paniccia", "createdAt": "2020-07-24T10:15:47Z", "path": "src/main/resources/application.properties", "diffHunk": "@@ -179,3 +179,6 @@ ccd.conditional-apis.case-assigned-users-and-roles.enabled=${CCD_CONDITIONAL_API\n # (Note SecurityLoggingFilter logs at debug)\n security.logging.filter.path.regex=${DATA_STORE_SECURITY_LOGGING_FILTER_PATH_REGEX:.*}\n \n+caseworker.role.regex=${CASEWORKER_ROLE_REGEX:caseworker.+}", "originalCommit": "a7cd401aee0f52791c8fe83dcf0f51048ba7f421", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "1d20a81407eeeb176f5a99008e1e982e625147ba", "url": "https://github.com/hmcts/ccd-data-store-api/commit/1d20a81407eeeb176f5a99008e1e982e625147ba", "message": "RDM-9095 - Review comments", "committedDate": "2020-07-24T10:48:37Z", "type": "commit"}, {"oid": "f438b691438a200afb61c5d0c07edbb10a0a9e1d", "url": "https://github.com/hmcts/ccd-data-store-api/commit/f438b691438a200afb61c5d0c07edbb10a0a9e1d", "message": "improved readability", "committedDate": "2020-07-24T11:48:49Z", "type": "commit"}, {"oid": "0f58682b9856dafbfd1ece7e0a2a68ca0a403254", "url": "https://github.com/hmcts/ccd-data-store-api/commit/0f58682b9856dafbfd1ece7e0a2a68ca0a403254", "message": "improved readability", "committedDate": "2020-07-24T11:50:11Z", "type": "commit"}, {"oid": "75984952636fb14d4f9d3a417207c949a602e214", "url": "https://github.com/hmcts/ccd-data-store-api/commit/75984952636fb14d4f9d3a417207c949a602e214", "message": "Merge branch 'develop' into RDM-9095", "committedDate": "2020-08-07T08:22:25Z", "type": "commit"}, {"oid": "b971908910aa11f8d2c542c3eefce618db871e11", "url": "https://github.com/hmcts/ccd-data-store-api/commit/b971908910aa11f8d2c542c3eefce618db871e11", "message": "Update method names from merged changes", "committedDate": "2020-08-07T08:26:39Z", "type": "commit"}, {"oid": "6578947c4d2fae2e120b7606a70a85a00b2f6f95", "url": "https://github.com/hmcts/ccd-data-store-api/commit/6578947c4d2fae2e120b7606a70a85a00b2f6f95", "message": "Merge branch 'develop' into RDM-9095", "committedDate": "2020-08-14T11:24:00Z", "type": "commit"}]}