{"pr_number": 989, "pr_title": "RDM-8667 FTA", "pr_createdAt": "2020-06-22T13:26:38Z", "pr_url": "https://github.com/hmcts/ccd-data-store-api/pull/989", "timeline": [{"oid": "d1ff7946fe729d50a54aec3136be52f88cbfbcb8", "url": "https://github.com/hmcts/ccd-data-store-api/commit/d1ff7946fe729d50a54aec3136be52f88cbfbcb8", "message": "Tests for Organistaion Policy", "committedDate": "2020-07-08T11:05:46Z", "type": "commit"}, {"oid": "28cf497f57c6dfb84fe1c71bbc340003afc7ab0d", "url": "https://github.com/hmcts/ccd-data-store-api/commit/28cf497f57c6dfb84fe1c71bbc340003afc7ab0d", "message": "simple improvements", "committedDate": "2020-07-08T11:05:46Z", "type": "commit"}, {"oid": "3ad4d418b61af4772040c476d9bcb6a4f732d7a1", "url": "https://github.com/hmcts/ccd-data-store-api/commit/3ad4d418b61af4772040c476d9bcb6a4f732d7a1", "message": "format test data files", "committedDate": "2020-07-08T11:05:46Z", "type": "commit"}, {"oid": "77e8ec45682e9691b13c3feae43b8817bc6934a3", "url": "https://github.com/hmcts/ccd-data-store-api/commit/77e8ec45682e9691b13c3feae43b8817bc6934a3", "message": "fix operation name", "committedDate": "2020-07-08T11:05:46Z", "type": "commit"}, {"oid": "0af1950ab0d88f2ef00d9e36a3fe4bfc6defd717", "url": "https://github.com/hmcts/ccd-data-store-api/commit/0af1950ab0d88f2ef00d9e36a3fe4bfc6defd717", "message": "Updated Befta version", "committedDate": "2020-07-08T11:07:00Z", "type": "commit"}, {"oid": "e2b59650f6848d4fd690c1fae9150451fbbff640", "url": "https://github.com/hmcts/ccd-data-store-api/commit/e2b59650f6848d4fd690c1fae9150451fbbff640", "message": "Updated befta version", "committedDate": "2020-07-08T11:09:24Z", "type": "commit"}, {"oid": "1e6db9552da5ec471dfd0b3807ba62e96ca04a74", "url": "https://github.com/hmcts/ccd-data-store-api/commit/1e6db9552da5ec471dfd0b3807ba62e96ca04a74", "message": "Updated test data", "committedDate": "2020-07-08T11:09:24Z", "type": "commit"}, {"oid": "341744e0f202cb72fbe2abb4ea9710e0d1add093", "url": "https://github.com/hmcts/ccd-data-store-api/commit/341744e0f202cb72fbe2abb4ea9710e0d1add093", "message": "Fix token", "committedDate": "2020-07-08T11:09:24Z", "type": "commit"}, {"oid": "e2b3e80d1cf6117a0ac6c69222837c7146175838", "url": "https://github.com/hmcts/ccd-data-store-api/commit/e2b3e80d1cf6117a0ac6c69222837c7146175838", "message": "Revert change to token retrieval", "committedDate": "2020-07-08T11:09:24Z", "type": "commit"}, {"oid": "ab6e0ccc16c735b2aeb5f42862fb23dfaa705523", "url": "https://github.com/hmcts/ccd-data-store-api/commit/ab6e0ccc16c735b2aeb5f42862fb23dfaa705523", "message": "Renamed files", "committedDate": "2020-07-08T11:37:18Z", "type": "commit"}, {"oid": "ce82fd9c51a97667326157448c928141377f2c76", "url": "https://github.com/hmcts/ccd-data-store-api/commit/ce82fd9c51a97667326157448c928141377f2c76", "message": "Added more scenarios", "committedDate": "2020-07-13T12:02:11Z", "type": "commit"}, {"oid": "ce82fd9c51a97667326157448c928141377f2c76", "url": "https://github.com/hmcts/ccd-data-store-api/commit/ce82fd9c51a97667326157448c928141377f2c76", "message": "Added more scenarios", "committedDate": "2020-07-13T12:02:11Z", "type": "forcePushed"}, {"oid": "8f639f38d82350e5d2352a3229317c96dfed1bf9", "url": "https://github.com/hmcts/ccd-data-store-api/commit/8f639f38d82350e5d2352a3229317c96dfed1bf9", "message": "Use befta version with master def fix", "committedDate": "2020-07-13T14:17:07Z", "type": "commit"}, {"oid": "613dab5ef5d2e934fc04d19153afda859b96161a", "url": "https://github.com/hmcts/ccd-data-store-api/commit/613dab5ef5d2e934fc04d19153afda859b96161a", "message": "Merge branch 'develop' into fta_8667", "committedDate": "2020-07-13T14:18:18Z", "type": "commit"}, {"oid": "ac3db56d052ce1e45cf09c73285a9f7df88c57a1", "url": "https://github.com/hmcts/ccd-data-store-api/commit/ac3db56d052ce1e45cf09c73285a9f7df88c57a1", "message": "Remove feature name", "committedDate": "2020-07-13T22:33:13Z", "type": "commit"}, {"oid": "e801fac79fe90a7fffc3fcd2d6e1ef06d105836e", "url": "https://github.com/hmcts/ccd-data-store-api/commit/e801fac79fe90a7fffc3fcd2d6e1ef06d105836e", "message": "Merge branch 'fta_8667' of github.com:hmcts/ccd-data-store-api into fta_8667", "committedDate": "2020-07-13T22:33:50Z", "type": "commit"}, {"oid": "83e9a63cb04bb38b0d9b5314634c5d1db02ef15d", "url": "https://github.com/hmcts/ccd-data-store-api/commit/83e9a63cb04bb38b0d9b5314634c5d1db02ef15d", "message": "Ignored failing test scenario", "committedDate": "2020-07-14T08:44:51Z", "type": "commit"}, {"oid": "90d12335cd1e1d319a266a068b610e7ef3940ce6", "url": "https://github.com/hmcts/ccd-data-store-api/commit/90d12335cd1e1d319a266a068b610e7ef3940ce6", "message": "Fixed broken json", "committedDate": "2020-07-14T08:50:52Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQwMzU4Mg==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/989#discussion_r454403582", "bodyText": "More ideally, we could probably apply a verification step to get the details of the case just created, using a ste to call a relevant api operation. Not a must, though, for just practical purposes.", "author": "MSancaktutar", "createdAt": "2020-07-14T14:35:24Z", "path": "src/aat/resources/features/F-107/F-107.feature", "diffHunk": "@@ -0,0 +1,53 @@\n+@F-107\n+Feature: F-107: Organisation Policies on Cases\n+\n+    Background: Load test data for the scenario\n+    Given an appropriate test context as detailed in the test data source\n+\n+    @S-925\n+    Scenario: must successfully create a case with a case type containing some OrganisationPolicy fields\n+      Given a user with [an active profile in CCD]\n+      And a successful call [to create a token for case creation] as in [F-107_Case_Data_Create_Token_Creation]\n+      When a request is prepared with appropriate values\n+      And the request [contains some OrganisationPolicy fields with all correct values]\n+      And it is submitted to call the [Submit Case Creation as Caseworker] operation of [CCD Data Store]\n+      Then a positive response is received\n+      And the response has all other details as expected\n+", "originalCommit": "90d12335cd1e1d319a266a068b610e7ef3940ce6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzU1MTQ2Mg==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/989#discussion_r457551462", "bodyText": "\ud83d\udc4d", "author": "Olawale", "createdAt": "2020-07-20T16:47:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQwMzU4Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQwNDY3NQ==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/989#discussion_r454404675", "bodyText": "Repeated Givens", "author": "MSancaktutar", "createdAt": "2020-07-14T14:36:39Z", "path": "src/aat/resources/features/F-107/F-107.feature", "diffHunk": "@@ -0,0 +1,53 @@\n+@F-107\n+Feature: F-107: Organisation Policies on Cases\n+\n+    Background: Load test data for the scenario\n+    Given an appropriate test context as detailed in the test data source\n+\n+    @S-925\n+    Scenario: must successfully create a case with a case type containing some OrganisationPolicy fields\n+      Given a user with [an active profile in CCD]\n+      And a successful call [to create a token for case creation] as in [F-107_Case_Data_Create_Token_Creation]\n+      When a request is prepared with appropriate values\n+      And the request [contains some OrganisationPolicy fields with all correct values]\n+      And it is submitted to call the [Submit Case Creation as Caseworker] operation of [CCD Data Store]\n+      Then a positive response is received\n+      And the response has all other details as expected\n+\n+    @S-927\n+    Scenario: must successfully update OrganisationPolicy fields on a case\n+      Given a user with [an active profile in CCD]\n+      Given a successful call [to create a token for case creation] as in [F-107_Case_Data_Create_Token_Creation]", "originalCommit": "90d12335cd1e1d319a266a068b610e7ef3940ce6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzQ3MTY0OQ==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/989#discussion_r457471649", "bodyText": "Changed the second Given to And.", "author": "Olawale", "createdAt": "2020-07-20T15:04:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQwNDY3NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQwNTc2MA==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/989#discussion_r454405760", "bodyText": "Token creation for subsequent case creation can be skipped in the scenarios, by following a naming convention for the token creation data ids, or (as of ver 3.6.0) by specifying a prerequisite in the test data file of depending call.", "author": "MSancaktutar", "createdAt": "2020-07-14T14:38:06Z", "path": "src/aat/resources/features/F-107/F-107.feature", "diffHunk": "@@ -0,0 +1,53 @@\n+@F-107\n+Feature: F-107: Organisation Policies on Cases\n+\n+    Background: Load test data for the scenario\n+    Given an appropriate test context as detailed in the test data source\n+\n+    @S-925\n+    Scenario: must successfully create a case with a case type containing some OrganisationPolicy fields\n+      Given a user with [an active profile in CCD]\n+      And a successful call [to create a token for case creation] as in [F-107_Case_Data_Create_Token_Creation]\n+      When a request is prepared with appropriate values\n+      And the request [contains some OrganisationPolicy fields with all correct values]\n+      And it is submitted to call the [Submit Case Creation as Caseworker] operation of [CCD Data Store]\n+      Then a positive response is received\n+      And the response has all other details as expected\n+\n+    @S-927\n+    Scenario: must successfully update OrganisationPolicy fields on a case\n+      Given a user with [an active profile in CCD]\n+      Given a successful call [to create a token for case creation] as in [F-107_Case_Data_Create_Token_Creation]", "originalCommit": "90d12335cd1e1d319a266a068b610e7ef3940ce6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODIxNDk3NQ==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/989#discussion_r458214975", "bodyText": "Fixed. Removed the token creation step. Used the naming convention for token creation.", "author": "Olawale", "createdAt": "2020-07-21T16:06:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQwNTc2MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQwNjkyMg==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/989#discussion_r454406922", "bodyText": "This one, however, is good to stay here because it is essential to the flow of the functionality.", "author": "MSancaktutar", "createdAt": "2020-07-14T14:39:38Z", "path": "src/aat/resources/features/F-107/F-107.feature", "diffHunk": "@@ -0,0 +1,53 @@\n+@F-107\n+Feature: F-107: Organisation Policies on Cases\n+\n+    Background: Load test data for the scenario\n+    Given an appropriate test context as detailed in the test data source\n+\n+    @S-925\n+    Scenario: must successfully create a case with a case type containing some OrganisationPolicy fields\n+      Given a user with [an active profile in CCD]\n+      And a successful call [to create a token for case creation] as in [F-107_Case_Data_Create_Token_Creation]\n+      When a request is prepared with appropriate values\n+      And the request [contains some OrganisationPolicy fields with all correct values]\n+      And it is submitted to call the [Submit Case Creation as Caseworker] operation of [CCD Data Store]\n+      Then a positive response is received\n+      And the response has all other details as expected\n+\n+    @S-927\n+    Scenario: must successfully update OrganisationPolicy fields on a case\n+      Given a user with [an active profile in CCD]\n+      Given a successful call [to create a token for case creation] as in [F-107_Case_Data_Create_Token_Creation]\n+      And a case that has just been created as in [S-927_Create_Case_Data]\n+      And a successful call [to get an event token for the case just created] as in [S-927-Prerequisite]", "originalCommit": "90d12335cd1e1d319a266a068b610e7ef3940ce6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzQ3MjA1MA==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/989#discussion_r457472050", "bodyText": "\ud83d\udc4d", "author": "Olawale", "createdAt": "2020-07-20T15:04:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQwNjkyMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQwNzY2NQ==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/989#discussion_r454407665", "bodyText": "any chance we could be more specific as to what is incorrect in those values? (like, maybe, for example, 'a case role different from the default one in the policy definition')", "author": "MSancaktutar", "createdAt": "2020-07-14T14:40:36Z", "path": "src/aat/resources/features/F-107/F-107.feature", "diffHunk": "@@ -0,0 +1,53 @@\n+@F-107\n+Feature: F-107: Organisation Policies on Cases\n+\n+    Background: Load test data for the scenario\n+    Given an appropriate test context as detailed in the test data source\n+\n+    @S-925\n+    Scenario: must successfully create a case with a case type containing some OrganisationPolicy fields\n+      Given a user with [an active profile in CCD]\n+      And a successful call [to create a token for case creation] as in [F-107_Case_Data_Create_Token_Creation]\n+      When a request is prepared with appropriate values\n+      And the request [contains some OrganisationPolicy fields with all correct values]\n+      And it is submitted to call the [Submit Case Creation as Caseworker] operation of [CCD Data Store]\n+      Then a positive response is received\n+      And the response has all other details as expected\n+\n+    @S-927\n+    Scenario: must successfully update OrganisationPolicy fields on a case\n+      Given a user with [an active profile in CCD]\n+      Given a successful call [to create a token for case creation] as in [F-107_Case_Data_Create_Token_Creation]\n+      And a case that has just been created as in [S-927_Create_Case_Data]\n+      And a successful call [to get an event token for the case just created] as in [S-927-Prerequisite]\n+      When a request is prepared with appropriate values\n+      And the request [contains some OrganisationPolicy fields with all correct values]\n+      And it is submitted to call the [submit event for an existing case (V2)] operation of [CCD data store]\n+      Then a positive response is received\n+      And the response has all other details as expected\n+\n+    @S-926\n+    Scenario: must return e negative response for a case creation attempt with an invalid data in some OrganisationPolicy fields\n+      Given a user with [an active profile in CCD]\n+      And a successful call [to create a token for case creation] as in [F-107_Case_Data_Create_Token_Creation]\n+      When a request is prepared with appropriate values\n+      And the request [contains some OrganisationPolicy fields with incorrect values]", "originalCommit": "90d12335cd1e1d319a266a068b610e7ef3940ce6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzQ3NTQ4OA==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/989#discussion_r457475488", "bodyText": "Changed the step to be more specific.", "author": "Olawale", "createdAt": "2020-07-20T15:08:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQwNzY2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQwOTMzMw==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/989#discussion_r454409333", "bodyText": "Could you please mention the scenario number to enable in that ticket, to avoid forgetting.", "author": "MSancaktutar", "createdAt": "2020-07-14T14:42:50Z", "path": "src/aat/resources/features/F-107/F-107.feature", "diffHunk": "@@ -0,0 +1,53 @@\n+@F-107\n+Feature: F-107: Organisation Policies on Cases\n+\n+    Background: Load test data for the scenario\n+    Given an appropriate test context as detailed in the test data source\n+\n+    @S-925\n+    Scenario: must successfully create a case with a case type containing some OrganisationPolicy fields\n+      Given a user with [an active profile in CCD]\n+      And a successful call [to create a token for case creation] as in [F-107_Case_Data_Create_Token_Creation]\n+      When a request is prepared with appropriate values\n+      And the request [contains some OrganisationPolicy fields with all correct values]\n+      And it is submitted to call the [Submit Case Creation as Caseworker] operation of [CCD Data Store]\n+      Then a positive response is received\n+      And the response has all other details as expected\n+\n+    @S-927\n+    Scenario: must successfully update OrganisationPolicy fields on a case\n+      Given a user with [an active profile in CCD]\n+      Given a successful call [to create a token for case creation] as in [F-107_Case_Data_Create_Token_Creation]\n+      And a case that has just been created as in [S-927_Create_Case_Data]\n+      And a successful call [to get an event token for the case just created] as in [S-927-Prerequisite]\n+      When a request is prepared with appropriate values\n+      And the request [contains some OrganisationPolicy fields with all correct values]\n+      And it is submitted to call the [submit event for an existing case (V2)] operation of [CCD data store]\n+      Then a positive response is received\n+      And the response has all other details as expected\n+\n+    @S-926\n+    Scenario: must return e negative response for a case creation attempt with an invalid data in some OrganisationPolicy fields\n+      Given a user with [an active profile in CCD]\n+      And a successful call [to create a token for case creation] as in [F-107_Case_Data_Create_Token_Creation]\n+      When a request is prepared with appropriate values\n+      And the request [contains some OrganisationPolicy fields with incorrect values]\n+      And it is submitted to call the [Submit Case Creation as Caseworker] operation of [CCD Data Store]\n+      Then a negative response is received\n+      And the response has all other details as expected\n+\n+    @S-928 @Ignore # Enable test when RDM-8993 is fixed.", "originalCommit": "90d12335cd1e1d319a266a068b610e7ef3940ce6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzQ3NjQ1Mg==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/989#discussion_r457476452", "bodyText": "RDM-8993 has been fixed. Hence, removed the comment.", "author": "Olawale", "createdAt": "2020-07-20T15:09:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQwOTMzMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQwOTg2MQ==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/989#discussion_r454409861", "bodyText": "this line could be removed as described in a similar scenario.", "author": "MSancaktutar", "createdAt": "2020-07-14T14:43:40Z", "path": "src/aat/resources/features/F-107/F-107.feature", "diffHunk": "@@ -0,0 +1,53 @@\n+@F-107\n+Feature: F-107: Organisation Policies on Cases\n+\n+    Background: Load test data for the scenario\n+    Given an appropriate test context as detailed in the test data source\n+\n+    @S-925\n+    Scenario: must successfully create a case with a case type containing some OrganisationPolicy fields\n+      Given a user with [an active profile in CCD]\n+      And a successful call [to create a token for case creation] as in [F-107_Case_Data_Create_Token_Creation]\n+      When a request is prepared with appropriate values\n+      And the request [contains some OrganisationPolicy fields with all correct values]\n+      And it is submitted to call the [Submit Case Creation as Caseworker] operation of [CCD Data Store]\n+      Then a positive response is received\n+      And the response has all other details as expected\n+\n+    @S-927\n+    Scenario: must successfully update OrganisationPolicy fields on a case\n+      Given a user with [an active profile in CCD]\n+      Given a successful call [to create a token for case creation] as in [F-107_Case_Data_Create_Token_Creation]\n+      And a case that has just been created as in [S-927_Create_Case_Data]\n+      And a successful call [to get an event token for the case just created] as in [S-927-Prerequisite]\n+      When a request is prepared with appropriate values\n+      And the request [contains some OrganisationPolicy fields with all correct values]\n+      And it is submitted to call the [submit event for an existing case (V2)] operation of [CCD data store]\n+      Then a positive response is received\n+      And the response has all other details as expected\n+\n+    @S-926\n+    Scenario: must return e negative response for a case creation attempt with an invalid data in some OrganisationPolicy fields\n+      Given a user with [an active profile in CCD]\n+      And a successful call [to create a token for case creation] as in [F-107_Case_Data_Create_Token_Creation]\n+      When a request is prepared with appropriate values\n+      And the request [contains some OrganisationPolicy fields with incorrect values]\n+      And it is submitted to call the [Submit Case Creation as Caseworker] operation of [CCD Data Store]\n+      Then a negative response is received\n+      And the response has all other details as expected\n+\n+    @S-928 @Ignore # Enable test when RDM-8993 is fixed.\n+    Scenario: must return e negative response for a case update attempt with an invalid data in some OrganisationPolicy fields\n+      Given a user with [an active profile in CCD]\n+      Given a successful call [to create a token for case creation] as in [F-107_Case_Data_Create_Token_Creation]", "originalCommit": "90d12335cd1e1d319a266a068b610e7ef3940ce6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODIxNDM3NA==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/989#discussion_r458214374", "bodyText": "Fixed.", "author": "Olawale", "createdAt": "2020-07-21T16:05:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQwOTg2MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQxMDA3Ng==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/989#discussion_r454410076", "bodyText": "more specificlly?", "author": "MSancaktutar", "createdAt": "2020-07-14T14:43:57Z", "path": "src/aat/resources/features/F-107/F-107.feature", "diffHunk": "@@ -0,0 +1,53 @@\n+@F-107\n+Feature: F-107: Organisation Policies on Cases\n+\n+    Background: Load test data for the scenario\n+    Given an appropriate test context as detailed in the test data source\n+\n+    @S-925\n+    Scenario: must successfully create a case with a case type containing some OrganisationPolicy fields\n+      Given a user with [an active profile in CCD]\n+      And a successful call [to create a token for case creation] as in [F-107_Case_Data_Create_Token_Creation]\n+      When a request is prepared with appropriate values\n+      And the request [contains some OrganisationPolicy fields with all correct values]\n+      And it is submitted to call the [Submit Case Creation as Caseworker] operation of [CCD Data Store]\n+      Then a positive response is received\n+      And the response has all other details as expected\n+\n+    @S-927\n+    Scenario: must successfully update OrganisationPolicy fields on a case\n+      Given a user with [an active profile in CCD]\n+      Given a successful call [to create a token for case creation] as in [F-107_Case_Data_Create_Token_Creation]\n+      And a case that has just been created as in [S-927_Create_Case_Data]\n+      And a successful call [to get an event token for the case just created] as in [S-927-Prerequisite]\n+      When a request is prepared with appropriate values\n+      And the request [contains some OrganisationPolicy fields with all correct values]\n+      And it is submitted to call the [submit event for an existing case (V2)] operation of [CCD data store]\n+      Then a positive response is received\n+      And the response has all other details as expected\n+\n+    @S-926\n+    Scenario: must return e negative response for a case creation attempt with an invalid data in some OrganisationPolicy fields\n+      Given a user with [an active profile in CCD]\n+      And a successful call [to create a token for case creation] as in [F-107_Case_Data_Create_Token_Creation]\n+      When a request is prepared with appropriate values\n+      And the request [contains some OrganisationPolicy fields with incorrect values]\n+      And it is submitted to call the [Submit Case Creation as Caseworker] operation of [CCD Data Store]\n+      Then a negative response is received\n+      And the response has all other details as expected\n+\n+    @S-928 @Ignore # Enable test when RDM-8993 is fixed.\n+    Scenario: must return e negative response for a case update attempt with an invalid data in some OrganisationPolicy fields\n+      Given a user with [an active profile in CCD]\n+      Given a successful call [to create a token for case creation] as in [F-107_Case_Data_Create_Token_Creation]\n+      And a case that has just been created as in [S-927_Create_Case_Data]\n+      And a successful call [to get an event token for the case just created] as in [S-927-Prerequisite]\n+      When a request is prepared with appropriate values\n+      And the request [contains some OrganisationPolicy fields with incorrect values]", "originalCommit": "90d12335cd1e1d319a266a068b610e7ef3940ce6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzQ3NzUzMw==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/989#discussion_r457477533", "bodyText": "Added specific details to the scenario step.", "author": "Olawale", "createdAt": "2020-07-20T15:10:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQxMDA3Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQxMzE4MQ==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/989#discussion_r454413181", "bodyText": "[scenarioContext][parentContext][childContexts] --> [scenarioContext][siblingContexts]", "author": "MSancaktutar", "createdAt": "2020-07-14T14:47:47Z", "path": "src/aat/resources/features/F-107/S-927-Prerequisite.td.json", "diffHunk": "@@ -0,0 +1,43 @@\n+{\n+  \"title\": \"should create an event token for correct inputs\",\n+  \"_guid_\": \"S-927-Prerequisite\",\n+  \"productName\": \"CCD Data Store\",\n+  \"operationName\": \"Retrieve a create token\",\n+  \"method\": \"GET\",\n+  \"uri\": \"/caseworkers/{uid}/jurisdictions/{jid}/case-types/{ctid}/cases/{cid}/event-triggers/{etid}/token\",\n+  \"specs\": [\n+    \"to get an event token for the case just created\"\n+  ],\n+\n+  \"users\": {\n+    \"invokingUser\": {\n+      \"username\": \"befta.caseworker.caa@gmail.com\",\n+      \"password\": \"[[$CCD_CASEWORKER_AUTOTEST_PASSWORD]]\"\n+    }\n+  },\n+\n+  \"request\": {\n+    \"headers\": {\n+      \"_extends_\": \"Common_Request_Headers\"\n+    },\n+    \"pathVariables\": {\n+      \"uid\": \"[[DEFAULT_AUTO_VALUE]]\",\n+      \"jid\": \"BEFTA_MASTER\",\n+      \"ctid\": \"FT_MasterCaseType\",\n+      \"cid\": \"${[scenarioContext][parentContext][childContexts][S-927_Create_Case_Data][testData][actualResponse][body][id]}\",", "originalCommit": "90d12335cd1e1d319a266a068b610e7ef3940ce6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzUzMzAwMA==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/989#discussion_r457533000", "bodyText": "Fixed. \ud83d\udc4d", "author": "Olawale", "createdAt": "2020-07-20T16:18:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQxMzE4MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQxMzUxMg==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/989#discussion_r454413512", "bodyText": "please e-use common 201 response object, and remove redundantly repeated lines.", "author": "MSancaktutar", "createdAt": "2020-07-14T14:48:16Z", "path": "src/aat/resources/features/F-107/S-927.td.json", "diffHunk": "@@ -0,0 +1,74 @@\n+{\n+  \"title\": \"should create event successfully for an existing case\",\n+  \"_guid_\": \"S-927\",\n+  \"_extends_\": \"F-107_Test_Data_Update\",\n+\n+  \"specs\": [\n+    \"an active profile in CCD\",\n+    \"contains some OrganisationPolicy fields with all correct values\"\n+  ],\n+  \"request\": {\n+    \"pathVariables\": {\n+      \"cid\": \"${[scenarioContext][childContexts][S-927_Create_Case_Data][testData][actualResponse][body][id]}\"\n+    },\n+    \"body\": {\n+      \"event_token\": \"${[scenarioContext][childContexts][S-927-Prerequisite][testData][actualResponse][body][token]}\"\n+    }\n+  },\n+  \"expectedResponse\": {\n+    \"responseCode\": 201,", "originalCommit": "90d12335cd1e1d319a266a068b610e7ef3940ce6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzUxNDgwMA==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/989#discussion_r457514800", "bodyText": "Fixes. Removed redundant header checks. Used common 201 response object.", "author": "Olawale", "createdAt": "2020-07-20T15:52:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQxMzUxMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQxNTc2NQ==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/989#discussion_r454415765", "bodyText": "The specific values for many of [[ANYTHING_PRESENT]] placeholders should better be checked in exact terms. This is particularly required at least for values in OrganisationPolicy fields and their sub-fields.", "author": "MSancaktutar", "createdAt": "2020-07-14T14:51:07Z", "path": "src/aat/resources/features/F-107/S-927_Create_Case_Data.td.json", "diffHunk": "@@ -0,0 +1,104 @@\n+{\n+\t\"_guid_\": \"S-927_Create_Case_Data\",\n+  \"_extends_\": \"F-107_Test_Data_Base\",\n+  \"request\": {\n+    \"body\": {\n+      \"event_token\": \"${[scenarioContext][siblingContexts][F-107_Case_Data_Create_Token_Creation][testData][actualResponse][body][token]}\"\n+    }\n+  },\n+\n+  \"expectedResponse\": {\n+    \"_extends_\": \"Common_201_Response\",\n+    \"headers\": {\n+      \"Keep-Alive\": \"[[ANYTHING_PRESENT]]\",\n+      \"Connection\": \"[[ANYTHING_PRESENT]]\",\n+      \"Transfer-Encoding\" : \"[[ANYTHING_PRESENT]]\",\n+      \"vary\" : \"[[ANYTHING_PRESENT]]\",\n+      \"Content-Encoding\": \"[[ANYTHING_PRESENT]]\"\n+    },\n+    \"body\": {\n+      \"id\": \"[[ANYTHING_PRESENT]]\",\n+      \"jurisdiction\": \"BEFTA_MASTER\",\n+      \"case_type_id\": \"FT_MasterCaseType\",\n+      \"created_date\": \"[[ANYTHING_PRESENT]]\",\n+      \"last_modified\": \"[[ANYTHING_PRESENT]]\",\n+      \"last_state_modified_date\": \"[[ANYTHING_PRESENT]]\",\n+      \"state\": \"CaseCreated\",\n+      \"version\": \"[[ANYTHING_PRESENT]]\",\n+      \"security_classification\": \"PUBLIC\",\n+      \"security_classifications\": \"[[ANYTHING_PRESENT]]\",\n+      \"case_data\": {\n+        \"AddressField\": {\n+          \"AddressLine1\": \"[[ANYTHING_PRESENT]]\",\n+          \"AddressLine2\": \"[[ANYTHING_PRESENT]]\",\n+          \"AddressLine3\": \"[[ANYTHING_PRESENT]]\",\n+          \"Country\": \"[[ANYTHING_PRESENT]]\"\n+        },\n+        \"TextField\": \"[[ANYTHING_PRESENT]]\",\n+        \"OrganisationPolicyField2\": {\n+          \"OrgPolicyCaseAssignedRole\": \"[Defendant]\",\n+          \"OrgPolicyReference\": \"ref\",\n+          \"Organisation\": {\n+            \"OrganisationID\": \"[[ANYTHING_PRESENT]]\",\n+            \"OrganisationName\": \"[[ANYTHING_PRESENT]]\"\n+          }\n+        },\n+        \"TextAreaField\": \"[[ANYTHING_PRESENT]]\",\n+        \"OrganisationPolicyField1\": {\n+          \"OrgPolicyCaseAssignedRole\": \"[Claimant]\",\n+          \"OrgPolicyReference\": \"ref\",\n+          \"Organisation\": {\n+            \"OrganisationID\": \"[[ANYTHING_PRESENT]]\",\n+            \"OrganisationName\": \"[[ANYTHING_PRESENT]]\"\n+          }\n+        }\n+      },", "originalCommit": "90d12335cd1e1d319a266a068b610e7ef3940ce6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzUyNjc4Mg==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/989#discussion_r457526782", "bodyText": "Added the actual expected values in the expecteResponse, specifically for OrganisationPolicy.", "author": "Olawale", "createdAt": "2020-07-20T16:08:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQxNTc2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQxNjc5Nw==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/989#discussion_r454416797", "bodyText": "Title:   \"title\": \"should create event successfully for an existing case\",\nneeds to be corrected to a consistent one.", "author": "MSancaktutar", "createdAt": "2020-07-14T14:52:28Z", "path": "src/aat/resources/features/F-107/S-928.td.json", "diffHunk": "@@ -0,0 +1,41 @@\n+{\n+  \"title\": \"should create event successfully for an existing case\",\n+  \"_guid_\": \"S-928\",\n+  \"_extends_\": \"F-107_Test_Data_Update\",\n+\n+  \"specs\": [\n+    \"an active profile in CCD\",\n+    \"contains some OrganisationPolicy fields with incorrect values\"\n+  ],\n+\n+  \"request\": {\n+    \"pathVariables\": {\n+      \"cid\": \"${[scenarioContext][childContexts][S-927_Create_Case_Data][testData][actualResponse][body][id]}\"\n+    },\n+    \"body\": {\n+      \"data\": {\n+        \"OrganisationPolicyField1\": {\n+          \"OrgPolicyCaseAssignedRole\": \"[Invalid]\"\n+          },\n+        \"OrganisationPolicyField2\": {\n+          \"OrgPolicyCaseAssignedRole\": \"[Invalid]\"\n+          }\n+        },\n+      \"event_token\": \"${[scenarioContext][childContexts][S-927-Prerequisite][testData][actualResponse][body][token]}\"\n+    }\n+  },\n+  \"expectedResponse\": {\n+    \"_extends_\": \"Common_422_Response\",\n+    \"body\" : {\n+      \"exception\" : \"uk.gov.hmcts.ccd.endpoint.exceptions.ValidationException\",\n+      \"timestamp\" : \"[[ANYTHING_PRESENT]]\",\n+      \"status\" : 422,\n+      \"error\" : \"Unprocessable Entity\",\n+      \"message\" : \"[[ANYTHING_PRESENT]]\",\n+      \"path\" : \"[[ANYTHING_PRESENT]]\",\n+      \"details\" : null,\n+      \"callbackErrors\" : null,\n+      \"callbackWarnings\" : null\n+    }\n+  }\n+}", "originalCommit": "90d12335cd1e1d319a266a068b610e7ef3940ce6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzUzNDYwNw==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/989#discussion_r457534607", "bodyText": "Fixed.", "author": "Olawale", "createdAt": "2020-07-20T16:20:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQxNjc5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzU1MDgwMg==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/989#discussion_r457550802", "bodyText": "Fixed.", "author": "Olawale", "createdAt": "2020-07-20T16:46:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQxNjc5Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQxODYwOA==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/989#discussion_r454418608", "bodyText": "I would actually expect an http-400 for this kind of a situation. Could we check with it's developer why this was implemented as 422? Was there anything that had to be kept consistent with? Without a strong rationale to justify, I'd advise an http-400 for this, and therefore this scenario would be revealing a defect, in fact.", "author": "MSancaktutar", "createdAt": "2020-07-14T14:54:49Z", "path": "src/aat/resources/features/F-107/S-928.td.json", "diffHunk": "@@ -0,0 +1,41 @@\n+{\n+  \"title\": \"should create event successfully for an existing case\",\n+  \"_guid_\": \"S-928\",\n+  \"_extends_\": \"F-107_Test_Data_Update\",\n+\n+  \"specs\": [\n+    \"an active profile in CCD\",\n+    \"contains some OrganisationPolicy fields with incorrect values\"\n+  ],\n+\n+  \"request\": {\n+    \"pathVariables\": {\n+      \"cid\": \"${[scenarioContext][childContexts][S-927_Create_Case_Data][testData][actualResponse][body][id]}\"\n+    },\n+    \"body\": {\n+      \"data\": {\n+        \"OrganisationPolicyField1\": {\n+          \"OrgPolicyCaseAssignedRole\": \"[Invalid]\"\n+          },\n+        \"OrganisationPolicyField2\": {\n+          \"OrgPolicyCaseAssignedRole\": \"[Invalid]\"\n+          }\n+        },\n+      \"event_token\": \"${[scenarioContext][childContexts][S-927-Prerequisite][testData][actualResponse][body][token]}\"\n+    }\n+  },\n+  \"expectedResponse\": {\n+    \"_extends_\": \"Common_422_Response\",\n+    \"body\" : {\n+      \"exception\" : \"uk.gov.hmcts.ccd.endpoint.exceptions.ValidationException\",\n+      \"timestamp\" : \"[[ANYTHING_PRESENT]]\",\n+      \"status\" : 422,\n+      \"error\" : \"Unprocessable Entity\",\n+      \"message\" : \"[[ANYTHING_PRESENT]]\",\n+      \"path\" : \"[[ANYTHING_PRESENT]]\",\n+      \"details\" : null,\n+      \"callbackErrors\" : null,\n+      \"callbackWarnings\" : null", "originalCommit": "90d12335cd1e1d319a266a068b610e7ef3940ce6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODAwOTMyNw==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/989#discussion_r458009327", "bodyText": "@kiran-yenigala-hmcts has fixed RDM-8993 to return 400 BadRequest for invalid org policy case roles in case creation and update. Tests amended accordingly.", "author": "Olawale", "createdAt": "2020-07-21T10:54:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQxODYwOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQyNTk3MA==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/989#discussion_r454425970", "bodyText": "3.6.1 is now ready. please use that one.", "author": "MSancaktutar", "createdAt": "2020-07-14T15:04:22Z", "path": "build.gradle", "diffHunk": "@@ -278,7 +278,7 @@ dependencies {\n     }\n     compile 'org.jooq:jool-java-8:0.9.14'\n \n-    testCompile group: 'uk.gov.hmcts', name: 'befta-fw', version: '3.6.0'\n+    testCompile group: 'uk.gov.hmcts', name: 'befta-fw', version: '3.6.0-master-def-fix'", "originalCommit": "90d12335cd1e1d319a266a068b610e7ef3940ce6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzUzMDgzMg==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/989#discussion_r457530832", "bodyText": "\ud83d\udc4d", "author": "Olawale", "createdAt": "2020-07-20T16:14:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQyNTk3MA=="}], "type": "inlineReview"}, {"oid": "b5c9e130bf38fcda942517a0cec7587f8606342d", "url": "https://github.com/hmcts/ccd-data-store-api/commit/b5c9e130bf38fcda942517a0cec7587f8606342d", "message": "Merge develop into branch", "committedDate": "2020-07-20T14:48:09Z", "type": "commit"}, {"oid": "d5ef257c9227614ef20c9cbd3d7832cfbacf9490", "url": "https://github.com/hmcts/ccd-data-store-api/commit/d5ef257c9227614ef20c9cbd3d7832cfbacf9490", "message": "Refactored tests", "committedDate": "2020-07-20T20:31:08Z", "type": "commit"}, {"oid": "257b044c66bdd64fbf48931dd90d1d08973c44df", "url": "https://github.com/hmcts/ccd-data-store-api/commit/257b044c66bdd64fbf48931dd90d1d08973c44df", "message": "Refactored test to check 400 validation error, not 422", "committedDate": "2020-07-21T10:51:57Z", "type": "commit"}, {"oid": "e8dd14469c1ac25a616a18b5bb0e47e39c61860e", "url": "https://github.com/hmcts/ccd-data-store-api/commit/e8dd14469c1ac25a616a18b5bb0e47e39c61860e", "message": "Removed redundant token creation step", "committedDate": "2020-07-21T16:04:11Z", "type": "commit"}, {"oid": "3cf9e18020ab39b8b7c35d3afa5fc038ae62e483", "url": "https://github.com/hmcts/ccd-data-store-api/commit/3cf9e18020ab39b8b7c35d3afa5fc038ae62e483", "message": "Merge branch 'develop' into fta_8667", "committedDate": "2020-07-23T01:42:23Z", "type": "commit"}, {"oid": "45d91f1743d4cee4cdbedb6d036a2460c3872446", "url": "https://github.com/hmcts/ccd-data-store-api/commit/45d91f1743d4cee4cdbedb6d036a2460c3872446", "message": "use latest fw version", "committedDate": "2020-07-23T02:20:00Z", "type": "commit"}, {"oid": "f13b173e97fbc6a7157511ad874f89678a537ca7", "url": "https://github.com/hmcts/ccd-data-store-api/commit/f13b173e97fbc6a7157511ad874f89678a537ca7", "message": "Merge branch 'develop' into fta_8667", "committedDate": "2020-07-23T15:33:38Z", "type": "commit"}, {"oid": "0d1de2e891784abac617e3f3c937074b5360d4ec", "url": "https://github.com/hmcts/ccd-data-store-api/commit/0d1de2e891784abac617e3f3c937074b5360d4ec", "message": "Resolved conflicting file names", "committedDate": "2020-07-23T17:38:35Z", "type": "commit"}, {"oid": "b02e09df444374fb4456b7523640dee335345bf4", "url": "https://github.com/hmcts/ccd-data-store-api/commit/b02e09df444374fb4456b7523640dee335345bf4", "message": "Corrected guid", "committedDate": "2020-07-23T18:10:42Z", "type": "commit"}]}