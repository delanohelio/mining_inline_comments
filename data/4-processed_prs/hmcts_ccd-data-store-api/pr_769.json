{"pr_number": 769, "pr_title": "Rdm 6240", "pr_createdAt": "2020-01-22T10:41:52Z", "pr_url": "https://github.com/hmcts/ccd-data-store-api/pull/769", "timeline": [{"oid": "808c4489dfba645d2c4dfc72e1359eb9ad5994be", "url": "https://github.com/hmcts/ccd-data-store-api/commit/808c4489dfba645d2c4dfc72e1359eb9ad5994be", "message": "RDM-6240 Sanitise inputs in SortOrderQueryBuilder. Replace SortOrderQueryBuilderTest with integration tests in DefaultCaseDetailsRepositoryTest.\nSortOrderQueryBuilder generates SQL queries. To verify that the generated SQL is correct, it needs to be tested by executing it against the Hibernate/Postgres stack and validating the results. Unit testing this means testing implementation rather than behaviour, leading to brittle tests that are tightly coupled to the implementation. I have ensured coverage for the deleted tests by expanding DefaultCaseDetailsRepositoryTest, adding new tests where necessary.", "committedDate": "2020-01-20T16:47:38Z", "type": "commit"}, {"oid": "bde396fe6c71ead75cf699ab473d8522773c0dc9", "url": "https://github.com/hmcts/ccd-data-store-api/commit/bde396fe6c71ead75cf699ab473d8522773c0dc9", "message": "RDM-6240 Validate column names if metadata field for ordering or validate based on valid field name if it is a dynamic field ordering within ccd data. Clean up criterion factory.", "committedDate": "2020-01-22T10:39:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQ5NTU4Nw==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/769#discussion_r369495587", "bodyText": "this validation already occurs in definition-store. If we re-force it here then we should throw an error immediately rather than fallback to JSONB group.\nAlso VALID_FIELD_NAME_REGEX should in sync with fieldNames pattern of definition.", "author": "smathangi", "createdAt": "2020-01-22T11:02:08Z", "path": "src/main/java/uk/gov/hmcts/ccd/data/casedetails/search/SortOrderQueryBuilder.java", "diffHunk": "@@ -12,23 +21,39 @@\n     private static final String SPACE = \" \";\n     private static final String COMMA = \",\";\n \n+    private static final Set<String> VALID_COLUMNS_FOR_ORDER_BY\n+        = Collections.unmodifiableSet((Set<? extends String>) Stream\n+                                          .of(CaseDetailsEntity.CREATED_DATE_FIELD_COL,\n+                                              CaseDetailsEntity.LAST_MODIFIED_FIELD_COL,\n+                                              CaseDetailsEntity.JURISDICTION_FIELD_COL,\n+                                              CaseDetailsEntity.CASE_TYPE_ID_FIELD_COL,\n+                                              CaseDetailsEntity.STATE_FIELD_COL,\n+                                              CaseDetailsEntity.REFERENCE_FIELD_COL,\n+                                              CaseDetailsEntity.SECURITY_CLASSIFICATION_FIELD_COL)\n+                                          .collect(Collectors.toCollection(HashSet::new)));\n+\n     public String buildSortOrderClause(MetaData metaData) {\n         StringBuilder sb = new StringBuilder();\n         metaData.getSortOrderFields().forEach(sortOrderField -> {\n-            if (sortOrderField.isMetadata()) {\n+            if (sortOrderField.isMetadata() && VALID_COLUMNS_FOR_ORDER_BY.contains(getMataFieldName(sortOrderField.getCaseFieldId()))) {", "originalCommit": "bde396fe6c71ead75cf699ab473d8522773c0dc9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTUwNjE0Ng==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/769#discussion_r369506146", "bodyText": "Looks good overall, but couldn't grasp the reason to remove this test class at first sight.", "author": "MSancaktutar", "createdAt": "2020-01-22T11:27:43Z", "path": "src/test/java/uk/gov/hmcts/ccd/data/casedetails/search/SortOrderQueryBuilderTest.java", "diffHunk": "@@ -1,80 +0,0 @@\n-package uk.gov.hmcts.ccd.data.casedetails.search;\n-", "originalCommit": "bde396fe6c71ead75cf699ab473d8522773c0dc9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTUxMDQ2Mg==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/769#discussion_r369510462", "bodyText": "I would put the validation here, at the exact point where the data is being converted to SQL, and throw an exception if the sort order is invalid. Otherwise I have to look around a bunch of different places to figure out if the validation always happens.", "author": "banderous", "createdAt": "2020-01-22T11:38:21Z", "path": "src/main/java/uk/gov/hmcts/ccd/data/casedetails/search/SortOrderQueryBuilder.java", "diffHunk": "@@ -12,23 +21,39 @@\n     private static final String SPACE = \" \";\n     private static final String COMMA = \",\";\n \n+    private static final Set<String> VALID_COLUMNS_FOR_ORDER_BY\n+        = Collections.unmodifiableSet((Set<? extends String>) Stream\n+                                          .of(CaseDetailsEntity.CREATED_DATE_FIELD_COL,\n+                                              CaseDetailsEntity.LAST_MODIFIED_FIELD_COL,\n+                                              CaseDetailsEntity.JURISDICTION_FIELD_COL,\n+                                              CaseDetailsEntity.CASE_TYPE_ID_FIELD_COL,\n+                                              CaseDetailsEntity.STATE_FIELD_COL,\n+                                              CaseDetailsEntity.REFERENCE_FIELD_COL,\n+                                              CaseDetailsEntity.SECURITY_CLASSIFICATION_FIELD_COL)\n+                                          .collect(Collectors.toCollection(HashSet::new)));\n+\n     public String buildSortOrderClause(MetaData metaData) {\n         StringBuilder sb = new StringBuilder();\n         metaData.getSortOrderFields().forEach(sortOrderField -> {\n-            if (sortOrderField.isMetadata()) {\n+            if (sortOrderField.isMetadata() && VALID_COLUMNS_FOR_ORDER_BY.contains(getMataFieldName(sortOrderField.getCaseFieldId()))) {\n                 sb.append(getMataFieldName(sortOrderField.getCaseFieldId()));\n-            } else {\n+                appendOrder(sb, sortOrderField);\n+            } else if (sortOrderField.getCaseFieldId().matches(VALID_FIELD_NAME_REGEX)) {\n                 sb.append(convertFieldNameToJSONBsqlFormat(sortOrderField.getCaseFieldId()));\n+                appendOrder(sb, sortOrderField);\n             }\n-            sb.append(SPACE);\n-            sb.append(sortOrderField.getDirection());\n-            sb.append(COMMA);\n-            sb.append(SPACE);\n         });\n         // always sort with creation_date as a last order so that it supports cases where no values at all for the configured fields and also default fallback.\n         return sb.append(CREATED_DATE + SPACE + SortDirection.fromOptionalString(metaData.getSortDirection())).toString();\n     }\n \n+    private void appendOrder(final StringBuilder sb, final SortOrderField sortOrderField) {\n+        sb.append(SPACE);\n+        sb.append(sortOrderField.getDirection());", "originalCommit": "bde396fe6c71ead75cf699ab473d8522773c0dc9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTUxNDg2NA==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/769#discussion_r369514864", "bodyText": "Not sure I understand - the appending happens in the if else as well?", "author": "andrewfolga", "createdAt": "2020-01-22T11:48:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTUxMDQ2Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTUxODUxMA==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/769#discussion_r369518510", "bodyText": "ok I will add a top level if block looking for special characters:\nmetaData.getSortOrderFields().forEach(sortOrderField -> {\n            if (!sortOrderField.getCaseFieldId().matches(SPECIAL_CHARS)) {\n                if (sortOrderField.isMetadata()) {\n                    sb.append(getMataFieldName(sortOrderField.getCaseFieldId()));\n                } else {\n                    sb.append(convertFieldNameToJSONBsqlFormat(sortOrderField.getCaseFieldId()));\n                }\n                sb.append(SPACE);\n                sb.append(sortOrderField.getDirection());\n                sb.append(COMMA);\n                sb.append(SPACE);\n            }\n        });", "author": "andrewfolga", "createdAt": "2020-01-22T11:56:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTUxMDQ2Mg=="}], "type": "inlineReview"}, {"oid": "3c2bbddbbc01039830a0e55b75a1e50064cc1a29", "url": "https://github.com/hmcts/ccd-data-store-api/commit/3c2bbddbbc01039830a0e55b75a1e50064cc1a29", "message": "Merge branch 'develop' into RDM-6240", "committedDate": "2020-01-22T11:45:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTUyNTEyMA==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/769#discussion_r369525120", "bodyText": "Based on the latest discussions around logic duplication between def store and data store, I think we can indeed remove this allowed-list approach as well. We can stay within the purpose of just SQL-i prevention by just rejecting a few special chars in case field ids, and indeed, case field IDs can reasonably be assumed to not contain such chars, no matter how their validity conventions change in the foreseeable future.", "author": "MSancaktutar", "createdAt": "2020-01-22T12:13:02Z", "path": "src/main/java/uk/gov/hmcts/ccd/data/casedetails/search/SortOrderQueryBuilder.java", "diffHunk": "@@ -12,23 +21,39 @@\n     private static final String SPACE = \" \";\n     private static final String COMMA = \",\";\n \n+    private static final Set<String> VALID_COLUMNS_FOR_ORDER_BY\n+        = Collections.unmodifiableSet((Set<? extends String>) Stream\n+                                          .of(CaseDetailsEntity.CREATED_DATE_FIELD_COL,\n+                                              CaseDetailsEntity.LAST_MODIFIED_FIELD_COL,\n+                                              CaseDetailsEntity.JURISDICTION_FIELD_COL,\n+                                              CaseDetailsEntity.CASE_TYPE_ID_FIELD_COL,\n+                                              CaseDetailsEntity.STATE_FIELD_COL,\n+                                              CaseDetailsEntity.REFERENCE_FIELD_COL,\n+                                              CaseDetailsEntity.SECURITY_CLASSIFICATION_FIELD_COL)\n+                                          .collect(Collectors.toCollection(HashSet::new)));", "originalCommit": "3c2bbddbbc01039830a0e55b75a1e50064cc1a29", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTU0Mzk5OA==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/769#discussion_r369543998", "bodyText": "The OWASP guide recommends blacklisting only as a last resort:\n\nThis technique should only be used as a last resort, when none of the above are feasible. Input validation is probably a better choice as this methodology is frail compared to other defenses and we cannot guarantee it will prevent all SQL Injection in all situations.\n\nIf in this case we know the range of possible values then Andrew's original whitelisting would be my preference but either approach is an improvement.\nRegarding the duplication between definition and data stores, I see this as an indicator that these services should be merged together, which would also simplify testing (no wiremock or duplication of models, cannot commit breaking changes to data store into def store).", "author": "banderous", "createdAt": "2020-01-22T12:58:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTUyNTEyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTU4MTY0OA==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/769#discussion_r369581648", "bodyText": "Yes I was following the OWASP guide and initially tried to do white listing solution. The problem with that is it creates dependency on whatever change is introduced to case_data table's columns. I am ok with either solution here but the the common denominator between @MSancaktutar @smathangi and myself was blacklisting...\n@MSancaktutar let me know what you think?", "author": "andrewfolga", "createdAt": "2020-01-22T14:13:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTUyNTEyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTk4MTExMw==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/769#discussion_r369981113", "bodyText": "Sanitising input against a disallowed list is in this case more efficient and well-secure. It is an ORDER BY clause we're building and preventing those disallowed chars solves the same problem to the same effect with less coupling with other parts of CCD.", "author": "MSancaktutar", "createdAt": "2020-01-23T08:23:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTUyNTEyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDAwNzExNg==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/769#discussion_r370007116", "bodyText": "The OWASP guide is explicit that blacklisting should be the last resort and only used for securing legacy code; there are issues such as Unicode smuggling where special characters can get past a blacklist and get converted to dangerous characters by the database.\nIn this case the range of valid input is known so whitelisting is the secure way to go; a switch statement that only outputs known valid constants.\nDatabase queries are inherently coupled to the schema they operate on, which is why it's problematic to split schema out of a database into its own service as we have done. If we are going to persist with the split then duplication is inevitable.", "author": "banderous", "createdAt": "2020-01-23T09:24:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTUyNTEyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDAyNjE2NA==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/769#discussion_r370026164", "bodyText": "I think this whitelist check for metadata fields are already happening against a ENUM. Is it not good enough?  \n  \n    \n      ccd-data-store-api/src/main/java/uk/gov/hmcts/ccd/data/casedetails/search/SortOrderQueryBuilder.java\n    \n    \n         Line 42\n      in\n      75fbac7\n    \n    \n    \n    \n\n        \n          \n           return CaseField.valueOf(metaFieldName).getDbColumnName();", "author": "smathangi", "createdAt": "2020-01-23T10:02:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTUyNTEyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDA2MDQwMw==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/769#discussion_r370060403", "bodyText": "Yes @smathangi this is the right approach, a couple more places where the same needs to be done.", "author": "banderous", "createdAt": "2020-01-23T11:16:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTUyNTEyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDA2NTcwMA==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/769#discussion_r370065700", "bodyText": "@banderous can you let me know which places do you mean?", "author": "andrewfolga", "createdAt": "2020-01-23T11:29:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTUyNTEyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDA3Mjc2MA==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/769#discussion_r370072760", "bodyText": "@andrewfolga individual comments are in the review I made requesting changes.", "author": "banderous", "createdAt": "2020-01-23T11:47:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTUyNTEyMA=="}], "type": "inlineReview"}, {"oid": "fd305eb50524ffd110107277196776331bb1af2a", "url": "https://github.com/hmcts/ccd-data-store-api/commit/fd305eb50524ffd110107277196776331bb1af2a", "message": "RDM-6240 Remove validation of table columns. Add top level validation against special characters.", "committedDate": "2020-01-22T12:40:03Z", "type": "commit"}, {"oid": "8f58695df913712272e3827bc9dc3b9675d63b9a", "url": "https://github.com/hmcts/ccd-data-store-api/commit/8f58695df913712272e3827bc9dc3b9675d63b9a", "message": "Merge remote-tracking branch 'origin/RDM-6240' into RDM-6240", "committedDate": "2020-01-22T12:40:14Z", "type": "commit"}, {"oid": "1691108a5883fb01c4d55033a7e111e8c1bd4d3e", "url": "https://github.com/hmcts/ccd-data-store-api/commit/1691108a5883fb01c4d55033a7e111e8c1bd4d3e", "message": "Merge branch 'develop' into RDM-6240", "committedDate": "2020-01-22T12:40:35Z", "type": "commit"}, {"oid": "1d10f643f58c1d42635e283aaad313eab24ad4c5", "url": "https://github.com/hmcts/ccd-data-store-api/commit/1d10f643f58c1d42635e283aaad313eab24ad4c5", "message": "RDM-6240 Revert access modifier change.", "committedDate": "2020-01-22T12:41:52Z", "type": "commit"}, {"oid": "da4b9205af4f2277506fb8e6dd45160addc3a856", "url": "https://github.com/hmcts/ccd-data-store-api/commit/da4b9205af4f2277506fb8e6dd45160addc3a856", "message": "Merge remote-tracking branch 'origin/RDM-6240' into RDM-6240", "committedDate": "2020-01-22T12:42:09Z", "type": "commit"}, {"oid": "75fbac732d9e24f220afa20f4f56f487f5c5a03c", "url": "https://github.com/hmcts/ccd-data-store-api/commit/75fbac732d9e24f220afa20f4f56f487f5c5a03c", "message": "Merge branch 'develop' into RDM-6240", "committedDate": "2020-01-22T14:08:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDAxOTM2NQ==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/769#discussion_r370019365", "bodyText": "double check comment", "author": "andrewfolga", "createdAt": "2020-01-23T09:49:05Z", "path": "src/test/java/uk/gov/hmcts/ccd/data/casedetails/DefaultCaseDetailsRepositoryTest.java", "diffHunk": "@@ -201,6 +222,35 @@ public void getFindByMetadataAndFieldDataSortDesc() {\n         assertThat(byMetaDataAndFieldData.get(1).getId(), is(\"1\"));\n     }\n \n+    @Test\n+    @Sql(executionPhase = Sql.ExecutionPhase.BEFORE_TEST_METHOD, scripts = { \"classpath:sql/insert_cases.sql\" })\n+    public void getFindByMetadataAndFieldDataSortByBothCaseAndMetadataFields() {\n+        assumeDataInitialised();\n+\n+        MetaData metadata = new MetaData(\"TestAddressBookCase\", \"PROBATE\");\n+        metadata.setSortDirection(Optional.of(\"Asc\"));\n+        metadata.addSortOrderField(SortOrderField.sortOrderWith()\n+                                       .caseFieldId(\"[LAST_MODIFIED_DATE]\")\n+                                       .metadata(true)\n+                                       .direction(\"ASC\")\n+                                       .build());\n+        metadata.addSortOrderField(SortOrderField.sortOrderWith()\n+                                       .caseFieldId(\"PersonLastName\")\n+                                       .metadata(false)\n+                                       .direction(\"DESC\")\n+                                       .build());\n+\n+        HashMap<String, String> searchParams = new HashMap<>();\n+        searchParams.put(\"PersonFirstName\", \"Janet\");\n+        final List<CaseDetails> byMetaDataAndFieldData = caseDetailsRepository.findByMetaDataAndFieldData(metadata,\n+            searchParams);\n+\n+        // See the timestamps in insert_cases.sql.\n+        // Should be ordered by person last name, last modified desc, creation date asc.", "originalCommit": "75fbac732d9e24f220afa20f4f56f487f5c5a03c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "6e7a20cd927c8c6059af749b8247540ec14619a9", "url": "https://github.com/hmcts/ccd-data-store-api/commit/6e7a20cd927c8c6059af749b8247540ec14619a9", "message": "Merge branch 'develop' into RDM-6240", "committedDate": "2020-01-23T10:03:50Z", "type": "commit"}, {"oid": "05211ff68646c2fd7ee57265eeda6d2ef190302d", "url": "https://github.com/hmcts/ccd-data-store-api/commit/05211ff68646c2fd7ee57265eeda6d2ef190302d", "message": "RDM-6240 If malicious content skip the building of query and log exception.", "committedDate": "2020-01-23T10:34:53Z", "type": "commit"}, {"oid": "a8dfcc8c016155377b26b05cf44088a96fa19079", "url": "https://github.com/hmcts/ccd-data-store-api/commit/a8dfcc8c016155377b26b05cf44088a96fa19079", "message": "Merge remote-tracking branch 'origin/RDM-6240' into RDM-6240", "committedDate": "2020-01-23T10:35:00Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDA0MDg1Mw==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/769#discussion_r370040853", "bodyText": "We are appending an arbitrary String here - this should be an Enum, or it looks like you could use SortDirection.fromOptionalString", "author": "banderous", "createdAt": "2020-01-23T10:32:05Z", "path": "src/main/java/uk/gov/hmcts/ccd/data/casedetails/search/SortOrderQueryBuilder.java", "diffHunk": "@@ -4,26 +4,34 @@\n import org.springframework.stereotype.Component;\n import uk.gov.hmcts.ccd.data.casedetails.search.MetaData.CaseField;\n \n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+\n @Component\n public class SortOrderQueryBuilder {\n \n     private static final String DATA_FIELD = \"data\";\n     private static final String CREATED_DATE = \"created_date\";\n     private static final String SPACE = \" \";\n     private static final String COMMA = \",\";\n+    private static final String SPECIAL_CHARS_REGEXP = \"[\\\\s\\\\\\\\\\\\/,;\\\\)\\\\('\\\"`]\";\n+    private static final Pattern SPECIAL_CHARS_PATTERN = Pattern.compile(SPECIAL_CHARS_REGEXP);\n \n     public String buildSortOrderClause(MetaData metaData) {\n         StringBuilder sb = new StringBuilder();\n         metaData.getSortOrderFields().forEach(sortOrderField -> {\n-            if (sortOrderField.isMetadata()) {\n-                sb.append(getMataFieldName(sortOrderField.getCaseFieldId()));\n-            } else {\n-                sb.append(convertFieldNameToJSONBsqlFormat(sortOrderField.getCaseFieldId()));\n+            Matcher matcher = SPECIAL_CHARS_PATTERN.matcher(sortOrderField.getCaseFieldId());\n+            if (!matcher.find()) {\n+                if (sortOrderField.isMetadata()) {\n+                    sb.append(getMataFieldName(sortOrderField.getCaseFieldId()));\n+                } else {\n+                    sb.append(convertFieldNameToJSONBsqlFormat(sortOrderField.getCaseFieldId()));\n+                }\n+                sb.append(SPACE);\n+                sb.append(sortOrderField.getDirection());", "originalCommit": "6e7a20cd927c8c6059af749b8247540ec14619a9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDE1OTY1MQ==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/769#discussion_r370159651", "bodyText": "Good point - done.", "author": "andrewfolga", "createdAt": "2020-01-23T14:46:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDA0MDg1Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDA0MzQ2Ng==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/769#discussion_r370043466", "bodyText": "convertFieldNameToJSONBsqlFormat is also vulnerable since it just passes through the input with some substitutions - can we apply a whitelist of known allowed characters to it?", "author": "banderous", "createdAt": "2020-01-23T10:37:44Z", "path": "src/main/java/uk/gov/hmcts/ccd/data/casedetails/search/SortOrderQueryBuilder.java", "diffHunk": "@@ -4,26 +4,34 @@\n import org.springframework.stereotype.Component;\n import uk.gov.hmcts.ccd.data.casedetails.search.MetaData.CaseField;\n \n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+\n @Component\n public class SortOrderQueryBuilder {\n \n     private static final String DATA_FIELD = \"data\";\n     private static final String CREATED_DATE = \"created_date\";\n     private static final String SPACE = \" \";\n     private static final String COMMA = \",\";\n+    private static final String SPECIAL_CHARS_REGEXP = \"[\\\\s\\\\\\\\\\\\/,;\\\\)\\\\('\\\"`]\";\n+    private static final Pattern SPECIAL_CHARS_PATTERN = Pattern.compile(SPECIAL_CHARS_REGEXP);\n \n     public String buildSortOrderClause(MetaData metaData) {\n         StringBuilder sb = new StringBuilder();\n         metaData.getSortOrderFields().forEach(sortOrderField -> {\n-            if (sortOrderField.isMetadata()) {\n-                sb.append(getMataFieldName(sortOrderField.getCaseFieldId()));\n-            } else {\n-                sb.append(convertFieldNameToJSONBsqlFormat(sortOrderField.getCaseFieldId()));\n+            Matcher matcher = SPECIAL_CHARS_PATTERN.matcher(sortOrderField.getCaseFieldId());\n+            if (!matcher.find()) {\n+                if (sortOrderField.isMetadata()) {\n+                    sb.append(getMataFieldName(sortOrderField.getCaseFieldId()));\n+                } else {\n+                    sb.append(convertFieldNameToJSONBsqlFormat(sortOrderField.getCaseFieldId()));", "originalCommit": "6e7a20cd927c8c6059af749b8247540ec14619a9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDE2ODI1OA==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/769#discussion_r370168258", "bodyText": "We already handle that input with blacklisting as per @MSancaktutar comments? See Matcher matcher = SPECIAL_CHARS_PATTERN.matcher(sortOrderField.getCaseFieldId());", "author": "andrewfolga", "createdAt": "2020-01-23T14:59:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDA0MzQ2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDE2ODU4Mg==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/769#discussion_r370168582", "bodyText": "This can be any field from within the dynamic case data json so not sure how we would do whitelisting here. Can you elaborate please?", "author": "andrewfolga", "createdAt": "2020-01-23T15:00:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDA0MzQ2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDE3OTQwNA==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/769#discussion_r370179404", "bodyText": "Ah yes sorry, I think we are back to the whitelisting vs blacklisting thing again. Whitelisting would involve asserting that the column name only consists of the set of allowable characters in it but we've been over that one :)", "author": "banderous", "createdAt": "2020-01-23T15:17:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDA0MzQ2Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDA0NDI4NA==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/769#discussion_r370044284", "bodyText": "You could let the exception propagate and not catch it, or rethrow it. Returning a null values will result in a more cryptic error later on.", "author": "banderous", "createdAt": "2020-01-23T10:39:27Z", "path": "src/main/java/uk/gov/hmcts/ccd/data/casedetails/search/SortOrderQueryBuilder.java", "diffHunk": "@@ -1,37 +1,55 @@\n package uk.gov.hmcts.ccd.data.casedetails.search;\n \n import org.apache.commons.lang3.StringUtils;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n import org.springframework.stereotype.Component;\n import uk.gov.hmcts.ccd.data.casedetails.search.MetaData.CaseField;\n \n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+\n @Component\n public class SortOrderQueryBuilder {\n \n+    private static final Logger LOG = LoggerFactory.getLogger(SortOrderQueryBuilder.class);\n+\n     private static final String DATA_FIELD = \"data\";\n     private static final String CREATED_DATE = \"created_date\";\n     private static final String SPACE = \" \";\n     private static final String COMMA = \",\";\n+    private static final String SPECIAL_CHARS_REGEXP = \"[\\\\s\\\\\\\\\\\\/,;\\\\)\\\\('\\\"`]\";\n+    private static final Pattern SPECIAL_CHARS_PATTERN = Pattern.compile(SPECIAL_CHARS_REGEXP);\n \n     public String buildSortOrderClause(MetaData metaData) {\n         StringBuilder sb = new StringBuilder();\n         metaData.getSortOrderFields().forEach(sortOrderField -> {\n-            if (sortOrderField.isMetadata()) {\n-                sb.append(getMataFieldName(sortOrderField.getCaseFieldId()));\n-            } else {\n-                sb.append(convertFieldNameToJSONBsqlFormat(sortOrderField.getCaseFieldId()));\n+            Matcher matcher = SPECIAL_CHARS_PATTERN.matcher(sortOrderField.getCaseFieldId());\n+            if (!matcher.find()) {\n+                if (sortOrderField.isMetadata()) {\n+                    sb.append(getMataFieldName(sortOrderField.getCaseFieldId()));\n+                } else {\n+                    sb.append(convertFieldNameToJSONBsqlFormat(sortOrderField.getCaseFieldId()));\n+                }\n+                sb.append(SPACE);\n+                sb.append(sortOrderField.getDirection());\n+                sb.append(COMMA);\n+                sb.append(SPACE);\n             }\n-            sb.append(SPACE);\n-            sb.append(sortOrderField.getDirection());\n-            sb.append(COMMA);\n-            sb.append(SPACE);\n         });\n         // always sort with creation_date as a last order so that it supports cases where no values at all for the configured fields and also default fallback.\n         return sb.append(CREATED_DATE + SPACE + SortDirection.fromOptionalString(metaData.getSortDirection())).toString();\n     }\n \n     private String getMataFieldName(String fieldName) {\n         String metaFieldName = fieldName.startsWith(\"[\") ? StringUtils.substringBetween(fieldName, \"[\", \"]\") : fieldName;\n-        return CaseField.valueOf(metaFieldName).getDbColumnName();\n+        String dbColumnName = null;\n+        try {\n+            dbColumnName = CaseField.valueOf(metaFieldName).getDbColumnName();\n+        } catch (IllegalArgumentException iae) {", "originalCommit": "a8dfcc8c016155377b26b05cf44088a96fa19079", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDE2OTgwOA==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/769#discussion_r370169808", "bodyText": "I followed your approach where you also do not throw or propagate exception but do not append the section of sql query being built that contains a validation problem. See a test reflecting that here:\n    public void sanitisesInputsCountQuery() {\n        String evil = \"foo');insert into case users values(1,2,3);--\";\n        when(authorisedCaseDefinitionDataService.getUserAuthorisedCaseStateIds(\"PROBATE\", \"TestAddressBookCase\", CAN_READ))\n            .thenReturn(asList(evil));\n\n        when(userAuthorisation.getAccessLevel()).thenReturn(AccessLevel.GRANTED);\n        when(userAuthorisation.getUserId()).thenReturn(evil);\n\n        MetaData metadata = new MetaData(\"TestAddressBookCase\", \"PROBATE\");\n        final PaginatedSearchMetadata byMetaData = caseDetailsRepository.getPaginatedSearchMetadata(metadata, Maps.newHashMap());\n\n        // If any input is not correctly sanitized it will cause an exception since query result structure will not be as hibernate expects.\n        assertThat(byMetaData.getTotalResultsCount(), is(0));\n    }", "author": "andrewfolga", "createdAt": "2020-01-23T15:02:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDA0NDI4NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDE4NTg2NA==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/769#discussion_r370185864", "bodyText": "The fix in that case was using OWASP option 1 - parameterised queries. With a parameterised query it doesn't matter what the input is, it should still result in a valid query (that returns zero results).\nIn this case the column name is a parameter so we cannot use a parameterised query and must use OWASP option three - explicitly rejecting the bad input. So in this case I would design the test to expect that IllegalArgument exception and fail if it is not thrown.", "author": "banderous", "createdAt": "2020-01-23T15:27:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDA0NDI4NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDIxMzUxNw==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/769#discussion_r370213517", "bodyText": "I would remove this exception handler completely and assert that the illegalargumentexception is thrown in your test", "author": "banderous", "createdAt": "2020-01-23T16:12:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDA0NDI4NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDA0NDY2OA==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/769#discussion_r370044668", "bodyText": "Test passing evil in to the direction too", "author": "banderous", "createdAt": "2020-01-23T10:40:16Z", "path": "src/test/java/uk/gov/hmcts/ccd/data/casedetails/DefaultCaseDetailsRepositoryTest.java", "diffHunk": "@@ -153,6 +153,27 @@ public void sanitisesInputs() {\n         assertThat(byMetaData.getTotalResultsCount(), is(0));\n     }\n \n+    @Test\n+    public void sanitisesInputsMainQuery() {\n+        String evil = \"foo');insert into case users values(1,2,3);--\";\n+        when(authorisedCaseDefinitionDataService.getUserAuthorisedCaseStateIds(\"PROBATE\", \"TestAddressBookCase\", CAN_READ))\n+            .thenReturn(asList(evil));\n+\n+        when(userAuthorisation.getAccessLevel()).thenReturn(AccessLevel.GRANTED);\n+        when(userAuthorisation.getUserId()).thenReturn(evil);\n+\n+        MetaData metadata = new MetaData(\"TestAddressBookCase\", \"PROBATE\");\n+        metadata.addSortOrderField(SortOrderField.sortOrderWith()\n+                                       .caseFieldId(evil)\n+                                       .metadata(false)\n+                                       .direction(\"DESC\")", "originalCommit": "a8dfcc8c016155377b26b05cf44088a96fa19079", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDE3MDQ2MQ==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/769#discussion_r370170461", "bodyText": "I've created an additional test now.", "author": "andrewfolga", "createdAt": "2020-01-23T15:03:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDA0NDY2OA=="}], "type": "inlineReview"}, {"oid": "d53f6cca0e056c2f9cf4cad46bba2ceacfa6d9e6", "url": "https://github.com/hmcts/ccd-data-store-api/commit/d53f6cca0e056c2f9cf4cad46bba2ceacfa6d9e6", "message": "Merge branch 'develop' into RDM-6240", "committedDate": "2020-01-23T15:05:55Z", "type": "commit"}, {"oid": "85e5199a9d6a0866811fdae6824dd70fababc487", "url": "https://github.com/hmcts/ccd-data-store-api/commit/85e5199a9d6a0866811fdae6824dd70fababc487", "message": "RDM-6240 Address latest comments. Use whitelisting on sorting direction. Add relevant test.", "committedDate": "2020-01-23T15:14:40Z", "type": "commit"}, {"oid": "bd87be182763f844d7503dcf641503c51fc21075", "url": "https://github.com/hmcts/ccd-data-store-api/commit/bd87be182763f844d7503dcf641503c51fc21075", "message": "Merge remote-tracking branch 'origin/RDM-6240' into RDM-6240", "committedDate": "2020-01-23T15:14:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDIxNDgyNA==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/769#discussion_r370214824", "bodyText": "If we made SortDirection.fromOptionalString throw an exception could this cause an issue in production? Where does metaData.getSortDirection() come from? Could it contain null or some other value that would currently just result in an ASC sort order?", "author": "banderous", "createdAt": "2020-01-23T16:15:16Z", "path": "src/main/java/uk/gov/hmcts/ccd/data/casedetails/search/SortOrderQueryBuilder.java", "diffHunk": "@@ -1,37 +1,55 @@\n package uk.gov.hmcts.ccd.data.casedetails.search;\n \n import org.apache.commons.lang3.StringUtils;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n import org.springframework.stereotype.Component;\n import uk.gov.hmcts.ccd.data.casedetails.search.MetaData.CaseField;\n \n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+\n+import static java.util.Optional.ofNullable;\n+\n @Component\n public class SortOrderQueryBuilder {\n \n+    private static final Logger LOG = LoggerFactory.getLogger(SortOrderQueryBuilder.class);\n+\n     private static final String DATA_FIELD = \"data\";\n     private static final String CREATED_DATE = \"created_date\";\n     private static final String SPACE = \" \";\n-    private static final String COMMA = \",\";\n+    private static final String SPECIAL_CHARS_REGEXP = \"[\\\\s\\\\\\\\\\\\/,;\\\\)\\\\('\\\"`]\";\n+    private static final Pattern SPECIAL_CHARS_PATTERN = Pattern.compile(SPECIAL_CHARS_REGEXP);\n \n     public String buildSortOrderClause(MetaData metaData) {\n         StringBuilder sb = new StringBuilder();\n         metaData.getSortOrderFields().forEach(sortOrderField -> {\n-            if (sortOrderField.isMetadata()) {\n-                sb.append(getMataFieldName(sortOrderField.getCaseFieldId()));\n-            } else {\n-                sb.append(convertFieldNameToJSONBsqlFormat(sortOrderField.getCaseFieldId()));\n+            Matcher matcher = SPECIAL_CHARS_PATTERN.matcher(sortOrderField.getCaseFieldId());\n+            if (!matcher.find()) {\n+                if (sortOrderField.isMetadata()) {\n+                    sb.append(getMataFieldName(sortOrderField.getCaseFieldId()));\n+                } else {\n+                    sb.append(convertFieldNameToJSONBsqlFormat(sortOrderField.getCaseFieldId()));\n+                }\n+                sb.append(SPACE);\n+                sb.append(SortDirection.fromOptionalString(ofNullable(sortOrderField.getDirection())));\n+                sb.append(SPACE);\n             }\n-            sb.append(SPACE);\n-            sb.append(sortOrderField.getDirection());\n-            sb.append(COMMA);\n-            sb.append(SPACE);\n         });\n         // always sort with creation_date as a last order so that it supports cases where no values at all for the configured fields and also default fallback.\n         return sb.append(CREATED_DATE + SPACE + SortDirection.fromOptionalString(metaData.getSortDirection())).toString();", "originalCommit": "bd87be182763f844d7503dcf641503c51fc21075", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI1NzIyMg==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/769#discussion_r370257222", "bodyText": "I left this out as I am unsure the answers to those questions.", "author": "andrewfolga", "createdAt": "2020-01-23T17:33:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDIxNDgyNA=="}], "type": "inlineReview"}, {"oid": "673cc7a9919d2461a79a379ebb760d8c87d2e2ea", "url": "https://github.com/hmcts/ccd-data-store-api/commit/673cc7a9919d2461a79a379ebb760d8c87d2e2ea", "message": "RDM-6240 Address latest comments. Throw exception on matching special characters on failed blacklisting validation. Add removed COMMA. Remove swallowing exception on CaseField enum unwrapping as it should serve as proper validation and throw exception as well.", "committedDate": "2020-01-23T17:31:51Z", "type": "commit"}, {"oid": "274d66139e8c8f53bb80223fcd4d47295bd3529c", "url": "https://github.com/hmcts/ccd-data-store-api/commit/274d66139e8c8f53bb80223fcd4d47295bd3529c", "message": "Merge branch 'develop' into RDM-6240", "committedDate": "2020-01-24T08:55:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDUzMTM5NQ==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/769#discussion_r370531395", "bodyText": "you could get rid of this else now that we're throwing an exception", "author": "banderous", "createdAt": "2020-01-24T09:08:28Z", "path": "src/main/java/uk/gov/hmcts/ccd/data/casedetails/search/SortOrderQueryBuilder.java", "diffHunk": "@@ -1,32 +1,50 @@\n package uk.gov.hmcts.ccd.data.casedetails.search;\n \n import org.apache.commons.lang3.StringUtils;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n import org.springframework.stereotype.Component;\n import uk.gov.hmcts.ccd.data.casedetails.search.MetaData.CaseField;\n \n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+\n+import static java.util.Optional.ofNullable;\n+import static uk.gov.hmcts.ccd.data.casedetails.search.SortDirection.fromOptionalString;\n+\n @Component\n public class SortOrderQueryBuilder {\n \n+    private static final Logger LOG = LoggerFactory.getLogger(SortOrderQueryBuilder.class);\n+\n     private static final String DATA_FIELD = \"data\";\n     private static final String CREATED_DATE = \"created_date\";\n     private static final String SPACE = \" \";\n+    private static final String SPECIAL_CHARS_REGEXP = \"[\\\\s\\\\\\\\\\\\/,;\\\\)\\\\('\\\"`]\";\n+    private static final Pattern SPECIAL_CHARS_PATTERN = Pattern.compile(SPECIAL_CHARS_REGEXP);\n     private static final String COMMA = \",\";\n \n     public String buildSortOrderClause(MetaData metaData) {\n         StringBuilder sb = new StringBuilder();\n         metaData.getSortOrderFields().forEach(sortOrderField -> {\n-            if (sortOrderField.isMetadata()) {\n-                sb.append(getMataFieldName(sortOrderField.getCaseFieldId()));\n+            Matcher matcher = SPECIAL_CHARS_PATTERN.matcher(sortOrderField.getCaseFieldId());\n+            if (matcher.find()) {\n+                LOG.error(\"Illegal sort order field id: {}\", sortOrderField.getCaseFieldId());\n+                throw new IllegalArgumentException(\"Illegal sortOrderField.caseFieldId=\" + sortOrderField.getCaseFieldId());\n             } else {", "originalCommit": "274d66139e8c8f53bb80223fcd4d47295bd3529c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDUzMTY1NQ==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/769#discussion_r370531655", "bodyText": "by which I mean the block and braces, not the code inside!", "author": "banderous", "createdAt": "2020-01-24T09:09:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDUzMTM5NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDUzMjA1OQ==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/769#discussion_r370532059", "bodyText": "Done", "author": "andrewfolga", "createdAt": "2020-01-24T09:10:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDUzMTM5NQ=="}], "type": "inlineReview"}, {"oid": "aa55fe4389f2396887ffeb8e92fb2a52f76de38d", "url": "https://github.com/hmcts/ccd-data-store-api/commit/aa55fe4389f2396887ffeb8e92fb2a52f76de38d", "message": "RDM-6240 Remove else condition.", "committedDate": "2020-01-24T09:10:21Z", "type": "commit"}, {"oid": "0acf5f6f8e7d0fd30d794bac1f8a84db12c5f431", "url": "https://github.com/hmcts/ccd-data-store-api/commit/0acf5f6f8e7d0fd30d794bac1f8a84db12c5f431", "message": "Merge remote-tracking branch 'origin/RDM-6240' into RDM-6240", "committedDate": "2020-01-24T09:10:52Z", "type": "commit"}, {"oid": "f3a1820fb8025cb779447fc5096f202bce6658ea", "url": "https://github.com/hmcts/ccd-data-store-api/commit/f3a1820fb8025cb779447fc5096f202bce6658ea", "message": "RDM-6240 Remove blacklisting and add whitelisting back for the metadata column names.", "committedDate": "2020-01-24T09:50:35Z", "type": "commit"}, {"oid": "8e7adcd3e04fed655c21326a48c248027c91d571", "url": "https://github.com/hmcts/ccd-data-store-api/commit/8e7adcd3e04fed655c21326a48c248027c91d571", "message": "Merge branch 'develop' into RDM-6240", "committedDate": "2020-01-24T16:25:40Z", "type": "commit"}, {"oid": "bd1ef0709129913ecb8b7ff67c7097603d974718", "url": "https://github.com/hmcts/ccd-data-store-api/commit/bd1ef0709129913ecb8b7ff67c7097603d974718", "message": "RDM-6240 Remove explicit whitelisting as already done implicitly with enum conversion.", "committedDate": "2020-01-27T10:09:08Z", "type": "commit"}, {"oid": "78adf746a996ba2db78e73fb4722c181797bd987", "url": "https://github.com/hmcts/ccd-data-store-api/commit/78adf746a996ba2db78e73fb4722c181797bd987", "message": "Merge remote-tracking branch 'origin/RDM-6240' into RDM-6240", "committedDate": "2020-01-27T10:09:17Z", "type": "commit"}, {"oid": "34c2f259ed25d05a337d0553705ddfb86c0a1fe2", "url": "https://github.com/hmcts/ccd-data-store-api/commit/34c2f259ed25d05a337d0553705ddfb86c0a1fe2", "message": "RDM-6240 Remove unused Logger.", "committedDate": "2020-01-27T10:17:09Z", "type": "commit"}, {"oid": "4defdf6e1b9d143a4c2b5c4ce5a6587a86c803dd", "url": "https://github.com/hmcts/ccd-data-store-api/commit/4defdf6e1b9d143a4c2b5c4ce5a6587a86c803dd", "message": "RDM-6240 Pull in appendColumnOrDataFieldForOrderBy into buildSortOrderClause.", "committedDate": "2020-01-27T10:22:44Z", "type": "commit"}, {"oid": "f19c5d671e6d54eebeb25e50fadb0d284569ca2a", "url": "https://github.com/hmcts/ccd-data-store-api/commit/f19c5d671e6d54eebeb25e50fadb0d284569ca2a", "message": "RDM-6240 Pull in appendColumnOrDataFieldForOrderBy into buildSortOrderClause.", "committedDate": "2020-01-27T12:04:28Z", "type": "commit"}, {"oid": "34a37218d0a6cb7a4a71871153bcd07c170e18d8", "url": "https://github.com/hmcts/ccd-data-store-api/commit/34a37218d0a6cb7a4a71871153bcd07c170e18d8", "message": "Merge branch 'develop' into RDM-6240", "committedDate": "2020-01-28T10:06:45Z", "type": "commit"}, {"oid": "237257ca5236e724b9483fefd36fa5296f92713a", "url": "https://github.com/hmcts/ccd-data-store-api/commit/237257ca5236e724b9483fefd36fa5296f92713a", "message": "Merge branch 'develop' into RDM-6240", "committedDate": "2020-01-28T17:23:02Z", "type": "commit"}, {"oid": "c925d0f28909c868be41249a2b2d191b2384c94a", "url": "https://github.com/hmcts/ccd-data-store-api/commit/c925d0f28909c868be41249a2b2d191b2384c94a", "message": "Merge branch 'develop' into RDM-6240", "committedDate": "2020-01-29T13:01:17Z", "type": "commit"}]}