{"pr_number": 849, "pr_title": "RDM 7273 - Unable to reference more than one element of a complex type within the search and workbasket tabs", "pr_createdAt": "2020-03-16T13:57:47Z", "pr_url": "https://github.com/hmcts/ccd-data-store-api/pull/849", "timeline": [{"oid": "5a5827c6ec3b0a11f3ba62ec7de948d9ebf621d8", "url": "https://github.com/hmcts/ccd-data-store-api/commit/5a5827c6ec3b0a11f3ba62ec7de948d9ebf621d8", "message": "RDM-7273 - fixed complex fields filter issue in search/workbasket input filters and results.", "committedDate": "2020-03-16T13:11:36Z", "type": "commit"}, {"oid": "4b374ec3c73065db0526af7cac2e7a32097ddb8d", "url": "https://github.com/hmcts/ccd-data-store-api/commit/4b374ec3c73065db0526af7cac2e7a32097ddb8d", "message": "RDM-7273 - fixed complex fields filter issue in search/workbasket input filters and results.", "committedDate": "2020-03-16T14:05:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzU0OTM2MQ==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/849#discussion_r393549361", "bodyText": "just realised that this is not gonna work for case roles. Nothing to do with this PR but raised the following ticket to keep track of this: https://tools.hmcts.net/jira/browse/RDM-7942", "author": "mario-paniccia", "createdAt": "2020-03-17T09:36:40Z", "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/aggregated/MergeDataToSearchResultOperation.java", "diffHunk": "@@ -80,11 +80,12 @@ private SearchResultViewColumn createSearchResultViewColumn(final SearchResultFi\n     }\n \n     private boolean filterDistinctFieldsByRole(final HashSet<String> addedFields, final SearchResultField resultField) {\n-        if (addedFields.contains(resultField.getCaseFieldId())) {\n+        String id = buildCaseFieldId(resultField);\n+        if (addedFields.contains(id)) {\n             return false;\n         } else {\n             if (StringUtils.isEmpty(resultField.getRole()) || userRepository.getUserRoles().contains(resultField.getRole())) {", "originalCommit": "4b374ec3c73065db0526af7cac2e7a32097ddb8d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzYzOTY3OA==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/849#discussion_r393639678", "bodyText": "consider moving this to a method in the CriteriaInput class itself for future reuse in other places as well. For example getPath or getFullId.", "author": "mario-paniccia", "createdAt": "2020-03-17T12:23:35Z", "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/aggregated/AuthorisedGetCriteriaOperation.java", "diffHunk": "@@ -63,15 +63,21 @@ private boolean criteriaAllowedByCRUD(CaseType caseType, CriteriaInput criteriaI\n     }\n \n     private boolean filterDistinctFieldsByRole(final Set<String> addedFields, final CriteriaInput criteriaInput, final Set<String> userRoles) {\n-        if (addedFields.contains(criteriaInput.getField().getId())) {\n+        String id = buildFieldId(criteriaInput);\n+        if (addedFields.contains(id)) {\n             return false;\n         } else {\n             if (StringUtils.isEmpty(criteriaInput.getRole()) || userRoles.contains(criteriaInput.getRole())) {\n-                addedFields.add(criteriaInput.getField().getId());\n+                addedFields.add(id);\n                 return true;\n             } else {\n                 return false;\n             }\n         }\n     }\n+\n+    private String buildFieldId(CriteriaInput criteriaInput) {\n+        return StringUtils.isEmpty(criteriaInput.getField().getElementPath()) ? criteriaInput.getField().getId() :\n+            criteriaInput.getField().getId() + '.' + criteriaInput.getField().getElementPath();\n+    }", "originalCommit": "4b374ec3c73065db0526af7cac2e7a32097ddb8d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzY0MDA3Mw==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/849#discussion_r393640073", "bodyText": "rather than buildCaseFieldId consider moving this to a method in the SearchResultField class itself for future reuse in other places as well. For example getPath or getFullId.", "author": "mario-paniccia", "createdAt": "2020-03-17T12:24:19Z", "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/aggregated/MergeDataToSearchResultOperation.java", "diffHunk": "@@ -80,11 +80,12 @@ private SearchResultViewColumn createSearchResultViewColumn(final SearchResultFi\n     }\n \n     private boolean filterDistinctFieldsByRole(final HashSet<String> addedFields, final SearchResultField resultField) {\n-        if (addedFields.contains(resultField.getCaseFieldId())) {\n+        String id = buildCaseFieldId(resultField);", "originalCommit": "4b374ec3c73065db0526af7cac2e7a32097ddb8d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f1bf60534682e2161a4a547e9efa743ae39f2b8c", "url": "https://github.com/hmcts/ccd-data-store-api/commit/f1bf60534682e2161a4a547e9efa743ae39f2b8c", "message": "Merge branch 'develop' into RDM-7273", "committedDate": "2020-03-17T12:24:50Z", "type": "commit"}, {"oid": "991da7c0445b3bf418a490225654e9b7465049dd", "url": "https://github.com/hmcts/ccd-data-store-api/commit/991da7c0445b3bf418a490225654e9b7465049dd", "message": "RDM-7273 - review comment and tests", "committedDate": "2020-03-17T14:08:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzczMjY1Mw==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/849#discussion_r393732653", "bodyText": "can we have SearchResultField and CriteriaInput use the same method name please?", "author": "mario-paniccia", "createdAt": "2020-03-17T14:45:23Z", "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/aggregated/MergeDataToSearchResultOperation.java", "diffHunk": "@@ -72,34 +72,27 @@ public SearchResultView execute(final CaseType caseType,\n \n     private SearchResultViewColumn createSearchResultViewColumn(final SearchResultField searchResultField, final CaseField caseField) {\n         return new SearchResultViewColumn(\n-            buildCaseFieldId(searchResultField),\n+            searchResultField.buildCaseFieldId(),\n             buildCaseFieldType(searchResultField, caseField),\n             searchResultField.getLabel(),\n             searchResultField.getDisplayOrder(),\n             searchResultField.isMetadata());\n     }\n \n     private boolean filterDistinctFieldsByRole(final HashSet<String> addedFields, final SearchResultField resultField) {\n-        if (addedFields.contains(resultField.getCaseFieldId())) {\n+        String id = resultField.buildCaseFieldId();", "originalCommit": "991da7c0445b3bf418a490225654e9b7465049dd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "90f663876a3bf7f5a0d4574d2f7451b8aabf8043", "url": "https://github.com/hmcts/ccd-data-store-api/commit/90f663876a3bf7f5a0d4574d2f7451b8aabf8043", "message": "RDM-7273 - review comment - method name change", "committedDate": "2020-03-18T11:03:53Z", "type": "commit"}, {"oid": "baa32edf84f8f5cde44d2f22da96833e985667b2", "url": "https://github.com/hmcts/ccd-data-store-api/commit/baa32edf84f8f5cde44d2f22da96833e985667b2", "message": "Merge branch 'develop' into RDM-7273", "committedDate": "2020-03-20T08:49:38Z", "type": "commit"}, {"oid": "d6c9be0593ecf79ede13785a4e43cd3a0283460c", "url": "https://github.com/hmcts/ccd-data-store-api/commit/d6c9be0593ecf79ede13785a4e43cd3a0283460c", "message": "RDM-7273 - changing method name back to buildCaseFieldId as json trying to serialise getFullId method. Though we can ignore with @JsonIgnore", "committedDate": "2020-03-20T09:22:33Z", "type": "commit"}, {"oid": "f9bf10686954223ca5eb3ac302748a373f849c9d", "url": "https://github.com/hmcts/ccd-data-store-api/commit/f9bf10686954223ca5eb3ac302748a373f849c9d", "message": "Merge branch 'develop' into RDM-7273", "committedDate": "2020-03-22T17:48:24Z", "type": "commit"}]}