{"pr_number": 2821, "pr_title": "Improve List IDP endpoint with addtional query param called ''requiredAttributes\"", "pr_createdAt": "2020-03-12T10:46:02Z", "pr_url": "https://github.com/wso2/carbon-identity-framework/pull/2821", "timeline": [{"oid": "a6a05c257a8f0d73f4745d0408d63daf648316b9", "url": "https://github.com/wso2/carbon-identity-framework/commit/a6a05c257a8f0d73f4745d0408d63daf648316b9", "message": "fix https://github.com/wso2/product-is/issues/7864", "committedDate": "2020-03-12T10:43:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTU1MDYyOQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2821#discussion_r391550629", "bodyText": "formatting issue. remove space before @deprecated", "author": "emswbandara", "createdAt": "2020-03-12T11:12:13Z", "path": "components/idp-mgt/org.wso2.carbon.idp.mgt/src/main/java/org/wso2/carbon/idp/mgt/IdentityProviderManager.java", "diffHunk": "@@ -1066,6 +1066,7 @@ public void updateResidentIdP(IdentityProvider identityProvider, String tenantDo\n      * @return Identity Provider's Basic Information array {@link IdpSearchResult}.\n      * @throws IdentityProviderManagementServerException server related error while getting Identity  Providers object.\n      * @throws IdentityProviderManagementClientException client related error while getting Identity  Providers object.\n+     *  @deprecated use {@link #getIdPs(Integer, Integer, String, String, String, String, List)}", "originalCommit": "a6a05c257a8f0d73f4745d0408d63daf648316b9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjA1Njg4MQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2821#discussion_r392056881", "bodyText": "let's pass an empty list rather than null. :-)", "author": "senthalan", "createdAt": "2020-03-13T06:54:21Z", "path": "components/idp-mgt/org.wso2.carbon.idp.mgt/src/main/java/org/wso2/carbon/idp/mgt/IdentityProviderManagementService.java", "diffHunk": "@@ -148,7 +148,7 @@ public int getAllIdpCount() throws IdentityProviderManagementException {\n         String tenantDomain = CarbonContext.getThreadLocalCarbonContext().getTenantDomain();\n         IdpSearchResult idpSearchResult = IdentityProviderManager.getInstance()\n                 .getIdPs(limit, offset, filter, IdPManagementConstants.DEFAULT_SORT_ORDER,\n-                        IdPManagementConstants.DEFAULT_SORT_BY, tenantDomain);\n+                        IdPManagementConstants.DEFAULT_SORT_BY, tenantDomain, null);", "originalCommit": "a6a05c257a8f0d73f4745d0408d63daf648316b9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjA1NzUxMA==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2821#discussion_r392057510", "bodyText": "Don't we need a default implementation to the new interface method", "author": "senthalan", "createdAt": "2020-03-13T06:56:42Z", "path": "components/idp-mgt/org.wso2.carbon.idp.mgt/src/main/java/org/wso2/carbon/idp/mgt/IdpManager.java", "diffHunk": "@@ -85,11 +85,32 @@ void updateResidentIdP(IdentityProvider identityProvider, String tenantDomain) t\n      * @return Identity Provider's Basic Information array {@link IdpSearchResult}.\n      * @throws IdentityProviderManagementServerException server related error when getting list of Identity  Providers.\n      * @throws IdentityProviderManagementClientException client related error when getting list of Identity  Providers.\n+     * @deprecated use {@link #getIdPs(Integer, Integer, String, String, String, String, List)} instead.\n      */\n     IdpSearchResult getIdPs(Integer limit, Integer offset, String filter, String sortOrder, String sortBy,\n                             String tenantDomain)\n             throws IdentityProviderManagementServerException, IdentityProviderManagementClientException;\n \n+    /**\n+     * Get all identity provider's Basic information along with additionally requested information depends on the\n+     * requiredAttributes.\n+     *\n+     * @param limit              Limit per page.\n+     * @param offset             Offset value.\n+     * @param filter             Filter value for IdP search.\n+     * @param sortOrder          Order of IdP ASC/DESC.\n+     * @param sortBy             The column value need to sort.\n+     * @param tenantDomain       TenantDomain of the user.\n+     * @param requiredAttributes Required attributes which needs to be return.\n+     * @return Identity Provider's Basic Information array along with requested attribute\n+     * information{@link IdpSearchResult}.\n+     * @throws IdentityProviderManagementServerException server related error when getting list of Identity Providers.\n+     * @throws IdentityProviderManagementClientException client related error when getting list of Identity Providers.\n+     */\n+    IdpSearchResult getIdPs(Integer limit, Integer offset, String filter, String sortOrder, String sortBy,", "originalCommit": "a6a05c257a8f0d73f4745d0408d63daf648316b9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjg5MDExMw==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2821#discussion_r392890113", "bodyText": "Since it is a new version, do we need to ?", "author": "sarubi", "createdAt": "2020-03-16T09:42:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjA1NzUxMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzAwMzIwNQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2821#discussion_r393003205", "bodyText": "better to add a default implementation to return null. Otherwise if there are classes written implementing this they will break unless we release a minor/major version", "author": "emswbandara", "createdAt": "2020-03-16T12:56:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjA1NzUxMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzAxNTA3Nw==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2821#discussion_r393015077", "bodyText": "added", "author": "sarubi", "createdAt": "2020-03-16T13:17:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjA1NzUxMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjA1ODE4MQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2821#discussion_r392058181", "bodyText": "we can move the null check inside the appendRequiredAttributes(), it will easier to read the code", "author": "senthalan", "createdAt": "2020-03-13T06:59:07Z", "path": "components/idp-mgt/org.wso2.carbon.idp.mgt/src/main/java/org/wso2/carbon/idp/mgt/dao/IdPManagementDAO.java", "diffHunk": "@@ -350,8 +378,12 @@ private ResultSet getIdpQueryResultSet(Connection dbConnection, String sortedOrd\n             prepStmt.setInt(filterAttributeValueSize + 3, offset);\n         } else if (databaseProductName.contains(\"Microsoft\")) {\n             sqlQuery = IdPManagementConstants.SQLQueries.GET_IDP_BY_TENANT_MSSQL;\n+            if (requiredAttributes != null) {", "originalCommit": "a6a05c257a8f0d73f4745d0408d63daf648316b9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjE0MjM3OA==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2821#discussion_r392142378", "bodyText": "let's throw the parent IdentityProviderManagementException instead of IdentityProviderManagementServerException and IdentityProviderManagementClientException", "author": "emswbandara", "createdAt": "2020-03-13T10:22:36Z", "path": "components/idp-mgt/org.wso2.carbon.idp.mgt/src/main/java/org/wso2/carbon/idp/mgt/IdpManager.java", "diffHunk": "@@ -85,11 +85,32 @@ void updateResidentIdP(IdentityProvider identityProvider, String tenantDomain) t\n      * @return Identity Provider's Basic Information array {@link IdpSearchResult}.\n      * @throws IdentityProviderManagementServerException server related error when getting list of Identity  Providers.\n      * @throws IdentityProviderManagementClientException client related error when getting list of Identity  Providers.\n+     * @deprecated use {@link #getIdPs(Integer, Integer, String, String, String, String, List)} instead.\n      */\n     IdpSearchResult getIdPs(Integer limit, Integer offset, String filter, String sortOrder, String sortBy,\n                             String tenantDomain)\n             throws IdentityProviderManagementServerException, IdentityProviderManagementClientException;\n \n+    /**\n+     * Get all identity provider's Basic information along with additionally requested information depends on the\n+     * requiredAttributes.\n+     *\n+     * @param limit              Limit per page.\n+     * @param offset             Offset value.\n+     * @param filter             Filter value for IdP search.\n+     * @param sortOrder          Order of IdP ASC/DESC.\n+     * @param sortBy             The column value need to sort.\n+     * @param tenantDomain       TenantDomain of the user.\n+     * @param requiredAttributes Required attributes which needs to be return.\n+     * @return Identity Provider's Basic Information array along with requested attribute\n+     * information{@link IdpSearchResult}.\n+     * @throws IdentityProviderManagementServerException server related error when getting list of Identity Providers.\n+     * @throws IdentityProviderManagementClientException client related error when getting list of Identity Providers.\n+     */\n+    IdpSearchResult getIdPs(Integer limit, Integer offset, String filter, String sortOrder, String sortBy,\n+                            String tenantDomain, List<String> requiredAttributes)\n+            throws IdentityProviderManagementServerException, IdentityProviderManagementClientException;", "originalCommit": "a6a05c257a8f0d73f4745d0408d63daf648316b9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjE0MzAxMw==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2821#discussion_r392143013", "bodyText": "call the new getIdPs(Integer, Integer, String, String, String, String, List) from within this deprecated method", "author": "emswbandara", "createdAt": "2020-03-13T10:23:52Z", "path": "components/idp-mgt/org.wso2.carbon.idp.mgt/src/main/java/org/wso2/carbon/idp/mgt/IdentityProviderManager.java", "diffHunk": "@@ -1066,6 +1066,7 @@ public void updateResidentIdP(IdentityProvider identityProvider, String tenantDo\n      * @return Identity Provider's Basic Information array {@link IdpSearchResult}.\n      * @throws IdentityProviderManagementServerException server related error while getting Identity  Providers object.\n      * @throws IdentityProviderManagementClientException client related error while getting Identity  Providers object.\n+     *  @deprecated use {@link #getIdPs(Integer, Integer, String, String, String, String, List)}\n      */\n     @Override\n     public IdpSearchResult getIdPs(Integer limit, Integer offset, String filter, String sortOrder, String sortBy,", "originalCommit": "a6a05c257a8f0d73f4745d0408d63daf648316b9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjE0MzI4NQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2821#discussion_r392143285", "bodyText": "let's throw only IdentityProviderManagementException it will wrap both client and server exceptions", "author": "emswbandara", "createdAt": "2020-03-13T10:24:29Z", "path": "components/idp-mgt/org.wso2.carbon.idp.mgt/src/main/java/org/wso2/carbon/idp/mgt/IdentityProviderManager.java", "diffHunk": "@@ -1082,6 +1083,37 @@ public IdpSearchResult getIdPs(Integer limit, Integer offset, String filter, Str\n         return result;\n     }\n \n+    /**\n+     * Get all identity provider's Basic information along with additionally requested information depends on the\n+     * requiredAttributes.\n+     *\n+     * @param limit              Limit per page.\n+     * @param offset             Offset value.\n+     * @param filter             Filter value for IdP search.\n+     * @param sortOrder          Order of IdP ASC/DESC.\n+     * @param sortBy             The column value need to sort.\n+     * @param tenantDomain       TenantDomain of the user.\n+     * @param requiredAttributes Required attributes which needs to be return.\n+     * @return Identity Provider's Basic Information array along with requested attribute\n+     * information{@link IdpSearchResult}.\n+     * @throws IdentityProviderManagementServerException server related error when getting list of Identity Providers.\n+     * @throws IdentityProviderManagementClientException client related error when getting list of Identity Providers.\n+     */\n+    @Override\n+    public IdpSearchResult getIdPs(Integer limit, Integer offset, String filter, String sortOrder, String sortBy,\n+                                   String tenantDomain, List<String> requiredAttributes)\n+            throws IdentityProviderManagementServerException, IdentityProviderManagementClientException {", "originalCommit": "a6a05c257a8f0d73f4745d0408d63daf648316b9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjE0MzUzNw==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2821#discussion_r392143537", "bodyText": "depending*", "author": "emswbandara", "createdAt": "2020-03-13T10:24:58Z", "path": "components/idp-mgt/org.wso2.carbon.idp.mgt/src/main/java/org/wso2/carbon/idp/mgt/IdentityProviderManager.java", "diffHunk": "@@ -1082,6 +1083,37 @@ public IdpSearchResult getIdPs(Integer limit, Integer offset, String filter, Str\n         return result;\n     }\n \n+    /**\n+     * Get all identity provider's Basic information along with additionally requested information depends on the", "originalCommit": "a6a05c257a8f0d73f4745d0408d63daf648316b9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjE0NTM5MQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2821#discussion_r392145391", "bodyText": "let's use ListUtils.isNotEmpty here. Then we can remove the null checks on the places where appendRequiredAttributes is being called.", "author": "emswbandara", "createdAt": "2020-03-13T10:28:26Z", "path": "components/idp-mgt/org.wso2.carbon.idp.mgt/src/main/java/org/wso2/carbon/idp/mgt/dao/IdPManagementDAO.java", "diffHunk": "@@ -403,48 +447,86 @@ private ResultSet getIdpQueryResultSet(Connection dbConnection, String sortedOrd\n         return prepStmt.executeQuery();\n     }\n \n+    /**\n+     * Add requested required attributes in the SQL query.\n+     *\n+     * @param sqlQuery           SQL query which need to be modify.\n+     * @param requiredAttributes Required attributes which needs to be return.\n+     * @return modified SQL query.\n+     */\n+    private String appendRequiredAttributes(String sqlQuery, List<String> requiredAttributes) {\n+\n+        if (!requiredAttributes.isEmpty()) {", "originalCommit": "a6a05c257a8f0d73f4745d0408d63daf648316b9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjg5MDY5OQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2821#discussion_r392890699", "bodyText": "CollectionUtils right? ListUtils doesnt contain isNotEmpty method.", "author": "sarubi", "createdAt": "2020-03-16T09:43:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjE0NTM5MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjE0NTUzMg==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2821#discussion_r392145532", "bodyText": "add default case and throw exception", "author": "emswbandara", "createdAt": "2020-03-13T10:28:43Z", "path": "components/idp-mgt/org.wso2.carbon.idp.mgt/src/main/java/org/wso2/carbon/idp/mgt/dao/IdPManagementDAO.java", "diffHunk": "@@ -403,48 +447,86 @@ private ResultSet getIdpQueryResultSet(Connection dbConnection, String sortedOrd\n         return prepStmt.executeQuery();\n     }\n \n+    /**\n+     * Add requested required attributes in the SQL query.\n+     *\n+     * @param sqlQuery           SQL query which need to be modify.\n+     * @param requiredAttributes Required attributes which needs to be return.\n+     * @return modified SQL query.\n+     */\n+    private String appendRequiredAttributes(String sqlQuery, List<String> requiredAttributes) {\n+\n+        if (!requiredAttributes.isEmpty()) {\n+            for (String attribute : requiredAttributes) {\n+                switch (attribute) {\n+                    case IdPManagementConstants.IDP_IS_PRIMARY:\n+                        sqlQuery += \", \" + IdPManagementConstants.IS_PRIMARY + \" \";\n+                        break;\n+                    case IdPManagementConstants.IDP_HOME_REALM_ID:\n+                        sqlQuery += \", \" + IdPManagementConstants.HOME_REALM_ID + \" \";\n+                        break;\n+                    case IdPManagementConstants.IDP_IS_FEDERATION_HUB:\n+                        sqlQuery += \", \" + IdPManagementConstants.IS_FEDERATION_HUB + \" \";\n+                        break;\n+                    case IdPManagementConstants.IDP_CERTIFICATE:\n+                        sqlQuery += \", \" + IdPManagementConstants.CERTIFICATE + \" \";\n+                        break;\n+                    case IdPManagementConstants.IDP_ALIAS:\n+                        sqlQuery += \", \" + IdPManagementConstants.ALIAS + \" \";\n+                        break;\n+                    case IdPManagementConstants.IDP_CLAIMS:\n+                        sqlQuery += \", \" + IdPManagementConstants.CLAIMS + \" \";\n+                        break;\n+                    case IdPManagementConstants.IDP_ROLES:\n+                        sqlQuery += \", \" + IdPManagementConstants.ROLES + \" \";\n+                        break;\n+                    case IdPManagementConstants.IDP_FEDERATED_AUTHENTICATORS:\n+                        sqlQuery += \", \" + IdPManagementConstants.FEDERATED_AUTHENTICATORS + \" \";\n+                        break;\n+                    case IdPManagementConstants.IDP_PROVISIONING:\n+                        sqlQuery += \", \" + IdPManagementConstants.PROVISIONING + \" \";\n+                        break;", "originalCommit": "a6a05c257a8f0d73f4745d0408d63daf648316b9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjE0NjAzNA==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2821#discussion_r392146034", "bodyText": "do we need this comment?", "author": "emswbandara", "createdAt": "2020-03-13T10:29:48Z", "path": "components/idp-mgt/org.wso2.carbon.idp.mgt/src/main/java/org/wso2/carbon/idp/mgt/dao/IdPManagementDAO.java", "diffHunk": "@@ -456,6 +538,129 @@ private ResultSet getIdpQueryResultSet(Connection dbConnection, String sortedOrd\n         return identityProviderList;\n     }\n \n+    /**\n+     * @param resultSet          ResultSet.\n+     * @param dbConnection       Database Connection.\n+     * @param requiredAttributes Required attributes which needs to be return.\n+     * @param tenantId           Tenant Id of the identity provider.\n+     * @param identityProvider   Identity Provider Object.\n+     * @throws SQLException\n+     * @throws IdentityProviderManagementServerException\n+     */\n+    private void populateRequiredAttributesForIdentityProviderList(ResultSet resultSet, Connection dbConnection,\n+                                                                   List<String> requiredAttributes, int tenantId,\n+                                                                   IdentityProvider identityProvider)\n+            throws SQLException, IdentityProviderManagementServerException {\n+\n+        int idpId = Integer.parseInt(identityProvider.getId());\n+        String idPName = identityProvider.getIdentityProviderName();\n+\n+        try {\n+            if (!requiredAttributes.isEmpty()) {\n+                for (String attribute : requiredAttributes) {\n+                    switch (attribute) {\n+                        case IdPManagementConstants.IDP_IS_PRIMARY:\n+                            if ((IdPManagementConstants.IS_TRUE_VALUE).equals(resultSet.getString(\"IS_PRIMARY\"))) {\n+                                identityProvider.setPrimary(true);\n+                            } else {\n+                                identityProvider.setPrimary(false);\n+                            }\n+                            break;\n+                        case IdPManagementConstants.IDP_HOME_REALM_ID:\n+                            identityProvider.setHomeRealmId(resultSet.getString(\"HOME_REALM_ID\"));\n+                            break;\n+                        case IdPManagementConstants.IDP_IS_FEDERATION_HUB:\n+                            if ((IdPManagementConstants.IS_TRUE_VALUE)\n+                                    .equals(resultSet.getString(\"IS_FEDERATION_HUB\"))) {\n+                                identityProvider.setFederationHub(false);\n+                            }\n+                            break;\n+                        case IdPManagementConstants.IDP_CERTIFICATE:\n+                            identityProvider.setCertificate(getBlobValue(resultSet.getBinaryStream(\"CERTIFICATE\")));\n+                            break;\n+                        case IdPManagementConstants.IDP_ALIAS:\n+                            identityProvider.setAlias(resultSet.getString(\"ALIAS\"));\n+                            break;\n+                        case IdPManagementConstants.IDP_CLAIMS:\n+                            if (identityProvider.getClaimConfig() == null) {\n+                                identityProvider.setClaimConfig(new ClaimConfig());\n+                            }\n+\n+                            // IS_LOCAL_CLAIM_DIALECT", "originalCommit": "a6a05c257a8f0d73f4745d0408d63daf648316b9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjE0NjMzMw==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2821#discussion_r392146333", "bodyText": "add default case and throw exception", "author": "emswbandara", "createdAt": "2020-03-13T10:30:27Z", "path": "components/idp-mgt/org.wso2.carbon.idp.mgt/src/main/java/org/wso2/carbon/idp/mgt/dao/IdPManagementDAO.java", "diffHunk": "@@ -456,6 +538,129 @@ private ResultSet getIdpQueryResultSet(Connection dbConnection, String sortedOrd\n         return identityProviderList;\n     }\n \n+    /**\n+     * @param resultSet          ResultSet.\n+     * @param dbConnection       Database Connection.\n+     * @param requiredAttributes Required attributes which needs to be return.\n+     * @param tenantId           Tenant Id of the identity provider.\n+     * @param identityProvider   Identity Provider Object.\n+     * @throws SQLException\n+     * @throws IdentityProviderManagementServerException\n+     */\n+    private void populateRequiredAttributesForIdentityProviderList(ResultSet resultSet, Connection dbConnection,\n+                                                                   List<String> requiredAttributes, int tenantId,\n+                                                                   IdentityProvider identityProvider)\n+            throws SQLException, IdentityProviderManagementServerException {\n+\n+        int idpId = Integer.parseInt(identityProvider.getId());\n+        String idPName = identityProvider.getIdentityProviderName();\n+\n+        try {\n+            if (!requiredAttributes.isEmpty()) {\n+                for (String attribute : requiredAttributes) {\n+                    switch (attribute) {\n+                        case IdPManagementConstants.IDP_IS_PRIMARY:\n+                            if ((IdPManagementConstants.IS_TRUE_VALUE).equals(resultSet.getString(\"IS_PRIMARY\"))) {\n+                                identityProvider.setPrimary(true);\n+                            } else {\n+                                identityProvider.setPrimary(false);\n+                            }\n+                            break;\n+                        case IdPManagementConstants.IDP_HOME_REALM_ID:\n+                            identityProvider.setHomeRealmId(resultSet.getString(\"HOME_REALM_ID\"));\n+                            break;\n+                        case IdPManagementConstants.IDP_IS_FEDERATION_HUB:\n+                            if ((IdPManagementConstants.IS_TRUE_VALUE)\n+                                    .equals(resultSet.getString(\"IS_FEDERATION_HUB\"))) {\n+                                identityProvider.setFederationHub(false);\n+                            }\n+                            break;\n+                        case IdPManagementConstants.IDP_CERTIFICATE:\n+                            identityProvider.setCertificate(getBlobValue(resultSet.getBinaryStream(\"CERTIFICATE\")));\n+                            break;\n+                        case IdPManagementConstants.IDP_ALIAS:\n+                            identityProvider.setAlias(resultSet.getString(\"ALIAS\"));\n+                            break;\n+                        case IdPManagementConstants.IDP_CLAIMS:\n+                            if (identityProvider.getClaimConfig() == null) {\n+                                identityProvider.setClaimConfig(new ClaimConfig());\n+                            }\n+\n+                            // IS_LOCAL_CLAIM_DIALECT\n+                            if (IdPManagementConstants.IS_TRUE_VALUE\n+                                    .equals(resultSet.getString(\"IS_LOCAL_CLAIM_DIALECT\"))) {\n+                                identityProvider.getClaimConfig().setLocalClaimDialect(true);\n+                            } else {\n+                                identityProvider.getClaimConfig().setLocalClaimDialect(false);\n+                            }\n+\n+                            String userClaimUri = resultSet.getString(\"USER_CLAIM_URI\");\n+                            String roleClaimUri = resultSet.getString(\"ROLE_CLAIM_URI\");\n+\n+                            if (identityProvider.getClaimConfig().isLocalClaimDialect()) {\n+                                identityProvider.setClaimConfig(getLocalIdPDefaultClaimValues(dbConnection,\n+                                        idPName, userClaimUri, roleClaimUri, idpId, tenantId));\n+                            } else {\n+                                // get claim configuration.\n+                                identityProvider.setClaimConfig(getIdPClaimConfiguration(dbConnection, idPName,\n+                                        userClaimUri, roleClaimUri, idpId, tenantId));\n+                            }\n+                            break;\n+                        case IdPManagementConstants.IDP_ROLES:\n+                            identityProvider.setProvisioningRole(resultSet.getString(\"PROVISIONING_ROLE\"));\n+                            // Get permission and role configuration.\n+                            identityProvider.setPermissionAndRoleConfig(getPermissionsAndRoleConfiguration(\n+                                    dbConnection, idPName, idpId, tenantId));\n+                            break;\n+                        case IdPManagementConstants.IDP_FEDERATED_AUTHENTICATORS:\n+                            String defaultAuthenticatorName = resultSet.getString(\"DEFAULT_AUTHENTICATOR_NAME\");\n+\n+                            // Get federated authenticators.\n+                            identityProvider.setFederatedAuthenticatorConfigs(getFederatedAuthenticatorConfigs(\n+                                    dbConnection, idPName, identityProvider, tenantId));\n+\n+                            if (defaultAuthenticatorName != null &&\n+                                    identityProvider.getFederatedAuthenticatorConfigs() != null) {\n+                                identityProvider.setDefaultAuthenticatorConfig(IdentityApplicationManagementUtil\n+                                        .getFederatedAuthenticator(\n+                                                identityProvider.getFederatedAuthenticatorConfigs(),\n+                                                defaultAuthenticatorName));\n+                            }\n+                            break;\n+                        case IdPManagementConstants.IDP_PROVISIONING:\n+                            JustInTimeProvisioningConfig jitProConfig = new JustInTimeProvisioningConfig();\n+                            if ((IdPManagementConstants.IS_TRUE_VALUE)\n+                                    .equals(resultSet.getString(\"INBOUND_PROV_ENABLED\"))) {\n+                                jitProConfig.setProvisioningEnabled(true);\n+                            } else {\n+                                jitProConfig.setProvisioningEnabled(false);\n+                            }\n+\n+                            jitProConfig\n+                                    .setProvisioningUserStore(resultSet.getString(\"INBOUND_PROV_USER_STORE_ID\"));\n+                            identityProvider.setJustInTimeProvisioningConfig(jitProConfig);\n+\n+                            String defaultProvisioningConnectorConfigName =\n+                                    resultSet.getString(\"DEFAULT_PRO_CONNECTOR_NAME\");\n+                            if (defaultProvisioningConnectorConfigName != null) {\n+                                ProvisioningConnectorConfig defaultProConnector = new ProvisioningConnectorConfig();\n+                                defaultProConnector.setName(defaultProvisioningConnectorConfigName);\n+                                identityProvider.setDefaultProvisioningConnectorConfig(defaultProConnector);\n+                            }\n+\n+                            // Get provisioning connectors.\n+                            identityProvider.setProvisioningConnectorConfigs(getProvisioningConnectorConfigs(\n+                                    dbConnection, idPName, idpId, tenantId));\n+                            break;", "originalCommit": "a6a05c257a8f0d73f4745d0408d63daf648316b9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjg5MTkyOQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2821#discussion_r392891929", "bodyText": "Here I haven't added default check since we didn't consider basic attributes cases. I added the default case when we generate query depends on the provided attribute list [1].\n[1] https://github.com/wso2/carbon-identity-framework/pull/2821/files#diff-aef45437564b8a5e30cf2197682d6fa6R502", "author": "sarubi", "createdAt": "2020-03-16T09:45:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjE0NjMzMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjk0NjgzNg==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2821#discussion_r392946836", "bodyText": "if we do like that, what will be the behavior if a user send a basic attribute in requiredAttributes field", "author": "emswbandara", "createdAt": "2020-03-16T11:20:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjE0NjMzMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjk2Mjc1OQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2821#discussion_r392962759", "bodyText": "we won't honour that provided basic attribute, will go as default behaviour flow where the requested attribute is null.", "author": "sarubi", "createdAt": "2020-03-16T11:52:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjE0NjMzMw=="}], "type": "inlineReview"}, {"oid": "b5e052e9aeb7563238087edf6dc86f3ef6a08f2b", "url": "https://github.com/wso2/carbon-identity-framework/commit/b5e052e9aeb7563238087edf6dc86f3ef6a08f2b", "message": "fix issue (https://github.com/wso2/product-is/issues/7876) with IDP listing in oracle and support the required attribute query filtering in oracle.", "committedDate": "2020-03-16T08:06:14Z", "type": "commit"}, {"oid": "1d69f34e9ce9dd9d7dfacd8e3f593e6e017d0747", "url": "https://github.com/wso2/carbon-identity-framework/commit/1d69f34e9ce9dd9d7dfacd8e3f593e6e017d0747", "message": "Fix review comments", "committedDate": "2020-03-16T09:39:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzAwNDkzMw==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2821#discussion_r393004933", "bodyText": "do we need this null check since we are already checking it at line 575", "author": "emswbandara", "createdAt": "2020-03-16T12:59:21Z", "path": "components/idp-mgt/org.wso2.carbon.idp.mgt/src/main/java/org/wso2/carbon/idp/mgt/dao/IdPManagementDAO.java", "diffHunk": "@@ -403,48 +444,105 @@ private ResultSet getIdpQueryResultSet(Connection dbConnection, String sortedOrd\n         return prepStmt.executeQuery();\n     }\n \n+    /**\n+     * Add requested required attributes in the SQL query.\n+     *\n+     * @param sqlQuery           SQL query which need to be modify.\n+     * @param requiredAttributes Required attributes which needs to be return.\n+     * @return modified SQL query.\n+     */\n+    private String appendRequiredAttributes(String sqlQuery, List<String> requiredAttributes)\n+            throws IdentityProviderManagementClientException {\n+\n+        if (CollectionUtils.isNotEmpty(requiredAttributes)) {\n+            for (String attribute : requiredAttributes) {\n+                switch (attribute) {\n+                    case IdPManagementConstants.IDP_UUID:\n+                        // Skip since it is basic attribute which is by default added.\n+                        break;\n+                    case IdPManagementConstants.IDP_NAME:\n+                        // Skip since it is basic attribute which is by default added.\n+                        break;\n+                    case IdPManagementConstants.IDP_DESCRIPTION:\n+                        // Skip since it is basic attribute which is by default added.\n+                        break;\n+                    case IdPManagementConstants.IDP_IS_ENABLED:\n+                        // Skip since it is basic attribute which is by default added.\n+                        break;\n+                    case IdPManagementConstants.IDP_IMAGE_URL:\n+                        // Skip since it is basic attribute which is by default added.\n+                        break;\n+                    case IdPManagementConstants.IDP_IS_PRIMARY:\n+                        sqlQuery += \", \" + IdPManagementConstants.IS_PRIMARY + \" \";\n+                        break;\n+                    case IdPManagementConstants.IDP_HOME_REALM_ID:\n+                        sqlQuery += \", \" + IdPManagementConstants.HOME_REALM_ID + \" \";\n+                        break;\n+                    case IdPManagementConstants.IDP_IS_FEDERATION_HUB:\n+                        sqlQuery += \", \" + IdPManagementConstants.IS_FEDERATION_HUB + \" \";\n+                        break;\n+                    case IdPManagementConstants.IDP_CERTIFICATE:\n+                        sqlQuery += \", \" + IdPManagementConstants.CERTIFICATE + \" \";\n+                        break;\n+                    case IdPManagementConstants.IDP_ALIAS:\n+                        sqlQuery += \", \" + IdPManagementConstants.ALIAS + \" \";\n+                        break;\n+                    case IdPManagementConstants.IDP_CLAIMS:\n+                        sqlQuery += \", \" + IdPManagementConstants.CLAIMS + \" \";\n+                        break;\n+                    case IdPManagementConstants.IDP_ROLES:\n+                        sqlQuery += \", \" + IdPManagementConstants.ROLES + \" \";\n+                        break;\n+                    case IdPManagementConstants.IDP_FEDERATED_AUTHENTICATORS:\n+                        sqlQuery += \", \" + IdPManagementConstants.FEDERATED_AUTHENTICATORS + \" \";\n+                        break;\n+                    case IdPManagementConstants.IDP_PROVISIONING:\n+                        sqlQuery += \", \" + IdPManagementConstants.PROVISIONING + \" \";\n+                        break;\n+                    default:\n+                        throw IdPManagementUtil.handleClientException(\n+                                IdPManagementConstants.ErrorMessage.ERROR_CODE_IDP_ATTRIBUTE_INVALID, attribute);\n+                }\n+            }\n+        }\n+        return sqlQuery;\n+    }\n+\n     /**\n      * Populate the result set.\n      *\n-     * @param resultSet    resultSet.\n-     * @param dbConnection database Connection.\n+     * @param resultSet          ResultSet.\n+     * @param dbConnection       Database Connection.\n+     * @param requiredAttributes Required attributes which needs to be return.\n+     * @param tenantId           Tenant Id of the identity provider.\n      * @return List of Identity Provider.\n      * @throws SQLException Database Exception.\n      */\n-    private List<IdentityProvider> populateIdentityProviderList(ResultSet resultSet, Connection dbConnection)\n-            throws SQLException {\n+    private List<IdentityProvider> populateIdentityProviderList(ResultSet resultSet, Connection dbConnection,\n+                                                                List<String> requiredAttributes, int tenantId)\n+            throws SQLException, IdentityProviderManagementServerException {\n \n         List<IdentityProvider> identityProviderList = new ArrayList<>();\n         while (resultSet.next()) {\n             IdentityProvider identityProvider = new IdentityProvider();\n-            identityProvider.setIdentityProviderName(resultSet.getString(1));\n-            if ((IdPManagementConstants.IS_TRUE_VALUE).equals(resultSet.getString(\"IS_PRIMARY\"))) {\n-                identityProvider.setPrimary(true);\n-            } else {\n-                identityProvider.setPrimary(false);\n-            }\n-            identityProvider.setHomeRealmId(resultSet.getString(\"HOME_REALM_ID\"));\n+            // First set the basic attributes such as id, name, description, isEnabled, image url, uuid.\n+            identityProvider.setId(resultSet.getString(\"ID\"));\n+            identityProvider.setIdentityProviderName(resultSet.getString(\"NAME\"));\n             identityProvider.setIdentityProviderDescription(resultSet.getString(\"DESCRIPTION\"));\n-            // IS_FEDERATION_HUB_IDP\n-            if ((IdPManagementConstants.IS_TRUE_VALUE).equals(resultSet.getString(\"IS_FEDERATION_HUB\"))) {\n-                identityProvider.setFederationHub(false);\n-            }\n-            // IS_LOCAL_CLAIM_DIALECT\n-            if ((IdPManagementConstants.IS_TRUE_VALUE).equals(resultSet.getString(\"IS_LOCAL_CLAIM_DIALECT\"))) {\n-                if (identityProvider.getClaimConfig() == null) {\n-                    identityProvider.setClaimConfig(new ClaimConfig());\n-                }\n-                identityProvider.getClaimConfig().setLocalClaimDialect(true);\n-            }\n             // IS_ENABLE\n             if ((IdPManagementConstants.IS_TRUE_VALUE).equals(resultSet.getString(\"IS_ENABLED\"))) {\n                 identityProvider.setEnable(true);\n             } else {\n                 identityProvider.setEnable(false);\n             }\n-            identityProvider.setDisplayName(resultSet.getString(\"DISPLAY_NAME\"));\n             identityProvider.setImageUrl(resultSet.getString(\"IMAGE_URL\"));\n             identityProvider.setResourceId(resultSet.getString(\"UUID\"));\n+\n+            if (requiredAttributes != null) {", "originalCommit": "1d69f34e9ce9dd9d7dfacd8e3f593e6e017d0747", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzAxNjUyMQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2821#discussion_r393016521", "bodyText": "fixed", "author": "sarubi", "createdAt": "2020-03-16T13:20:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzAwNDkzMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzAwNTc3Nw==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2821#discussion_r393005777", "bodyText": "is this comment change needed", "author": "emswbandara", "createdAt": "2020-03-16T13:00:51Z", "path": "components/idp-mgt/org.wso2.carbon.idp.mgt/src/main/java/org/wso2/carbon/idp/mgt/IdentityProviderManagementService.java", "diffHunk": "@@ -123,7 +123,7 @@ public int getAllIdpCount() throws IdentityProviderManagementException {\n      * Retrieves registered Identity providers for the logged-in tenant.\n      *\n      * @return Array of <code>IdentityProvider</code>. IdP names, primary IdP and home.\n-     * realm identifiers of each IdP.\n+     * realm identifiers of each IdP.getIdPs", "originalCommit": "1d69f34e9ce9dd9d7dfacd8e3f593e6e017d0747", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "5e055beb8788b8385e898dca1d263360d5637b01", "url": "https://github.com/wso2/carbon-identity-framework/commit/5e055beb8788b8385e898dca1d263360d5637b01", "message": "add default implementation for getIdPs", "committedDate": "2020-03-16T13:16:57Z", "type": "commit"}, {"oid": "226df7320e041e91a2e16b3ec370824713be7e97", "url": "https://github.com/wso2/carbon-identity-framework/commit/226df7320e041e91a2e16b3ec370824713be7e97", "message": "refactored", "committedDate": "2020-03-16T13:19:39Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzA5MjcwMQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2821#discussion_r393092701", "bodyText": "throws statement needs to be updated", "author": "emswbandara", "createdAt": "2020-03-16T15:04:13Z", "path": "components/idp-mgt/org.wso2.carbon.idp.mgt/src/main/java/org/wso2/carbon/idp/mgt/IdpManager.java", "diffHunk": "@@ -85,10 +85,34 @@ void updateResidentIdP(IdentityProvider identityProvider, String tenantDomain) t\n      * @return Identity Provider's Basic Information array {@link IdpSearchResult}.\n      * @throws IdentityProviderManagementServerException server related error when getting list of Identity  Providers.\n      * @throws IdentityProviderManagementClientException client related error when getting list of Identity  Providers.\n+     * @deprecated use {@link #getIdPs(Integer, Integer, String, String, String, String, List)} instead.\n      */\n     IdpSearchResult getIdPs(Integer limit, Integer offset, String filter, String sortOrder, String sortBy,\n                             String tenantDomain)\n-            throws IdentityProviderManagementServerException, IdentityProviderManagementClientException;\n+            throws IdentityProviderManagementException;\n+\n+    /**\n+     * Get all identity provider's Basic information along with additionally requested information depends on the\n+     * requiredAttributes.\n+     *\n+     * @param limit              Limit per page.\n+     * @param offset             Offset value.\n+     * @param filter             Filter value for IdP search.\n+     * @param sortOrder          Order of IdP ASC/DESC.\n+     * @param sortBy             The column value need to sort.\n+     * @param tenantDomain       TenantDomain of the user.\n+     * @param requiredAttributes Required attributes which needs to be return.\n+     * @return Identity Provider's Basic Information array along with requested attribute\n+     * information{@link IdpSearchResult}.\n+     * @throws IdentityProviderManagementServerException server related error when getting list of Identity Providers.", "originalCommit": "226df7320e041e91a2e16b3ec370824713be7e97", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzQ0ODUwMw==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2821#discussion_r393448503", "bodyText": "fixed", "author": "sarubi", "createdAt": "2020-03-17T05:13:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzA5MjcwMQ=="}], "type": "inlineReview"}, {"oid": "73fed08d5adb349b58cc79202c1e303325cfad98", "url": "https://github.com/wso2/carbon-identity-framework/commit/73fed08d5adb349b58cc79202c1e303325cfad98", "message": "refactored", "committedDate": "2020-03-17T05:11:56Z", "type": "commit"}]}