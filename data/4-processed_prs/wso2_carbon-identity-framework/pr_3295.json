{"pr_number": 3295, "pr_title": "Fix getUserList issue when username list is changed via old listeners", "pr_createdAt": "2020-12-17T05:05:08Z", "pr_url": "https://github.com/wso2/carbon-identity-framework/pull/3295", "timeline": [{"oid": "66dd93f10ea1fafd78c1e91d625ee743972e8aa4", "url": "https://github.com/wso2/carbon-identity-framework/commit/66dd93f10ea1fafd78c1e91d625ee743972e8aa4", "message": "Reflect updated users retrieved from listeners.", "committedDate": "2020-12-17T05:02:44Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDgxODQ5NA==", "url": "https://github.com/wso2/carbon-identity-framework/pull/3295#discussion_r544818494", "bodyText": "resolveUserIdFromUsername, This method can be returned an empty user-id right? Don't we need to check its emptiness?", "author": "Thumimku", "createdAt": "2020-12-17T05:16:40Z", "path": "components/identity-mgt/org.wso2.carbon.identity.mgt/src/main/java/org/wso2/carbon/identity/mgt/listener/IdentityUserNameResolverListener.java", "diffHunk": "@@ -797,6 +804,36 @@ public boolean doPreGetUserListWithID(String claimUri, String claimValue, List<U\n             }\n         }\n \n+        // Reflect newly removed users by listeners in returnUsersList\n+        if (CollectionUtils.isNotEmpty(returnUserNamesList)) {\n+            tempUserNamesList.addAll(returnInitialUserNamesList);\n+            tempUserNamesList.removeAll(returnUserNamesList);\n+            for (User user : returnUsersList) {\n+                if (tempUserNamesList.contains(user.getUsername())) {\n+                    returnUsersList.remove(user);\n+                }\n+            }\n+            tempUserNamesList.clear();\n+        }\n+\n+        // Reflect newly add users by listeners in returnUsersList\n+        if (CollectionUtils.isNotEmpty(returnUserNamesList)) {\n+            tempUserNamesList.addAll(returnUserNamesList);\n+            tempUserNamesList.removeAll(returnInitialUserNamesList);\n+            for (String username : tempUserNamesList) {\n+                User newUser = new User();\n+                newUser.setUsername(username);\n+                try {\n+                    newUser.setUserID(FrameworkUtils.resolveUserIdFromUsername(userStoreManager, username));", "originalCommit": "66dd93f10ea1fafd78c1e91d625ee743972e8aa4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDgyMjQ3Mg==", "url": "https://github.com/wso2/carbon-identity-framework/pull/3295#discussion_r544822472", "bodyText": "This won't send empty id. It will create a new id if user doesn't have one.  Even if it is empty we don't need to handle it here as our main intension is to get the username", "author": "inthirakumaaran", "createdAt": "2020-12-17T05:28:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDgxODQ5NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDgyMjc3OA==", "url": "https://github.com/wso2/carbon-identity-framework/pull/3295#discussion_r544822778", "bodyText": "ACK, that's why we don't throw the exception just logging.", "author": "Thumimku", "createdAt": "2020-12-17T05:29:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDgxODQ5NA=="}], "type": "inlineReview"}]}