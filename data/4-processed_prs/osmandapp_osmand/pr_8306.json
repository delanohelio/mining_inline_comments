{"pr_number": 8306, "pr_title": "Routing region fix #7668", "pr_createdAt": "2020-01-23T16:36:16Z", "pr_url": "https://github.com/osmandapp/OsmAnd/pull/8306", "timeline": [{"oid": "e5ca877802513c40514638a0b4f6cbc87760b223", "url": "https://github.com/osmandapp/OsmAnd/commit/e5ca877802513c40514638a0b4f6cbc87760b223", "message": "fix defining driving region #7668", "committedDate": "2020-01-23T08:19:06Z", "type": "commit"}, {"oid": "d0aaddf28c88e4647cd7d88585ebef5e2df7e21c", "url": "https://github.com/osmandapp/OsmAnd/commit/d0aaddf28c88e4647cd7d88585ebef5e2df7e21c", "message": "fix defining driving region 2 #7668", "committedDate": "2020-01-23T08:40:24Z", "type": "commit"}, {"oid": "42a7a5d88dc183444fba4fe09f76a87f9c598d69", "url": "https://github.com/osmandapp/OsmAnd/commit/42a7a5d88dc183444fba4fe09f76a87f9c598d69", "message": "fix defining driving region 3 #7668", "committedDate": "2020-01-23T16:31:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI2MDU2Ng==", "url": "https://github.com/osmandapp/OsmAnd/pull/8306#discussion_r370260566", "bodyText": "should be stored offfline in settings", "author": "vshcherb", "createdAt": "2020-01-23T17:40:20Z", "path": "OsmAnd/src/net/osmand/plus/routing/RoutingHelper.java", "diffHunk": "@@ -57,6 +57,7 @@\n \tprivate List<LatLon> intermediatePoints;\n \tprivate Location lastProjection;\n \tprivate Location lastFixedLocation;\n+\tprivate LatLon lastStartLocation = null;", "originalCommit": "42a7a5d88dc183444fba4fe09f76a87f9c598d69", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDUyMzE3Mg==", "url": "https://github.com/osmandapp/OsmAnd/pull/8306#discussion_r370523172", "bodyText": "fixed", "author": "MadWasp79", "createdAt": "2020-01-24T08:46:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI2MDU2Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI2MTI2MQ==", "url": "https://github.com/osmandapp/OsmAnd/pull/8306#discussion_r370261261", "bodyText": "Constant ?", "author": "vshcherb", "createdAt": "2020-01-23T17:41:40Z", "path": "OsmAnd/src/net/osmand/plus/routing/RoutingHelper.java", "diffHunk": "@@ -260,6 +262,17 @@ public LatLon getFinalLocation() {\n \t\treturn finalLocation;\n \t}\n \n+\tpublic void cacheStartLocation(Location nextStartLocation) {\n+\t\tLatLon start = new LatLon(nextStartLocation.getLatitude(), nextStartLocation.getLongitude());\n+\t\tif (lastStartLocation == null) {\n+\t\t\tlastStartLocation = new LatLon(nextStartLocation.getLatitude(), nextStartLocation.getLongitude());\n+\t\t\tapp.getMapViewTrackingUtilities().detectDrivingRegion(lastStartLocation);\n+\t\t} else if (MapUtils.getDistance(start, lastStartLocation) > 100000) {", "originalCommit": "42a7a5d88dc183444fba4fe09f76a87f9c598d69", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI2MTU4Mw==", "url": "https://github.com/osmandapp/OsmAnd/pull/8306#discussion_r370261583", "bodyText": "Could be 1 line \"lastStartLocation == null || MapUtils.getDistance(start, lastStartLocation) < CACHE_RADIUS )", "author": "vshcherb", "createdAt": "2020-01-23T17:42:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI2MTI2MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDUyMzE0OQ==", "url": "https://github.com/osmandapp/OsmAnd/pull/8306#discussion_r370523149", "bodyText": "fixed", "author": "MadWasp79", "createdAt": "2020-01-24T08:46:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI2MTI2MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI2MTcyOA==", "url": "https://github.com/osmandapp/OsmAnd/pull/8306#discussion_r370261728", "bodyText": "cacheStartLocation method name is wrong ?", "author": "vshcherb", "createdAt": "2020-01-23T17:42:38Z", "path": "OsmAnd/src/net/osmand/plus/routing/RoutingHelper.java", "diffHunk": "@@ -260,6 +262,17 @@ public LatLon getFinalLocation() {\n \t\treturn finalLocation;\n \t}\n \n+\tpublic void cacheStartLocation(Location nextStartLocation) {", "originalCommit": "42a7a5d88dc183444fba4fe09f76a87f9c598d69", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDUyMzE2NA==", "url": "https://github.com/osmandapp/OsmAnd/pull/8306#discussion_r370523164", "bodyText": "fixed", "author": "MadWasp79", "createdAt": "2020-01-24T08:46:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI2MTcyOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI2MTkzNg==", "url": "https://github.com/osmandapp/OsmAnd/pull/8306#discussion_r370261936", "bodyText": "Potentially duplicate WorldRegion from BinaryMapDataObject is not fixed here!", "author": "vshcherb", "createdAt": "2020-01-23T17:43:04Z", "path": "OsmAnd-java/src/main/java/net/osmand/map/OsmandRegions.java", "diffHunk": "@@ -743,17 +743,8 @@ public BinaryMapDataObject getSmallestBinaryMapDataObjectAt(List<BinaryMapDataOb\n \t\t\twhile (it.hasNext()) {\n \t\t\t\tBinaryMapDataObject o = it.next();\n \t\t\t\tif (o.getTypes() != null) {\n-\t\t\t\t\tboolean isRegion = true;\n-\t\t\t\t\tfor (int i = 0; i < o.getTypes().length; i++) {\n-\t\t\t\t\t\tTagValuePair tp = o.getMapIndex().decodeType(o.getTypes()[i]);\n-\t\t\t\t\t\tif (\"boundary\".equals(tp.value)) {\n-\t\t\t\t\t\t\tisRegion = false;\n-\t\t\t\t\t\t\tbreak;\n-\t\t\t\t\t\t}\n-\t\t\t\t\t}\n \t\t\t\t\tWorldRegion downloadRegion = getRegionData(getFullName(o));\n-\t\t\t\t\tif (!isRegion\n-\t\t\t\t\t\t\t|| downloadRegion == null\n+\t\t\t\t\tif ( downloadRegion == null", "originalCommit": "42a7a5d88dc183444fba4fe09f76a87f9c598d69", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "576c4330b46efe2b1c04d70cc847c6ecad0d298d", "url": "https://github.com/osmandapp/OsmAnd/commit/576c4330b46efe2b1c04d70cc847c6ecad0d298d", "message": "refactoring and fixes", "committedDate": "2020-01-24T13:51:27Z", "type": "commit"}, {"oid": "315e1c38a77fad5e50ce0960e0ea332630993cb6", "url": "https://github.com/osmandapp/OsmAnd/commit/315e1c38a77fad5e50ce0960e0ea332630993cb6", "message": "typo", "committedDate": "2020-01-24T14:34:01Z", "type": "commit"}]}