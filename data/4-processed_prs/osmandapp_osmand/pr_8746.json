{"pr_number": 8746, "pr_title": "Drawer logo", "pr_createdAt": "2020-04-01T17:15:02Z", "pr_url": "https://github.com/osmandapp/OsmAnd/pull/8746", "timeline": [{"oid": "6ec5d526a81dd94623439ff99ac5a76e2e23b557", "url": "https://github.com/osmandapp/OsmAnd/commit/6ec5d526a81dd94623439ff99ac5a76e2e23b557", "message": "Add branding profile logo", "committedDate": "2020-04-01T15:49:49Z", "type": "commit"}, {"oid": "63e4716708eb6b1ec014dd36207d31f86a865437", "url": "https://github.com/osmandapp/OsmAnd/commit/63e4716708eb6b1ec014dd36207d31f86a865437", "message": "Add check for osf extension in folder name", "committedDate": "2020-04-01T16:24:08Z", "type": "commit"}, {"oid": "50577f3f323dd06111ea297ef4536b64decb921d", "url": "https://github.com/osmandapp/OsmAnd/commit/50577f3f323dd06111ea297ef4536b64decb921d", "message": "Remove nav drawer footer", "committedDate": "2020-04-01T16:46:02Z", "type": "commit"}, {"oid": "2fac0833cc7691fcb715d3b3ae16588e5b73be26", "url": "https://github.com/osmandapp/OsmAnd/commit/2fac0833cc7691fcb715d3b3ae16588e5b73be26", "message": "Fix plugin dependent quick actions", "committedDate": "2020-04-03T11:02:17Z", "type": "commit"}, {"oid": "5d65373647c4927b8f902e668a94c6b97358cb10", "url": "https://github.com/osmandapp/OsmAnd/commit/5d65373647c4927b8f902e668a94c6b97358cb10", "message": "Remove unnecessary changes and move formatWarnings to android utils", "committedDate": "2020-04-03T12:23:57Z", "type": "commit"}, {"oid": "649f7e594b4b88e5d2173f1f1f5cf71e273d4aee", "url": "https://github.com/osmandapp/OsmAnd/commit/649f7e594b4b88e5d2173f1f1f5cf71e273d4aee", "message": "Add warnings to settings items", "committedDate": "2020-04-03T14:07:41Z", "type": "commit"}, {"oid": "16a52a0b5dab9f0e202821ae37d399ca6078b7cc", "url": "https://github.com/osmandapp/OsmAnd/commit/16a52a0b5dab9f0e202821ae37d399ca6078b7cc", "message": "Merge branch 'master' of https://github.com/osmandapp/Osmand into import_fixes\n\n# Conflicts:\n#\tOsmAnd/res/values/strings.xml", "committedDate": "2020-04-03T14:10:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzA4MzM0MA==", "url": "https://github.com/osmandapp/OsmAnd/pull/8746#discussion_r403083340", "bodyText": "No ignore should always be in logs", "author": "vshcherb", "createdAt": "2020-04-03T15:23:37Z", "path": "OsmAnd/src/net/osmand/plus/OsmAndAppCustomization.java", "diffHunk": "@@ -227,18 +255,43 @@ public Bitmap getNavDrawerLogo() {\n \t}\n \n \tpublic boolean setNavDrawerLogo(String uri, @Nullable String packageName, @Nullable String intent) {\n+\t\tString connectedAppDirPath = IndexConstants.PLUGINS_DIR + packageName;\n+\t\tFile connectedAppDir = app.getAppPath(connectedAppDirPath);\n \t\tif (TextUtils.isEmpty(uri)) {\n-\t\t\tnavDrawerLogo = null;\n+\t\t\tapp.getSettings().NAV_DRAWER_LOGO.resetToDefault();\n+\t\t\tAlgorithms.removeAllFiles(connectedAppDir);\n \t\t} else {\n \t\t\ttry {\n-\t\t\t\tInputStream is = app.getContentResolver().openInputStream(Uri.parse(uri));\n+\t\t\t\tUri fileUri = Uri.parse(uri);\n+\t\t\t\tInputStream is = app.getContentResolver().openInputStream(fileUri);\n \t\t\t\tif (is != null) {\n-\t\t\t\t\tnavDrawerLogo = BitmapFactory.decodeStream(is);\n-\t\t\t\t\tis.close();\n-\n+\t\t\t\t\tString iconName = ImportHelper.getNameFromContentUri(app, fileUri);\n+\t\t\t\t\tif (!connectedAppDir.exists()) {\n+\t\t\t\t\t\tconnectedAppDir.mkdirs();\n+\t\t\t\t\t}\n+\t\t\t\t\tOutputStream fout = new FileOutputStream(new File(connectedAppDir, iconName));\n+\t\t\t\t\ttry {\n+\t\t\t\t\t\tAlgorithms.streamCopy(is, fout);\n+\t\t\t\t\t} finally {\n+\t\t\t\t\t\ttry {\n+\t\t\t\t\t\t\tis.close();\n+\t\t\t\t\t\t} catch (IOException e) {\n+\t\t\t\t\t\t\te.printStackTrace();\n+\t\t\t\t\t\t}\n+\t\t\t\t\t\ttry {\n+\t\t\t\t\t\t\tfout.close();\n+\t\t\t\t\t\t} catch (IOException e) {\n+\t\t\t\t\t\t\te.printStackTrace();\n+\t\t\t\t\t\t}\n+\t\t\t\t\t}\n+\t\t\t\t\tJSONObject json = new JSONObject();\n+\t\t\t\t\tjson.put(\"\", connectedAppDirPath + \"/\" + iconName);\n+\t\t\t\t\tapp.getSettings().NAV_DRAWER_LOGO.set(json.toString());\n \t\t\t\t}\n \t\t\t} catch (FileNotFoundException e) {\n \t\t\t\treturn false;\n+\t\t\t} catch (JSONException e) {", "originalCommit": "16a52a0b5dab9f0e202821ae37d399ca6078b7cc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzA4MzQxNg==", "url": "https://github.com/osmandapp/OsmAnd/pull/8746#discussion_r403083416", "bodyText": "Use logging system", "author": "vshcherb", "createdAt": "2020-04-03T15:23:44Z", "path": "OsmAnd/src/net/osmand/plus/OsmAndAppCustomization.java", "diffHunk": "@@ -227,18 +255,43 @@ public Bitmap getNavDrawerLogo() {\n \t}\n \n \tpublic boolean setNavDrawerLogo(String uri, @Nullable String packageName, @Nullable String intent) {\n+\t\tString connectedAppDirPath = IndexConstants.PLUGINS_DIR + packageName;\n+\t\tFile connectedAppDir = app.getAppPath(connectedAppDirPath);\n \t\tif (TextUtils.isEmpty(uri)) {\n-\t\t\tnavDrawerLogo = null;\n+\t\t\tapp.getSettings().NAV_DRAWER_LOGO.resetToDefault();\n+\t\t\tAlgorithms.removeAllFiles(connectedAppDir);\n \t\t} else {\n \t\t\ttry {\n-\t\t\t\tInputStream is = app.getContentResolver().openInputStream(Uri.parse(uri));\n+\t\t\t\tUri fileUri = Uri.parse(uri);\n+\t\t\t\tInputStream is = app.getContentResolver().openInputStream(fileUri);\n \t\t\t\tif (is != null) {\n-\t\t\t\t\tnavDrawerLogo = BitmapFactory.decodeStream(is);\n-\t\t\t\t\tis.close();\n-\n+\t\t\t\t\tString iconName = ImportHelper.getNameFromContentUri(app, fileUri);\n+\t\t\t\t\tif (!connectedAppDir.exists()) {\n+\t\t\t\t\t\tconnectedAppDir.mkdirs();\n+\t\t\t\t\t}\n+\t\t\t\t\tOutputStream fout = new FileOutputStream(new File(connectedAppDir, iconName));\n+\t\t\t\t\ttry {\n+\t\t\t\t\t\tAlgorithms.streamCopy(is, fout);\n+\t\t\t\t\t} finally {\n+\t\t\t\t\t\ttry {\n+\t\t\t\t\t\t\tis.close();\n+\t\t\t\t\t\t} catch (IOException e) {\n+\t\t\t\t\t\t\te.printStackTrace();\n+\t\t\t\t\t\t}\n+\t\t\t\t\t\ttry {\n+\t\t\t\t\t\t\tfout.close();\n+\t\t\t\t\t\t} catch (IOException e) {\n+\t\t\t\t\t\t\te.printStackTrace();", "originalCommit": "16a52a0b5dab9f0e202821ae37d399ca6078b7cc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzA4Mzc2NA==", "url": "https://github.com/osmandapp/OsmAnd/pull/8746#discussion_r403083764", "bodyText": "ArrayList -> List", "author": "vshcherb", "createdAt": "2020-04-03T15:24:13Z", "path": "OsmAnd/src/net/osmand/plus/osmedit/OsmEditingPlugin.java", "diffHunk": "@@ -139,10 +140,12 @@ public OsmBugsDbHelper getDBBug() {\n //\tprivate EditingPOIDialogProvider poiActions;\n \n \t@Override\n-\tprotected void registerQuickActionTypes(List<QuickActionType> quickActionTypes) {\n+\tprotected List<QuickActionType> getQuickActionTypes() {\n+\t\tArrayList<QuickActionType> quickActionTypes = new ArrayList<>();", "originalCommit": "16a52a0b5dab9f0e202821ae37d399ca6078b7cc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "6438de2c82b126307f481791ddf2bbc8cf78d597", "url": "https://github.com/osmandapp/OsmAnd/commit/6438de2c82b126307f481791ddf2bbc8cf78d597", "message": "Add logs to nav drawer logo loading", "committedDate": "2020-04-03T15:33:19Z", "type": "commit"}, {"oid": "32ddf71193682787f78e0f06bbf0393f81292be3", "url": "https://github.com/osmandapp/OsmAnd/commit/32ddf71193682787f78e0f06bbf0393f81292be3", "message": "Remove explicit list type from quickActionTypes", "committedDate": "2020-04-03T15:39:19Z", "type": "commit"}, {"oid": "feb6d11fe0993ac165cd1f156bfff298fec7c201", "url": "https://github.com/osmandapp/OsmAnd/commit/feb6d11fe0993ac165cd1f156bfff298fec7c201", "message": "Add missing log", "committedDate": "2020-04-03T15:41:27Z", "type": "commit"}]}