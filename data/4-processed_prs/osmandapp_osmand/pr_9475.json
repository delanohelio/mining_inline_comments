{"pr_number": 9475, "pr_title": "Add rotation to setMapLocation API", "pr_createdAt": "2020-07-18T10:14:11Z", "pr_url": "https://github.com/osmandapp/OsmAnd/pull/9475", "timeline": [{"oid": "fac63e2cb3565d03ae65d715476eec44f826260f", "url": "https://github.com/osmandapp/OsmAnd/commit/fac63e2cb3565d03ae65d715476eec44f826260f", "message": "Add rotation to setMapLocation API", "committedDate": "2020-07-18T10:10:30Z", "type": "commit"}, {"oid": "5d61f19511b78bba59543592eb2c0077e2000ffd", "url": "https://github.com/osmandapp/OsmAnd/commit/5d61f19511b78bba59543592eb2c0077e2000ffd", "message": "Minor change, remove newline", "committedDate": "2020-07-18T11:40:02Z", "type": "commit"}, {"oid": "743eaf19d0cf1b328dafd58d9a0d7c3b1091435c", "url": "https://github.com/osmandapp/OsmAnd/commit/743eaf19d0cf1b328dafd58d9a0d7c3b1091435c", "message": "Minor change, style", "committedDate": "2020-07-18T11:44:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjkwOTU3OQ==", "url": "https://github.com/osmandapp/OsmAnd/pull/9475#discussion_r456909579", "bodyText": "new fields always should be last parameter\ncc @Chumva", "author": "vshcherb", "createdAt": "2020-07-19T13:33:46Z", "path": "OsmAnd-api/src/net/osmand/aidlapi/map/SetMapLocationParams.java", "diffHunk": "@@ -56,6 +66,7 @@ public void writeToBundle(Bundle bundle) {\n \t\tbundle.putDouble(\"latitude\", latitude);\n \t\tbundle.putDouble(\"longitude\", longitude);\n \t\tbundle.putInt(\"zoom\", zoom);", "originalCommit": "743eaf19d0cf1b328dafd58d9a0d7c3b1091435c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjkxMDUwMw==", "url": "https://github.com/osmandapp/OsmAnd/pull/9475#discussion_r456910503", "bodyText": "It is ok to add new fields in Bundle in a different order because values are stored with keys. But preferably add them at the end for better understanding differences among versions. But in parcelable order of written and read values is important and changes in it will break reading values.", "author": "Chumva", "createdAt": "2020-07-19T13:42:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjkwOTU3OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjkyMDA5Ng==", "url": "https://github.com/osmandapp/OsmAnd/pull/9475#discussion_r456920096", "bodyText": "Do you think it's better to reorder everything even the parameters order in the constructor, or just the putFloat?", "author": "ehermann", "createdAt": "2020-07-19T15:10:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjkwOTU3OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjkyMTE4Mg==", "url": "https://github.com/osmandapp/OsmAnd/pull/9475#discussion_r456921182", "bodyText": "putFloat and getFloat will be enough", "author": "Chumva", "createdAt": "2020-07-19T15:20:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjkwOTU3OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjkxMDU3Mg==", "url": "https://github.com/osmandapp/OsmAnd/pull/9475#discussion_r456910572", "bodyText": "This one should be written last.", "author": "Chumva", "createdAt": "2020-07-19T13:43:54Z", "path": "OsmAnd-telegram/src/net/osmand/aidl/map/SetMapLocationParams.java", "diffHunk": "@@ -52,13 +63,15 @@ public void writeToParcel(Parcel out, int flags) {\n \t\tout.writeDouble(latitude);\n \t\tout.writeDouble(longitude);\n \t\tout.writeInt(zoom);\n+\t\tout.writeFloat(rotation);", "originalCommit": "743eaf19d0cf1b328dafd58d9a0d7c3b1091435c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjkxMDYzMA==", "url": "https://github.com/osmandapp/OsmAnd/pull/9475#discussion_r456910630", "bodyText": "Also, read the new value in the end.", "author": "Chumva", "createdAt": "2020-07-19T13:44:29Z", "path": "OsmAnd-telegram/src/net/osmand/aidl/map/SetMapLocationParams.java", "diffHunk": "@@ -52,13 +63,15 @@ public void writeToParcel(Parcel out, int flags) {\n \t\tout.writeDouble(latitude);\n \t\tout.writeDouble(longitude);\n \t\tout.writeInt(zoom);\n+\t\tout.writeFloat(rotation);\n \t\tout.writeByte((byte) (animated ? 1 : 0));\n \t}\n \n \tprivate void readFromParcel(Parcel in) {\n \t\tlatitude = in.readDouble();\n \t\tlongitude = in.readDouble();\n \t\tzoom = in.readInt();\n+\t\trotation = in.readFloat();", "originalCommit": "743eaf19d0cf1b328dafd58d9a0d7c3b1091435c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjkxMDg0OA==", "url": "https://github.com/osmandapp/OsmAnd/pull/9475#discussion_r456910848", "bodyText": "Probably it is better to use !Float.isNaN() because this expression might be true even if rotation is NaN.", "author": "Chumva", "createdAt": "2020-07-19T13:46:08Z", "path": "OsmAnd/src/net/osmand/aidl/OsmandAidlApi.java", "diffHunk": "@@ -300,6 +302,9 @@ public void onReceive(Context context, Intent intent) {\n \t\t\t\t\t\t\tzoom = zoom > mapView.getMaxZoom() ? mapView.getMaxZoom() : zoom;\n \t\t\t\t\t\t\tzoom = zoom < mapView.getMinZoom() ? mapView.getMinZoom() : zoom;\n \t\t\t\t\t\t}\n+\t\t\t\t\t\tif(rotation != Float.NaN) {", "originalCommit": "743eaf19d0cf1b328dafd58d9a0d7c3b1091435c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjkxMTEyNA==", "url": "https://github.com/osmandapp/OsmAnd/pull/9475#discussion_r456911124", "bodyText": "The second constructor is not necessary for backwards compatibility, the only order of written and read values is important, except for some situations with lists of items.", "author": "Chumva", "createdAt": "2020-07-19T13:49:02Z", "path": "OsmAnd/src/net/osmand/aidl/map/SetMapLocationParams.java", "diffHunk": "@@ -8,12 +8,18 @@\n \tprivate double latitude;\n \tprivate double longitude;\n \tprivate int zoom;\n+\tprivate float rotation;\n \tprivate boolean animated;\n \n \tpublic SetMapLocationParams(double latitude, double longitude, int zoom, boolean animated) {\n+\t\tthis(latitude, longitude, zoom, Float.NaN, animated);", "originalCommit": "743eaf19d0cf1b328dafd58d9a0d7c3b1091435c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e87ed289c7aef40f6646eec65d76d6a46d51decc", "url": "https://github.com/osmandapp/OsmAnd/commit/e87ed289c7aef40f6646eec65d76d6a46d51decc", "message": "applied suggestions from reviewers:\nreorder puFloat and getFload, and removing additional constructor", "committedDate": "2020-07-19T15:40:45Z", "type": "commit"}, {"oid": "1ad893c3da3d4c78810f2a6bfb299b2169b37873", "url": "https://github.com/osmandapp/OsmAnd/commit/1ad893c3da3d4c78810f2a6bfb299b2169b37873", "message": "Minor fix, forgot to update Osmand-Telegram", "committedDate": "2020-07-19T15:54:26Z", "type": "commit"}]}