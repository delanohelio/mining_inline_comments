{"pr_number": 9932, "pr_title": "Issue 175 osmedit use oauth", "pr_createdAt": "2020-10-02T12:10:38Z", "pr_url": "https://github.com/osmandapp/OsmAnd/pull/9932", "timeline": [{"oid": "cc107157fcc72062930dc41db77f10587093a708", "url": "https://github.com/osmandapp/OsmAnd/commit/cc107157fcc72062930dc41db77f10587093a708", "message": "oauth authtoken saved", "committedDate": "2020-09-30T11:34:14Z", "type": "commit"}, {"oid": "6d0e76095fa72cc2efd0e97797448eeae43f85c8", "url": "https://github.com/osmandapp/OsmAnd/commit/6d0e76095fa72cc2efd0e97797448eeae43f85c8", "message": "saving state", "committedDate": "2020-09-30T14:00:02Z", "type": "commit"}, {"oid": "689ebf5b75598182772139cbef7a71eb8544065d", "url": "https://github.com/osmandapp/OsmAnd/commit/689ebf5b75598182772139cbef7a71eb8544065d", "message": "oauth finished", "committedDate": "2020-10-02T11:59:10Z", "type": "commit"}, {"oid": "33f933e89d2bc56a0d9740da88464ae8bbe39542", "url": "https://github.com/osmandapp/OsmAnd/commit/33f933e89d2bc56a0d9740da88464ae8bbe39542", "message": "logout added", "committedDate": "2020-10-02T13:00:03Z", "type": "commit"}, {"oid": "dba64d631747bf90a125d8f8540f17f88abceb66", "url": "https://github.com/osmandapp/OsmAnd/commit/dba64d631747bf90a125d8f8540f17f88abceb66", "message": "bug fix", "committedDate": "2020-10-02T13:49:03Z", "type": "commit"}, {"oid": "0948476bf8bcb8f945c1834390f18217807d7ac1", "url": "https://github.com/osmandapp/OsmAnd/commit/0948476bf8bcb8f945c1834390f18217807d7ac1", "message": "style issues fixed", "committedDate": "2020-10-05T06:54:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTQ3NzgwMw==", "url": "https://github.com/osmandapp/OsmAnd/pull/9932#discussion_r499477803", "bodyText": "not specified what's consumer key?\nOSM_OAUTH_CONSUMER_KEY?", "author": "vshcherb", "createdAt": "2020-10-05T09:52:57Z", "path": "OsmAnd/build.gradle", "diffHunk": "@@ -216,9 +216,13 @@ android {\n \n \tbuildTypes {\n \t\tdebug {\n+\t\t\tbuildConfigField \"String\", \"CONSUMER_KEY\", \"\\\"Ti2qq3fo4i4Wmuox3SiWRIGq3obZisBHnxmcM05y\\\"\"\n+\t\t\tbuildConfigField \"String\", \"CONSUMER_SECRET\", \"\\\"lxulb3HYoMmd2cC4xxNe1dyfRMAY8dS0eNihJ0DM\\\"\"\n \t\t\tsigningConfig signingConfigs.development\n \t\t}\n \t\trelease {\n+\t\t\tbuildConfigField \"String\", \"CONSUMER_KEY\", \"\\\"Ti2qq3fo4i4Wmuox3SiWRIGq3obZisBHnxmcM05y\\\"\"", "originalCommit": "0948476bf8bcb8f945c1834390f18217807d7ac1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTIzNjgwMA==", "url": "https://github.com/osmandapp/OsmAnd/pull/9932#discussion_r501236800", "bodyText": "Not resolved", "author": "vshcherb", "createdAt": "2020-10-07T18:49:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTQ3NzgwMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTQ3ODA3NA==", "url": "https://github.com/osmandapp/OsmAnd/pull/9932#discussion_r499478074", "bodyText": "Duplicate dependency, it's already present in OsmAnd-java", "author": "vshcherb", "createdAt": "2020-10-05T09:53:26Z", "path": "OsmAnd/build.gradle", "diffHunk": "@@ -563,6 +567,9 @@ dependencies {\n \timplementation (\"com.github.HITGIF:TextFieldBoxes:1.4.5\"){\n \t\texclude group: 'com.android.support'\n \t}\n+\timplementation('com.github.scribejava:scribejava-apis:7.1.1'){", "originalCommit": "0948476bf8bcb8f945c1834390f18217807d7ac1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTQ3ODQ1NA==", "url": "https://github.com/osmandapp/OsmAnd/pull/9932#discussion_r499478454", "bodyText": "We don't add test screens to master, not clear what's this", "author": "vshcherb", "createdAt": "2020-10-05T09:53:59Z", "path": "OsmAnd/res/values/strings.xml", "diffHunk": "@@ -11,6 +11,12 @@\n \tThx - Hardy\n \n -->\n+    <string name=\"osm_edit_logout_success\">Logout successful</string>\n+    <string name=\"clear_osm_token\">Clear OpenStreetMap OAuth token</string>\n+    <string name=\"test_user_request_description\">Test user request</string>", "originalCommit": "0948476bf8bcb8f945c1834390f18217807d7ac1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTQ3ODc0OQ==", "url": "https://github.com/osmandapp/OsmAnd/pull/9932#discussion_r499478749", "bodyText": "any need?", "author": "vshcherb", "createdAt": "2020-10-05T09:54:26Z", "path": "OsmAnd/src/net/osmand/plus/download/DownloadIndexesThread.java", "diffHunk": "@@ -58,8 +59,8 @@\n \tprivate ConcurrentLinkedQueue<IndexItem> indexItemDownloading = new ConcurrentLinkedQueue<IndexItem>();\n \tprivate IndexItem currentDownloadingItem = null;\n \tprivate int currentDownloadingItemProgress = 0;\n-\n \tprivate DownloadResources indexes;\n+\tprivate static final int THREAD_ID = 10103;", "originalCommit": "0948476bf8bcb8f945c1834390f18217807d7ac1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTQ3ODk4MA==", "url": "https://github.com/osmandapp/OsmAnd/pull/9932#discussion_r499478980", "bodyText": "formatting!", "author": "vshcherb", "createdAt": "2020-10-05T09:54:51Z", "path": "OsmAnd/src/net/osmand/plus/osmedit/OpenstreetmapRemoteUtil.java", "diffHunk": "@@ -206,12 +172,16 @@ public long openChangeSet(String comment) {\n \t\t} catch (IOException e) {\n \t\t\tlog.error(\"Unhandled exception\", e); //$NON-NLS-1$\n \t\t}\n-\t\tString response = sendRequest(\n-\t\t\t\tgetSiteApi() + \"api/0.6/changeset/create/\", \"PUT\", writer.getBuffer().toString(), ctx.getString(R.string.opening_changeset), true); //$NON-NLS-1$ //$NON-NLS-2$\n-\t\tif (response != null && response.length() > 0) {\n-\t\t\tid = Long.parseLong(response);\n-\t\t}\n-\n+        String response = sendRequest(\n+                getSiteApi() + \"api/0.6/changeset/create/\", \"PUT\", writer.getBuffer().toString(), ctx.getString(R.string.opening_changeset), true); //$NON-NLS-1$ //$NON-NLS-2$\n+        try {\n+            if (response != null && response.length() > 0) {\n+                log.debug(response);\n+                id = Long.parseLong(response);\n+            }\n+        } catch (Exception e) {\n+            log.error(e);\n+        }", "originalCommit": "0948476bf8bcb8f945c1834390f18217807d7ac1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTQ3OTE1OA==", "url": "https://github.com/osmandapp/OsmAnd/pull/9932#discussion_r499479158", "bodyText": "formattting !!! block else", "author": "vshcherb", "createdAt": "2020-10-05T09:55:06Z", "path": "OsmAnd/src/net/osmand/plus/osmedit/OsmBugsRemoteUtil.java", "diffHunk": "@@ -118,8 +119,13 @@ private OsmBugResult editingPOI(String url, String requestMethod, String userOpe\n \t\t\tconnection.setRequestProperty(\"User-Agent\", Version.getFullVersion(app)); //$NON-NLS-1$\n \n \t\t\tif (!anonymous) {\n-\t\t\t\tString token = settings.USER_NAME.get() + \":\" + settings.USER_PASSWORD.get(); //$NON-NLS-1$\n-\t\t\t\tconnection.addRequestProperty(\"Authorization\", \"Basic \" + Base64.encode(token.getBytes(\"UTF-8\"))); //$NON-NLS-1$ //$NON-NLS-2$ //$NON-NLS-3$\n+\t\t\t\tif (client.isValidToken()){\n+\t\t\t\t\tconnection.addRequestProperty(\"Authorization\", \"OAuth \" + client.getClient().getAccessToken().getToken());\n+\t\t\t\t}", "originalCommit": "0948476bf8bcb8f945c1834390f18217807d7ac1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTQ3OTY4NA==", "url": "https://github.com/osmandapp/OsmAnd/pull/9932#discussion_r499479684", "bodyText": "why replace net.osmand. to , something is misconfigured in IDE", "author": "vshcherb", "createdAt": "2020-10-05T09:55:57Z", "path": "OsmAnd/src/net/osmand/plus/osmedit/OsmEditingPlugin.java", "diffHunk": "@@ -13,25 +13,18 @@\n import android.widget.EditText;\n import android.widget.Spinner;\n import android.widget.Toast;\n-\n import androidx.annotation.NonNull;\n import androidx.appcompat.app.AlertDialog;\n import androidx.fragment.app.Fragment;\n-\n import net.osmand.AndroidUtils;\n import net.osmand.PlatformUtil;\n import net.osmand.data.Amenity;\n import net.osmand.data.MapObject;\n import net.osmand.data.TransportStop;\n import net.osmand.osm.PoiType;\n import net.osmand.osm.edit.Entity;\n-import net.osmand.plus.ContextMenuAdapter;\n+import net.osmand.plus.*;", "originalCommit": "0948476bf8bcb8f945c1834390f18217807d7ac1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "6f5019f03f835827f0e491bcbd1fc4bf2ae016c8", "url": "https://github.com/osmandapp/OsmAnd/commit/6f5019f03f835827f0e491bcbd1fc4bf2ae016c8", "message": "style issues and cleanup", "committedDate": "2020-10-06T06:59:03Z", "type": "commit"}, {"oid": "a5776ae07a527c64ffc8936a42e8f31d65c0b1e4", "url": "https://github.com/osmandapp/OsmAnd/commit/a5776ae07a527c64ffc8936a42e8f31d65c0b1e4", "message": "cleanup", "committedDate": "2020-10-06T07:30:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDEzMjQwMQ==", "url": "https://github.com/osmandapp/OsmAnd/pull/9932#discussion_r500132401", "bodyText": "?? prepareStream", "author": "vshcherb", "createdAt": "2020-10-06T09:24:44Z", "path": "OsmAnd-java/src/main/java/net/osmand/osm/io/NetworkUtils.java", "diffHunk": "@@ -65,9 +56,10 @@ public static String sendGetRequest(String urlText, String userNamePassword, Str\n \t\t\treturn e.getMessage();\n \t\t}\n \t}\n-\t\n \tprivate static final String BOUNDARY = \"CowMooCowMooCowCowCow\"; //$NON-NLS-1$\n-\tpublic static String uploadFile(String urlText, File fileToUpload, String userNamePassword, String formName, boolean gzip, Map<String, String> additionalMapData){\n+\tpublic static String uploadFile(String urlText, File fileToUpload, String userNamePassword,", "originalCommit": "a5776ae07a527c64ffc8936a42e8f31d65c0b1e4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTI1MzIzMQ==", "url": "https://github.com/osmandapp/OsmAnd/pull/9932#discussion_r501253231", "bodyText": "We need to take care if input stream is large and will cause out of memory exception inside app! At least we shouldn't make it worse as it seems we did", "author": "vshcherb", "createdAt": "2020-10-07T19:19:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDEzMjQwMQ=="}], "type": "inlineReview"}, {"oid": "e8fc5959de67c1aa8e7136dc28f87061bbb72f52", "url": "https://github.com/osmandapp/OsmAnd/commit/e8fc5959de67c1aa8e7136dc28f87061bbb72f52", "message": "conflict resolved", "committedDate": "2020-10-08T09:09:32Z", "type": "commit"}, {"oid": "bde5ae822b5a8172761a329bcf43ed04816d70bb", "url": "https://github.com/osmandapp/OsmAnd/commit/bde5ae822b5a8172761a329bcf43ed04816d70bb", "message": "stream improvements", "committedDate": "2020-10-08T12:43:57Z", "type": "commit"}, {"oid": "0f3070f16082b49721e1068261af2a94d60fee16", "url": "https://github.com/osmandapp/OsmAnd/commit/0f3070f16082b49721e1068261af2a94d60fee16", "message": "Merge branch 'master' of git://github.com/osmandapp/Osmand into issue_175_osmedit_use_oauth", "committedDate": "2020-10-08T12:44:00Z", "type": "commit"}, {"oid": "1f986e92e0717e9106d500015283d557ac4ff28f", "url": "https://github.com/osmandapp/OsmAnd/commit/1f986e92e0717e9106d500015283d557ac4ff28f", "message": "osm stream file upload", "committedDate": "2020-10-09T11:22:28Z", "type": "commit"}, {"oid": "79b542384d3b7e4fff64b6968fa4613a9445103c", "url": "https://github.com/osmandapp/OsmAnd/commit/79b542384d3b7e4fff64b6968fa4613a9445103c", "message": "conflict resolved", "committedDate": "2020-10-09T11:24:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjM5ODY3OQ==", "url": "https://github.com/osmandapp/OsmAnd/pull/9932#discussion_r502398679", "bodyText": "???", "author": "vshcherb", "createdAt": "2020-10-09T12:40:25Z", "path": "OsmAnd/src/net/osmand/plus/osmedit/SettingsOsmEditingActivity.java", "diffHunk": "@@ -116,4 +174,17 @@ protected void onPostExecute(OsmBugsUtil.OsmBugResult osmBugResult) {\n \t\t\tToast.makeText(context, text, Toast.LENGTH_LONG).show();\n \t\t}\n \t}\n+\n+\t@Override\n+\tprotected void onNewIntent(Intent intent) {\n+\t\tsuper.onNewIntent(intent);\n+\t\tUri uri = intent.getData();\n+\t\tSystem.out.println(\"URI=\" + uri);", "originalCommit": "79b542384d3b7e4fff64b6968fa4613a9445103c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}