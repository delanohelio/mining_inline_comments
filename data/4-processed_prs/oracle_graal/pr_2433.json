{"pr_number": 2433, "pr_title": "correct computation of prologue size", "pr_createdAt": "2020-05-04T16:39:35Z", "pr_url": "https://github.com/oracle/graal/pull/2433", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTkyNjkzOA==", "url": "https://github.com/oracle/graal/pull/2433#discussion_r419926938", "bodyText": "So the 10 here is from 4 (length field)  + 2 (version field) + 4 (prologue length field), right?", "author": "olpaw", "createdAt": "2020-05-05T07:56:25Z", "path": "substratevm/src/com.oracle.objectfile/src/com/oracle/objectfile/elf/dwarf/DwarfLineSectionImpl.java", "diffHunk": "@@ -320,7 +320,7 @@ private int writeHeader(ClassEntry classEntry, byte[] buffer, int p) {\n         /*\n          * 4 ubyte prologue length includes rest of header and dir + file table section.\n          */\n-        int prologueSize = classEntry.getLinePrologueSize() - 6;\n+        int prologueSize = classEntry.getLinePrologueSize() - 10;", "originalCommit": "577dc0df9f5127b96e77687caa1960f5f8efcc30", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTk3MzIwNw==", "url": "https://github.com/oracle/graal/pull/2433#discussion_r419973207", "bodyText": "Yes, that's right and originally I failed to exclude the 4 byte slot for for the prologue field from the prologue length.\nI thought about using a private static final field for this value here to allow the above to be documented in some javadoc. However, I thought that would be overkill as it was fairly obvious at this point that we had just written 10 bytes.\nI also thought about asserting at the end of writing the header that the sum of the header size, file table size and directory size added up to the prologue field value + 10. However, that would involve reading back an int out of the byte array at offset 6 in order to validate what was fairly clearly written using that same computation. Once again that seemed to be overkill (so far there has been no need for any methods to read structured data from the byte[] so adding one to implement an assert seemed to be a step too far).\nIf you want I couled revise either or both those decisions?", "author": "adinn", "createdAt": "2020-05-05T09:20:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTkyNjkzOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTk4MDQyNw==", "url": "https://github.com/oracle/graal/pull/2433#discussion_r419980427", "bodyText": "Nah ... just use - (4 + 2 + 4) instead of -10.", "author": "olpaw", "createdAt": "2020-05-05T09:33:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTkyNjkzOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDE4Mjc0MA==", "url": "https://github.com/oracle/graal/pull/2433#discussion_r420182740", "bodyText": "Done.", "author": "adinn", "createdAt": "2020-05-05T15:06:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTkyNjkzOA=="}], "type": "inlineReview"}, {"oid": "25298c162ea69e76fa5c4c824a1d29164b3d2f39", "url": "https://github.com/oracle/graal/commit/25298c162ea69e76fa5c4c824a1d29164b3d2f39", "message": "correct computation of prologue size", "committedDate": "2020-05-05T15:05:13Z", "type": "commit"}, {"oid": "25298c162ea69e76fa5c4c824a1d29164b3d2f39", "url": "https://github.com/oracle/graal/commit/25298c162ea69e76fa5c4c824a1d29164b3d2f39", "message": "correct computation of prologue size", "committedDate": "2020-05-05T15:05:13Z", "type": "forcePushed"}]}