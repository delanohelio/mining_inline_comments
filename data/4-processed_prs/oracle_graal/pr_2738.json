{"pr_number": 2738, "pr_title": "Fix code that assumes suites are under a vcs repository", "pr_createdAt": "2020-08-07T11:51:34Z", "pr_url": "https://github.com/oracle/graal/pull/2738", "timeline": [{"oid": "05d53b05ae15cab2e6831161ae6a77b7e7213a5d", "url": "https://github.com/oracle/graal/commit/05d53b05ae15cab2e6831161ae6a77b7e7213a5d", "message": "Fix code that assumes suites are under a vcs repository\n\nAs of mx 5.270.0, mx projects can be built even outside a vcs\nrepository.\nThis patch makes the necessary changes to allow graal to be built\noutside a vcs repository.", "committedDate": "2020-08-07T11:48:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODA0NjY0MQ==", "url": "https://github.com/oracle/graal/pull/2738#discussion_r468046641", "bodyText": "Why not run the same testing as in the else branch?\nAlso, I would rename RM_GIT to WITHOUT_VCS as it better documents the intention of this change.", "author": "dougxc", "createdAt": "2020-08-10T16:57:30Z", "path": ".travis.yml", "diffHunk": "@@ -135,7 +137,14 @@ install:\n script:\n   - echo ${JAVA_HOME}\n   - ${JAVA_HOME}/bin/java -version\n-  - mx --primary-suite-path ${TRAVIS_BUILD_DIR}/${PRIMARY} --J @\"-Xmx2g\" --java-home=${JAVA_HOME} gate --strict-mode --tags ${GATE}\n+  - |\n+      if [[ ${RM_GIT} ]]\n+      then\n+        rm -rf .git\n+        mx --primary-suite-path ${TRAVIS_BUILD_DIR}/substratevm native-image --version", "originalCommit": "e9615754550a382061af490068257fa0453137bd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODEwOTQzMw==", "url": "https://github.com/oracle/graal/pull/2738#discussion_r468109433", "bodyText": "Why not run the same testing as in the else branch?\n\nThat's a good question and kind of show why this kind of tests might not be that future proof.\nLooking at the changes in 05d53b0 one sees that only 3 suites are affected (sdk, compiler, substratevm).\nNow in these suites only a subset of the commands are affected. For instance in substratevm the only affected commmands are native-image and native-image-configure (the ones invoking _ensure_vm_built. As a result,\nmx --primary-suite-path substratevm gate --tags build works fine even without this PR.\nIn order to test all the changes of this PR one needs to run:\n\nmx --primary-suite-path substratevm native-image -version\nmx --primary-suite-path compiler makegraaljdk /tmp/graaljdk\nmx --primary-suite-path sdk javadoc\n\nbut this still allows people to perform changes that could break mx commands performed outside a vcs repository.\nE.g.  mx --primary-suite-path substratevm build\nUnfortunately we cannot (it would take too long) test every mx command of graal, so I just settled with mx native-image.\nWDYT?\n\nAlso, I would rename RM_GIT to WITHOUT_VCS as it better documents the intention of this change.\n\n\ud83d\udc4d I'll take care of that.", "author": "zakkak", "createdAt": "2020-08-10T18:52:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODA0NjY0MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODE0NjQzMQ==", "url": "https://github.com/oracle/graal/pull/2738#discussion_r468146431", "bodyText": "Ok, then we'll start with the testing you've added and expand as necessary (i.e. when we find other commands that need to be fixed to work without VCS).", "author": "dougxc", "createdAt": "2020-08-10T19:56:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODA0NjY0MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODIxOTU1MA==", "url": "https://github.com/oracle/graal/pull/2738#discussion_r468219550", "bodyText": "Thank u", "author": "pjkendall982", "createdAt": "2020-08-10T22:24:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODA0NjY0MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODUxMjcwNA==", "url": "https://github.com/oracle/graal/pull/2738#discussion_r468512704", "bodyText": "Thanks @dougxc!", "author": "zakkak", "createdAt": "2020-08-11T11:33:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODA0NjY0MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODUyMTI1Nw==", "url": "https://github.com/oracle/graal/pull/2738#discussion_r468521257", "bodyText": "Have you looked into the Travis failures on this PR?", "author": "dougxc", "createdAt": "2020-08-11T11:50:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODA0NjY0MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODcyMjIwNw==", "url": "https://github.com/oracle/graal/pull/2738#discussion_r468722207", "bodyText": "Travis looks happy now :)", "author": "zakkak", "createdAt": "2020-08-11T16:48:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODA0NjY0MQ=="}], "type": "inlineReview"}, {"oid": "13dd1ea19017a4e6506fb816b92dd92895137e0b", "url": "https://github.com/oracle/graal/commit/13dd1ea19017a4e6506fb816b92dd92895137e0b", "message": "Add .mx_vcs_repo file and travis test for building without vcs", "committedDate": "2020-08-10T18:52:46Z", "type": "forcePushed"}, {"oid": "447f1302a33c3ca355041e7658c216c12674ed39", "url": "https://github.com/oracle/graal/commit/447f1302a33c3ca355041e7658c216c12674ed39", "message": "Add .mx_vcs_repo file and travis test for building without vcs", "committedDate": "2020-08-11T11:53:33Z", "type": "forcePushed"}, {"oid": "fc6ef771b442f1271da3037f40e03bd75ee3bb43", "url": "https://github.com/oracle/graal/commit/fc6ef771b442f1271da3037f40e03bd75ee3bb43", "message": "Add .mx_vcs_repo file and travis test for building without vcs", "committedDate": "2020-08-11T13:38:36Z", "type": "commit"}, {"oid": "fc6ef771b442f1271da3037f40e03bd75ee3bb43", "url": "https://github.com/oracle/graal/commit/fc6ef771b442f1271da3037f40e03bd75ee3bb43", "message": "Add .mx_vcs_repo file and travis test for building without vcs", "committedDate": "2020-08-11T13:38:36Z", "type": "forcePushed"}]}