{"pr_number": 361, "pr_title": "Remove deleted views", "pr_createdAt": "2020-02-15T06:08:22Z", "pr_url": "https://github.com/opensrp/opensrp-client-native-form/pull/361", "timeline": [{"oid": "535cdf8fab4da5f226a74aacccea8b5266c516ef", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/535cdf8fab4da5f226a74aacccea8b5266c516ef", "message": "remove deleted views from form json", "committedDate": "2020-02-15T06:03:48Z", "type": "commit"}, {"oid": "5d3bcdb8fd520710ca72df1a8e0bea3abfdc2eae", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/5d3bcdb8fd520710ca72df1a8e0bea3abfdc2eae", "message": "Bump up version", "committedDate": "2020-02-15T06:05:54Z", "type": "commit"}, {"oid": "6813e0c56dc4868e11294b295d9e1c2ecdc4f791", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/6813e0c56dc4868e11294b295d9e1c2ecdc4f791", "message": "Invoke refresh logic", "committedDate": "2020-02-15T06:10:55Z", "type": "commit"}, {"oid": "1d9a795333ce27d89a46392b2a18cc546924b722", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/1d9a795333ce27d89a46392b2a18cc546924b722", "message": "remove unused imports reported by codacy", "committedDate": "2020-02-15T06:26:50Z", "type": "commit"}, {"oid": "6233b90e6eec5addf17ee446a9713eb6f1c492ea", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/6233b90e6eec5addf17ee446a9713eb6f1c492ea", "message": "reformat code structure", "committedDate": "2020-02-15T08:50:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDA1NzMzMA==", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/361#discussion_r380057330", "bodyText": "What is this arrayList for?", "author": "bennsimon", "createdAt": "2020-02-17T09:08:14Z", "path": "android-json-form-wizard/src/main/java/com/vijay/jsonwizard/task/AttachRepeatingGroupTask.java", "diffHunk": "@@ -72,6 +74,7 @@ public AttachRepeatingGroupTask(final ViewParent parent, int numRepeatingGroups,\n     @Override\n     protected void onPreExecute() {\n         showProgressDialog(R.string.please_wait_title, R.string.creating_repeating_group_message, widgetArgs.getFormFragment().getContext());\n+        repeatingGroups = new ArrayList<>();", "originalCommit": "6233b90e6eec5addf17ee446a9713eb6f1c492ea", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDA3NDI4OQ==", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/361#discussion_r380074289", "bodyText": "Thanks for catching that, I have removed", "author": "manutarus", "createdAt": "2020-02-17T09:41:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDA1NzMzMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDA1NzQ1Nw==", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/361#discussion_r380057457", "bodyText": "I think the comment here can be updated", "author": "bennsimon", "createdAt": "2020-02-17T09:08:32Z", "path": "android-json-form-wizard/src/main/java/com/vijay/jsonwizard/task/AttachRepeatingGroupTask.java", "diffHunk": "@@ -100,14 +104,27 @@ protected void onPostExecute(List<View> result) {\n                     keysToRemove.add(repeatingGroupKey);\n                     rootLayout.removeViewAt(i);\n                 }\n-                // remove deleted fields from form json\n+//                remove deleted fields from form json\n+                ArrayList<String> removeThisFields = new ArrayList<>();\n                 int len = fields.length();\n                 for (int i = len - 1; i >= 0; i--) {\n                     String[] key = ((String) fields.getJSONObject(i).get(KEY)).split(\"_\");\n                     if (keysToRemove.contains(key[key.length - 1])) {\n+                        removeThisFields.add((String) fields.getJSONObject(i).get(KEY));\n                         fields.remove(i);\n                     }\n                 }\n+//                remove deleted views from form json", "originalCommit": "6233b90e6eec5addf17ee446a9713eb6f1c492ea", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDA2MDA1MA==", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/361#discussion_r380060050", "bodyText": "This method seems reusable you can add it in utils", "author": "bennsimon", "createdAt": "2020-02-17T09:13:55Z", "path": "android-json-form-wizard/src/main/java/com/vijay/jsonwizard/task/AttachRepeatingGroupTask.java", "diffHunk": "@@ -100,14 +104,27 @@ protected void onPostExecute(List<View> result) {\n                     keysToRemove.add(repeatingGroupKey);\n                     rootLayout.removeViewAt(i);\n                 }\n-                // remove deleted fields from form json\n+//                remove deleted fields from form json\n+                ArrayList<String> removeThisFields = new ArrayList<>();\n                 int len = fields.length();\n                 for (int i = len - 1; i >= 0; i--) {\n                     String[] key = ((String) fields.getJSONObject(i).get(KEY)).split(\"_\");\n                     if (keysToRemove.contains(key[key.length - 1])) {\n+                        removeThisFields.add((String) fields.getJSONObject(i).get(KEY));\n                         fields.remove(i);\n                     }\n                 }\n+//                remove deleted views from form json\n+                Collection<View> viewCollection =  widgetArgs.getFormFragment().getJsonApi().getFormDataViews();\n+                Iterator<View> viewIterator = viewCollection.iterator();\n+                while (viewIterator.hasNext()){\n+                    View view = viewIterator.next();\n+                    String key = (String) view.getTag(R.id.key);\n+                    if(removeThisFields.contains(key)){", "originalCommit": "6233b90e6eec5addf17ee446a9713eb6f1c492ea", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDA2MDgxNA==", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/361#discussion_r380060814", "bodyText": "I think you should check for null in this chained method calls widgetArgs.getFormFragment().getJsonApi().getFormDataViews()", "author": "bennsimon", "createdAt": "2020-02-17T09:15:29Z", "path": "android-json-form-wizard/src/main/java/com/vijay/jsonwizard/task/AttachRepeatingGroupTask.java", "diffHunk": "@@ -100,14 +104,27 @@ protected void onPostExecute(List<View> result) {\n                     keysToRemove.add(repeatingGroupKey);\n                     rootLayout.removeViewAt(i);\n                 }\n-                // remove deleted fields from form json\n+//                remove deleted fields from form json\n+                ArrayList<String> removeThisFields = new ArrayList<>();\n                 int len = fields.length();\n                 for (int i = len - 1; i >= 0; i--) {\n                     String[] key = ((String) fields.getJSONObject(i).get(KEY)).split(\"_\");\n                     if (keysToRemove.contains(key[key.length - 1])) {\n+                        removeThisFields.add((String) fields.getJSONObject(i).get(KEY));\n                         fields.remove(i);\n                     }\n                 }\n+//                remove deleted views from form json\n+                Collection<View> viewCollection =  widgetArgs.getFormFragment().getJsonApi().getFormDataViews();", "originalCommit": "6233b90e6eec5addf17ee446a9713eb6f1c492ea", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e321e67070578c86cf66b3462c5709b7183df06f", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/e321e67070578c86cf66b3462c5709b7183df06f", "message": "abstract fuction to remove deleted feilds from form json object", "committedDate": "2020-02-17T11:51:29Z", "type": "commit"}]}