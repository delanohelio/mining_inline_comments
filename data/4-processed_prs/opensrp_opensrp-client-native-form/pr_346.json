{"pr_number": 346, "pr_title": "Refactor the expansion panel Dialog to enable code reuse", "pr_createdAt": "2020-01-27T09:47:11Z", "pr_url": "https://github.com/opensrp/opensrp-client-native-form/pull/346", "timeline": [{"oid": "de8e6ccb0e21f5327da9f9b1d910209e47d9f86f", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/de8e6ccb0e21f5327da9f9b1d910209e47d9f86f", "message": ":hammer: Move some expansion panels methods to the form utils to enable reuse", "committedDate": "2020-01-27T09:44:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTI1NDE3Mg==", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/346#discussion_r371254172", "bodyText": "Catch a less generic exception", "author": "bennsimon", "createdAt": "2020-01-27T13:59:54Z", "path": "android-json-form-wizard/src/main/java/com/vijay/jsonwizard/utils/FormUtils.java", "diffHunk": "@@ -1315,6 +1457,93 @@ public void getOptionsOpenMRSAttributes(JSONObject item, JSONArray valueOpenMRSA\n         }\n     }\n \n+    public String getOptionsValueRadioButton(String value, JSONArray options) throws JSONException {\n+        String secondaryValue = \"\";\n+        if (!TextUtils.isEmpty(value)) {\n+            for (int i = 0; i < options.length(); i++) {\n+                JSONObject option = options.getJSONObject(i);\n+                if (option.has(JsonFormConstants.KEY) && value.equals(option.getString(JsonFormConstants.KEY))) {\n+                    String key = option.getString(JsonFormConstants.KEY);\n+                    String text = option.getString(JsonFormConstants.TEXT);\n+                    secondaryValue = key + \":\" + text;\n+                }\n+            }\n+        }\n+        return secondaryValue;\n+    }\n+\n+    public void getSpinnerValueOpenMRSAttributes(JSONObject item, JSONArray valueOpenMRSAttributes) throws JSONException {\n+        if (item != null && item.equals(JsonFormConstants.SPINNER) && item.has(JsonFormConstants.OPENMRS_CHOICE_IDS)) {\n+            JSONObject openMRSChoiceIds = item.getJSONObject(JsonFormConstants.OPENMRS_CHOICE_IDS);\n+            String value = item.getString(JsonFormConstants.VALUE);\n+            Iterator<String> keys = openMRSChoiceIds.keys();\n+            while (keys.hasNext()) {\n+                String key = keys.next();\n+                if (value.equals(key)) {\n+                    JSONObject jsonObject = new JSONObject();\n+                    String optionOpenMRSConceptId = openMRSChoiceIds.get(key).toString();\n+                    jsonObject.put(JsonFormConstants.KEY, item.getString(JsonFormConstants.KEY));\n+                    jsonObject.put(JsonFormConstants.OPENMRS_ENTITY_PARENT,\n+                            item.getString(JsonFormConstants.OPENMRS_ENTITY_PARENT));\n+                    jsonObject.put(JsonFormConstants.OPENMRS_ENTITY, item.getString(JsonFormConstants.OPENMRS_ENTITY));\n+                    jsonObject.put(JsonFormConstants.OPENMRS_ENTITY_ID, optionOpenMRSConceptId);\n+\n+                    valueOpenMRSAttributes.put(jsonObject);\n+                }\n+\n+            }\n+        }\n+    }\n+\n+    private JSONObject createValueObject(String key, String type, String label, int index, JSONArray values, JSONObject openMRSAttributes, JSONArray valueOpenMRSAttributes) {\n+        JSONObject jsonObject = new JSONObject();\n+        try {\n+            if (values.length() > 0) {\n+                jsonObject.put(JsonFormConstants.KEY, key);\n+                jsonObject.put(JsonFormConstants.TYPE, type);\n+                jsonObject.put(JsonFormConstants.LABEL, label);\n+                jsonObject.put(JsonFormConstants.INDEX, index);\n+                jsonObject.put(JsonFormConstants.VALUES, values);\n+                jsonObject.put(JsonFormConstants.OPENMRS_ATTRIBUTES, openMRSAttributes);\n+                if (valueOpenMRSAttributes.length() > 0) {\n+                    jsonObject.put(JsonFormConstants.VALUE_OPENMRS_ATTRIBUTES, valueOpenMRSAttributes);\n+                }\n+            }\n+        } catch (Exception e) {\n+            Timber.e(e, \" --> createValueObject\");\n+\n+        }\n+        return jsonObject;\n+    }\n+\n+    /**\n+     * @param key\n+     * @param type\n+     * @param values\n+     * @param openMRSAttributes\n+     * @param valueOpenMRSAttributes\n+     * @return\n+     */\n+    public JSONObject createSecondaryValueObject(String key, String type, JSONArray values, JSONObject openMRSAttributes,\n+                                                 JSONArray valueOpenMRSAttributes) {\n+        JSONObject jsonObject = new JSONObject();\n+        try {\n+            if (values.length() > 0) {\n+                jsonObject.put(JsonFormConstants.KEY, key);\n+                jsonObject.put(JsonFormConstants.TYPE, type);\n+                jsonObject.put(JsonFormConstants.VALUES, values);\n+                jsonObject.put(JsonFormConstants.OPENMRS_ATTRIBUTES, openMRSAttributes);\n+                if (valueOpenMRSAttributes.length() > 0) {\n+                    jsonObject.put(JsonFormConstants.VALUE_OPENMRS_ATTRIBUTES, valueOpenMRSAttributes);\n+                }\n+            }\n+        } catch (Exception e) {", "originalCommit": "de8e6ccb0e21f5327da9f9b1d910209e47d9f86f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTI1NDIyMw==", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/346#discussion_r371254223", "bodyText": "Catch a less generic exception", "author": "bennsimon", "createdAt": "2020-01-27T14:00:00Z", "path": "android-json-form-wizard/src/main/java/com/vijay/jsonwizard/utils/FormUtils.java", "diffHunk": "@@ -1315,6 +1457,93 @@ public void getOptionsOpenMRSAttributes(JSONObject item, JSONArray valueOpenMRSA\n         }\n     }\n \n+    public String getOptionsValueRadioButton(String value, JSONArray options) throws JSONException {\n+        String secondaryValue = \"\";\n+        if (!TextUtils.isEmpty(value)) {\n+            for (int i = 0; i < options.length(); i++) {\n+                JSONObject option = options.getJSONObject(i);\n+                if (option.has(JsonFormConstants.KEY) && value.equals(option.getString(JsonFormConstants.KEY))) {\n+                    String key = option.getString(JsonFormConstants.KEY);\n+                    String text = option.getString(JsonFormConstants.TEXT);\n+                    secondaryValue = key + \":\" + text;\n+                }\n+            }\n+        }\n+        return secondaryValue;\n+    }\n+\n+    public void getSpinnerValueOpenMRSAttributes(JSONObject item, JSONArray valueOpenMRSAttributes) throws JSONException {\n+        if (item != null && item.equals(JsonFormConstants.SPINNER) && item.has(JsonFormConstants.OPENMRS_CHOICE_IDS)) {\n+            JSONObject openMRSChoiceIds = item.getJSONObject(JsonFormConstants.OPENMRS_CHOICE_IDS);\n+            String value = item.getString(JsonFormConstants.VALUE);\n+            Iterator<String> keys = openMRSChoiceIds.keys();\n+            while (keys.hasNext()) {\n+                String key = keys.next();\n+                if (value.equals(key)) {\n+                    JSONObject jsonObject = new JSONObject();\n+                    String optionOpenMRSConceptId = openMRSChoiceIds.get(key).toString();\n+                    jsonObject.put(JsonFormConstants.KEY, item.getString(JsonFormConstants.KEY));\n+                    jsonObject.put(JsonFormConstants.OPENMRS_ENTITY_PARENT,\n+                            item.getString(JsonFormConstants.OPENMRS_ENTITY_PARENT));\n+                    jsonObject.put(JsonFormConstants.OPENMRS_ENTITY, item.getString(JsonFormConstants.OPENMRS_ENTITY));\n+                    jsonObject.put(JsonFormConstants.OPENMRS_ENTITY_ID, optionOpenMRSConceptId);\n+\n+                    valueOpenMRSAttributes.put(jsonObject);\n+                }\n+\n+            }\n+        }\n+    }\n+\n+    private JSONObject createValueObject(String key, String type, String label, int index, JSONArray values, JSONObject openMRSAttributes, JSONArray valueOpenMRSAttributes) {\n+        JSONObject jsonObject = new JSONObject();\n+        try {\n+            if (values.length() > 0) {\n+                jsonObject.put(JsonFormConstants.KEY, key);\n+                jsonObject.put(JsonFormConstants.TYPE, type);\n+                jsonObject.put(JsonFormConstants.LABEL, label);\n+                jsonObject.put(JsonFormConstants.INDEX, index);\n+                jsonObject.put(JsonFormConstants.VALUES, values);\n+                jsonObject.put(JsonFormConstants.OPENMRS_ATTRIBUTES, openMRSAttributes);\n+                if (valueOpenMRSAttributes.length() > 0) {\n+                    jsonObject.put(JsonFormConstants.VALUE_OPENMRS_ATTRIBUTES, valueOpenMRSAttributes);\n+                }\n+            }\n+        } catch (Exception e) {", "originalCommit": "de8e6ccb0e21f5327da9f9b1d910209e47d9f86f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "db1161ef4a1c2724ba6da61ee68ddb2d4f2980ed", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/db1161ef4a1c2724ba6da61ee68ddb2d4f2980ed", "message": ":ok_hand: switch to more specific exception handlers", "committedDate": "2020-01-27T14:20:20Z", "type": "commit"}]}