{"pr_number": 2906, "pr_title": "NMS-12413: Fix remove from definitions", "pr_createdAt": "2020-02-27T19:14:34Z", "pr_url": "https://github.com/OpenNMS/opennms/pull/2906", "timeline": [{"oid": "e8c17b202512c41e5c5eb8899e8f3bc243d06093", "url": "https://github.com/OpenNMS/opennms/commit/e8c17b202512c41e5c5eb8899e8f3bc243d06093", "message": "NMS-12413: Fix remove from definition", "committedDate": "2020-02-27T19:10:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQwODA1Nw==", "url": "https://github.com/OpenNMS/opennms/pull/2906#discussion_r388408057", "bodyText": "Let's use LocationUtils here.", "author": "j-white", "createdAt": "2020-03-05T16:26:27Z", "path": "opennms-config/src/main/java/org/opennms/netmgt/config/SnmpPeerFactory.java", "diffHunk": "@@ -470,6 +480,84 @@ public boolean removeFromDefinition(InetAddress inetAddress, String location, St\n         return succeeded;\n     }\n \n+    private Definition findMatchingDefinition(InetAddress inetAddress, String location) {\n+        SnmpConfig config = getSnmpConfig();\n+        List<Definition> definitions = config.getDefinitions();\n+        return definitions.stream().filter(definition -> matchDefinition(definition, inetAddress, location)).findFirst().orElse(null);\n+    }\n+\n+    private  static Definition createDefinition(Definition matchingDefinition) {\n+        Definition definition = new Definition();\n+        definition.setProfileLabel(matchingDefinition.getProfileLabel());\n+        definition.setLocation(matchingDefinition.getLocation());\n+        // Fill configuration\n+        definition.setProxyHost(matchingDefinition.getProxyHost());\n+        definition.setMaxVarsPerPdu(matchingDefinition.getMaxVarsPerPdu());\n+        definition.setMaxRepetitions(matchingDefinition.getMaxRepetitions());\n+        definition.setMaxRequestSize(matchingDefinition.getMaxRequestSize());\n+\n+        definition.setSecurityName(matchingDefinition.getSecurityName());\n+        definition.setSecurityLevel(matchingDefinition.getSecurityLevel());\n+        definition.setAuthPassphrase(matchingDefinition.getAuthPassphrase());\n+        definition.setAuthProtocol(matchingDefinition.getAuthProtocol());\n+        definition.setEngineId(matchingDefinition.getEngineId());\n+        definition.setContextEngineId(matchingDefinition.getContextEngineId());\n+        definition.setContextName(matchingDefinition.getContextName());\n+        definition.setEnterpriseId(matchingDefinition.getEnterpriseId());\n+        definition.setPrivacyPassphrase(matchingDefinition.getPrivacyPassphrase());\n+        definition.setPrivacyProtocol(matchingDefinition.getPrivacyProtocol());\n+        definition.setVersion(matchingDefinition.getVersion());\n+        definition.setReadCommunity(matchingDefinition.getReadCommunity());\n+        definition.setWriteCommunity(matchingDefinition.getWriteCommunity());\n+        definition.setPort(matchingDefinition.getPort());\n+        definition.setTimeout(matchingDefinition.getTimeout());\n+        definition.setTTL(matchingDefinition.getTTL());\n+        definition.setRetry(matchingDefinition.getRetry());\n+        return definition;\n+    }\n+\n+    private boolean matchDefinition(Definition definition, InetAddress inetAddress, String location) {\n+        String locationFromDefinition = definition.getLocation();\n+        if(DEFAULT_LOCATION.equals(location)) {", "originalCommit": "e8c17b202512c41e5c5eb8899e8f3bc243d06093", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "b73ab27bedf6c0ca192f6787d1089370d3ebd55e", "url": "https://github.com/OpenNMS/opennms/commit/b73ab27bedf6c0ca192f6787d1089370d3ebd55e", "message": "NMS-12413: Use LocationUtils", "committedDate": "2020-03-05T17:46:17Z", "type": "commit"}]}