{"pr_number": 3198, "pr_title": "NMS-12971: Identify message broker strategies in web \"about\" page", "pr_createdAt": "2020-10-26T16:11:09Z", "pr_url": "https://github.com/OpenNMS/opennms/pull/3198", "timeline": [{"oid": "bcb832a66e3afa068a4fa470124ee77d7a29547b", "url": "https://github.com/OpenNMS/opennms/commit/bcb832a66e3afa068a4fa470124ee77d7a29547b", "message": "NMS-12971: Identify message broker strategies in web \"about\" page", "committedDate": "2020-10-26T16:09:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjA5NTYyNA==", "url": "https://github.com/OpenNMS/opennms/pull/3198#discussion_r512095624", "bodyText": "This looks good enough but there is also GRPC as IPC strategy for both Sink and RPC which we set through system property org.opennms.core.ipc.strategy.  This takes precedence over  Sink and RPC specific strategies.", "author": "cgorantla", "createdAt": "2020-10-26T16:27:48Z", "path": "opennms-webapp/src/main/webapp/about/index.jsp", "diffHunk": "@@ -135,6 +135,10 @@\n     <th>Time-Series Strategy:</th>\n     <td><%=TimeSeries.getTimeseriesStrategy().getDescr()%></td>\n   </tr>\n+  <tr>\n+    <th>Message Broker Strategy:</th>\n+    <td>RPC: <%=System.getProperty(\"org.opennms.core.ipc.rpc.strategy\", \"ActiveMQ\")%>; Sink: <%=System.getProperty(\"org.opennms.core.ipc.sink.strategy\", \"ActiveMQ\")%></td>", "originalCommit": "bcb832a66e3afa068a4fa470124ee77d7a29547b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjE1NDY5OQ==", "url": "https://github.com/OpenNMS/opennms/pull/3198#discussion_r512154699", "bodyText": "This looks good enough but there is also GRPC as IPC strategy for both Sink and RPC which we set through system property org.opennms.core.ipc.strategy. This takes precedence over Sink and RPC specific strategies.\n\nGreat catch. Thanks, I'll update the PR to cover this case as well.", "author": "jeffgdotorg", "createdAt": "2020-10-26T17:48:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjA5NTYyNA=="}], "type": "inlineReview"}, {"oid": "a8f63d450481dcf91a1ca1761c0b9c76410d3719", "url": "https://github.com/OpenNMS/opennms/commit/a8f63d450481dcf91a1ca1761c0b9c76410d3719", "message": "NMS-12971: Account for global IPC strategy overriding RPC and Sink ones", "committedDate": "2020-10-26T18:05:32Z", "type": "commit"}, {"oid": "27d0189eaace9332cf9cc6bc99f58af754301ba6", "url": "https://github.com/OpenNMS/opennms/commit/27d0189eaace9332cf9cc6bc99f58af754301ba6", "message": "NMS-12971: Just consult the strategy class. Better all around. Thanks Chandra!", "committedDate": "2020-10-26T19:25:12Z", "type": "commit"}, {"oid": "b0a7c12a3c3bf81f5886b1388b5488c918235e31", "url": "https://github.com/OpenNMS/opennms/commit/b0a7c12a3c3bf81f5886b1388b5488c918235e31", "message": "NMS-12971: There are still three strategies to account for though.", "committedDate": "2020-10-26T19:38:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjI1ODI1NA==", "url": "https://github.com/OpenNMS/opennms/pull/3198#discussion_r512258254", "bodyText": "Think you need to import these packages.", "author": "cgorantla", "createdAt": "2020-10-26T20:48:11Z", "path": "opennms-webapp/src/main/webapp/about/index.jsp", "diffHunk": "@@ -131,10 +131,25 @@\n     <th>Database Version:</th>\n     <td><%=dbVersion%></td>\n   </tr>\n+<%\n+    String globalMBStrategy, sinkMBStrategy, rpcMBStrategy;\n+    globalMBStrategy = org.opennms.core.rpc.common.RpcStrategy.getRpcStrategy().getDescr();", "originalCommit": "b0a7c12a3c3bf81f5886b1388b5488c918235e31", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDQ4NTI1Mw==", "url": "https://github.com/OpenNMS/opennms/pull/3198#discussion_r514485253", "bodyText": "Importing doesn't seem to do the job; it still breaks on build and I get an additional message:\nAn error occurred at line: [21] in the generated java file: [/Users/jeffg/git/foundation-work/opennms-webapp/target/jsp-classes/org/apache/jsp/about/index_jsp.java]\nOnly a type can be imported. org.opennms.core.ipc.sink.common.SinkStrategy resolves to a package\n\nSame result with either foundation-2019 or foundation-2020. Does the opennms-webapp POM perhaps need updating?", "author": "jeffgdotorg", "createdAt": "2020-10-29T18:41:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjI1ODI1NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDQ4ODQyMA==", "url": "https://github.com/OpenNMS/opennms/pull/3198#discussion_r514488420", "bodyText": "Guess you have to bring both dependencies into opennms-webapp and import  the packages here", "author": "cgorantla", "createdAt": "2020-10-29T18:46:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjI1ODI1NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTI5NzAxMA==", "url": "https://github.com/OpenNMS/opennms/pull/3198#discussion_r515297010", "bodyText": "Got both dependencies added and ran it through full smoke, which passed. I think this should do the job.\nAlso changed from descr to name in the page.", "author": "jeffgdotorg", "createdAt": "2020-10-30T18:22:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjI1ODI1NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjI1ODUxNA==", "url": "https://github.com/OpenNMS/opennms/pull/3198#discussion_r512258514", "bodyText": "Sufficient to get Sink/RPC strategies here.", "author": "cgorantla", "createdAt": "2020-10-26T20:48:40Z", "path": "opennms-webapp/src/main/webapp/about/index.jsp", "diffHunk": "@@ -131,10 +131,25 @@\n     <th>Database Version:</th>\n     <td><%=dbVersion%></td>\n   </tr>\n+<%\n+    String globalMBStrategy, sinkMBStrategy, rpcMBStrategy;\n+    globalMBStrategy = org.opennms.core.rpc.common.RpcStrategy.getRpcStrategy().getDescr();\n+    if (globalMBStrategy != null) {\n+        sinkMBStrategy = globalMBStrategy;\n+        rpcMBStrategy = globalMBStrategy;\n+    } else {\n+        sinkMBStrategy = org.opennms.core.ipc.sink.common.SinkStrategy.getSinkStrategy().getDescr();", "originalCommit": "b0a7c12a3c3bf81f5886b1388b5488c918235e31", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjI1OTA0MQ==", "url": "https://github.com/OpenNMS/opennms/pull/3198#discussion_r512259041", "bodyText": "Depending on how it looks on the web page, we should choose between Descr and name.\nI prefer using name", "author": "cgorantla", "createdAt": "2020-10-26T20:49:35Z", "path": "opennms-webapp/src/main/webapp/about/index.jsp", "diffHunk": "@@ -131,10 +131,25 @@\n     <th>Database Version:</th>\n     <td><%=dbVersion%></td>\n   </tr>\n+<%\n+    String globalMBStrategy, sinkMBStrategy, rpcMBStrategy;\n+    globalMBStrategy = org.opennms.core.rpc.common.RpcStrategy.getRpcStrategy().getDescr();\n+    if (globalMBStrategy != null) {\n+        sinkMBStrategy = globalMBStrategy;\n+        rpcMBStrategy = globalMBStrategy;\n+    } else {\n+        sinkMBStrategy = org.opennms.core.ipc.sink.common.SinkStrategy.getSinkStrategy().getDescr();\n+        rpcMBStrategy = org.opennms.core.rpc.common.RpcStrategy.getRpcStrategy().getDescr();\n+    }\n+%>\n   <tr>\n     <th>Time-Series Strategy:</th>\n     <td><%=TimeSeries.getTimeseriesStrategy().getDescr()%></td>\n   </tr>\n+  <tr>\n+    <th>IPC Strategy:</th>\n+    <td>Sink: <%=sinkMBStrategy%>; RPC: <%=rpcMBStrategy%></td>", "originalCommit": "b0a7c12a3c3bf81f5886b1388b5488c918235e31", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "b563c284fb43e671d053d490d5bfc138c9b2a860", "url": "https://github.com/OpenNMS/opennms/commit/b563c284fb43e671d053d490d5bfc138c9b2a860", "message": "NMS-12971:  Identify message broker strategies in web \"about\" page\n\n- Add RPC and Sink common dependencies to webapp\n- List strategies in about/index.jsp", "committedDate": "2020-10-30T14:50:08Z", "type": "commit"}, {"oid": "bdda3932b9002debec2738c69e2848d6b435d768", "url": "https://github.com/OpenNMS/opennms/commit/bdda3932b9002debec2738c69e2848d6b435d768", "message": "Merge branch 'jira/NMS-12971' of github.com:OpenNMS/opennms into jira/NMS-12971", "committedDate": "2020-10-30T17:57:00Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTMwMjg2Ng==", "url": "https://github.com/OpenNMS/opennms/pull/3198#discussion_r515302866", "bodyText": "Didn't get why you still need globalMBStrategy here.", "author": "cgorantla", "createdAt": "2020-10-30T18:34:02Z", "path": "opennms-webapp/src/main/webapp/about/index.jsp", "diffHunk": "@@ -135,6 +137,21 @@\n     <th>Time-Series Strategy:</th>\n     <td><%=TimeSeries.getTimeseriesStrategy().getDescr()%></td>\n   </tr>\n+<%\n+    String globalMBStrategy, sinkMBStrategy, rpcMBStrategy;\n+    globalMBStrategy = org.opennms.core.rpc.common.RpcStrategy.getRpcStrategy().getName();\n+    if (globalMBStrategy != null) {", "originalCommit": "bdda3932b9002debec2738c69e2848d6b435d768", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTMxNTgyNw==", "url": "https://github.com/OpenNMS/opennms/pull/3198#discussion_r515315827", "bodyText": "Think you are trying to use globalMBStrategy in order to get both strategy names to be jms. Instead I think we can change CAMEL_SINK_STRATEGY_NAME to jms", "author": "cgorantla", "createdAt": "2020-10-30T19:00:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTMwMjg2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTM3NzUxMQ==", "url": "https://github.com/OpenNMS/opennms/pull/3198#discussion_r515377511", "bodyText": "Guess I misunderstood earlier in our conversation. In this case, the scriptlet is totally unnecessary. Will change accordingly.", "author": "jeffgdotorg", "createdAt": "2020-10-30T20:52:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTMwMjg2Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTMwMzA3MQ==", "url": "https://github.com/OpenNMS/opennms/pull/3198#discussion_r515303071", "bodyText": "you can omit package here.", "author": "cgorantla", "createdAt": "2020-10-30T18:34:31Z", "path": "opennms-webapp/src/main/webapp/about/index.jsp", "diffHunk": "@@ -135,6 +137,21 @@\n     <th>Time-Series Strategy:</th>\n     <td><%=TimeSeries.getTimeseriesStrategy().getDescr()%></td>\n   </tr>\n+<%\n+    String globalMBStrategy, sinkMBStrategy, rpcMBStrategy;\n+    globalMBStrategy = org.opennms.core.rpc.common.RpcStrategy.getRpcStrategy().getName();\n+    if (globalMBStrategy != null) {\n+        sinkMBStrategy = globalMBStrategy;\n+        rpcMBStrategy = globalMBStrategy;\n+    } else {\n+        sinkMBStrategy = org.opennms.core.ipc.sink.common.SinkStrategy.getSinkStrategy().getName();", "originalCommit": "bdda3932b9002debec2738c69e2848d6b435d768", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTM3NzU4Ng==", "url": "https://github.com/OpenNMS/opennms/pull/3198#discussion_r515377586", "bodyText": "Of course.", "author": "jeffgdotorg", "createdAt": "2020-10-30T20:52:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTMwMzA3MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTMwMzczOA==", "url": "https://github.com/OpenNMS/opennms/pull/3198#discussion_r515303738", "bodyText": "Guess this is unintentional change", "author": "cgorantla", "createdAt": "2020-10-30T18:35:45Z", "path": "core/web-assets/package-lock.json", "diffHunk": "@@ -4330,9 +4330,9 @@\n             }\n         },\n         \"dot-prop\": {\n-            \"version\": \"4.2.0\",\n-            \"resolved\": \"https://registry.npmjs.org/dot-prop/-/dot-prop-4.2.0.tgz\",\n-            \"integrity\": \"sha512-tUMXrxlExSW6U2EXiiKGSBVdYgtV8qlHL+C10TsW4PURY/ic+eaysnSkwB4kA/mBlCyy/IKDJ+Lc3wbWeaXtuQ==\",\n+            \"version\": \"4.2.1\",", "originalCommit": "bdda3932b9002debec2738c69e2848d6b435d768", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjAzNjk5NQ==", "url": "https://github.com/OpenNMS/opennms/pull/3198#discussion_r516036995", "bodyText": "Guess this is unintentional change\n\nI think is must have been. I certainly didn't make it intentionally.", "author": "jeffgdotorg", "createdAt": "2020-11-02T15:09:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTMwMzczOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA1MTExMA==", "url": "https://github.com/OpenNMS/opennms/pull/3198#discussion_r516051110", "bodyText": "That probably came from a merge.  It's made its way through the various branches foundation-2019 and up.", "author": "RangerRick", "createdAt": "2020-11-02T15:28:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTMwMzczOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA3MDk5OQ==", "url": "https://github.com/OpenNMS/opennms/pull/3198#discussion_r516070999", "bodyText": "I think you're right @RangerRick . It doesn't show up in a diff done today between the PR branch and foundation-2019.", "author": "jeffgdotorg", "createdAt": "2020-11-02T15:55:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTMwMzczOA=="}], "type": "inlineReview"}, {"oid": "3541953f3f4daa5552576849eda458601d22cfdf", "url": "https://github.com/OpenNMS/opennms/commit/3541953f3f4daa5552576849eda458601d22cfdf", "message": "NMS-12971: Factor out excess logic in JSP, eliminating need for scriptlet", "committedDate": "2020-10-30T20:53:13Z", "type": "commit"}, {"oid": "457918a27599fd07bd02310399a2a28ffba0d765", "url": "https://github.com/OpenNMS/opennms/commit/457918a27599fd07bd02310399a2a28ffba0d765", "message": "Merge branch 'foundation-2019' of github.com:OpenNMS/opennms into jira/NMS-12971", "committedDate": "2020-11-02T15:09:39Z", "type": "commit"}]}