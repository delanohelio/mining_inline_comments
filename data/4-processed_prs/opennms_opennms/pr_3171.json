{"pr_number": 3171, "pr_title": "BS-55: sort attributes alphanumerically", "pr_createdAt": "2020-09-29T14:24:14Z", "pr_url": "https://github.com/OpenNMS/opennms/pull/3171", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njc2MjExMw==", "url": "https://github.com/OpenNMS/opennms/pull/3171#discussion_r496762113", "bodyText": "This is screaming at me for unit test coverage.", "author": "j-white", "createdAt": "2020-09-29T14:25:48Z", "path": "opennms-dao/src/main/java/org/opennms/netmgt/dao/support/RrdResourceAttributeUtils.java", "diffHunk": "@@ -255,4 +256,79 @@ protected static String getStringProperty(File directory, String key) {\n             throw new DataAccessResourceFailureException(message, e);\n         }\n     }\n+\n+    /**\n+     * Alphanumeric sort that handles substrings with numeric components\n+     */\n+    public static class AlphaNumericOnmsAttributeComparator implements Serializable, Comparator<OnmsAttribute> {", "originalCommit": "5ec94a0efd67d9c56831ead78f7401ea14ef0cec", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njc2NjQ5NA==", "url": "https://github.com/OpenNMS/opennms/pull/3171#discussion_r496766494", "bodyText": "What's BS? :)\n\nFiiiine, it didn't seem worth making a whole other issue for a pretty simple change, but for you, I'll do it.  ;)\nYeah, I can add a couple unit tests.", "author": "RangerRick", "createdAt": "2020-09-29T14:31:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njc2MjExMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njc4NjQ4MQ==", "url": "https://github.com/OpenNMS/opennms/pull/3171#discussion_r496786481", "bodyText": "Didn't bother changing the branch name, but changed the commits.", "author": "RangerRick", "createdAt": "2020-09-29T14:55:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njc2MjExMw=="}], "type": "inlineReview"}, {"oid": "92ed17e7cfed6144f983e7b1f8c009114dcf9d5f", "url": "https://github.com/OpenNMS/opennms/commit/92ed17e7cfed6144f983e7b1f8c009114dcf9d5f", "message": "NMS-12931: sort attributes alphanumerically", "committedDate": "2020-09-29T14:33:07Z", "type": "commit"}, {"oid": "d58056a0eb2a71364214511c2fb591d15fcf7d40", "url": "https://github.com/OpenNMS/opennms/commit/d58056a0eb2a71364214511c2fb591d15fcf7d40", "message": "NMS-12931: unit test", "committedDate": "2020-09-29T14:54:50Z", "type": "commit"}, {"oid": "d58056a0eb2a71364214511c2fb591d15fcf7d40", "url": "https://github.com/OpenNMS/opennms/commit/d58056a0eb2a71364214511c2fb591d15fcf7d40", "message": "NMS-12931: unit test", "committedDate": "2020-09-29T14:54:50Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjgwMzE0OQ==", "url": "https://github.com/OpenNMS/opennms/pull/3171#discussion_r496803149", "bodyText": "lengthFirstStr and lengthSecondStr can be final", "author": "christianpape", "createdAt": "2020-09-29T15:16:59Z", "path": "opennms-dao/src/main/java/org/opennms/netmgt/dao/support/RrdResourceAttributeUtils.java", "diffHunk": "@@ -255,4 +256,79 @@ protected static String getStringProperty(File directory, String key) {\n             throw new DataAccessResourceFailureException(message, e);\n         }\n     }\n+\n+    /**\n+     * Alphanumeric sort that handles substrings with numeric components\n+     */\n+    public static class AlphaNumericOnmsAttributeComparator implements Serializable, Comparator<OnmsAttribute> {\n+        private static final long serialVersionUID = 1;\n+\n+        public int compare(final OnmsAttribute firstAtt, final OnmsAttribute secondAtt) {\n+            // Sorting algorithm found here: http://blog.icodejava.com/261/how-to-sort-alpha-numeric-strings-in-java/\n+            final String firstString  = firstAtt.getName();\n+            final String secondString = secondAtt.getName();\n+\n+            if (secondString == null || firstString == null) {\n+                return 0;\n+            }\n+\n+            int lengthFirstStr = firstString.length();", "originalCommit": "d58056a0eb2a71364214511c2fb591d15fcf7d40", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjgwMzM2MQ==", "url": "https://github.com/OpenNMS/opennms/pull/3171#discussion_r496803361", "bodyText": "result can also be final", "author": "christianpape", "createdAt": "2020-09-29T15:17:17Z", "path": "opennms-dao/src/main/java/org/opennms/netmgt/dao/support/RrdResourceAttributeUtils.java", "diffHunk": "@@ -255,4 +256,79 @@ protected static String getStringProperty(File directory, String key) {\n             throw new DataAccessResourceFailureException(message, e);\n         }\n     }\n+\n+    /**\n+     * Alphanumeric sort that handles substrings with numeric components\n+     */\n+    public static class AlphaNumericOnmsAttributeComparator implements Serializable, Comparator<OnmsAttribute> {\n+        private static final long serialVersionUID = 1;\n+\n+        public int compare(final OnmsAttribute firstAtt, final OnmsAttribute secondAtt) {\n+            // Sorting algorithm found here: http://blog.icodejava.com/261/how-to-sort-alpha-numeric-strings-in-java/\n+            final String firstString  = firstAtt.getName();\n+            final String secondString = secondAtt.getName();\n+\n+            if (secondString == null || firstString == null) {\n+                return 0;\n+            }\n+\n+            int lengthFirstStr = firstString.length();\n+            int lengthSecondStr = secondString.length();\n+\n+            int index1 = 0;\n+            int index2 = 0;\n+\n+            while (index1 < lengthFirstStr && index2 < lengthSecondStr) {\n+                char ch1 = firstString.charAt(index1);\n+                char ch2 = secondString.charAt(index2);\n+\n+                final char[] space1 = new char[lengthFirstStr];\n+                final char[] space2 = new char[lengthSecondStr];\n+\n+                int loc1 = 0;\n+                int loc2 = 0;\n+\n+                do {\n+                    space1[loc1++] = ch1;\n+                    index1++;\n+\n+                    if (index1 < lengthFirstStr) {\n+                        ch1 = firstString.charAt(index1);\n+                    } else {\n+                        break;\n+                    }\n+                } while (Character.isDigit(ch1) == Character.isDigit(space1[0]));\n+\n+                do {\n+                    space2[loc2++] = ch2;\n+                    index2++;\n+\n+                    if (index2 < lengthSecondStr) {\n+                        ch2 = secondString.charAt(index2);\n+                    } else {\n+                        break;\n+                    }\n+                } while (Character.isDigit(ch2) == Character.isDigit(space2[0]));\n+\n+                final String str1 = new String(space1);\n+                final String str2 = new String(space2);\n+\n+                int result;", "originalCommit": "d58056a0eb2a71364214511c2fb591d15fcf7d40", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e3900d4e81c187f0870ebeb2dfc561eceb6e11de", "url": "https://github.com/OpenNMS/opennms/commit/e3900d4e81c187f0870ebeb2dfc561eceb6e11de", "message": "NMS-12931: feedback from @christianpape", "committedDate": "2020-09-29T15:23:57Z", "type": "commit"}]}