{"pr_number": 3080, "pr_title": "NMS-12820: Remote Poller: Modify model to new structure", "pr_createdAt": "2020-07-24T17:56:01Z", "pr_url": "https://github.com/OpenNMS/opennms/pull/3080", "timeline": [{"oid": "3262c6fff8032e20afdad973728ab4d1583988e0", "url": "https://github.com/OpenNMS/opennms/commit/3262c6fff8032e20afdad973728ab4d1583988e0", "message": "NMS-12820: Remote Poller: Modify model to new structure", "committedDate": "2020-07-24T17:50:04Z", "type": "commit"}, {"oid": "21a2d1d024d7fe843286e6f0aeab153954c96900", "url": "https://github.com/OpenNMS/opennms/commit/21a2d1d024d7fe843286e6f0aeab153954c96900", "message": "NMS-12820: Remote Poller: Modify model to new structure: fix sql scripts", "committedDate": "2020-07-24T20:38:34Z", "type": "commit"}, {"oid": "3191422a904ebe850027f3336817ebc9de2ca930", "url": "https://github.com/OpenNMS/opennms/commit/3191422a904ebe850027f3336817ebc9de2ca930", "message": "NMS-12820: Remote Poller: Modify model to new structure: fix join", "committedDate": "2020-07-24T21:42:08Z", "type": "commit"}, {"oid": "e78f53634af5bcfe53769a6f56178caa562d20c0", "url": "https://github.com/OpenNMS/opennms/commit/e78f53634af5bcfe53769a6f56178caa562d20c0", "message": "NMS-12820: Remote Poller: fix tests, but added a lot of TODOs", "committedDate": "2020-08-04T16:07:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTE2Njk1MQ==", "url": "https://github.com/OpenNMS/opennms/pull/3080#discussion_r465166951", "bodyText": "@fooker I believe we can delete this event?", "author": "patrick-schweizer", "createdAt": "2020-08-04T16:12:31Z", "path": "features/events/api/src/main/java/org/opennms/netmgt/events/api/EventConstants.java", "diffHunk": "@@ -108,6 +108,7 @@\n     /**\n      * The poller package association changed event UEI.\n      */\n+    // TODO Patrick: do we still need this?", "originalCommit": "e78f53634af5bcfe53769a6f56178caa562d20c0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTUxMDQzMg==", "url": "https://github.com/OpenNMS/opennms/pull/3080#discussion_r465510432", "bodyText": "Currently we still using this event in order to re-scheduling only parts of all the scheduled jobs. I think we can create a more general event here that indicates that an application is somehow changed (polling package, locations or monitored services).", "author": "christianpape", "createdAt": "2020-08-05T06:50:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTE2Njk1MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTYyMjA5OA==", "url": "https://github.com/OpenNMS/opennms/pull/3080#discussion_r465622098", "bodyText": "Ack. Created a separate issue for that: https://issues.opennms.org/browse/NMS-12838", "author": "fooker", "createdAt": "2020-08-05T10:16:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTE2Njk1MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTE2NzMyOA==", "url": "https://github.com/OpenNMS/opennms/pull/3080#discussion_r465167328", "bodyText": "@fooker we should discuss this.", "author": "patrick-schweizer", "createdAt": "2020-08-04T16:13:07Z", "path": "features/remotepollerng/daemon/src/main/java/org/opennms/netmgt/remotepollerng/RemotePollerd.java", "diffHunk": "@@ -216,8 +216,9 @@ public void scheduleAllServices() {\n         return mapOfScheduledServices;\n     }\n \n+    // TODO: Patrick: should this be updateScheduledServicesForApplication() going forward?", "originalCommit": "e78f53634af5bcfe53769a6f56178caa562d20c0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTE2NzUxMw==", "url": "https://github.com/OpenNMS/opennms/pull/3080#discussion_r465167513", "bodyText": "@fooker we should discuss this.", "author": "patrick-schweizer", "createdAt": "2020-08-04T16:13:23Z", "path": "features/remotepollerng/daemon/src/test/java/org/opennms/netmgt/remotepollerng/RemotePollerdIT.java", "diffHunk": "@@ -96,6 +95,7 @@\n })\n @JUnitConfigurationEnvironment\n @JUnitTemporaryDatabase(reuseDatabase = false)\n+@Ignore // TODO: Patrick: rewrite test after we have finalized how it should look like...", "originalCommit": "e78f53634af5bcfe53769a6f56178caa562d20c0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTE2Nzg1MQ==", "url": "https://github.com/OpenNMS/opennms/pull/3080#discussion_r465167851", "bodyText": "@fooker we should discuss this.", "author": "patrick-schweizer", "createdAt": "2020-08-04T16:13:50Z", "path": "opennms-web-api/src/main/java/org/opennms/web/svclayer/support/DefaultDistributedStatusService.java", "diffHunk": "@@ -248,7 +248,7 @@ public SimpleWebTable createStatusTable(DistributedStatusDetailsCommand command,\n                           \"bright\");\n             table.addCell(getResponseText(s.getPollResult()), \"\");\n             table.addCell(reDateify(s.getPollResult().getTimestamp()), \"\");\n-            //TODO: table.addCell(reDateify(s.getLocationMonitor().getLastUpdated()), \"\");\n+            table.addCell(reDateify(new Date()), \"\"); // TODO Patrick: from where do we get the date?", "originalCommit": "e78f53634af5bcfe53769a6f56178caa562d20c0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTYyNTM0Mg==", "url": "https://github.com/OpenNMS/opennms/pull/3080#discussion_r465625342", "bodyText": "This can be ignored(stay as you currently have it) for now - the whole code will hopefully go away soon.", "author": "fooker", "createdAt": "2020-08-05T10:22:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTE2Nzg1MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTE2ODAyNA==", "url": "https://github.com/OpenNMS/opennms/pull/3080#discussion_r465168024", "bodyText": "@fooker we should discuss this.", "author": "patrick-schweizer", "createdAt": "2020-08-04T16:14:03Z", "path": "opennms-webapp-rest/src/main/java/org/opennms/web/rest/v1/config/CollectionConfigurationResource.java", "diffHunk": "@@ -67,11 +65,7 @@ public Response getCollectdConfigurationForLocation(@PathParam(\"location\") final\n             return Response.status(Response.Status.NOT_FOUND).build();\n         }\n \n-        final List<String> collectionPackageNames = def.getCollectionPackageNames();\n-        if (collectionPackageNames != null && collectionPackageNames.size() > 0) {\n-            final CollectdConfiguration collectdConfig = m_collectdConfigResource.get().getCollectdConfigurationForPackages(collectionPackageNames);\n-            return Response.ok(collectdConfig).build();\n-        }\n+        // TODO: Patrick: do we still need this method?", "originalCommit": "e78f53634af5bcfe53769a6f56178caa562d20c0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTYyNjk5MA==", "url": "https://github.com/OpenNMS/opennms/pull/3080#discussion_r465626990", "bodyText": "I think this is a leftover from the first days minion work - the whole component can go away.", "author": "fooker", "createdAt": "2020-08-05T10:26:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTE2ODAyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTc0MDU2Ng==", "url": "https://github.com/OpenNMS/opennms/pull/3080#discussion_r465740566", "bodyText": "\ud83d\udc4d I removed it", "author": "patrick-schweizer", "createdAt": "2020-08-05T13:49:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTE2ODAyNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTE2ODEyNQ==", "url": "https://github.com/OpenNMS/opennms/pull/3080#discussion_r465168125", "bodyText": "@fooker we should discuss this.", "author": "patrick-schweizer", "createdAt": "2020-08-04T16:14:12Z", "path": "opennms-webapp-rest/src/main/java/org/opennms/web/rest/v1/config/PollerConfigurationResource.java", "diffHunk": "@@ -59,6 +57,7 @@\n \n     @GET\n     @Produces({MediaType.APPLICATION_XML, MediaType.APPLICATION_JSON, MediaType.APPLICATION_ATOM_XML})\n+    // TODO: Patrick: do we still need this class?", "originalCommit": "e78f53634af5bcfe53769a6f56178caa562d20c0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTYyNzIzMg==", "url": "https://github.com/OpenNMS/opennms/pull/3080#discussion_r465627232", "bodyText": "Same here - just delete the whole class.", "author": "fooker", "createdAt": "2020-08-05T10:26:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTE2ODEyNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTc0MTEyNQ==", "url": "https://github.com/OpenNMS/opennms/pull/3080#discussion_r465741125", "bodyText": "+1 I removed it", "author": "patrick-schweizer", "createdAt": "2020-08-05T13:50:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTE2ODEyNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTE2ODY5Mg==", "url": "https://github.com/OpenNMS/opennms/pull/3080#discussion_r465168692", "bodyText": "@fooker we should discuss how to rewrite this test", "author": "patrick-schweizer", "createdAt": "2020-08-04T16:15:03Z", "path": "opennms-webapp-rest/src/test/java/org/opennms/web/rest/v1/MonitoringLocationRestServiceIT.java", "diffHunk": "@@ -97,9 +93,10 @@ public void testEventOnUpdate() throws Exception {\n         this.eventIpcManager.getEventAnticipator().verifyAnticipated();\n \n         // add polling package\n-        this.eventIpcManager.getEventAnticipator().anticipateEvent(new EventBuilder(EventConstants.POLLER_PACKAGE_LOCATION_ASSOCIATION_CHANGED_EVENT_UEI, \"ReST\").addParam(EventConstants.PARM_DAEMON_NAME, \"RemotePollerNG\").getEvent());\n-        sendPut(\"/monitoringLocations/location1\", \"pollingPackageNames=foo\", 204);\n-        this.eventIpcManager.getEventAnticipator().verifyAnticipated();\n+        // TODO: Patrick remove", "originalCommit": "e78f53634af5bcfe53769a6f56178caa562d20c0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTk3MTIzOQ==", "url": "https://github.com/OpenNMS/opennms/pull/3080#discussion_r465971239", "bodyText": "all rest services are not relevant for now", "author": "patrick-schweizer", "createdAt": "2020-08-05T20:02:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTE2ODY5Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTE2ODgxNg==", "url": "https://github.com/OpenNMS/opennms/pull/3080#discussion_r465168816", "bodyText": "@fooker we should discuss how to rewrite this test", "author": "patrick-schweizer", "createdAt": "2020-08-04T16:15:14Z", "path": "opennms-webapp-rest/src/test/java/org/opennms/web/rest/v1/RemotePollerAvailabilityRestServiceIT.java", "diffHunk": "@@ -87,6 +88,8 @@\n @JUnitConfigurationEnvironment\n @JUnitTemporaryDatabase\n @Transactional\n+// TODO: Patrick fix test?", "originalCommit": "e78f53634af5bcfe53769a6f56178caa562d20c0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTE2OTA4Ng==", "url": "https://github.com/OpenNMS/opennms/pull/3080#discussion_r465169086", "bodyText": "@fooker we should discuss how to rewrite this test", "author": "patrick-schweizer", "createdAt": "2020-08-04T16:15:37Z", "path": "opennms-webapp-rest/src/test/java/org/opennms/web/rest/v2/MonitoringLocationRestServiceIT.java", "diffHunk": "@@ -133,10 +129,9 @@ public void testEventOnUpdate() throws Exception {\n         this.eventIpcManager.getEventAnticipator().verifyAnticipated();\n \n         // add polling package\n-        this.eventIpcManager.getEventAnticipator().anticipateEvent(new EventBuilder(EventConstants.POLLER_PACKAGE_LOCATION_ASSOCIATION_CHANGED_EVENT_UEI, \"ReST\").addParam(EventConstants.PARM_DAEMON_NAME, \"RemotePollerNG\").getEvent());\n-        location.setPollingPackageNames(Lists.newArrayList(\"foo\", \"bar\"));\n+        // TODO: Patrick this.eventIpcManager.getEventAnticipator().anticipateEvent(new EventBuilder(EventConstants.POLLER_PACKAGE_LOCATION_ASSOCIATION_CHANGED_EVENT_UEI, \"ReST\").addParam(EventConstants.PARM_DAEMON_NAME, \"RemotePollerNG\").getEvent());", "originalCommit": "e78f53634af5bcfe53769a6f56178caa562d20c0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTE2OTMwMg==", "url": "https://github.com/OpenNMS/opennms/pull/3080#discussion_r465169302", "bodyText": "@fooker we should discuss how to rewrite this test", "author": "patrick-schweizer", "createdAt": "2020-08-04T16:15:55Z", "path": "opennms-webapp/src/test/java/org/opennms/web/svclayer/support/DefaultDistributedStatusServiceTest.java", "diffHunk": "@@ -325,7 +336,8 @@ public void runTestCreateStatus() {\n         \n         expectedTable.newRow();\n         expectedTable.addCell(\"Node 1\", \"Normal\", \"element/node.jsp?node=1\");\n-        expectedTable.addCell(\"Raleigh-\" + LOCATION_MONITOR_ID_A, \"\", \"distributed/locationMonitorDetails.htm?monitorId=\" + LOCATION_MONITOR_ID_A);\n+        // TODO: Patrick: I removed the LOCATION_MONITOR_ID_A to make the test pass again. Is that correct?", "originalCommit": "e78f53634af5bcfe53769a6f56178caa562d20c0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTE2OTQyNw==", "url": "https://github.com/OpenNMS/opennms/pull/3080#discussion_r465169427", "bodyText": "@fooker we should discuss how to rewrite this test", "author": "patrick-schweizer", "createdAt": "2020-08-04T16:16:05Z", "path": "opennms-webapp/src/test/java/org/opennms/web/svclayer/support/DefaultDistributedStatusServiceTest.java", "diffHunk": "@@ -644,6 +672,9 @@ public void testCreateFacilityStatusTableOneApplicationOneOfTwoLocationsReportin\n     /*\n      * XXX need to check sorting\n      */\n+    // TODO: PatrickTest is broken but not sure what to do to fix it", "originalCommit": "e78f53634af5bcfe53769a6f56178caa562d20c0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "772071a259f10d84a81fec2de98b467a1fc34686", "url": "https://github.com/OpenNMS/opennms/commit/772071a259f10d84a81fec2de98b467a1fc34686", "message": "NMS-12820: Remote Poller: fix jpa problem", "committedDate": "2020-08-05T03:52:28Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTUxMjA1OQ==", "url": "https://github.com/OpenNMS/opennms/pull/3080#discussion_r465512059", "bodyText": "The liquibase changes above use a \"bigint\". Please keep both schemes consistent.", "author": "christianpape", "createdAt": "2020-08-05T06:54:23Z", "path": "opennms-base-assembly/src/main/filtered/etc/create.sql", "diffHunk": "@@ -1480,6 +1457,26 @@ CREATE INDEX appid_idx on application_service_map(appid);\n CREATE INDEX ifserviceid_idx on application_service_map(ifserviceid);\n CREATE UNIQUE INDEX appid_ifserviceid_idex on application_service_map(appid,ifserviceid);\n \n+--########################################################################\n+--# application_perspective_location_map table - Many-to-Many mapping table of\n+--# applications to monitoringLocations\n+--#\n+--# This table contains the following fields:\n+--#\n+--# appId                : The application id from applications table\n+--# monitoringLocationId : The id from the monitoringLocations table.\n+--########################################################################\n+\n+create table application_perspective_location_map (\n+                                         appId\t\tinteger,", "originalCommit": "772071a259f10d84a81fec2de98b467a1fc34686", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTc0NTkzNg==", "url": "https://github.com/OpenNMS/opennms/pull/3080#discussion_r465745936", "bodyText": "\ud83d\udc4d fixed", "author": "patrick-schweizer", "createdAt": "2020-08-05T13:57:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTUxMjA1OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTUxMzUwNg==", "url": "https://github.com/OpenNMS/opennms/pull/3080#discussion_r465513506", "bodyText": "Same here. Liquibase changes define this field as \"nullable=false\", so here a \"NOT NULL\" is missing. A foreign key constraint does not imply a not-null constraint.", "author": "christianpape", "createdAt": "2020-08-05T06:57:43Z", "path": "opennms-base-assembly/src/main/filtered/etc/create.sql", "diffHunk": "@@ -1480,6 +1457,26 @@ CREATE INDEX appid_idx on application_service_map(appid);\n CREATE INDEX ifserviceid_idx on application_service_map(ifserviceid);\n CREATE UNIQUE INDEX appid_ifserviceid_idex on application_service_map(appid,ifserviceid);\n \n+--########################################################################\n+--# application_perspective_location_map table - Many-to-Many mapping table of\n+--# applications to monitoringLocations\n+--#\n+--# This table contains the following fields:\n+--#\n+--# appId                : The application id from applications table\n+--# monitoringLocationId : The id from the monitoringLocations table.\n+--########################################################################\n+\n+create table application_perspective_location_map (\n+                                         appId\t\tinteger,\n+                                         monitoringLocationId\ttext,", "originalCommit": "772071a259f10d84a81fec2de98b467a1fc34686", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTc0NjczNg==", "url": "https://github.com/OpenNMS/opennms/pull/3080#discussion_r465746736", "bodyText": "fixed.", "author": "patrick-schweizer", "createdAt": "2020-08-05T13:58:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTUxMzUwNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTUxNTUxMA==", "url": "https://github.com/OpenNMS/opennms/pull/3080#discussion_r465515510", "bodyText": "The column's name in the schema is \"pollingpackage\" not \"polling_package\".", "author": "christianpape", "createdAt": "2020-08-05T07:01:57Z", "path": "opennms-model/src/main/java/org/opennms/netmgt/model/OnmsApplication.java", "diffHunk": "@@ -116,35 +107,47 @@ public void setName(String name) {\n     @XmlElementWrapper(name=\"monitoredServices\")\n     @JsonBackReference\n     public Set<OnmsMonitoredService> getMonitoredServices() {\n-        return m_monitoredServices;\n+        return monitoredServices;\n     }\n \n-    /**\n-     * <p>setMonitoredServices</p>\n-     *\n-     * @param services a {@link java.util.Set} object.\n-     * @since 1.8.1\n-     */\n     public void setMonitoredServices(Set<OnmsMonitoredService> services) {\n-        m_monitoredServices = services;\n+        monitoredServices = services;\n     }\n \n-    /**\n-     * <p>addMonitoredService</p>\n-     *\n-     * @param service a {@link org.opennms.netmgt.model.OnmsMonitoredService} object.\n-     * @since 1.8.1\n-     */\n     public void addMonitoredService(OnmsMonitoredService service) {\n         getMonitoredServices().add(service);\n     }\n \n-    /**\n-     * <p>compareTo</p>\n-     *\n-     * @param o a {@link org.opennms.netmgt.model.OnmsApplication} object.\n-     * @return a int.\n-     */\n+\n+    @ManyToMany( cascade={CascadeType.PERSIST, CascadeType.MERGE})\n+    @JoinTable(name=\"application_perspective_location_map\",\n+            joinColumns=@JoinColumn(name=\"appId\", referencedColumnName = \"id\"),\n+            inverseJoinColumns=@JoinColumn(name=\"monitoringLocationId\", referencedColumnName = \"id\"))\n+    @XmlIDREF\n+    @XmlElement(name=\"perspectiveLocationId\")\n+    @XmlElementWrapper(name=\"perspectiveLocations\")\n+    public Set<OnmsMonitoringLocation> getPerspectiveLocations() {\n+        return this.perspectiveLocations;\n+    }\n+\n+    public void setPerspectiveLocations(Set<OnmsMonitoringLocation> perspectiveLocations) {\n+        this.perspectiveLocations = perspectiveLocations;\n+    }\n+\n+    public void addPerspectiveLocation(OnmsMonitoringLocation perspectiveLocation) {\n+        getPerspectiveLocations().add(perspectiveLocation);\n+    }\n+\n+    /** Can be null. */\n+    @Column(name = \"polling_package\", nullable=true)", "originalCommit": "772071a259f10d84a81fec2de98b467a1fc34686", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTc0OTE0NQ==", "url": "https://github.com/OpenNMS/opennms/pull/3080#discussion_r465749145", "bodyText": "good catch! I changed the name but forgot here. fixed.", "author": "patrick-schweizer", "createdAt": "2020-08-05T14:02:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTUxNTUxMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTUxNjc2OA==", "url": "https://github.com/OpenNMS/opennms/pull/3080#discussion_r465516768", "bodyText": "The current implementation / Web-UI allows users to create applicationnames that differ only in upper and lower case. So, I think we should not ignore the case at this point.", "author": "christianpape", "createdAt": "2020-08-05T07:04:54Z", "path": "opennms-model/src/main/java/org/opennms/netmgt/model/OnmsApplication.java", "diffHunk": "@@ -116,35 +107,47 @@ public void setName(String name) {\n     @XmlElementWrapper(name=\"monitoredServices\")\n     @JsonBackReference\n     public Set<OnmsMonitoredService> getMonitoredServices() {\n-        return m_monitoredServices;\n+        return monitoredServices;\n     }\n \n-    /**\n-     * <p>setMonitoredServices</p>\n-     *\n-     * @param services a {@link java.util.Set} object.\n-     * @since 1.8.1\n-     */\n     public void setMonitoredServices(Set<OnmsMonitoredService> services) {\n-        m_monitoredServices = services;\n+        monitoredServices = services;\n     }\n \n-    /**\n-     * <p>addMonitoredService</p>\n-     *\n-     * @param service a {@link org.opennms.netmgt.model.OnmsMonitoredService} object.\n-     * @since 1.8.1\n-     */\n     public void addMonitoredService(OnmsMonitoredService service) {\n         getMonitoredServices().add(service);\n     }\n \n-    /**\n-     * <p>compareTo</p>\n-     *\n-     * @param o a {@link org.opennms.netmgt.model.OnmsApplication} object.\n-     * @return a int.\n-     */\n+\n+    @ManyToMany( cascade={CascadeType.PERSIST, CascadeType.MERGE})\n+    @JoinTable(name=\"application_perspective_location_map\",\n+            joinColumns=@JoinColumn(name=\"appId\", referencedColumnName = \"id\"),\n+            inverseJoinColumns=@JoinColumn(name=\"monitoringLocationId\", referencedColumnName = \"id\"))\n+    @XmlIDREF\n+    @XmlElement(name=\"perspectiveLocationId\")\n+    @XmlElementWrapper(name=\"perspectiveLocations\")\n+    public Set<OnmsMonitoringLocation> getPerspectiveLocations() {\n+        return this.perspectiveLocations;\n+    }\n+\n+    public void setPerspectiveLocations(Set<OnmsMonitoringLocation> perspectiveLocations) {\n+        this.perspectiveLocations = perspectiveLocations;\n+    }\n+\n+    public void addPerspectiveLocation(OnmsMonitoringLocation perspectiveLocation) {\n+        getPerspectiveLocations().add(perspectiveLocation);\n+    }\n+\n+    /** Can be null. */\n+    @Column(name = \"polling_package\", nullable=true)\n+    public String getPollingPackage() {\n+        return pollingPackage;\n+    }\n+\n+    public void setPollingPackage(String pollingPackage) {\n+        this.pollingPackage = pollingPackage;\n+    }\n+\n     @Override\n     public int compareTo(OnmsApplication o) {\n         return getName().compareToIgnoreCase(o.getName());", "originalCommit": "772071a259f10d84a81fec2de98b467a1fc34686", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTc0OTgzMw==", "url": "https://github.com/OpenNMS/opennms/pull/3080#discussion_r465749833", "bodyText": "I didn't change that but makes sense. I removed the check..", "author": "patrick-schweizer", "createdAt": "2020-08-05T14:03:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTUxNjc2OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTUyMDMzNw==", "url": "https://github.com/OpenNMS/opennms/pull/3080#discussion_r465520337", "bodyText": "The POLLER_PACKAGE_LOCATION_ASSOCIATION_CHANGED_EVENT_UEI can be removed, but it's handling must be moved to the ApplicationRestService. We already have an APPLICATION_DELETED_EVENT_UEI, so I think we should introduce an additional APPLICATION_CHANGED_EVENT_UEI in order to re-schedule services at runtime.", "author": "christianpape", "createdAt": "2020-08-05T07:12:37Z", "path": "opennms-webapp-rest/src/main/java/org/opennms/web/rest/v1/MonitoringLocationsRestService.java", "diffHunk": "@@ -117,19 +116,6 @@ public Response addMonitoringLocation(@Context final UriInfo uriInfo, OnmsMonito\n \t\ttry {\n \t\t\tLOG.debug(\"addMonitoringLocation: Adding monitoringLocation {}\", monitoringLocation.getLocationName());\n \t\t\tm_monitoringLocationDao.save(monitoringLocation);\n-\n-\t\t\tfinal boolean sendEvent = monitoringLocation.getPollingPackageNames() != null && !monitoringLocation.getPollingPackageNames().isEmpty();", "originalCommit": "772071a259f10d84a81fec2de98b467a1fc34686", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTYyMzIyMw==", "url": "https://github.com/OpenNMS/opennms/pull/3080#discussion_r465623223", "bodyText": "Same for an APPLICATION_CREATED_EVENT_UEI", "author": "fooker", "createdAt": "2020-08-05T10:18:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTUyMDMzNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTYyMzQwOA==", "url": "https://github.com/OpenNMS/opennms/pull/3080#discussion_r465623408", "bodyText": "See https://issues.opennms.org/browse/NMS-12838", "author": "fooker", "createdAt": "2020-08-05T10:18:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTUyMDMzNw=="}], "type": "inlineReview"}, {"oid": "db10e5747f4769740b4e5328f425a37403b1c717", "url": "https://github.com/OpenNMS/opennms/commit/db10e5747f4769740b4e5328f425a37403b1c717", "message": "NMS-12820: Remote Poller: fix pr comments", "committedDate": "2020-08-05T14:29:55Z", "type": "commit"}, {"oid": "1ef7ccf169c04a4ee207a8226ade1d9dd37a0d3b", "url": "https://github.com/OpenNMS/opennms/commit/1ef7ccf169c04a4ee207a8226ade1d9dd37a0d3b", "message": "NMS-12820: Remote Poller: fix pr comments", "committedDate": "2020-08-05T14:44:52Z", "type": "commit"}, {"oid": "f6de0c3669bf8f1d9aa6e1c24dbbf6e72573b016", "url": "https://github.com/OpenNMS/opennms/commit/f6de0c3669bf8f1d9aa6e1c24dbbf6e72573b016", "message": "NMS-12820: Remote Poller: fix pr comments", "committedDate": "2020-08-05T14:57:16Z", "type": "commit"}, {"oid": "cb44243c45d1f444e979be9b8023458403edd48e", "url": "https://github.com/OpenNMS/opennms/commit/cb44243c45d1f444e979be9b8023458403edd48e", "message": "NMS-12820: Remote Poller: adopt MigrationLocationsMigratorOffline", "committedDate": "2020-08-05T19:50:01Z", "type": "commit"}, {"oid": "a17524d728cf6025affbc7ae87445f3e85c0af45", "url": "https://github.com/OpenNMS/opennms/commit/a17524d728cf6025affbc7ae87445f3e85c0af45", "message": "NMS-12820: Remote Poller: remove MigrationLocationsMigratorOffline", "committedDate": "2020-08-06T00:15:11Z", "type": "commit"}]}