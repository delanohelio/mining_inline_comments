{"pr_number": 1488, "pr_title": "Handle MFA timeouts during ActiveDirectoryInteractive authentication by retrying connection", "pr_createdAt": "2020-12-22T02:48:47Z", "pr_url": "https://github.com/microsoft/mssql-jdbc/pull/1488", "timeline": [{"oid": "c97b863c95385bdcd1afc897ef39cbebaf495578", "url": "https://github.com/microsoft/mssql-jdbc/commit/c97b863c95385bdcd1afc897ef39cbebaf495578", "message": "Fix AEv2 tests exclude for reqExternalSetup and cleanup (#1247)", "committedDate": "2020-02-05T19:03:48Z", "type": "commit"}, {"oid": "54b5a194e5d46552419c86e0d1f8c800f42d3de8", "url": "https://github.com/microsoft/mssql-jdbc/commit/54b5a194e5d46552419c86e0d1f8c800f42d3de8", "message": "Fix | Add null check for getObject() with LocalTime and LocalDate (#1250)", "committedDate": "2020-02-08T00:19:05Z", "type": "commit"}, {"oid": "672b7d67caae75250c53f82a760e8d3880e62a37", "url": "https://github.com/microsoft/mssql-jdbc/commit/672b7d67caae75250c53f82a760e8d3880e62a37", "message": "added all AKV tests to use reqExternalSetup tag so they will be skipped by default (#1254)\n\n* skip AKV test properly\r\n\r\n* removed enclave properties string to failed errors as enclave tests could be skipped", "committedDate": "2020-02-10T19:04:22Z", "type": "commit"}, {"oid": "3c3331b7b0ff1b27b1e80271bf9ffdc6aae7be79", "url": "https://github.com/microsoft/mssql-jdbc/commit/3c3331b7b0ff1b27b1e80271bf9ffdc6aae7be79", "message": "Merge remote-tracking branch 'upstream/dev' into dev", "committedDate": "2020-03-25T06:21:47Z", "type": "commit"}, {"oid": "e2c5640370daa89c0d8c1559b5791e99656f78c8", "url": "https://github.com/microsoft/mssql-jdbc/commit/e2c5640370daa89c0d8c1559b5791e99656f78c8", "message": "Merge remote-tracking branch 'upstream/dev' into dev", "committedDate": "2020-03-26T06:10:08Z", "type": "commit"}, {"oid": "aad696640378b75f3cb8cb24cc2fa299358db9ac", "url": "https://github.com/microsoft/mssql-jdbc/commit/aad696640378b75f3cb8cb24cc2fa299358db9ac", "message": "Merge remote-tracking branch 'upstream/dev' into dev", "committedDate": "2020-03-28T03:18:02Z", "type": "commit"}, {"oid": "92bf04c2787c3b2a704f641f50cb4a83193f1d6d", "url": "https://github.com/microsoft/mssql-jdbc/commit/92bf04c2787c3b2a704f641f50cb4a83193f1d6d", "message": "Merge remote-tracking branch 'upstream/dev' into dev", "committedDate": "2020-03-31T01:58:20Z", "type": "commit"}, {"oid": "3ba5ab72008501e23f43dbcbcc333775320ddafa", "url": "https://github.com/microsoft/mssql-jdbc/commit/3ba5ab72008501e23f43dbcbcc333775320ddafa", "message": "Merge remote-tracking branch 'upstream/dev' into dev", "committedDate": "2020-04-04T05:47:37Z", "type": "commit"}, {"oid": "d20823deffea162b2b17b079cc291f91269558aa", "url": "https://github.com/microsoft/mssql-jdbc/commit/d20823deffea162b2b17b079cc291f91269558aa", "message": "Merge remote-tracking branch 'upstream/dev' into dev", "committedDate": "2020-04-07T00:45:05Z", "type": "commit"}, {"oid": "4cc959f7e76eedbf49e30e5b92de43c86d7eb803", "url": "https://github.com/microsoft/mssql-jdbc/commit/4cc959f7e76eedbf49e30e5b92de43c86d7eb803", "message": "Merge remote-tracking branch 'upstream/dev' into dev", "committedDate": "2020-04-29T02:59:23Z", "type": "commit"}, {"oid": "7b301f8184b26da4d99b2feab8b2aea886c01cea", "url": "https://github.com/microsoft/mssql-jdbc/commit/7b301f8184b26da4d99b2feab8b2aea886c01cea", "message": "Merge remote-tracking branch 'upstream/dev' into dev", "committedDate": "2020-04-30T06:36:21Z", "type": "commit"}, {"oid": "56bcf139fe6acd87c41b3829b4f157c59bd9f873", "url": "https://github.com/microsoft/mssql-jdbc/commit/56bcf139fe6acd87c41b3829b4f157c59bd9f873", "message": "Merge remote-tracking branch 'upstream/dev' into dev", "committedDate": "2020-05-07T22:26:03Z", "type": "commit"}, {"oid": "744e0ca78e57bc6c0db98910a9066d5b583c6ba8", "url": "https://github.com/microsoft/mssql-jdbc/commit/744e0ca78e57bc6c0db98910a9066d5b583c6ba8", "message": "Merge remote-tracking branch 'upstream/dev' into dev", "committedDate": "2020-05-12T22:47:18Z", "type": "commit"}, {"oid": "df8fd41ffa6005b18b0e328593faaeb495ce6547", "url": "https://github.com/microsoft/mssql-jdbc/commit/df8fd41ffa6005b18b0e328593faaeb495ce6547", "message": "Merge remote-tracking branch 'upstream/dev' into dev", "committedDate": "2020-05-19T01:06:51Z", "type": "commit"}, {"oid": "652e68b110828db6b172c1b02df6a06ab04c2b59", "url": "https://github.com/microsoft/mssql-jdbc/commit/652e68b110828db6b172c1b02df6a06ab04c2b59", "message": "Merge remote-tracking branch 'upstream/dev' into dev", "committedDate": "2020-05-26T07:07:35Z", "type": "commit"}, {"oid": "53736db944298004a4a383be14ae83370ffab717", "url": "https://github.com/microsoft/mssql-jdbc/commit/53736db944298004a4a383be14ae83370ffab717", "message": "Merge remote-tracking branch 'upstream/dev' into dev", "committedDate": "2020-05-26T23:02:59Z", "type": "commit"}, {"oid": "9ba6a42285fcc046a0a68e110454b62d8f7f6657", "url": "https://github.com/microsoft/mssql-jdbc/commit/9ba6a42285fcc046a0a68e110454b62d8f7f6657", "message": "Merge remote-tracking branch 'upstream/dev' into dev", "committedDate": "2020-06-02T06:50:57Z", "type": "commit"}, {"oid": "6d156f728a1253dd469da1c6896189762b00097b", "url": "https://github.com/microsoft/mssql-jdbc/commit/6d156f728a1253dd469da1c6896189762b00097b", "message": "Merge remote-tracking branch 'upstream/dev' into dev", "committedDate": "2020-06-05T19:15:40Z", "type": "commit"}, {"oid": "e08ffe5f54050344920bc48d44dc8e04cd143866", "url": "https://github.com/microsoft/mssql-jdbc/commit/e08ffe5f54050344920bc48d44dc8e04cd143866", "message": "Merge remote-tracking branch 'upstream/dev' into dev", "committedDate": "2020-06-10T21:34:05Z", "type": "commit"}, {"oid": "6b6cab266b655c48858187f56071aa3e4ba87054", "url": "https://github.com/microsoft/mssql-jdbc/commit/6b6cab266b655c48858187f56071aa3e4ba87054", "message": "Merge remote-tracking branch 'upstream/dev' into dev", "committedDate": "2020-06-18T19:14:21Z", "type": "commit"}, {"oid": "c2025901e1c9e8b279f42279da2f25ffd6c4232a", "url": "https://github.com/microsoft/mssql-jdbc/commit/c2025901e1c9e8b279f42279da2f25ffd6c4232a", "message": "Merge remote-tracking branch 'upstream/dev' into dev", "committedDate": "2020-06-24T18:58:46Z", "type": "commit"}, {"oid": "0515d4b0d51c3150b2149438f8b8a69be3dfc2bd", "url": "https://github.com/microsoft/mssql-jdbc/commit/0515d4b0d51c3150b2149438f8b8a69be3dfc2bd", "message": "Merge remote-tracking branch 'upstream/dev' into dev", "committedDate": "2020-06-24T20:34:25Z", "type": "commit"}, {"oid": "2c63b5828becf3f737f4edf95593d98ada4e273a", "url": "https://github.com/microsoft/mssql-jdbc/commit/2c63b5828becf3f737f4edf95593d98ada4e273a", "message": "Merge remote-tracking branch 'upstream/dev' into dev", "committedDate": "2020-06-25T06:36:46Z", "type": "commit"}, {"oid": "78aa941fab02af4aef190c7da6141b1251a84b4b", "url": "https://github.com/microsoft/mssql-jdbc/commit/78aa941fab02af4aef190c7da6141b1251a84b4b", "message": "Merge remote-tracking branch 'upstream/dev' into dev", "committedDate": "2020-07-02T18:43:21Z", "type": "commit"}, {"oid": "90e99cd54a0cb4347f813d965ea38b0a9801e8b0", "url": "https://github.com/microsoft/mssql-jdbc/commit/90e99cd54a0cb4347f813d965ea38b0a9801e8b0", "message": "Merge remote-tracking branch 'upstream/dev' into dev", "committedDate": "2020-07-02T20:57:03Z", "type": "commit"}, {"oid": "da1004bb9862d31941e537e77bd0e2ded5edef96", "url": "https://github.com/microsoft/mssql-jdbc/commit/da1004bb9862d31941e537e77bd0e2ded5edef96", "message": "Merge remote-tracking branch 'upstream/dev' into dev", "committedDate": "2020-07-06T22:39:35Z", "type": "commit"}, {"oid": "9ca12848377fad04ad8f8d2a29258ea8500f70d2", "url": "https://github.com/microsoft/mssql-jdbc/commit/9ca12848377fad04ad8f8d2a29258ea8500f70d2", "message": "Merge remote-tracking branch 'upstream/dev' into dev", "committedDate": "2020-07-28T07:45:46Z", "type": "commit"}, {"oid": "c67d8edea9341b2b94a075ecbbc4768e313f0658", "url": "https://github.com/microsoft/mssql-jdbc/commit/c67d8edea9341b2b94a075ecbbc4768e313f0658", "message": "Merge remote-tracking branch 'upstream/dev' into dev", "committedDate": "2020-08-01T00:41:25Z", "type": "commit"}, {"oid": "1d0a4adf7296966d52421ace5011fcc2fcc3147a", "url": "https://github.com/microsoft/mssql-jdbc/commit/1d0a4adf7296966d52421ace5011fcc2fcc3147a", "message": "Merge remote-tracking branch 'upstream/dev' into dev", "committedDate": "2020-08-05T00:02:31Z", "type": "commit"}, {"oid": "f1b1dfbf14ed46682044e343a9e1e34e258827d3", "url": "https://github.com/microsoft/mssql-jdbc/commit/f1b1dfbf14ed46682044e343a9e1e34e258827d3", "message": "Merge remote-tracking branch 'upstream/dev' into dev", "committedDate": "2020-08-26T20:44:33Z", "type": "commit"}, {"oid": "d9bad87bda75441fad79010fb31e90c7de8b6a5d", "url": "https://github.com/microsoft/mssql-jdbc/commit/d9bad87bda75441fad79010fb31e90c7de8b6a5d", "message": "Merge remote-tracking branch 'upstream/dev' into dev", "committedDate": "2020-09-02T05:47:37Z", "type": "commit"}, {"oid": "a2e50b9b66d9207415d6853fa449fc55e968a44a", "url": "https://github.com/microsoft/mssql-jdbc/commit/a2e50b9b66d9207415d6853fa449fc55e968a44a", "message": "Merge remote-tracking branch 'upstream/dev' into dev", "committedDate": "2020-09-09T19:00:26Z", "type": "commit"}, {"oid": "7ff97dee94ec4144ef22e5d12ba76f1a84ebe3c9", "url": "https://github.com/microsoft/mssql-jdbc/commit/7ff97dee94ec4144ef22e5d12ba76f1a84ebe3c9", "message": "enable ADintegrated tests for non-windows", "committedDate": "2020-09-09T23:20:13Z", "type": "commit"}, {"oid": "7cae3b431dc533e07042f1bbc810995f78b64510", "url": "https://github.com/microsoft/mssql-jdbc/commit/7cae3b431dc533e07042f1bbc810995f78b64510", "message": "fixed user test for kerberos", "committedDate": "2020-09-11T05:34:42Z", "type": "commit"}, {"oid": "c8c5a2977c700d62815ab8073ea11a8d40885deb", "url": "https://github.com/microsoft/mssql-jdbc/commit/c8c5a2977c700d62815ab8073ea11a8d40885deb", "message": "Merge remote-tracking branch 'upstream/dev' into dev", "committedDate": "2020-09-16T22:34:15Z", "type": "commit"}, {"oid": "d76368aedf39c5dbc573f7449e91524b1227daf7", "url": "https://github.com/microsoft/mssql-jdbc/commit/d76368aedf39c5dbc573f7449e91524b1227daf7", "message": "Merge remote-tracking branch 'upstream/dev' into dev", "committedDate": "2020-09-22T05:08:08Z", "type": "commit"}, {"oid": "e5aafd300061bee1968463cf7ad1d07d6da8356d", "url": "https://github.com/microsoft/mssql-jdbc/commit/e5aafd300061bee1968463cf7ad1d07d6da8356d", "message": "Merge branch 'dev' of https://github.com/lilgreenbird/mssql-jdbc into dev", "committedDate": "2020-09-22T05:08:27Z", "type": "commit"}, {"oid": "7800824306a3a34fb9976887e36e96fb8bcabd73", "url": "https://github.com/microsoft/mssql-jdbc/commit/7800824306a3a34fb9976887e36e96fb8bcabd73", "message": "Merge remote-tracking branch 'upstream/dev' into dev", "committedDate": "2020-10-05T20:56:53Z", "type": "commit"}, {"oid": "a8199bbbddf7c75d6381cf0d057b00504823c005", "url": "https://github.com/microsoft/mssql-jdbc/commit/a8199bbbddf7c75d6381cf0d057b00504823c005", "message": "merged", "committedDate": "2020-10-14T23:58:37Z", "type": "commit"}, {"oid": "3a91ea12fbdca3f4e30ff6865e172a01ba53cdfb", "url": "https://github.com/microsoft/mssql-jdbc/commit/3a91ea12fbdca3f4e30ff6865e172a01ba53cdfb", "message": "Merge remote-tracking branch 'upstream/dev' into dev", "committedDate": "2020-10-16T20:46:04Z", "type": "commit"}, {"oid": "3e39be1a62d7d3b530631db181f9ca211b4bc284", "url": "https://github.com/microsoft/mssql-jdbc/commit/3e39be1a62d7d3b530631db181f9ca211b4bc284", "message": "Merge remote-tracking branch 'upstream/dev' into dev", "committedDate": "2020-10-28T01:25:50Z", "type": "commit"}, {"oid": "16d2bbdd531e6a94e1c49208ce03211cc1081993", "url": "https://github.com/microsoft/mssql-jdbc/commit/16d2bbdd531e6a94e1c49208ce03211cc1081993", "message": "Merge remote-tracking branch 'upstream/dev' into dev", "committedDate": "2020-11-28T02:23:01Z", "type": "commit"}, {"oid": "f9d22e9105fa363b210884fbf37025ce83962d79", "url": "https://github.com/microsoft/mssql-jdbc/commit/f9d22e9105fa363b210884fbf37025ce83962d79", "message": "Merge remote-tracking branch 'upstream/dev' into dev", "committedDate": "2020-12-02T00:40:18Z", "type": "commit"}, {"oid": "8eeb9a63ad7b9bff1aea5ea7528eca22985af025", "url": "https://github.com/microsoft/mssql-jdbc/commit/8eeb9a63ad7b9bff1aea5ea7528eca22985af025", "message": "Merge remote-tracking branch 'upstream/dev' into dev", "committedDate": "2020-12-08T06:08:33Z", "type": "commit"}, {"oid": "438a67e4ad778cc026e75bf1b9b3c3c1496ebabc", "url": "https://github.com/microsoft/mssql-jdbc/commit/438a67e4ad778cc026e75bf1b9b3c3c1496ebabc", "message": "mfa retry", "committedDate": "2020-12-19T10:39:57Z", "type": "commit"}, {"oid": "37ff971bb993dce4b60cf2aac42d8ced53509eb6", "url": "https://github.com/microsoft/mssql-jdbc/commit/37ff971bb993dce4b60cf2aac42d8ced53509eb6", "message": "update", "committedDate": "2020-12-19T10:53:31Z", "type": "commit"}, {"oid": "99ada36618385723c8b27c2581bc090a3e7e1d7d", "url": "https://github.com/microsoft/mssql-jdbc/commit/99ada36618385723c8b27c2581bc090a3e7e1d7d", "message": "cleanup", "committedDate": "2020-12-22T02:44:11Z", "type": "commit"}, {"oid": "3748ab2372fdfc385aa2f56dc61989ef75af59ec", "url": "https://github.com/microsoft/mssql-jdbc/commit/3748ab2372fdfc385aa2f56dc61989ef75af59ec", "message": "Merge remote-tracking branch 'upstream/dev' into timeout", "committedDate": "2021-01-05T19:31:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjE1ODUwMg==", "url": "https://github.com/microsoft/mssql-jdbc/pull/1488#discussion_r552158502", "bodyText": "SQLServerException.USER_ACCOUNT_LOCKED == sqlex.getErrorCode() was removed, is this intentional?", "author": "rene-ye", "createdAt": "2021-01-05T19:52:55Z", "path": "src/main/java/com/microsoft/sqlserver/jdbc/SQLServerConnection.java", "diffHunk": "@@ -2477,33 +2480,20 @@ private void login(String primary, String primaryInstanceName, int primaryPortNu\n                 } else\n                     break; // leave the while loop -- we've successfully connected\n             } catch (SQLServerException sqlex) {\n-                if ((SQLServerException.LOGON_FAILED == sqlex.getErrorCode()) // actual logon failed, i.e. bad password\n-                        || (SQLServerException.PASSWORD_EXPIRED == sqlex.getErrorCode()) // actual logon failed, i.e.\n-                                                                                         // password isExpired\n-                        || (SQLServerException.USER_ACCOUNT_LOCKED == sqlex.getErrorCode()) // actual logon failed, i.e.\n-                                                                                            // user account locked\n-                        || (SQLServerException.DRIVER_ERROR_INVALID_TDS == sqlex.getDriverErrorCode()) // invalid TDS\n-                                                                                                       // received from\n-                                                                                                       // server\n-                        || (SQLServerException.DRIVER_ERROR_SSL_FAILED == sqlex.getDriverErrorCode()) // failure\n-                                                                                                      // negotiating SSL\n-                        || (SQLServerException.DRIVER_ERROR_INTERMITTENT_TLS_FAILED == sqlex.getDriverErrorCode()) // failure\n-                                                                                                                   // TLS1.2\n-                        || (SQLServerException.DRIVER_ERROR_UNSUPPORTED_CONFIG == sqlex.getDriverErrorCode()) // unsupported\n-                                                                                                              // configuration\n-                                                                                                              // (e.g.\n-                                                                                                              // Sphinx,\n-                                                                                                              // invalid\n-                                                                                                              // packet\n-                                                                                                              // size,\n-                                                                                                              // etc.)\n-                        || (SQLServerException.ERROR_SOCKET_TIMEOUT == sqlex.getDriverErrorCode()) // socket timeout\n-                                                                                                   // ocurred\n-                        || timerHasExpired(timerExpire)// no more time to try again\n-                        || (state.equals(State.Connected) && !isDBMirroring)\n-                // for non-dbmirroring cases, do not retry after tcp socket connection succeeds\n-                ) {\n-\n+                int errorCode = sqlex.getErrorCode();\n+                int driverErrorCode = sqlex.getDriverErrorCode();\n+                if (SQLServerException.LOGON_FAILED == errorCode // actual logon failed, i.e. bad password\n+                        || SQLServerException.PASSWORD_EXPIRED == errorCode // user account locked\n+                        || SQLServerException.DRIVER_ERROR_INVALID_TDS == driverErrorCode // invalid TDS", "originalCommit": "3748ab2372fdfc385aa2f56dc61989ef75af59ec", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "ec9b6f61eb3c1eb14b50204f9385b2e87ba7f64d", "url": "https://github.com/microsoft/mssql-jdbc/commit/ec9b6f61eb3c1eb14b50204f9385b2e87ba7f64d", "message": "review update", "committedDate": "2021-01-05T23:39:00Z", "type": "commit"}, {"oid": "81077336431fd03f37b0fe0d9cf3c00b164adf8f", "url": "https://github.com/microsoft/mssql-jdbc/commit/81077336431fd03f37b0fe0d9cf3c00b164adf8f", "message": "update", "committedDate": "2021-01-06T05:45:29Z", "type": "commit"}]}