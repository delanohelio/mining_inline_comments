{"pr_number": 13428, "pr_title": "[WFLY-13700] Add ability to configure stale transaction timeout for l\u2026", "pr_createdAt": "2020-07-26T14:47:32Z", "pr_url": "https://github.com/wildfly/wildfly/pull/13428", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTY4MzY4Ng==", "url": "https://github.com/wildfly/wildfly/pull/13428#discussion_r461683686", "bodyText": "only for transactions which contains the remote enlistments (aka. which contains the EJB remote call). This should be emphasized in the description as for any other transaction (aka. the txn with DB) the transaction is removed imediatelly after it's committed.", "author": "ochaloup", "createdAt": "2020-07-28T15:44:37Z", "path": "transactions/src/main/resources/org/jboss/as/txn/subsystem/LocalDescriptions.properties", "diffHunk": "@@ -87,3 +87,5 @@ transactions.commit-markable-resource.jndi-name=JNDi name of this CMR resource\n transactions.commit-markable-resource.xid-location=Name of database table associated to this CMR resource\n transactions.commit-markable-resource.batch-size=Batch size for this CMR resource\n transactions.commit-markable-resource.immediate-cleanup=Immediate cleanup associated to this CMR resource\n+\n+transactions.stale-transaction-time=The time for which transaction is held in memory after it is being completed.", "originalCommit": "32ca9bb6cc18bc3323dc2996cc28bd1772d1d2e7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDM4NzkxNw==", "url": "https://github.com/wildfly/wildfly/pull/13428#discussion_r464387917", "bodyText": "fixed", "author": "tadamski", "createdAt": "2020-08-03T12:42:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTY4MzY4Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTY5MTM0NQ==", "url": "https://github.com/wildfly/wildfly/pull/13428#discussion_r461691345", "bodyText": "have you been considering to create rather some \"WFTC element\" which could gathering all the WFTC setup?\nJust thinking - until now the setup here was mostly about Narayana. This one is specific for WFTC - so just thinking.", "author": "ochaloup", "createdAt": "2020-07-28T15:55:02Z", "path": "transactions/src/main/resources/schema/wildfly-txn_6_0.xsd", "diffHunk": "@@ -0,0 +1,352 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+\n+<!--\n+  ~ JBoss, Home of Professional Open Source.\n+  ~ Copyright 2020, Red Hat Middleware LLC, and individual contributors\n+  ~ as indicated by the @author tags. See the copyright.txt file in the\n+  ~ distribution for a full listing of individual contributors.\n+  ~\n+  ~ This is free software; you can redistribute it and/or modify it\n+  ~ under the terms of the GNU Lesser General Public License as\n+  ~ published by the Free Software Foundation; either version 2.1 of\n+  ~ the License, or (at your option) any later version.\n+  ~\n+  ~ This software is distributed in the hope that it will be useful,\n+  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of\n+  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n+  ~ Lesser General Public License for more details.\n+  ~\n+  ~ You should have received a copy of the GNU Lesser General Public\n+  ~ License along with this software; if not, write to the Free\n+  ~ Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n+  ~ 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n+  ~\n+  -->\n+\n+<xs:schema xmlns:xs=\"http://www.w3.org/2001/XMLSchema\"\n+           targetNamespace=\"urn:jboss:domain:transactions:6.0\"\n+           xmlns=\"urn:jboss:domain:transactions:6.0\"\n+           elementFormDefault=\"qualified\"\n+           attributeFormDefault=\"unqualified\"\n+           version=\"6.0\">\n+\n+    <!-- The transaction subsystem root element -->\n+    <xs:element name=\"subsystem\" type=\"subsystem\"/>\n+\n+    <xs:complexType name=\"subsystem\">\n+        <xs:annotation>\n+            <xs:documentation>\n+                <![CDATA[\n+                The configuration of the transactions subsystem.\n+            ]]>\n+            </xs:documentation>\n+        </xs:annotation>\n+        <xs:sequence>\n+            <xs:element name=\"core-environment\" type=\"core-environment\" maxOccurs=\"1\"/>\n+            <xs:element name=\"recovery-environment\" type=\"recovery-environment\" maxOccurs=\"1\"/>\n+            <xs:element name=\"coordinator-environment\" type=\"coordinator-environment\" minOccurs=\"0\" maxOccurs=\"1\"/>\n+            <xs:element name=\"object-store\" type=\"object-store\" minOccurs=\"0\" maxOccurs=\"1\"/>\n+            <xs:element name=\"jts\" type=\"jts-Type\" minOccurs=\"0\" maxOccurs=\"1\"/>\n+            <xs:choice minOccurs=\"0\" maxOccurs=\"1\">\n+                <xs:element name=\"use-journal-store\" type=\"use-journal-store-Type\" minOccurs=\"0\" maxOccurs=\"1\"/>\n+                <xs:element name=\"jdbc-store\" type=\"jdbc-store-Type\" minOccurs=\"0\" maxOccurs=\"1\"/>\n+            </xs:choice>\n+            <xs:element name=\"commit-markable-resources\" type=\"cmr-resources-Type\" minOccurs=\"0\" maxOccurs=\"1\"></xs:element>\n+            <xs:element name=\"stale-transaction-time\" type=\"stale-transaction-time\" minOccurs=\"0\" maxOccurs=\"1\"/>", "originalCommit": "32ca9bb6cc18bc3323dc2996cc28bd1772d1d2e7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDM4Nzk3NA==", "url": "https://github.com/wildfly/wildfly/pull/13428#discussion_r464387974", "bodyText": "fixed", "author": "tadamski", "createdAt": "2020-08-03T12:42:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTY5MTM0NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTY5MjA1Ng==", "url": "https://github.com/wildfly/wildfly/pull/13428#discussion_r461692056", "bodyText": "the  same comment as for description in cli - this is only for transactions with remote enlistments (remote EJB XAResource enlisted)", "author": "ochaloup", "createdAt": "2020-07-28T15:56:05Z", "path": "transactions/src/main/resources/schema/wildfly-txn_6_0.xsd", "diffHunk": "@@ -0,0 +1,352 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+\n+<!--\n+  ~ JBoss, Home of Professional Open Source.\n+  ~ Copyright 2020, Red Hat Middleware LLC, and individual contributors\n+  ~ as indicated by the @author tags. See the copyright.txt file in the\n+  ~ distribution for a full listing of individual contributors.\n+  ~\n+  ~ This is free software; you can redistribute it and/or modify it\n+  ~ under the terms of the GNU Lesser General Public License as\n+  ~ published by the Free Software Foundation; either version 2.1 of\n+  ~ the License, or (at your option) any later version.\n+  ~\n+  ~ This software is distributed in the hope that it will be useful,\n+  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of\n+  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n+  ~ Lesser General Public License for more details.\n+  ~\n+  ~ You should have received a copy of the GNU Lesser General Public\n+  ~ License along with this software; if not, write to the Free\n+  ~ Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n+  ~ 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n+  ~\n+  -->\n+\n+<xs:schema xmlns:xs=\"http://www.w3.org/2001/XMLSchema\"\n+           targetNamespace=\"urn:jboss:domain:transactions:6.0\"\n+           xmlns=\"urn:jboss:domain:transactions:6.0\"\n+           elementFormDefault=\"qualified\"\n+           attributeFormDefault=\"unqualified\"\n+           version=\"6.0\">\n+\n+    <!-- The transaction subsystem root element -->\n+    <xs:element name=\"subsystem\" type=\"subsystem\"/>\n+\n+    <xs:complexType name=\"subsystem\">\n+        <xs:annotation>\n+            <xs:documentation>\n+                <![CDATA[\n+                The configuration of the transactions subsystem.\n+            ]]>\n+            </xs:documentation>\n+        </xs:annotation>\n+        <xs:sequence>\n+            <xs:element name=\"core-environment\" type=\"core-environment\" maxOccurs=\"1\"/>\n+            <xs:element name=\"recovery-environment\" type=\"recovery-environment\" maxOccurs=\"1\"/>\n+            <xs:element name=\"coordinator-environment\" type=\"coordinator-environment\" minOccurs=\"0\" maxOccurs=\"1\"/>\n+            <xs:element name=\"object-store\" type=\"object-store\" minOccurs=\"0\" maxOccurs=\"1\"/>\n+            <xs:element name=\"jts\" type=\"jts-Type\" minOccurs=\"0\" maxOccurs=\"1\"/>\n+            <xs:choice minOccurs=\"0\" maxOccurs=\"1\">\n+                <xs:element name=\"use-journal-store\" type=\"use-journal-store-Type\" minOccurs=\"0\" maxOccurs=\"1\"/>\n+                <xs:element name=\"jdbc-store\" type=\"jdbc-store-Type\" minOccurs=\"0\" maxOccurs=\"1\"/>\n+            </xs:choice>\n+            <xs:element name=\"commit-markable-resources\" type=\"cmr-resources-Type\" minOccurs=\"0\" maxOccurs=\"1\"></xs:element>\n+            <xs:element name=\"stale-transaction-time\" type=\"stale-transaction-time\" minOccurs=\"0\" maxOccurs=\"1\"/>\n+\n+        </xs:sequence>\n+\n+\n+    </xs:complexType>\n+\n+    <xs:complexType name=\"recovery-environment\">\n+        <xs:annotation>\n+            <xs:documentation>\n+                <![CDATA[\n+                The recovery environment configuration.\n+\n+                The \"socket-binding\" attribute is used to reference the correct socket binding to use for the\n+                recovery environment.\n+                The \"status-socket-binding\" attribute is used to reference the correct socket binding to use for the\n+                transaction status manager.\n+                The \"recovery-listener\" attribute sets if recovery system should listen on a network socket or not.\n+            ]]>\n+            </xs:documentation>\n+        </xs:annotation>\n+        <xs:attribute name=\"socket-binding\" type=\"xs:string\" />\n+        <xs:attribute name=\"status-socket-binding\" type=\"xs:string\" />\n+        <xs:attribute name=\"recovery-listener\" type=\"xs:boolean\" default=\"false\"/>\n+    </xs:complexType>\n+\n+    <xs:complexType name=\"core-environment\">\n+        <xs:annotation>\n+            <xs:documentation>\n+                <![CDATA[\n+                The core environment configuration.\n+\n+                The process-id element specifies the process id implemention.\n+                The \"node-identifier\" attribute is used to set the node identifier on the core environment.\n+            ]]>\n+            </xs:documentation>\n+        </xs:annotation>\n+        <xs:all>\n+            <xs:element name=\"process-id\" type=\"process-id\" />\n+        </xs:all>\n+        <xs:attribute name=\"node-identifier\" type=\"xs:string\" default=\"1\"/>\n+    </xs:complexType>\n+    <xs:complexType name=\"process-id\">\n+        <xs:annotation>\n+            <xs:documentation>\n+                <![CDATA[\n+                The process identifer implementation\n+                The \"node-identifier\" attribute is used to set the node identifier on the core environment.\n+                The \"socket-process-id-max-ports\" attribute is used to set the max ports on the core environment.\n+            ]]>\n+            </xs:documentation>\n+        </xs:annotation>\n+        <xs:choice>\n+            <xs:element name=\"uuid\" type=\"uuid\" />\n+            <xs:element name=\"socket\" type=\"socket-id\" />\n+        </xs:choice>\n+    </xs:complexType>\n+    <xs:complexType name=\"uuid\">\n+        <xs:annotation>\n+            <xs:documentation>\n+                <![CDATA[\n+                The UUID based process identifer implementation\n+            ]]>\n+            </xs:documentation>\n+        </xs:annotation>\n+    </xs:complexType>\n+    <xs:complexType name=\"socket-id\">\n+        <xs:annotation>\n+            <xs:documentation>\n+                <![CDATA[\n+                The socket based process identifer implementation\n+                The \"socket-binding\" attribute is used to specify the port to bind to.\n+                The \"socket-process-id-max-ports\" attribute is used to set the max ports on the core environment.\n+            ]]>\n+            </xs:documentation>\n+        </xs:annotation>\n+        <xs:attribute name=\"socket-binding\" type=\"xs:string\" use=\"required\"/>\n+        <xs:attribute name=\"socket-process-id-max-ports\" type=\"xs:int\" default=\"10\" />\n+    </xs:complexType>\n+\n+    <xs:attribute name=\"socket-process-id-max-ports\" type=\"xs:int\" default=\"10\" />\n+\n+    <xs:complexType name=\"coordinator-environment\">\n+        <xs:annotation>\n+            <xs:documentation>\n+                <![CDATA[\n+                The coordinator environment configuration.\n+                statistics-enabled - if recording of transaction statistics is enabled, false otherwise.\n+                enable-tsm-status - if the transaction status manager (TSM) service, needed for out of process recovery, should be provided or not.\n+                default-timeout - the default transaction lifetime, in seconds.\n+                maximum-timeout - the maximum transaction lifetime, in seconds.\n+            ]]>\n+            </xs:documentation>\n+        </xs:annotation>\n+        <xs:attribute name=\"statistics-enabled\" type=\"xs:boolean\" default=\"false\"/>\n+        <xs:attribute name=\"enable-statistics\" type=\"xs:boolean\" default=\"false\">\n+            <xs:annotation>\n+                <xs:documentation>\n+                    <![CDATA[ Deprecated. Use statistics-enabled. ]]>\n+                </xs:documentation>\n+            </xs:annotation>\n+        </xs:attribute>\n+        <xs:attribute name=\"enable-tsm-status\" type=\"xs:boolean\" default=\"false\"/>\n+        <xs:attribute name=\"default-timeout\" type=\"xs:int\" default=\"300\" />\n+        <xs:attribute name=\"maximum-timeout\" type=\"xs:int\" default=\"31536000\" />\n+    </xs:complexType>\n+\n+    <xs:complexType name=\"object-store\">\n+        <xs:annotation>\n+            <xs:documentation>\n+                <![CDATA[\n+                The object store configuration.\n+\n+                The \"path\" attribute denotes a relative or absolute filesystem path denoting where the transaction\n+                manager object store should store data.\n+\n+                The \"relative-to\" attribute references a global path configuration in the domain model, defaulting\n+                to the JBoss Application Server data directory (jboss.server.data.dir). If the value of the \"path\" attribute\n+                does not specify an absolute pathname, it will treated as relative to this path.\n+            ]]>\n+            </xs:documentation>\n+        </xs:annotation>\n+        <xs:attribute name=\"path\" type=\"xs:string\" default=\"tx-object-store\"/>\n+        <xs:attribute name=\"relative-to\" type=\"xs:string\"/>\n+    </xs:complexType>\n+\n+    <xs:complexType name=\"jts-Type\">\n+        <xs:annotation>\n+            <xs:documentation>\n+                <![CDATA[\n+                The flag to enable JTS.\n+            ]]>\n+            </xs:documentation>\n+        </xs:annotation>\n+    </xs:complexType>\n+\n+    <xs:complexType name=\"use-journal-store-Type\">\n+        <xs:annotation>\n+            <xs:documentation>\n+                <![CDATA[\n+                The flag to enable the journal transaction log store.\n+            ]]>\n+            </xs:documentation>\n+        </xs:annotation>\n+        <xs:attribute name=\"enable-async-io\" type=\"xs:boolean\" use=\"optional\" default=\"false\">\n+            <xs:annotation>\n+                <xs:documentation>\n+                    <![CDATA[\n+                        Enable AsyncIO for the journal transaction log store.\n+                        ]]>\n+                </xs:documentation>\n+            </xs:annotation>\n+        </xs:attribute>\n+    </xs:complexType>\n+\n+    <xs:complexType name=\"jdbc-store-Type\">\n+        <xs:annotation>\n+            <xs:documentation>\n+                <![CDATA[\n+                        The presence of this tag enable the jdbc transaction log store.\n+                    ]]>\n+            </xs:documentation>\n+        </xs:annotation>\n+        <xs:all>\n+            <xs:element name=\"action\" type=\"jdbc-store-settings-Type\" minOccurs=\"0\" maxOccurs=\"1\">\n+                <xs:annotation>\n+                    <xs:documentation>\n+                        <![CDATA[\n+                             Configure jdbc store for default action store. If not present defaults are used.\n+                                ]]>\n+                    </xs:documentation>\n+                </xs:annotation>\n+            </xs:element>\n+            <xs:element name=\"communication\" type=\"jdbc-store-settings-Type\" minOccurs=\"0\" maxOccurs=\"1\">\n+                <xs:annotation>\n+                    <xs:documentation>\n+                        <![CDATA[\n+                            Configure jdbc store for communication store. If not present defaults are used.\n+                                ]]>\n+                    </xs:documentation>\n+                </xs:annotation>\n+            </xs:element>\n+            <xs:element name=\"state\" type=\"jdbc-store-settings-Type\" minOccurs=\"0\" maxOccurs=\"1\">\n+                <xs:annotation>\n+                    <xs:documentation>\n+                        <![CDATA[\n+                           Configure jdbc store for state store. If not present defaults are used.\n+                                ]]>\n+                    </xs:documentation>\n+                </xs:annotation>\n+            </xs:element>\n+        </xs:all>\n+        <xs:attribute name=\"datasource-jndi-name\" type=\"xs:string\" use=\"required\">\n+            <xs:annotation>\n+                <xs:documentation>\n+                    <![CDATA[\n+                        Configure datasource jndi used to connect for jdbc store\n+                        ]]>\n+                </xs:documentation>\n+            </xs:annotation>\n+        </xs:attribute>\n+    </xs:complexType>\n+\n+    <xs:complexType name=\"jdbc-store-settings-Type\">\n+        <xs:annotation>\n+            <xs:documentation>\n+                <![CDATA[\n+                    Settings for jdbc store\n+                    ]]>\n+            </xs:documentation>\n+        </xs:annotation>\n+        <xs:attribute name=\"table-prefix\" type=\"xs:string\" use=\"optional\" />\n+        <xs:attribute name=\"drop-table\" type=\"xs:boolean\" use=\"optional\" default=\"false\"/>\n+    </xs:complexType>\n+\n+    <xs:complexType name=\"cmr-resources-Type\">\n+        <xs:annotation>\n+            <xs:documentation>\n+                <![CDATA[\n+                    A list of non XA aware datasources that can reliably participate in an XA transaction.\n+                    ]]>\n+            </xs:documentation>\n+        </xs:annotation>\n+        <xs:all>\n+            <xs:element name=\"commit-markable-resource\" type=\"cmr-resource-Type\" minOccurs=\"1\"/>\n+        </xs:all>\n+    </xs:complexType>\n+\n+    <xs:complexType name=\"cmr-resource-Type\">\n+        <xs:annotation>\n+            <xs:documentation>\n+                <![CDATA[\n+                    Settings for a single commit markable resource.\n+\t\t\t\t\tEach datasource must be defined in the datasources subsystem configuration and\n+\t\t\t\t\teach one must be marked with the connectable=\"true\" attribute.\n+                    ]]>\n+            </xs:documentation>\n+        </xs:annotation>\n+        <xs:all>\n+            <xs:element name=\"xid-location\" type=\"cmr-table-Type\" minOccurs=\"0\" maxOccurs=\"1\"/>\n+        </xs:all>\n+        <xs:attribute name=\"jndi-name\" type=\"xs:token\" use=\"required\"/>\n+    </xs:complexType>\n+\n+    <xs:complexType name=\"cmr-table-Type\">\n+        <xs:annotation>\n+            <xs:documentation>\n+                <![CDATA[\n+                    Storage settings for a single commit markable resource. For datasource resources\n+\t\t\t\t\tthis will specifiy the table name where the xid of the commit-markable-resource\n+\t\t\t\t\tis stored\n+                    ]]>\n+            </xs:documentation>\n+        </xs:annotation>\n+        <xs:attribute name=\"name\" type=\"xs:token\" use=\"optional\" default=\"xids\">\n+            <xs:annotation>\n+                <xs:documentation>\n+                    <![CDATA[\n+\t\t\t\t\tA name for the storage location\n+\t\t\t\t\t]]>\n+                </xs:documentation>\n+            </xs:annotation>\n+        </xs:attribute>\n+        <xs:attribute name=\"immediate-cleanup\" type=\"xs:boolean\" use=\"optional\" default=\"true\">\n+            <xs:annotation>\n+                <xs:documentation>\n+                    <![CDATA[\n+\t\t\t\t\tIndicates whether the entry should be removed as soon as the transaction has\n+\t\t\t\t\tcompleted\n+\t\t\t\t\t]]>\n+                </xs:documentation>\n+            </xs:annotation>\n+        </xs:attribute>\n+        <xs:attribute name=\"batch-size\" type=\"xs:integer\" use=\"optional\" default=\"100\">\n+            <xs:annotation>\n+                <xs:documentation>\n+                    <![CDATA[\n+\t\t\t\t\tIf deletion of entries are deferred to the recovery module (ie immediate-cleanup\n+\t\t\t\t\tis set to false) then the batch size specifies how many xids to remove per DML\n+\t\t\t\t\tstatement. Tuning the batch size is resource manager specific.\n+\t\t\t\t\t]]>\n+                </xs:documentation>\n+            </xs:annotation>\n+        </xs:attribute>\n+    </xs:complexType>\n+\n+    <xs:complexType name=\"stale-transaction-time\">\n+        <xs:annotation>\n+            <xs:documentation>\n+                <![CDATA[\n+                The time after which completed transactions are removed from the memory.", "originalCommit": "32ca9bb6cc18bc3323dc2996cc28bd1772d1d2e7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDM4ODAyMg==", "url": "https://github.com/wildfly/wildfly/pull/13428#discussion_r464388022", "bodyText": "fixed", "author": "tadamski", "createdAt": "2020-08-03T12:42:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTY5MjA1Ng=="}], "type": "inlineReview"}, {"oid": "abd34a3a2f788c34d217cc65420b0ad86b9f574b", "url": "https://github.com/wildfly/wildfly/commit/abd34a3a2f788c34d217cc65420b0ad86b9f574b", "message": "[WFLY-13700] Add ability to configure stale transaction timeout for local transaction", "committedDate": "2020-08-03T10:28:11Z", "type": "forcePushed"}, {"oid": "5b5c520e2787252bb142ce3562156255b58afcc3", "url": "https://github.com/wildfly/wildfly/commit/5b5c520e2787252bb142ce3562156255b58afcc3", "message": "[WFLY-13700] Add ability to configure stale transaction timeout for local transaction", "committedDate": "2020-08-03T12:13:19Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDM4ODkyMA==", "url": "https://github.com/wildfly/wildfly/pull/13428#discussion_r464388920", "bodyText": "this annotation element should be part of the <xs:attribte ... element, or shouldn't?", "author": "ochaloup", "createdAt": "2020-08-03T12:44:34Z", "path": "transactions/src/main/resources/schema/wildfly-txn_6_0.xsd", "diffHunk": "@@ -0,0 +1,352 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+\n+<!--\n+  ~ JBoss, Home of Professional Open Source.\n+  ~ Copyright 2020, Red Hat Middleware LLC, and individual contributors\n+  ~ as indicated by the @author tags. See the copyright.txt file in the\n+  ~ distribution for a full listing of individual contributors.\n+  ~\n+  ~ This is free software; you can redistribute it and/or modify it\n+  ~ under the terms of the GNU Lesser General Public License as\n+  ~ published by the Free Software Foundation; either version 2.1 of\n+  ~ the License, or (at your option) any later version.\n+  ~\n+  ~ This software is distributed in the hope that it will be useful,\n+  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of\n+  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n+  ~ Lesser General Public License for more details.\n+  ~\n+  ~ You should have received a copy of the GNU Lesser General Public\n+  ~ License along with this software; if not, write to the Free\n+  ~ Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n+  ~ 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n+  ~\n+  -->\n+\n+<xs:schema xmlns:xs=\"http://www.w3.org/2001/XMLSchema\"\n+           targetNamespace=\"urn:jboss:domain:transactions:6.0\"\n+           xmlns=\"urn:jboss:domain:transactions:6.0\"\n+           elementFormDefault=\"qualified\"\n+           attributeFormDefault=\"unqualified\"\n+           version=\"6.0\">\n+\n+    <!-- The transaction subsystem root element -->\n+    <xs:element name=\"subsystem\" type=\"subsystem\"/>\n+\n+    <xs:complexType name=\"subsystem\">\n+        <xs:annotation>\n+            <xs:documentation>\n+                <![CDATA[\n+                The configuration of the transactions subsystem.\n+            ]]>\n+            </xs:documentation>\n+        </xs:annotation>\n+        <xs:sequence>\n+            <xs:element name=\"core-environment\" type=\"core-environment\" maxOccurs=\"1\"/>\n+            <xs:element name=\"recovery-environment\" type=\"recovery-environment\" maxOccurs=\"1\"/>\n+            <xs:element name=\"coordinator-environment\" type=\"coordinator-environment\" minOccurs=\"0\" maxOccurs=\"1\"/>\n+            <xs:element name=\"object-store\" type=\"object-store\" minOccurs=\"0\" maxOccurs=\"1\"/>\n+            <xs:element name=\"jts\" type=\"jts-Type\" minOccurs=\"0\" maxOccurs=\"1\"/>\n+            <xs:choice minOccurs=\"0\" maxOccurs=\"1\">\n+                <xs:element name=\"use-journal-store\" type=\"use-journal-store-Type\" minOccurs=\"0\" maxOccurs=\"1\"/>\n+                <xs:element name=\"jdbc-store\" type=\"jdbc-store-Type\" minOccurs=\"0\" maxOccurs=\"1\"/>\n+            </xs:choice>\n+            <xs:element name=\"commit-markable-resources\" type=\"cmr-resources-Type\" minOccurs=\"0\" maxOccurs=\"1\"></xs:element>\n+            <xs:element name=\"client\" type=\"client\" minOccurs=\"0\" maxOccurs=\"1\"/>\n+\n+        </xs:sequence>\n+\n+\n+    </xs:complexType>\n+\n+    <xs:complexType name=\"recovery-environment\">\n+        <xs:annotation>\n+            <xs:documentation>\n+                <![CDATA[\n+                The recovery environment configuration.\n+\n+                The \"socket-binding\" attribute is used to reference the correct socket binding to use for the\n+                recovery environment.\n+                The \"status-socket-binding\" attribute is used to reference the correct socket binding to use for the\n+                transaction status manager.\n+                The \"recovery-listener\" attribute sets if recovery system should listen on a network socket or not.\n+            ]]>\n+            </xs:documentation>\n+        </xs:annotation>\n+        <xs:attribute name=\"socket-binding\" type=\"xs:string\" />\n+        <xs:attribute name=\"status-socket-binding\" type=\"xs:string\" />\n+        <xs:attribute name=\"recovery-listener\" type=\"xs:boolean\" default=\"false\"/>\n+    </xs:complexType>\n+\n+    <xs:complexType name=\"core-environment\">\n+        <xs:annotation>\n+            <xs:documentation>\n+                <![CDATA[\n+                The core environment configuration.\n+\n+                The process-id element specifies the process id implemention.\n+                The \"node-identifier\" attribute is used to set the node identifier on the core environment.\n+            ]]>\n+            </xs:documentation>\n+        </xs:annotation>\n+        <xs:all>\n+            <xs:element name=\"process-id\" type=\"process-id\" />\n+        </xs:all>\n+        <xs:attribute name=\"node-identifier\" type=\"xs:string\" default=\"1\"/>\n+    </xs:complexType>\n+    <xs:complexType name=\"process-id\">\n+        <xs:annotation>\n+            <xs:documentation>\n+                <![CDATA[\n+                The process identifer implementation\n+                The \"node-identifier\" attribute is used to set the node identifier on the core environment.\n+                The \"socket-process-id-max-ports\" attribute is used to set the max ports on the core environment.\n+            ]]>\n+            </xs:documentation>\n+        </xs:annotation>\n+        <xs:choice>\n+            <xs:element name=\"uuid\" type=\"uuid\" />\n+            <xs:element name=\"socket\" type=\"socket-id\" />\n+        </xs:choice>\n+    </xs:complexType>\n+    <xs:complexType name=\"uuid\">\n+        <xs:annotation>\n+            <xs:documentation>\n+                <![CDATA[\n+                The UUID based process identifer implementation\n+            ]]>\n+            </xs:documentation>\n+        </xs:annotation>\n+    </xs:complexType>\n+    <xs:complexType name=\"socket-id\">\n+        <xs:annotation>\n+            <xs:documentation>\n+                <![CDATA[\n+                The socket based process identifer implementation\n+                The \"socket-binding\" attribute is used to specify the port to bind to.\n+                The \"socket-process-id-max-ports\" attribute is used to set the max ports on the core environment.\n+            ]]>\n+            </xs:documentation>\n+        </xs:annotation>\n+        <xs:attribute name=\"socket-binding\" type=\"xs:string\" use=\"required\"/>\n+        <xs:attribute name=\"socket-process-id-max-ports\" type=\"xs:int\" default=\"10\" />\n+    </xs:complexType>\n+\n+    <xs:attribute name=\"socket-process-id-max-ports\" type=\"xs:int\" default=\"10\" />\n+\n+    <xs:complexType name=\"coordinator-environment\">\n+        <xs:annotation>\n+            <xs:documentation>\n+                <![CDATA[\n+                The coordinator environment configuration.\n+                statistics-enabled - if recording of transaction statistics is enabled, false otherwise.\n+                enable-tsm-status - if the transaction status manager (TSM) service, needed for out of process recovery, should be provided or not.\n+                default-timeout - the default transaction lifetime, in seconds.\n+                maximum-timeout - the maximum transaction lifetime, in seconds.\n+            ]]>\n+            </xs:documentation>\n+        </xs:annotation>\n+        <xs:attribute name=\"statistics-enabled\" type=\"xs:boolean\" default=\"false\"/>\n+        <xs:attribute name=\"enable-statistics\" type=\"xs:boolean\" default=\"false\">\n+            <xs:annotation>\n+                <xs:documentation>\n+                    <![CDATA[ Deprecated. Use statistics-enabled. ]]>\n+                </xs:documentation>\n+            </xs:annotation>\n+        </xs:attribute>\n+        <xs:attribute name=\"enable-tsm-status\" type=\"xs:boolean\" default=\"false\"/>\n+        <xs:attribute name=\"default-timeout\" type=\"xs:int\" default=\"300\" />\n+        <xs:attribute name=\"maximum-timeout\" type=\"xs:int\" default=\"31536000\" />\n+    </xs:complexType>\n+\n+    <xs:complexType name=\"object-store\">\n+        <xs:annotation>\n+            <xs:documentation>\n+                <![CDATA[\n+                The object store configuration.\n+\n+                The \"path\" attribute denotes a relative or absolute filesystem path denoting where the transaction\n+                manager object store should store data.\n+\n+                The \"relative-to\" attribute references a global path configuration in the domain model, defaulting\n+                to the JBoss Application Server data directory (jboss.server.data.dir). If the value of the \"path\" attribute\n+                does not specify an absolute pathname, it will treated as relative to this path.\n+            ]]>\n+            </xs:documentation>\n+        </xs:annotation>\n+        <xs:attribute name=\"path\" type=\"xs:string\" default=\"tx-object-store\"/>\n+        <xs:attribute name=\"relative-to\" type=\"xs:string\"/>\n+    </xs:complexType>\n+\n+    <xs:complexType name=\"jts-Type\">\n+        <xs:annotation>\n+            <xs:documentation>\n+                <![CDATA[\n+                The flag to enable JTS.\n+            ]]>\n+            </xs:documentation>\n+        </xs:annotation>\n+    </xs:complexType>\n+\n+    <xs:complexType name=\"use-journal-store-Type\">\n+        <xs:annotation>\n+            <xs:documentation>\n+                <![CDATA[\n+                The flag to enable the journal transaction log store.\n+            ]]>\n+            </xs:documentation>\n+        </xs:annotation>\n+        <xs:attribute name=\"enable-async-io\" type=\"xs:boolean\" use=\"optional\" default=\"false\">\n+            <xs:annotation>\n+                <xs:documentation>\n+                    <![CDATA[\n+                        Enable AsyncIO for the journal transaction log store.\n+                        ]]>\n+                </xs:documentation>\n+            </xs:annotation>\n+        </xs:attribute>\n+    </xs:complexType>\n+\n+    <xs:complexType name=\"jdbc-store-Type\">\n+        <xs:annotation>\n+            <xs:documentation>\n+                <![CDATA[\n+                        The presence of this tag enable the jdbc transaction log store.\n+                    ]]>\n+            </xs:documentation>\n+        </xs:annotation>\n+        <xs:all>\n+            <xs:element name=\"action\" type=\"jdbc-store-settings-Type\" minOccurs=\"0\" maxOccurs=\"1\">\n+                <xs:annotation>\n+                    <xs:documentation>\n+                        <![CDATA[\n+                             Configure jdbc store for default action store. If not present defaults are used.\n+                                ]]>\n+                    </xs:documentation>\n+                </xs:annotation>\n+            </xs:element>\n+            <xs:element name=\"communication\" type=\"jdbc-store-settings-Type\" minOccurs=\"0\" maxOccurs=\"1\">\n+                <xs:annotation>\n+                    <xs:documentation>\n+                        <![CDATA[\n+                            Configure jdbc store for communication store. If not present defaults are used.\n+                                ]]>\n+                    </xs:documentation>\n+                </xs:annotation>\n+            </xs:element>\n+            <xs:element name=\"state\" type=\"jdbc-store-settings-Type\" minOccurs=\"0\" maxOccurs=\"1\">\n+                <xs:annotation>\n+                    <xs:documentation>\n+                        <![CDATA[\n+                           Configure jdbc store for state store. If not present defaults are used.\n+                                ]]>\n+                    </xs:documentation>\n+                </xs:annotation>\n+            </xs:element>\n+        </xs:all>\n+        <xs:attribute name=\"datasource-jndi-name\" type=\"xs:string\" use=\"required\">\n+            <xs:annotation>\n+                <xs:documentation>\n+                    <![CDATA[\n+                        Configure datasource jndi used to connect for jdbc store\n+                        ]]>\n+                </xs:documentation>\n+            </xs:annotation>\n+        </xs:attribute>\n+    </xs:complexType>\n+\n+    <xs:complexType name=\"jdbc-store-settings-Type\">\n+        <xs:annotation>\n+            <xs:documentation>\n+                <![CDATA[\n+                    Settings for jdbc store\n+                    ]]>\n+            </xs:documentation>\n+        </xs:annotation>\n+        <xs:attribute name=\"table-prefix\" type=\"xs:string\" use=\"optional\" />\n+        <xs:attribute name=\"drop-table\" type=\"xs:boolean\" use=\"optional\" default=\"false\"/>\n+    </xs:complexType>\n+\n+    <xs:complexType name=\"cmr-resources-Type\">\n+        <xs:annotation>\n+            <xs:documentation>\n+                <![CDATA[\n+                    A list of non XA aware datasources that can reliably participate in an XA transaction.\n+                    ]]>\n+            </xs:documentation>\n+        </xs:annotation>\n+        <xs:all>\n+            <xs:element name=\"commit-markable-resource\" type=\"cmr-resource-Type\" minOccurs=\"1\"/>\n+        </xs:all>\n+    </xs:complexType>\n+\n+    <xs:complexType name=\"cmr-resource-Type\">\n+        <xs:annotation>\n+            <xs:documentation>\n+                <![CDATA[\n+                    Settings for a single commit markable resource.\n+\t\t\t\t\tEach datasource must be defined in the datasources subsystem configuration and\n+\t\t\t\t\teach one must be marked with the connectable=\"true\" attribute.\n+                    ]]>\n+            </xs:documentation>\n+        </xs:annotation>\n+        <xs:all>\n+            <xs:element name=\"xid-location\" type=\"cmr-table-Type\" minOccurs=\"0\" maxOccurs=\"1\"/>\n+        </xs:all>\n+        <xs:attribute name=\"jndi-name\" type=\"xs:token\" use=\"required\"/>\n+    </xs:complexType>\n+\n+    <xs:complexType name=\"cmr-table-Type\">\n+        <xs:annotation>\n+            <xs:documentation>\n+                <![CDATA[\n+                    Storage settings for a single commit markable resource. For datasource resources\n+\t\t\t\t\tthis will specifiy the table name where the xid of the commit-markable-resource\n+\t\t\t\t\tis stored\n+                    ]]>\n+            </xs:documentation>\n+        </xs:annotation>\n+        <xs:attribute name=\"name\" type=\"xs:token\" use=\"optional\" default=\"xids\">\n+            <xs:annotation>\n+                <xs:documentation>\n+                    <![CDATA[\n+\t\t\t\t\tA name for the storage location\n+\t\t\t\t\t]]>\n+                </xs:documentation>\n+            </xs:annotation>\n+        </xs:attribute>\n+        <xs:attribute name=\"immediate-cleanup\" type=\"xs:boolean\" use=\"optional\" default=\"true\">\n+            <xs:annotation>\n+                <xs:documentation>\n+                    <![CDATA[\n+\t\t\t\t\tIndicates whether the entry should be removed as soon as the transaction has\n+\t\t\t\t\tcompleted\n+\t\t\t\t\t]]>\n+                </xs:documentation>\n+            </xs:annotation>\n+        </xs:attribute>\n+        <xs:attribute name=\"batch-size\" type=\"xs:integer\" use=\"optional\" default=\"100\">\n+            <xs:annotation>\n+                <xs:documentation>\n+                    <![CDATA[\n+\t\t\t\t\tIf deletion of entries are deferred to the recovery module (ie immediate-cleanup\n+\t\t\t\t\tis set to false) then the batch size specifies how many xids to remove per DML\n+\t\t\t\t\tstatement. Tuning the batch size is resource manager specific.\n+\t\t\t\t\t]]>\n+                </xs:documentation>\n+            </xs:annotation>\n+        </xs:attribute>\n+    </xs:complexType>\n+\n+    <xs:complexType name=\"client\">\n+        <xs:annotation>\n+            <xs:documentation>\n+                <![CDATA[\n+                The time after which completed transactions that contain remote enlistments are removed from the memory.", "originalCommit": "5b5c520e2787252bb142ce3562156255b58afcc3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDU5MDA2Mw==", "url": "https://github.com/wildfly/wildfly/pull/13428#discussion_r464590063", "bodyText": "fixed", "author": "tadamski", "createdAt": "2020-08-03T18:30:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDM4ODkyMA=="}], "type": "inlineReview"}, {"oid": "ce6fa0593d9c7d701e2d776472677c81611aa1bf", "url": "https://github.com/wildfly/wildfly/commit/ce6fa0593d9c7d701e2d776472677c81611aa1bf", "message": "[WFLY-13700] Add ability to configure stale transaction timeout for local transaction", "committedDate": "2020-08-03T18:03:28Z", "type": "forcePushed"}, {"oid": "49ad982990e9ed7254157ed18c3be8a89b68b011", "url": "https://github.com/wildfly/wildfly/commit/49ad982990e9ed7254157ed18c3be8a89b68b011", "message": "[WFLY-13700] Add ability to configure stale transaction timeout for local transaction", "committedDate": "2020-08-13T11:38:48Z", "type": "forcePushed"}, {"oid": "fb6debe466c03dd0333ebcc202a99eca6735952c", "url": "https://github.com/wildfly/wildfly/commit/fb6debe466c03dd0333ebcc202a99eca6735952c", "message": "[WFLY-13700] Add ability to configure stale transaction timeout for local transaction", "committedDate": "2020-09-01T08:15:10Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4MjI1MTgyOQ==", "url": "https://github.com/wildfly/wildfly/pull/13428#discussion_r582251829", "bodyText": "This should be RESTART_ALL_SERVICES -- ReloadRequiredWriteAttributeHandler handles the writes.", "author": "bstansberry", "createdAt": "2021-02-24T19:45:12Z", "path": "transactions/src/main/java/org/jboss/as/txn/subsystem/TransactionSubsystemRootResourceDefinition.java", "diffHunk": "@@ -281,6 +281,13 @@\n             .setAllowExpression(true)\n             .setRequires(CommonAttributes.USE_JDBC_STORE).build();\n \n+    public static final SimpleAttributeDefinition STALE_TRANSACTION_TIME = new SimpleAttributeDefinitionBuilder(CommonAttributes.STALE_TRANSACTION_TIME, ModelType.INT, true)\n+            .setValidator(new IntRangeValidator(0))\n+            .setMeasurementUnit(MeasurementUnit.SECONDS)\n+            .setDefaultValue(new ModelNode().set(600))\n+            .setFlags(AttributeAccess.Flag.RESTART_NONE)", "originalCommit": "fb6debe466c03dd0333ebcc202a99eca6735952c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NDc2NjA3NA==", "url": "https://github.com/wildfly/wildfly/pull/13428#discussion_r584766074", "bodyText": "fixed", "author": "tadamski", "createdAt": "2021-03-01T14:43:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4MjI1MTgyOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4MjI1MzY1Ng==", "url": "https://github.com/wildfly/wildfly/pull/13428#discussion_r582253656", "bodyText": "This would be MODEL_VERSION_EAP74", "author": "bstansberry", "createdAt": "2021-02-24T19:47:49Z", "path": "transactions/src/main/java/org/jboss/as/txn/subsystem/TransactionTransformers.java", "diffHunk": "@@ -39,6 +40,8 @@\n     static final ModelVersion MODEL_VERSION_EAP70 = ModelVersion.create(3, 0);\n     static final ModelVersion MODEL_VERSION_EAP71 = ModelVersion.create(4, 0);\n     static final ModelVersion MODEL_VERSION_EAP72 = ModelVersion.create(5, 0);\n+    static final ModelVersion MODEL_VERSION_5_1_0 = ModelVersion.create(5, 1);\n+    static final ModelVersion MODEL_VERSION_EAP73 = ModelVersion.create(6, 0);", "originalCommit": "fb6debe466c03dd0333ebcc202a99eca6735952c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NDc2NjE0MA==", "url": "https://github.com/wildfly/wildfly/pull/13428#discussion_r584766140", "bodyText": "fixed", "author": "tadamski", "createdAt": "2021-03-01T14:43:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4MjI1MzY1Ng=="}], "type": "inlineReview"}, {"oid": "7b065cbdb080b78e215aad6709cf745329638d63", "url": "https://github.com/wildfly/wildfly/commit/7b065cbdb080b78e215aad6709cf745329638d63", "message": "[WFLY-13700] Add ability to configure stale transaction timeout for local transaction", "committedDate": "2021-03-01T13:31:51Z", "type": "forcePushed"}, {"oid": "2df61a38f526a39429ec98251d093a937c86e61c", "url": "https://github.com/wildfly/wildfly/commit/2df61a38f526a39429ec98251d093a937c86e61c", "message": "[WFLY-13700] Add ability to configure stale transaction timeout for local transaction", "committedDate": "2021-03-01T14:42:26Z", "type": "commit"}, {"oid": "2df61a38f526a39429ec98251d093a937c86e61c", "url": "https://github.com/wildfly/wildfly/commit/2df61a38f526a39429ec98251d093a937c86e61c", "message": "[WFLY-13700] Add ability to configure stale transaction timeout for local transaction", "committedDate": "2021-03-01T14:42:26Z", "type": "forcePushed"}]}