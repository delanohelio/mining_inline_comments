{"pr_number": 12948, "pr_title": "WFLY-12681 Provide a 'microprofile-platform' Galleon layer", "pr_createdAt": "2020-01-29T23:35:22Z", "pr_url": "https://github.com/wildfly/wildfly/pull/12948", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjkyMTUyNA==", "url": "https://github.com/wildfly/wildfly/pull/12948#discussion_r372921524", "bodyText": "I'm not sure I would bother enumerating the individual specs, unless we want to keep this list updated (e.g. health) with every new release.", "author": "pferraro", "createdAt": "2020-01-30T12:31:16Z", "path": "docs/src/main/asciidoc/_admin-guide/Galleon_provisioning.adoc", "diffHunk": "@@ -122,6 +122,7 @@ Basic layers:\n * _jaxrs_: Support for JAXRS. Depends on _web-server_ (defined in the WildFly servlet feature-pack).\n * _jms-activemq_: Support for connections to a remote JMS broker.\n * _jpa_: Support for JPA (using the latest WildFly supported Hibernate release).\n+* _microprofile_: Support for MicroProfile specification including Config, Fault Tolerance, JWT, Metrics, OpenAPI, OpenTracing.", "originalCommit": "1c9309d6cdf21dda9d7b7ee84e59a0b9421fad2d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzIxMzYzOQ==", "url": "https://github.com/wildfly/wildfly/pull/12948#discussion_r373213639", "bodyText": "My thinking was to keep the list updated so people dont assume this includes some specs we dont yet support or ones that might be only incubating. What better wording do you suggest?", "author": "rhusar", "createdAt": "2020-01-30T21:53:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjkyMTUyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzM2MTU1NA==", "url": "https://github.com/wildfly/wildfly/pull/12948#discussion_r373361554", "bodyText": "Would including an additional qualifier in the name make sense?  Either platform version  or allow for a second one microprofile_experimental", "author": "darranl", "createdAt": "2020-01-31T08:24:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjkyMTUyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDc1Mjk2NQ==", "url": "https://github.com/wildfly/wildfly/pull/12948#discussion_r380752965", "bodyText": "Reworded to be more general.", "author": "rhusar", "createdAt": "2020-02-18T15:39:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjkyMTUyNA=="}], "type": "inlineReview"}, {"oid": "17f4066d849745ca3d761eb82c13beffb9980e9c", "url": "https://github.com/wildfly/wildfly/commit/17f4066d849745ca3d761eb82c13beffb9980e9c", "message": "WFLY-12681 Provide a 'microprofile' Galleon layer", "committedDate": "2020-02-18T15:38:57Z", "type": "forcePushed"}, {"oid": "1db928db9fc069c995fdbb69d3ec88241c5757e4", "url": "https://github.com/wildfly/wildfly/commit/1db928db9fc069c995fdbb69d3ec88241c5757e4", "message": "WFLY-12681 Provide a 'microprofile' Galleon layer", "committedDate": "2020-02-25T10:58:05Z", "type": "forcePushed"}, {"oid": "ec96de254ca7a31cf86b01ef7e1f330e967475fe", "url": "https://github.com/wildfly/wildfly/commit/ec96de254ca7a31cf86b01ef7e1f330e967475fe", "message": "WFLY-12681 Provide a 'microprofile' Galleon layer", "committedDate": "2020-03-10T14:09:25Z", "type": "forcePushed"}, {"oid": "69f950f2e0eeae2f5cd27e9b72ebc0461b497fb3", "url": "https://github.com/wildfly/wildfly/commit/69f950f2e0eeae2f5cd27e9b72ebc0461b497fb3", "message": "WFLY-12681 Provide a 'microprofile' Galleon layer", "committedDate": "2020-05-04T14:26:50Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzUxNTk3NQ==", "url": "https://github.com/wildfly/wildfly/pull/12948#discussion_r453515975", "bodyText": "@rhusar Just out of curiosity, why we don't include microprofile-health?", "author": "yersan", "createdAt": "2020-07-13T09:26:04Z", "path": "galleon-pack/src/main/resources/layers/standalone/microprofile/layer-spec.xml", "diffHunk": "@@ -0,0 +1,32 @@\n+<?xml version=\"1.0\" ?>\n+<!--\n+  ~ JBoss, Home of Professional Open Source.\n+  ~ Copyright 2020, Red Hat, Inc., and individual contributors\n+  ~ as indicated by the @author tags. See the copyright.txt file in the\n+  ~ distribution for a full listing of individual contributors.\n+  ~\n+  ~ This is free software; you can redistribute it and/or modify it\n+  ~ under the terms of the GNU Lesser General Public License as\n+  ~ published by the Free Software Foundation; either version 2.1 of\n+  ~ the License, or (at your option) any later version.\n+  ~\n+  ~ This software is distributed in the hope that it will be useful,\n+  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of\n+  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n+  ~ Lesser General Public License for more details.\n+  ~\n+  ~ You should have received a copy of the GNU Lesser General Public\n+  ~ License along with this software; if not, write to the Free\n+  ~ Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n+  ~ 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n+  -->\n+<layer-spec xmlns=\"urn:jboss:galleon:layer-spec:1.0\" name=\"microprofile\">\n+    <dependencies>\n+        <layer name=\"microprofile-config\" optional=\"true\"/>\n+        <layer name=\"microprofile-fault-tolerance\" optional=\"true\"/>\n+        <layer name=\"microprofile-jwt\" optional=\"true\"/>\n+        <layer name=\"microprofile-metrics\" optional=\"true\"/>\n+        <layer name=\"microprofile-openapi\" optional=\"true\"/>\n+        <layer name=\"open-tracing\" optional=\"true\"/>", "originalCommit": "69f950f2e0eeae2f5cd27e9b72ebc0461b497fb3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTc4NTM4MQ==", "url": "https://github.com/wildfly/wildfly/pull/12948#discussion_r455785381", "bodyText": "@yersan Fixed, thanks. The reason being that 'microprofile-health' layer did not exist in January.", "author": "rhusar", "createdAt": "2020-07-16T13:28:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzUxNTk3NQ=="}], "type": "inlineReview"}, {"oid": "ab150c4a2c0af34651443363436a26fdafbdbc74", "url": "https://github.com/wildfly/wildfly/commit/ab150c4a2c0af34651443363436a26fdafbdbc74", "message": "WFLY-12681 Provide a 'microprofile' Galleon layer", "committedDate": "2020-07-16T12:11:33Z", "type": "forcePushed"}, {"oid": "edd853e7b0f1a52ad4f13df2f8b69b97aeeb8fca", "url": "https://github.com/wildfly/wildfly/commit/edd853e7b0f1a52ad4f13df2f8b69b97aeeb8fca", "message": "WFLY-12681 Provide a 'microprofile' Galleon layer", "committedDate": "2020-07-16T13:27:08Z", "type": "forcePushed"}, {"oid": "c8ec8536fe8e0644eccf57349823b56bcddc3b0a", "url": "https://github.com/wildfly/wildfly/commit/c8ec8536fe8e0644eccf57349823b56bcddc3b0a", "message": "WFLY-12681 Provide a 'microprofile-platform' Galleon layer", "committedDate": "2020-07-20T16:18:24Z", "type": "forcePushed"}, {"oid": "d254cdf474fde55289067733e45a7fc06615c9f0", "url": "https://github.com/wildfly/wildfly/commit/d254cdf474fde55289067733e45a7fc06615c9f0", "message": "WFLY-12681 Provide a 'microprofile-platform' Galleon layer", "committedDate": "2020-07-21T17:17:31Z", "type": "forcePushed"}, {"oid": "090b28b8985d89a9defc8384379d8b8f0f2e239c", "url": "https://github.com/wildfly/wildfly/commit/090b28b8985d89a9defc8384379d8b8f0f2e239c", "message": "WFLY-12681 Provide a 'microprofile-platform' Galleon layer", "committedDate": "2020-08-04T11:31:40Z", "type": "forcePushed"}, {"oid": "53086f1367114374e8d48e5ab98a3f959082f2ae", "url": "https://github.com/wildfly/wildfly/commit/53086f1367114374e8d48e5ab98a3f959082f2ae", "message": "WFLY-12681 Provide a 'microprofile-platform' Galleon layer", "committedDate": "2020-08-06T16:54:09Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzE5MDk2NA==", "url": "https://github.com/wildfly/wildfly/pull/12948#discussion_r477190964", "bodyText": "@rhusar given microprofile-platform already includes microprofile-config, microprofile-fault-tolerance, microprofile-health, microprofile-jwt, microprofile-metrics, microprofile-openapi, open-tracing: can we remove them from the list? or we keep them to prevent errors in case, in some future, they are removed from microprofile-platform or microprofile-platform itself is removed?", "author": "tommaso-borgato", "createdAt": "2020-08-26T10:12:39Z", "path": "testsuite/layers/pom.xml", "diffHunk": "@@ -2266,6 +2302,7 @@\n                                                 <layer>logging</layer>\n                                                 <layer>management</layer>\n                                                 <layer>management-security-realm</layer>\n+                                                <layer>microprofile-platform</layer>\n                                                 <layer>microprofile-config</layer>", "originalCommit": "53086f1367114374e8d48e5ab98a3f959082f2ae", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzIyNDE2MA==", "url": "https://github.com/wildfly/wildfly/pull/12948#discussion_r477224160", "bodyText": "@tommaso-borgato We can \u2013 but the existing layers are already overlapping (e.g. undertow is listed explicitly even though its a dependency of any of the web server layers, e.g. datasources-web-server). So this is intentional.", "author": "rhusar", "createdAt": "2020-08-26T11:18:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzE5MDk2NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzI2MDgwNg==", "url": "https://github.com/wildfly/wildfly/pull/12948#discussion_r477260806", "bodyText": "@rhusar what drove the decision to exclude these tests? I am asking just for getting some understanding ... (I already asked on the AD, so if you answer there I'll copy the answer here and vice-versa)", "author": "tommaso-borgato", "createdAt": "2020-08-26T12:28:03Z", "path": "testsuite/integration/basic/pom.xml", "diffHunk": "@@ -1229,6 +1270,45 @@\n                                 <phase>none</phase>\n                             </execution>\n \n+                            <!-- Tests against the install with microprofile-platform support -->\n+                            <execution>\n+                                <id>microprofile-platform-layers.surefire</id>\n+                                <phase>test</phase>\n+                                <goals>\n+                                    <goal>test</goal>\n+                                </goals>\n+                                <configuration>\n+                                    <systemPropertyVariables>\n+                                        <jboss.install.dir>${basedir}/target/wildfly-microprofile-platform</jboss.install.dir>\n+                                        <jboss.home>${project.build.directory}/wildfly-microprofile-platform</jboss.home>\n+                                        <jboss.home.dir>${project.build.directory}/wildfly-microprofile-platform</jboss.home.dir>\n+                                        <jbossas.dist>${project.build.directory}/wildfly-microprofile-platform</jbossas.dist>\n+                                        <jboss.dist>${project.build.directory}/wildfly-microprofile-platform</jboss.dist>\n+                                        <module.path>${project.build.directory}/wildfly-microprofile-platform/modules${path.separator}${basedir}/target/modules</module.path>\n+                                    </systemPropertyVariables>\n+                                    <environmentVariables>\n+                                        <JBOSS_HOME>${project.build.directory}/wildfly-microprofile-platform</JBOSS_HOME>\n+                                        <!-- dummy env property for MicroProfile Config testing -->\n+                                        <MPCONFIG_TEST_ENV_VAR>integ-basicmpconfig-test-env-var-value</MPCONFIG_TEST_ENV_VAR>\n+                                        <TEST_PROP>JMXPropertyEditorsTestCase-WFLY-12899</TEST_PROP>\n+                                    </environmentVariables>\n+                                    <redirectTestOutputToFile>${testLogToFile}</redirectTestOutputToFile>\n+                                    <includes>\n+                                        <include>org/wildfly/test/integration/microprofile/**/*TestCase.java</include>\n+                                    </includes>\n+                                    <excludes>", "originalCommit": "53086f1367114374e8d48e5ab98a3f959082f2ae", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODI1MDY4Mw==", "url": "https://github.com/wildfly/wildfly/pull/12948#discussion_r478250683", "bodyText": "@tommaso-borgato These tests have other dependencies in order to run (e.g. security) while the profile only provisions basic server (jaxrs-server) with the microprofile-plaform layer and of course jmx-remoting & security-manager which are needed by Arquillian. We might consider adding more layers to support more tests, but I am not sure if that doesn't defeat the purpose of the test.", "author": "rhusar", "createdAt": "2020-08-27T08:35:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzI2MDgwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTA1MjU3Ng==", "url": "https://github.com/wildfly/wildfly/pull/12948#discussion_r479052576", "bodyText": "@tommaso-borgato We can certainly do that, the price we pay is the extra testsuite execution time which is kind of exploding atm. Do you have a link handy where the JSF+EJB layer tests are discussed by any chance?", "author": "rhusar", "createdAt": "2020-08-28T09:55:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzI2MDgwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTA2NTEwMw==", "url": "https://github.com/wildfly/wildfly/pull/12948#discussion_r479065103", "bodyText": "@rhusar I am waiting for EAP7-1529 to be completed with JSF+EJB test, that's why I tagged @yersan: here is the TP snippet relative to this: https://gitlab.mw.lab.eng.bos.redhat.com/jbossqe-eap/test-plans/merge_requests/380/diffs#4e1bf40d542063d096fcd61d1fb6f49b4aba74ab_0_177\nProbably he can contribute to this discussion ....", "author": "tommaso-borgato", "createdAt": "2020-08-28T10:05:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzI2MDgwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTk1MTU0NA==", "url": "https://github.com/wildfly/wildfly/pull/12948#discussion_r479951544", "bodyText": "@rhusar in addition to that, microprofile tests are fast (about 10 seconds on my laptop)", "author": "tommaso-borgato", "createdAt": "2020-08-31T07:38:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzI2MDgwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTAyNDU3MA==", "url": "https://github.com/wildfly/wildfly/pull/12948#discussion_r481024570", "bodyText": "^^^ do you have any update on the missing tests? would it be possible, for example, to add security tests on a slimmed server with the minimum amount of necessary layers? if you don't want to add more tests it's fine, just leave a comment here so we know how the discussion ended", "author": "tommaso-borgato", "createdAt": "2020-09-01T10:08:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzI2MDgwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzYxOTkyNw==", "url": "https://github.com/wildfly/wildfly/pull/12948#discussion_r483619927", "bodyText": "Actually, it looks like the problem is only with the test setup. I will put this on the backlog, but its not clear what those tests are missing \u2013 will need to check with Darran when he comes back.", "author": "rhusar", "createdAt": "2020-09-04T13:36:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzI2MDgwNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODM3MjYzNA==", "url": "https://github.com/wildfly/wildfly/pull/12948#discussion_r478372634", "bodyText": "@rhusar please consider reading this comment in order to validate the location where this layer is defined", "author": "tommaso-borgato", "createdAt": "2020-08-27T12:15:09Z", "path": "galleon-pack/src/main/resources/layers/standalone/microprofile-platform/layer-spec.xml", "diffHunk": "@@ -0,0 +1,33 @@\n+<?xml version=\"1.0\" ?>", "originalCommit": "53086f1367114374e8d48e5ab98a3f959082f2ae", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTAzNjU3OA==", "url": "https://github.com/wildfly/wildfly/pull/12948#discussion_r479036578", "bodyText": "@tommaso-borgato The comment confirms the location is correct. Resolving.", "author": "rhusar", "createdAt": "2020-08-28T09:42:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODM3MjYzNA=="}], "type": "inlineReview"}, {"oid": "4d455b733bf1c06195aca126523f974de3e8fbf0", "url": "https://github.com/wildfly/wildfly/commit/4d455b733bf1c06195aca126523f974de3e8fbf0", "message": "WFLY-12681 Provide a 'microprofile-platform' Galleon layer", "committedDate": "2020-09-04T09:31:16Z", "type": "forcePushed"}, {"oid": "92ee175f4123930c344388da4c87e3b63f8d60d5", "url": "https://github.com/wildfly/wildfly/commit/92ee175f4123930c344388da4c87e3b63f8d60d5", "message": "WFLY-12681 Provide a 'microprofile-platform' Galleon layer", "committedDate": "2020-09-10T10:13:31Z", "type": "forcePushed"}, {"oid": "272bf5c5c680fd2b4f44cc02b60279a635a2cade", "url": "https://github.com/wildfly/wildfly/commit/272bf5c5c680fd2b4f44cc02b60279a635a2cade", "message": "Minor fix in org.wildfly.test.integration.microprofile.opentracing.MultiTracerTestCase", "committedDate": "2020-09-10T19:59:42Z", "type": "commit"}, {"oid": "e20bb126ae201e0ca12ce080cb1b812294695e92", "url": "https://github.com/wildfly/wildfly/commit/e20bb126ae201e0ca12ce080cb1b812294695e92", "message": "WFLY-12681 Provide a 'microprofile-platform' Galleon layer", "committedDate": "2020-09-10T20:22:30Z", "type": "forcePushed"}, {"oid": "b0c7423c58a9da6a3a0f8aca0c2ec03fa3bec4c4", "url": "https://github.com/wildfly/wildfly/commit/b0c7423c58a9da6a3a0f8aca0c2ec03fa3bec4c4", "message": "WFLY-12681 Provide a 'microprofile-platform' Galleon layer", "committedDate": "2020-09-10T20:26:44Z", "type": "commit"}, {"oid": "b0c7423c58a9da6a3a0f8aca0c2ec03fa3bec4c4", "url": "https://github.com/wildfly/wildfly/commit/b0c7423c58a9da6a3a0f8aca0c2ec03fa3bec4c4", "message": "WFLY-12681 Provide a 'microprofile-platform' Galleon layer", "committedDate": "2020-09-10T20:26:44Z", "type": "forcePushed"}]}