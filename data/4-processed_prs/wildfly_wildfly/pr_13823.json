{"pr_number": 13823, "pr_title": "Fix for WFLY-14190, EE9 tests for bootable jar", "pr_createdAt": "2020-12-14T12:34:01Z", "pr_url": "https://github.com/wildfly/wildfly/pull/13823", "timeline": [{"oid": "31f92ff16b77e80a967f90d314f154311f951118", "url": "https://github.com/wildfly/wildfly/commit/31f92ff16b77e80a967f90d314f154311f951118", "message": "Fix for WFLY-14190, EE9 tests for bootable jar", "committedDate": "2020-12-15T09:51:54Z", "type": "forcePushed"}, {"oid": "285da0e03a7c179ecaa2be538e704d122e272654", "url": "https://github.com/wildfly/wildfly/commit/285da0e03a7c179ecaa2be538e704d122e272654", "message": "Fix for WFLY-14190, EE9 tests for bootable jar", "committedDate": "2020-12-15T15:54:44Z", "type": "forcePushed"}, {"oid": "b70a5edcc73b5240cecfb560adc70988557c7cb3", "url": "https://github.com/wildfly/wildfly/commit/b70a5edcc73b5240cecfb560adc70988557c7cb3", "message": "Fix for WFLY-14190, EE9 tests for bootable jar", "committedDate": "2020-12-16T08:21:48Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDEwNjE2Nw==", "url": "https://github.com/wildfly/wildfly/pull/13823#discussion_r544106167", "bodyText": "these 3 excludes can be removed as the tests have been moved to testsuite/integration/microprofile", "author": "jmesnil", "createdAt": "2020-12-16T08:33:06Z", "path": "testsuite/integration/basic/pom.xml", "diffHunk": "@@ -2873,371 +3255,283 @@\n                         </executions>\n                     </plugin>\n                     <plugin>\n-                        <artifactId>maven-jar-plugin</artifactId>\n+                        <groupId>org.apache.maven.plugins</groupId>\n+                        <artifactId>maven-surefire-plugin</artifactId>\n                         <executions>\n+                            <!-- Disable the standard test executions. -->\n                             <execution>\n-                                <id>create-module-testDriver</id>\n-                                <goals>\n-                                    <goal>jar</goal>\n-                                </goals>\n-                                <phase>process-test-classes</phase>\n-                                <configuration>\n-                                    <outputDirectory>${project.build.directory}/extraContent/modules/org/jboss/test/testDriver/main</outputDirectory>\n-                                    <classesDirectory>${project.build.testOutputDirectory}</classesDirectory>\n-                                    <includes>\n-                                        <include>**/org/jboss/as/test/integration/jca/classloading/ClassloadingDataSource.class</include>\n-                                        <include>**/org/jboss/as/test/integration/jca/classloading/ClassloadingDriver.class</include>\n-                                        <include>**/org/jboss/as/test/integration/jca/classloading/TestConnection.class</include>\n-                                        <include>**/org/jboss/as/test/integration/jca/classloading/ClassloadingXADataSource.class</include>\n-                                        <include>**/org/jboss/as/test/integration/jca/classloading/TestXAConnection.class</include>\n-                                        <include>**/META-INF/services/java.sql.Driver</include>\n-                                    </includes>\n-                                    <finalName>testDriver</finalName>\n-                                    <classifier>bootableJar</classifier>\n-                                </configuration>\n+                                <id>default-test</id>\n+                                <phase>none</phase>\n                             </execution>\n                             <execution>\n-                                <id>create-module-cidExtensionModule</id>\n-                                <goals>\n-                                    <goal>jar</goal>\n-                                </goals>\n-                                <phase>process-test-classes</phase>\n-                                <configuration>\n-                                    <outputDirectory>${project.build.directory}/extraContent/modules/cidExtensionModule/main</outputDirectory>\n-                                    <classesDirectory>${project.build.testOutputDirectory}</classesDirectory>\n-                                    <includes>\n-                                        <include>**/org/jboss/as/test/integration/weld/extensions/cdiportableextensions/FunExtension.class</include>\n-                                        <include>**/org/jboss/as/test/integration/weld/extensions/cdiportableextensions/Funny.class</include>\n-                                        <include>**/META-INF/services/javax.enterprise.inject.spi.Extension</include>\n-                                    </includes>\n-                                    <finalName>weldTest</finalName>\n-                                    <classifier>bootableJar</classifier>\n-                                </configuration>\n+                                <id>basic-integration-default-full.surefire</id>\n+                                <phase>none</phase>\n                             </execution>\n                             <execution>\n-                                <id>create-module-test-alpha</id>\n-                                <goals>\n-                                    <goal>jar</goal>\n-                                </goals>\n-                                <phase>process-test-classes</phase>\n-                                <configuration>\n-                                    <outputDirectory>${project.build.directory}/extraContent/modules/test/alpha/main</outputDirectory>\n-                                    <classesDirectory>${project.build.testOutputDirectory}</classesDirectory>\n-                                    <includes>\n-                                        <include>**/org/jboss/as/test/integration/weld/modules/AlphaBean.class</include>\n-                                        <include>**/org/jboss/as/test/integration/weld/modules/AlphaLookup.class</include>\n-                                        <include>**/META-INF/beans.xml</include>\n-                                    </includes>\n-                                    <finalName>alpha</finalName>\n-                                    <classifier>bootableJar</classifier>\n-                                </configuration>\n+                                <id>basic-integration-default-web.surefire</id>\n+                                <phase>none</phase>\n                             </execution>\n                             <execution>\n-                                <id>create-module-test-bravo</id>\n-                                <goals>\n-                                    <goal>jar</goal>\n-                                </goals>\n-                                <phase>process-test-classes</phase>\n-                                <configuration>\n-                                    <outputDirectory>${project.build.directory}/extraContent/modules/test/bravo/main</outputDirectory>\n-                                    <classesDirectory>${project.build.testOutputDirectory}</classesDirectory>\n-                                    <includes>\n-                                        <include>**/org/jboss/as/test/integration/weld/modules/BravoBean.class</include>\n-                                        <include>**/org/jboss/as/test/integration/weld/modules/BravoLookup.class</include>\n-                                        <include>**/META-INF/beans.xml</include>\n-                                    </includes>\n-                                    <finalName>bravo</finalName>\n-                                    <classifier>bootableJar</classifier>\n-                                </configuration>\n+                                <id>basic-integration-2nd.surefire</id>\n+                                <phase>none</phase>\n                             </execution>\n                             <execution>\n-                                <id>create-module-test-charlie</id>\n-                                <goals>\n-                                    <goal>jar</goal>\n-                                </goals>\n-                                <phase>process-test-classes</phase>\n-                                <configuration>\n-                                    <outputDirectory>${project.build.directory}/extraContent/modules/test/charlie/main</outputDirectory>\n-                                    <classesDirectory>${project.build.testOutputDirectory}</classesDirectory>\n-                                    <includes>\n-                                        <include>**/org/jboss/as/test/integration/weld/modules/CharlieBean.class</include>\n-                                        <include>**/org/jboss/as/test/integration/weld/modules/CharlieLookup.class</include>\n-                                        <include>**/META-INF/beans.xml</include>\n-                                    </includes>\n-                                    <finalName>charlie</finalName>\n-                                    <classifier>bootableJar</classifier>\n-                                </configuration>\n+                                <id>basic-integration-ldap.surefire</id>\n+                                <phase>none</phase>\n                             </execution>\n+\n+                            <!-- Tests against the cloud-server install without legacy security -->\n                             <execution>\n-                                <id>create-module-test-delta</id>\n+                                <!-- We reuse the microprofile.surefire execution used for testing standalone-microprofile.xml\n+                                     as the set of tests we want is the same -->\n+                                <id>microprofile.surefire</id>\n+                                <phase>test</phase>\n                                 <goals>\n-                                    <goal>jar</goal>\n+                                    <goal>test</goal>\n                                 </goals>\n-                                <phase>process-test-classes</phase>\n                                 <configuration>\n-                                    <outputDirectory>${project.build.directory}/extraContent/modules/test/delta/main</outputDirectory>\n-                                    <classesDirectory>${project.build.testOutputDirectory}</classesDirectory>\n-                                    <includes>\n-                                        <include>**/org/jboss/as/test/integration/weld/modules/DeltaBean.class</include>\n-                                        <include>**/org/jboss/as/test/integration/weld/modules/DeltaLookup.class</include>\n-                                        <include>**/META-INF/beans.xml</include>\n-                                    </includes>\n-                                    <finalName>delta</finalName>\n-                                    <classifier>bootableJar</classifier>\n+                                    <systemPropertyVariables>\n+                                        <install.dir>${project.build.directory}/wildfly</install.dir>\n+                                        <bootable.jar>${project.build.directory}/test-wildfly-cloud-profile.jar</bootable.jar>\n+                                        <arquillian.xml>arquillian-bootable.xml</arquillian.xml>\n+                                    </systemPropertyVariables>\n+                                    <redirectTestOutputToFile>${testLogToFile}</redirectTestOutputToFile>\n+                                    <classpathDependencyExcludes>\n+                                        <classpathDependencyExclude>\n+                                            org.wildfly.arquillian:wildfly-arquillian-container-managed\n+                                        </classpathDependencyExclude>\n+                                    </classpathDependencyExcludes>\n+                                    <excludes combine.children=\"append\">\n+                                        <!-- For bootable-jar, custom modules have to be prepared aside in the time of jar packinging,\n+                                        which is not sustainable for all tests. -->\n+                                        <exclude>org/jboss/as/test/integration/security/vault/ExternalPasswordCommandsTestCase.java</exclude>\n+                                        <exclude>org/jboss/as/test/integration/security/vault/ExternalPasswordByClassTestCase.java</exclude>\n+                                        <exclude>org/jboss/as/test/integration/weld/modules/deployment/ModuleBeanDiscoveryModeTest.java</exclude>\n+                                        <exclude>org/jboss/as/test/integration/weld/modules/export/ExportedModuleTestCase.java</exclude>\n+                                        <!-- Requires extra modules -->", "originalCommit": "b70a5edcc73b5240cecfb560adc70988557c7cb3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDI2MjEyMw==", "url": "https://github.com/wildfly/wildfly/pull/13823#discussion_r544262123", "bodyText": "Ok, done.", "author": "jfdenise", "createdAt": "2020-12-16T12:33:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDEwNjE2Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDEwODUxNw==", "url": "https://github.com/wildfly/wildfly/pull/13823#discussion_r544108517", "bodyText": "maybe, we should also add the comments that explains why these tests are excluded (as they require the creation of a JBoss Module)", "author": "jmesnil", "createdAt": "2020-12-16T08:37:01Z", "path": "testsuite/integration/microprofile/pom.xml", "diffHunk": "@@ -661,6 +782,12 @@\n                                             org.wildfly.arquillian:wildfly-arquillian-container-managed\n                                         </classpathDependencyExclude>\n                                     </classpathDependencyExcludes>\n+                                    <excludes>\n+                                        <exclude>org/wildfly/test/integration/microprofile/jwt/ejb/JWTEJBTestCase.java</exclude>\n+                                        <exclude>org/wildfly/test/integration/microprofile/config/smallrye/converter/MicroProfileConfigConvertersTestCase</exclude>", "originalCommit": "b70a5edcc73b5240cecfb560adc70988557c7cb3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDI2NDAwMA==", "url": "https://github.com/wildfly/wildfly/pull/13823#discussion_r544264000", "bodyText": "I investigated the tests and module.path was not set to the right location, I fixed that. I removed the exclusion for bootable.jar, 1 test still fails MicroProfileConfigConvertersTestCase with ts.bootable.ee9. This needs to be investigated. @bstansberry , I tried with the ee9 profile and MicroProfileConfigConvertersTestCase as well MicroProfileConfigTestCase are failing.", "author": "jfdenise", "createdAt": "2020-12-16T12:36:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDEwODUxNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDI4NjgzMA==", "url": "https://github.com/wildfly/wildfly/pull/13823#discussion_r544286830", "bodyText": "Thanks. The nightly for WildFly Preview shows those 2 failures.\nhttps://ci.wildfly.org/viewLog.html?buildId=234874&tab=buildResultsDiv&buildTypeId=WF_WildflyPreviewNightly\nSo we can handle that separately.", "author": "bstansberry", "createdAt": "2020-12-16T13:12:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDEwODUxNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDM2MDk3MQ==", "url": "https://github.com/wildfly/wildfly/pull/13823#discussion_r544360971", "bodyText": "I have found the root cause of MicroProfileConfigConvertersTestCase issue, the custom module relies on javax.annotation that needs transformation. I am looking into it.", "author": "jfdenise", "createdAt": "2020-12-16T14:51:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDEwODUxNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDM3OTQ0Mw==", "url": "https://github.com/wildfly/wildfly/pull/13823#discussion_r544379443", "bodyText": "The exclusions are now removed, the fix also applies to ts.ee9 profile.", "author": "jfdenise", "createdAt": "2020-12-16T15:14:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDEwODUxNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDEwODkxMw==", "url": "https://github.com/wildfly/wildfly/pull/13823#discussion_r544108913", "bodyText": "is there a reason to get this version here (as opposed to the top-level pom.xml)?", "author": "jmesnil", "createdAt": "2020-12-16T08:37:39Z", "path": "testsuite/integration/pom.xml", "diffHunk": "@@ -48,6 +48,8 @@\n \n         <ts.elytron.cli>../../shared/enable-elytron.cli</ts.elytron.cli>\n         <wildfly.dir>${project.build.directory}/wildfly</wildfly.dir>\n+        \n+        <version.org.wildfly.jar.plugin>3.0.0.Beta1</version.org.wildfly.jar.plugin>", "originalCommit": "b70a5edcc73b5240cecfb560adc70988557c7cb3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDI2NDI2NA==", "url": "https://github.com/wildfly/wildfly/pull/13823#discussion_r544264264", "bodyText": "No reason, I moved to top level pom file.", "author": "jfdenise", "createdAt": "2020-12-16T12:36:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDEwODkxMw=="}], "type": "inlineReview"}, {"oid": "4de5c7434e50898d0c4ae41c7af524aff7b4c908", "url": "https://github.com/wildfly/wildfly/commit/4de5c7434e50898d0c4ae41c7af524aff7b4c908", "message": "Fix for WFLY-14190, EE9 tests for bootable jar", "committedDate": "2020-12-16T11:06:42Z", "type": "forcePushed"}, {"oid": "2f5f10b1c99072a8f061f1ff02a0e416ae5e0aca", "url": "https://github.com/wildfly/wildfly/commit/2f5f10b1c99072a8f061f1ff02a0e416ae5e0aca", "message": "Fix for WFLY-14190, EE9 tests for bootable jar", "committedDate": "2020-12-16T12:31:25Z", "type": "forcePushed"}, {"oid": "db5cb18888bc6fde51a3772afe39925910b21ead", "url": "https://github.com/wildfly/wildfly/commit/db5cb18888bc6fde51a3772afe39925910b21ead", "message": "Fix for WFLY-14190, EE9 tests for bootable jar", "committedDate": "2020-12-16T15:12:57Z", "type": "forcePushed"}, {"oid": "812dd5c8c625f861b9f51063ffa1adbdae89adb4", "url": "https://github.com/wildfly/wildfly/commit/812dd5c8c625f861b9f51063ffa1adbdae89adb4", "message": "Fix for WFLY-14190, EE9 tests for bootable jar", "committedDate": "2020-12-16T16:00:06Z", "type": "commit"}, {"oid": "812dd5c8c625f861b9f51063ffa1adbdae89adb4", "url": "https://github.com/wildfly/wildfly/commit/812dd5c8c625f861b9f51063ffa1adbdae89adb4", "message": "Fix for WFLY-14190, EE9 tests for bootable jar", "committedDate": "2020-12-16T16:00:06Z", "type": "forcePushed"}]}