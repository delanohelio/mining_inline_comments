{"pr_number": 4957, "pr_title": "Sign single account", "pr_createdAt": "2020-12-15T15:20:54Z", "pr_url": "https://github.com/bisq-network/bisq/pull/4957", "timeline": [{"oid": "de25105fa81f7acc1468cecb1a35f763e9989224", "url": "https://github.com/bisq-network/bisq/commit/de25105fa81f7acc1468cecb1a35f763e9989224", "message": "Copy account data to clipboard\n\nUse ctrl+c to copy accountagewitness and pubkey to clipboard in a format to\nbe used by arbitrator to sign the account", "committedDate": "2020-12-15T13:53:34Z", "type": "commit"}, {"oid": "4c33f9c9992b308276055de420741bd45a5a4118", "url": "https://github.com/bisq-network/bisq/commit/4c33f9c9992b308276055de420741bd45a5a4118", "message": "Sign imported AccountAgeWitness,PubKey\n\nChange the specific sign window to sign an imported account in the form\nof accountAgeWitnessString,pubKeyString. The SignSpecificWitness never\nworked due to missing pubKey data and this is a way to import the missing data.", "committedDate": "2020-12-15T15:08:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzU2ODAzMw==", "url": "https://github.com/bisq-network/bisq/pull/4957#discussion_r543568033", "bodyText": "Is that a debug util or is the \",\" concatenation used in normal cases?", "author": "chimp1984", "createdAt": "2020-12-15T18:04:26Z", "path": "core/src/main/java/bisq/core/account/witness/AccountAgeWitnessService.java", "diffHunk": "@@ -880,4 +880,10 @@ public boolean isSignWitnessTrade(Trade trade) {\n                 !peerHasSignedWitness(trade) &&\n                 tradeAmountIsSufficient(trade.getTradeAmount());\n     }\n+\n+    public String signInfoFromAccount(PaymentAccount paymentAccount) {\n+        var pubKey = keyRing.getSignatureKeyPair().getPublic();\n+        var witness = getMyWitness(paymentAccount.getPaymentAccountPayload());\n+        return Utilities.bytesAsHexString(witness.getHash()) + \",\" + Utilities.bytesAsHexString(pubKey.getEncoded());", "originalCommit": "de25105fa81f7acc1468cecb1a35f763e9989224", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzU2ODI5Ng==", "url": "https://github.com/bisq-network/bisq/pull/4957#discussion_r543568296", "bodyText": "If debug tool better to rename method to make it more clear and add a comment...", "author": "chimp1984", "createdAt": "2020-12-15T18:04:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzU2ODAzMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzU3NTg3MQ==", "url": "https://github.com/bisq-network/bisq/pull/4957#discussion_r543575871", "bodyText": "After reviewing the rest I understand now better... I stil would recommend to rename the method so it is more clear its not a normal user method but a special tool... also i am old-school and prefer get prefix... here it could read as intent as well: sign infoFromAccount.... instead of: get signInfo from account", "author": "chimp1984", "createdAt": "2020-12-15T18:15:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzU2ODAzMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzU4NTk5Mg==", "url": "https://github.com/bisq-network/bisq/pull/4957#discussion_r543585992", "bodyText": "Yes, the naming was not good, changed to getSignInfo...", "author": "sqrrm", "createdAt": "2020-12-15T18:31:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzU2ODAzMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzU2OTA4OQ==", "url": "https://github.com/bisq-network/bisq/pull/4957#discussion_r543569089", "bodyText": "Cmd+c is a very common key command, not sure if its better to use a more exotic one so that user do not trigger that accidentally. Prob. no harm by doing that, but confusing...", "author": "chimp1984", "createdAt": "2020-12-15T18:06:02Z", "path": "desktop/src/main/java/bisq/desktop/main/account/content/PaymentAccountsView.java", "diffHunk": "@@ -62,6 +62,8 @@ public void initialize() {\n                 accountAgeWitnessService.getAccountAgeWitnessUtils().logSigners();\n             } else if (Utilities.isCtrlShiftPressed(KeyCode.U, event)) {\n                 accountAgeWitnessService.getAccountAgeWitnessUtils().logUnsignedSignerPubKeys();\n+            } else if (Utilities.isAltOrCtrlPressed(KeyCode.C, event)) {", "originalCommit": "de25105fa81f7acc1468cecb1a35f763e9989224", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzU2OTQ5MQ==", "url": "https://github.com/bisq-network/bisq/pull/4957#discussion_r543569491", "bodyText": "As its only used for fiat, better move it to fiat class instead of base class", "author": "chimp1984", "createdAt": "2020-12-15T18:06:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzU2OTA4OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzU4NTE1Mg==", "url": "https://github.com/bisq-network/bisq/pull/4957#discussion_r543585152", "bodyText": "I like adding it here, and I like ctrl+c since it's the common copy key and that's what we're doing here, copying the account info to clipboard.", "author": "sqrrm", "createdAt": "2020-12-15T18:29:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzU2OTA4OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzU4ODM2Mg==", "url": "https://github.com/bisq-network/bisq/pull/4957#discussion_r543588362", "bodyText": "it opens a popup window right?", "author": "chimp1984", "createdAt": "2020-12-15T18:34:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzU2OTA4OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzU4ODYyNg==", "url": "https://github.com/bisq-network/bisq/pull/4957#discussion_r543588626", "bodyText": "or just copy to clipboard?", "author": "chimp1984", "createdAt": "2020-12-15T18:35:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzU2OTA4OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzU4ODc2NA==", "url": "https://github.com/bisq-network/bisq/pull/4957#discussion_r543588764", "bodyText": "sorry have not looked too close to the code base....", "author": "chimp1984", "createdAt": "2020-12-15T18:35:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzU2OTA4OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzcwNTE0NQ==", "url": "https://github.com/bisq-network/bisq/pull/4957#discussion_r543705145", "bodyText": "Just copy to clipboard, no need for popup window.", "author": "sqrrm", "createdAt": "2020-12-15T21:39:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzU2OTA4OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzU3MTIxOQ==", "url": "https://github.com/bisq-network/bisq/pull/4957#discussion_r543571219", "bodyText": "Why not move return into the try block?\nreturn getWitnessByHash(accountAgeWitnessHash)\n                .map(ageWitness -> new Tuple2<>(ageWitness, pubKeyHash))\n                .orElse(null);", "author": "chimp1984", "createdAt": "2020-12-15T18:09:11Z", "path": "core/src/main/java/bisq/core/account/witness/AccountAgeWitnessService.java", "diffHunk": "@@ -886,4 +887,24 @@ public String signInfoFromAccount(PaymentAccount paymentAccount) {\n         var witness = getMyWitness(paymentAccount.getPaymentAccountPayload());\n         return Utilities.bytesAsHexString(witness.getHash()) + \",\" + Utilities.bytesAsHexString(pubKey.getEncoded());\n     }\n+\n+    public Tuple2<AccountAgeWitness, byte[]> signInfoFromString(String signInfo) {\n+        var parts = signInfo.split(\",\");\n+        if (parts.length != 2){\n+            return null;\n+        }\n+        byte[] pubKeyHash;\n+        Optional<AccountAgeWitness> accountAgeWitness;\n+        try {\n+            var accountAgeWitnessHash = Utilities.decodeFromHex(parts[0]);\n+            pubKeyHash = Utilities.decodeFromHex(parts[1]);\n+            accountAgeWitness = getWitnessByHash(accountAgeWitnessHash);\n+        } catch (Exception e) {\n+            return null;\n+        }\n+\n+        return accountAgeWitness", "originalCommit": "4c33f9c9992b308276055de420741bd45a5a4118", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzU4NzkxOA==", "url": "https://github.com/bisq-network/bisq/pull/4957#discussion_r543587918", "bodyText": "Yes, done.", "author": "sqrrm", "createdAt": "2020-12-15T18:34:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzU3MTIxOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzU3MjcyOQ==", "url": "https://github.com/bisq-network/bisq/pull/4957#discussion_r543572729", "bodyText": "So that use old arbitrators, right? there are none registered anymore. Wouldn't it be better to use mediators or refund agents?", "author": "chimp1984", "createdAt": "2020-12-15T18:11:24Z", "path": "desktop/src/main/java/bisq/desktop/main/overlays/windows/SignSpecificWitnessWindow.java", "diffHunk": "@@ -194,15 +161,24 @@ private void addSuccessContent() {\n \n     @Override\n     protected void addButtons() {\n-        var buttonTuple = add2ButtonsAfterGroup(gridPane, ++rowIndex + 1,\n+        var buttonTuple = add2ButtonsAfterGroup(gridPane, ++rowIndex + 2,\n                 Res.get(\"popup.accountSigning.singleAccountSelect.headline\"), Res.get(\"shared.cancel\"));\n \n         actionButton = buttonTuple.first;\n         actionButton.setDisable(true);\n-        actionButton.setOnAction(e -> selectAccountAgeWitness());\n+        actionButton.setOnAction(e -> importAccountAgeWitness());\n \n         closeButton = (AutoTooltipButton) buttonTuple.second;\n         closeButton.setOnAction(e -> hide());\n+    }\n \n+    private ECKey checkedArbitratorKey() {\n+        var arbitratorKey = arbitratorManager.getRegistrationKey(privateKey.getText());", "originalCommit": "4c33f9c9992b308276055de420741bd45a5a4118", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzY5Mzk4MQ==", "url": "https://github.com/bisq-network/bisq/pull/4957#discussion_r543693981", "bodyText": "It might be but that's a bigger change and I'm not convinced. I think that would add another complication to adding more mediators.", "author": "sqrrm", "createdAt": "2020-12-15T21:20:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzU3MjcyOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzU3MzU1Nw==", "url": "https://github.com/bisq-network/bisq/pull/4957#discussion_r543573557", "bodyText": "Ah now I see why u use \",\" for concatination....\nA pipe or a static field for it would make it a bit more intuitive... but no worry... being picky ;-)", "author": "chimp1984", "createdAt": "2020-12-15T18:12:32Z", "path": "core/src/main/java/bisq/core/account/witness/AccountAgeWitnessService.java", "diffHunk": "@@ -886,4 +887,24 @@ public String signInfoFromAccount(PaymentAccount paymentAccount) {\n         var witness = getMyWitness(paymentAccount.getPaymentAccountPayload());\n         return Utilities.bytesAsHexString(witness.getHash()) + \",\" + Utilities.bytesAsHexString(pubKey.getEncoded());\n     }\n+\n+    public Tuple2<AccountAgeWitness, byte[]> signInfoFromString(String signInfo) {\n+        var parts = signInfo.split(\",\");", "originalCommit": "4c33f9c9992b308276055de420741bd45a5a4118", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzU4ODU4Nw==", "url": "https://github.com/bisq-network/bisq/pull/4957#discussion_r543588587", "bodyText": "Won't change, just easier to read with , as separator.", "author": "sqrrm", "createdAt": "2020-12-15T18:34:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzU3MzU1Nw=="}], "type": "inlineReview"}, {"oid": "e0f4dc22e784bfc55c8439f645a583ce6531c232", "url": "https://github.com/bisq-network/bisq/commit/e0f4dc22e784bfc55c8439f645a583ce6531c232", "message": "Fix formatting", "committedDate": "2020-12-15T18:27:13Z", "type": "commit"}, {"oid": "26024bd6ec0155dca6b8f3bb484df789535866af", "url": "https://github.com/bisq-network/bisq/commit/26024bd6ec0155dca6b8f3bb484df789535866af", "message": "Refactor: rename methods, move return statement", "committedDate": "2020-12-15T18:35:49Z", "type": "commit"}]}