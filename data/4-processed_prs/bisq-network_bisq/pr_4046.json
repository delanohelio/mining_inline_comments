{"pr_number": 4046, "pr_title": "Add holder name for new Faster Payments accounts", "pr_createdAt": "2020-03-11T11:42:15Z", "pr_url": "https://github.com/bisq-network/bisq/pull/4046", "timeline": [{"oid": "cbb59c155b688cf51433b5f4070f70aa3d3fb24f", "url": "https://github.com/bisq-network/bisq/commit/cbb59c155b688cf51433b5f4070f70aa3d3fb24f", "message": "Remove redundant @Nullable from account payload excludeFromJsonDataMap\n\nSince this map is final and every PaymentAccountPayload constructor\ninitialises it to something nonnull, the @Nullable field annotation is\nredundant, so remove it.\n\nFurther simplify the code by passing an empty map into the constructor\ndirectly from each subclass constructor, rather than mapping empties to\nnulls from each 'proto.getExcludeFromJsonDataMap()' result, then mapping\nnulls back to empties in the base constructor. This is safe, since\ngetExcludeFromJsonDataMap() always returns a nonnull map.\n\nFinally, tidy the code slightly by replacing 'Charset.forName(\"UTF-8\")'\nwith StandardCharsets.UTF_8 in each PaymentAccountPayload subclass.", "committedDate": "2020-03-07T12:08:50Z", "type": "commit"}, {"oid": "a829969089d7d4acb9968856c31a2e91d37ab5fe", "url": "https://github.com/bisq-network/bisq/commit/a829969089d7d4acb9968856c31a2e91d37ab5fe", "message": "Add holder name for new Faster Payments accounts\n\nUse excludeFromJsonDataMap to add an optional owner full name property\nto Faster Payments (GBP) accounts, without affecting the trade JSON\ncontract (for backwards compatibility). This is to fix #3976, that some\nbanks have started checking the recipient name.\n\nMake the name a non-optional field for _new_ accounts, but display the\ndetails for old Faster Payments accounts in exactly the same way as\nbefore, only showing the extra field in the info popup, account and\ntrade step views when it is present.\n\nAlso update the now misleading payment instructions in the buyer popup.\nTODO: Update translations (which probably aren't needed anyway).", "committedDate": "2020-03-11T11:15:12Z", "type": "commit"}, {"oid": "a957fb167a15f43204b0f2ee212d471ba7a0caab", "url": "https://github.com/bisq-network/bisq/commit/a957fb167a15f43204b0f2ee212d471ba7a0caab", "message": "Add popup to advise user to recreate Faster Payments account\n\nOpen an info popup in the take/create offer view, upon choosing to take\nor make a new offer, to instruct the user to recreate their old Faster\nPayments account with an owner full name (and preserved salt). Also show\nthe popup upon manual selection of any old (i.e. missing full name)\nFaster Payments account from the trading account combo box, analogously\nto the ClearXchange (Zelle) warning popup logic.\n\n(Also eliminate slight differences between the private\n'maybeShow[ClearXchange|FasterPayments]Warning' methods in TakeOfferView\nand MutableOfferView, to make the code easier to deduplicate in future.)", "committedDate": "2020-03-25T09:48:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODY1OTgxNA==", "url": "https://github.com/bisq-network/bisq/pull/4046#discussion_r398659814", "bodyText": "If this field is shown during the trade process it creates unnecessary scrolling.\n\nI'd just change line 54-55 to\naddCompactTopLabelTextField(gridPane, gridRow, 1, Res.get(\"payment.accountNr\"),\n                ((FasterPaymentsAccountPayload) paymentAccountPayload).getAccountNr());\n\nwhich puts sort code and account nr next to each other.\n\nThat would work for both cases.", "author": "ripcurlx", "createdAt": "2020-03-26T15:23:26Z", "path": "desktop/src/main/java/bisq/desktop/components/paymentmethods/FasterPaymentsForm.java", "diffHunk": "@@ -44,6 +44,10 @@\n \n     public static int addFormForBuyer(GridPane gridPane, int gridRow,\n                                       PaymentAccountPayload paymentAccountPayload) {\n+        if (!((FasterPaymentsAccountPayload) paymentAccountPayload).getHolderName().isEmpty()) {\n+            addCompactTopLabelTextField(gridPane, ++gridRow, Res.get(\"payment.account.owner\"),\n+                    ((FasterPaymentsAccountPayload) paymentAccountPayload).getHolderName());\n+        }", "originalCommit": "0ec168bc0d6ad45e3ba475679ba8610dbd53a512", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTA1NTUwNQ==", "url": "https://github.com/bisq-network/bisq/pull/4046#discussion_r399055505", "bodyText": "OK, I'll apply the suggested change.", "author": "stejbac", "createdAt": "2020-03-27T06:18:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODY1OTgxNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTA1MzgzNA==", "url": "https://github.com/bisq-network/bisq/pull/4046#discussion_r399053834", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              The UK sort code and account number used to be sufficient for a Faster Payment transfer, but since then some banks \\\n          \n          \n            \n              have started verifying the receiver's name. For this reason, accounts created in old Bisq clients do not provide the \\\n          \n          \n            \n              trade partner with an owner full name. Please use trade chat to avoid any issues in such cases.\n          \n          \n            \n              Faster Payment accounts created in old Bisq clients do not provide the receiver's name, \\\n          \n          \n            \n              so please use trade chat to obtain it (if needed).", "author": "m52go", "createdAt": "2020-03-27T06:12:06Z", "path": "core/src/main/resources/i18n/displayStrings.properties", "diffHunk": "@@ -622,8 +622,9 @@ portfolio.pending.step2_buyer.halCashInfo.msg=You need to send a text message wi\n   trade ID ({0}) to the BTC seller.\\nThe seller''s mobile nr. is {1}.\\n\\n\\\n   Did you send the code to the seller?\n portfolio.pending.step2_buyer.fasterPaymentsHolderNameInfo=Some banks might require the receiver's name. \\\n-  The UK sort code and account number is sufficient for a Faster Payment transfer and the receivers name is not verified \\\n-  by any of the banks.\n+  The UK sort code and account number used to be sufficient for a Faster Payment transfer, but since then some banks \\\n+  have started verifying the receiver's name. For this reason, accounts created in old Bisq clients do not provide the \\\n+  trade partner with an owner full name. Please use trade chat to avoid any issues in such cases.", "originalCommit": "0ec168bc0d6ad45e3ba475679ba8610dbd53a512", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTA4NzM4OA==", "url": "https://github.com/bisq-network/bisq/pull/4046#discussion_r399087388", "bodyText": "OK, I'll apply that change. I think the text\n\nSome banks might require the receiver's name ...\n\nshould possibly be changed to\n\nSome banks might verify the receiver's name ...\n\nwith the suggested change, to emphasise that the issue is that they've started checking it.\n(Although my bank still accepts dummy names - I'm not sure how much longer, though.)", "author": "stejbac", "createdAt": "2020-03-27T07:54:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTA1MzgzNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTA1Mzg1NQ==", "url": "https://github.com/bisq-network/bisq/pull/4046#discussion_r399053855", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            payment.fasterPayments.newRequirements.info=When using Faster Payments some banks have started verifying the receiver''s \\\n          \n          \n            \n              full name. Your current Faster Payments account only specifies a UK bank account number and sort code. This used to be \\\n          \n          \n            \n              sufficient, but may not be now for some sender''s banks. New Faster Payments accounts in Bisq now include an owner \\\n          \n          \n            \n              full name. Please consider recreating your account in Bisq to provide future {0} buyers with a recipient name.\\n\\n\\\n          \n          \n            \n              When recreating a Faster Payments account, take care to copy the account age verification salt from your old account \\\n          \n          \n            \n              and use the same sort code and account number. (The owner full name or account name need not be the same, however.) \\\n          \n          \n            \n              This preserves the public hash, so that the new account need not be aged or signed from scratch.\n          \n          \n            \n            payment.fasterPayments.newRequirements.info=Some banks have started verifying the receiver''s \\\n          \n          \n            \n              full name for Faster Payments transfers. Your current Faster Payments account does not specify a full name.\\n\\n \\\n          \n          \n            \n              Please consider recreating your Faster Payments account in Bisq to provide future {0} buyers with a full name.\\n\\n\\\n          \n          \n            \n              When you recreate the account, make sure to copy the precise sort code, account number, and account age \\\n          \n          \n            \n              verification salt values from your old account to your new account. This will ensure your existing account's age and \\\n          \n          \n            \n              signing status are preserved.", "author": "m52go", "createdAt": "2020-03-27T06:12:11Z", "path": "core/src/main/resources/i18n/displayStrings.properties", "diffHunk": "@@ -3019,7 +3020,13 @@ If you have not fulfilled the above requirements you will lose your security dep\n   For the {0} seller it is highly recommended \\\n to get in contact with the {1} buyer by using the provided email address or mobile number to verify that he or she \\\n   is really the owner of the Zelle (ClearXchange) account.\n-\n+payment.fasterPayments.newRequirements.info=When using Faster Payments some banks have started verifying the receiver''s \\\n+  full name. Your current Faster Payments account only specifies a UK bank account number and sort code. This used to be \\\n+  sufficient, but may not be now for some sender''s banks. New Faster Payments accounts in Bisq now include an owner \\\n+  full name. Please consider recreating your account in Bisq to provide future {0} buyers with a recipient name.\\n\\n\\\n+  When recreating a Faster Payments account, take care to copy the account age verification salt from your old account \\\n+  and use the same sort code and account number. (The owner full name or account name need not be the same, however.) \\\n+  This preserves the public hash, so that the new account need not be aged or signed from scratch.", "originalCommit": "0ec168bc0d6ad45e3ba475679ba8610dbd53a512", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTA4ODkyNQ==", "url": "https://github.com/bisq-network/bisq/pull/4046#discussion_r399088925", "bodyText": "OK, I'll apply the suggested simplification.", "author": "stejbac", "createdAt": "2020-03-27T07:57:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTA1Mzg1NQ=="}], "type": "inlineReview"}, {"oid": "e2f5d7f70b3fc82719b3ba6bdb4f21531d74d2e8", "url": "https://github.com/bisq-network/bisq/commit/e2f5d7f70b3fc82719b3ba6bdb4f21531d74d2e8", "message": "Improve layout of Faster Payments buyer form fields\n\nDisplay the account number on the same row as the sort code in the trade\nstep view, to prevent scrolling with the extra name field (as suggested\nin the code review).\n\n(This also affects the layout of old accounts without the extra field.)", "committedDate": "2020-03-27T06:12:38Z", "type": "forcePushed"}, {"oid": "d84130ff5b82b4a236ad4b540e975db566f23f80", "url": "https://github.com/bisq-network/bisq/commit/d84130ff5b82b4a236ad4b540e975db566f23f80", "message": "Improve popup text + layout of Faster Payments buyer form fields\n\nDisplay the account number on the same row as the sort code in the trade\nstep view, to prevent scrolling with the extra name field (as suggested\nin the code review).\n\n(This also affects the layout of old accounts without the extra field.)\n\nAlso apply the suggested popup text simplifications.", "committedDate": "2020-03-27T08:08:21Z", "type": "commit"}, {"oid": "d84130ff5b82b4a236ad4b540e975db566f23f80", "url": "https://github.com/bisq-network/bisq/commit/d84130ff5b82b4a236ad4b540e975db566f23f80", "message": "Improve popup text + layout of Faster Payments buyer form fields\n\nDisplay the account number on the same row as the sort code in the trade\nstep view, to prevent scrolling with the extra name field (as suggested\nin the code review).\n\n(This also affects the layout of old accounts without the extra field.)\n\nAlso apply the suggested popup text simplifications.", "committedDate": "2020-03-27T08:08:21Z", "type": "forcePushed"}]}