{"pr_number": 4095, "pr_title": "feat: Add BeforeAfterEvent", "pr_createdAt": "2020-07-22T19:30:50Z", "pr_url": "https://github.com/MovingBlocks/Terasology/pull/4095", "timeline": [{"oid": "332bcde0a18813fa1ec7ac5b30a09a320a8416bf", "url": "https://github.com/MovingBlocks/Terasology/commit/332bcde0a18813fa1ec7ac5b30a09a320a8416bf", "message": "delete extra files", "committedDate": "2020-07-22T20:53:44Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTYzNTM2Ng==", "url": "https://github.com/MovingBlocks/Terasology/pull/4095#discussion_r459635366", "bodyText": "Did you ever work with Generics, as in, implemented a generic class? I'd think this would be a good case where we can use that - don't fix the event to be based on float right away.\nSo here's my suggestion:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            public class AbstractBeforeAfterEvent implements Event {\n          \n          \n            \n            public abstract class BeforeAfterEvent<T> implements Event {\n          \n      \n    \n    \n  \n\n\nmake the class abstract to ensure nobody can create a new BeforeAfterEvent(\"foo\", \"bar\") out of thin air, but has to extend it to use it.\nshorten the name to BeforeAfterEvent - I don't see any good value in explicitly prefixing the \"Abstract\" part, and the inheritance line will read a little bit cleaner\npublic class HealthChangedEvent extends BeforeAfterEvent<Float> { ... }\n\nmake the type of the changed value generic <T>. this allows to reuse the same base class regardless whether the value is an integer, a float, a string, or anything else. However, this implies that we cannot offer the getChange on this base class.", "author": "skaldarnar", "createdAt": "2020-07-23T18:09:31Z", "path": "engine/src/main/java/org/terasology/entitySystem/event/AbstractBeforeAfterEvent.java", "diffHunk": "@@ -0,0 +1,42 @@\n+// Copyright 2020 The Terasology Foundation\n+// SPDX-License-Identifier: Apache-2.0\n+\n+package org.terasology.entitySystem.event;\n+\n+/**\n+ * Immutable event to notify a change in a certain value.\n+ * NOTE: This is a generic event and a more specific Event extending this event should be fired and reacted to.\n+ */\n+public class AbstractBeforeAfterEvent implements Event {", "originalCommit": "332bcde0a18813fa1ec7ac5b30a09a320a8416bf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTcwMzUxOA==", "url": "https://github.com/MovingBlocks/Terasology/pull/4095#discussion_r459703518", "bodyText": "Nope I certainly haven't worked with Generics \ud83d\ude05... And I did absolutely everything wrong I see \ud83d\ude05\nAnd Now the component based alteration effect pr thing  (Class componentClass) makes sense..\nThanks for explaining all this in such great detail!", "author": "ktksan", "createdAt": "2020-07-23T20:17:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTYzNTM2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTc0NTEwMQ==", "url": "https://github.com/MovingBlocks/Terasology/pull/4095#discussion_r459745101", "bodyText": "And I did absolutely everything wrong\n\nThat's not true - basically everything was there, and it made it easy for me to add all those comments about fancy features \ud83d\ude05 I hope you'll learn one thing or the other, and please don't hesitate if you have questions (and please ask about things like Class componentClass if they are unclear \ud83d\ude09 )", "author": "skaldarnar", "createdAt": "2020-07-23T21:43:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTYzNTM2Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTYzNTcyOA==", "url": "https://github.com/MovingBlocks/Terasology/pull/4095#discussion_r459635728", "bodyText": "If the class works with a generic <T> these values become of type T.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private final float oldValue;\n          \n          \n            \n                private final float newValue;\n          \n          \n            \n                protected final T oldValue;\n          \n          \n            \n                protected final T newValue;\n          \n      \n    \n    \n  \n\nIf subclasses should be able to access oldValue and newValue those should be protected instead of private.", "author": "skaldarnar", "createdAt": "2020-07-23T18:10:05Z", "path": "engine/src/main/java/org/terasology/entitySystem/event/AbstractBeforeAfterEvent.java", "diffHunk": "@@ -0,0 +1,42 @@\n+// Copyright 2020 The Terasology Foundation\n+// SPDX-License-Identifier: Apache-2.0\n+\n+package org.terasology.entitySystem.event;\n+\n+/**\n+ * Immutable event to notify a change in a certain value.\n+ * NOTE: This is a generic event and a more specific Event extending this event should be fired and reacted to.\n+ */\n+public class AbstractBeforeAfterEvent implements Event {\n+    private final float oldValue;\n+    private final float newValue;", "originalCommit": "332bcde0a18813fa1ec7ac5b30a09a320a8416bf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTYzNjE1Ng==", "url": "https://github.com/MovingBlocks/Terasology/pull/4095#discussion_r459636156", "bodyText": "Same here:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                AbstractBeforeAfterEvent(float oldValue, float newValue) {\n          \n          \n            \n                AbstractBeforeAfterEvent(final T oldValue, final T newValue) {\n          \n      \n    \n    \n  \n\nWe can also mark them final as we are not going to change them ever in this event.", "author": "skaldarnar", "createdAt": "2020-07-23T18:10:45Z", "path": "engine/src/main/java/org/terasology/entitySystem/event/AbstractBeforeAfterEvent.java", "diffHunk": "@@ -0,0 +1,42 @@\n+// Copyright 2020 The Terasology Foundation\n+// SPDX-License-Identifier: Apache-2.0\n+\n+package org.terasology.entitySystem.event;\n+\n+/**\n+ * Immutable event to notify a change in a certain value.\n+ * NOTE: This is a generic event and a more specific Event extending this event should be fired and reacted to.\n+ */\n+public class AbstractBeforeAfterEvent implements Event {\n+    private final float oldValue;\n+    private final float newValue;\n+\n+    /**\n+     * Creates a new notification event on change in value.\n+     */\n+    AbstractBeforeAfterEvent(float oldValue, float newValue) {", "originalCommit": "332bcde0a18813fa1ec7ac5b30a09a320a8416bf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTY0MTg2MQ==", "url": "https://github.com/MovingBlocks/Terasology/pull/4095#discussion_r459641861", "bodyText": "If we want this convenience functionality you could introduce a\npublic abstract class FloatBeforeAfterEvent extends BeforeAfterEvent<Float> { ... }\nfor this purpose.\nFor calculating the factor you could consider to return infinity in case the old value was zero, something like this (there's a difference between positive and negative infinity, though):\n    public float getFactor() {\n        return oldValue != 0 ? newValue / oldValue : Float.POSITIVE_INFINITY;\n    }", "author": "skaldarnar", "createdAt": "2020-07-23T18:20:51Z", "path": "engine/src/main/java/org/terasology/entitySystem/event/AbstractBeforeAfterEvent.java", "diffHunk": "@@ -0,0 +1,42 @@\n+// Copyright 2020 The Terasology Foundation\n+// SPDX-License-Identifier: Apache-2.0\n+\n+package org.terasology.entitySystem.event;\n+\n+/**\n+ * Immutable event to notify a change in a certain value.\n+ * NOTE: This is a generic event and a more specific Event extending this event should be fired and reacted to.\n+ */\n+public class AbstractBeforeAfterEvent implements Event {\n+    private final float oldValue;\n+    private final float newValue;\n+\n+    /**\n+     * Creates a new notification event on change in value.\n+     */\n+    AbstractBeforeAfterEvent(float oldValue, float newValue) {\n+        this.oldValue = oldValue;\n+        this.newValue = newValue;\n+    }\n+\n+    /**\n+     * Returns the value prior to change.\n+     */\n+    public float getOldValue() {\n+        return oldValue;\n+    }\n+\n+    /**\n+     * Returns the value after change.\n+     */\n+    public float getNewValue() {\n+        return newValue;\n+    }\n+\n+    /**\n+     * Returns the amount by which the value has been changed.\n+     */\n+    public float getChange() {", "originalCommit": "332bcde0a18813fa1ec7ac5b30a09a320a8416bf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTcyMzcxMg==", "url": "https://github.com/MovingBlocks/Terasology/pull/4095#discussion_r459723712", "bodyText": "I see, Again thanks for explaining!\nBut for this PR I don't think we should introduce FloatBeforeAfterEvent just for a getChange/Factor() method...\nThe whole point of using generics I think is we don't need to have separate events for different datatypes..\nSo I think we can leave those separate functionalities to the specific events that extend this event.", "author": "ktksan", "createdAt": "2020-07-23T20:57:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTY0MTg2MQ=="}], "type": "inlineReview"}, {"oid": "d05976eb2ea98ad06742e80e33de6c4c30acae19", "url": "https://github.com/MovingBlocks/Terasology/commit/d05976eb2ea98ad06742e80e33de6c4c30acae19", "message": "Add BeforeAfterEvent", "committedDate": "2020-07-23T21:14:48Z", "type": "commit"}, {"oid": "d05976eb2ea98ad06742e80e33de6c4c30acae19", "url": "https://github.com/MovingBlocks/Terasology/commit/d05976eb2ea98ad06742e80e33de6c4c30acae19", "message": "Add BeforeAfterEvent", "committedDate": "2020-07-23T21:14:48Z", "type": "forcePushed"}]}