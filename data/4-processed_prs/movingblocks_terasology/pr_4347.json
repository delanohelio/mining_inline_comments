{"pr_number": 4347, "pr_title": "build(facades.PC): tidy distribution tasks", "pr_createdAt": "2020-12-29T00:52:30Z", "pr_url": "https://github.com/MovingBlocks/Terasology/pull/4347", "timeline": [{"oid": "99ba7366d6d40aecfa1b0dfc6f6e1cca18914fde", "url": "https://github.com/MovingBlocks/Terasology/commit/99ba7366d6d40aecfa1b0dfc6f6e1cca18914fde", "message": "chore (build): remove unused distModules task", "committedDate": "2020-12-28T19:25:57Z", "type": "commit"}, {"oid": "cec2bf519aedb684c7abbce7fd4a646f3686e583", "url": "https://github.com/MovingBlocks/Terasology/commit/cec2bf519aedb684c7abbce7fd4a646f3686e583", "message": "chore (build): remove RemoteModuleGatherer\n\ngradle is smart enough to put runtime dependencies on the classpath", "committedDate": "2020-12-28T19:31:13Z", "type": "commit"}, {"oid": "5bac6606b32945ec866febb599d78b1c7478dcc4", "url": "https://github.com/MovingBlocks/Terasology/commit/5bac6606b32945ec866febb599d78b1c7478dcc4", "message": "chore (build): remove unnecessary IdeaModel overrides\n\nWhen we have resources for gestalt's asset loader we need to be particular about output directories. But the facade does not register gestalt assets itself.\n\nWe avoid some gradle/intellij build state collisions by not forcing these values.", "committedDate": "2020-12-28T19:38:07Z", "type": "commit"}, {"oid": "d3a6b1a028d8828503f538321160fdea09c9289d", "url": "https://github.com/MovingBlocks/Terasology/commit/d3a6b1a028d8828503f538321160fdea09c9289d", "message": "chore (build): The PC facade gets to be named \"Terasology\"", "committedDate": "2020-12-28T20:12:12Z", "type": "commit"}, {"oid": "79bacf3fa4104907f3aee2e40d1a77ed83597b91", "url": "https://github.com/MovingBlocks/Terasology/commit/79bacf3fa4104907f3aee2e40d1a77ed83597b91", "message": "chore(build): add README, LICENSE, NOTICE, and VERSION files to the main distribution", "committedDate": "2020-12-28T21:14:24Z", "type": "commit"}, {"oid": "87eb506545043ac0ef2c0864254e6bb555ca3093", "url": "https://github.com/MovingBlocks/Terasology/commit/87eb506545043ac0ef2c0864254e6bb555ca3093", "message": "chore(build): refactor createVersionInfoFile to use specific gradle task type", "committedDate": "2020-12-28T23:03:38Z", "type": "commit"}, {"oid": "007cc7459a10144420a6c42b931ce4804c2e69ea", "url": "https://github.com/MovingBlocks/Terasology/commit/007cc7459a10144420a6c42b931ce4804c2e69ea", "message": "chore (build): pass createVersionInfoFile to processResources\n\ninstead of writing to the build state directly. This helps gradle be consistent about which tasks are responsible for which outputs.", "committedDate": "2020-12-29T00:18:35Z", "type": "commit"}, {"oid": "b1ff0bbfdfdee1beabf1c85a292c5635655682a6", "url": "https://github.com/MovingBlocks/Terasology/commit/b1ff0bbfdfdee1beabf1c85a292c5635655682a6", "message": "chore (build): add Credits.md as an engine resource in engine's build, not facade's", "committedDate": "2020-12-29T00:41:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU1NDg5NA==", "url": "https://github.com/MovingBlocks/Terasology/pull/4347#discussion_r549554894", "bodyText": "@Cervator This task had an \"only if $BUILD_URL is set\" condition on it. Is that important to keep? i.e. is a properties file with a bunch of missing entries worse than no properties file at all?", "author": "keturn", "createdAt": "2020-12-29T03:28:01Z", "path": "engine/build.gradle", "diffHunk": "@@ -216,26 +214,31 @@ group = 'org.terasology.engine'\n println \"Version for $project.name loaded as $version for group $group\"\n \n // This version info file actually goes inside the built jar and can be used at runtime\n-task createVersionInfoFile {\n-    inputs.property('dateTime', startDateTimeString)\n-    onlyIf { env.BUILD_URL != null }", "originalCommit": "b1ff0bbfdfdee1beabf1c85a292c5635655682a6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU1NzM2NQ==", "url": "https://github.com/MovingBlocks/Terasology/pull/4347#discussion_r549557365", "bodyText": "So that's the guard that means it normally only runs in Jenkins, which sets the env vars that get read. As for whether an incomplete file is worse than empty - unsure. It might list gibberish in the main menu? The file also gets attached in the open in Jenkins so the launcher can read it, but I'm not sure about the details there", "author": "Cervator", "createdAt": "2020-12-29T03:45:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU1NDg5NA=="}], "type": "inlineReview"}, {"oid": "474faa4243fd52a3868e393e1ccce6e3eeb4978a", "url": "https://github.com/MovingBlocks/Terasology/commit/474faa4243fd52a3868e393e1ccce6e3eeb4978a", "message": "Merge branch 'fix/transient-deps' into chore/tidy-dist-tasks", "committedDate": "2020-12-29T20:34:24Z", "type": "commit"}, {"oid": "e3cb11c481304cb61378160f93e8ae6024845ea2", "url": "https://github.com/MovingBlocks/Terasology/commit/e3cb11c481304cb61378160f93e8ae6024845ea2", "message": "chore(gradle): add some section headers\n\nI think this is a sign that this file is big enough to split up, but that'll make mess of the code review so we'll do that after.", "committedDate": "2020-12-29T21:00:15Z", "type": "commit"}, {"oid": "c14644147048d3746664bc5b5b0e93a8ed172f09", "url": "https://github.com/MovingBlocks/Terasology/commit/c14644147048d3746664bc5b5b0e93a8ed172f09", "message": "Merge branch 'develop' into chore/tidy-dist-tasks", "committedDate": "2021-01-03T01:35:06Z", "type": "commit"}, {"oid": "e4df5d904d8f0d13c5d12f54c4266ada86e9fb9b", "url": "https://github.com/MovingBlocks/Terasology/commit/e4df5d904d8f0d13c5d12f54c4266ada86e9fb9b", "message": "Merge remote-tracking branch 'origin/develop' into chore/tidy-dist-tasks", "committedDate": "2021-01-17T04:39:26Z", "type": "commit"}, {"oid": "61d35c9067b73e6f89bca73b11e23b0daf405e94", "url": "https://github.com/MovingBlocks/Terasology/commit/61d35c9067b73e6f89bca73b11e23b0daf405e94", "message": "doc(build): createVersionTask", "committedDate": "2021-01-17T04:52:21Z", "type": "commit"}, {"oid": "a7e661ba217ccd99fe1aaa051f6e57c64e237362", "url": "https://github.com/MovingBlocks/Terasology/commit/a7e661ba217ccd99fe1aaa051f6e57c64e237362", "message": "refactor (build): move jar task to distribution-related section", "committedDate": "2021-01-17T04:53:37Z", "type": "commit"}, {"oid": "d4ed1827d9e560752626e08a061ec9f0b5ba6f29", "url": "https://github.com/MovingBlocks/Terasology/commit/d4ed1827d9e560752626e08a061ec9f0b5ba6f29", "message": "chore(build): allow createVersionFile to run regardless of environment", "committedDate": "2021-01-17T04:55:26Z", "type": "commit"}, {"oid": "b8b058055a3976a2e2bbf0c5afe051ab0b14a66c", "url": "https://github.com/MovingBlocks/Terasology/commit/b8b058055a3976a2e2bbf0c5afe051ab0b14a66c", "message": "chore (build): name facade's jar Terasology.jar\n\nLauncher invokes it by naming this file, not by class lookup.", "committedDate": "2021-01-17T05:25:01Z", "type": "commit"}, {"oid": "c4c866da27e375f1faebbc8dfd6446db498272af", "url": "https://github.com/MovingBlocks/Terasology/commit/c4c866da27e375f1faebbc8dfd6446db498272af", "message": "refactor (build): move configurations to before dependencies where they're used", "committedDate": "2021-01-17T18:46:43Z", "type": "commit"}, {"oid": "2b8a149cefceaaf99bc0ef273ea1341fa44064e8", "url": "https://github.com/MovingBlocks/Terasology/commit/2b8a149cefceaaf99bc0ef273ea1341fa44064e8", "message": "chore (build): include native libs in distribution", "committedDate": "2021-01-17T19:12:17Z", "type": "commit"}, {"oid": "ffaacc735e3ad1ea1801ffc76f4e7347a3bf7fee", "url": "https://github.com/MovingBlocks/Terasology/commit/ffaacc735e3ad1ea1801ffc76f4e7347a3bf7fee", "message": "chore (build): replace dist tasks\n\nConfigure things so we can take advantage of more of gradle's defaults.", "committedDate": "2021-01-17T19:15:29Z", "type": "commit"}, {"oid": "6f5af62a42025991aab0df9a4b1a70b7d1ec0ff3", "url": "https://github.com/MovingBlocks/Terasology/commit/6f5af62a42025991aab0df9a4b1a70b7d1ec0ff3", "message": "chore (build): remove old facade launch scripts\n\nThe exe versions were unmaintained and gradle provides startup scripts that are much better about compatibility than we were.", "committedDate": "2021-01-17T19:19:05Z", "type": "commit"}, {"oid": "867656f9ffafd100da7d4a9fc60ab43c28edb445", "url": "https://github.com/MovingBlocks/Terasology/commit/867656f9ffafd100da7d4a9fc60ab43c28edb445", "message": "Merge remote-tracking branch 'origin/develop' into chore/tidy-dist-tasks", "committedDate": "2021-01-17T19:19:44Z", "type": "commit"}, {"oid": "806add837c89199a77391a0d51fa5a98eda72a8c", "url": "https://github.com/MovingBlocks/Terasology/commit/806add837c89199a77391a0d51fa5a98eda72a8c", "message": "Merge remote-tracking branch 'origin/develop' into chore/tidy-dist-tasks", "committedDate": "2021-01-17T20:00:11Z", "type": "commit"}, {"oid": "7189173ca1c973b37f75a30a818cb77ee9e57171", "url": "https://github.com/MovingBlocks/Terasology/commit/7189173ca1c973b37f75a30a818cb77ee9e57171", "message": "chore (build): keep jars in \"libs/\" not \"lib/\" in distForLauncher", "committedDate": "2021-01-17T22:37:57Z", "type": "commit"}, {"oid": "bb3c6c161525bc836264f8a75d289b8dd30fe3cb", "url": "https://github.com/MovingBlocks/Terasology/commit/bb3c6c161525bc836264f8a75d289b8dd30fe3cb", "message": "fix (build): do not ignore build output appearing in a source directory\n\nengine:processResources has been adjusted so this file needn't end up there.", "committedDate": "2021-01-17T22:53:11Z", "type": "commit"}, {"oid": "474a312704dfd521819b5c9fff06a9d1cf4dd02a", "url": "https://github.com/MovingBlocks/Terasology/commit/474a312704dfd521819b5c9fff06a9d1cf4dd02a", "message": "chore (build): remove unused var", "committedDate": "2021-01-17T23:06:07Z", "type": "commit"}, {"oid": "a4a966514f22d9cf1ff88fd248d782e9837767f0", "url": "https://github.com/MovingBlocks/Terasology/commit/a4a966514f22d9cf1ff88fd248d782e9837767f0", "message": "chore (build): leave dateTime out of locally-built versionInfo\n\nTo avoid gradle deciding that engine's build is always stale.", "committedDate": "2021-01-18T00:08:03Z", "type": "commit"}, {"oid": "9d84f8ee66ba268d0a49ce48dc8f4287027cf3d8", "url": "https://github.com/MovingBlocks/Terasology/commit/9d84f8ee66ba268d0a49ce48dc8f4287027cf3d8", "message": "Merge remote-tracking branch 'origin/develop' into chore/tidy-dist-tasks", "committedDate": "2021-01-18T00:13:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTI4MDIxOA==", "url": "https://github.com/MovingBlocks/Terasology/pull/4347#discussion_r559280218", "bodyText": "This looks pretty fancy. I trust the comment but have no idea how the magic works.", "author": "Cervator", "createdAt": "2021-01-18T02:04:17Z", "path": "facades/PC/build.gradle.kts", "diffHunk": "@@ -217,103 +239,78 @@ tasks.register<Copy>(\"createVersionFile\") {\n     filter(FixCrLfFilter::class, \"eol\" to FixCrLfFilter.CrLf.newInstance(\"crlf\"))\n }\n \n-// TODO: This could probably be done more Gradley (engine project resource dir instead of direct path?) and with some variables\n-tasks.register<Copy>(\"copyCreditsFile\") {\n-    description = \"Copies the credits file into the engine's resource dir where it'll be read at runtime\"\n-    from(\"$rootDir/docs\")\n-    into(\"$rootDir/engine/src/main/resources\")\n-    include(\"Credits.md\")\n-}\n-\n-// Main application dist target. Does NOT include any modules.\n-tasks.register<Sync>(\"distApp\") {\n-    description = \"Creates an application package for distribution\"\n+tasks.register<Zip>(\"distForLauncher\") {\n     group = \"terasology dist\"\n+    description = \"Bundles the project to a Launcher-compatible layout.\"\n \n-    dependsOn(\"createVersionFile\")\n-    dependsOn(\"copyCreditsFile\")\n-    dependsOn(\":extractNatives\")\n-    dependsOn(\"jar\")\n-\n-    into(\"${distsDirectory.get().asFile}/app\")\n-    from (\"$rootDir/README.markdown\") {\n-        filter(FixCrLfFilter::class, \"eol\" to FixCrLfFilter.CrLf.newInstance(\"crlf\"))\n-        rename(\"README.markdown\", \"README\")\n-    }\n-    from (\"$rootDir/LICENSE\") {\n-        filter(FixCrLfFilter::class, \"eol\" to FixCrLfFilter.CrLf.newInstance(\"crlf\"))\n-    }\n-    from (\"$rootDir/NOTICE\") {\n-        filter(FixCrLfFilter::class, \"eol\" to FixCrLfFilter.CrLf.newInstance(\"crlf\"))\n-    }\n-    from(\"launchScripts\") {\n-        exclude(\"TeraEd.exe\")\n-    }\n-\n-    from(\"$buildDir/$versionFileName\") {}\n+    archiveFileName.set(\"Terasology.zip\")\n \n-    into(subDirLibs) {\n-        from(configurations.runtimeClasspath)\n-        from(tasks.getByPath(\":engine:jar\"))\n-        from(\"$buildDir/libs\") {\n-            include(\"*.jar\")\n-            rename {\n-                \"Terasology.jar\"\n+    // Launcher expects `libs/Terasology.jar`, no containing folder\n+    // TODO: fix launcher so it can take either structure. It should be able to do without ambiguity.\n+    val defaultLibraryDirectory = \"lib\"\n+    val launcherLibraryDirectory = \"libs\"\n+\n+    this.with(distributions.getByName(\"main\").contents {\n+        eachFile {\n+            val pathSegments = relativePath.segments\n+\n+            when (pathSegments[0]) {\n+                defaultLibraryDirectory -> {\n+                    // Redirect things from lib/ to libs/\n+                    val tail = pathSegments.sliceArray(1 until pathSegments.size)", "originalCommit": "9d84f8ee66ba268d0a49ce48dc8f4287027cf3d8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTI5MTIyNg==", "url": "https://github.com/MovingBlocks/Terasology/pull/4347#discussion_r559291226", "bodyText": "I was disappointed with how verbose my Kotlin solution for this was. This\n\n  \n    \n      Terasology/facades/PC/build.gradle.kts\n    \n    \n        Lines 259 to 261\n      in\n      9d84f8e\n    \n    \n    \n    \n\n        \n          \n           // Redirect things from lib/ to libs/ \n        \n\n        \n          \n           val tail = pathSegments.sliceArray(1 until pathSegments.size) \n        \n\n        \n          \n           relativePath = RelativePath(true, launcherLibraryDirectory, *tail) \n        \n    \n  \n\n\nwould be something like this in Python:\nrelativePath = RelativePath(true, launcherLibraryDirectory, *pathSegments[1:])\nbut I didn't figure out a way to do that kind of open-ended slice in Kotlin. I tried just .drop()ing the first segment, but that left me with a List instead of an Array and I seem to need Array to use the spread operator with the varargs argument.", "author": "keturn", "createdAt": "2021-01-18T02:55:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTI4MDIxOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTI4MDI0NA==", "url": "https://github.com/MovingBlocks/Terasology/pull/4347#discussion_r559280244", "bodyText": "I guess this doesn't get in the way of anything? Like runtime hot reloading or stuff like that. Not really sure what this would affect. Assets changing at runtime is one thing but unsure if that'd be affected.", "author": "Cervator", "createdAt": "2021-01-18T02:04:27Z", "path": "facades/PC/build.gradle.kts", "diffHunk": "@@ -69,22 +67,27 @@ val displayVersion = versionBase\n \n \n application {\n+    applicationName = \"Terasology\"\n     mainClass.set(extra.get(\"mainClassName\") as String)\n }\n \n-// Adjust as the Gradle 6 upgrade changed this path a bit\n-sourceSets {", "originalCommit": "9d84f8ee66ba268d0a49ce48dc8f4287027cf3d8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTI4ODg1MA==", "url": "https://github.com/MovingBlocks/Terasology/pull/4347#discussion_r559288850", "bodyText": "facade's sources don't contain any gestalt modules, so we don't have to be as controlling when we build this as we do when we build modules.", "author": "keturn", "createdAt": "2021-01-18T02:44:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTI4MDI0NA=="}], "type": "inlineReview"}, {"oid": "3a678f8135df9e323b45d60c90139c3a401cd455", "url": "https://github.com/MovingBlocks/Terasology/commit/3a678f8135df9e323b45d60c90139c3a401cd455", "message": "chore (build): initial import of start scripts as distributed by gradle\n\nfrom https://github.com/gradle/gradle/tree/f38a522/subprojects/plugins/src/main/resources/org/gradle/api/internal/plugins", "committedDate": "2021-01-19T20:19:09Z", "type": "commit"}, {"oid": "78a4846b23247110e26442effe7c2527222c6923", "url": "https://github.com/MovingBlocks/Terasology/commit/78a4846b23247110e26442effe7c2527222c6923", "message": "chore (build): rename scripts so the syntax highlighting is kinda right\n\nIssue for proper support of this template format is https://youtrack.jetbrains.com/issue/IDEABKL-6135", "committedDate": "2021-01-19T20:22:51Z", "type": "commit"}, {"oid": "01ae5db1f26f48cf0ee614c982d3d99611406f68", "url": "https://github.com/MovingBlocks/Terasology/commit/01ae5db1f26f48cf0ee614c982d3d99611406f68", "message": "fix (build): don't set CLASSPATH in script, use the jar with the classpath in its manifest [Windows]\n\notherwise cmd.exe fails with \"the line is too long\" errors.\nhttps://github.com/gradle/gradle/issues/1989", "committedDate": "2021-01-19T20:27:31Z", "type": "commit"}, {"oid": "957cd1891f9c6f0babd7b218625f50a05ea61680", "url": "https://github.com/MovingBlocks/Terasology/commit/957cd1891f9c6f0babd7b218625f50a05ea61680", "message": "fix (build): clean up after wayword auto-copyright-header-insertion", "committedDate": "2021-01-19T20:46:46Z", "type": "commit"}, {"oid": "5248ea5a945a4aad9c2cf0f5b484dde90159d161", "url": "https://github.com/MovingBlocks/Terasology/commit/5248ea5a945a4aad9c2cf0f5b484dde90159d161", "message": "fix (build): don't set CLASSPATH in script, use the jar with the classpath in its manifest [Unix]\n\nUnix shells have a longer line length limit than cmd.exe, but using the jar manifest will be more consistent with Windows and Launcher.", "committedDate": "2021-01-19T20:49:42Z", "type": "commit"}, {"oid": "5bb9dd4a2d640fb275b833328813c980b2089100", "url": "https://github.com/MovingBlocks/Terasology/commit/5bb9dd4a2d640fb275b833328813c980b2089100", "message": "fix (build): use the jar-classpath start scripts", "committedDate": "2021-01-19T20:57:02Z", "type": "commit"}, {"oid": "ec9691fa2bede56d43aa37e230056bd20aa57eed", "url": "https://github.com/MovingBlocks/Terasology/commit/ec9691fa2bede56d43aa37e230056bd20aa57eed", "message": "Merge remote-tracking branch 'origin/develop' into chore/tidy-dist-tasks", "committedDate": "2021-01-19T21:01:29Z", "type": "commit"}, {"oid": "1afeec9df306df29bf17d0cf7ad0ccb0bda297a6", "url": "https://github.com/MovingBlocks/Terasology/commit/1afeec9df306df29bf17d0cf7ad0ccb0bda297a6", "message": "chore (build): correct reference to upstream", "committedDate": "2021-01-19T21:12:23Z", "type": "commit"}, {"oid": "15a8c93b44eaacb74e8b0b6d4279ebf63dc3fd85", "url": "https://github.com/MovingBlocks/Terasology/commit/15a8c93b44eaacb74e8b0b6d4279ebf63dc3fd85", "message": "Merge remote-tracking branch 'origin/develop' into chore/tidy-dist-tasks\n\n# Conflicts:\n#\tengine/build.gradle", "committedDate": "2021-01-29T21:51:49Z", "type": "commit"}, {"oid": "14565ece2112a361a7df21078b06a553321b6d26", "url": "https://github.com/MovingBlocks/Terasology/commit/14565ece2112a361a7df21078b06a553321b6d26", "message": "chore (build): remove unused variables (post-merge clean-up)", "committedDate": "2021-01-29T22:04:23Z", "type": "commit"}, {"oid": "d476cd6232b45dc0dab5014fa382697edb8188d4", "url": "https://github.com/MovingBlocks/Terasology/commit/d476cd6232b45dc0dab5014fa382697edb8188d4", "message": "fix (build): merge clean-up", "committedDate": "2021-01-30T00:50:47Z", "type": "commit"}, {"oid": "6b7694a7085bbcf73eb9900bdb20093ea89fd79d", "url": "https://github.com/MovingBlocks/Terasology/commit/6b7694a7085bbcf73eb9900bdb20093ea89fd79d", "message": "chore (build): gradle 6.7 \u2192 6.8.1", "committedDate": "2021-01-30T00:57:07Z", "type": "commit"}, {"oid": "b23dc19c6ee6c309fc2c27e3a316e8372623f240", "url": "https://github.com/MovingBlocks/Terasology/commit/b23dc19c6ee6c309fc2c27e3a316e8372623f240", "message": "fix (build): jar.version property deprecated by gradle\n\nand was probably accidental in the first place", "committedDate": "2021-01-30T01:01:53Z", "type": "commit"}, {"oid": "a2533e00448a9ca3a391d02923af99ca98fe59b8", "url": "https://github.com/MovingBlocks/Terasology/commit/a2533e00448a9ca3a391d02923af99ca98fe59b8", "message": "Merge branch 'chore/gradle-68' into chore/tidy-dist-tasks", "committedDate": "2021-01-30T01:11:28Z", "type": "commit"}, {"oid": "73888474d0a28a36ef63d19b1711d381b328e19e", "url": "https://github.com/MovingBlocks/Terasology/commit/73888474d0a28a36ef63d19b1711d381b328e19e", "message": "test(build): add testDistForLauncher and testDistZip\n\nSome checks to make sure files end up where they are expected.", "committedDate": "2021-01-30T04:27:02Z", "type": "commit"}, {"oid": "1d9d8aacf5777e87512cf2df55d810829bc2ea22", "url": "https://github.com/MovingBlocks/Terasology/commit/1d9d8aacf5777e87512cf2df55d810829bc2ea22", "message": "fix(build): keep start scripts inside distZip's root directory", "committedDate": "2021-01-30T04:39:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NzE5NzQxMA==", "url": "https://github.com/MovingBlocks/Terasology/pull/4347#discussion_r567197410", "bodyText": "That's not pretty.\nWe're using precompiled script plugins to cut down on the amount of config we have to use. It sets the gradle plugin name nicely, but this import path is gross. I wonder if that's something we can change without giving up its convenience.\nOr is there a way we can have our Task class auto-imported like the core gradle Tasks seem to be?", "author": "keturn", "createdAt": "2021-01-30T04:48:51Z", "path": "facades/PC/build.gradle.kts", "diffHunk": "@@ -3,14 +3,15 @@\n \n // The PC facade is responsible for the primary distribution - a plain Java application runnable on PCs\n \n+import Terasology_dist_gradle.ValidateZipDistribution", "originalCommit": "1d9d8aacf5777e87512cf2df55d810829bc2ea22", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NzIwMTU3Nw==", "url": "https://github.com/MovingBlocks/Terasology/pull/4347#discussion_r567201577", "bodyText": "hmm. not seeing much to do about this. I can put a namespace in front of it like org.terasology.foo. but it still involves that _gradle part.\nI'm inclined to leave it be until we get to the point where we're packaging our gradle plugins for distribution for use outside this multiproject.", "author": "keturn", "createdAt": "2021-01-30T05:35:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NzE5NzQxMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2ODM4NjE1NQ==", "url": "https://github.com/MovingBlocks/Terasology/pull/4347#discussion_r568386155", "bodyText": "try @JvmName", "author": "keturn", "createdAt": "2021-02-02T07:50:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NzE5NzQxMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2ODkyNDAzOA==", "url": "https://github.com/MovingBlocks/Terasology/pull/4347#discussion_r568924038", "bodyText": "hmm, will try later, not worth changing generated filenames at this point in the PR, as we already have another PR waiting on this one.", "author": "keturn", "createdAt": "2021-02-02T20:55:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NzE5NzQxMA=="}], "type": "inlineReview"}, {"oid": "1de903aff4163322dae0fc44b8f4a8711b60b730", "url": "https://github.com/MovingBlocks/Terasology/commit/1de903aff4163322dae0fc44b8f4a8711b60b730", "message": "Merge branch 'develop' into chore/gradle-68", "committedDate": "2021-01-30T09:34:20Z", "type": "commit"}, {"oid": "0e82184408ae6f49c66c44f9915aba93d2ec5d34", "url": "https://github.com/MovingBlocks/Terasology/commit/0e82184408ae6f49c66c44f9915aba93d2ec5d34", "message": "fix(build): use .flatMap to unwrap Provider<Provider<>>\n\nas recommended by https://discuss.gradle.org/t/un-nesting-provider-provider/38904", "committedDate": "2021-01-30T17:49:18Z", "type": "commit"}, {"oid": "4402383b57ae869e46fd3ff8d028d05eb3087e89", "url": "https://github.com/MovingBlocks/Terasology/commit/4402383b57ae869e46fd3ff8d028d05eb3087e89", "message": "Merge remote-tracking branch 'origin/develop' into chore/tidy-dist-tasks", "committedDate": "2021-01-30T17:49:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NzMwMTY1MA==", "url": "https://github.com/MovingBlocks/Terasology/pull/4347#discussion_r567301650", "bodyText": "It would be worthwhile to add a bit of documentation for this Task subclass.", "author": "keturn", "createdAt": "2021-01-30T19:24:38Z", "path": "buildSrc/src/main/kotlin/terasology-dist.gradle.kts", "diffHunk": "@@ -0,0 +1,40 @@\n+// Copyright 2021 The Terasology Foundation\n+// SPDX-License-Identifier: Apache-2.0\n+\n+@Suppress(\"UnstableApiUsage\")\n+open class ValidateZipDistribution @Inject constructor(objects: ObjectFactory) : DefaultTask() {", "originalCommit": "4402383b57ae869e46fd3ff8d028d05eb3087e89", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "c2cdbdd52c83cd6cdb6831230072993174254e98", "url": "https://github.com/MovingBlocks/Terasology/commit/c2cdbdd52c83cd6cdb6831230072993174254e98", "message": "doc(build): document ValidateZipDistribution class", "committedDate": "2021-01-31T20:17:18Z", "type": "commit"}, {"oid": "50dee4eda909b8d82b8b5e43a5f12d32e5988ea5", "url": "https://github.com/MovingBlocks/Terasology/commit/50dee4eda909b8d82b8b5e43a5f12d32e5988ea5", "message": "Merge remote-tracking branch 'origin/develop' into chore/tidy-dist-tasks", "committedDate": "2021-01-31T20:17:51Z", "type": "commit"}, {"oid": "e61978ba41555180f33582dc378e29869582f1cf", "url": "https://github.com/MovingBlocks/Terasology/commit/e61978ba41555180f33582dc378e29869582f1cf", "message": "Merge branch 'develop' into chore/tidy-dist-tasks", "committedDate": "2021-02-02T08:41:25Z", "type": "commit"}, {"oid": "de53ea48c3b544ced66038b4afbfac935378128a", "url": "https://github.com/MovingBlocks/Terasology/commit/de53ea48c3b544ced66038b4afbfac935378128a", "message": "Merge branch 'develop' into chore/gradle-68", "committedDate": "2021-02-02T18:08:50Z", "type": "commit"}, {"oid": "1aba539c65e0c22bce7f22238ba12f2f9750075f", "url": "https://github.com/MovingBlocks/Terasology/commit/1aba539c65e0c22bce7f22238ba12f2f9750075f", "message": "Merge remote-tracking branch 'origin/develop' into chore/gradle-68", "committedDate": "2021-02-02T20:39:20Z", "type": "commit"}, {"oid": "1f98da6834703dd3b33839a789e8c1c8d53ec367", "url": "https://github.com/MovingBlocks/Terasology/commit/1f98da6834703dd3b33839a789e8c1c8d53ec367", "message": "Merge branch 'chore/gradle-68' into chore/tidy-dist-tasks", "committedDate": "2021-02-02T20:40:35Z", "type": "commit"}, {"oid": "512e8cfe201c98a494ea965a542024b2ccf307d2", "url": "https://github.com/MovingBlocks/Terasology/commit/512e8cfe201c98a494ea965a542024b2ccf307d2", "message": "build(PC): get access to kotlin.test as api dependency instead of explicit delegation", "committedDate": "2021-02-02T21:09:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2OTY3MjMwNQ==", "url": "https://github.com/MovingBlocks/Terasology/pull/4347#discussion_r569672305", "bodyText": "#4454 (comment)\nGIT_BRANCH no longer used for this", "author": "keturn", "createdAt": "2021-02-03T19:05:44Z", "path": "facades/PC/build.gradle.kts", "diffHunk": "@@ -200,12 +200,41 @@ tasks.register<JavaExec>(\"server\") {\n     args(\"-headless\", \"-homedir=$localServerDataPath\")\n }\n \n-// Preps a version file to bundle with PC dists. This eventually goes into the root of a zip file\n-tasks.register<Copy>(\"createVersionFile\") {\n+\n+/*********************************\n+ * Distribution\n+ *\n+ * See also publish.gradle, included near the top.\n+ */\n+\n+tasks.named<Jar>(\"jar\") {\n+    // Launcher expects the main class to be in the file with this name.\n+    archiveFileName.set(\"Terasology.jar\")\n+\n+    manifest {\n+        //TODO: Maybe later add the engine's version number into here?\n+        attributes[\"Main-Class\"] = mainClassName\n+        // A classpath in the manifest avoids the problem of having to put a classpath on the command line and\n+        // \"line is too long\" errors: https://github.com/gradle/gradle/issues/1989\n+        attributes[\"Class-Path\"] = configurations[\"runtimeClasspath\"].joinToString(\" \") { it.name }\n+        attributes[\"Implementation-Title\"] = \"Terasology-\" + project.name\n+        attributes[\"Implementation-Version\"] = \"\"\"${env[\"BUILD_NUMBER\"]}, ${env[\"GIT_BRANCH\"]}, ${env[\"BUILD_ID\"]}\"\"\"", "originalCommit": "512e8cfe201c98a494ea965a542024b2ccf307d2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "5087712c3aef40202ed595df4e34bcf0ef764156", "url": "https://github.com/MovingBlocks/Terasology/commit/5087712c3aef40202ed595df4e34bcf0ef764156", "message": "Merge remote-tracking branch 'origin/develop' into chore/gradle-68", "committedDate": "2021-02-03T19:13:29Z", "type": "commit"}, {"oid": "683e8ca77a04f8b1415f2da3e243958ea2980dd1", "url": "https://github.com/MovingBlocks/Terasology/commit/683e8ca77a04f8b1415f2da3e243958ea2980dd1", "message": "Merge branch 'chore/gradle-68' into chore/tidy-dist-tasks", "committedDate": "2021-02-03T19:13:50Z", "type": "commit"}, {"oid": "976b0ac976cdd48d6cef9b3624bcf13023b7df70", "url": "https://github.com/MovingBlocks/Terasology/commit/976b0ac976cdd48d6cef9b3624bcf13023b7df70", "message": "CI: include testDist task", "committedDate": "2021-02-03T19:17:39Z", "type": "commit"}, {"oid": "6e51e06713cc69b23b6c08992bd25fbdd0446f2c", "url": "https://github.com/MovingBlocks/Terasology/commit/6e51e06713cc69b23b6c08992bd25fbdd0446f2c", "message": "build(PC): GIT_BRANCH is no longer used for build information", "committedDate": "2021-02-03T19:32:08Z", "type": "commit"}]}