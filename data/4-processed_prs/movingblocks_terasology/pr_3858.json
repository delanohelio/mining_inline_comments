{"pr_number": 3858, "pr_title": "Modified search to show if an asset is broken", "pr_createdAt": "2020-03-16T22:10:01Z", "pr_url": "https://github.com/MovingBlocks/Terasology/pull/3858", "timeline": [{"oid": "b6f2ab25a14c6f87a65408b604eb3601f58e4651", "url": "https://github.com/MovingBlocks/Terasology/commit/b6f2ab25a14c6f87a65408b604eb3601f58e4651", "message": "modified asset search", "committedDate": "2020-03-16T22:02:46Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTM4ODY3OQ==", "url": "https://github.com/MovingBlocks/Terasology/pull/3858#discussion_r395388679", "bodyText": "One of our style rules is to avoid star imports. IntelliJ defaults to using them however.\nYou'll need to go into settings and change the number of imports required before a star is used up to 99. It's pain that we can't automatically do that at the moment but oh well", "author": "syntaxi", "createdAt": "2020-03-20T00:20:48Z", "path": "engine/src/main/java/org/terasology/logic/console/commands/CoreCommands.java", "diffHunk": "@@ -83,15 +84,10 @@\n \n import java.io.IOException;\n import java.net.UnknownHostException;\n+import java.util.*;", "originalCommit": "b6f2ab25a14c6f87a65408b604eb3601f58e4651", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTM4OTA5Nw==", "url": "https://github.com/MovingBlocks/Terasology/pull/3858#discussion_r395389097", "bodyText": "We try and have all variables have useful names, even if they're not used much. Here I'd suggest something like matchingBlocks or even just outputList", "author": "syntaxi", "createdAt": "2020-03-20T00:22:41Z", "path": "engine/src/main/java/org/terasology/logic/console/commands/CoreCommands.java", "diffHunk": "@@ -253,10 +249,29 @@ public String search(@CommandParam(\"searched\") String searched) {\n      * @return List of blocks that match searched string\n      */\n     private List<String> findBlockMatches(String searchLowercase) {\n-        return assetManager.getAvailableAssets(BlockFamilyDefinition.class)\n-                .stream().<Optional<BlockFamilyDefinition>>map(urn -> assetManager.getAsset(urn, BlockFamilyDefinition.class))\n-                .filter(def -> def.isPresent() && def.get().isLoadable() && matchesSearch(searchLowercase, def.get()))\n-                .map(r -> new BlockUri(r.get().getUrn()).toString()).collect(Collectors.toList());\n+        ResourceUrn curUrn;\n+        List<String> l=new ArrayList<String>();", "originalCommit": "b6f2ab25a14c6f87a65408b604eb3601f58e4651", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTc0NTQ4Mg==", "url": "https://github.com/MovingBlocks/Terasology/pull/3858#discussion_r395745482", "bodyText": "Fixed! Will keep this in mind from now on .", "author": "vedant-shroff", "createdAt": "2020-03-20T16:17:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTM4OTA5Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTM4OTI3NA==", "url": "https://github.com/MovingBlocks/Terasology/pull/3858#discussion_r395389274", "bodyText": "See my above comment about naming. (Although this variable could easily be joined with the following line", "author": "syntaxi", "createdAt": "2020-03-20T00:23:21Z", "path": "engine/src/main/java/org/terasology/logic/console/commands/CoreCommands.java", "diffHunk": "@@ -253,10 +249,29 @@ public String search(@CommandParam(\"searched\") String searched) {\n      * @return List of blocks that match searched string\n      */\n     private List<String> findBlockMatches(String searchLowercase) {\n-        return assetManager.getAvailableAssets(BlockFamilyDefinition.class)\n-                .stream().<Optional<BlockFamilyDefinition>>map(urn -> assetManager.getAsset(urn, BlockFamilyDefinition.class))\n-                .filter(def -> def.isPresent() && def.get().isLoadable() && matchesSearch(searchLowercase, def.get()))\n-                .map(r -> new BlockUri(r.get().getUrn()).toString()).collect(Collectors.toList());\n+        ResourceUrn curUrn;\n+        List<String> l=new ArrayList<String>();\n+        for (ResourceUrn urn : assetManager.getAvailableAssets(BlockFamilyDefinition.class)) {\n+            // Current urn for logging purposes to find the broken urn\n+            curUrn = urn;\n+            try{\n+                Optional<BlockFamilyDefinition> def = assetManager.getAsset(urn, BlockFamilyDefinition.class);\n+                if (def.isPresent() && def.get().isLoadable() && matchesSearch(searchLowercase, def.get())) {\n+                    String s = new BlockUri(def.get().getUrn()).toString();", "originalCommit": "b6f2ab25a14c6f87a65408b604eb3601f58e4651", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTM4OTYxMg==", "url": "https://github.com/MovingBlocks/Terasology/pull/3858#discussion_r395389612", "bodyText": "Would it be possible to instead of returning here, to just keep looping through the for block?\nThat way the broken assets will be skipped but the rest of the command will still work and the printing will still work.", "author": "syntaxi", "createdAt": "2020-03-20T00:24:49Z", "path": "engine/src/main/java/org/terasology/logic/console/commands/CoreCommands.java", "diffHunk": "@@ -253,10 +249,29 @@ public String search(@CommandParam(\"searched\") String searched) {\n      * @return List of blocks that match searched string\n      */\n     private List<String> findBlockMatches(String searchLowercase) {\n-        return assetManager.getAvailableAssets(BlockFamilyDefinition.class)\n-                .stream().<Optional<BlockFamilyDefinition>>map(urn -> assetManager.getAsset(urn, BlockFamilyDefinition.class))\n-                .filter(def -> def.isPresent() && def.get().isLoadable() && matchesSearch(searchLowercase, def.get()))\n-                .map(r -> new BlockUri(r.get().getUrn()).toString()).collect(Collectors.toList());\n+        ResourceUrn curUrn;\n+        List<String> l=new ArrayList<String>();\n+        for (ResourceUrn urn : assetManager.getAvailableAssets(BlockFamilyDefinition.class)) {\n+            // Current urn for logging purposes to find the broken urn\n+            curUrn = urn;\n+            try{\n+                Optional<BlockFamilyDefinition> def = assetManager.getAsset(urn, BlockFamilyDefinition.class);\n+                if (def.isPresent() && def.get().isLoadable() && matchesSearch(searchLowercase, def.get())) {\n+                    String s = new BlockUri(def.get().getUrn()).toString();\n+                    l.add(s);\n+                }\n+            }\n+            // If a prefab is broken , it will throw an exception\n+            catch(Exception e){\n+                List<String> EmptyList=new ArrayList<String>();\n+                console.addMessage(\"Note : Search may not return results if invalid assets are present\");\n+                console.addMessage(\"Error parsing : \"+curUrn.toString());\n+                console.addMessage(e.toString());\n+                return(EmptyList);", "originalCommit": "b6f2ab25a14c6f87a65408b604eb3601f58e4651", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTY1Nzk5NQ==", "url": "https://github.com/MovingBlocks/Terasology/pull/3858#discussion_r395657995", "bodyText": "Good idea, Sorry for not implementing this initially , it was on my mind but I forgot about it once I was done with the functionality . This is the new output after this change.", "author": "vedant-shroff", "createdAt": "2020-03-20T14:04:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTM4OTYxMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTM5MDA3Ng==", "url": "https://github.com/MovingBlocks/Terasology/pull/3858#discussion_r395390076", "bodyText": "The cleanup of the method is appreciated, but this line seems like it has just been removed. Is it actually not needed, because it looks like it's used in spawning the prefab.", "author": "syntaxi", "createdAt": "2020-03-20T00:26:41Z", "path": "engine/src/main/java/org/terasology/logic/console/commands/CoreCommands.java", "diffHunk": "@@ -523,17 +538,16 @@ public String spawnPrefab(@Sender EntityRef sender, @CommandParam(\"prefabId\") St\n         } else {\n             dir.set(Direction.FORWARD.getVector3f());\n         }\n-        Quat4f rotation = Quat4f.shortestArcQuat(Direction.FORWARD.getVector3f(), dir);", "originalCommit": "b6f2ab25a14c6f87a65408b604eb3601f58e4651", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTY1NTc0NA==", "url": "https://github.com/MovingBlocks/Terasology/pull/3858#discussion_r395655744", "bodyText": "Fixed , Turns out I was using a slightly older branch which had an outdated version of this method , have replaced it with the correct implementation along with other changes", "author": "vedant-shroff", "createdAt": "2020-03-20T14:01:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTM5MDA3Ng=="}], "type": "inlineReview"}, {"oid": "86e5a9f4a2e899115ed01634f4a5abf2fe7bfdd7", "url": "https://github.com/MovingBlocks/Terasology/commit/86e5a9f4a2e899115ed01634f4a5abf2fe7bfdd7", "message": "made required changes to search", "committedDate": "2020-03-20T13:58:06Z", "type": "commit"}, {"oid": "e417b18b83cb5595033880257124fff637c80eef", "url": "https://github.com/MovingBlocks/Terasology/commit/e417b18b83cb5595033880257124fff637c80eef", "message": "minor code cleanup to search", "committedDate": "2020-03-20T13:59:37Z", "type": "commit"}]}