{"pr_number": 4199, "pr_title": "fix(nui): `InputSettings:onClose` out-of-bounds crash", "pr_createdAt": "2020-10-13T17:39:53Z", "pr_url": "https://github.com/MovingBlocks/Terasology/pull/4199", "timeline": [{"oid": "71ffc90d052f634f48c31a3bcf11ca9e31c84177", "url": "https://github.com/MovingBlocks/Terasology/commit/71ffc90d052f634f48c31a3bcf11ca9e31c84177", "message": "fix(nui): `InputSettings:onClose` out-of-bounds crash\n\n- previously if any of the `getBinds()` calls returned a non-null but empty list, the game would crash due to an out-of-bounds error", "committedDate": "2020-10-13T17:37:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDE0MDM0NQ==", "url": "https://github.com/MovingBlocks/Terasology/pull/4199#discussion_r504140345", "bodyText": "That's the actual fix, the rest is simply formatting.\nAn alternative here would be to return null. I chose to do nothing instead as there might've been a valid configuration before.", "author": "jdrueckert", "createdAt": "2020-10-13T17:40:49Z", "path": "engine/src/main/java/org/terasology/rendering/nui/layers/mainMenu/inputSettings/InputSettingsScreen.java", "diffHunk": "@@ -307,9 +317,18 @@ public void onClosed() {\n         bindsManager.registerBinds();\n \n         // TODO: Find a better place to do this in.\n-        TabbingManager.tabForwardInput = bindsManager.getBindsConfig().getBinds(new SimpleUri(\"engine:tabbingUI\")).get(0);\n-        TabbingManager.tabBackInputModifier = bindsManager.getBindsConfig().getBinds(new SimpleUri(\"engine:tabbingModifier\")).get(0);\n-        TabbingManager.activateInput = bindsManager.getBindsConfig().getBinds(new SimpleUri(\"engine:activate\")).get(0);\n+        BindsConfig bindsConf = bindsManager.getBindsConfig();\n+        if (bindsConf != null) {\n+            bindsConf.getBinds(new SimpleUri(\"engine:tabbingUI\")).stream().findFirst().ifPresent(input -> {\n+                TabbingManager.tabForwardInput = input;\n+            });\n+            bindsConf.getBinds(new SimpleUri(\"engine:tabbingModifier\")).stream().findFirst().ifPresent(input -> {\n+                TabbingManager.tabBackInputModifier = input;\n+            });\n+            bindsConf.getBinds(new SimpleUri(\"engine:activate\")).stream().findFirst().ifPresent(input -> {\n+                TabbingManager.activateInput = input;\n+            });\n+        }", "originalCommit": "71ffc90d052f634f48c31a3bcf11ca9e31c84177", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDE1Mjk5OQ==", "url": "https://github.com/MovingBlocks/Terasology/pull/4199#discussion_r504152999", "bodyText": "We talked about this offline -\u202fit's not clear to neither of us what the semantic operation here is. Is it \"reset\" to default values? What should happen if there is no value in the binding config?\nAs @jdrueckert said this will do nothing in case the binding list is empty. An alternative would be to explicitly set the input to null. I don't know who can make this call - @BenjaminAmos ?\nbindsConf.getBinds(new SimpleUri(\"engine:tabbingUI\")).stream().findFirst().orElse(null)", "author": "skaldarnar", "createdAt": "2020-10-13T18:02:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDE0MDM0NQ=="}], "type": "inlineReview"}]}