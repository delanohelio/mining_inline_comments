{"pr_number": 3841, "pr_title": "feat: improve 'playerHeight' command", "pr_createdAt": "2020-03-03T13:30:36Z", "pr_url": "https://github.com/MovingBlocks/Terasology/pull/3841", "timeline": [{"oid": "5212bad83f1437d495cd77a2cf826c3d84ff14cd", "url": "https://github.com/MovingBlocks/Terasology/commit/5212bad83f1437d495cd77a2cf826c3d84ff14cd", "message": "implements height change extras and fixes bugs", "committedDate": "2020-03-03T05:54:49Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTUzNzg3MQ==", "url": "https://github.com/MovingBlocks/Terasology/pull/3841#discussion_r395537871", "bodyText": "See: https://github.com/MovingBlocks/Terasology/wiki/Common-Style-Points#starred-imports", "author": "syntaxi", "createdAt": "2020-03-20T10:05:21Z", "path": "engine/src/main/java/org/terasology/logic/debug/MovementDebugCommands.java", "diffHunk": "@@ -18,12 +18,8 @@\n import org.terasology.entitySystem.entity.EntityManager;\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n-import org.terasology.logic.characters.CharacterImpulseEvent;\n+import org.terasology.logic.characters.*;", "originalCommit": "5212bad83f1437d495cd77a2cf826c3d84ff14cd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTUzODE0Mw==", "url": "https://github.com/MovingBlocks/Terasology/pull/3841#discussion_r395538143", "bodyText": "See: https://github.com/MovingBlocks/Terasology/wiki/Common-Style-Points#descriptive-variable-names", "author": "syntaxi", "createdAt": "2020-03-20T10:05:51Z", "path": "engine/src/main/java/org/terasology/logic/debug/MovementDebugCommands.java", "diffHunk": "@@ -233,22 +231,44 @@ public String stepHeight(@Sender EntityRef client, @CommandParam(\"height\") float\n         return \"\";\n     }\n \n+    private float function1(float parameter){", "originalCommit": "5212bad83f1437d495cd77a2cf826c3d84ff14cd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQ4MTkyMA==", "url": "https://github.com/MovingBlocks/Terasology/pull/3841#discussion_r400481920", "bodyText": "Indeed, please use a descriptive name here. What is this function doing? What to the numbers mean?", "author": "skaldarnar", "createdAt": "2020-03-30T20:44:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTUzODE0Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQ4MjgzOQ==", "url": "https://github.com/MovingBlocks/Terasology/pull/3841#discussion_r400482839", "bodyText": "What's the reason to cast between float and doubles here? Wouldn't the following work?\nprivate double calculateSomething(double p) {\n    return pow(p, 0.6) * 0.78;\n}\nI guess this could even be inlined.", "author": "skaldarnar", "createdAt": "2020-03-30T20:45:55Z", "path": "engine/src/main/java/org/terasology/logic/debug/MovementDebugCommands.java", "diffHunk": "@@ -233,22 +231,44 @@ public String stepHeight(@Sender EntityRef client, @CommandParam(\"height\") float\n         return \"\";\n     }\n \n+    private float function1(float parameter){\n+        double p = (double)parameter;\n+        return (float) pow(p,0.6) * 0.78f ;", "originalCommit": "5212bad83f1437d495cd77a2cf826c3d84ff14cd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjA3NTU4MA==", "url": "https://github.com/MovingBlocks/Terasology/pull/3841#discussion_r402075580", "bodyText": "The values returned from the functions are assigned to float variables.Hence the cast", "author": "godfather2", "createdAt": "2020-04-02T06:20:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQ4MjgzOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQ4MzE4MA==", "url": "https://github.com/MovingBlocks/Terasology/pull/3841#discussion_r400483180", "bodyText": "Same here, please use a better name for the method.", "author": "skaldarnar", "createdAt": "2020-03-30T20:46:31Z", "path": "engine/src/main/java/org/terasology/logic/debug/MovementDebugCommands.java", "diffHunk": "@@ -233,22 +231,44 @@ public String stepHeight(@Sender EntityRef client, @CommandParam(\"height\") float\n         return \"\";\n     }\n \n+    private float function1(float parameter){\n+        double p = (double)parameter;\n+        return (float) pow(p,0.6) * 0.78f ;\n+    }\n+\n+    private float function2(float parameter){", "originalCommit": "5212bad83f1437d495cd77a2cf826c3d84ff14cd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQ4NDE5OQ==", "url": "https://github.com/MovingBlocks/Terasology/pull/3841#discussion_r400484199", "bodyText": "This can be replaced by a reference to clientComp which is retrieved in the first line of this try-catch block.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        EntityRef player = client.getComponent(ClientComponent.class).character;\n          \n          \n            \n                        EntityRef player = clientComp.character;", "author": "skaldarnar", "createdAt": "2020-03-30T20:48:25Z", "path": "engine/src/main/java/org/terasology/logic/debug/MovementDebugCommands.java", "diffHunk": "@@ -233,22 +231,44 @@ public String stepHeight(@Sender EntityRef client, @CommandParam(\"height\") float\n         return \"\";\n     }\n \n+    private float function1(float parameter){\n+        double p = (double)parameter;\n+        return (float) pow(p,0.6) * 0.78f ;\n+    }\n+\n+    private float function2(float parameter){\n+       return 0.15f + (0.64f * parameter) - (0.006f * parameter * parameter);\n+    }\n+\n     @Command(shortDescription = \"Sets the height of the player\", runOnServer = true,\n             requiredPermission = PermissionManager.CHEAT_PERMISSION)\n     public String playerHeight(@Sender EntityRef client, @CommandParam(\"height\") float amount) {\n         try {\n             ClientComponent clientComp = client.getComponent(ClientComponent.class);\n             CharacterMovementComponent move = clientComp.character.getComponent(CharacterMovementComponent.class);\n-            if (move != null) {\n+            CharacterComponent charComp=clientComp.character.getComponent(CharacterComponent.class);\n+            EntityRef player = client.getComponent(ClientComponent.class).character;", "originalCommit": "5212bad83f1437d495cd77a2cf826c3d84ff14cd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQ4NDc5Ng==", "url": "https://github.com/MovingBlocks/Terasology/pull/3841#discussion_r400484796", "bodyText": "What constant is calculated based off the height (amount)? Is it the eye level or something like that?", "author": "skaldarnar", "createdAt": "2020-03-30T20:49:22Z", "path": "engine/src/main/java/org/terasology/logic/debug/MovementDebugCommands.java", "diffHunk": "@@ -233,22 +231,44 @@ public String stepHeight(@Sender EntityRef client, @CommandParam(\"height\") float\n         return \"\";\n     }\n \n+    private float function1(float parameter){\n+        double p = (double)parameter;\n+        return (float) pow(p,0.6) * 0.78f ;\n+    }\n+\n+    private float function2(float parameter){\n+       return 0.15f + (0.64f * parameter) - (0.006f * parameter * parameter);\n+    }\n+\n     @Command(shortDescription = \"Sets the height of the player\", runOnServer = true,\n             requiredPermission = PermissionManager.CHEAT_PERMISSION)\n     public String playerHeight(@Sender EntityRef client, @CommandParam(\"height\") float amount) {\n         try {\n             ClientComponent clientComp = client.getComponent(ClientComponent.class);\n             CharacterMovementComponent move = clientComp.character.getComponent(CharacterMovementComponent.class);\n-            if (move != null) {\n+            CharacterComponent charComp=clientComp.character.getComponent(CharacterComponent.class);\n+            EntityRef player = client.getComponent(ClientComponent.class).character;\n+            GazeMountPointComponent gazeMountPointComponent = player.getComponent(GazeMountPointComponent.class);\n+\n+            float ratio = amount / 1.6f;\n+            float constant= function1(amount);", "originalCommit": "5212bad83f1437d495cd77a2cf826c3d84ff14cd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQ4NjQwMA==", "url": "https://github.com/MovingBlocks/Terasology/pull/3841#discussion_r400486400", "bodyText": "If function2 computes the run factor (whatever that is) you could call it getRunFactor instead.", "author": "skaldarnar", "createdAt": "2020-03-30T20:52:23Z", "path": "engine/src/main/java/org/terasology/logic/debug/MovementDebugCommands.java", "diffHunk": "@@ -233,22 +231,44 @@ public String stepHeight(@Sender EntityRef client, @CommandParam(\"height\") float\n         return \"\";\n     }\n \n+    private float function1(float parameter){\n+        double p = (double)parameter;\n+        return (float) pow(p,0.6) * 0.78f ;\n+    }\n+\n+    private float function2(float parameter){\n+       return 0.15f + (0.64f * parameter) - (0.006f * parameter * parameter);\n+    }\n+\n     @Command(shortDescription = \"Sets the height of the player\", runOnServer = true,\n             requiredPermission = PermissionManager.CHEAT_PERMISSION)\n     public String playerHeight(@Sender EntityRef client, @CommandParam(\"height\") float amount) {\n         try {\n             ClientComponent clientComp = client.getComponent(ClientComponent.class);\n             CharacterMovementComponent move = clientComp.character.getComponent(CharacterMovementComponent.class);\n-            if (move != null) {\n+            CharacterComponent charComp=clientComp.character.getComponent(CharacterComponent.class);\n+            EntityRef player = client.getComponent(ClientComponent.class).character;\n+            GazeMountPointComponent gazeMountPointComponent = player.getComponent(GazeMountPointComponent.class);\n+\n+            float ratio = amount / 1.6f;\n+            float constant= function1(amount);\n+\n+            if (move != null && gazeMountPointComponent != null) {\n                 float prevHeight = move.height;\n+\n                 move.height = amount;\n+                gazeMountPointComponent.translate.y = amount;\n+                move.jumpSpeed = 12 * constant;\n+                move.stepHeight = 0.35f * ratio;\n+                move.distanceBetweenFootsteps = ratio;\n+                move.runFactor = function2(amount);", "originalCommit": "5212bad83f1437d495cd77a2cf826c3d84ff14cd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f94718fa1643fd18991bb1f478d2f0c57ff2e8b1", "url": "https://github.com/MovingBlocks/Terasology/commit/f94718fa1643fd18991bb1f478d2f0c57ff2e8b1", "message": "Expanded star import", "committedDate": "2020-04-02T05:57:55Z", "type": "commit"}, {"oid": "26f8f9833ab999d4f519842c8d009a87b5214b53", "url": "https://github.com/MovingBlocks/Terasology/commit/26f8f9833ab999d4f519842c8d009a87b5214b53", "message": "Update engine/src/main/java/org/terasology/logic/debug/MovementDebugCommands.java\n\nCo-Authored-By: Tobias Nett <skaldarnar@googlemail.com>", "committedDate": "2020-04-02T06:00:00Z", "type": "commit"}, {"oid": "1e21cc6b3ab6b65411594e49a24aeebe744db54a", "url": "https://github.com/MovingBlocks/Terasology/commit/1e21cc6b3ab6b65411594e49a24aeebe744db54a", "message": "Assigned more meaningful names and cleaned up code", "committedDate": "2020-04-02T06:43:25Z", "type": "commit"}, {"oid": "6b915eff7bfc6b30a5ae9a1bbf41f66a9bc3b301", "url": "https://github.com/MovingBlocks/Terasology/commit/6b915eff7bfc6b30a5ae9a1bbf41f66a9bc3b301", "message": "Fixed small mistake", "committedDate": "2020-04-02T07:04:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQxODIxMA==", "url": "https://github.com/MovingBlocks/Terasology/pull/3841#discussion_r402418210", "bodyText": "The member height is public in CharacterMovementComponent, so there should be no need for this getter method.\nSee CharacterMovementComponent.java#L39", "author": "skaldarnar", "createdAt": "2020-04-02T15:47:31Z", "path": "engine/src/main/java/org/terasology/logic/characters/CharacterMovementComponent.java", "diffHunk": "@@ -91,6 +91,8 @@ public Vector3f getVelocity() {\n         return velocity;\n     }\n \n+    public float getPlayerHeight(){ return height; }", "originalCommit": "6b915eff7bfc6b30a5ae9a1bbf41f66a9bc3b301", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQyMjc1NQ==", "url": "https://github.com/MovingBlocks/Terasology/pull/3841#discussion_r402422755", "bodyText": "I believe 1.6f is the default height of the player? Ideally, we don't have to copy around these magic numbers and loose track of where they came from.\nThe best shot could be to define constants in CharacterMovementComponent which can be reused here.", "author": "skaldarnar", "createdAt": "2020-04-02T15:53:39Z", "path": "engine/src/main/java/org/terasology/logic/debug/MovementDebugCommands.java", "diffHunk": "@@ -233,22 +236,48 @@ public String stepHeight(@Sender EntityRef client, @CommandParam(\"height\") float\n         return \"\";\n     }\n \n+    private float getJumpSpeed(float amount){\n+        double d = (double)amount;\n+        return (float) pow(d,0.6) * 9.36f ;\n+    }\n+    \n+    private float getInteractionRange(float amount){\n+        double d = (double)amount;\n+        return (float) pow(d,0.6) * 3.9f ;\n+    }\n+\n+    private float getRunFactor(float amount){\n+       return 0.15f + (0.64f * amount) - (0.006f * amount * amount);\n+    }\n+\n     @Command(shortDescription = \"Sets the height of the player\", runOnServer = true,\n             requiredPermission = PermissionManager.CHEAT_PERMISSION)\n     public String playerHeight(@Sender EntityRef client, @CommandParam(\"height\") float amount) {\n         try {\n             ClientComponent clientComp = client.getComponent(ClientComponent.class);\n             CharacterMovementComponent move = clientComp.character.getComponent(CharacterMovementComponent.class);\n-            if (move != null) {\n+            CharacterComponent charComp = clientComp.character.getComponent(CharacterComponent.class);\n+            EntityRef player = clientComp.character;\n+            GazeMountPointComponent gazeMountPointComponent = player.getComponent(GazeMountPointComponent.class);\n+\n+            float ratio = amount / 1.6f;", "originalCommit": "6b915eff7bfc6b30a5ae9a1bbf41f66a9bc3b301", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQyODA2MA==", "url": "https://github.com/MovingBlocks/Terasology/pull/3841#discussion_r402428060", "bodyText": "Height has a limitation of @Range(min = 0, max = 5) in CharacterMovementComponent, that should probably also be checked here...", "author": "skaldarnar", "createdAt": "2020-04-02T16:00:51Z", "path": "engine/src/main/java/org/terasology/logic/debug/MovementDebugCommands.java", "diffHunk": "@@ -233,22 +236,48 @@ public String stepHeight(@Sender EntityRef client, @CommandParam(\"height\") float\n         return \"\";\n     }\n \n+    private float getJumpSpeed(float amount){\n+        double d = (double)amount;\n+        return (float) pow(d,0.6) * 9.36f ;\n+    }\n+    \n+    private float getInteractionRange(float amount){\n+        double d = (double)amount;\n+        return (float) pow(d,0.6) * 3.9f ;\n+    }\n+\n+    private float getRunFactor(float amount){\n+       return 0.15f + (0.64f * amount) - (0.006f * amount * amount);\n+    }\n+\n     @Command(shortDescription = \"Sets the height of the player\", runOnServer = true,\n             requiredPermission = PermissionManager.CHEAT_PERMISSION)\n     public String playerHeight(@Sender EntityRef client, @CommandParam(\"height\") float amount) {", "originalCommit": "6b915eff7bfc6b30a5ae9a1bbf41f66a9bc3b301", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQ1MjM3NA==", "url": "https://github.com/MovingBlocks/Terasology/pull/3841#discussion_r402452374", "bodyText": "The default jumpSpeed seems to be 10 (and that's the maximum at the same time o.O ). thus, I would assume that setting the player height to the default should result in the default jump speed, but substituting amount by 1.6 yiels a value ~12.4 (\u226010).\nThis is how the jump speed is adjusted according to this function, for amount in the interval from 0 to 5:\n\nsee Wolfram Alpha\nsee CharacterMovementComponent.java#L53-L54", "author": "skaldarnar", "createdAt": "2020-04-02T16:36:52Z", "path": "engine/src/main/java/org/terasology/logic/debug/MovementDebugCommands.java", "diffHunk": "@@ -233,22 +236,48 @@ public String stepHeight(@Sender EntityRef client, @CommandParam(\"height\") float\n         return \"\";\n     }\n \n+    private float getJumpSpeed(float amount){\n+        double d = (double)amount;\n+        return (float) pow(d,0.6) * 9.36f ;", "originalCommit": "6b915eff7bfc6b30a5ae9a1bbf41f66a9bc3b301", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQ1NTkxMw==", "url": "https://github.com/MovingBlocks/Terasology/pull/3841#discussion_r402455913", "bodyText": "The run factor seems to be a value in the range from 0 to 10, with 1.5 being the default.\nAgain, calculating the new run factor with the default height of 1.6 yields a value of 1.15864 (\u22601.5).\nThis is how the run factor scales with the given function for amount between 0 and 5. The curve looks almost linear, to be hones:\n\nsee Wolfram Alpha", "author": "skaldarnar", "createdAt": "2020-04-02T16:42:16Z", "path": "engine/src/main/java/org/terasology/logic/debug/MovementDebugCommands.java", "diffHunk": "@@ -233,22 +236,48 @@ public String stepHeight(@Sender EntityRef client, @CommandParam(\"height\") float\n         return \"\";\n     }\n \n+    private float getJumpSpeed(float amount){\n+        double d = (double)amount;\n+        return (float) pow(d,0.6) * 9.36f ;\n+    }\n+    \n+    private float getInteractionRange(float amount){\n+        double d = (double)amount;\n+        return (float) pow(d,0.6) * 3.9f ;\n+    }\n+\n+    private float getRunFactor(float amount){\n+       return 0.15f + (0.64f * amount) - (0.006f * amount * amount);", "originalCommit": "6b915eff7bfc6b30a5ae9a1bbf41f66a9bc3b301", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQ2NTE4MQ==", "url": "https://github.com/MovingBlocks/Terasology/pull/3841#discussion_r402465181", "bodyText": "The default interaction range seems to be 5 (see CharacterComponent.java#L37). With this formula the interaction range for height of 1.6 is 5.17055 (\u2260 5).\nThis is what the plot looks like:\n\nsee Wolfram Alpha", "author": "skaldarnar", "createdAt": "2020-04-02T16:56:27Z", "path": "engine/src/main/java/org/terasology/logic/debug/MovementDebugCommands.java", "diffHunk": "@@ -233,22 +236,48 @@ public String stepHeight(@Sender EntityRef client, @CommandParam(\"height\") float\n         return \"\";\n     }\n \n+    private float getJumpSpeed(float amount){\n+        double d = (double)amount;\n+        return (float) pow(d,0.6) * 9.36f ;\n+    }\n+    \n+    private float getInteractionRange(float amount){\n+        double d = (double)amount;\n+        return (float) pow(d,0.6) * 3.9f ;", "originalCommit": "6b915eff7bfc6b30a5ae9a1bbf41f66a9bc3b301", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "87596cf7deffa6cd8a93d3b5221d35d6d54a8c9e", "url": "https://github.com/MovingBlocks/Terasology/commit/87596cf7deffa6cd8a93d3b5221d35d6d54a8c9e", "message": "Got rid of unnecessary getter", "committedDate": "2020-04-04T07:27:25Z", "type": "commit"}, {"oid": "851d6b66eba64fa6000a7f92118aef06c05d2a7c", "url": "https://github.com/MovingBlocks/Terasology/commit/851d6b66eba64fa6000a7f92118aef06c05d2a7c", "message": "Made necessary changes", "committedDate": "2020-04-04T16:39:52Z", "type": "commit"}, {"oid": "fa8d3ed2baba237f5a9a417eb277e02740949e7d", "url": "https://github.com/MovingBlocks/Terasology/commit/fa8d3ed2baba237f5a9a417eb277e02740949e7d", "message": "Changed the height range", "committedDate": "2020-04-04T16:43:06Z", "type": "commit"}, {"oid": "944bc1ea00d812eca22b6234a956d580f4b11000", "url": "https://github.com/MovingBlocks/Terasology/commit/944bc1ea00d812eca22b6234a956d580f4b11000", "message": "corrected small mistake", "committedDate": "2020-04-04T17:36:35Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzQ5NjI5Ng==", "url": "https://github.com/MovingBlocks/Terasology/pull/3841#discussion_r403496296", "bodyText": "This does not take the default values, but the current values for the CharacterMovementComponent.", "author": "skaldarnar", "createdAt": "2020-04-04T17:43:54Z", "path": "engine/src/main/java/org/terasology/logic/debug/MovementDebugCommands.java", "diffHunk": "@@ -233,22 +236,52 @@ public String stepHeight(@Sender EntityRef client, @CommandParam(\"height\") float\n         return \"\";\n     }\n \n+    private float getJumpSpeed(float amount){\n+        double d = (double)amount;\n+        return Math.round(pow(d,0.55) * 8.45f);\n+    }\n+    \n+    private float getInteractionRange(float amount){\n+        double d = (double)amount;\n+        return Math.round(pow(d,0.6) * 3.9f);\n+    }\n+\n+    private float getRunFactor(float amount){\n+       return Math.round(5.5f + (6.4f * amount) - (0.06f * amount * amount)) / 10f;\n+    }\n+\n     @Command(shortDescription = \"Sets the height of the player\", runOnServer = true,\n             requiredPermission = PermissionManager.CHEAT_PERMISSION)\n     public String playerHeight(@Sender EntityRef client, @CommandParam(\"height\") float amount) {\n         try {\n             ClientComponent clientComp = client.getComponent(ClientComponent.class);\n             CharacterMovementComponent move = clientComp.character.getComponent(CharacterMovementComponent.class);\n-            if (move != null) {\n+            CharacterComponent charComp = clientComp.character.getComponent(CharacterComponent.class);\n+            EntityRef player = clientComp.character;\n+            GazeMountPointComponent gazeMountPointComponent = player.getComponent(GazeMountPointComponent.class);\n+\n+            float defaultHeight = move.height;\n+            float defaultStepHeight = move.stepHeight;\n+            float defaultFootSteps = move.distanceBetweenFootsteps;", "originalCommit": "fa8d3ed2baba237f5a9a417eb277e02740949e7d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzQ5ODQ2OQ==", "url": "https://github.com/MovingBlocks/Terasology/pull/3841#discussion_r403498469", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private float getJumpSpeed(float amount){\n          \n          \n            \n                    double d = (double)amount;\n          \n          \n            \n                    return Math.round(pow(d,0.55) * 8.45f);\n          \n          \n            \n                }\n          \n          \n            \n                private float getJumpSpeed(float height) {\n          \n          \n            \n                    return Math.round(Math.pow(height/DEFAULT_HEIGHT, 0.55f) * DEFAULT_JUMP_SPEED);\n          \n          \n            \n                }", "author": "skaldarnar", "createdAt": "2020-04-04T18:04:45Z", "path": "engine/src/main/java/org/terasology/logic/debug/MovementDebugCommands.java", "diffHunk": "@@ -233,22 +236,52 @@ public String stepHeight(@Sender EntityRef client, @CommandParam(\"height\") float\n         return \"\";\n     }\n \n+    private float getJumpSpeed(float amount){\n+        double d = (double)amount;\n+        return Math.round(pow(d,0.55) * 8.45f);\n+    }", "originalCommit": "944bc1ea00d812eca22b6234a956d580f4b11000", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzQ5ODc0Ng==", "url": "https://github.com/MovingBlocks/Terasology/pull/3841#discussion_r403498746", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private float getInteractionRange(float amount){\n          \n          \n            \n                    double d = (double)amount;\n          \n          \n            \n                    return Math.round(pow(d,0.6) * 3.9f);\n          \n          \n            \n                }\n          \n          \n            \n                private float getInteractionRange(float height){\n          \n          \n            \n                    return Math.round(pow(height/DEFAULT_HEIGHT, 0.6) * DEFAULT_INTERACTION_RANGE);\n          \n          \n            \n                }", "author": "skaldarnar", "createdAt": "2020-04-04T18:06:44Z", "path": "engine/src/main/java/org/terasology/logic/debug/MovementDebugCommands.java", "diffHunk": "@@ -233,22 +236,52 @@ public String stepHeight(@Sender EntityRef client, @CommandParam(\"height\") float\n         return \"\";\n     }\n \n+    private float getJumpSpeed(float amount){\n+        double d = (double)amount;\n+        return Math.round(pow(d,0.55) * 8.45f);\n+    }\n+    \n+    private float getInteractionRange(float amount){\n+        double d = (double)amount;\n+        return Math.round(pow(d,0.6) * 3.9f);\n+    }", "originalCommit": "944bc1ea00d812eca22b6234a956d580f4b11000", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzQ5OTU5Nw==", "url": "https://github.com/MovingBlocks/Terasology/pull/3841#discussion_r403499597", "bodyText": "Maybe use a similar formular to the ones you use above? Is there any reason this should be quadratic?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private float getRunFactor(float amount){\n          \n          \n            \n                   return Math.round(5.5f + (6.4f * amount) - (0.06f * amount * amount)) / 10f;\n          \n          \n            \n                }\n          \n          \n            \n                private float getRunFactor(float height){\n          \n          \n            \n                   return Math.round(Math.pow(height/DEFAULT_HEIGHT, 0.5) * DEFAULT_RUN_FACTOR);;\n          \n          \n            \n                }", "author": "skaldarnar", "createdAt": "2020-04-04T18:14:05Z", "path": "engine/src/main/java/org/terasology/logic/debug/MovementDebugCommands.java", "diffHunk": "@@ -233,22 +236,52 @@ public String stepHeight(@Sender EntityRef client, @CommandParam(\"height\") float\n         return \"\";\n     }\n \n+    private float getJumpSpeed(float amount){\n+        double d = (double)amount;\n+        return Math.round(pow(d,0.55) * 8.45f);\n+    }\n+    \n+    private float getInteractionRange(float amount){\n+        double d = (double)amount;\n+        return Math.round(pow(d,0.6) * 3.9f);\n+    }\n+\n+    private float getRunFactor(float amount){\n+       return Math.round(5.5f + (6.4f * amount) - (0.06f * amount * amount)) / 10f;\n+    }", "originalCommit": "944bc1ea00d812eca22b6234a956d580f4b11000", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzUwOTAzMA==", "url": "https://github.com/MovingBlocks/Terasology/pull/3841#discussion_r403509030", "bodyText": "well....its just that i painstakingly constructing the other 2 functions manually,before i realized that it is much easier to arrive at them through regression,and that is how i acquired the third function.I must admit @skaldarnar you are really thorough", "author": "godfather2", "createdAt": "2020-04-04T19:43:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzQ5OTU5Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzQ5OTc1MQ==", "url": "https://github.com/MovingBlocks/Terasology/pull/3841#discussion_r403499751", "bodyText": "These should not be re-defined here. When the default values in CharacterMovementComponent are changed these will be outdated, and will likely cause some weird behavior and bugs.\nInstead, CharacterMovementComponent should expose\n    public  static final float DEFAULT_HEIGHT = 1.6f;\n    public  static final float DEFAULT_JUMP_SPEED = 10.f;", "author": "skaldarnar", "createdAt": "2020-04-04T18:15:20Z", "path": "engine/src/main/java/org/terasology/logic/debug/MovementDebugCommands.java", "diffHunk": "@@ -233,22 +236,52 @@ public String stepHeight(@Sender EntityRef client, @CommandParam(\"height\") float\n         return \"\";\n     }\n \n+    private float getJumpSpeed(float amount){\n+        double d = (double)amount;\n+        return Math.round(pow(d,0.55) * 8.45f);\n+    }\n+    \n+    private float getInteractionRange(float amount){\n+        double d = (double)amount;\n+        return Math.round(pow(d,0.6) * 3.9f);\n+    }\n+\n+    private float getRunFactor(float amount){\n+       return Math.round(5.5f + (6.4f * amount) - (0.06f * amount * amount)) / 10f;\n+    }\n+\n     @Command(shortDescription = \"Sets the height of the player\", runOnServer = true,\n             requiredPermission = PermissionManager.CHEAT_PERMISSION)\n     public String playerHeight(@Sender EntityRef client, @CommandParam(\"height\") float amount) {\n         try {\n             ClientComponent clientComp = client.getComponent(ClientComponent.class);\n             CharacterMovementComponent move = clientComp.character.getComponent(CharacterMovementComponent.class);\n-            if (move != null) {\n+            CharacterComponent charComp = clientComp.character.getComponent(CharacterComponent.class);\n+            EntityRef player = clientComp.character;\n+            GazeMountPointComponent gazeMountPointComponent = player.getComponent(GazeMountPointComponent.class);\n+\n+            float defaultHeight = 1.6f;", "originalCommit": "944bc1ea00d812eca22b6234a956d580f4b11000", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzUwNDc5MA==", "url": "https://github.com/MovingBlocks/Terasology/pull/3841#discussion_r403504790", "bodyText": "i just looked at the restoreSpeed command. This is how it accesses default values CharacterMovementComponent moveDefault = prefab.get().getComponent(CharacterMovementComponent.class); for instance  move.jumpSpeed = moveDefault.jumpSpeed; Should i do this?", "author": "godfather2", "createdAt": "2020-04-04T19:03:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzQ5OTc1MQ=="}], "type": "inlineReview"}, {"oid": "9de2a0b0df45386c5488b9ac8be37ff2a2c165b4", "url": "https://github.com/MovingBlocks/Terasology/commit/9de2a0b0df45386c5488b9ac8be37ff2a2c165b4", "message": "Update MovementDebugCommands.java", "committedDate": "2020-04-04T18:24:35Z", "type": "commit"}, {"oid": "f29f7847f0329b75c3d55f14ce8c83d1c2d2b3cd", "url": "https://github.com/MovingBlocks/Terasology/commit/f29f7847f0329b75c3d55f14ce8c83d1c2d2b3cd", "message": "Cleaned up formulae", "committedDate": "2020-04-18T20:17:31Z", "type": "commit"}, {"oid": "0b002b9752840b6ad026fafbda909f418dd9d141", "url": "https://github.com/MovingBlocks/Terasology/commit/0b002b9752840b6ad026fafbda909f418dd9d141", "message": "Corrected the default height and height range", "committedDate": "2020-04-18T20:20:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDg0OTYyMQ==", "url": "https://github.com/MovingBlocks/Terasology/pull/3841#discussion_r410849621", "bodyText": "Why did you change the default height here?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public float height = 1.8f;\n          \n          \n            \n                public float height = 1.6f;", "author": "skaldarnar", "createdAt": "2020-04-19T08:22:40Z", "path": "engine/src/main/java/org/terasology/logic/characters/CharacterMovementComponent.java", "diffHunk": "@@ -35,8 +35,8 @@\n public final class CharacterMovementComponent implements Component {\n \n     // Collision settings\n-    @Range(min = 0, max = 5)\n-    public float height = 1.6f;\n+    @Range(min = 1, max = 25)\n+    public float height = 1.8f;", "originalCommit": "0b002b9752840b6ad026fafbda909f418dd9d141", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDg2NTM4OA==", "url": "https://github.com/MovingBlocks/Terasology/pull/3841#discussion_r410865388", "bodyText": "Now I saw that the values in CharacterMovementComponent are not the same as the ones in player.prefab. That should not be a problem as you are loading the default values from the prefab anyways. Thus, I would like to keep this default value as it is.", "author": "skaldarnar", "createdAt": "2020-04-19T09:48:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDg0OTYyMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDg2NTcxMg==", "url": "https://github.com/MovingBlocks/Terasology/pull/3841#discussion_r410865712", "bodyText": "Unfortunately, we cannot assume that the default value for the interaction range is always 5 as it may be changed by a prefab (see default jump speed). Thus, this method should also get the default value to multiply with:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private float getInteractionRange(float ratio) {\n          \n          \n            \n                    return (float) Math.pow(ratio, 0.62f) * 5f;\n          \n          \n            \n                }\n          \n          \n            \n                private float getInteractionRange(float ratio, float defaultValue) {\n          \n          \n            \n                    return (float) Math.pow(ratio, 0.62f) * defaultValue;\n          \n          \n            \n                }", "author": "skaldarnar", "createdAt": "2020-04-19T09:50:01Z", "path": "engine/src/main/java/org/terasology/logic/debug/MovementDebugCommands.java", "diffHunk": "@@ -233,28 +238,59 @@ public String stepHeight(@Sender EntityRef client, @CommandParam(\"height\") float\n         return \"\";\n     }\n \n+    private float getJumpSpeed(float ratio) {\n+        return (float) Math.pow(ratio, 0.74f) * 6f + 4f;\n+    }\n+\n+    private float getInteractionRange(float ratio) {\n+        return (float) Math.pow(ratio, 0.62f) * 5f;\n+    }", "originalCommit": "0b002b9752840b6ad026fafbda909f418dd9d141", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDg2NTc5NQ==", "url": "https://github.com/MovingBlocks/Terasology/pull/3841#discussion_r410865795", "bodyText": "Same applies here for the run factor:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private float getRunFactor(float ratio) {\n          \n          \n            \n                    return (float) Math.pow(ratio, 0.68f) * 1.5f;\n          \n          \n            \n                }\n          \n          \n            \n                private float getRunFactor(float ratio, float defaultValue) {\n          \n          \n            \n                    return (float) Math.pow(ratio, 0.68f) * defaultValue;\n          \n          \n            \n                }", "author": "skaldarnar", "createdAt": "2020-04-19T09:50:24Z", "path": "engine/src/main/java/org/terasology/logic/debug/MovementDebugCommands.java", "diffHunk": "@@ -233,28 +238,59 @@ public String stepHeight(@Sender EntityRef client, @CommandParam(\"height\") float\n         return \"\";\n     }\n \n+    private float getJumpSpeed(float ratio) {\n+        return (float) Math.pow(ratio, 0.74f) * 6f + 4f;\n+    }\n+\n+    private float getInteractionRange(float ratio) {\n+        return (float) Math.pow(ratio, 0.62f) * 5f;\n+    }\n+\n+    private float getRunFactor(float ratio) {\n+        return (float) Math.pow(ratio, 0.68f) * 1.5f;\n+    }", "originalCommit": "0b002b9752840b6ad026fafbda909f418dd9d141", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDg2ODA2NA==", "url": "https://github.com/MovingBlocks/Terasology/pull/3841#discussion_r410868064", "bodyText": "The default jump speed for the player is set in the prefab to 12, thus calculating with 10 here sets the default values off (sorry for not catching this earlier). I like the fact the we have a constant value here to ensure that the player can always jump some minimum height.\nWhen deriving this from the default jump speed I would also increase the influence of the constant and reduce the influence of the first part:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private float getJumpSpeed(float ratio) {\n          \n          \n            \n                    return (float) Math.pow(ratio, 0.74f) * 6f + 4f;\n          \n          \n            \n                }\n          \n          \n            \n                private float getJumpSpeed(float ratio, float defaultValue) {\n          \n          \n            \n                    return (float) Math.pow(ratio, 0.74f) * 0.4f * defaultValue + 0.6f * defaultValue;\n          \n          \n            \n                }", "author": "skaldarnar", "createdAt": "2020-04-19T10:02:07Z", "path": "engine/src/main/java/org/terasology/logic/debug/MovementDebugCommands.java", "diffHunk": "@@ -233,28 +238,59 @@ public String stepHeight(@Sender EntityRef client, @CommandParam(\"height\") float\n         return \"\";\n     }\n \n+    private float getJumpSpeed(float ratio) {\n+        return (float) Math.pow(ratio, 0.74f) * 6f + 4f;\n+    }", "originalCommit": "0b002b9752840b6ad026fafbda909f418dd9d141", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDg2OTM0MQ==", "url": "https://github.com/MovingBlocks/Terasology/pull/3841#discussion_r410869341", "bodyText": "As we'll need both the default movement component and the default character component later I'll fetch both here:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            Optional<Prefab> prefab = Assets.get(new ResourceUrn(\"engine:player\"), Prefab.class);\n          \n          \n            \n                            CharacterMovementComponent moveDefault = prefab.get().getComponent(CharacterMovementComponent.class);\n          \n          \n            \n            \n          \n          \n            \n                            Prefab playerDefaults = Assets.getPrefab(\"engine:player\").get();\n          \n          \n            \n                            CharacterMovementComponent moveDefault = playerDefaults.getComponent(CharacterMovementComponent.class);\n          \n          \n            \n                            CharacterComponent characterDefault = playerDefaults.getComponent(CharacterComponent.class)", "author": "skaldarnar", "createdAt": "2020-04-19T10:09:46Z", "path": "engine/src/main/java/org/terasology/logic/debug/MovementDebugCommands.java", "diffHunk": "@@ -233,28 +238,59 @@ public String stepHeight(@Sender EntityRef client, @CommandParam(\"height\") float\n         return \"\";\n     }\n \n+    private float getJumpSpeed(float ratio) {\n+        return (float) Math.pow(ratio, 0.74f) * 6f + 4f;\n+    }\n+\n+    private float getInteractionRange(float ratio) {\n+        return (float) Math.pow(ratio, 0.62f) * 5f;\n+    }\n+\n+    private float getRunFactor(float ratio) {\n+        return (float) Math.pow(ratio, 0.68f) * 1.5f;\n+    }\n+\n     @Command(shortDescription = \"Sets the height of the player\", runOnServer = true,\n             requiredPermission = PermissionManager.CHEAT_PERMISSION)\n     public String playerHeight(@Sender EntityRef client, @CommandParam(\"height\") float amount) {\n-        try {\n-            ClientComponent clientComp = client.getComponent(ClientComponent.class);\n-            CharacterMovementComponent move = clientComp.character.getComponent(CharacterMovementComponent.class);\n-            if (move != null) {\n-                float prevHeight = move.height;\n-                move.height = amount;\n-                clientComp.character.saveComponent(move);\n-                LocationComponent loc = client.getComponent(LocationComponent.class);\n-                Vector3f currentPosition = loc.getWorldPosition();\n-                clientComp.character\n-                        .send(new CharacterTeleportEvent(new Vector3f(currentPosition.getX(), currentPosition.getY() + (amount - prevHeight) / 2, currentPosition.getZ())));\n-                physics.removeCharacterCollider(clientComp.character);\n-                physics.getCharacterCollider(clientComp.character);\n-                return \"Height of player set to \" + amount + \" (was \" + prevHeight + \")\";\n+        if (amount >= 1 && amount <= 25) {\n+            try {\n+                ClientComponent clientComp = client.getComponent(ClientComponent.class);\n+                CharacterMovementComponent move = clientComp.character.getComponent(CharacterMovementComponent.class);\n+                CharacterComponent charComp = clientComp.character.getComponent(CharacterComponent.class);\n+                EntityRef player = clientComp.character;\n+                GazeMountPointComponent gazeMountPointComponent = player.getComponent(GazeMountPointComponent.class);\n+                Optional<Prefab> prefab = Assets.get(new ResourceUrn(\"engine:player\"), Prefab.class);\n+                CharacterMovementComponent moveDefault = prefab.get().getComponent(CharacterMovementComponent.class);", "originalCommit": "0b002b9752840b6ad026fafbda909f418dd9d141", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDg3MDEzNw==", "url": "https://github.com/MovingBlocks/Terasology/pull/3841#discussion_r410870137", "bodyText": "Ideally we'll need a lot more null checks here (for all the components). I'll refactor that part after this PR is merged, though.", "author": "skaldarnar", "createdAt": "2020-04-19T10:14:19Z", "path": "engine/src/main/java/org/terasology/logic/debug/MovementDebugCommands.java", "diffHunk": "@@ -233,28 +238,59 @@ public String stepHeight(@Sender EntityRef client, @CommandParam(\"height\") float\n         return \"\";\n     }\n \n+    private float getJumpSpeed(float ratio) {\n+        return (float) Math.pow(ratio, 0.74f) * 6f + 4f;\n+    }\n+\n+    private float getInteractionRange(float ratio) {\n+        return (float) Math.pow(ratio, 0.62f) * 5f;\n+    }\n+\n+    private float getRunFactor(float ratio) {\n+        return (float) Math.pow(ratio, 0.68f) * 1.5f;\n+    }\n+\n     @Command(shortDescription = \"Sets the height of the player\", runOnServer = true,\n             requiredPermission = PermissionManager.CHEAT_PERMISSION)\n     public String playerHeight(@Sender EntityRef client, @CommandParam(\"height\") float amount) {\n-        try {\n-            ClientComponent clientComp = client.getComponent(ClientComponent.class);\n-            CharacterMovementComponent move = clientComp.character.getComponent(CharacterMovementComponent.class);\n-            if (move != null) {\n-                float prevHeight = move.height;\n-                move.height = amount;\n-                clientComp.character.saveComponent(move);\n-                LocationComponent loc = client.getComponent(LocationComponent.class);\n-                Vector3f currentPosition = loc.getWorldPosition();\n-                clientComp.character\n-                        .send(new CharacterTeleportEvent(new Vector3f(currentPosition.getX(), currentPosition.getY() + (amount - prevHeight) / 2, currentPosition.getZ())));\n-                physics.removeCharacterCollider(clientComp.character);\n-                physics.getCharacterCollider(clientComp.character);\n-                return \"Height of player set to \" + amount + \" (was \" + prevHeight + \")\";\n+        if (amount >= 1 && amount <= 25) {\n+            try {\n+                ClientComponent clientComp = client.getComponent(ClientComponent.class);\n+                CharacterMovementComponent move = clientComp.character.getComponent(CharacterMovementComponent.class);\n+                CharacterComponent charComp = clientComp.character.getComponent(CharacterComponent.class);\n+                EntityRef player = clientComp.character;\n+                GazeMountPointComponent gazeMountPointComponent = player.getComponent(GazeMountPointComponent.class);\n+                Optional<Prefab> prefab = Assets.get(new ResourceUrn(\"engine:player\"), Prefab.class);\n+                CharacterMovementComponent moveDefault = prefab.get().getComponent(CharacterMovementComponent.class);\n+\n+                if (move != null && gazeMountPointComponent != null) {", "originalCommit": "0b002b9752840b6ad026fafbda909f418dd9d141", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDg3MDMzMg==", "url": "https://github.com/MovingBlocks/Terasology/pull/3841#discussion_r410870332", "bodyText": "Inline with the method changes above we'll need to pass the default values over now:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                move.jumpSpeed = getJumpSpeed(ratio);\n          \n          \n            \n                                move.stepHeight = moveDefault.stepHeight * ratio;\n          \n          \n            \n                                move.distanceBetweenFootsteps = moveDefault.distanceBetweenFootsteps * ratio;\n          \n          \n            \n                                move.runFactor = getRunFactor(ratio);\n          \n          \n            \n                                charComp.interactionRange = getInteractionRange(ratio);\n          \n          \n            \n                                move.jumpSpeed = getJumpSpeed(ratio, moveDefault.jumpSpeed);\n          \n          \n            \n                                move.stepHeight = ratio * moveDefault.stepHeight;\n          \n          \n            \n                                move.distanceBetweenFootsteps = ratio * moveDefault.distanceBetweenFootsteps;\n          \n          \n            \n                                move.runFactor = getRunFactor(ratio, moveDefault.runFactor);\n          \n          \n            \n                                charComp.interactionRange = getInteractionRange(ratio, characterDefault.interactionRange);", "author": "skaldarnar", "createdAt": "2020-04-19T10:15:30Z", "path": "engine/src/main/java/org/terasology/logic/debug/MovementDebugCommands.java", "diffHunk": "@@ -233,28 +238,59 @@ public String stepHeight(@Sender EntityRef client, @CommandParam(\"height\") float\n         return \"\";\n     }\n \n+    private float getJumpSpeed(float ratio) {\n+        return (float) Math.pow(ratio, 0.74f) * 6f + 4f;\n+    }\n+\n+    private float getInteractionRange(float ratio) {\n+        return (float) Math.pow(ratio, 0.62f) * 5f;\n+    }\n+\n+    private float getRunFactor(float ratio) {\n+        return (float) Math.pow(ratio, 0.68f) * 1.5f;\n+    }\n+\n     @Command(shortDescription = \"Sets the height of the player\", runOnServer = true,\n             requiredPermission = PermissionManager.CHEAT_PERMISSION)\n     public String playerHeight(@Sender EntityRef client, @CommandParam(\"height\") float amount) {\n-        try {\n-            ClientComponent clientComp = client.getComponent(ClientComponent.class);\n-            CharacterMovementComponent move = clientComp.character.getComponent(CharacterMovementComponent.class);\n-            if (move != null) {\n-                float prevHeight = move.height;\n-                move.height = amount;\n-                clientComp.character.saveComponent(move);\n-                LocationComponent loc = client.getComponent(LocationComponent.class);\n-                Vector3f currentPosition = loc.getWorldPosition();\n-                clientComp.character\n-                        .send(new CharacterTeleportEvent(new Vector3f(currentPosition.getX(), currentPosition.getY() + (amount - prevHeight) / 2, currentPosition.getZ())));\n-                physics.removeCharacterCollider(clientComp.character);\n-                physics.getCharacterCollider(clientComp.character);\n-                return \"Height of player set to \" + amount + \" (was \" + prevHeight + \")\";\n+        if (amount >= 1 && amount <= 25) {\n+            try {\n+                ClientComponent clientComp = client.getComponent(ClientComponent.class);\n+                CharacterMovementComponent move = clientComp.character.getComponent(CharacterMovementComponent.class);\n+                CharacterComponent charComp = clientComp.character.getComponent(CharacterComponent.class);\n+                EntityRef player = clientComp.character;\n+                GazeMountPointComponent gazeMountPointComponent = player.getComponent(GazeMountPointComponent.class);\n+                Optional<Prefab> prefab = Assets.get(new ResourceUrn(\"engine:player\"), Prefab.class);\n+                CharacterMovementComponent moveDefault = prefab.get().getComponent(CharacterMovementComponent.class);\n+\n+                if (move != null && gazeMountPointComponent != null) {\n+                    float prevHeight = move.height;\n+                    float defaultEyeHeight = config.getPlayer().getEyeHeight();\n+                    float foreHeadSize = moveDefault.height - defaultEyeHeight;\n+                    float ratio = amount / moveDefault.height;\n+\n+                    move.height = amount;\n+                    move.jumpSpeed = getJumpSpeed(ratio);\n+                    move.stepHeight = moveDefault.stepHeight * ratio;\n+                    move.distanceBetweenFootsteps = moveDefault.distanceBetweenFootsteps * ratio;\n+                    move.runFactor = getRunFactor(ratio);\n+                    charComp.interactionRange = getInteractionRange(ratio);", "originalCommit": "0b002b9752840b6ad026fafbda909f418dd9d141", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDg3MDUzNw==", "url": "https://github.com/MovingBlocks/Terasology/pull/3841#discussion_r410870537", "bodyText": "As this is the same code as for the playerEyeHeight command I would refactor this later on to use a common\nupdateGazeMountPointHeight(player, amount - foreHeadSize);", "author": "skaldarnar", "createdAt": "2020-04-19T10:16:48Z", "path": "engine/src/main/java/org/terasology/logic/debug/MovementDebugCommands.java", "diffHunk": "@@ -233,28 +238,59 @@ public String stepHeight(@Sender EntityRef client, @CommandParam(\"height\") float\n         return \"\";\n     }\n \n+    private float getJumpSpeed(float ratio) {\n+        return (float) Math.pow(ratio, 0.74f) * 6f + 4f;\n+    }\n+\n+    private float getInteractionRange(float ratio) {\n+        return (float) Math.pow(ratio, 0.62f) * 5f;\n+    }\n+\n+    private float getRunFactor(float ratio) {\n+        return (float) Math.pow(ratio, 0.68f) * 1.5f;\n+    }\n+\n     @Command(shortDescription = \"Sets the height of the player\", runOnServer = true,\n             requiredPermission = PermissionManager.CHEAT_PERMISSION)\n     public String playerHeight(@Sender EntityRef client, @CommandParam(\"height\") float amount) {\n-        try {\n-            ClientComponent clientComp = client.getComponent(ClientComponent.class);\n-            CharacterMovementComponent move = clientComp.character.getComponent(CharacterMovementComponent.class);\n-            if (move != null) {\n-                float prevHeight = move.height;\n-                move.height = amount;\n-                clientComp.character.saveComponent(move);\n-                LocationComponent loc = client.getComponent(LocationComponent.class);\n-                Vector3f currentPosition = loc.getWorldPosition();\n-                clientComp.character\n-                        .send(new CharacterTeleportEvent(new Vector3f(currentPosition.getX(), currentPosition.getY() + (amount - prevHeight) / 2, currentPosition.getZ())));\n-                physics.removeCharacterCollider(clientComp.character);\n-                physics.getCharacterCollider(clientComp.character);\n-                return \"Height of player set to \" + amount + \" (was \" + prevHeight + \")\";\n+        if (amount >= 1 && amount <= 25) {\n+            try {\n+                ClientComponent clientComp = client.getComponent(ClientComponent.class);\n+                CharacterMovementComponent move = clientComp.character.getComponent(CharacterMovementComponent.class);\n+                CharacterComponent charComp = clientComp.character.getComponent(CharacterComponent.class);\n+                EntityRef player = clientComp.character;\n+                GazeMountPointComponent gazeMountPointComponent = player.getComponent(GazeMountPointComponent.class);\n+                Optional<Prefab> prefab = Assets.get(new ResourceUrn(\"engine:player\"), Prefab.class);\n+                CharacterMovementComponent moveDefault = prefab.get().getComponent(CharacterMovementComponent.class);\n+\n+                if (move != null && gazeMountPointComponent != null) {\n+                    float prevHeight = move.height;\n+                    float defaultEyeHeight = config.getPlayer().getEyeHeight();\n+                    float foreHeadSize = moveDefault.height - defaultEyeHeight;\n+                    float ratio = amount / moveDefault.height;\n+\n+                    move.height = amount;\n+                    move.jumpSpeed = getJumpSpeed(ratio);\n+                    move.stepHeight = moveDefault.stepHeight * ratio;\n+                    move.distanceBetweenFootsteps = moveDefault.distanceBetweenFootsteps * ratio;\n+                    move.runFactor = getRunFactor(ratio);\n+                    charComp.interactionRange = getInteractionRange(ratio);\n+                    gazeMountPointComponent.translate.y = amount - foreHeadSize;\n+                    Location.removeChild(player, gazeMountPointComponent.gazeEntity);\n+                    Location.attachChild(player, gazeMountPointComponent.gazeEntity, gazeMountPointComponent.translate, new Quat4f(Quat4f.IDENTITY));\n+\n+                    player.saveComponent(gazeMountPointComponent);", "originalCommit": "0b002b9752840b6ad026fafbda909f418dd9d141", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDg3MDY1Ng==", "url": "https://github.com/MovingBlocks/Terasology/pull/3841#discussion_r410870656", "bodyText": "If we did proper null checks this try-catch block should not be necessary (in general, catching a NPE is always a code smell as you could have done a null-check before).", "author": "skaldarnar", "createdAt": "2020-04-19T10:17:40Z", "path": "engine/src/main/java/org/terasology/logic/debug/MovementDebugCommands.java", "diffHunk": "@@ -233,28 +238,59 @@ public String stepHeight(@Sender EntityRef client, @CommandParam(\"height\") float\n         return \"\";\n     }\n \n+    private float getJumpSpeed(float ratio) {\n+        return (float) Math.pow(ratio, 0.74f) * 6f + 4f;\n+    }\n+\n+    private float getInteractionRange(float ratio) {\n+        return (float) Math.pow(ratio, 0.62f) * 5f;\n+    }\n+\n+    private float getRunFactor(float ratio) {\n+        return (float) Math.pow(ratio, 0.68f) * 1.5f;\n+    }\n+\n     @Command(shortDescription = \"Sets the height of the player\", runOnServer = true,\n             requiredPermission = PermissionManager.CHEAT_PERMISSION)\n     public String playerHeight(@Sender EntityRef client, @CommandParam(\"height\") float amount) {\n-        try {\n-            ClientComponent clientComp = client.getComponent(ClientComponent.class);\n-            CharacterMovementComponent move = clientComp.character.getComponent(CharacterMovementComponent.class);\n-            if (move != null) {\n-                float prevHeight = move.height;\n-                move.height = amount;\n-                clientComp.character.saveComponent(move);\n-                LocationComponent loc = client.getComponent(LocationComponent.class);\n-                Vector3f currentPosition = loc.getWorldPosition();\n-                clientComp.character\n-                        .send(new CharacterTeleportEvent(new Vector3f(currentPosition.getX(), currentPosition.getY() + (amount - prevHeight) / 2, currentPosition.getZ())));\n-                physics.removeCharacterCollider(clientComp.character);\n-                physics.getCharacterCollider(clientComp.character);\n-                return \"Height of player set to \" + amount + \" (was \" + prevHeight + \")\";\n+        if (amount >= 1 && amount <= 25) {\n+            try {\n+                ClientComponent clientComp = client.getComponent(ClientComponent.class);\n+                CharacterMovementComponent move = clientComp.character.getComponent(CharacterMovementComponent.class);\n+                CharacterComponent charComp = clientComp.character.getComponent(CharacterComponent.class);\n+                EntityRef player = clientComp.character;\n+                GazeMountPointComponent gazeMountPointComponent = player.getComponent(GazeMountPointComponent.class);\n+                Optional<Prefab> prefab = Assets.get(new ResourceUrn(\"engine:player\"), Prefab.class);\n+                CharacterMovementComponent moveDefault = prefab.get().getComponent(CharacterMovementComponent.class);\n+\n+                if (move != null && gazeMountPointComponent != null) {\n+                    float prevHeight = move.height;\n+                    float defaultEyeHeight = config.getPlayer().getEyeHeight();\n+                    float foreHeadSize = moveDefault.height - defaultEyeHeight;\n+                    float ratio = amount / moveDefault.height;\n+\n+                    move.height = amount;\n+                    move.jumpSpeed = getJumpSpeed(ratio);\n+                    move.stepHeight = moveDefault.stepHeight * ratio;\n+                    move.distanceBetweenFootsteps = moveDefault.distanceBetweenFootsteps * ratio;\n+                    move.runFactor = getRunFactor(ratio);\n+                    charComp.interactionRange = getInteractionRange(ratio);\n+                    gazeMountPointComponent.translate.y = amount - foreHeadSize;\n+                    Location.removeChild(player, gazeMountPointComponent.gazeEntity);\n+                    Location.attachChild(player, gazeMountPointComponent.gazeEntity, gazeMountPointComponent.translate, new Quat4f(Quat4f.IDENTITY));\n+\n+                    player.saveComponent(gazeMountPointComponent);\n+                    clientComp.character.saveComponent(move);\n+\n+                    return \"Height of player set to \" + amount + \" (was \" + prevHeight + \")\";\n+                }\n+                return \"\";\n+            } catch (NullPointerException e) {", "originalCommit": "0b002b9752840b6ad026fafbda909f418dd9d141", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "cb8015cb7a2c0eb669c880100dcb808fdfb111cf", "url": "https://github.com/MovingBlocks/Terasology/commit/cb8015cb7a2c0eb669c880100dcb808fdfb111cf", "message": "Apply suggestions from code review", "committedDate": "2020-04-19T10:18:31Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDg3Nzk3Ng==", "url": "https://github.com/MovingBlocks/Terasology/pull/3841#discussion_r410877976", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            CharacterComponent characterDefault = playerDefaults.getComponent(CharacterComponent.class)\n          \n          \n            \n                            CharacterComponent characterDefault = playerDefaults.getComponent(CharacterComponent.class);", "author": "skaldarnar", "createdAt": "2020-04-19T10:59:55Z", "path": "engine/src/main/java/org/terasology/logic/debug/MovementDebugCommands.java", "diffHunk": "@@ -233,28 +238,61 @@ public String stepHeight(@Sender EntityRef client, @CommandParam(\"height\") float\n         return \"\";\n     }\n \n+    private float getJumpSpeed(float ratio, float defaultValue) {\n+        return (float) Math.pow(ratio, 0.74f) * 0.4f * defaultValue + 0.6f * defaultValue;\n+    }\n+\n+    private float getInteractionRange(float ratio, float defaultValue) {\n+        return (float) Math.pow(ratio, 0.62f) * defaultValue;\n+    }\n+\n+    private float getRunFactor(float ratio, float defaultValue) {\n+        return (float) Math.pow(ratio, 0.68f) * defaultValue;\n+    }\n+\n     @Command(shortDescription = \"Sets the height of the player\", runOnServer = true,\n             requiredPermission = PermissionManager.CHEAT_PERMISSION)\n     public String playerHeight(@Sender EntityRef client, @CommandParam(\"height\") float amount) {\n-        try {\n-            ClientComponent clientComp = client.getComponent(ClientComponent.class);\n-            CharacterMovementComponent move = clientComp.character.getComponent(CharacterMovementComponent.class);\n-            if (move != null) {\n-                float prevHeight = move.height;\n-                move.height = amount;\n-                clientComp.character.saveComponent(move);\n-                LocationComponent loc = client.getComponent(LocationComponent.class);\n-                Vector3f currentPosition = loc.getWorldPosition();\n-                clientComp.character\n-                        .send(new CharacterTeleportEvent(new Vector3f(currentPosition.getX(), currentPosition.getY() + (amount - prevHeight) / 2, currentPosition.getZ())));\n-                physics.removeCharacterCollider(clientComp.character);\n-                physics.getCharacterCollider(clientComp.character);\n-                return \"Height of player set to \" + amount + \" (was \" + prevHeight + \")\";\n+        if (amount >= 1 && amount <= 25) {\n+            try {\n+                ClientComponent clientComp = client.getComponent(ClientComponent.class);\n+                CharacterMovementComponent move = clientComp.character.getComponent(CharacterMovementComponent.class);\n+                CharacterComponent charComp = clientComp.character.getComponent(CharacterComponent.class);\n+                EntityRef player = clientComp.character;\n+                GazeMountPointComponent gazeMountPointComponent = player.getComponent(GazeMountPointComponent.class);\n+\n+                Prefab playerDefaults = Assets.getPrefab(\"engine:player\").get();\n+                CharacterMovementComponent moveDefault = playerDefaults.getComponent(CharacterMovementComponent.class);\n+                CharacterComponent characterDefault = playerDefaults.getComponent(CharacterComponent.class)", "originalCommit": "cb8015cb7a2c0eb669c880100dcb808fdfb111cf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "3acd3877d481d49142a3c121f19923f03d4f96f1", "url": "https://github.com/MovingBlocks/Terasology/commit/3acd3877d481d49142a3c121f19923f03d4f96f1", "message": "added missed ';'", "committedDate": "2020-04-19T11:00:16Z", "type": "commit"}]}