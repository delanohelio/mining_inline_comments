{"pr_number": 3835, "pr_title": "Gradle upgrade superset including Jenkins work and more!", "pr_createdAt": "2020-02-23T04:43:11Z", "pr_url": "https://github.com/MovingBlocks/Terasology/pull/3835", "timeline": [{"oid": "6bc7adeded1d8c1a8a3b0aae00b1a86504c458b7", "url": "https://github.com/MovingBlocks/Terasology/commit/6bc7adeded1d8c1a8a3b0aae00b1a86504c458b7", "message": "init gradle 6.0", "committedDate": "2019-12-13T18:24:19Z", "type": "commit"}, {"oid": "71b27878d20b0678b5a37938794c78542cedafa7", "url": "https://github.com/MovingBlocks/Terasology/commit/71b27878d20b0678b5a37938794c78542cedafa7", "message": "Fixed templates/build.gradle for using with gradle 6", "committedDate": "2019-12-15T19:12:26Z", "type": "commit"}, {"oid": "9708732703d9f6ea3414f54ecc1c24186d67c818", "url": "https://github.com/MovingBlocks/Terasology/commit/9708732703d9f6ea3414f54ecc1c24186d67c818", "message": "Fix engine build", "committedDate": "2019-12-16T20:43:28Z", "type": "commit"}, {"oid": "a7f50f9dca151dd728a3840d1e1da5a6a6c2967c", "url": "https://github.com/MovingBlocks/Terasology/commit/a7f50f9dca151dd728a3840d1e1da5a6a6c2967c", "message": "Add exclusion for jacoco, mockito generated classes", "committedDate": "2019-12-17T14:55:19Z", "type": "commit"}, {"oid": "dc626d788439ccb48a67f85e7a6c29c065077f7c", "url": "https://github.com/MovingBlocks/Terasology/commit/dc626d788439ccb48a67f85e7a6c29c065077f7c", "message": "Reworked dependencies for \"whitelist\" libraries on compile-time\nand speedup compile", "committedDate": "2019-12-17T14:56:59Z", "type": "commit"}, {"oid": "1f515071c3de9da919a5902d196e6a42deb9e704", "url": "https://github.com/MovingBlocks/Terasology/commit/1f515071c3de9da919a5902d196e6a42deb9e704", "message": "Fix `gradlew game` run with new gradle", "committedDate": "2019-12-17T19:51:36Z", "type": "commit"}, {"oid": "6ad689db5e4e725d1b7986a88343e68f712d27eb", "url": "https://github.com/MovingBlocks/Terasology/commit/6ad689db5e4e725d1b7986a88343e68f712d27eb", "message": "Fix server task\nFix tests after gradle upgrade", "committedDate": "2019-12-18T13:01:45Z", "type": "commit"}, {"oid": "b4d0b7ce1a2c983f07d7febecde559a55b236efe", "url": "https://github.com/MovingBlocks/Terasology/commit/b4d0b7ce1a2c983f07d7febecde559a55b236efe", "message": "Add groups for gradle tasks", "committedDate": "2019-12-18T14:54:36Z", "type": "commit"}, {"oid": "b5193ee611c5b0054769f8f9d0dd4ecd8f0097bf", "url": "https://github.com/MovingBlocks/Terasology/commit/b5193ee611c5b0054769f8f9d0dd4ecd8f0097bf", "message": "Implements gradle's substitute for engine and modules", "committedDate": "2019-12-21T17:40:39Z", "type": "commit"}, {"oid": "0c35953e97639adc1afe9843f3a7ec28f575e311", "url": "https://github.com/MovingBlocks/Terasology/commit/0c35953e97639adc1afe9843f3a7ec28f575e311", "message": "Fix manifestClasspath\nFix gather libraries for distribution\nFix. move -Xmx options to jvmArgs", "committedDate": "2019-12-24T19:06:13Z", "type": "commit"}, {"oid": "9f1e79df34ad241ca59d32d04c1474ec067575cf", "url": "https://github.com/MovingBlocks/Terasology/commit/9f1e79df34ad241ca59d32d04c1474ec067575cf", "message": "Remove configureondemand - it's incubating and don't work with version remapper (FacadeServer cannot building in workspace)", "committedDate": "2020-01-04T15:46:41Z", "type": "commit"}, {"oid": "7f15c303b015ae25859d3c741d5f0edf1879d1c3", "url": "https://github.com/MovingBlocks/Terasology/commit/7f15c303b015ae25859d3c741d5f0edf1879d1c3", "message": "Simplify modules build.gradle\nMove workspace features from module to workspace\nUnify plugin style", "committedDate": "2020-01-09T09:45:30Z", "type": "commit"}, {"oid": "61d355a91a58f33fccc754db25734eb438b57e3c", "url": "https://github.com/MovingBlocks/Terasology/commit/61d355a91a58f33fccc754db25734eb438b57e3c", "message": "Syncronize templates's build.gradle with Core's build.gradle", "committedDate": "2020-01-26T16:33:34Z", "type": "commit"}, {"oid": "2dfd2ae80f2e4cf765eeebeb9915fa0a63ed8ff7", "url": "https://github.com/MovingBlocks/Terasology/commit/2dfd2ae80f2e4cf765eeebeb9915fa0a63ed8ff7", "message": "Add api dependency in engine for Light and Shadow", "committedDate": "2020-01-26T16:34:23Z", "type": "commit"}, {"oid": "5557cf61d4f11e2ff77a7b134cb16aaf72d9b087", "url": "https://github.com/MovingBlocks/Terasology/commit/5557cf61d4f11e2ff77a7b134cb16aaf72d9b087", "message": "Configure gradle's maven-plugin instead artifactory plugin", "committedDate": "2020-01-26T16:35:31Z", "type": "commit"}, {"oid": "b9d10e0df2e2467252b19c48fe498ba26fd2737a", "url": "https://github.com/MovingBlocks/Terasology/commit/b9d10e0df2e2467252b19c48fe498ba26fd2737a", "message": "Rename artifactory.gradle to maven.gradle\nCleanup maven.gradle", "committedDate": "2020-01-26T16:43:50Z", "type": "commit"}, {"oid": "666cbba7fa9b3ec3cf3e4cfcfddc8053d674be73", "url": "https://github.com/MovingBlocks/Terasology/commit/666cbba7fa9b3ec3cf3e4cfcfddc8053d674be73", "message": "Replace deprecated call.", "committedDate": "2020-01-26T16:46:20Z", "type": "commit"}, {"oid": "0a3be99ab3c1c710f74e1c25770e28866b205375", "url": "https://github.com/MovingBlocks/Terasology/commit/0a3be99ab3c1c710f74e1c25770e28866b205375", "message": "Fix auth parameters for remote maven repository", "committedDate": "2020-01-26T16:54:08Z", "type": "commit"}, {"oid": "129c1134a7fd3a68781c3df82f3d5a9c75ce51a9", "url": "https://github.com/MovingBlocks/Terasology/commit/129c1134a7fd3a68781c3df82f3d5a9c75ce51a9", "message": "Merge PR #3806 by @DarkWeird - Gradle 6 upgrade and related", "committedDate": "2020-02-01T19:41:36Z", "type": "commit"}, {"oid": "186b04785d7c04267a0bfaa221e6d434e02cae89", "url": "https://github.com/MovingBlocks/Terasology/commit/186b04785d7c04267a0bfaa221e6d434e02cae89", "message": "Version bump to v3", "committedDate": "2020-02-02T04:29:07Z", "type": "commit"}, {"oid": "3de8958b9b767c2deb26fad558a4874fc6de1555", "url": "https://github.com/MovingBlocks/Terasology/commit/3de8958b9b767c2deb26fad558a4874fc6de1555", "message": "Minor tweaks, cleanup, and an arg fix", "committedDate": "2020-02-02T04:29:07Z", "type": "commit"}, {"oid": "b61970a8b2823f1cce91ecc77efd0168fe42c37c", "url": "https://github.com/MovingBlocks/Terasology/commit/b61970a8b2823f1cce91ecc77efd0168fe42c37c", "message": "Rename `maven.gradle` to `publish.gradle` to clarify. Two minor maybe-fixes", "committedDate": "2020-02-02T04:29:07Z", "type": "commit"}, {"oid": "229311d04674062a0ad5fb378b378554c234e756", "url": "https://github.com/MovingBlocks/Terasology/commit/229311d04674062a0ad5fb378b378554c234e756", "message": "Support redirecting Artifactory repo targeting via env vars (such as defined by a Jenkins Folder)", "committedDate": "2020-02-02T15:53:22Z", "type": "commit"}, {"oid": "eb7dc59875ae845cfbc84c18dd6eaf44fadd8aae", "url": "https://github.com/MovingBlocks/Terasology/commit/eb7dc59875ae845cfbc84c18dd6eaf44fadd8aae", "message": "Helps to set a full URL", "committedDate": "2020-02-02T16:12:21Z", "type": "commit"}, {"oid": "1c10b04395d2b7876f65b2c2d17259b12f0fef43", "url": "https://github.com/MovingBlocks/Terasology/commit/1c10b04395d2b7876f65b2c2d17259b12f0fef43", "message": "Matching version here to the general engine number", "committedDate": "2020-02-02T16:36:23Z", "type": "commit"}, {"oid": "e6ec9ad6a19673aef2003337d1df3960bf7d2416", "url": "https://github.com/MovingBlocks/Terasology/commit/e6ec9ad6a19673aef2003337d1df3960bf7d2416", "message": "Experimental Jenkinsfile", "committedDate": "2020-02-02T16:36:44Z", "type": "commit"}, {"oid": "b7f1c3cab743211b270ac2508687435a9a615154", "url": "https://github.com/MovingBlocks/Terasology/commit/b7f1c3cab743211b270ac2508687435a9a615154", "message": "Some build dirs changed", "committedDate": "2020-02-15T23:35:42Z", "type": "commit"}, {"oid": "f7c126fc8e3b210df6ab9a7dcb4cf83196ee32f8", "url": "https://github.com/MovingBlocks/Terasology/commit/f7c126fc8e3b210df6ab9a7dcb4cf83196ee32f8", "message": "Improve gradle.properties template and tweak Jenkins more", "committedDate": "2020-02-15T23:51:55Z", "type": "commit"}, {"oid": "ff180b2fcac31aab7b999be695954abb665d2d30", "url": "https://github.com/MovingBlocks/Terasology/commit/ff180b2fcac31aab7b999be695954abb665d2d30", "message": "Expose JOML as a package to modules", "committedDate": "2020-02-16T17:48:56Z", "type": "commit"}, {"oid": "40a00823dec2888a93de7bccadc06068ec71cc3c", "url": "https://github.com/MovingBlocks/Terasology/commit/40a00823dec2888a93de7bccadc06068ec71cc3c", "message": "Bump to TeraConfig over a Checkstyle config issue", "committedDate": "2020-02-22T22:04:37Z", "type": "commit"}, {"oid": "e764c59efabd22ec0499558f8108a080e31b76d9", "url": "https://github.com/MovingBlocks/Terasology/commit/e764c59efabd22ec0499558f8108a080e31b76d9", "message": "Merge Gradle rework\n\n# Conflicts:\n#\tengine/build.gradle", "committedDate": "2020-02-22T22:15:07Z", "type": "commit"}, {"oid": "84dbc8e22d363e80bf981839359a15141737d004", "url": "https://github.com/MovingBlocks/Terasology/commit/84dbc8e22d363e80bf981839359a15141737d004", "message": "Merge PR #3833 by @sin3point14 - whitelist JOML for modules", "committedDate": "2020-02-22T23:23:01Z", "type": "commit"}, {"oid": "740d76a5dd850e436bb50c97cdc4b363c0ad6f72", "url": "https://github.com/MovingBlocks/Terasology/commit/740d76a5dd850e436bb50c97cdc4b363c0ad6f72", "message": "Add sin3point14 to game credits", "committedDate": "2020-02-22T23:23:45Z", "type": "commit"}, {"oid": "2ecb0d274a7b377d0702932aa3bf59c889824616", "url": "https://github.com/MovingBlocks/Terasology/commit/2ecb0d274a7b377d0702932aa3bf59c889824616", "message": "Minor tidying", "committedDate": "2020-02-22T23:49:56Z", "type": "commit"}, {"oid": "0e279fc37e2487aa045e4488c8a9332b61fa0207", "url": "https://github.com/MovingBlocks/Terasology/commit/0e279fc37e2487aa045e4488c8a9332b61fa0207", "message": "Plugin version issue - rely on Gradle default", "committedDate": "2020-02-23T02:48:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzAyNzQwNw==", "url": "https://github.com/MovingBlocks/Terasology/pull/3835#discussion_r383027407", "bodyText": "This block appears to be what can cause a stall with gradlew idea when org.gradle.parallel=true is set in gradle.properties - FYI @DarkWeird\nIf I comment this block out then the stall doesn't happen (but I'd assume module dependencies won't work). Probably relates to multiple threads working different modules for the ideaModule task yet this block iterates through all modules and for each goes and looks for every other module and substitutes stuff? That seems a classic case for ConcurrentModificationException being thrown when working with a Map just to come up with a possibly similar example :-)\nWe could still merge and advise to keep parallel processing off, with the intent to later get rid of gradlew idea entirely - but there could be a possibility of similar stalls in other Gradle logic that needs to iterate over modules?\nRunning Gradle in parallel mode is nice for efficiency but probably not really high priority yet. Could be more of an optimization thing to review later :-)", "author": "Cervator", "createdAt": "2020-02-23T18:29:46Z", "path": "build.gradle", "diffHunk": "@@ -185,16 +183,104 @@ clean.doLast {\n     println \"Cleaned root - don't forget to re-extract stuff! 'gradlew extractNatives extractConfig' will do so, or 'gradlew idea' (or eclipse)\"\n }\n \n-task protobufCompileWindows(type:Exec) {\n+task protobufCompileWindows(type: Exec) {\n     description = \"Run 'Protobuf Compiler' (Windows)\"\n     commandLine 'protobuf\\\\compiler\\\\protoc.exe', '--proto_path=engine\\\\src\\\\main\\\\protobuf', '--java_out', 'engine\\\\src\\\\main\\\\java', 'engine\\\\src\\\\main\\\\protobuf\\\\*'\n }\n \n-task protobufCompileLinux(type:Exec) {\n+task protobufCompileLinux(type: Exec) {\n     description = \"Run 'Protobuf Compiler' (Linux)\"\n     commandLine 'protobuf/compiler/protoc', '--proto_path=engine/src/main/protobuf', '--java_out', 'engine/src/main/java', \"engine/src/main/protobuf/EntityData.proto\", \"engine/src/main/protobuf/NetMessage.proto\"\n }\n \n+\n+\n+// Magic for replace remote dependency on local project (source)\n+// for Engine\n+allprojects {\n+    configurations.all {\n+        resolutionStrategy.dependencySubstitution {\n+            substitute module(\"org.terasology.engine:engine\") because \"we have sources!\" with project(\":engine\")\n+            substitute module(\"org.terasology.engine:engine-tests\") because \"we have sources!\" with project(\":engine-tests\")\n+        }\n+    }\n+}\n+\n+// Magic for replace remote dependency on local project (source)\n+// For exists modules\n+project(\":modules\").subprojects.forEach { proj ->", "originalCommit": "0e279fc37e2487aa045e4488c8a9332b61fa0207", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}