{"pr_number": 3918, "pr_title": "feat: Particle System Gen./Aff. Registration", "pr_createdAt": "2020-04-30T04:28:23Z", "pr_url": "https://github.com/MovingBlocks/Terasology/pull/3918", "timeline": [{"oid": "92a4d7fe171a4476dd69e7acfbf3ea5eeb1d9d9b", "url": "https://github.com/MovingBlocks/Terasology/commit/92a4d7fe171a4476dd69e7acfbf3ea5eeb1d9d9b", "message": "Tweaked and removed unused classes and resolved comments from @eviltak\n\ncommit e59df8debb9ee42d9c6fd1e3ea5774bbdf8db8c8\nAuthor: Max <maximborsch@gmail.com>\nDate:   Tue Jan 16 21:47:53 2018 -0500\n\n    PS Generator/Affector Annotation registration & refac.\n\ncommit ccd59051f735e393cb6ccc3c1611fff6e525ac3d\nAuthor: Max <maximborsch@gmail.com>\nDate:   Tue Jan 16 21:47:53 2018 -0500\n\n    PS Generator/Affector Annotation registration & refac.\n\ncommit f2c0c6c582e693e3a398147e9cf56f5d01ed787f\nAuthor: Max <maximborsch@gmail.com>\nDate:   Tue Jan 2 20:09:23 2018 -0500\n\n    Particle javadocs & gitignore fix\n\ncommit c658058c01bd32a9345a2e126eb99158ada9237e\nAuthor: Max <maximborsch@gmail.com>\nDate:   Tue Jan 2 13:35:51 2018 -0500\n\n    Particle System Javadocs\n\ncommit 732ed55f9278d121117bda1dc8167879db5a2be9\nAuthor: Max <maximborsch@gmail.com>\nDate:   Wed Dec 20 17:56:15 2017 -0500\n\n    facade.groovy", "committedDate": "2020-04-30T04:26:09Z", "type": "commit"}, {"oid": "717bb9135244e2760bee7443dfe90c9500e6c517", "url": "https://github.com/MovingBlocks/Terasology/commit/717bb9135244e2760bee7443dfe90c9500e6c517", "message": "fixed unit test", "committedDate": "2020-04-30T20:33:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODY1ODg2Mw==", "url": "https://github.com/MovingBlocks/Terasology/pull/3918#discussion_r418658863", "bodyText": "Is there any way to ensure that a specific class can only have two sub-classes? This code relies on the fact that a ParticleSystemFunction is either a GeneratorFunction  or a AffectorFunction ...", "author": "skaldarnar", "createdAt": "2020-05-01T17:55:13Z", "path": "engine/src/main/java/org/terasology/particles/updating/ParticleUpdaterImpl.java", "diffHunk": "@@ -107,9 +127,38 @@ public void update(final float delta) {\n     }\n \n     @Override\n-    public void configureEmitter(final ParticleEmitterComponent emitter,\n-                                 final BiMap<Class<Component>, AffectorFunction> registeredAffectorFunctions,\n-                                 final BiMap<Class<Component>, GeneratorFunction> registeredGeneratorFunctions) {\n+    public void initialize() {\n+        ModuleEnvironment environment = moduleManager.getEnvironment();\n+\n+        for (Class<?> type : environment.getTypesAnnotatedWith(RegisterParticleSystemFunction.class)) {\n+            RegisterParticleSystemFunction annotation = type.getAnnotation(RegisterParticleSystemFunction.class);\n+\n+            if (!ParticleSystemFunction.class.isAssignableFrom(type)) {\n+                logger.error(\"Cannot register particle system function {}, must be a subclass of ParticleSystemFunction\", type.getSimpleName());\n+            } else {\n+                try {\n+                    ParticleSystemFunction function = (ParticleSystemFunction) type.newInstance();", "originalCommit": "717bb9135244e2760bee7443dfe90c9500e6c517", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODY2MTM2NQ==", "url": "https://github.com/MovingBlocks/Terasology/pull/3918#discussion_r418661365", "bodyText": "I'm not quite sure I follow", "author": "pollend", "createdAt": "2020-05-01T18:00:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODY1ODg2Mw=="}], "type": "inlineReview"}]}