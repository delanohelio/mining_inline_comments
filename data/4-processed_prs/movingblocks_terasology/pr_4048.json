{"pr_number": 4048, "pr_title": "feat/nui-extraction branch: Make the game playable again", "pr_createdAt": "2020-06-13T19:02:53Z", "pr_url": "https://github.com/MovingBlocks/Terasology/pull/4048", "timeline": [{"oid": "b8698f3bffe55b8a1ec7772dba838a5c08302c9c", "url": "https://github.com/MovingBlocks/Terasology/commit/b8698f3bffe55b8a1ec7772dba838a5c08302c9c", "message": "Converted Terasology UI widgets to JOML. Fixed crash on game start.\n\nTemporarily introduced MouseDevice.getMousePosition to fix JOML TeraMath incompatibilities.", "committedDate": "2020-06-13T10:50:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc3MjQ2MQ==", "url": "https://github.com/MovingBlocks/Terasology/pull/4048#discussion_r439772461", "bodyText": "Oh, I see. The old getPosition was a TeraMath.Vector2i and this is a joml.Vector2i.\nAnd this method matches both the name and the type of the one in nui-input's MouseDevice. Okay. \ud83d\udc4d", "author": "keturn", "createdAt": "2020-06-13T21:59:44Z", "path": "engine/src/main/java/org/terasology/input/lwjgl/LwjglMouseDevice.java", "diffHunk": "@@ -49,6 +50,12 @@ public Vector2i getPosition() {\n         return new Vector2i(Mouse.getX() / this.uiScale, (Display.getHeight() - Mouse.getY()) / this.uiScale);\n     }\n \n+    // TODO: Remove when nui-input is fully integrated\n+    @Override\n+    public org.joml.Vector2i getMousePosition() {\n+        return JomlUtil.from(getPosition());", "originalCommit": "b8698f3bffe55b8a1ec7772dba838a5c08302c9c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc3NDY1Nw==", "url": "https://github.com/MovingBlocks/Terasology/pull/4048#discussion_r439774657", "bodyText": "I'm worried about this one. If we skip over setting up this up here, when will it get done?\nI'd want to either fix whatever is supposed to set those bindings so it reliably runs before we get here, or move this to a callback or event handler that is called once the bindsManager is all configured.", "author": "keturn", "createdAt": "2020-06-13T22:42:04Z", "path": "engine/src/main/java/org/terasology/rendering/nui/internal/NUIManagerInternal.java", "diffHunk": "@@ -145,7 +145,10 @@ public NUIManagerInternal(TerasologyCanvasRenderer renderer, Context context) {\n         TabbingManager.setFocusManager(this);\n \n         // NOTE: Fix for tests\n-        if (bindsManager != null) {\n+        if (bindsManager != null\n+                && bindsManager.getBindsConfig().hasBinds(new SimpleUri(\"engine:tabbingUI\"))\n+                && bindsManager.getBindsConfig().hasBinds(new SimpleUri(\"engine:tabbingModifier\"))\n+                && bindsManager.getBindsConfig().hasBinds(new SimpleUri(\"engine:activate\"))) {", "originalCommit": "b8698f3bffe55b8a1ec7772dba838a5c08302c9c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}