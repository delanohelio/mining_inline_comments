{"pr_number": 12485, "pr_title": "Cherry picks of Log Viewer changes for release/6.1", "pr_createdAt": "2020-07-22T22:04:16Z", "pr_url": "https://github.com/cdapio/cdap/pull/12485", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTUwMzUyMg==", "url": "https://github.com/cdapio/cdap/pull/12485#discussion_r459503522", "bodyText": "Should this be !isPolling?", "author": "yukiej", "createdAt": "2020-07-23T14:43:43Z", "path": "cdap-ui/app/cdap/components/LogViewer/TopPanel.tsx", "diffHunk": "@@ -0,0 +1,154 @@\n+/*\n+ * Copyright \u00a9 2020 Cask Data, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+import * as React from 'react';\n+import withStyles, { WithStyles, StyleRules } from '@material-ui/core/styles/withStyles';\n+import DataFetcher from 'components/LogViewer/DataFetcher';\n+import Button from '@material-ui/core/Button';\n+import FormControlLabel from '@material-ui/core/FormControlLabel';\n+import Checkbox from '@material-ui/core/Checkbox';\n+import classnames from 'classnames';\n+\n+export const TOP_PANEL_HEIGHT = '50px';\n+\n+const styles = (theme): StyleRules => {\n+  return {\n+    root: {\n+      backgroundColor: theme.palette.grey[100],\n+      color: theme.palette.white[50],\n+      display: 'flex',\n+      justifyContent: 'flex-end',\n+      alignItems: 'center',\n+      height: TOP_PANEL_HEIGHT,\n+      paddingLeft: '20px',\n+      paddingRight: '20px',\n+      position: 'relative',\n+    },\n+    actionButton: {\n+      margin: theme.spacing(1),\n+\n+      '&:hover': {\n+        color: theme.palette.white[50],\n+        borderColor: theme.palette.white[50],\n+        backgroundColor: theme.palette.grey[200],\n+      },\n+\n+      '&$disabled': {\n+        // needed to beat specificity\n+        color: theme.palette.grey[50],\n+        cursor: 'not-allowed',\n+        backgroundColor: theme.palette.white[50],\n+      },\n+    },\n+    disabled: {},\n+    checkboxContainer: {\n+      margin: '0 40px',\n+      userSelect: 'none',\n+    },\n+    checkbox: {\n+      color: theme.palette.white[50],\n+    },\n+  };\n+};\n+\n+interface ITopPanelProps extends WithStyles<typeof styles> {\n+  dataFetcher: DataFetcher;\n+  isPolling: boolean;\n+  getLatestLogs: () => void;\n+  setSystemLogs: (includeSystemLogs: boolean) => void;\n+}\n+\n+const TopPanelView: React.FC<ITopPanelProps> = ({\n+  classes,\n+  dataFetcher,\n+  isPolling,\n+  getLatestLogs,\n+  setSystemLogs,\n+}) => {\n+  const [includeSystemLogs, setLocalIncludeSystemLogs] = React.useState(\n+    dataFetcher.getIncludeSystemLogs()\n+  );\n+\n+  function getRawLogsBasePath() {\n+    const backendUrl = dataFetcher.getRawLogsUrl();\n+    const encodedBackendUrl = encodeURIComponent(backendUrl);\n+\n+    const url = `/downloadLogs?backendPath=${encodedBackendUrl}`;\n+    return url;\n+  }\n+\n+  function getRawLogsUrl() {\n+    return `${getRawLogsBasePath()}&type=raw`;\n+  }\n+\n+  function getDownloadLogsUrl() {\n+    const fileName = dataFetcher.getDownloadFileName();\n+    return `${getRawLogsBasePath()}&type=download&filename=${fileName}.log`;\n+  }\n+\n+  function handleToggleSystemLogs() {\n+    const newState = !includeSystemLogs;\n+    setLocalIncludeSystemLogs(newState);\n+    setSystemLogs(newState);\n+  }\n+\n+  return (\n+    <div className={classes.root}>\n+      <FormControlLabel\n+        control={\n+          <Checkbox\n+            checked={includeSystemLogs}\n+            onChange={handleToggleSystemLogs}\n+            color=\"default\"\n+            className={classes.checkbox}\n+          />\n+        }\n+        label=\"Include System Logs\"\n+        className={classes.checkboxContainer}\n+      />\n+\n+      <Button\n+        variant=\"outlined\"\n+        color=\"inherit\"\n+        className={classnames(classes.actionButton, { [classes.disabled]: isPolling })}\n+        disabled={isPolling}", "originalCommit": "9ca8d115d8b7e67c77dd8f451c5724bb39704ae4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTU2NDQ3NQ==", "url": "https://github.com/cdapio/cdap/pull/12485#discussion_r459564475", "bodyText": "we want to disable the Get Latest Logs when it is currently polling, since Get Latest Logs is the mechanism where the user can restart the poll.", "author": "elfenheart", "createdAt": "2020-07-23T16:09:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTUwMzUyMg=="}], "type": "inlineReview"}, {"oid": "796e6ba407cb323536ee2f3c57cc79770f6d7e09", "url": "https://github.com/cdapio/cdap/commit/796e6ba407cb323536ee2f3c57cc79770f6d7e09", "message": "[CDAP-16981] LogViewer add Data Fetcher layer", "committedDate": "2020-07-23T16:10:29Z", "type": "commit"}, {"oid": "574c9641fb21ce2fd835830a146f093b51f009fa", "url": "https://github.com/cdapio/cdap/commit/574c9641fb21ce2fd835830a146f093b51f009fa", "message": "[CDAP-16980] Add LogViewer Renderer", "committedDate": "2020-07-23T16:10:29Z", "type": "commit"}, {"oid": "eb83109148c78783b154cd6f0d85ba52745a2ed1", "url": "https://github.com/cdapio/cdap/commit/eb83109148c78783b154cd6f0d85ba52745a2ed1", "message": "[CDAP-17025] Add new LogViewer to pipeline detail page", "committedDate": "2020-07-23T16:10:30Z", "type": "commit"}, {"oid": "8d1a2fc891b364d6afd547a33b0ac8163b30d40f", "url": "https://github.com/cdapio/cdap/commit/8d1a2fc891b364d6afd547a33b0ac8163b30d40f", "message": "[CDAP-17026] Add new LogViewer to Pipeline Preview", "committedDate": "2020-07-23T16:11:17Z", "type": "commit"}, {"oid": "81d7eb51ca801bb80a293a35f60201cc8abcb765", "url": "https://github.com/cdapio/cdap/commit/81d7eb51ca801bb80a293a35f60201cc8abcb765", "message": "[CDAP-17075] Add single page Log Viewer", "committedDate": "2020-07-23T16:11:21Z", "type": "commit"}, {"oid": "975e20a80f328e45bfa5e966bc0e912e0bad687a", "url": "https://github.com/cdapio/cdap/commit/975e20a80f328e45bfa5e966bc0e912e0bad687a", "message": "Remove old log viewer components", "committedDate": "2020-07-23T16:11:21Z", "type": "commit"}, {"oid": "61f1efbf77613f65cc9ebb322d9c3d6407e4f4a0", "url": "https://github.com/cdapio/cdap/commit/61f1efbf77613f65cc9ebb322d9c3d6407e4f4a0", "message": "fix log viewer discrepancy for cherry-picks", "committedDate": "2020-07-23T16:11:22Z", "type": "commit"}, {"oid": "61f1efbf77613f65cc9ebb322d9c3d6407e4f4a0", "url": "https://github.com/cdapio/cdap/commit/61f1efbf77613f65cc9ebb322d9c3d6407e4f4a0", "message": "fix log viewer discrepancy for cherry-picks", "committedDate": "2020-07-23T16:11:22Z", "type": "forcePushed"}]}