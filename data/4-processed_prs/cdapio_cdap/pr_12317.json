{"pr_number": 12317, "pr_title": "[CDAP-16960] Preview error handling", "pr_createdAt": "2020-06-12T15:36:09Z", "pr_url": "https://github.com/cdapio/cdap/pull/12317", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMxNTY2OA==", "url": "https://github.com/cdapio/cdap/pull/12317#discussion_r440315668", "bodyText": "If the utility function is generic enough we need to pull it out. Its hard to track this change tomorrow if something changes in replicator.", "author": "ajainarayanan", "createdAt": "2020-06-15T16:56:21Z", "path": "cdap-ui/app/cdap/components/PreviewData/index.tsx", "diffHunk": "@@ -25,6 +25,11 @@ import { messageTextStyle } from 'components/PreviewData/Table';\n import PreviewTableContainer from 'components/PreviewData/TableContainer';\n import withStyles, { WithStyles } from '@material-ui/core/styles/withStyles';\n import ThemeWrapper from 'components/ThemeWrapper';\n+import T from 'i18n-react';\n+import { extractErrorMessage } from 'components/Replicator/utilities';", "originalCommit": "0ac6fb7761542e2ff881c3bc78fdc03f9f3cec72", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDUyNzYwMQ==", "url": "https://github.com/cdapio/cdap/pull/12317#discussion_r440527601", "bodyText": "That's reasonable. Where would you suggest putting the utility function?", "author": "yukiej", "createdAt": "2020-06-16T01:01:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMxNTY2OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDkxNDMwOA==", "url": "https://github.com/cdapio/cdap/pull/12317#discussion_r440914308", "bodyText": "Moved to services/helpers, as per our conversation", "author": "yukiej", "createdAt": "2020-06-16T14:53:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMxNTY2OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMxNzM2OA==", "url": "https://github.com/cdapio/cdap/pull/12317#discussion_r440317368", "bodyText": "Since we are not sure where the error message will reside (error.response or errror.response.message) can we check if its an object and avoid rendering object in the DOM? It will break the entire app.", "author": "ajainarayanan", "createdAt": "2020-06-15T16:59:13Z", "path": "cdap-ui/app/cdap/components/PreviewData/index.tsx", "diffHunk": "@@ -97,26 +105,42 @@ const PreviewDataViewBase: React.FC<IPreviewDataViewProps> = ({\n   const tableData: ITableData = getTableData();\n \n   const loadingMsg = (cls) => (\n-    <div className={classes.headingContainer}>\n-      <Heading type={HeadingTypes.h3} label={'Fetching preview data'} className={cls.messageText} />\n+    <div className={cls.headingContainer}>\n+      <Heading\n+        type={HeadingTypes.h3}\n+        label={T.translate(`${I18N_PREFIX}.loading`)}\n+        className={cls.messageText}\n+      />\n       <LoadingSVGCentered />\n     </div>\n   );\n \n   const noPreviewDataMsg = (cls) => (\n-    <div className={classes.headingContainer}>\n+    <div className={cls.headingContainer}>\n+      <Heading\n+        type={HeadingTypes.h3}\n+        label={T.translate(`${I18N_PREFIX}.runPreview`)}\n+        className={cls.messageText}\n+      />\n+    </div>\n+  );\n+\n+  const errorMsg = (cls) => (\n+    <div className={classnames('text-danger', cls.headingContainer)}>\n       <Heading\n         type={HeadingTypes.h3}\n-        label={'Run preview to generate preview data.'}\n+        label={T.translate(`${I18N_PREFIX}.errorHeader`)}\n         className={cls.messageText}\n       />\n+      <span>{error}</span>", "originalCommit": "0ac6fb7761542e2ff881c3bc78fdc03f9f3cec72", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDUxNjIxNw==", "url": "https://github.com/cdapio/cdap/pull/12317#discussion_r440516217", "bodyText": "nit: sort", "author": "elfenheart", "createdAt": "2020-06-16T00:20:13Z", "path": "cdap-ui/app/cdap/text/text-en.yaml", "diffHunk": "@@ -2410,7 +2410,10 @@ features:\n       viewNamespace: View pipelines in namespace\n     viewPipeline: View Pipeline\n   PreviewData:\n-    Table:\n+    loading: Fetching preview data\n+    errorHeader: Error fetching preview data. Please try re-running preview. ", "originalCommit": "0ac6fb7761542e2ff881c3bc78fdc03f9f3cec72", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDUyNzkxMQ==", "url": "https://github.com/cdapio/cdap/pull/12317#discussion_r440527911", "bodyText": "sorted!", "author": "yukiej", "createdAt": "2020-06-16T01:02:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDUxNjIxNw=="}], "type": "inlineReview"}, {"oid": "b8f33ca540f1333aed31aff9011d0d1a88ee13bd", "url": "https://github.com/cdapio/cdap/commit/b8f33ca540f1333aed31aff9011d0d1a88ee13bd", "message": "Address feedback and move error parsing to services/helpers", "committedDate": "2020-06-16T16:04:42Z", "type": "forcePushed"}, {"oid": "d5ae3a6dec69afdfff87d07dc383af81b9b36de6", "url": "https://github.com/cdapio/cdap/commit/d5ae3a6dec69afdfff87d07dc383af81b9b36de6", "message": "Address feedback and move error parsing to services/helpers", "committedDate": "2020-06-16T16:06:26Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTAwMzA2OQ==", "url": "https://github.com/cdapio/cdap/pull/12317#discussion_r441003069", "bodyText": "Can this use the extract error message?", "author": "elfenheart", "createdAt": "2020-06-16T16:57:19Z", "path": "cdap-ui/app/cdap/components/PreviewData/index.tsx", "diffHunk": "@@ -97,26 +105,42 @@ const PreviewDataViewBase: React.FC<IPreviewDataViewProps> = ({\n   const tableData: ITableData = getTableData();\n \n   const loadingMsg = (cls) => (\n-    <div className={classes.headingContainer}>\n-      <Heading type={HeadingTypes.h3} label={'Fetching preview data'} className={cls.messageText} />\n+    <div className={cls.headingContainer}>\n+      <Heading\n+        type={HeadingTypes.h3}\n+        label={T.translate(`${I18N_PREFIX}.loading`)}\n+        className={cls.messageText}\n+      />\n       <LoadingSVGCentered />\n     </div>\n   );\n \n   const noPreviewDataMsg = (cls) => (\n-    <div className={classes.headingContainer}>\n+    <div className={cls.headingContainer}>\n+      <Heading\n+        type={HeadingTypes.h3}\n+        label={T.translate(`${I18N_PREFIX}.runPreview`)}\n+        className={cls.messageText}\n+      />\n+    </div>\n+  );\n+\n+  const errorMsg = (cls) => (\n+    <div className={classnames('text-danger', cls.headingContainer)}>\n       <Heading\n         type={HeadingTypes.h3}\n-        label={'Run preview to generate preview data.'}\n+        label={T.translate(`${I18N_PREFIX}.errorHeader`)}\n         className={cls.messageText}\n       />\n+      <span>{typeof error === 'string' ? error : JSON.stringify(error)}</span>", "originalCommit": "d5ae3a6dec69afdfff87d07dc383af81b9b36de6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTEyNDkyNw==", "url": "https://github.com/cdapio/cdap/pull/12317#discussion_r441124927", "bodyText": "Resolved offline.", "author": "yukiej", "createdAt": "2020-06-16T20:33:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTAwMzA2OQ=="}], "type": "inlineReview"}, {"oid": "6c1798d7b375550a796df3d58a257ed871ab022b", "url": "https://github.com/cdapio/cdap/commit/6c1798d7b375550a796df3d58a257ed871ab022b", "message": "Add error handling backend returns error while fetching preview and i18n for previewData messages", "committedDate": "2020-06-16T20:35:46Z", "type": "commit"}, {"oid": "6c1798d7b375550a796df3d58a257ed871ab022b", "url": "https://github.com/cdapio/cdap/commit/6c1798d7b375550a796df3d58a257ed871ab022b", "message": "Add error handling backend returns error while fetching preview and i18n for previewData messages", "committedDate": "2020-06-16T20:35:46Z", "type": "forcePushed"}]}