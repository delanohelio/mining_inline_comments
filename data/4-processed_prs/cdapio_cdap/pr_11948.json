{"pr_number": 11948, "pr_title": "Add getInputStages API", "pr_createdAt": "2020-03-11T20:49:39Z", "pr_url": "https://github.com/cdapio/cdap/pull/11948", "timeline": [{"oid": "2440d16234243a02ee5174e3cde5ac6f4ae98cc6", "url": "https://github.com/cdapio/cdap/commit/2440d16234243a02ee5174e3cde5ac6f4ae98cc6", "message": "[CDAP-16324] Serialize NULLs in StageSpec", "committedDate": "2020-03-18T07:17:51Z", "type": "forcePushed"}, {"oid": "398aa87c6db457168ee771dc00b2cdd5a49c71da", "url": "https://github.com/cdapio/cdap/commit/398aa87c6db457168ee771dc00b2cdd5a49c71da", "message": "[CDAP-16324] Serialize NULLs in StageSpec", "committedDate": "2020-03-18T07:20:52Z", "type": "forcePushed"}, {"oid": "59835869f890866103143347b3cbae79f1269838", "url": "https://github.com/cdapio/cdap/commit/59835869f890866103143347b3cbae79f1269838", "message": "[CDAP-16324] Serialize NULLs in StageSpec", "committedDate": "2020-03-18T08:22:26Z", "type": "forcePushed"}, {"oid": "49b64195746bc30144592a5e73502a786b59c09e", "url": "https://github.com/cdapio/cdap/commit/49b64195746bc30144592a5e73502a786b59c09e", "message": "[CDAP-16324] Add getInputStages API", "committedDate": "2020-03-20T06:23:14Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjY5MTQ5OA==", "url": "https://github.com/cdapio/cdap/pull/11948#discussion_r396691498", "bodyText": "Will it ever be null?? For stage that doesn't have input (source?), it should be just an empty list, not null.", "author": "chtyim", "createdAt": "2020-03-23T19:08:09Z", "path": "cdap-app-templates/cdap-etl/cdap-etl-core/src/main/java/io/cdap/cdap/etl/common/DefaultStageConfigurer.java", "diffHunk": "@@ -75,6 +77,12 @@ public void setOutputSchemas(Map<String, Schema> outputSchemas) {\n     return inputSchemas;\n   }\n \n+  @Nullable", "originalCommit": "49b64195746bc30144592a5e73502a786b59c09e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njg4NTM4Mg==", "url": "https://github.com/cdapio/cdap/pull/11948#discussion_r396885382", "bodyText": "removed Nullable annotation.", "author": "rmstar", "createdAt": "2020-03-24T03:37:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjY5MTQ5OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjY5MjU0MA==", "url": "https://github.com/cdapio/cdap/pull/11948#discussion_r396692540", "bodyText": "This seems a bit unsafe to me. The original problem was that the schemas map keyset doesn't contains all input stages. And now we are using the same keyset to construct the input stages list?\nI think it is better to have the stage names pass in explicitly (probably with a fallback to the schemas keyset for backward compatibility when deserializing from older spec).", "author": "chtyim", "createdAt": "2020-03-23T19:10:08Z", "path": "cdap-app-templates/cdap-etl/cdap-etl-proto/src/main/java/io/cdap/cdap/etl/proto/v2/spec/StageSpec.java", "diffHunk": "@@ -53,6 +56,7 @@ private StageSpec(String name, PluginSpec plugin, Map<String, Schema> inputSchem\n     this.name = name;\n     this.plugin = plugin;\n     this.inputSchemas = Collections.unmodifiableMap(inputSchemas);\n+    this.inputStages = Lists.newArrayList(inputSchemas.keySet());", "originalCommit": "49b64195746bc30144592a5e73502a786b59c09e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njg2MjUyNA==", "url": "https://github.com/cdapio/cdap/pull/11948#discussion_r396862524", "bodyText": "fixed.", "author": "rmstar", "createdAt": "2020-03-24T02:03:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjY5MjU0MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc2MDA5OQ==", "url": "https://github.com/cdapio/cdap/pull/11948#discussion_r396760099", "bodyText": "get a list of input stage names.", "author": "CuriousVini", "createdAt": "2020-03-23T21:13:14Z", "path": "cdap-app-templates/cdap-etl/cdap-etl-api/src/main/java/io/cdap/cdap/etl/api/MultiInputStageConfigurer.java", "diffHunk": "@@ -35,6 +36,13 @@\n    */\n   Map<String, Schema> getInputSchemas();\n \n+  /**\n+   * get the of input stage names", "originalCommit": "49b64195746bc30144592a5e73502a786b59c09e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njg2MjQ4OA==", "url": "https://github.com/cdapio/cdap/pull/11948#discussion_r396862488", "bodyText": "fixed.", "author": "rmstar", "createdAt": "2020-03-24T02:03:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc2MDA5OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc2MjUwMw==", "url": "https://github.com/cdapio/cdap/pull/11948#discussion_r396762503", "bodyText": "better use Collections.unmodifiableList()", "author": "CuriousVini", "createdAt": "2020-03-23T21:17:53Z", "path": "cdap-app-templates/cdap-etl/cdap-etl-proto/src/main/java/io/cdap/cdap/etl/proto/v2/spec/StageSpec.java", "diffHunk": "@@ -53,6 +56,7 @@ private StageSpec(String name, PluginSpec plugin, Map<String, Schema> inputSchem\n     this.name = name;\n     this.plugin = plugin;\n     this.inputSchemas = Collections.unmodifiableMap(inputSchemas);\n+    this.inputStages = Lists.newArrayList(inputSchemas.keySet());", "originalCommit": "49b64195746bc30144592a5e73502a786b59c09e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njg2MzM1Ng==", "url": "https://github.com/cdapio/cdap/pull/11948#discussion_r396863356", "bodyText": "this code has been removed, but in the fallback path , I'm using ImmutableList.copyOf.", "author": "rmstar", "createdAt": "2020-03-24T02:06:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc2MjUwMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzAxMzMyMA==", "url": "https://github.com/cdapio/cdap/pull/11948#discussion_r397013320", "bodyText": "Why need a Multiset for equals? Because we can contains duplicates in input stages?", "author": "chtyim", "createdAt": "2020-03-24T09:32:37Z", "path": "cdap-app-templates/cdap-etl/cdap-etl-proto/src/main/java/io/cdap/cdap/etl/proto/v2/spec/StageSpec.java", "diffHunk": "@@ -118,6 +133,7 @@ public boolean equals(Object o) {\n     return Objects.equals(name, that.name) &&\n       Objects.equals(plugin, that.plugin) &&\n       Objects.equals(inputSchemas, that.inputSchemas) &&\n+      Objects.equals(HashMultiset.create(inputStages), HashMultiset.create(that.inputStages)) &&", "originalCommit": "27ac8459e6d9643e9cb1e16966bd7251dd7cfec2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzI4NjAyNg==", "url": "https://github.com/cdapio/cdap/pull/11948#discussion_r397286026", "bodyText": "yes, it's handle duplicates input stage names (not sure if that can actually happen).", "author": "rmstar", "createdAt": "2020-03-24T16:22:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzAxMzMyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzM2OTE0OA==", "url": "https://github.com/cdapio/cdap/pull/11948#discussion_r397369148", "bodyText": "changed MultiSet -> Set", "author": "rmstar", "createdAt": "2020-03-24T18:22:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzAxMzMyMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzM4NDA1NQ==", "url": "https://github.com/cdapio/cdap/pull/11948#discussion_r397384055", "bodyText": "You can use the Standard Java API new HashSet<>(inputStages).", "author": "chtyim", "createdAt": "2020-03-24T18:47:12Z", "path": "cdap-app-templates/cdap-etl/cdap-etl-proto/src/main/java/io/cdap/cdap/etl/proto/v2/spec/StageSpec.java", "diffHunk": "@@ -118,6 +133,7 @@ public boolean equals(Object o) {\n     return Objects.equals(name, that.name) &&\n       Objects.equals(plugin, that.plugin) &&\n       Objects.equals(inputSchemas, that.inputSchemas) &&\n+      Objects.equals(Sets.newHashSet(inputStages), Sets.newHashSet(that.inputStages)) &&", "originalCommit": "a0c351eb701f90ab723a58e8484c9e60f788ebe4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzQwOTY0OQ==", "url": "https://github.com/cdapio/cdap/pull/11948#discussion_r397409649", "bodyText": "fixed", "author": "rmstar", "createdAt": "2020-03-24T19:32:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzM4NDA1NQ=="}], "type": "inlineReview"}, {"oid": "1d4963cbe9bf1ad35d64a8d3c174369d45cc3cc7", "url": "https://github.com/cdapio/cdap/commit/1d4963cbe9bf1ad35d64a8d3c174369d45cc3cc7", "message": "[CDAP-16324] Add getInputStages API", "committedDate": "2020-03-24T19:31:11Z", "type": "commit"}, {"oid": "1d4963cbe9bf1ad35d64a8d3c174369d45cc3cc7", "url": "https://github.com/cdapio/cdap/commit/1d4963cbe9bf1ad35d64a8d3c174369d45cc3cc7", "message": "[CDAP-16324] Add getInputStages API", "committedDate": "2020-03-24T19:31:11Z", "type": "forcePushed"}]}