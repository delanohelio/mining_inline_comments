{"pr_number": 12808, "pr_title": "[CDAP-17336] Fixes schema editor to handle disabled schema in studio", "pr_createdAt": "2020-10-13T07:38:28Z", "pr_url": "https://github.com/cdapio/cdap/pull/12808", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjM2NjM0OQ==", "url": "https://github.com/cdapio/cdap/pull/12808#discussion_r516366349", "bodyText": "should this return true? if there's an issue then no schema is available", "author": "elfenheart", "createdAt": "2020-11-03T00:42:34Z", "path": "cdap-ui/app/cdap/components/AbstractWidget/SchemaEditor/SchemaHelpers.ts", "diffHunk": "@@ -177,6 +178,21 @@ const isFlatRowTypeComplex = (typeName: AvroSchemaTypesEnum) => {\n   }\n };\n \n+const isNoSchemaAvailable = (schema) => {\n+  let avroSchema = schema;\n+  if (avroSchema) {\n+    avroSchema = avroSchema.schema;\n+    if (typeof avroSchema === 'string') {\n+      try {\n+        avroSchema = JSON.parse(avroSchema);\n+      } catch (e) {\n+        return false;", "originalCommit": "81df59d5808d6a8f0ee6ac0648abbf1cbdc4501c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjM2NjUyMg==", "url": "https://github.com/cdapio/cdap/pull/12808#discussion_r516366522", "bodyText": "might have to do a return true outside of this if statement?", "author": "elfenheart", "createdAt": "2020-11-03T00:42:59Z", "path": "cdap-ui/app/cdap/components/AbstractWidget/SchemaEditor/SchemaHelpers.ts", "diffHunk": "@@ -177,6 +178,21 @@ const isFlatRowTypeComplex = (typeName: AvroSchemaTypesEnum) => {\n   }\n };\n \n+const isNoSchemaAvailable = (schema) => {\n+  let avroSchema = schema;\n+  if (avroSchema) {\n+    avroSchema = avroSchema.schema;\n+    if (typeof avroSchema === 'string') {\n+      try {\n+        avroSchema = JSON.parse(avroSchema);\n+      } catch (e) {\n+        return false;\n+      }\n+    }\n+    return !objectQuery(avroSchema, 'fields', 'length');\n+  }\n+};", "originalCommit": "81df59d5808d6a8f0ee6ac0648abbf1cbdc4501c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjM3NDQ1OQ==", "url": "https://github.com/cdapio/cdap/pull/12808#discussion_r516374459", "bodyText": "Nit: I18n?", "author": "njbriggs", "createdAt": "2020-11-03T00:59:23Z", "path": "cdap-ui/app/cdap/components/PluginSchemaEditor/index.tsx", "diffHunk": "@@ -387,35 +427,42 @@ class PluginSchemaEditorBase extends React.PureComponent<\n       } else {\n         newSchema.schema = s.schema;\n       }\n+      if (isNoSchemaAvailable(newSchema)) {\n+        newSchema.schema = `No ${this.props.schemaTitle} available`;", "originalCommit": "81df59d5808d6a8f0ee6ac0648abbf1cbdc4501c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzU1NDE5OQ==", "url": "https://github.com/cdapio/cdap/pull/12808#discussion_r517554199", "bodyText": "Fair enough. Have not added i18n for Schema editor. Will take it up in a separate PR.", "author": "ajainarayanan", "createdAt": "2020-11-04T18:40:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjM3NDQ1OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjM3NjgzNA==", "url": "https://github.com/cdapio/cdap/pull/12808#discussion_r516376834", "bodyText": "Nit: In other places, I've seen a preference for putting the \"truthy\" condition earlier in the ternary (i.e., this would be !!returnSchema.fields.length ? returnSchema : getDefaultEmptyAvroSchema()). Do we have a preference here?", "author": "njbriggs", "createdAt": "2020-11-03T01:04:21Z", "path": "cdap-ui/app/cdap/components/PluginSchemaEditor/index.tsx", "diffHunk": "@@ -373,6 +396,23 @@ class PluginSchemaEditorBase extends React.PureComponent<\n   };\n \n   private santizeSchemasForEditor = (schemas = this.props.schemas): ISchemaType[] => {\n+    if (typeof schemas === 'string') {\n+      let returnSchema;\n+      try {\n+        returnSchema = JSON.parse(schemas);\n+      } catch (e) {\n+        return [{ ...getDefaultEmptyAvroSchema() }];\n+      }\n+      if (!returnSchema.schema) {\n+        return [\n+          {\n+            name: 'etlSchemaBody',\n+            schema: !returnSchema.fields.length ? getDefaultEmptyAvroSchema() : returnSchema,", "originalCommit": "81df59d5808d6a8f0ee6ac0648abbf1cbdc4501c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzU1NDY1NQ==", "url": "https://github.com/cdapio/cdap/pull/12808#discussion_r517554655", "bodyText": "IMHO there is no preference as of now. But if you insist on a pattern we could follow. I am not too strong about it.", "author": "ajainarayanan", "createdAt": "2020-11-04T18:41:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjM3NjgzNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzU2NDgxOQ==", "url": "https://github.com/cdapio/cdap/pull/12808#discussion_r517564819", "bodyText": "I think it makes things a bit easier to read, but is most effective with nested ternaries (which we shouldn't be doing anyway). So I'm not going to push for a standard for now.", "author": "njbriggs", "createdAt": "2020-11-04T18:59:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjM3NjgzNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzYzNjY5Mg==", "url": "https://github.com/cdapio/cdap/pull/12808#discussion_r517636692", "bodyText": "I think I was using that pattern in Replication if I were to use the <If condition>, since condition has to be boolean", "author": "elfenheart", "createdAt": "2020-11-04T21:18:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjM3NjgzNA=="}], "type": "inlineReview"}, {"oid": "5e2fc34a43fb1e1f5ec8e7982c3850ff30ff640d", "url": "https://github.com/cdapio/cdap/commit/5e2fc34a43fb1e1f5ec8e7982c3850ff30ff640d", "message": "[CDAP-17336] Fixes schema editor to handle disabled schema in studio\n\n  - Fixes new schema editor to be disabled for implicit schemas\n  - Adds helper function to determine if no schema is available\n  - Fixes plugin schema editor to handle no schema to show the right message\n  - Fixes Actions dropdown in output schema to have right options for implicit schema\n  - Fixes plugin schema editor to handle schema as string (happens when users propagte schema)", "committedDate": "2020-11-04T18:42:39Z", "type": "commit"}, {"oid": "5e2fc34a43fb1e1f5ec8e7982c3850ff30ff640d", "url": "https://github.com/cdapio/cdap/commit/5e2fc34a43fb1e1f5ec8e7982c3850ff30ff640d", "message": "[CDAP-17336] Fixes schema editor to handle disabled schema in studio\n\n  - Fixes new schema editor to be disabled for implicit schemas\n  - Adds helper function to determine if no schema is available\n  - Fixes plugin schema editor to handle no schema to show the right message\n  - Fixes Actions dropdown in output schema to have right options for implicit schema\n  - Fixes plugin schema editor to handle schema as string (happens when users propagte schema)", "committedDate": "2020-11-04T18:42:39Z", "type": "forcePushed"}]}