{"pr_number": 12186, "pr_title": "[CDAP-16839] Base implementation for virtual scrolling", "pr_createdAt": "2020-05-19T07:00:39Z", "pr_url": "https://github.com/cdapio/cdap/pull/12186", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzYwNjM2MQ==", "url": "https://github.com/cdapio/cdap/pull/12186#discussion_r427606361", "bodyText": "Why is it call demo? Is it really just for demo or is actual prod code?", "author": "chtyim", "createdAt": "2020-05-19T21:19:23Z", "path": "cdap-ui/app/cdap/components/Home/index.js", "diffHunk": "@@ -185,6 +187,13 @@ export default class Home extends Component {\n           <Route path=\"/ns/:namespace/kitchen\" component={ConfigurationGroupKitchenSync} />\n           <Route path=\"/ns/:namespace/replication\" component={Replicator} />\n           <Route path=\"/ns/:namespace/lab\" component={Lab} />\n+          <Route\n+            exact\n+            path=\"/ns/:namespace/vs\"\n+            render={() => {\n+              return <VirtualScrollDemo />;", "originalCommit": "5e763e2ba7da146ba64bc0d1894833d943864658", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzY2MjQ4OA==", "url": "https://github.com/cdapio/cdap/pull/12186#discussion_r427662488", "bodyText": "No this is an experimental page. The VirtualScrollDemo component is the page that renders the virtual scroll list. This is a temporary route where this experiment is.", "author": "ajainarayanan", "createdAt": "2020-05-19T23:46:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzYwNjM2MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzM2ODQ1Nw==", "url": "https://github.com/cdapio/cdap/pull/12186#discussion_r433368457", "bodyText": "Can you use components/Lab/ToggleExperiment to switch between this component and 404 page using cdap-common-experiment? So that this route won't be available to users unless they have the experiment enabled.", "author": "itsanudeep", "createdAt": "2020-06-01T17:06:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzYwNjM2MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzM2ODg4OQ==", "url": "https://github.com/cdapio/cdap/pull/12186#discussion_r433368889", "bodyText": "move this import to top of the page?", "author": "itsanudeep", "createdAt": "2020-06-01T17:07:50Z", "path": "cdap-ui/app/cdap/components/Home/index.js", "diffHunk": "@@ -94,6 +94,8 @@ const SecureKeys = Loadable({\n   loading: LoadingSVGCentered,\n });\n \n+import VirtualScrollDemo from 'components/VirtualScroll/demo';", "originalCommit": "5e763e2ba7da146ba64bc0d1894833d943864658", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDkwMTk3Ng==", "url": "https://github.com/cdapio/cdap/pull/12186#discussion_r434901976", "bodyText": "Is childrenUnderFold the number of rows that are in DOM but not in the viewport?", "author": "itsanudeep", "createdAt": "2020-06-03T22:56:12Z", "path": "cdap-ui/app/cdap/components/VirtualScroll/index.tsx", "diffHunk": "@@ -0,0 +1,123 @@\n+/*\n+ * Copyright \u00a9 2020 Cask Data, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+import React, { memo, useMemo, useState, useEffect } from 'react';\n+import withStyles, { StyleRules, WithStyles } from '@material-ui/core/styles/withStyles';\n+import { useScroll } from 'components/VirtualScroll/useScroll';\n+\n+interface IVirtualScrollProps extends WithStyles<typeof styles> {\n+  renderList: (\n+    visibleNodeCount: number,\n+    startNode: number\n+  ) => React.ReactNode | Promise<React.ReactNode>;\n+  itemCount: number | (() => number);\n+  visibleChildCount: number;\n+  childHeight: number;\n+  childrenUnderFold: number;\n+  LoadingElement?: React.ReactNode;\n+}\n+const styles = (): StyleRules => {\n+  return {\n+    root: {\n+      overflow: 'auto',\n+    },\n+    viewport: {\n+      paddingTop: '1px',\n+      overflow: 'hidden',\n+      willChange: 'transform',\n+      position: 'relative',\n+    },\n+    loading: {\n+      position: 'absolute',\n+      background: 'purple',\n+      bottom: '0',\n+      height: '30px',\n+      color: 'white',\n+      width: '200px',\n+      marginLeft: '10px',\n+      textAlign: 'center',\n+    },\n+  };\n+};\n+\n+// VirtualScroll component\n+const VirtualScroll = ({\n+  renderList,\n+  itemCount,\n+  visibleChildCount,\n+  childHeight,\n+  childrenUnderFold,", "originalCommit": "5e763e2ba7da146ba64bc0d1894833d943864658", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTYxMDkzOQ==", "url": "https://github.com/cdapio/cdap/pull/12186#discussion_r435610939", "bodyText": "Yes. It is both top and bottom of the viewport.. It acts like a buffer to have some elements pre-rendered when user scrolls.", "author": "ajainarayanan", "createdAt": "2020-06-04T23:36:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDkwMTk3Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDkwMjY0Nw==", "url": "https://github.com/cdapio/cdap/pull/12186#discussion_r434902647", "bodyText": "Do you have any plans to compare the performance of our implementation vs react-window or some other library that's available?", "author": "itsanudeep", "createdAt": "2020-06-03T22:58:16Z", "path": "cdap-ui/app/cdap/components/VirtualScroll/index.tsx", "diffHunk": "@@ -0,0 +1,123 @@\n+/*", "originalCommit": "5e763e2ba7da146ba64bc0d1894833d943864658", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTYxNTQxNw==", "url": "https://github.com/cdapio/cdap/pull/12186#discussion_r435615417", "bodyText": "Not as of now. It will take some substantial feature parity to see how this implementation fares. But IMHO we will not be on-par,  at least for sometime, with the performance offered by those libraries developed in open with 100s of contributions.", "author": "ajainarayanan", "createdAt": "2020-06-04T23:41:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDkwMjY0Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTYxODEzMA==", "url": "https://github.com/cdapio/cdap/pull/12186#discussion_r435618130", "bodyText": "Is there a reason for creating a new one then?", "author": "njbriggs", "createdAt": "2020-06-04T23:49:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDkwMjY0Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTYyMjYxMQ==", "url": "https://github.com/cdapio/cdap/pull/12186#discussion_r435622611", "bodyText": "Couple of things,\n\nHistorically we usually use a library for everything we want to do for anything other than basic rendering. This is an effort towards minimizing importing a whole slew of dependency and increase yarn install time (Today it takes > 5 mins to do yarn install)\nI may have miscommunicated there, by performance I mean feature parity. The performance, in terms of the ability to render things efficiently is still the core objective and we can test and compare those numbers but the comparison would be limited to rendering a list or table and not a grid.\nThe flexibility to use web workers as part of the virtual scroll component for some of the processing that we might have to do. For instance sorting/searching large list or doing a compute intensive operation (parse json for valid avro schema).\n\nIt all boils down to whether we want to use industry famous libraries and incur the dependency and learning cost or develop it in-house for greater flexibility on the source. Hope I answered to some extent.", "author": "ajainarayanan", "createdAt": "2020-06-05T00:06:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDkwMjY0Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTYyNTI1OQ==", "url": "https://github.com/cdapio/cdap/pull/12186#discussion_r435625259", "bodyText": "That makes sense. I agree it's a tough trade-off.", "author": "njbriggs", "createdAt": "2020-06-05T00:17:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDkwMjY0Nw=="}], "type": "inlineReview"}, {"oid": "d23764f34899d9f078ddc43f46f7b8e8d07abbc4", "url": "https://github.com/cdapio/cdap/commit/d23764f34899d9f078ddc43f46f7b8e8d07abbc4", "message": "[CDAP-16839] Adds base implementation of virtual scroll", "committedDate": "2020-06-09T20:28:30Z", "type": "commit"}, {"oid": "d23764f34899d9f078ddc43f46f7b8e8d07abbc4", "url": "https://github.com/cdapio/cdap/commit/d23764f34899d9f078ddc43f46f7b8e8d07abbc4", "message": "[CDAP-16839] Adds base implementation of virtual scroll", "committedDate": "2020-06-09T20:28:30Z", "type": "forcePushed"}]}