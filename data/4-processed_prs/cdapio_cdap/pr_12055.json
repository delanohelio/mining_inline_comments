{"pr_number": 12055, "pr_title": "(CDAP-16369) Remote Execution Runtime Redesign", "pr_createdAt": "2020-04-13T22:14:44Z", "pr_url": "https://github.com/cdapio/cdap/pull/12055", "timeline": [{"oid": "28ca09c08b8e676663c4076a1b24214bea0ecf09", "url": "https://github.com/cdapio/cdap/commit/28ca09c08b8e676663c4076a1b24214bea0ecf09", "message": "Make sure provisioning service is running before using it", "committedDate": "2020-04-13T22:16:18Z", "type": "forcePushed"}, {"oid": "bcfaf0858581cb333d3b0bd114125d4436d014f8", "url": "https://github.com/cdapio/cdap/commit/bcfaf0858581cb333d3b0bd114125d4436d014f8", "message": "Make sure provisioning service is running before using it", "committedDate": "2020-04-13T22:18:16Z", "type": "forcePushed"}, {"oid": "94071282230bcf10fbf71f4e90b07e57c39cbe7a", "url": "https://github.com/cdapio/cdap/commit/94071282230bcf10fbf71f4e90b07e57c39cbe7a", "message": "(CDAP-16369) Added RuntimeServer to standalone and Hadoop mode\n\n- In hadoop mode, runtime server runs inside app-fabric instead\n  of separate service in YARN. This is due to hadoop support\n  is deprecated since 6.2, so we are not going to make a lot of\n  effort to make it scalabile on YARN", "committedDate": "2020-04-13T22:40:39Z", "type": "forcePushed"}, {"oid": "d54319a6d5ba7b708cdbc5b7a67019cb41652d19", "url": "https://github.com/cdapio/cdap/commit/d54319a6d5ba7b708cdbc5b7a67019cb41652d19", "message": "(CDAP-16369) Added RuntimeServer to standalone and Hadoop mode\n\n- In hadoop mode, runtime server runs inside app-fabric instead\n  of separate service in YARN. This is due to hadoop support\n  is deprecated since 6.2, so we are not going to make a lot of\n  effort to make it scalabile on YARN", "committedDate": "2020-04-13T22:54:42Z", "type": "forcePushed"}, {"oid": "314d1315a593ae5c5c011e6db13d26713f1f7a51", "url": "https://github.com/cdapio/cdap/commit/314d1315a593ae5c5c011e6db13d26713f1f7a51", "message": "(CDAP-16369) Added RuntimeServer to standalone and Hadoop mode\n\n- In hadoop mode, runtime server runs inside app-fabric instead\n  of separate service in YARN. This is due to hadoop support\n  is deprecated since 6.2, so we are not going to make a lot of\n  effort to make it scalabile on YARN", "committedDate": "2020-04-13T22:55:14Z", "type": "forcePushed"}, {"oid": "8a3e6eae575d248b013ce0a95eeefe3362ed3e98", "url": "https://github.com/cdapio/cdap/commit/8a3e6eae575d248b013ce0a95eeefe3362ed3e98", "message": "(CDAP-16369) Added RuntimeServer to standalone and Hadoop mode\n\n- In hadoop mode, runtime server runs inside app-fabric instead\n  of separate service in YARN. This is due to hadoop support\n  is deprecated since 6.2, so we are not going to make a lot of\n  effort to make it scalabile on YARN", "committedDate": "2020-04-13T22:56:03Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzg3NDYzOA==", "url": "https://github.com/cdapio/cdap/pull/12055#discussion_r407874638", "bodyText": "should we call this start?", "author": "CuriousVini", "createdAt": "2020-04-14T05:25:31Z", "path": "cdap-runtime-spi/src/main/java/io/cdap/cdap/runtime/spi/runtimejob/RuntimeJob.java", "diffHunk": "@@ -28,4 +28,9 @@\n    * @throws Exception thrown if any error while job execution\n    */\n   void run(RuntimeJobEnvironment runtimeJobEnvironment) throws Exception;", "originalCommit": "8a3e6eae575d248b013ce0a95eeefe3362ed3e98", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ1OTAwMQ==", "url": "https://github.com/cdapio/cdap/pull/12055#discussion_r408459001", "bodyText": "changed to requestStop()", "author": "chtyim", "createdAt": "2020-04-14T21:54:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzg3NDYzOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzg3NjkyMw==", "url": "https://github.com/cdapio/cdap/pull/12055#discussion_r407876923", "bodyText": "could you please file a jira to move it to a separate extension and add it as todo here?", "author": "CuriousVini", "createdAt": "2020-04-14T05:32:53Z", "path": "cdap-app-fabric/src/main/java/io/cdap/cdap/internal/app/runtime/monitor/GceRemoteAuthenticator.java", "diffHunk": "@@ -0,0 +1,103 @@\n+/*\n+ * Copyright \u00a9 2020 Cask Data, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+package io.cdap.cdap.internal.app.runtime.monitor;\n+\n+import com.google.gson.Gson;\n+import com.google.gson.JsonObject;\n+import io.cdap.cdap.common.internal.remote.RemoteAuthenticator;\n+import io.cdap.common.http.HttpRequest;\n+import io.cdap.common.http.HttpRequests;\n+import io.cdap.common.http.HttpResponse;\n+\n+import java.io.IOException;\n+import java.net.URL;\n+import java.util.concurrent.TimeUnit;\n+\n+/**\n+ * A {@link RemoteAuthenticator} that authenticate remote calls using Google Cloud token acquired from GCE metadata.\n+ */\n+@SuppressWarnings(\"unused\")\n+public class GceRemoteAuthenticator extends RemoteAuthenticator {", "originalCommit": "8a3e6eae575d248b013ce0a95eeefe3362ed3e98", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ2MjA3MQ==", "url": "https://github.com/cdapio/cdap/pull/12055#discussion_r408462071", "bodyText": "Done. CDAP-16583", "author": "chtyim", "createdAt": "2020-04-14T22:01:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzg3NjkyMw=="}], "type": "inlineReview"}, {"oid": "631346a191b0296a7d0fac43ef21a35e28a0f07b", "url": "https://github.com/cdapio/cdap/commit/631346a191b0296a7d0fac43ef21a35e28a0f07b", "message": "(CDAP-16369) Persist all system arguments during program start", "committedDate": "2020-04-14T20:01:03Z", "type": "commit"}, {"oid": "30537f1ba9aae9219c930c849b5ef31a8d24a925", "url": "https://github.com/cdapio/cdap/commit/30537f1ba9aae9219c930c849b5ef31a8d24a925", "message": "(CDAP-16369) Added a cursor based scan active run records to AppMetadataStore\n\n- This allows scanning active run records efficiently across all namespaces\n  without holding up large amount of memory", "committedDate": "2020-04-14T20:01:04Z", "type": "commit"}, {"oid": "8d311baac8b2d326e7098cdc566773d09c6d0feb", "url": "https://github.com/cdapio/cdap/commit/8d311baac8b2d326e7098cdc566773d09c6d0feb", "message": "address comment", "committedDate": "2020-04-14T21:45:52Z", "type": "forcePushed"}, {"oid": "ca3b26509e1dee0f2f5d1c98d62d00cef4da5556", "url": "https://github.com/cdapio/cdap/commit/ca3b26509e1dee0f2f5d1c98d62d00cef4da5556", "message": "(CDAP-16369) Added getUserArgs() method to RunRecodDetail\n\n- Unified calls for getting runtime arguments from RunRecordDetail\n- Also fixed deserialization usage of RunRecordDetail", "committedDate": "2020-04-14T21:58:36Z", "type": "commit"}, {"oid": "a4e1668c1942d00cfe842801ed53c15d6595ad06", "url": "https://github.com/cdapio/cdap/commit/a4e1668c1942d00cfe842801ed53c15d6595ad06", "message": "(CDAP-16369) Move TrafficRelayServer and ProxySelector out from RuntimeMonitorServer\n\n- This is for preparing the removal of RuntimeMonitorServer", "committedDate": "2020-04-14T21:58:36Z", "type": "commit"}, {"oid": "38f0487cb334ae996d64555de565c549f68369af", "url": "https://github.com/cdapio/cdap/commit/38f0487cb334ae996d64555de565c549f68369af", "message": "(CDAP-16369) Improve Dataproc job manager stop() implementation\n\n- Instead of always issuing stop, check the job status first", "committedDate": "2020-04-14T21:58:36Z", "type": "commit"}, {"oid": "fc4ece49a295409671f0d9f077ba24fb861e2d0e", "url": "https://github.com/cdapio/cdap/commit/fc4ece49a295409671f0d9f077ba24fb861e2d0e", "message": "(CDAP-16369) Change job launching and monitoring mechanism\n\n- Remote runtime actively talking to CDAP\n- Supports either SSH tunnel or CDAP exposes URL\n- Unified SSH and RuntimeJob launch code", "committedDate": "2020-04-14T22:00:16Z", "type": "commit"}, {"oid": "482684a10e9c51560f0f7221c3a9be37573b8864", "url": "https://github.com/cdapio/cdap/commit/482684a10e9c51560f0f7221c3a9be37573b8864", "message": "(CDAP-16369) Change the RuntimeJobManager interface\n\n- Remove init and destroy, extends from Closeable to make it easier to use", "committedDate": "2020-04-14T22:00:16Z", "type": "commit"}, {"oid": "fa6a82fa1d654c35574d91bd7409c434be603cf8", "url": "https://github.com/cdapio/cdap/commit/fa6a82fa1d654c35574d91bd7409c434be603cf8", "message": "(CDAP-16369) Provisioner config and runtime argument to control monitor type\n\n- Based on CDAP config for each provisioner\n- Overridable by runtime arguments", "committedDate": "2020-04-14T22:00:17Z", "type": "commit"}, {"oid": "9e04c5149b1b036a7b6fdbc384eb383f9a9741cb", "url": "https://github.com/cdapio/cdap/commit/9e04c5149b1b036a7b6fdbc384eb383f9a9741cb", "message": "(CDAP-16369) Fixied a ByteBuf leak in runtime server", "committedDate": "2020-04-14T22:00:17Z", "type": "commit"}, {"oid": "51466d79e1d81ca4035d043626660c472eeeb440", "url": "https://github.com/cdapio/cdap/commit/51466d79e1d81ca4035d043626660c472eeeb440", "message": "(CDAP-16369) Improve progress logs in runtime client service\n\n- Progress log per topic and log total number of messages being processed", "committedDate": "2020-04-14T22:00:17Z", "type": "commit"}, {"oid": "f19805f9864f6ca1b4d77f77640f6c451a3ab22b", "url": "https://github.com/cdapio/cdap/commit/f19805f9864f6ca1b4d77f77640f6c451a3ab22b", "message": "(CDAP-16369) Delete unused class\n\n- Monitoring proxy classes are not needed", "committedDate": "2020-04-14T22:00:17Z", "type": "commit"}, {"oid": "680708a7035b4143de032add9f8d3ad73d7cf71e", "url": "https://github.com/cdapio/cdap/commit/680708a7035b4143de032add9f8d3ad73d7cf71e", "message": "(CDAP-16369) Added RuntimeServer to standalone and Hadoop mode\n\n- In hadoop mode, runtime server runs inside app-fabric instead\n  of separate service in YARN. This is due to hadoop support\n  is deprecated since 6.2, so we are not going to make a lot of\n  effort to make it scalabile on YARN", "committedDate": "2020-04-14T22:00:17Z", "type": "commit"}, {"oid": "680708a7035b4143de032add9f8d3ad73d7cf71e", "url": "https://github.com/cdapio/cdap/commit/680708a7035b4143de032add9f8d3ad73d7cf71e", "message": "(CDAP-16369) Added RuntimeServer to standalone and Hadoop mode\n\n- In hadoop mode, runtime server runs inside app-fabric instead\n  of separate service in YARN. This is due to hadoop support\n  is deprecated since 6.2, so we are not going to make a lot of\n  effort to make it scalabile on YARN", "committedDate": "2020-04-14T22:00:17Z", "type": "forcePushed"}]}