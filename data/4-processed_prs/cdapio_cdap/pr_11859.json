{"pr_number": 11859, "pr_title": "[UI][Pipelines] Lazyload runs & runscount for only viewed pipelines", "pr_createdAt": "2020-02-10T07:17:13Z", "pr_url": "https://github.com/cdapio/cdap/pull/11859", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQxNzA2NQ==", "url": "https://github.com/cdapio/cdap/pull/11859#discussion_r377417065", "bodyText": "should this be > 25?", "author": "elfenheart", "createdAt": "2020-02-11T01:58:18Z", "path": "cdap-ui/app/cdap/components/PipelineList/DeployedPipelineView/Pagination/index.tsx", "diffHunk": "@@ -15,27 +15,20 @@\n  */\n \n import { connect } from 'react-redux';\n-import { Actions } from 'components/PipelineList/DeployedPipelineView/store';\n import PaginationView from 'components/PipelineList/PaginationView';\n-\n+import { setPage } from 'components/PipelineList/DeployedPipelineView/store/ActionCreator';\n const mapStateToProps = (state) => {\n   return {\n     currentPage: state.deployed.currentPage,\n     pageLimit: state.deployed.pageLimit,\n-    shouldDisplay: state.deployed.search.length === 0,\n+    shouldDisplay: state.deployed.filteredPipelines.length > 24,", "originalCommit": "908e4e9aded7f9584ffe02c43f93c4f7441ecefa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQxOTk3MQ==", "url": "https://github.com/cdapio/cdap/pull/11859#discussion_r377419971", "bodyText": "Filtered pipelines will never be > 25.", "author": "ajainarayanan", "createdAt": "2020-02-11T02:13:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQxNzA2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzg0MzkzNQ==", "url": "https://github.com/cdapio/cdap/pull/11859#discussion_r377843935", "bodyText": "then do we need this property at all then? This is to show or hide the Pagination component, right?", "author": "elfenheart", "createdAt": "2020-02-11T19:17:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQxNzA2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTAwMDAwOQ==", "url": "https://github.com/cdapio/cdap/pull/11859#discussion_r381000009", "bodyText": "Have updated the search/pagination behavior. Have added comments to explain changes in code. Let me know if that is ok.", "author": "ajainarayanan", "createdAt": "2020-02-18T23:39:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQxNzA2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQxODI5Ng==", "url": "https://github.com/cdapio/cdap/pull/11859#discussion_r377418296", "bodyText": "so where is the reset happening now?", "author": "elfenheart", "createdAt": "2020-02-11T02:04:33Z", "path": "cdap-ui/app/cdap/components/PipelineList/DeployedPipelineView/index.tsx", "diffHunk": "@@ -50,7 +53,11 @@ const DeployedPipeline: React.FC = () => {\n   // on unmount\n   React.useEffect(() => {\n     return () => {\n-      reset();\n+      // (TODO): This is right now problematic.\n+      // React unmounts component everytime when incoming props change\n+      // Because this is FC there is no way to know if the parent component\n+      // changed the props or really unmounted.\n+      // reset();", "originalCommit": "908e4e9aded7f9584ffe02c43f93c4f7441ecefa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQxOTkwMA==", "url": "https://github.com/cdapio/cdap/pull/11859#discussion_r377419900", "bodyText": "It is not. Thats why added the comment. We right now don't reset the store.", "author": "ajainarayanan", "createdAt": "2020-02-11T02:12:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQxODI5Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzg0NDIwNw==", "url": "https://github.com/cdapio/cdap/pull/11859#discussion_r377844207", "bodyText": "that doesn't cause issue in navigating back and forth while staying in React components? such as existing search filter or sorting?", "author": "elfenheart", "createdAt": "2020-02-11T19:17:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQxODI5Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzg5MzM3Ng==", "url": "https://github.com/cdapio/cdap/pull/11859#discussion_r377893376", "bodyText": "Search and sorting will exist but the pipelines won't.  I will have to reset but not erase the pipelines and filtered ones. Still trying it out.", "author": "ajainarayanan", "createdAt": "2020-02-11T20:56:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQxODI5Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzkwNTU4NQ==", "url": "https://github.com/cdapio/cdap/pull/11859#discussion_r377905585", "bodyText": "Fixed. Can you give it another review.", "author": "ajainarayanan", "createdAt": "2020-02-11T21:20:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQxODI5Ng=="}], "type": "inlineReview"}, {"oid": "6d6cf89dc0af77b60537a1cd7905b5441a2f901b", "url": "https://github.com/cdapio/cdap/commit/6d6cf89dc0af77b60537a1cd7905b5441a2f901b", "message": "Correctly reset store on unmount in pipeline list", "committedDate": "2020-02-11T21:20:03Z", "type": "forcePushed"}, {"oid": "89f645f175884e26e11ba1264ac04cf27e70e5ed", "url": "https://github.com/cdapio/cdap/commit/89f645f175884e26e11ba1264ac04cf27e70e5ed", "message": "Fixes the way we update search in store", "committedDate": "2020-02-18T23:33:54Z", "type": "forcePushed"}, {"oid": "494807c7f6fe6ffe34d9374e69e175d3f20c8659", "url": "https://github.com/cdapio/cdap/commit/494807c7f6fe6ffe34d9374e69e175d3f20c8659", "message": "Fixes the way we update search in store", "committedDate": "2020-02-18T23:38:54Z", "type": "forcePushed"}, {"oid": "5389547421abd2799356f61976bd86f7a84f1896", "url": "https://github.com/cdapio/cdap/commit/5389547421abd2799356f61976bd86f7a84f1896", "message": "Fixes the way we update search in store", "committedDate": "2020-02-18T23:44:48Z", "type": "forcePushed"}, {"oid": "925a10889156839fe0d546182ae24bf13933fc6f", "url": "https://github.com/cdapio/cdap/commit/925a10889156839fe0d546182ae24bf13933fc6f", "message": "[UI][Pipelines] Lazyload runs & runscount for only viewed pipelines\n\n  - Adds natural-sort to sort pipelines by name in graphql resolver\n  - Fixes graphql server to fetch runs & total runs count for only first 25 pipelines\n  - Disables sorting by columns other than pipeline name\n  - Lazy load runs & runscount only for pipelines currently in view\n\n    As part of this change the following have been changed,\n\n      1. Moved pipelines and the filteredPipelines to store\n      2. Any modifications done to the current viewed pipelines is always saved to store\n      3. This way we can determine currently viewed pipeline for which we need to fetch the runs\n      4. Upon fetch we save the runs and runscount to both the filtered pipelines & the full list.\n   This way we avoid refetching them multiple times\n\n  - Fixes the property we check while pausing & resuming polling in datasource", "committedDate": "2020-02-18T23:53:14Z", "type": "commit"}, {"oid": "925a10889156839fe0d546182ae24bf13933fc6f", "url": "https://github.com/cdapio/cdap/commit/925a10889156839fe0d546182ae24bf13933fc6f", "message": "[UI][Pipelines] Lazyload runs & runscount for only viewed pipelines\n\n  - Adds natural-sort to sort pipelines by name in graphql resolver\n  - Fixes graphql server to fetch runs & total runs count for only first 25 pipelines\n  - Disables sorting by columns other than pipeline name\n  - Lazy load runs & runscount only for pipelines currently in view\n\n    As part of this change the following have been changed,\n\n      1. Moved pipelines and the filteredPipelines to store\n      2. Any modifications done to the current viewed pipelines is always saved to store\n      3. This way we can determine currently viewed pipeline for which we need to fetch the runs\n      4. Upon fetch we save the runs and runscount to both the filtered pipelines & the full list.\n   This way we avoid refetching them multiple times\n\n  - Fixes the property we check while pausing & resuming polling in datasource", "committedDate": "2020-02-18T23:53:14Z", "type": "forcePushed"}]}