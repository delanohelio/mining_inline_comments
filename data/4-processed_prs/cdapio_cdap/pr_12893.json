{"pr_number": 12893, "pr_title": "[CDAP-17453][CDAP-17445][CDAP-17443] Replication graph tooltip, table selection, and time selections", "pr_createdAt": "2020-12-10T04:50:05Z", "pr_url": "https://github.com/cdapio/cdap/pull/12893", "timeline": [{"oid": "5e61ef6a7a111bfbf4c02b5244200c37c6bc1072", "url": "https://github.com/cdapio/cdap/commit/5e61ef6a7a111bfbf4c02b5244200c37c6bc1072", "message": "add time period selection", "committedDate": "2020-12-10T18:23:02Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDU4MTE2NA==", "url": "https://github.com/cdapio/cdap/pull/12893#discussion_r540581164", "bodyText": "Nit: Why not just const heading = activeTable || 'All tables replicated';", "author": "njbriggs", "createdAt": "2020-12-10T23:38:57Z", "path": "cdap-ui/app/cdap/components/Replicator/Detail/SelectedTable/index.tsx", "diffHunk": "@@ -0,0 +1,74 @@\n+/*\n+ * Copyright \u00a9 2020 Cask Data, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+import React, { useContext } from 'react';\n+import withStyles, { WithStyles, StyleRules } from '@material-ui/core/styles/withStyles';\n+import { DetailContext } from 'components/Replicator/Detail';\n+import Heading, { HeadingTypes } from 'components/Heading';\n+import If from 'components/If';\n+\n+const styles = (theme): StyleRules => {\n+  return {\n+    root: {\n+      padding: '0 15px',\n+      marginBottom: '25px',\n+      display: 'flex',\n+      alignItems: 'center',\n+    },\n+    reset: {\n+      color: theme.palette.blue[100],\n+      cursor: 'pointer',\n+      marginLeft: '5px',\n+\n+      '&:hover': {\n+        textDecoration: 'underline',\n+      },\n+    },\n+    activeTableText: {\n+      marginLeft: '10px',\n+    },\n+    heading: {\n+      marginBottom: 0,\n+    },\n+  };\n+};\n+\n+const SelectedTableView: React.FC<WithStyles<typeof styles>> = ({ classes }) => {\n+  const { activeTable, setActiveTable } = useContext(DetailContext);\n+\n+  function handleReset() {\n+    setActiveTable(null);\n+  }\n+\n+  const heading = activeTable ? `\"${activeTable}\"` : 'All tables replicated';", "originalCommit": "5e61ef6a7a111bfbf4c02b5244200c37c6bc1072", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDY5NTk4Ng==", "url": "https://github.com/cdapio/cdap/pull/12893#discussion_r540695986", "bodyText": "the design call out for the quotation mark for the name of a particular table", "author": "elfenheart", "createdAt": "2020-12-11T05:14:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDU4MTE2NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjg3MTIyNg==", "url": "https://github.com/cdapio/cdap/pull/12893#discussion_r542871226", "bodyText": "Got it", "author": "njbriggs", "createdAt": "2020-12-14T22:26:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDU4MTE2NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDU4NjcxMw==", "url": "https://github.com/cdapio/cdap/pull/12893#discussion_r540586713", "bodyText": "Can you consider a material-ui component for consistency? Popper might work, but I don't know if anchorEl will accept an SVG element.", "author": "njbriggs", "createdAt": "2020-12-10T23:52:20Z", "path": "cdap-ui/app/cdap/components/Replicator/Detail/TableScatterPlotGraph/ScatterPlotTooltip.tsx", "diffHunk": "@@ -0,0 +1,109 @@\n+/*\n+ * Copyright \u00a9 2020 Cask Data, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+import React from 'react';\n+import withStyles, { WithStyles, StyleRules } from '@material-ui/core/styles/withStyles';\n+import { ITableMetricsData } from 'components/Replicator/Detail/TableScatterPlotGraph/parser';\n+import { numberFormat } from 'components/Replicator/Detail/TableScatterPlotGraph/ScatterPlotTable';\n+\n+const styles = (theme): StyleRules => {\n+  return {\n+    tooltip: {\n+      position: 'absolute',\n+      backgroundColor: theme.palette.white[50],\n+      boxShadow: theme.shadows[3],\n+      padding: '15px 0',\n+      width: '350px',\n+    },\n+    tooltipHeading: {\n+      marginBottom: '25px',\n+      padding: '0 15px',\n+    },\n+    tooltipMetrics: {\n+      display: 'grid',\n+      gridTemplateColumns: '50% 50%',\n+    },\n+    metricContent: {\n+      padding: '0 15px',\n+\n+      '&:first-child': {\n+        borderRight: `1px solid ${theme.palette.grey[300]}`,\n+      },\n+\n+      '& > div': {\n+        display: 'grid',\n+        gridTemplateColumns: '50% 50%',\n+      },\n+    },\n+    metric: {\n+      textAlign: 'right',\n+    },\n+  };\n+};\n+\n+interface IScatterPlotTooltipProps extends WithStyles<typeof styles> {\n+  tooltip: {\n+    top: number;\n+    left: number;\n+    isOpen: boolean;\n+    activeData?: Partial<ITableMetricsData>;\n+  };\n+}\n+\n+const ScatterPlotTooltipView: React.FC<IScatterPlotTooltipProps> = ({ classes, tooltip }) => {\n+  const activeTooltip: Partial<ITableMetricsData> =\n+    tooltip && tooltip.activeData ? tooltip.activeData : {};\n+  return (\n+    <div", "originalCommit": "5e61ef6a7a111bfbf4c02b5244200c37c6bc1072", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjYyMjM1Nw==", "url": "https://github.com/cdapio/cdap/pull/12893#discussion_r542622357", "bodyText": "I tried using Popper/Popover, however the problem is that these components create an invisible overlay, since they are using portals. So when the popover appears, the d3 is registering mouseout, thus hiding the popover immediately. There might be some way to bind to the svg elements directly, however this will mean that we will have to create individual popovers for all of the data points.\nDo you have some other idea?", "author": "elfenheart", "createdAt": "2020-12-14T18:35:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDU4NjcxMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjg3MTU2Nw==", "url": "https://github.com/cdapio/cdap/pull/12893#discussion_r542871567", "bodyText": "Not off the top of my head, unfortunately.", "author": "njbriggs", "createdAt": "2020-12-14T22:26:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDU4NjcxMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjkyMDExOQ==", "url": "https://github.com/cdapio/cdap/pull/12893#discussion_r542920119", "bodyText": "we can revisit this, and create a better framework for adding tooltips to d3 in general", "author": "elfenheart", "createdAt": "2020-12-14T23:25:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDU4NjcxMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDU4NzY4Ng==", "url": "https://github.com/cdapio/cdap/pull/12893#discussion_r540587686", "bodyText": "Can you take advantage of margin and other constants rather than putting raw numbers here?", "author": "njbriggs", "createdAt": "2020-12-10T23:54:47Z", "path": "cdap-ui/app/cdap/components/Replicator/Detail/TableScatterPlotGraph/scatterPlot.ts", "diffHunk": "@@ -158,8 +170,35 @@ export function renderScatterPlot(id: string, data: ITableMetricsData[], contain\n         return COLOR_MAP.inactiveOutline;\n       }\n       return COLOR_MAP.activeOutline;\n+    })\n+    .on('mouseover', (d) => {\n+      const { top, left } = getTooltipPosition(d);\n+      onHover(top, left, true, d);\n+    })\n+    .on('mouseout', (d) => {\n+      if (isClicked) {\n+        return;\n+      }\n+      onHover(0, 0, false, d);\n+    })\n+    .on('click', (d) => {\n+      addOverlay(d);\n     });\n \n+  function getTooltipPosition(d) {\n+    const top = y(d.latency) - 70 + 'px';\n+    let left = x(d.eventsPerMin) + 50;", "originalCommit": "5e61ef6a7a111bfbf4c02b5244200c37c6bc1072", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDU5MTI3OQ==", "url": "https://github.com/cdapio/cdap/pull/12893#discussion_r540591279", "bodyText": "Is there a \"standard\" dropdown here? Could there be a shared component that takes a couple fields and some list items?", "author": "njbriggs", "createdAt": "2020-12-11T00:03:43Z", "path": "cdap-ui/app/cdap/components/Replicator/Detail/ThroughputLatencyGraphs/LatencyGraph/LatencyTooltip.tsx", "diffHunk": "@@ -0,0 +1,70 @@\n+/*\n+ * Copyright \u00a9 2020 Cask Data, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+import React from 'react';\n+import withStyles, { WithStyles, StyleRules } from '@material-ui/core/styles/withStyles';\n+import { IThroughputLatencyData } from 'components/Replicator/Detail/ThroughputLatencyGraphs/parser';\n+import { formatLatency } from 'components/Replicator/Detail/ThroughputLatencyGraphs/LatencyGraph/LatencyTable';\n+\n+const styles = (theme): StyleRules => {\n+  return {\n+    tooltip: {\n+      position: 'absolute',\n+      backgroundColor: theme.palette.white[50],\n+      boxShadow: theme.shadows[3],\n+      padding: '15px',\n+      width: '250px',\n+    },\n+    heading: {\n+      marginBottom: '10px',\n+    },\n+  };\n+};\n+\n+interface ILatencyTooltipProps extends WithStyles<typeof styles> {\n+  tooltip: {\n+    top: number;\n+    left: number;\n+    isOpen: boolean;\n+    activeData?: Partial<IThroughputLatencyData>;\n+  };\n+}\n+\n+const LatencyTooltipView: React.FC<ILatencyTooltipProps> = ({ classes, tooltip }) => {\n+  const tooltipData: Partial<IThroughputLatencyData> =\n+    tooltip && tooltip.activeData ? tooltip.activeData : {};\n+  return (\n+    <div\n+      className={classes.tooltip}\n+      style={{\n+        top: tooltip.top,\n+        left: tooltip.left,\n+        opacity: tooltip.isOpen ? 1 : 0,\n+      }}\n+    >\n+      <div className={classes.heading}>\n+        <strong>{tooltipData.formattedTimeRange}</strong>\n+      </div>\n+      <div>\n+        <div>Average latency</div>", "originalCommit": "5e61ef6a7a111bfbf4c02b5244200c37c6bc1072", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDY5Njk1Nw==", "url": "https://github.com/cdapio/cdap/pull/12893#discussion_r540696957", "bodyText": "the tooltip content designs are all different for each of the graphs unfortunately", "author": "elfenheart", "createdAt": "2020-12-11T05:18:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDU5MTI3OQ=="}], "type": "inlineReview"}, {"oid": "a6a50910786eefd5caaebeac077494794c2dd192", "url": "https://github.com/cdapio/cdap/commit/a6a50910786eefd5caaebeac077494794c2dd192", "message": "[CDAP-17453][CDAP-17445][CDAP-17443] Replication graph tooltip, table selection, and time selections", "committedDate": "2020-12-15T04:02:22Z", "type": "commit"}, {"oid": "a6a50910786eefd5caaebeac077494794c2dd192", "url": "https://github.com/cdapio/cdap/commit/a6a50910786eefd5caaebeac077494794c2dd192", "message": "[CDAP-17453][CDAP-17445][CDAP-17443] Replication graph tooltip, table selection, and time selections", "committedDate": "2020-12-15T04:02:22Z", "type": "forcePushed"}]}