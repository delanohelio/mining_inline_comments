{"pr_number": 12251, "pr_title": "[CDAP-16893] Use immutable.js for updating states (plugin JSON Creator)", "pr_createdAt": "2020-06-03T18:20:33Z", "pr_url": "https://github.com/cdapio/cdap/pull/12251", "timeline": [{"oid": "12a3974e99884ac7ba9a8829ed665243a241df77", "url": "https://github.com/cdapio/cdap/commit/12a3974e99884ac7ba9a8829ed665243a241df77", "message": "[CDAP-16893] Use immutable.js for updating states (plugin JSON Creator)", "committedDate": "2020-06-10T15:18:29Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODg1Nzc2MQ==", "url": "https://github.com/cdapio/cdap/pull/12251#discussion_r438857761", "bodyText": "Instead of checking if widgetInfo.get(widgetID) is undefined, you can use has() to check if the key exists", "author": "yukiej", "createdAt": "2020-06-11T15:10:27Z", "path": "cdap-ui/app/cdap/components/PluginJSONCreator/Create/Content/WidgetCollection/index.tsx", "diffHunk": "@@ -161,7 +146,7 @@ const WidgetCollectionView: React.FC<IWidgetCollectionProps> = ({\n       <div className={classes.widgetContainer}>\n         {activeWidgets.map((widgetID, widgetIndex) => {\n           return (\n-            <If condition={widgetInfo[widgetID]} key={widgetIndex}>\n+            <If key={widgetIndex} condition={widgetInfo.get(widgetID) !== undefined}>", "originalCommit": "12a3974e99884ac7ba9a8829ed665243a241df77", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTU2NzI4Nw==", "url": "https://github.com/cdapio/cdap/pull/12251#discussion_r441567287", "bodyText": "Resolved", "author": "jennac3", "createdAt": "2020-06-17T13:59:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODg1Nzc2MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODg1ODg2MA==", "url": "https://github.com/cdapio/cdap/pull/12251#discussion_r438858860", "bodyText": "you can also use isEmpty() to check for an empty Map or List", "author": "yukiej", "createdAt": "2020-06-11T15:12:05Z", "path": "cdap-ui/app/cdap/components/PluginJSONCreator/Create/Content/WidgetCollection/index.tsx", "diffHunk": "@@ -78,66 +79,50 @@ const WidgetCollectionView: React.FC<IWidgetCollectionProps> = ({\n   widgetToAttributes,\n   setWidgetToAttributes,\n }) => {\n-  const [activeWidgets, setActiveWidgets] = React.useState(groupID ? groupToWidgets[groupID] : []);\n+  const activeWidgets = groupID ? groupToWidgets.get(groupID) : fromJS([]);\n   const [openWidgetIndex, setOpenWidgetIndex] = React.useState(null);\n \n-  React.useEffect(() => {\n-    if (groupID) {\n-      setActiveWidgets(groupToWidgets[groupID]);\n-    } else {\n-      setActiveWidgets([]);\n-    }\n-  }, [groupToWidgets]);\n-\n   function addWidgetToGroup(index: number) {\n     return () => {\n       const newWidgetID = 'Widget_' + uuidV4();\n \n       // Add a new widget's ID at the specified index\n-      const newWidgets = [...activeWidgets];\n-      if (newWidgets.length === 0) {\n-        newWidgets.splice(0, 0, newWidgetID);\n+      let newWidgets;\n+      if (activeWidgets.size === 0) {", "originalCommit": "12a3974e99884ac7ba9a8829ed665243a241df77", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTU2NzEzOQ==", "url": "https://github.com/cdapio/cdap/pull/12251#discussion_r441567139", "bodyText": "Resolved!", "author": "jennac3", "createdAt": "2020-06-17T13:59:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODg1ODg2MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODg3MTQ0Mg==", "url": "https://github.com/cdapio/cdap/pull/12251#discussion_r438871442", "bodyText": "Do we need the if/else here? It seems like keyvaluePairs is the same no matter what", "author": "yukiej", "createdAt": "2020-06-11T15:29:00Z", "path": "cdap-ui/app/cdap/components/PluginJSONCreator/Create/Content/WidgetCollection/WidgetAttributesCollection/WidgetAttributeInput/AttributeMultipleValuesInput/index.tsx", "diffHunk": "@@ -219,38 +223,30 @@ const AttributeMultipleValuesInputView = ({\n     setCurrentInput(getCurrentWidgetAttributeValues(newType));\n \n     // When user switches the 'selectedType', the value will reset back to an empty array.\n-    setWidgetToAttributes((prevObjs) => ({\n-      ...prevObjs,\n-      [widgetID]: { ...prevObjs[widgetID], [field]: [] },\n-    }));\n+    setWidgetToAttributes(fromJS(widgetToAttributes).setIn([widgetID, field], fromJS([])));\n   };\n \n   const onAttributeChange = (newVal) => {\n     setCurrentInput(newVal);\n-    setWidgetToAttributes((prevObjs) => ({\n-      ...prevObjs,\n-      [widgetID]: { ...prevObjs[widgetID], [field]: newVal.split(COMMON_DELIMITER) },\n-    }));\n+    setWidgetToAttributes(\n+      fromJS(widgetToAttributes).setIn([widgetID, field], fromJS(newVal.split(COMMON_DELIMITER)))\n+    );\n   };\n \n   const onKeyValueAttributeChange = (keyvalue, type: SupportedType) => {\n+    let keyvaluePairs;\n     if (type === SupportedType.ValueLabelPair) {\n-      const keyvaluePairs = keyvalue.pairs.map((pair) => {\n+      keyvaluePairs = keyvalue.pairs.map((pair) => {", "originalCommit": "12a3974e99884ac7ba9a8829ed665243a241df77", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTU3NDE4Mg==", "url": "https://github.com/cdapio/cdap/pull/12251#discussion_r441574182", "bodyText": "Resolved", "author": "jennac3", "createdAt": "2020-06-17T14:08:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODg3MTQ0Mg=="}], "type": "inlineReview"}, {"oid": "9fc487b8687fcdcb444b8c726d8bad22ce5204e0", "url": "https://github.com/cdapio/cdap/commit/9fc487b8687fcdcb444b8c726d8bad22ce5204e0", "message": "[CDAP-16893] Use immutable.js for updating states (plugin JSON Creator)", "committedDate": "2020-06-17T14:02:58Z", "type": "forcePushed"}, {"oid": "d8ed7dd41b5451ac25d62c8d0db977a72ebc4141", "url": "https://github.com/cdapio/cdap/commit/d8ed7dd41b5451ac25d62c8d0db977a72ebc4141", "message": "pull from develop", "committedDate": "2020-06-22T15:03:57Z", "type": "forcePushed"}, {"oid": "088f051f4097cc56283fc15f7e2726a7fd62b2b8", "url": "https://github.com/cdapio/cdap/commit/088f051f4097cc56283fc15f7e2726a7fd62b2b8", "message": "[CDAP-16893] Use immutable.js for updating states (plugin JSON Creator)", "committedDate": "2020-06-22T15:14:15Z", "type": "forcePushed"}, {"oid": "10f0bd497be09aa92fd8717382a981e184e15e02", "url": "https://github.com/cdapio/cdap/commit/10f0bd497be09aa92fd8717382a981e184e15e02", "message": "[CDAP-16893] Use immutable.js for updating states (plugin JSON Creator)", "committedDate": "2020-06-22T15:17:53Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzczOTI3Mg==", "url": "https://github.com/cdapio/cdap/pull/12251#discussion_r443739272", "bodyText": "it's better to be explicit when you know the type you want to convert (ie. use Map)", "author": "elfenheart", "createdAt": "2020-06-22T18:10:13Z", "path": "cdap-ui/app/cdap/components/PluginJSONCreator/Create/Content/ConfigurationGroupsCollection/index.tsx", "diffHunk": "@@ -94,30 +94,32 @@ const ConfigurationGroupsCollectionView: React.FC<ICreateContext & WithStyles<ty\n       const newGroupID = 'ConfigGroup_' + uuidV4();\n \n       // Add a new group's ID at the specified index\n-      const newGroups = [...localConfigurationGroups];\n-      if (newGroups.length === 0) {\n-        newGroups.splice(0, 0, newGroupID);\n+      let newGroups;\n+      if (localConfigurationGroups.isEmpty()) {\n+        newGroups = localConfigurationGroups.insert(0, newGroupID);\n       } else {\n-        newGroups.splice(index + 1, 0, newGroupID);\n+        newGroups = localConfigurationGroups.insert(index + 1, newGroupID);\n       }\n       setLocalConfigurationGroups(newGroups);\n \n       // Set the activeGroupIndex to the new group's index\n-      if (newGroups.length <= 1) {\n+      if (newGroups.size <= 1) {\n         setActiveGroupIndex(0);\n       } else {\n         setActiveGroupIndex(index + 1);\n       }\n \n       // Set the mappings for the newly added group\n-      setLocalGroupToInfo({\n-        ...localGroupToInfo,\n-        [newGroupID]: {\n-          label: '',\n-          description: '',\n-        } as IConfigurationGroupInfo,\n-      });\n-      setLocalGroupToWidgets({ ...localGroupToWidgets, [newGroupID]: [] });\n+      setLocalGroupToInfo(\n+        localGroupToInfo.set(\n+          newGroupID,\n+          fromJS({", "originalCommit": "10f0bd497be09aa92fd8717382a981e184e15e02", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzc1OTk4OA==", "url": "https://github.com/cdapio/cdap/pull/12251#discussion_r443759988", "bodyText": "Resolved.", "author": "jennac3", "createdAt": "2020-06-22T18:51:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzczOTI3Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzczOTQ2Ng==", "url": "https://github.com/cdapio/cdap/pull/12251#discussion_r443739466", "bodyText": "same here, you can use empty list", "author": "elfenheart", "createdAt": "2020-06-22T18:10:36Z", "path": "cdap-ui/app/cdap/components/PluginJSONCreator/Create/Content/ConfigurationGroupsCollection/index.tsx", "diffHunk": "@@ -94,30 +94,32 @@ const ConfigurationGroupsCollectionView: React.FC<ICreateContext & WithStyles<ty\n       const newGroupID = 'ConfigGroup_' + uuidV4();\n \n       // Add a new group's ID at the specified index\n-      const newGroups = [...localConfigurationGroups];\n-      if (newGroups.length === 0) {\n-        newGroups.splice(0, 0, newGroupID);\n+      let newGroups;\n+      if (localConfigurationGroups.isEmpty()) {\n+        newGroups = localConfigurationGroups.insert(0, newGroupID);\n       } else {\n-        newGroups.splice(index + 1, 0, newGroupID);\n+        newGroups = localConfigurationGroups.insert(index + 1, newGroupID);\n       }\n       setLocalConfigurationGroups(newGroups);\n \n       // Set the activeGroupIndex to the new group's index\n-      if (newGroups.length <= 1) {\n+      if (newGroups.size <= 1) {\n         setActiveGroupIndex(0);\n       } else {\n         setActiveGroupIndex(index + 1);\n       }\n \n       // Set the mappings for the newly added group\n-      setLocalGroupToInfo({\n-        ...localGroupToInfo,\n-        [newGroupID]: {\n-          label: '',\n-          description: '',\n-        } as IConfigurationGroupInfo,\n-      });\n-      setLocalGroupToWidgets({ ...localGroupToWidgets, [newGroupID]: [] });\n+      setLocalGroupToInfo(\n+        localGroupToInfo.set(\n+          newGroupID,\n+          fromJS({\n+            label: '',\n+            description: '',\n+          })\n+        )\n+      );\n+      setLocalGroupToWidgets(localGroupToWidgets.set(newGroupID, fromJS([])));", "originalCommit": "10f0bd497be09aa92fd8717382a981e184e15e02", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzc2MDA5Nw==", "url": "https://github.com/cdapio/cdap/pull/12251#discussion_r443760097", "bodyText": "Resolved", "author": "jennac3", "createdAt": "2020-06-22T18:51:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzczOTQ2Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzc0MjE2MA==", "url": "https://github.com/cdapio/cdap/pull/12251#discussion_r443742160", "bodyText": "is localGroupToInfo already an immutable object? If it is, then you don't have to call fromJS. If it's not immutable, why not?", "author": "elfenheart", "createdAt": "2020-06-22T18:15:56Z", "path": "cdap-ui/app/cdap/components/PluginJSONCreator/Create/Content/ConfigurationGroupsCollection/index.tsx", "diffHunk": "@@ -126,21 +128,23 @@ const ConfigurationGroupsCollectionView: React.FC<ICreateContext & WithStyles<ty\n       setActiveGroupIndex(null);\n \n       // Delete a group at the specified index\n-      const newGroups = [...localConfigurationGroups];\n-      const groupToDelete = newGroups[index];\n-      newGroups.splice(index, 1);\n+      const groupToDelete = localConfigurationGroups.get(index);\n+\n+      const newGroups = localConfigurationGroups.remove(index);\n       setLocalConfigurationGroups(newGroups);\n \n       // Delete the corresponding data of the group\n-      const { [groupToDelete]: info, ...restGroupToInfo } = localGroupToInfo;\n-      const { [groupToDelete]: widgets, ...restGroupToWidgets } = localGroupToWidgets;\n-      setLocalGroupToInfo(restGroupToInfo);\n-      setLocalGroupToWidgets(restGroupToWidgets);\n+      const newGroupToInfo = fromJS(localGroupToInfo.delete(groupToDelete));", "originalCommit": "10f0bd497be09aa92fd8717382a981e184e15e02", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzc2MDIzNg==", "url": "https://github.com/cdapio/cdap/pull/12251#discussion_r443760236", "bodyText": "Resolved", "author": "jennac3", "createdAt": "2020-06-22T18:51:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzc0MjE2MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzc0Mjk4MA==", "url": "https://github.com/cdapio/cdap/pull/12251#discussion_r443742980", "bodyText": "the values of the info should be an immutable object already", "author": "elfenheart", "createdAt": "2020-06-22T18:17:27Z", "path": "cdap-ui/app/cdap/components/PluginJSONCreator/Create/Content/Filters/FilterCollection/FilterConditionInput/index.tsx", "diffHunk": "@@ -56,48 +57,53 @@ const FilterConditionInputview: React.FC<IFilterConditionInputProps> = ({\n   setFilterToCondition,\n   widgetInfo,\n }) => {\n-  const existingCondition = filterToCondition[filterID];\n+  const existingCondition = filterToCondition.get(filterID);\n \n   const [conditionMode, setConditionMode] = React.useState(\n-    existingCondition.expression ? FilterConditionMode.Expression : FilterConditionMode.Operator\n+    existingCondition.get('expression')\n+      ? FilterConditionMode.Expression\n+      : FilterConditionMode.Operator\n   );\n \n   const allWidgetNames = widgetInfo\n-    ? Object.values(widgetInfo)\n-        .map((info: IWidgetInfo) => info.name)\n-        .filter((widgetName) => !isNil(widgetName))\n-    : [];\n+    ? widgetInfo\n+        .valueSeq()\n+        .map((info) => fromJS(info).get('name'))", "originalCommit": "10f0bd497be09aa92fd8717382a981e184e15e02", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzc2MDU0Mg==", "url": "https://github.com/cdapio/cdap/pull/12251#discussion_r443760542", "bodyText": "Resolved", "author": "jennac3", "createdAt": "2020-06-22T18:52:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzc0Mjk4MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzc0NDYxOQ==", "url": "https://github.com/cdapio/cdap/pull/12251#discussion_r443744619", "bodyText": "missed this before, but if the top level of the row is an <If>, you can conditionally render the row by checking if (!showToInfo.has(showID)) { return null; } instead", "author": "elfenheart", "createdAt": "2020-06-22T18:20:41Z", "path": "cdap-ui/app/cdap/components/PluginJSONCreator/Create/Content/Filters/FilterCollection/FilterShowlistInput/index.tsx", "diffHunk": "@@ -72,78 +74,65 @@ const FilterShowlistInputView: React.FC<IFilterShowlistInputProps> = ({\n   widgetInfo,\n }) => {\n   const allWidgetNames = widgetInfo\n-    ? Object.values(widgetInfo)\n-        .map((info: IWidgetInfo) => info.name)\n-        .filter((widgetName) => !isNil(widgetName))\n-    : [];\n+    ? widgetInfo\n+        .valueSeq()\n+        .map((info) => fromJS(info).get('name'))\n+        .filter((widgetName) => !isNil(widgetName) && !isNil(widgetName))\n+    : List([]);\n \n   function setShowProperty(showID: string, property: string) {\n     return (val) => {\n-      setShowToInfo((prevObjs) => ({\n-        ...prevObjs,\n-        [showID]: { ...prevObjs[showID], [property]: val },\n-      }));\n+      setShowToInfo(fromJS(showToInfo).setIn([showID, property], val));\n     };\n   }\n \n-  function addShowToFilter(filterObjID: string, index?: number) {\n+  function addShowToFilter(filterObjID: string, index: number) {\n     const newShowID = 'Show_' + uuidV4();\n \n-    setShowToInfo({\n-      ...showToInfo,\n-      [newShowID]: {\n-        name: '',\n-      } as IPropertyShowConfig,\n-    });\n-\n-    if (index === undefined) {\n-      setFilterToShowList({\n-        ...filterToShowList,\n-        [filterObjID]: [...filterToShowList[filterObjID], newShowID],\n-      });\n+    setShowToInfo(\n+      showToInfo.set(\n+        newShowID,\n+        fromJS({\n+          name: '',\n+          type: '',\n+        })\n+      )\n+    );\n+\n+    const showlist = filterToShowList.get(filterObjID);\n+\n+    let newShowlist;\n+    if (showlist.isEmpty()) {\n+      newShowlist = showlist.insert(0, newShowID);\n     } else {\n-      const showList = filterToShowList[filterObjID];\n-\n-      if (showList.length === 0) {\n-        showList.splice(0, 0, newShowID);\n-      } else {\n-        showList.splice(index + 1, 0, newShowID);\n-      }\n-\n-      setFilterToShowList({\n-        ...filterToShowList,\n-        [filterObjID]: showList,\n-      });\n+      newShowlist = showlist.insert(index + 1, newShowID);\n     }\n+\n+    setFilterToShowList(filterToShowList.set(filterObjID, newShowlist));\n   }\n \n   function deleteShowFromFilter(filterObjID: string, index: number) {\n-    const showList = filterToShowList[filterObjID];\n-\n-    const showToDelete = showList[index];\n-\n-    showList.splice(index, 1);\n+    const showlist = filterToShowList.get(filterObjID);\n+    const showToDelete = showlist.get(index);\n \n-    setFilterToShowList({\n-      ...filterToShowList,\n-      [filterObjID]: showList,\n-    });\n+    const newShowlist = showlist.remove(index);\n+    setFilterToShowList(filterToShowList.set(filterObjID, newShowlist));\n \n-    const { [showToDelete]: tmp, ...restShowToInfo } = showToInfo;\n-    setShowToInfo(restShowToInfo);\n+    const newShowToInfo = fromJS(showToInfo.delete(showToDelete));\n+    setShowToInfo(newShowToInfo);\n   }\n \n   return (\n-    <If condition={!isNil(filterToShowList[filterID])}>\n+    <If condition={filterToShowList.has(filterID)}>\n       <Heading type={HeadingTypes.h6} label=\"Add widgets to configure\" />\n-      {filterToShowList[filterID].map((showID: string, showIndex: number) => {\n+      {filterToShowList.get(filterID).map((showID: string, showIndex: number) => {\n         return (\n-          <If key={showID} condition={showToInfo[showID]}>\n+          <If key={showID} condition={showToInfo.has(showID)}>", "originalCommit": "10f0bd497be09aa92fd8717382a981e184e15e02", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzc2MDU3Mg==", "url": "https://github.com/cdapio/cdap/pull/12251#discussion_r443760572", "bodyText": "Resolved", "author": "jennac3", "createdAt": "2020-06-22T18:52:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzc0NDYxOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzc0NjA5NA==", "url": "https://github.com/cdapio/cdap/pull/12251#discussion_r443746094", "bodyText": "i think you should keep the spec version on the variable", "author": "elfenheart", "createdAt": "2020-06-22T18:23:25Z", "path": "cdap-ui/app/cdap/components/PluginJSONCreator/Create/Content/JsonMenu/utilities.ts", "diffHunk": "@@ -27,65 +22,61 @@ function getJSONConfig(widgetJSONData) {\n   } = widgetJSONData;\n \n   const configurationGroupsData = configurationGroups.map((groupID: string) => {\n-    const groupLabel = groupToInfo[groupID].label;\n-    const widgetData = groupToWidgets[groupID].map((widgetID: string) => {\n-      const info: IWidgetInfo = widgetInfo[widgetID];\n-      const widgetAttributes = widgetToAttributes[widgetID];\n-\n-      return {\n-        'widget-type': info.widgetType,\n-        label: info.label,\n-        name: info.name,\n-        ...(info.widgetCategory && { 'widget-category': info.widgetCategory }),\n+    const groupLabel = groupToInfo.get(groupID).get('label');\n+    const widgetData = groupToWidgets.get(groupID).map((widgetID: string) => {\n+      const info = widgetInfo.get(widgetID);\n+      const widgetAttributes = widgetToAttributes.get(widgetID);\n+\n+      return fromJS({\n+        'widget-type': info.get('widgetType'),\n+        label: info.get('label'),\n+        name: info.get('name'),\n+        ...(info.get('widgetCategory') && {\n+          'widget-category': info.get('widgetCategory'),\n+        }),\n         ...(widgetAttributes &&\n-          Object.keys(widgetAttributes).length > 0 && {\n+          List(widgetAttributes.keys()).size > 0 && {\n             'widget-attributes': widgetAttributes,\n           }),\n-      };\n+      });\n     });\n-    return {\n+    return fromJS({\n       label: groupLabel,\n       properties: widgetData,\n-    };\n+    });\n   });\n \n   const filtersData = filters.map((filterID) => {\n-    const filterToShowListData = filterToShowList[filterID].map((showID) => {\n-      let showListData;\n-      if (showToInfo[showID].type) {\n-        showListData = {\n-          name: showToInfo[showID].name,\n-          type: showToInfo[showID].type,\n-        };\n-      } else {\n-        showListData = {\n-          name: showToInfo[showID].name,\n-        };\n-      }\n-      return showListData;\n+    const filterToShowListData = filterToShowList.get(filterID).map((showID) => {\n+      return fromJS({\n+        name: showToInfo.get(showID).get('name'),\n+        ...(showToInfo.get(showID).get('type') && {\n+          type: showToInfo.get(showID).get('type'),\n+        }),\n+      });\n     });\n-    return {\n-      name: filterToName[filterID],\n-      condition: filterToCondition[filterID],\n+    return fromJS({\n+      name: filterToName.get(filterID),\n+      condition: filterToCondition.get(filterID),\n       show: filterToShowListData,\n-    };\n+    });\n   });\n \n   const config = {\n     metadata: {\n-      'spec-version': SPEC_VERSION,\n+      'spec-version': '1.5',", "originalCommit": "10f0bd497be09aa92fd8717382a981e184e15e02", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzc2MDY5Mg==", "url": "https://github.com/cdapio/cdap/pull/12251#discussion_r443760692", "bodyText": "Resolved", "author": "jennac3", "createdAt": "2020-06-22T18:52:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzc0NjA5NA=="}], "type": "inlineReview"}, {"oid": "c9f8a3326b3594c7fd6c59335ba4d2ef20a83493", "url": "https://github.com/cdapio/cdap/commit/c9f8a3326b3594c7fd6c59335ba4d2ef20a83493", "message": "[CDAP-16893] Use immutable.js for updating states (plugin JSON Creator)", "committedDate": "2020-06-22T20:13:38Z", "type": "forcePushed"}, {"oid": "611e494b1a940b14377e9be8508b8770acefeb30", "url": "https://github.com/cdapio/cdap/commit/611e494b1a940b14377e9be8508b8770acefeb30", "message": "[CDAP-16893] Use immutable.js for updating states (plugin JSON Creator)", "committedDate": "2020-06-22T20:20:08Z", "type": "forcePushed"}, {"oid": "c6522bcf1bd28775665b8e1854e50166b8d99769", "url": "https://github.com/cdapio/cdap/commit/c6522bcf1bd28775665b8e1854e50166b8d99769", "message": "[CDAP-16893] Use immutable.js for updating states (plugin JSON Creator)", "committedDate": "2020-06-22T20:23:08Z", "type": "commit"}, {"oid": "c6522bcf1bd28775665b8e1854e50166b8d99769", "url": "https://github.com/cdapio/cdap/commit/c6522bcf1bd28775665b8e1854e50166b8d99769", "message": "[CDAP-16893] Use immutable.js for updating states (plugin JSON Creator)", "committedDate": "2020-06-22T20:23:08Z", "type": "forcePushed"}]}