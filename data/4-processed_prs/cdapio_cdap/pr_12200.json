{"pr_number": 12200, "pr_title": "[CDAP-16845] Fix preview starting when user clicks No with post-run actions", "pr_createdAt": "2020-05-20T22:04:00Z", "pr_url": "https://github.com/cdapio/cdap/pull/12200", "timeline": [{"oid": "fbba0c2a64b7723ba10094fac04dbffab4ca209e", "url": "https://github.com/cdapio/cdap/commit/fbba0c2a64b7723ba10094fac04dbffab4ca209e", "message": "Fix  callback", "committedDate": "2020-05-28T21:49:25Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDMwMDEyMw==", "url": "https://github.com/cdapio/cdap/pull/12200#discussion_r434300123", "bodyText": "nit: it would be clear if the test case says either one or the other. Saying should run or not run preview doesn't say what this test case is testing :). May be split it into two test cases one starting preview after clicking yes and one not starting preview because user clicked no.", "author": "ajainarayanan", "createdAt": "2020-06-03T04:24:59Z", "path": "cdap-ui/cypress/integration/pipeline.spec.ts", "diffHunk": "@@ -96,13 +112,88 @@ describe('Creating a pipeline', () => {\n       .find('.toggle-switch')\n       .click();\n     cy.get('@instrumentationDiv').contains('Off');\n+\n+    cy.contains('Pipeline alert').click();\n+    cy.contains('+').click();\n+    cy.contains('Send Email').click();\n+\n+    // enter sender, recipients, subject, message\n+\n+    cy.get('[data-cy=\"sender\"]').within(() => {\n+      cy.get('input')\n+        .scrollIntoView()\n+        .focus()\n+        .type(TEST_SENDER);\n+    });\n+    cy.get('[data-cy=\"recipients\"]').within(() => {\n+      cy.get('input').type(TEST_RECIPIENT);\n+    });\n+    cy.get('[data-cy=\"subject\"]').within(() => {\n+      cy.get('input').type(TEST_SUBJECT);\n+    });\n+    // validate and see error\n+    cy.get('[data-cy=\"validate-btn\"]').click();\n+\n+    cy.contains('error found').should('exist');\n+\n+    // Fix missing field to resolve error\n+    cy.get('[data-cy=\"message\"]').within(() => {\n+      cy.get('button').click();\n+    });\n+    // validate\n+    cy.get('[data-cy=\"validate-btn\"]').click();\n+    cy.wait(2000);\n+    cy.contains('error found').should('not.exist');\n+\n+    // click next\n+    cy.get('[data-cy=\"next-btn\"]').click();\n+\n+    // click confirm\n+    cy.get('[data-cy=\"confirm-btn\"]').click();\n+\n+    // See email alert\n+    cy.get('[data-cy=\"saved-alerts\"]').within(() => {\n+      cy.contains('Email').should('exist');\n+    });\n+\n     cy.get('[data-testid=config-apply-close]').click();\n+  });\n+  it('should run or not run Preview based on user action on postrun action modal', () => {", "originalCommit": "5bf89c684af1fa106693aa79a93c6660bf7e0911", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDYyMjMwNQ==", "url": "https://github.com/cdapio/cdap/pull/12200#discussion_r434622305", "bodyText": "That makes a lot of sense! Have split into two tests :)", "author": "yukiej", "createdAt": "2020-06-03T14:43:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDMwMDEyMw=="}], "type": "inlineReview"}, {"oid": "ebe34a58615eb2b024c24b7a6f03b6bd0b6e08d5", "url": "https://github.com/cdapio/cdap/commit/ebe34a58615eb2b024c24b7a6f03b6bd0b6e08d5", "message": "Fix  callback\n\nAdd data-cy attributes for preview\n\nAdd preview tests to run locally to check for behavior when post-run action exists", "committedDate": "2020-06-03T14:45:33Z", "type": "commit"}, {"oid": "ebe34a58615eb2b024c24b7a6f03b6bd0b6e08d5", "url": "https://github.com/cdapio/cdap/commit/ebe34a58615eb2b024c24b7a6f03b6bd0b6e08d5", "message": "Fix  callback\n\nAdd data-cy attributes for preview\n\nAdd preview tests to run locally to check for behavior when post-run action exists", "committedDate": "2020-06-03T14:45:33Z", "type": "forcePushed"}]}