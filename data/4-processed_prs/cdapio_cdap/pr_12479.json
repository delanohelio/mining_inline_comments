{"pr_number": 12479, "pr_title": "[CDAP-17015] Update Preview UI to handle queued preview runs", "pr_createdAt": "2020-07-21T01:38:06Z", "pr_url": "https://github.com/cdapio/cdap/pull/12479", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODIxNzcwMA==", "url": "https://github.com/cdapio/cdap/pull/12479#discussion_r458217700", "bodyText": "We can capitalize strings to keep consistency", "author": "jennac3", "createdAt": "2020-07-21T16:10:08Z", "path": "cdap-ui/app/cdap/services/AlertStatus.ts", "diffHunk": "@@ -0,0 +1,24 @@\n+/*\n+ * Copyright \u00a9 2020 Cask Data, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+// TO-DO(CDAP-17088): Move this to Alert component once it has been converted to TS\n+enum ALERT_STATUS {\n+  Success = 'success',", "originalCommit": "5b07830e07d371966159792ed8c076ab94ac93ce", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTA0NTQ0OA==", "url": "https://github.com/cdapio/cdap/pull/12479#discussion_r459045448", "bodyText": "This is coming from the expected props for the Alert component. I agree it looks a little funny, but we use the Alert component in a lot of places that would also need updating so I don't want to make a change to that in this PR. That said, I've noted the suggested improvement in ALERT_STATUS in the JIRA for the future typescript Alert component.", "author": "yukiej", "createdAt": "2020-07-22T19:54:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODIxNzcwMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODIxOTE4MA==", "url": "https://github.com/cdapio/cdap/pull/12479#discussion_r458219180", "bodyText": "Is it possible to define timerLabel in enums? (Pending, Running, Duration)", "author": "jennac3", "createdAt": "2020-07-21T16:12:17Z", "path": "cdap-ui/app/hydrator/controllers/create/toppanel-ctrl.js", "diffHunk": "@@ -294,10 +304,36 @@ class HydratorPlusPlusTopPanelCtrl {\n     seconds = seconds < 10 ? '0' + seconds : seconds;\n     minutes = minutes < 10 ? '0' + minutes : minutes;\n \n+    this.setDisplayDuration(minutes, seconds);\n+  }\n+\n+  setDisplayDuration(minutes, seconds) {\n     this.displayDuration = {\n-      minutes: minutes,\n-      seconds: seconds\n-    };\n+      minutes: !minutes ? '--' : minutes,\n+      seconds: !seconds ? '--' : seconds,\n+    }\n+  }\n+\n+  updateTimerLabelAndTitle(res) {\n+    // set default\n+    if (!res) {\n+      this.timerLabel = 'Duration';\n+      this.queueStatus = '';\n+      return;\n+    }\n+\n+    const { WAITING, ACQUIRED, INIT, RUNNING } = window.CaskCommon.PREVIEW_STATUS;\n+    if (res.status === WAITING && res.positionInWaitingQueue > 0) {\n+      const runsAheadInQueue = res.positionInWaitingQueue;\n+      this.queueStatus = `${runsAheadInQueue} ${runsAheadInQueue === 1? 'run' : 'runs'} ahead in queue`;\n+      this.timerLabel = `${runsAheadInQueue} Pending`;", "originalCommit": "5b07830e07d371966159792ed8c076ab94ac93ce", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTA1NTEzMw==", "url": "https://github.com/cdapio/cdap/pull/12479#discussion_r459055133", "bodyText": "I can't add an enum here so I added the timer labels to global-constants.", "author": "yukiej", "createdAt": "2020-07-22T20:12:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODIxOTE4MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTA4MDUyOA==", "url": "https://github.com/cdapio/cdap/pull/12479#discussion_r459080528", "bodyText": "nit: the indentation seems a bit off here? I'm not sure if it's because of github UI!", "author": "jennac3", "createdAt": "2020-07-22T21:01:06Z", "path": "cdap-ui/app/hydrator/controllers/create/toppanel-ctrl.js", "diffHunk": "@@ -294,10 +304,36 @@ class HydratorPlusPlusTopPanelCtrl {\n     seconds = seconds < 10 ? '0' + seconds : seconds;\n     minutes = minutes < 10 ? '0' + minutes : minutes;\n \n+    this.setDisplayDuration(minutes, seconds);\n+  }\n+\n+  setDisplayDuration(minutes, seconds) {\n     this.displayDuration = {\n-      minutes: minutes,\n-      seconds: seconds\n-    };\n+      minutes: !minutes ? '--' : minutes,\n+      seconds: !seconds ? '--' : seconds,\n+    }\n+  }\n+\n+  updateTimerLabelAndTitle(res) {\n+    // set default\n+    if (!res) {\n+      this.timerLabel = this.GLOBALS.en.hydrator.preview.timerLabels.DURATION;\n+      this.queueStatus = '';\n+      return;\n+    }\n+\n+    const { WAITING, ACQUIRED, INIT, RUNNING } = window.CaskCommon.PREVIEW_STATUS;\n+    if (res.status === WAITING && res.positionInWaitingQueue > 0) {\n+      const runsAheadInQueue = res.positionInWaitingQueue;\n+      this.queueStatus = `${runsAheadInQueue} ${runsAheadInQueue === 1? 'run' : 'runs'} ahead in queue`;\n+      this.timerLabel = `${runsAheadInQueue} ${this.GLOBALS.en.hydrator.preview.timerLabels.PENDING}`;\n+    } else if ([ WAITING, ACQUIRED, INIT, RUNNING ].includes(res.status) && this.loadingLabel !== 'Stopping') {\n+      this.timerLabel = this.GLOBALS.en.hydrator.preview.timerLabels.RUNNING;\n+      this.queueStatus = '';\n+    } else {\n+    this.timerLabel = this.GLOBALS.en.hydrator.preview.timerLabels.DURATION;", "originalCommit": "9d4014397a4b5213e38cf3a84ad9b3c224e00318", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTE3ODA4Ng==", "url": "https://github.com/cdapio/cdap/pull/12479#discussion_r459178086", "bodyText": "good catch, fixed!", "author": "yukiej", "createdAt": "2020-07-23T01:59:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTA4MDUyOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTEyMTkyMQ==", "url": "https://github.com/cdapio/cdap/pull/12479#discussion_r459121921", "bodyText": "Would this be easier to read as minutes ? minutes : '--' or even minutes || '--'? It looks like we display -- for 0.", "author": "njbriggs", "createdAt": "2020-07-22T22:35:01Z", "path": "cdap-ui/app/hydrator/controllers/create/toppanel-ctrl.js", "diffHunk": "@@ -294,10 +304,36 @@ class HydratorPlusPlusTopPanelCtrl {\n     seconds = seconds < 10 ? '0' + seconds : seconds;\n     minutes = minutes < 10 ? '0' + minutes : minutes;\n \n+    this.setDisplayDuration(minutes, seconds);\n+  }\n+\n+  setDisplayDuration(minutes, seconds) {\n     this.displayDuration = {\n-      minutes: minutes,\n-      seconds: seconds\n-    };\n+      minutes: !minutes ? '--' : minutes,", "originalCommit": "9d4014397a4b5213e38cf3a84ad9b3c224e00318", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTE3ODM3MA==", "url": "https://github.com/cdapio/cdap/pull/12479#discussion_r459178370", "bodyText": "Done", "author": "yukiej", "createdAt": "2020-07-23T02:01:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTEyMTkyMQ=="}], "type": "inlineReview"}, {"oid": "89c0935256b752944a1db54b56d4cfb697580c97", "url": "https://github.com/cdapio/cdap/commit/89c0935256b752944a1db54b56d4cfb697580c97", "message": "Update preview statuses and update alert component to handle info case\n\nUpdate preview statuses and button messaging to include WAITING and ACQUIRED", "committedDate": "2020-07-23T02:02:40Z", "type": "commit"}, {"oid": "593a0f6bc4f82fbcb3af561cb528a9e90af5f935", "url": "https://github.com/cdapio/cdap/commit/593a0f6bc4f82fbcb3af561cb528a9e90af5f935", "message": "address feedback", "committedDate": "2020-07-23T02:28:22Z", "type": "commit"}, {"oid": "593a0f6bc4f82fbcb3af561cb528a9e90af5f935", "url": "https://github.com/cdapio/cdap/commit/593a0f6bc4f82fbcb3af561cb528a9e90af5f935", "message": "address feedback", "committedDate": "2020-07-23T02:28:22Z", "type": "forcePushed"}]}