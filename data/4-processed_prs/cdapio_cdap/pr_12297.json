{"pr_number": 12297, "pr_title": "[CDAP-16690] Add preview data view", "pr_createdAt": "2020-06-10T22:36:34Z", "pr_url": "https://github.com/cdapio/cdap/pull/12297", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODQ2MzIyMw==", "url": "https://github.com/cdapio/cdap/pull/12297#discussion_r438463223", "bodyText": "nit: Not sure how we missed it but the cls argument is actually not be being entirely here right?  We can either remove cls and use classes for both headingContainer and messageText or we could use cls for both?", "author": "ajainarayanan", "createdAt": "2020-06-10T23:34:47Z", "path": "cdap-ui/app/cdap/components/PreviewData/index.tsx", "diffHunk": "@@ -0,0 +1,147 @@\n+/*\n+ * Copyright \u00a9 2020 Cask Data, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+import React, { useState, useEffect } from 'react';\n+import PropTypes from 'prop-types';\n+import { INode, fetchPreview, IRecords, IPreviewData } from 'components/PreviewData/utilities';\n+import If from 'components/If';\n+import isEmpty from 'lodash/isEmpty';\n+import Heading, { HeadingTypes } from 'components/Heading';\n+import LoadingSVGCentered from 'components/LoadingSVGCentered';\n+import { messageTextStyle } from 'components/PreviewData/Table';\n+import PreviewTableContainer from 'components/PreviewData/TableContainer';\n+import withStyles, { WithStyles } from '@material-ui/core/styles/withStyles';\n+import ThemeWrapper from 'components/ThemeWrapper';\n+\n+const styles = () => {\n+  return {\n+    messageText: messageTextStyle,\n+    headingContainer: {\n+      paddingLeft: '10px',\n+    },\n+  };\n+};\n+\n+interface IPreviewDataViewProps extends WithStyles<typeof styles> {\n+  previewId: string;\n+  selectedNode: INode;\n+  getStagesAndConnections: () => any;\n+  previewStatus: string;\n+}\n+\n+export interface ITableData {\n+  inputs: { [key: string]: IRecords };\n+  outputs: { [key: string]: IRecords };\n+}\n+\n+const PreviewDataViewBase: React.FC<IPreviewDataViewProps> = ({\n+  previewId,\n+  selectedNode,\n+  getStagesAndConnections,\n+  previewStatus,\n+  classes,\n+}) => {\n+  const { stages, connections } = getStagesAndConnections();\n+\n+  const [previewLoading, setPreviewLoading] = useState(false);\n+  const [previewData, setPreviewData] = useState<IPreviewData>({});\n+\n+  const updatePreviewCb = (updatedPreview: IPreviewData) => {\n+    setPreviewData(updatedPreview);\n+  };\n+\n+  useEffect(\n+    () => {\n+      if (previewId) {\n+        fetchPreview(\n+          selectedNode,\n+          previewId,\n+          stages,\n+          connections,\n+          setPreviewLoading,\n+          updatePreviewCb\n+        );\n+      }\n+    },\n+    [previewId]\n+  );\n+\n+  const getTableData = () => {\n+    let inputs = {};\n+    let outputs = {};\n+\n+    if (!isEmpty(previewData)) {\n+      if (!isEmpty(previewData.input) && !selectedNode.isSource) {\n+        inputs = previewData.input;\n+      }\n+      if (!isEmpty(previewData.output) && !selectedNode.isSink) {\n+        outputs = previewData.output;\n+      }\n+    }\n+    return { inputs, outputs };\n+  };\n+\n+  const tableData: ITableData = getTableData();\n+\n+  const loadingMsg = (cls) => (\n+    <div className={classes.headingContainer}>", "originalCommit": "47c4249d3bebc8e70b88f95a397acceec28bb760", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODUwNjU5OA==", "url": "https://github.com/cdapio/cdap/pull/12297#discussion_r438506598", "bodyText": "Good catch! I will fix this in the next PR.", "author": "yukiej", "createdAt": "2020-06-11T02:21:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODQ2MzIyMw=="}], "type": "inlineReview"}, {"oid": "4a7ffa9ce102a768c60b1fd2b55e5958d9b9dbbc", "url": "https://github.com/cdapio/cdap/commit/4a7ffa9ce102a768c60b1fd2b55e5958d9b9dbbc", "message": "Add preview status and preview data view\n\nMove preview loadinig to preview data view from nodeconfig", "committedDate": "2020-06-11T02:20:35Z", "type": "commit"}, {"oid": "1fb55906f9367ac4effe99f45afb8560a0fe1ea3", "url": "https://github.com/cdapio/cdap/commit/1fb55906f9367ac4effe99f45afb8560a0fe1ea3", "message": "Cherry-pick joiner fix from 6.2 - see CDAP-16106", "committedDate": "2020-06-11T02:20:35Z", "type": "commit"}, {"oid": "a67226eb619e6fac9cd2712219fd319723a26fd7", "url": "https://github.com/cdapio/cdap/commit/a67226eb619e6fac9cd2712219fd319723a26fd7", "message": "Include port names for stages with multiple inputs or outputs", "committedDate": "2020-06-11T02:20:35Z", "type": "commit"}, {"oid": "a67226eb619e6fac9cd2712219fd319723a26fd7", "url": "https://github.com/cdapio/cdap/commit/a67226eb619e6fac9cd2712219fd319723a26fd7", "message": "Include port names for stages with multiple inputs or outputs", "committedDate": "2020-06-11T02:20:35Z", "type": "forcePushed"}]}