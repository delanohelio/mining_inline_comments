{"pr_number": 12354, "pr_title": "[CDAP-16972] Fix to stop pipeline preview running properly", "pr_createdAt": "2020-06-17T04:26:32Z", "pr_url": "https://github.com/cdapio/cdap/pull/12354", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTMwMDUwOA==", "url": "https://github.com/cdapio/cdap/pull/12354#discussion_r441300508", "bodyText": "nit: Could we explicitly check for empty values instead of falsey values.", "author": "ajainarayanan", "createdAt": "2020-06-17T06:06:07Z", "path": "cdap-ui/app/cdap/components/KeyValuePairs/KeyValueStoreActions.js", "diffHunk": "@@ -44,8 +44,8 @@ const convertKeyValuePairsObjToMap = (keyValues) => {\n const keyValuePairsHaveMissingValues = (keyValues) => {\n   if (keyValues.pairs) {\n     return keyValues.pairs.some((keyValuePair) => {\n-      if (keyValuePair.notDeletable && keyValuePair.provided) {\n-        return false;\n+      if (keyValuePair.notDeletable) {\n+        return !keyValuePair.value;", "originalCommit": "5500d2d331946adf74ec790c21c1fd1f31a626c7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTgxNTk3Mg==", "url": "https://github.com/cdapio/cdap/pull/12354#discussion_r441815972", "bodyText": "done", "author": "itsanudeep", "createdAt": "2020-06-17T20:32:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTMwMDUwOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTczNjY0Ng==", "url": "https://github.com/cdapio/cdap/pull/12354#discussion_r441736646", "bodyText": "nit: space after if", "author": "elfenheart", "createdAt": "2020-06-17T18:13:51Z", "path": "cdap-ui/app/hydrator/controllers/create/toppanel-ctrl.js", "diffHunk": "@@ -481,7 +481,10 @@ class HydratorPlusPlusTopPanelCtrl {\n   }\n \n   startOrStopPreview() {\n-    if (this.doesPreviewHaveEmptyMacros) {\n+    if(this.previewRunning){", "originalCommit": "5500d2d331946adf74ec790c21c1fd1f31a626c7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTgyMzI3OA==", "url": "https://github.com/cdapio/cdap/pull/12354#discussion_r441823278", "bodyText": "done", "author": "itsanudeep", "createdAt": "2020-06-17T20:44:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTczNjY0Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTczNjk3Ng==", "url": "https://github.com/cdapio/cdap/pull/12354#discussion_r441736976", "bodyText": "this function signature doesn't make sense anymore", "author": "elfenheart", "createdAt": "2020-06-17T18:14:25Z", "path": "cdap-ui/app/hydrator/controllers/create/toppanel-ctrl.js", "diffHunk": "@@ -481,7 +481,10 @@ class HydratorPlusPlusTopPanelCtrl {\n   }\n \n   startOrStopPreview() {\n-    if (this.doesPreviewHaveEmptyMacros) {\n+    if(this.previewRunning){\n+      this.stopPreview();\n+    }\n+    else if (this.doesPreviewHaveEmptyMacros) {\n       this.doStartOrStopPreview();", "originalCommit": "5500d2d331946adf74ec790c21c1fd1f31a626c7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTgyMzQ1Nw==", "url": "https://github.com/cdapio/cdap/pull/12354#discussion_r441823457", "bodyText": "refactored the start stop functions", "author": "itsanudeep", "createdAt": "2020-06-17T20:44:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTczNjk3Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTg0MzE3OA==", "url": "https://github.com/cdapio/cdap/pull/12354#discussion_r441843178", "bodyText": "we won't ever get to this condition, can we?", "author": "elfenheart", "createdAt": "2020-06-17T21:25:13Z", "path": "cdap-ui/app/hydrator/controllers/create/toppanel-ctrl.js", "diffHunk": "@@ -481,26 +481,24 @@ class HydratorPlusPlusTopPanelCtrl {\n   }\n \n   startOrStopPreview() {\n-    if (this.doesPreviewHaveEmptyMacros) {\n-      this.doStartOrStopPreview();\n-    } else {\n-      // Validate and show runtime arguments if there are\n-      // un-fulfilled macros.\n-      this.toggleConfig();\n-    }\n-  }\n-\n-  doStartOrStopPreview() {\n-    this.getRuntimeArguments()\n-      .then(() => {\n+    if (this.previewRunning) {\n+      this.stopPreview();\n+    } else if (this.doesPreviewHaveEmptyMacros) {\n+      this.getRuntimeArguments().then(() => {\n         if (this.previewRunning) {\n           this.stopPreview();", "originalCommit": "118ea295467bd6c53ca17da049dbefacb5b81713", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTg3ODI1MA==", "url": "https://github.com/cdapio/cdap/pull/12354#discussion_r441878250", "bodyText": "If getRuntimeArguments call takes a while to finish, the preview state could change and we might hit this edge case I think. I doubt it's likely to happen in a real scenario but just to be safe, I did not remove this. Let me know if I should remove this, will make the change.", "author": "itsanudeep", "createdAt": "2020-06-17T22:58:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTg0MzE3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTkwNzk2NQ==", "url": "https://github.com/cdapio/cdap/pull/12354#discussion_r441907965", "bodyText": "in that case i think the right thing to do is to do nothing. When the getRuntimeArguments modal open, the expectation is for the preview to start. If it's already running, it shouldn't stop the currently running preview.", "author": "elfenheart", "createdAt": "2020-06-18T00:46:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTg0MzE3OA=="}], "type": "inlineReview"}, {"oid": "d98af8932102ae61873d51baa388cc895949daa6", "url": "https://github.com/cdapio/cdap/commit/d98af8932102ae61873d51baa388cc895949daa6", "message": "Resolve macros at run button level", "committedDate": "2020-06-18T08:27:45Z", "type": "forcePushed"}, {"oid": "0b780c96bf1fd78db6252760fd835b28f3be37cf", "url": "https://github.com/cdapio/cdap/commit/0b780c96bf1fd78db6252760fd835b28f3be37cf", "message": "Fix to properly stop pipeline preview", "committedDate": "2020-06-18T15:35:54Z", "type": "commit"}, {"oid": "0b780c96bf1fd78db6252760fd835b28f3be37cf", "url": "https://github.com/cdapio/cdap/commit/0b780c96bf1fd78db6252760fd835b28f3be37cf", "message": "Fix to properly stop pipeline preview", "committedDate": "2020-06-18T15:35:54Z", "type": "forcePushed"}]}