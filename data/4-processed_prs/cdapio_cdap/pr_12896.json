{"pr_number": 12896, "pr_title": "[CDAP-17446] Replication Detail Page Redesign", "pr_createdAt": "2020-12-11T05:16:19Z", "pr_url": "https://github.com/cdapio/cdap/pull/12896", "timeline": [{"oid": "85acf65f27229df888b1b8494c1d22e858c4b7d2", "url": "https://github.com/cdapio/cdap/commit/85acf65f27229df888b1b8494c1d22e858c4b7d2", "message": "[CDAP-17446] Replication Detail Page Redesign", "committedDate": "2020-12-11T06:02:21Z", "type": "forcePushed"}, {"oid": "6c39938aa0782d85c4239d05318577e5c6424d60", "url": "https://github.com/cdapio/cdap/commit/6c39938aa0782d85c4239d05318577e5c6424d60", "message": "[CDAP-17446] Replication Detail Page Redesign", "committedDate": "2020-12-15T04:30:36Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzA1Njk2Mw==", "url": "https://github.com/cdapio/cdap/pull/12896#discussion_r543056963", "bodyText": "nit: Are we introducing a different heading size?", "author": "ajainarayanan", "createdAt": "2020-12-15T05:27:28Z", "path": "cdap-ui/app/cdap/components/Replicator/Detail/ContentHeading/index.tsx", "diffHunk": "@@ -0,0 +1,112 @@\n+/*\n+ * Copyright \u00a9 2020 Cask Data, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+import React, { useState, useContext } from 'react';\n+import withStyles, { WithStyles, StyleRules } from '@material-ui/core/styles/withStyles';\n+import { DetailContext } from 'components/Replicator/Detail';\n+import { objectQuery } from 'services/helpers';\n+import ConfigDisplay from 'components/Replicator/ConfigDisplay';\n+import If from 'components/If';\n+import RunInfo from 'components/Replicator/Detail/ContentHeading/RunInfo';\n+\n+const styles = (theme): StyleRules => {\n+  return {\n+    root: {\n+      '& > hr': {\n+        borderWidth: '4px',\n+        borderColor: theme.palette.grey[500],\n+        marginLeft: '-40px',\n+        marginRight: '-40px',\n+      },\n+    },\n+    contentHeading: {\n+      display: 'grid',\n+      gridTemplateColumns: '1fr 550px',\n+      marginTop: '15px',\n+      alignItems: 'center',\n+    },\n+    text: {\n+      fontSize: '18px',", "originalCommit": "6c39938aa0782d85c4239d05318577e5c6424d60", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzA1NzI3MQ==", "url": "https://github.com/cdapio/cdap/pull/12896#discussion_r543057271", "bodyText": "Same here. We should use standardized headings. @leacd Is there any specific need to resize the headings here?", "author": "ajainarayanan", "createdAt": "2020-12-15T05:28:26Z", "path": "cdap-ui/app/cdap/components/Replicator/Detail/DetailContent/index.tsx", "diffHunk": "@@ -0,0 +1,103 @@\n+/*\n+ * Copyright \u00a9 2020 Cask Data, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+import React, { useContext } from 'react';\n+import withStyles, { WithStyles, StyleRules } from '@material-ui/core/styles/withStyles';\n+import { Route, Switch, NavLink } from 'react-router-dom';\n+import { getCurrentNamespace } from 'services/NamespaceStore';\n+import { basepath } from 'components/Replicator';\n+import { DetailContext } from 'components/Replicator/Detail';\n+import Overview from 'components/Replicator/Detail/Overview';\n+import Monitoring from 'components/Replicator/Detail/Monitoring';\n+import { humanReadableDate } from 'services/helpers';\n+\n+const styles = (theme): StyleRules => {\n+  return {\n+    root: {\n+      display: 'grid',\n+      gridTemplateColumns: '300px 1fr',\n+      alignItems: 'end',\n+    },\n+    link: {\n+      color: theme.palette.grey[50],\n+      fontSize: '25px',", "originalCommit": "6c39938aa0782d85c4239d05318577e5c6424d60", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzYxOTMzMg==", "url": "https://github.com/cdapio/cdap/pull/12896#discussion_r543619332", "bodyText": "the NavLink cannot apply the activeClass stylings if we use heading component here", "author": "elfenheart", "createdAt": "2020-12-15T19:17:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzA1NzI3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzYyNDA4Nw==", "url": "https://github.com/cdapio/cdap/pull/12896#discussion_r543624087", "bodyText": "Wouldn't the Heading component be nested inside the NavLink? The activeClassStyles will still get applied to the H tags nested under the anchor tag right? Am I missing something.", "author": "ajainarayanan", "createdAt": "2020-12-15T19:24:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzA1NzI3MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzA1OTc5MQ==", "url": "https://github.com/cdapio/cdap/pull/12896#discussion_r543059791", "bodyText": "nit: This is already exported from helpers.", "author": "ajainarayanan", "createdAt": "2020-12-15T05:35:41Z", "path": "cdap-ui/app/cdap/components/Replicator/Detail/Monitoring/Metrics/parser.tsx", "diffHunk": "@@ -0,0 +1,89 @@\n+/*\n+ * Copyright \u00a9 2020 Cask Data, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+import { IRawMetricData } from 'components/Replicator/types';\n+import { truncateNumber } from 'services/helpers';\n+import { convertBytesToHumanReadable } from 'services/helpers';\n+\n+interface IAggregateMetrics {\n+  dataReplicated: number;\n+  eventsPerMin: number;\n+  latency: number;\n+  errors: number;\n+  totalEvents: number;\n+  inserts: number;\n+  updates: number;\n+  deletes: number;\n+}\n+\n+const METRIC_NAME_MAP = {\n+  'user.dml.inserts': 'inserts',\n+  'user.dml.updates': 'updates',\n+  'user.dml.deletes': 'deletes',\n+  'user.dml.errors': 'errors',\n+  'user.dml.latency.seconds': 'latency',\n+  'user.dml.data.processed.bytes': 'dataReplicated',\n+};\n+\n+const PRECISION = 2;\n+\n+const ONE_MIN_SECONDS = 60;", "originalCommit": "6c39938aa0782d85c4239d05318577e5c6424d60", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzA2MTg0Ng==", "url": "https://github.com/cdapio/cdap/pull/12896#discussion_r543061846", "bodyText": "nit: Seems like all the parsers have most of the metrics in common. Can we extract out the common metrics into one parser and reuse it. Would be useful if at some point in we change any of the metrics.", "author": "ajainarayanan", "createdAt": "2020-12-15T05:41:37Z", "path": "cdap-ui/app/cdap/components/Replicator/Detail/Monitoring/ThroughputLatencyGraphs/parser.ts", "diffHunk": "@@ -44,10 +44,10 @@ interface IRawMetricData {\n }\n \n const METRIC_NAME_MAP = {\n-  'user.dml.insert': 'inserts',\n-  'user.dml.update': 'updates',\n-  'user.dml.delete': 'deletes',\n-  'user.dml.error': 'errors',\n+  'user.dml.inserts': 'inserts',", "originalCommit": "6c39938aa0782d85c4239d05318577e5c6424d60", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzU2ODQ2MQ==", "url": "https://github.com/cdapio/cdap/pull/12896#discussion_r543568461", "bodyText": "the parsers are different, the grouping of the metrics are different. There is some clean up and consolidation that can happen, will do that in subsequent PR", "author": "elfenheart", "createdAt": "2020-12-15T18:05:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzA2MTg0Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzA2MzE5Mw==", "url": "https://github.com/cdapio/cdap/pull/12896#discussion_r543063193", "bodyText": "nit: Will this be removed in a subsequent PR?", "author": "ajainarayanan", "createdAt": "2020-12-15T05:45:14Z", "path": "cdap-ui/app/cdap/components/Replicator/Detail/Overview/TablesList/index.tsx", "diffHunk": "@@ -0,0 +1,330 @@\n+/*\n+ * Copyright \u00a9 2020 Cask Data, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+import React, { useContext, useEffect, useState } from 'react';\n+import withStyles, { WithStyles, StyleRules } from '@material-ui/core/styles/withStyles';\n+import { DetailContext } from 'components/Replicator/Detail';\n+import { generateTableKey } from 'components/Replicator/utilities';\n+import { Map } from 'immutable';\n+import { MyReplicatorApi } from 'api/replicator';\n+import { getCurrentNamespace } from 'services/NamespaceStore';\n+import TextField from '@material-ui/core/TextField';\n+import InputAdornment from '@material-ui/core/InputAdornment';\n+import Search from '@material-ui/icons/Search';\n+import debounce from 'lodash/debounce';\n+import Table from 'components/Table';\n+import TableHeader from 'components/Table/TableHeader';\n+import TableRow from 'components/Table/TableRow';\n+import TableCell from 'components/Table/TableCell';\n+import TableBody from 'components/Table/TableBody';\n+import IconSVG from 'components/IconSVG';\n+import MetricsQueryHelper from 'services/MetricsQueryHelper';\n+import { PROGRAM_INFO } from 'components/Replicator/constants';\n+import { MyMetricApi } from 'api/metric';\n+import { parseOverviewMetrics } from 'components/Replicator/Detail/Overview/TablesList/metricsParser';\n+import { compare } from 'natural-orderby';\n+import TableColumnGroup from 'components/Table/TableColumnGroup';\n+import ColumnGroup from 'components/Table/ColumnGroup';\n+import TimePeriodDropdown from 'components/Replicator/Detail/TimePeriodDropdown';\n+\n+const styles = (theme): StyleRules => {\n+  return {\n+    grid: {\n+      height: '500px',\n+    },\n+\n+    subtitle: {\n+      marginTop: '10px',\n+      marginBottom: '10px',\n+      display: 'grid',\n+      gridTemplateColumns: '50% 50%',\n+      alignItems: 'center',\n+\n+      '& > div:last-child': {\n+        textAlign: 'right',\n+      },\n+    },\n+    search: {\n+      width: '250px',\n+\n+      '& input': {\n+        paddingTop: '10px',\n+        paddingBottom: '10px',\n+      },\n+    },\n+    SNAPSHOTTING: {\n+      color: theme.palette.blue[100],\n+    },\n+    REPLICATING: {\n+      color: theme.palette.blue[100],\n+    },\n+    FAILING: {\n+      color: theme.palette.red[100],\n+    },\n+    IDLE: {\n+      color: theme.palette.grey[200],\n+    },\n+  };\n+};\n+\n+const TablesListView: React.FC<WithStyles<typeof styles>> = ({ classes }) => {\n+  const { name, tables, columns, offsetBasePath, timeRange } = useContext(DetailContext);\n+\n+  const [statusMap, setStatusMap] = useState(Map<string, string>());\n+  const [filteredTables, setFilteredTables] = useState(sortTable(tables.toList()));\n+  const [search, setSearch] = useState('');\n+  const [tableMetricsMap, setTableMetricsMap] = useState({});\n+\n+  function handleSearch(e) {\n+    setSearch(e.target.value);\n+  }\n+\n+  function sortTable(unorderedTable) {\n+    return unorderedTable\n+      .sort((a, b) => {\n+        return compare()(a.get('table'), b.get('table'));\n+      })\n+      .toList();\n+  }\n+\n+  const filterTableBySearch = debounce(() => {\n+    if (!search || search.length === 0) {\n+      setFilteredTables(sortTable(tables.toList()));\n+      return;\n+    }\n+\n+    const filteredList = tables\n+      .filter((row) => {\n+        const normalizedTable = row.get('table').toLowerCase();\n+        const normalizedSearch = search.toLowerCase();\n+\n+        return normalizedTable.indexOf(normalizedSearch) !== -1;\n+      })\n+      .toList();\n+\n+    setFilteredTables(sortTable(filteredList));\n+  }, 300);\n+\n+  // handle search query change\n+  useEffect(filterTableBySearch, [search, tables]);\n+\n+  useEffect(() => {\n+    if (!offsetBasePath || offsetBasePath.length === 0) {\n+      return;\n+    }\n+\n+    const params = {\n+      namespace: getCurrentNamespace(),\n+    };\n+\n+    const body = {\n+      name,\n+      offsetBasePath,\n+    };\n+\n+    // TODO: optimize polling\n+    // Don't poll when status is not running\n+    const statusPoll$ = MyReplicatorApi.pollTableStatus(params, body).subscribe((res) => {\n+      const tableStatus = res.tables;\n+\n+      let status = Map<string, string>();\n+      tableStatus.forEach((tableInfo) => {\n+        const tableKey = generateTableKey(tableInfo);\n+        status = status.set(tableKey, tableInfo.state);\n+      });\n+\n+      setStatusMap(status);\n+    });\n+\n+    return () => {\n+      statusPoll$.unsubscribe();\n+    };\n+  }, [offsetBasePath]);\n+\n+  useEffect(() => {\n+    if (tables.size === 0) {\n+      return;\n+    }\n+\n+    const tags = {\n+      namespace: getCurrentNamespace(),\n+      app: name,\n+      worker: PROGRAM_INFO.programId,\n+      run: '*',\n+      instance: '*',\n+    };\n+\n+    const tagsParams = MetricsQueryHelper.tagsToParams(tags);\n+\n+    const metrics = ['inserts', 'updates', 'deletes', 'errors', 'latency.seconds']\n+      .map((metric) => {\n+        return `metric=user.dml.${metric}`;\n+      })\n+      .join('&');\n+\n+    const start = `start=now-${timeRange}`;\n+    const end = 'end=now';\n+    const aggregate = 'aggregate=false';\n+    const groupBy = 'groupBy=ent';\n+\n+    const params = [start, end, aggregate, groupBy, tagsParams, metrics].join('&');\n+\n+    MyMetricApi.queryTags({ params }).subscribe(\n+      (res) => {\n+        setTableMetricsMap(\n+          parseOverviewMetrics(\n+            res,\n+            tables\n+              .toList()\n+              .map((tableInfo) => tableInfo.get('table'))\n+              .toJS()\n+          )\n+        );\n+      },\n+      (err) => {\n+        // tslint:disable-next-line: no-console\n+        console.log('err', err);\n+      }\n+    );\n+  }, [timeRange, tables]);\n+  return (\n+    <div className={classes.root}>\n+      <div className={classes.subtitle}>\n+        <div>\n+          <strong>{tables.size}</strong> tables to be replicated\n+        </div>\n+        <div>\n+          <TextField\n+            className={classes.search}\n+            value={search}\n+            onChange={handleSearch}\n+            variant=\"outlined\"\n+            placeholder=\"Search by table name\"\n+            InputProps={{\n+              startAdornment: (\n+                <InputAdornment position=\"start\">\n+                  <Search />\n+                </InputAdornment>\n+              ),\n+            }}\n+          />\n+        </div>\n+      </div>\n+\n+      <Table\n+        columnTemplate=\"30px 2fr 100px 1fr 1fr 1fr 150px 1fr 1fr 1fr\"\n+        classes={{ grid: classes.grid }}\n+      >\n+        <TableHeader>\n+          <TableColumnGroup>\n+            <ColumnGroup gridColumn=\"4 / span 7\">\n+              Activities in the <TimePeriodDropdown />\n+            </ColumnGroup>\n+          </TableColumnGroup>\n+          <TableRow>\n+            <TableCell>\n+              <IconSVG name=\"icon-circle\" className={classes.IDLE} />\n+            </TableCell>\n+            <TableCell>Table name</TableCell>\n+            <TableCell textAlign=\"right\">\n+              <div>Selected</div>\n+              <div>columns</div>\n+            </TableCell>\n+            <TableCell textAlign=\"right\">\n+              <div>No. events</div>\n+              <div>replicated</div>\n+            </TableCell>\n+            <TableCell textAlign=\"right\">\n+              <div>Throughput</div>\n+              <div>(events/min)</div>\n+            </TableCell>\n+            <TableCell textAlign=\"right\">\n+              <div>Latency</div>\n+              <div>(min)</div>\n+            </TableCell>\n+            <TableCell />\n+            <TableCell textAlign=\"right\">Inserts</TableCell>\n+            <TableCell textAlign=\"right\">Updates</TableCell>\n+            <TableCell textAlign=\"right\">Deletes</TableCell>\n+          </TableRow>\n+        </TableHeader>\n+\n+        <TableBody>\n+          {filteredTables.toList().map((row) => {\n+            const tableKey = generateTableKey(row);\n+\n+            const tableColumns = columns.get(tableKey);\n+            const numColumns = tableColumns ? tableColumns.size : 0;\n+            const tableStatus = statusMap.get(tableKey) || 'IDLE';\n+            const icon = tableStatus === 'SNAPSHOTTING' ? 'icon-circle-o' : 'icon-circle';\n+            const tableName = row.get('table');\n+            const tableMetrics = tableMetricsMap[tableName] || {};\n+\n+            return (\n+              <TableRow key={tableKey.toString()}>\n+                <TableCell>\n+                  <IconSVG name={icon} className={classes[tableStatus]} />\n+                </TableCell>\n+                <TableCell>{tableName}</TableCell>\n+                <TableCell textAlign=\"right\">{numColumns === 0 ? 'All' : numColumns}</TableCell>\n+                <TableCell textAlign=\"right\">{tableMetrics.totalEvents}</TableCell>\n+                <TableCell textAlign=\"right\">{tableMetrics.eventsPerMin}</TableCell>\n+                <TableCell textAlign=\"right\">{tableMetrics.latency}</TableCell>\n+                <TableCell />\n+                <TableCell textAlign=\"right\">{tableMetrics.inserts}</TableCell>\n+                <TableCell textAlign=\"right\">{tableMetrics.updates}</TableCell>\n+                <TableCell textAlign=\"right\">{tableMetrics.deletes}</TableCell>\n+              </TableRow>\n+            );\n+          })}\n+        </TableBody>\n+      </Table>\n+\n+      {/* <div className=\"grid-wrapper\">", "originalCommit": "6c39938aa0782d85c4239d05318577e5c6424d60", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzA2NTUzOA==", "url": "https://github.com/cdapio/cdap/pull/12896#discussion_r543065538", "bodyText": "This is a nice start!", "author": "ajainarayanan", "createdAt": "2020-12-15T05:51:48Z", "path": "cdap-ui/app/cdap/components/Replicator/Detail/Overview/TablesList/index.tsx", "diffHunk": "@@ -0,0 +1,330 @@\n+/*\n+ * Copyright \u00a9 2020 Cask Data, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+import React, { useContext, useEffect, useState } from 'react';\n+import withStyles, { WithStyles, StyleRules } from '@material-ui/core/styles/withStyles';\n+import { DetailContext } from 'components/Replicator/Detail';\n+import { generateTableKey } from 'components/Replicator/utilities';\n+import { Map } from 'immutable';\n+import { MyReplicatorApi } from 'api/replicator';\n+import { getCurrentNamespace } from 'services/NamespaceStore';\n+import TextField from '@material-ui/core/TextField';\n+import InputAdornment from '@material-ui/core/InputAdornment';\n+import Search from '@material-ui/icons/Search';\n+import debounce from 'lodash/debounce';\n+import Table from 'components/Table';\n+import TableHeader from 'components/Table/TableHeader';\n+import TableRow from 'components/Table/TableRow';\n+import TableCell from 'components/Table/TableCell';\n+import TableBody from 'components/Table/TableBody';\n+import IconSVG from 'components/IconSVG';\n+import MetricsQueryHelper from 'services/MetricsQueryHelper';\n+import { PROGRAM_INFO } from 'components/Replicator/constants';\n+import { MyMetricApi } from 'api/metric';\n+import { parseOverviewMetrics } from 'components/Replicator/Detail/Overview/TablesList/metricsParser';\n+import { compare } from 'natural-orderby';\n+import TableColumnGroup from 'components/Table/TableColumnGroup';\n+import ColumnGroup from 'components/Table/ColumnGroup';\n+import TimePeriodDropdown from 'components/Replicator/Detail/TimePeriodDropdown';\n+\n+const styles = (theme): StyleRules => {\n+  return {\n+    grid: {\n+      height: '500px',\n+    },\n+\n+    subtitle: {\n+      marginTop: '10px',\n+      marginBottom: '10px',\n+      display: 'grid',\n+      gridTemplateColumns: '50% 50%',\n+      alignItems: 'center',\n+\n+      '& > div:last-child': {\n+        textAlign: 'right',\n+      },\n+    },\n+    search: {\n+      width: '250px',\n+\n+      '& input': {\n+        paddingTop: '10px',\n+        paddingBottom: '10px',\n+      },\n+    },\n+    SNAPSHOTTING: {\n+      color: theme.palette.blue[100],\n+    },\n+    REPLICATING: {\n+      color: theme.palette.blue[100],\n+    },\n+    FAILING: {\n+      color: theme.palette.red[100],\n+    },\n+    IDLE: {\n+      color: theme.palette.grey[200],\n+    },\n+  };\n+};\n+\n+const TablesListView: React.FC<WithStyles<typeof styles>> = ({ classes }) => {\n+  const { name, tables, columns, offsetBasePath, timeRange } = useContext(DetailContext);\n+\n+  const [statusMap, setStatusMap] = useState(Map<string, string>());\n+  const [filteredTables, setFilteredTables] = useState(sortTable(tables.toList()));\n+  const [search, setSearch] = useState('');\n+  const [tableMetricsMap, setTableMetricsMap] = useState({});\n+\n+  function handleSearch(e) {\n+    setSearch(e.target.value);\n+  }\n+\n+  function sortTable(unorderedTable) {\n+    return unorderedTable\n+      .sort((a, b) => {\n+        return compare()(a.get('table'), b.get('table'));\n+      })\n+      .toList();\n+  }\n+\n+  const filterTableBySearch = debounce(() => {\n+    if (!search || search.length === 0) {\n+      setFilteredTables(sortTable(tables.toList()));\n+      return;\n+    }\n+\n+    const filteredList = tables\n+      .filter((row) => {\n+        const normalizedTable = row.get('table').toLowerCase();\n+        const normalizedSearch = search.toLowerCase();\n+\n+        return normalizedTable.indexOf(normalizedSearch) !== -1;\n+      })\n+      .toList();\n+\n+    setFilteredTables(sortTable(filteredList));\n+  }, 300);\n+\n+  // handle search query change\n+  useEffect(filterTableBySearch, [search, tables]);\n+\n+  useEffect(() => {\n+    if (!offsetBasePath || offsetBasePath.length === 0) {\n+      return;\n+    }\n+\n+    const params = {\n+      namespace: getCurrentNamespace(),\n+    };\n+\n+    const body = {\n+      name,\n+      offsetBasePath,\n+    };\n+\n+    // TODO: optimize polling\n+    // Don't poll when status is not running\n+    const statusPoll$ = MyReplicatorApi.pollTableStatus(params, body).subscribe((res) => {\n+      const tableStatus = res.tables;\n+\n+      let status = Map<string, string>();\n+      tableStatus.forEach((tableInfo) => {\n+        const tableKey = generateTableKey(tableInfo);\n+        status = status.set(tableKey, tableInfo.state);\n+      });\n+\n+      setStatusMap(status);\n+    });\n+\n+    return () => {\n+      statusPoll$.unsubscribe();\n+    };\n+  }, [offsetBasePath]);\n+\n+  useEffect(() => {\n+    if (tables.size === 0) {\n+      return;\n+    }\n+\n+    const tags = {\n+      namespace: getCurrentNamespace(),\n+      app: name,\n+      worker: PROGRAM_INFO.programId,\n+      run: '*',\n+      instance: '*',\n+    };\n+\n+    const tagsParams = MetricsQueryHelper.tagsToParams(tags);\n+\n+    const metrics = ['inserts', 'updates', 'deletes', 'errors', 'latency.seconds']\n+      .map((metric) => {\n+        return `metric=user.dml.${metric}`;\n+      })\n+      .join('&');\n+\n+    const start = `start=now-${timeRange}`;\n+    const end = 'end=now';\n+    const aggregate = 'aggregate=false';\n+    const groupBy = 'groupBy=ent';\n+\n+    const params = [start, end, aggregate, groupBy, tagsParams, metrics].join('&');\n+\n+    MyMetricApi.queryTags({ params }).subscribe(\n+      (res) => {\n+        setTableMetricsMap(\n+          parseOverviewMetrics(\n+            res,\n+            tables\n+              .toList()\n+              .map((tableInfo) => tableInfo.get('table'))\n+              .toJS()\n+          )\n+        );\n+      },\n+      (err) => {\n+        // tslint:disable-next-line: no-console\n+        console.log('err', err);\n+      }\n+    );\n+  }, [timeRange, tables]);\n+  return (\n+    <div className={classes.root}>\n+      <div className={classes.subtitle}>\n+        <div>\n+          <strong>{tables.size}</strong> tables to be replicated\n+        </div>\n+        <div>\n+          <TextField\n+            className={classes.search}\n+            value={search}\n+            onChange={handleSearch}\n+            variant=\"outlined\"\n+            placeholder=\"Search by table name\"\n+            InputProps={{\n+              startAdornment: (\n+                <InputAdornment position=\"start\">\n+                  <Search />\n+                </InputAdornment>\n+              ),\n+            }}\n+          />\n+        </div>\n+      </div>\n+\n+      <Table", "originalCommit": "6c39938aa0782d85c4239d05318577e5c6424d60", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzYyMjMxNA==", "url": "https://github.com/cdapio/cdap/pull/12896#discussion_r543622314", "bodyText": "nit: This needs to be changed as well.", "author": "ajainarayanan", "createdAt": "2020-12-15T19:22:21Z", "path": "cdap-ui/app/cdap/components/Replicator/Detail/Overview/TablesList/metricsParser.ts", "diffHunk": "@@ -0,0 +1,95 @@\n+/*\n+ * Copyright \u00a9 2020 Cask Data, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+import { IRawMetricData } from 'components/Replicator/types';\n+import { truncateNumber } from 'services/helpers';\n+\n+interface IOverviewMetricsData {\n+  tableName: string;\n+  inserts: number;\n+  updates: number;\n+  deletes: number;\n+  errors: number;\n+  latency: number;\n+  eventsPerMin: number;\n+  totalEvents: number;\n+}\n+\n+const INITIAL_DATA = {\n+  inserts: 0,\n+  updates: 0,\n+  deletes: 0,\n+  errors: 0,\n+  latency: 0,\n+  eventsPerMin: 0,\n+  totalEvents: 0,\n+};\n+\n+const METRIC_MAP = {\n+  'user.dml.inserts': 'inserts',\n+  'user.dml.updates': 'updates',\n+  'user.dml.deletes': 'deletes',\n+  'user.dml.errors': 'errors',\n+  'user.dml.latency.seconds': 'latency',\n+};\n+\n+const ONE_MIN_SECONDS = 60;", "originalCommit": "eb069f97ac68cca9a163dd5f075e6155e558880f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "2041bbd61cb95fe1d84651f8f286424f1dfe7399", "url": "https://github.com/cdapio/cdap/commit/2041bbd61cb95fe1d84651f8f286424f1dfe7399", "message": "update navlink heading", "committedDate": "2020-12-15T20:01:11Z", "type": "forcePushed"}, {"oid": "e29fb11f39b91b88f33eda05959d65e4fc27848a", "url": "https://github.com/cdapio/cdap/commit/e29fb11f39b91b88f33eda05959d65e4fc27848a", "message": "[CDAP-17446] Replication Detail Page Redesign", "committedDate": "2020-12-15T20:03:47Z", "type": "commit"}, {"oid": "e29fb11f39b91b88f33eda05959d65e4fc27848a", "url": "https://github.com/cdapio/cdap/commit/e29fb11f39b91b88f33eda05959d65e4fc27848a", "message": "[CDAP-17446] Replication Detail Page Redesign", "committedDate": "2020-12-15T20:03:47Z", "type": "forcePushed"}]}