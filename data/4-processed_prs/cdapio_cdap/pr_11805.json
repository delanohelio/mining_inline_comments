{"pr_number": 11805, "pr_title": "[CDAP-14284] Adds base implementation to handle different types of nodes in React", "pr_createdAt": "2020-01-02T09:42:22Z", "pr_url": "https://github.com/cdapio/cdap/pull/11805", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzkzMjc0Mg==", "url": "https://github.com/cdapio/cdap/pull/11805#discussion_r363932742", "bodyText": "i'm not sure i understand this condition, why are we checking the target?", "author": "elfenheart", "createdAt": "2020-01-07T20:18:59Z", "path": "cdap-ui/app/cdap/components/DAG/Nodes/AlertPublisherNode/index.tsx", "diffHunk": "@@ -0,0 +1,44 @@\n+/*\n+ * Copyright \u00a9 2020 Cask Data, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+*/\n+\n+import withStyles from '@material-ui/core/styles/withStyles';\n+import { IAbstractNodeProps, AbstractNode } from 'components/DAG/Nodes/AbstractNode';\n+import { genericNodeStyles } from 'components/DAG/Nodes/utilities';\n+\n+const styles = genericNodeStyles({\n+  border: `1px solid #ffba01`,\n+  '&.drag-hover': {\n+    backgroundColor: 'rgba(255, 186, 1, 0.1)',\n+  },\n+});\n+interface IAlertPublisherProps extends IAbstractNodeProps<typeof styles> {}\n+class AlertPublisherComponent extends AbstractNode<IAlertPublisherProps> {\n+  public type = 'alertpublisher';\n+\n+  public checkForValidIncomingConnection = (connObj) => {\n+    if (connObj.connection.target.getAttribute('data-node-type') !== 'alertpublisher') {", "originalCommit": "573f3c0efe46b75473903f7b0d6750b28d893668", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzk2NjI1MQ==", "url": "https://github.com/cdapio/cdap/pull/11805#discussion_r363966251", "bodyText": "Every node will have checkForValidIncomingConnection condition to determine if the current connection is valid or not.\nWe register this callback from each node in the DAGRenderer init node function .\nWhen a connection event is fired when user connects two nodes we call all the callbacks from the nodes.\nIt is basically a reduce on all the callbacks and the eventual reduce value should be true for the connection to be drawn. It it returns false then one of the nodes involved in the connection rejects this connection so we don't render the connection.\n\nThe advantage of this is having such custom logic specific to node within the node.\nHope I made sense.\nNow that I think about it I think I can add this function as a static function and have it registered as not per instance of the node. Will add that change.\nEDIT:\nThe connection validation event handlers are still part of the instance but we register them based on node types and not node instances. This prevents adding a handler for each instance of the node and rather adds one handler per node type.", "author": "ajainarayanan", "createdAt": "2020-01-07T21:45:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzkzMjc0Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzk0MzUwMQ==", "url": "https://github.com/cdapio/cdap/pull/11805#discussion_r363943501", "bodyText": "should there be an abstract component for these endpoints as well?", "author": "elfenheart", "createdAt": "2020-01-07T20:47:28Z", "path": "cdap-ui/app/cdap/components/DAG/Nodes/TransformNode/index.tsx", "diffHunk": "@@ -0,0 +1,130 @@\n+/*\n+ * Copyright \u00a9 2020 Cask Data, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+*/\n+\n+import * as React from 'react';\n+import withStyles from '@material-ui/core/styles/withStyles';\n+import { IAbstractNodeProps, AbstractNode } from 'components/DAG/Nodes/AbstractNode';\n+import { genericNodeStyles } from 'components/DAG/Nodes/utilities';\n+import If from 'components/If';\n+import ButtonBase from '@material-ui/core/ButtonBase';\n+const styles = genericNodeStyles({\n+  border: `1px solid #4586f3`,\n+  '&.drag-hover': {\n+    backgroundColor: 'rgba(69, 134, 243, 0.1)',\n+  },\n+});\n+interface ITransformNodeProps extends IAbstractNodeProps<typeof styles> {}\n+class TransformNodeComponent extends AbstractNode<ITransformNodeProps> {\n+  public type = 'transform';\n+  public alertEndpointRef: HTMLElement | null;\n+  public errorEndpointRef: HTMLElement | null;\n+  public getEndpointParams = () => {\n+    const endPointConfigs = this.getEndpointConfig();\n+    const alertEndpointConfigs = this.getAlertEndpointConfig();\n+    const errorEndpointConfigs = this.getErrorEndpointConfig();\n+    return [\n+      {\n+        element: this.regularEndpointRef,\n+        params: endPointConfigs,\n+        referenceParams: {},\n+      },\n+      {\n+        element: this.alertEndpointRef,\n+        params: alertEndpointConfigs,\n+        referenceParams: {},\n+      },\n+      {\n+        element: this.errorEndpointRef,\n+        params: errorEndpointConfigs,\n+        referenceParams: {},\n+      },\n+    ];\n+  };\n+  public checkForValidIncomingConnection = (connObj) => {\n+    if (connObj.connection.target.getAttribute('data-node-type') !== 'transform') {\n+      return true;\n+    }\n+    return (\n+      ['alertpublisher', 'sink'].indexOf(\n+        connObj.connection.source.getAttribute('data-node-type')\n+      ) === -1\n+    );\n+  };\n+\n+  public render() {\n+    const {\n+      classes,\n+      config: { showAlert = false, showError = false },\n+    } = this.props;\n+    const RegularEndpoint = () => (", "originalCommit": "573f3c0efe46b75473903f7b0d6750b28d893668", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzk2ODcwMg==", "url": "https://github.com/cdapio/cdap/pull/11805#discussion_r363968702", "bodyText": "I didn't perceive it that way. Right now all nodes have a generic endpoint and if the node needs to change in their specific implementation then they can override this function (This is becoming a class function in AbstractNode in my next PR which will be overridden by child nodes if need be).", "author": "ajainarayanan", "createdAt": "2020-01-07T21:51:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzk0MzUwMQ=="}], "type": "inlineReview"}, {"oid": "921e4d03c6129d6dff74109a632158cbfac47620", "url": "https://github.com/cdapio/cdap/commit/921e4d03c6129d6dff74109a632158cbfac47620", "message": "[CDAP-14284] Adds base implementation to handle different types of nodes in React\n\n  - Modifies Default Node to resemble SourceNode\n  - Avoids DAGRenderer to repaint everything on each node manipulation\n  - Modifies raw styles to css-in-js to start with\n  - Extracts generic node functionalities to utilitites module\n  - Adds Source, Transform, Sink Error, Sink & Alertpublisher nodes\n  - Modifies AbstractNode to handle nodes with alert and error endpoints\n  - Modifies Source & Transform nodes based on modifications to AbstractNode\n  - Modifies DAGRenderer to delegate incoming connection validation function to individual nodes\n  - Adds boolean options to show/hide alert and error endpoints in transform nodes", "committedDate": "2020-01-23T20:55:11Z", "type": "commit"}, {"oid": "921e4d03c6129d6dff74109a632158cbfac47620", "url": "https://github.com/cdapio/cdap/commit/921e4d03c6129d6dff74109a632158cbfac47620", "message": "[CDAP-14284] Adds base implementation to handle different types of nodes in React\n\n  - Modifies Default Node to resemble SourceNode\n  - Avoids DAGRenderer to repaint everything on each node manipulation\n  - Modifies raw styles to css-in-js to start with\n  - Extracts generic node functionalities to utilitites module\n  - Adds Source, Transform, Sink Error, Sink & Alertpublisher nodes\n  - Modifies AbstractNode to handle nodes with alert and error endpoints\n  - Modifies Source & Transform nodes based on modifications to AbstractNode\n  - Modifies DAGRenderer to delegate incoming connection validation function to individual nodes\n  - Adds boolean options to show/hide alert and error endpoints in transform nodes", "committedDate": "2020-01-23T20:55:11Z", "type": "forcePushed"}]}