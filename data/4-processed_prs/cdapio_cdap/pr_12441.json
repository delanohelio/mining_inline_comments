{"pr_number": 12441, "pr_title": "[CDAP-17062] Group and sort request logs by timestamp (RequestHistoryTab)", "pr_createdAt": "2020-07-08T15:57:47Z", "pr_url": "https://github.com/cdapio/cdap/pull/12441", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjEzMjUwMQ==", "url": "https://github.com/cdapio/cdap/pull/12441#discussion_r456132501", "bodyText": "we have moment.js to help with this", "author": "elfenheart", "createdAt": "2020-07-16T23:25:37Z", "path": "cdap-ui/app/cdap/components/HttpExecutor/RequestHistoryTab/index.tsx", "diffHunk": "@@ -141,17 +161,44 @@ const RequestHistoryTabView: React.FC<IRequestHistoryTabProps> = ({\n   onRequestClick,\n   resetIncomingRequest,\n }) => {\n-  const [requestLog, setRequestLog] = React.useState(List<IRequestHistory>([]));\n+  const [requestLog, setRequestLog] = React.useState(\n+    Map<string, List<IRequestHistory>>({}) // maps timestamp date (e.g. April 5th) to a list of corresponding request histories\n+  );\n+\n+  const convertDateToString = (date: Date) => {\n+    const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };\n+    return date.toLocaleDateString('en-US', options);", "originalCommit": "d3d76a947407786525f98fff385b894d3fd21625", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzY0NTAzMA==", "url": "https://github.com/cdapio/cdap/pull/12441#discussion_r457645030", "bodyText": "done", "author": "jennac3", "createdAt": "2020-07-20T19:35:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjEzMjUwMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzcwNDc2NQ==", "url": "https://github.com/cdapio/cdap/pull/12441#discussion_r457704765", "bodyText": "use color already defined in the theme palettes", "author": "elfenheart", "createdAt": "2020-07-20T21:34:13Z", "path": "cdap-ui/app/cdap/components/HttpExecutor/RequestHistoryTab/index.tsx", "diffHunk": "@@ -102,9 +112,20 @@ const styles = (theme): StyleRules => {\n   };\n };\n \n+const StyledExpansionPanel = withStyles(() => ({\n+  root: {\n+    '&$expanded': {\n+      margin: 0,\n+    },\n+    borderBottom: '1px solid #C0C0C0',", "originalCommit": "a4fe9f441caced22b9e19437a6207fe30912964f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzcxNDQ2NQ==", "url": "https://github.com/cdapio/cdap/pull/12441#discussion_r457714465", "bodyText": "Done", "author": "jennac3", "createdAt": "2020-07-20T21:56:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzcwNDc2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzcwNjkyOA==", "url": "https://github.com/cdapio/cdap/pull/12441#discussion_r457706928", "bodyText": "isn't valueSeq() already returns a List? do you still need the Array.from?", "author": "elfenheart", "createdAt": "2020-07-20T21:39:21Z", "path": "cdap-ui/app/cdap/components/HttpExecutor/store/HttpExecutorStore.js", "diffHunk": "@@ -62,10 +63,21 @@ const setResponse = (state, action) => {\n     timestamp: new Date().toLocaleString(),\n   };\n \n-  const newRequestLog = requestLog.push(newCall);\n+  // Update the component view in real-time, since we cannot listen to local storage's change\n+  // Since the new request call is the latest out of all the request histories, insert at 0th index\n+  const timestamp = new Date(newCall.timestamp);\n+  const dateID = getDateID(timestamp);\n+  const requestsGroup = getRequestsByDate(requestLog, dateID);\n+  const newRequestLog = requestLog.set(dateID, requestsGroup.insert(0, newCall));\n \n-  // saving of the request to the localStorage\n-  localStorage.setItem(REQUEST_HISTORY, JSON.stringify(newRequestLog));\n+  // Saving request histories to the localStorage\n+  let storedLogs = List([]);\n+  Array.from(newRequestLog.valueSeq()).forEach((requests) => {", "originalCommit": "a4fe9f441caced22b9e19437a6207fe30912964f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzcwOTk5OQ==", "url": "https://github.com/cdapio/cdap/pull/12441#discussion_r457709999", "bodyText": "valueSeq returns iterator", "author": "jennac3", "createdAt": "2020-07-20T21:46:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzcwNjkyOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzcwOTI1MQ==", "url": "https://github.com/cdapio/cdap/pull/12441#discussion_r457709251", "bodyText": "i think this is supposed to be MMMM D. d is day of the week, not month", "author": "elfenheart", "createdAt": "2020-07-20T21:44:45Z", "path": "cdap-ui/app/cdap/components/HttpExecutor/utilities.ts", "diffHunk": "@@ -0,0 +1,28 @@\n+/*\n+ * Copyright \u00a9 2020 Cask Data, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n+ * use this file except in compliance with the License. You may obtain a copy of\n+ * the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+import { List, Map } from 'immutable';\n+\n+import { IRequestHistory } from 'components/HttpExecutor/RequestHistoryTab';\n+import moment from 'moment';\n+\n+export function getDateID(date: Date) {\n+  return moment(date).format('dddd, MMMM d, YYYY');", "originalCommit": "a4fe9f441caced22b9e19437a6207fe30912964f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzcxMzA3Nw==", "url": "https://github.com/cdapio/cdap/pull/12441#discussion_r457713077", "bodyText": "Done", "author": "jennac3", "createdAt": "2020-07-20T21:53:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzcwOTI1MQ=="}], "type": "inlineReview"}, {"oid": "a8daa8c7bae6d2c9748af00d1e06198080dc7003", "url": "https://github.com/cdapio/cdap/commit/a8daa8c7bae6d2c9748af00d1e06198080dc7003", "message": "[CDAP-17062] Group and sort request logs by timestamp (RequestHistoryTab)", "committedDate": "2020-07-20T23:31:54Z", "type": "forcePushed"}, {"oid": "c847f7d6c5bc978d51697f47a25204edbc4c8095", "url": "https://github.com/cdapio/cdap/commit/c847f7d6c5bc978d51697f47a25204edbc4c8095", "message": "[CDAP-17062] Group and sort request logs by timestamp (RequestHistoryTab)", "committedDate": "2020-07-20T23:40:59Z", "type": "commit"}, {"oid": "c847f7d6c5bc978d51697f47a25204edbc4c8095", "url": "https://github.com/cdapio/cdap/commit/c847f7d6c5bc978d51697f47a25204edbc4c8095", "message": "[CDAP-17062] Group and sort request logs by timestamp (RequestHistoryTab)", "committedDate": "2020-07-20T23:40:59Z", "type": "forcePushed"}]}