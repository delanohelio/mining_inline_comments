{"pr_number": 12410, "pr_title": "[CDAP-16690] Implement virtual scroll into preview data and record view", "pr_createdAt": "2020-06-25T16:58:53Z", "pr_url": "https://github.com/cdapio/cdap/pull/12410", "timeline": [{"oid": "87ee44d1faa371ffc5e5e0364def2296fe8d8ac7", "url": "https://github.com/cdapio/cdap/commit/87ee44d1faa371ffc5e5e0364def2296fe8d8ac7", "message": "Check for out of range records", "committedDate": "2020-06-25T23:51:36Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjIwMzYxMA==", "url": "https://github.com/cdapio/cdap/pull/12410#discussion_r446203610", "bodyText": "The comments here are really helpful!", "author": "jennac3", "createdAt": "2020-06-26T14:02:27Z", "path": "cdap-ui/app/cdap/components/PreviewData/RecordView/RecordTable.tsx", "diffHunk": "@@ -15,53 +15,140 @@\n  */\n \n import React from 'react';\n-import Table from '@material-ui/core/Table';\n-import TableBody from '@material-ui/core/TableBody';\n-import TableRow from '@material-ui/core/TableRow';\n+import VirtualScroll from 'components/VirtualScroll';\n+import { PREVIEW_STATUS } from 'services/PreviewStatus';\n import Paper from '@material-ui/core/Paper';\n-import TableHead from '@material-ui/core/TableHead';\n+import Grid from '@material-ui/core/Grid';\n import withStyles, { WithStyles } from '@material-ui/core/styles/withStyles';\n import ThemeWrapper from 'components/ThemeWrapper';\n-import { CustomTableCell, styles } from 'components/PreviewData/DataView/Table';\n+import { styles } from 'components/PreviewData/DataView/Table';\n+import classnames from 'classnames';\n+import T from 'i18n-react';\n+import Heading, { HeadingTypes } from 'components/Heading';\n \n const I18N_PREFIX = 'features.PreviewData.RecordView.RecordTable';\n \n interface IRecordTableProps extends WithStyles<typeof styles> {\n-  headers: string[];\n-  record: any;\n+  headers?: string[];\n+  record?: any;\n+  selectedRecord?: number;\n+  isInput?: boolean;\n+  previewStatus?: string;\n+  isCondition?: boolean;\n }\n \n-const RecordTableView: React.FC<IRecordTableProps> = ({ classes, headers, record }) => {\n+const RecordTableView: React.FC<IRecordTableProps> = ({\n+  classes,\n+  headers,\n+  record,\n+  selectedRecord,\n+  isInput,\n+  previewStatus,\n+  isCondition,\n+}) => {\n   // Used to stringify any non-string field values and field names.\n   // TO DO: Might not need to do this for field names, need to test with nested schemas.\n   // TO DO: Move to utilities, since we also use this in data view\n+\n   const format = (field: any) => {\n     if (typeof field === 'object') {\n       return JSON.stringify(field);\n     }\n     return field;\n   };\n \n+  const noRecordMsg = () => {\n+    let msg;\n+    const recordType = isInput ? 'Input' : 'Output';\n+    if (isCondition) {\n+      msg = T.translate(`${I18N_PREFIX}.previewNotSupported`);\n+    } else if (previewStatus === PREVIEW_STATUS.RUNNING || previewStatus === PREVIEW_STATUS.INIT) {\n+      // preview is still running but there's no data yet\n+      msg = T.translate(`${I18N_PREFIX}.previewRunning`, { recordType });\n+    } else if (headers.length > 0) {\n+      // not running preview and there is preview data, but not for this record number", "originalCommit": "87ee44d1faa371ffc5e5e0364def2296fe8d8ac7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjIwNDUxMQ==", "url": "https://github.com/cdapio/cdap/pull/12410#discussion_r446204511", "bodyText": "Maybe we can let these numbers 25 and 40 be defined with a constant in case we may need to reuse them", "author": "jennac3", "createdAt": "2020-06-26T14:04:02Z", "path": "cdap-ui/app/cdap/components/PreviewData/RecordView/RecordTable.tsx", "diffHunk": "@@ -15,53 +15,140 @@\n  */\n \n import React from 'react';\n-import Table from '@material-ui/core/Table';\n-import TableBody from '@material-ui/core/TableBody';\n-import TableRow from '@material-ui/core/TableRow';\n+import VirtualScroll from 'components/VirtualScroll';\n+import { PREVIEW_STATUS } from 'services/PreviewStatus';\n import Paper from '@material-ui/core/Paper';\n-import TableHead from '@material-ui/core/TableHead';\n+import Grid from '@material-ui/core/Grid';\n import withStyles, { WithStyles } from '@material-ui/core/styles/withStyles';\n import ThemeWrapper from 'components/ThemeWrapper';\n-import { CustomTableCell, styles } from 'components/PreviewData/DataView/Table';\n+import { styles } from 'components/PreviewData/DataView/Table';\n+import classnames from 'classnames';\n+import T from 'i18n-react';\n+import Heading, { HeadingTypes } from 'components/Heading';\n \n const I18N_PREFIX = 'features.PreviewData.RecordView.RecordTable';\n \n interface IRecordTableProps extends WithStyles<typeof styles> {\n-  headers: string[];\n-  record: any;\n+  headers?: string[];\n+  record?: any;\n+  selectedRecord?: number;\n+  isInput?: boolean;\n+  previewStatus?: string;\n+  isCondition?: boolean;\n }\n \n-const RecordTableView: React.FC<IRecordTableProps> = ({ classes, headers, record }) => {\n+const RecordTableView: React.FC<IRecordTableProps> = ({\n+  classes,\n+  headers,\n+  record,\n+  selectedRecord,\n+  isInput,\n+  previewStatus,\n+  isCondition,\n+}) => {\n   // Used to stringify any non-string field values and field names.\n   // TO DO: Might not need to do this for field names, need to test with nested schemas.\n   // TO DO: Move to utilities, since we also use this in data view\n+\n   const format = (field: any) => {\n     if (typeof field === 'object') {\n       return JSON.stringify(field);\n     }\n     return field;\n   };\n \n+  const noRecordMsg = () => {\n+    let msg;\n+    const recordType = isInput ? 'Input' : 'Output';\n+    if (isCondition) {\n+      msg = T.translate(`${I18N_PREFIX}.previewNotSupported`);\n+    } else if (previewStatus === PREVIEW_STATUS.RUNNING || previewStatus === PREVIEW_STATUS.INIT) {\n+      // preview is still running but there's no data yet\n+      msg = T.translate(`${I18N_PREFIX}.previewRunning`, { recordType });\n+    } else if (headers.length > 0) {\n+      // not running preview and there is preview data, but not for this record number\n+      msg = T.translate(`${I18N_PREFIX}.noSelectedRecord`, { selectedRecord });\n+    } else {\n+      // not running preview AND there is no preview data for this stage\n+      msg = T.translate(`${I18N_PREFIX}.noPreviewRunning`, { recordType });\n+    }\n+    return (\n+      <div>\n+        <Heading type={HeadingTypes.h3} label={msg} className={classes.messageText} />\n+      </div>\n+    );\n+  };\n+\n+  const renderList = (visibleNodeCount: number, startNode: number) => {\n+    if (!record) {\n+      return;\n+    }\n+    return headers.slice(startNode, startNode + visibleNodeCount).map((fieldName, i) => {\n+      const processedFieldName = format(fieldName);\n+      const processedValue = format(record[fieldName]);\n+      return (\n+        <React.Fragment>\n+          <Grid\n+            container\n+            direction=\"row\"\n+            wrap=\"nowrap\"\n+            className={classnames(classes.row, { oddRow: (i + startNode + 1) % 2 })}\n+            key={`gridrow-${i}`}\n+          >\n+            <Grid\n+              item\n+              className={classnames(classes.cell, classes.recordCell)}\n+              title={processedFieldName}\n+            >\n+              {processedFieldName}\n+            </Grid>\n+            <Grid\n+              item\n+              className={classnames(classes.cell, classes.recordCell)}\n+              title={processedValue}\n+            >\n+              {processedValue}\n+            </Grid>\n+          </Grid>\n+        </React.Fragment>\n+      );\n+    });\n+  };\n+\n+  // When the selected record number is out of range\n+  if (!record) {\n+    return noRecordMsg();\n+  }\n+\n   return (\n-    <Paper className={classes.root}>\n-      <Table>\n-        <TableHead>\n-          <TableRow className={classes.row}>\n-            <CustomTableCell>Field</CustomTableCell>\n-            <CustomTableCell>Value</CustomTableCell>\n-          </TableRow>\n-        </TableHead>\n-        <TableBody>\n-          {headers.map((fieldName, i) => {\n-            return (\n-              <TableRow className={classes.row} key={`tr-${i}}`}>\n-                <CustomTableCell>{format(fieldName)}</CustomTableCell>\n-                <CustomTableCell>{format(record[fieldName])}</CustomTableCell>\n-              </TableRow>\n-            );\n-          })}\n-        </TableBody>\n-      </Table>\n+    <Paper className={classnames(classes.root, classes.recordContainer)}>\n+      <Grid container direction=\"column\" wrap=\"nowrap\">\n+        <Grid item>\n+          <Grid\n+            container\n+            direction=\"row\"\n+            justify=\"center\"\n+            alignItems=\"center\"\n+            className={classes.headerRow}\n+          >\n+            <Grid item className={classnames(classes.headerCell, classes.cell, classes.recordCell)}>\n+              {T.translate(`${I18N_PREFIX}.fieldName`)}\n+            </Grid>\n+            <Grid item className={classnames(classes.headerCell, classes.cell, classes.recordCell)}>\n+              {T.translate(`${I18N_PREFIX}.value`)}\n+            </Grid>\n+          </Grid>\n+        </Grid>\n+        <Grid item>\n+          <VirtualScroll\n+            itemCount={() => headers.length}\n+            visibleChildCount={25}", "originalCommit": "87ee44d1faa371ffc5e5e0364def2296fe8d8ac7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDQ3MjI3NA==", "url": "https://github.com/cdapio/cdap/pull/12410#discussion_r450472274", "bodyText": "Extracted as constants!", "author": "yukiej", "createdAt": "2020-07-06T20:49:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjIwNDUxMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjIwNTI2MA==", "url": "https://github.com/cdapio/cdap/pull/12410#discussion_r446205260", "bodyText": "Maybe we can let this number 100 be defined with a constant in case we may need to reuse them", "author": "jennac3", "createdAt": "2020-06-26T14:05:18Z", "path": "cdap-ui/app/cdap/components/PreviewData/index.tsx", "diffHunk": "@@ -66,10 +72,22 @@ const PreviewDataViewBase: React.FC<IPreviewDataViewProps> = ({\n \n   const [previewLoading, setPreviewLoading] = useState(false);\n   const [previewData, setPreviewData] = useState<IPreviewData>({});\n+  const [tableData, setTableData] = useState<ITableData>({});\n   const [error, setError] = useState(null);\n+  const [viewMode, setViewMode] = useState('Table');\n+\n+  const widgetProps = {\n+    on: { value: 'Record', label: 'Record' },\n+    off: { value: 'Table', label: 'Table' },\n+  };\n \n   const updatePreviewCb = (updatedPreview: IPreviewData) => {\n     setPreviewData(updatedPreview);\n+    const parsedData = getTableData(updatedPreview);\n+    setTableData(parsedData);\n+    setViewMode(\n+      parsedData.inputFieldCount > 100 || parsedData.outputFieldCount > 100 ? 'Record' : 'Table'", "originalCommit": "87ee44d1faa371ffc5e5e0364def2296fe8d8ac7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDQ3Nzg0Mw==", "url": "https://github.com/cdapio/cdap/pull/12410#discussion_r450477843", "bodyText": "Done!", "author": "yukiej", "createdAt": "2020-07-06T21:01:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjIwNTI2MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjIwNTU5Nw==", "url": "https://github.com/cdapio/cdap/pull/12410#discussion_r446205597", "bodyText": "Maybe we can define Record and Table with enum, since we use them more than once in this PreviewData/index.tsx.", "author": "jennac3", "createdAt": "2020-06-26T14:05:53Z", "path": "cdap-ui/app/cdap/components/PreviewData/index.tsx", "diffHunk": "@@ -66,10 +72,22 @@ const PreviewDataViewBase: React.FC<IPreviewDataViewProps> = ({\n \n   const [previewLoading, setPreviewLoading] = useState(false);\n   const [previewData, setPreviewData] = useState<IPreviewData>({});\n+  const [tableData, setTableData] = useState<ITableData>({});\n   const [error, setError] = useState(null);\n+  const [viewMode, setViewMode] = useState('Table');\n+\n+  const widgetProps = {\n+    on: { value: 'Record', label: 'Record' },", "originalCommit": "87ee44d1faa371ffc5e5e0364def2296fe8d8ac7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDQ3NjYzNw==", "url": "https://github.com/cdapio/cdap/pull/12410#discussion_r450476637", "bodyText": "Good idea! Done.", "author": "yukiej", "createdAt": "2020-07-06T20:58:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjIwNTU5Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjIwNjYyNA==", "url": "https://github.com/cdapio/cdap/pull/12410#discussion_r446206624", "bodyText": "Maybe we can extract these logic in If condition into a function and add a comment!", "author": "jennac3", "createdAt": "2020-06-26T14:07:43Z", "path": "cdap-ui/app/cdap/components/PreviewData/index.tsx", "diffHunk": "@@ -147,22 +163,28 @@ const PreviewDataViewBase: React.FC<IPreviewDataViewProps> = ({\n     </div>\n   );\n \n-  const showRecordView = tableData.inputFieldCount >= 100 || tableData.outputFieldCount >= 100;\n-\n   return (\n     <div>\n       <If condition={!previewId}>{noPreviewDataMsg(classes)}</If>\n       <If condition={previewLoading}>{loadingMsg(classes)}</If>\n       <If condition={error}>{errorMsg(classes)}</If>\n \n-      <If condition={!previewLoading && previewId && !isEmpty(previewData) && !showRecordView}>\n+      <If condition={!previewLoading && previewId && !isEmpty(previewData) && viewMode === 'Table'}>", "originalCommit": "87ee44d1faa371ffc5e5e0364def2296fe8d8ac7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzg4NzY5MQ==", "url": "https://github.com/cdapio/cdap/pull/12410#discussion_r453887691", "bodyText": "Is this being used anywhere?", "author": "ajainarayanan", "createdAt": "2020-07-13T19:40:49Z", "path": "cdap-ui/app/cdap/components/PreviewData/DataView/Table.tsx", "diffHunk": "@@ -15,61 +15,78 @@\n  */\n \n import React from 'react';\n-import Table from '@material-ui/core/Table';\n-import TableBody from '@material-ui/core/TableBody';\n-import TableHead from '@material-ui/core/TableHead';\n-import TableRow from '@material-ui/core/TableRow';\n import Paper from '@material-ui/core/Paper';\n-import TableCell from '@material-ui/core/TableCell';\n-import withStyles, { WithStyles } from '@material-ui/core/styles/withStyles';\n+import Grid from '@material-ui/core/Grid';\n+import withStyles, { WithStyles, StyleRules } from '@material-ui/core/styles/withStyles';\n import isEmpty from 'lodash/isEmpty';\n import { PREVIEW_STATUS } from 'services/PreviewStatus';\n import Heading, { HeadingTypes } from 'components/Heading';\n import ThemeWrapper from 'components/ThemeWrapper';\n+import VirtualScroll from 'components/VirtualScroll';\n import T from 'i18n-react';\n+import classnames from 'classnames';\n \n const I18N_PREFIX = 'features.PreviewData.DataView.Table';\n \n-export const CustomTableCell = withStyles((theme) => ({\n-  head: {\n-    backgroundColor: theme.palette.grey['300'],\n-    color: theme.palette.common.white,\n-    padding: 10,\n-    fontSize: 14,\n-    '&:first-of-type': {\n-      borderRight: `1px solid ${theme.palette.grey['500']}`,\n-    },\n-  },\n-  body: {\n-    padding: 10,\n-    fontSize: 14,\n-    '&:first-of-type': {\n-      borderRight: `1px solid ${theme.palette.grey['500']}`,\n-    },\n-  },\n-}))(TableCell);\n-\n export const messageTextStyle = {\n   fontSize: '1.3rem !important',\n   margin: '10px 0',\n };\n-export const styles = (theme) => ({\n+export const styles = (theme): StyleRules => ({\n   root: {\n-    width: '100%',\n     display: 'inline-block',\n     height: 'auto',\n     marginTop: theme.spacing(1),\n   },\n+  tableContainer: {\n+    width: 'fit-content',\n+    minWidth: '100%',\n+  },\n+  recordContainer: {\n+    width: '100%',\n+  },\n   table: {\n     width: '100%',\n   },\n   row: {\n     height: 40,\n-    '&:nth-of-type(odd)': {\n+    '&.oddRow': {\n       backgroundColor: theme.palette.grey['600'],\n     },\n   },\n   messageText: messageTextStyle,\n+  headerRow: {\n+    backgroundColor: theme.palette.grey['300'],\n+    fontWeight: 500,\n+  },\n+  headerCell: {\n+    color: theme.palette.common.white,\n+    fontSize: 14,\n+  },\n+  cell: {\n+    textAlign: 'center',\n+    height: '40px',\n+    lineHeight: '40px',\n+    overflow: 'hidden',\n+    textOverflow: 'ellipsis',\n+  },\n+  recordCell: {", "originalCommit": "c8cf11fdd9ac3befbe2c742fc733e3bf73847643", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzk1Mjc5Mg==", "url": "https://github.com/cdapio/cdap/pull/12410#discussion_r453952792", "bodyText": "This is being used in the RecordTable component. Maybe it would make sense to separate those styles out so they are in the RecordTable component file? The Record and Data table share most styles, but not all.", "author": "yukiej", "createdAt": "2020-07-13T21:46:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzg4NzY5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDMxNjk4Nw==", "url": "https://github.com/cdapio/cdap/pull/12410#discussion_r454316987", "bodyText": "Yeah I think so. Since we are migrating towards css-in-js it makes sense to co-locate the styles with the components. Easier to maintain. We can share a subset of styles for sure but those used only in the RecordTable should be in that specific component.", "author": "ajainarayanan", "createdAt": "2020-07-14T12:24:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzg4NzY5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQ5NTU4OA==", "url": "https://github.com/cdapio/cdap/pull/12410#discussion_r454495588", "bodyText": "Moved these styles to RecordTable", "author": "yukiej", "createdAt": "2020-07-14T16:45:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzg4NzY5MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzg4ODQyMA==", "url": "https://github.com/cdapio/cdap/pull/12410#discussion_r453888420", "bodyText": "Can we add a todo here. The minimum width of the cell is 120px and when we have the ability to resize the columns it could be varied.", "author": "ajainarayanan", "createdAt": "2020-07-13T19:42:11Z", "path": "cdap-ui/app/cdap/components/PreviewData/DataView/Table.tsx", "diffHunk": "@@ -15,61 +15,78 @@\n  */\n \n import React from 'react';\n-import Table from '@material-ui/core/Table';\n-import TableBody from '@material-ui/core/TableBody';\n-import TableHead from '@material-ui/core/TableHead';\n-import TableRow from '@material-ui/core/TableRow';\n import Paper from '@material-ui/core/Paper';\n-import TableCell from '@material-ui/core/TableCell';\n-import withStyles, { WithStyles } from '@material-ui/core/styles/withStyles';\n+import Grid from '@material-ui/core/Grid';\n+import withStyles, { WithStyles, StyleRules } from '@material-ui/core/styles/withStyles';\n import isEmpty from 'lodash/isEmpty';\n import { PREVIEW_STATUS } from 'services/PreviewStatus';\n import Heading, { HeadingTypes } from 'components/Heading';\n import ThemeWrapper from 'components/ThemeWrapper';\n+import VirtualScroll from 'components/VirtualScroll';\n import T from 'i18n-react';\n+import classnames from 'classnames';\n \n const I18N_PREFIX = 'features.PreviewData.DataView.Table';\n \n-export const CustomTableCell = withStyles((theme) => ({\n-  head: {\n-    backgroundColor: theme.palette.grey['300'],\n-    color: theme.palette.common.white,\n-    padding: 10,\n-    fontSize: 14,\n-    '&:first-of-type': {\n-      borderRight: `1px solid ${theme.palette.grey['500']}`,\n-    },\n-  },\n-  body: {\n-    padding: 10,\n-    fontSize: 14,\n-    '&:first-of-type': {\n-      borderRight: `1px solid ${theme.palette.grey['500']}`,\n-    },\n-  },\n-}))(TableCell);\n-\n export const messageTextStyle = {\n   fontSize: '1.3rem !important',\n   margin: '10px 0',\n };\n-export const styles = (theme) => ({\n+export const styles = (theme): StyleRules => ({\n   root: {\n-    width: '100%',\n     display: 'inline-block',\n     height: 'auto',\n     marginTop: theme.spacing(1),\n   },\n+  tableContainer: {\n+    width: 'fit-content',\n+    minWidth: '100%',\n+  },\n+  recordContainer: {\n+    width: '100%',\n+  },\n   table: {\n     width: '100%',\n   },\n   row: {\n     height: 40,\n-    '&:nth-of-type(odd)': {\n+    '&.oddRow': {\n       backgroundColor: theme.palette.grey['600'],\n     },\n   },\n   messageText: messageTextStyle,\n+  headerRow: {\n+    backgroundColor: theme.palette.grey['300'],\n+    fontWeight: 500,\n+  },\n+  headerCell: {\n+    color: theme.palette.common.white,\n+    fontSize: 14,\n+  },\n+  cell: {\n+    textAlign: 'center',\n+    height: '40px',\n+    lineHeight: '40px',\n+    overflow: 'hidden',\n+    textOverflow: 'ellipsis',\n+  },\n+  recordCell: {\n+    width: '50%',\n+    padding: '0px 5px',\n+    '&:first-of-type': {\n+      borderRight: `1px solid ${theme.palette.grey['500']}`,\n+      fontWeight: 500,\n+    },\n+  },\n+  tableCell: {\n+    width: '120px',", "originalCommit": "c8cf11fdd9ac3befbe2c742fc733e3bf73847643", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzk1NDg1NQ==", "url": "https://github.com/cdapio/cdap/pull/12410#discussion_r453954855", "bodyText": "Good call, to do added.", "author": "yukiej", "createdAt": "2020-07-13T21:49:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzg4ODQyMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzg4ODg3Mg==", "url": "https://github.com/cdapio/cdap/pull/12410#discussion_r453888872", "bodyText": "nit: Can we have the text align to left? I believe we it left aligned in other places in UI.", "author": "ajainarayanan", "createdAt": "2020-07-13T19:43:03Z", "path": "cdap-ui/app/cdap/components/PreviewData/DataView/Table.tsx", "diffHunk": "@@ -15,61 +15,78 @@\n  */\n \n import React from 'react';\n-import Table from '@material-ui/core/Table';\n-import TableBody from '@material-ui/core/TableBody';\n-import TableHead from '@material-ui/core/TableHead';\n-import TableRow from '@material-ui/core/TableRow';\n import Paper from '@material-ui/core/Paper';\n-import TableCell from '@material-ui/core/TableCell';\n-import withStyles, { WithStyles } from '@material-ui/core/styles/withStyles';\n+import Grid from '@material-ui/core/Grid';\n+import withStyles, { WithStyles, StyleRules } from '@material-ui/core/styles/withStyles';\n import isEmpty from 'lodash/isEmpty';\n import { PREVIEW_STATUS } from 'services/PreviewStatus';\n import Heading, { HeadingTypes } from 'components/Heading';\n import ThemeWrapper from 'components/ThemeWrapper';\n+import VirtualScroll from 'components/VirtualScroll';\n import T from 'i18n-react';\n+import classnames from 'classnames';\n \n const I18N_PREFIX = 'features.PreviewData.DataView.Table';\n \n-export const CustomTableCell = withStyles((theme) => ({\n-  head: {\n-    backgroundColor: theme.palette.grey['300'],\n-    color: theme.palette.common.white,\n-    padding: 10,\n-    fontSize: 14,\n-    '&:first-of-type': {\n-      borderRight: `1px solid ${theme.palette.grey['500']}`,\n-    },\n-  },\n-  body: {\n-    padding: 10,\n-    fontSize: 14,\n-    '&:first-of-type': {\n-      borderRight: `1px solid ${theme.palette.grey['500']}`,\n-    },\n-  },\n-}))(TableCell);\n-\n export const messageTextStyle = {\n   fontSize: '1.3rem !important',\n   margin: '10px 0',\n };\n-export const styles = (theme) => ({\n+export const styles = (theme): StyleRules => ({\n   root: {\n-    width: '100%',\n     display: 'inline-block',\n     height: 'auto',\n     marginTop: theme.spacing(1),\n   },\n+  tableContainer: {\n+    width: 'fit-content',\n+    minWidth: '100%',\n+  },\n+  recordContainer: {\n+    width: '100%',\n+  },\n   table: {\n     width: '100%',\n   },\n   row: {\n     height: 40,\n-    '&:nth-of-type(odd)': {\n+    '&.oddRow': {\n       backgroundColor: theme.palette.grey['600'],\n     },\n   },\n   messageText: messageTextStyle,\n+  headerRow: {\n+    backgroundColor: theme.palette.grey['300'],\n+    fontWeight: 500,\n+  },\n+  headerCell: {\n+    color: theme.palette.common.white,\n+    fontSize: 14,\n+  },\n+  cell: {\n+    textAlign: 'center',", "originalCommit": "c8cf11fdd9ac3befbe2c742fc733e3bf73847643", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzk5NTUxNg==", "url": "https://github.com/cdapio/cdap/pull/12410#discussion_r453995516", "bodyText": "Done!", "author": "yukiej", "createdAt": "2020-07-13T23:02:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzg4ODg3Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzg5MTI1Nw==", "url": "https://github.com/cdapio/cdap/pull/12410#discussion_r453891257", "bodyText": "Same here. Not used anywhere I believe.", "author": "ajainarayanan", "createdAt": "2020-07-13T19:47:46Z", "path": "cdap-ui/app/cdap/components/PreviewData/DataView/Table.tsx", "diffHunk": "@@ -15,61 +15,78 @@\n  */\n \n import React from 'react';\n-import Table from '@material-ui/core/Table';\n-import TableBody from '@material-ui/core/TableBody';\n-import TableHead from '@material-ui/core/TableHead';\n-import TableRow from '@material-ui/core/TableRow';\n import Paper from '@material-ui/core/Paper';\n-import TableCell from '@material-ui/core/TableCell';\n-import withStyles, { WithStyles } from '@material-ui/core/styles/withStyles';\n+import Grid from '@material-ui/core/Grid';\n+import withStyles, { WithStyles, StyleRules } from '@material-ui/core/styles/withStyles';\n import isEmpty from 'lodash/isEmpty';\n import { PREVIEW_STATUS } from 'services/PreviewStatus';\n import Heading, { HeadingTypes } from 'components/Heading';\n import ThemeWrapper from 'components/ThemeWrapper';\n+import VirtualScroll from 'components/VirtualScroll';\n import T from 'i18n-react';\n+import classnames from 'classnames';\n \n const I18N_PREFIX = 'features.PreviewData.DataView.Table';\n \n-export const CustomTableCell = withStyles((theme) => ({\n-  head: {\n-    backgroundColor: theme.palette.grey['300'],\n-    color: theme.palette.common.white,\n-    padding: 10,\n-    fontSize: 14,\n-    '&:first-of-type': {\n-      borderRight: `1px solid ${theme.palette.grey['500']}`,\n-    },\n-  },\n-  body: {\n-    padding: 10,\n-    fontSize: 14,\n-    '&:first-of-type': {\n-      borderRight: `1px solid ${theme.palette.grey['500']}`,\n-    },\n-  },\n-}))(TableCell);\n-\n export const messageTextStyle = {\n   fontSize: '1.3rem !important',\n   margin: '10px 0',\n };\n-export const styles = (theme) => ({\n+export const styles = (theme): StyleRules => ({\n   root: {\n-    width: '100%',\n     display: 'inline-block',\n     height: 'auto',\n     marginTop: theme.spacing(1),\n   },\n+  tableContainer: {\n+    width: 'fit-content',\n+    minWidth: '100%',\n+  },\n+  recordContainer: {", "originalCommit": "c8cf11fdd9ac3befbe2c742fc733e3bf73847643", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzk1NzY4OQ==", "url": "https://github.com/cdapio/cdap/pull/12410#discussion_r453957689", "bodyText": "Also used in RecordTable", "author": "yukiej", "createdAt": "2020-07-13T21:54:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzg5MTI1Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQ5NTQ0NA==", "url": "https://github.com/cdapio/cdap/pull/12410#discussion_r454495444", "bodyText": "Moved these styles to RecordTable", "author": "yukiej", "createdAt": "2020-07-14T16:45:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzg5MTI1Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzg5MjYyMQ==", "url": "https://github.com/cdapio/cdap/pull/12410#discussion_r453892621", "bodyText": "Do we need a separate class for this? Can we use the headerRow to set the color and font size? Will be set for the entire header row container.", "author": "ajainarayanan", "createdAt": "2020-07-13T19:50:25Z", "path": "cdap-ui/app/cdap/components/PreviewData/DataView/Table.tsx", "diffHunk": "@@ -15,61 +15,78 @@\n  */\n \n import React from 'react';\n-import Table from '@material-ui/core/Table';\n-import TableBody from '@material-ui/core/TableBody';\n-import TableHead from '@material-ui/core/TableHead';\n-import TableRow from '@material-ui/core/TableRow';\n import Paper from '@material-ui/core/Paper';\n-import TableCell from '@material-ui/core/TableCell';\n-import withStyles, { WithStyles } from '@material-ui/core/styles/withStyles';\n+import Grid from '@material-ui/core/Grid';\n+import withStyles, { WithStyles, StyleRules } from '@material-ui/core/styles/withStyles';\n import isEmpty from 'lodash/isEmpty';\n import { PREVIEW_STATUS } from 'services/PreviewStatus';\n import Heading, { HeadingTypes } from 'components/Heading';\n import ThemeWrapper from 'components/ThemeWrapper';\n+import VirtualScroll from 'components/VirtualScroll';\n import T from 'i18n-react';\n+import classnames from 'classnames';\n \n const I18N_PREFIX = 'features.PreviewData.DataView.Table';\n \n-export const CustomTableCell = withStyles((theme) => ({\n-  head: {\n-    backgroundColor: theme.palette.grey['300'],\n-    color: theme.palette.common.white,\n-    padding: 10,\n-    fontSize: 14,\n-    '&:first-of-type': {\n-      borderRight: `1px solid ${theme.palette.grey['500']}`,\n-    },\n-  },\n-  body: {\n-    padding: 10,\n-    fontSize: 14,\n-    '&:first-of-type': {\n-      borderRight: `1px solid ${theme.palette.grey['500']}`,\n-    },\n-  },\n-}))(TableCell);\n-\n export const messageTextStyle = {\n   fontSize: '1.3rem !important',\n   margin: '10px 0',\n };\n-export const styles = (theme) => ({\n+export const styles = (theme): StyleRules => ({\n   root: {\n-    width: '100%',\n     display: 'inline-block',\n     height: 'auto',\n     marginTop: theme.spacing(1),\n   },\n+  tableContainer: {\n+    width: 'fit-content',\n+    minWidth: '100%',\n+  },\n+  recordContainer: {\n+    width: '100%',\n+  },\n   table: {\n     width: '100%',\n   },\n   row: {\n     height: 40,\n-    '&:nth-of-type(odd)': {\n+    '&.oddRow': {\n       backgroundColor: theme.palette.grey['600'],\n     },\n   },\n   messageText: messageTextStyle,\n+  headerRow: {\n+    backgroundColor: theme.palette.grey['300'],\n+    fontWeight: 500,\n+  },\n+  headerCell: {", "originalCommit": "c8cf11fdd9ac3befbe2c742fc733e3bf73847643", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzk4OTMyNQ==", "url": "https://github.com/cdapio/cdap/pull/12410#discussion_r453989325", "bodyText": "Good call, done!", "author": "yukiej", "createdAt": "2020-07-13T22:44:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzg5MjYyMQ=="}], "type": "inlineReview"}, {"oid": "640340aaf3d11e92bd9eee24c94edb6148234748", "url": "https://github.com/cdapio/cdap/commit/640340aaf3d11e92bd9eee24c94edb6148234748", "message": "Address feedback to simplify styles", "committedDate": "2020-07-14T16:44:14Z", "type": "forcePushed"}, {"oid": "268a9cd9139db689b0dd498808cfd1311d5039a5", "url": "https://github.com/cdapio/cdap/commit/268a9cd9139db689b0dd498808cfd1311d5039a5", "message": "Adjust width of record dropdown", "committedDate": "2020-07-17T14:48:20Z", "type": "forcePushed"}, {"oid": "e2696131da9d159742eb54cd02b85226fb1b5004", "url": "https://github.com/cdapio/cdap/commit/e2696131da9d159742eb54cd02b85226fb1b5004", "message": "Adding toggle\n\nUpdate view mode based on toggle state", "committedDate": "2020-07-17T15:43:32Z", "type": "commit"}, {"oid": "e0942d0451dc49be2c4b5a6f7e5f2d0109ac32a0", "url": "https://github.com/cdapio/cdap/commit/e0942d0451dc49be2c4b5a6f7e5f2d0109ac32a0", "message": "Table view virtual scroll in progress", "committedDate": "2020-07-17T15:43:32Z", "type": "commit"}, {"oid": "38fb5e5f9780abc3ef29d168fb29f052686733cb", "url": "https://github.com/cdapio/cdap/commit/38fb5e5f9780abc3ef29d168fb29f052686733cb", "message": "Initial implementation of virtual scroll in record view, no styling", "committedDate": "2020-07-17T15:43:32Z", "type": "commit"}, {"oid": "405ae747bee4242ac651b28474ca0eb2e34dfd6e", "url": "https://github.com/cdapio/cdap/commit/405ae747bee4242ac651b28474ca0eb2e34dfd6e", "message": "Update virtual scroll to handle short tables and changes in renderList", "committedDate": "2020-07-17T15:43:32Z", "type": "commit"}, {"oid": "41b3532cfa18d4ef05a465587ed9561f7565e8bb", "url": "https://github.com/cdapio/cdap/commit/41b3532cfa18d4ef05a465587ed9561f7565e8bb", "message": "Initial styling for records with virtual scroll", "committedDate": "2020-07-17T15:43:32Z", "type": "commit"}, {"oid": "f354331854143592d984d2908e944ef45860a908", "url": "https://github.com/cdapio/cdap/commit/f354331854143592d984d2908e944ef45860a908", "message": "Modify styles for tables with fewer columns", "committedDate": "2020-07-17T15:43:32Z", "type": "commit"}, {"oid": "26020c0b5e7b96ed5221d42b6e3f6ccbee05267a", "url": "https://github.com/cdapio/cdap/commit/26020c0b5e7b96ed5221d42b6e3f6ccbee05267a", "message": "Add lines between columns in table", "committedDate": "2020-07-17T15:43:32Z", "type": "commit"}, {"oid": "25e787d2f17584306e8c370c3b3fb6311a29a45c", "url": "https://github.com/cdapio/cdap/commit/25e787d2f17584306e8c370c3b3fb6311a29a45c", "message": "Increase font weight for headers and record field names", "committedDate": "2020-07-17T15:43:33Z", "type": "commit"}, {"oid": "67293cbb1086cbaaa7408a98ea40ebe11c4d46bc", "url": "https://github.com/cdapio/cdap/commit/67293cbb1086cbaaa7408a98ea40ebe11c4d46bc", "message": "Check for out of range records", "committedDate": "2020-07-17T15:43:33Z", "type": "commit"}, {"oid": "1e0f42b773c376b0366d1097ffffbc545197fc64", "url": "https://github.com/cdapio/cdap/commit/1e0f42b773c376b0366d1097ffffbc545197fc64", "message": "Address feedback", "committedDate": "2020-07-17T15:43:33Z", "type": "commit"}, {"oid": "682dbc791229e39aa17a36275f3d9a4eeab75697", "url": "https://github.com/cdapio/cdap/commit/682dbc791229e39aa17a36275f3d9a4eeab75697", "message": "Add logic for preview content", "committedDate": "2020-07-17T15:43:33Z", "type": "commit"}, {"oid": "6afef75931bc5dd85e7ac92629ca6cb7284f096b", "url": "https://github.com/cdapio/cdap/commit/6afef75931bc5dd85e7ac92629ca6cb7284f096b", "message": "Fix styles when there are no records", "committedDate": "2020-07-17T15:43:33Z", "type": "commit"}, {"oid": "2a4e5b57ec5a3c4e9c9c3250c6b4ec1f54baa41a", "url": "https://github.com/cdapio/cdap/commit/2a4e5b57ec5a3c4e9c9c3250c6b4ec1f54baa41a", "message": "Fix preview loading styles", "committedDate": "2020-07-17T15:43:33Z", "type": "commit"}, {"oid": "5c728117b8614e07afaa1602ac9aac2f4f7300b4", "url": "https://github.com/cdapio/cdap/commit/5c728117b8614e07afaa1602ac9aac2f4f7300b4", "message": "Address feedback to simplify styles", "committedDate": "2020-07-17T15:43:33Z", "type": "commit"}, {"oid": "2c03a5e69f35bc45b84ae6db36c2038f8b9d9532", "url": "https://github.com/cdapio/cdap/commit/2c03a5e69f35bc45b84ae6db36c2038f8b9d9532", "message": "Update blue line for hydrator modal to match configurable tabs", "committedDate": "2020-07-17T15:43:34Z", "type": "commit"}, {"oid": "058ba4b10687bfa32499372adb2283f3fc94807d", "url": "https://github.com/cdapio/cdap/commit/058ba4b10687bfa32499372adb2283f3fc94807d", "message": "Switch out abstract widget", "committedDate": "2020-07-17T15:52:43Z", "type": "commit"}, {"oid": "06450711c320525aa54af8cd295a637d6371f55d", "url": "https://github.com/cdapio/cdap/commit/06450711c320525aa54af8cd295a637d6371f55d", "message": "Add extra space to align records when there are multiple inputs or outputs", "committedDate": "2020-07-17T15:52:48Z", "type": "commit"}, {"oid": "e0593b3def33ccbd532466bbfc4ef76dad1214be", "url": "https://github.com/cdapio/cdap/commit/e0593b3def33ccbd532466bbfc4ef76dad1214be", "message": "Disable toggle for condition pluginn", "committedDate": "2020-07-17T15:52:48Z", "type": "commit"}, {"oid": "085d3db9ef45123d607c2f93c5f2cb006c09da80", "url": "https://github.com/cdapio/cdap/commit/085d3db9ef45123d607c2f93c5f2cb006c09da80", "message": "Fix spacing around tabs", "committedDate": "2020-07-17T15:52:48Z", "type": "commit"}, {"oid": "a8e967abed8dfa58d77537368d2d0795ac4161f3", "url": "https://github.com/cdapio/cdap/commit/a8e967abed8dfa58d77537368d2d0795ac4161f3", "message": "Match heights for split containers including ones without data", "committedDate": "2020-07-17T15:52:48Z", "type": "commit"}, {"oid": "7be19d59b73e9e600f2f2d2b422b60e9c5161830", "url": "https://github.com/cdapio/cdap/commit/7be19d59b73e9e600f2f2d2b422b60e9c5161830", "message": "Fix record count calculation bug", "committedDate": "2020-07-17T15:52:48Z", "type": "commit"}, {"oid": "62f86c31d4d734f927b62ea78fd1da4944606599", "url": "https://github.com/cdapio/cdap/commit/62f86c31d4d734f927b62ea78fd1da4944606599", "message": "Adjust width of record dropdown", "committedDate": "2020-07-17T15:52:48Z", "type": "commit"}, {"oid": "f5c0fb8e8a0f77ea695050cac690b17b39031b98", "url": "https://github.com/cdapio/cdap/commit/f5c0fb8e8a0f77ea695050cac690b17b39031b98", "message": "Merge conflict fixes", "committedDate": "2020-07-17T16:40:06Z", "type": "commit"}, {"oid": "f5c0fb8e8a0f77ea695050cac690b17b39031b98", "url": "https://github.com/cdapio/cdap/commit/f5c0fb8e8a0f77ea695050cac690b17b39031b98", "message": "Merge conflict fixes", "committedDate": "2020-07-17T16:40:06Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjYxNTA2Ng==", "url": "https://github.com/cdapio/cdap/pull/12410#discussion_r456615066", "bodyText": "Curious: Why switch from the pseudo-class to an explicit class?", "author": "njbriggs", "createdAt": "2020-07-17T18:45:49Z", "path": "cdap-ui/app/cdap/components/PreviewData/DataView/Table.tsx", "diffHunk": "@@ -15,61 +15,65 @@\n  */\n \n import React from 'react';\n-import Table from '@material-ui/core/Table';\n-import TableBody from '@material-ui/core/TableBody';\n-import TableHead from '@material-ui/core/TableHead';\n-import TableRow from '@material-ui/core/TableRow';\n import Paper from '@material-ui/core/Paper';\n-import TableCell from '@material-ui/core/TableCell';\n-import withStyles, { WithStyles } from '@material-ui/core/styles/withStyles';\n+import Grid from '@material-ui/core/Grid';\n+import withStyles, { WithStyles, StyleRules } from '@material-ui/core/styles/withStyles';\n import isEmpty from 'lodash/isEmpty';\n import { PREVIEW_STATUS } from 'services/PreviewStatus';\n import Heading, { HeadingTypes } from 'components/Heading';\n import ThemeWrapper from 'components/ThemeWrapper';\n+import VirtualScroll from 'components/VirtualScroll';\n import T from 'i18n-react';\n+import classnames from 'classnames';\n \n const I18N_PREFIX = 'features.PreviewData.DataView.Table';\n \n-export const CustomTableCell = withStyles((theme) => ({\n-  head: {\n-    backgroundColor: theme.palette.grey['300'],\n-    color: theme.palette.common.white,\n-    padding: 10,\n-    fontSize: 14,\n-    '&:first-of-type': {\n-      borderRight: `1px solid ${theme.palette.grey['500']}`,\n-    },\n-  },\n-  body: {\n-    padding: 10,\n-    fontSize: 14,\n-    '&:first-of-type': {\n-      borderRight: `1px solid ${theme.palette.grey['500']}`,\n-    },\n-  },\n-}))(TableCell);\n-\n export const messageTextStyle = {\n   fontSize: '1.3rem !important',\n-  margin: '10px 0',\n+  margin: 'unset',\n+  padding: '10px 5px',\n };\n-export const styles = (theme) => ({\n+export const styles = (theme): StyleRules => ({\n   root: {\n-    width: '100%',\n     display: 'inline-block',\n     height: 'auto',\n     marginTop: theme.spacing(1),\n   },\n-  table: {\n-    width: '100%',\n+  tableContainer: {\n+    width: 'fit-content',\n+    minWidth: '100%',\n   },\n   row: {\n     height: 40,\n-    '&:nth-of-type(odd)': {\n+    '&.oddRow': {", "originalCommit": "f5c0fb8e8a0f77ea695050cac690b17b39031b98", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjYxODE2Nw==", "url": "https://github.com/cdapio/cdap/pull/12410#discussion_r456618167", "bodyText": "Nm, looks like the virtual scroll would alter the oddness/evenness of a given row.", "author": "njbriggs", "createdAt": "2020-07-17T18:52:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjYxNTA2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjYxODI2NA==", "url": "https://github.com/cdapio/cdap/pull/12410#discussion_r456618264", "bodyText": "Great question - I did this so the color of a row didn't change/flicker randomly now that we're dynamically generating the rows with virtual scroll.", "author": "yukiej", "createdAt": "2020-07-17T18:52:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjYxNTA2Ng=="}], "type": "inlineReview"}]}