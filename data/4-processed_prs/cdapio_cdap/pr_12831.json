{"pr_number": 12831, "pr_title": "[CDAP-8617] Fixes UI to show proper Authorization message for unauthorized users of the namespace ", "pr_createdAt": "2020-10-30T05:03:38Z", "pr_url": "https://github.com/cdapio/cdap/pull/12831", "timeline": [{"oid": "d53d0b7a5d1c616866f4b79e2dd3ef881073394b", "url": "https://github.com/cdapio/cdap/commit/d53d0b7a5d1c616866f4b79e2dd3ef881073394b", "message": "Fixes tracker and hydtator to properly handle 403s vs 404s", "committedDate": "2020-10-30T18:26:28Z", "type": "forcePushed"}, {"oid": "715553e6b9884fbbf535ae9c47c58208ffc9aaec", "url": "https://github.com/cdapio/cdap/commit/715553e6b9884fbbf535ae9c47c58208ffc9aaec", "message": "Fixes tracker and hydtator to properly handle 403s vs 404s", "committedDate": "2020-10-30T18:34:06Z", "type": "forcePushed"}, {"oid": "de2561f5ec97b139d1209958db0fb5feb06539c4", "url": "https://github.com/cdapio/cdap/commit/de2561f5ec97b139d1209958db0fb5feb06539c4", "message": "Fixes tracker and hydtator to properly handle 403s vs 404s", "committedDate": "2020-10-30T18:36:54Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTM4ODIyMA==", "url": "https://github.com/cdapio/cdap/pull/12831#discussion_r515388220", "bodyText": "Long-term, should we show the message from the back end? Will it be localized? (No need to change for now)", "author": "njbriggs", "createdAt": "2020-10-30T21:20:41Z", "path": "cdap-ui/app/cdap/main.js", "diffHunk": "@@ -358,22 +357,35 @@ class CDAP extends Component {\n               </div>\n             </If>\n             <If condition={!this.state.isNamespaceFetchInFlight}>\n-              <If\n-                condition={this.state.pageLevelError && this.state.pageLevelError.errorCode === 404}\n-              >\n+              <If condition={isNamespaceNotFound}>\n                 <Page404 message={this.state.pageLevelError.message} />\n               </If>\n+              {/** We show authorization failure message when the specific namespace API returns 403 */}\n+              <If condition={isUserUnAuthorizedForNamespace}>\n+                <AuthorizationErrorMessage message={this.state.pageLevelError.message} />\n+              </If>\n               <If\n-                condition={this.state.pageLevelError && this.state.pageLevelError.errorCode !== 404}\n+                condition={\n+                  !isUserUnAuthorizedForNamespace &&\n+                  !isNamespaceNotFound &&\n+                  this.state.pageLevelError\n+                }\n               >\n                 <Page500\n                   message={this.state.pageLevelError.message}\n                   refreshFn={this.retrieveNamespace}\n                 />\n               </If>\n-\n+              {/**\n+               * We show authorization failure message when the backend return empty\n+               * namespace. This indicates the user has access to no namespace.\n+               */}\n               <If condition={!this.state.pageLevelError}>\n-                {this.state.authorizationFailed ? <AuthorizationErrorMessage /> : container}\n+                {this.state.authorizationFailed ? (\n+                  <AuthorizationErrorMessage message={this.state.pageLevelError.message} />", "originalCommit": "de2561f5ec97b139d1209958db0fb5feb06539c4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjE5MzAwNw==", "url": "https://github.com/cdapio/cdap/pull/12831#discussion_r516193007", "bodyText": "Yeah as of now we don't have the message from backend. One possible way to do this would be to have a health API from backend that deterministically say that the backend is down and if not can send a message that UI can use. But as far as I can see the message will be from UI as it needs to have call-to-actions as well as other context for the user.", "author": "ajainarayanan", "createdAt": "2020-11-02T19:04:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTM4ODIyMA=="}], "type": "inlineReview"}, {"oid": "9bee67d0593ac641c0e141fc331cde19e9252fd5", "url": "https://github.com/cdapio/cdap/commit/9bee67d0593ac641c0e141fc331cde19e9252fd5", "message": "[CDAP-8617] Fixes UI to show proper Authorization message for unauthorized users of the namespace\n\n  - Consolidates throwing Authorization error in Home & RouteToNamespace components in react side of the app\n  - Adds utility functions to NamespaceStore to check and validate namespace, including access to no namespace\n  - Adds namespace context to AuthorizationErrorMessage component + exports it to use in Angular side\n  - Removes old implementation of validating namespace function in angular helpers\n  - Replaces old namespace validation function usage in both hydrator & tracker with new one exported from react\n  - Removes unnecessary margin top styling for canvas\n  - Fixes namespace accordion in Admin view to show valid empty message when user has access to no namespace\n  - Fixes navigation to Admin view to reset page error\n  - Fixes tracker and hydtator to properly handle 403s vs 404s", "committedDate": "2020-11-02T22:47:38Z", "type": "commit"}, {"oid": "9bee67d0593ac641c0e141fc331cde19e9252fd5", "url": "https://github.com/cdapio/cdap/commit/9bee67d0593ac641c0e141fc331cde19e9252fd5", "message": "[CDAP-8617] Fixes UI to show proper Authorization message for unauthorized users of the namespace\n\n  - Consolidates throwing Authorization error in Home & RouteToNamespace components in react side of the app\n  - Adds utility functions to NamespaceStore to check and validate namespace, including access to no namespace\n  - Adds namespace context to AuthorizationErrorMessage component + exports it to use in Angular side\n  - Removes old implementation of validating namespace function in angular helpers\n  - Replaces old namespace validation function usage in both hydrator & tracker with new one exported from react\n  - Removes unnecessary margin top styling for canvas\n  - Fixes namespace accordion in Admin view to show valid empty message when user has access to no namespace\n  - Fixes navigation to Admin view to reset page error\n  - Fixes tracker and hydtator to properly handle 403s vs 404s", "committedDate": "2020-11-02T22:47:38Z", "type": "forcePushed"}]}