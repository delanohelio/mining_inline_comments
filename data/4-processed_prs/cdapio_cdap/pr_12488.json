{"pr_number": 12488, "pr_title": "[CDAP-16414] Handling graphQL errors in pipeline list view", "pr_createdAt": "2020-07-23T16:16:12Z", "pr_url": "https://github.com/cdapio/cdap/pull/12488", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTYzOTc2Mg==", "url": "https://github.com/cdapio/cdap/pull/12488#discussion_r459639762", "bodyText": "Is the condition above correct? If I'm reading the condition correctly, errorsByOrigin['network'] will always be undefined here.", "author": "njbriggs", "createdAt": "2020-07-23T18:17:02Z", "path": "cdap-ui/app/cdap/services/helpers.js", "diffHunk": "@@ -489,6 +489,37 @@ function connectWithStore(store, WrappedComponent, ...args) {\n     return <ConnectedWrappedComponent {...props} store={store} />;\n   };\n }\n+/**\n+ * This function formats the graphQl errors by error type\n+ * { errorType: ['message1', 'message2'] ....} will be\n+ * the format of categorized errors.\n+ */\n+function categorizeGraphQlErrors(error) {\n+  const GENERIC_ERROR_ORIGIN = 'generic';\n+  const graphQLErrors = objectQuery(error, 'graphQLErrors') || [];\n+  const networkErrors = objectQuery(error, 'networkError') || [];\n+  const errorsByOrigin = {};\n+  if (graphQLErrors.length === 0 && networkErrors.length === 0 && error) {\n+    errorsByOrigin[GENERIC_ERROR_ORIGIN] = error.message;\n+  }\n+  graphQLErrors.forEach(error => {\n+    const errorOrigin = objectQuery(error, 'extensions', 'exception', 'errorOrigin') || GENERIC_ERROR_ORIGIN;\n+    if (errorsByOrigin.hasOwnProperty(errorOrigin)) {\n+      errorsByOrigin[errorOrigin] = [error.message];\n+    }\n+    else {\n+      errorsByOrigin[errorOrigin].push([error.message]);\n+    }\n+  });\n+  networkErrors.forEach(error => {\n+    if (errorsByOrigin.hasOwnProperty('network')) {\n+      errorsByOrigin['network'] = [error.message];\n+    } else {\n+      errorsByOrigin['network'].push([error.message]);", "originalCommit": "e45ac92e04fbc8683d31ec73b0da6c4b95860caf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTY0OTY3OQ==", "url": "https://github.com/cdapio/cdap/pull/12488#discussion_r459649679", "bodyText": "Fixed the condition", "author": "itsanudeep", "createdAt": "2020-07-23T18:34:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTYzOTc2Mg=="}], "type": "inlineReview"}, {"oid": "15d5de7a88a63fa5837f0d694077c637f5cdeb18", "url": "https://github.com/cdapio/cdap/commit/15d5de7a88a63fa5837f0d694077c637f5cdeb18", "message": "graphql error handling for pipelines list page", "committedDate": "2020-07-23T18:33:32Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTA0OTc4MQ==", "url": "https://github.com/cdapio/cdap/pull/12488#discussion_r461049781", "bodyText": "nit: can you validate this message with @leacd ?\nI think its a bit better to say Multiple services encountered some issues retrieving pipelines.....", "author": "elfenheart", "createdAt": "2020-07-27T17:24:41Z", "path": "cdap-ui/app/cdap/text/text-en.yaml", "diffHunk": "@@ -2145,6 +2145,7 @@ features:\n         1: \"pipeline \"\n         _: \"pipelines \"\n     DeployedPipelineView:\n+      graphQLMultipleServicesDown: Multiple services ran into issues when trying to retrieve list of pipelines. Please try again later.", "originalCommit": "15d5de7a88a63fa5837f0d694077c637f5cdeb18", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTcwNjkyNA==", "url": "https://github.com/cdapio/cdap/pull/12488#discussion_r461706924", "bodyText": "Reached out to Lea, waiting on her suggestion", "author": "itsanudeep", "createdAt": "2020-07-28T16:18:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTA0OTc4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTg0ODQ5Mg==", "url": "https://github.com/cdapio/cdap/pull/12488#discussion_r461848492", "bodyText": "updated the message", "author": "itsanudeep", "createdAt": "2020-07-28T20:12:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTA0OTc4MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTA2NzkwMQ==", "url": "https://github.com/cdapio/cdap/pull/12488#discussion_r461067901", "bodyText": "Don't think we should hardcode 500 here. We might have 403 or 401 errors tomorrow which should not converted. Can we get the status code from the request response?", "author": "ajainarayanan", "createdAt": "2020-07-27T17:56:03Z", "path": "cdap-ui/graphql/resolvers-common.js", "diffHunk": "@@ -41,14 +41,24 @@ export function requestPromiseWrapper(options, token, bodyModifiersFn) {\n   return new Promise((resolve, reject) => {\n     request(options, (err, response, body) => {\n       if (err) {\n-        const error =  new ApolloError(err, '500');\n-        return reject(error);\n+        let exception;\n+        if (typeof errorModifiersFn === 'function') {\n+          exception = errorModifiersFn(err, '500');", "originalCommit": "15d5de7a88a63fa5837f0d694077c637f5cdeb18", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTcwNjc3NA==", "url": "https://github.com/cdapio/cdap/pull/12488#discussion_r461706774", "bodyText": "done", "author": "itsanudeep", "createdAt": "2020-07-28T16:17:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTA2NzkwMQ=="}], "type": "inlineReview"}, {"oid": "457d7c9fdccb8e9f4ea876e7596ca1a4e25b5834", "url": "https://github.com/cdapio/cdap/commit/457d7c9fdccb8e9f4ea876e7596ca1a4e25b5834", "message": "use statusCode", "committedDate": "2020-07-28T16:04:00Z", "type": "forcePushed"}, {"oid": "8475bb610a381ca92de02d5a78e564fd118ef05e", "url": "https://github.com/cdapio/cdap/commit/8475bb610a381ca92de02d5a78e564fd118ef05e", "message": "graphql error handling for pipelines list page", "committedDate": "2020-07-29T16:55:21Z", "type": "commit"}, {"oid": "8475bb610a381ca92de02d5a78e564fd118ef05e", "url": "https://github.com/cdapio/cdap/commit/8475bb610a381ca92de02d5a78e564fd118ef05e", "message": "graphql error handling for pipelines list page", "committedDate": "2020-07-29T16:55:21Z", "type": "forcePushed"}]}