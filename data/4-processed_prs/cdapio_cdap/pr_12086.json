{"pr_number": 12086, "pr_title": "[CDAP-16236] Reverts the change to remove check for macros before running preview", "pr_createdAt": "2020-04-19T16:42:25Z", "pr_url": "https://github.com/cdapio/cdap/pull/12086", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjMxNTU2Ng==", "url": "https://github.com/cdapio/cdap/pull/12086#discussion_r412315566", "bodyText": "nit: Can we name this something more appropriate? Having empty values is still valid to start a preview, it's just we don't want to 'Run' the preview right away without opening the modeless.", "author": "itsanudeep", "createdAt": "2020-04-21T16:41:49Z", "path": "cdap-ui/app/hydrator/controllers/create/toppanel-ctrl.js", "diffHunk": "@@ -502,6 +511,11 @@ class HydratorPlusPlusTopPanelCtrl {\n     this.previewStore.dispatch(\n       this.previewActions.setRuntimeArgsForDisplay(_.cloneDeep(this.runtimeArguments))\n     );\n+    this.validToStartPreview = this.isValidToStartPreview();\n+  }\n+\n+  isValidToStartPreview() {", "originalCommit": "bca67625f280eee9cf47a475d691e14da0b6d6f6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjMyNjA5Ng==", "url": "https://github.com/cdapio/cdap/pull/12086#discussion_r412326096", "bodyText": "Can we add a TODO to clean this up when we have preview enabled in bamboo?", "author": "itsanudeep", "createdAt": "2020-04-21T16:55:05Z", "path": "cdap-ui/cypress/integration/pipeline.runtimeargs.spec.ts", "diffHunk": "@@ -29,16 +33,23 @@ const PREVIEW_SUCCESS_BANNER_MSG =\n const SINK_PATH_VAL = '/tmp/cdap-ui-integration-fixtures';\n const SOURCE_PATH_VAL = 'file:/tmp/cdap-ui-integration-fixtures/airports.csv';\n \n-/* Disabling preview tests for now because our E2E tests don't have preview enabled\n- describe('Creating pipeline with macros ', () => {\n+let skipPreviewTests = false;", "originalCommit": "bca67625f280eee9cf47a475d691e14da0b6d6f6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjMzOTIzNg==", "url": "https://github.com/cdapio/cdap/pull/12086#discussion_r412339236", "bodyText": "We were trying to avoid explicit wait statements like these, right? You can use cy.get('[title=\"Airport_source\"').should('exist'); to check if the pipeline is deployed like we do in other tests?", "author": "itsanudeep", "createdAt": "2020-04-21T17:12:52Z", "path": "cdap-ui/cypress/integration/pipeline.runtimeargs.spec.ts", "diffHunk": "@@ -48,21 +59,22 @@ const SOURCE_PATH_VAL = 'file:/tmp/cdap-ui-integration-fixtures/airports.csv';\n     getArtifactsPoll(headers);\n   });\n \n-  it('should be successful for preview', () => {\n+  it('and providing wrong runtime arguments should fail the pipeline preview.', () => {\n     // Go to Pipelines studio\n     cy.visit('/pipelines/ns/default/studio');\n-    cy.url().should('include', '/studio');\n+    cy.window().then((window) => {\n+      skipPreviewTests = window.CDAP_CONFIG.hydrator.previewEnabled !== true;\n+    });\n+    if (skipPreviewTests) {\n+      skip();\n+    }\n     cy.upload_pipeline(\n       'pipeline_with_macros.json',\n       '#pipeline-import-config-link > input[type=\"file\"]'\n-    ).then(subject => {\n-      expect(subject.length).to.be.eq(1);\n-    });\n-  });\n-\n-  it('and providing wrong runtime arguments should fail the pipeline preview.', () => {\n+    );\n+    cy.wait(10000);", "originalCommit": "bca67625f280eee9cf47a475d691e14da0b6d6f6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjQxMTM3Nw==", "url": "https://github.com/cdapio/cdap/pull/12086#discussion_r412411377", "bodyText": "I agree we need to avoid the wait times but this is uploading a json in pipeline studio and we don't have a fail-proof way to find if its complete.", "author": "ajainarayanan", "createdAt": "2020-04-21T18:56:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjMzOTIzNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjQyNTY5Nw==", "url": "https://github.com/cdapio/cdap/pull/12086#discussion_r412425697", "bodyText": "Won't cy.get('[title=\"Airport_source\"').should('exist');  do this? We're testing if title in source node is present, which we only see after the pipeline is uploaded and ready in studio?", "author": "itsanudeep", "createdAt": "2020-04-21T19:18:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjMzOTIzNg=="}], "type": "inlineReview"}, {"oid": "412ad40314c01a56cd7622a48ed46bdbba61e060", "url": "https://github.com/cdapio/cdap/commit/412ad40314c01a56cd7622a48ed46bdbba61e060", "message": "[CDAP-16236] Reverts the change to remove check for macros before running preview\n\n - Fixes preview tests to be skipped on environments where preview is disabled\n - Fixes data-cy attribute of run button in preview to be consistent\n - Show runtime arguments if there are unfulfilled macros before running preview", "committedDate": "2020-04-28T00:19:27Z", "type": "commit"}, {"oid": "412ad40314c01a56cd7622a48ed46bdbba61e060", "url": "https://github.com/cdapio/cdap/commit/412ad40314c01a56cd7622a48ed46bdbba61e060", "message": "[CDAP-16236] Reverts the change to remove check for macros before running preview\n\n - Fixes preview tests to be skipped on environments where preview is disabled\n - Fixes data-cy attribute of run button in preview to be consistent\n - Show runtime arguments if there are unfulfilled macros before running preview", "committedDate": "2020-04-28T00:19:27Z", "type": "forcePushed"}]}