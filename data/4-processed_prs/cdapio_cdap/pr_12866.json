{"pr_number": 12866, "pr_title": "[CDAP-17413] Fixes joiner in-memory input stages to show correct value when input stages change", "pr_createdAt": "2020-11-21T00:38:30Z", "pr_url": "https://github.com/cdapio/cdap/pull/12866", "timeline": [{"oid": "3607ab09e971f098cf0b44171dfefec48b3a87ad", "url": "https://github.com/cdapio/cdap/commit/3607ab09e971f098cf0b44171dfefec48b3a87ad", "message": "[CDAP-17413] Fixes joiner in-memory input stages to show correct value when input stages change", "committedDate": "2020-11-21T00:35:39Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTAxNzYwNA==", "url": "https://github.com/cdapio/cdap/pull/12866#discussion_r529017604", "bodyText": "Is there some store where this should be validated? Seems odd to call back when rendering.", "author": "njbriggs", "createdAt": "2020-11-23T21:48:05Z", "path": "cdap-ui/app/cdap/components/AbstractWidget/MultiStageSelector/index.tsx", "diffHunk": "@@ -72,13 +72,36 @@ const MultiStageSelectorBase: React.FC<IMultiStageSelectorProps> = ({\n       </div>\n     );\n   }\n+  const validatedValue = value\n+    .toString()\n+    .split(',')\n+    .filter((stage) => {\n+      return inputStages.find((s) => s.id === stage);\n+    })\n+    .join(',');\n+  if (validatedValue !== value) {\n+    /**\n+     * This will happen when the user configured the plugin (say joiner)\n+     * with initial two stages and then later drop one of those stages.\n+     *\n+     * Now the previously selected input stages are no longer valid.\n+     * The validatedValue will only have stages that are still input to joiner\n+     * and will update the value of the plugin automatically.\n+     *\n+     * If not for this we will show only valid stages but the actual plugin property\n+     * will have all the stages.\n+     */\n+    onChange(validatedValue);", "originalCommit": "3607ab09e971f098cf0b44171dfefec48b3a87ad", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjI4NDExMA==", "url": "https://github.com/cdapio/cdap/pull/12866#discussion_r536284110", "bodyText": "@njbriggs The validation happens couple of lines above. The validation is nothing but checking if the input stages specified in the value still present as input.\nSay,\n\nThe user connects a File and a GCS source to joiner\nConfigures joiner and chooses the two sources in the multistageselector\nCloses the joiner and renames or removes one of the input stages, say File source\n\nUpon opening the joiner the MultiStageSelector should not include the removed source as it is not longer valid. Previously the select widget used to remove it from rendering (as it is not present in the list).\nNow we are removing it from the list and updating the value of plugin property to have only valid input stages.", "author": "ajainarayanan", "createdAt": "2020-12-04T18:09:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTAxNzYwNA=="}], "type": "inlineReview"}]}