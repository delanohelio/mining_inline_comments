{"pr_number": 923, "pr_title": "Refactor deprecated type", "pr_createdAt": "2020-01-30T15:15:44Z", "pr_url": "https://github.com/1c-syntax/bsl-language-server/pull/923", "timeline": [{"oid": "320bf38722ef41b88cd64f4f085e1f43a43cf055", "url": "https://github.com/1c-syntax/bsl-language-server/commit/320bf38722ef41b88cd64f4f085e1f43a43cf055", "message": "Refactor DeprecatedTypeManagedFormDiagnostic", "committedDate": "2020-01-30T12:11:45Z", "type": "commit"}, {"oid": "4350f494bc8afbd1037860fb514f78e5f1879bc3", "url": "https://github.com/1c-syntax/bsl-language-server/commit/4350f494bc8afbd1037860fb514f78e5f1879bc3", "message": "Refactor DeprecatedTypeManagedFormDiagnostic", "committedDate": "2020-01-30T12:52:41Z", "type": "commit"}, {"oid": "3f73359f4f9990508b7a8356ec423a306299bb4e", "url": "https://github.com/1c-syntax/bsl-language-server/commit/3f73359f4f9990508b7a8356ec423a306299bb4e", "message": "Refactor DeprecatedTypeManagedFormDiagnostic", "committedDate": "2020-01-30T15:04:24Z", "type": "commit"}, {"oid": "8662f1b56505f61739dcdadcf5b58d1599ca9588", "url": "https://github.com/1c-syntax/bsl-language-server/commit/8662f1b56505f61739dcdadcf5b58d1599ca9588", "message": "\u0420\u0430\u0441\u0448\u0438\u0440\u0435\u043d\u0438\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f", "committedDate": "2020-01-30T15:14:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzA2MTEyNQ==", "url": "https://github.com/1c-syntax/bsl-language-server/pull/923#discussion_r373061125", "bodyText": "\u0410 \u0437\u0430\u0447\u0435\u043c \u0447\u0435\u0440\u0435\u0437 getChild? \u041f\u043e\u0447\u0435\u043c\u0443 \u043d\u0435 \u0432\u0435\u0440\u043d\u0443\u0442\u044c ctx.doCall?", "author": "nixel2007", "createdAt": "2020-01-30T16:39:27Z", "path": "src/main/java/com/github/_1c_syntax/bsl/languageserver/diagnostics/DeprecatedTypeManagedFormDiagnostic.java", "diffHunk": "@@ -65,29 +65,29 @@\n     Pattern.CASE_INSENSITIVE | Pattern.UNICODE_CASE\n   );\n \n-  private boolean isTypeMethod = false;\n-\n   public DeprecatedTypeManagedFormDiagnostic(DiagnosticInfo info) {\n     super(info);\n   }\n \n   @Override\n   public ParseTree visitGlobalMethodCall(BSLParser.GlobalMethodCallContext ctx ) {\n-    if (methodPattern.matcher(ctx.methodName().getText()).matches()) {\n-      isTypeMethod = true;\n+\n+    if (!methodPattern.matcher(ctx.methodName().getText()).matches()) {\n+      return super.visitGlobalMethodCall(ctx);\n     }\n-    return super.visitGlobalMethodCall(ctx);\n-  }\n+    BSLParser.DoCallContext found = ctx.getChild(BSLParser.DoCallContext.class, 0);", "originalCommit": "8662f1b56505f61739dcdadcf5b58d1599ca9588", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzM1Njg3Mg==", "url": "https://github.com/1c-syntax/bsl-language-server/pull/923#discussion_r373356872", "bodyText": "Done", "author": "EightM", "createdAt": "2020-01-31T08:09:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzA2MTEyNQ=="}], "type": "inlineReview"}, {"oid": "1a3110c876cc8602142606b10769a6bf9e2d7609", "url": "https://github.com/1c-syntax/bsl-language-server/commit/1a3110c876cc8602142606b10769a6bf9e2d7609", "message": "Merge branch 'develop' of https://github.com/1c-syntax/bsl-language-server into RefactorDeprecatedType", "committedDate": "2020-01-31T07:59:34Z", "type": "commit"}, {"oid": "c362e43d21ce669e8fc4bd4ab7ab48ab4d8b1789", "url": "https://github.com/1c-syntax/bsl-language-server/commit/c362e43d21ce669e8fc4bd4ab7ab48ab4d8b1789", "message": "\u0417\u0430\u043c\u0435\u043d\u0430 \u043d\u0430 doCall", "committedDate": "2020-01-31T08:06:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDE4Nzk2OQ==", "url": "https://github.com/1c-syntax/bsl-language-server/pull/923#discussion_r374187969", "bodyText": "\u0441\u0442\u043e\u0438\u0442 \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c {}", "author": "nixel2007", "createdAt": "2020-02-03T16:01:56Z", "path": "src/main/java/com/github/_1c_syntax/bsl/languageserver/diagnostics/DeprecatedTypeManagedFormDiagnostic.java", "diffHunk": "@@ -65,29 +65,30 @@\n     Pattern.CASE_INSENSITIVE | Pattern.UNICODE_CASE\n   );\n \n-  private boolean isTypeMethod = false;\n-\n   public DeprecatedTypeManagedFormDiagnostic(DiagnosticInfo info) {\n     super(info);\n   }\n \n   @Override\n   public ParseTree visitGlobalMethodCall(BSLParser.GlobalMethodCallContext ctx ) {\n-    if (methodPattern.matcher(ctx.methodName().getText()).matches()) {\n-      isTypeMethod = true;\n+\n+    if (!methodPattern.matcher(ctx.methodName().getText()).matches()) {\n+      return super.visitGlobalMethodCall(ctx);\n     }\n-    return super.visitGlobalMethodCall(ctx);\n-  }\n \n-  @Override\n-  public ParseTree visitCallParamList(BSLParser.CallParamListContext ctx) {\n-    if (isTypeMethod) {\n-      if (paramPattern.matcher(ctx.getText().replaceAll(\"\\\"\", \"\")).matches()) {\n-        diagnosticStorage.addDiagnostic(ctx);\n-      }\n-      isTypeMethod = false;\n+    BSLParser.DoCallContext found = ctx.doCall();\n+\n+    if (found == null) return super.visitGlobalMethodCall(ctx);", "originalCommit": "c362e43d21ce669e8fc4bd4ab7ab48ab4d8b1789", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDE4ODIwNg==", "url": "https://github.com/1c-syntax/bsl-language-server/pull/923#discussion_r374188206", "bodyText": "\u0442\u044d\u043a\u0441, \u0430 \u0442\u0443\u0442 \u043f\u043e\u0447\u0435\u043c\u0443 \u043d\u0435\u043b\u044c\u0437\u044f \u0432\u044b\u0437\u0432\u0430\u0442\u044c found.callParamList?", "author": "nixel2007", "createdAt": "2020-02-03T16:02:18Z", "path": "src/main/java/com/github/_1c_syntax/bsl/languageserver/diagnostics/DeprecatedTypeManagedFormDiagnostic.java", "diffHunk": "@@ -65,29 +65,30 @@\n     Pattern.CASE_INSENSITIVE | Pattern.UNICODE_CASE\n   );\n \n-  private boolean isTypeMethod = false;\n-\n   public DeprecatedTypeManagedFormDiagnostic(DiagnosticInfo info) {\n     super(info);\n   }\n \n   @Override\n   public ParseTree visitGlobalMethodCall(BSLParser.GlobalMethodCallContext ctx ) {\n-    if (methodPattern.matcher(ctx.methodName().getText()).matches()) {\n-      isTypeMethod = true;\n+\n+    if (!methodPattern.matcher(ctx.methodName().getText()).matches()) {\n+      return super.visitGlobalMethodCall(ctx);\n     }\n-    return super.visitGlobalMethodCall(ctx);\n-  }\n \n-  @Override\n-  public ParseTree visitCallParamList(BSLParser.CallParamListContext ctx) {\n-    if (isTypeMethod) {\n-      if (paramPattern.matcher(ctx.getText().replaceAll(\"\\\"\", \"\")).matches()) {\n-        diagnosticStorage.addDiagnostic(ctx);\n-      }\n-      isTypeMethod = false;\n+    BSLParser.DoCallContext found = ctx.doCall();\n+\n+    if (found == null) return super.visitGlobalMethodCall(ctx);\n+\n+    BSLParser.CallParamListContext callCtx = found.getChild(BSLParser.CallParamListContext.class, 0);", "originalCommit": "c362e43d21ce669e8fc4bd4ab7ab48ab4d8b1789", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDUzMjQ1OQ==", "url": "https://github.com/1c-syntax/bsl-language-server/pull/923#discussion_r374532459", "bodyText": "Done", "author": "EightM", "createdAt": "2020-02-04T08:33:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDE4ODIwNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDE4ODMzMA==", "url": "https://github.com/1c-syntax/bsl-language-server/pull/923#discussion_r374188330", "bodyText": "\u0438 \u0442\u0443\u0442 {}", "author": "nixel2007", "createdAt": "2020-02-03T16:02:30Z", "path": "src/main/java/com/github/_1c_syntax/bsl/languageserver/diagnostics/DeprecatedTypeManagedFormDiagnostic.java", "diffHunk": "@@ -65,29 +65,30 @@\n     Pattern.CASE_INSENSITIVE | Pattern.UNICODE_CASE\n   );\n \n-  private boolean isTypeMethod = false;\n-\n   public DeprecatedTypeManagedFormDiagnostic(DiagnosticInfo info) {\n     super(info);\n   }\n \n   @Override\n   public ParseTree visitGlobalMethodCall(BSLParser.GlobalMethodCallContext ctx ) {\n-    if (methodPattern.matcher(ctx.methodName().getText()).matches()) {\n-      isTypeMethod = true;\n+\n+    if (!methodPattern.matcher(ctx.methodName().getText()).matches()) {\n+      return super.visitGlobalMethodCall(ctx);\n     }\n-    return super.visitGlobalMethodCall(ctx);\n-  }\n \n-  @Override\n-  public ParseTree visitCallParamList(BSLParser.CallParamListContext ctx) {\n-    if (isTypeMethod) {\n-      if (paramPattern.matcher(ctx.getText().replaceAll(\"\\\"\", \"\")).matches()) {\n-        diagnosticStorage.addDiagnostic(ctx);\n-      }\n-      isTypeMethod = false;\n+    BSLParser.DoCallContext found = ctx.doCall();\n+\n+    if (found == null) return super.visitGlobalMethodCall(ctx);\n+\n+    BSLParser.CallParamListContext callCtx = found.getChild(BSLParser.CallParamListContext.class, 0);\n+\n+    if (callCtx == null) return super.visitGlobalMethodCall(ctx);", "originalCommit": "c362e43d21ce669e8fc4bd4ab7ab48ab4d8b1789", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDUzMjQ5Mg==", "url": "https://github.com/1c-syntax/bsl-language-server/pull/923#discussion_r374532492", "bodyText": "Done", "author": "EightM", "createdAt": "2020-02-04T08:33:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDE4ODMzMA=="}], "type": "inlineReview"}, {"oid": "ef007d18df9d2ccf55924b338239bfe8b65b68e3", "url": "https://github.com/1c-syntax/bsl-language-server/commit/ef007d18df9d2ccf55924b338239bfe8b65b68e3", "message": "Merge branch 'develop' of https://github.com/1c-syntax/bsl-language-server into RefactorDeprecatedType", "committedDate": "2020-02-04T08:31:05Z", "type": "commit"}, {"oid": "864f58c14165db25915474016a10f40cefa18884", "url": "https://github.com/1c-syntax/bsl-language-server/commit/864f58c14165db25915474016a10f40cefa18884", "message": "\u0418\u0441\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0437\u0430\u043c\u0435\u0447\u0430\u043d\u0438\u0439 \u043f\u043e \u0440\u0435\u0432\u044c\u044e", "committedDate": "2020-02-04T08:32:35Z", "type": "commit"}]}