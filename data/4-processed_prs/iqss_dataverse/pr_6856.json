{"pr_number": 6856, "pr_title": "6741 add data render logic", "pr_createdAt": "2020-04-24T19:26:01Z", "pr_url": "https://github.com/IQSS/dataverse/pull/6856", "timeline": [{"oid": "861f873f332246ae1966568aad22f4b2c3696131", "url": "https://github.com/IQSS/dataverse/commit/861f873f332246ae1966568aad22f4b2c3696131", "message": "Merge branch 'develop' into 6741-add-data-render-logic", "committedDate": "2020-04-23T17:41:45Z", "type": "commit"}, {"oid": "e8d2bf2edb875d1e695f08c230c421f7518cde9d", "url": "https://github.com/IQSS/dataverse/commit/e8d2bf2edb875d1e695f08c230c421f7518cde9d", "message": "#6741 restrict Add Data in header", "committedDate": "2020-04-24T19:04:52Z", "type": "commit"}, {"oid": "a460b80a319b7c21ced6ca56840f89ed978d5db6", "url": "https://github.com/IQSS/dataverse/commit/a460b80a319b7c21ced6ca56840f89ed978d5db6", "message": "#6741 remove unused script", "committedDate": "2020-04-24T19:27:35Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDgxMTU3NQ==", "url": "https://github.com/IQSS/dataverse/pull/6856#discussion_r414811575", "bodyText": "Is this code just for debugging?", "author": "pdurbin", "createdAt": "2020-04-24T19:27:37Z", "path": "src/main/webapp/dataverse_header.xhtml", "diffHunk": "@@ -189,6 +211,11 @@\n                 </div>\n             </div>\n         </noscript>\n+        <script>\n+function a () {\n+var contact = prompt(\"Add the contact.\");\n+}", "originalCommit": "e8d2bf2edb875d1e695f08c230c421f7518cde9d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDgxMzY5Nw==", "url": "https://github.com/IQSS/dataverse/pull/6856#discussion_r414813697", "bodyText": "Yes. I have removed it", "author": "sekmiller", "createdAt": "2020-04-24T19:31:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDgxMTU3NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDgxNzgzMQ==", "url": "https://github.com/IQSS/dataverse/pull/6856#discussion_r414817831", "bodyText": "Whoops. Sorry. I didn't mean to include that in my review. I saw you had already deleted it. I forgot to go back and delete the comment.", "author": "pdurbin", "createdAt": "2020-04-24T19:39:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDgxMTU3NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTgwNDAxOQ==", "url": "https://github.com/IQSS/dataverse/pull/6856#discussion_r415804019", "bodyText": "The render logic in these duplicate ui:fragment components should consolidated and moved directly into the li components like other navbar features on this page <li jsf:rendered=\"#{...}\"> (line 88).", "author": "mheppler", "createdAt": "2020-04-27T13:17:35Z", "path": "src/main/webapp/dataverse_header.xhtml", "diffHunk": "@@ -31,21 +39,35 @@\n                 </div>\n                 <div class=\"collapse navbar-collapse\" id=\"topNavBar\">\n                     <ul class=\"nav navbar-nav navbar-right\">\n-                        <li class=\"dropdown\">\n-                            <a href=\"#\" class=\"dropdown-toggle\" data-toggle=\"dropdown\">#{bundle['dataverse.results.btn.addData']} <b class=\"caret\"></b></a>\n-                            <ul class=\"dropdown-menu\">\n-                                <li>\n-                                    <h:outputLink value=\"/dataverse.xhtml?ownerId=#{dataverseServiceBean.findRootDataverse().id}\">\n-                                        <h:outputText value=\"#{bundle['dataverse.results.btn.addData.newDataverse']}\"/>\n-                                    </h:outputLink>\n-                                </li>\n-                                <li>\n-                                    <h:outputLink value=\"/dataset.xhtml?ownerId=#{dataverseServiceBean.findRootDataverse().id}\">\n-                                        <h:outputText value=\"#{bundle['dataverse.results.btn.addData.newDataset']}\"/>\n-                                    </h:outputLink>\n+                        <ui:fragment rendered=\"#{showAddDataGroup}\">", "originalCommit": "a460b80a319b7c21ced6ca56840f89ed978d5db6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTg5NjY3NA==", "url": "https://github.com/IQSS/dataverse/pull/6856#discussion_r415896674", "bodyText": "as requested I removed the ui:fragments and moved the render logic to jsf:rendered.", "author": "sekmiller", "createdAt": "2020-04-27T15:10:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTgwNDAxOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTgwNTEzMw==", "url": "https://github.com/IQSS/dataverse/pull/6856#discussion_r415805133", "bodyText": "Same render logic moved into the li here as suggested above.", "author": "mheppler", "createdAt": "2020-04-27T13:18:59Z", "path": "src/main/webapp/dataverse_header.xhtml", "diffHunk": "@@ -31,21 +39,35 @@\n                 </div>\n                 <div class=\"collapse navbar-collapse\" id=\"topNavBar\">\n                     <ul class=\"nav navbar-nav navbar-right\">\n-                        <li class=\"dropdown\">\n-                            <a href=\"#\" class=\"dropdown-toggle\" data-toggle=\"dropdown\">#{bundle['dataverse.results.btn.addData']} <b class=\"caret\"></b></a>\n-                            <ul class=\"dropdown-menu\">\n-                                <li>\n-                                    <h:outputLink value=\"/dataverse.xhtml?ownerId=#{dataverseServiceBean.findRootDataverse().id}\">\n-                                        <h:outputText value=\"#{bundle['dataverse.results.btn.addData.newDataverse']}\"/>\n-                                    </h:outputLink>\n-                                </li>\n-                                <li>\n-                                    <h:outputLink value=\"/dataset.xhtml?ownerId=#{dataverseServiceBean.findRootDataverse().id}\">\n-                                        <h:outputText value=\"#{bundle['dataverse.results.btn.addData.newDataset']}\"/>\n-                                    </h:outputLink>\n+                        <ui:fragment rendered=\"#{showAddDataGroup}\">\n+                        <ui:fragment rendered=\"#{!authUserSession}\">\n+                            <li>\n+                                <a href=\"#\" onClick=\"PF('addData_popup').show()\">#{bundle['dataverse.results.btn.addData']} </a>\n+                            </li> \n+                        </ui:fragment>\n+\n+                            <ui:fragment rendered=\"#{authUserSession}\">\n+                                <li class=\"dropdown\">\n+                                    <a href=\"#\" class=\"dropdown-toggle\" data-toggle=\"dropdown\">#{bundle['dataverse.results.btn.addData']} <b class=\"caret\"></b></a>\n+                                    <ul class=\"dropdown-menu\">\n+                                        <ui:fragment rendered=\"#{showAddDataverseLink}\">", "originalCommit": "a460b80a319b7c21ced6ca56840f89ed978d5db6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTgwODYxMg==", "url": "https://github.com/IQSS/dataverse/pull/6856#discussion_r415808612", "bodyText": "This addData_popup reference that was copied over from search-include-fragment will now look for that dialog on every page, but the dataverse pg is the only page that will have the dialog included on it.", "author": "mheppler", "createdAt": "2020-04-27T13:23:37Z", "path": "src/main/webapp/dataverse_header.xhtml", "diffHunk": "@@ -31,21 +39,35 @@\n                 </div>\n                 <div class=\"collapse navbar-collapse\" id=\"topNavBar\">\n                     <ul class=\"nav navbar-nav navbar-right\">\n-                        <li class=\"dropdown\">\n-                            <a href=\"#\" class=\"dropdown-toggle\" data-toggle=\"dropdown\">#{bundle['dataverse.results.btn.addData']} <b class=\"caret\"></b></a>\n-                            <ul class=\"dropdown-menu\">\n-                                <li>\n-                                    <h:outputLink value=\"/dataverse.xhtml?ownerId=#{dataverseServiceBean.findRootDataverse().id}\">\n-                                        <h:outputText value=\"#{bundle['dataverse.results.btn.addData.newDataverse']}\"/>\n-                                    </h:outputLink>\n-                                </li>\n-                                <li>\n-                                    <h:outputLink value=\"/dataset.xhtml?ownerId=#{dataverseServiceBean.findRootDataverse().id}\">\n-                                        <h:outputText value=\"#{bundle['dataverse.results.btn.addData.newDataset']}\"/>\n-                                    </h:outputLink>\n+                        <ui:fragment rendered=\"#{showAddDataGroup}\">\n+                        <ui:fragment rendered=\"#{!authUserSession}\">\n+                            <li>\n+                                <a href=\"#\" onClick=\"PF('addData_popup').show()\">#{bundle['dataverse.results.btn.addData']} </a>", "originalCommit": "a460b80a319b7c21ced6ca56840f89ed978d5db6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTg5NDM1Mw==", "url": "https://github.com/IQSS/dataverse/pull/6856#discussion_r415894353", "bodyText": "I made the add data popup into a fragment and included it in the dataverse template.", "author": "sekmiller", "createdAt": "2020-04-27T15:07:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTgwODYxMg=="}], "type": "inlineReview"}, {"oid": "7b9c999c3449f71d9e3e67d9310ea3c5bd12a035", "url": "https://github.com/IQSS/dataverse/commit/7b9c999c3449f71d9e3e67d9310ea3c5bd12a035", "message": "#6741 address CR suggestions", "committedDate": "2020-04-27T15:05:44Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTkxOTAwMA==", "url": "https://github.com/IQSS/dataverse/pull/6856#discussion_r415919000", "bodyText": "I was wondering what the best way to handle this popup is, and I think this a great solution. \ud83d\udc4d", "author": "mheppler", "createdAt": "2020-04-27T15:36:14Z", "path": "src/main/webapp/dataverse_template.xhtml", "diffHunk": "@@ -79,6 +79,7 @@\n             </f:facet>\n         </p:ajaxStatus>\n         <ui:include src=\"contactFormFragment.xhtml\"></ui:include>\n+        <ui:include src=\"addDataFormFragment.xhtml\"></ui:include>", "originalCommit": "7b9c999c3449f71d9e3e67d9310ea3c5bd12a035", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "bb287377d90a57a61bd0675f4d5323aa7b0bc767", "url": "https://github.com/IQSS/dataverse/commit/bb287377d90a57a61bd0675f4d5323aa7b0bc767", "message": "#6741 Change add data button logic to AuthUser only", "committedDate": "2020-04-27T19:39:14Z", "type": "commit"}, {"oid": "674a240c9e39f32182350ee84588dcf0874b3117", "url": "https://github.com/IQSS/dataverse/commit/674a240c9e39f32182350ee84588dcf0874b3117", "message": "#6741 redirect to login page from Add Data in header\n\n-if the user is not logged in when pressing button", "committedDate": "2020-04-28T18:01:56Z", "type": "commit"}, {"oid": "ff4806046ba0c27d6e0f6ab56349937ffc630221", "url": "https://github.com/IQSS/dataverse/commit/ff4806046ba0c27d6e0f6ab56349937ffc630221", "message": "#6741 move popup include back to search inc frag", "committedDate": "2020-04-28T19:27:37Z", "type": "commit"}]}