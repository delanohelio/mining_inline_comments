{"pr_number": 6921, "pr_title": "#6920 Informative error message for custom metadata block definition.", "pr_createdAt": "2020-05-20T16:48:46Z", "pr_url": "https://github.com/IQSS/dataverse/pull/6921", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODgwMzE0OA==", "url": "https://github.com/IQSS/dataverse/pull/6921#discussion_r428803148", "bodyText": "This test is failing because the test has \"cell\" in the error message while the api uses \"column\". Suggest putting the error message into the Bundle. None of the rest of the endpoints use the bundle because this is a very old api, but we're trying to add new work to the bundle when possible", "author": "sekmiller", "createdAt": "2020-05-21T17:30:46Z", "path": "src/test/java/edu/harvard/iq/dataverse/api/AdminIT.java", "diffHunk": "@@ -671,4 +679,30 @@ public void testMigrateHDLToDOI() {\n                 .statusCode(OK.getStatusCode());\n     }\n \n+    @Test\n+    public void testLoadMetadataBlock_ErrorHandling() {\n+        Response createUser = UtilIT.createRandomUser();\n+        String apiToken = UtilIT.getApiTokenFromResponse(createUser);\n+\n+        byte[] updatedContent = null;\n+        try {\n+            updatedContent = Files.readAllBytes(Paths.get(\"src/test/resources/tsv/test.tsv\"));\n+        } catch (IOException e) {\n+            logger.warning(e.getMessage());\n+            assertEquals(0,1);\n+        }\n+        Response response = UtilIT.loadMetadataBlock(apiToken, updatedContent);\n+        assertEquals(500, response.getStatusCode());\n+        response.then().assertThat().statusCode(INTERNAL_SERVER_ERROR.getStatusCode());\n+\n+        String body = response.getBody().asString();\n+        String status = JsonPath.from(body).getString(\"status\");\n+        assertEquals(\"ERROR\", status);\n+\n+        String message = JsonPath.from(body).getString(\"message\");\n+        assertEquals(\n+          \"Error parsing metadata block in DATASETFIELD part, line #5: missing 'watermark' cell (#5)\",", "originalCommit": "833c83349d8c1e256279fcb57bc5947a2d4a15bd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODgxMzA1OQ==", "url": "https://github.com/IQSS/dataverse/pull/6921#discussion_r428813059", "bodyText": "Oh, and you'll need to get the latest from the develop branch.", "author": "sekmiller", "createdAt": "2020-05-21T17:48:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODgwMzE0OA=="}], "type": "inlineReview"}, {"oid": "aecb7c52a00e9b8ae29bd06aaa70620cd2333c2b", "url": "https://github.com/IQSS/dataverse/commit/aecb7c52a00e9b8ae29bd06aaa70620cd2333c2b", "message": "#6920 Informative error message for custom metadata block definition.", "committedDate": "2020-05-21T20:26:00Z", "type": "commit"}, {"oid": "957ed4e89f2671be389ab87b79956d8f604f301c", "url": "https://github.com/IQSS/dataverse/commit/957ed4e89f2671be389ab87b79956d8f604f301c", "message": "#6920 adding test.tsv file.", "committedDate": "2020-05-21T20:26:00Z", "type": "commit"}, {"oid": "8c331dfd5172f842ac9cd2e462c93371df9561dc", "url": "https://github.com/IQSS/dataverse/commit/8c331dfd5172f842ac9cd2e462c93371df9561dc", "message": "#6920 replacing simple strings to bundles.", "committedDate": "2020-05-21T20:26:00Z", "type": "commit"}, {"oid": "8c331dfd5172f842ac9cd2e462c93371df9561dc", "url": "https://github.com/IQSS/dataverse/commit/8c331dfd5172f842ac9cd2e462c93371df9561dc", "message": "#6920 replacing simple strings to bundles.", "committedDate": "2020-05-21T20:26:00Z", "type": "forcePushed"}, {"oid": "95cac28c56169baf787131eaee4b1a2f1364382b", "url": "https://github.com/IQSS/dataverse/commit/95cac28c56169baf787131eaee4b1a2f1364382b", "message": "#6920 add unit tests for getArrayIndexOutOfBoundMessage() and getGeneralErrorMessage().", "committedDate": "2020-05-22T09:09:58Z", "type": "commit"}, {"oid": "cfd79740667e78a56316031ba6090869b2d284ef", "url": "https://github.com/IQSS/dataverse/commit/cfd79740667e78a56316031ba6090869b2d284ef", "message": "#6920 testing citation.tsv metadata block.", "committedDate": "2020-05-22T12:31:09Z", "type": "commit"}]}