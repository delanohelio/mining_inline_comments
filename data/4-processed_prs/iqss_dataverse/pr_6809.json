{"pr_number": 6809, "pr_title": "6761 payara installer update", "pr_createdAt": "2020-04-10T13:12:28Z", "pr_url": "https://github.com/IQSS/dataverse/pull/6809", "timeline": [{"oid": "b82f54e7a8fb5e0f91d9a29593287bada5afb8bd", "url": "https://github.com/IQSS/dataverse/commit/b82f54e7a8fb5e0f91d9a29593287bada5afb8bd", "message": "Verify that this is a valid Payara installation, and a supported version, from python.\n(ref. #6761)", "committedDate": "2020-04-06T23:24:36Z", "type": "commit"}, {"oid": "53bb0bc978f45239e6d5413daab8cc5782f0d94b", "url": "https://github.com/IQSS/dataverse/commit/53bb0bc978f45239e6d5413daab8cc5782f0d94b", "message": "renamed installGlassfish (#6761)", "committedDate": "2020-04-06T23:28:15Z", "type": "commit"}, {"oid": "67c2c3b7b6c92fdad51e0c3797754e25fa70850e", "url": "https://github.com/IQSS/dataverse/commit/67c2c3b7b6c92fdad51e0c3797754e25fa70850e", "message": "more python installer mods (#6761)", "committedDate": "2020-04-09T13:40:39Z", "type": "commit"}, {"oid": "74d002855c1c13f0bcf2edb935b0dd8619988724", "url": "https://github.com/IQSS/dataverse/commit/74d002855c1c13f0bcf2edb935b0dd8619988724", "message": "Few more installer tweaks from yesterday. #6761", "committedDate": "2020-04-10T13:03:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjgyMzY5NQ==", "url": "https://github.com/IQSS/dataverse/pull/6809#discussion_r406823695", "bodyText": "I'm just noting the conversation about this change at #6812 (comment)", "author": "pdurbin", "createdAt": "2020-04-10T16:02:40Z", "path": "scripts/installer/install.py", "diffHunk": "@@ -229,12 +230,12 @@\n    print(\"Checking for required components...\")\n    # 1a. check to see if warfile is available\n    warfile = \"dataverse.war\"\n-   warfileVersion = None\n+   warfileVersion = \"\"\n    if not os.path.isfile(warfile):\n       # get dataverse version from pom.xml\n       tree = ET.ElementTree(file='../../pom.xml')\n       for elem in tree.iter(\"*\"):\n-         if elem.tag == '{http://maven.apache.org/POM/4.0.0}version':\n+         if elem.tag == '{https://maven.apache.org/POM/4.0.0}version':", "originalCommit": "74d002855c1c13f0bcf2edb935b0dd8619988724", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzQ3NjA1Mw==", "url": "https://github.com/IQSS/dataverse/pull/6809#discussion_r407476053", "bodyText": "This has been fine under Glassfish4 and is fine under Payara5, but installation-main sez\n\nThe installer places files called jhove.conf and jhoveConfig.xsd into the directory /usr/local/glassfish4/glassfish/domains/domain1/config by default and makes adjustments to the jhove.conf file based on the directory into which you chose to install Glassfish.\n\nWe might a) update that to payara5 and b) I don't see logic in the script to adjust the path in jhove.conf; we might note in the docs that the file would need to be edited?", "author": "donsizemore", "createdAt": "2020-04-13T13:24:24Z", "path": "conf/jhove/jhove.conf", "diffHunk": "@@ -3,7 +3,7 @@\n  xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n  xmlns=\"http://hul.harvard.edu/ois/xml/ns/jhove/jhoveConfig\"\n  xsi:schemaLocation=\"http://hul.harvard.edu/ois/xml/ns/jhove/jhoveConfig\n-                     file:///usr/local/glassfish4/glassfish/domains/domain1/config/jhoveConfig.xsd\">\n+                     file:///usr/local/payara5/glassfish/domains/domain1/config/jhoveConfig.xsd\">", "originalCommit": "74d002855c1c13f0bcf2edb935b0dd8619988724", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzQ4MjIyNA==", "url": "https://github.com/IQSS/dataverse/pull/6809#discussion_r407482224", "bodyText": "There's no code in the script that adjusts that path, no. But there's the next best thing in there, a comment:\n# @todo: The JHOVE conf file has an absolute PATH of the JHOVE config schema file (uh, yeah...)\n# - so it may need to be readjusted, if glassfish lives somewhere other than /usr/local/glassfish4\n# (replicate from the old installer)\n\n(it looks like it just slipped through the cracks. will add.)", "author": "landreev", "createdAt": "2020-04-13T13:38:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzQ3NjA1Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzY0MzIyMA==", "url": "https://github.com/IQSS/dataverse/pull/6809#discussion_r407643220", "bodyText": "I almost touched doc/sphinx-guides/source/_static/util/default.config as part of the doc issue I'm working on but stopped after seeing the edit above. There are many copies of default.config (screenshot below) and we should figure out where/when to update them.", "author": "pdurbin", "createdAt": "2020-04-13T18:39:24Z", "path": "scripts/installer/default.config", "diffHunk": "@@ -1,7 +1,7 @@\n [glassfish]\n HOST_DNS_ADDRESS = localhost\n-GLASSFISH_USER = glassfish\n-GLASSFISH_DIRECTORY = /usr/local/glassfish4\n+GLASSFISH_USER = dataverse\n+GLASSFISH_DIRECTORY = /usr/local/payara5", "originalCommit": "74d002855c1c13f0bcf2edb935b0dd8619988724", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzY3OTM4OQ==", "url": "https://github.com/IQSS/dataverse/pull/6809#discussion_r407679389", "bodyText": "Note that these other copies are a different config file. Must be an older style docker config? - the format is different/incompatible with what the python installer is using.\nI should probably rename the new, configparser-style file.", "author": "landreev", "createdAt": "2020-04-13T19:47:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzY0MzIyMA=="}], "type": "inlineReview"}, {"oid": "40076236ae3783929efa4a52e728db5c9cae6c05", "url": "https://github.com/IQSS/dataverse/commit/40076236ae3783929efa4a52e728db5c9cae6c05", "message": "added jsf patch", "committedDate": "2020-04-14T20:04:04Z", "type": "commit"}, {"oid": "ed5a5750b646811b3e63dc9c37abe9364960e786", "url": "https://github.com/IQSS/dataverse/commit/ed5a5750b646811b3e63dc9c37abe9364960e786", "message": "fixed the Makefile for packaging the installer bundle (#6761)", "committedDate": "2020-04-15T20:06:38Z", "type": "commit"}, {"oid": "3b0dcfa8e21d5dc1c32672237d1f9e3c7f3c3e05", "url": "https://github.com/IQSS/dataverse/commit/3b0dcfa8e21d5dc1c32672237d1f9e3c7f3c3e05", "message": "prevent \"Symbol not found\" errors on Mac #6761\n\nSee https://stackoverflow.com/a/58443768/19464", "committedDate": "2020-04-15T21:30:48Z", "type": "commit"}, {"oid": "9bee249e3e8e61ee17645345f1876adea3e9a13c", "url": "https://github.com/IQSS/dataverse/commit/9bee249e3e8e61ee17645345f1876adea3e9a13c", "message": "added the jsf patch to the payara installer (#6761)", "committedDate": "2020-04-15T22:08:42Z", "type": "commit"}, {"oid": "4daa59f7173ce373ec939001e6eaa959c5069034", "url": "https://github.com/IQSS/dataverse/commit/4daa59f7173ce373ec939001e6eaa959c5069034", "message": "added the code to adjust the location of the schema file in the jhove.conf file,\nif payara is installed somewhere other than /usr/local/payara5.  (#6761)", "committedDate": "2020-04-16T00:17:08Z", "type": "commit"}, {"oid": "5a41c1c41bb413abd1a0f18cc591cac25f98cf03", "url": "https://github.com/IQSS/dataverse/commit/5a41c1c41bb413abd1a0f18cc591cac25f98cf03", "message": "Merge pull request #6825 from IQSS/6761-psycopg2\n\nprevent \"Symbol not found\" errors on Mac #6761", "committedDate": "2020-04-16T03:53:09Z", "type": "commit"}, {"oid": "32c2a9cf53577a92fccccac81288b338486c78db", "url": "https://github.com/IQSS/dataverse/commit/32c2a9cf53577a92fccccac81288b338486c78db", "message": "changed the python readme and requirements.txt to use psycopg2-binary as the\nrecommended installation package. (#6761)", "committedDate": "2020-04-16T04:05:13Z", "type": "commit"}, {"oid": "a1d1846bf865a5fdb31074abc2c3ebb51908626a", "url": "https://github.com/IQSS/dataverse/commit/a1d1846bf865a5fdb31074abc2c3ebb51908626a", "message": "got the old installer to work with payara; just in case. (#6761)", "committedDate": "2020-04-17T02:55:21Z", "type": "commit"}, {"oid": "a206e0e1f294b784ab2229be3f62a65ff3819891", "url": "https://github.com/IQSS/dataverse/commit/a206e0e1f294b784ab2229be3f62a65ff3819891", "message": "added the jsf patch to the old installer as well. #6761", "committedDate": "2020-04-17T15:29:52Z", "type": "commit"}, {"oid": "9ad1b97e9c4e4fd3c2cc66db4d9febe2105ffc23", "url": "https://github.com/IQSS/dataverse/commit/9ad1b97e9c4e4fd3c2cc66db4d9febe2105ffc23", "message": "Merge branch 'develop' into 6761-payara-installer-update", "committedDate": "2020-04-17T15:58:01Z", "type": "commit"}, {"oid": "6662d4c1c5c3fe06c7b73dec1ee6947d4a798e09", "url": "https://github.com/IQSS/dataverse/commit/6662d4c1c5c3fe06c7b73dec1ee6947d4a798e09", "message": "(and of course we need to go back to expecting \"http:\" in the pom.xml schema...) #6761", "committedDate": "2020-04-17T16:01:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTQ1NjE1Mg==", "url": "https://github.com/IQSS/dataverse/pull/6809#discussion_r411456152", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            In order to link with the PostgresQL libraries, pip will need to\n          \n          \n            \n            In order to link with the PostgreSQL libraries, pip will need to", "author": "pdurbin", "createdAt": "2020-04-20T15:08:35Z", "path": "scripts/installer/README_python.txt", "diffHunk": "@@ -16,20 +16,28 @@ backward compatibility, for now, but please use version 2.7 or newer.\n \n \n The extra module psycopg2 (PostgreSQL client) is required. The\n-installer has been tested with psycopg2 version 2.8.4.\n+installer has been tested with psycopg2 version 2.8.4. \n \n-Install the module with \n+We recommend that you try installing the \"binary\", pre-built version of the package:\n \n-pip install psycopg2 \n+pip install psycopg2-binary\n \n-(or \"pip3 install psycopg2\" if you intend to use python3 and it's\n+(or \"pip3 install psycopg2-binary\" if you intend to use python3 and it's\n installed separately on your system)\n \n-In order to build the module, pip will need to execute pg_config,\n-PostgreSQL configuration utility. Make sure it is in your PATH. If you\n-have multiple versions of PostgresQL installed, make sure the version\n-that you will be using with Dataverse is the first on your PATH. For\n-example,\n+If for whatever reason the binary psycopg2 package doesn't run\n+properly on your system, you can try the more complex process of\n+making pip build it from sources:\n+\n+pip3 install psycopg2\n+\n+This will require compilers to be properly installed on your system.\n+(On MacOS, you'll need XCode installed). \n+In order to link with the PostgresQL libraries, pip will need to", "originalCommit": "6662d4c1c5c3fe06c7b73dec1ee6947d4a798e09", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTQ1NzI2OA==", "url": "https://github.com/IQSS/dataverse/pull/6809#discussion_r411457268", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            in your PATH. If you have multiple versions of PostgresQL installed,\n          \n          \n            \n            in your PATH. If you have multiple versions of PostgreSQL installed,", "author": "pdurbin", "createdAt": "2020-04-20T15:10:01Z", "path": "scripts/installer/README_python.txt", "diffHunk": "@@ -16,20 +16,28 @@ backward compatibility, for now, but please use version 2.7 or newer.\n \n \n The extra module psycopg2 (PostgreSQL client) is required. The\n-installer has been tested with psycopg2 version 2.8.4.\n+installer has been tested with psycopg2 version 2.8.4. \n \n-Install the module with \n+We recommend that you try installing the \"binary\", pre-built version of the package:\n \n-pip install psycopg2 \n+pip install psycopg2-binary\n \n-(or \"pip3 install psycopg2\" if you intend to use python3 and it's\n+(or \"pip3 install psycopg2-binary\" if you intend to use python3 and it's\n installed separately on your system)\n \n-In order to build the module, pip will need to execute pg_config,\n-PostgreSQL configuration utility. Make sure it is in your PATH. If you\n-have multiple versions of PostgresQL installed, make sure the version\n-that you will be using with Dataverse is the first on your PATH. For\n-example,\n+If for whatever reason the binary psycopg2 package doesn't run\n+properly on your system, you can try the more complex process of\n+making pip build it from sources:\n+\n+pip3 install psycopg2\n+\n+This will require compilers to be properly installed on your system.\n+(On MacOS, you'll need XCode installed). \n+In order to link with the PostgresQL libraries, pip will need to\n+execute pg_config, PostgreSQL configuration utility. Make sure it is\n+in your PATH. If you have multiple versions of PostgresQL installed,", "originalCommit": "6662d4c1c5c3fe06c7b73dec1ee6947d4a798e09", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTU2MTQ2OQ==", "url": "https://github.com/IQSS/dataverse/pull/6809#discussion_r411561469", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            print(\"section of the Installataion guide, on how to configure your Dataverse with the proper registration\")\n          \n          \n            \n            print(\"section of the Installation guide, on how to configure your Dataverse with the proper registration\")", "author": "pdurbin", "createdAt": "2020-04-20T17:31:44Z", "path": "scripts/installer/install.py", "diffHunk": "@@ -616,7 +631,7 @@\n print(\"as the following two JVM options:\")\n print(\"\\t<jvm-options>-Ddoi.username=...</jvm-options>\")\n print(\"\\t<jvm-options>-Ddoi.password=...</jvm-options>\")\n-print(\"and restart glassfish\")\n+print(\"and restart payara\")\n print(\"If this is a production Dataverse and you are planning to register datasets as \")\n print(\"\\\"real\\\", non-test DOIs or Handles, consult the \\\"Persistent Identifiers and Publishing Datasets\\\"\")\n print(\"section of the Installataion guide, on how to configure your Dataverse with the proper registration\")", "originalCommit": "6662d4c1c5c3fe06c7b73dec1ee6947d4a798e09", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "a677da16554c7e70acd7c9df95462947efbdc08e", "url": "https://github.com/IQSS/dataverse/commit/a677da16554c7e70acd7c9df95462947efbdc08e", "message": "script name change in the makefile", "committedDate": "2020-04-20T19:31:03Z", "type": "commit"}]}