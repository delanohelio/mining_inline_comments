{"pr_number": 7363, "pr_title": "add script for rebuilding dev environment #7256", "pr_createdAt": "2020-10-27T21:07:21Z", "pr_url": "https://github.com/IQSS/dataverse/pull/7363", "timeline": [{"oid": "5b5e946917204c7f76893780ed74f1da59122e23", "url": "https://github.com/IQSS/dataverse/commit/5b5e946917204c7f76893780ed74f1da59122e23", "message": "add script for rebuilding dev environment #7256", "committedDate": "2020-10-27T21:02:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDU1MjYyMg==", "url": "https://github.com/IQSS/dataverse/pull/7363#discussion_r514552622", "bodyText": "since you can change this location, can this be determined from the jvm option instead of hardcoded?", "author": "scolapasta", "createdAt": "2020-10-29T20:40:09Z", "path": "scripts/dev/dev-rebuild.sh", "diffHunk": "@@ -0,0 +1,71 @@\n+#!/bin/sh\n+PAYARA_DIR=/usr/local/payara5\n+ASADMIN=$PAYARA_DIR/glassfish/bin/asadmin\n+DB_NAME=dvndb\n+DB_USER=dvnapp\n+\n+echo \"Checking if there is a war file to undeploy...\"\n+LIST_APP=$($ASADMIN list-applications -t)\n+OLD_WAR=$(echo $LIST_APP | awk '{print $1}')\n+NEW_WAR=target/dataverse*.war\n+if [ ! -z $OLD_WAR ]; then\n+  $ASADMIN undeploy $OLD_WAR\n+fi\n+\n+echo \"Stopping app server...\"\n+$ASADMIN stop-domain\n+\n+echo \"Deleting \\\"generated\\\" directory...\"\n+rm -rf $PAYARA_DIR/glassfish/domains/domain1/generated\n+\n+echo \"Deleting ALL DATA FILES uploaded to Dataverse...\" \n+rm -rf $PAYARA_DIR/glassfish/domains/domain1/files", "originalCommit": "5b5e946917204c7f76893780ed74f1da59122e23", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDU1NzM1Ng==", "url": "https://github.com/IQSS/dataverse/pull/7363#discussion_r514557356", "bodyText": "I had that thought, that perhaps some devs keep their data files somewhere other than default (domain1/files). I figured I'd wait until there's demand to make this configurable. We could either add a variable to the top called something like DATA_FILES_DIR or yes, perhaps pull it out from asadmin list-jvm-options.", "author": "pdurbin", "createdAt": "2020-10-29T20:48:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDU1MjYyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDU1ODY2Ng==", "url": "https://github.com/IQSS/dataverse/pull/7363#discussion_r514558666", "bodyText": "OK, I'm fine with pushing that to later. Could you a) add that as a todo comment and b) add a note in the docs to point out that files would have to be in the default location?", "author": "scolapasta", "createdAt": "2020-10-29T20:51:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDU1MjYyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDU2MzIzNQ==", "url": "https://github.com/IQSS/dataverse/pull/7363#discussion_r514563235", "bodyText": "Sure, fixed in ecde956.", "author": "pdurbin", "createdAt": "2020-10-29T20:59:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDU1MjYyMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDU1Mjk5OA==", "url": "https://github.com/IQSS/dataverse/pull/7363#discussion_r514552998", "bodyText": "just because I'm curious, what does this do?", "author": "scolapasta", "createdAt": "2020-10-29T20:40:51Z", "path": "scripts/dev/dev-rebuild.sh", "diffHunk": "@@ -0,0 +1,71 @@\n+#!/bin/sh\n+PAYARA_DIR=/usr/local/payara5\n+ASADMIN=$PAYARA_DIR/glassfish/bin/asadmin\n+DB_NAME=dvndb\n+DB_USER=dvnapp\n+\n+echo \"Checking if there is a war file to undeploy...\"\n+LIST_APP=$($ASADMIN list-applications -t)\n+OLD_WAR=$(echo $LIST_APP | awk '{print $1}')\n+NEW_WAR=target/dataverse*.war\n+if [ ! -z $OLD_WAR ]; then\n+  $ASADMIN undeploy $OLD_WAR\n+fi\n+\n+echo \"Stopping app server...\"\n+$ASADMIN stop-domain\n+\n+echo \"Deleting \\\"generated\\\" directory...\"\n+rm -rf $PAYARA_DIR/glassfish/domains/domain1/generated\n+\n+echo \"Deleting ALL DATA FILES uploaded to Dataverse...\" \n+rm -rf $PAYARA_DIR/glassfish/domains/domain1/files\n+\n+echo \"Terminating database settings so we can drop the database...\"", "originalCommit": "5b5e946917204c7f76893780ed74f1da59122e23", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDU1ODg4MQ==", "url": "https://github.com/IQSS/dataverse/pull/7363#discussion_r514558881", "bodyText": "I'm assuming you mean the pg_terminate_backend stuff. It's just a SQL statement I found online somewhere. I didn't dig into it. In practice, it's sometimes necessary to terminate all sessions because you've got a session or two left over from pgAdmin or a terminal. In my experience, you can drop a database with open sessions.", "author": "pdurbin", "createdAt": "2020-10-29T20:51:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDU1Mjk5OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDU2MTY5Ng==", "url": "https://github.com/IQSS/dataverse/pull/7363#discussion_r514561696", "bodyText": "Ah, makes sense. I was confused by \"Terminating database settings\". I think that's a typo and should be \"sessions\".", "author": "scolapasta", "createdAt": "2020-10-29T20:56:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDU1Mjk5OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDU2NDQyNQ==", "url": "https://github.com/IQSS/dataverse/pull/7363#discussion_r514564425", "bodyText": "Oh, a typo. I meant sessions, not settings. Fixed in d3778f3.", "author": "pdurbin", "createdAt": "2020-10-29T21:02:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDU1Mjk5OA=="}], "type": "inlineReview"}, {"oid": "ecde956db1e822b510d730d19fb9b815956621a7", "url": "https://github.com/IQSS/dataverse/commit/ecde956db1e822b510d730d19fb9b815956621a7", "message": "note that files dir must be the default #7256", "committedDate": "2020-10-29T20:58:43Z", "type": "commit"}, {"oid": "d3778f3600e8284df6950c19f4fc4c3b38c5c7a2", "url": "https://github.com/IQSS/dataverse/commit/d3778f3600e8284df6950c19f4fc4c3b38c5c7a2", "message": "typo #7256", "committedDate": "2020-10-29T21:01:09Z", "type": "commit"}]}