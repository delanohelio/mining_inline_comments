{"pr_number": 7415, "pr_title": "prevent double linking of datasets and dataverses #7259", "pr_createdAt": "2020-11-16T21:23:39Z", "pr_url": "https://github.com/IQSS/dataverse/pull/7415", "timeline": [{"oid": "be999dba03d217410c2d581ac4fbe8a8c33e26a2", "url": "https://github.com/IQSS/dataverse/commit/be999dba03d217410c2d581ac4fbe8a8c33e26a2", "message": "prevent double linking of datasets #7259", "committedDate": "2020-11-16T21:20:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDYwODMyMw==", "url": "https://github.com/IQSS/dataverse/pull/7415#discussion_r524608323", "bodyText": "will this be efficient enough, instead of adding a find method specific for an existing link?", "author": "scolapasta", "createdAt": "2020-11-16T21:31:41Z", "path": "src/main/java/edu/harvard/iq/dataverse/engine/command/impl/LinkDatasetCommand.java", "diffHunk": "@@ -50,6 +52,13 @@ public DatasetLinkingDataverse execute(CommandContext ctxt) throws CommandExcept\n         if (linkedDataset.getOwner().getOwners().contains(linkingDataverse)) {\n             throw new IllegalCommandException(BundleUtil.getStringFromBundle(\"dataset.link.not.to.parent.dataverse\"), this);\n         }\n+        List<Dataverse> existingLinksToDataverses = new ArrayList<>();\n+        for (DatasetLinkingDataverse datasetLinkingDataverse : linkedDataset.getDatasetLinkingDataverses()) {", "originalCommit": "be999dba03d217410c2d581ac4fbe8a8c33e26a2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTUyNTQ2Mg==", "url": "https://github.com/IQSS/dataverse/pull/7415#discussion_r525525462", "bodyText": "@scolapasta and I just discussed this and decided that we'd see how it goes in QA and optimize later if need be.", "author": "pdurbin", "createdAt": "2020-11-17T21:08:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDYwODMyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzE5NzI2Ng==", "url": "https://github.com/IQSS/dataverse/pull/7415#discussion_r527197266", "bodyText": "Good news, I found an alreadyLinked method and switched to it in 109a3d3.", "author": "pdurbin", "createdAt": "2020-11-19T21:04:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDYwODMyMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDYwOTA1Mg==", "url": "https://github.com/IQSS/dataverse/pull/7415#discussion_r524609052", "bodyText": "is this test in the move tests? I see what you mean then - it works, but I wonder if we won't lose track that it's being tested here.", "author": "scolapasta", "createdAt": "2020-11-16T21:32:19Z", "path": "src/test/java/edu/harvard/iq/dataverse/api/MoveIT.java", "diffHunk": "@@ -254,6 +254,12 @@ public void testMoveLinkedDataset() {\n         linkDataset.then().assertThat()\n                 .statusCode(OK.getStatusCode());\n \n+        // A dataset cannot be linked to the same dataverse again.", "originalCommit": "be999dba03d217410c2d581ac4fbe8a8c33e26a2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzE0MTE2MA==", "url": "https://github.com/IQSS/dataverse/pull/7415#discussion_r527141160", "bodyText": "Tests moved to their own class in 6bccd4f.", "author": "pdurbin", "createdAt": "2020-11-19T19:25:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDYwOTA1Mg=="}], "type": "inlineReview"}, {"oid": "6bccd4fbc1455ed79a703232a620c3a684611e09", "url": "https://github.com/IQSS/dataverse/commit/6bccd4fbc1455ed79a703232a620c3a684611e09", "message": "move linking tests to dedicated class #7259", "committedDate": "2020-11-19T19:22:52Z", "type": "commit"}, {"oid": "5d4a3dcc1fa200b16e8d55c1d1c181560d4bda95", "url": "https://github.com/IQSS/dataverse/commit/5d4a3dcc1fa200b16e8d55c1d1c181560d4bda95", "message": "check if dataverse to dataverse links already exist #7259", "committedDate": "2020-11-19T20:48:33Z", "type": "commit"}, {"oid": "109a3d3a1773ad87ff99aa0339f3656e02e70222", "url": "https://github.com/IQSS/dataverse/commit/109a3d3a1773ad87ff99aa0339f3656e02e70222", "message": "switch to alreadyLinked method #7259", "committedDate": "2020-11-19T21:00:09Z", "type": "commit"}, {"oid": "041d4a60a3b8acb0756a7297efd647fd0bb62dc3", "url": "https://github.com/IQSS/dataverse/commit/041d4a60a3b8acb0756a7297efd647fd0bb62dc3", "message": "Merge branch 'develop' into 7259-linking #7259", "committedDate": "2020-11-19T21:05:35Z", "type": "commit"}, {"oid": "403a96644f94340b5221bb582970e98e660c0f34", "url": "https://github.com/IQSS/dataverse/commit/403a96644f94340b5221bb582970e98e660c0f34", "message": "add tests for linking levels of dataverses #7430 #7259", "committedDate": "2020-11-20T17:38:46Z", "type": "commit"}]}