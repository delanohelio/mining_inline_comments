{"pr_number": 7396, "pr_title": "recommend RHEL/CentOS 8, update docker-aio", "pr_createdAt": "2020-11-05T16:10:57Z", "pr_url": "https://github.com/IQSS/dataverse/pull/7396", "timeline": [{"oid": "119c0bc0f89f42cd2b4c60d30923196cb508939e", "url": "https://github.com/IQSS/dataverse/commit/119c0bc0f89f42cd2b4c60d30923196cb508939e", "message": "#7394 recommend RHEL/CentOS 8", "committedDate": "2020-11-05T16:08:04Z", "type": "commit"}, {"oid": "5c0fb2feb680c502109d79bdf8b53eb5d94ac0e2", "url": "https://github.com/IQSS/dataverse/commit/5c0fb2feb680c502109d79bdf8b53eb5d94ac0e2", "message": "#7384 point docker-aio, docker-dcm, openshift, and vagrant at CentOS 8", "committedDate": "2020-11-05T20:19:27Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODM1NDMwMQ==", "url": "https://github.com/IQSS/dataverse/pull/7396#discussion_r518354301", "bodyText": "Whoops! I thought I had removed this openshift.json file back when I deleted OpenShift stuff in e72ba3c. I say we remove this file too, either in this pull request or in a future one. We aren't using it. We aren't maintaining it.", "author": "pdurbin", "createdAt": "2020-11-05T20:46:49Z", "path": "conf/openshift/openshift.json", "diffHunk": "@@ -150,10 +150,10 @@\n       \"kind\": \"ImageStream\",\n       \"apiVersion\": \"v1\",\n       \"metadata\": {\n-        \"name\": \"centos-postgresql-94-centos7\"\n+        \"name\": \"centos-postgresql-10-centos8\"", "originalCommit": "5c0fb2feb680c502109d79bdf8b53eb5d94ac0e2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAzNjI5MA==", "url": "https://github.com/IQSS/dataverse/pull/7396#discussion_r520036290", "bodyText": "removed in 28d38c3", "author": "donsizemore", "createdAt": "2020-11-09T18:45:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODM1NDMwMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODM1Njc3MQ==", "url": "https://github.com/IQSS/dataverse/pull/7396#discussion_r518356771", "bodyText": "I asked for a review from @pameyer because I remember him talking about how he's still on CentOS 6. But this was a while back. https://github.com/sbgrid/data-capture-module/blob/0.6/doc/installation.md mentions CentOS 6 and 7, not 8.", "author": "pdurbin", "createdAt": "2020-11-05T20:51:28Z", "path": "conf/docker-dcm/dcmsrv.dockerfile", "diffHunk": "@@ -1,5 +1,5 @@\n # build from repo root\n-FROM centos:6\n+FROM centos:8", "originalCommit": "5c0fb2feb680c502109d79bdf8b53eb5d94ac0e2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTAxNTY4Mg==", "url": "https://github.com/IQSS/dataverse/pull/7396#discussion_r519015682", "bodyText": "It might make more sense to leave use centos:7 here - the DCM server side stuff is tested on that OS, but I haven't tested with Cent8 yet.  I don't expect any issues, but that's different from knowing that it works.", "author": "pameyer", "createdAt": "2020-11-06T21:32:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODM1Njc3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDYyNTMwOQ==", "url": "https://github.com/IQSS/dataverse/pull/7396#discussion_r520625309", "bodyText": "I reverted it back to CentOS 6. I don't want to retest DCM stuff.", "author": "pdurbin", "createdAt": "2020-11-10T14:55:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODM1Njc3MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODM1ODc3OA==", "url": "https://github.com/IQSS/dataverse/pull/7396#discussion_r518358778", "bodyText": "We don't use this anymore? I assume it's being deleted on purpose. \ud83d\ude04", "author": "pdurbin", "createdAt": "2020-11-05T20:55:14Z", "path": "tests/jenkins/groupvars.yml", "diffHunk": "@@ -1,163 +0,0 @@\n----\n-# dataverse/defaults/main.yml", "originalCommit": "5c0fb2feb680c502109d79bdf8b53eb5d94ac0e2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODk1NzkwNg==", "url": "https://github.com/IQSS/dataverse/pull/7396#discussion_r518957906", "bodyText": "I was having to submit a PR and wait on the review process each time someone requested a new feature and accompanying group_var in dataverse-ansible. Since this file only applied beneath the dataverse-ansible role, I moved it there. Let me know if this should be removed in a separate issue.", "author": "donsizemore", "createdAt": "2020-11-06T19:25:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODM1ODc3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDYyNTczNg==", "url": "https://github.com/IQSS/dataverse/pull/7396#discussion_r520625736", "bodyText": "No, it's fine. Thanks.", "author": "pdurbin", "createdAt": "2020-11-10T14:56:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODM1ODc3OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODM2MDExOA==", "url": "https://github.com/IQSS/dataverse/pull/7396#discussion_r518360118", "bodyText": "Mental note: Vagrant was already upgraded to CentOS 8 in pull request #7153 (also by @donsizemore , thank you!).", "author": "pdurbin", "createdAt": "2020-11-05T20:57:54Z", "path": "conf/vagrant/etc/yum.repos.d/shibboleth.repo", "diffHunk": "@@ -1,7 +1,7 @@\n [security_shibboleth]\n-name=Shibboleth (CentOS_CentOS-6)\n+name=Shibboleth (CentOS_8)", "originalCommit": "5c0fb2feb680c502109d79bdf8b53eb5d94ac0e2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODM3NTU5NA==", "url": "https://github.com/IQSS/dataverse/pull/7396#discussion_r518375594", "bodyText": "Since we're creating this new c8.dockerfile, should we go ahead and delete the c7.dockerfile in this directory?", "author": "pdurbin", "createdAt": "2020-11-05T21:21:13Z", "path": "conf/docker-aio/c8.dockerfile", "diffHunk": "@@ -0,0 +1,82 @@\n+FROM centos:8", "originalCommit": "5c0fb2feb680c502109d79bdf8b53eb5d94ac0e2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTAyMjA2Mg==", "url": "https://github.com/IQSS/dataverse/pull/7396#discussion_r519022062", "bodyText": "It might be useful for testing on cent7 and cent8; but that's probably better handled through dataverse-ansible.", "author": "pameyer", "createdAt": "2020-11-06T21:48:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODM3NTU5NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDYyMzQ3NA==", "url": "https://github.com/IQSS/dataverse/pull/7396#discussion_r520623474", "bodyText": "I removed the old one. We can always pull it out of git history if we need it.", "author": "pdurbin", "createdAt": "2020-11-10T14:53:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODM3NTU5NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODM3NjUxNA==", "url": "https://github.com/IQSS/dataverse/pull/7396#discussion_r518376514", "bodyText": "Should we delete c6client.dockerfile since we're adding c8client.dockerfile?", "author": "pdurbin", "createdAt": "2020-11-05T21:23:05Z", "path": "conf/docker-dcm/c8client.dockerfile", "diffHunk": "@@ -0,0 +1,7 @@\n+# build from repo root", "originalCommit": "5c0fb2feb680c502109d79bdf8b53eb5d94ac0e2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTAxNTMyMQ==", "url": "https://github.com/IQSS/dataverse/pull/7396#discussion_r519015321", "bodyText": "Probably - seems like it's less confusing to have two copies.", "author": "pameyer", "createdAt": "2020-11-06T21:31:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODM3NjUxNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDYyNjIwNQ==", "url": "https://github.com/IQSS/dataverse/pull/7396#discussion_r520626205", "bodyText": "In the end we decided to stick with the older, already tested version of CentOS for DCM stuff.", "author": "pdurbin", "createdAt": "2020-11-10T14:56:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODM3NjUxNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODM4MTcyNw==", "url": "https://github.com/IQSS/dataverse/pull/7396#discussion_r518381727", "bodyText": "Just a comment that it's sad to see \"the steps below were orginally[sic] written for el6\" in here. I'm not sure if the steps need to be rewritten or not. People would probably complain if they don't work. Maybe we should rewrite this line.", "author": "pdurbin", "createdAt": "2020-11-05T21:33:44Z", "path": "doc/sphinx-guides/source/installation/prerequisites.rst", "diffHunk": "@@ -14,7 +14,7 @@ After following all the steps below, you can proceed to the :doc:`installation-m\n Linux\n -----\n \n-We assume you plan to run Dataverse on Linux and we recommend RHEL/CentOS, which is the Linux distribution tested by the Dataverse development team. Please be aware that while el7 (RHEL/CentOS 7) is the recommended platform, the steps below were orginally written for el6 and may need to be updated (please feel free to make a pull request!).\n+We assume you plan to run Dataverse on Linux and we recommend RHEL/CentOS, which is the Linux distribution tested by the Dataverse development team. Please be aware that while el8 (RHEL/CentOS 8) is the recommended platform, the steps below were orginally written for el6 and may need to be updated (please feel free to make a pull request!).", "originalCommit": "5c0fb2feb680c502109d79bdf8b53eb5d94ac0e2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODM4NjAzMw==", "url": "https://github.com/IQSS/dataverse/pull/7396#discussion_r518386033", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            For RHEL/CentOS, the EPEL distribution is strongly recommended::\n          \n          \n            \n            For RHEL/CentOS, the EPEL distribution is strongly recommended:\n          \n      \n    \n    \n  \n\nTo avoid this error:\n/Users/pdurbin/github/iqss/guides.dataverse.org/doc/sphinx-guides/source/installation/prerequisites.rst:331: WARNING: Literal block expected; none found.\nIt's the double :: that's causing trouble. Removing one fixes it. You could change the remaining colon to a period. Probably looks better.", "author": "pdurbin", "createdAt": "2020-11-05T21:41:37Z", "path": "doc/sphinx-guides/source/installation/prerequisites.rst", "diffHunk": "@@ -322,27 +322,35 @@ components and libraries. Please consult the instructions in the\n Installing R\n ============\n \n-Can be installed with :fixedwidthplain:`yum`::\n+For RHEL/CentOS, the EPEL distribution is strongly recommended::", "originalCommit": "5c0fb2feb680c502109d79bdf8b53eb5d94ac0e2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODM4NzQyNQ==", "url": "https://github.com/IQSS/dataverse/pull/7396#discussion_r518387425", "bodyText": "I'm new to CodeReady-Builder. Is it an alternative to EPEL?", "author": "pdurbin", "createdAt": "2020-11-05T21:44:22Z", "path": "doc/sphinx-guides/source/installation/prerequisites.rst", "diffHunk": "@@ -322,27 +322,35 @@ components and libraries. Please consult the instructions in the\n Installing R\n ============\n \n-Can be installed with :fixedwidthplain:`yum`::\n+For RHEL/CentOS, the EPEL distribution is strongly recommended::\n \n-       yum install R-core R-core-devel\n+If :fixedwidthplain:`yum` isn't configured to use EPEL repositories ( https://fedoraproject.org/wiki/EPEL ):\n \n-EPEL distribution is strongly recommended. The version of R currently available from epel6 and epel7 is 3.5; it has been tested and is known to work on RedHat and CentOS versions 6 and 7.\n+RHEL/CentOS 8 users can install the epel-release RPM::\n \n-If :fixedwidthplain:`yum` isn't configured to use EPEL repositories ( https://fedoraproject.org/wiki/EPEL ):\n+       yum install https://dl.fedoraproject.org/pub/epel/epel-release-latest-8.noarch.rpm\n \n-RHEL/CentOS users can install the RPM :fixedwidthplain:`epel-release`. For RHEL/CentOS 7::\n+RHEL/CentOS 7 users can install the epel-release RPM::\n \n        yum install https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm\n \n-RHEL/CentOS users can install the RPM :fixedwidthplain:`epel-release`. For RHEL/CentOS 6::\n+RHEL 8 users will need to enable the CodeReady-Builder repository::\n+\n+       subscription-manager repos --enable codeready-builder-for-rhel-8-x86_64-rpms", "originalCommit": "5c0fb2feb680c502109d79bdf8b53eb5d94ac0e2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODM4ODUzOA==", "url": "https://github.com/IQSS/dataverse/pull/7396#discussion_r518388538", "bodyText": "I'm new to PowerTools as well. I'm starting to worry that there are a lot of steps here. Is it possible to simplify it, at least in how it's described at the top as \"You're going to enable EPEL and then install a package called R-core-devel.\" Or the extra things, PowerTools and CodeReady-Builder really necessary?", "author": "pdurbin", "createdAt": "2020-11-05T21:46:19Z", "path": "doc/sphinx-guides/source/installation/prerequisites.rst", "diffHunk": "@@ -322,27 +322,35 @@ components and libraries. Please consult the instructions in the\n Installing R\n ============\n \n-Can be installed with :fixedwidthplain:`yum`::\n+For RHEL/CentOS, the EPEL distribution is strongly recommended::\n \n-       yum install R-core R-core-devel\n+If :fixedwidthplain:`yum` isn't configured to use EPEL repositories ( https://fedoraproject.org/wiki/EPEL ):\n \n-EPEL distribution is strongly recommended. The version of R currently available from epel6 and epel7 is 3.5; it has been tested and is known to work on RedHat and CentOS versions 6 and 7.\n+RHEL/CentOS 8 users can install the epel-release RPM::\n \n-If :fixedwidthplain:`yum` isn't configured to use EPEL repositories ( https://fedoraproject.org/wiki/EPEL ):\n+       yum install https://dl.fedoraproject.org/pub/epel/epel-release-latest-8.noarch.rpm\n \n-RHEL/CentOS users can install the RPM :fixedwidthplain:`epel-release`. For RHEL/CentOS 7::\n+RHEL/CentOS 7 users can install the epel-release RPM::\n \n        yum install https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm\n \n-RHEL/CentOS users can install the RPM :fixedwidthplain:`epel-release`. For RHEL/CentOS 6::\n+RHEL 8 users will need to enable the CodeReady-Builder repository::\n+\n+       subscription-manager repos --enable codeready-builder-for-rhel-8-x86_64-rpms\n \n-       yum install https://dl.fedoraproject.org/pub/epel/epel-release-latest-6.noarch.rpm\n+CentOS 8 users will need to enable the PowerTools repository::\n \n-RHEL users will want to log in to their organization's respective RHN interface, find the particular machine in question and:\n+       dnf config-manager --enable PowerTools", "originalCommit": "5c0fb2feb680c502109d79bdf8b53eb5d94ac0e2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODk1NjgxOQ==", "url": "https://github.com/IQSS/dataverse/pull/7396#discussion_r518956819", "bodyText": "yes, the R portion became a bit of a choose-your-own adventure, but to my knowledge these are the necessary steps. I forget the additional dependencies provided by each repo. I can write a friendlier introductory paragraph if you'd like (but first let me comment out these steps in dataverse-ansible to verify that they're still needed).", "author": "donsizemore", "createdAt": "2020-11-06T19:23:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODM4ODUzOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAzMjYwOQ==", "url": "https://github.com/IQSS/dataverse/pull/7396#discussion_r520032609", "bodyText": "Yes, we still need these repos: Depsolve Error occured: \\n Problem: conflicting requests\\n  - nothing provides openblas-devel needed by R-core-devel-4.0.3-1.el8.x86_64\\n  - nothing provides texinfo-tex needed by R-core-devel-4.0.3-1.el8.x86_64", "author": "donsizemore", "createdAt": "2020-11-09T18:38:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODM4ODUzOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTAxODExNg==", "url": "https://github.com/IQSS/dataverse/pull/7396#discussion_r519018116", "bodyText": "This might also be better left at centos:7 (server-side component hasn't been tested on cent8).", "author": "pameyer", "createdAt": "2020-11-06T21:38:40Z", "path": "conf/docker-dcm/rsalsrv.dockerfile", "diffHunk": "@@ -1,4 +1,4 @@\n-FROM centos:7\n+FROM centos:8", "originalCommit": "5c0fb2feb680c502109d79bdf8b53eb5d94ac0e2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDYyNjY1OQ==", "url": "https://github.com/IQSS/dataverse/pull/7396#discussion_r520626659", "bodyText": "Reverted. Thanks.", "author": "pdurbin", "createdAt": "2020-11-10T14:57:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTAxODExNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTAyMjkwMg==", "url": "https://github.com/IQSS/dataverse/pull/7396#discussion_r519022902", "bodyText": "updating prep_it.bash with the corresponding change is probably also helpful.", "author": "pameyer", "createdAt": "2020-11-06T21:50:14Z", "path": "conf/docker-aio/readme.md", "diffHunk": "@@ -27,7 +27,7 @@ Also usable for normal development and system evaluation; not intended for produ\n #### Setup\n \n - `cd conf/docker-aio`, and run `./1prep.sh` to copy files for integration test data into docker build context; `1prep.sh` will also build the war file and installation zip file\n-- build the docker image: `docker build -t dv0 -f c7.dockerfile .`\n+- build the docker image: `docker build -t dv0 -f c8.dockerfile .`", "originalCommit": "5c0fb2feb680c502109d79bdf8b53eb5d94ac0e2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDYyMjkxNQ==", "url": "https://github.com/IQSS/dataverse/pull/7396#discussion_r520622915", "bodyText": "Thanks, fixed in 7f90961.", "author": "pdurbin", "createdAt": "2020-11-10T14:52:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTAyMjkwMg=="}], "type": "inlineReview"}, {"oid": "28d38c3a11ef41f738369100c9dc34afc69e77b9", "url": "https://github.com/IQSS/dataverse/commit/28d38c3a11ef41f738369100c9dc34afc69e77b9", "message": "#7394 remove conf/openshift/openshift.json per @pdurbin", "committedDate": "2020-11-09T18:44:32Z", "type": "commit"}, {"oid": "7f90961db7a1c16fb3562c97552b94463ce9c57d", "url": "https://github.com/IQSS/dataverse/commit/7f90961db7a1c16fb3562c97552b94463ce9c57d", "message": "use centos 8 image #7394", "committedDate": "2020-11-09T20:45:13Z", "type": "commit"}, {"oid": "c7fc7c29fae8f9370769fbd2b9c1b598d21f3800", "url": "https://github.com/IQSS/dataverse/commit/c7fc7c29fae8f9370769fbd2b9c1b598d21f3800", "message": "remove old centos 7 docker-aio file #7394\n\nWe upgraded to centos 8", "committedDate": "2020-11-09T20:47:22Z", "type": "commit"}, {"oid": "5814985cc250097e041cf7dfa9154f926ad9b89e", "url": "https://github.com/IQSS/dataverse/commit/5814985cc250097e041cf7dfa9154f926ad9b89e", "message": "revert docker-dcm stuff to pre centos 8 #7394\n\nWe don't want to test all this stuff at this time. Just put it back to\nhow it was.", "committedDate": "2020-11-09T20:49:40Z", "type": "commit"}, {"oid": "444bff044a51f1eefee037285f25fd5a1e21a224", "url": "https://github.com/IQSS/dataverse/commit/444bff044a51f1eefee037285f25fd5a1e21a224", "message": "Merge pull request #58 from IQSS/7394-centos8\n\n7394 centos8", "committedDate": "2020-11-10T00:20:02Z", "type": "commit"}]}