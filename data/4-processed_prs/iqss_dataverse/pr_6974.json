{"pr_number": 6974, "pr_title": "6936 Implement email domain based groups", "pr_createdAt": "2020-06-10T09:15:35Z", "pr_url": "https://github.com/IQSS/dataverse/pull/6974", "timeline": [{"oid": "9673e820ba300f3b5ee88760f0a13934dfb90627", "url": "https://github.com/IQSS/dataverse/commit/9673e820ba300f3b5ee88760f0a13934dfb90627", "message": "Refactor ConfirmEmailService to offer verification checking and start to use in some places. #6936", "committedDate": "2020-06-10T08:45:09Z", "type": "commit"}, {"oid": "45cb9a7cacd12fd47a15e937fb4731eb992e0962", "url": "https://github.com/IQSS/dataverse/commit/45cb9a7cacd12fd47a15e937fb4731eb992e0962", "message": "Add a very basic first implementation of the mail domain group infrastructure. Still lacking tests, API endpoints etc. #6936", "committedDate": "2020-06-10T08:45:09Z", "type": "commit"}, {"oid": "1a6b6807da458f15e3cb20dde91f919d93789faa", "url": "https://github.com/IQSS/dataverse/commit/1a6b6807da458f15e3cb20dde91f919d93789faa", "message": "Make domain comparison use lowercase. Add some more JavaDocs. #6936", "committedDate": "2020-06-10T08:45:09Z", "type": "commit"}, {"oid": "0d7379c05db3a1f8f7d1240de5bc0ccc8ad73a95", "url": "https://github.com/IQSS/dataverse/commit/0d7379c05db3a1f8f7d1240de5bc0ccc8ad73a95", "message": "Add tests for MailDomainGroup and MailDomainGroupProvider. #6936", "committedDate": "2020-06-10T08:45:09Z", "type": "commit"}, {"oid": "39075d93b943d7dadf6ddc62f85cb620530c4550", "url": "https://github.com/IQSS/dataverse/commit/39075d93b943d7dadf6ddc62f85cb620530c4550", "message": "Add generator for MailDomainGroups during testing. #6936", "committedDate": "2020-06-10T08:45:09Z", "type": "commit"}, {"oid": "fa2a5446767ecf19be2bfae08e37f6470c3700c1", "url": "https://github.com/IQSS/dataverse/commit/fa2a5446767ecf19be2bfae08e37f6470c3700c1", "message": "Make MailDomainGroupServiceBean more testable by making the mail bisection function static. #6936", "committedDate": "2020-06-10T08:45:09Z", "type": "commit"}, {"oid": "1b5e0e1b05fd3b395d01a48e8e0119435bce61ea", "url": "https://github.com/IQSS/dataverse/commit/1b5e0e1b05fd3b395d01a48e8e0119435bce61ea", "message": "Add test for MailDomainGroupServiceBean and fix error when filtering matching entries. #6936", "committedDate": "2020-06-10T08:45:09Z", "type": "commit"}, {"oid": "69a485fb105ecc6d6fefe8fe9e66e11c0008c05c", "url": "https://github.com/IQSS/dataverse/commit/69a485fb105ecc6d6fefe8fe9e66e11c0008c05c", "message": "Wire the new mail domain group in the GroupServiceBean, so it will be included in group searches. #6936", "committedDate": "2020-06-10T08:45:09Z", "type": "commit"}, {"oid": "8d2b9cb202159aba66e3bf4ae6e16d718e7184fc", "url": "https://github.com/IQSS/dataverse/commit/8d2b9cb202159aba66e3bf4ae6e16d718e7184fc", "message": "Make MailDomainGroup and its test usable from other packages (for JSON parsing/printing). #6936", "committedDate": "2020-06-10T08:45:09Z", "type": "commit"}, {"oid": "8aaab6110125bac89abff420e1bc0bedeb2e35d0", "url": "https://github.com/IQSS/dataverse/commit/8aaab6110125bac89abff420e1bc0bedeb2e35d0", "message": "Add JSON parser and printer for MailDomainGroup, to be used for REST API endpoints. #6936", "committedDate": "2020-06-10T08:46:26Z", "type": "commit"}, {"oid": "dc0da65275a8b0acb908f175e07d0f42eaf6fb8c", "url": "https://github.com/IQSS/dataverse/commit/dc0da65275a8b0acb908f175e07d0f42eaf6fb8c", "message": "Add persistence handling to create and update MailDomainGroups to the service and entity layer. #6936", "committedDate": "2020-06-10T08:46:28Z", "type": "commit"}, {"oid": "7c72ed52e71dd62da378d7318e5c484ff73ff909", "url": "https://github.com/IQSS/dataverse/commit/7c72ed52e71dd62da378d7318e5c484ff73ff909", "message": "Add first REST endpoints to get, create and update MailDomainGroups. Lacking deletion support. #6936", "committedDate": "2020-06-10T08:46:28Z", "type": "commit"}, {"oid": "694ee50602010376de0a7a0fa7ed953ffd50be3c", "url": "https://github.com/IQSS/dataverse/commit/694ee50602010376de0a7a0fa7ed953ffd50be3c", "message": "Extend exception handling at REST endpoints. Does now provide a catch-all for exceptions, support JsonParseExceptions and JPA ConstraintViolationExceptions. Relates to #3423 and #6936.", "committedDate": "2020-06-10T08:46:28Z", "type": "commit"}, {"oid": "389324bad3d78bce16cf9135eff2b9fa11677dc7", "url": "https://github.com/IQSS/dataverse/commit/389324bad3d78bce16cf9135eff2b9fa11677dc7", "message": "Remove try-catch-boilerplate for mail domain group creation by using the extended exception handling. #6936", "committedDate": "2020-06-10T08:46:28Z", "type": "commit"}, {"oid": "09c7f64b0eab4f9d592868748ec9747d58aa962c", "url": "https://github.com/IQSS/dataverse/commit/09c7f64b0eab4f9d592868748ec9747d58aa962c", "message": "Make JsonParser fail on empty (maybe filtered invalid) domains array of MailDomainGroup. #6936", "committedDate": "2020-06-10T08:46:28Z", "type": "commit"}, {"oid": "bd0f68586c649966837e3199ad12c3624b431d5a", "url": "https://github.com/IQSS/dataverse/commit/bd0f68586c649966837e3199ad12c3624b431d5a", "message": "Add deletion endpoint for MailDomainGroup and make consistent use of group alias as the identifier everywhere. #6936", "committedDate": "2020-06-10T08:46:28Z", "type": "commit"}, {"oid": "6b6578888e9157563260b3fb674489806187e346", "url": "https://github.com/IQSS/dataverse/commit/6b6578888e9157563260b3fb674489806187e346", "message": "Add db migration for MailDomainGroups as PersistedGlobalGroup uses SINGLE_TABLE inheritance strategy. #6936", "committedDate": "2020-06-15T14:01:06Z", "type": "commit"}, {"oid": "76ae9278b3e9e3b860c2a1af97f449a764252dc5", "url": "https://github.com/IQSS/dataverse/commit/76ae9278b3e9e3b860c2a1af97f449a764252dc5", "message": "Add docs for mail domain groups only, without refactoring to a groups page. #6936", "committedDate": "2020-06-15T16:16:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMzNTU3NA==", "url": "https://github.com/IQSS/dataverse/pull/6974#discussion_r440335574", "bodyText": "Somebody else here has pointed out that there is a connection with issue #3438; in a sense that, if we rely on users having verified emails for the purposes of group membership, not being able to verify it becomes more of an issue.\nSince you have been using these email groups in production, have you done anything to address #3438? (one possible solutions appear to be to just always show this button below - ?)", "author": "landreev", "createdAt": "2020-06-15T17:32:13Z", "path": "src/main/java/edu/harvard/iq/dataverse/authorization/providers/builtin/DataverseUserPage.java", "diffHunk": "@@ -546,6 +546,7 @@ public void sendConfirmEmail() {\n     \n     /**\n      * Determines whether the button to send a verification email appears on user page\n+     * TODO: cant this be refactored to use confirmEmailService.hasVerifiedEmail(currentUser) ?", "originalCommit": "76ae9278b3e9e3b860c2a1af97f449a764252dc5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDM0NjAzNg==", "url": "https://github.com/IQSS/dataverse/pull/6974#discussion_r440346036", "bodyText": "Nope, I didn't. I was going to lean on auth provider support for this. Is this still an issue? It's 4 years old and a lot happened since then. If we encounter these problems again, I could take a look at this...", "author": "poikilotherm", "createdAt": "2020-06-15T17:51:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMzNTU3NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDM1OTIzMw==", "url": "https://github.com/IQSS/dataverse/pull/6974#discussion_r440359233", "bodyText": "It appears that it has never been fixed precisely because it was not much of a serious issue for anyone (I didn't have any recollection of it). And form what I'm reading, that condition only happens if a user tries to refresh the page at the wrong time during the verification... The fact that you haven't heard many complaints about it is somewhat reassuring.\nWe'll address #3438, now that we have an extra reason to do so. I asked in part because I was wondering if the refactoring you suggested in the comment above might by itself solve it - but no, I don't think so.", "author": "landreev", "createdAt": "2020-06-15T18:16:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMzNTU3NA=="}], "type": "inlineReview"}]}