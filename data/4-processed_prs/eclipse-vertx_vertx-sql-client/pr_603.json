{"pr_number": 603, "pr_title": "Additional basic DB2 input validation", "pr_createdAt": "2020-04-28T03:48:24Z", "pr_url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/603", "timeline": [{"oid": "c62acc5d341132a7441b9575d25990b9560a19a4", "url": "https://github.com/eclipse-vertx/vertx-sql-client/commit/c62acc5d341132a7441b9575d25990b9560a19a4", "message": "Additional basic DB2 input validation\n\nSigned-off-by: Greg Watts <gwatts@us.ibm.com>", "committedDate": "2020-04-28T04:19:20Z", "type": "commit"}, {"oid": "c62acc5d341132a7441b9575d25990b9560a19a4", "url": "https://github.com/eclipse-vertx/vertx-sql-client/commit/c62acc5d341132a7441b9575d25990b9560a19a4", "message": "Additional basic DB2 input validation\n\nSigned-off-by: Greg Watts <gwatts@us.ibm.com>", "committedDate": "2020-04-28T04:19:20Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjcyMTc2MA==", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/603#discussion_r416721760", "bodyText": "lets leave these initialized as empty strings", "author": "aguibert", "createdAt": "2020-04-28T15:44:57Z", "path": "vertx-db2-client/src/main/java/io/vertx/db2client/DB2ConnectOptions.java", "diffHunk": "@@ -47,11 +49,11 @@ public static DB2ConnectOptions fromUri(String connectionUri) throws IllegalArgu\n     public static final String DEFAULT_HOST = \"localhost\";\n     public static final int DEFAULT_PORT = 50000;\n     public static final String DEFAULT_USER = \"root\";\n-    public static final String DEFAULT_PASSWORD = \"\";\n-    public static final String DEFAULT_SCHEMA = \"\";\n+    public static final String DEFAULT_PASSWORD = \"INVALID\";\n+    public static final String DEFAULT_SCHEMA = \"INVALID\";", "originalCommit": "c62acc5d341132a7441b9575d25990b9560a19a4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzAxOTkxNA==", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/603#discussion_r417019914", "bodyText": "Currently, I am checking for blank values that get passed into:\nDB2ConnectOptions.setUser\nDB2ConnectOptions.setPassword\nDB2ConnectOptions.setDatabase\nWhen DB2ConnectOptions.init runs, it fills in default values for user (root), pwd (blank) and DB (blank).  This causes test failures right away for the last two listed.  I could push the testing for blank values back to the parent (SqlConnectOptions), but they already check for null values (not blank) and I am concerned changing global stuff outside of DB2.  How would you recommend I proceed?", "author": "gjwatts", "createdAt": "2020-04-29T01:29:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjcyMTc2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzYyNzU2Mg==", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/603#discussion_r417627562", "bodyText": "I have removed the default user/password/schema values and removed the setting of them in the init method.", "author": "gjwatts", "createdAt": "2020-04-29T21:37:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjcyMTc2MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjcyMjQwNQ==", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/603#discussion_r416722405", "bodyText": "for user/pass/database lets just check the length of the string without calling trim() (whitespace may still be valid characters)", "author": "aguibert", "createdAt": "2020-04-28T15:45:51Z", "path": "vertx-db2-client/src/main/java/io/vertx/db2client/DB2ConnectOptions.java", "diffHunk": "@@ -93,17 +95,29 @@ public DB2ConnectOptions setPort(int port) {\n \n     @Override\n     public DB2ConnectOptions setUser(String user) {\n-        return (DB2ConnectOptions) super.setUser(user);\n+    \tif (user == null || user.trim().length() < 1) {", "originalCommit": "c62acc5d341132a7441b9575d25990b9560a19a4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzAxOTkzNQ==", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/603#discussion_r417019935", "bodyText": "Done", "author": "gjwatts", "createdAt": "2020-04-29T01:30:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjcyMjQwNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjc3NTc0OQ==", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/603#discussion_r416775749", "bodyText": "Lets include the actual error code received in the error message here and on line 44", "author": "aguibert", "createdAt": "2020-04-28T17:00:23Z", "path": "vertx-db2-client/src/test/java/io/vertx/db2client/DB2ErrorMessageTest.java", "diffHunk": "@@ -26,66 +26,155 @@\n \n @RunWith(VertxUnitRunner.class)\n public class DB2ErrorMessageTest extends DB2TestBase {\n-\t\n+\n \t@Test\n-\t@Ignore\t\t// TODO - Need to figure out why this is blowing up in parseACCSECreply()\n \tpublic void testConnectInvalidDatabase(TestContext ctx) {\n-\t  options.setDatabase(\"DOES_NOT_EXIST\");\n-\t  DB2Connection.connect(vertx, options, ctx.asyncAssertFailure(err -> {\n-\t\t  ctx.assertTrue(err instanceof DB2Exception, \"The error message returned is of the wrong type.  It should be a DB2Exception, but it was of type \" + err.getClass().getSimpleName());\n-//\t\t  DB2Exception ex = (DB2Exception) err;\n-//\t\t  ctx.assertTrue(ex.getMessage().contains(\"Invalid database\"), \"The SQL error message returned is not correct.  It should have contained \\\"Invalid database\\\", but instead it said \\\"\" + ex.getMessage() + \"\\\"\");\n-\t  }));\n+\t\toptions.setDatabase(\"DB_DOES_NOT_EXIST\");\n+\t\tDB2Connection.connect(vertx, options, ctx.asyncAssertFailure(err -> {\n+\t\t\tctx.assertTrue(err instanceof DB2Exception, \"The error message returned is of the wrong type.  It should be a DB2Exception, but it was of type \" + err.getClass().getSimpleName());\n+\t\t\tDB2Exception ex = (DB2Exception) err;\n+\t\t\tctx.assertTrue(ex.getMessage().contains(\"provided was not found\") ||\n+\t\t\t\t\tex.getMessage().contains(\"The connection was closed by the database server\"), \n+\t\t\t\t\t\"The SQL error message returned is not correct.  It should have contained \\\"provided was not found\\\" or \\\"The connection was closed by the database server\\\", but instead it said \\\"\" + ex.getMessage() + \"\\\"\");\n+\t\t\tctx.assertTrue(ex.getErrorCode() == SqlCode.DATABASE_NOT_FOUND ||\n+\t\t\t\t\tex.getErrorCode() == SqlCode.CONNECTION_REFUSED, \n+\t\t\t\t\t\"Wrong SQL code received\");", "originalCommit": "c62acc5d341132a7441b9575d25990b9560a19a4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzAxOTk1Mg==", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/603#discussion_r417019952", "bodyText": "Done", "author": "gjwatts", "createdAt": "2020-04-29T01:30:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjc3NTc0OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjc3NjM5OA==", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/603#discussion_r416776398", "bodyText": "is this test case intentionally ignored?", "author": "aguibert", "createdAt": "2020-04-28T17:01:22Z", "path": "vertx-db2-client/src/test/java/io/vertx/db2client/DB2ErrorMessageTest.java", "diffHunk": "@@ -26,66 +26,155 @@\n \n @RunWith(VertxUnitRunner.class)\n public class DB2ErrorMessageTest extends DB2TestBase {\n-\t\n+\n \t@Test\n-\t@Ignore\t\t// TODO - Need to figure out why this is blowing up in parseACCSECreply()\n \tpublic void testConnectInvalidDatabase(TestContext ctx) {\n-\t  options.setDatabase(\"DOES_NOT_EXIST\");\n-\t  DB2Connection.connect(vertx, options, ctx.asyncAssertFailure(err -> {\n-\t\t  ctx.assertTrue(err instanceof DB2Exception, \"The error message returned is of the wrong type.  It should be a DB2Exception, but it was of type \" + err.getClass().getSimpleName());\n-//\t\t  DB2Exception ex = (DB2Exception) err;\n-//\t\t  ctx.assertTrue(ex.getMessage().contains(\"Invalid database\"), \"The SQL error message returned is not correct.  It should have contained \\\"Invalid database\\\", but instead it said \\\"\" + ex.getMessage() + \"\\\"\");\n-\t  }));\n+\t\toptions.setDatabase(\"DB_DOES_NOT_EXIST\");\n+\t\tDB2Connection.connect(vertx, options, ctx.asyncAssertFailure(err -> {\n+\t\t\tctx.assertTrue(err instanceof DB2Exception, \"The error message returned is of the wrong type.  It should be a DB2Exception, but it was of type \" + err.getClass().getSimpleName());\n+\t\t\tDB2Exception ex = (DB2Exception) err;\n+\t\t\tctx.assertTrue(ex.getMessage().contains(\"provided was not found\") ||\n+\t\t\t\t\tex.getMessage().contains(\"The connection was closed by the database server\"), \n+\t\t\t\t\t\"The SQL error message returned is not correct.  It should have contained \\\"provided was not found\\\" or \\\"The connection was closed by the database server\\\", but instead it said \\\"\" + ex.getMessage() + \"\\\"\");\n+\t\t\tctx.assertTrue(ex.getErrorCode() == SqlCode.DATABASE_NOT_FOUND ||\n+\t\t\t\t\tex.getErrorCode() == SqlCode.CONNECTION_REFUSED, \n+\t\t\t\t\t\"Wrong SQL code received\");\n+\t\t\tctx.assertTrue(ex.getSqlState().equalsIgnoreCase(\"2E000\") ||\n+\t\t\t\t\tex.getSqlState() == SQLState.AUTH_DATABASE_CONNECTION_REFUSED,\n+\t\t\t\t\t\"Wrong SQL state received\");\n+//\t\t\tSystem.out.println(ex.getMessage());\n+\t\t}));\n \t}\n-\t\n+\n \t@Test\n \tpublic void testConnectInvalidUsername(TestContext ctx) {\n-\t  options.setUser(\"INVALID_USER_FOR_TESTING\");\n-\t  DB2Connection.connect(vertx, options, ctx.asyncAssertFailure(err -> {\n-\t\t  ctx.assertTrue(err instanceof DB2Exception, \"The error message returned is of the wrong type.  It should be a DB2Exception, but it was of type \" + err.getClass().getSimpleName());\n-\t\t  DB2Exception ex = (DB2Exception) err;\n-\t\t  ctx.assertTrue(ex.getMessage().contains(\"Invalid credentials\"), \"The SQL error message returned is not correct.  It should have contained \\\"Invalid credentials\\\", but instead it said \\\"\" + ex.getMessage() + \"\\\"\");\n-\t\t  ctx.assertEquals(SqlCode.INVALID_CREDENTIALS, ex.getErrorCode());\n-\t\t  ctx.assertEquals(SQLState.NET_CONNECT_AUTH_FAILED, ex.getSqlState());\n-\t\t  System.out.println(err.getMessage());\n-\t  }));\n+\t\toptions.setUser(\"INVALID_USER_FOR_TESTING\");\n+\t\tDB2Connection.connect(vertx, options, ctx.asyncAssertFailure(err -> {\n+\t\t\tctx.assertTrue(err instanceof DB2Exception, \"The error message returned is of the wrong type.  It should be a DB2Exception, but it was of type \" + err.getClass().getSimpleName());\n+\t\t\tDB2Exception ex = (DB2Exception) err;\n+\t\t\tctx.assertTrue(ex.getMessage().contains(\"Invalid credentials\"), \"The SQL error message returned is not correct.  It should have contained \\\"Invalid credentials\\\", but instead it said \\\"\" + ex.getMessage() + \"\\\"\");\n+\t\t\tctx.assertEquals(SqlCode.INVALID_CREDENTIALS, ex.getErrorCode());\n+\t\t\tctx.assertEquals(SQLState.NET_CONNECT_AUTH_FAILED, ex.getSqlState());\n+//\t\t\tSystem.out.println(ex.getMessage());\n+\t\t}));\n \t}\n-\t\n+\n \t@Test\n \tpublic void testConnectInvalidPassword(TestContext ctx) {\n \t\toptions.setPassword(\"INVALID_PASSWORD_FOR_TESTING\");\n-\t\t  DB2Connection.connect(vertx, options, ctx.asyncAssertFailure(err -> {\n-\t\t\t  ctx.assertTrue(err instanceof DB2Exception, \"The error message returned is of the wrong type.  It should be a DB2Exception, but it was of type \" + err.getClass().getSimpleName());\n-\t\t\t  DB2Exception ex = (DB2Exception) err;\n-\t\t\t  ctx.assertTrue(ex.getMessage().contains(\"Invalid credentials\"), \"The SQL error message returned is not correct.  It should have contained \\\"Invalid credentials\\\", but instead it said \\\"\" + ex.getMessage() + \"\\\"\");\n-\t\t\t  ctx.assertEquals(SqlCode.INVALID_CREDENTIALS, ex.getErrorCode());\n-\t\t\t  ctx.assertEquals(SQLState.NET_CONNECT_AUTH_FAILED, ex.getSqlState());\n-\t\t\t  System.out.println(err.getMessage());\n-\t\t  }));\n+\t\tDB2Connection.connect(vertx, options, ctx.asyncAssertFailure(err -> {\n+\t\t\tctx.assertTrue(err instanceof DB2Exception, \"The error message returned is of the wrong type.  It should be a DB2Exception, but it was of type \" + err.getClass().getSimpleName());\n+\t\t\tDB2Exception ex = (DB2Exception) err;\n+\t\t\tctx.assertTrue(ex.getMessage().contains(\"Invalid credentials\"), \"The SQL error message returned is not correct.  It should have contained \\\"Invalid credentials\\\", but instead it said \\\"\" + ex.getMessage() + \"\\\"\");\n+\t\t\tctx.assertEquals(SqlCode.INVALID_CREDENTIALS, ex.getErrorCode());\n+\t\t\tctx.assertEquals(SQLState.NET_CONNECT_AUTH_FAILED, ex.getSqlState());\n+//\t\t\tSystem.out.println(ex.getMessage());\n+\t\t}));\n+\t}\n+\n+\t@Test\n+\t@Ignore", "originalCommit": "c62acc5d341132a7441b9575d25990b9560a19a4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzAxOTk2NA==", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/603#discussion_r417019964", "bodyText": "Nope, thanks for catching that!", "author": "gjwatts", "createdAt": "2020-04-29T01:30:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjc3NjM5OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjc3NzI5Nw==", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/603#discussion_r416777297", "bodyText": "if you change the catch block to only catch a DB2Exception then you don't have to do the instanceof check and cast. If any other exception type was thrown it would miss the catch block and cause the test case to fail as expected", "author": "aguibert", "createdAt": "2020-04-28T17:02:43Z", "path": "vertx-db2-client/src/test/java/io/vertx/db2client/DB2ErrorMessageTest.java", "diffHunk": "@@ -26,66 +26,155 @@\n \n @RunWith(VertxUnitRunner.class)\n public class DB2ErrorMessageTest extends DB2TestBase {\n-\t\n+\n \t@Test\n-\t@Ignore\t\t// TODO - Need to figure out why this is blowing up in parseACCSECreply()\n \tpublic void testConnectInvalidDatabase(TestContext ctx) {\n-\t  options.setDatabase(\"DOES_NOT_EXIST\");\n-\t  DB2Connection.connect(vertx, options, ctx.asyncAssertFailure(err -> {\n-\t\t  ctx.assertTrue(err instanceof DB2Exception, \"The error message returned is of the wrong type.  It should be a DB2Exception, but it was of type \" + err.getClass().getSimpleName());\n-//\t\t  DB2Exception ex = (DB2Exception) err;\n-//\t\t  ctx.assertTrue(ex.getMessage().contains(\"Invalid database\"), \"The SQL error message returned is not correct.  It should have contained \\\"Invalid database\\\", but instead it said \\\"\" + ex.getMessage() + \"\\\"\");\n-\t  }));\n+\t\toptions.setDatabase(\"DB_DOES_NOT_EXIST\");\n+\t\tDB2Connection.connect(vertx, options, ctx.asyncAssertFailure(err -> {\n+\t\t\tctx.assertTrue(err instanceof DB2Exception, \"The error message returned is of the wrong type.  It should be a DB2Exception, but it was of type \" + err.getClass().getSimpleName());\n+\t\t\tDB2Exception ex = (DB2Exception) err;\n+\t\t\tctx.assertTrue(ex.getMessage().contains(\"provided was not found\") ||\n+\t\t\t\t\tex.getMessage().contains(\"The connection was closed by the database server\"), \n+\t\t\t\t\t\"The SQL error message returned is not correct.  It should have contained \\\"provided was not found\\\" or \\\"The connection was closed by the database server\\\", but instead it said \\\"\" + ex.getMessage() + \"\\\"\");\n+\t\t\tctx.assertTrue(ex.getErrorCode() == SqlCode.DATABASE_NOT_FOUND ||\n+\t\t\t\t\tex.getErrorCode() == SqlCode.CONNECTION_REFUSED, \n+\t\t\t\t\t\"Wrong SQL code received\");\n+\t\t\tctx.assertTrue(ex.getSqlState().equalsIgnoreCase(\"2E000\") ||\n+\t\t\t\t\tex.getSqlState() == SQLState.AUTH_DATABASE_CONNECTION_REFUSED,\n+\t\t\t\t\t\"Wrong SQL state received\");\n+//\t\t\tSystem.out.println(ex.getMessage());\n+\t\t}));\n \t}\n-\t\n+\n \t@Test\n \tpublic void testConnectInvalidUsername(TestContext ctx) {\n-\t  options.setUser(\"INVALID_USER_FOR_TESTING\");\n-\t  DB2Connection.connect(vertx, options, ctx.asyncAssertFailure(err -> {\n-\t\t  ctx.assertTrue(err instanceof DB2Exception, \"The error message returned is of the wrong type.  It should be a DB2Exception, but it was of type \" + err.getClass().getSimpleName());\n-\t\t  DB2Exception ex = (DB2Exception) err;\n-\t\t  ctx.assertTrue(ex.getMessage().contains(\"Invalid credentials\"), \"The SQL error message returned is not correct.  It should have contained \\\"Invalid credentials\\\", but instead it said \\\"\" + ex.getMessage() + \"\\\"\");\n-\t\t  ctx.assertEquals(SqlCode.INVALID_CREDENTIALS, ex.getErrorCode());\n-\t\t  ctx.assertEquals(SQLState.NET_CONNECT_AUTH_FAILED, ex.getSqlState());\n-\t\t  System.out.println(err.getMessage());\n-\t  }));\n+\t\toptions.setUser(\"INVALID_USER_FOR_TESTING\");\n+\t\tDB2Connection.connect(vertx, options, ctx.asyncAssertFailure(err -> {\n+\t\t\tctx.assertTrue(err instanceof DB2Exception, \"The error message returned is of the wrong type.  It should be a DB2Exception, but it was of type \" + err.getClass().getSimpleName());\n+\t\t\tDB2Exception ex = (DB2Exception) err;\n+\t\t\tctx.assertTrue(ex.getMessage().contains(\"Invalid credentials\"), \"The SQL error message returned is not correct.  It should have contained \\\"Invalid credentials\\\", but instead it said \\\"\" + ex.getMessage() + \"\\\"\");\n+\t\t\tctx.assertEquals(SqlCode.INVALID_CREDENTIALS, ex.getErrorCode());\n+\t\t\tctx.assertEquals(SQLState.NET_CONNECT_AUTH_FAILED, ex.getSqlState());\n+//\t\t\tSystem.out.println(ex.getMessage());\n+\t\t}));\n \t}\n-\t\n+\n \t@Test\n \tpublic void testConnectInvalidPassword(TestContext ctx) {\n \t\toptions.setPassword(\"INVALID_PASSWORD_FOR_TESTING\");\n-\t\t  DB2Connection.connect(vertx, options, ctx.asyncAssertFailure(err -> {\n-\t\t\t  ctx.assertTrue(err instanceof DB2Exception, \"The error message returned is of the wrong type.  It should be a DB2Exception, but it was of type \" + err.getClass().getSimpleName());\n-\t\t\t  DB2Exception ex = (DB2Exception) err;\n-\t\t\t  ctx.assertTrue(ex.getMessage().contains(\"Invalid credentials\"), \"The SQL error message returned is not correct.  It should have contained \\\"Invalid credentials\\\", but instead it said \\\"\" + ex.getMessage() + \"\\\"\");\n-\t\t\t  ctx.assertEquals(SqlCode.INVALID_CREDENTIALS, ex.getErrorCode());\n-\t\t\t  ctx.assertEquals(SQLState.NET_CONNECT_AUTH_FAILED, ex.getSqlState());\n-\t\t\t  System.out.println(err.getMessage());\n-\t\t  }));\n+\t\tDB2Connection.connect(vertx, options, ctx.asyncAssertFailure(err -> {\n+\t\t\tctx.assertTrue(err instanceof DB2Exception, \"The error message returned is of the wrong type.  It should be a DB2Exception, but it was of type \" + err.getClass().getSimpleName());\n+\t\t\tDB2Exception ex = (DB2Exception) err;\n+\t\t\tctx.assertTrue(ex.getMessage().contains(\"Invalid credentials\"), \"The SQL error message returned is not correct.  It should have contained \\\"Invalid credentials\\\", but instead it said \\\"\" + ex.getMessage() + \"\\\"\");\n+\t\t\tctx.assertEquals(SqlCode.INVALID_CREDENTIALS, ex.getErrorCode());\n+\t\t\tctx.assertEquals(SQLState.NET_CONNECT_AUTH_FAILED, ex.getSqlState());\n+//\t\t\tSystem.out.println(ex.getMessage());\n+\t\t}));\n+\t}\n+\n+\t@Test\n+\t@Ignore\n+\tpublic void testQueryBlankDatabase(TestContext ctx) {\n+\t\ttry {\n+\t\t\toptions.setDatabase(\"\");\n+\t\t\tctx.fail(\"Expected a DB2Exception to be thrown\");\n+\t\t} catch (Exception e) {\n+\t\t\tctx.assertTrue(e instanceof DB2Exception, \"Expected a DB2Exception to be thrown\");\n+\t\t\tDB2Exception ex = (DB2Exception) e;\n+\t\t\tctx.assertTrue(ex.getMessage().contains(\"The database name cannot be blank or null\"), \"The SQL error message returned is not correct.  It should have contained \\\"The database name cannot be blank or null\\\", but instead it said \\\"\" + ex.getMessage() + \"\\\"\");\n+\t\t\tctx.assertEquals(SqlCode.DATABASE_NOT_FOUND, ex.getErrorCode());\n+\t\t\tctx.assertEquals(SQLState.DATABASE_NOT_FOUND, ex.getSqlState());\n+//\t\t\tSystem.out.println(ex.getMessage());\n+\t\t}\n+\t}\n+\n+\t@Test\n+\tpublic void testQueryBlankUsername(TestContext ctx) {\n+\t\ttry {\n+\t\t\toptions.setUser(\"\");\n+\t\t\tctx.fail(\"Expected a DB2Exception to be thrown\");\n+\t\t} catch (Exception e) {", "originalCommit": "c62acc5d341132a7441b9575d25990b9560a19a4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjg0MjA2OQ==", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/603#discussion_r416842069", "bodyText": "also applies to a few other cases in this PR", "author": "aguibert", "createdAt": "2020-04-28T18:44:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjc3NzI5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzAxOTk4OA==", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/603#discussion_r417019988", "bodyText": "Yep, good catch!", "author": "gjwatts", "createdAt": "2020-04-29T01:30:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjc3NzI5Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjg0MjYyNw==", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/603#discussion_r416842627", "bodyText": "all of these commented out print statements can be removed", "author": "aguibert", "createdAt": "2020-04-28T18:46:00Z", "path": "vertx-db2-client/src/test/java/io/vertx/db2client/DB2ErrorMessageTest.java", "diffHunk": "@@ -26,66 +26,155 @@\n \n @RunWith(VertxUnitRunner.class)\n public class DB2ErrorMessageTest extends DB2TestBase {\n-\t\n+\n \t@Test\n-\t@Ignore\t\t// TODO - Need to figure out why this is blowing up in parseACCSECreply()\n \tpublic void testConnectInvalidDatabase(TestContext ctx) {\n-\t  options.setDatabase(\"DOES_NOT_EXIST\");\n-\t  DB2Connection.connect(vertx, options, ctx.asyncAssertFailure(err -> {\n-\t\t  ctx.assertTrue(err instanceof DB2Exception, \"The error message returned is of the wrong type.  It should be a DB2Exception, but it was of type \" + err.getClass().getSimpleName());\n-//\t\t  DB2Exception ex = (DB2Exception) err;\n-//\t\t  ctx.assertTrue(ex.getMessage().contains(\"Invalid database\"), \"The SQL error message returned is not correct.  It should have contained \\\"Invalid database\\\", but instead it said \\\"\" + ex.getMessage() + \"\\\"\");\n-\t  }));\n+\t\toptions.setDatabase(\"DB_DOES_NOT_EXIST\");\n+\t\tDB2Connection.connect(vertx, options, ctx.asyncAssertFailure(err -> {\n+\t\t\tctx.assertTrue(err instanceof DB2Exception, \"The error message returned is of the wrong type.  It should be a DB2Exception, but it was of type \" + err.getClass().getSimpleName());\n+\t\t\tDB2Exception ex = (DB2Exception) err;\n+\t\t\tctx.assertTrue(ex.getMessage().contains(\"provided was not found\") ||\n+\t\t\t\t\tex.getMessage().contains(\"The connection was closed by the database server\"), \n+\t\t\t\t\t\"The SQL error message returned is not correct.  It should have contained \\\"provided was not found\\\" or \\\"The connection was closed by the database server\\\", but instead it said \\\"\" + ex.getMessage() + \"\\\"\");\n+\t\t\tctx.assertTrue(ex.getErrorCode() == SqlCode.DATABASE_NOT_FOUND ||\n+\t\t\t\t\tex.getErrorCode() == SqlCode.CONNECTION_REFUSED, \n+\t\t\t\t\t\"Wrong SQL code received\");\n+\t\t\tctx.assertTrue(ex.getSqlState().equalsIgnoreCase(\"2E000\") ||\n+\t\t\t\t\tex.getSqlState() == SQLState.AUTH_DATABASE_CONNECTION_REFUSED,\n+\t\t\t\t\t\"Wrong SQL state received\");\n+//\t\t\tSystem.out.println(ex.getMessage());", "originalCommit": "c62acc5d341132a7441b9575d25990b9560a19a4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzAyMDAwNw==", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/603#discussion_r417020007", "bodyText": "Done", "author": "gjwatts", "createdAt": "2020-04-29T01:30:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjg0MjYyNw=="}], "type": "inlineReview"}, {"oid": "bad574b9535cc9ebdde61d13829d6212179cfb34", "url": "https://github.com/eclipse-vertx/vertx-sql-client/commit/bad574b9535cc9ebdde61d13829d6212179cfb34", "message": "Merge branch 'master' of github.com:eclipse-vertx/vertx-sql-client into 490-connection-error-path-handling\n\nSigned-off-by: Greg Watts <gwatts@us.ibm.com>", "committedDate": "2020-04-29T20:47:23Z", "type": "commit"}, {"oid": "ec8042616d64badc59810c7f0eb6f9337c0f326f", "url": "https://github.com/eclipse-vertx/vertx-sql-client/commit/ec8042616d64badc59810c7f0eb6f9337c0f326f", "message": "Change testTimestamp to handle DBs without nano precision\n\nSigned-off-by: Greg Watts <gwatts@us.ibm.com>", "committedDate": "2020-05-01T00:37:03Z", "type": "commit"}]}