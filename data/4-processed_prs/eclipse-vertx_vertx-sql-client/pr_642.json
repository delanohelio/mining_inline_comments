{"pr_number": 642, "pr_title": "PgException getter and getMessage with all fields, PgErrorCodes", "pr_createdAt": "2020-05-18T08:03:15Z", "pr_url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/642", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjUyNjkwNg==", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/642#discussion_r426526906", "bodyText": "I think we don't actually need this API, we can put the fields in the PgException. In addition I'm not sure if all the fields are necessary to be exposed directly in the API.", "author": "BillyYccc", "createdAt": "2020-05-18T10:29:23Z", "path": "vertx-pg-client/src/main/java/io/vertx/pgclient/impl/codec/Response.java", "diffHunk": "@@ -1,209 +1,58 @@\n /*\n- * Copyright (C) 2017 Julien Viet\n+ * Copyright (c) 2020 Contributors to the Eclipse Foundation\n  *\n- * Licensed under the Apache License, Version 2.0 (the \"License\");\n- * you may not use this file except in compliance with the License.\n- * You may obtain a copy of the License at\n- *\n- * http://www.apache.org/licenses/LICENSE-2.0\n- *\n- * Unless required by applicable law or agreed to in writing, software\n- * distributed under the License is distributed on an \"AS IS\" BASIS,\n- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n- * See the License for the specific language governing permissions and\n- * limitations under the License.\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0, or the Apache License, Version 2.0\n+ * which is available at https://www.apache.org/licenses/LICENSE-2.0.\n  *\n+ * SPDX-License-Identifier: EPL-2.0 OR Apache-2.0\n  */\n \n package io.vertx.pgclient.impl.codec;\n \n+import io.vertx.codegen.annotations.VertxGen;\n+\n /**\n  *\n  * <p>\n  * A common response message for PostgreSQL\n  * <a href=\"https://www.postgresql.org/docs/9.5/static/protocol-error-fields.html\">Error and Notice Message Fields</a>\n- *\n- * @author <a href=\"mailto:emad.albloushi@gmail.com\">Emad Alblueshi</a>\n  */\n+@VertxGen\n+public interface Response {", "originalCommit": "3d7a87bb8574f9b68a53681eefa5670d80b1bc70", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjU4NDEwMQ==", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/642#discussion_r426584101", "bodyText": "agreeing with you, let's have fields on exception", "author": "vietj", "createdAt": "2020-05-18T12:20:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjUyNjkwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjYyNjEwMQ==", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/642#discussion_r426626101", "bodyText": "Ok, I'll copy the fields into PgException.\nAll fields that are reported by PostgreSQL can be useful in some cases. Other clients report all of them: vert-x3/vertx-mysql-postgresql-client, dotConnect, tokio_postgres::error::DbError, DBD::Pg#pg_error_field. The PostgreSQL developers decided to send the fields, which ones should we drop and why?", "author": "julianladisch", "createdAt": "2020-05-18T13:29:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjUyNjkwNg=="}], "type": "inlineReview"}, {"oid": "9d61cc0639d6aa089c619ca9e62c101faa7df527", "url": "https://github.com/eclipse-vertx/vertx-sql-client/commit/9d61cc0639d6aa089c619ca9e62c101faa7df527", "message": "PgException getter and getMessage with all fields, PgErrorCodes\n\nSupport debugging database errors by including all fields in\nPgException.\n\nFixes #274.\n\n* Create a getter method for each field returned by PostgreSQL.\n\n* The getMessage() method (overriding the RuntimeException method)\n  has been returning the message field only. Now it returns all\n  fields for complete information in logs. It creates a serialized\n  JsonObject to support parsing the String, for example in\n  microservice integration tests where it is returned in the\n  HTTP body.\n\n* To get only the message field use the new getErrorMessage()\n  method.\n\n* Add PgErrorCodes with constants for all SQLSTATE error codes and a\n  hasCode(Throwable throwable, String code) method for comparison.\n  \"Applications that need to know which error condition has occurred\n  should usually test the error code, rather than looking at the\n  textual error message.\" (Quote from\n  https://www.postgresql.org/docs/current/errcodes-appendix.html )\n\nThe https://github.com/vert-x3/vertx-mysql-postgresql-client\nclient returns all fields in GenericDatabaseException#getMessage(),\nPgException should provide the same amount of data.\n\nTo change the visibility of the Response getter methods from\npackage-private to public the package-private Response has been\nrenamed to ResponseImpl and a public Response interface with public\ngetter methods has been created.\n\nSigned-off-by: Julian Ladisch <eclipse.org-rtn@ladisch.de>", "committedDate": "2020-05-18T13:01:30Z", "type": "commit"}, {"oid": "9d61cc0639d6aa089c619ca9e62c101faa7df527", "url": "https://github.com/eclipse-vertx/vertx-sql-client/commit/9d61cc0639d6aa089c619ca9e62c101faa7df527", "message": "PgException getter and getMessage with all fields, PgErrorCodes\n\nSupport debugging database errors by including all fields in\nPgException.\n\nFixes #274.\n\n* Create a getter method for each field returned by PostgreSQL.\n\n* The getMessage() method (overriding the RuntimeException method)\n  has been returning the message field only. Now it returns all\n  fields for complete information in logs. It creates a serialized\n  JsonObject to support parsing the String, for example in\n  microservice integration tests where it is returned in the\n  HTTP body.\n\n* To get only the message field use the new getErrorMessage()\n  method.\n\n* Add PgErrorCodes with constants for all SQLSTATE error codes and a\n  hasCode(Throwable throwable, String code) method for comparison.\n  \"Applications that need to know which error condition has occurred\n  should usually test the error code, rather than looking at the\n  textual error message.\" (Quote from\n  https://www.postgresql.org/docs/current/errcodes-appendix.html )\n\nThe https://github.com/vert-x3/vertx-mysql-postgresql-client\nclient returns all fields in GenericDatabaseException#getMessage(),\nPgException should provide the same amount of data.\n\nTo change the visibility of the Response getter methods from\npackage-private to public the package-private Response has been\nrenamed to ResponseImpl and a public Response interface with public\ngetter methods has been created.\n\nSigned-off-by: Julian Ladisch <eclipse.org-rtn@ladisch.de>", "committedDate": "2020-05-18T13:01:30Z", "type": "forcePushed"}, {"oid": "b9a9be663c9ed7ec6205ed64d6bd2e1f5510c698", "url": "https://github.com/eclipse-vertx/vertx-sql-client/commit/b9a9be663c9ed7ec6205ed64d6bd2e1f5510c698", "message": "Copy Response fields into PgException, revert Response/ResponseImpl\n\nSigned-off-by: Julian Ladisch <eclipse.org-rtn@ladisch.de>", "committedDate": "2020-05-18T14:43:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc1Njk4MA==", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/642#discussion_r426756980", "bodyText": "rather reuse the existing io.vertx.pgclient.impl.util.Util class that contains already similar static methods", "author": "vietj", "createdAt": "2020-05-18T16:38:22Z", "path": "vertx-pg-client/src/test/java/io/vertx/pgclient/impl/codec/ResponseHelper.java", "diffHunk": "@@ -0,0 +1,45 @@\n+/*\n+ * Copyright (c) 2020 Contributors to the Eclipse Foundation\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0, or the Apache License, Version 2.0\n+ * which is available at https://www.apache.org/licenses/LICENSE-2.0.\n+ *\n+ * SPDX-License-Identifier: EPL-2.0 OR Apache-2.0\n+ */\n+\n+package io.vertx.pgclient.impl.codec;\n+\n+import io.vertx.pgclient.PgException;\n+\n+public final class ResponseHelper {", "originalCommit": "ea0a6c7aede3b1f3224bcef87865653a1867c054", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzA4MjU3Mw==", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/642#discussion_r427082573", "bodyText": "The Response methods setMessage, setSeverity, etc. are package-private.\nResponse is in main/java/io/vertx/pgclient/impl/codec/Response.java.\nResponseHelper is a test helper located in test/java/io/vertx/pgclient/impl/codec/ResponseHelper.java. It is in test/... because it is needed for testing only. It is in io/vertx/pgclient/impl/codec to have access to the package-private methods of Response.java.\nMoving the ResponseHelper methods into main/io/vertx/pgclient/impl/Util.java fails because of the package-private access restriction, and having a test helper needed for testing only should not got into main/...", "author": "julianladisch", "createdAt": "2020-05-19T07:21:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc1Njk4MA=="}], "type": "inlineReview"}, {"oid": "81bc0f6f418aebd31b9f39f4207032ca5fda897b", "url": "https://github.com/eclipse-vertx/vertx-sql-client/commit/81bc0f6f418aebd31b9f39f4207032ca5fda897b", "message": "Add license header\n\nSigned-off-by: Julian Ladisch <eclipse.org-rtn@ladisch.de>", "committedDate": "2020-05-19T07:25:26Z", "type": "commit"}, {"oid": "81bc0f6f418aebd31b9f39f4207032ca5fda897b", "url": "https://github.com/eclipse-vertx/vertx-sql-client/commit/81bc0f6f418aebd31b9f39f4207032ca5fda897b", "message": "Add license header\n\nSigned-off-by: Julian Ladisch <eclipse.org-rtn@ladisch.de>", "committedDate": "2020-05-19T07:25:26Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzA5MTUwNg==", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/642#discussion_r427091506", "bodyText": "I think this should be instead an enum", "author": "vietj", "createdAt": "2020-05-19T07:38:17Z", "path": "vertx-pg-client/src/main/java/io/vertx/pgclient/PgErrorCodes.java", "diffHunk": "@@ -0,0 +1,306 @@\n+/*\n+ * Copyright (c) 2020 Contributors to the Eclipse Foundation\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0, or the Apache License, Version 2.0\n+ * which is available at https://www.apache.org/licenses/LICENSE-2.0.\n+ *\n+ * SPDX-License-Identifier: EPL-2.0 OR Apache-2.0\n+ */\n+\n+package io.vertx.pgclient;\n+\n+/**\n+ * SQLSTATE codes used by PostgreSQL\n+ * (<a href=\"https://www.postgresql.org/docs/current/errcodes-appendix.html\">PostgreSQL Error Codes</a>,\n+ * <a href=\"https://git.postgresql.org/gitweb/?p=postgresql.git;a=blob;f=src/backend/utils/errcodes.txt;hb=HEAD\">\n+ * errcodes.txt</a>)\n+ */\n+public class PgErrorCodes {", "originalCommit": "81bc0f6f418aebd31b9f39f4207032ca5fda897b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzE2NjQ4OA==", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/642#discussion_r427166488", "bodyText": "I don't think so.\nThe list of error codes is never complete. New PostgreSQL versions may add new codes, and any application can use custom codes: do $$ begin raise sqlstate '99999'; end $$;\nSub-classing PgErrorCodes allows to add custom codes.\nAn enum cannot be extended to support more codes.\nThere is no need to get a human readable name for a code at runtime because PgException contains a message and a detail field. PgErrorCodes provides a human readable name for an expected code used in a unit test or when to handle a specific error.\n\"You should use enum types any time you need to represent a fixed set of constants.\" (quote from https://docs.oracle.com/javase/tutorial/java/javaOO/enum.html )", "author": "julianladisch", "createdAt": "2020-05-19T09:36:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzA5MTUwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzI3MTU0MA==", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/642#discussion_r427271540", "bodyText": "ok, then I think we should not have this list or error codes in the code", "author": "vietj", "createdAt": "2020-05-19T12:43:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzA5MTUwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzY0NDY2OQ==", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/642#discussion_r427644669", "bodyText": "I've removed the file PgErrorCodes.java.", "author": "julianladisch", "createdAt": "2020-05-19T22:52:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzA5MTUwNg=="}], "type": "inlineReview"}, {"oid": "9a9d4408a967a01441f24305577e75bbfbdc2610", "url": "https://github.com/eclipse-vertx/vertx-sql-client/commit/9a9d4408a967a01441f24305577e75bbfbdc2610", "message": "Remove PgErrorCodes.java\n\nSigned-off-by: Julian Ladisch <eclipse.org-rtn@ladisch.de>", "committedDate": "2020-05-19T22:27:23Z", "type": "commit"}]}