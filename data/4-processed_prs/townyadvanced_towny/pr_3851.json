{"pr_number": 3851, "pr_title": "make reload more specific", "pr_createdAt": "2020-03-31T00:34:26Z", "pr_url": "https://github.com/TownyAdvanced/Towny/pull/3851", "timeline": [{"oid": "6dd3229aecb5996ae61bcb12620a9f0e09f66419", "url": "https://github.com/TownyAdvanced/Towny/commit/6dd3229aecb5996ae61bcb12620a9f0e09f66419", "message": "make reload more versatile.", "committedDate": "2020-03-31T00:30:38Z", "type": "commit"}, {"oid": "64f43bd526cdc03837c529dee42de00fb9b5911f", "url": "https://github.com/TownyAdvanced/Towny/commit/64f43bd526cdc03837c529dee42de00fb9b5911f", "message": "add lang label", "committedDate": "2020-03-31T00:32:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU4NjMxMA==", "url": "https://github.com/TownyAdvanced/Towny/pull/3851#discussion_r400586310", "bodyText": "Should be Whether or not to reset the config.yml.", "author": "LlmDl", "createdAt": "2020-03-31T01:15:34Z", "path": "src/com/palmergames/bukkit/towny/command/TownyAdminCommand.java", "diffHunk": "@@ -1444,24 +1471,61 @@ public String nextNpcName() throws TownyException {\n \t\t\t\tthrow new TownyException(TownySettings.getLangString(\"msg_err_too_many_npc\"));\r\n \t\t} while (true);\r\n \t}\r\n+\t\r\n+\tpublic void reloadLangs() {\r\n+\t\tString rootFolder = TownyUniverse.getInstance().getRootFolder();\r\n+\t\ttry {\r\n+\t\t\tTownySettings.loadLanguage(rootFolder + File.separator + \"settings\", \"english.yml\");\r\n+\t\t} catch (IOException e) {\r\n+\t\t\tTownyMessaging.sendErrorMsg(sender, TownySettings.getLangString(\"msg_reload_error\"));\r\n+\t\t\te.printStackTrace();\r\n+\t\t}\r\n+\t\t\r\n+\t\tTownyMessaging.sendMsg(sender, TownySettings.getLangString(\"msg_reloaded_lang\"));\r\n+\t}\r\n+\t\r\n+\tpublic void reloadPerms() {\r\n+\t\tString rootFolder = TownyUniverse.getInstance().getRootFolder();\r\n+\t\tTownyPerms.loadPerms(rootFolder + File.separator + \"settings\", \"townyperms.yml\");\r\n+\t\tTownyMessaging.sendMsg(sender, TownySettings.getLangString(\"msg_reloaded_perms\"));\r\n+\t}\r\n \r\n-\tpublic void reloadTowny(Boolean reset) {\r\n+\t/**\r\n+\t * Reloads only the config\r\n+\t */\r\n+\tpublic void reloadConfig() {\r\n+\t\ttry {\r\n+\t\t\tString rootFolder = TownyUniverse.getInstance().getRootFolder();\r\n+\t\t\tTownySettings.loadConfig(rootFolder + File.separator + \"settings\" + File.separator + \"config.yml\", plugin.getVersion());\r\n+\t\t} catch (IOException e) {\r\n+\t\t\tTownyMessaging.sendErrorMsg(sender, TownySettings.getLangString(\"msg_reload_error\"));\r\n+\t\t\te.printStackTrace();\r\n+\t\t\treturn;\r\n+\t\t}\r\n+\t\t\r\n+\t\tTownyMessaging.sendMsg(sender, TownySettings.getLangString(\"msg_reloaded_config\"));\r\n+\t}\r\n \r\n+\t/**\r\n+\t * Reloads both the database and the config. Used with a database reload command.\r\n+\t * \r\n+\t * @param reset Whether or not to reset the database.\r", "originalCommit": "64f43bd526cdc03837c529dee42de00fb9b5911f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU4NjQ2Mw==", "url": "https://github.com/TownyAdvanced/Towny/pull/3851#discussion_r400586463", "bodyText": "Should have a second language string saying the config.yml was reset to default.", "author": "LlmDl", "createdAt": "2020-03-31T01:16:14Z", "path": "src/com/palmergames/bukkit/towny/command/TownyAdminCommand.java", "diffHunk": "@@ -1444,24 +1471,61 @@ public String nextNpcName() throws TownyException {\n \t\t\t\tthrow new TownyException(TownySettings.getLangString(\"msg_err_too_many_npc\"));\r\n \t\t} while (true);\r\n \t}\r\n+\t\r\n+\tpublic void reloadLangs() {\r\n+\t\tString rootFolder = TownyUniverse.getInstance().getRootFolder();\r\n+\t\ttry {\r\n+\t\t\tTownySettings.loadLanguage(rootFolder + File.separator + \"settings\", \"english.yml\");\r\n+\t\t} catch (IOException e) {\r\n+\t\t\tTownyMessaging.sendErrorMsg(sender, TownySettings.getLangString(\"msg_reload_error\"));\r\n+\t\t\te.printStackTrace();\r\n+\t\t}\r\n+\t\t\r\n+\t\tTownyMessaging.sendMsg(sender, TownySettings.getLangString(\"msg_reloaded_lang\"));\r\n+\t}\r\n+\t\r\n+\tpublic void reloadPerms() {\r\n+\t\tString rootFolder = TownyUniverse.getInstance().getRootFolder();\r\n+\t\tTownyPerms.loadPerms(rootFolder + File.separator + \"settings\", \"townyperms.yml\");\r\n+\t\tTownyMessaging.sendMsg(sender, TownySettings.getLangString(\"msg_reloaded_perms\"));\r\n+\t}\r\n \r\n-\tpublic void reloadTowny(Boolean reset) {\r\n+\t/**\r\n+\t * Reloads only the config\r\n+\t */\r\n+\tpublic void reloadConfig() {\r\n+\t\ttry {\r\n+\t\t\tString rootFolder = TownyUniverse.getInstance().getRootFolder();\r\n+\t\t\tTownySettings.loadConfig(rootFolder + File.separator + \"settings\" + File.separator + \"config.yml\", plugin.getVersion());\r\n+\t\t} catch (IOException e) {\r\n+\t\t\tTownyMessaging.sendErrorMsg(sender, TownySettings.getLangString(\"msg_reload_error\"));\r\n+\t\t\te.printStackTrace();\r\n+\t\t\treturn;\r\n+\t\t}\r\n+\t\t\r\n+\t\tTownyMessaging.sendMsg(sender, TownySettings.getLangString(\"msg_reloaded_config\"));\r\n+\t}\r\n \r\n+\t/**\r\n+\t * Reloads both the database and the config. Used with a database reload command.\r\n+\t * \r\n+\t * @param reset Whether or not to reset the database.\r\n+\t */\r\n+\tpublic void reloadDatabase(Boolean reset) {\r\n \t\tif (reset) {\r\n \t\t\tTownyUniverse.getInstance().getDataSource().deleteFile(plugin.getConfigPath());\r\n \t\t}\r\n \t\tif (plugin.load()) {\r\n-\t\t\t\r\n+\r\n \t\t\t// Register all child permissions for ranks\r\n \t\t\tTownyPerms.registerPermissionNodes();\r\n-\t\t\t\r\n+\r\n \t\t\t// Update permissions for all online players\r\n \t\t\tTownyPerms.updateOnlinePerms();\r\n-\t\t\t\r\n+\r\n \t\t}\r\n \r\n-\t\tTownyMessaging.sendMsg(sender, TownySettings.getLangString(\"msg_reloaded\"));\r\n-\t\t// TownyMessaging.sendMsg(TownySettings.getLangString(\"msg_reloaded\"));\r\n+\t\tTownyMessaging.sendMsg(sender, TownySettings.getLangString(\"msg_reloaded_db\"));\r", "originalCommit": "64f43bd526cdc03837c529dee42de00fb9b5911f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU4NjY2Mw==", "url": "https://github.com/TownyAdvanced/Towny/pull/3851#discussion_r400586663", "bodyText": "I'd add an alias for townyperms as well here.", "author": "LlmDl", "createdAt": "2020-03-31T01:17:05Z", "path": "src/com/palmergames/bukkit/towny/command/TownyAdminCommand.java", "diffHunk": "@@ -237,6 +238,9 @@ public boolean onCommand(CommandSender sender, Command cmd, String commandLabel,\n \tpublic List<String> onTabComplete(CommandSender sender, Command command, String alias, String[] args) {\r\n \t\t\r\n \t\tswitch (args[0].toLowerCase()) {\r\n+\t\t\tcase \"reload\":\r\n+\t\t\t\tif (args.length > 1)\r\n+\t\t\t\t\treturn NameUtil.filterByStart(Arrays.asList(\"database\", \"db\", \"config\", \"perms\", \"permissions\", \"language\", \"lang\"), args[1]);\r", "originalCommit": "64f43bd526cdc03837c529dee42de00fb9b5911f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU4NzE3OQ==", "url": "https://github.com/TownyAdvanced/Towny/pull/3851#discussion_r400587179", "bodyText": "The subcommands should be broken down into 5 options, one subcommand per line the fourth \"\" is actually meant for translatable help descriptions explaining what each does. Add on an \"all\" option.", "author": "LlmDl", "createdAt": "2020-03-31T01:18:53Z", "path": "src/com/palmergames/bukkit/towny/command/TownyAdminCommand.java", "diffHunk": "@@ -455,12 +459,35 @@ public boolean parseTownyAdminCommand(String[] split) throws TownyException {\n \t\t\t\tgiveBonus(StringMgmt.remFirstArg(split));\r\n \r\n \t\t\t} else if (split[0].equalsIgnoreCase(\"reload\")) {\r\n-\r\n-\t\t\t\treloadTowny(false);\r\n-\r\n+\t\t\t\tif (split.length == 2) {\r\n+\t\t\t\t\tswitch (split[1]) {\r\n+\t\t\t\t\t\tcase \"db\":\r\n+\t\t\t\t\t\tcase \"database\":\r\n+\t\t\t\t\t\t\treloadDatabase(false);\r\n+\t\t\t\t\t\t\tbreak;\r\n+\t\t\t\t\t\tcase \"config\":\r\n+\t\t\t\t\t\t\treloadConfig();\r\n+\t\t\t\t\t\t\tbreak;\r\n+\t\t\t\t\t\tcase \"perms\":\r\n+\t\t\t\t\t\tcase \"permissions\":\r\n+\t\t\t\t\t\t\treloadPerms();\r\n+\t\t\t\t\t\t\tbreak;\r\n+\t\t\t\t\t\tcase \"language\":\r\n+\t\t\t\t\t\tcase \"lang\":\r\n+\t\t\t\t\t\t\treloadLangs();\r\n+\t\t\t\t\t\t\tbreak;\r\n+\t\t\t\t\t\tdefault:\r\n+\t\t\t\t\t\t\tplayer.sendMessage(ChatTools.formatTitle(\"/ta reload\"));\r\n+\t\t\t\t\t\t\tplayer.sendMessage(ChatTools.formatCommand(\"\", \"/ta reload\", \"<database|config|perms|lang>\", \"\"));\r\n+\t\t\t\t\t}\r\n+\t\t\t\t} else {\r\n+\t\t\t\t\tplayer.sendMessage(ChatTools.formatTitle(\"/ta reload\"));\r\n+\t\t\t\t\tplayer.sendMessage(ChatTools.formatCommand(\"\", \"/ta reload\", \"<database|config|perms|lang>\", \"\"));\r", "originalCommit": "64f43bd526cdc03837c529dee42de00fb9b5911f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU4NzM1MQ==", "url": "https://github.com/TownyAdvanced/Towny/pull/3851#discussion_r400587351", "bodyText": "Switch needs an \"all\" option for reloading everything all at once.", "author": "LlmDl", "createdAt": "2020-03-31T01:19:31Z", "path": "src/com/palmergames/bukkit/towny/command/TownyAdminCommand.java", "diffHunk": "@@ -455,12 +459,35 @@ public boolean parseTownyAdminCommand(String[] split) throws TownyException {\n \t\t\t\tgiveBonus(StringMgmt.remFirstArg(split));\r\n \r\n \t\t\t} else if (split[0].equalsIgnoreCase(\"reload\")) {\r\n-\r\n-\t\t\t\treloadTowny(false);\r\n-\r\n+\t\t\t\tif (split.length == 2) {\r\n+\t\t\t\t\tswitch (split[1]) {\r", "originalCommit": "64f43bd526cdc03837c529dee42de00fb9b5911f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU4Nzk3OQ==", "url": "https://github.com/TownyAdvanced/Towny/pull/3851#discussion_r400587979", "bodyText": "Reset is supposed to only reset the config.", "author": "LlmDl", "createdAt": "2020-03-31T01:22:09Z", "path": "src/com/palmergames/bukkit/towny/command/TownyAdminCommand.java", "diffHunk": "@@ -455,12 +459,35 @@ public boolean parseTownyAdminCommand(String[] split) throws TownyException {\n \t\t\t\tgiveBonus(StringMgmt.remFirstArg(split));\r\n \r\n \t\t\t} else if (split[0].equalsIgnoreCase(\"reload\")) {\r\n-\r\n-\t\t\t\treloadTowny(false);\r\n-\r\n+\t\t\t\tif (split.length == 2) {\r\n+\t\t\t\t\tswitch (split[1]) {\r\n+\t\t\t\t\t\tcase \"db\":\r\n+\t\t\t\t\t\tcase \"database\":\r\n+\t\t\t\t\t\t\treloadDatabase(false);\r\n+\t\t\t\t\t\t\tbreak;\r\n+\t\t\t\t\t\tcase \"config\":\r\n+\t\t\t\t\t\t\treloadConfig();\r\n+\t\t\t\t\t\t\tbreak;\r\n+\t\t\t\t\t\tcase \"perms\":\r\n+\t\t\t\t\t\tcase \"permissions\":\r\n+\t\t\t\t\t\t\treloadPerms();\r\n+\t\t\t\t\t\t\tbreak;\r\n+\t\t\t\t\t\tcase \"language\":\r\n+\t\t\t\t\t\tcase \"lang\":\r\n+\t\t\t\t\t\t\treloadLangs();\r\n+\t\t\t\t\t\t\tbreak;\r\n+\t\t\t\t\t\tdefault:\r\n+\t\t\t\t\t\t\tplayer.sendMessage(ChatTools.formatTitle(\"/ta reload\"));\r\n+\t\t\t\t\t\t\tplayer.sendMessage(ChatTools.formatCommand(\"\", \"/ta reload\", \"<database|config|perms|lang>\", \"\"));\r\n+\t\t\t\t\t}\r\n+\t\t\t\t} else {\r\n+\t\t\t\t\tplayer.sendMessage(ChatTools.formatTitle(\"/ta reload\"));\r\n+\t\t\t\t\tplayer.sendMessage(ChatTools.formatCommand(\"\", \"/ta reload\", \"<database|config|perms|lang>\", \"\"));\r\n+\t\t\t\t\treturn false;\r\n+\t\t\t\t}\r\n \t\t\t} else if (split[0].equalsIgnoreCase(\"reset\")) {\r\n \r\n-\t\t\t\treloadTowny(true);\r\n+\t\t\t\treloadDatabase(true);\r", "originalCommit": "64f43bd526cdc03837c529dee42de00fb9b5911f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "3931a20a04e12937c6729bff000df4ff07d10932", "url": "https://github.com/TownyAdvanced/Towny/commit/3931a20a04e12937c6729bff000df4ff07d10932", "message": "Fixed formatting and added \"all\" subcommand.", "committedDate": "2020-03-31T01:42:36Z", "type": "commit"}, {"oid": "b50c232411f1a59f116462716f5202e8865978c5", "url": "https://github.com/TownyAdvanced/Towny/commit/b50c232411f1a59f116462716f5202e8865978c5", "message": "Merge branch 'master' into refactor/reload", "committedDate": "2020-03-31T01:43:07Z", "type": "commit"}, {"oid": "3d5df7c35ad3f1ba299200d3100c9007c9f71786", "url": "https://github.com/TownyAdvanced/Towny/commit/3d5df7c35ad3f1ba299200d3100c9007c9f71786", "message": "fix typo", "committedDate": "2020-03-31T01:45:22Z", "type": "commit"}, {"oid": "e1bec5d10e49f4ea92eb59f35c4deefc39bef11e", "url": "https://github.com/TownyAdvanced/Towny/commit/e1bec5d10e49f4ea92eb59f35c4deefc39bef11e", "message": "add \"all\" autocomplete.", "committedDate": "2020-03-31T01:46:49Z", "type": "commit"}, {"oid": "c6bac2a6d4c83edc1d89b470bc7faf4c1faf05d7", "url": "https://github.com/TownyAdvanced/Towny/commit/c6bac2a6d4c83edc1d89b470bc7faf4c1faf05d7", "message": "Fix some errors, and make lang load with config.", "committedDate": "2020-03-31T20:09:42Z", "type": "commit"}, {"oid": "1b28ebcd466d9b4b372c7e0b4b49fa33d914091b", "url": "https://github.com/TownyAdvanced/Towny/commit/1b28ebcd466d9b4b372c7e0b4b49fa33d914091b", "message": "remove some redundancy", "committedDate": "2020-03-31T20:37:08Z", "type": "commit"}, {"oid": "b43e270510917a41756535a1c589b6b5bc3734b2", "url": "https://github.com/TownyAdvanced/Towny/commit/b43e270510917a41756535a1c589b6b5bc3734b2", "message": "Merge branch 'master' into refactor/reload\n\n# Conflicts:\n#\tresources/pt-br.yml", "committedDate": "2020-04-02T17:14:58Z", "type": "commit"}]}