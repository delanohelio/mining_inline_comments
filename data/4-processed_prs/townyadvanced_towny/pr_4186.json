{"pr_number": 4186, "pr_title": "Metadata Improvements", "pr_createdAt": "2020-07-18T23:02:00Z", "pr_url": "https://github.com/TownyAdvanced/Towny/pull/4186", "timeline": [{"oid": "81755bba6ae22a4d729bea748879190fb3632cbc", "url": "https://github.com/TownyAdvanced/Towny/commit/81755bba6ae22a4d729bea748879190fb3632cbc", "message": "Metadata now  uses a map and other improvements.", "committedDate": "2020-07-18T22:56:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njg1MDEzMA==", "url": "https://github.com/TownyAdvanced/Towny/pull/4186#discussion_r456850130", "bodyText": "Even though when I originally did this I set this to null as the default, I think we're better of making it non-null:\nprivate Map<String, CustomDataField<?>> metadata = new HastMap<>();", "author": null, "createdAt": "2020-07-19T02:34:27Z", "path": "src/com/palmergames/bukkit/towny/object/TownyObject.java", "diffHunk": "@@ -4,13 +4,16 @@\n \n import java.util.ArrayList;\n import java.util.Arrays;\n-import java.util.HashSet;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.HashMap;\n import java.util.List;\n+import java.util.Map;\n \n public abstract class TownyObject implements Nameable {\n \tprivate String name;\n-\n-\tprivate HashSet<CustomDataField<?>> metadata = null;\n+\t\n+\tprivate Map<String, CustomDataField<?>> metadata = null;", "originalCommit": "81755bba6ae22a4d729bea748879190fb3632cbc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODM4MTUxNQ==", "url": "https://github.com/TownyAdvanced/Towny/pull/4186#discussion_r458381515", "bodyText": "Reason I kept it null is for lazy-loading. I don't think the majority of TownyObjects will have metadata so I rather not create new objects for all of them if they're not going to be used.", "author": "silverwolfg11", "createdAt": "2020-07-21T20:54:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njg1MDEzMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njg1MDI1Ng==", "url": "https://github.com/TownyAdvanced/Towny/pull/4186#discussion_r456850256", "bodyText": "Unless this method is being used externally, it may not need to be here.", "author": null, "createdAt": "2020-07-19T02:36:08Z", "path": "src/com/palmergames/bukkit/towny/object/TownyObject.java", "diffHunk": "@@ -50,38 +53,57 @@ public String toString() {\n \t}\n \n \tpublic void addMetaData(CustomDataField<?> md) {\n-\t\tif (getMetadata() == null)\n-\t\t\tmetadata = new HashSet<>();\n-\n-\t\tgetMetadata().add(md);\n+\t\tif (metadata == null)\n+\t\t\tmetadata = new HashMap<>();\n+\t\t\n+\t\tmetadata.put(md.getKey(), md);\n \t}\n \n \tpublic void removeMetaData(CustomDataField<?> md) {\n \t\tif (!hasMeta())\n \t\t\treturn;\n-\n-\t\tgetMetadata().remove(md);\n-\n-\t\tif (getMetadata().size() == 0)\n+\t\t\n+\t\tmetadata.remove(md.getKey());\n+\t\t\n+\t\tif (metadata.isEmpty())\n \t\t\tthis.metadata = null;\n \t}\n+\t\n+\tpublic Collection<CustomDataField<?>> getMetadata() {\n+\t\tif (metadata == null || metadata.isEmpty())\n+\t\t\treturn Collections.emptyList();\n+\t\t\n+\t\treturn Collections.unmodifiableCollection(metadata.values());\n+\t}\n \n-\tpublic HashSet<CustomDataField<?>> getMetadata() {\n-\t\treturn metadata;\n+\tpublic Map<String, CustomDataField<?>> getMetaMap() {\n+\t\tif (metadata == null)\n+\t\t\treturn Collections.emptyMap();\n+\n+\t\treturn Collections.unmodifiableMap(metadata);\n+\t}", "originalCommit": "81755bba6ae22a4d729bea748879190fb3632cbc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "ed9f7ae9116411c8e9967c51591e63e7d3ad2f20", "url": "https://github.com/TownyAdvanced/Towny/commit/ed9f7ae9116411c8e9967c51591e63e7d3ad2f20", "message": "Remove unused metamap method.", "committedDate": "2020-07-21T21:47:49Z", "type": "commit"}, {"oid": "e78acf95905c334d1b35d89660b135eab0a53cf5", "url": "https://github.com/TownyAdvanced/Towny/commit/e78acf95905c334d1b35d89660b135eab0a53cf5", "message": "Fix hasMeta check", "committedDate": "2020-07-21T21:52:35Z", "type": "commit"}, {"oid": "762af35c01f1333bb1ceef9b5a43c2b8732594db", "url": "https://github.com/TownyAdvanced/Towny/commit/762af35c01f1333bb1ceef9b5a43c2b8732594db", "message": "Add some missing override annotations.", "committedDate": "2020-07-22T18:48:47Z", "type": "commit"}]}