{"pr_number": 3900, "pr_title": "Adds confirmation for setting plot types to outposts.", "pr_createdAt": "2020-04-11T16:50:31Z", "pr_url": "https://github.com/TownyAdvanced/Towny/pull/3900", "timeline": [{"oid": "e2f01a4e06df013f245028eb4290c780804207fa", "url": "https://github.com/TownyAdvanced/Towny/commit/e2f01a4e06df013f245028eb4290c780804207fa", "message": "Adds confirmation for setting plot types to outposts.", "committedDate": "2020-04-11T16:48:31Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzEzMTYxMg==", "url": "https://github.com/TownyAdvanced/Towny/pull/3900#discussion_r407131612", "bodyText": "This lang string can be changed to the generic msg_confirm_purchase string and all the lang file changes can be reverted.", "author": "LlmDl", "createdAt": "2020-04-12T01:33:00Z", "path": "src/com/palmergames/bukkit/towny/command/PlotCommand.java", "diffHunk": "@@ -656,12 +656,29 @@ public boolean parsePlotCommand(Player player, String[] split) throws TownyExcep\n \t\t\t\t\t\t\t\t if (OutpostUtil.OutpostTests(town, resident, townyWorld, key, isAdmin, true)) {\r\n \t\t\t\t\t\t\t\t\t if (TownySettings.isUsingEconomy() && !town.getAccount().pay(TownySettings.getOutpostCost(), String.format(\"Plot Set Outpost\"))) \r\n \t\t\t\t\t\t\t\t\t\t throw new TownyException(TownySettings.getLangString(\"msg_err_cannot_afford_to_set_outpost\"));\r\n-\r\n-\t\t\t\t\t\t\t\t\t TownyMessaging.sendMessage(player, String.format(TownySettings.getLangString(\"msg_plot_set_cost\"), TownyEconomyHandler.getFormattedBalance(TownySettings.getOutpostCost()), TownySettings.getLangString(\"outpost\")));\r\n-\t\t\t\t\t\t\t\t\t townBlock.setOutpost(true);\r\n-\t\t\t\t\t\t\t\t\t town.addOutpostSpawn(player.getLocation());\r\n-\t\t\t\t\t\t\t\t\t townyUniverse.getDataSource().saveTown(town);\r\n-\t\t\t\t\t\t\t\t\t townyUniverse.getDataSource().saveTownBlock(townBlock);\r\n+\t\t\t\t\t\t\t\t\t \r\n+\t\t\t\t\t\t\t\t\t // Create a confirmation for setting outpost.\r\n+\t\t\t\t\t\t\t\t\t Confirmation confirmation = new Confirmation(() -> {\r\n+\t\t\t\t\t\t\t\t\t\t townBlock.setOutpost(true);\r\n+\t\t\t\t\t\t\t\t\t\t \r\n+\t\t\t\t\t\t\t\t\t\t try {\r\n+\t\t\t\t\t\t\t\t\t\t\t town.addOutpostSpawn(player.getLocation());\r\n+\t\t\t\t\t\t\t\t\t\t } catch (TownyException e) {\r\n+\t\t\t\t\t\t\t\t\t\t\t TownyMessaging.sendErrorMsg(e.getMessage());\r\n+\t\t\t\t\t\t\t\t\t\t\t return;\r\n+\t\t\t\t\t\t\t\t\t\t }\r\n+\t\t\t\t\t\t\t\t\t\t \r\n+\t\t\t\t\t\t\t\t\t\t townyUniverse.getDataSource().saveTown(town);\r\n+\t\t\t\t\t\t\t\t\t\t townyUniverse.getDataSource().saveTownBlock(townBlock);\r\n+\t\t\t\t\t\t\t\t\t\t TownyMessaging.sendMessage(player, String.format(TownySettings.getLangString(\"msg_plot_set_cost\"), TownyEconomyHandler.getFormattedBalance(TownySettings.getOutpostCost()), TownySettings.getLangString(\"outpost\")));\r\n+\t\t\t\t\t\t\t\t\t });\r\n+\t\t\t\t\t\t\t\t\t // Set title.\r\n+\t\t\t\t\t\t\t\t\t String title = String.format(TownySettings.getLangString(\"msg_warn_outpost_cost\"), TownyEconomyHandler.getFormattedBalance(TownySettings.getOutpostCost()));\r", "originalCommit": "e2f01a4e06df013f245028eb4290c780804207fa", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "de437ed2e2e3651907c76bb5cf67a4747634c238", "url": "https://github.com/TownyAdvanced/Towny/commit/de437ed2e2e3651907c76bb5cf67a4747634c238", "message": "Revert lang changes.", "committedDate": "2020-04-12T18:13:36Z", "type": "commit"}, {"oid": "f68bec392637e281244e3eada3a744a1746dbac8", "url": "https://github.com/TownyAdvanced/Towny/commit/f68bec392637e281244e3eada3a744a1746dbac8", "message": "Merge branch 'master' into feature/outpost-confirmation\n\n# Conflicts:\n#\tresources/chinese.yml", "committedDate": "2020-04-12T18:15:33Z", "type": "commit"}, {"oid": "7afc85b1aa5283f62eed6026dc20936160cda328", "url": "https://github.com/TownyAdvanced/Towny/commit/7afc85b1aa5283f62eed6026dc20936160cda328", "message": "Fix merge issues.", "committedDate": "2020-04-12T18:16:01Z", "type": "commit"}, {"oid": "abf6d8eca2da691a56c5953fec7ab1444689482b", "url": "https://github.com/TownyAdvanced/Towny/commit/abf6d8eca2da691a56c5953fec7ab1444689482b", "message": "fix the other lang files.", "committedDate": "2020-04-12T18:17:57Z", "type": "commit"}, {"oid": "3214cb06eda1cfce0cb858c4db9e4d471cb1ba7c", "url": "https://github.com/TownyAdvanced/Towny/commit/3214cb06eda1cfce0cb858c4db9e4d471cb1ba7c", "message": "Fix players being charged before they confirm/cancel the confirmation.", "committedDate": "2020-04-14T10:49:55Z", "type": "commit"}, {"oid": "9fef0e7719e5405989cbb9606f7ead8aa5369d44", "url": "https://github.com/TownyAdvanced/Towny/commit/9fef0e7719e5405989cbb9606f7ead8aa5369d44", "message": "Add forgotten check to see if economy is being used.", "committedDate": "2020-04-14T10:55:43Z", "type": "commit"}]}