{"pr_number": 3946, "pr_title": "Allow line length > 54", "pr_createdAt": "2020-04-23T12:55:19Z", "pr_url": "https://github.com/TownyAdvanced/Towny/pull/3946", "timeline": [{"oid": "eda0c8fc404ae3b1f376000a0a9eb9ef4364beee", "url": "https://github.com/TownyAdvanced/Towny/commit/eda0c8fc404ae3b1f376000a0a9eb9ef4364beee", "message": "Make confirmations slightly more configurable", "committedDate": "2020-04-21T02:03:26Z", "type": "commit"}, {"oid": "3d2a3817af2dfdeb9aecc5a421d4b27abf3520fe", "url": "https://github.com/TownyAdvanced/Towny/commit/3d2a3817af2dfdeb9aecc5a421d4b27abf3520fe", "message": "Why are there two...?", "committedDate": "2020-04-21T02:46:21Z", "type": "commit"}, {"oid": "bb53fea0bd7d32df68ee22606f4e4819ec4ae008", "url": "https://github.com/TownyAdvanced/Towny/commit/bb53fea0bd7d32df68ee22606f4e4819ec4ae008", "message": "Introduce customizable confirmation/invitation prefixes", "committedDate": "2020-04-21T17:07:38Z", "type": "commit"}, {"oid": "8af438a057c90f7de385cfa0ef8438471cc4031b", "url": "https://github.com/TownyAdvanced/Towny/commit/8af438a057c90f7de385cfa0ef8438471cc4031b", "message": "Merge branch 'master' of https://github.com/TownyAdvanced/Towny\n\n\u0001 Conflicts:\n\u0001\tresources/english.yml", "committedDate": "2020-04-22T20:07:34Z", "type": "commit"}, {"oid": "9a89b902fd0467a586459897de66541a1529bf17", "url": "https://github.com/TownyAdvanced/Towny/commit/9a89b902fd0467a586459897de66541a1529bf17", "message": "First pass at removing the 54 char restriction", "committedDate": "2020-04-23T02:58:37Z", "type": "commit"}, {"oid": "03c076e293ca02203ef7e43b86cb9e1873ffcce4", "url": "https://github.com/TownyAdvanced/Towny/commit/03c076e293ca02203ef7e43b86cb9e1873ffcce4", "message": "Cleanup and fixes", "committedDate": "2020-04-23T12:35:15Z", "type": "commit"}, {"oid": "3960a83b57fd73733e1bfcc0f683f55a9780bbee", "url": "https://github.com/TownyAdvanced/Towny/commit/3960a83b57fd73733e1bfcc0f683f55a9780bbee", "message": "Small mistake", "committedDate": "2020-04-23T13:12:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzgyNzE1Mw==", "url": "https://github.com/TownyAdvanced/Towny/pull/3946#discussion_r413827153", "bodyText": "This is an error message and has to be forced red as otherwise we'd have to prefix all the err_msg's in the lang files with colour codes.", "author": "LlmDl", "createdAt": "2020-04-23T14:09:01Z", "path": "src/com/palmergames/bukkit/towny/TownyMessaging.java", "diffHunk": "@@ -47,22 +49,19 @@ public static void sendErrorMsg(String msg) {\n \t * @param msg the message to send\r\n \t */\r\n \tpublic static void sendErrorMsg(Object sender, String msg) {\r\n-\t\tboolean isPlayer = false;\r\n+\t\t// todo: maybe check if it's already colored to avoid forcing red?\r", "originalCommit": "3960a83b57fd73733e1bfcc0f683f55a9780bbee", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzgzMjIyOA==", "url": "https://github.com/TownyAdvanced/Towny/pull/3946#discussion_r413832228", "bodyText": "Just an fyi we don't have any of this { return; } going on in the code. I would appreciate if you did\nif (p == null)\n   return;\n\nTo be more uniform with the rest of the code.", "author": "LlmDl", "createdAt": "2020-04-23T14:14:46Z", "path": "src/com/palmergames/bukkit/towny/TownyMessaging.java", "diffHunk": "@@ -108,22 +99,30 @@ public static void sendMsg(String msg) {\n \t * @param msg the message being sent\r\n \t */\r\n \tpublic static void sendMsg(Object sender, String msg) {\r\n-\t\tfor (String line : ChatTools.color(TownySettings.getLangString(\"default_towny_prefix\") + Colors.Green + msg)) {\r\n-\t\t\tif (sender instanceof Player) {\r\n-\t\t\t\t((Player) sender).sendMessage(line);\r\n-\t\t\t} else if (sender instanceof CommandSender) {\r\n-\t\t\t\t((CommandSender) sender).sendMessage(Colors.strip(line));\r\n-\t\t\t} else if (sender instanceof Resident) {\r\n-\t\t\t\tPlayer p = TownyAPI.getInstance().getPlayer((Resident) sender);\r\n-\t\t\t\tif (p == null) {\r\n-\t\t\t\t\treturn;\r\n-\t\t\t\t}\r\n-\t\t\t\tp.sendMessage(Colors.strip(line));\r\n-\t\t\t}\r\n+\t\t// todo: maybe check if it's already colored to avoid forcing green?\r\n+\t\t// I don't fully understand the reason for the Resident check but I don't want to break something so...\r\n+\t\tif (sender instanceof Resident) {\r\n+\t\t\tPlayer p = TownyAPI.getInstance().getPlayer((Resident) sender);\r\n+\t\t\tif (p == null) { return; }\r", "originalCommit": "3960a83b57fd73733e1bfcc0f683f55a9780bbee", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzg0MDYzNg==", "url": "https://github.com/TownyAdvanced/Towny/pull/3946#discussion_r413840636", "bodyText": "I am also not quite sure that the resident is supposed to have the colour stripped. As all the sendMsg should be green.", "author": "LlmDl", "createdAt": "2020-04-23T14:24:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzgzMjIyOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzg0MzM3MA==", "url": "https://github.com/TownyAdvanced/Towny/pull/3946#discussion_r413843370", "bodyText": "This one is not meant to be prefixed.", "author": "LlmDl", "createdAt": "2020-04-23T14:27:30Z", "path": "src/com/palmergames/bukkit/towny/TownyMessaging.java", "diffHunk": "@@ -252,7 +246,7 @@ public static void sendMessage(Object sender, String[] lines) {\n \t\t\t\tif (p == null) {\r\n \t\t\t\t\treturn;\r\n \t\t\t\t}\r\n-\t\t\t\tp.sendMessage(Colors.strip(line));\r\n+\t\t\t\tp.sendMessage(PREFIX + Colors.strip(line));\r", "originalCommit": "3960a83b57fd73733e1bfcc0f683f55a9780bbee", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzg1NTMxMQ==", "url": "https://github.com/TownyAdvanced/Towny/pull/3946#discussion_r413855311", "bodyText": "I am not entirely sure why you changed out from using ChatTools.list() throughout this file, as you've already removed the wordwrap and color methods from ChatTools which would have been causing an issue. What you've replaced it with, to me, is less readable. Can you explain if this was necessary?", "author": "LlmDl", "createdAt": "2020-04-23T14:41:13Z", "path": "src/com/palmergames/bukkit/towny/tasks/DailyTimerTask.java", "diffHunk": "@@ -231,9 +231,9 @@ protected void collectNationTaxes(Nation nation) throws EconomyException {\n \t\t\t}\r\n \t\t\tif (localRemovedTowns != null) {\r\n \t\t\t\tif (localRemovedTowns.size() == 1) \r\n-\t\t\t\t\tTownyMessaging.sendNationMessagePrefixed(nation, String.format(TownySettings.getLangString(\"msg_couldnt_pay_tax\"), ChatTools.list(localRemovedTowns), \"nation\"));\r\n+\t\t\t\t\tTownyMessaging.sendNationMessagePrefixed(nation, String.format(\"%s%s%s\", TownySettings.getLangString(\"msg_couldnt_pay_tax\"), String.join(\", \", localRemovedTowns), \"nation\"));\r", "originalCommit": "3960a83b57fd73733e1bfcc0f683f55a9780bbee", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzkxMTY0Nw==", "url": "https://github.com/TownyAdvanced/Towny/pull/3946#discussion_r413911647", "bodyText": "Yeah this shouldn't have made it in, I was experimenting with ways to clean this up too but it's out of scope and just came out all wrong.", "author": null, "createdAt": "2020-04-23T15:47:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzg1NTMxMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzg1NTg4Ng==", "url": "https://github.com/TownyAdvanced/Towny/pull/3946#discussion_r413855886", "bodyText": "Unused import?", "author": "LlmDl", "createdAt": "2020-04-23T14:41:49Z", "path": "src/com/palmergames/bukkit/util/ChatTools.java", "diffHunk": "@@ -1,5 +1,7 @@\n package com.palmergames.bukkit.util;\n \n+import org.bukkit.ChatColor;", "originalCommit": "3960a83b57fd73733e1bfcc0f683f55a9780bbee", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzg4OTA3Mg==", "url": "https://github.com/TownyAdvanced/Towny/pull/3946#discussion_r413889072", "bodyText": "Unused import?", "author": "LlmDl", "createdAt": "2020-04-23T15:19:36Z", "path": "src/com/palmergames/bukkit/towny/TownyFormatter.java", "diffHunk": "@@ -20,6 +20,7 @@\n import com.palmergames.bukkit.util.ChatTools;\r\n import com.palmergames.bukkit.util.Colors;\r\n import com.palmergames.util.StringMgmt;\r\n+import org.bukkit.ChatColor;\r", "originalCommit": "3960a83b57fd73733e1bfcc0f683f55a9780bbee", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "3356874ff7ec37a47505f7e503fd7eda1dd73885", "url": "https://github.com/TownyAdvanced/Towny/commit/3356874ff7ec37a47505f7e503fd7eda1dd73885", "message": "Removed unused imports and reverted edits to DailyTimerTask", "committedDate": "2020-04-23T15:50:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzkyOTI2Mw==", "url": "https://github.com/TownyAdvanced/Towny/pull/3946#discussion_r413929263", "bodyText": "Three changes to this file should probably be reverted, otherwise we're not getting a nice \"name, name, name\" list.", "author": "LlmDl", "createdAt": "2020-04-23T16:09:19Z", "path": "src/com/palmergames/bukkit/towny/command/ResidentCommand.java", "diffHunk": "@@ -464,7 +464,7 @@ else if (resident.isMayor())\n \t\t\t\tformatedList.add(colour + resident.getName() + Colors.White);\r\n \t\t\t}\r\n \t\t}\r\n-\t\tfor (String line : ChatTools.list(formatedList))\r\n+\t\tfor (String line : formatedList)\r", "originalCommit": "3356874ff7ec37a47505f7e503fd7eda1dd73885", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzkyOTg4OQ==", "url": "https://github.com/TownyAdvanced/Towny/pull/3946#discussion_r413929889", "bodyText": "All of the changes to this file can be reverted except for this one.", "author": "LlmDl", "createdAt": "2020-04-23T16:10:04Z", "path": "src/com/palmergames/bukkit/towny/tasks/DailyTimerTask.java", "diffHunk": "@@ -493,8 +493,8 @@ public void collectNationCosts() throws EconomyException {\n \t\t\t\t}\r\n \t\t\t}\r\n \t\t}\r\n-\t\tif (removedNations != null) {\r\n-\t\t\tif (removedNations.size() == 1) \r\n+\t\tif (removedNations != null && !removedNations.isEmpty()) {\r", "originalCommit": "3356874ff7ec37a47505f7e503fd7eda1dd73885", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e0ad723dc5bf7e3e6723ece81f8b04123c303005", "url": "https://github.com/TownyAdvanced/Towny/commit/e0ad723dc5bf7e3e6723ece81f8b04123c303005", "message": "Revert more changes except for empty col check", "committedDate": "2020-04-23T16:42:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzk1Nzg0Mg==", "url": "https://github.com/TownyAdvanced/Towny/pull/3946#discussion_r413957842", "bodyText": "If the above if-statement passes, then this if-statement will always be false. Thus you can use an else-if here or you could move this if-statement above the previous one and use an else-if on the previous one.", "author": "silverwolfg11", "createdAt": "2020-04-23T16:47:13Z", "path": "src/com/palmergames/bukkit/towny/TownyMessaging.java", "diffHunk": "@@ -47,22 +49,18 @@ public static void sendErrorMsg(String msg) {\n \t * @param msg the message to send\r\n \t */\r\n \tpublic static void sendErrorMsg(Object sender, String msg) {\r\n-\t\tboolean isPlayer = false;\r\n \t\tif (sender instanceof Player) {\r\n-\t\t\tisPlayer = true;\r\n+\t\t\t((Player) sender).sendMessage(PREFIX + ChatColor.RED + msg);\r\n \t\t}\r\n \r\n+\t\tif (sender instanceof ConsoleCommandSender) {\r\n+\t\t\t((ConsoleCommandSender) sender).sendMessage(PREFIX + ChatColor.stripColor(msg));\r\n+\t\t}\r\n+\t\t\r\n \t\tif (sender == null) {\r", "originalCommit": "e0ad723dc5bf7e3e6723ece81f8b04123c303005", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzk2MTAwNQ==", "url": "https://github.com/TownyAdvanced/Towny/pull/3946#discussion_r413961005", "bodyText": "This if-statement call is highly unlikely (but still valid). However, I wouldn't return on null (bad, in this instance, for control flow and you would skip the dev message) and would instead use a simple != null check", "author": "silverwolfg11", "createdAt": "2020-04-23T16:51:42Z", "path": "src/com/palmergames/bukkit/towny/TownyMessaging.java", "diffHunk": "@@ -108,22 +98,30 @@ public static void sendMsg(String msg) {\n \t * @param msg the message being sent\r\n \t */\r\n \tpublic static void sendMsg(Object sender, String msg) {\r\n-\t\tfor (String line : ChatTools.color(TownySettings.getLangString(\"default_towny_prefix\") + Colors.Green + msg)) {\r\n-\t\t\tif (sender instanceof Player) {\r\n-\t\t\t\t((Player) sender).sendMessage(line);\r\n-\t\t\t} else if (sender instanceof CommandSender) {\r\n-\t\t\t\t((CommandSender) sender).sendMessage(Colors.strip(line));\r\n-\t\t\t} else if (sender instanceof Resident) {\r\n-\t\t\t\tPlayer p = TownyAPI.getInstance().getPlayer((Resident) sender);\r\n-\t\t\t\tif (p == null) {\r\n-\t\t\t\t\treturn;\r\n-\t\t\t\t}\r\n-\t\t\t\tp.sendMessage(Colors.strip(line));\r\n-\t\t\t}\r\n+\t\t// I don't fully understand the reason for the Resident check but I don't want to break something so...\r\n+\t\tif (sender instanceof Resident) {\r\n+\t\t\tPlayer p = TownyAPI.getInstance().getPlayer((Resident) sender);\r\n+\t\t\tif (p == null)\r\n+\t\t\t\treturn;\r", "originalCommit": "e0ad723dc5bf7e3e6723ece81f8b04123c303005", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzk2MTc3Nw==", "url": "https://github.com/TownyAdvanced/Towny/pull/3946#discussion_r413961777", "bodyText": "All of these if-statements, are mutually exclusive so they can be prefixed with an else if", "author": "silverwolfg11", "createdAt": "2020-04-23T16:52:51Z", "path": "src/com/palmergames/bukkit/towny/TownyMessaging.java", "diffHunk": "@@ -108,22 +98,30 @@ public static void sendMsg(String msg) {\n \t * @param msg the message being sent\r\n \t */\r\n \tpublic static void sendMsg(Object sender, String msg) {\r\n-\t\tfor (String line : ChatTools.color(TownySettings.getLangString(\"default_towny_prefix\") + Colors.Green + msg)) {\r\n-\t\t\tif (sender instanceof Player) {\r\n-\t\t\t\t((Player) sender).sendMessage(line);\r\n-\t\t\t} else if (sender instanceof CommandSender) {\r\n-\t\t\t\t((CommandSender) sender).sendMessage(Colors.strip(line));\r\n-\t\t\t} else if (sender instanceof Resident) {\r\n-\t\t\t\tPlayer p = TownyAPI.getInstance().getPlayer((Resident) sender);\r\n-\t\t\t\tif (p == null) {\r\n-\t\t\t\t\treturn;\r\n-\t\t\t\t}\r\n-\t\t\t\tp.sendMessage(Colors.strip(line));\r\n-\t\t\t}\r\n+\t\t// I don't fully understand the reason for the Resident check but I don't want to break something so...\r\n+\t\tif (sender instanceof Resident) {\r\n+\t\t\tPlayer p = TownyAPI.getInstance().getPlayer((Resident) sender);\r\n+\t\t\tif (p == null)\r\n+\t\t\t\treturn;\r\n+\t\t\tp.sendMessage(PREFIX + ChatColor.GREEN + msg);\r\n+\t\t}\r\n+\t\t\r\n+\t\tif (sender instanceof Player) {\r", "originalCommit": "e0ad723dc5bf7e3e6723ece81f8b04123c303005", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzk2MzIwNg==", "url": "https://github.com/TownyAdvanced/Towny/pull/3946#discussion_r413963206", "bodyText": "Use this is as probably the last else statement (if you use else-ifs above). Also do not use system.out, use TownyMessaging instead, and probably with Invalid sender instead of null sender if you chose to do the else-ifs.", "author": "silverwolfg11", "createdAt": "2020-04-23T16:54:52Z", "path": "src/com/palmergames/bukkit/towny/TownyMessaging.java", "diffHunk": "@@ -108,22 +98,30 @@ public static void sendMsg(String msg) {\n \t * @param msg the message being sent\r\n \t */\r\n \tpublic static void sendMsg(Object sender, String msg) {\r\n-\t\tfor (String line : ChatTools.color(TownySettings.getLangString(\"default_towny_prefix\") + Colors.Green + msg)) {\r\n-\t\t\tif (sender instanceof Player) {\r\n-\t\t\t\t((Player) sender).sendMessage(line);\r\n-\t\t\t} else if (sender instanceof CommandSender) {\r\n-\t\t\t\t((CommandSender) sender).sendMessage(Colors.strip(line));\r\n-\t\t\t} else if (sender instanceof Resident) {\r\n-\t\t\t\tPlayer p = TownyAPI.getInstance().getPlayer((Resident) sender);\r\n-\t\t\t\tif (p == null) {\r\n-\t\t\t\t\treturn;\r\n-\t\t\t\t}\r\n-\t\t\t\tp.sendMessage(Colors.strip(line));\r\n-\t\t\t}\r\n+\t\t// I don't fully understand the reason for the Resident check but I don't want to break something so...\r\n+\t\tif (sender instanceof Resident) {\r\n+\t\t\tPlayer p = TownyAPI.getInstance().getPlayer((Resident) sender);\r\n+\t\t\tif (p == null)\r\n+\t\t\t\treturn;\r\n+\t\t\tp.sendMessage(PREFIX + ChatColor.GREEN + msg);\r\n+\t\t}\r\n+\t\t\r\n+\t\tif (sender instanceof Player) {\r\n+\t\t\t((Player) sender).sendMessage(PREFIX + ChatColor.GREEN + msg);\r\n+\t\t}\r\n+\r\n+\t\tif (sender instanceof ConsoleCommandSender) {\r\n+\t\t\t((ConsoleCommandSender) sender).sendMessage(PREFIX + ChatColor.stripColor(msg));\r\n+\t\t}\r\n+\r\n+\t\tif (sender == null) {\r\n+\t\t\tSystem.out.print(\"Message called with null sender\");\r\n \t\t}\r", "originalCommit": "e0ad723dc5bf7e3e6723ece81f8b04123c303005", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzk2NzA0Mg==", "url": "https://github.com/TownyAdvanced/Towny/pull/3946#discussion_r413967042", "bodyText": "I'll change it, but when I forked the repo it already came with a system.out", "author": null, "createdAt": "2020-04-23T17:00:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzk2MzIwNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzk2NDA4Mw==", "url": "https://github.com/TownyAdvanced/Towny/pull/3946#discussion_r413964083", "bodyText": "This would be really convenient to have, however, it prevents changing the prefix on language file reload.", "author": "silverwolfg11", "createdAt": "2020-04-23T16:56:04Z", "path": "src/com/palmergames/bukkit/towny/TownyMessaging.java", "diffHunk": "@@ -28,6 +29,7 @@\n public class TownyMessaging {\r\n \tprivate static final Logger LOGGER = LogManager.getLogger(Towny.class);\r\n \tprivate static final Logger LOGGER_DEBUG = LogManager.getLogger(\"com.palmergames.bukkit.towny.debug\");\r\n+\tprivate static final String PREFIX = TownySettings.getLangString(\"default_towny_prefix\");\r", "originalCommit": "e0ad723dc5bf7e3e6723ece81f8b04123c303005", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "ef3c7202997e7d26ee1a897ce7bd2d32c08a104b", "url": "https://github.com/TownyAdvanced/Towny/commit/ef3c7202997e7d26ee1a897ce7bd2d32c08a104b", "message": "By request, removed static prefix, refactored message sending", "committedDate": "2020-04-23T17:41:07Z", "type": "commit"}, {"oid": "b18ae82435a1b6cd2a98dc8d57b12a3d93b86977", "url": "https://github.com/TownyAdvanced/Towny/commit/b18ae82435a1b6cd2a98dc8d57b12a3d93b86977", "message": "Removed unused import", "committedDate": "2020-04-23T17:43:12Z", "type": "commit"}]}