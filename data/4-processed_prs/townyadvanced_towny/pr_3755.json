{"pr_number": 3755, "pr_title": "HotFix: Fix Ally invite sending to already allied nations.", "pr_createdAt": "2020-03-09T02:55:34Z", "pr_url": "https://github.com/TownyAdvanced/Towny/pull/3755", "timeline": [{"oid": "a7ac696c585bbdc4d94ab87615ad6ac0a1e0f26c", "url": "https://github.com/TownyAdvanced/Towny/commit/a7ac696c585bbdc4d94ab87615ad6ac0a1e0f26c", "message": "Fixed problem where nation ally invite would send invite to other nation even if they were already allied.", "committedDate": "2020-03-09T02:53:02Z", "type": "commit"}, {"oid": "fda38de29e21a0af96c455ca25a80ef150287b64", "url": "https://github.com/TownyAdvanced/Towny/commit/fda38de29e21a0af96c455ca25a80ef150287b64", "message": "Remove labeler", "committedDate": "2020-03-09T02:56:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTY0OTk0NQ==", "url": "https://github.com/TownyAdvanced/Towny/pull/3755#discussion_r389649945", "bodyText": "Unused import?", "author": "LlmDl", "createdAt": "2020-03-09T13:12:22Z", "path": "src/com/palmergames/bukkit/towny/listeners/TownyBlockListener.java", "diffHunk": "@@ -26,6 +26,7 @@\n import org.bukkit.Material;\r\n import org.bukkit.block.Block;\r\n import org.bukkit.block.BlockFace;\r\n+import org.bukkit.configuration.file.YamlConfiguration;\r", "originalCommit": "fda38de29e21a0af96c455ca25a80ef150287b64", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTY1MDAzNw==", "url": "https://github.com/TownyAdvanced/Towny/pull/3755#discussion_r389650037", "bodyText": "Unused imports?", "author": "LlmDl", "createdAt": "2020-03-09T13:12:34Z", "path": "src/com/palmergames/bukkit/towny/listeners/TownyBlockListener.java", "diffHunk": "@@ -37,6 +38,9 @@\n import org.bukkit.event.block.BlockPistonExtendEvent;\r\n import org.bukkit.event.block.BlockPistonRetractEvent;\r\n import org.bukkit.event.block.BlockPlaceEvent;\r\n+import org.bukkit.inventory.ItemStack;\r\n+import org.bukkit.inventory.meta.ItemMeta;\r\n+import org.yaml.snakeyaml.Yaml;\r", "originalCommit": "fda38de29e21a0af96c455ca25a80ef150287b64", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTY1NDAzMA==", "url": "https://github.com/TownyAdvanced/Towny/pull/3755#discussion_r389654030", "bodyText": "It's debatable whether the return statement should be put back in for the nation.equals(ally) and also added to your new if statement. I know it's supposed to pass over any non-usable names because it is sent a String[], but if you look at the cases below inside of the catch, if it is given an unusable argument it kills it with a return, rather than continuing to process the string. I would say put the returns in the try to match until all of the returns can be dealt with.", "author": "LlmDl", "createdAt": "2020-03-09T13:19:53Z", "path": "src/com/palmergames/bukkit/towny/command/NationCommand.java", "diffHunk": "@@ -1735,10 +1735,12 @@ private void nationAlly(Player player, String[] split) throws TownyException {\n \t\t\t\t\tally = townyUniverse.getDataSource().getNation(name);\r\n \t\t\t\t\tif (nation.equals(ally)) {\r\n \t\t\t\t\t\tTownyMessaging.sendErrorMsg(player, TownySettings.getLangString(\"msg_own_nation_disallow\"));\r\n-\t\t\t\t\t\treturn;\r\n+\t\t\t\t\t} else if (nation.isAlliedWith(ally)) {\r\n+\t\t\t\t\t\tTownyMessaging.sendErrorMsg(player, String.format(TownySettings.getLangString(\"msg_already_ally\"), ally));\r", "originalCommit": "fda38de29e21a0af96c455ca25a80ef150287b64", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTgxNzM4MA==", "url": "https://github.com/TownyAdvanced/Towny/pull/3755#discussion_r389817380", "bodyText": "The reason I removed the returns, is because it doesn't seem logical to have them when you think about it from the perspective of the player. For example\nNation1 is allied with Nation2\nNation2 is allied with Nation3\nPlayer in Nation1 executes command /n ally add Nation2 Nation3\nTowny says you're already an ally with nation2 and stops.\nNow lets switch the order\nPlayer in Nation1 executes command /n ally add Nation3 Nation2\nTowny states that Nation1 is now an ally of Nation2\nTowny then states Nation1 is already an ally with nation two.\n^ There's a discrepancy in the results of these commands only when the order differs, which is confusing for the player. This discrepancy is caused by the order of the input.\nBy removing the return it removes this discrepancy, and simply \"skips\" and notifies if a nation in the input list if it's already allied, and then carries on to ally the other ones passed in. Therefore you can pass the nations into the command in any order and it should work as expected.", "author": null, "createdAt": "2020-03-09T16:44:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTY1NDAzMA=="}], "type": "inlineReview"}, {"oid": "a326252ebec97ea0226ab624a4ad90e162dccfa4", "url": "https://github.com/TownyAdvanced/Towny/commit/a326252ebec97ea0226ab624a4ad90e162dccfa4", "message": "removed unused imports", "committedDate": "2020-03-09T16:47:44Z", "type": "commit"}, {"oid": "b4c126b4fe8c1ff1a543cbe7f438ed369ca925aa", "url": "https://github.com/TownyAdvanced/Towny/commit/b4c126b4fe8c1ff1a543cbe7f438ed369ca925aa", "message": "remove other returns in loop", "committedDate": "2020-03-10T00:06:23Z", "type": "commit"}]}