{"pr_number": 520, "pr_title": "Log4j2 update and Adapter logger improvement", "pr_createdAt": "2020-03-18T09:59:40Z", "pr_url": "https://github.com/ibissource/iaf/pull/520", "timeline": [{"oid": "112b3aa00da2888a2349fb1a88077c45a9cf79d9", "url": "https://github.com/ibissource/iaf/commit/112b3aa00da2888a2349fb1a88077c45a9cf79d9", "message": "Update Log4j dependencies.", "committedDate": "2020-02-19T11:11:32Z", "type": "commit"}, {"oid": "20499f7ef0da49497e34e7df878e032823c0f89b", "url": "https://github.com/ibissource/iaf/commit/20499f7ef0da49497e34e7df878e032823c0f89b", "message": "Change layouts.", "committedDate": "2020-02-26T10:31:47Z", "type": "commit"}, {"oid": "44c8ebd89b99367fc91dcb33433b1f24406256c2", "url": "https://github.com/ibissource/iaf/commit/44c8ebd89b99367fc91dcb33433b1f24406256c2", "message": "Adapt LOG4J2 refactoring (package change for logger.)", "committedDate": "2020-02-26T10:36:17Z", "type": "commit"}, {"oid": "05c2b94a440ed01f39c8c4fa2c3d9c53045ab67f", "url": "https://github.com/ibissource/iaf/commit/05c2b94a440ed01f39c8c4fa2c3d9c53045ab67f", "message": "Change poms to use log4j2", "committedDate": "2020-02-26T10:38:47Z", "type": "commit"}, {"oid": "44cb6a00b83c8cdbc51ebfcc9b60839ad1fc0468", "url": "https://github.com/ibissource/iaf/commit/44cb6a00b83c8cdbc51ebfcc9b60839ad1fc0468", "message": "Adapt ibis thread filter.", "committedDate": "2020-02-26T14:26:19Z", "type": "commit"}, {"oid": "eb54dddee2b0383758656848fef44180736d8669", "url": "https://github.com/ibissource/iaf/commit/eb54dddee2b0383758656848fef44180736d8669", "message": "Update log4j4ibis.xml for Log4j2.", "committedDate": "2020-03-04T09:43:02Z", "type": "commit"}, {"oid": "f52f94d0feab8f505645a6165a2ea5e13a0558b9", "url": "https://github.com/ibissource/iaf/commit/f52f94d0feab8f505645a6165a2ea5e13a0558b9", "message": "Change initialization of log util.", "committedDate": "2020-03-04T10:04:00Z", "type": "commit"}, {"oid": "eff85acf449d20af9375e6dcf49c5cd1c6733f82", "url": "https://github.com/ibissource/iaf/commit/eff85acf449d20af9375e6dcf49c5cd1c6733f82", "message": "Merge branch 'master' into logger-update", "committedDate": "2020-03-04T10:06:19Z", "type": "commit"}, {"oid": "d1e26472f14549239e847fec6d473cf0bf042413", "url": "https://github.com/ibissource/iaf/commit/d1e26472f14549239e847fec6d473cf0bf042413", "message": "Delete logutil and extend configurations.", "committedDate": "2020-03-06T15:41:02Z", "type": "commit"}, {"oid": "6d515c52c9fa0e3c59b6c06e81b8d8655c76c3a9", "url": "https://github.com/ibissource/iaf/commit/6d515c52c9fa0e3c59b6c06e81b8d8655c76c3a9", "message": "Extend layouts for masking and length limit.", "committedDate": "2020-03-06T15:41:27Z", "type": "commit"}, {"oid": "1812a91758306af7d0db7c831879da349cecfd81", "url": "https://github.com/ibissource/iaf/commit/1812a91758306af7d0db7c831879da349cecfd81", "message": "Adapt files to logutil change.", "committedDate": "2020-03-06T15:43:00Z", "type": "commit"}, {"oid": "f469afd66d9c626addc033561546e4c0de7b25fc", "url": "https://github.com/ibissource/iaf/commit/f469afd66d9c626addc033561546e4c0de7b25fc", "message": "Update log4j2 dependencies", "committedDate": "2020-03-06T15:46:27Z", "type": "commit"}, {"oid": "a1b2dc1b3fd06da6ec3414aaf12014a64bedea03", "url": "https://github.com/ibissource/iaf/commit/a1b2dc1b3fd06da6ec3414aaf12014a64bedea03", "message": "Updating log4j2 configurations.", "committedDate": "2020-03-06T15:47:36Z", "type": "commit"}, {"oid": "b3a01c3522c28e8024cffa4772f53d8c5f9428e4", "url": "https://github.com/ibissource/iaf/commit/b3a01c3522c28e8024cffa4772f53d8c5f9428e4", "message": "Add log4j2 to make sure it boots up before Spring.", "committedDate": "2020-03-06T15:48:03Z", "type": "commit"}, {"oid": "7a91581fc3e16e8b559b5426f94869eef7d4c22e", "url": "https://github.com/ibissource/iaf/commit/7a91581fc3e16e8b559b5426f94869eef7d4c22e", "message": "Get rid of xml layout and explicit servlet filters.", "committedDate": "2020-03-13T09:18:10Z", "type": "commit"}, {"oid": "e693724225eb3111af6c8461a53533b7a728f76d", "url": "https://github.com/ibissource/iaf/commit/e693724225eb3111af6c8461a53533b7a728f76d", "message": "Merge branch 'master' into logger-update", "committedDate": "2020-03-13T09:29:21Z", "type": "commit"}, {"oid": "7adf9206d8a4a6c4a915da0a108ab878e7a6ef16", "url": "https://github.com/ibissource/iaf/commit/7adf9206d8a4a6c4a915da0a108ab878e7a6ef16", "message": "Rearrange pom dependencies.", "committedDate": "2020-03-13T13:02:16Z", "type": "commit"}, {"oid": "679b49c672b488f20d09272c5773102512dd28b8", "url": "https://github.com/ibissource/iaf/commit/679b49c672b488f20d09272c5773102512dd28b8", "message": "Merge branch master to logger-update", "committedDate": "2020-03-13T13:03:14Z", "type": "commit"}, {"oid": "6d3292be28e78f24cfe6832a944d107460bbbbe0", "url": "https://github.com/ibissource/iaf/commit/6d3292be28e78f24cfe6832a944d107460bbbbe0", "message": "Debug and optimize logging extensions.", "committedDate": "2020-03-13T13:03:35Z", "type": "commit"}, {"oid": "b774ce6092f0f440c4850355ee923b92b1c1f2d9", "url": "https://github.com/ibissource/iaf/commit/b774ce6092f0f440c4850355ee923b92b1c1f2d9", "message": "Debug configuration.", "committedDate": "2020-03-13T13:04:42Z", "type": "commit"}, {"oid": "2cc960e50ccec7b77f6687b1d87c22d76136798b", "url": "https://github.com/ibissource/iaf/commit/2cc960e50ccec7b77f6687b1d87c22d76136798b", "message": "Improve message logging. And get rid of MsgLogUtil.", "committedDate": "2020-03-13T14:42:53Z", "type": "commit"}, {"oid": "76afbee00599e022606037867adf8de876b8ec25", "url": "https://github.com/ibissource/iaf/commit/76afbee00599e022606037867adf8de876b8ec25", "message": "Revert StartIbis.java, committed by mistake.", "committedDate": "2020-03-18T09:53:12Z", "type": "commit"}, {"oid": "1b02ddf0a60350741196d7622200a9ce31fb0571", "url": "https://github.com/ibissource/iaf/commit/1b02ddf0a60350741196d7622200a9ce31fb0571", "message": "Merge branch 'master' into logger-update", "committedDate": "2020-03-18T10:02:11Z", "type": "commit"}, {"oid": "ec88d5793862b20663960a22fc8d196c2e688365", "url": "https://github.com/ibissource/iaf/commit/ec88d5793862b20663960a22fc8d196c2e688365", "message": "Bring back logutil.", "committedDate": "2020-03-18T11:00:20Z", "type": "commit"}, {"oid": "5b2c430947df0a613097734c9a3a0b818c786692", "url": "https://github.com/ibissource/iaf/commit/5b2c430947df0a613097734c9a3a0b818c786692", "message": "Merge branch 'logger-update' of github.com:ibissource/iaf into logger-update", "committedDate": "2020-03-18T11:01:25Z", "type": "commit"}, {"oid": "c6bae6925f5566afce902fd21971446672515f23", "url": "https://github.com/ibissource/iaf/commit/c6bae6925f5566afce902fd21971446672515f23", "message": "Disable log4j2 trace logging.", "committedDate": "2020-03-18T11:42:41Z", "type": "commit"}, {"oid": "60665d87d46101dd38695726d411511bd91c221b", "url": "https://github.com/ibissource/iaf/commit/60665d87d46101dd38695726d411511bd91c221b", "message": "Revert using logmanager instead of logutil.", "committedDate": "2020-03-18T11:43:19Z", "type": "commit"}, {"oid": "604364c2b9fa43454e2a8d6b1a2d6653284859e3", "url": "https://github.com/ibissource/iaf/commit/604364c2b9fa43454e2a8d6b1a2d6653284859e3", "message": "Merge branch 'master' into logger-update", "committedDate": "2020-03-26T14:44:50Z", "type": "commit"}, {"oid": "677a7ec0e787c50dd4d28922339ef773718d60ed", "url": "https://github.com/ibissource/iaf/commit/677a7ec0e787c50dd4d28922339ef773718d60ed", "message": "Merge branch 'master' into logger-update", "committedDate": "2020-04-02T08:16:30Z", "type": "commit"}, {"oid": "949d3ec38b424f425fc01db9bc595e7275b0bfe3", "url": "https://github.com/ibissource/iaf/commit/949d3ec38b424f425fc01db9bc595e7275b0bfe3", "message": "Solve wrong auto-merge issue.", "committedDate": "2020-04-02T08:43:48Z", "type": "commit"}, {"oid": "3f68e55956d4cf136171dd37f0d5fb2f5496d996", "url": "https://github.com/ibissource/iaf/commit/3f68e55956d4cf136171dd37f0d5fb2f5496d996", "message": "Remove and correct a few (unused) imports", "committedDate": "2020-04-08T12:43:46Z", "type": "commit"}, {"oid": "fdf03c840b92344aaa74c222151b614cfa7bf8ef", "url": "https://github.com/ibissource/iaf/commit/fdf03c840b92344aaa74c222151b614cfa7bf8ef", "message": "More imports", "committedDate": "2020-04-08T13:21:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTYyOTMzOA==", "url": "https://github.com/ibissource/iaf/pull/520#discussion_r405629338", "bodyText": "Copyright 2017-2019 Nationale-Nederlanden, 2020 WeAreFrank!", "author": "gvanbrakel", "createdAt": "2020-04-08T15:51:31Z", "path": "akamai/src/main/java/nl/nn/adapterframework/extensions/akamai/NetStorageSender.java", "diffHunk": "@@ -1,5 +1,5 @@\n /*\n-   Copyright 2017-2019 Nationale-Nederlanden\n+   Copyright 2017-2020 WeAreFrank!", "originalCommit": "fdf03c840b92344aaa74c222151b614cfa7bf8ef", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "28d37e1220469ec40e5191b975ef83da1f96c54a", "url": "https://github.com/ibissource/iaf/commit/28d37e1220469ec40e5191b975ef83da1f96c54a", "message": "Cleanup a little bit more", "committedDate": "2020-04-08T18:38:49Z", "type": "commit"}, {"oid": "a487247f79533cdf82b995f78b02327525b74224", "url": "https://github.com/ibissource/iaf/commit/a487247f79533cdf82b995f78b02327525b74224", "message": "Rollback logger provider, and add log4j dependency to pom.xml.", "committedDate": "2020-04-14T08:43:51Z", "type": "commit"}, {"oid": "2429032ea8df7da17cdbcc799813b863cbbe7906", "url": "https://github.com/ibissource/iaf/commit/2429032ea8df7da17cdbcc799813b863cbbe7906", "message": "Adapter name to upper case for logger name.", "committedDate": "2020-04-14T08:44:56Z", "type": "commit"}, {"oid": "826b10dc135cd52d503dc33a59576d26ba373af9", "url": "https://github.com/ibissource/iaf/commit/826b10dc135cd52d503dc33a59576d26ba373af9", "message": "Add deprecated message for log4j4ibis.xml", "committedDate": "2020-04-14T08:49:38Z", "type": "commit"}, {"oid": "1c55468c1d9f61af7cde9fa24e250d2b59f98e9c", "url": "https://github.com/ibissource/iaf/commit/1c55468c1d9f61af7cde9fa24e250d2b59f98e9c", "message": "Replace impossible regex with null to improve performance.", "committedDate": "2020-04-14T08:50:38Z", "type": "commit"}, {"oid": "3f3faaf2e38f73674af6d53f95b6c99427441311", "url": "https://github.com/ibissource/iaf/commit/3f3faaf2e38f73674af6d53f95b6c99427441311", "message": "Add extra javadoc for log4j2 extensions.", "committedDate": "2020-04-14T08:51:00Z", "type": "commit"}, {"oid": "9fe15acaf6707e2a24466ef290e4b7115a5682ae", "url": "https://github.com/ibissource/iaf/commit/9fe15acaf6707e2a24466ef290e4b7115a5682ae", "message": "Add licence, javadoc, rename a few methods", "committedDate": "2020-04-14T14:28:41Z", "type": "commit"}, {"oid": "57b82a2b024e5a0f4228586512f0479f6359f02b", "url": "https://github.com/ibissource/iaf/commit/57b82a2b024e5a0f4228586512f0479f6359f02b", "message": "Fix a few junittests and generify messagelog logger pattern", "committedDate": "2020-04-14T15:09:08Z", "type": "commit"}, {"oid": "0dce48ab49e7a5896217708165964babdf075781", "url": "https://github.com/ibissource/iaf/commit/0dce48ab49e7a5896217708165964babdf075781", "message": "Fix NPE", "committedDate": "2020-04-14T15:29:52Z", "type": "commit"}, {"oid": "bc30f170bcb8110d8c84c1461be2e75db1de011e", "url": "https://github.com/ibissource/iaf/commit/bc30f170bcb8110d8c84c1461be2e75db1de011e", "message": "Fix missing dash in log message", "committedDate": "2020-04-14T15:40:43Z", "type": "commit"}, {"oid": "1d8f920bd72740592168179057102b7e33929886", "url": "https://github.com/ibissource/iaf/commit/1d8f920bd72740592168179057102b7e33929886", "message": "Update test configuration.", "committedDate": "2020-04-14T15:55:48Z", "type": "commit"}, {"oid": "69f221633ad305cf803d89e828fbb6cc272fd452", "url": "https://github.com/ibissource/iaf/commit/69f221633ad305cf803d89e828fbb6cc272fd452", "message": "Add test-jar for log4j2 to use listappender.", "committedDate": "2020-04-15T11:31:02Z", "type": "commit"}, {"oid": "8aa54824da7bb06d5c70478df5f9376cc8178a59", "url": "https://github.com/ibissource/iaf/commit/8aa54824da7bb06d5c70478df5f9376cc8178a59", "message": "Replace test appender with list appender.", "committedDate": "2020-04-15T11:39:49Z", "type": "commit"}, {"oid": "6bebc8fe0380b2420df2f8f17c93288688f5942a", "url": "https://github.com/ibissource/iaf/commit/6bebc8fe0380b2420df2f8f17c93288688f5942a", "message": "Delete unrelated test file.", "committedDate": "2020-04-15T12:17:30Z", "type": "commit"}, {"oid": "db03b6e8c48f1395f33d3d04eea862b60e2bd3f8", "url": "https://github.com/ibissource/iaf/commit/db03b6e8c48f1395f33d3d04eea862b60e2bd3f8", "message": "Revert log lines to their old format", "committedDate": "2020-04-15T15:26:42Z", "type": "commit"}, {"oid": "637fe2b8021730e22896de96ba96e1c4e8ea0a02", "url": "https://github.com/ibissource/iaf/commit/637fe2b8021730e22896de96ba96e1c4e8ea0a02", "message": "Refactor a few classes", "committedDate": "2020-04-20T12:35:29Z", "type": "commit"}, {"oid": "0138bb6dec77e0d7d04f6871d5bc2dbab2ec1d35", "url": "https://github.com/ibissource/iaf/commit/0138bb6dec77e0d7d04f6871d5bc2dbab2ec1d35", "message": "Revert changes to log statement", "committedDate": "2020-04-20T12:41:16Z", "type": "commit"}, {"oid": "7cc563bf4f6d6da0b3df772a15708ca76bc6aae9", "url": "https://github.com/ibissource/iaf/commit/7cc563bf4f6d6da0b3df772a15708ca76bc6aae9", "message": "Merge branch 'master' into logger-update\n\n# Conflicts:\n#\tcore/src/main/java/nl/nn/adapterframework/http/HttpSenderBase.java\n#\tcore/src/main/java/nl/nn/adapterframework/jdbc/dbms/OracleToMSSQLTranslator.java\n#\tcore/src/main/java/nl/nn/adapterframework/lifecycle/ServletManager.java\n#\tcore/src/main/java/nl/nn/adapterframework/webcontrol/api/BrowseJdbcTable.java", "committedDate": "2020-04-20T12:49:46Z", "type": "commit"}, {"oid": "698b25e634b1294055cd7f42ea819fb8433106c2", "url": "https://github.com/ibissource/iaf/commit/698b25e634b1294055cd7f42ea819fb8433106c2", "message": "Fix NPE", "committedDate": "2020-04-20T13:00:12Z", "type": "commit"}, {"oid": "99f6915b700881ee0f72eda1a64f6223c8fe13a6", "url": "https://github.com/ibissource/iaf/commit/99f6915b700881ee0f72eda1a64f6223c8fe13a6", "message": "Fix disableANSI", "committedDate": "2020-04-20T13:15:51Z", "type": "commit"}, {"oid": "a2a1feec917ed294b81ab42bfa234be336439f91", "url": "https://github.com/ibissource/iaf/commit/a2a1feec917ed294b81ab42bfa234be336439f91", "message": "Rename extensions.log4j package to logging", "committedDate": "2020-04-20T14:17:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTQ2MTUyNQ==", "url": "https://github.com/ibissource/iaf/pull/520#discussion_r411461525", "bodyText": "Hier misschien nog een keer Ctrl-Shift-O doen?", "author": "gvanbrakel", "createdAt": "2020-04-20T15:15:19Z", "path": "core/src/main/java/nl/nn/adapterframework/align/content/JsonDocumentContainer.java", "diffHunk": "@@ -22,10 +22,9 @@\n import javax.json.stream.JsonGenerator;\n \n import org.apache.commons.lang.NotImplementedException;\n-import org.apache.log4j.Logger;\n-import org.apache.xerces.xs.XSTypeDefinition;\n-\n import nl.nn.adapterframework.util.LogUtil;\n+import org.apache.logging.log4j.Logger;\n+import org.apache.xerces.xs.XSTypeDefinition;\n ", "originalCommit": "a2a1feec917ed294b81ab42bfa234be336439f91", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTQ2MjI0NA==", "url": "https://github.com/ibissource/iaf/pull/520#discussion_r411462244", "bodyText": "Hier ook Ctrl-Shift-O", "author": "gvanbrakel", "createdAt": "2020-04-20T15:16:11Z", "path": "core/src/main/java/nl/nn/adapterframework/cache/CacheAdapterBase.java", "diffHunk": "@@ -15,14 +15,13 @@\n */\n package nl.nn.adapterframework.cache;\n \n-import org.apache.commons.lang.StringUtils;\n-import org.apache.log4j.Logger;\n-\n import nl.nn.adapterframework.configuration.ConfigurationException;\n import nl.nn.adapterframework.core.IPipeLineSession;\n import nl.nn.adapterframework.doc.IbisDoc;\n-import nl.nn.adapterframework.util.LogUtil;\n import nl.nn.adapterframework.util.TransformerPool;\n+import org.apache.commons.lang.StringUtils;\n+import nl.nn.adapterframework.util.LogUtil;\n+import org.apache.logging.log4j.Logger;\n ", "originalCommit": "a2a1feec917ed294b81ab42bfa234be336439f91", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTQ2MzI2NQ==", "url": "https://github.com/ibissource/iaf/pull/520#discussion_r411463265", "bodyText": "Hier ook Ctrl-Shift-O", "author": "gvanbrakel", "createdAt": "2020-04-20T15:17:31Z", "path": "core/src/main/java/nl/nn/adapterframework/configuration/IbisContext.java", "diffHunk": "@@ -39,9 +26,21 @@\n import nl.nn.adapterframework.util.DateUtils;\n import nl.nn.adapterframework.util.FlowDiagram;\n import nl.nn.adapterframework.util.JdbcUtil;\n-import nl.nn.adapterframework.util.LogUtil;\n import nl.nn.adapterframework.util.MessageKeeper;\n import nl.nn.adapterframework.util.MessageKeeperMessage;\n+import org.apache.commons.lang.StringUtils;\n+import nl.nn.adapterframework.util.LogUtil;\n+import org.apache.logging.log4j.Logger;\n+import org.springframework.beans.factory.BeanCreationException;\n+", "originalCommit": "a2a1feec917ed294b81ab42bfa234be336439f91", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTQ2MzU3Ng==", "url": "https://github.com/ibissource/iaf/pull/520#discussion_r411463576", "bodyText": "Hier ook Ctrl-Shift-O", "author": "gvanbrakel", "createdAt": "2020-04-20T15:17:53Z", "path": "core/src/main/java/nl/nn/adapterframework/configuration/JmxMbeanHelper.java", "diffHunk": "@@ -15,10 +15,12 @@\n */\n package nl.nn.adapterframework.configuration;\n \n-import java.util.HashMap;\n-import java.util.List;\n-import java.util.Map;\n-import java.util.Set;\n+import nl.nn.adapterframework.core.IAdapter;\n+import nl.nn.adapterframework.util.AppConstants;\n+import nl.nn.adapterframework.util.JmxUtils;\n+import org.apache.commons.lang.StringUtils;\n+import nl.nn.adapterframework.util.LogUtil;\n+import org.apache.logging.log4j.Logger;", "originalCommit": "a2a1feec917ed294b81ab42bfa234be336439f91", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTQ2NzI5MQ==", "url": "https://github.com/ibissource/iaf/pull/520#discussion_r411467291", "bodyText": "Hier ook Ctrl-Shift-O", "author": "gvanbrakel", "createdAt": "2020-04-20T15:22:35Z", "path": "core/src/main/java/nl/nn/adapterframework/doc/IbisDocPipe.java", "diffHunk": "@@ -64,6 +34,25 @@\n import nl.nn.adapterframework.util.Misc;\n import nl.nn.adapterframework.util.XmlBuilder;\n import nl.nn.adapterframework.util.XmlUtils;\n+import org.apache.logging.log4j.Logger;\n+import org.springframework.beans.factory.BeanDefinitionStoreException;\n+import org.springframework.beans.factory.config.BeanDefinition;\n+import org.springframework.beans.factory.support.BeanDefinitionRegistry;\n+import org.springframework.beans.factory.support.BeanNameGenerator;\n+import org.springframework.beans.factory.support.SimpleBeanDefinitionRegistry;\n+import org.springframework.context.annotation.AnnotationBeanNameGenerator;\n+import org.springframework.context.annotation.ClassPathBeanDefinitionScanner;\n+import org.springframework.core.annotation.AnnotationUtils;\n+import org.springframework.core.type.filter.AssignableTypeFilter;\n+import org.springframework.core.type.filter.RegexPatternTypeFilter;\n+import org.springframework.util.Assert;\n+import org.xml.sax.SAXException;\n+\n+import java.io.IOException;\n+import java.lang.reflect.Method;\n+import java.lang.reflect.Modifier;\n+import java.util.*;\n+import java.util.regex.Pattern;", "originalCommit": "a2a1feec917ed294b81ab42bfa234be336439f91", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTQ2ODkyNQ==", "url": "https://github.com/ibissource/iaf/pull/520#discussion_r411468925", "bodyText": "Hier ook Ctrl-Shift-O", "author": "gvanbrakel", "createdAt": "2020-04-20T15:24:35Z", "path": "core/src/main/java/nl/nn/adapterframework/extensions/svn/SvnUtils.java", "diffHunk": "@@ -15,22 +15,19 @@\n  */\n package nl.nn.adapterframework.extensions.svn;\n \n-import java.io.IOException;\n-\n-import javax.xml.xpath.XPathExpressionException;\n-\n-import org.apache.commons.lang.StringUtils;\n-import org.apache.log4j.Logger;\n-\n import nl.nn.adapterframework.configuration.ConfigurationException;\n import nl.nn.adapterframework.core.SenderException;\n import nl.nn.adapterframework.core.TimeOutException;\n import nl.nn.adapterframework.http.HttpSender;\n import nl.nn.adapterframework.stream.Message;\n import nl.nn.adapterframework.util.DomBuilderException;\n-import nl.nn.adapterframework.util.LogUtil;\n import nl.nn.adapterframework.util.XmlUtils;\n+import org.apache.commons.lang.StringUtils;\n+import nl.nn.adapterframework.util.LogUtil;\n+import org.apache.logging.log4j.Logger;\n \n+import javax.xml.xpath.XPathExpressionException;\n+import java.io.IOException;\n /**", "originalCommit": "a2a1feec917ed294b81ab42bfa234be336439f91", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTQ2OTg5Mw==", "url": "https://github.com/ibissource/iaf/pull/520#discussion_r411469893", "bodyText": "Hier ook Ctrl-Shift-O", "author": "gvanbrakel", "createdAt": "2020-04-20T15:25:45Z", "path": "core/src/main/java/nl/nn/adapterframework/extensions/xfb/XfbSender.java", "diffHunk": "@@ -15,21 +15,20 @@\n */\n package nl.nn.adapterframework.extensions.xfb;\n \n-import java.io.File;\n-import java.io.IOException;\n-\n-import org.apache.commons.lang.StringUtils;\n-import org.apache.log4j.Logger;\n-\n import nl.nn.adapterframework.configuration.ConfigurationException;\n import nl.nn.adapterframework.core.IPipeLineSession;\n import nl.nn.adapterframework.core.SenderException;\n import nl.nn.adapterframework.core.TimeOutException;\n import nl.nn.adapterframework.senders.SenderWithParametersBase;\n import nl.nn.adapterframework.stream.Message;\n import nl.nn.adapterframework.util.FileUtils;\n-import nl.nn.adapterframework.util.LogUtil;\n import nl.nn.adapterframework.util.ProcessUtil;\n+import org.apache.commons.lang.StringUtils;\n+import nl.nn.adapterframework.util.LogUtil;\n+import org.apache.logging.log4j.Logger;\n+", "originalCommit": "a2a1feec917ed294b81ab42bfa234be336439f91", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTQ3Mzg3Ng==", "url": "https://github.com/ibissource/iaf/pull/520#discussion_r411473876", "bodyText": "Hier wil je wel een if(log.isLevelTerseEnabled()) denk ik", "author": "gvanbrakel", "createdAt": "2020-04-20T15:30:40Z", "path": "core/src/main/java/nl/nn/adapterframework/pipes/MessageSendingPipe.java", "diffHunk": "@@ -878,16 +879,14 @@ protected PipeRunResult sendMessage(Message input, IPipeLineSession session, ISe\n \t\t\t\t\t\t\tadapter.setLastExitState(getName(), System.currentTimeMillis(), exitState);\n \t\t\t\t\t\t}\n \t\t\t\t\t}\n-\t\t\t\t\tif (MsgLogUtil.getMsgLogLevelNum(adapter.getMsgLogLevel())>=MsgLogUtil.MSGLOG_LEVEL_TERSE) {\n \n-\t\t\t\t\t\tString duration;\n-\t\t\t\t\t\tif(msgLogHumanReadable) {\n-\t\t\t\t\t\t\tduration = Misc.getAge(startTime);\n-\t\t\t\t\t\t} else {\n-\t\t\t\t\t\t\tduration = Misc.getDurationInMs(startTime);\n-\t\t\t\t\t\t}\n-\t\t\t\t\t\tmsgLog.info(\"Sender [\" + sender.getName() + \"] class [\" + sender.getClass().getSimpleName() + \"] duration [\" + duration + \"] got exit-state [\" + exitState + \"]\");\n+\t\t\t\t\tString duration;\n+\t\t\t\t\tif(msgLogHumanReadable) {\n+\t\t\t\t\t\tduration = Misc.getAge(startTime);\n+\t\t\t\t\t} else {\n+\t\t\t\t\t\tduration = Misc.getDurationInMs(startTime);\n \t\t\t\t\t}\n+\t\t\t\t\tmsgLog.log(Level.toLevel(\"TERSE\"), String.format(\"Sender [%s] class [%s] duration [%s] got exit-state [%s]\", sender.getName(), ClassUtils.nameOf(sender), duration, exitState));", "originalCommit": "a2a1feec917ed294b81ab42bfa234be336439f91", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTQ3NTg4OQ==", "url": "https://github.com/ibissource/iaf/pull/520#discussion_r411475889", "bodyText": "Hier ook Ctrl-Shift-O", "author": "gvanbrakel", "createdAt": "2020-04-20T15:33:10Z", "path": "core/src/main/java/nl/nn/adapterframework/util/AppConstants.java", "diffHunk": "@@ -31,7 +31,8 @@\n import org.apache.commons.digester.substitution.VariableExpander;\n import org.apache.commons.io.FilenameUtils;\n import org.apache.commons.lang3.StringUtils;\n-import org.apache.log4j.Logger;\n+import nl.nn.adapterframework.util.LogUtil;\n+import org.apache.logging.log4j.Logger;", "originalCommit": "a2a1feec917ed294b81ab42bfa234be336439f91", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTQ3NjEyNA==", "url": "https://github.com/ibissource/iaf/pull/520#discussion_r411476124", "bodyText": "Hier ook Ctrl-Shift-O", "author": "gvanbrakel", "createdAt": "2020-04-20T15:33:27Z", "path": "core/src/main/java/nl/nn/adapterframework/util/ClassUtils.java", "diffHunk": "@@ -33,7 +33,8 @@\n \n import org.apache.commons.lang.builder.ReflectionToStringBuilder;\n import org.apache.commons.lang3.StringUtils;\n-import org.apache.log4j.Logger;\n+import nl.nn.adapterframework.util.LogUtil;\n+import org.apache.logging.log4j.Logger;", "originalCommit": "a2a1feec917ed294b81ab42bfa234be336439f91", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTQ3NjMxNw==", "url": "https://github.com/ibissource/iaf/pull/520#discussion_r411476317", "bodyText": "Hier ook Ctrl-Shift-O", "author": "gvanbrakel", "createdAt": "2020-04-20T15:33:42Z", "path": "core/src/main/java/nl/nn/adapterframework/util/CredentialFactory.java", "diffHunk": "@@ -38,7 +38,8 @@\n \n import org.apache.commons.lang.StringUtils;\n import org.apache.commons.lang.builder.ToStringBuilder;\n-import org.apache.log4j.Logger;\n+import nl.nn.adapterframework.util.LogUtil;\n+import org.apache.logging.log4j.Logger;", "originalCommit": "a2a1feec917ed294b81ab42bfa234be336439f91", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTQ3NjQxNA==", "url": "https://github.com/ibissource/iaf/pull/520#discussion_r411476414", "bodyText": "Hier ook Ctrl-Shift-O", "author": "gvanbrakel", "createdAt": "2020-04-20T15:33:50Z", "path": "core/src/main/java/nl/nn/adapterframework/util/DB2XMLWriter.java", "diffHunk": "@@ -23,7 +23,8 @@\n \n import nl.nn.adapterframework.core.SenderException;\n \n-import org.apache.log4j.Logger;\n+import nl.nn.adapterframework.util.LogUtil;\n+import org.apache.logging.log4j.Logger;\n ", "originalCommit": "a2a1feec917ed294b81ab42bfa234be336439f91", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTQ3NzI3MA==", "url": "https://github.com/ibissource/iaf/pull/520#discussion_r411477270", "bodyText": "Hier ook Ctrl-Shift-O", "author": "gvanbrakel", "createdAt": "2020-04-20T15:34:55Z", "path": "core/src/main/java/nl/nn/adapterframework/util/FileHandler.java", "diffHunk": "@@ -45,6 +44,7 @@\n import nl.nn.adapterframework.parameters.ParameterList;\n import nl.nn.adapterframework.parameters.ParameterValue;\n import nl.nn.adapterframework.parameters.ParameterValueList;\n+import org.apache.logging.log4j.Logger;\n import nl.nn.adapterframework.stream.Message;", "originalCommit": "a2a1feec917ed294b81ab42bfa234be336439f91", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTQ3NzUyMg==", "url": "https://github.com/ibissource/iaf/pull/520#discussion_r411477522", "bodyText": "Hier ook Ctrl-Shift-O", "author": "gvanbrakel", "createdAt": "2020-04-20T15:35:14Z", "path": "core/src/main/java/nl/nn/adapterframework/util/FileUtils.java", "diffHunk": "@@ -35,14 +35,14 @@\n import javax.servlet.http.HttpServletRequest;\n \n import org.apache.commons.lang.StringUtils;\n-import org.apache.log4j.Logger;\n \n import nl.nn.adapterframework.configuration.ConfigurationException;\n import nl.nn.adapterframework.core.IPipeLineSession;\n import nl.nn.adapterframework.core.ParameterException;\n import nl.nn.adapterframework.parameters.Parameter;\n import nl.nn.adapterframework.parameters.ParameterList;\n import nl.nn.adapterframework.parameters.ParameterValueList;\n+import org.apache.logging.log4j.Logger;", "originalCommit": "a2a1feec917ed294b81ab42bfa234be336439f91", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTQ4MDMwMA==", "url": "https://github.com/ibissource/iaf/pull/520#discussion_r411480300", "bodyText": "Hier ook Ctrl-Shift-O", "author": "gvanbrakel", "createdAt": "2020-04-20T15:38:48Z", "path": "core/src/main/java/nl/nn/adapterframework/webcontrol/api/ServerStatistics.java", "diffHunk": "@@ -54,15 +51,18 @@\n import nl.nn.adapterframework.core.IAdapter;\n import nl.nn.adapterframework.core.IReceiver;\n import nl.nn.adapterframework.core.ITransactionalStorage;\n-import nl.nn.adapterframework.extensions.log4j.IbisAppenderWrapper;\n+import nl.nn.adapterframework.logging.IbisMaskingLayout;\n import nl.nn.adapterframework.receivers.ReceiverBase;\n import nl.nn.adapterframework.util.AppConstants;\n import nl.nn.adapterframework.util.DateUtils;\n-import nl.nn.adapterframework.util.LogUtil;\n import nl.nn.adapterframework.util.MessageKeeper;\n import nl.nn.adapterframework.util.Misc;\n import nl.nn.adapterframework.util.ProcessMetrics;\n import nl.nn.adapterframework.util.RunStateEnum;\n+import org.apache.logging.log4j.Level;\n+import nl.nn.adapterframework.util.LogUtil;\n+import org.apache.logging.log4j.Logger;\n+import org.apache.logging.log4j.core.config.Configurator;", "originalCommit": "a2a1feec917ed294b81ab42bfa234be336439f91", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTQ4MTExNA==", "url": "https://github.com/ibissource/iaf/pull/520#discussion_r411481114", "bodyText": "Nou ja!", "author": "gvanbrakel", "createdAt": "2020-04-20T15:39:49Z", "path": "core/src/main/java/nl/nn/adapterframework/webcontrol/api/ServerStatistics.java", "diffHunk": "@@ -348,16 +335,15 @@ else if(key.equalsIgnoreCase(\"enableDebugger\")) {\n \t\t\t\tmsg.append(\"logIntermediaryResults changed from [\" + logIntermediary+ \"] to [\" + logIntermediaryResults + \"]\");\n \t\t}\n \n-\t\tif (iaw != null) {\n-\t\t\tif(iaw.getMaxMessageLength() != maxMessageLength) {\n-\t\t\t\tif(msg.length() > 0)\n-\t\t\t\t\tmsg.append(\", logMaxMessageLength from [\" + iaw.getMaxMessageLength() + \"] to [\" + maxMessageLength + \"]\");\n-\t\t\t\telse\n-\t\t\t\t\tmsg.append(\"logMaxMessageLength changed from [\" + iaw.getMaxMessageLength() + \"] to [\" + maxMessageLength + \"]\");\n-\t\t\t\tiaw.setMaxMessageLength(maxMessageLength);\n-\t\t\t}\n-\t\t}\n+\t\tif (maxMessageLength != IbisMaskingLayout.getMaxLength()) {\n+\t\t\tmsg.append(\", logMaxMessageLength changed from [\")\n+\t\t\t\t\t.append(IbisMaskingLayout.getMaxLength())\n+\t\t\t\t\t.append(\"] to [\")\n+\t\t\t\t\t.append(maxMessageLength)\n+\t\t\t\t\t.append(\"]\");", "originalCommit": "a2a1feec917ed294b81ab42bfa234be336439f91", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTQ4ODQ3OA==", "url": "https://github.com/ibissource/iaf/pull/520#discussion_r411488478", "bodyText": "Misschien wel handig om uit te leggen hoe dit werkt, in een commentaarregeltje", "author": "gvanbrakel", "createdAt": "2020-04-20T15:49:17Z", "path": "core/src/main/java/nl/nn/adapterframework/logging/IbisLoggerConfigurationFactory.java", "diffHunk": "@@ -0,0 +1,216 @@\n+/*\n+   Copyright 2020 WeAreFrank!\n+\n+   Licensed under the Apache License, Version 2.0 (the \"License\");\n+   you may not use this file except in compliance with the License.\n+   You may obtain a copy of the License at\n+\n+       http://www.apache.org/licenses/LICENSE-2.0\n+\n+   Unless required by applicable law or agreed to in writing, software\n+   distributed under the License is distributed on an \"AS IS\" BASIS,\n+   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+   See the License for the specific language governing permissions and\n+   limitations under the License.\n+*/\n+package nl.nn.adapterframework.logging;\n+\n+import java.io.BufferedReader;\n+import java.io.File;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.io.StringWriter;\n+import java.io.Writer;\n+import java.net.URL;\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.Properties;\n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+\n+import org.apache.logging.log4j.ThreadContext;\n+import org.apache.logging.log4j.core.LoggerContext;\n+import org.apache.logging.log4j.core.config.Configuration;\n+import org.apache.logging.log4j.core.config.ConfigurationFactory;\n+import org.apache.logging.log4j.core.config.ConfigurationSource;\n+import org.apache.logging.log4j.core.config.xml.XmlConfiguration;\n+import nl.nn.adapterframework.util.StreamUtil;\n+\n+/**\n+ * This ConfigurationFactory is loaded after the log4j2.properties file has been initialised.\n+ * Both Configurations are then combined via a CompositeConfiguration\n+ * \n+ * @author Murat Kaan Meral\n+ * @author Niels Meijer\n+ */\n+//@Order(1000)\n+//@Plugin(name = \"IbisLoggerConfigurationFactory\", category = ConfigurationFactory.CATEGORY)\n+public class IbisLoggerConfigurationFactory extends ConfigurationFactory {\n+\tpublic static final String LOG_PREFIX = \"IbisLoggerConfigurationFactory class \";\n+\tprivate static final String LOG4J_PROPS_FILE = \"log4j4ibis.properties\";\n+\tprivate static final String DS_PROPERTIES_FILE = \"DeploymentSpecifics.properties\";\n+\tprivate static String[] logDirectoryHierarchy = new String[] {\n+\t\t\t\"site.logdir\",\n+\t\t\t\"user.dir/logs\",\n+\t\t\t\"user.dir/log\",\n+\t\t\t\"jboss.server.base.dir/log\",\n+\t\t\t\"wtp.deploy/../logs\",\n+\t\t\t\"catalina.base/logs\"", "originalCommit": "a2a1feec917ed294b81ab42bfa234be336439f91", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "b66c16b3325eb093fed3223387290a8dddc277ab", "url": "https://github.com/ibissource/iaf/commit/b66c16b3325eb093fed3223387290a8dddc277ab", "message": "Make code Gerrit compliant", "committedDate": "2020-04-20T16:36:04Z", "type": "commit"}, {"oid": "52b2a90dd39f55482f949b9c332808e78b8c3516", "url": "https://github.com/ibissource/iaf/commit/52b2a90dd39f55482f949b9c332808e78b8c3516", "message": "Merge branch 'master' into logger-update", "committedDate": "2020-04-22T10:19:40Z", "type": "commit"}, {"oid": "5fef93ec1e685a21de0fd911218b0ab7ee0b4ea2", "url": "https://github.com/ibissource/iaf/commit/5fef93ec1e685a21de0fd911218b0ab7ee0b4ea2", "message": "Fix logger in FileSystemUtils", "committedDate": "2020-04-22T12:16:53Z", "type": "commit"}, {"oid": "c5a348c172e1f71cedcb750028853904abbab5e0", "url": "https://github.com/ibissource/iaf/commit/c5a348c172e1f71cedcb750028853904abbab5e0", "message": "Fix typo", "committedDate": "2020-04-22T16:44:00Z", "type": "commit"}]}