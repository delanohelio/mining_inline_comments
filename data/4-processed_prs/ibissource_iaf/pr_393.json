{"pr_number": 393, "pr_title": "Add possibility to put error details in ESB SOAP body response", "pr_createdAt": "2020-01-31T14:20:26Z", "pr_url": "https://github.com/ibissource/iaf/pull/393", "timeline": [{"oid": "9e2b378a5171affc0892871a6f9579c3615479b8", "url": "https://github.com/ibissource/iaf/commit/9e2b378a5171affc0892871a6f9579c3615479b8", "message": "Add possibility to put error details in ESB SOAP body response", "committedDate": "2020-01-31T14:18:10Z", "type": "commit"}, {"oid": "c66e0f16b6cb16774423dcb1aa7ac03bcf9465f1", "url": "https://github.com/ibissource/iaf/commit/c66e0f16b6cb16774423dcb1aa7ac03bcf9465f1", "message": "Do not commit this file", "committedDate": "2020-01-31T14:24:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzU5NDY0NQ==", "url": "https://github.com/ibissource/iaf/pull/393#discussion_r377594645", "bodyText": "Je kan niet zomaar voor elke Xslt een parameter 'environment' toevoegen, hier in de XsltSender.\nAls dit voor de EsbSoapWrapperPipe nodig is, dan moet je het daar doen.", "author": "gvanbrakel", "createdAt": "2020-02-11T12:06:41Z", "path": "core/src/main/java/nl/nn/adapterframework/senders/XsltSender.java", "diffHunk": "@@ -95,6 +96,13 @@\n \t */\n \t@Override\n \tpublic void configure() throws ConfigurationException {\n+\t\tParameterList parameterList = getParameterList();", "originalCommit": "c66e0f16b6cb16774423dcb1aa7ac03bcf9465f1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODI4NzA0OA==", "url": "https://github.com/ibissource/iaf/pull/393#discussion_r378287048", "bodyText": "Ja daar heb je eigenlijk wel gelijk in. Maar het leek me handig om dit generiek te maken omdat je het vaker nodig kunt hebben. Ik stel voor om een attribuut aan de XsltSender toe te voegen waarmee deze parameter toegevoegd wordt (addEnvironmentParameter, default is dan 'false').\nAccoord?", "author": "leeuw73", "createdAt": "2020-02-12T14:32:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzU5NDY0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzA2MDg5Ng==", "url": "https://github.com/ibissource/iaf/pull/393#discussion_r397060896", "bodyText": "Je kan toch ook gewoon een parameter aan je configuratie toevoegen als je hem nodig hebt.\nWaarom moet dit iets speciaals zijn?", "author": "gvanbrakel", "createdAt": "2020-03-24T10:50:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzU5NDY0NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzYwMTc2Mw==", "url": "https://github.com/ibissource/iaf/pull/393#discussion_r377601763", "bodyText": "De test op 'errorDetailCode' leek verdwenen te zijn, maar zag ik toch nog verder naar onderen. Wordt er ook getest dat de oude manier van werken ook nog werkt?", "author": "gvanbrakel", "createdAt": "2020-02-11T12:23:06Z", "path": "core/src/main/resources/xml/xsl/esb/soapBody.xsl", "diffHunk": "@@ -141,22 +150,62 @@\n \t\t\t\t\t\t\t\t\t</xsl:element>\n \t\t\t\t\t\t\t\t</xsl:element>\n \t\t\t\t\t\t\t</xsl:element>\n-\t\t\t\t\t\t\t<xsl:if test=\"string-length($errorDetailCode)&gt;0\">\n-\t\t\t\t\t\t\t\t<xsl:element name=\"DetailList\" namespace=\"{$ns}\">\n-\t\t\t\t\t\t\t\t\t<xsl:element name=\"Detail\" namespace=\"{$ns}\">\n-\t\t\t\t\t\t\t\t\t\t<xsl:element name=\"Code\" namespace=\"{$ns}\">\n-\t\t\t\t\t\t\t\t\t\t\t<xsl:value-of select=\"$errorDetailCode\"/>\n-\t\t\t\t\t\t\t\t\t\t</xsl:element>\n-\t\t\t\t\t\t\t\t\t\t<xsl:if test=\"string-length($errorDetailText)&gt;0\">\n+\t\t\t\t\t\t\t<xsl:choose>", "originalCommit": "c66e0f16b6cb16774423dcb1aa7ac03bcf9465f1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODI4NTYyMg==", "url": "https://github.com/ibissource/iaf/pull/393#discussion_r378285622", "bodyText": "Jazeker, dat zit in de testen van de adapter EsbSoapValidator", "author": "leeuw73", "createdAt": "2020-02-12T14:30:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzYwMTc2Mw=="}], "type": "inlineReview"}, {"oid": "b5ac8977abb008615124ceb5b440cd7b585206ea", "url": "https://github.com/ibissource/iaf/commit/b5ac8977abb008615124ceb5b440cd7b585206ea", "message": "Merge remote-tracking branch 'origin/master' into\nEsbSoapBodyErrorDetails\n\nConflicts:\n\tRELEASES.md", "committedDate": "2020-02-28T11:10:29Z", "type": "commit"}, {"oid": "4debe9488dce924c6b5b5919023616c2ce57a0ea", "url": "https://github.com/ibissource/iaf/commit/4debe9488dce924c6b5b5919023616c2ce57a0ea", "message": "[ci skip] Merge release notes", "committedDate": "2020-02-28T11:13:45Z", "type": "commit"}, {"oid": "d8997c4ebdb06180d7ff98d5b5d4879223a7a733", "url": "https://github.com/ibissource/iaf/commit/d8997c4ebdb06180d7ff98d5b5d4879223a7a733", "message": "Merge branch 'master' into EsbSoapBodyErrorDetails", "committedDate": "2020-02-28T14:39:22Z", "type": "commit"}, {"oid": "2efc7164041da708463932ec00492e7e6ffc6b7d", "url": "https://github.com/ibissource/iaf/commit/2efc7164041da708463932ec00492e7e6ffc6b7d", "message": "XsltSender/XsltPipe: new attribute addEnvironmentParameter", "committedDate": "2020-02-28T15:14:28Z", "type": "commit"}, {"oid": "9b0bc41fd941948909eb200fb8d5412a0457775a", "url": "https://github.com/ibissource/iaf/commit/9b0bc41fd941948909eb200fb8d5412a0457775a", "message": "Add comments for soapBody.xls", "committedDate": "2020-02-28T15:26:16Z", "type": "commit"}, {"oid": "76e72703f1d9ccab59f90f4b7bd21a8baf439596", "url": "https://github.com/ibissource/iaf/commit/76e72703f1d9ccab59f90f4b7bd21a8baf439596", "message": "Replace attribute addEnvironmentParameter by xslt parameter", "committedDate": "2020-03-25T14:08:34Z", "type": "commit"}, {"oid": "ad8f03c0f6325d8dfba354af6c04c4475aa5614f", "url": "https://github.com/ibissource/iaf/commit/ad8f03c0f6325d8dfba354af6c04c4475aa5614f", "message": "Remove free-ride change", "committedDate": "2020-03-25T14:12:57Z", "type": "commit"}, {"oid": "cdc69f2a38e499a04aa6b71d4b449e4155d098d3", "url": "https://github.com/ibissource/iaf/commit/cdc69f2a38e499a04aa6b71d4b449e4155d098d3", "message": "clarify ibisdoc", "committedDate": "2020-03-31T11:26:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzA1ODUzMA==", "url": "https://github.com/ibissource/iaf/pull/393#discussion_r397058530", "bodyText": "Is dit nodig voor deze aanpassing?", "author": "gvanbrakel", "createdAt": "2020-03-24T10:46:34Z", "path": "core/src/main/java/nl/nn/adapterframework/extensions/test/IbisTester.java", "diffHunk": "@@ -141,9 +141,13 @@ public void initTest() {\n \t\tSystem.setProperty(\"log.level\", \"INFO\");\n \t\tSystem.setProperty(\"dtap.stage\", \"LOC\");\n \t\tSystem.setProperty(\"application.server.type\", \"IBISTEST\");\n+\t\tSystem.setProperty(\"application.server.type.custom\", \"\");\n \t\tSystem.setProperty(\"flow.create.url\", \"\");\n \t\tdebug(\"***start***\");\n-\t\tibisContext = null;\n+\t\tif (ibisContext != null) {\n+\t\t\tibisContext.destroy();\n+\t\t\tibisContext = null;\n+\t\t}", "originalCommit": "9b0bc41fd941948909eb200fb8d5412a0457775a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzE5MTU3Mg==", "url": "https://github.com/ibissource/iaf/pull/393#discussion_r403191572", "bodyText": "Deze class is uit de PR", "author": "leeuw73", "createdAt": "2020-04-03T17:50:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzA1ODUzMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzA1OTQyMw==", "url": "https://github.com/ibissource/iaf/pull/393#discussion_r397059423", "bodyText": "Bij wat voor replacements gebeurt dit dan? En waarom dan?", "author": "gvanbrakel", "createdAt": "2020-03-24T10:48:13Z", "path": "core/src/main/java/nl/nn/adapterframework/pipes/AbstractPipe.java", "diffHunk": "@@ -497,6 +498,16 @@ public boolean isPreserveInput() {\n \t\treturn preserveInput;\n \t}\n \n+\t@IbisDoc({\"6\", \"when set, the original input (which will be replaced) is stored under this session key\", \"\"})", "originalCommit": "9b0bc41fd941948909eb200fb8d5412a0457775a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzE5MTg3OA==", "url": "https://github.com/ibissource/iaf/pull/393#discussion_r403191878", "bodyText": "Attribuut heb ik verwijderd", "author": "leeuw73", "createdAt": "2020-04-03T17:50:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzA1OTQyMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDgzODUwMw==", "url": "https://github.com/ibissource/iaf/pull/393#discussion_r400838503", "bodyText": "Ik zie dat je ERROR_1, ERROR_2 e.d. als code gebruikt. Ik denk dat het handiger is om in die gevallen alleen 'ERROR' te gebruiken, omdat je dan xpath queries kan doen als /DetailList/Detail[Code='ERROR']/Text.", "author": "gvanbrakel", "createdAt": "2020-03-31T11:28:54Z", "path": "core/src/main/resources/xml/xsl/esb/soapBody.xsl", "diffHunk": "@@ -141,22 +155,62 @@\n \t\t\t\t\t\t\t\t\t</xsl:element>\n \t\t\t\t\t\t\t\t</xsl:element>\n \t\t\t\t\t\t\t</xsl:element>\n-\t\t\t\t\t\t\t<xsl:if test=\"string-length($errorDetailCode)&gt;0\">\n-\t\t\t\t\t\t\t\t<xsl:element name=\"DetailList\" namespace=\"{$ns}\">\n-\t\t\t\t\t\t\t\t\t<xsl:element name=\"Detail\" namespace=\"{$ns}\">\n-\t\t\t\t\t\t\t\t\t\t<xsl:element name=\"Code\" namespace=\"{$ns}\">\n-\t\t\t\t\t\t\t\t\t\t\t<xsl:value-of select=\"$errorDetailCode\"/>\n-\t\t\t\t\t\t\t\t\t\t</xsl:element>\n-\t\t\t\t\t\t\t\t\t\t<xsl:if test=\"string-length($errorDetailText)&gt;0\">\n+\t\t\t\t\t\t\t<xsl:choose>\n+\t\t\t\t\t\t\t\t<xsl:when test=\"$addErrorsFromInputMessage='true' and string-length($errorRootTag)&gt;0 and $rootTag='errorMessage'\">\n+\t\t\t\t\t\t\t\t\t<xsl:element name=\"DetailList\" namespace=\"{$ns}\">\n+\t\t\t\t\t\t\t\t\t\t<xsl:element name=\"Detail\" namespace=\"{$ns}\">\n+\t\t\t\t\t\t\t\t\t\t\t<xsl:element name=\"Code\" namespace=\"{$ns}\">\n+\t\t\t\t\t\t\t\t\t\t\t\t<xsl:text>ERROR_1</xsl:text>", "originalCommit": "cdc69f2a38e499a04aa6b71d4b449e4155d098d3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzE5MjIxNQ==", "url": "https://github.com/ibissource/iaf/pull/393#discussion_r403192215", "bodyText": "Aangepast zoals door jou voorgesteld", "author": "leeuw73", "createdAt": "2020-04-03T17:50:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDgzODUwMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDg1NDAwNA==", "url": "https://github.com/ibissource/iaf/pull/393#discussion_r400854004", "bodyText": "Hier gebruik je storeReplacedInputInSessionKey i.c.m. getInputFromSessionKey=\"xmlFailureReason\".\nVervolgens gebruik je de originele input als parameter.\nDat kan natuurlijk ook andersom, dat je de orignele input de input laat zijn, en de failure reason als parameter.\nDan is storeReplacedInputInSessionKey niet nodig.", "author": "gvanbrakel", "createdAt": "2020-03-31T11:57:47Z", "path": "test/src/main/configurations/MainConfig/ConfigurationSoapValidator.xml", "diffHunk": "@@ -0,0 +1,42 @@\n+\n+<adapter name=\"SoapValidator\">\n+\t<receiver className=\"nl.nn.adapterframework.receivers.GenericReceiver\" name=\"SoapValidator\">\n+\t\t<listener className=\"nl.nn.adapterframework.receivers.JavaListener\" serviceName=\"ibis4test-SoapValidator\" throwException=\"false\" />\n+\t</receiver>\n+\t<pipeline firstPipe=\"HelloWorld\">\n+\t\t<exits>\n+\t\t\t<exit path=\"EXIT\" state=\"success\" />\n+\t\t</exits>\n+\t\t<inputValidator className=\"nl.nn.adapterframework.soap.SoapValidator\" schemaLocation=\"http://api.nn.nl/HelloWorld /SoapValidator/xsd/HelloWorld.xsd\" soapBody=\"HelloWorld_Request\" addNamespaceToSchema=\"true\">\n+\t\t\t<forward name=\"failure\" path=\"InputValidatorFailure\" />\n+\t\t</inputValidator>\n+\t\t<inputWrapper className=\"nl.nn.adapterframework.extensions.api.ApiSoapWrapperPipe\" direction=\"unwrap\" />\n+\t\t<outputWrapper className=\"nl.nn.adapterframework.extensions.api.ApiSoapWrapperPipe\" outputNamespace=\"http://api.nn.nl/HelloWorld\" root=\"HelloWorld_Response\" />\n+\t\t<outputValidator className=\"nl.nn.adapterframework.soap.SoapValidator\" schemaLocation=\"http://api.nn.nl/HelloWorld /SoapValidator/xsd/HelloWorld.xsd\" soapBody=\"HelloWorld_Response\" addNamespaceToSchema=\"true\">\n+\t\t\t<forward name=\"failure\" path=\"OutputValidatorFailure\" />\n+\t\t</outputValidator>\n+\t\t<pipe name=\"InputValidatorFailure\" className=\"nl.nn.adapterframework.pipes.XsltPipe\" styleSheetName=\"xml/xsl/esb/soapBody.xsl\" xslt2=\"true\" getInputFromSessionKey=\"xmlFailureReason\" storeReplacedInputInSessionKey=\"replacedInput\">\n+\t\t\t<param name=\"cmhVersion\" value=\"1\" />\n+\t\t\t<param name=\"errorCode\" value=\"ERR6003\" />\n+\t\t\t<param name=\"errorReason\" value=\"Invalid Request\" />\n+\t\t\t<param name=\"errorRootTag\" value=\"HelloWorld_Response\" />\n+\t\t\t<param name=\"originalMessage\" sessionKey=\"replacedInput\" />\n+\t\t\t<param name=\"addErrorsFromInputMessage\" value=\"true\" />\n+\t\t\t<param name=\"operationName\" value=\"Test/SoapValidator\" />\n+\t\t\t<param name=\"paradigm\" value=\"Response\" />\n+\t\t\t<forward name=\"success\" path=\"EXIT\" />\n+\t\t</pipe>", "originalCommit": "cdc69f2a38e499a04aa6b71d4b449e4155d098d3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzE5MjU3MQ==", "url": "https://github.com/ibissource/iaf/pull/393#discussion_r403192571", "bodyText": "Aangepast zoals door jou voorgesteld", "author": "leeuw73", "createdAt": "2020-04-03T17:51:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDg1NDAwNA=="}], "type": "inlineReview"}, {"oid": "7f3cc4d3249bd871aba9c1c44466b96f0f2039f6", "url": "https://github.com/ibissource/iaf/commit/7f3cc4d3249bd871aba9c1c44466b96f0f2039f6", "message": "Remove attribute storeReplacedInputInSessionKey\n\nAnd remove ERROR counter suffix", "committedDate": "2020-04-03T17:45:42Z", "type": "commit"}, {"oid": "5d715ba741057dd81ab14fe53cbc60d8aa394d85", "url": "https://github.com/ibissource/iaf/commit/5d715ba741057dd81ab14fe53cbc60d8aa394d85", "message": "Forgotten Larva scenario", "committedDate": "2020-04-04T07:48:36Z", "type": "commit"}, {"oid": "6ee2e3c197bf8dbb6bf92309c58931e1e0981feb", "url": "https://github.com/ibissource/iaf/commit/6ee2e3c197bf8dbb6bf92309c58931e1e0981feb", "message": "Merge branch 'master' into EsbSoapBodyErrorDetails", "committedDate": "2020-04-15T13:35:47Z", "type": "commit"}]}