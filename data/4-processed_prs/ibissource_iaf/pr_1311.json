{"pr_number": 1311, "pr_title": "Refactor stub4testtool.xsl", "pr_createdAt": "2020-12-02T15:35:26Z", "pr_url": "https://github.com/ibissource/iaf/pull/1311", "timeline": [{"oid": "0de851f4dc922516f68c35ef1076da8be0ce97be", "url": "https://github.com/ibissource/iaf/commit/0de851f4dc922516f68c35ef1076da8be0ce97be", "message": "Refactor choose to separate templates (excluding receivers/pipelines/senders)", "committedDate": "2020-12-01T15:42:15Z", "type": "commit"}, {"oid": "6f76df5b43087ad89f51f582d531105654ab6400", "url": "https://github.com/ibissource/iaf/commit/6f76df5b43087ad89f51f582d531105654ab6400", "message": "Small XSLT fixes + refactor pipeline and receiver stubbing, and start sender refactoring (stub is not complete yet)", "committedDate": "2020-12-03T13:49:44Z", "type": "commit"}, {"oid": "6f76df5b43087ad89f51f582d531105654ab6400", "url": "https://github.com/ibissource/iaf/commit/6f76df5b43087ad89f51f582d531105654ab6400", "message": "Small XSLT fixes + refactor pipeline and receiver stubbing, and start sender refactoring (stub is not complete yet)", "committedDate": "2020-12-03T13:49:44Z", "type": "forcePushed"}, {"oid": "6f245518efa93487fc4cfc78a286fa0e19e5b497", "url": "https://github.com/ibissource/iaf/commit/6f245518efa93487fc4cfc78a286fa0e19e5b497", "message": "First step stubbing senders", "committedDate": "2020-12-04T14:22:11Z", "type": "commit"}, {"oid": "d63ea143d7a58f2dbb0355f0ecc2e96d01247d2a", "url": "https://github.com/ibissource/iaf/commit/d63ea143d7a58f2dbb0355f0ecc2e96d01247d2a", "message": "Stub naming + small fixes", "committedDate": "2020-12-07T08:32:21Z", "type": "commit"}, {"oid": "1a228a99b743041dc9318bdfd7e3dda0c09cc871", "url": "https://github.com/ibissource/iaf/commit/1a228a99b743041dc9318bdfd7e3dda0c09cc871", "message": "Invert sender stub name ordering", "committedDate": "2020-12-07T08:36:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODE2NDYzOA==", "url": "https://github.com/ibissource/iaf/pull/1311#discussion_r538164638", "bodyText": "Zou je hier een comment bij kunnen zetten dat deze Listeners als uitzondering niet gestubt worden, en alle overige wel?", "author": "gvanbrakel", "createdAt": "2020-12-08T09:14:23Z", "path": "core/src/main/resources/xml/xsl/stub4testtool.xsl", "diffHunk": "@@ -25,321 +25,320 @@\n \t<xsl:template match=\"/\">\n \t\t<xsl:apply-templates select=\"*|@*|comment()|processing-instruction()\" />\n \t</xsl:template>\n+\t\n \t<xsl:template match=\"*|@*|comment()|processing-instruction()\">\n-\t\t<xsl:choose>\n-\t\t\t<xsl:when test=\"name()='receiver'\">\n-\t\t\t\t<xsl:choose>\n-\t\t\t\t\t<xsl:when test=\"listener[@className='nl.nn.adapterframework.jdbc.JdbcQueryListener']\">\n-\t\t\t\t\t\t<xsl:call-template name=\"copy\" />\n-\t\t\t\t\t</xsl:when>\n-\t\t\t\t\t<xsl:when test=\"listener[@className='nl.nn.adapterframework.receivers.DirectoryListener']\">\n-\t\t\t\t\t\t<xsl:call-template name=\"copy\" />\n-\t\t\t\t\t</xsl:when>\n-\t\t\t\t\t<xsl:when test=\"listener[@className='nl.nn.adapterframework.receivers.JavaListener']\">\n-\t\t\t\t\t\t<xsl:call-template name=\"copy\" />\n-\t\t\t\t\t</xsl:when>\n-\t\t\t\t\t<xsl:when test=\"listener[@className='nl.nn.adapterframework.http.WebServiceListener']\">\n-\t\t\t\t\t\t<xsl:call-template name=\"copy\" />\n-\t\t\t\t\t</xsl:when>\n-\t\t\t\t\t<xsl:when test=\"listener[@className='nl.nn.adapterframework.http.RestListener']\">\n-\t\t\t\t\t\t<xsl:call-template name=\"copy\" />\n-\t\t\t\t\t</xsl:when>\n-\t\t\t\t\t<xsl:when test=\"listener[@className='nl.nn.adapterframework.jdbc.MessageStoreListener']\">\n-\t\t\t\t\t\t<xsl:call-template name=\"copy\" />\n-\t\t\t\t\t</xsl:when>\n-\t\t\t\t\t<xsl:when test=\"listener[@className='nl.nn.adapterframework.http.rest.ApiListener']\">\n-\t\t\t\t\t\t<xsl:call-template name=\"copy\" />\n-\t\t\t\t\t</xsl:when>\n-\t\t\t\t\t<xsl:otherwise>\n-\t\t\t\t\t\t<xsl:call-template name=\"disable\" />\n-\t\t\t\t\t</xsl:otherwise>\n-\t\t\t\t</xsl:choose>\n-\t\t\t</xsl:when>\n-\t\t\t<xsl:when test=\"name()='pipeline'\">\n-\t\t\t\t<xsl:element name=\"receiver\">\n-\t\t\t\t\t<xsl:attribute name=\"name\">\n-\t\t\t\t\t\t<xsl:value-of select=\"concat('testtool-',parent::*[name()='adapter']/@name)\" />\n-\t\t\t\t\t</xsl:attribute>\n-\t\t\t\t\t<xsl:apply-templates select=\"parent::*[name()='adapter']/receiver/@*[name()!='transactionAttribute']\" />\n-\t\t\t\t\t<xsl:element name=\"listener\">\n-\t\t\t\t\t\t<xsl:attribute name=\"className\">nl.nn.adapterframework.receivers.JavaListener</xsl:attribute>\n-\t\t\t\t\t\t<xsl:attribute name=\"serviceName\">\n-\t\t\t\t\t\t\t<xsl:value-of select=\"concat('testtool-',parent::*[name()='adapter']/@name)\" />\n-\t\t\t\t\t\t</xsl:attribute>\n-\t\t\t\t\t\t<xsl:if test=\"parent::*[name()='adapter']/errorMessageFormatter\">\n-\t\t\t\t\t\t\t<xsl:attribute name=\"throwException\">false</xsl:attribute>\n-\t\t\t\t\t\t</xsl:if>\n-\t\t\t\t\t</xsl:element>\n-\t\t\t\t\t<xsl:for-each select=\"parent::*[name()='adapter']/receiver/errorStorage[@className='nl.nn.adapterframework.jdbc.JdbcTransactionalStorage' or @className='nl.nn.adapterframework.jdbc.DummyTransactionalStorage']\">\n-\t\t\t\t\t\t<xsl:if test=\"position()=1\">\n-\t\t\t\t\t\t\t<xsl:copy-of select=\".\" />\n-\t\t\t\t\t\t</xsl:if>\n-\t\t\t\t\t</xsl:for-each>\n-\t\t\t\t\t<xsl:for-each select=\"parent::*[name()='adapter']/receiver/errorSender[@className='nl.nn.adapterframework.senders.IbisLocalSender']\">\n-\t\t\t\t\t\t<xsl:if test=\"position()=1\">\n-\t\t\t\t\t\t\t<xsl:copy-of select=\".\" />\n-\t\t\t\t\t\t</xsl:if>\n-\t\t\t\t\t</xsl:for-each>\n-\t\t\t\t\t<xsl:for-each select=\"parent::*[name()='adapter']/receiver/messageLog[@className='nl.nn.adapterframework.jdbc.JdbcTransactionalStorage' or @className='nl.nn.adapterframework.jdbc.DummyTransactionalStorage']\">\n-\t\t\t\t\t\t<xsl:if test=\"position()=1\">\n-\t\t\t\t\t\t\t<xsl:copy-of select=\".\" />\n-\t\t\t\t\t\t</xsl:if>\n-\t\t\t\t\t</xsl:for-each>\n-\t\t\t\t</xsl:element>\n-\t\t\t\t<xsl:call-template name=\"copy\" />\n-\t\t\t</xsl:when>\n-\t\t\t<xsl:when test=\"name()='listener'\">\n+\t\t<xsl:call-template name=\"copy\" />\n+\t</xsl:template>\n+\t\n+\t<xsl:template match=\"adapter\">\n+\t\t<xsl:element name=\"adapter\">\n+\t\t\t<xsl:apply-templates select=\"@*\" />\n+\t\t\t<xsl:for-each select=\"receiver[1]\">\n+\t\t\t\t<xsl:call-template name=\"stubReceiver\">\n+\t\t\t\t\t<xsl:with-param name=\"isAdapterStub\" select=\"true()\"/>\n+\t\t\t\t</xsl:call-template>\n+\t\t\t</xsl:for-each>\n+\t\t\t<xsl:apply-templates select=\"*|comment()|processing-instruction()|text()\" />\n+\t\t</xsl:element>\n+\t</xsl:template>\n+\t\n+\t<xsl:template match=\"receiver[listener[@className='nl.nn.adapterframework.jdbc.JdbcQueryListener'\n+\t\t\t\t\t\t\t\t\t\tor @className='nl.nn.adapterframework.receivers.DirectoryListener'\n+\t\t\t\t\t\t\t\t\t\tor @className='nl.nn.adapterframework.receivers.JavaListener'\n+\t\t\t\t\t\t\t\t\t\tor @className='nl.nn.adapterframework.http.WebServiceListener'\n+\t\t\t\t\t\t\t\t\t\tor @className='nl.nn.adapterframework.http.RestListener'\n+\t\t\t\t\t\t\t\t\t\tor @className='nl.nn.adapterframework.jdbc.MessageStoreListener'\n+\t\t\t\t\t\t\t\t\t\tor @className='nl.nn.adapterframework.http.rest.ApiListener']]\">", "originalCommit": "1a228a99b743041dc9318bdfd7e3dda0c09cc871", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODE2NTk3MQ==", "url": "https://github.com/ibissource/iaf/pull/1311#discussion_r538165971", "bodyText": "Zou je hier een comment bij kunnen zetten dat deze Senders als uitzondering niet gestubt worden, en alle overige wel?", "author": "gvanbrakel", "createdAt": "2020-12-08T09:16:14Z", "path": "core/src/main/resources/xml/xsl/stub4testtool.xsl", "diffHunk": "@@ -25,321 +25,320 @@\n \t<xsl:template match=\"/\">\n \t\t<xsl:apply-templates select=\"*|@*|comment()|processing-instruction()\" />\n \t</xsl:template>\n+\t\n \t<xsl:template match=\"*|@*|comment()|processing-instruction()\">\n-\t\t<xsl:choose>\n-\t\t\t<xsl:when test=\"name()='receiver'\">\n-\t\t\t\t<xsl:choose>\n-\t\t\t\t\t<xsl:when test=\"listener[@className='nl.nn.adapterframework.jdbc.JdbcQueryListener']\">\n-\t\t\t\t\t\t<xsl:call-template name=\"copy\" />\n-\t\t\t\t\t</xsl:when>\n-\t\t\t\t\t<xsl:when test=\"listener[@className='nl.nn.adapterframework.receivers.DirectoryListener']\">\n-\t\t\t\t\t\t<xsl:call-template name=\"copy\" />\n-\t\t\t\t\t</xsl:when>\n-\t\t\t\t\t<xsl:when test=\"listener[@className='nl.nn.adapterframework.receivers.JavaListener']\">\n-\t\t\t\t\t\t<xsl:call-template name=\"copy\" />\n-\t\t\t\t\t</xsl:when>\n-\t\t\t\t\t<xsl:when test=\"listener[@className='nl.nn.adapterframework.http.WebServiceListener']\">\n-\t\t\t\t\t\t<xsl:call-template name=\"copy\" />\n-\t\t\t\t\t</xsl:when>\n-\t\t\t\t\t<xsl:when test=\"listener[@className='nl.nn.adapterframework.http.RestListener']\">\n-\t\t\t\t\t\t<xsl:call-template name=\"copy\" />\n-\t\t\t\t\t</xsl:when>\n-\t\t\t\t\t<xsl:when test=\"listener[@className='nl.nn.adapterframework.jdbc.MessageStoreListener']\">\n-\t\t\t\t\t\t<xsl:call-template name=\"copy\" />\n-\t\t\t\t\t</xsl:when>\n-\t\t\t\t\t<xsl:when test=\"listener[@className='nl.nn.adapterframework.http.rest.ApiListener']\">\n-\t\t\t\t\t\t<xsl:call-template name=\"copy\" />\n-\t\t\t\t\t</xsl:when>\n-\t\t\t\t\t<xsl:otherwise>\n-\t\t\t\t\t\t<xsl:call-template name=\"disable\" />\n-\t\t\t\t\t</xsl:otherwise>\n-\t\t\t\t</xsl:choose>\n-\t\t\t</xsl:when>\n-\t\t\t<xsl:when test=\"name()='pipeline'\">\n-\t\t\t\t<xsl:element name=\"receiver\">\n-\t\t\t\t\t<xsl:attribute name=\"name\">\n-\t\t\t\t\t\t<xsl:value-of select=\"concat('testtool-',parent::*[name()='adapter']/@name)\" />\n-\t\t\t\t\t</xsl:attribute>\n-\t\t\t\t\t<xsl:apply-templates select=\"parent::*[name()='adapter']/receiver/@*[name()!='transactionAttribute']\" />\n-\t\t\t\t\t<xsl:element name=\"listener\">\n-\t\t\t\t\t\t<xsl:attribute name=\"className\">nl.nn.adapterframework.receivers.JavaListener</xsl:attribute>\n-\t\t\t\t\t\t<xsl:attribute name=\"serviceName\">\n-\t\t\t\t\t\t\t<xsl:value-of select=\"concat('testtool-',parent::*[name()='adapter']/@name)\" />\n-\t\t\t\t\t\t</xsl:attribute>\n-\t\t\t\t\t\t<xsl:if test=\"parent::*[name()='adapter']/errorMessageFormatter\">\n-\t\t\t\t\t\t\t<xsl:attribute name=\"throwException\">false</xsl:attribute>\n-\t\t\t\t\t\t</xsl:if>\n-\t\t\t\t\t</xsl:element>\n-\t\t\t\t\t<xsl:for-each select=\"parent::*[name()='adapter']/receiver/errorStorage[@className='nl.nn.adapterframework.jdbc.JdbcTransactionalStorage' or @className='nl.nn.adapterframework.jdbc.DummyTransactionalStorage']\">\n-\t\t\t\t\t\t<xsl:if test=\"position()=1\">\n-\t\t\t\t\t\t\t<xsl:copy-of select=\".\" />\n-\t\t\t\t\t\t</xsl:if>\n-\t\t\t\t\t</xsl:for-each>\n-\t\t\t\t\t<xsl:for-each select=\"parent::*[name()='adapter']/receiver/errorSender[@className='nl.nn.adapterframework.senders.IbisLocalSender']\">\n-\t\t\t\t\t\t<xsl:if test=\"position()=1\">\n-\t\t\t\t\t\t\t<xsl:copy-of select=\".\" />\n-\t\t\t\t\t\t</xsl:if>\n-\t\t\t\t\t</xsl:for-each>\n-\t\t\t\t\t<xsl:for-each select=\"parent::*[name()='adapter']/receiver/messageLog[@className='nl.nn.adapterframework.jdbc.JdbcTransactionalStorage' or @className='nl.nn.adapterframework.jdbc.DummyTransactionalStorage']\">\n-\t\t\t\t\t\t<xsl:if test=\"position()=1\">\n-\t\t\t\t\t\t\t<xsl:copy-of select=\".\" />\n-\t\t\t\t\t\t</xsl:if>\n-\t\t\t\t\t</xsl:for-each>\n-\t\t\t\t</xsl:element>\n-\t\t\t\t<xsl:call-template name=\"copy\" />\n-\t\t\t</xsl:when>\n-\t\t\t<xsl:when test=\"name()='listener'\">\n+\t\t<xsl:call-template name=\"copy\" />\n+\t</xsl:template>\n+\t\n+\t<xsl:template match=\"adapter\">\n+\t\t<xsl:element name=\"adapter\">\n+\t\t\t<xsl:apply-templates select=\"@*\" />\n+\t\t\t<xsl:for-each select=\"receiver[1]\">\n+\t\t\t\t<xsl:call-template name=\"stubReceiver\">\n+\t\t\t\t\t<xsl:with-param name=\"isAdapterStub\" select=\"true()\"/>\n+\t\t\t\t</xsl:call-template>\n+\t\t\t</xsl:for-each>\n+\t\t\t<xsl:apply-templates select=\"*|comment()|processing-instruction()|text()\" />\n+\t\t</xsl:element>\n+\t</xsl:template>\n+\t\n+\t<xsl:template match=\"receiver[listener[@className='nl.nn.adapterframework.jdbc.JdbcQueryListener'\n+\t\t\t\t\t\t\t\t\t\tor @className='nl.nn.adapterframework.receivers.DirectoryListener'\n+\t\t\t\t\t\t\t\t\t\tor @className='nl.nn.adapterframework.receivers.JavaListener'\n+\t\t\t\t\t\t\t\t\t\tor @className='nl.nn.adapterframework.http.WebServiceListener'\n+\t\t\t\t\t\t\t\t\t\tor @className='nl.nn.adapterframework.http.RestListener'\n+\t\t\t\t\t\t\t\t\t\tor @className='nl.nn.adapterframework.jdbc.MessageStoreListener'\n+\t\t\t\t\t\t\t\t\t\tor @className='nl.nn.adapterframework.http.rest.ApiListener']]\">\n+\t\t<xsl:call-template name=\"copy\" />\n+\t\t<xsl:call-template name=\"stubReceiver\">\n+\t\t\t<xsl:with-param name=\"isAdapterStub\" select=\"false()\"/>\n+\t\t</xsl:call-template>\n+\t</xsl:template>\n+\t\n+\t<xsl:template match=\"receiver\">\n+\t\t<xsl:call-template name=\"disable\" />\n+\t\t<xsl:call-template name=\"stubReceiver\">\n+\t\t\t<xsl:with-param name=\"isAdapterStub\" select=\"false()\"/>\n+\t\t</xsl:call-template>\n+\t</xsl:template>\t\n+\t\n+\t<xsl:template name=\"stubReceiver\">\n+\t\t<xsl:param name=\"isAdapterStub\" as=\"xs:boolean\"/>\n+\n+\t\t<xsl:variable name=\"receiverName\">\n+\t\t\t<xsl:choose>\n+\t\t\t\t<xsl:when test=\"$isAdapterStub\">\n+\t\t\t\t\t<xsl:value-of select=\"parent::adapter/@name\"/>\n+\t\t\t\t</xsl:when>\n+\t\t\t\t<xsl:otherwise>\n+\t\t\t\t\t<xsl:value-of select=\"string-join((parent::adapter/@name,xs:string(count(preceding-sibling::receiver)+1)),'-')\"/>\n+\t\t\t\t</xsl:otherwise>\n+\t\t\t</xsl:choose>\n+\t\t</xsl:variable>\n+\t\t\n+\t\t<xsl:element name=\"receiver\">\n+\t\t\t<xsl:attribute name=\"name\">\n+\t\t\t\t<xsl:value-of select=\"concat('testtool-',$receiverName)\" />\n+\t\t\t</xsl:attribute>\n+\t\t\t<xsl:apply-templates select=\"@*[name()!='transactionAttribute' and name() !='name']\" />\n+\t\t\t<xsl:element name=\"listener\">\n+\t\t\t\t<xsl:attribute name=\"className\">nl.nn.adapterframework.receivers.JavaListener</xsl:attribute>\n+\t\t\t\t<xsl:attribute name=\"serviceName\">\n+\t\t\t\t\t<xsl:value-of select=\"concat('testtool-',$receiverName)\" />\n+\t\t\t\t</xsl:attribute>\n+\t\t\t\t<xsl:if test=\"parent::*[adapter]/errorMessageFormatter\">\n+\t\t\t\t\t<xsl:attribute name=\"throwException\">false</xsl:attribute>\n+\t\t\t\t</xsl:if>\n+\t\t\t</xsl:element>\n+\t\t\t<xsl:copy-of select=\"errorStorage[@className='nl.nn.adapterframework.jdbc.JdbcTransactionalStorage' or @className='nl.nn.adapterframework.jdbc.DummyTransactionalStorage']\"/>\n+\t\t\t<xsl:copy-of select=\"errorSender[@className='nl.nn.adapterframework.senders.IbisLocalSender']\"/>\n+\t\t\t<xsl:copy-of select=\"messageLog[@className='nl.nn.adapterframework.jdbc.JdbcTransactionalStorage' or @className='nl.nn.adapterframework.jdbc.DummyTransactionalStorage']\"/>\n+\t\t</xsl:element>\n+\t</xsl:template>\n+\t\n+\t<xsl:template match=\"sender[   @className='nl.nn.adapterframework.jdbc.ResultSet2FileSender'", "originalCommit": "1a228a99b743041dc9318bdfd7e3dda0c09cc871", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "1ad2edcc2a0f85ae62e3fd3b7e9440f25b18d8d3", "url": "https://github.com/ibissource/iaf/commit/1ad2edcc2a0f85ae62e3fd3b7e9440f25b18d8d3", "message": "Added comments", "committedDate": "2020-12-08T14:57:38Z", "type": "commit"}, {"oid": "db34b73376e4f7341b4ab943485a06bb2f3d4eed", "url": "https://github.com/ibissource/iaf/commit/db34b73376e4f7341b4ab943485a06bb2f3d4eed", "message": "Correct validator, pipe/errorStorage and pipe/messageLog matches", "committedDate": "2020-12-08T15:22:31Z", "type": "commit"}]}