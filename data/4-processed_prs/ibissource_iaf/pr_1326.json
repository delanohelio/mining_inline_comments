{"pr_number": 1326, "pr_title": "Fix #1033 Update adapter2dot xsl file", "pr_createdAt": "2020-12-08T13:03:50Z", "pr_url": "https://github.com/ibissource/iaf/pull/1326", "timeline": [{"oid": "73416ff442d56789277dc2095e6731a0085dd930", "url": "https://github.com/ibissource/iaf/commit/73416ff442d56789277dc2095e6731a0085dd930", "message": "Fix #1033", "committedDate": "2020-12-08T12:57:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODM4NjY5OQ==", "url": "https://github.com/ibissource/iaf/pull/1326#discussion_r538386699", "bodyText": "The // operator searches the whole document for (in this case) a pipe element.\nI think the following would be better:\nselect=\"pipe[1]/@name\"", "author": "gvanbrakel", "createdAt": "2020-12-08T13:46:25Z", "path": "core/src/main/resources/xsl/adapter2dot.xsl", "diffHunk": "@@ -39,7 +39,14 @@\n \t\t</xsl:choose>\n \t\t<xsl:value-of select=\"$space\" />\n \t\t<xsl:text>&quot;</xsl:text>\n-\t\t<xsl:value-of select=\"@firstPipe\" />\n+\t\t<xsl:choose>\n+\t\t\t<xsl:when test=\"string-length(@firstPipe) > 0\">\n+\t\t\t\t<xsl:value-of select=\"@firstPipe\" />\n+\t\t\t</xsl:when>\n+\t\t\t<xsl:otherwise>\n+\t\t\t\t<xsl:value-of select=\"//pipe[1]/@name\" />", "originalCommit": "73416ff442d56789277dc2095e6731a0085dd930", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODQwMDM3Ng==", "url": "https://github.com/ibissource/iaf/pull/1326#discussion_r538400376", "bodyText": "I think you'll need to calculate the 'next' pipe in the pipeline, using following-sibling::*[1]/@name", "author": "gvanbrakel", "createdAt": "2020-12-08T13:57:23Z", "path": "core/src/main/resources/xsl/adapter2dot.xsl", "diffHunk": "@@ -98,41 +105,41 @@\n \t\t\t\t<xsl:value-of select=\"$space\" />\n \t\t\t\t<xsl:text>[shape=diamond]</xsl:text>\n \t\t\t\t<xsl:text>&#10;</xsl:text>\n-\t\t\t\t<xsl:variable name=\"nffn\" select=\"@notFoundForwardName\" />\n-\t\t\t\t<xsl:if test=\"string-length($nffn)&gt;0 and (forward/@name=$nffn)=false()\">\n+\t\t\t\t<xsl:variable name=\"notFoundForwardName\" select=\"@notFoundForwardName\" />\n+\t\t\t\t<xsl:if test=\"string-length($notFoundForwardName)&gt;0 and (forward/@name=$notFoundForwardName)=false()\">\n \t\t\t\t\t<xsl:call-template name=\"forward\">\n \t\t\t\t\t\t<xsl:with-param name=\"pipeName\" select=\"@name\" />\n-\t\t\t\t\t\t<xsl:with-param name=\"forwardPath\" select=\"$nffn\" />\n+\t\t\t\t\t\t<xsl:with-param name=\"forwardPath\" select=\"$notFoundForwardName\" />\n \t\t\t\t\t\t<xsl:with-param name=\"forwardName\">notFoundForwardName</xsl:with-param>\n \t\t\t\t\t</xsl:call-template>\n \t\t\t\t</xsl:if>\n-\t\t\t\t<xsl:variable name=\"efn\" select=\"@emptyForwardName\" />\n-\t\t\t\t<xsl:if test=\"string-length($efn)&gt;0 and (forward/@name=$efn)=false()\">\n+\t\t\t\t<xsl:variable name=\"emptyForwardName\" select=\"@emptyForwardName\" />\n+\t\t\t\t<xsl:if test=\"string-length($emptyForwardName)&gt;0 and (forward/@name=$emptyForwardName)=false()\">\n \t\t\t\t\t<xsl:call-template name=\"forward\">\n \t\t\t\t\t\t<xsl:with-param name=\"pipeName\" select=\"@name\" />\n-\t\t\t\t\t\t<xsl:with-param name=\"forwardPath\" select=\"$efn\" />\n+\t\t\t\t\t\t<xsl:with-param name=\"forwardPath\" select=\"$emptyForwardName\" />\n \t\t\t\t\t\t<xsl:with-param name=\"forwardName\">emptyForwardName</xsl:with-param>\n \t\t\t\t\t</xsl:call-template>\n \t\t\t\t</xsl:if>\n-\t\t\t\t<xsl:variable name=\"tfn\" select=\"@thenForwardName\" />\n-\t\t\t\t<xsl:if test=\"string-length($tfn)&gt;0 and (forward/@name=$tfn)=false()\">\n+\t\t\t\t<xsl:variable name=\"thenForwardName\" select=\"@thenForwardName\" />\n+\t\t\t\t<xsl:if test=\"string-length($thenForwardName)&gt;0 and (forward/@name=$thenForwardName)=false()\">\n \t\t\t\t\t<xsl:call-template name=\"forward\">\n \t\t\t\t\t\t<xsl:with-param name=\"pipeName\" select=\"@name\" />\n-\t\t\t\t\t\t<xsl:with-param name=\"forwardPath\" select=\"$tfn\" />\n+\t\t\t\t\t\t<xsl:with-param name=\"forwardPath\" select=\"$thenForwardName\" />\n \t\t\t\t\t\t<xsl:with-param name=\"forwardName\">thenForwardName</xsl:with-param>\n \t\t\t\t\t</xsl:call-template>\n \t\t\t\t</xsl:if>\n-\t\t\t\t<xsl:variable name=\"efn\" select=\"@elseForwardName\" />\n-\t\t\t\t<xsl:if test=\"string-length($efn)&gt;0 and (forward/@name=$efn)=false()\">\n+\t\t\t\t<xsl:variable name=\"elseForwardName\" select=\"@elseForwardName\" />\n+\t\t\t\t<xsl:if test=\"string-length($elseForwardName)&gt;0 and (forward/@name=$elseForwardName)=false()\">\n \t\t\t\t\t<xsl:call-template name=\"forward\">\n \t\t\t\t\t\t<xsl:with-param name=\"pipeName\" select=\"@name\" />\n-\t\t\t\t\t\t<xsl:with-param name=\"forwardPath\" select=\"$efn\" />\n+\t\t\t\t\t\t<xsl:with-param name=\"forwardPath\" select=\"$elseForwardName\" />\n \t\t\t\t\t\t<xsl:with-param name=\"forwardName\">elseForwardName</xsl:with-param>\n \t\t\t\t\t</xsl:call-template>\n \t\t\t\t</xsl:if>\n \t\t\t</xsl:when>\n \t\t\t<xsl:otherwise>\n-\t\t\t\t<xsl:if test=\"forward=false()\">\n+\t\t\t\t<xsl:if test=\"count(forward[@name='success'])=0\">\n \t\t\t\t\t<xsl:call-template name=\"forward\">\n \t\t\t\t\t\t<xsl:with-param name=\"pipeName\" select=\"@name\" />", "originalCommit": "73416ff442d56789277dc2095e6731a0085dd930", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTEyMDAzMw==", "url": "https://github.com/ibissource/iaf/pull/1326#discussion_r539120033", "bodyText": "Should it not be following-sibling::pipe[1]/@name, to be sure that the XPath goes to a pipe and not something else if someone made a mistake in the configuration?\nAnd what if there is no following pipe? Should it then go to an exit with state success? Or does that not matter for this XSLT?", "author": "ricardovh", "createdAt": "2020-12-09T08:53:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODQwMDM3Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTEyNjY0Mw==", "url": "https://github.com/ibissource/iaf/pull/1326#discussion_r539126643", "bodyText": "@alisihab pointed out to me that the name is already determined", "author": "gvanbrakel", "createdAt": "2020-12-09T09:03:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODQwMDM3Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTEyNzQ2OQ==", "url": "https://github.com/ibissource/iaf/pull/1326#discussion_r539127469", "bodyText": "There it only checks if there is no success forward configured. Please examine what will happen in the next lines if the condition holds.", "author": "alisihab", "createdAt": "2020-12-09T09:04:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODQwMDM3Ng=="}], "type": "inlineReview"}, {"oid": "0d1f79fb285f600a49984874ab168085b0739dcd", "url": "https://github.com/ibissource/iaf/commit/0d1f79fb285f600a49984874ab168085b0739dcd", "message": "simplify changes and create a test", "committedDate": "2020-12-08T15:10:40Z", "type": "commit"}, {"oid": "41a1ea1097f1cbf3f8faf3402d103f95f4ec1f35", "url": "https://github.com/ibissource/iaf/commit/41a1ea1097f1cbf3f8faf3402d103f95f4ec1f35", "message": "prove that having an exit right after a pipe which does not have success forward will not block the pipeline to follow the next pipe", "committedDate": "2020-12-10T09:14:37Z", "type": "commit"}]}