{"pr_number": 679, "pr_title": "Dynamically enable and disable struts servlet", "pr_createdAt": "2020-05-05T16:59:04Z", "pr_url": "https://github.com/ibissource/iaf/pull/679", "timeline": [{"oid": "a902a15f750d964b0c171ef0fdee1b450434abd6", "url": "https://github.com/ibissource/iaf/commit/a902a15f750d964b0c171ef0fdee1b450434abd6", "message": "Turn Struts ActionServlet into Spring bean", "committedDate": "2020-05-05T15:52:12Z", "type": "commit"}, {"oid": "6715dbcffd5a1806c9e3c0936dc39273732a73ed", "url": "https://github.com/ibissource/iaf/commit/6715dbcffd5a1806c9e3c0936dc39273732a73ed", "message": "Make cookies httpOnly and secure", "committedDate": "2020-05-05T16:19:00Z", "type": "commit"}, {"oid": "03445dbf740499468e629509853bc30ca9f4a36f", "url": "https://github.com/ibissource/iaf/commit/03445dbf740499468e629509853bc30ca9f4a36f", "message": "introduce flow diagram lazyloading", "committedDate": "2020-05-06T14:26:20Z", "type": "commit"}, {"oid": "145ec545896b037d1a95ffbdc7b8b20287344154", "url": "https://github.com/ibissource/iaf/commit/145ec545896b037d1a95ffbdc7b8b20287344154", "message": "Hide aspectj logs", "committedDate": "2020-05-06T19:19:24Z", "type": "commit"}, {"oid": "79d159d63b302f9de8983bee7ce36703837b43e9", "url": "https://github.com/ibissource/iaf/commit/79d159d63b302f9de8983bee7ce36703837b43e9", "message": "bugfix", "committedDate": "2020-05-06T19:19:35Z", "type": "commit"}, {"oid": "2dc422b596af9d7ce86b7bd5157378ffb908121b", "url": "https://github.com/ibissource/iaf/commit/2dc422b596af9d7ce86b7bd5157378ffb908121b", "message": "Add tmp dir location", "committedDate": "2020-05-06T20:04:09Z", "type": "commit"}, {"oid": "1c5fd9704fe5334451582eb516b782d9b8e65030", "url": "https://github.com/ibissource/iaf/commit/1c5fd9704fe5334451582eb516b782d9b8e65030", "message": "Create tmp dir if not exist", "committedDate": "2020-05-06T20:31:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTk3NTYzOQ==", "url": "https://github.com/ibissource/iaf/pull/679#discussion_r421975639", "bodyText": "Wat doet dit precies?", "author": "gvanbrakel", "createdAt": "2020-05-08T06:54:48Z", "path": "core/src/main/java/nl/nn/adapterframework/util/FlowDiagram.java", "diffHunk": "@@ -16,49 +16,55 @@\n package nl.nn.adapterframework.util;\n \n import java.io.File;\n+import java.io.FileInputStream;\n import java.io.FileOutputStream;\n import java.io.IOException;\n+import java.io.InputStream;\n import java.util.List;\n \n import javax.xml.transform.TransformerConfigurationException;\n+import javax.xml.transform.TransformerException;\n \n import org.apache.commons.lang3.StringUtils;\n-import nl.nn.adapterframework.util.LogUtil;\n import org.apache.logging.log4j.Logger;\n+import org.springframework.beans.factory.DisposableBean;\n+import org.springframework.context.annotation.Scope;\n+import org.xml.sax.SAXException;\n \n import nl.nn.adapterframework.configuration.Configuration;\n-import nl.nn.adapterframework.configuration.ConfigurationException;\n import nl.nn.adapterframework.core.IAdapter;\n import nl.nn.adapterframework.core.Resource;\n import nl.nn.adapterframework.extensions.graphviz.Format;\n import nl.nn.adapterframework.extensions.graphviz.GraphvizEngine;\n import nl.nn.adapterframework.extensions.graphviz.GraphvizException;\n import nl.nn.adapterframework.extensions.graphviz.Options;\n+import nl.nn.adapterframework.lifecycle.IbisInitializer;\n \n /**\n  * Utility class to generate the flow diagram for an adapter or a configuration.\n  * \n- * @author Peter Leeuwenburgh\n  * @author Niels Meijer\n  * @version 2.0\n  */\n \n-public class FlowDiagram {\n+@IbisInitializer\n+@Scope(\"singleton\")", "originalCommit": "1c5fd9704fe5334451582eb516b782d9b8e65030", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTk3NjA2MQ==", "url": "https://github.com/ibissource/iaf/pull/679#discussion_r421976061", "bodyText": "Huh? Als de namen niet goed waren, moet je all the way gaan, en ook de .xsls hernoemen.", "author": "gvanbrakel", "createdAt": "2020-05-08T06:55:54Z", "path": "core/src/main/java/nl/nn/adapterframework/util/FlowDiagram.java", "diffHunk": "@@ -16,49 +16,55 @@\n package nl.nn.adapterframework.util;\n \n import java.io.File;\n+import java.io.FileInputStream;\n import java.io.FileOutputStream;\n import java.io.IOException;\n+import java.io.InputStream;\n import java.util.List;\n \n import javax.xml.transform.TransformerConfigurationException;\n+import javax.xml.transform.TransformerException;\n \n import org.apache.commons.lang3.StringUtils;\n-import nl.nn.adapterframework.util.LogUtil;\n import org.apache.logging.log4j.Logger;\n+import org.springframework.beans.factory.DisposableBean;\n+import org.springframework.context.annotation.Scope;\n+import org.xml.sax.SAXException;\n \n import nl.nn.adapterframework.configuration.Configuration;\n-import nl.nn.adapterframework.configuration.ConfigurationException;\n import nl.nn.adapterframework.core.IAdapter;\n import nl.nn.adapterframework.core.Resource;\n import nl.nn.adapterframework.extensions.graphviz.Format;\n import nl.nn.adapterframework.extensions.graphviz.GraphvizEngine;\n import nl.nn.adapterframework.extensions.graphviz.GraphvizException;\n import nl.nn.adapterframework.extensions.graphviz.Options;\n+import nl.nn.adapterframework.lifecycle.IbisInitializer;\n \n /**\n  * Utility class to generate the flow diagram for an adapter or a configuration.\n  * \n- * @author Peter Leeuwenburgh\n  * @author Niels Meijer\n  * @version 2.0\n  */\n \n-public class FlowDiagram {\n+@IbisInitializer\n+@Scope(\"singleton\")\n+public class FlowDiagram implements DisposableBean {\n \tprivate static Logger log = LogUtil.getLogger(FlowDiagram.class);\n \n \tprivate final AppConstants APP_CONSTANTS = AppConstants.getInstance();\n \tprivate File adapterFlowDir = new File(APP_CONSTANTS.getResolvedProperty(\"flow.adapter.dir\"));\n \tprivate File configFlowDir = new File(APP_CONSTANTS.getResolvedProperty(\"flow.config.dir\"));\n \n-\tprivate static final String CONFIG2DOT_XSLT = \"/IAF_WebControl/GenerateFlowDiagram/xsl/config2dot.xsl\";\n-\tprivate static final String IBIS2DOT_XSLT = \"/IAF_WebControl/GenerateFlowDiagram/xsl/ibis2dot.xsl\";\n+\tprivate static final String ADAPTER2DOT_XSLT = \"/IAF_WebControl/GenerateFlowDiagram/xsl/config2dot.xsl\";\n+\tprivate static final String CONFIGURATION2DOT_XSLT = \"/IAF_WebControl/GenerateFlowDiagram/xsl/ibis2dot.xsl\";", "originalCommit": "1c5fd9704fe5334451582eb516b782d9b8e65030", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTk3NzI3MA==", "url": "https://github.com/ibissource/iaf/pull/679#discussion_r421977270", "bodyText": "Het zou toch ook aardig zijn om hier gebruik te maken van FileSystems, zodat je deze flowdiagrams ook op een S3 bucket of SambaShare kan hosten", "author": "gvanbrakel", "createdAt": "2020-05-08T06:58:59Z", "path": "core/src/main/java/nl/nn/adapterframework/util/FlowDiagram.java", "diffHunk": "@@ -96,25 +90,52 @@ public FlowDiagram(String format, String version) throws TransformerConfiguratio\n \n \t\toptions = options.format(this.format);\n \n-\t\tResource xsltSourceConfig = Resource.getResource(CONFIG2DOT_XSLT);\n+\t\tResource xsltSourceConfig = Resource.getResource(ADAPTER2DOT_XSLT);\n+\t\ttransformerPoolAdapter = TransformerPool.getInstance(xsltSourceConfig, 2);\n \n-\t\ttransformerPoolConfig = TransformerPool.getInstance(xsltSourceConfig, 2);\n+\t\tResource xsltSourceIbis = Resource.getResource(CONFIGURATION2DOT_XSLT);\n+\t\ttransformerPoolConfig = TransformerPool.getInstance(xsltSourceIbis, 2);\n+\t}\n \n-\t\tResource xsltSourceIbis = Resource.getResource(IBIS2DOT_XSLT);\n-\t\ttransformerPoolIbis = TransformerPool.getInstance(xsltSourceIbis, 2);\n+\tpublic InputStream get(IAdapter adapter) throws IOException, GraphvizException {\n+\t\tFile destFile = retrieveAdapterFlowFile(adapter);\n+\n+\t\tif(!destFile.exists()) {", "originalCommit": "1c5fd9704fe5334451582eb516b782d9b8e65030", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTk3ODY5OA==", "url": "https://github.com/ibissource/iaf/pull/679#discussion_r421978698", "bodyText": "Is dit cookie gedocumenteerd in de consent page?", "author": "gvanbrakel", "createdAt": "2020-05-08T07:02:45Z", "path": "core/src/main/java/nl/nn/adapterframework/webcontrol/action/BrowseJdbcTableExecute.java", "diffHunk": "@@ -240,6 +240,8 @@ public ActionForward executeSub(\n \t\t\t\t\t\"WEB_JDBCBROWSECOOKIE_NAME\"),\n \t\t\t\tcookieValue);\n \t\tsendJdbcBrowseCookie.setMaxAge(Integer.MAX_VALUE);\n+\t\tsendJdbcBrowseCookie.setHttpOnly(true);\n+\t\tsendJdbcBrowseCookie.setSecure(true);", "originalCommit": "1c5fd9704fe5334451582eb516b782d9b8e65030", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTk3ODczMg==", "url": "https://github.com/ibissource/iaf/pull/679#discussion_r421978732", "bodyText": "Is dit cookie gedocumenteerd in de consent page?", "author": "gvanbrakel", "createdAt": "2020-05-08T07:02:51Z", "path": "core/src/main/java/nl/nn/adapterframework/webcontrol/action/BrowseQueueExecute.java", "diffHunk": "@@ -158,6 +158,8 @@ public ActionForward executeSub(\n \t\t\t\t\t\"WEB_QBROWSECOOKIE\"),\n \t\t\t\tcookieValue);\n \t\tsendJmsCookie.setMaxAge(Integer.MAX_VALUE);\n+\t\tsendJmsCookie.setHttpOnly(true);\n+\t\tsendJmsCookie.setSecure(true);", "originalCommit": "1c5fd9704fe5334451582eb516b782d9b8e65030", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTk3ODgyOA==", "url": "https://github.com/ibissource/iaf/pull/679#discussion_r421978828", "bodyText": "Is dit cookie gedocumenteerd in de consent page?", "author": "gvanbrakel", "createdAt": "2020-05-08T07:03:06Z", "path": "core/src/main/java/nl/nn/adapterframework/webcontrol/action/ExecuteJdbcQueryExecute.java", "diffHunk": "@@ -119,6 +119,8 @@ public ActionForward executeSub(ActionMapping mapping, ActionForm form, HttpServ\n \t\t\t\t\t\"WEB_EXECJDBCCOOKIE_NAME\"),\n \t\t\t\tcookieValue);\n \t\texecJdbcCookie.setMaxAge(Integer.MAX_VALUE);\n+\t\texecJdbcCookie.setHttpOnly(true);\n+\t\texecJdbcCookie.setSecure(true);", "originalCommit": "1c5fd9704fe5334451582eb516b782d9b8e65030", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTk3ODk2Mw==", "url": "https://github.com/ibissource/iaf/pull/679#discussion_r421978963", "bodyText": "Is dit cookie gedocumenteerd in de consent page?", "author": "gvanbrakel", "createdAt": "2020-05-08T07:03:29Z", "path": "core/src/main/java/nl/nn/adapterframework/webcontrol/action/SendJmsMessageExecute.java", "diffHunk": "@@ -168,6 +168,8 @@ public ActionForward executeSub(ActionMapping mapping, ActionForm form, HttpServ\n \t          cookieValue += \"destinationType=\\\"\" + form_destinationType + \"\\\"\";\n \t          Cookie sendJmsCookie = new Cookie(AppConstants.getInstance().getProperty(\"WEB_JMSCOOKIE_NAME\"), cookieValue);\n \t          sendJmsCookie.setMaxAge(Integer.MAX_VALUE);\n+\t          sendJmsCookie.setHttpOnly(true);\n+\t          sendJmsCookie.setSecure(true);", "originalCommit": "1c5fd9704fe5334451582eb516b782d9b8e65030", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTk3OTAwOQ==", "url": "https://github.com/ibissource/iaf/pull/679#discussion_r421979009", "bodyText": "Is dit cookie gedocumenteerd in de consent page?", "author": "gvanbrakel", "createdAt": "2020-05-08T07:03:36Z", "path": "core/src/main/java/nl/nn/adapterframework/webcontrol/action/ShowIbisstoreSummary.java", "diffHunk": "@@ -177,6 +177,8 @@ public ActionForward executeSub(ActionMapping mapping, ActionForm form, HttpServ\n \t\tString cookieValue = jmsRealm;\n \t\tCookie cookie =\tnew Cookie(cookieName, cookieValue);\n \t\tcookie.setMaxAge(Integer.MAX_VALUE);\n+\t\tcookie.setHttpOnly(true);\n+\t\tcookie.setSecure(true);", "originalCommit": "1c5fd9704fe5334451582eb516b782d9b8e65030", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTk4MDQ5Mw==", "url": "https://github.com/ibissource/iaf/pull/679#discussion_r421980493", "bodyText": "Niet 'old' en 'legacy' noemen, ook geen 'ugly' of 'beautiful', maar naar iets wat het is. Zoiets als 'struts console'.", "author": "gvanbrakel", "createdAt": "2020-05-08T07:07:13Z", "path": "core/src/main/resources/AppConstants.properties", "diffHunk": "@@ -352,6 +352,9 @@ etag.ehcache.dir=${cache.dir}\n etag.ehcache.diskPersistent=false\n etag.ehcache.diskExpiryThreadIntervalSeconds=600\n \n+########## OLD CONSOLE ##########\n+legacyConsole.enabled=false", "originalCommit": "1c5fd9704fe5334451582eb516b782d9b8e65030", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTk4MDY1OQ==", "url": "https://github.com/ibissource/iaf/pull/679#discussion_r421980659", "bodyText": "Was die ander dan niet interactief?", "author": "gvanbrakel", "createdAt": "2020-05-08T07:07:38Z", "path": "core/src/main/resources/AppConstants.properties", "diffHunk": "@@ -352,6 +352,9 @@ etag.ehcache.dir=${cache.dir}\n etag.ehcache.diskPersistent=false\n etag.ehcache.diskExpiryThreadIntervalSeconds=600\n \n+########## OLD CONSOLE ##########\n+legacyConsole.enabled=false\n+active.config.database=false\n \n ########## INTERACTIVE CONSOLE ##########\n # Activates the new IBIS API + GUI3.0", "originalCommit": "1c5fd9704fe5334451582eb516b782d9b8e65030", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTk4MjQ1Ng==", "url": "https://github.com/ibissource/iaf/pull/679#discussion_r421982456", "bodyText": "Ook hier: Struts console, console 1.2", "author": "gvanbrakel", "createdAt": "2020-05-08T07:11:52Z", "path": "webapp/src/main/webapp/iaf/gui/js/controllers.js", "diffHunk": "@@ -398,6 +399,13 @@ angular.module('iaf.beheerconsole')\n \t\t$(\".rating i\").removeClass(\"fa-star\").addClass(\"fa-star-o\");\n \t\t$(\".rating i:nth-child(-n+\"+ (rating + 1) +\")\").addClass(\"fa-star\").removeClass(\"fa-star-o\");\n \t};\n+\n+\t$scope.showLegacyConsoleDisabled = function () {\n+\t\tSweetAlert.Warning({\n+\t\t\ttitle: \"Legacy Console Disabled\",\n+\t\t\ttext: \"The old console has been disabled. In order to enable it, set te property [legacyConsole.enabled] to true.\",", "originalCommit": "1c5fd9704fe5334451582eb516b782d9b8e65030", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "19f66f70e9b79b0136f44b62e91f4eae2daa0174", "url": "https://github.com/ibissource/iaf/commit/19f66f70e9b79b0136f44b62e91f4eae2daa0174", "message": "Rename and move flowdiagram xslts", "committedDate": "2020-05-08T12:17:01Z", "type": "commit"}, {"oid": "739eaaca1f35b2aae1752bf1348dbb16c0a0b3e8", "url": "https://github.com/ibissource/iaf/commit/739eaaca1f35b2aae1752bf1348dbb16c0a0b3e8", "message": "Rename legacy to struts console", "committedDate": "2020-05-08T12:17:20Z", "type": "commit"}, {"oid": "c5c4c92427b9f2aa01c5b69d7c2a563ee4b3c232", "url": "https://github.com/ibissource/iaf/commit/c5c4c92427b9f2aa01c5b69d7c2a563ee4b3c232", "message": "Fix typo", "committedDate": "2020-05-08T12:18:29Z", "type": "commit"}, {"oid": "36561157ea4fb0936db8118af35cd3f5ce57656e", "url": "https://github.com/ibissource/iaf/commit/36561157ea4fb0936db8118af35cd3f5ce57656e", "message": "Make sure restservicedispatcher doesn't freak out", "committedDate": "2020-05-08T12:26:55Z", "type": "commit"}]}