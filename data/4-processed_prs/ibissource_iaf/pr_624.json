{"pr_number": 624, "pr_title": "PipeRunResult using Message and fix for output streaming", "pr_createdAt": "2020-04-21T14:27:42Z", "pr_url": "https://github.com/ibissource/iaf/pull/624", "timeline": [{"oid": "12250489696ac76430fe1f56ce6e9b3f31128918", "url": "https://github.com/ibissource/iaf/commit/12250489696ac76430fe1f56ce6e9b3f31128918", "message": "PipeRunResult using Message and fix for output streaming", "committedDate": "2020-04-21T14:27:01Z", "type": "commit"}, {"oid": "855e04f108628d1a02ac09c94d6d59391fc95910", "url": "https://github.com/ibissource/iaf/commit/855e04f108628d1a02ac09c94d6d59391fc95910", "message": "Merge branch 'master' into PipeRunResult_using_Message", "committedDate": "2020-04-21T14:28:39Z", "type": "commit"}, {"oid": "95dc2e84c4cf97c378293e2a295a19d89e569ddf", "url": "https://github.com/ibissource/iaf/commit/95dc2e84c4cf97c378293e2a295a19d89e569ddf", "message": "Fix ClassCastException", "committedDate": "2020-04-21T14:40:43Z", "type": "commit"}, {"oid": "56e07ba8443f35321d27f6c3dac9ce9eb227edb4", "url": "https://github.com/ibissource/iaf/commit/56e07ba8443f35321d27f6c3dac9ce9eb227edb4", "message": "Solve Codacy issues", "committedDate": "2020-04-21T14:55:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzYxOTg1OA==", "url": "https://github.com/ibissource/iaf/pull/624#discussion_r413619858", "bodyText": "Nu lijkt het of de PLE een naam heeft?", "author": "nielsm5", "createdAt": "2020-04-23T08:31:27Z", "path": "core/src/main/java/nl/nn/adapterframework/core/PipeLineExit.java", "diffHunk": "@@ -61,6 +61,10 @@\n \tpublic String getPath() {\n \t\treturn path;\n \t}\n+\t@Override\n+\tpublic String getName() {\n+\t\treturn getPath();\n+\t}", "originalCommit": "56e07ba8443f35321d27f6c3dac9ce9eb227edb4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzkwMjAxNQ==", "url": "https://github.com/ibissource/iaf/pull/624#discussion_r413902015", "bodyText": "Misschien handig hier te documenteren wat getName in deze context representeert.", "author": "nielsm5", "createdAt": "2020-04-23T15:35:17Z", "path": "core/src/main/java/nl/nn/adapterframework/core/IForwardTarget.java", "diffHunk": "@@ -0,0 +1,22 @@\n+/*\n+   Copyright 2020 WeAreFrank!\n+\n+   Licensed under the Apache License, Version 2.0 (the \"License\");\n+   you may not use this file except in compliance with the License.\n+   You may obtain a copy of the License at\n+\n+       http://www.apache.org/licenses/LICENSE-2.0\n+\n+   Unless required by applicable law or agreed to in writing, software\n+   distributed under the License is distributed on an \"AS IS\" BASIS,\n+   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+   See the License for the specific language governing permissions and\n+   limitations under the License.\n+*/\n+package nl.nn.adapterframework.core;\n+\n+public interface IForwardTarget {\n+\t\n+\tpublic String getName();", "originalCommit": "56e07ba8443f35321d27f6c3dac9ce9eb227edb4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "685717794f08a2814e0ae31697e1174d036a358b", "url": "https://github.com/ibissource/iaf/commit/685717794f08a2814e0ae31697e1174d036a358b", "message": "Simplify provideOutputStream() for pipes", "committedDate": "2020-04-24T06:12:28Z", "type": "commit"}, {"oid": "f2fd682086f5f4845b54794b2c883a4c9ab34514", "url": "https://github.com/ibissource/iaf/commit/f2fd682086f5f4845b54794b2c883a4c9ab34514", "message": "Document IForwardTarget", "committedDate": "2020-04-24T06:12:44Z", "type": "commit"}, {"oid": "063361f4a1a8ed13dd38e1f0c9d5a84169ee3509", "url": "https://github.com/ibissource/iaf/commit/063361f4a1a8ed13dd38e1f0c9d5a84169ee3509", "message": "Fix Codacy issues", "committedDate": "2020-04-24T06:51:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDUxNDEwMg==", "url": "https://github.com/ibissource/iaf/pull/624#discussion_r414514102", "bodyText": "Wat doet dit? .. ?", "author": "nielsm5", "createdAt": "2020-04-24T11:48:46Z", "path": "ladybug/src/main/resources/springIbisDebuggerAdvice.xml", "diffHunk": "@@ -123,17 +123,18 @@\n \t\t\t<aop:around\n \t\t\t\tpointcut=\n \t\t\t\t\t\"\n-\t \t\t\t\t\texecution(\n-\t \t\t\t\t\t\t*\n-\t \t\t\t\t\t\tnl.nn.adapterframework.stream.IOutputStreamingSupport.provideOutputStream(\n-\t \t\t\t\t\t\t\tnl.nn.adapterframework.core.IPipeLineSession, nl.nn.adapterframework.stream.IOutputStreamingSupport\n-\t \t\t\t\t\t\t)\n+\t \t\t\t\texecution(\n+\t \t\t\t\t\t*\n+\t \t\t\t\t\tnl.nn.adapterframework.stream.IOutputStreamingSupport.provideOutputStream(\n+\t \t\t\t\t\t\tnl.nn.adapterframework.core.IPipeLineSession, \n+\t \t\t\t\t\t\t..", "originalCommit": "063361f4a1a8ed13dd38e1f0c9d5a84169ee3509", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDU5Nzc4OQ==", "url": "https://github.com/ibissource/iaf/pull/624#discussion_r414597789", "bodyText": "Dit verwijst naar optionele extra argumenten. Dus met of zonder IForwardTarget, in dit geval", "author": "gvanbrakel", "createdAt": "2020-04-24T13:58:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDUxNDEwMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDUxODE0NQ==", "url": "https://github.com/ibissource/iaf/pull/624#discussion_r414518145", "bodyText": "wat doet deze methode nu nog??", "author": "nielsm5", "createdAt": "2020-04-24T11:56:03Z", "path": "core/src/main/java/nl/nn/adapterframework/stream/StreamingPipe.java", "diffHunk": "@@ -63,66 +70,18 @@ public boolean requiresOutputStream() {\n \n \t/**\n \t * provide the outputstream, or null if a stream cannot be provided.\n-\t * If nextProvider is null, then descendants must replace it with getStreamTarget().\n+\t * Implementations should provide a forward target by calling {@link #getNextPipe()}.\n \t */\n-\t@Override\n-\tpublic MessageOutputStream provideOutputStream(IPipeLineSession session, IOutputStreamingSupport nextProvider) throws StreamingException {\n+\tpublic MessageOutputStream provideOutputStream(IPipeLineSession session) throws StreamingException {\n \t\treturn null;\n \t}\n \n-\t/**\n-\t * Descendants of this class must implement this method. When nextProvider is not null, they can use that to obtain an OutputStream to write their results to. \n-\t */\n-\tpublic abstract PipeRunResult doPipe(Message input, IPipeLineSession session, IOutputStreamingSupport nextProvider) throws PipeRunException;\n-\t\n \t@Override\n-\tpublic final PipeRunResult doPipe(Message message, IPipeLineSession session) throws PipeRunException {\n-\t\treturn doPipe(message, session, getStreamTarget());\n+\tpublic final MessageOutputStream provideOutputStream(IPipeLineSession session, IForwardTarget next) throws StreamingException {", "originalCommit": "063361f4a1a8ed13dd38e1f0c9d5a84169ee3509", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDU5NzE1Nw==", "url": "https://github.com/ibissource/iaf/pull/624#discussion_r414597157", "bodyText": "Hij implementeert IOutputStreamingSupport.provideOutputStream, en kan als zodanig aangeroepen worden.\nAls hij geimplementeerd wordt door Senders is het tweede argument wel nodig.", "author": "gvanbrakel", "createdAt": "2020-04-24T13:58:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDUxODE0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDY3OTIyNA==", "url": "https://github.com/ibissource/iaf/pull/624#discussion_r414679224", "bodyText": "Maar hij is final en hij doet niets met de target? Wie kan dit implementeren?", "author": "nielsm5", "createdAt": "2020-04-24T15:48:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDUxODE0NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDUyMjg3NA==", "url": "https://github.com/ibissource/iaf/pull/624#discussion_r414522874", "bodyText": "Waarom asString? kan het geen message blijven?\nIk zou hier return new PipeRunResult(getForward(), message); verwachten", "author": "nielsm5", "createdAt": "2020-04-24T12:04:25Z", "path": "core/src/main/java/nl/nn/adapterframework/pipes/TimeoutGuardPipe.java", "diffHunk": "@@ -100,9 +100,8 @@ public PipeRunResult doPipe(Message message, IPipeLineSession session) throws Pi\n \t\tFuture future = service.submit(doPipe);\n \t\tString result = null;\n \t\ttry {\n-\t\t\tlog.debug(getLogPrefix(session) + \"setting timeout of [\"\n-\t\t\t\t\t+ timeout_work + \"] s\");\n-\t\t\tresult = (String) future.get(timeout_work, TimeUnit.SECONDS);\n+\t\t\tlog.debug(getLogPrefix(session) + \"setting timeout of [\" + timeout_work + \"] s\");\n+\t\t\tresult = Message.asString(future.get(timeout_work, TimeUnit.SECONDS));", "originalCommit": "063361f4a1a8ed13dd38e1f0c9d5a84169ee3509", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDU5MTI2MA==", "url": "https://github.com/ibissource/iaf/pull/624#discussion_r414591260", "bodyText": "Omdat ik er niet aan wilde zitten. We moeten van deze TimeoutGuardPipe af, omdat hij z'n werk niet afbreekt bij een timeout, maar alleen het proces door laat lopen. Het is dus nu een soort uitgestelde asynchrone excutor.\nIk zal hem deprecieren.", "author": "gvanbrakel", "createdAt": "2020-04-24T13:50:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDUyMjg3NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDUyNDU5MQ==", "url": "https://github.com/ibissource/iaf/pull/624#discussion_r414524591", "bodyText": "waarom geen message?", "author": "nielsm5", "createdAt": "2020-04-24T12:07:24Z", "path": "core/src/main/java/nl/nn/adapterframework/pipes/Json2XmlValidator.java", "diffHunk": "@@ -144,9 +144,11 @@ public PipeRunResult doPipe(Message input, IPipeLineSession session, boolean res\n \t\t\t\tif (!getOutputFormat(session,responseMode).equalsIgnoreCase(FORMAT_JSON)) {\n \t\t\t\t\tPipeRunResult result=super.doPipe(new Message(messageToValidate),session, responseMode);\n \t\t\t\t\tif (isProduceNamespaceLessXml()) {\n-\t\t\t\t\t\tString msg=(String)result.getResult();\n-\t\t\t\t\t\tmsg=XmlUtils.removeNamespaces(msg);\n-\t\t\t\t\t\tresult.setResult(msg);\n+\t\t\t\t\t\ttry {\n+\t\t\t\t\t\t\tresult.setResult(XmlUtils.removeNamespaces(result.getResult().asString()));", "originalCommit": "063361f4a1a8ed13dd38e1f0c9d5a84169ee3509", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDU4ODM2Mg==", "url": "https://github.com/ibissource/iaf/pull/624#discussion_r414588362", "bodyText": "Omdat XmlUtils.removeNamespaces geen message accepteert", "author": "gvanbrakel", "createdAt": "2020-04-24T13:46:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDUyNDU5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDU5MDk0Mw==", "url": "https://github.com/ibissource/iaf/pull/624#discussion_r414590943", "bodyText": "Maar dat kan je wel maken :)\nNu maak je van een message een string, en in XmlUtils.removeNamespaces weer een message.", "author": "nielsm5", "createdAt": "2020-04-24T13:49:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDUyNDU5MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDUyNjY4OA==", "url": "https://github.com/ibissource/iaf/pull/624#discussion_r414526688", "bodyText": "Misschien handig hier ook javadoc toe te voegen :)", "author": "nielsm5", "createdAt": "2020-04-24T12:10:48Z", "path": "core/src/main/java/nl/nn/adapterframework/core/PipeLine.java", "diffHunk": "@@ -555,6 +555,21 @@ public void setPipeLineProcessor(PipeLineProcessor pipeLineProcessor) {\n \t\tthis.pipeLineProcessor = pipeLineProcessor;\n \t}\n \n+\tpublic IForwardTarget getForward(IPipe pipe, String path) throws PipeRunException {\n+\t\tif ((null==path) || (path.length()==0)){\n+\t\t\tthrow new PipeRunException(pipe, \"Pipeline of [\"+getOwner().getName()+\"] got a path that equals null or has a zero-length value from pipe [\"+pipe.getName()+\"]. Check the configuration, probably forwards are not defined for this pipe.\");\n+\t\t}\n+\t\tPipeLineExit plExit= getPipeLineExits().get(path);\n+\t\tif (plExit != null ) {\n+\t\t\treturn plExit;\n+\t\t}\n+\t\tIPipe nextPipe=getPipe(path);\n+\t\tif (nextPipe==null) {\n+\t\t\tthrow new PipeRunException(pipe, \"Pipeline of adapter [\"+ getOwner().getName()+\"] got an erroneous definition from pipe [\"+pipe.getName()+\"]. Pipe to execute [\"+path+ \"] is not defined.\");\n+\t\t}\n+\t\treturn nextPipe;\n+\t}", "originalCommit": "063361f4a1a8ed13dd38e1f0c9d5a84169ee3509", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDUyODY0NQ==", "url": "https://github.com/ibissource/iaf/pull/624#discussion_r414528645", "bodyText": "Is hier ook een test voor? Een adapter die een sub-adapter aanroept, en een IMessageOutputStream teruggeeft?", "author": "nielsm5", "createdAt": "2020-04-24T12:14:05Z", "path": "core/src/main/java/nl/nn/adapterframework/core/IForwardTarget.java", "diffHunk": "@@ -0,0 +1,30 @@\n+/*\n+   Copyright 2020 WeAreFrank!\n+\n+   Licensed under the Apache License, Version 2.0 (the \"License\");\n+   you may not use this file except in compliance with the License.\n+   You may obtain a copy of the License at\n+\n+       http://www.apache.org/licenses/LICENSE-2.0\n+\n+   Unless required by applicable law or agreed to in writing, software\n+   distributed under the License is distributed on an \"AS IS\" BASIS,\n+   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+   See the License for the specific language governing permissions and\n+   limitations under the License.\n+*/\n+package nl.nn.adapterframework.core;\n+\n+/**\n+ * IForwardTarget represents the destination of a PipeForward, so a {@link IPipe} or {@link PipeLineExit}.\n+ * \n+ * @author Gerrit van Brakel\n+ */\n+public interface IForwardTarget {", "originalCommit": "063361f4a1a8ed13dd38e1f0c9d5a84169ee3509", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDU2NjA0Ng==", "url": "https://github.com/ibissource/iaf/pull/624#discussion_r414566046", "bodyText": "Er zijn testen voor in iaf-test, als je in Test.properties opneemt:\nstreaming.auto=true", "author": "gvanbrakel", "createdAt": "2020-04-24T13:14:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDUyODY0NQ=="}], "type": "inlineReview"}, {"oid": "302da3820ed8fd6e50447d563c3364897ac157b0", "url": "https://github.com/ibissource/iaf/commit/302da3820ed8fd6e50447d563c3364897ac157b0", "message": "Change PipeLine.getForward() into resolveForward()", "committedDate": "2020-04-24T14:02:43Z", "type": "commit"}, {"oid": "438780b2752c0d370b60f185f8596efde63c9c7d", "url": "https://github.com/ibissource/iaf/commit/438780b2752c0d370b60f185f8596efde63c9c7d", "message": "Merge branch 'master' into PipeRunResult_using_Message\n\nConflicts:\n\tcore/src/main/java/nl/nn/adapterframework/pipes/TimeoutGuardPipe.java", "committedDate": "2020-04-24T15:24:23Z", "type": "commit"}, {"oid": "56926f6a36763ece617a129cac5b28868d62f556", "url": "https://github.com/ibissource/iaf/commit/56926f6a36763ece617a129cac5b28868d62f556", "message": "Comment out TimeoutGuardPipe deprecation, as it breaks IbisConsoleTest", "committedDate": "2020-04-24T16:02:32Z", "type": "commit"}]}