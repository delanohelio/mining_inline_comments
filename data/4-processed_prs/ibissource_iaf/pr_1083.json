{"pr_number": 1083, "pr_title": "Fix #1048 Add MariaDB full jdbc listener support", "pr_createdAt": "2020-09-22T13:15:38Z", "pr_url": "https://github.com/ibissource/iaf/pull/1083", "timeline": [{"oid": "212cdb51388401d9b7a4e06824e7b00d826f0dcd", "url": "https://github.com/ibissource/iaf/commit/212cdb51388401d9b7a4e06824e7b00d826f0dcd", "message": "Add support for parallel JdbcListeners for Dbmses without 'skip locked'", "committedDate": "2020-09-22T10:57:43Z", "type": "commit"}, {"oid": "875ab7644e88c022e1fc06e1c374a209a9112898", "url": "https://github.com/ibissource/iaf/commit/875ab7644e88c022e1fc06e1c374a209a9112898", "message": "Merge branch 'master' into Add_MariaDB_full_JdbcListener_support", "committedDate": "2020-09-22T11:38:54Z", "type": "commit"}, {"oid": "c0f838c2a1f311e1de4f53725c457bef722396ae", "url": "https://github.com/ibissource/iaf/commit/c0f838c2a1f311e1de4f53725c457bef722396ae", "message": "Add InProcessLog-browser icon to adapter status", "committedDate": "2020-09-22T13:13:08Z", "type": "commit"}, {"oid": "f9666805c8817a259827c39bf91dc34f8502b0f1", "url": "https://github.com/ibissource/iaf/commit/f9666805c8817a259827c39bf91dc34f8502b0f1", "message": "Test for locking problems in JdbcListener", "committedDate": "2020-09-22T13:15:01Z", "type": "commit"}, {"oid": "6deecc861960b9e61483551ab8e8b676c2b39c2e", "url": "https://github.com/ibissource/iaf/commit/6deecc861960b9e61483551ab8e8b676c2b39c2e", "message": "Rollback to status 'available' for dbmses without skip locked support", "committedDate": "2020-09-23T15:14:06Z", "type": "commit"}, {"oid": "1ce673af4f62e072f08f867fbfbcb49577d05777", "url": "https://github.com/ibissource/iaf/commit/1ce673af4f62e072f08f867fbfbcb49577d05777", "message": "Fix test for MySQL: use uppercase tablename in delete", "committedDate": "2020-09-23T15:16:02Z", "type": "commit"}, {"oid": "bd395a65dd1f929734046a1cbe2ee3bb373e42c2", "url": "https://github.com/ibissource/iaf/commit/bd395a65dd1f929734046a1cbe2ee3bb373e42c2", "message": "Fix Codacy issues", "committedDate": "2020-09-23T15:34:40Z", "type": "commit"}, {"oid": "665f61a0b95ad97f7bfe78c3b7d46c1e511e0f77", "url": "https://github.com/ibissource/iaf/commit/665f61a0b95ad97f7bfe78c3b7d46c1e511e0f77", "message": "Enable postgres-xa datasource", "committedDate": "2020-09-23T16:28:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDEzMjMyOQ==", "url": "https://github.com/ibissource/iaf/pull/1083#discussion_r494132329", "bodyText": "Ik vind het erg tof dat je met de tijd mee gaat en allemaal lambda's gebruikt, ik vind het er alleen niet duidelijker op worden. ConnectedOperation is gewoon een Boolean?", "author": "nielsm5", "createdAt": "2020-09-24T08:27:46Z", "path": "core/src/main/java/nl/nn/adapterframework/jdbc/JdbcListener.java", "diffHunk": "@@ -266,8 +258,61 @@ public void afterMessageProcessed(PipeLineResult processResult, Object rawMessag\n \t\t\t}\n \t\t}\n \t}\n+\n+\t@Override\n+\tpublic boolean setMessageStateToInProcess(Object rawMessage, Map<String, Object> threadContext) throws ListenerException {\n+\t\tif (StringUtils.isEmpty(getUpdateStatusToInProcessQuery())) {\n+\t\t\treturn false;\n+\t\t} \n+\t\treturn doConnected(rawMessage, threadContext, setMessageStateToInProcess);\n+\t}\n+\n+\tpublic ConnectedOperation<Boolean> setMessageStateToInProcess = (Connection conn, Object rawMessage, Map<String, Object> threadContext) -> {\n+\t\tif (StringUtils.isEmpty(getUpdateStatusToInProcessQuery())) {\n+\t\t\treturn false;\n+\t\t}\n+\t\tString key = getIdFromRawMessage(rawMessage, threadContext);\n+\t\texecute(conn,getUpdateStatusToInProcessQuery(), key);\n+\t\treturn true;\n+\t};\n+\n+\n+\t@Override\n+\tpublic void revertInProcessStatusToAvailable(Object rawMessage, Map<String, Object> threadContext) throws ListenerException {\n+\t\tif (StringUtils.isEmpty(getRevertInProcessStatusQuery())) {\n+\t\t\treturn;\n+\t\t}\n+\t\tdoConnected(rawMessage, threadContext, revertInProcessStatusToAvailable);\t\n+\t}\n+\n+\tprotected ConnectedOperation<Boolean> revertInProcessStatusToAvailable = (Connection conn, Object rawMessage, Map<String, Object> threadContext) -> {\n+\t\tif (StringUtils.isEmpty(getRevertInProcessStatusQuery())) {\n+\t\t\treturn false;\n+\t\t}\n+\t\tString key=getIdFromRawMessage(rawMessage,threadContext);\n+\t\texecute(conn,getRevertInProcessStatusQuery(), key);\n+\t\treturn true;\n+\t};\n+\n+\tprotected interface ConnectedOperation<X> {\n+\t\tX operate(Connection conn, Object rawMessage, Map<String, Object> threadContext) throws ListenerException;\n+\t}", "originalCommit": "665f61a0b95ad97f7bfe78c3b7d46c1e511e0f77", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDc4MDcyMA==", "url": "https://github.com/ibissource/iaf/pull/1083#discussion_r494780720", "bodyText": "Heb nu ConnectedOperation inderdaad een boolean gemaakt. Ik dacht dat ik hem vaker kon gebruiken, maar lambda's zijn toch niet zo handig dat ze zo flexibel zijn. Voor elke signature moet je een andere functionele interface maken.", "author": "gvanbrakel", "createdAt": "2020-09-25T06:45:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDEzMjMyOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDE1NTM5MQ==", "url": "https://github.com/ibissource/iaf/pull/1083#discussion_r494155391", "bodyText": "Ik vind het stom dat je 2 setters hebt en vervolgens een field direct wijzigt.", "author": "nielsm5", "createdAt": "2020-09-24T09:02:52Z", "path": "core/src/main/java/nl/nn/adapterframework/jdbc/MessageStoreListener.java", "diffHunk": "@@ -128,6 +128,18 @@ public Object getRawMessage(Map<String,Object> threadContext) throws ListenerExc\n \t\treturn rawMessage;\n \t}\n \n+\t@Override\n+\tpublic IMessageBrowser<Object> getInProcessBrowser() {\n+\t\tIMessageBrowser<Object> result = super.getInProcessBrowser();\n+\t\tif (result!=null && result instanceof JdbcTableMessageBrowser) {\n+\t\t\tJdbcTableMessageBrowser<Object> jtmb = (JdbcTableMessageBrowser<Object>)result;\n+\t\t\tjtmb.setCommentField(\"COMMENTS\");\n+\t\t\tjtmb.setExpiryDateField(\"EXPIRYDATE\");\n+\t\t\tjtmb.hostField=\"HOST\";", "originalCommit": "665f61a0b95ad97f7bfe78c3b7d46c1e511e0f77", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "41aecf0e4ff21f2f07126b8357769d8a71d96a18", "url": "https://github.com/ibissource/iaf/commit/41aecf0e4ff21f2f07126b8357769d8a71d96a18", "message": "Add XA support to PostgreSQL docker container", "committedDate": "2020-09-24T16:31:32Z", "type": "commit"}, {"oid": "d27fc69e708ba0fb07fb25a24bb773266a1552af", "url": "https://github.com/ibissource/iaf/commit/d27fc69e708ba0fb07fb25a24bb773266a1552af", "message": "Fix Issues", "committedDate": "2020-09-25T06:52:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDgyOTI1OA==", "url": "https://github.com/ibissource/iaf/pull/1083#discussion_r494829258", "bodyText": "Heeeeeeeee, dit gebeurd nu 3 keer?", "author": "nielsm5", "createdAt": "2020-09-25T08:25:29Z", "path": "core/src/main/java/nl/nn/adapterframework/jdbc/MessageStoreListener.java", "diffHunk": "@@ -128,14 +128,26 @@ public Object getRawMessage(Map<String,Object> threadContext) throws ListenerExc\n \t\treturn rawMessage;\n \t}\n \n+\t@Override\n+\tpublic IMessageBrowser<Object> getInProcessBrowser() {\n+\t\tIMessageBrowser<Object> result = super.getInProcessBrowser();\n+\t\tif (result!=null && result instanceof JdbcTableMessageBrowser) {\n+\t\t\tJdbcTableMessageBrowser<Object> jtmb = (JdbcTableMessageBrowser<Object>)result;\n+\t\t\tjtmb.setCommentField(\"COMMENTS\");\n+\t\t\tjtmb.setExpiryDateField(\"EXPIRYDATE\");\n+\t\t\tjtmb.setHostField(\"HOST\");", "originalCommit": "d27fc69e708ba0fb07fb25a24bb773266a1552af", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDgzMTM5NA==", "url": "https://github.com/ibissource/iaf/pull/1083#discussion_r494831394", "bodyText": "Mag dan weg toch? als het toch niets doet...", "author": "nielsm5", "createdAt": "2020-09-25T08:29:16Z", "path": "core/src/main/java/nl/nn/adapterframework/jdbc/JdbcTransactionalStorage.java", "diffHunk": "@@ -1013,9 +1013,10 @@ public boolean isActive() {\n \t\treturn active;\n \t}\n \n+\t@Override\n \t@IbisDoc({\"the name of the column that stores the hostname of the server\", \"host\"})\n \tpublic void setHostField(String hostField) {\n-\t\tthis.hostField = hostField;\n+\t\tsuper.setHostField(hostField);\n \t}\n ", "originalCommit": "d27fc69e708ba0fb07fb25a24bb773266a1552af", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTA4MTQ3NA==", "url": "https://github.com/ibissource/iaf/pull/1083#discussion_r495081474", "bodyText": "toch niet, want de super is protected", "author": "gvanbrakel", "createdAt": "2020-09-25T15:54:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDgzMTM5NA=="}], "type": "inlineReview"}, {"oid": "4a220025d6d019023eaf6b7789757ff779d07d08", "url": "https://github.com/ibissource/iaf/commit/4a220025d6d019023eaf6b7789757ff779d07d08", "message": "Fix issue", "committedDate": "2020-09-25T16:01:32Z", "type": "commit"}, {"oid": "9bd84d21c6c0b4ffdd96b7c355bd21ea1a920dbb", "url": "https://github.com/ibissource/iaf/commit/9bd84d21c6c0b4ffdd96b7c355bd21ea1a920dbb", "message": "Use Datasource and Driver for Oracle", "committedDate": "2020-09-28T08:23:57Z", "type": "commit"}, {"oid": "72c9b4ccab19fa1c0bcf3676838dc0b7d70de472", "url": "https://github.com/ibissource/iaf/commit/72c9b4ccab19fa1c0bcf3676838dc0b7d70de472", "message": "MsSqlServer using type datasource and driverClassName", "committedDate": "2020-09-28T08:41:58Z", "type": "commit"}, {"oid": "6f7cc68ebe5f4635511d9a6d5f91734f2e61f884", "url": "https://github.com/ibissource/iaf/commit/6f7cc68ebe5f4635511d9a6d5f91734f2e61f884", "message": "MySQL and MariaDB using type datasource and driverClassName", "committedDate": "2020-09-28T09:04:15Z", "type": "commit"}, {"oid": "e139a8e7ae54127da5f75c13bfae901a1ebb5349", "url": "https://github.com/ibissource/iaf/commit/e139a8e7ae54127da5f75c13bfae901a1ebb5349", "message": "Merge branch 'master' into Add_MariaDB_full_JdbcListener_support", "committedDate": "2020-09-28T11:33:05Z", "type": "commit"}, {"oid": "2e535c36c5536e84a1bd2222706a3d8f4bec86cb", "url": "https://github.com/ibissource/iaf/commit/2e535c36c5536e84a1bd2222706a3d8f4bec86cb", "message": "cosmetic", "committedDate": "2020-09-28T12:47:28Z", "type": "commit"}]}