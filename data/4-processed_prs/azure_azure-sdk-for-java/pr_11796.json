{"pr_number": 11796, "pr_title": "Migrate integration tests for spring modules", "pr_createdAt": "2020-06-05T01:24:46Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/11796", "timeline": [{"oid": "189f4c7f83d1fe596fc3a947cac58e0627a62741", "url": "https://github.com/Azure/azure-sdk-for-java/commit/189f4c7f83d1fe596fc3a947cac58e0627a62741", "message": "modify versions and remove dependencymanagement", "committedDate": "2020-06-05T14:21:09Z", "type": "forcePushed"}, {"oid": "b45c02f9f448d2003d8cec87fa826c30dabbbd81", "url": "https://github.com/Azure/azure-sdk-for-java/commit/b45c02f9f448d2003d8cec87fa826c30dabbbd81", "message": "add readme.md for pipeline check", "committedDate": "2020-06-08T02:19:38Z", "type": "forcePushed"}, {"oid": "85f6c85d9781c6d26fa49fc2e1fa42a89083d54c", "url": "https://github.com/Azure/azure-sdk-for-java/commit/85f6c85d9781c6d26fa49fc2e1fa42a89083d54c", "message": "add external dependencies", "committedDate": "2020-06-08T03:39:03Z", "type": "forcePushed"}, {"oid": "bf2bb88d19d44538dfe94127722fe389b7520db5", "url": "https://github.com/Azure/azure-sdk-for-java/commit/bf2bb88d19d44538dfe94127722fe389b7520db5", "message": "add external dependencies", "committedDate": "2020-06-08T04:15:45Z", "type": "forcePushed"}, {"oid": "6ef4bb9b09f4a2a987cdd4f10ad028eab86ce29f", "url": "https://github.com/Azure/azure-sdk-for-java/commit/6ef4bb9b09f4a2a987cdd4f10ad028eab86ce29f", "message": "exclude integration tests in CI pipeline", "committedDate": "2020-06-10T06:43:00Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODE1NzEzOQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11796#discussion_r438157139", "bodyText": "azure-spring-boot-bom was added to sdk/boms as part of @saragluna's PR which is the correct location. The azure-spring-boot-bom changes shouldn't be in this PR.", "author": "JimSuplizio", "createdAt": "2020-06-10T14:16:48Z", "path": "sdk/spring/azure-spring-boot-bom/pom.xml", "diffHunk": "@@ -0,0 +1,123 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>", "originalCommit": "7ab61ec1ae0fe3e89d5c4fcc4f92ce8e12555dcf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODE2NTQ2NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11796#discussion_r438165464", "bodyText": "Same comment as above. Please rebase and remove the azure-spring-boot-bom from here.", "author": "JimSuplizio", "createdAt": "2020-06-10T14:27:26Z", "path": "sdk/spring/pom.xml", "diffHunk": "@@ -10,6 +10,7 @@\n   <version>1.0.0</version><!-- Need not change for every release-->\n   <modules>\n     <module>azure-spring-boot</module>\n+    <module>azure-spring-boot-bom</module>", "originalCommit": "7ab61ec1ae0fe3e89d5c4fcc4f92ce8e12555dcf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "d520c9c2652a0fc4eca2b5d965f93cc3029624dc", "url": "https://github.com/Azure/azure-sdk-for-java/commit/d520c9c2652a0fc4eca2b5d965f93cc3029624dc", "message": "add integration tests for aad, keyvault and cosmosdb", "committedDate": "2020-06-11T01:47:17Z", "type": "commit"}, {"oid": "a7ad271ec2a24e7a5775168f40d985f57cb2e323", "url": "https://github.com/Azure/azure-sdk-for-java/commit/a7ad271ec2a24e7a5775168f40d985f57cb2e323", "message": "fix tests.yml", "committedDate": "2020-06-11T01:47:23Z", "type": "commit"}, {"oid": "f2cbd11349d1f5b6777b6f0c3cef4d08b2075c35", "url": "https://github.com/Azure/azure-sdk-for-java/commit/f2cbd11349d1f5b6777b6f0c3cef4d08b2075c35", "message": "test for keyvault with vm", "committedDate": "2020-06-11T01:47:24Z", "type": "commit"}, {"oid": "f4d76ed28f2831d66d85b14e68f8336cdf523e91", "url": "https://github.com/Azure/azure-sdk-for-java/commit/f4d76ed28f2831d66d85b14e68f8336cdf523e91", "message": "fix enforcer", "committedDate": "2020-06-11T01:47:24Z", "type": "commit"}, {"oid": "cd94a0c2c3e8c940dda5a386c567b5cd8f477c46", "url": "https://github.com/Azure/azure-sdk-for-java/commit/cd94a0c2c3e8c940dda5a386c567b5cd8f477c46", "message": "apply pr: Deliver multiple KeyVault support", "committedDate": "2020-06-11T01:47:25Z", "type": "commit"}, {"oid": "337c2df63634c4e8f20cc7ff50cfdd77db160e0f", "url": "https://github.com/Azure/azure-sdk-for-java/commit/337c2df63634c4e8f20cc7ff50cfdd77db160e0f", "message": " migrate pr: cache key vault values", "committedDate": "2020-06-11T01:47:26Z", "type": "commit"}, {"oid": "4aa812aff36b994b22ad7d08895a5cf1bc6f6725", "url": "https://github.com/Azure/azure-sdk-for-java/commit/4aa812aff36b994b22ad7d08895a5cf1bc6f6725", "message": "migrate pr: keyvault case sensitive names", "committedDate": "2020-06-11T01:47:26Z", "type": "commit"}, {"oid": "1f2dadfb970f7c3d3ba439c0424fb222fd4afe20", "url": "https://github.com/Azure/azure-sdk-for-java/commit/1f2dadfb970f7c3d3ba439c0424fb222fd4afe20", "message": "multiKeyvaultIT", "committedDate": "2020-06-11T01:47:27Z", "type": "commit"}, {"oid": "2f55a368da8a06f76e2a15a96886c1be9d29e7bf", "url": "https://github.com/Azure/azure-sdk-for-java/commit/2f55a368da8a06f76e2a15a96886c1be9d29e7bf", "message": "export VM resources for keyvaultIT", "committedDate": "2020-06-11T01:47:28Z", "type": "commit"}, {"oid": "a8a748eb5746d2e36757fa3a33a5dea7a004c98f", "url": "https://github.com/Azure/azure-sdk-for-java/commit/a8a748eb5746d2e36757fa3a33a5dea7a004c98f", "message": "ignore keyvaultIT of vmMSI", "committedDate": "2020-06-11T01:47:28Z", "type": "commit"}, {"oid": "6c94117675e2ffe430eb429b22e11e3289d32d4e", "url": "https://github.com/Azure/azure-sdk-for-java/commit/6c94117675e2ffe430eb429b22e11e3289d32d4e", "message": "modify versions and remove dependencymanagement", "committedDate": "2020-06-11T01:47:29Z", "type": "commit"}, {"oid": "a2639838f2ea6b05f9c4a8552c319e7dc0be50f4", "url": "https://github.com/Azure/azure-sdk-for-java/commit/a2639838f2ea6b05f9c4a8552c319e7dc0be50f4", "message": "add readme.md for pipeline check", "committedDate": "2020-06-11T01:47:29Z", "type": "commit"}, {"oid": "2b6efa1a70178ecdd782922438630f346a38cbf5", "url": "https://github.com/Azure/azure-sdk-for-java/commit/2b6efa1a70178ecdd782922438630f346a38cbf5", "message": "add external dependencies", "committedDate": "2020-06-11T01:47:30Z", "type": "commit"}, {"oid": "f3b69ffd4f114c63eb12638fc3076dde0c283cbe", "url": "https://github.com/Azure/azure-sdk-for-java/commit/f3b69ffd4f114c63eb12638fc3076dde0c283cbe", "message": "add dependency for test-core", "committedDate": "2020-06-11T01:47:31Z", "type": "commit"}, {"oid": "43406f833397fc3e3c31dfa732dc17c56f64fa1e", "url": "https://github.com/Azure/azure-sdk-for-java/commit/43406f833397fc3e3c31dfa732dc17c56f64fa1e", "message": "exclude integration tests in CI pipeline", "committedDate": "2020-06-11T01:47:31Z", "type": "commit"}, {"oid": "6687cb8b08ca5a4230c3225408353f303a50befc", "url": "https://github.com/Azure/azure-sdk-for-java/commit/6687cb8b08ca5a4230c3225408353f303a50befc", "message": "add environment var on CI to skip IT", "committedDate": "2020-06-11T02:24:28Z", "type": "commit"}, {"oid": "6687cb8b08ca5a4230c3225408353f303a50befc", "url": "https://github.com/Azure/azure-sdk-for-java/commit/6687cb8b08ca5a4230c3225408353f303a50befc", "message": "add environment var on CI to skip IT", "committedDate": "2020-06-11T02:24:28Z", "type": "forcePushed"}, {"oid": "238d58a487552056d601310abf7523a80e4ddf2b", "url": "https://github.com/Azure/azure-sdk-for-java/commit/238d58a487552056d601310abf7523a80e4ddf2b", "message": "add property for skipSpringITs", "committedDate": "2020-06-11T04:35:10Z", "type": "commit"}, {"oid": "f7da5dea92cb827be0931ad85e50a532e23afdf5", "url": "https://github.com/Azure/azure-sdk-for-java/commit/f7da5dea92cb827be0931ad85e50a532e23afdf5", "message": "Merge pull request #5 from saragluna/feature/migrate-multiKeyvaultIT\n\nadd property for skipSpringITs", "committedDate": "2020-06-11T04:42:48Z", "type": "commit"}, {"oid": "f5f8793eab5e7f1a200c9840ab15b205fc281184", "url": "https://github.com/Azure/azure-sdk-for-java/commit/f5f8793eab5e7f1a200c9840ab15b205fc281184", "message": "refine dependencies", "committedDate": "2020-06-11T09:10:10Z", "type": "commit"}, {"oid": "8c56435193f3075815cc1996e22db08b2beb7711", "url": "https://github.com/Azure/azure-sdk-for-java/commit/8c56435193f3075815cc1996e22db08b2beb7711", "message": "fix dependencies issue", "committedDate": "2020-06-11T11:18:25Z", "type": "commit"}, {"oid": "d11c9bce4ad481c432763e60f9f79da3520eda99", "url": "https://github.com/Azure/azure-sdk-for-java/commit/d11c9bce4ad481c432763e60f9f79da3520eda99", "message": "rename packages", "committedDate": "2020-06-11T11:32:44Z", "type": "commit"}, {"oid": "96da1f31cc2eafe7fc93be64290abbf721345fd8", "url": "https://github.com/Azure/azure-sdk-for-java/commit/96da1f31cc2eafe7fc93be64290abbf721345fd8", "message": "add spring code owners", "committedDate": "2020-06-11T11:33:32Z", "type": "commit"}, {"oid": "b0848e64307cb8a6471f1d3a5a81da884bbf5ff9", "url": "https://github.com/Azure/azure-sdk-for-java/commit/b0848e64307cb8a6471f1d3a5a81da884bbf5ff9", "message": "Merge pull request #6 from saragluna/feature/migrate-multiKeyvaultIT\n\nFeature/migrate multi keyvault it", "committedDate": "2020-06-11T13:19:08Z", "type": "commit"}, {"oid": "444c32b8ca8d7cf8746f1cb9a2fe1402cf330594", "url": "https://github.com/Azure/azure-sdk-for-java/commit/444c32b8ca8d7cf8746f1cb9a2fe1402cf330594", "message": "include a starter in test-core, to make it included when build from source", "committedDate": "2020-06-11T13:53:42Z", "type": "commit"}, {"oid": "956e3be7a0ea94aa4efd3d8b07ead241b017efa5", "url": "https://github.com/Azure/azure-sdk-for-java/commit/956e3be7a0ea94aa4efd3d8b07ead241b017efa5", "message": "Merge pull request #7 from saragluna/feature/migrate-multiKeyvaultIT\n\ninclude a starter in test-core, to make it included when build from source", "committedDate": "2020-06-11T13:58:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTExNzEyNA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11796#discussion_r439117124", "bodyText": "@hemanttanwar @saragluna\nThe Java team needs to comment on this but I think the test matrix needs to be more than just linux and Java 8. Similarly, should this be testing with more than just AZURE_TEST_HTTP_CLIENTS: netty?", "author": "JimSuplizio", "createdAt": "2020-06-11T23:04:02Z", "path": "sdk/spring/tests.yml", "diffHunk": "@@ -0,0 +1,41 @@\n+trigger: none\n+\n+jobs:\n+    - template: ../../eng/pipelines/templates/jobs/archetype-sdk-tests.yml\n+      parameters:\n+        TimeoutInMinutes: 240\n+        MaxParallel: 2\n+        ServiceDirectory: spring\n+        Matrix:\n+          Linux - Java 8 (AzureCloud):", "originalCommit": "956e3be7a0ea94aa4efd3d8b07ead241b017efa5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTE1Nzk2OQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11796#discussion_r439157969", "bodyText": "@JimSuplizio Yes, the matrix needs to be more than just Linux - Java 8 (just using only Linux - Java 8 to save testing time). I will remove the matrix section in tests.yml in this PR to use the default matrix defined in the test template.", "author": "saragluna", "createdAt": "2020-06-12T01:20:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTExNzEyNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTExNzgxOA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11796#discussion_r439117818", "bodyText": "I'm happy to see this PR was updated to pass skipSpringITs into Maven instead of using an environment variable.", "author": "JimSuplizio", "createdAt": "2020-06-11T23:06:06Z", "path": "sdk/spring/tests.yml", "diffHunk": "@@ -0,0 +1,41 @@\n+trigger: none\n+\n+jobs:\n+    - template: ../../eng/pipelines/templates/jobs/archetype-sdk-tests.yml\n+      parameters:\n+        TimeoutInMinutes: 240\n+        MaxParallel: 2\n+        ServiceDirectory: spring\n+        Matrix:\n+          Linux - Java 8 (AzureCloud):\n+            OSVmImage: 'ubuntu-18.04'\n+            JavaVersion: '1.8'\n+            DisplayName: 'Linux - Java 8'\n+            SubscriptionConfiguration: $(sub-config-azure-cloud-test-resources)\n+            AZURE_TEST_HTTP_CLIENTS: netty\n+        TestStepMavenInputs:\n+          options: '-Dmaven.wagon.http.pool=false $(DefaultOptions) -Dmaven.javadoc.skip=true -Drevapi.skip=true -DskipSpringITs=false -pl $(ProjectList)'", "originalCommit": "956e3be7a0ea94aa4efd3d8b07ead241b017efa5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "9d5708dfc9176a79a6e756748e100cc77bd43f95", "url": "https://github.com/Azure/azure-sdk-for-java/commit/9d5708dfc9176a79a6e756748e100cc77bd43f95", "message": "remove the matrix overriding in tests.yml", "committedDate": "2020-06-12T01:29:28Z", "type": "commit"}, {"oid": "3422e53e378e223dc91f23c7a8acfd8b51e0f083", "url": "https://github.com/Azure/azure-sdk-for-java/commit/3422e53e378e223dc91f23c7a8acfd8b51e0f083", "message": "Merge pull request #8 from saragluna/feature/migrate-multiKeyvaultIT\n\nremove the matrix overriding in tests.yml", "committedDate": "2020-06-12T15:39:27Z", "type": "commit"}, {"oid": "646d22230ea86af76f72a19e17fcf26509a103de", "url": "https://github.com/Azure/azure-sdk-for-java/commit/646d22230ea86af76f72a19e17fcf26509a103de", "message": "Merge branch 'master' into feature/migrate-multiKeyvaultIT", "committedDate": "2020-06-12T17:17:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTU2MTM5NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11796#discussion_r439561394", "bodyText": "I'm seeing failures  here that look like they're related to the right environment variables for an AAD app not being present. If you're using the default azure credentials then setting this in the EnvVars section might fix it:\n        ARM_CLIENTID: $(aad-azure-sdk-test-client-id)\n        ARM_CLIENTKEY: $(aad-azure-sdk-test-client-secret)\n        AZURE_TENANT_ID: $(aad-azure-sdk-test-tenant-id)", "author": "danieljurek", "createdAt": "2020-06-12T17:48:45Z", "path": "sdk/spring/tests.yml", "diffHunk": "@@ -1,9 +1,33 @@\n trigger: none\n \n jobs:\n-  - template: ../../eng/pipelines/templates/jobs/archetype-sdk-tests.yml\n-    parameters:\n-      ServiceDirectory: spring\n-      EnvVars:\n-        AZURE_TEST_MODE: LIVE\n-      Artifacts: []\n+    - template: ../../eng/pipelines/templates/jobs/archetype-sdk-tests.yml\n+      parameters:\n+        TimeoutInMinutes: 240\n+        MaxParallel: 2\n+        ServiceDirectory: spring\n+        TestStepMavenInputs:\n+          options: '-Dmaven.wagon.http.pool=false $(DefaultOptions) -Dmaven.javadoc.skip=true -Drevapi.skip=true -DskipSpringITs=false -pl $(ProjectList)'\n+          goals: \"verify\"\n+\n+        Artifacts:\n+          - name: azure-spring-boot-tests\n+            groupId: com.microsoft.azure\n+            safeName: azurespringboot-tests\n+          - name: azure-spring-boot-test-core\n+            groupId: com.microsoft.azure\n+            safeName: azurespringboottestcore\n+          - name: azure-spring-boot-test-cosmosdb\n+            groupId: com.microsoft.azure\n+            safeName: azurespringboottestcosmosdb\n+          - name: azure-spring-boot-test-aad\n+            groupId: com.microsoft.azure\n+            safeName: azurespringboottestaad\n+          - name: azure-spring-boot-test-keyvault\n+            groupId: com.microsoft.azure\n+            safeName: azurespringboottestkeyvault\n+          - name: azure-spring-boot-test-application\n+            groupId: com.microsoft.azure\n+            safeName: azurespringboottestapplication\n+        EnvVars:\n+          AZURE_TEST_MODE: LIVE", "originalCommit": "646d22230ea86af76f72a19e17fcf26509a103de", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTcwMDUxNw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11796#discussion_r439700517", "bodyText": "@danieljurek We're using another Azure AD (which is created by ourselves) so we'll need to add such environment variables for the pipeline. Should we create a variable group for these variables or is there somewhere we could add them to? Seems like I don't have the permission to edit the pipeline.", "author": "saragluna", "createdAt": "2020-06-13T02:19:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTU2MTM5NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTU2NTk2Mg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11796#discussion_r439565962", "bodyText": "MaxParallel is probably not necessary here. For the most part you probably only need to set it when one or more of these is true:\n\nTests use some shared resource (you're using test-resources.json which gives you one set of resources per job)\nThe resources you're creating have a low upper bound for the number of instances which can be created in a subscription and you want to limit parallelism to prevent having too many instances of that resource active at once\nYour test matrix is enormous and running tests would saturate our agent pool and make other tests wait a long time in a queued state", "author": "danieljurek", "createdAt": "2020-06-12T17:58:41Z", "path": "sdk/spring/tests.yml", "diffHunk": "@@ -1,9 +1,33 @@\n trigger: none\n \n jobs:\n-  - template: ../../eng/pipelines/templates/jobs/archetype-sdk-tests.yml\n-    parameters:\n-      ServiceDirectory: spring\n-      EnvVars:\n-        AZURE_TEST_MODE: LIVE\n-      Artifacts: []\n+    - template: ../../eng/pipelines/templates/jobs/archetype-sdk-tests.yml\n+      parameters:\n+        TimeoutInMinutes: 240\n+        MaxParallel: 2", "originalCommit": "646d22230ea86af76f72a19e17fcf26509a103de", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTcwMDAzNQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11796#discussion_r439700035", "bodyText": "Okay, I'll remove it then.", "author": "saragluna", "createdAt": "2020-06-13T02:12:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTU2NTk2Mg=="}], "type": "inlineReview"}, {"oid": "4189114c7a778110835eafe3fcadd0df77e0ca4a", "url": "https://github.com/Azure/azure-sdk-for-java/commit/4189114c7a778110835eafe3fcadd0df77e0ca4a", "message": "remove MaxParallel parameter in spring tests.yml", "committedDate": "2020-06-13T02:46:15Z", "type": "commit"}, {"oid": "538793c9bc9a32ef8a406b7e8a5b0dafe1cc04ce", "url": "https://github.com/Azure/azure-sdk-for-java/commit/538793c9bc9a32ef8a406b7e8a5b0dafe1cc04ce", "message": "Merge pull request #9 from saragluna/feature/migrate-multiKeyvaultIT\n\nremove MaxParallel parameter in spring tests.yml", "committedDate": "2020-06-13T03:11:20Z", "type": "commit"}]}