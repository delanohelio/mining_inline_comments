{"pr_number": 18372, "pr_title": "Update README.md file in the resource-server-obo", "pr_createdAt": "2020-12-28T07:01:01Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/18372", "timeline": [{"oid": "e24c2adaa4c29744a8f518a460e444ec10a65bbc", "url": "https://github.com/Azure/azure-sdk-for-java/commit/e24c2adaa4c29744a8f518a460e444ec10a65bbc", "message": "Update the resource sever obo README.md file.", "committedDate": "2020-12-28T06:57:29Z", "type": "commit"}, {"oid": "cfe48f408cf378025e2505336b1e46b54624571d", "url": "https://github.com/Azure/azure-sdk-for-java/commit/cfe48f408cf378025e2505336b1e46b54624571d", "message": "Merge branch 'master' into update_obo_sample_readme\n\n# Conflicts:\n#\tsdk/spring/azure-spring-boot-samples/azure-spring-boot-sample-active-directory-resource-server-obo/src/main/resources/application.yaml", "committedDate": "2020-12-28T07:06:09Z", "type": "commit"}, {"oid": "9ba6c076633d22c26d981eac86e06a44399a9317", "url": "https://github.com/Azure/azure-sdk-for-java/commit/9ba6c076633d22c26d981eac86e06a44399a9317", "message": "Update the resource sever obo README.md file.", "committedDate": "2020-12-28T07:07:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU1NTU5MQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18372#discussion_r549555591", "bodyText": "Did we mention the Web API sample link somewhere above?", "author": "saragluna", "createdAt": "2020-12-29T03:32:24Z", "path": "sdk/spring/azure-spring-boot-samples/azure-spring-boot-sample-active-directory-resource-server-obo/README.md", "diffHunk": "@@ -48,68 +55,44 @@ We need to ensure that this [environment checklist][ready-to-run-checklist] is c\n </dependencies>\n ```\n \n-### Register your Web API\n-You can follow *azure-spring-boot-sample-active-directory-resource-server* sample to add `ResourceAccessGraph.read`, `ResourceAccessGraphCustomResources.read` scopes. \n-Convention current application id url is `api://sample-client-id`, ; the application id url of the sample *azure-spring-boot-sample-active-directory-resource-server* is `custom-client-id`.  \n-After adding as shown below:\n-\n-   ![API Permissions](resource/resource-server-obo-add-scope.png)\n-\n-### Add API permissions\n-The current Web API will access Graph API and Custom API. \n-\n-Sign in to the [Azure portal][azure-portal]. If you have access to multiple tenants, use the **Directory + subscription** filter  in the top menu to select the tenant containing your client app's registration.\n-\n-#### Add Graph API Permission\n-1. Select **Azure Active Directory** > **App registrations**, and then select your current sample application (not your web API).\n-\n-2. Select **API permissions** > **Add a permission** > **Microsoft APIs** > **Microsoft Graph** > **Delegated permissions**, select **User.Read**, select **Add permission** to complete the process.\n+### Configure your middle-tier Web API A\n+1. You can follow *Web API A* sample to add `ResourceAccessGraph.Read`, `ResourceAccessGraphCustomResources.Read` scopes. Convention current application id url is `api://xxxxx-xxxx-xxxxxx`.(**NOTE**: In the **Web API A** `ResourceAccessGraph.Read`, `ResourceAccessGraphCustomResources.Read` scopes should be added to the **Web APP**.)![API Permissions](docs/image-resource-server-obo-add-scope.png)", "originalCommit": "9ba6c076633d22c26d981eac86e06a44399a9317", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU1NTYyNA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18372#discussion_r549555624", "bodyText": "Maybe Convention of current application id is better.", "author": "saragluna", "createdAt": "2020-12-29T03:32:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU1NTU5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU1NTY5MQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18372#discussion_r549555691", "bodyText": "Why do we have a concept of Web APP here?", "author": "saragluna", "createdAt": "2020-12-29T03:33:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU1NTU5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU2OTkwOA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18372#discussion_r549569908", "bodyText": "Did we mention the Web API sample link somewhere above?\nYes. A link to a sample Web API already exists above.\nMaybe Convention of current application id is better.\nI agree with you.\nWhy do we have a concept of Web APP here?\nI want to tell users of this sample that they should configure their Web API A permissions in their web app.", "author": "ZhuXiaoBing-cn", "createdAt": "2020-12-29T05:10:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU1NTU5MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU1NTg1MA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18372#discussion_r549555850", "bodyText": "We don't need the Graph API permissions now?", "author": "saragluna", "createdAt": "2020-12-29T03:34:18Z", "path": "sdk/spring/azure-spring-boot-samples/azure-spring-boot-sample-active-directory-resource-server-obo/README.md", "diffHunk": "@@ -48,68 +55,44 @@ We need to ensure that this [environment checklist][ready-to-run-checklist] is c\n </dependencies>\n ```\n \n-### Register your Web API\n-You can follow *azure-spring-boot-sample-active-directory-resource-server* sample to add `ResourceAccessGraph.read`, `ResourceAccessGraphCustomResources.read` scopes. \n-Convention current application id url is `api://sample-client-id`, ; the application id url of the sample *azure-spring-boot-sample-active-directory-resource-server* is `custom-client-id`.  \n-After adding as shown below:\n-\n-   ![API Permissions](resource/resource-server-obo-add-scope.png)\n-\n-### Add API permissions\n-The current Web API will access Graph API and Custom API. \n-\n-Sign in to the [Azure portal][azure-portal]. If you have access to multiple tenants, use the **Directory + subscription** filter  in the top menu to select the tenant containing your client app's registration.\n-\n-#### Add Graph API Permission\n-1. Select **Azure Active Directory** > **App registrations**, and then select your current sample application (not your web API).", "originalCommit": "9ba6c076633d22c26d981eac86e06a44399a9317", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU3MDIxMg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18372#discussion_r549570212", "bodyText": "I'm using photos instead of text description.", "author": "ZhuXiaoBing-cn", "createdAt": "2020-12-29T05:12:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU1NTg1MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU1NjAxMw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18372#discussion_r549556013", "bodyText": "Maybe we could remove the Sample here.", "author": "saragluna", "createdAt": "2020-12-29T03:35:15Z", "path": "sdk/spring/azure-spring-boot-samples/azure-spring-boot-sample-active-directory-resource-server-obo/README.md", "diffHunk": "@@ -48,68 +55,44 @@ We need to ensure that this [environment checklist][ready-to-run-checklist] is c\n </dependencies>\n ```\n \n-### Register your Web API\n-You can follow *azure-spring-boot-sample-active-directory-resource-server* sample to add `ResourceAccessGraph.read`, `ResourceAccessGraphCustomResources.read` scopes. \n-Convention current application id url is `api://sample-client-id`, ; the application id url of the sample *azure-spring-boot-sample-active-directory-resource-server* is `custom-client-id`.  \n-After adding as shown below:\n-\n-   ![API Permissions](resource/resource-server-obo-add-scope.png)\n-\n-### Add API permissions\n-The current Web API will access Graph API and Custom API. \n-\n-Sign in to the [Azure portal][azure-portal]. If you have access to multiple tenants, use the **Directory + subscription** filter  in the top menu to select the tenant containing your client app's registration.\n-\n-#### Add Graph API Permission\n-1. Select **Azure Active Directory** > **App registrations**, and then select your current sample application (not your web API).\n-\n-2. Select **API permissions** > **Add a permission** > **Microsoft APIs** > **Microsoft Graph** > **Delegated permissions**, select **User.Read**, select **Add permission** to complete the process.\n+### Configure your middle-tier Web API A\n+1. You can follow *Web API A* sample to add `ResourceAccessGraph.Read`, `ResourceAccessGraphCustomResources.Read` scopes. Convention current application id url is `api://xxxxx-xxxx-xxxxxx`.(**NOTE**: In the **Web API A** `ResourceAccessGraph.Read`, `ResourceAccessGraphCustomResources.Read` scopes should be added to the **Web APP**.)![API Permissions](docs/image-resource-server-obo-add-scope.png)\n+2. Select **API permissions** > **Add a permission** > **My APIs**, select *Web API B* application name. ![Select MyAPIs](docs/image-select-myapis.png)\n+3. **Delegated permissions** is selected by default\uff0c Select **File** > **File.Read** permission, select **Add permission** to complete the process.![Add Permissions](docs/image-add-permissions.png)\n+4. Add **Web API B** permissions to **Web API A** and grant admin consent.![API Permissions](docs/image-add-grant-admin-consent.png)\n \n-#### Add Custom API Permission\n-\n-1. Select **Azure Active Directory** > **App registrations**, and then select your current sample application (not your web API).\n-\n-2. Select **API permissions** > **Add a permission** > **My APIs**, select *azure-spring-boot-sample-active-directory-resource-server* application name.\n-\n-3. **Delegated permissions** is selected by default\uff0c Select **File** > **File.Read** permission, select **Add permission** to complete the process.\n-\n-### Grant consent for your tenant\n-Respectively grant admin consent to the Graph and Custom permissions. After adding as shown below:\n-   ![API Permissions](resource/resource-server-obo-add-permissions.png)\n+See [OAuth 2.0 On-Behalf-Of flow] for more information about OBO.\n \n ## Examples\n-\n-### Configure application.yaml\n-\n+### Configure application.yml\n ```yaml\n azure:\n   activedirectory:\n     resource-server:\n       obo:\n         enabled: true\n-    client-id: [resource-server-application-client-id]\n-    client-secret: [resource-server-application-client-secret]\n-    tenant-id: [tenant-id-registered-by-application]\n-    app-id-uri: api://sample-client-id\n+    client-id: <Web-API-A-client-id>\n+    client-secret: <Web-API-A-client-secret>\n+    tenant-id: <tenant-id-registered-by-application>\n+    app-id-uri: <Web-API-A-app-id-url>\n     authorization:\n       graph:\n         scopes:\n           - https://graph.microsoft.com/User.Read\n       custom:\n         scopes:\n-          - api://custom-client-id/File.read\n+          - <Web-API-B-app-id-url>/File.Read\n ```\n \n-### Run with Maven \n-\n+### Run with Maven\n ```shell\n cd azure-spring-boot-samples/azure-spring-boot-sample-active-directory-resource-server-obo\n mvn spring-boot:run\n ```\n \n-### Access the Web API\n-First, you need to obtain an access token to access Sample API.\n-- API will Only call Graph resource. \n+### Access the Web API A\n+First, you need to obtain an access token to access Sample Web API A.", "originalCommit": "9ba6c076633d22c26d981eac86e06a44399a9317", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU3MDM2OA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18372#discussion_r549570368", "bodyText": "You are right.", "author": "ZhuXiaoBing-cn", "createdAt": "2020-12-29T05:13:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU1NjAxMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU1NjY1MA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18372#discussion_r549556650", "bodyText": "Can we change this scope to Graph.Read?", "author": "saragluna", "createdAt": "2020-12-29T03:39:18Z", "path": "sdk/spring/azure-spring-boot-samples/azure-spring-boot-sample-active-directory-resource-server-obo/src/main/java/com/azure/spring/sample/aad/controller/SampleController.java", "diffHunk": "@@ -41,7 +41,7 @@\n      * @return Response with graph data\n      */\n     @GetMapping(\"call-graph-only\")\n-    @PreAuthorize(\"hasAuthority('SCOPE_ResourceAccessGraph.read')\")\n+    @PreAuthorize(\"hasAuthority('SCOPE_ResourceAccessGraph.Read')\")", "originalCommit": "9ba6c076633d22c26d981eac86e06a44399a9317", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU1NzE5NQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18372#discussion_r549557195", "bodyText": "Oh, I think we could call these scopes Obo.Graph.Read and Obo.File.Read?", "author": "saragluna", "createdAt": "2020-12-29T03:43:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU1NjY1MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTYyMTgxMA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18372#discussion_r549621810", "bodyText": "Here I chose Obo.Graph.Read in the end.", "author": "ZhuXiaoBing-cn", "createdAt": "2020-12-29T08:51:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU1NjY1MA=="}], "type": "inlineReview"}, {"oid": "26b13bc5a53d12990c1ae0669cf88d39aa8ea0e0", "url": "https://github.com/Azure/azure-sdk-for-java/commit/26b13bc5a53d12990c1ae0669cf88d39aa8ea0e0", "message": "Update the resource-server-obo README.md file.", "committedDate": "2020-12-29T08:40:55Z", "type": "commit"}, {"oid": "d66306ec88173f285960c184c68eeac33d484ed3", "url": "https://github.com/Azure/azure-sdk-for-java/commit/d66306ec88173f285960c184c68eeac33d484ed3", "message": "Merge branch 'master' into update_obo_sample_readme\n\n# Conflicts:\n#\tsdk/spring/azure-spring-boot-samples/azure-spring-boot-sample-active-directory-resource-server-obo/README.md\n#\tsdk/spring/azure-spring-boot-samples/azure-spring-boot-sample-active-directory-resource-server-obo/src/main/resources/application.yaml", "committedDate": "2020-12-29T08:46:35Z", "type": "commit"}, {"oid": "7b4d05e5d01cbd4cab840676d9b143b545d0b5ae", "url": "https://github.com/Azure/azure-sdk-for-java/commit/7b4d05e5d01cbd4cab840676d9b143b545d0b5ae", "message": "Update the resource-server-obo README.md file.", "committedDate": "2020-12-29T08:48:27Z", "type": "commit"}, {"oid": "faeb4d7edda0c81f3bb4102a497d772021e8c7c2", "url": "https://github.com/Azure/azure-sdk-for-java/commit/faeb4d7edda0c81f3bb4102a497d772021e8c7c2", "message": "Update the resource-server-obo README.md file and modify part of the code.", "committedDate": "2020-12-29T09:26:32Z", "type": "commit"}, {"oid": "78753507fe544ebdd67e2f0736f0f1ea1993a5ce", "url": "https://github.com/Azure/azure-sdk-for-java/commit/78753507fe544ebdd67e2f0736f0f1ea1993a5ce", "message": "Update README.md", "committedDate": "2020-12-29T10:22:08Z", "type": "commit"}, {"oid": "83244a7d61fcb5b9beeefdc31980e36c8c3234d5", "url": "https://github.com/Azure/azure-sdk-for-java/commit/83244a7d61fcb5b9beeefdc31980e36c8c3234d5", "message": "Update README.md", "committedDate": "2020-12-29T10:33:01Z", "type": "commit"}, {"oid": "13364294262e99d89d6b238d266ea57a3fba0928", "url": "https://github.com/Azure/azure-sdk-for-java/commit/13364294262e99d89d6b238d266ea57a3fba0928", "message": "Update SampleController.java", "committedDate": "2020-12-29T10:35:25Z", "type": "commit"}, {"oid": "8beca7589da7f2b2d809a20d88702ab5801904fe", "url": "https://github.com/Azure/azure-sdk-for-java/commit/8beca7589da7f2b2d809a20d88702ab5801904fe", "message": "Merge branch 'master' into update_obo_sample_readme", "committedDate": "2020-12-29T10:37:58Z", "type": "commit"}]}