{"pr_number": 13025, "pr_title": "Refactor poller's activate, polling, fetching operation helper function", "pr_createdAt": "2020-07-10T16:05:31Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/13025", "timeline": [{"oid": "467e62fee009c8167ba25fccf98597b7c8881642", "url": "https://github.com/Azure/azure-sdk-for-java/commit/467e62fee009c8167ba25fccf98597b7c8881642", "message": "refactor poller's activate, polling, fetching operation helper and some javadoc", "committedDate": "2020-07-10T15:57:03Z", "type": "commit"}, {"oid": "67b2ce57dc65b12440bd43b0e303c8f7ab46fc4a", "url": "https://github.com/Azure/azure-sdk-for-java/commit/67b2ce57dc65b12440bd43b0e303c8f7ab46fc4a", "message": "nit, period at the end of sentence", "committedDate": "2020-07-10T16:13:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjk1OTQ0NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13025#discussion_r452959444", "bodyText": "Why not update the fetching operation here?", "author": "samvaity", "createdAt": "2020-07-10T16:52:05Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/FormRecognizerAsyncClient.java", "diffHunk": "@@ -305,17 +328,23 @@\n      * been cancelled. The completed operation returns a List of {@link FormPage}.\n      * @throws FormRecognizerException If recognize operation fails and the {@link AnalyzeOperationResult} returned with\n      * an {@link OperationStatus#FAILED}.\n-     * @throws NullPointerException If {@code recognizeOptions} is {@code null}.\n+     * @throws NullPointerException If {@code form} is null.\n      */\n     @ServiceMethod(returns = ReturnType.COLLECTION)\n     public PollerFlux<OperationResult, List<FormPage>> beginRecognizeContent(Flux<ByteBuffer> form, long length,\n         RecognizeOptions recognizeOptions) {\n         try {\n+            Objects.requireNonNull(form, \"'form' is required and cannot be null.\");\n+\n             recognizeOptions = getRecognizeOptionsProperties(recognizeOptions);\n             return new PollerFlux<>(\n                 recognizeOptions.getPollInterval(),\n-                contentStreamActivationOperation(form, length, recognizeOptions.getContentType()),\n-                extractContentPollOperation(),\n+                streamActivationOperation(\n+                    contentType -> service.analyzeLayoutAsyncWithResponseAsync(contentType, form, length)\n+                        .map(response -> new OperationResult(\n+                            parseModelId(response.getDeserializedHeaders().getOperationLocation()))),\n+                    form, recognizeOptions.getContentType()),\n+                pollingOperation(service::getAnalyzeLayoutResultWithResponseAsync),\n                 (activationResponse, context) ->\n                     monoError(logger, new RuntimeException(\"Cancellation is not supported\")),\n                 fetchExtractContentResult());", "originalCommit": "67b2ce57dc65b12440bd43b0e303c8f7ab46fc4a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzAxMDAyMA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13025#discussion_r453010020", "bodyText": "It returns Mono<List<FormPage>> other fetching returns Mono<List<RecognizedForm>>\nand FormPage and RecognizedForm has no common parent.", "author": "mssfang", "createdAt": "2020-07-10T18:38:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjk1OTQ0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzA1MjAxNg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13025#discussion_r453052016", "bodyText": "So you just grouped the receipt and form custom form API ?\nbut not the content API?", "author": "samvaity", "createdAt": "2020-07-10T20:01:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjk1OTQ0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzA5MDQxOQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13025#discussion_r453090419", "bodyText": "There are two places are using fetchExtractContentResult() method: beginRecognizeContentFromUrl and beginRecognizeContent. I leave it unchange in both place since there is no benefit of doing so.", "author": "mssfang", "createdAt": "2020-07-10T21:43:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjk1OTQ0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzExMDg3MA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13025#discussion_r453110870", "bodyText": "Updated to use the updated fetchingOperation(). Bring the complexity to upper level but it makes code more clean even we added more line of code.", "author": "mssfang", "createdAt": "2020-07-10T22:51:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjk1OTQ0NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzA1MzI3Mw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13025#discussion_r453053273", "bodyText": "To make this method common to all the API's we could have it return the modelSimpleResponse and let the respective API's do their conversion toRecognizedForm() or toFormPage?", "author": "samvaity", "createdAt": "2020-07-10T20:04:02Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/FormRecognizerAsyncClient.java", "diffHunk": "@@ -512,12 +514,17 @@\n         };\n     }\n \n-    private Function<PollingContext<OperationResult>, Mono<List<RecognizedForm>>>\n-        fetchExtractReceiptResult(boolean includeFieldElements) {\n+    /*\n+     * Poller's FETCHING operation that fetch a list of RecognizedForm.\n+     */\n+    private Function<PollingContext<OperationResult>, Mono<List<RecognizedForm>>> fetchingOperation(\n+        Function<UUID, Mono<SimpleResponse<AnalyzeOperationResult>>> fetchingFunction,\n+        boolean includeFieldElements) {\n+\n         return (pollingContext) -> {\n             try {\n                 final UUID resultUid = UUID.fromString(pollingContext.getLatestResponse().getValue().getResultId());\n-                return service.getAnalyzeReceiptResultWithResponseAsync(resultUid)\n+                return fetchingFunction.apply(resultUid)\n                     .map(modelSimpleResponse -> {\n                         throwIfAnalyzeStatusInvalid(modelSimpleResponse.getValue());\n                         return toRecognizedForm(modelSimpleResponse.getValue().getAnalyzeResult(),", "originalCommit": "67b2ce57dc65b12440bd43b0e303c8f7ab46fc4a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "a9adaf530fdc27f5804aff955ff57651bcdfd15d", "url": "https://github.com/Azure/azure-sdk-for-java/commit/a9adaf530fdc27f5804aff955ff57651bcdfd15d", "message": "remove fetchExtractContentResult() and use the updated fetchingOperation() method", "committedDate": "2020-07-10T22:49:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzg0ODEwNA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13025#discussion_r453848104", "bodyText": "nit: activationOperation::apply", "author": "samvaity", "createdAt": "2020-07-13T18:30:12Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/FormRecognizerAsyncClient.java", "diffHunk": "@@ -512,192 +540,55 @@\n         };\n     }\n \n-    private Function<PollingContext<OperationResult>, Mono<List<RecognizedForm>>>\n-        fetchExtractReceiptResult(boolean includeFieldElements) {\n-        return (pollingContext) -> {\n-            try {\n-                final UUID resultUid = UUID.fromString(pollingContext.getLatestResponse().getValue().getResultId());\n-                return service.getAnalyzeReceiptResultWithResponseAsync(resultUid)\n-                    .map(modelSimpleResponse -> {\n-                        throwIfAnalyzeStatusInvalid(modelSimpleResponse.getValue());\n-                        return toRecognizedForm(modelSimpleResponse.getValue().getAnalyzeResult(),\n-                            includeFieldElements);\n-                    })\n-                    .onErrorMap(Utility::mapToHttpResponseExceptionIfExist);\n-            } catch (RuntimeException ex) {\n-                return monoError(logger, ex);\n-            }\n-        };\n-    }\n+    /*\n+     * Poller's FETCHING operation.\n+     */\n+    private Function<PollingContext<OperationResult>, Mono<SimpleResponse<AnalyzeOperationResult>>> fetchingOperation(\n+        Function<UUID, Mono<SimpleResponse<AnalyzeOperationResult>>> fetchingFunction) {\n \n-    private Function<PollingContext<OperationResult>, Mono<OperationResult>> contentAnalyzeActivationOperation(\n-        String formUrl) {\n         return (pollingContext) -> {\n             try {\n-                Objects.requireNonNull(formUrl, \"'formUrl' is required and cannot be null.\");\n-                return service.analyzeLayoutAsyncWithResponseAsync(new SourcePath().setSource(formUrl))\n-                    .map(response ->\n-                        new OperationResult(parseModelId(response.getDeserializedHeaders().getOperationLocation())))\n-                    .onErrorMap(Utility::mapToHttpResponseExceptionIfExist);\n+                final UUID resultUid = UUID.fromString(pollingContext.getLatestResponse().getValue().getResultId());\n+                return fetchingFunction.apply(resultUid);\n             } catch (RuntimeException ex) {\n                 return monoError(logger, ex);\n             }\n         };\n     }\n \n-    private Function<PollingContext<OperationResult>, Mono<OperationResult>> contentStreamActivationOperation(\n-        Flux<ByteBuffer> form, long length, FormContentType contentType) {\n+    /*\n+     * Poller's ACTIVATION operation that takes stream as input.\n+     */\n+    private Function<PollingContext<OperationResult>, Mono<OperationResult>> streamActivationOperation(\n+        Function<ContentType, Mono<OperationResult>> activationOperation, Flux<ByteBuffer> form,\n+        FormContentType contentType) {\n         return pollingContext -> {\n+            Mono<OperationResult> operationResultMono;\n             try {\n-                Objects.requireNonNull(form, \"'form' is required and cannot be null.\");\n                 if (contentType != null) {\n-                    return service.analyzeLayoutAsyncWithResponseAsync(\n-                        ContentType.fromString(contentType.toString()), form, length)\n-                        .map(response -> new OperationResult(parseModelId(\n-                            response.getDeserializedHeaders().getOperationLocation())))\n-                        .onErrorMap(Utility::mapToHttpResponseExceptionIfExist);\n+                    final ContentType givenContentType = ContentType.fromString(contentType.toString());\n+                    operationResultMono = activationOperation.apply(givenContentType);\n                 } else {\n-                    return detectContentType(form)\n-                        .flatMap(detectedContentType ->\n-                            service.analyzeLayoutAsyncWithResponseAsync(detectedContentType, form, length)\n-                                .map(response -> new OperationResult(\n-                                    parseModelId(response.getDeserializedHeaders().getOperationLocation()))))\n-                        .onErrorMap(Utility::mapToHttpResponseExceptionIfExist);\n+                    operationResultMono = detectContentType(form)\n+                        .flatMap(detectedContentType -> activationOperation.apply(detectedContentType));", "originalCommit": "a9adaf530fdc27f5804aff955ff57651bcdfd15d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzg0OTkxMw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13025#discussion_r453849913", "bodyText": "Not sure, if we are using this publisher's value", "author": "samvaity", "createdAt": "2020-07-13T18:33:05Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/FormRecognizerAsyncClient.java", "diffHunk": "@@ -512,192 +540,55 @@\n         };\n     }\n \n-    private Function<PollingContext<OperationResult>, Mono<List<RecognizedForm>>>\n-        fetchExtractReceiptResult(boolean includeFieldElements) {\n-        return (pollingContext) -> {\n-            try {\n-                final UUID resultUid = UUID.fromString(pollingContext.getLatestResponse().getValue().getResultId());\n-                return service.getAnalyzeReceiptResultWithResponseAsync(resultUid)\n-                    .map(modelSimpleResponse -> {\n-                        throwIfAnalyzeStatusInvalid(modelSimpleResponse.getValue());\n-                        return toRecognizedForm(modelSimpleResponse.getValue().getAnalyzeResult(),\n-                            includeFieldElements);\n-                    })\n-                    .onErrorMap(Utility::mapToHttpResponseExceptionIfExist);\n-            } catch (RuntimeException ex) {\n-                return monoError(logger, ex);\n-            }\n-        };\n-    }\n+    /*\n+     * Poller's FETCHING operation.\n+     */\n+    private Function<PollingContext<OperationResult>, Mono<SimpleResponse<AnalyzeOperationResult>>> fetchingOperation(\n+        Function<UUID, Mono<SimpleResponse<AnalyzeOperationResult>>> fetchingFunction) {\n \n-    private Function<PollingContext<OperationResult>, Mono<OperationResult>> contentAnalyzeActivationOperation(\n-        String formUrl) {\n         return (pollingContext) -> {\n             try {\n-                Objects.requireNonNull(formUrl, \"'formUrl' is required and cannot be null.\");\n-                return service.analyzeLayoutAsyncWithResponseAsync(new SourcePath().setSource(formUrl))\n-                    .map(response ->\n-                        new OperationResult(parseModelId(response.getDeserializedHeaders().getOperationLocation())))\n-                    .onErrorMap(Utility::mapToHttpResponseExceptionIfExist);\n+                final UUID resultUid = UUID.fromString(pollingContext.getLatestResponse().getValue().getResultId());\n+                return fetchingFunction.apply(resultUid);\n             } catch (RuntimeException ex) {\n                 return monoError(logger, ex);\n             }\n         };\n     }\n \n-    private Function<PollingContext<OperationResult>, Mono<OperationResult>> contentStreamActivationOperation(\n-        Flux<ByteBuffer> form, long length, FormContentType contentType) {\n+    /*\n+     * Poller's ACTIVATION operation that takes stream as input.\n+     */\n+    private Function<PollingContext<OperationResult>, Mono<OperationResult>> streamActivationOperation(\n+        Function<ContentType, Mono<OperationResult>> activationOperation, Flux<ByteBuffer> form,\n+        FormContentType contentType) {\n         return pollingContext -> {\n+            Mono<OperationResult> operationResultMono;\n             try {\n-                Objects.requireNonNull(form, \"'form' is required and cannot be null.\");\n                 if (contentType != null) {\n-                    return service.analyzeLayoutAsyncWithResponseAsync(\n-                        ContentType.fromString(contentType.toString()), form, length)\n-                        .map(response -> new OperationResult(parseModelId(\n-                            response.getDeserializedHeaders().getOperationLocation())))\n-                        .onErrorMap(Utility::mapToHttpResponseExceptionIfExist);\n+                    final ContentType givenContentType = ContentType.fromString(contentType.toString());\n+                    operationResultMono = activationOperation.apply(givenContentType);\n                 } else {\n-                    return detectContentType(form)\n-                        .flatMap(detectedContentType ->\n-                            service.analyzeLayoutAsyncWithResponseAsync(detectedContentType, form, length)\n-                                .map(response -> new OperationResult(\n-                                    parseModelId(response.getDeserializedHeaders().getOperationLocation()))))\n-                        .onErrorMap(Utility::mapToHttpResponseExceptionIfExist);\n+                    operationResultMono = detectContentType(form)\n+                        .flatMap(detectedContentType -> activationOperation.apply(detectedContentType));\n                 }\n+                operationResultMono.onErrorMap(Utility::mapToHttpResponseExceptionIfExist);", "originalCommit": "a9adaf530fdc27f5804aff955ff57651bcdfd15d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "3ed04f782179459a1b37340c62c34444ef32b243", "url": "https://github.com/Azure/azure-sdk-for-java/commit/3ed04f782179459a1b37340c62c34444ef32b243", "message": "address feedbacks 1", "committedDate": "2020-07-13T23:37:32Z", "type": "commit"}, {"oid": "a0ea7f8d7ae4a7959c76c00b2e4fdf31337e4dc4", "url": "https://github.com/Azure/azure-sdk-for-java/commit/a0ea7f8d7ae4a7959c76c00b2e4fdf31337e4dc4", "message": "using == instead of equals()", "committedDate": "2020-07-14T01:27:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTI4ODAxMQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13025#discussion_r455288011", "bodyText": "nit: rename resultUid to resultUuid", "author": "srnagar", "createdAt": "2020-07-15T19:24:10Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/FormRecognizerAsyncClient.java", "diffHunk": "@@ -512,56 +540,37 @@\n         };\n     }\n \n-    private Function<PollingContext<OperationResult>, Mono<List<RecognizedForm>>>\n-        fetchExtractReceiptResult(boolean includeFieldElements) {\n-        return (pollingContext) -> {\n-            try {\n-                final UUID resultUid = UUID.fromString(pollingContext.getLatestResponse().getValue().getResultId());\n-                return service.getAnalyzeReceiptResultWithResponseAsync(resultUid)\n-                    .map(modelSimpleResponse -> {\n-                        throwIfAnalyzeStatusInvalid(modelSimpleResponse.getValue());\n-                        return toRecognizedForm(modelSimpleResponse.getValue().getAnalyzeResult(),\n-                            includeFieldElements);\n-                    })\n-                    .onErrorMap(Utility::mapToHttpResponseExceptionIfExist);\n-            } catch (RuntimeException ex) {\n-                return monoError(logger, ex);\n-            }\n-        };\n-    }\n+    /*\n+     * Poller's FETCHING operation.\n+     */\n+    private Function<PollingContext<OperationResult>, Mono<SimpleResponse<AnalyzeOperationResult>>> fetchingOperation(\n+        Function<UUID, Mono<SimpleResponse<AnalyzeOperationResult>>> fetchingFunction) {\n \n-    private Function<PollingContext<OperationResult>, Mono<OperationResult>> contentAnalyzeActivationOperation(\n-        String formUrl) {\n         return (pollingContext) -> {\n             try {\n-                Objects.requireNonNull(formUrl, \"'formUrl' is required and cannot be null.\");\n-                return service.analyzeLayoutAsyncWithResponseAsync(new SourcePath().setSource(formUrl))\n-                    .map(response ->\n-                        new OperationResult(parseModelId(response.getDeserializedHeaders().getOperationLocation())))\n-                    .onErrorMap(Utility::mapToHttpResponseExceptionIfExist);\n+                final UUID resultUid = UUID.fromString(pollingContext.getLatestResponse().getValue().getResultId());", "originalCommit": "a0ea7f8d7ae4a7959c76c00b2e4fdf31337e4dc4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTI5MTc5NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13025#discussion_r455291794", "bodyText": "Throwing an exception inside a map operator is odd. In this case, use handle() operator to either sink.error() or sink.next() depending on whether the response is an error or success.", "author": "srnagar", "createdAt": "2020-07-15T19:30:48Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/FormRecognizerAsyncClient.java", "diffHunk": "@@ -434,75 +490,47 @@\n      * or has been cancelled. The completed operation returns a List of {@link RecognizedForm}.\n      * @throws FormRecognizerException If recognize operation fails and the {@link AnalyzeOperationResult} returned with\n      * an {@link OperationStatus#FAILED}.\n-     * @throws NullPointerException If {@code recognizeOptions} is {@code null}.\n+     * @throws NullPointerException If {@code receipt} is null.\n      */\n     @ServiceMethod(returns = ReturnType.COLLECTION)\n     public PollerFlux<OperationResult, List<RecognizedForm>>\n         beginRecognizeReceipts(Flux<ByteBuffer> receipt, long length, RecognizeOptions recognizeOptions) {\n         try {\n+            Objects.requireNonNull(receipt, \"'receipt' is required and cannot be null.\");\n+\n             recognizeOptions = getRecognizeOptionsProperties(recognizeOptions);\n+            final boolean isIncludeFieldElements = recognizeOptions.isIncludeFieldElements();\n             return new PollerFlux<>(\n                 recognizeOptions.getPollInterval(),\n-                receiptStreamActivationOperation(receipt, length,\n-                    recognizeOptions.getContentType(), recognizeOptions.isIncludeFieldElements()),\n-                extractReceiptPollOperation(),\n+                streamActivationOperation(\n+                    (contentType -> service.analyzeReceiptAsyncWithResponseAsync(\n+                        contentType, receipt, length, isIncludeFieldElements).map(response -> new OperationResult(\n+                            parseModelId(response.getDeserializedHeaders().getOperationLocation())))),\n+                    receipt, recognizeOptions.getContentType()),\n+                pollingOperation(service::getAnalyzeReceiptResultWithResponseAsync),\n                 (activationResponse, context) -> monoError(logger,\n                     new RuntimeException(\"Cancellation is not supported\")),\n-                fetchExtractReceiptResult(recognizeOptions.isIncludeFieldElements()));\n+                fetchingOperation(service::getAnalyzeReceiptResultWithResponseAsync)\n+                    .andThen(after -> after.map(modelSimpleResponse -> {\n+                        throwIfAnalyzeStatusInvalid(modelSimpleResponse.getValue());", "originalCommit": "a0ea7f8d7ae4a7959c76c00b2e4fdf31337e4dc4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTMyMTA0NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13025#discussion_r455321044", "bodyText": "throwing an exception will be removed. The issue related to the handling failed status is here: #12200", "author": "mssfang", "createdAt": "2020-07-15T20:26:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTI5MTc5NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTM0NTYzNw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13025#discussion_r455345637", "bodyText": "@mssfang Currently, treat it as the exception will be thrown. Can update this later when we actually onboard the LRO failure handling changes.", "author": "samvaity", "createdAt": "2020-07-15T21:06:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTI5MTc5NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTI5NDA1Mg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13025#discussion_r455294052", "bodyText": "What happens if the errorInformationList is null or empty? The status has failed but this method won't throw any exception which might result in the map operation above to continue with the transformation instead of throwing.", "author": "srnagar", "createdAt": "2020-07-15T19:35:06Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/FormRecognizerAsyncClient.java", "diffHunk": "@@ -734,4 +623,20 @@ private RecognizeOptions getRecognizeOptionsProperties(RecognizeOptions userProv\n             return new RecognizeOptions();\n         }\n     }\n+\n+    /**\n+     * Helper method that throws a {@link FormRecognizerException} if {@link AnalyzeOperationResult#getStatus()} is\n+     * {@link OperationStatus#FAILED}.\n+     *\n+     * @param analyzeResponse The response returned from the service.\n+     */\n+    private void throwIfAnalyzeStatusInvalid(AnalyzeOperationResult analyzeResponse) {\n+        if (OperationStatus.FAILED == analyzeResponse.getStatus()) {\n+            List<ErrorInformation> errorInformationList = analyzeResponse.getAnalyzeResult().getErrors();\n+            if (!CoreUtils.isNullOrEmpty(errorInformationList)) {", "originalCommit": "a0ea7f8d7ae4a7959c76c00b2e4fdf31337e4dc4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTMyMDE3NQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13025#discussion_r455320175", "bodyText": "Good point. We are trying to remove the method throwIfAnalyzeStatusInvalid() here and directly throw error when status is failed: https://github.com/Azure/azure-sdk-for-java/blob/master/sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/FormRecognizerAsyncClient.java#L720", "author": "mssfang", "createdAt": "2020-07-15T20:24:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTI5NDA1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTM0Nzk5Mg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13025#discussion_r455347992", "bodyText": "What happens if the errorInformationList is null or empty? The status has failed but this method won't throw any exception which might result in the map operation above to continue with the transformation instead of throwing.\n\n@srnagar\nI will cover this in - #12200 (comment).", "author": "samvaity", "createdAt": "2020-07-15T21:09:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTI5NDA1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI2OTEyMA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13025#discussion_r458269120", "bodyText": "Removed this in - https://github.com/Azure/azure-sdk-for-java/pull/13247/files#diff-f3e13c2bd95cecb8a90329a3c1e1f6dbL632", "author": "samvaity", "createdAt": "2020-07-21T17:30:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTI5NDA1Mg=="}], "type": "inlineReview"}, {"oid": "69ad97c84cd681a303112635174c6939264acf65", "url": "https://github.com/Azure/azure-sdk-for-java/commit/69ad97c84cd681a303112635174c6939264acf65", "message": "resultUid to resultUuid", "committedDate": "2020-07-16T05:40:46Z", "type": "commit"}, {"oid": "27f80c7c0a285c34bd5963acab516ad9846d70fd", "url": "https://github.com/Azure/azure-sdk-for-java/commit/27f80c7c0a285c34bd5963acab516ad9846d70fd", "message": "resolved conflict", "committedDate": "2020-07-29T05:26:24Z", "type": "commit"}, {"oid": "7690bb61384fb3ec27ef52cf08583b6355b99985", "url": "https://github.com/Azure/azure-sdk-for-java/commit/7690bb61384fb3ec27ef52cf08583b6355b99985", "message": "fixes checkstyle error", "committedDate": "2020-07-29T06:29:06Z", "type": "commit"}, {"oid": "de1edc42a90766bb4e73d0c2e1b2e81e528f2e56", "url": "https://github.com/Azure/azure-sdk-for-java/commit/de1edc42a90766bb4e73d0c2e1b2e81e528f2e56", "message": "Merge branch 'master' of https://github.com/Azure/azure-sdk-for-java into FR-PollerHelper", "committedDate": "2020-07-30T18:10:48Z", "type": "commit"}, {"oid": "d02d7569dc6ca0f050e183b4b7ace0605a917776", "url": "https://github.com/Azure/azure-sdk-for-java/commit/d02d7569dc6ca0f050e183b4b7ace0605a917776", "message": "fixed live-test failures", "committedDate": "2020-07-30T18:13:38Z", "type": "commit"}, {"oid": "8a9eb28e5ffaea7419057bdad94d094de59fc742", "url": "https://github.com/Azure/azure-sdk-for-java/commit/8a9eb28e5ffaea7419057bdad94d094de59fc742", "message": "remove unused import", "committedDate": "2020-07-30T18:33:27Z", "type": "commit"}]}