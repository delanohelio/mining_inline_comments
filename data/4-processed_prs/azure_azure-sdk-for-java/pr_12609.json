{"pr_number": 12609, "pr_title": "Migrate integration tests for spring-data-cosmosdb", "pr_createdAt": "2020-06-29T13:45:57Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/12609", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzA4ODQxOQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12609#discussion_r447088419", "bodyText": "This template is in wrong tests.yml\nWe cannot club azure-cosmos live tests and azure-spring-data-cosmosdb live tests.\nWe should create a separate tests.yml in sdk/cosmos/azure-spring-data-cosmosdb directory which will use its own test-resources.json file which you have created above.", "author": "kushagraThapar", "createdAt": "2020-06-29T16:11:33Z", "path": "sdk/cosmos/tests.yml", "diffHunk": "@@ -244,4 +244,23 @@ jobs:\n         goals: verify\n         options: '$(ProfileFlag) -Dgpg.skip $(AdditionalArgs) -pl $(ProjectList)'\n \n-      TestResultsFiles: '**/junitreports/TEST-*.xml'\n\\ No newline at end of file\n+      TestResultsFiles: '**/junitreports/TEST-*.xml'\n+\n+  - template: ../../eng/pipelines/templates/jobs/archetype-sdk-tests.yml", "originalCommit": "e292d3cd0b0a94ff9e1f2669269da44d58293fff", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzQxNTk0NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12609#discussion_r447415944", "bodyText": "Hi, I have added a new tests.yml in the directory sdk/cosmos/azure-spring-data-cosmosdb. By the way, what is the concern about why azure-cosmos and azure-spring-data-cosmosdb live tests cannot be put in one tests.yml? Will this mean that these two tests would always be triggered out together?", "author": "yiliuTo", "createdAt": "2020-06-30T05:20:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzA4ODQxOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzc3MTQxMA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12609#discussion_r447771410", "bodyText": "Yes, you are right, if we add them in the same file, then they will always run together, which we don't want.\nWe want separate CIs for both of these projects.", "author": "kushagraThapar", "createdAt": "2020-06-30T15:24:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzA4ODQxOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDUyMTk4Mg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12609#discussion_r450521982", "bodyText": "Why would we create a separate tests.yml file. Shouldn't the goal be to make sure these live tests run along with the Cosmos live tests? The whole point of our path structure is that things that are co-located is that they build and ship (roughly) together.", "author": "mitchdenny", "createdAt": "2020-07-06T23:00:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzA4ODQxOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDUzMzQ3NQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12609#discussion_r450533475", "bodyText": "Yea, this was older comment from me, please disregard this - we have just 1 tests.yml file now.", "author": "kushagraThapar", "createdAt": "2020-07-06T23:39:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzA4ODQxOQ=="}], "type": "inlineReview"}, {"oid": "82ed2d2c7d241bd913ab015f78aac655b627b564", "url": "https://github.com/Azure/azure-sdk-for-java/commit/82ed2d2c7d241bd913ab015f78aac655b627b564", "message": "modify javadoc warning of @ symbol for the pipeline", "committedDate": "2020-07-01T07:10:48Z", "type": "forcePushed"}, {"oid": "6d80a3eb9b6bfc03adc03bc4276fa187180bbcdd", "url": "https://github.com/Azure/azure-sdk-for-java/commit/6d80a3eb9b6bfc03adc03bc4276fa187180bbcdd", "message": "modify javadoc warning of @ symbol for the pipeline", "committedDate": "2020-07-01T08:39:40Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODM3MzEyNA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12609#discussion_r448373124", "bodyText": "Please do not change this file or check this change in. There's already a PR that was investigating this and it doesn't work and breaks other things.", "author": "JimSuplizio", "createdAt": "2020-07-01T13:44:20Z", "path": "eng/pipelines/scripts/generate_overview_from_readme.py", "diffHunk": "@@ -1,10 +1,10 @@\n # Copyright (c) Microsoft Corporation. All rights reserved.\n # Licensed under the MIT License.\n \n-# Use case: Given a README.md file, generate a readme_overview.html file and place it next \n+# Use case: Given a README.md file, generate a readme_overview.html file and place it next", "originalCommit": "6d80a3eb9b6bfc03adc03bc4276fa187180bbcdd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY5ODEzMw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12609#discussion_r448698133", "bodyText": "Ok, I will restore the file.", "author": "yiliuTo", "createdAt": "2020-07-02T01:27:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODM3MzEyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTI3ODMzMg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12609#discussion_r449278332", "bodyText": "nit: if the only thing in this file are removal of two trailing spaces then please remove this entirely.", "author": "JimSuplizio", "createdAt": "2020-07-02T21:40:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODM3MzEyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTUwMjk3Mg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12609#discussion_r449502972", "bodyText": "Sorry, I forgot when and how I removed these two trailing spaces thus neglacting the changes. I will revert them.", "author": "yiliuTo", "createdAt": "2020-07-03T10:12:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODM3MzEyNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQ0NTY4MA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12609#discussion_r448445680", "bodyText": "@yiliuTo - We don't need this extra entry in test-resources.json file. We can just re-use this file as it is.\nThe way it works is, for each matrix entry in tests.yml, it will create a new account using this test-resources.json, so you just need to add the new matrix entry for spring in tests.yml which I see you have already added.\nThough one thing which needs to be changed will be how we handle the output of this test-resources.json file in spring integration tests, but don't worry about it in this PR, I will take care of it once this PR goes in.", "author": "kushagraThapar", "createdAt": "2020-07-01T15:31:16Z", "path": "sdk/cosmos/test-resources.json", "diffHunk": "@@ -79,6 +81,19 @@\n         \"capabilities\": [],\n         \"ipRules\": []\n       }\n+    },", "originalCommit": "6d80a3eb9b6bfc03adc03bc4276fa187180bbcdd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "9d70558836434243210201b1d1ce4f92cf140a97", "url": "https://github.com/Azure/azure-sdk-for-java/commit/9d70558836434243210201b1d1ce4f92cf140a97", "message": "revert eng files and modify test-resources.json for IT", "committedDate": "2020-07-02T01:54:05Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDM0NDI2NQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12609#discussion_r450344265", "bodyText": "Minor change - developing version naming convention should be 0.1.2-beta.1 and not SNAPSHOT.", "author": "kushagraThapar", "createdAt": "2020-07-06T16:35:00Z", "path": "sdk/cosmos/azure-spring-data-cosmosdb/Contributing.md", "diffHunk": "@@ -0,0 +1,62 @@\n+# Contributing\n+This instruction is guideline for building and code contribution.\n+\n+## Prequisites\n+- JDK 1.8 and above\n+- [Maven](http://maven.apache.org/) 3.0 and above\n+\n+## Build from source\n+To build the project, run maven commands.\n+\n+```bash\n+git clone https://github.com/Azure/azure-sdk-for-java.git \n+cd sdk/cosmos/azure-spring-data-cosmosdb\n+mvnw clean install\n+```\n+\n+## Test\n+There're integration tests on azure and on emulator to trigger integration test execution against Azure Cosmos DB and against [Azure Cosmos DB Emulator](https://docs.microsoft.com/azure/cosmos-db/local-emulator), you need to follow the link to setup emulator before test execution.\n+\n+- Run unit tests\n+```bash\n+mvnw clean install\n+```\n+\n+- Run integration tests\n+   - on Azure \n+     >**NOTE** Please note that integration test against Azure requires Azure Cosmos DB Document API and will automatically create a Cosmos database in your Azure subscription, then there will be **Azure usage fee.**\n+ \n+     Integration tests will require a Azure Subscription. If you don't already have an Azure subscription, you can activate your [MSDN subscriber benefits](https://azure.microsoft.com/pricing/member-offers/msdn-benefits-details/) or sign up for a [free Azure account](https://azure.microsoft.com/free/). \n+  \n+     1. Create an Azure Cosmos DB on Azure.\n+        - Go to [Azure portal](https://portal.azure.com/) and click +New.\n+        - Click Databases, and then click Azure Cosmos DB to create your database. \n+        - Navigate to the database you have created, and click Access keys and copy your URI and access keys for your database.\n+  \n+     2. Set environment variables ACCOUNT_HOST, ACCOUNT_KEY and SECONDARY_ACCOUNT_KEY, where value of them are Cosmos account URI, primary key and secondary key.\n+     3. Run maven command with `integration-test-azure` profile. \n+  \n+        ```bash\n+        set ACCOUNT_HOST=your-cosmos-account-uri\n+        set ACCOUNT_KEY=your-cosmos-account-primary-key\n+        set SECONDARY_ACCOUNT_KEY=your-cosmos-account-secondary-key\n+        mvnw -P integration-test-azure clean install\n+        ```\n+   - on Emulator\n+   \n+     Setup Azure Cosmos DB Emulator by following [this instruction](https://docs.microsoft.com/azure/cosmos-db/local-emulator), and set associated environment variables. Then run test with:\n+     ```bash\n+     mvnw -P integration-test-emulator install\n+     ```\n+\n+\n+- Skip tests execution\n+```bash\n+mvnw clean install -DskipTests\n+```\n+\n+## Version management\n+Developing version naming convention is like `0.1.2-SNAPSHOT`. Release version naming convention is like `0.1.2`. ", "originalCommit": "8e9c0a46e14d6aa2402f1555b83f2c4a850570c7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDU2NDIzOA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12609#discussion_r450564238", "bodyText": "I ignored this, will modify it soon.", "author": "yiliuTo", "createdAt": "2020-07-07T01:37:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDM0NDI2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDUyMDQxOA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12609#discussion_r450520418", "bodyText": "Are there any security concerns here? Is this secret used anywhere else, can it be randomly generated?", "author": "mitchdenny", "createdAt": "2020-07-06T22:55:56Z", "path": "eng/pipelines/templates/stages/cosmos-sdk-client.yml", "diffHunk": "@@ -94,17 +94,25 @@ stages:\n             DisplayName: 'Emulator only Integration Tests'\n             PROTOCOLS: '[\"Tcp\"]'\n             DESIRED_CONSISTENCIES: '[\"Strong\", \"Session\"]'\n+            AdditionalArgs: '-DargLine=\"-DACCOUNT_HOST=https://localhost:8081/\"'\n           Https_Integration_Tests_Java8:\n             OSVmImage: 'windows-2019'\n             JavaTestVersion: '1.8'\n             ProfileFlag: '-Pemulator'\n             DisplayName: 'Emulator only Integration Tests'\n             PROTOCOLS: '[\"Https\"]'\n             DESIRED_CONSISTENCIES: '[\"Strong\", \"Session\"]'\n+            AdditionalArgs: '-DargLine=\"-DACCOUNT_HOST=https://localhost:8081/\"'\n+          Spring_Integration_Tests_Java8:\n+            OSVmImage: 'windows-2019'\n+            JavaTestVersion: '1.8'\n+            ProfileFlag: '-P integration-test-emulator'\n+            DisplayName: 'Spring Emulator only Integration Tests'\n+            AdditionalArgs: '-DargLine=\"-DACCOUNT_HOST=https://localhost:8081/ -DACCOUNT_KEY=C2y6yDjf5/R+ob0N8A7Cgv30VRDJIWEHLM+4QDU5DE2nQ9nDuVTqobD4b8mGGyPMbIZnqyMsEcaGQy67XIw/Jw== -DSECONDARY_ACCOUNT_KEY=C2y6yDjf5/R+ob0N8A7Cgv30VRDJIWEHLM+4QDU5DE2nQ9nDuVTqobD4b8mGGyPMbIZnqyMsEcaGQy67XIw/Jw==\"'", "originalCommit": "8e9c0a46e14d6aa2402f1555b83f2c4a850570c7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDUyNDE1Ng==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12609#discussion_r450524156", "bodyText": "No security concerns : this key is documented in public Microsoft docs : https://docs.microsoft.com/en-us/azure/cosmos-db/local-emulator#authenticating-requests\nAlso in azure-cosmos source code: https://github.com/Azure/azure-sdk-for-java/blob/master/sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/implementation/TestConfigurations.java#L42", "author": "kushagraThapar", "createdAt": "2020-07-06T23:08:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDUyMDQxOA=="}], "type": "inlineReview"}, {"oid": "359fc04bccb5e79ee0375fb40f947fc79a6145fa", "url": "https://github.com/Azure/azure-sdk-for-java/commit/359fc04bccb5e79ee0375fb40f947fc79a6145fa", "message": "add spring cosmosdb IT to sdk\\cosmos tests.yml", "committedDate": "2020-07-07T02:29:11Z", "type": "commit"}, {"oid": "6b59bf42c141ad32d28c5281624009481eb25981", "url": "https://github.com/Azure/azure-sdk-for-java/commit/6b59bf42c141ad32d28c5281624009481eb25981", "message": "add test-resources.json for IT", "committedDate": "2020-07-07T02:29:12Z", "type": "commit"}, {"oid": "58d12f4b61d69039914910d4b04b3373bd30cd7b", "url": "https://github.com/Azure/azure-sdk-for-java/commit/58d12f4b61d69039914910d4b04b3373bd30cd7b", "message": "add default constructor for IT", "committedDate": "2020-07-07T02:29:12Z", "type": "commit"}, {"oid": "114adfb7fcb7b7c629ccbf5cdbc56f6eb730a72a", "url": "https://github.com/Azure/azure-sdk-for-java/commit/114adfb7fcb7b7c629ccbf5cdbc56f6eb730a72a", "message": "modify javadoc and code owners", "committedDate": "2020-07-07T02:29:13Z", "type": "commit"}, {"oid": "19e92422bc2f3c71fa13e462077c4f305d75f9b5", "url": "https://github.com/Azure/azure-sdk-for-java/commit/19e92422bc2f3c71fa13e462077c4f305d75f9b5", "message": "add tests.yml in azure-spring-data-cosmosdb", "committedDate": "2020-07-07T02:29:14Z", "type": "commit"}, {"oid": "fd2f97c4bfefd9fa2c3845a13d025208edd02567", "url": "https://github.com/Azure/azure-sdk-for-java/commit/fd2f97c4bfefd9fa2c3845a13d025208edd02567", "message": "modify readme.md for outdated link", "committedDate": "2020-07-07T02:29:14Z", "type": "commit"}, {"oid": "2190b09931d6d8026f7b5150732c884e480dac6e", "url": "https://github.com/Azure/azure-sdk-for-java/commit/2190b09931d6d8026f7b5150732c884e480dac6e", "message": "place integration test files in sdk/cosmos and rename directory path", "committedDate": "2020-07-07T02:29:16Z", "type": "commit"}, {"oid": "2512f38a3f57abe7990efe3343c916f43e303b96", "url": "https://github.com/Azure/azure-sdk-for-java/commit/2512f38a3f57abe7990efe3343c916f43e303b96", "message": "modify javadoc warning of @ symbol for the pipeline", "committedDate": "2020-07-07T02:29:18Z", "type": "commit"}, {"oid": "b4a7f460359128408962b52976c06c254e746d7a", "url": "https://github.com/Azure/azure-sdk-for-java/commit/b4a7f460359128408962b52976c06c254e746d7a", "message": "revert eng files and modify test-resources.json for IT", "committedDate": "2020-07-07T02:29:19Z", "type": "commit"}, {"oid": "c3393f5cc115d4f299921b2ea9bced28902b22ff", "url": "https://github.com/Azure/azure-sdk-for-java/commit/c3393f5cc115d4f299921b2ea9bced28902b22ff", "message": "Added spring integration matrix tests for Session and Strong consistency", "committedDate": "2020-07-07T02:29:20Z", "type": "commit"}, {"oid": "bb430f228d149935d4fe8c35d8be540674c2b846", "url": "https://github.com/Azure/azure-sdk-for-java/commit/bb430f228d149935d4fe8c35d8be540674c2b846", "message": "Enabled unit tests and integration tests for azure and emulator", "committedDate": "2020-07-07T02:29:22Z", "type": "commit"}, {"oid": "e6874032500a83fe06fdec2645e2cc1b71ba3f8f", "url": "https://github.com/Azure/azure-sdk-for-java/commit/e6874032500a83fe06fdec2645e2cc1b71ba3f8f", "message": "Added account host and key to emulator tests", "committedDate": "2020-07-07T02:29:22Z", "type": "commit"}, {"oid": "8a4b0fb51103ee7218606e29d35a396961822bee", "url": "https://github.com/Azure/azure-sdk-for-java/commit/8a4b0fb51103ee7218606e29d35a396961822bee", "message": "Reverted experimental changes. Exculded PageablePersonRepositoryIT from emulator tests", "committedDate": "2020-07-07T02:29:23Z", "type": "commit"}, {"oid": "da7e7bb329a1cf65ca917989513b82b9b51bd847", "url": "https://github.com/Azure/azure-sdk-for-java/commit/da7e7bb329a1cf65ca917989513b82b9b51bd847", "message": "restore file generate_overview_from_readme.py", "committedDate": "2020-07-07T02:29:24Z", "type": "commit"}, {"oid": "b4c694fd6bec8a4c30ff43b173d37ea57e5aab38", "url": "https://github.com/Azure/azure-sdk-for-java/commit/b4c694fd6bec8a4c30ff43b173d37ea57e5aab38", "message": "clear reademe.md temparorily for pipeline", "committedDate": "2020-07-07T02:29:24Z", "type": "commit"}, {"oid": "40a3e2ad0c75b158c7f36cefa712372f7f2dcdba", "url": "https://github.com/Azure/azure-sdk-for-java/commit/40a3e2ad0c75b158c7f36cefa712372f7f2dcdba", "message": "add Contributing.md", "committedDate": "2020-07-07T02:29:25Z", "type": "commit"}, {"oid": "a952b45fe9d50bd332493a415ca905fe0bbcee3b", "url": "https://github.com/Azure/azure-sdk-for-java/commit/a952b45fe9d50bd332493a415ca905fe0bbcee3b", "message": "modify version declaration in contributing.md", "committedDate": "2020-07-07T02:29:26Z", "type": "commit"}, {"oid": "a952b45fe9d50bd332493a415ca905fe0bbcee3b", "url": "https://github.com/Azure/azure-sdk-for-java/commit/a952b45fe9d50bd332493a415ca905fe0bbcee3b", "message": "modify version declaration in contributing.md", "committedDate": "2020-07-07T02:29:26Z", "type": "forcePushed"}]}