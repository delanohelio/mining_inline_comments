{"pr_number": 15477, "pr_title": "fix msi validate function", "pr_createdAt": "2020-09-22T07:40:16Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/15477", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjU0MTAwNw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15477#discussion_r492541007", "bodyText": "Can we delete  && Strings.isNullOrEmpty(subscriptionId)?", "author": "chenrujun", "createdAt": "2020-09-22T07:57:28Z", "path": "sdk/spring/azure-spring-cloud-context/src/main/java/com/microsoft/azure/spring/cloud/context/core/config/AzureProperties.java", "diffHunk": "@@ -41,7 +41,7 @@ private void validate() {\n         }\n \n         if (msiEnabled && Strings.isNullOrEmpty(subscriptionId)) {\n-            Assert.hasText(this.region, \"When msi is enabled, spring.cloud.azure.subscription-id must be provided\");\n+            Assert.hasText(this.subscriptionId, \"When msi is enabled, spring.cloud.azure.subscription-id must be provided\");", "originalCommit": "8c0e83fbd50075f57b35e2fda175c795ae648bbb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzIzNjQ2Mw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15477#discussion_r493236463", "bodyText": "Can we delete  && Strings.isNullOrEmpty(subscriptionId)?\n\nI think it's necessary, we will assert it when the subscriptionId is empty", "author": "zhoufenqin", "createdAt": "2020-09-23T06:49:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjU0MTAwNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzI4MTg1OQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15477#discussion_r493281859", "bodyText": "Here is the source code of Assert.hasText(...):\n\tpublic static void hasText(@Nullable String text, String message) {\n\t\tif (!StringUtils.hasText(text)) {\n\t\t\tthrow new IllegalArgumentException(message);\n\t\t}\n\t}\n\nIt will check by StringUtils.hasText(text).\nMaybe we do not need check it again by Strings.isNullOrEmpty(subscriptionId)?", "author": "chenrujun", "createdAt": "2020-09-23T08:02:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjU0MTAwNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzI3Mzg5MA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15477#discussion_r493273890", "bodyText": "We should remove the locale in this URL.", "author": "saragluna", "createdAt": "2020-09-23T07:54:18Z", "path": "sdk/spring/azure-spring-boot-samples/azure-spring-cloud-eventhubs-binder-sample/README.adoc", "diffHunk": "@@ -141,15 +141,11 @@ If you choose system-assigned identity, follow https://docs.microsoft.com/en-us/\n If you choose user-assigned identity, follow https://docs.microsoft.com/en-us/azure/app-service/overview-managed-identity#adding-a-user-assigned-identity[\n  Adding a user assigned identity].\n \n-==== Role Assignment\n+==== Add Role Assignment for Resource Group\n \n-Add role assignment to Event hub, Storage Account and Resource Group.\n+- Resource Group: assign `Reader` role for managed identity.\n \n-- Event Hub: `Contributor` role.\n-- Storage Account: `Storage Account Key Operator Service Role` role.\n-- Resource Group: `Reader` role.\n-\n-See https://docs.microsoft.com/en-us/azure/event-hubs/event-hubs-managed-service-identity[Managed identities for Azure resources with Event Hubs] to add role assignment for Event Hub, Storage Account and Resource Group are similar.\n+See https://docs.microsoft.com/en-us/azure/role-based-access-control/role-assignments-portal[Add or remove Azure role assignments] to add the role assignment for Resource Group.", "originalCommit": "85e6ca8fdf1bfc7b8547896b1db5b4a7597dc816", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzI3NzAxNA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15477#discussion_r493277014", "bodyText": "Same here.", "author": "saragluna", "createdAt": "2020-09-23T07:57:22Z", "path": "sdk/spring/azure-spring-boot-samples/azure-spring-cloud-eventhubs-binder-sample/README.adoc", "diffHunk": "@@ -186,6 +183,18 @@ spring.cloud.stream.bindings.output.destination=[eventhub-name]\n spring.cloud.stream.eventhub.bindings.input.consumer.checkpoint-mode=MANUAL\n ....\n \n+==== Add Role Assignment for Event Hub and Storage Account\n+\n+- Event Hub: assign `Contributor` role for managed identity.\n+- Storage Account: assign `Storage Account Key Operator Service Role` role for managed identity.\n+\n+See https://docs.microsoft.com/en-us/azure/event-hubs/event-hubs-managed-service-identity[Managed identities for Azure resources with Event Hubs] to add role assignment for Event Hub, Storage Account is similar.", "originalCommit": "85e6ca8fdf1bfc7b8547896b1db5b4a7597dc816", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "6089199f8d832ebf87b714db3d30669a957d78ac", "url": "https://github.com/Azure/azure-sdk-for-java/commit/6089199f8d832ebf87b714db3d30669a957d78ac", "message": "update azure context auto configuration", "committedDate": "2020-09-23T08:08:38Z", "type": "forcePushed"}, {"oid": "1edad7505bfb6a4d9720b5d8bc137bfc821b04ba", "url": "https://github.com/Azure/azure-sdk-for-java/commit/1edad7505bfb6a4d9720b5d8bc137bfc821b04ba", "message": "fix msi validate function", "committedDate": "2020-09-23T14:22:10Z", "type": "commit"}, {"oid": "779a973ba21275e9c036e2d2026874332151c9b1", "url": "https://github.com/Azure/azure-sdk-for-java/commit/779a973ba21275e9c036e2d2026874332151c9b1", "message": "update azure context auto configuration", "committedDate": "2020-09-23T14:46:20Z", "type": "commit"}, {"oid": "779a973ba21275e9c036e2d2026874332151c9b1", "url": "https://github.com/Azure/azure-sdk-for-java/commit/779a973ba21275e9c036e2d2026874332151c9b1", "message": "update azure context auto configuration", "committedDate": "2020-09-23T14:46:20Z", "type": "forcePushed"}]}