{"pr_number": 16108, "pr_title": "mgmt, support enable/disable secret", "pr_createdAt": "2020-10-09T07:51:40Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/16108", "timeline": [{"oid": "74e0c65b184c5fde283e20a6692e216d65033231", "url": "https://github.com/Azure/azure-sdk-for-java/commit/74e0c65b184c5fde283e20a6692e216d65033231", "message": "support enable/disable secret", "committedDate": "2020-10-09T07:50:40Z", "type": "commit"}, {"oid": "e0e5b543bc5df58a5e5ce5c5dc390a5ad37ee462", "url": "https://github.com/Azure/azure-sdk-for-java/commit/e0e5b543bc5df58a5e5ce5c5dc390a5ad37ee462", "message": "revert pom", "committedDate": "2020-10-09T07:52:41Z", "type": "commit"}, {"oid": "d1c0f4e6b6eb99e2227e15f15d826d729cb9f170", "url": "https://github.com/Azure/azure-sdk-for-java/commit/d1c0f4e6b6eb99e2227e15f15d826d729cb9f170", "message": "nit", "committedDate": "2020-10-09T07:52:51Z", "type": "commit"}, {"oid": "5e0915a68f8dd6fdd8b975ddeb6685bf3fc44e13", "url": "https://github.com/Azure/azure-sdk-for-java/commit/5e0915a68f8dd6fdd8b975ddeb6685bf3fc44e13", "message": "fix for getById on KeysImpl", "committedDate": "2020-10-09T08:01:42Z", "type": "commit"}, {"oid": "85a772b8163a4cce53689c2e03754535349c331b", "url": "https://github.com/Azure/azure-sdk-for-java/commit/85a772b8163a4cce53689c2e03754535349c331b", "message": "use PagedFlux", "committedDate": "2020-10-09T09:19:10Z", "type": "commit"}, {"oid": "40056f1f13ee1ea08c4383216694cfce50a91d4e", "url": "https://github.com/Azure/azure-sdk-for-java/commit/40056f1f13ee1ea08c4383216694cfce50a91d4e", "message": "fix spotbugs", "committedDate": "2020-10-09T09:19:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzExNzc0MA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16108#discussion_r503117740", "bodyText": "Is it better use something like makeSecretEnabledOrDisabled? Not just named with enable", "author": "ChenTanyi", "createdAt": "2020-10-12T08:18:18Z", "path": "sdk/resourcemanager/azure-resourcemanager-keyvault/src/main/java/com/azure/resourcemanager/keyvault/implementation/SecretsImpl.java", "diffHunk": "@@ -110,7 +123,51 @@ public Secret getByNameAndVersion(String name, String version) {\n \n     @Override\n     public Mono<Secret> getByNameAndVersionAsync(final String name, final String version) {\n-        return inner.getSecret(name, version).map(this::wrapModel);\n+        Objects.requireNonNull(name);\n+        return (version == null ? inner.getSecret(name) : inner.getSecret(name, version)).map(this::wrapModel);\n+    }\n+\n+    @Override\n+    public Secret enableByNameAndVersion(String name, String version) {\n+        return enableByNameAndVersionAsync(name, version).block();\n+    }\n+\n+    @Override\n+    public Mono<Secret> enableByNameAndVersionAsync(String name, String version) {\n+        Objects.requireNonNull(name);\n+        return enableByNameAndVersionAsync(name, version, true);\n+    }\n+\n+    @Override\n+    public void disableByNameAndVersion(String name, String version) {\n+        disableByNameAndVersionAsync(name, version).block();\n+    }\n+\n+    @Override\n+    public Mono<Void> disableByNameAndVersionAsync(String name, String version) {\n+        Objects.requireNonNull(name);\n+        return enableByNameAndVersionAsync(name, version, false).then();\n+    }\n+\n+    private Mono<Secret> enableByNameAndVersionAsync(String name, String version, boolean enabled) {", "originalCommit": "40056f1f13ee1ea08c4383216694cfce50a91d4e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzE1Nzk5OQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16108#discussion_r503157999", "bodyText": "It is private method so I am a bit relax on the naming. I will try to figure out a better name.", "author": "weidongxu-microsoft", "createdAt": "2020-10-12T09:21:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzExNzc0MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzY1NDI4OQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16108#discussion_r503654289", "bodyText": "Changed to updateSecretEnableDisableAsync", "author": "weidongxu-microsoft", "createdAt": "2020-10-13T04:03:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzExNzc0MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzExODE1Mg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16108#discussion_r503118152", "bodyText": "Is it any other way rather than using such a mock ID?", "author": "ChenTanyi", "createdAt": "2020-10-12T08:18:59Z", "path": "sdk/resourcemanager/azure-resourcemanager-keyvault/src/main/java/com/azure/resourcemanager/keyvault/implementation/SecretsImpl.java", "diffHunk": "@@ -110,7 +123,51 @@ public Secret getByNameAndVersion(String name, String version) {\n \n     @Override\n     public Mono<Secret> getByNameAndVersionAsync(final String name, final String version) {\n-        return inner.getSecret(name, version).map(this::wrapModel);\n+        Objects.requireNonNull(name);\n+        return (version == null ? inner.getSecret(name) : inner.getSecret(name, version)).map(this::wrapModel);\n+    }\n+\n+    @Override\n+    public Secret enableByNameAndVersion(String name, String version) {\n+        return enableByNameAndVersionAsync(name, version).block();\n+    }\n+\n+    @Override\n+    public Mono<Secret> enableByNameAndVersionAsync(String name, String version) {\n+        Objects.requireNonNull(name);\n+        return enableByNameAndVersionAsync(name, version, true);\n+    }\n+\n+    @Override\n+    public void disableByNameAndVersion(String name, String version) {\n+        disableByNameAndVersionAsync(name, version).block();\n+    }\n+\n+    @Override\n+    public Mono<Void> disableByNameAndVersionAsync(String name, String version) {\n+        Objects.requireNonNull(name);\n+        return enableByNameAndVersionAsync(name, version, false).then();\n+    }\n+\n+    private Mono<Secret> enableByNameAndVersionAsync(String name, String version, boolean enabled) {\n+        try {\n+            String mockId = \"https://foo.vault.azure.net/secrets/\" + name;", "originalCommit": "40056f1f13ee1ea08c4383216694cfce50a91d4e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzE1NTAyOQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16108#discussion_r503155029", "bodyText": "The problem is that SecretProperties does not have constructor that can take the version. So the only way I can create a SecretProperties with version is to use serialization (https://github.com/Azure/azure-sdk-for-java/blob/master/sdk/keyvault/azure-security-keyvault-secrets/src/main/java/com/azure/security/keyvault/secrets/models/SecretProperties.java#L330-L344).", "author": "weidongxu-microsoft", "createdAt": "2020-10-12T09:16:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzExODE1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzE1NTU0MQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16108#discussion_r503155541", "bodyText": "Alternative would to do a list, then choose the correct SecretProperties.\nWe cannot do get, since a disabled secret would fail in get.", "author": "weidongxu-microsoft", "createdAt": "2020-10-12T09:17:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzExODE1Mg=="}], "type": "inlineReview"}, {"oid": "422509b3a1a1391bf2492ea1797d67ab543b0b82", "url": "https://github.com/Azure/azure-sdk-for-java/commit/422509b3a1a1391bf2492ea1797d67ab543b0b82", "message": "Merge branch 'master' into mgmt_keyvault-secret-disable", "committedDate": "2020-10-13T02:42:24Z", "type": "commit"}, {"oid": "c57e6aa85f029c439fb684780aac438031bbacef", "url": "https://github.com/Azure/azure-sdk-for-java/commit/c57e6aa85f029c439fb684780aac438031bbacef", "message": "add exclude netty in pom", "committedDate": "2020-10-13T02:43:04Z", "type": "commit"}, {"oid": "ecfe7c2e7e448965652e978d170a7c33c32fe35e", "url": "https://github.com/Azure/azure-sdk-for-java/commit/ecfe7c2e7e448965652e978d170a7c33c32fe35e", "message": "rename to updateSecretEnableDisableAsync", "committedDate": "2020-10-13T04:03:01Z", "type": "commit"}]}