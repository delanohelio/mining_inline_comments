{"pr_number": 13784, "pr_title": "map version field to _etag", "pr_createdAt": "2020-08-04T21:07:53Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/13784", "timeline": [{"oid": "3f9fb31dc7bf9c08b372c2bb04e26383b5fb7a66", "url": "https://github.com/Azure/azure-sdk-for-java/commit/3f9fb31dc7bf9c08b372c2bb04e26383b5fb7a66", "message": "map version field to _etag and back to prevent a redundant field from being added to the document", "committedDate": "2020-08-04T21:06:45Z", "type": "commit"}, {"oid": "684815ecbd5f0be08c36e32adfa2ddda428f258d", "url": "https://github.com/Azure/azure-sdk-for-java/commit/684815ecbd5f0be08c36e32adfa2ddda428f258d", "message": "move logic to helper method for parity", "committedDate": "2020-08-04T21:12:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTMzNjc1NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13784#discussion_r465336754", "bodyText": "its was unclear to me why writeJsonNode was being called with a ObjectNode instance instead of just passing the objectNode straight to the read method.\nThis started failing because writeJsonNode is now using CosmosEntityInformation to check if the entity passed is versioned. When an ObjectNode object is passed to writeJsonNode, CosmosEntityInformation fails to initailize properly because the type of object node is not an entity with proper annotations or fields that match expectations. Specifically, CosmosEntityInformation expects the class to have a field named id or a field annotated with @id. ObjectNode obviously has neither of these.\nUnless i am missing something about the purpose of calling writeJsonNode here, i dont think it will ever be used in this manner and the input object should be a proper entity that can be use with CosmosEntityInformation.", "author": "Blackbaud-EricSlater", "createdAt": "2020-08-04T21:19:46Z", "path": "sdk/cosmos/azure-spring-data-cosmos/src/test/java/com/azure/spring/data/cosmos/core/converter/MappingCosmosConverterUnitTest.java", "diffHunk": "@@ -64,9 +67,7 @@ public void convertDocumentToAddressCorrectly() {\n         objectNode.put(TestConstants.PROPERTY_STREET, TestConstants.STREET);\n         objectNode.put(TestConstants.PROPERTY_ID, TestConstants.POSTAL_CODE);\n ", "originalCommit": "684815ecbd5f0be08c36e32adfa2ddda428f258d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTM1Njk0NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13784#discussion_r465356944", "bodyText": "@Blackbaud-EricSlater - Yups makes sense not to call writeJsonNode here.", "author": "kushagraThapar", "createdAt": "2020-08-04T22:06:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTMzNjc1NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTMzNzQ5Mw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13784#discussion_r465337493", "bodyText": "same issue as described above.\nAlso, the assertions in this test just seemed wrong and it was comparing jsonNode contents instead of the fields on the memo object", "author": "Blackbaud-EricSlater", "createdAt": "2020-08-04T21:21:21Z", "path": "sdk/cosmos/azure-spring-data-cosmos/src/test/java/com/azure/spring/data/cosmos/core/converter/MappingCosmosConverterUnitTest.java", "diffHunk": "@@ -93,12 +94,10 @@ public void canReadPojoWithDateFromDocument() throws ParseException {\n         jsonObject.put(TestConstants.PROPERTY_DATE, date);\n         jsonObject.put(TestConstants.PROPERTY_ID, TestConstants.ID_1);\n \n-        final JsonNode jsonNode = mappingCosmosConverter.writeJsonNode(jsonObject);", "originalCommit": "684815ecbd5f0be08c36e32adfa2ddda428f258d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTM1NzA5Nw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13784#discussion_r465357097", "bodyText": "Thanks for fixing this.", "author": "kushagraThapar", "createdAt": "2020-08-04T22:06:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTMzNzQ5Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTMzOTU2Mg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13784#discussion_r465339562", "bodyText": "this constant is defined in a number of places - what about just making the one on CosmosEntityInformation public?", "author": "Blackbaud-MikeLueders", "createdAt": "2020-08-04T21:25:53Z", "path": "sdk/cosmos/azure-spring-data-cosmos/src/main/java/com/azure/spring/data/cosmos/core/CosmosTemplate.java", "diffHunk": "@@ -57,6 +57,7 @@\n public class CosmosTemplate implements CosmosOperations, ApplicationContextAware {\n \n     private static final Logger LOGGER = LoggerFactory.getLogger(CosmosTemplate.class);\n+    private static final String ETAG_KEY = \"_etag\";", "originalCommit": "684815ecbd5f0be08c36e32adfa2ddda428f258d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTM0NDY3MA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13784#discussion_r465344670", "bodyText": "fixed. moved to Constants class and used it in all the relevant places", "author": "Blackbaud-EricSlater", "createdAt": "2020-08-04T21:37:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTMzOTU2Mg=="}], "type": "inlineReview"}, {"oid": "5972b650ecf222c7b928332eb847b265a390be8e", "url": "https://github.com/Azure/azure-sdk-for-java/commit/5972b650ecf222c7b928332eb847b265a390be8e", "message": "make constant for default etag property name and use it in all the places", "committedDate": "2020-08-04T21:31:51Z", "type": "commit"}, {"oid": "b631e26293d273a4caf2748e6b4fea9f8943b1d5", "url": "https://github.com/Azure/azure-sdk-for-java/commit/b631e26293d273a4caf2748e6b4fea9f8943b1d5", "message": "missed a usage of constant. fix checkstyle issue", "committedDate": "2020-08-04T21:36:51Z", "type": "commit"}]}