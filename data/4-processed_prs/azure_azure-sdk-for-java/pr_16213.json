{"pr_number": 16213, "pr_title": "Live test pipeline setup", "pr_createdAt": "2020-10-13T03:05:35Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/16213", "timeline": [{"oid": "ac41a80979b48aa3acb940079c5e560569369795", "url": "https://github.com/Azure/azure-sdk-for-java/commit/ac41a80979b48aa3acb940079c5e560569369795", "message": "remove test resources file", "committedDate": "2020-10-13T16:45:51Z", "type": "forcePushed"}, {"oid": "ed9042636dcc63ee62a2237273057185e5869440", "url": "https://github.com/Azure/azure-sdk-for-java/commit/ed9042636dcc63ee62a2237273057185e5869440", "message": "update datafeed tests", "committedDate": "2020-10-28T08:17:51Z", "type": "forcePushed"}, {"oid": "16c2b43d909d439e7ce56e23e6c2ce0092673308", "url": "https://github.com/Azure/azure-sdk-for-java/commit/16c2b43d909d439e7ce56e23e6c2ce0092673308", "message": "update redactor, re-record tests", "committedDate": "2020-10-29T01:08:44Z", "type": "forcePushed"}, {"oid": "f688f4860777527fb8d311c9b599c9e006afda38", "url": "https://github.com/Azure/azure-sdk-for-java/commit/f688f4860777527fb8d311c9b599c9e006afda38", "message": "update redactor, re-record tests", "committedDate": "2020-10-29T01:31:49Z", "type": "forcePushed"}, {"oid": "c880bfb6af931205c8bf375aab35680565f2bc33", "url": "https://github.com/Azure/azure-sdk-for-java/commit/c880bfb6af931205c8bf375aab35680565f2bc33", "message": "update redactor, re-record tests", "committedDate": "2020-10-29T22:26:12Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDY0NTMyNQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16213#discussion_r514645325", "bodyText": "remove", "author": "samvaity", "createdAt": "2020-10-30T00:43:30Z", "path": "sdk/metricsadvisor/azure-ai-metricsadvisor/src/test/java/com/azure/ai/metricsadvisor/HookTestBase.java", "diffHunk": "@@ -97,6 +97,7 @@ protected void assertCreateWebHookOutput(Hook hook) {\n //        }\n     }\n \n+    // Track this with https://github.com/Azure/azure-sdk-for-java/issues/16932", "originalCommit": "1d1623e7d1ff2b64ecdaef9424c516a446db7d33", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDY0NTQ0MQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16213#discussion_r514645441", "bodyText": "reported as service issue #_53", "author": "samvaity", "createdAt": "2020-10-30T00:44:00Z", "path": "sdk/metricsadvisor/azure-ai-metricsadvisor/src/test/java/com/azure/ai/metricsadvisor/IncidentForAlertTestBase.java", "diffHunk": "@@ -19,22 +19,22 @@\n         static final ListIncidentsForAlertInput INSTANCE = new ListIncidentsForAlertInput();\n         final ListIncidentsAlertedOptions options = new ListIncidentsAlertedOptions()\n             .setTop(10);\n-        final String alertConfigurationId = \"ff3014a0-bbbb-41ec-a637-677e77b81299\";\n-        final String alertId = \"1746b031c00\";\n+        final String alertConfigurationId = ALERT_CONFIG_ID;\n+        final String alertId = \"175434e3400\";\n     }\n \n     protected static class ListIncidentsForAlertOutput {\n         static final ListIncidentsForAlertOutput INSTANCE = new ListIncidentsForAlertOutput();\n-        final int expectedIncidents = 3;\n+        final int expectedIncidents = 2;\n     }\n \n     protected void assertListIncidentsForAlertOutput(Incident incident) {\n         Assertions.assertNotNull(incident);\n         Assertions.assertNotNull(incident.getId());\n         Assertions.assertNotNull(incident.getMetricId());\n-        Assertions.assertNotNull(incident.getSeverity());\n+        // currently, returned as null?\n+        // Assertions.assertNotNull(incident.getSeverity());", "originalCommit": "1d1623e7d1ff2b64ecdaef9424c516a446db7d33", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "40556944687ec87b959ad45e1b28c9b8f98e9f55", "url": "https://github.com/Azure/azure-sdk-for-java/commit/40556944687ec87b959ad45e1b28c9b8f98e9f55", "message": "use shared test secrets", "committedDate": "2020-10-30T18:39:01Z", "type": "commit"}, {"oid": "8ea79d4f52eb58cc5961ead08469d7dcddd8f0f7", "url": "https://github.com/Azure/azure-sdk-for-java/commit/8ea79d4f52eb58cc5961ead08469d7dcddd8f0f7", "message": "remove test resources file", "committedDate": "2020-10-30T18:39:03Z", "type": "commit"}, {"oid": "33be1a20c6fe9a457c0d871b8dc0b8f81eec4d46", "url": "https://github.com/Azure/azure-sdk-for-java/commit/33be1a20c6fe9a457c0d871b8dc0b8f81eec4d46", "message": "new resource Id/recordings update", "committedDate": "2020-10-30T18:39:07Z", "type": "commit"}, {"oid": "4310e7f54bad2b2077db4256497ada3a269dc219", "url": "https://github.com/Azure/azure-sdk-for-java/commit/4310e7f54bad2b2077db4256497ada3a269dc219", "message": "update recordings for dimensions new data feed", "committedDate": "2020-10-30T18:39:13Z", "type": "commit"}, {"oid": "e013410b5f41cf255db482e562934b53c775e85a", "url": "https://github.com/Azure/azure-sdk-for-java/commit/e013410b5f41cf255db482e562934b53c775e85a", "message": "update feedback recording", "committedDate": "2020-10-30T18:39:17Z", "type": "commit"}, {"oid": "56c937243a74c0b571fb3de5af67285c296742df", "url": "https://github.com/Azure/azure-sdk-for-java/commit/56c937243a74c0b571fb3de5af67285c296742df", "message": "update datafeed tests", "committedDate": "2020-10-30T18:39:21Z", "type": "commit"}, {"oid": "eebaf61d278e7c7a902a2783ed6a8dd9c4b7ef70", "url": "https://github.com/Azure/azure-sdk-for-java/commit/eebaf61d278e7c7a902a2783ed6a8dd9c4b7ef70", "message": "update redactor, re-record tests", "committedDate": "2020-10-30T18:49:19Z", "type": "commit"}, {"oid": "10e2e05623945d2e724e5ac95cff863852e9ae43", "url": "https://github.com/Azure/azure-sdk-for-java/commit/10e2e05623945d2e724e5ac95cff863852e9ae43", "message": "update spotbugs and alert config id", "committedDate": "2020-10-30T18:56:06Z", "type": "forcePushed"}, {"oid": "11e08de2afe43b3267c98b1baf6fee451ab23cff", "url": "https://github.com/Azure/azure-sdk-for-java/commit/11e08de2afe43b3267c98b1baf6fee451ab23cff", "message": "update spotbugs and alert config id", "committedDate": "2020-10-30T21:00:16Z", "type": "forcePushed"}, {"oid": "7f88c4515988fd62fd4183802afae47dec428e76", "url": "https://github.com/Azure/azure-sdk-for-java/commit/7f88c4515988fd62fd4183802afae47dec428e76", "message": "update spotbugs and alert config id", "committedDate": "2020-10-30T21:12:25Z", "type": "forcePushed"}, {"oid": "70a6f2bfe3831ee22dfec3af1da72b11095778a6", "url": "https://github.com/Azure/azure-sdk-for-java/commit/70a6f2bfe3831ee22dfec3af1da72b11095778a6", "message": "update spotbugs and alert config id", "committedDate": "2020-11-01T09:22:20Z", "type": "forcePushed"}, {"oid": "799cb08f4c8886d6d06b078ef3fcc196ed8c6bc8", "url": "https://github.com/Azure/azure-sdk-for-java/commit/799cb08f4c8886d6d06b078ef3fcc196ed8c6bc8", "message": "update spotbugs and alert config id", "committedDate": "2020-11-01T21:17:44Z", "type": "forcePushed"}, {"oid": "1f4323cd5cffcde9ee5d766778331aac914ecef3", "url": "https://github.com/Azure/azure-sdk-for-java/commit/1f4323cd5cffcde9ee5d766778331aac914ecef3", "message": "update spotbugs and alert config id", "committedDate": "2020-11-01T21:34:34Z", "type": "forcePushed"}, {"oid": "064d178a8d6cc730c12458f6e1536d472980ef9e", "url": "https://github.com/Azure/azure-sdk-for-java/commit/064d178a8d6cc730c12458f6e1536d472980ef9e", "message": "update spotbugs and alert config id", "committedDate": "2020-11-01T22:47:24Z", "type": "forcePushed"}, {"oid": "c9ee9390a0c7d145b7de8ee6d9ce4b2d8cebd1eb", "url": "https://github.com/Azure/azure-sdk-for-java/commit/c9ee9390a0c7d145b7de8ee6d9ce4b2d8cebd1eb", "message": "update spotbugs and alert config id", "committedDate": "2020-11-01T23:00:28Z", "type": "commit"}, {"oid": "c9ee9390a0c7d145b7de8ee6d9ce4b2d8cebd1eb", "url": "https://github.com/Azure/azure-sdk-for-java/commit/c9ee9390a0c7d145b7de8ee6d9ce4b2d8cebd1eb", "message": "update spotbugs and alert config id", "committedDate": "2020-11-01T23:00:28Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA1OTQxNg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16213#discussion_r516059416", "bodyText": "In finally should we attempt to clean up the resource only if the alertConfigurationId has a value (which means creation succeeded).", "author": "anuchandy", "createdAt": "2020-11-02T15:39:55Z", "path": "sdk/metricsadvisor/azure-ai-metricsadvisor/src/test/java/com/azure/ai/metricsadvisor/AnomalyAlertAsyncTest.java", "diffHunk": "@@ -160,20 +162,24 @@ public void getAnomalyAlertValidId(HttpClient httpClient, MetricsAdvisorServiceV\n     @ParameterizedTest(name = DISPLAY_NAME_WITH_ARGUMENTS)\n     @MethodSource(\"com.azure.ai.metricsadvisor.TestUtils#getTestParameters\")\n     public void createAnomalyAlertConfiguration(HttpClient httpClient, MetricsAdvisorServiceVersion serviceVersion) {\n-        // Arrange\n-        client = getMetricsAdvisorAdministrationBuilder(httpClient, serviceVersion).buildAsyncClient();\n         final AtomicReference<String> alertConfigurationId = new AtomicReference<>();\n-        creatAnomalyAlertRunner(inputAnomalyAlert ->\n-\n-            // Act & Assert\n-            StepVerifier.create(client.createAnomalyAlertConfiguration(inputAnomalyAlert))\n-                .assertNext(createdAnomalyAlert -> {\n-                    alertConfigurationId.set(createdAnomalyAlert.getId());\n-                    validateAnomalyAlertResult(inputAnomalyAlert, createdAnomalyAlert);\n-                })\n-                .verifyComplete());\n-\n-        client.deleteAnomalyAlertConfiguration(alertConfigurationId.get()).block();\n+        try {\n+           // Arrange\n+            client = getMetricsAdvisorAdministrationBuilder(httpClient, serviceVersion).buildAsyncClient();\n+            creatAnomalyAlertRunner(inputAnomalyAlert ->\n+\n+                // Act & Assert\n+                StepVerifier.create(client.createAnomalyAlertConfiguration(inputAnomalyAlert))\n+                    .assertNext(createdAnomalyAlert -> {\n+                        alertConfigurationId.set(createdAnomalyAlert.getId());\n+                        validateAnomalyAlertResult(inputAnomalyAlert, createdAnomalyAlert);\n+                    })\n+                    .verifyComplete());\n+        } finally {\n+            Mono<Void> deleteAnomalyAlertConfiguration\n+                = client.deleteAnomalyAlertConfiguration(alertConfigurationId.get());\n+            StepVerifier.create(deleteAnomalyAlertConfiguration).verifyComplete();", "originalCommit": "c9ee9390a0c7d145b7de8ee6d9ce4b2d8cebd1eb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA2MDIxMg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16213#discussion_r516060212", "bodyText": "the same comment for other applicable places we do the cleanup in finally.", "author": "anuchandy", "createdAt": "2020-11-02T15:41:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA1OTQxNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjE0MzM0MA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16213#discussion_r516143340", "bodyText": "Should leave a TODO to determine the root cause and fix this.", "author": "alzimmermsft", "createdAt": "2020-11-02T17:34:30Z", "path": "sdk/metricsadvisor/azure-ai-metricsadvisor/pom.xml", "diffHunk": "@@ -109,6 +109,17 @@\n               </argLine>\n             </configuration>\n           </plugin>\n+          <plugin>\n+            <groupId>org.apache.maven.plugins</groupId>\n+            <artifactId>maven-surefire-plugin</artifactId>\n+            <version>3.0.0-M3</version> <!-- {x-version-update;org.apache.maven.plugins:maven-surefire-plugin;external_dependency} -->\n+            <configuration>\n+              <systemPropertyVariables>\n+                <!-- Parallel runs disabled due to subscriber timeout issue causing failures in tests. -->\n+                <junit.jupiter.execution.parallel.enabled>false</junit.jupiter.execution.parallel.enabled>", "originalCommit": "c9ee9390a0c7d145b7de8ee6d9ce4b2d8cebd1eb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjE2Nzc4MQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16213#discussion_r516167781", "bodyText": "#17069. Will add it to the code too.", "author": "samvaity", "createdAt": "2020-11-02T18:16:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjE0MzM0MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjE0NDU3MQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16213#discussion_r516144571", "bodyText": "Are these static test configurations or dynamic each time the tests are ran?", "author": "alzimmermsft", "createdAt": "2020-11-02T17:36:41Z", "path": "sdk/metricsadvisor/tests.yml", "diffHunk": "@@ -10,3 +10,23 @@ jobs:\n           safeName: azureaimetricsadvisor\n       EnvVars:\n         AZURE_TEST_MODE: RECORD\n+        AZURE_METRICS_ADVISOR_ENDPOINT: $(metricsadvisor-test-service-endpoint)", "originalCommit": "c9ee9390a0c7d145b7de8ee6d9ce4b2d8cebd1eb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjE2MjMxOQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16213#discussion_r516162319", "bodyText": "They are static since the service has a restriction on resources per region and also the tests need ingested data which requires some prior preparation.", "author": "samvaity", "createdAt": "2020-11-02T18:06:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjE0NDU3MQ=="}], "type": "inlineReview"}, {"oid": "9b8f1e1d8bb9f170f4b28e303176ac166232643b", "url": "https://github.com/Azure/azure-sdk-for-java/commit/9b8f1e1d8bb9f170f4b28e303176ac166232643b", "message": "check non-null id before finally", "committedDate": "2020-11-02T20:51:44Z", "type": "commit"}, {"oid": "9b8f1e1d8bb9f170f4b28e303176ac166232643b", "url": "https://github.com/Azure/azure-sdk-for-java/commit/9b8f1e1d8bb9f170f4b28e303176ac166232643b", "message": "check non-null id before finally", "committedDate": "2020-11-02T20:51:44Z", "type": "forcePushed"}]}