{"pr_number": 15964, "pr_title": "Added support for HttpPipelinePosition in Storage Client builders", "pr_createdAt": "2020-10-05T22:56:54Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/15964", "timeline": [{"oid": "f68fd508f7192d5835dc2c3e1b65e7787cf40a20", "url": "https://github.com/Azure/azure-sdk-for-java/commit/f68fd508f7192d5835dc2c3e1b65e7787cf40a20", "message": "Added support for HttpPipelinePosition in Storage Client builders", "committedDate": "2020-10-05T22:55:31Z", "type": "commit"}, {"oid": "bc87e33ba3e464f6144d8bc789b316f9d7271517", "url": "https://github.com/Azure/azure-sdk-for-java/commit/bc87e33ba3e464f6144d8bc789b316f9d7271517", "message": "Added tests", "committedDate": "2020-10-05T23:09:15Z", "type": "commit"}, {"oid": "170b266c1d0f7ee9ccfb18075784fa2383a40ea2", "url": "https://github.com/Azure/azure-sdk-for-java/commit/170b266c1d0f7ee9ccfb18075784fa2383a40ea2", "message": "Fixed datalake tests", "committedDate": "2020-10-05T23:20:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQzNTkwMw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15964#discussion_r500435903", "bodyText": "Can you leave a comment that explains this tests the policy is in the right place because if it were added per retry, it would be after the credentials and auth would fail because we changed a signed header", "author": "rickle-msft", "createdAt": "2020-10-06T16:29:43Z", "path": "sdk/storage/azure-storage-blob-cryptography/src/test/java/com/azure/storage/blob/specialized/cryptography/EncyptedBlockBlobAPITest.groovy", "diffHunk": "@@ -1462,6 +1468,32 @@ class EncyptedBlockBlobAPITest extends APISpec {\n         3 * Constants.MB| Constants.MB  || 4 // Encryption padding will add an extra block\n     }\n \n+    def getPerCallVersionPolicy() {\n+        return new HttpPipelinePolicy() {\n+            @Override\n+            Mono<HttpResponse> process(HttpPipelineCallContext context, HttpPipelineNextPolicy next) {\n+                context.getHttpRequest().setHeader(\"x-ms-version\",\"2017-11-09\")\n+                return next.process()\n+            }\n+            @Override\n+            HttpPipelinePosition getPipelinePosition() {\n+                return HttpPipelinePosition.PER_CALL\n+            }\n+        }\n+    }\n+\n+    def \"Per call policy\"() {\n+        def client = getEncryptedClientBuilder(fakeKey, fakeKeyResolver, primaryCredential, bec.getBlobUrl(), getPerCallVersionPolicy()).buildEncryptedBlobClient()", "originalCommit": "170b266c1d0f7ee9ccfb18075784fa2383a40ea2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDU3MjkwOA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15964#discussion_r500572908", "bodyText": "done", "author": "gapra-msft", "createdAt": "2020-10-06T20:22:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQzNTkwMw=="}], "type": "inlineReview"}, {"oid": "e29806f511c1b50c7e43f28c70422351f5c4b9de", "url": "https://github.com/Azure/azure-sdk-for-java/commit/e29806f511c1b50c7e43f28c70422351f5c4b9de", "message": "Added comments for the test", "committedDate": "2020-10-06T17:20:12Z", "type": "commit"}]}