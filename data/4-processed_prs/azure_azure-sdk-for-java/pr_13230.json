{"pr_number": 13230, "pr_title": "mgmt, if service says 404 is error, it is error", "pr_createdAt": "2020-07-16T06:22:01Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/13230", "timeline": [{"oid": "04f6a7cd4517a3efb1e5a09df07caece95867d94", "url": "https://github.com/Azure/azure-sdk-for-java/commit/04f6a7cd4517a3efb1e5a09df07caece95867d94", "message": "remove onErrorResume", "committedDate": "2020-07-16T06:19:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTUzNTk4Ng==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13230#discussion_r455535986", "bodyText": "Track1 does this\n    private Observable<VirtualMachineInner> retrieveVirtualMachineAsync() {\n        return this.computeManager\n                .inner()\n                .virtualMachines()\n                .getByResourceGroupAsync(rgName, vmName, InstanceViewTypes.INSTANCE_VIEW)\n                .flatMap(new Func1<VirtualMachineInner, Observable<VirtualMachineInner>>() {\n                    @Override\n                    public Observable<VirtualMachineInner> call(VirtualMachineInner virtualMachine) {\n                        if (virtualMachine == null) {\n                            return Observable.error(new Exception(String.format(\"VM with name '%s' not found (resource group '%s')\",\n                                    vmName, rgName)));\n                        }\n                        return Observable.just(virtualMachine);\n                    }\n                });\n    }\n\nBasically it convert null to Exception.\nSince we already has Exception here, no need for this code.\n\nI've added // Exception if vm not found comment in these locations, in case we need to switch back the GET 404 response to Mono.empty() without ManagementException.", "author": "weidongxu-microsoft", "createdAt": "2020-07-16T06:23:33Z", "path": "sdk/compute/mgmt/src/main/java/com/azure/resourcemanager/compute/implementation/WindowsVolumeNoAADEncryptionMonitorImpl.java", "diffHunk": "@@ -155,13 +155,7 @@ public DiskVolumeEncryptionMonitor refresh() {\n             .computeManager\n             .inner()\n             .getVirtualMachines()\n-            .getByResourceGroupAsync(rgName, vmName)\n-            .onErrorResume(", "originalCommit": "04f6a7cd4517a3efb1e5a09df07caece95867d94", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "13ba3c54d4dc35d02c82d265f12b9731a3c99080", "url": "https://github.com/Azure/azure-sdk-for-java/commit/13ba3c54d4dc35d02c82d265f12b9731a3c99080", "message": "add comment to mark the location", "committedDate": "2020-07-16T06:37:15Z", "type": "commit"}, {"oid": "c75fd7b228a0f68ddb8edbe239a1e3d950f89fa9", "url": "https://github.com/Azure/azure-sdk-for-java/commit/c75fd7b228a0f68ddb8edbe239a1e3d950f89fa9", "message": "Merge branch 'master' into mgmt_let-it-fail", "committedDate": "2020-07-16T06:37:54Z", "type": "commit"}, {"oid": "9f3981cfdae8dede72ee3d997392746bc3349e3d", "url": "https://github.com/Azure/azure-sdk-for-java/commit/9f3981cfdae8dede72ee3d997392746bc3349e3d", "message": "revert", "committedDate": "2020-07-16T06:49:28Z", "type": "commit"}, {"oid": "139ae18cfde5e5253d417105edc73b7a1e40c4d3", "url": "https://github.com/Azure/azure-sdk-for-java/commit/139ae18cfde5e5253d417105edc73b7a1e40c4d3", "message": "protection for 404", "committedDate": "2020-07-16T09:15:54Z", "type": "commit"}, {"oid": "9ba48650009632d33039f9641d39ae23719e50b6", "url": "https://github.com/Azure/azure-sdk-for-java/commit/9ba48650009632d33039f9641d39ae23719e50b6", "message": "nit", "committedDate": "2020-07-16T09:20:22Z", "type": "commit"}, {"oid": "6a0d0c751b32aa2d6e3503213e3b072916a49226", "url": "https://github.com/Azure/azure-sdk-for-java/commit/6a0d0c751b32aa2d6e3503213e3b072916a49226", "message": "ignore 404 in nested list", "committedDate": "2020-07-16T09:57:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjI3NjIzOQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13230#discussion_r456276239", "bodyText": "why does it need the try? When will it throw IllegalArgumentException?", "author": "ChenTanyi", "createdAt": "2020-07-17T07:46:07Z", "path": "sdk/authorization/mgmt/src/main/java/com/azure/resourcemanager/authorization/implementation/ActiveDirectoryApplicationsImpl.java", "diffHunk": "@@ -93,10 +91,13 @@ public ActiveDirectoryApplication getByName(String spn) {\n                 Mono\n                     .defer(\n                         () -> {\n-                            UUID.fromString(trimmed);\n-                            return inner().listAsync(String.format(\"appId eq '%s'\", trimmed)).singleOrEmpty();\n+                            try {\n+                                UUID.fromString(trimmed);\n+                                return inner().listAsync(String.format(\"appId eq '%s'\", trimmed)).singleOrEmpty();\n+                            } catch (IllegalArgumentException e) {\n+                                return Mono.empty();\n+                            }", "originalCommit": "6a0d0c751b32aa2d6e3503213e3b072916a49226", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjMxODQ5Mw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13230#discussion_r456318493", "bodyText": "I think it is for UUID.fromString. The block tries to find Application by the appId. So if input is not UUID, this part will be skipped.\nI think try catch in the exact location would be better than previously .onErrorResume(IllegalArgumentException.class, e -> Mono.empty()) after this block.", "author": "weidongxu-microsoft", "createdAt": "2020-07-17T09:07:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjI3NjIzOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjI3ODA3MQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13230#discussion_r456278071", "bodyText": "I think it could just be removed, due to other list will not deal with 404.", "author": "ChenTanyi", "createdAt": "2020-07-17T07:50:04Z", "path": "sdk/compute/mgmt/src/main/java/com/azure/resourcemanager/compute/implementation/VirtualMachineExtensionImagesImpl.java", "diffHunk": "@@ -44,9 +45,10 @@ public VirtualMachineExtensionImagesImpl(VirtualMachinePublishers publishers) {\n                     virtualMachinePublisher\n                         .extensionTypes()\n                         .listAsync()\n-                        .onErrorResume(e -> Mono.empty())\n-                        .flatMap(\n-                            virtualMachineExtensionImageType -> virtualMachineExtensionImageType.versions().listAsync())\n+                        .onErrorResume(ManagementException.class,\n+                            e -> e.getResponse().getStatusCode() == 404 ? Flux.empty() : Flux.error(e))", "originalCommit": "6a0d0c751b32aa2d6e3503213e3b072916a49226", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjMxOTY5Nw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13230#discussion_r456319697", "bodyText": "This is because for 1 or 2 publisher, above list image type would fail with 404 (error on publisher not valid). But apparently we would still want to continue with the other publishers.", "author": "weidongxu-microsoft", "createdAt": "2020-07-17T09:09:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjI3ODA3MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjI3ODI0Nw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13230#discussion_r456278247", "bodyText": "same as above", "author": "ChenTanyi", "createdAt": "2020-07-17T07:50:23Z", "path": "sdk/compute/mgmt/src/main/java/com/azure/resourcemanager/compute/implementation/VirtualMachineImagesImpl.java", "diffHunk": "@@ -85,7 +87,8 @@ public VirtualMachineImage getImage(\n                     virtualMachinePublisher\n                         .offers()\n                         .listAsync()\n-                        .onErrorResume(e -> Mono.empty())\n+                        .onErrorResume(ManagementException.class,\n+                            e -> e.getResponse().getStatusCode() == 404 ? Flux.empty() : Flux.error(e))", "originalCommit": "6a0d0c751b32aa2d6e3503213e3b072916a49226", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}