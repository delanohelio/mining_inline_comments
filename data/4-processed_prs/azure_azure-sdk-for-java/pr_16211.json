{"pr_number": 16211, "pr_title": " upgrade jms underlying library with azure-servicebus-jms ", "pr_createdAt": "2020-10-13T02:40:48Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/16211", "timeline": [{"oid": "ef20b70bddc937268f919abcb9cce4ff0e1c0869", "url": "https://github.com/Azure/azure-sdk-for-java/commit/ef20b70bddc937268f919abcb9cce4ff0e1c0869", "message": "upgrade jms underlying library with azure-servicebus-jms\n\n(cherry picked from commit 635f53201a3d3089fae12c6953b083e7c9e9018b)", "committedDate": "2020-10-13T01:37:02Z", "type": "commit"}, {"oid": "47f6b62858423390a67b0daf5400fd1e99f08c44", "url": "https://github.com/Azure/azure-sdk-for-java/commit/47f6b62858423390a67b0daf5400fd1e99f08c44", "message": "add some comment\n\n(cherry picked from commit b70c14962e9e5d931acbc033741f05b5ab687cd2)", "committedDate": "2020-10-13T01:37:14Z", "type": "commit"}, {"oid": "733336686d11448bf1484ce01221e1b183e35cb3", "url": "https://github.com/Azure/azure-sdk-for-java/commit/733336686d11448bf1484ce01221e1b183e35cb3", "message": "relase spring boot 2.3.6-beta.1", "committedDate": "2020-10-13T02:30:06Z", "type": "commit"}, {"oid": "8e190170868594016736bbd038883e4ed9398131", "url": "https://github.com/Azure/azure-sdk-for-java/commit/8e190170868594016736bbd038883e4ed9398131", "message": "add azure-servicebus-jms external dependencies", "committedDate": "2020-10-13T03:10:08Z", "type": "commit"}, {"oid": "0fb7defc5c8aaabc7a6d97a7441017e4367e7a5b", "url": "https://github.com/Azure/azure-sdk-for-java/commit/0fb7defc5c8aaabc7a6d97a7441017e4367e7a5b", "message": "fix external dependencies, from ``:` to `;`", "committedDate": "2020-10-13T03:24:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzkyMzQ3NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16211#discussion_r503923474", "bodyText": "If the combination is not prefixed by spring_, we could place it above with all other external dependencies, instead of having a separate block for it.", "author": "saragluna", "createdAt": "2020-10-13T12:50:23Z", "path": "eng/versioning/external_dependencies.txt", "diffHunk": "@@ -315,3 +315,6 @@ storage_com.microsoft.azure:azure-storage;8.4.0\n \n # sdk\\spring\\azure-spring-boot\\pom.xml\n spring_com.microsoft.azure:azure;1.34.0\n+\n+# sdk\\spring\\azure-spring-boot-starter-servicebus-jms\\pom.xml\n+com.microsoft.azure:azure-servicebus-jms;0.0.5", "originalCommit": "0fb7defc5c8aaabc7a6d97a7441017e4367e7a5b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzkyMzk5NQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16211#discussion_r503923995", "bodyText": "The dependency version should be 2.3.5.", "author": "saragluna", "createdAt": "2020-10-13T12:51:12Z", "path": "eng/versioning/version_client.txt", "diffHunk": "@@ -88,15 +88,15 @@ com.azure.resourcemanager:azure-resourcemanager-sql;2.0.0-beta.4;2.0.0-beta.5\n com.azure.resourcemanager:azure-resourcemanager-storage;2.0.0-beta.4;2.0.0-beta.5\n com.azure.resourcemanager:azure-resourcemanager-trafficmanager;2.0.0-beta.4;2.0.0-beta.5\n com.azure.resourcemanager:azure-resourcemanager-test;2.0.0-beta.4;2.0.0-beta.5\n-com.microsoft.azure:azure-active-directory-b2c-spring-boot-starter;2.3.3;2.3.5\n-com.microsoft.azure:azure-active-directory-spring-boot-starter;2.3.3;2.3.5\n-com.microsoft.azure:azure-cosmosdb-spring-boot-starter;2.3.3;2.3.5\n-com.microsoft.azure:azure-data-gremlin-spring-boot-starter;2.3.3;2.3.5\n-com.microsoft.azure:azure-keyvault-secrets-spring-boot-starter;2.3.3;2.3.5\n-com.microsoft.azure:azure-servicebus-jms-spring-boot-starter;2.3.4;2.3.5\n-com.microsoft.azure:azure-spring-boot-metrics-starter;2.3.3;2.3.5\n-com.microsoft.azure:azure-spring-boot-starter;2.3.4;2.3.5\n-com.microsoft.azure:azure-spring-boot;2.3.4;2.3.5\n+com.microsoft.azure:azure-active-directory-b2c-spring-boot-starter;2.3.3;2.3.6-beta.1", "originalCommit": "0fb7defc5c8aaabc7a6d97a7441017e4367e7a5b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTIwMjU0Ng==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16211#discussion_r505202546", "bodyText": "ok", "author": "backwind1233", "createdAt": "2020-10-15T06:32:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzkyMzk5NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzkyNDUzMA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16211#discussion_r503924530", "bodyText": "Are these versions updated by the update_version.py script?", "author": "saragluna", "createdAt": "2020-10-13T12:52:00Z", "path": "sdk/spring/azure-spring-boot-samples/azure-spring-cloud-appconfiguration-conversion-sample-initial/pom.xml", "diffHunk": "@@ -32,7 +32,7 @@\n     <dependency>\n       <groupId>com.microsoft.azure</groupId>\n       <artifactId>azure-cosmosdb-spring-boot-starter</artifactId>\n-      <version>2.3.5</version> <!-- {x-version-update;com.microsoft.azure:azure-cosmosdb-spring-boot-starter;current} -->\n+      <version>2.3.6-beta.1</version> <!-- {x-version-update;com.microsoft.azure:azure-cosmosdb-spring-boot-starter;current} -->", "originalCommit": "0fb7defc5c8aaabc7a6d97a7441017e4367e7a5b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzkyNjE1MA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16211#discussion_r503926150", "bodyText": "No need for the topic client id anymore? BTW, do we need to set up the UA header for BI here?", "author": "saragluna", "createdAt": "2020-10-13T12:54:31Z", "path": "sdk/spring/azure-spring-boot/src/main/java/com/microsoft/azure/spring/autoconfigure/jms/ServiceBusJMSAutoConfiguration.java", "diffHunk": "@@ -31,21 +32,12 @@\n     @ConditionalOnMissingBean\n     public ConnectionFactory jmsConnectionFactory(AzureServiceBusJMSProperties serviceBusJMSProperties) {\n         final String connectionString = serviceBusJMSProperties.getConnectionString();\n-        final String clientId = serviceBusJMSProperties.getTopicClientId();\n-        final int idleTimeout = serviceBusJMSProperties.getIdleTimeout();\n-\n-        final ServiceBusKey serviceBusKey = ConnectionStringResolver.getServiceBusKey(connectionString);\n-        final String host = serviceBusKey.getHost();\n-        final String sasKeyName = serviceBusKey.getSharedAccessKeyName();\n-        final String sasKey = serviceBusKey.getSharedAccessKey();\n-\n-        final String remoteUri = String.format(AMQP_URI_FORMAT, host, idleTimeout);\n-        final JmsConnectionFactory jmsConnectionFactory = new JmsConnectionFactory();\n-        jmsConnectionFactory.setRemoteURI(remoteUri);\n-        jmsConnectionFactory.setClientID(clientId);\n-        jmsConnectionFactory.setUsername(sasKeyName);\n-        jmsConnectionFactory.setPassword(sasKey);\n-        return new CachingConnectionFactory(jmsConnectionFactory);\n+        final long idleTimeout = serviceBusJMSProperties.getIdleTimeout();\n+        final ServiceBusJmsConnectionFactorySettings settings =", "originalCommit": "0fb7defc5c8aaabc7a6d97a7441017e4367e7a5b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "cf1cba8f44db92036498a7064a4439238c2c5b6d", "url": "https://github.com/Azure/azure-sdk-for-java/commit/cf1cba8f44db92036498a7064a4439238c2c5b6d", "message": "add clientId", "committedDate": "2020-10-14T09:00:27Z", "type": "commit"}, {"oid": "8d1e5d8b62023d655d6c0f3d2f681a8a8a1928ed", "url": "https://github.com/Azure/azure-sdk-for-java/commit/8d1e5d8b62023d655d6c0f3d2f681a8a8a1928ed", "message": "format code", "committedDate": "2020-10-15T08:20:32Z", "type": "commit"}, {"oid": "2a659aa3208b61d234e0f2f3efa59142877c8aed", "url": "https://github.com/Azure/azure-sdk-for-java/commit/2a659aa3208b61d234e0f2f3efa59142877c8aed", "message": "format code: sort lines", "committedDate": "2020-10-15T08:32:01Z", "type": "commit"}, {"oid": "7bb139c9008089bd8666749035fce67ff99dbff0", "url": "https://github.com/Azure/azure-sdk-for-java/commit/7bb139c9008089bd8666749035fce67ff99dbff0", "message": "set userAgent", "committedDate": "2020-10-15T09:04:53Z", "type": "commit"}, {"oid": "55b19aa5147b307184fe28ee7167a9d4e2cf1283", "url": "https://github.com/Azure/azure-sdk-for-java/commit/55b19aa5147b307184fe28ee7167a9d4e2cf1283", "message": "update version", "committedDate": "2020-10-15T09:14:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTk4MTc3OA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16211#discussion_r505981778", "bodyText": "@saragluna ,\nAha, I'm not the only person who like this code style.  \ud83d\ude04", "author": "chenrujun", "createdAt": "2020-10-16T02:03:35Z", "path": "sdk/spring/azure-spring-boot/src/main/java/com/microsoft/azure/spring/autoconfigure/jms/SpringServiceBusJmsConnectionFactory.java", "diffHunk": "@@ -0,0 +1,20 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.microsoft.azure.spring.autoconfigure.jms;\n+\n+import com.microsoft.azure.servicebus.jms.ServiceBusJmsConnectionFactory;\n+import com.microsoft.azure.servicebus.jms.ServiceBusJmsConnectionFactorySettings;\n+\n+public class SpringServiceBusJmsConnectionFactory extends ServiceBusJmsConnectionFactory {\n+    public SpringServiceBusJmsConnectionFactory(\n+        String connectionString,\n+        ServiceBusJmsConnectionFactorySettings settings\n+    ) {", "originalCommit": "55b19aa5147b307184fe28ee7167a9d4e2cf1283", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjAyNDA3Ng==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16211#discussion_r506024076", "bodyText": "test", "author": "backwind1233", "createdAt": "2020-10-16T03:27:20Z", "path": "eng/jacoco-test-coverage/pom.xml", "diffHunk": "@@ -330,47 +330,47 @@\n     <dependency>\n       <groupId>com.microsoft.azure</groupId>\n       <artifactId>azure-spring-boot</artifactId>\n-      <version>2.3.5</version> <!-- {x-version-update;com.microsoft.azure:azure-spring-boot;current} -->\n+      <version>2.3.6-beta.1</version> <!-- {x-version-update;com.microsoft.azure:azure-spring-boot;current} -->\n     </dependency>\n     <dependency>\n       <groupId>com.microsoft.azure</groupId>\n       <artifactId>azure-spring-boot-starter</artifactId>\n-      <version>2.3.5</version> <!-- {x-version-update;com.microsoft.azure:azure-spring-boot-starter;current} -->\n+      <version>2.3.6-beta.1</version> <!-- {x-version-update;com.microsoft.azure:azure-spring-boot-starter;current} -->\n     </dependency>\n     <dependency>\n       <groupId>com.microsoft.azure</groupId>", "originalCommit": "0fb7defc5c8aaabc7a6d97a7441017e4367e7a5b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjA0MDc3Nw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16211#discussion_r506040777", "bodyText": "349-352 4 lines", "author": "backwind1233", "createdAt": "2020-10-16T04:11:14Z", "path": "eng/jacoco-test-coverage/pom.xml", "diffHunk": "@@ -330,47 +330,47 @@\n     <dependency>\n       <groupId>com.microsoft.azure</groupId>\n       <artifactId>azure-spring-boot</artifactId>\n-      <version>2.3.5</version> <!-- {x-version-update;com.microsoft.azure:azure-spring-boot;current} -->\n+      <version>2.3.6-beta.1</version> <!-- {x-version-update;com.microsoft.azure:azure-spring-boot;current} -->\n     </dependency>\n     <dependency>\n       <groupId>com.microsoft.azure</groupId>\n       <artifactId>azure-spring-boot-starter</artifactId>\n-      <version>2.3.5</version> <!-- {x-version-update;com.microsoft.azure:azure-spring-boot-starter;current} -->\n+      <version>2.3.6-beta.1</version> <!-- {x-version-update;com.microsoft.azure:azure-spring-boot-starter;current} -->\n     </dependency>\n     <dependency>\n       <groupId>com.microsoft.azure</groupId>\n       <artifactId>azure-active-directory-spring-boot-starter</artifactId>\n-      <version>2.3.5</version> <!-- {x-version-update;com.microsoft.azure:azure-active-directory-spring-boot-starter;current} -->\n+      <version>2.3.6-beta.1</version> <!-- {x-version-update;com.microsoft.azure:azure-active-directory-spring-boot-starter;current} -->\n     </dependency>\n     <dependency>\n       <groupId>com.microsoft.azure</groupId>\n       <artifactId>azure-keyvault-secrets-spring-boot-starter</artifactId>\n-      <version>2.3.5</version> <!-- {x-version-update;com.microsoft.azure:azure-keyvault-secrets-spring-boot-starter;current} -->\n+      <version>2.3.6-beta.1</version> <!-- {x-version-update;com.microsoft.azure:azure-keyvault-secrets-spring-boot-starter;current} -->\n     </dependency>\n     <dependency>\n       <groupId>com.microsoft.azure</groupId>\n       <artifactId>azure-spring-boot-metrics-starter</artifactId>", "originalCommit": "55b19aa5147b307184fe28ee7167a9d4e2cf1283", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}