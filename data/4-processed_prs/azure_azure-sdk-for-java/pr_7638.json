{"pr_number": 7638, "pr_title": "Text Analytics ARM template for Live tests", "pr_createdAt": "2020-01-23T00:44:40Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/7638", "timeline": [{"oid": "b77220411fbfa0e3fb0b1334549b267f3af64916", "url": "https://github.com/Azure/azure-sdk-for-java/commit/b77220411fbfa0e3fb0b1334549b267f3af64916", "message": "add test-resources for text analytics", "committedDate": "2020-01-28T22:29:27Z", "type": "commit"}, {"oid": "68520a3c08fe16b3b431542d605b4aef198811c6", "url": "https://github.com/Azure/azure-sdk-for-java/commit/68520a3c08fe16b3b431542d605b4aef198811c6", "message": "fix for live tests", "committedDate": "2020-01-28T22:31:52Z", "type": "forcePushed"}, {"oid": "9664b78ce9325aa3127484f82250d6fa027743b6", "url": "https://github.com/Azure/azure-sdk-for-java/commit/9664b78ce9325aa3127484f82250d6fa027743b6", "message": "fix for live tests", "committedDate": "2020-01-28T22:41:32Z", "type": "commit"}, {"oid": "9664b78ce9325aa3127484f82250d6fa027743b6", "url": "https://github.com/Azure/azure-sdk-for-java/commit/9664b78ce9325aa3127484f82250d6fa027743b6", "message": "fix for live tests", "committedDate": "2020-01-28T22:41:32Z", "type": "forcePushed"}, {"oid": "649113abb87cb7ca72702722bef65b90c370fb87", "url": "https://github.com/Azure/azure-sdk-for-java/commit/649113abb87cb7ca72702722bef65b90c370fb87", "message": "Merge branch 'master' of https://github.com/Azure/azure-sdk-for-java into arm-temp-ta", "committedDate": "2020-01-28T22:52:05Z", "type": "commit"}, {"oid": "fb31579586ed95b79d4f0ff62d3d26f8b64e1ac1", "url": "https://github.com/Azure/azure-sdk-for-java/commit/fb31579586ed95b79d4f0ff62d3d26f8b64e1ac1", "message": "u", "committedDate": "2020-01-28T23:17:52Z", "type": "forcePushed"}, {"oid": "4f99cdef70470cbd1bbe5d23d5f1ccb005b70ca1", "url": "https://github.com/Azure/azure-sdk-for-java/commit/4f99cdef70470cbd1bbe5d23d5f1ccb005b70ca1", "message": "Code coverage in aggregate reports (#7734)\n\n* Drop in code coverage generation.\n\n* Set pom file location.\n\n* Increase job timeout.\n\n* Remove nio dependency for now.", "committedDate": "2020-01-28T23:19:44Z", "type": "forcePushed"}, {"oid": "431f1b3fdb25f4517a9322966bb9ce5f5544bf6b", "url": "https://github.com/Azure/azure-sdk-for-java/commit/431f1b3fdb25f4517a9322966bb9ce5f5544bf6b", "message": "add subscription key in tests yml", "committedDate": "2020-01-28T23:38:44Z", "type": "commit"}, {"oid": "431f1b3fdb25f4517a9322966bb9ce5f5544bf6b", "url": "https://github.com/Azure/azure-sdk-for-java/commit/431f1b3fdb25f4517a9322966bb9ce5f5544bf6b", "message": "add subscription key in tests yml", "committedDate": "2020-01-28T23:38:44Z", "type": "forcePushed"}, {"oid": "984c04a9702924be6b23b5a90dee2c106cc5b99c", "url": "https://github.com/Azure/azure-sdk-for-java/commit/984c04a9702924be6b23b5a90dee2c106cc5b99c", "message": "update with tests-resources", "committedDate": "2020-01-29T00:21:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjUyMDYxMQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7638#discussion_r372520611", "bodyText": "You'll want to change this to the below, right now this is still looking at the value being loaded from the KeyVault.\nAZURE_TEXT_ANALYTICS_ENDPOINT: $(AZURE_TEXT_ANALYTICS_ENDPOINT)\nI may be mis-remembering this but @danieljurek mentioned that this may not need to be listed since the generated output uses the same name as the environment variable expected and it can automatically map the value.", "author": "alzimmermsft", "createdAt": "2020-01-29T17:21:03Z", "path": "sdk/textanalytics/tests.yml", "diffHunk": "@@ -9,5 +9,6 @@ jobs:\n         AZURE_CLIENT_ID: $(aad-azure-sdk-test-client-id)\n         AZURE_CLIENT_SECRET: $(aad-azure-sdk-test-client-secret)\n         AZURE_TENANT_ID: $(aad-azure-sdk-test-tenant-id)\n-        AZURE_TEXT_ANALYTICS_ENDPOINT: $(java-textanalytics-sdk-endpoint)\n+        AZURE_TEXT_ANALYTICS_ENDPOINT: $(java-azure-textanalytics-sdk-endpoint)", "originalCommit": "984c04a9702924be6b23b5a90dee2c106cc5b99c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjYzMTY4Mw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7638#discussion_r372631683", "bodyText": "Yes, once the ARM template changes are correct. This yml file should no longer have these variables mentioned. Keeping these changes currently to help the service team investigate a bug on the Live tests pipeline that is using this PR.", "author": "samvaity", "createdAt": "2020-01-29T21:11:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjUyMDYxMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjUyMTMxOQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7638#discussion_r372521319", "bodyText": "I believe @mssfang mentioned that East US needs to be used, do you know what location this will be? I think it may be West US or West US2 by default, @hemanttanwar could you verify.", "author": "alzimmermsft", "createdAt": "2020-01-29T17:22:20Z", "path": "sdk/textanalytics/test-resources.json", "diffHunk": "@@ -0,0 +1,43 @@\n+{\n+    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\n+    \"contentVersion\": \"1.0.0.0\",\n+    \"parameters\": {\n+        \"baseName\": {\n+            \"type\": \"String\"\n+        },\n+        \"tenantId\": {\n+            \"type\": \"String\"\n+        },\n+        \"testApplicationOid\": {\n+            \"type\": \"String\"\n+        },\n+        \"endpointSuffix\": {\n+            \"defaultValue\": \"cognitiveservices.azure.com\",\n+            \"type\": \"String\"\n+        }\n+    },\n+    \"variables\": {\n+        \"location\": \"[resourceGroup().location]\",", "originalCommit": "984c04a9702924be6b23b5a90dee2c106cc5b99c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjU4MDExNA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7638#discussion_r372580114", "bodyText": "We used to be told that West US/West US 2 is not functioning properly.  It is a service bug. But currently, the bug exists for other regions as well. So the region should not matter in this case.", "author": "mssfang", "createdAt": "2020-01-29T19:18:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjUyMTMxOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjUyMTU5Mw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7638#discussion_r372521593", "bodyText": "Should this value be output by the resource generator?", "author": "alzimmermsft", "createdAt": "2020-01-29T17:22:53Z", "path": "sdk/textanalytics/tests.yml", "diffHunk": "@@ -9,5 +9,6 @@ jobs:\n         AZURE_CLIENT_ID: $(aad-azure-sdk-test-client-id)\n         AZURE_CLIENT_SECRET: $(aad-azure-sdk-test-client-secret)\n         AZURE_TENANT_ID: $(aad-azure-sdk-test-tenant-id)\n-        AZURE_TEXT_ANALYTICS_ENDPOINT: $(java-textanalytics-sdk-endpoint)\n+        AZURE_TEXT_ANALYTICS_ENDPOINT: $(java-azure-textanalytics-sdk-endpoint)\n+        AZURE_TEXT_ANALYTICS_SUBSCRIPTION_KEY: $(java-textanalytics-test-subscription-key)", "originalCommit": "984c04a9702924be6b23b5a90dee2c106cc5b99c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDg1Mjc4Nw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7638#discussion_r374852787", "bodyText": "These values should not exist here anymore as they would be output variables from the test-resources.json file itself.", "author": "samvaity", "createdAt": "2020-02-04T18:43:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjUyMTU5Mw=="}], "type": "inlineReview"}, {"oid": "2c8beb01f6c0a063edb588de5833f87ebe317e52", "url": "https://github.com/Azure/azure-sdk-for-java/commit/2c8beb01f6c0a063edb588de5833f87ebe317e52", "message": "working deployment file", "committedDate": "2020-01-30T20:21:22Z", "type": "commit"}, {"oid": "da12c53fc55b8be527f3201387ae6755011cf705", "url": "https://github.com/Azure/azure-sdk-for-java/commit/da12c53fc55b8be527f3201387ae6755011cf705", "message": "add role assignments", "committedDate": "2020-01-30T22:27:04Z", "type": "commit"}, {"oid": "9902ed33cd88769c120a6a6ef4441511bf964b36", "url": "https://github.com/Azure/azure-sdk-for-java/commit/9902ed33cd88769c120a6a6ef4441511bf964b36", "message": "remove prim name", "committedDate": "2020-01-30T23:25:06Z", "type": "commit"}, {"oid": "6f08995d6c5b4e1962eb35d90247df0d1c850e5a", "url": "https://github.com/Azure/azure-sdk-for-java/commit/6f08995d6c5b4e1962eb35d90247df0d1c850e5a", "message": "update endpoint", "committedDate": "2020-01-30T23:57:57Z", "type": "commit"}, {"oid": "54cf4829fa206285ca14cb16ffb9b5b68447105e", "url": "https://github.com/Azure/azure-sdk-for-java/commit/54cf4829fa206285ca14cb16ffb9b5b68447105e", "message": "Merge branch 'master' of https://github.com/Azure/azure-sdk-for-java into arm-temp-ta", "committedDate": "2020-01-31T01:11:20Z", "type": "commit"}, {"oid": "a5d8ced131201181c8db6ca36baf4791c1b32df6", "url": "https://github.com/Azure/azure-sdk-for-java/commit/a5d8ced131201181c8db6ca36baf4791c1b32df6", "message": "update role id", "committedDate": "2020-02-03T22:38:32Z", "type": "commit"}, {"oid": "cd3f33667a1813a399cc7f0dfb45f7f888da2452", "url": "https://github.com/Azure/azure-sdk-for-java/commit/cd3f33667a1813a399cc7f0dfb45f7f888da2452", "message": "update to latest api version", "committedDate": "2020-02-03T23:37:27Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDQzNzk4Nw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7638#discussion_r374437987", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            \"description\": \"THe base resource name.\"\n          \n          \n            \n                            \"description\": \"The base resource name.\"", "author": "conniey", "createdAt": "2020-02-04T01:52:08Z", "path": "sdk/textanalytics/test-resources.json", "diffHunk": "@@ -0,0 +1,89 @@\n+{\n+    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\n+    \"contentVersion\": \"1.0.0.0\",\n+    \"parameters\": {\n+        \"baseName\": {\n+            \"type\": \"string\",\n+            \"defaultValue\": \"[resourceGroup().name]\",\n+            \"metadata\": {\n+                \"description\": \"THe base resource name.\"", "originalCommit": "cd3f33667a1813a399cc7f0dfb45f7f888da2452", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDQzODExNQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7638#discussion_r374438115", "bodyText": "nit: be consistent about using ID or id.", "author": "conniey", "createdAt": "2020-02-04T01:52:43Z", "path": "sdk/textanalytics/test-resources.json", "diffHunk": "@@ -0,0 +1,89 @@\n+{\n+    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\n+    \"contentVersion\": \"1.0.0.0\",\n+    \"parameters\": {\n+        \"baseName\": {\n+            \"type\": \"string\",\n+            \"defaultValue\": \"[resourceGroup().name]\",\n+            \"metadata\": {\n+                \"description\": \"THe base resource name.\"\n+            }\n+        },\n+        \"testApplicationOid\": {\n+            \"type\": \"String\",\n+            \"metadata\": {\n+                \"description\": \"The principal to assign the role to. This is application object id.\"", "originalCommit": "cd3f33667a1813a399cc7f0dfb45f7f888da2452", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDg2MjIyNA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7638#discussion_r374862224", "bodyText": "updated throughout to use id.", "author": "samvaity", "createdAt": "2020-02-04T19:00:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDQzODExNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDQzODIzMQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7638#discussion_r374438231", "bodyText": "taRoleId -> textAnalyticsRoleId.\nIt makes it a lot easier for future people to reason about.", "author": "conniey", "createdAt": "2020-02-04T01:53:15Z", "path": "sdk/textanalytics/test-resources.json", "diffHunk": "@@ -0,0 +1,89 @@\n+{\n+    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\n+    \"contentVersion\": \"1.0.0.0\",\n+    \"parameters\": {\n+        \"baseName\": {\n+            \"type\": \"string\",\n+            \"defaultValue\": \"[resourceGroup().name]\",\n+            \"metadata\": {\n+                \"description\": \"THe base resource name.\"\n+            }\n+        },\n+        \"testApplicationOid\": {\n+            \"type\": \"String\",\n+            \"metadata\": {\n+                \"description\": \"The principal to assign the role to. This is application object id.\"\n+            }\n+        },\n+        \"tenantId\": {\n+            \"type\": \"String\",\n+            \"metadata\": {\n+                \"description\": \"The tenant ID to which the application and resources belong.\"\n+            }\n+        },\n+        \"testApplicationId\": {\n+            \"type\": \"String\",\n+            \"metadata\": {\n+                \"description\": \"The application client ID used to run tests.\"\n+            }\n+        },\n+        \"testApplicationSecret\": {\n+            \"type\": \"String\",\n+            \"metadata\": {\n+                \"description\": \"The application client secret used to run tests.\"\n+            }\n+        }\n+    },\n+    \"variables\": {\n+        \"taRoleId\": \"[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Authorization/roleDefinitions/a97b65f3-24c7-4388-baec-2e87135dc908')]\"", "originalCommit": "cd3f33667a1813a399cc7f0dfb45f7f888da2452", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDQzODM2NQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7638#discussion_r374438365", "bodyText": "nit: missing new line.", "author": "conniey", "createdAt": "2020-02-04T01:53:51Z", "path": "sdk/textanalytics/test-resources.json", "diffHunk": "@@ -0,0 +1,89 @@\n+{\n+    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\n+    \"contentVersion\": \"1.0.0.0\",\n+    \"parameters\": {\n+        \"baseName\": {\n+            \"type\": \"string\",\n+            \"defaultValue\": \"[resourceGroup().name]\",\n+            \"metadata\": {\n+                \"description\": \"THe base resource name.\"\n+            }\n+        },\n+        \"testApplicationOid\": {\n+            \"type\": \"String\",\n+            \"metadata\": {\n+                \"description\": \"The principal to assign the role to. This is application object id.\"\n+            }\n+        },\n+        \"tenantId\": {\n+            \"type\": \"String\",\n+            \"metadata\": {\n+                \"description\": \"The tenant ID to which the application and resources belong.\"\n+            }\n+        },\n+        \"testApplicationId\": {\n+            \"type\": \"String\",\n+            \"metadata\": {\n+                \"description\": \"The application client ID used to run tests.\"\n+            }\n+        },\n+        \"testApplicationSecret\": {\n+            \"type\": \"String\",\n+            \"metadata\": {\n+                \"description\": \"The application client secret used to run tests.\"\n+            }\n+        }\n+    },\n+    \"variables\": {\n+        \"taRoleId\": \"[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Authorization/roleDefinitions/a97b65f3-24c7-4388-baec-2e87135dc908')]\"\n+    },\n+    \"resources\": [\n+        {\n+            \"type\": \"Microsoft.Authorization/roleAssignments\",\n+            \"apiVersion\": \"2018-09-01-preview\",\n+            \"name\": \"[guid(concat(variables('taRoleId'), parameters('baseName')))]\",\n+            \"dependsOn\": [\n+                \"[parameters('baseName')]\"\n+            ],\n+            \"properties\": {\n+                \"principalId\": \"[parameters('testApplicationOid')]\",\n+                \"roleDefinitionId\": \"[variables('taRoleId')]\"\n+            }\n+        },\n+        {\n+            \"type\": \"Microsoft.CognitiveServices/accounts\",\n+            \"name\": \"[parameters('baseName')]\",\n+            \"apiVersion\": \"2017-04-18\",\n+            \"sku\": {\n+                \"name\": \"S\"\n+            },\n+            \"kind\": \"TextAnalytics\",\n+            \"location\": \"[resourceGroup().location]\",\n+            \"properties\": {\n+                \"customSubDomainName\": \"[parameters('baseName')]\"\n+            }\n+        }\n+    ],\n+    \"outputs\": {\n+        \"AZURE_TENANT_ID\": {\n+            \"type\": \"String\",\n+            \"value\": \"[parameters('tenantId')]\"\n+        },\n+        \"AZURE_CLIENT_ID\": {\n+            \"type\": \"String\",\n+            \"value\": \"[parameters('testApplicationId')]\"\n+        },\n+        \"AZURE_CLIENT_SECRET\": {\n+            \"type\": \"String\",\n+            \"value\": \"[parameters('testApplicationSecret')]\"\n+        },\n+        \"AZURE_TEXT_ANALYTICS_SUBSCRIPTION_KEY\": {\n+            \"type\": \"string\",\n+            \"value\": \"[listKeys(resourceId('Microsoft.CognitiveServices/accounts', parameters('baseName')), '2017-04-18').key1]\"\n+        },\n+        \"AZURE_TEXT_ANALYTICS_ENDPOINT\": {\n+            \"type\": \"string\",\n+            \"value\": \"[concat('https://', parameters('baseName'), '.cognitiveservices.azure.com/')]\"\n+        }\n+    }\n+}", "originalCommit": "cd3f33667a1813a399cc7f0dfb45f7f888da2452", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDQzODU5NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7638#discussion_r374438594", "bodyText": "I would make this a variable in the template rather than creating it here. It makes it easier to follow because we just have to jump to the top of this script rather than ctrl+f through all our concats.", "author": "conniey", "createdAt": "2020-02-04T01:54:57Z", "path": "sdk/textanalytics/test-resources.json", "diffHunk": "@@ -0,0 +1,89 @@\n+{\n+    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\n+    \"contentVersion\": \"1.0.0.0\",\n+    \"parameters\": {\n+        \"baseName\": {\n+            \"type\": \"string\",\n+            \"defaultValue\": \"[resourceGroup().name]\",\n+            \"metadata\": {\n+                \"description\": \"THe base resource name.\"\n+            }\n+        },\n+        \"testApplicationOid\": {\n+            \"type\": \"String\",\n+            \"metadata\": {\n+                \"description\": \"The principal to assign the role to. This is application object id.\"\n+            }\n+        },\n+        \"tenantId\": {\n+            \"type\": \"String\",\n+            \"metadata\": {\n+                \"description\": \"The tenant ID to which the application and resources belong.\"\n+            }\n+        },\n+        \"testApplicationId\": {\n+            \"type\": \"String\",\n+            \"metadata\": {\n+                \"description\": \"The application client ID used to run tests.\"\n+            }\n+        },\n+        \"testApplicationSecret\": {\n+            \"type\": \"String\",\n+            \"metadata\": {\n+                \"description\": \"The application client secret used to run tests.\"\n+            }\n+        }\n+    },\n+    \"variables\": {\n+        \"taRoleId\": \"[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Authorization/roleDefinitions/a97b65f3-24c7-4388-baec-2e87135dc908')]\"\n+    },\n+    \"resources\": [\n+        {\n+            \"type\": \"Microsoft.Authorization/roleAssignments\",\n+            \"apiVersion\": \"2018-09-01-preview\",\n+            \"name\": \"[guid(concat(variables('taRoleId'), parameters('baseName')))]\",\n+            \"dependsOn\": [\n+                \"[parameters('baseName')]\"\n+            ],\n+            \"properties\": {\n+                \"principalId\": \"[parameters('testApplicationOid')]\",\n+                \"roleDefinitionId\": \"[variables('taRoleId')]\"\n+            }\n+        },\n+        {\n+            \"type\": \"Microsoft.CognitiveServices/accounts\",\n+            \"name\": \"[parameters('baseName')]\",\n+            \"apiVersion\": \"2017-04-18\",\n+            \"sku\": {\n+                \"name\": \"S\"\n+            },\n+            \"kind\": \"TextAnalytics\",\n+            \"location\": \"[resourceGroup().location]\",\n+            \"properties\": {\n+                \"customSubDomainName\": \"[parameters('baseName')]\"\n+            }\n+        }\n+    ],\n+    \"outputs\": {\n+        \"AZURE_TENANT_ID\": {\n+            \"type\": \"String\",\n+            \"value\": \"[parameters('tenantId')]\"\n+        },\n+        \"AZURE_CLIENT_ID\": {\n+            \"type\": \"String\",\n+            \"value\": \"[parameters('testApplicationId')]\"\n+        },\n+        \"AZURE_CLIENT_SECRET\": {\n+            \"type\": \"String\",\n+            \"value\": \"[parameters('testApplicationSecret')]\"\n+        },\n+        \"AZURE_TEXT_ANALYTICS_SUBSCRIPTION_KEY\": {\n+            \"type\": \"string\",\n+            \"value\": \"[listKeys(resourceId('Microsoft.CognitiveServices/accounts', parameters('baseName')), '2017-04-18').key1]\"\n+        },\n+        \"AZURE_TEXT_ANALYTICS_ENDPOINT\": {\n+            \"type\": \"string\",\n+            \"value\": \"[concat('https://', parameters('baseName'), '.cognitiveservices.azure.com/')]\"", "originalCommit": "cd3f33667a1813a399cc7f0dfb45f7f888da2452", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDQzODcyMA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7638#discussion_r374438720", "bodyText": "Use a variable for the API version so you don't have to use a string replace in the future for multiple places.", "author": "conniey", "createdAt": "2020-02-04T01:55:29Z", "path": "sdk/textanalytics/test-resources.json", "diffHunk": "@@ -0,0 +1,89 @@\n+{\n+    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\n+    \"contentVersion\": \"1.0.0.0\",\n+    \"parameters\": {\n+        \"baseName\": {\n+            \"type\": \"string\",\n+            \"defaultValue\": \"[resourceGroup().name]\",\n+            \"metadata\": {\n+                \"description\": \"THe base resource name.\"\n+            }\n+        },\n+        \"testApplicationOid\": {\n+            \"type\": \"String\",\n+            \"metadata\": {\n+                \"description\": \"The principal to assign the role to. This is application object id.\"\n+            }\n+        },\n+        \"tenantId\": {\n+            \"type\": \"String\",\n+            \"metadata\": {\n+                \"description\": \"The tenant ID to which the application and resources belong.\"\n+            }\n+        },\n+        \"testApplicationId\": {\n+            \"type\": \"String\",\n+            \"metadata\": {\n+                \"description\": \"The application client ID used to run tests.\"\n+            }\n+        },\n+        \"testApplicationSecret\": {\n+            \"type\": \"String\",\n+            \"metadata\": {\n+                \"description\": \"The application client secret used to run tests.\"\n+            }\n+        }\n+    },\n+    \"variables\": {\n+        \"taRoleId\": \"[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Authorization/roleDefinitions/a97b65f3-24c7-4388-baec-2e87135dc908')]\"\n+    },\n+    \"resources\": [\n+        {\n+            \"type\": \"Microsoft.Authorization/roleAssignments\",\n+            \"apiVersion\": \"2018-09-01-preview\",\n+            \"name\": \"[guid(concat(variables('taRoleId'), parameters('baseName')))]\",\n+            \"dependsOn\": [\n+                \"[parameters('baseName')]\"\n+            ],\n+            \"properties\": {\n+                \"principalId\": \"[parameters('testApplicationOid')]\",\n+                \"roleDefinitionId\": \"[variables('taRoleId')]\"\n+            }\n+        },\n+        {\n+            \"type\": \"Microsoft.CognitiveServices/accounts\",\n+            \"name\": \"[parameters('baseName')]\",\n+            \"apiVersion\": \"2017-04-18\",\n+            \"sku\": {\n+                \"name\": \"S\"\n+            },\n+            \"kind\": \"TextAnalytics\",\n+            \"location\": \"[resourceGroup().location]\",\n+            \"properties\": {\n+                \"customSubDomainName\": \"[parameters('baseName')]\"\n+            }\n+        }\n+    ],\n+    \"outputs\": {\n+        \"AZURE_TENANT_ID\": {\n+            \"type\": \"String\",\n+            \"value\": \"[parameters('tenantId')]\"\n+        },\n+        \"AZURE_CLIENT_ID\": {\n+            \"type\": \"String\",\n+            \"value\": \"[parameters('testApplicationId')]\"\n+        },\n+        \"AZURE_CLIENT_SECRET\": {\n+            \"type\": \"String\",\n+            \"value\": \"[parameters('testApplicationSecret')]\"\n+        },\n+        \"AZURE_TEXT_ANALYTICS_SUBSCRIPTION_KEY\": {\n+            \"type\": \"string\",\n+            \"value\": \"[listKeys(resourceId('Microsoft.CognitiveServices/accounts', parameters('baseName')), '2017-04-18').key1]\"", "originalCommit": "cd3f33667a1813a399cc7f0dfb45f7f888da2452", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "d8312d022525c0a0abf35c4d46382cb32af75634", "url": "https://github.com/Azure/azure-sdk-for-java/commit/d8312d022525c0a0abf35c4d46382cb32af75634", "message": "update with variables and params", "committedDate": "2020-02-04T19:00:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDg5Nzg1Nw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7638#discussion_r374897857", "bodyText": "Let's continue to use the tests.yml to handle loading these, no need to output these here.", "author": "alzimmermsft", "createdAt": "2020-02-04T20:13:12Z", "path": "sdk/textanalytics/test-resources.json", "diffHunk": "@@ -0,0 +1,96 @@\n+{\n+    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\n+    \"contentVersion\": \"1.0.0.0\",\n+    \"parameters\": {\n+        \"baseName\": {\n+            \"type\": \"string\",\n+            \"defaultValue\": \"[resourceGroup().name]\",\n+            \"metadata\": {\n+                \"description\": \"The base resource name.\"\n+            }\n+        },\n+        \"endpointSuffix\": {\n+            \"defaultValue\": \".cognitiveservices.azure.com/\",\n+            \"type\": \"String\"\n+        },\n+        \"testApplicationOid\": {\n+            \"type\": \"String\",\n+            \"metadata\": {\n+                \"description\": \"The principal to assign the role to. This is application object id.\"\n+            }\n+        },\n+        \"tenantId\": {\n+            \"type\": \"String\",\n+            \"metadata\": {\n+                \"description\": \"The tenant id to which the application and resources belong.\"\n+            }\n+        },\n+        \"testApplicationId\": {\n+            \"type\": \"String\",\n+            \"metadata\": {\n+                \"description\": \"The application client id used to run tests.\"\n+            }\n+        },\n+        \"testApplicationSecret\": {\n+            \"type\": \"String\",\n+            \"metadata\": {\n+                \"description\": \"The application client secret used to run tests.\"\n+            }\n+        }\n+    },\n+    \"variables\": {\n+        \"authorizationApiVersion\": \"2018-09-01-preview\",\n+        \"textAnalyticsApiVersion\": \"2017-04-18\",\n+        \"azureTextAnalyticsUrl\": \"[concat('https://', parameters('baseName'), parameters('endpointSuffix'))]\",\n+        \"cognitiveServiceUserRoleId\": \"[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Authorization/roleDefinitions/a97b65f3-24c7-4388-baec-2e87135dc908')]\"\n+    },\n+    \"resources\": [\n+        {\n+            \"type\": \"Microsoft.Authorization/roleAssignments\",\n+            \"apiVersion\": \"[variables('authorizationApiVersion')]\",\n+            \"name\": \"[guid(concat(variables('cognitiveServiceUserRoleId'), parameters('baseName')))]\",\n+            \"dependsOn\": [\n+                \"[parameters('baseName')]\"\n+            ],\n+            \"properties\": {\n+                \"principalId\": \"[parameters('testApplicationOid')]\",\n+                \"roleDefinitionId\": \"[variables('cognitiveServiceUserRoleId')]\"\n+            }\n+        },\n+        {\n+            \"type\": \"Microsoft.CognitiveServices/accounts\",\n+            \"name\": \"[parameters('baseName')]\",\n+            \"apiVersion\": \"[variables('textAnalyticsApiVersion')]\",\n+            \"sku\": {\n+                \"name\": \"S\"\n+            },\n+            \"kind\": \"TextAnalytics\",\n+            \"location\": \"[resourceGroup().location]\",\n+            \"properties\": {\n+                \"customSubDomainName\": \"[parameters('baseName')]\"\n+            }\n+        }\n+    ],\n+    \"outputs\": {\n+        \"AZURE_TENANT_ID\": {\n+            \"type\": \"String\",\n+            \"value\": \"[parameters('tenantId')]\"\n+        },\n+        \"AZURE_CLIENT_ID\": {\n+            \"type\": \"String\",\n+            \"value\": \"[parameters('testApplicationId')]\"\n+        },\n+        \"AZURE_CLIENT_SECRET\": {\n+            \"type\": \"String\",\n+            \"value\": \"[parameters('testApplicationSecret')]\"\n+        },", "originalCommit": "d8312d022525c0a0abf35c4d46382cb32af75634", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDkwMjY5MA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7638#discussion_r374902690", "bodyText": "I think the more recommended approach is to only maintain test variables in the tests-resources file as that can serve as a central place for all that info.\n@danieljurek Can add more context.", "author": "samvaity", "createdAt": "2020-02-04T20:23:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDg5Nzg1Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDkyMDg5Nw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7638#discussion_r374920897", "bodyText": "In the case of the variables being passed through the ARM template, this gives us one location to specify environment variables for a live test (compared with mixing environment variables defined in the ARM template and those defined in the tests.yml file).\nSince the ARM template is meant to be used with New-TestResources.ps1 it is more convenient for contributors to specify the environment variables in one place. The script outputs the set of environment variables needed to run tests and doesn't require the contributor to know to consult the tests.yml file.\nEither approach works but over time I've convinced myself that it makes sense to collect the environment variables in one place for the benefit of contributor experience.", "author": "danieljurek", "createdAt": "2020-02-04T21:02:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDg5Nzg1Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTA3MDUyMQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7638#discussion_r375070521", "bodyText": "As of now, I have used test-resources.json  to declare variables. Few other languages are also doing it. I think this is one think does not need to differ from other languages and have one common place for variables. So I will vote for keeping in this file.", "author": "hemanttanwar", "createdAt": "2020-02-05T05:52:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDg5Nzg1Nw=="}], "type": "inlineReview"}]}