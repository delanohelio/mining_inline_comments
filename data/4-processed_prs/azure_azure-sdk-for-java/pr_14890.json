{"pr_number": 14890, "pr_title": "mgmt, appservice redegisn", "pr_createdAt": "2020-09-08T04:45:06Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/14890", "timeline": [{"oid": "15f039f06922be6987f3b4a548058e5d1d8b3e55", "url": "https://github.com/Azure/azure-sdk-for-java/commit/15f039f06922be6987f3b4a548058e5d1d8b3e55", "message": "bump netty version", "committedDate": "2020-09-08T02:32:40Z", "type": "commit"}, {"oid": "2d4b7b3c71091a772fcc654680a38490cc20b7d5", "url": "https://github.com/Azure/azure-sdk-for-java/commit/2d4b7b3c71091a772fcc654680a38490cc20b7d5", "message": "add WebSiteBase", "committedDate": "2020-09-08T04:21:15Z", "type": "commit"}, {"oid": "978d0f3aed7c4a8c3ba87a249bf7f621148abe32", "url": "https://github.com/Azure/azure-sdk-for-java/commit/978d0f3aed7c4a8c3ba87a249bf7f621148abe32", "message": "redesign WebApps.List", "committedDate": "2020-09-08T04:44:15Z", "type": "commit"}, {"oid": "728dc019ebfaa40167315c773a8c48225d3f44e4", "url": "https://github.com/Azure/azure-sdk-for-java/commit/728dc019ebfaa40167315c773a8c48225d3f44e4", "message": "fix", "committedDate": "2020-09-08T04:48:50Z", "type": "commit"}, {"oid": "4b8ab5f2787f2866439bdfa24d13181699b580a6", "url": "https://github.com/Azure/azure-sdk-for-java/commit/4b8ab5f2787f2866439bdfa24d13181699b580a6", "message": "fix", "committedDate": "2020-09-08T04:50:29Z", "type": "commit"}, {"oid": "12a469d32c982c2587825509e47f6d06c1f20bd5", "url": "https://github.com/Azure/azure-sdk-for-java/commit/12a469d32c982c2587825509e47f6d06c1f20bd5", "message": "remove inProgressOperationId", "committedDate": "2020-09-08T04:55:58Z", "type": "commit"}, {"oid": "0bc97f633c5179b8d9f1cd44459ba19469251767", "url": "https://github.com/Azure/azure-sdk-for-java/commit/0bc97f633c5179b8d9f1cd44459ba19469251767", "message": "FunctionAppBasic", "committedDate": "2020-09-08T05:45:31Z", "type": "commit"}, {"oid": "2d9f3e493dd73d8c90a29c004748d2ce4bc29821", "url": "https://github.com/Azure/azure-sdk-for-java/commit/2d9f3e493dd73d8c90a29c004748d2ce4bc29821", "message": "fix tests", "committedDate": "2020-09-08T05:47:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDY2NDExNQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14890#discussion_r484664115", "bodyText": "Added to reduce duplicate code. Plan to move same code from a few other classes to use this as well.", "author": "weidongxu-microsoft", "createdAt": "2020-09-08T05:48:47Z", "path": "sdk/resourcemanager/azure-resourcemanager-resources/src/main/java/com/azure/resourcemanager/resources/fluentcore/arm/collection/implementation/BatchDeletionImpl.java", "diffHunk": "@@ -0,0 +1,37 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.resourcemanager.resources.fluentcore.arm.collection.implementation;\n+\n+import com.azure.resourcemanager.resources.fluentcore.arm.ResourceUtils;\n+import com.azure.resourcemanager.resources.fluentcore.utils.ReactorMapper;\n+import reactor.core.publisher.Flux;\n+import reactor.core.publisher.Mono;\n+\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.function.BiFunction;\n+\n+/**\n+ * Utility class for batch deletion.\n+ */\n+public class BatchDeletionImpl {\n+\n+    @SuppressWarnings({\"unchecked\", \"rawtypes\"})\n+    public static Flux<String> deleteByIdsAsync(Collection<String> ids,\n+                                                BiFunction<String, String, Mono<Void>> deleteByIdAsync) {\n+        if (ids == null || ids.isEmpty()) {\n+            return Flux.empty();\n+        }\n+\n+        Collection<Mono<String>> observables = new ArrayList<>();\n+        for (String id : ids) {\n+            final String resourceGroupName = ResourceUtils.groupFromResourceId(id);\n+            final String name = ResourceUtils.nameFromResourceId(id);\n+            Mono<String> o = ReactorMapper.map(deleteByIdAsync.apply(resourceGroupName, name), id);\n+            observables.add(o);\n+        }\n+\n+        return Flux.mergeDelayError(32, observables.toArray(new Mono[0]));\n+    }\n+}", "originalCommit": "2d9f3e493dd73d8c90a29c004748d2ce4bc29821", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDY3MDI1OA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14890#discussion_r484670258", "bodyText": "Why this property remains?", "author": "ChenTanyi", "createdAt": "2020-09-08T06:06:18Z", "path": "sdk/resourcemanager/azure-resourcemanager-appservice/src/main/java/com/azure/resourcemanager/appservice/implementation/WebAppBaseImpl.java", "diffHunk": "@@ -214,67 +215,44 @@ private void normalizeProperties() {\n         this.diagnosticLogsToUpdate = false;\n         this.sslBindingsToCreate = new TreeMap<>();\n         this.msiHandler = null;\n-        if (inner().hostNames() != null) {\n-            this.hostNamesSet = new HashSet<>(inner().hostNames());\n-        }\n-        if (inner().enabledHostNames() != null) {\n-            this.enabledHostNamesSet = new HashSet<>(inner().enabledHostNames());\n-        }\n-        if (inner().trafficManagerHostNames() != null) {\n-            this.trafficManagerHostNamesSet = new HashSet<>(inner().trafficManagerHostNames());\n-        }\n-        if (inner().outboundIpAddresses() != null) {\n-            this.outboundIPAddressesSet = new HashSet<>(Arrays.asList(inner().outboundIpAddresses().split(\",[ ]*\")));\n-        }\n-        this.hostNameSslStateMap = new HashMap<>();\n-        if (inner().hostnameSslStates() != null) {\n-            for (HostnameSslState hostNameSslState : inner().hostnameSslStates()) {\n-                // Server returns null sometimes, invalid on update, so we set default\n-                if (hostNameSslState.sslState() == null) {\n-                    hostNameSslState.withSslState(SslState.DISABLED);\n-                }\n-                hostNameSslStateMap.put(hostNameSslState.name(), hostNameSslState);\n-            }\n-        }\n+        this.webSiteBase = new WebSiteBaseImpl(inner());\n+        this.hostNameSslStateMap = new HashMap<>(this.webSiteBase.hostnameSslStates());", "originalCommit": "2d4b7b3c71091a772fcc654680a38490cc20b7d5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDY3NDg3Nw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14890#discussion_r484674877", "bodyText": "In Update flow, code changes the Map to add new items.", "author": "weidongxu-microsoft", "createdAt": "2020-09-08T06:18:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDY3MDI1OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDY3NTU3Mg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14890#discussion_r484675572", "bodyText": "Then should we just use it to save the update items?", "author": "ChenTanyi", "createdAt": "2020-09-08T06:19:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDY3MDI1OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDY3NjE0MQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14890#discussion_r484676141", "bodyText": "Yes. Hence I keep it there. I.e., WebSiteBase init the variable (instead of previous code in this method), then logic remains same as before.", "author": "weidongxu-microsoft", "createdAt": "2020-09-08T06:21:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDY3MDI1OA=="}], "type": "inlineReview"}, {"oid": "afa1567178d243e1bcbc8f85de19da62c4070565", "url": "https://github.com/Azure/azure-sdk-for-java/commit/afa1567178d243e1bcbc8f85de19da62c4070565", "message": "add test case for WebAppBasic", "committedDate": "2020-09-08T06:07:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDY3MTA1MA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14890#discussion_r484671050", "bodyText": "Flux.fromIterable().flatMapDelayError()", "author": "ChenTanyi", "createdAt": "2020-09-08T06:08:36Z", "path": "sdk/resourcemanager/azure-resourcemanager-appservice/src/main/java/com/azure/resourcemanager/appservice/implementation/WebAppsImpl.java", "diffHunk": "@@ -85,4 +103,61 @@ protected WebAppImpl wrapModel(SiteInner inner) {\n     public WebAppImpl define(String name) {\n         return wrapModel(name);\n     }\n+\n+    @Override\n+    @SuppressWarnings({\"unchecked\", \"rawtypes\"})\n+    public Flux<String> deleteByIdsAsync(Collection<String> ids) {\n+        if (ids == null || ids.isEmpty()) {\n+            return Flux.empty();\n+        }\n+\n+        Collection<Mono<String>> observables = new ArrayList<>();\n+        for (String id : ids) {\n+            final String resourceGroupName = ResourceUtils.groupFromResourceId(id);\n+            final String name = ResourceUtils.nameFromResourceId(id);\n+            Mono<String> o = ReactorMapper.map(this.inner().deleteAsync(resourceGroupName, name), id);\n+            observables.add(o);\n+        }\n+\n+        return Flux.mergeDelayError(32, observables.toArray(new Mono[0]));", "originalCommit": "978d0f3aed7c4a8c3ba87a249bf7f621148abe32", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDY3NjE5OA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14890#discussion_r484676198", "bodyText": "Done", "author": "weidongxu-microsoft", "createdAt": "2020-09-08T06:21:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDY3MTA1MA=="}], "type": "inlineReview"}, {"oid": "6b0b7237c47e06416aa92711c511f12335828d63", "url": "https://github.com/Azure/azure-sdk-for-java/commit/6b0b7237c47e06416aa92711c511f12335828d63", "message": "use flatMapDelayError", "committedDate": "2020-09-08T06:17:18Z", "type": "commit"}, {"oid": "4a846c1a302af15e14f1c8621ab4aa0e76c6ddc4", "url": "https://github.com/Azure/azure-sdk-for-java/commit/4a846c1a302af15e14f1c8621ab4aa0e76c6ddc4", "message": "let WebApp extends WebAppBasic", "committedDate": "2020-09-08T06:40:56Z", "type": "commit"}, {"oid": "f37714957b14f7b462efaac7f9a6dd076e44e2f8", "url": "https://github.com/Azure/azure-sdk-for-java/commit/f37714957b14f7b462efaac7f9a6dd076e44e2f8", "message": "Merge branch 'master' into mgmt_appservice-redegisn", "committedDate": "2020-09-08T06:51:36Z", "type": "commit"}, {"oid": "59b816567f42622f40a4cab19e8598db41537fb3", "url": "https://github.com/Azure/azure-sdk-for-java/commit/59b816567f42622f40a4cab19e8598db41537fb3", "message": "remove unused code", "committedDate": "2020-09-08T06:51:53Z", "type": "commit"}, {"oid": "3d48a59299d138a5948ef4a04736d2bc45d912be", "url": "https://github.com/Azure/azure-sdk-for-java/commit/3d48a59299d138a5948ef4a04736d2bc45d912be", "message": "add WebDeploymentSlotBasic and FunctionDeploymentSlotBasic", "committedDate": "2020-09-08T07:10:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDcwOTE5NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14890#discussion_r484709194", "bodyText": "I think the deleteByIdAsync should take one string id rather than two strings (some resource will need more).", "author": "ChenTanyi", "createdAt": "2020-09-08T07:31:09Z", "path": "sdk/resourcemanager/azure-resourcemanager-resources/src/main/java/com/azure/resourcemanager/resources/fluentcore/arm/collection/implementation/BatchDeletionImpl.java", "diffHunk": "@@ -17,21 +16,17 @@\n  */\n public class BatchDeletionImpl {\n \n-    @SuppressWarnings({\"unchecked\", \"rawtypes\"})\n     public static Flux<String> deleteByIdsAsync(Collection<String> ids,\n                                                 BiFunction<String, String, Mono<Void>> deleteByIdAsync) {\n         if (ids == null || ids.isEmpty()) {\n             return Flux.empty();\n+        } else {\n+            return Flux.fromIterable(ids)\n+                .flatMapDelayError(id -> {\n+                    final String resourceGroupName = ResourceUtils.groupFromResourceId(id);\n+                    final String name = ResourceUtils.nameFromResourceId(id);\n+                    return ReactorMapper.map(deleteByIdAsync.apply(resourceGroupName, name), id);", "originalCommit": "6b0b7237c47e06416aa92711c511f12335828d63", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDcxMzE4NQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14890#discussion_r484713185", "bodyText": "We can easily overload it with same name, and take Function<String, Mono<Void>> for this case (I actually wrote this signature first, then changed it since most case it is resourceGroupName+name).", "author": "weidongxu-microsoft", "createdAt": "2020-09-08T07:38:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDcwOTE5NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDcwOTIzNg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14890#discussion_r484709236", "bodyText": "For delete operations, do the users need Flux as return type?", "author": "xseeseesee", "createdAt": "2020-09-08T07:31:13Z", "path": "sdk/resourcemanager/azure-resourcemanager-appservice/src/main/java/com/azure/resourcemanager/appservice/implementation/FunctionAppsImpl.java", "diffHunk": "@@ -124,4 +134,48 @@ public FunctionAppImpl define(String name) {\n     public Mono<Void> deleteByResourceGroupAsync(String groupName, String name) {\n         return this.inner().deleteAsync(groupName, name);\n     }\n+\n+    @Override\n+    public Flux<String> deleteByIdsAsync(Collection<String> ids) {", "originalCommit": "4a846c1a302af15e14f1c8621ab4aa0e76c6ddc4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDcxMDg0MQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14890#discussion_r484710841", "bodyText": "I think this is a list of IDs that got deleted. As method with DelayError, error will be after Flux of IDs.", "author": "weidongxu-microsoft", "createdAt": "2020-09-08T07:34:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDcwOTIzNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDczNTYwOA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14890#discussion_r484735608", "bodyText": "Got it. So users would get IDs returned, which are success deletion, and errors if applicable returned after all completed.", "author": "xseeseesee", "createdAt": "2020-09-08T08:17:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDcwOTIzNg=="}], "type": "inlineReview"}, {"oid": "2488cd48f0d248b7b095efd38e6e1a10351300de", "url": "https://github.com/Azure/azure-sdk-for-java/commit/2488cd48f0d248b7b095efd38e6e1a10351300de", "message": "test and fix", "committedDate": "2020-09-08T08:13:00Z", "type": "commit"}, {"oid": "c84ece91a415071a3cf5a060b745b568a01e01f8", "url": "https://github.com/Azure/azure-sdk-for-java/commit/c84ece91a415071a3cf5a060b745b568a01e01f8", "message": "simplify FunctionRuntimeStack", "committedDate": "2020-09-08T08:23:50Z", "type": "commit"}, {"oid": "e09197f97594dc6976d6143a472d92e20cc7af44", "url": "https://github.com/Azure/azure-sdk-for-java/commit/e09197f97594dc6976d6143a472d92e20cc7af44", "message": "redact", "committedDate": "2020-09-08T08:24:39Z", "type": "commit"}, {"oid": "4d419ace111fe56e167b45faf15bae8394dbab6e", "url": "https://github.com/Azure/azure-sdk-for-java/commit/4d419ace111fe56e167b45faf15bae8394dbab6e", "message": "changelog", "committedDate": "2020-09-08T09:00:14Z", "type": "commit"}, {"oid": "b9960e90cbaf605779b1e38175288109f92d614c", "url": "https://github.com/Azure/azure-sdk-for-java/commit/b9960e90cbaf605779b1e38175288109f92d614c", "message": "spotbugs", "committedDate": "2020-09-08T09:11:23Z", "type": "commit"}, {"oid": "5e0aec543b4f7dd1045dd53a8199159c6e13ecfc", "url": "https://github.com/Azure/azure-sdk-for-java/commit/5e0aec543b4f7dd1045dd53a8199159c6e13ecfc", "message": "rename lambda function", "committedDate": "2020-09-09T05:34:45Z", "type": "commit"}, {"oid": "95a4853965ae3167ad671e7b604a3aef723bce17", "url": "https://github.com/Azure/azure-sdk-for-java/commit/95a4853965ae3167ad671e7b604a3aef723bce17", "message": "code reuse", "committedDate": "2020-09-09T05:41:14Z", "type": "commit"}, {"oid": "2db7e1b835ca90168964ae23a2c3171e5fa8becc", "url": "https://github.com/Azure/azure-sdk-for-java/commit/2db7e1b835ca90168964ae23a2c3171e5fa8becc", "message": "javadoc", "committedDate": "2020-09-09T05:41:20Z", "type": "commit"}, {"oid": "0e80c2531a94ab45e7512cc49b72371c046762b1", "url": "https://github.com/Azure/azure-sdk-for-java/commit/0e80c2531a94ab45e7512cc49b72371c046762b1", "message": "add test for batch flux", "committedDate": "2020-09-09T08:17:21Z", "type": "commit"}, {"oid": "2de39f365d9a44d3a312de9a457467960bedcb7f", "url": "https://github.com/Azure/azure-sdk-for-java/commit/2de39f365d9a44d3a312de9a457467960bedcb7f", "message": "delete ReactorMapper", "committedDate": "2020-09-09T09:19:35Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjE1NTgwMQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14890#discussion_r486155801", "bodyText": "just curious, why name it refresh on a get call?", "author": "yungezz", "createdAt": "2020-09-10T08:22:37Z", "path": "sdk/resourcemanager/azure-resourcemanager-appservice/src/main/java/com/azure/resourcemanager/appservice/implementation/FunctionAppBasicImpl.java", "diffHunk": "@@ -0,0 +1,36 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.resourcemanager.appservice.implementation;\n+\n+import com.azure.resourcemanager.appservice.AppServiceManager;\n+import com.azure.resourcemanager.appservice.fluent.inner.SiteInner;\n+import com.azure.resourcemanager.appservice.models.FunctionApp;\n+import com.azure.resourcemanager.appservice.models.FunctionAppBasic;\n+import com.azure.resourcemanager.resources.fluentcore.arm.models.HasManager;\n+import reactor.core.publisher.Mono;\n+\n+class FunctionAppBasicImpl extends WebSiteBaseImpl implements FunctionAppBasic, HasManager<AppServiceManager> {\n+\n+    private final AppServiceManager myManager;\n+\n+    FunctionAppBasicImpl(SiteInner innerObject, AppServiceManager myManager) {\n+        super(innerObject);\n+        this.myManager = myManager;\n+    }\n+\n+    @Override\n+    public FunctionApp refresh() {\n+        return this.refreshAsync().block();\n+    }\n+\n+    @Override\n+    public Mono<FunctionApp> refreshAsync() {", "originalCommit": "2de39f365d9a44d3a312de9a457467960bedcb7f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjcyMjAwMw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14890#discussion_r486722003", "bodyText": "To make it like other common resource instance, e.g.FunctionApp, which implement a Refreshable<FunctionApp> https://github.com/Azure/azure-sdk-for-java/blob/master/sdk/resourcemanager/azure-resourcemanager-resources/src/main/java/com/azure/resourcemanager/resources/fluentcore/model/Refreshable.java, which refresh() method updates itself and return a FunctionApp instance (actually just this).\nAnd here FunctionAppBasic has same refresh() method to update itself, and return a more complete FunctionApp instance.", "author": "weidongxu-microsoft", "createdAt": "2020-09-11T01:34:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjE1NTgwMQ=="}], "type": "inlineReview"}, {"oid": "92507c8451ada51ebda5b788a38163fb9c50d3b5", "url": "https://github.com/Azure/azure-sdk-for-java/commit/92507c8451ada51ebda5b788a38163fb9c50d3b5", "message": "refresh also refresh self", "committedDate": "2020-09-11T01:31:43Z", "type": "commit"}]}