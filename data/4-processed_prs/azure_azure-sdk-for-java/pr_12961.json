{"pr_number": 12961, "pr_title": "Partner release pipeline ", "pr_createdAt": "2020-07-09T06:23:55Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/12961", "timeline": [{"oid": "540fe982f5dc1cead3a0954e959f94c3e2f6e6ba", "url": "https://github.com/Azure/azure-sdk-for-java/commit/540fe982f5dc1cead3a0954e959f94c3e2f6e6ba", "message": "Empty pipeline definition for partner release pipeline.", "committedDate": "2020-07-08T04:33:11Z", "type": "commit"}, {"oid": "8fd727d57a7ce89e9145dba8a6566f484b15c417", "url": "https://github.com/Azure/azure-sdk-for-java/commit/8fd727d57a7ce89e9145dba8a6566f484b15c417", "message": "Seeing if code signing works.", "committedDate": "2020-07-08T05:18:46Z", "type": "commit"}, {"oid": "81b951a3175848240e52e2211112589a8f513a87", "url": "https://github.com/Azure/azure-sdk-for-java/commit/81b951a3175848240e52e2211112589a8f513a87", "message": "Tweak path.", "committedDate": "2020-07-08T05:21:41Z", "type": "commit"}, {"oid": "f6d9f8f1d53ae088c4332132a338ee5c4b34d961", "url": "https://github.com/Azure/azure-sdk-for-java/commit/f6d9f8f1d53ae088c4332132a338ee5c4b34d961", "message": "Tweak to absolute path.", "committedDate": "2020-07-08T05:24:27Z", "type": "commit"}, {"oid": "fccba7c34142b8d327b4734b64cd559a7f158c35", "url": "https://github.com/Azure/azure-sdk-for-java/commit/fccba7c34142b8d327b4734b64cd559a7f158c35", "message": "Setting up for test run.", "committedDate": "2020-07-08T06:11:19Z", "type": "commit"}, {"oid": "ba044dc1597fefb1464a7e19ea9b70b172bfeacc", "url": "https://github.com/Azure/azure-sdk-for-java/commit/ba044dc1597fefb1464a7e19ea9b70b172bfeacc", "message": "Removing hardcoded default that breaks filter logic.", "committedDate": "2020-07-08T06:18:40Z", "type": "commit"}, {"oid": "5587170453d45778915ba7821215ff6071362c99", "url": "https://github.com/Azure/azure-sdk-for-java/commit/5587170453d45778915ba7821215ff6071362c99", "message": "Add partner to list of options.", "committedDate": "2020-07-08T06:25:14Z", "type": "commit"}, {"oid": "152853f84b9017ebd02434094195b865781ecea4", "url": "https://github.com/Azure/azure-sdk-for-java/commit/152853f84b9017ebd02434094195b865781ecea4", "message": "Fix issue with using collection versus item in collection.", "committedDate": "2020-07-08T06:44:18Z", "type": "commit"}, {"oid": "5cf203dae783f0a276cb57e9689bf54bb2a66de9", "url": "https://github.com/Azure/azure-sdk-for-java/commit/5cf203dae783f0a276cb57e9689bf54bb2a66de9", "message": "Added TODO comment.", "committedDate": "2020-07-08T07:02:04Z", "type": "commit"}, {"oid": "1f9415066ed0c64ba7f89a296d84102cd2901113", "url": "https://github.com/Azure/azure-sdk-for-java/commit/1f9415066ed0c64ba7f89a296d84102cd2901113", "message": "Try stage parameters.", "committedDate": "2020-07-09T02:30:06Z", "type": "commit"}, {"oid": "7c396878b11b718afcaa3c049c1691797e0d3b04", "url": "https://github.com/Azure/azure-sdk-for-java/commit/7c396878b11b718afcaa3c049c1691797e0d3b04", "message": "Add quotes.", "committedDate": "2020-07-09T03:24:06Z", "type": "commit"}, {"oid": "87b1d74f9a27558d9e7fdcbf482a9317643de701", "url": "https://github.com/Azure/azure-sdk-for-java/commit/87b1d74f9a27558d9e7fdcbf482a9317643de701", "message": "Fix quotes.:", "committedDate": "2020-07-09T03:32:19Z", "type": "commit"}, {"oid": "911ca0d6dc99d5b6d666a22463b5085309696b8d", "url": "https://github.com/Azure/azure-sdk-for-java/commit/911ca0d6dc99d5b6d666a22463b5085309696b8d", "message": "Add output for stage only value, add upload.", "committedDate": "2020-07-09T05:21:00Z", "type": "commit"}, {"oid": "62af8df4ff99159863114540336d1236a3c5dc4f", "url": "https://github.com/Azure/azure-sdk-for-java/commit/62af8df4ff99159863114540336d1236a3c5dc4f", "message": "Try adding timeline records for better visibility.", "committedDate": "2020-07-09T05:52:31Z", "type": "commit"}, {"oid": "a81076414c3018241c29fe2b16e62532c05bc569", "url": "https://github.com/Azure/azure-sdk-for-java/commit/a81076414c3018241c29fe2b16e62532c05bc569", "message": "Remove log detail.", "committedDate": "2020-07-09T06:04:46Z", "type": "commit"}, {"oid": "7c8fe0fc00ada104b0959d045ccc98cf4fe2995e", "url": "https://github.com/Azure/azure-sdk-for-java/commit/7c8fe0fc00ada104b0959d045ccc98cf4fe2995e", "message": "Throw when no packages to publish.:", "committedDate": "2020-07-09T06:21:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTk5MDA2Nw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12961#discussion_r451990067", "bodyText": "These can be empty.", "author": "mitchdenny", "createdAt": "2020-07-09T06:25:05Z", "path": "eng/pipelines/templates/steps/java-publishing.yml", "diffHunk": "@@ -1,10 +1,11 @@\n parameters:\n   ArtifactDirectory: not-specified\n   RepositoryUrl: not-specified\n-  GroupID: not-specified\n-  ArtifactID: not-specified\n+  GroupID:", "originalCommit": "7c8fe0fc00ada104b0959d045ccc98cf4fe2995e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTk5MDU0MA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12961#discussion_r451990540", "bodyText": "Plumbed through a StageOnly property which effectively replaces ShouldPublish and AutoPromote from the old release pipelines. Now StageOnly simply controls whether we release the package.\nThought: Should we consider adding a separate job for the actual publish script which requires approval?", "author": "mitchdenny", "createdAt": "2020-07-09T06:26:18Z", "path": "eng/pipelines/templates/steps/java-publishing.yml", "diffHunk": "@@ -1,10 +1,11 @@\n parameters:\n   ArtifactDirectory: not-specified\n   RepositoryUrl: not-specified\n-  GroupID: not-specified\n-  ArtifactID: not-specified\n+  GroupID:\n+  ArtifactID:\n   BuildToolsPath: $(Pipeline.Workspace)/azure-sdk-build-tools\n   JavaRepoRoot: $(Pipeline.Workspace)/azure-sdk-for-java\n+  StageOnly: false", "originalCommit": "7c8fe0fc00ada104b0959d045ccc98cf4fe2995e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzcyODk3NQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12961#discussion_r457728975", "bodyText": "Should we consider adding a separate job for the actual publish script which requires approval?\n\nWe intentionally decided to not require approvals for the partner release pipelines to allow them to be self-serve. As long as they have access to queue a build the essentially have access/approval for releasing it.", "author": "weshaggard", "createdAt": "2020-07-20T22:33:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTk5MDU0MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc2MTk1Nw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12961#discussion_r457761957", "bodyText": "All good then!", "author": "mitchdenny", "createdAt": "2020-07-21T00:15:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTk5MDU0MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTk5MTA4OQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12961#discussion_r451991089", "bodyText": "Not sure about this. When used in our unified pipelines we pass along ArtifactId and GroupId filters, but that isn't necessarily in the partner release pipeline because we publish whatever is in the directory. This means that there are two quite distinct invocations of the template.", "author": "mitchdenny", "createdAt": "2020-07-09T06:27:48Z", "path": "eng/pipelines/templates/steps/java-publishing.yml", "diffHunk": "@@ -74,3 +75,19 @@ steps:\n           -RepositoryPassword $(azuresdk-sonatype-password)\n           -GPGExecutablePath ${{ parameters.BuildToolsPath }}/tools/gpg/bin/gpg.exe\n           -InformationAction Continue\n+\n+  - ${{if eq(parameters.Target, 'MavenCentralPartner')}}:", "originalCommit": "7c8fe0fc00ada104b0959d045ccc98cf4fe2995e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzcyOTUyNg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12961#discussion_r457729526", "bodyText": "If possible we should only have MavenCentral and have the partner release pipeline pass in the correct wildcards to publish all.", "author": "weshaggard", "createdAt": "2020-07-20T22:34:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTk5MTA4OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc2ODA5OQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12961#discussion_r457768099", "bodyText": "OK, the way I approached this was to collapse both invocations in under MavenCentral but to use one invocation or the other based on the artifact ID or group ID parameters. Once inside the script I largely avoid wildcards after I've done the parse of POM files to avoid accidentally picking up artifacts that I don't want.", "author": "mitchdenny", "createdAt": "2020-07-21T00:37:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTk5MTA4OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTk5MTIxMA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12961#discussion_r451991210", "bodyText": "Making it so that no packages == an error.", "author": "mitchdenny", "createdAt": "2020-07-09T06:28:08Z", "path": "eng/scripts/Publish-MavenPackages.ps1", "diffHunk": "@@ -187,13 +187,18 @@ Write-Information \"Repository Password is: [redacted]\"\n Write-Information \"GPG Executable Path is: $GPGExecutablePath\"\n Write-Information \"Group ID Filter is: $GroupIDFilter\"\n Write-Information \"Artifact ID Filter is: $ArtifactIDFilter\"\n+Write-Information \"Stage Only is: $StageOnly\"\n \n Write-Information \"Getting filtered package details.\"\n $packageDetails = Get-FilteredMavenPackageDetails -ArtifactDirectory $ArtifactDirectory -GroupIDFilter $GroupIDFilter -ArtifactIDFilter $ArtifactIDFilter\n \n Write-Host \"Found $($packageDetails.Length) packages to publish:\"\n $packageDetails | % { Write-Host $_.FullyQualifiedName }\n \n+if ($packageDetails.Length -eq 0) {\n+  throw \"Aborting, no packages to publish.\"", "originalCommit": "7c8fe0fc00ada104b0959d045ccc98cf4fe2995e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTk5MTU2MA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12961#discussion_r451991560", "bodyText": "This bug always existed, but we didn't catch it because PowerShell coerces a single element array into the same thing as an instance of the array element. Several moments of head scratching occurred when I first saw this bug in action.", "author": "mitchdenny", "createdAt": "2020-07-09T06:29:09Z", "path": "eng/scripts/Publish-MavenPackages.ps1", "diffHunk": "@@ -293,7 +298,7 @@ foreach ($packageDetail in $packageDetails) {\n     mvn org.sonatype.plugins:nexus-staging-maven-plugin:deploy-staged-repository \"--batch-mode\" \"-DnexusUrl=https://oss.sonatype.org\" \"$repositoryDirectoryOption\" \"$stagingProfileIdOption\" \"$stagingDescriptionOption\" \"-DrepositoryId=target-repo\" \"-DserverId=target-repo\" \"-Drepo.username=$RepositoryUsername\" \"-Drepo.password=\"\"$RepositoryPassword\"\"\" \"--settings=$PSScriptRoot\\..\\maven.publish.settings.xml\"\n \n     Write-Information \"Reading staging properties.\"\n-    $stagedRepositoryProperties = ConvertFrom-StringData (Get-Content \"$localRepositoryDirectory\\$($packageDetails.SonaTypeProfileID).properties\" -Raw)\n+    $stagedRepositoryProperties = ConvertFrom-StringData (Get-Content \"$localRepositoryDirectory\\$($packageDetail.SonaTypeProfileID).properties\" -Raw)", "originalCommit": "7c8fe0fc00ada104b0959d045ccc98cf4fe2995e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTk5MTY4Ng==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12961#discussion_r451991686", "bodyText": "This will be commented back in once we are 100% happy with everything.", "author": "mitchdenny", "createdAt": "2020-07-09T06:29:32Z", "path": "eng/scripts/Publish-MavenPackages.ps1", "diffHunk": "@@ -307,11 +312,12 @@ foreach ($packageDetail in $packageDetails) {\n     else {\n       Write-Information \"Releasing staging repostiory $stagedRepositoryId\"\n       Write-Information \"mvn org.sonatype.plugins:nexus-staging-maven-plugin:rc-release `\"-DstagingRepositoryId=$stagedRepositoryId`\" `\"-DnexusUrl=https://oss.sonatype.org`\" `\"-DrepositoryId=target-repo`\" `\"-DserverId=target-repo`\" `\"-Drepo.username=$RepositoryUsername`\" `\"-Drepo.password=`\"`\"$RepositoryPassword`\"`\"`\" `\"--settings=$PSScriptRoot\\..\\maven.publish.settings.xml`\"\"\n-      mvn org.sonatype.plugins:nexus-staging-maven-plugin:rc-release \"-DstagingRepositoryId=$stagedRepositoryId\" \"-DnexusUrl=https://oss.sonatype.org\" \"-DrepositoryId=target-repo\" \"-DserverId=target-repo\" \"-Drepo.username=$RepositoryUsername\" \"-Drepo.password=\"\"$RepositoryPassword\"\"\" \"--settings=$PSScriptRoot\\..\\maven.publish.settings.xml\"\n+      # TODO: Remove when tested has been completed end-to-end. This final step simply\n+      #       closes the staging repo and makes it visible in Maven Central.\n+      #mvn org.sonatype.plugins:nexus-staging-maven-plugin:rc-release \"-DstagingRepositoryId=$stagedRepositoryId\" \"-DnexusUrl=https://oss.sonatype.org\" \"-DrepositoryId=target-repo\" \"-DserverId=target-repo\" \"-Drepo.username=$RepositoryUsername\" \"-Drepo.password=\"\"$RepositoryPassword\"\"\" \"--settings=$PSScriptRoot\\..\\maven.publish.settings.xml\"", "originalCommit": "7c8fe0fc00ada104b0959d045ccc98cf4fe2995e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ0MjgzNA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12961#discussion_r458442834", "bodyText": "Don't forget to uncomment this before merging.", "author": "weshaggard", "createdAt": "2020-07-21T23:17:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTk5MTY4Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ3NDA2Nw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12961#discussion_r458474067", "bodyText": "Will do. I'm giving an internal team an opportunity to give me an updated set of artifacts for a test run before I open that safety.", "author": "mitchdenny", "createdAt": "2020-07-22T01:04:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTk5MTY4Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzcyNzgzMg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12961#discussion_r457727832", "bodyText": "Lets use windows-2019 here. I'd like us to be in control of when we move the image forward so we can at least test it.", "author": "weshaggard", "createdAt": "2020-07-20T22:30:07Z", "path": "eng/pipelines/partner-release.yml", "diffHunk": "@@ -0,0 +1,46 @@\n+trigger: none\n+pr: none\n+\n+resources:\n+  repositories:\n+    - repository: azure-sdk-build-tools\n+      type: git\n+      name: internal/azure-sdk-build-tools\n+      ref: refs/tags/azure-sdk-build-tools_20200618.4\n+\n+variables:\n+  BuildToolScripts: $(Pipeline.Workspace)/azure-sdk-build-tools/scripts\n+  Artifacts: $(Pipeline.Workspace)/artifacts\n+\n+pool:\n+  vmImage: 'windows-latest'", "originalCommit": "7c8fe0fc00ada104b0959d045ccc98cf4fe2995e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzcyOTY2Mw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12961#discussion_r457729663", "bodyText": "Why is the parse needed?", "author": "weshaggard", "createdAt": "2020-07-20T22:35:00Z", "path": "eng/pipelines/templates/steps/java-publishing.yml", "diffHunk": "@@ -74,3 +75,19 @@ steps:\n           -RepositoryPassword $(azuresdk-sonatype-password)\n           -GPGExecutablePath ${{ parameters.BuildToolsPath }}/tools/gpg/bin/gpg.exe\n           -InformationAction Continue\n+\n+  - ${{if eq(parameters.Target, 'MavenCentralPartner')}}:\n+    - task: PowerShell@2\n+      displayName: 'Publish to Maven Central'\n+      inputs:\n+        pwsh: true\n+        workingDirectory: $(Agent.BuildDirectory)\n+        filePath: ${{ parameters.JavaRepoRoot }}/eng/scripts/Publish-MavenPackages.ps1\n+        arguments: >\n+          -ArtifactDirectory ${{ parameters.ArtifactDirectory }}\n+          -RepositoryUrl https://oss.sonatype.org/service/local/staging/deploy/maven2/\n+          -RepositoryUsername azuresdk\n+          -RepositoryPassword $(azuresdk-sonatype-password)\n+          -GPGExecutablePath ${{ parameters.BuildToolsPath }}/tools/gpg/bin/gpg.exe\n+          -InformationAction Continue\n+          -StageOnly:$([bool]::Parse('$(StageOnly)'))", "originalCommit": "7c8fe0fc00ada104b0959d045ccc98cf4fe2995e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzczMDE1NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12961#discussion_r457730154", "bodyText": "Oh because PS requires the $. I think we fixed this in other places by doing -StageOnly:$$(StageOnly)", "author": "weshaggard", "createdAt": "2020-07-20T22:36:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzcyOTY2Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzczNDU1OA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12961#discussion_r457734558", "bodyText": "What about snapshot support? I know a number of partners rely on publishing those.", "author": "weshaggard", "createdAt": "2020-07-20T22:48:26Z", "path": "eng/scripts/Publish-MavenPackages.ps1", "diffHunk": "@@ -187,13 +187,18 @@ Write-Information \"Repository Password is: [redacted]\"\n Write-Information \"GPG Executable Path is: $GPGExecutablePath\"\n Write-Information \"Group ID Filter is: $GroupIDFilter\"\n Write-Information \"Artifact ID Filter is: $ArtifactIDFilter\"\n+Write-Information \"Stage Only is: $StageOnly\"", "originalCommit": "7c8fe0fc00ada104b0959d045ccc98cf4fe2995e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc2NTU2Ng==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12961#discussion_r457765566", "bodyText": "I'll probably cover this with a separate PR (we can run both pipelines side by side for a bit). The snapshot publishing process is quite a bit different and will take more time to validate, and I want to make sure this pipeline is ready for the team that needs it for Android publishing.", "author": "mitchdenny", "createdAt": "2020-07-21T00:28:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzczNDU1OA=="}], "type": "inlineReview"}, {"oid": "a607700df600a51ad388278e9ac401771759d553", "url": "https://github.com/Azure/azure-sdk-for-java/commit/a607700df600a51ad388278e9ac401771759d553", "message": "Pin windows version for pipeline.", "committedDate": "2020-07-21T00:19:02Z", "type": "commit"}, {"oid": "b753a7d30d6ea611803e881766ba05af06911202", "url": "https://github.com/Azure/azure-sdk-for-java/commit/b753a7d30d6ea611803e881766ba05af06911202", "message": "Simplify StageOnly expression.", "committedDate": "2020-07-21T00:20:15Z", "type": "commit"}, {"oid": "e851794791d1ff0d17a8ad5312227ffa77ce46dd", "url": "https://github.com/Azure/azure-sdk-for-java/commit/e851794791d1ff0d17a8ad5312227ffa77ce46dd", "message": "Switch invocation based on template parameters.", "committedDate": "2020-07-21T00:36:27Z", "type": "commit"}, {"oid": "213d1393a06168e17447d53266fc82e35f2a78dc", "url": "https://github.com/Azure/azure-sdk-for-java/commit/213d1393a06168e17447d53266fc82e35f2a78dc", "message": "Switch to ne(...,...) expression.", "committedDate": "2020-07-21T00:49:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ0MjE2Mw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12961#discussion_r458442163", "bodyText": "As best I can tell no harm comes if you pass empty values for these into your script so why not just always call these? It also won't hurt to always pass StageOnly parameter. Unless I missed something I think all the other arguments are the same.", "author": "weshaggard", "createdAt": "2020-07-21T23:15:17Z", "path": "eng/pipelines/templates/steps/java-publishing.yml", "diffHunk": "@@ -59,18 +60,40 @@ steps:\n           -InformationAction Continue\n \n   - ${{if eq(parameters.Target, 'MavenCentral')}}:\n-    - task: PowerShell@2\n-      displayName: 'Publish to Maven Central'\n-      inputs:\n-        pwsh: true\n-        workingDirectory: $(Agent.BuildDirectory)\n-        filePath: ${{ parameters.JavaRepoRoot }}/eng/scripts/Publish-MavenPackages.ps1\n-        arguments: >\n-          -ArtifactDirectory ${{ parameters.ArtifactDirectory }}\n-          -GroupIDFilter ${{ parameters.GroupID }}\n-          -ArtifactIDFilter ${{ parameters.ArtifactID }}\n-          -RepositoryUrl https://oss.sonatype.org/service/local/staging/deploy/maven2/\n-          -RepositoryUsername azuresdk\n-          -RepositoryPassword $(azuresdk-sonatype-password)\n-          -GPGExecutablePath ${{ parameters.BuildToolsPath }}/tools/gpg/bin/gpg.exe\n-          -InformationAction Continue\n+\n+    # Invoke this way if we are publishing a specific artifact (usually used from\n+    # within universal pipelines).\n+    - ${{if and(ne(parameters.GroupID, ''),ne(parameters.ArtifactID, ''))}}:\n+      - task: PowerShell@2\n+        displayName: 'Publish to Maven Central'\n+        inputs:\n+          pwsh: true\n+          workingDirectory: $(Agent.BuildDirectory)\n+          filePath: ${{ parameters.JavaRepoRoot }}/eng/scripts/Publish-MavenPackages.ps1\n+          arguments: >\n+            -ArtifactDirectory ${{ parameters.ArtifactDirectory }}\n+            -GroupIDFilter ${{ parameters.GroupID }}", "originalCommit": "213d1393a06168e17447d53266fc82e35f2a78dc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "c99fece044b4a87ef62317f2e509a66e942b9b73", "url": "https://github.com/Azure/azure-sdk-for-java/commit/c99fece044b4a87ef62317f2e509a66e942b9b73", "message": "Collapse invocations further.", "committedDate": "2020-07-21T23:39:02Z", "type": "commit"}, {"oid": "b062472c0ee7e5dc47420114d3c4072f6eaad10b", "url": "https://github.com/Azure/azure-sdk-for-java/commit/b062472c0ee7e5dc47420114d3c4072f6eaad10b", "message": "Allow null values.", "committedDate": "2020-07-21T23:49:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ1Mzg3MQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12961#discussion_r458453871", "bodyText": "You may need to put quotes around  -GroupIDFilter \"${{ parameters.GroupID }}\" in order for PS to accept the empty string.", "author": "weshaggard", "createdAt": "2020-07-21T23:52:27Z", "path": "eng/pipelines/templates/steps/java-publishing.yml", "diffHunk": "@@ -73,4 +74,5 @@ steps:\n           -RepositoryUsername azuresdk", "originalCommit": "b062472c0ee7e5dc47420114d3c4072f6eaad10b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ1NDU1OA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12961#discussion_r458454558", "bodyText": "Trying decorating with an attribute to allow nulls, but will try this afterwards if that doesn't work.", "author": "mitchdenny", "createdAt": "2020-07-21T23:54:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ1Mzg3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ2MDM3Mw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12961#discussion_r458460373", "bodyText": "OK I think we're good.", "author": "mitchdenny", "createdAt": "2020-07-22T00:14:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ1Mzg3MQ=="}], "type": "inlineReview"}, {"oid": "b9418e7c4062957ed38c5d2e9483faadb46c366a", "url": "https://github.com/Azure/azure-sdk-for-java/commit/b9418e7c4062957ed38c5d2e9483faadb46c366a", "message": "Pass in empty string.", "committedDate": "2020-07-22T00:04:35Z", "type": "commit"}, {"oid": "48fe591d050ce82b82bf203ffe2e106460627061", "url": "https://github.com/Azure/azure-sdk-for-java/commit/48fe591d050ce82b82bf203ffe2e106460627061", "message": "Uncomment the rc-release goal. Phasers are no longer set to stun.", "committedDate": "2020-07-23T02:46:38Z", "type": "commit"}]}