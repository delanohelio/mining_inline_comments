{"pr_number": 10735, "pr_title": "Add JUnit Based Test Parallelization", "pr_createdAt": "2020-05-05T21:44:58Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/10735", "timeline": [{"oid": "88aeeaabf3ce01e7accd533e0424987506b742a4", "url": "https://github.com/Azure/azure-sdk-for-java/commit/88aeeaabf3ce01e7accd533e0424987506b742a4", "message": "Update JUnit version and add flags for parallelization", "committedDate": "2020-05-05T21:43:34Z", "type": "commit"}, {"oid": "f17dc14a91836e935df4ecfacf2ed8ae5210e13b", "url": "https://github.com/Azure/azure-sdk-for-java/commit/f17dc14a91836e935df4ecfacf2ed8ae5210e13b", "message": "Update other external JUnit versions, fixed azure-core-test issue, added flag in test run", "committedDate": "2020-05-05T22:38:51Z", "type": "commit"}, {"oid": "569a9fd906c6b88bee188a6d341aed231cd042ac", "url": "https://github.com/Azure/azure-sdk-for-java/commit/569a9fd906c6b88bee188a6d341aed231cd042ac", "message": "Update parallelization to be full parallel, updated modules without thread safe tests to use non-parallel", "committedDate": "2020-05-05T23:22:08Z", "type": "commit"}, {"oid": "c9e7445feb8985d511a9b93eae9de785199b8eae", "url": "https://github.com/Azure/azure-sdk-for-java/commit/c9e7445feb8985d511a9b93eae9de785199b8eae", "message": "Guard azure-core-test add exports to Java 11+", "committedDate": "2020-05-05T23:41:09Z", "type": "commit"}, {"oid": "66e108e6279a5e99be39bca89f9c363d8eeaf332", "url": "https://github.com/Azure/azure-sdk-for-java/commit/66e108e6279a5e99be39bca89f9c363d8eeaf332", "message": "Disable test parallelization in Search, updated JUnit parameter passing to use new XML node", "committedDate": "2020-05-06T01:01:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDQ5NTMwMg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10735#discussion_r420495302", "bodyText": "Does it affect live tests? Why search is disabled?", "author": "sima-zhu", "createdAt": "2020-05-06T01:10:06Z", "path": "sdk/search/azure-search-documents/pom.xml", "diffHunk": "@@ -149,5 +149,28 @@\n         </plugins>\n       </build>\n     </profile>\n+\n+    <profile>\n+      <id>parallel-test-playback</id>\n+      <activation>\n+        <property>\n+          <name>parallel-test-playback</name>\n+        </property>\n+      </activation>\n+      <build>\n+        <plugins>\n+          <plugin>\n+            <groupId>org.apache.maven.plugins</groupId>\n+            <artifactId>maven-surefire-plugin</artifactId>\n+            <version>3.0.0-M3</version> <!-- {x-version-update;org.apache.maven.plugins:maven-surefire-plugin;external_dependency} -->\n+            <configuration>\n+              <systemPropertyVariables>", "originalCommit": "66e108e6279a5e99be39bca89f9c363d8eeaf332", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDkyODAwNw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10735#discussion_r420928007", "bodyText": "When using the host agent parallel runs will only happen in PR validation, so this won't affect live tests. I updated the PR description to explain that this was done since playback is much safer to parallelize without an in-depth investigation due to the locality of testing resources, if you want to you could run tests in parallel locally against the service.\nParallel tests for Search has been disabled as there is some testing global state that doesn't play well with parallelization and causes intermittent test failures, I added a comment into the POM stating this.", "author": "alzimmermsft", "createdAt": "2020-05-06T16:31:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDQ5NTMwMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDQ5NjYxMQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10735#discussion_r420496611", "bodyText": "If you are going to disable parallel execution, please include a comment about why this was deemed necessary.", "author": "JonathanGiles", "createdAt": "2020-05-06T01:15:42Z", "path": "sdk/eventhubs/azure-messaging-eventhubs/pom.xml", "diffHunk": "@@ -89,4 +89,29 @@\n       <scope>test</scope>\n     </dependency>\n   </dependencies>\n+\n+  <profiles>\n+    <profile>\n+      <id>parallel-test-playback</id>\n+      <activation>\n+        <property>\n+          <name>parallel-test-playback</name>\n+        </property>\n+      </activation>\n+      <build>\n+        <plugins>\n+          <plugin>\n+            <groupId>org.apache.maven.plugins</groupId>\n+            <artifactId>maven-surefire-plugin</artifactId>\n+            <version>3.0.0-M3</version> <!-- {x-version-update;org.apache.maven.plugins:maven-surefire-plugin;external_dependency} -->\n+            <configuration>\n+              <systemPropertyVariables>\n+                <junit.jupiter.execution.parallel.enabled>false</junit.jupiter.execution.parallel.enabled>", "originalCommit": "66e108e6279a5e99be39bca89f9c363d8eeaf332", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDkyNDQyMg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10735#discussion_r420924422", "bodyText": "Comment added", "author": "alzimmermsft", "createdAt": "2020-05-06T16:26:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDQ5NjYxMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDQ5Njg4Mw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10735#discussion_r420496883", "bodyText": "Same here", "author": "JonathanGiles", "createdAt": "2020-05-06T01:16:43Z", "path": "sdk/search/azure-search-documents/pom.xml", "diffHunk": "@@ -149,5 +149,28 @@\n         </plugins>\n       </build>\n     </profile>\n+\n+    <profile>\n+      <id>parallel-test-playback</id>\n+      <activation>\n+        <property>\n+          <name>parallel-test-playback</name>\n+        </property>\n+      </activation>\n+      <build>\n+        <plugins>\n+          <plugin>\n+            <groupId>org.apache.maven.plugins</groupId>\n+            <artifactId>maven-surefire-plugin</artifactId>\n+            <version>3.0.0-M3</version> <!-- {x-version-update;org.apache.maven.plugins:maven-surefire-plugin;external_dependency} -->\n+            <configuration>\n+              <systemPropertyVariables>\n+                <junit.jupiter.execution.parallel.enabled>false</junit.jupiter.execution.parallel.enabled>", "originalCommit": "66e108e6279a5e99be39bca89f9c363d8eeaf332", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDkyNDMxMA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10735#discussion_r420924310", "bodyText": "Comment added", "author": "alzimmermsft", "createdAt": "2020-05-06T16:25:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDQ5Njg4Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDQ5Njk0Mw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10735#discussion_r420496943", "bodyText": "And here...", "author": "JonathanGiles", "createdAt": "2020-05-06T01:16:55Z", "path": "sdk/servicebus/azure-messaging-servicebus/pom.xml", "diffHunk": "@@ -88,4 +88,28 @@\n     </dependency>\n   </dependencies>\n \n+  <profiles>\n+    <profile>\n+      <id>parallel-test-playback</id>\n+      <activation>\n+        <property>\n+          <name>parallel-test-playback</name>\n+        </property>\n+      </activation>\n+      <build>\n+        <plugins>\n+          <plugin>\n+            <groupId>org.apache.maven.plugins</groupId>\n+            <artifactId>maven-surefire-plugin</artifactId>\n+            <version>3.0.0-M3</version> <!-- {x-version-update;org.apache.maven.plugins:maven-surefire-plugin;external_dependency} -->\n+            <configuration>\n+              <systemPropertyVariables>\n+                <junit.jupiter.execution.parallel.enabled>false</junit.jupiter.execution.parallel.enabled>", "originalCommit": "66e108e6279a5e99be39bca89f9c363d8eeaf332", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDkyNDI0Mg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10735#discussion_r420924242", "bodyText": "Comment added", "author": "alzimmermsft", "createdAt": "2020-05-06T16:25:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDQ5Njk0Mw=="}], "type": "inlineReview"}, {"oid": "33fbd853eb81ce5a56dff1a0cb825ffe07f5b61e", "url": "https://github.com/Azure/azure-sdk-for-java/commit/33fbd853eb81ce5a56dff1a0cb825ffe07f5b61e", "message": "Add explanations for disabled parallel test runs in certain modules", "committedDate": "2020-05-06T16:25:05Z", "type": "commit"}, {"oid": "ba86088396c160dbe91fbec5009999ef86994b16", "url": "https://github.com/Azure/azure-sdk-for-java/commit/ba86088396c160dbe91fbec5009999ef86994b16", "message": "Merge branch 'master' into AzTest_ParallelPlayback", "committedDate": "2020-05-11T20:13:36Z", "type": "commit"}, {"oid": "f380ee90e65759b1dd39cb25d9cc4ba9d6314b84", "url": "https://github.com/Azure/azure-sdk-for-java/commit/f380ee90e65759b1dd39cb25d9cc4ba9d6314b84", "message": "Update new version numbers since last commit", "committedDate": "2020-05-11T20:31:41Z", "type": "commit"}, {"oid": "f892e83e6e3f0ed45e94449df88dae36c74452c0", "url": "https://github.com/Azure/azure-sdk-for-java/commit/f892e83e6e3f0ed45e94449df88dae36c74452c0", "message": "Add resource locks for tests mutating System.out", "committedDate": "2020-05-11T21:31:57Z", "type": "commit"}, {"oid": "f87418aaccb526de8078eccd90f726039032b7e5", "url": "https://github.com/Azure/azure-sdk-for-java/commit/f87418aaccb526de8078eccd90f726039032b7e5", "message": "Merge branch 'master' into AzTest_ParallelPlayback", "committedDate": "2020-05-11T22:46:34Z", "type": "commit"}, {"oid": "6c65d3db6bfade3f0a7fe39c9a0f1243091db30c", "url": "https://github.com/Azure/azure-sdk-for-java/commit/6c65d3db6bfade3f0a7fe39c9a0f1243091db30c", "message": "Remove invalid import", "committedDate": "2020-05-11T22:47:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzM3MjYxNA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10735#discussion_r423372614", "bodyText": "This was the invalid import, re-order on save happened.", "author": "alzimmermsft", "createdAt": "2020-05-11T23:16:26Z", "path": "sdk/cosmos/azure-cosmos/src/test/java/com/azure/cosmos/rx/TestSuiteBase.java", "diffHunk": "@@ -3,36 +3,43 @@\n package com.azure.cosmos.rx;\n \n import com.azure.cosmos.BridgeInternal;\n-import com.azure.cosmos.implementation.Resource;\n-import com.azure.cosmos.models.CompositePath;\n-import com.azure.cosmos.models.CompositePathSortOrder;\n import com.azure.cosmos.ConnectionMode;\n import com.azure.cosmos.ConnectionPolicy;\n import com.azure.cosmos.ConsistencyLevel;\n import com.azure.cosmos.CosmosAsyncClient;\n import com.azure.cosmos.CosmosAsyncClientTest;\n import com.azure.cosmos.CosmosAsyncContainer;\n import com.azure.cosmos.CosmosAsyncDatabase;\n-import com.azure.cosmos.models.CosmosAsyncDatabaseResponse;\n-import com.azure.cosmos.models.CosmosAsyncItemResponse;\n import com.azure.cosmos.CosmosAsyncUser;\n import com.azure.cosmos.CosmosBridgeInternal;\n import com.azure.cosmos.CosmosClient;\n import com.azure.cosmos.CosmosClientBuilder;\n import com.azure.cosmos.CosmosClientException;\n-import com.azure.cosmos.models.CosmosContainerProperties;\n-import com.azure.cosmos.models.CosmosContainerRequestOptions;\n-import com.azure.cosmos.models.JsonSerializable;", "originalCommit": "6c65d3db6bfade3f0a7fe39c9a0f1243091db30c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "454aae4c15e70cccf9777b21ca0b57991151a341", "url": "https://github.com/Azure/azure-sdk-for-java/commit/454aae4c15e70cccf9777b21ca0b57991151a341", "message": "Merged in master", "committedDate": "2020-05-13T17:04:56Z", "type": "commit"}]}