{"pr_number": 9144, "pr_title": "Add Release Infrastructure for BOMs", "pr_createdAt": "2020-03-17T00:17:46Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/9144", "timeline": [{"oid": "f3194bc5efafc861680f119b1c7558222463a7ce", "url": "https://github.com/Azure/azure-sdk-for-java/commit/f3194bc5efafc861680f119b1c7558222463a7ce", "message": "Added archetypes for BOMs", "committedDate": "2020-03-17T00:17:07Z", "type": "commit"}, {"oid": "bfcfca289ffea58ef4db986240249734f140ca43", "url": "https://github.com/Azure/azure-sdk-for-java/commit/bfcfca289ffea58ef4db986240249734f140ca43", "message": "Standardize BOM build configuration with normal client configuration", "committedDate": "2020-03-17T00:31:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzQ0NjQyOA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9144#discussion_r393446428", "bodyText": "nit: this can be removed.", "author": "srnagar", "createdAt": "2020-03-17T05:03:06Z", "path": "sdk/boms/pom.service.xml", "diffHunk": "@@ -0,0 +1,16 @@\n+<!-- Copyright (c) Microsoft Corporation. All rights reserved.\n+     Licensed under the MIT License. -->\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+  <modelVersion>4.0.0</modelVersion>\n+  <groupId>com.azure</groupId>\n+  <artifactId>azure-boms</artifactId>\n+  <packaging>pom</packaging>\n+  <version>1.0.0</version><!-- Need not change for every release-->\n+  <modules>\n+    <!-- NOTE: Commenting out because we should now be binary composed.\n+    -->", "originalCommit": "bfcfca289ffea58ef4db986240249734f140ca43", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzkwOTY5OA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9144#discussion_r393909698", "bodyText": "Removed", "author": "alzimmermsft", "createdAt": "2020-03-17T19:10:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzQ0NjQyOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzY4OTAwNQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9144#discussion_r393689005", "bodyText": "Is this step actually necessary? The BOM file doesn't have tags, the right parentage to ensure that it's been scanned and even if it did, the script would have to be modified for this specific case to allow a dependencyManagement sections (which is effectively what a BOM file is).", "author": "JimSuplizio", "createdAt": "2020-03-17T13:44:39Z", "path": "eng/pipelines/templates/jobs/archetype-sdk-bom.yml", "diffHunk": "@@ -0,0 +1,78 @@\n+parameters:\n+  SDKType: bom\n+  ServiceDirectory: not-specified # Set a default that breaks in obvious ways.\n+  ValidationSteps: []\n+\n+jobs:\n+  - job: 'Build and Validate'\n+\n+    variables:\n+      - template: ../variables/globals.yml\n+\n+    pool:\n+      vmImage: 'ubuntu-16.04'\n+\n+    strategy:\n+      matrix:\n+        Client Libraries:\n+          ArtifactName: 'packages'\n+          JavaVersion: '1.11'\n+\n+    steps:\n+      - script: |\n+          echo \"##vso[build.addbuildtag]Scheduled\"\n+        displayName: 'Tag scheduled builds'\n+        condition: and(succeeded(), eq(variables['Build.SourceBranchName'],'master'),eq(variables['Build.Reason'],'Schedule'))\n+\n+      - task: UsePythonVersion@0\n+        displayName: 'Use Python 3.6'\n+        inputs:\n+          versionSpec: '3.6'\n+\n+      - template: tools/daily-dev-build-variable/daily-dev-build-variable.yml@azure-sdk-tools\n+\n+      - pwsh: |\n+        $(Build.SourcesDirectory)/eng/versioning/pom_file_version_scanner.ps1", "originalCommit": "bfcfca289ffea58ef4db986240249734f140ca43", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzg4Nzk2Mg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9144#discussion_r393887962", "bodyText": "This can be removed, really the only checks I would want to do eagerly with the BOM is verifying that all dependencies references are in Maven central and that they align on common dependencies.", "author": "alzimmermsft", "createdAt": "2020-03-17T18:31:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzY4OTAwNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzkwOTc2Nw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9144#discussion_r393909767", "bodyText": "Removed", "author": "alzimmermsft", "createdAt": "2020-03-17T19:11:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzY4OTAwNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc3ODc3MQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9144#discussion_r393778771", "bodyText": "As we chatted I suspect this will not work as is. I'll defer to @mitchdenny  to help deep dive into this and figure out what needs to happen.", "author": "weshaggard", "createdAt": "2020-03-17T15:47:09Z", "path": "eng/pipelines/templates/stages/archetype-sdk-bom.yml", "diffHunk": "@@ -0,0 +1,23 @@\n+parameters:\n+  Artifacts: []\n+  SDKType: bom\n+  ServiceDirectory: not-specified\n+\n+stages:\n+  - stage: Build\n+    jobs:\n+      - template: ../jobs/archetype-sdk-bom.yml\n+        parameters:\n+          ServiceDirectory: ${{parameters.ServiceDirectory}}\n+          SDKType: ${{parameters.SDKType}}\n+          Artifacts: ${{parameters.Artifacts}}\n+\n+  # The Prerelease and Release stages are conditioned on whether we are building a pull request and the branch.\n+  - ${{if and(ne(variables['Build.Reason'], 'PullRequest'), eq(variables['System.TeamProject'], 'internal'))}}:", "originalCommit": "bfcfca289ffea58ef4db986240249734f140ca43", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzk3MzQwOA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9144#discussion_r393973408", "bodyText": "The POM publishing should work, and I think that signing will be a no-op. There could be some things we need to react to in the release legs of the pipeline such as version bump logic.", "author": "mitchdenny", "createdAt": "2020-03-17T21:11:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc3ODc3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzk3MzY5NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9144#discussion_r393973694", "bodyText": "My proposal is that given this won't break any current release pipelines is that we get it in and start tweaking things.", "author": "mitchdenny", "createdAt": "2020-03-17T21:12:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc3ODc3MQ=="}], "type": "inlineReview"}, {"oid": "9706aba6ef9a10b64796e01839a4ee07939ed621", "url": "https://github.com/Azure/azure-sdk-for-java/commit/9706aba6ef9a10b64796e01839a4ee07939ed621", "message": "Add ant task to azure-sdk-bom and removed version verification in BOM pipeline template", "committedDate": "2020-03-17T19:04:22Z", "type": "commit"}, {"oid": "8106ef3a5cadcc1fefd42879122187100059eaa8", "url": "https://github.com/Azure/azure-sdk-for-java/commit/8106ef3a5cadcc1fefd42879122187100059eaa8", "message": "Removed unnecessary comment", "committedDate": "2020-03-17T19:10:46Z", "type": "commit"}]}