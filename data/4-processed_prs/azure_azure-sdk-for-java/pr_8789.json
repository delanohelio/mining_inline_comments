{"pr_number": 8789, "pr_title": "Fixing checkstyle issues in cosmos package", "pr_createdAt": "2020-03-06T03:07:03Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/8789", "timeline": [{"oid": "3635e7dad4ccca9a19d3d92fee6ac55f31c2e0c6", "url": "https://github.com/Azure/azure-sdk-for-java/commit/3635e7dad4ccca9a19d3d92fee6ac55f31c2e0c6", "message": "Fixing checkstyle issues in cosmos package\nAdded suppressions for checks that are not handled at the moment\nAddressing #8681 https://github.com/Azure/azure-sdk-for-java/issues/8681\nEnabling failsOnError and failOnViolation on cosmos pom\nAdding basic javadoc at places, this has to be redone with proper docs", "committedDate": "2020-03-06T03:06:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODY5MzM0MA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8789#discussion_r388693340", "bodyText": "Can you please remove the above comment regarding CosmosSkip. Since this is now complete :)", "author": "kushagraThapar", "createdAt": "2020-03-06T03:12:49Z", "path": "sdk/cosmos/azure-cosmos/pom.xml", "diffHunk": "@@ -278,8 +278,10 @@ Licensed under the MIT License.\n         <artifactId>maven-checkstyle-plugin</artifactId>\n         <version>3.1.0</version> <!-- {x-version-update;org.apache.maven.plugins:maven-checkstyle-plugin;external_dependency} -->\n         <configuration>\n-          <failsOnError>false</failsOnError>\n-          <failOnViolation>false</failOnViolation>\n+          <suppressionsLocation>../../../eng/code-quality-reports/src/main/resources/checkstyle/checkstyle-suppressions.xml", "originalCommit": "3635e7dad4ccca9a19d3d92fee6ac55f31c2e0c6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODcwNTY5OQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8789#discussion_r388705699", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              <suppress checks=\"com\\.azure\\.tools\\.checkstyle\\.checks\\.GoodLoggingCheck\"\n          \n          \n            \n              <suppress checks=\"com.azure.tools.checkstyle.checks.GoodLoggingCheck\"\n          \n      \n    \n    \n  \n\nI think this works as well.", "author": "mssfang", "createdAt": "2020-03-06T04:15:43Z", "path": "eng/code-quality-reports/src/main/resources/checkstyle/checkstyle-suppressions.xml", "diffHunk": "@@ -324,4 +324,56 @@\n   <!-- Don't enforce non-static ClientLogger instances in azure-core-mgmt PollerFactory and PollingState types-->\n   <suppress checks=\"com\\.azure\\.tools\\.checkstyle\\.checks\\.(ThrowFromClientLoggerCheck|GoodLoggingCheck)\" files=\"com.azure.core.management.implementation.polling.PollerFactory.java\"/>\n   <suppress checks=\"com\\.azure\\.tools\\.checkstyle\\.checks\\.(ThrowFromClientLoggerCheck|GoodLoggingCheck)\" files=\"com.azure.core.management.implementation.polling.PollingState.java\"/>\n+  \n+  <!-- Cosmos sdk suppressions -->\n+  <suppress checks=\"[a-zA-Z0-9]*\" files=\"[/\\\\]azure-cosmos[/\\\\]src[/\\\\]test[/\\\\]\"/>\n+  <suppress checks=\"[a-zA-Z0-9]*\" files=\"[/\\\\]cosmos[/\\\\]examples[/\\\\]\"/>\n+  <suppress checks=\"[a-zA-Z0-9]*\" files=\"[/\\\\]cosmos[/\\\\]implementation[/\\\\]\"/>\n+  <suppress checks=\"[a-zA-Z0-9]*\" files=\"com.azure.cosmos.BridgeInternal.java\"/>\n+  <suppress checks=\"[a-zA-Z0-9]*\" files=\"com.azure.cosmos.CosmosBridgeInternal.java\"/>\n+  <suppress checks=\"[a-zA-Z0-9]*\" files=\"com.azure.cosmos.CommonsBridgeInternal.java\"/>\n+  <suppress checks=\"[a-zA-Z0-9]*\" files=\"[/\\\\]cosmos[/\\\\]rx[/\\\\]examples[/\\\\]\"/>\n+  <suppress checks=\"[a-zA-Z0-9]*\" files=\"[/\\\\]azure-cosmos-benchmark[/\\\\]\"/>\n+  <suppress checks=\"com\\.azure\\.tools\\.checkstyle\\.checks\\.GoodLoggingCheck\"", "originalCommit": "3635e7dad4ccca9a19d3d92fee6ac55f31c2e0c6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODc0MDQ5NQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8789#discussion_r388740495", "bodyText": "Removed unnecessary escapes", "author": "mbhaskar", "createdAt": "2020-03-06T07:00:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODcwNTY5OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODcwNjcxMA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8789#discussion_r388706710", "bodyText": "Is possible to group ThrowFromClientLoggerCheck suppression into one together.\nYou can follow what search suppression:\n  <suppress checks=\".\" files=\".*[/\\\\]search[/\\\\]implementation[/\\\\]((?!(GeoPointDeserializer|Iso8601DateDeserializer|SerializationUtil)).*)\"/>\n\nGeoPointDeserializer, Iso8601DateDeserializer, SerializationUtil are sharing same package path\ncom.azure.search.implementation.", "author": "mssfang", "createdAt": "2020-03-06T04:21:20Z", "path": "eng/code-quality-reports/src/main/resources/checkstyle/checkstyle-suppressions.xml", "diffHunk": "@@ -324,4 +324,56 @@\n   <!-- Don't enforce non-static ClientLogger instances in azure-core-mgmt PollerFactory and PollingState types-->\n   <suppress checks=\"com\\.azure\\.tools\\.checkstyle\\.checks\\.(ThrowFromClientLoggerCheck|GoodLoggingCheck)\" files=\"com.azure.core.management.implementation.polling.PollerFactory.java\"/>\n   <suppress checks=\"com\\.azure\\.tools\\.checkstyle\\.checks\\.(ThrowFromClientLoggerCheck|GoodLoggingCheck)\" files=\"com.azure.core.management.implementation.polling.PollingState.java\"/>\n+  \n+  <!-- Cosmos sdk suppressions -->\n+  <suppress checks=\"[a-zA-Z0-9]*\" files=\"[/\\\\]azure-cosmos[/\\\\]src[/\\\\]test[/\\\\]\"/>\n+  <suppress checks=\"[a-zA-Z0-9]*\" files=\"[/\\\\]cosmos[/\\\\]examples[/\\\\]\"/>\n+  <suppress checks=\"[a-zA-Z0-9]*\" files=\"[/\\\\]cosmos[/\\\\]implementation[/\\\\]\"/>\n+  <suppress checks=\"[a-zA-Z0-9]*\" files=\"com.azure.cosmos.BridgeInternal.java\"/>\n+  <suppress checks=\"[a-zA-Z0-9]*\" files=\"com.azure.cosmos.CosmosBridgeInternal.java\"/>\n+  <suppress checks=\"[a-zA-Z0-9]*\" files=\"com.azure.cosmos.CommonsBridgeInternal.java\"/>\n+  <suppress checks=\"[a-zA-Z0-9]*\" files=\"[/\\\\]cosmos[/\\\\]rx[/\\\\]examples[/\\\\]\"/>\n+  <suppress checks=\"[a-zA-Z0-9]*\" files=\"[/\\\\]azure-cosmos-benchmark[/\\\\]\"/>\n+  <suppress checks=\"com\\.azure\\.tools\\.checkstyle\\.checks\\.GoodLoggingCheck\"\n+            files=\"com.azure.cosmos.CosmosResponseDiagnostics\"/>  \n+  <suppress checks=\"com\\.azure\\.tools\\.checkstyle\\.checks\\.ThrowFromClientLoggerCheck\"", "originalCommit": "3635e7dad4ccca9a19d3d92fee6ac55f31c2e0c6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODc0MDU4NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8789#discussion_r388740584", "bodyText": "Thanks for the suggestion, grouped similar ones together.", "author": "mbhaskar", "createdAt": "2020-03-06T07:01:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODcwNjcxMA=="}], "type": "inlineReview"}, {"oid": "16165aa2b93147ba76929a103f81204c89948083", "url": "https://github.com/Azure/azure-sdk-for-java/commit/16165aa2b93147ba76929a103f81204c89948083", "message": "Fixing failing test (added getters for fields that are demoted from public to package private)\nGrouping similar checkstyle suppressions as per PR comments.", "committedDate": "2020-03-06T07:00:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTAxODY5NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8789#discussion_r389018694", "bodyText": "Please verify that after moving these field(which doesn't have a explicit serializer)from public to default are still coming in diagnostic ,I think  we need to do it manually as all field level validationa not their in tests , please refer CosmosResponseDIagnoticsTest file", "author": "simplynaveen20", "createdAt": "2020-03-06T16:51:30Z", "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/ClientSideRequestStatistics.java", "diffHunk": "@@ -203,77 +217,72 @@ void setRegionsContacted(Set<URI> regionsContacted) {\n         this.regionsContacted = Collections.synchronizedSet(regionsContacted);\n     }\n \n-    private static String formatDateTime(ZonedDateTime dateTime) {\n-        if (dateTime == null) {\n-            return null;\n-        }\n-        return dateTime.format(RESPONSE_TIME_FORMATTER);\n-    }\n-\n-    public void recordRetryContext(RxDocumentServiceRequest request) {\n-        if(request.requestContext.retryContext != null) {\n-            request.requestContext.retryContext.retryEndTime =  ZonedDateTime.now(ZoneOffset.UTC);\n+    void recordRetryContext(RxDocumentServiceRequest request) {\n+        if (request.requestContext.retryContext != null) {\n+            request.requestContext.retryContext.retryEndTime = ZonedDateTime.now(ZoneOffset.UTC);\n             this.retryContext = new RetryContext(request.requestContext.retryContext);\n         }\n     }\n \n     static class StoreResponseStatistics {\n         @JsonSerialize(using = StoreResult.StoreResultSerializer.class)\n-        public StoreResult storeResult;\n+        StoreResult storeResult;\n         @JsonSerialize(using = ZonedDateTimeSerializer.class)\n-        public ZonedDateTime requestResponseTime;\n-        public ResourceType requestResourceType;\n-        public OperationType requestOperationType;\n+        ZonedDateTime requestResponseTime;", "originalCommit": "16165aa2b93147ba76929a103f81204c89948083", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTAyNzQ0NQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8789#discussion_r389027445", "bodyText": "very good point. also as this PR adds getters to the classes in ClientSideRequestStatistics, jackson may see to ways to get a feild, the field itself and the getter for the field.\nWe should ensure they are properly annotated as per jackson guideline if one need to be ignored and the other one be used. etc.", "author": "moderakh", "createdAt": "2020-03-06T17:03:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTAxODY5NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTA1Njk3MQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8789#discussion_r389056971", "bodyText": "validated with @simplynaveen20 . These look good", "author": "mbhaskar", "createdAt": "2020-03-06T18:02:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTAxODY5NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTAyMTU0NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8789#discussion_r389021544", "bodyText": "Please verify that after moving these field(which doesn't have a explicit serializer)from public to default to after are still coming in diagnostic ,I think we need to do it manually as all field level validation is not their in tests , please refer CosmosResponseDIagnoticsTest file", "author": "simplynaveen20", "createdAt": "2020-03-06T16:56:21Z", "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/ClientSideRequestStatistics.java", "diffHunk": "@@ -303,14 +316,55 @@ public void serialize(ClientSideRequestStatistics statistics, JsonGenerator gene\n                 systemInformation.availableMemory = (maxMemory - (totalMemory - freeMemory)) + \" KB\";\n \n                 OperatingSystemMXBean mbean = (com.sun.management.OperatingSystemMXBean)\n-                    ManagementFactory.getOperatingSystemMXBean();\n-                systemInformation.processCpuLoad = mbean.getProcessCpuLoad()*100 +  \" %\";\n-                systemInformation.systemCpuLoad = mbean.getSystemCpuLoad()*100 +  \" %\";\n+                                                  ManagementFactory.getOperatingSystemMXBean();\n+                systemInformation.processCpuLoad = mbean.getProcessCpuLoad() * 100 + \" %\";\n+                systemInformation.systemCpuLoad = mbean.getSystemCpuLoad() * 100 + \" %\";\n                 generator.writeObjectField(\"systemInformation\", systemInformation);\n             } catch (Exception e) {\n                 // Error while evaluating system information, do nothing\n             }\n             generator.writeEndObject();\n         }\n     }\n+\n+    private class AddressResolutionStatistics {\n+        @JsonSerialize(using = ZonedDateTimeSerializer.class)\n+        ZonedDateTime startTime;\n+        @JsonSerialize(using = ZonedDateTimeSerializer.class)\n+        ZonedDateTime endTime;", "originalCommit": "16165aa2b93147ba76929a103f81204c89948083", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTA1ODYwMw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8789#discussion_r389058603", "bodyText": "Validated with @simplynaveen20. These look good", "author": "mbhaskar", "createdAt": "2020-03-06T18:05:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTAyMTU0NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTA0ODgxOQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8789#discussion_r389048819", "bodyText": "nit: extra space", "author": "mssfang", "createdAt": "2020-03-06T17:44:48Z", "path": "eng/code-quality-reports/src/main/resources/checkstyle/checkstyle-suppressions.xml", "diffHunk": "@@ -324,4 +324,26 @@\n   <!-- Don't enforce non-static ClientLogger instances in azure-core-mgmt PollerFactory and PollingState types-->\n   <suppress checks=\"com\\.azure\\.tools\\.checkstyle\\.checks\\.(ThrowFromClientLoggerCheck|GoodLoggingCheck)\" files=\"com.azure.core.management.implementation.polling.PollerFactory.java\"/>\n   <suppress checks=\"com\\.azure\\.tools\\.checkstyle\\.checks\\.(ThrowFromClientLoggerCheck|GoodLoggingCheck)\" files=\"com.azure.core.management.implementation.polling.PollingState.java\"/>\n+  \n+  <!-- Cosmos sdk suppressions -->\n+  <suppress checks=\"[a-zA-Z0-9]*\" files=\"[/\\\\]azure-cosmos[/\\\\]src[/\\\\]test[/\\\\]\"/>\n+  <suppress checks=\"[a-zA-Z0-9]*\" files=\"[/\\\\]cosmos[/\\\\]examples[/\\\\]\"/>\n+  <suppress checks=\"[a-zA-Z0-9]*\" files=\"[/\\\\]cosmos[/\\\\]implementation[/\\\\]\"/>\n+  <suppress checks=\"[a-zA-Z0-9]*\"  files=\".*[/\\\\]cosmos[/\\\\]((?!(BridgeInternal|CosmosBridgeInternal|CommonsBridgeInternal)).*)\"/>", "originalCommit": "16165aa2b93147ba76929a103f81204c89948083", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTA1NTgzNA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8789#discussion_r389055834", "bodyText": "I believe this now match what is in pom.client.xml and can be removed as it will be transitively pulled into this POM.", "author": "alzimmermsft", "createdAt": "2020-03-06T17:59:40Z", "path": "sdk/cosmos/azure-cosmos/pom.xml", "diffHunk": "@@ -272,14 +272,15 @@ Licensed under the MIT License.\n   <build>\n     <plugins>\n \n-      <!-- CosmosSkip - Needed temporary false values to not fail. -->\n       <plugin>\n         <groupId>org.apache.maven.plugins</groupId>\n         <artifactId>maven-checkstyle-plugin</artifactId>\n         <version>3.1.0</version> <!-- {x-version-update;org.apache.maven.plugins:maven-checkstyle-plugin;external_dependency} -->\n         <configuration>\n-          <failsOnError>false</failsOnError>\n-          <failOnViolation>false</failOnViolation>\n+          <suppressionsLocation>../../../eng/code-quality-reports/src/main/resources/checkstyle/checkstyle-suppressions.xml\n+          </suppressionsLocation>\n+          <failsOnError>true</failsOnError>\n+          <failOnViolation>true</failOnViolation>\n         </configuration>\n       </plugin>", "originalCommit": "16165aa2b93147ba76929a103f81204c89948083", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTA1ODM2NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8789#discussion_r389058364", "bodyText": "Sure, will validate and remove in next PR.", "author": "mbhaskar", "createdAt": "2020-03-06T18:05:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTA1NTgzNA=="}], "type": "inlineReview"}]}