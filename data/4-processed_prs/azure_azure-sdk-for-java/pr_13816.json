{"pr_number": 13816, "pr_title": "Remove Apache Avro Dependency from SchemaRegistry", "pr_createdAt": "2020-08-05T20:31:04Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/13816", "timeline": [{"oid": "a95b4524c5d07d1d106c9a33eb30e9c7e8a8ea6b", "url": "https://github.com/Azure/azure-sdk-for-java/commit/a95b4524c5d07d1d106c9a33eb30e9c7e8a8ea6b", "message": "Prototype additional Avro APIs of getSchema and getSchemaName", "committedDate": "2020-08-05T20:25:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAwNzIyOA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13816#discussion_r466007228", "bodyText": "Made AvroSerializer a sub-interface to ObjectSerializer so it can extend at will in the future without cause breaking changes.", "author": "alzimmermsft", "createdAt": "2020-08-05T21:13:03Z", "path": "sdk/core/azure-core-experimental/src/main/java/com/azure/core/experimental/serializer/AvroSerializer.java", "diffHunk": "@@ -0,0 +1,57 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.core.experimental.serializer;\n+\n+import com.azure.core.util.serializer.ObjectSerializer;\n+import com.azure.core.util.serializer.TypeReference;\n+import reactor.core.publisher.Mono;\n+\n+import java.io.InputStream;\n+import java.io.OutputStream;\n+\n+/**\n+ * Generic interface covering basic Avro serialization and deserialization methods.\n+ */\n+public interface AvroSerializer extends ObjectSerializer {", "originalCommit": "a95b4524c5d07d1d106c9a33eb30e9c7e8a8ea6b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAwNzYzNw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13816#discussion_r466007637", "bodyText": "Added these new methods to the provider as they are tied to the specific implementation and not a specific serializer instance.", "author": "alzimmermsft", "createdAt": "2020-08-05T21:13:56Z", "path": "sdk/core/azure-core-experimental/src/main/java/com/azure/core/experimental/serializer/AvroSerializerProvider.java", "diffHunk": "@@ -3,19 +3,35 @@\n \n package com.azure.core.experimental.serializer;\n \n-import com.azure.core.util.serializer.ObjectSerializer;\n-\n /**\n- * An interface to be implemented by any azure-core plugin that wishes to provide an Avro {@link ObjectSerializer}\n+ * An interface to be implemented by any azure-core plugin that wishes to provide an Avro {@link AvroSerializer}\n  * implementation.\n  */\n public interface AvroSerializerProvider {\n \n     /**\n-     * Creates a new Avro-based {@link ObjectSerializer} tied to the given schema.\n+     * Creates a new {@link AvroSerializer} tied to the given schema.\n      *\n      * @param schema The Avro schema that will be associated to the serializer.\n-     * @return A new Avro-based {@link ObjectSerializer} instance.\n+     * @return A new {@link AvroSerializer} instance.\n+     */\n+    AvroSerializer createInstance(String schema);\n+\n+    /**\n+     * Returns the Avro schema for specified object.\n+     *\n+     * @param object The object having its Avro schema retrieved.\n+     * @return The Avro schema for the object.\n+     * @throws IllegalArgumentException If the object is an unsupported type.\n+     */\n+    String getSchema(Object object);", "originalCommit": "a95b4524c5d07d1d106c9a33eb30e9c7e8a8ea6b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAxNjI5MA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13816#discussion_r466016290", "bodyText": "Not sure how this will work.\nThe output of this function is required for calling decode().  So if we don't do the parse here, then decode() will have to parse.  That'll lose the deserialization caching that happens on the SR client layer.", "author": "arerlend", "createdAt": "2020-08-05T21:31:58Z", "path": "sdk/schemaregistry/azure-data-schemaregistry-avro/src/main/java/com/azure/data/schemaregistry/avro/AvroSchemaRegistryCodec.java", "diffHunk": "@@ -52,20 +45,18 @@ public SerializationType getSerializationType() {\n      * @return avro schema\n      */\n     @Override\n-    public Schema parseSchemaString(String schemaString) {\n-        return (new Schema.Parser()).parse(schemaString);\n+    public String parseSchemaString(String schemaString) {", "originalCommit": "a95b4524c5d07d1d106c9a33eb30e9c7e8a8ea6b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAxNzAwNw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13816#discussion_r466017007", "bodyText": "OK I see.  So the provider will be in charge of caching.  That should be fine.", "author": "arerlend", "createdAt": "2020-08-05T21:33:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAxNjI5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAxOTAwOA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13816#discussion_r466019008", "bodyText": "SchemaRegistryObject has a getSchema() that will need to be removed.  It should only return a schema string now.", "author": "arerlend", "createdAt": "2020-08-05T21:38:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAxNjI5MA=="}], "type": "inlineReview"}]}