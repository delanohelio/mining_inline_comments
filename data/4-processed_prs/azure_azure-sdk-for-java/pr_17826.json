{"pr_number": 17826, "pr_title": "Javadocs update 2", "pr_createdAt": "2020-11-26T03:20:19Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/17826", "timeline": [{"oid": "a2ca67587ffdb898a3c8c176e35835d0903aec92", "url": "https://github.com/Azure/azure-sdk-for-java/commit/a2ca67587ffdb898a3c8c176e35835d0903aec92", "message": "Update documentation for message batch and processor client.", "committedDate": "2020-11-25T07:49:25Z", "type": "commit"}, {"oid": "806d30b9aa415d959080e7f95468dbbfd1df9432", "url": "https://github.com/Azure/azure-sdk-for-java/commit/806d30b9aa415d959080e7f95468dbbfd1df9432", "message": "Update documentation for messages.", "committedDate": "2020-11-25T09:51:27Z", "type": "commit"}, {"oid": "00bcda4ec89bb08552b09a3ad765730951c2d570", "url": "https://github.com/Azure/azure-sdk-for-java/commit/00bcda4ec89bb08552b09a3ad765730951c2d570", "message": "Update documentation for Message Context.", "committedDate": "2020-11-25T09:51:36Z", "type": "commit"}, {"oid": "91278d754d2149d2018c3057a222a8e9310a76f2", "url": "https://github.com/Azure/azure-sdk-for-java/commit/91278d754d2149d2018c3057a222a8e9310a76f2", "message": "Add transaction snippets.", "committedDate": "2020-11-25T20:16:49Z", "type": "commit"}, {"oid": "0210147c942b1efbc4759512b6211a41d07d025e", "url": "https://github.com/Azure/azure-sdk-for-java/commit/0210147c942b1efbc4759512b6211a41d07d025e", "message": "Adding links to options.", "committedDate": "2020-11-25T20:40:28Z", "type": "commit"}, {"oid": "64cd70507da12c884538f0588b4ab3313634b699", "url": "https://github.com/Azure/azure-sdk-for-java/commit/64cd70507da12c884538f0588b4ab3313634b699", "message": "Add transaction code snippets.", "committedDate": "2020-11-25T21:24:19Z", "type": "commit"}, {"oid": "271ee6974fca6b1937293bc05cfc385c738ad558", "url": "https://github.com/Azure/azure-sdk-for-java/commit/271ee6974fca6b1937293bc05cfc385c738ad558", "message": "Adding sender and receiver documentation.", "committedDate": "2020-11-26T01:07:37Z", "type": "commit"}, {"oid": "9c9653c6adf55ce0db79f7010dda91c24509fded", "url": "https://github.com/Azure/azure-sdk-for-java/commit/9c9653c6adf55ce0db79f7010dda91c24509fded", "message": "Update session client documentation.", "committedDate": "2020-11-26T01:14:32Z", "type": "commit"}, {"oid": "a608cadc737b981e91d681e338b0da7dbc8a4934", "url": "https://github.com/Azure/azure-sdk-for-java/commit/a608cadc737b981e91d681e338b0da7dbc8a4934", "message": "Fix docs naming", "committedDate": "2020-11-26T02:25:54Z", "type": "commit"}, {"oid": "8579fcf5e2d3d1333642c370ef64249eee4e2379", "url": "https://github.com/Azure/azure-sdk-for-java/commit/8579fcf5e2d3d1333642c370ef64249eee4e2379", "message": "Updating session documents.", "committedDate": "2020-11-26T02:49:31Z", "type": "commit"}, {"oid": "c14842baa12819bfd308ac1c812def473b9fe116", "url": "https://github.com/Azure/azure-sdk-for-java/commit/c14842baa12819bfd308ac1c812def473b9fe116", "message": "Merge branch 'master' of https://github.com/azure/azure-sdk-for-java into javadocs-part2", "committedDate": "2020-11-26T03:17:31Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDc2OTMxOQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17826#discussion_r530769319", "bodyText": "May be explain about autoComplete as it is important part.", "author": "hemanttanwar", "createdAt": "2020-11-26T04:37:19Z", "path": "sdk/servicebus/azure-messaging-servicebus/src/main/java/com/azure/messaging/servicebus/ServiceBusProcessorClient.java", "diffHunk": "@@ -36,11 +36,10 @@\n import static com.azure.messaging.servicebus.implementation.ServiceBusConstants.AZ_TRACING_SERVICE_NAME;\n \n /**\n- *  The processor client for processing Service Bus messages. {@link ServiceBusProcessorClient\n- *  ServiceBusProcessorClients} provides a push-based mechanism that invokes the message processing callback when a\n- *  message is received or the error handler when an error occurs when receiving messages. A\n- *  {@link ServiceBusProcessorClient} can be created to process messages for a session-enabled Service Bus entity or\n- *  a non session-enabled Service Bus entity.\n+ * The processor client for processing Service Bus messages. {@link ServiceBusProcessorClient} provides a push-based\n+ * mechanism that invokes the message processing callback when a message is received or the error handler when an error\n+ * occurs when receiving messages. A {@link ServiceBusProcessorClient} can be created to process messages for a\n+ * session-enabled or non session-enabled Service Bus entity.", "originalCommit": "c14842baa12819bfd308ac1c812def473b9fe116", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDc3NTM4OA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17826#discussion_r530775388", "bodyText": "I missed it to change to return BinaryData.fromBytes(amqpAnnotatedMessage.getBody().getFirstData())\nBinaryData will always have data, a null is converted into empty byte array inside BinaryData, So we do not have to\ncheck for payload.isPresent().\nBinaryData  store data in byte[] variable. so calling getFirstData will be efficient.", "author": "hemanttanwar", "createdAt": "2020-11-26T05:03:34Z", "path": "sdk/servicebus/azure-messaging-servicebus/src/main/java/com/azure/messaging/servicebus/ServiceBusReceivedMessage.java", "diffHunk": "@@ -50,50 +60,56 @@\n     }\n \n     /**\n-     * The representation of message as defined by AMQP protocol.\n-     *\n-     * @see <a href=\"http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-messaging-v1.0-os.html#section-message-format\">\n-     *     Amqp Message Format.</a>\n+     * Gets the set of free-form {@link ServiceBusReceivedMessage} properties which may be used for passing metadata\n+     * associated with the {@link ServiceBusReceivedMessage} during Service Bus operations. A common use-case for\n+     * {@code properties()} is to associate serialization hints for the {@link #getBody()} as an aid to consumers\n+     * who wish to deserialize the binary data.\n      *\n-     * @return the {@link AmqpAnnotatedMessage} representing amqp message.\n+     * @return Application properties associated with this {@link ServiceBusReceivedMessage}.\n+     * @see ServiceBusMessage#getApplicationProperties()\n      */\n-    public AmqpAnnotatedMessage getRawAmqpMessage() {\n-        return amqpAnnotatedMessage;\n+    public Map<String, Object> getApplicationProperties() {\n+        return amqpAnnotatedMessage.getApplicationProperties();\n     }\n \n     /**\n-     * Gets the actual payload/data wrapped by the {@link ServiceBusReceivedMessage}.\n+     * Gets the payload wrapped by the {@link ServiceBusReceivedMessage}.\n      *\n      * <p>The {@link BinaryData} wraps byte array and is an abstraction over many different ways it can be represented.\n-     * It provides many convenience API including APIs to serialize/deserialize object.\n+     * It provides convenience APIs to serialize/deserialize the object.</p>\n+     *\n      * <p>\n      * If the means for deserializing the raw data is not apparent to consumers, a common technique is to make use of\n      * {@link #getApplicationProperties()} when creating the event, to associate serialization hints as an aid to\n      * consumers who wish to deserialize the binary data.\n      * </p>\n      *\n-     * @return A byte array representing the data.\n+     * @return Binary data representing the payload.\n+     * @see ServiceBusMessage#getBody()\n      */\n     public BinaryData getBody() {\n         final AmqpMessageBodyType bodyType = amqpAnnotatedMessage.getBody().getBodyType();\n         switch (bodyType) {\n             case DATA:\n-                return BinaryData.fromBytes(amqpAnnotatedMessage.getBody()\n-                    .getData().stream().findFirst().get());\n+                final Optional<byte[]> payload = amqpAnnotatedMessage.getBody().getData().stream().findFirst();", "originalCommit": "c14842baa12819bfd308ac1c812def473b9fe116", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDc5Njc1MQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17826#discussion_r530796751", "bodyText": "I had an IntelliJ warning about this. I think it's defensive programming. You only know this because you implemented it. We could change the underlying behaviour.", "author": "conniey", "createdAt": "2020-11-26T06:25:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDc3NTM4OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTgwMDI0Mg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17826#discussion_r531800242", "bodyText": "We already have call to getFirstData in ServiceBusMessage and I did not see any intellij warning.\nThis API getFirstData was added for one of the reason\n\nNo need to create unnecessarily create List  when we will have one byte[] always.\n\nIn SBRM.getBody() have return type BinaryData, so it is one byte [] always. So there is no harm in using getFirstData(). And you do not need to depend/assume anything how it is implemented internally. If you want to check for null when getFirstData() returns, that is fine.\nThink about received message performance , when every message create aList of one byte[] for 95% of users.", "author": "hemanttanwar", "createdAt": "2020-11-27T22:36:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDc3NTM4OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDc4MTY2MQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17826#discussion_r530781661", "bodyText": "This is also, I think we missed it,\nThis should get getSubgect.\nJust to verify this is .Net API View https://apiview.dev/Assemblies/Review/b5d7e3304000449c859c2016f718db52#Azure.Messaging.ServiceBus.ServiceBusReceivedMessage", "author": "hemanttanwar", "createdAt": "2020-11-26T05:28:58Z", "path": "sdk/servicebus/azure-messaging-servicebus/src/main/java/com/azure/messaging/servicebus/ServiceBusReceivedMessage.java", "diffHunk": "@@ -238,25 +266,30 @@ public OffsetDateTime getExpiresAt() {\n     /**\n      * Gets the label for the message.\n      *\n+     * <p>\n+     * This property enables the application to indicate the purpose of the message to the receiver in a standardized\n+     * fashion, similar to an email subject line. The mapped AMQP property is \"subject\".\n+     * </p>\n+     *\n      * @return The label for the message.\n+     * @see ServiceBusMessage#getSubject()\n      */\n     public String getLabel() {", "originalCommit": "c14842baa12819bfd308ac1c812def473b9fe116", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDc4NDQwOA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17826#discussion_r530784408", "bodyText": "Document : This should throw exception if this is called for non-session entity. I think we do not have that check. we should add that check.", "author": "hemanttanwar", "createdAt": "2020-11-26T05:39:25Z", "path": "sdk/servicebus/azure-messaging-servicebus/src/main/java/com/azure/messaging/servicebus/ServiceBusReceiverClient.java", "diffHunk": "@@ -258,8 +255,8 @@ public ServiceBusReceivedMessage peekMessage() {\n \n     /**\n      * Reads the next active message without changing the state of the receiver or the message source. The first call to\n-     * {@code peek()} fetches the first active message for this receiver. Each subsequent call fetches the subsequent\n-     * message in the entity.\n+     * {@code peekMessage()} fetches the first active message for this receiver. Each subsequent call fetches the\n+     * subsequent message in the entity.", "originalCommit": "c14842baa12819bfd308ac1c812def473b9fe116", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDgwMjM4Mw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17826#discussion_r530802383", "bodyText": "This is done on the management node. You don't have to be a sessioned receiver to receive a message from it.", "author": "conniey", "createdAt": "2020-11-26T06:42:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDc4NDQwOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDc4NTE1Ng==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17826#discussion_r530785156", "bodyText": "if the session lock cannot be renewed. : We have this line many places, but it does not give hint why this operation can not be done. One reason is  id client is already disposed. Should we let user know why  ?", "author": "hemanttanwar", "createdAt": "2020-11-26T05:42:12Z", "path": "sdk/servicebus/azure-messaging-servicebus/src/main/java/com/azure/messaging/servicebus/ServiceBusReceiverClient.java", "diffHunk": "@@ -538,9 +556,8 @@ public void renewMessageLock(ServiceBusReceivedMessage message, Duration maxLock\n      * Sets the state of the session if this receiver is a session receiver.\n      *\n      * @return The next expiration time for the session lock.\n-     * @throws NullPointerException if {@code sessionId} is null.\n-     * @throws IllegalArgumentException if {@code sessionId} is an empty string.\n      * @throws IllegalStateException if the receiver is a non-session receiver or receiver is already disposed.\n+     * @throws ServiceBusException if the session lock cannot be renewed.\n      */", "originalCommit": "c14842baa12819bfd308ac1c812def473b9fe116", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDgwMjY1Ng==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17826#discussion_r530802656", "bodyText": "If the client is disposed, it'll throw an IllegalStateException. Any number of AMQP Exceptions can occur. These are all wrapped into a ServiceBusException.", "author": "conniey", "createdAt": "2020-11-26T06:43:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDc4NTE1Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDc4NTUzOA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17826#discussion_r530785538", "bodyText": "isn't this true that AmqpException will be mapped to ServiceBusException. Same in following few API.", "author": "hemanttanwar", "createdAt": "2020-11-26T05:43:55Z", "path": "sdk/servicebus/azure-messaging-servicebus/src/main/java/com/azure/messaging/servicebus/ServiceBusSenderAsyncClient.java", "diffHunk": "@@ -160,9 +162,11 @@ public String getEntityPath() {\n      *\n      * @return The {@link Mono} the finishes this operation on service bus resource.\n      *\n-     * @throws NullPointerException if {@code message} is {@code null} , {@code transactionContext} or\n-     * {@code transactionContext.transactionID} is {@code null}.\n+     * @throws NullPointerException if {@code message}, {@code transactionContext} or\n+     *      {@code transactionContext.transactionId} is {@code null}.\n      * @throws IllegalStateException if sender is already disposed.\n+     * @throws AmqpException if {@code message} is larger than the maximum allowed size of a single message.", "originalCommit": "c14842baa12819bfd308ac1c812def473b9fe116", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDgwMzI0MQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17826#discussion_r530803241", "bodyText": "Fixed this", "author": "conniey", "createdAt": "2020-11-26T06:45:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDc4NTUzOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDc4NzU4OQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17826#discussion_r530787589", "bodyText": "When user create  this  client ServiceBusSessionReceiverClient, they have to close this. Because this is intermediate client, it is easy to miss. We had same issue in our live test.\nSo may be we can write this  in builder when this is created also here so User ensure this is closed.", "author": "hemanttanwar", "createdAt": "2020-11-26T05:51:49Z", "path": "sdk/servicebus/azure-messaging-servicebus/src/main/java/com/azure/messaging/servicebus/ServiceBusSessionReceiverClient.java", "diffHunk": "@@ -13,14 +15,15 @@\n /**\n  * This session receiver client is used to acquire session locks from a queue or topic and create\n  * {@link ServiceBusReceiverClient} instances that are tied to the locked sessions.\n- * Use {@link #acceptSession(String)} to acquire the lock of a session if you know the session id.\n- *\n- * {@codesnippet com.azure.messaging.servicebus.servicebusreceiverclient.instantiation#nextsession}\n- *\n- * Use {@link #acceptNextSession()} to acquire the lock of the next available session without specifying the session id.\n  *\n+ * <p><strong>Receive messages from a specific session</strong></p>\n+ * <p>Use {@link #acceptSession(String)} to acquire the lock of a session if you know the session id.</p>", "originalCommit": "c14842baa12819bfd308ac1c812def473b9fe116", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDgwMzQwOQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17826#discussion_r530803409", "bodyText": "The code snippets have this well documented.", "author": "conniey", "createdAt": "2020-11-26T06:46:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDc4NzU4OQ=="}], "type": "inlineReview"}, {"oid": "daa96f338e793909a3535f8aaa90df73afc9acb4", "url": "https://github.com/Azure/azure-sdk-for-java/commit/daa96f338e793909a3535f8aaa90df73afc9acb4", "message": "Update to getSubject -> getLabel", "committedDate": "2020-11-26T06:46:37Z", "type": "commit"}, {"oid": "5a4b5ee537af34cfbcbd3583f3e9fa2b0040ef98", "url": "https://github.com/Azure/azure-sdk-for-java/commit/5a4b5ee537af34cfbcbd3583f3e9fa2b0040ef98", "message": "Change to getFirstData()", "committedDate": "2020-11-28T00:06:58Z", "type": "forcePushed"}, {"oid": "0a190287a2e5ac37485a50073c2d55750c898fda", "url": "https://github.com/Azure/azure-sdk-for-java/commit/0a190287a2e5ac37485a50073c2d55750c898fda", "message": "Change to getFirstData()", "committedDate": "2020-11-28T01:52:53Z", "type": "commit"}, {"oid": "0a190287a2e5ac37485a50073c2d55750c898fda", "url": "https://github.com/Azure/azure-sdk-for-java/commit/0a190287a2e5ac37485a50073c2d55750c898fda", "message": "Change to getFirstData()", "committedDate": "2020-11-28T01:52:53Z", "type": "forcePushed"}]}