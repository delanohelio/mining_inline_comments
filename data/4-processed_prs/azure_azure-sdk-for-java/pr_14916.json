{"pr_number": 14916, "pr_title": "Added support to pass application id to user agent string", "pr_createdAt": "2020-09-08T20:06:19Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/14916", "timeline": [{"oid": "3b83d57a0feecb7c531952cd428ab0dfac33cf9e", "url": "https://github.com/Azure/azure-sdk-for-java/commit/3b83d57a0feecb7c531952cd428ab0dfac33cf9e", "message": "Added support to pass application id to user agent string", "committedDate": "2020-09-08T20:05:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTE3NDAxMQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14916#discussion_r485174011", "bodyText": "Any possibility that logOptions is null?", "author": "alzimmermsft", "createdAt": "2020-09-08T20:20:49Z", "path": "sdk/storage/azure-storage-blob/src/main/java/com/azure/storage/blob/implementation/util/BuilderHelper.java", "diffHunk": "@@ -165,14 +165,15 @@ public static void httpsValidation(Object objectToCheck, String objectName, Stri\n      * Creates a {@link UserAgentPolicy} using the default blob module name and version.\n      *\n      * @param configuration Configuration store used to determine whether telemetry information should be included.\n+     * @param logOptions Logging options to set in the logging policy.\n      * @return The default {@link UserAgentPolicy} for the module.\n      */\n-    private static UserAgentPolicy getUserAgentPolicy(Configuration configuration) {\n+    private static UserAgentPolicy getUserAgentPolicy(Configuration configuration, HttpLogOptions logOptions) {\n         configuration = (configuration == null) ? Configuration.NONE : configuration;\n \n         String clientName = PROPERTIES.getOrDefault(SDK_NAME, \"UnknownName\");\n         String clientVersion = PROPERTIES.getOrDefault(SDK_VERSION, \"UnknownVersion\");\n-        return new UserAgentPolicy(getDefaultHttpLogOptions().getApplicationId(), clientName, clientVersion,\n+        return new UserAgentPolicy(logOptions.getApplicationId(), clientName, clientVersion,", "originalCommit": "3b83d57a0feecb7c531952cd428ab0dfac33cf9e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTE3NTU2Mw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14916#discussion_r485175563", "bodyText": "This method is only called by our builders where we set logOptions to default log options, so I think it is safe.", "author": "gapra-msft", "createdAt": "2020-09-08T20:24:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTE3NDAxMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzI2MDc4NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14916#discussion_r487260784", "bodyText": "We have discussed more about this in last 2 weeks with @JonathanGiles  and wanted more generic and common approach to provide applicationId. I would suggest not to implement this in HttpLogOptions because we are going to deprecate this.\nHere is Epic related to this issue #15107\nWe will be releasing com.azure.core.util.ClientOptions in master branch just after September release. Here is the PR for it  https://github.com/Azure/azure-sdk-for-java/pull/13697/files#diff-860f082a6593b9a09fa1a4d4fd0b5cf7R105\nI understand that we are changing this mid-way of this PR but want to make sure we are future proof.", "author": "hemanttanwar", "createdAt": "2020-09-11T19:57:03Z", "path": "sdk/storage/azure-storage-blob-cryptography/src/test/java/com/azure/storage/blob/specialized/cryptography/EncryptedBlobClientBuilderTest.groovy", "diffHunk": "@@ -56,6 +57,31 @@ class EncryptedBlobClientBuilderTest extends Specification {\n             .verifyComplete()\n     }\n \n+    /**\n+     * Tests that a user application id will be honored in the UA string when using the encrypted blob client builder's default\n+     * pipeline.\n+     */\n+    def \"Encrypted blob client custom application id in UA string\"() {\n+        when:\n+        def randomData = new byte[256]\n+        new SecureRandom().nextBytes(randomData)\n+\n+        def encryptedBlobClient = new EncryptedBlobClientBuilder()\n+            .endpoint(endpoint)\n+            .containerName(\"container\")\n+            .blobName(\"blob\")\n+            .credential(credentials)\n+            .key(new FakeKey(\"keyId\", randomData), \"keyWrapAlgorithm\")\n+            .httpClient(new ApplicationIdUAStringTestClient())\n+            .httpLogOptions(new HttpLogOptions().setApplicationId(\"custom-id\"))", "originalCommit": "3b83d57a0feecb7c531952cd428ab0dfac33cf9e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "94dcd297cce0be15df4b18a21db095ab6a551b2a", "url": "https://github.com/Azure/azure-sdk-for-java/commit/94dcd297cce0be15df4b18a21db095ab6a551b2a", "message": "Merge branch 'master' into storage/applicationId", "committedDate": "2020-09-15T18:32:19Z", "type": "commit"}]}