{"pr_number": 18086, "pr_title": "Test code coverage publishing", "pr_createdAt": "2020-12-11T18:58:32Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/18086", "timeline": [{"oid": "068822bf006bdfc9239f9e250211e3666f3af509", "url": "https://github.com/Azure/azure-sdk-for-java/commit/068822bf006bdfc9239f9e250211e3666f3af509", "message": "Test code coverage publishing", "committedDate": "2020-12-11T18:57:57Z", "type": "commit"}, {"oid": "34a49deeb965736eca0f90887ba1f8f9f685b1f0", "url": "https://github.com/Azure/azure-sdk-for-java/commit/34a49deeb965736eca0f90887ba1f8f9f685b1f0", "message": "Fix variable name", "committedDate": "2020-12-11T19:10:35Z", "type": "commit"}, {"oid": "d49b7b8b5bffe3bc56dcfdfa3b752d03b771ac3e", "url": "https://github.com/Azure/azure-sdk-for-java/commit/d49b7b8b5bffe3bc56dcfdfa3b752d03b771ac3e", "message": "debug path info", "committedDate": "2020-12-11T19:29:55Z", "type": "commit"}, {"oid": "4a3a57e70cf11f67b8db3322eaff36d1098b280e", "url": "https://github.com/Azure/azure-sdk-for-java/commit/4a3a57e70cf11f67b8db3322eaff36d1098b280e", "message": "more debug info", "committedDate": "2020-12-11T19:41:52Z", "type": "commit"}, {"oid": "88c86c96267c3e7b9f903262e4515a13d924ee55", "url": "https://github.com/Azure/azure-sdk-for-java/commit/88c86c96267c3e7b9f903262e4515a13d924ee55", "message": "multi-module coverage", "committedDate": "2020-12-11T21:39:43Z", "type": "commit"}, {"oid": "07c58ae4db4509c12c47b2e2c1dc6509f5cae85d", "url": "https://github.com/Azure/azure-sdk-for-java/commit/07c58ae4db4509c12c47b2e2c1dc6509f5cae85d", "message": "Separate step for generating report", "committedDate": "2020-12-14T18:19:22Z", "type": "commit"}, {"oid": "c3f246843a994c6f4e1270dae16e444229da1972", "url": "https://github.com/Azure/azure-sdk-for-java/commit/c3f246843a994c6f4e1270dae16e444229da1972", "message": "Fix directory", "committedDate": "2020-12-14T18:39:11Z", "type": "commit"}, {"oid": "9a12bcabc2424a210759e03fd9621e5f0b2ff79a", "url": "https://github.com/Azure/azure-sdk-for-java/commit/9a12bcabc2424a210759e03fd9621e5f0b2ff79a", "message": "Update core", "committedDate": "2020-12-14T19:05:02Z", "type": "commit"}, {"oid": "a79bb159c37c28fc5daaa10a26dfdbe9473d5b91", "url": "https://github.com/Azure/azure-sdk-for-java/commit/a79bb159c37c28fc5daaa10a26dfdbe9473d5b91", "message": "add condition for generating report", "committedDate": "2020-12-14T20:13:50Z", "type": "commit"}, {"oid": "22d24d44a3695217ade0469d33ceab7ea0f2a6c7", "url": "https://github.com/Azure/azure-sdk-for-java/commit/22d24d44a3695217ade0469d33ceab7ea0f2a6c7", "message": "Publish report for Windows only", "committedDate": "2020-12-14T20:37:25Z", "type": "commit"}, {"oid": "c097028d913042906994c63d393848359f6f125d", "url": "https://github.com/Azure/azure-sdk-for-java/commit/c097028d913042906994c63d393848359f6f125d", "message": "Clean up and prepare for PR", "committedDate": "2020-12-14T22:59:42Z", "type": "commit"}, {"oid": "d916d8a73ca67592b13053c4348a4f2eb7594598", "url": "https://github.com/Azure/azure-sdk-for-java/commit/d916d8a73ca67592b13053c4348a4f2eb7594598", "message": "use JavaTestVersion instead of JavaBuildVersion", "committedDate": "2020-12-14T23:23:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjkzMzg3NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18086#discussion_r542933874", "bodyText": "Why don't we make the profile additive? AKA it only defines dependencies and the Jacoco plugin", "author": "alzimmermsft", "createdAt": "2020-12-14T23:57:59Z", "path": "sdk/core/pom.xml", "diffHunk": "@@ -8,19 +8,137 @@\n   <artifactId>azure-core-service</artifactId>\n   <packaging>pom</packaging>\n   <version>1.0.0</version><!-- Need not change for every release-->\n-  <modules>\n-    <module>azure-core</module>\n-    <module>azure-core-amqp</module>\n-    <module>azure-core-amqp-experimental</module>\n-    <module>azure-core-experimental</module>\n-    <module>azure-core-http-jdk-httpclient</module>\n-    <module>azure-core-http-netty</module>\n-    <module>azure-core-http-okhttp</module>\n-    <module>azure-core-management</module>\n-    <module>azure-core-serializer-avro-apache</module>\n-    <module>azure-core-serializer-json-gson</module>\n-    <module>azure-core-serializer-json-jackson</module>\n-    <module>azure-core-test</module>\n-    <module>azure-core-tracing-opentelemetry</module>\n-  </modules>\n+\n+  <profiles>\n+    <!-- DO NOT CHANGE THE *ORDER* IN WHICH THESE PROFILES ARE DEFINED! -->\n+    <profile>", "originalCommit": "d916d8a73ca67592b13053c4348a4f2eb7594598", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjk0MDkxMQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18086#discussion_r542940911", "bodyText": "We also want to restrict the modules to track 2 modules and not include track 1 stuff.", "author": "srnagar", "createdAt": "2020-12-15T00:05:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjkzMzg3NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjkzNDQ0Mw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18086#discussion_r542934443", "bodyText": "Given this build configuration is going to be common across all service aggregator POMs we should think about making a parent POM for all of them and define this there instead of having 20-30 separate instantiations.", "author": "alzimmermsft", "createdAt": "2020-12-14T23:59:30Z", "path": "sdk/core/pom.xml", "diffHunk": "@@ -8,19 +8,137 @@\n   <artifactId>azure-core-service</artifactId>\n   <packaging>pom</packaging>\n   <version>1.0.0</version><!-- Need not change for every release-->\n-  <modules>\n-    <module>azure-core</module>\n-    <module>azure-core-amqp</module>\n-    <module>azure-core-amqp-experimental</module>\n-    <module>azure-core-experimental</module>\n-    <module>azure-core-http-jdk-httpclient</module>\n-    <module>azure-core-http-netty</module>\n-    <module>azure-core-http-okhttp</module>\n-    <module>azure-core-management</module>\n-    <module>azure-core-serializer-avro-apache</module>\n-    <module>azure-core-serializer-json-gson</module>\n-    <module>azure-core-serializer-json-jackson</module>\n-    <module>azure-core-test</module>\n-    <module>azure-core-tracing-opentelemetry</module>\n-  </modules>\n+\n+  <profiles>\n+    <!-- DO NOT CHANGE THE *ORDER* IN WHICH THESE PROFILES ARE DEFINED! -->\n+    <profile>\n+      <id>coverage</id>\n+      <modules>\n+        <module>azure-core</module>\n+        <module>azure-core-amqp</module>\n+        <module>azure-core-amqp-experimental</module>\n+        <module>azure-core-experimental</module>\n+        <module>azure-core-http-jdk-httpclient</module>\n+        <module>azure-core-http-netty</module>\n+        <module>azure-core-http-okhttp</module>\n+        <module>azure-core-management</module>\n+        <module>azure-core-serializer-avro-apache</module>\n+        <module>azure-core-serializer-json-gson</module>\n+        <module>azure-core-serializer-json-jackson</module>\n+        <module>azure-core-test</module>\n+        <module>azure-core-tracing-opentelemetry</module>\n+      </modules>\n+\n+      <dependencies>\n+        <dependency>\n+          <groupId>com.azure</groupId>\n+          <artifactId>azure-core</artifactId>\n+          <version>1.12.0-beta.1</version> <!-- {x-version-update;com.azure:azure-core;current} -->\n+        </dependency>\n+        <dependency>\n+          <groupId>com.azure</groupId>\n+          <artifactId>azure-core-amqp</artifactId>\n+          <version>2.1.0-beta.1</version> <!-- {x-version-update;com.azure:azure-core-amqp;current} -->\n+        </dependency>\n+        <dependency>\n+          <groupId>com.azure</groupId>\n+          <artifactId>azure-core-amqp-experimental</artifactId>\n+          <version>1.0.0-beta.1</version> <!-- {x-version-update;com.azure:azure-core-amqp-experimental;current} -->\n+        </dependency>\n+        <dependency>\n+          <groupId>com.azure</groupId>\n+          <artifactId>azure-core-experimental</artifactId>\n+          <version>1.0.0-beta.9</version> <!-- {x-version-update;com.azure:azure-core-experimental;current} -->\n+        </dependency>\n+        <dependency>\n+          <groupId>com.azure</groupId>\n+          <artifactId>azure-core-http-jdk-httpclient</artifactId>\n+          <version>1.0.0-beta.1</version> <!-- {x-version-update;com.azure:azure-core-http-jdk-httpclient;current} -->\n+        </dependency>\n+        <dependency>\n+          <groupId>com.azure</groupId>\n+          <artifactId>azure-core-http-netty</artifactId>\n+          <version>1.8.0-beta.1</version> <!-- {x-version-update;com.azure:azure-core-http-netty;current} -->\n+        </dependency>\n+        <dependency>\n+          <groupId>com.azure</groupId>\n+          <artifactId>azure-core-http-okhttp</artifactId>\n+          <version>1.5.0-beta.1</version> <!-- {x-version-update;com.azure:azure-core-http-okhttp;current} -->\n+        </dependency>\n+        <dependency>\n+          <groupId>com.azure</groupId>\n+          <artifactId>azure-core-management</artifactId>\n+          <version>1.1.0-beta.1</version> <!-- {x-version-update;com.azure:azure-core-management;current} -->\n+        </dependency>\n+        <dependency>\n+          <groupId>com.azure</groupId>\n+          <artifactId>azure-core-serializer-avro-apache</artifactId>\n+          <version>1.0.0-beta.6</version> <!-- {x-version-update;com.azure:azure-core-serializer-avro-apache;current} -->\n+        </dependency>\n+        <dependency>\n+          <groupId>com.azure</groupId>\n+          <artifactId>azure-core-serializer-json-gson</artifactId>\n+          <version>1.1.0-beta.1</version> <!-- {x-version-update;com.azure:azure-core-serializer-json-gson;current} -->\n+        </dependency>\n+        <dependency>\n+          <groupId>com.azure</groupId>\n+          <artifactId>azure-core-serializer-json-jackson</artifactId>\n+          <version>1.2.0-beta.1</version> <!-- {x-version-update;com.azure:azure-core-serializer-json-jackson;current} -->\n+        </dependency>\n+        <dependency>\n+          <groupId>com.azure</groupId>\n+          <artifactId>azure-core-tracing-opentelemetry</artifactId>\n+          <version>1.0.0-beta.7</version> <!-- {x-version-update;com.azure:azure-core-tracing-opentelemetry;current} -->\n+        </dependency>\n+      </dependencies>\n+\n+      <build>\n+        <plugins>\n+          <plugin>\n+            <groupId>org.jacoco</groupId>\n+            <artifactId>jacoco-maven-plugin</artifactId>\n+            <version>0.8.5</version> <!-- {x-version-update;org.jacoco:jacoco-maven-plugin;external_dependency} -->\n+            <executions>\n+              <execution>\n+                <id>report-aggregate</id>\n+                <phase>verify</phase>\n+                <goals>\n+                  <goal>report-aggregate</goal>\n+                </goals>\n+                <configuration>\n+                  <outputDirectory>${project.reporting.outputDirectory}/test-coverage</outputDirectory>\n+                  <excludes>\n+                    <exclude>**/com/azure/cosmos/implementation/apachecommons/**/*</exclude>\n+                    <exclude>**/com/azure/cosmos/implementation/guava25/**/*</exclude>\n+                    <exclude>**/com/azure/cosmos/implementation/guava27/**/*</exclude>\n+                  </excludes>\n+                </configuration>\n+              </execution>\n+            </executions>\n+          </plugin>\n+        </plugins>\n+      </build>", "originalCommit": "d916d8a73ca67592b13053c4348a4f2eb7594598", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjk0MTc1MA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18086#discussion_r542941750", "bodyText": "Having the parent pom would be my preference too but will hold off until someone from EngSys confirms that they are okay with adding another parent pom for service level pom.xml.", "author": "srnagar", "createdAt": "2020-12-15T00:06:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjkzNDQ0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDAwMzY4Ng==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18086#discussion_r544003686", "bodyText": "Adding a parent pom for core probably doesn't add a lot of value. If it wasn't something that we were going to apply broadly to other \"service areas\" as well I definitely wouldn't want to do it. It just makes automation a hodgepodge of special cases.", "author": "mitchdenny", "createdAt": "2020-12-16T06:03:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjkzNDQ0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDYxNzMzMg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18086#discussion_r544617332", "bodyText": "Discussed this with @mitchdenny offline and we decided not to have a parent pom for service areas as that would require shipping the parent pom to maven. So, we just have to duplicate the jacoco config.", "author": "srnagar", "createdAt": "2020-12-16T20:56:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjkzNDQ0Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjkzNTQ5NQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18086#discussion_r542935495", "bodyText": "Should we think of having a pom.data.xml, in a similar vain as we have pom.mgmt.xml to separate out Track 1 libraries from Track 2?", "author": "alzimmermsft", "createdAt": "2020-12-15T00:01:00Z", "path": "sdk/eventhubs/pom.xml", "diffHunk": "@@ -7,11 +7,68 @@\n   <artifactId>azure-eventhubs-service</artifactId>\n   <packaging>pom</packaging>\n   <version>1.0.0</version>  <!-- Need not change for every release-->\n-  <modules>\n-    <module>microsoft-azure-eventhubs</module>\n-    <module>microsoft-azure-eventhubs-eph</module>\n-    <module>microsoft-azure-eventhubs-extensions</module>\n-    <module>azure-messaging-eventhubs</module>\n-    <module>azure-messaging-eventhubs-checkpointstore-blob</module>\n-  </modules>\n+\n+  <profiles>\n+    <!-- DO NOT CHANGE THE *ORDER* IN WHICH THESE PROFILES ARE DEFINED! -->\n+    <profile>\n+      <id>coverage</id>\n+      <modules>\n+        <module>azure-messaging-eventhubs</module>\n+        <module>azure-messaging-eventhubs-checkpointstore-blob</module>\n+      </modules>\n+\n+      <dependencies>\n+        <dependency>\n+          <groupId>com.azure</groupId>\n+          <artifactId>azure-messaging-eventhubs</artifactId>\n+          <version>5.4.0-beta.2</version> <!-- {x-version-update;com.azure:azure-messaging-eventhubs;current} -->\n+        </dependency>\n+        <dependency>\n+          <groupId>com.azure</groupId>\n+          <artifactId>azure-messaging-eventhubs-checkpointstore-blob</artifactId>\n+          <version>1.4.0-beta.2</version> <!-- {x-version-update;com.azure:azure-messaging-eventhubs-checkpointstore-blob;current} -->\n+        </dependency>\n+      </dependencies>\n+\n+      <build>\n+        <plugins>\n+          <plugin>\n+            <groupId>org.jacoco</groupId>\n+            <artifactId>jacoco-maven-plugin</artifactId>\n+            <version>0.8.5</version> <!-- {x-version-update;org.jacoco:jacoco-maven-plugin;external_dependency} -->\n+            <executions>\n+              <execution>\n+                <id>report-aggregate</id>\n+                <phase>verify</phase>\n+                <goals>\n+                  <goal>report-aggregate</goal>\n+                </goals>\n+                <configuration>\n+                  <outputDirectory>${project.reporting.outputDirectory}/test-coverage</outputDirectory>\n+                  <excludes>\n+                    <exclude>**/com/azure/cosmos/implementation/apachecommons/**/*</exclude>\n+                    <exclude>**/com/azure/cosmos/implementation/guava25/**/*</exclude>\n+                    <exclude>**/com/azure/cosmos/implementation/guava27/**/*</exclude>\n+                  </excludes>\n+                </configuration>\n+              </execution>\n+            </executions>\n+          </plugin>\n+        </plugins>\n+      </build>\n+    </profile>\n+    <profile>\n+      <id>default</id>\n+      <activation>\n+        <activeByDefault>true</activeByDefault>\n+      </activation>\n+      <modules>\n+        <module>microsoft-azure-eventhubs</module>\n+        <module>microsoft-azure-eventhubs-eph</module>\n+        <module>microsoft-azure-eventhubs-extensions</module>", "originalCommit": "d916d8a73ca67592b13053c4348a4f2eb7594598", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjk0MjAwMw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18086#discussion_r542942003", "bodyText": "That's another question for EngSys.", "author": "srnagar", "createdAt": "2020-12-15T00:06:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjkzNTQ5NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDYxNzk0NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18086#discussion_r544617944", "bodyText": "This may be out of scope for this PR.", "author": "srnagar", "createdAt": "2020-12-16T20:57:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjkzNTQ5NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjkzODM0NQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18086#discussion_r542938345", "bodyText": "Do we only want to run this on Windows or Linux? Linux would run much faster, if that is a concern.", "author": "alzimmermsft", "createdAt": "2020-12-15T00:03:18Z", "path": "eng/pipelines/templates/jobs/archetype-sdk-client.yml", "diffHunk": "@@ -306,6 +306,20 @@ jobs:\n         # we want to run this when TestFromSource isn't true\n         condition: and(succeeded(), ne(variables['TestFromSource'],'true'))\n \n+      - task: Maven@3\n+        displayName: 'Generate aggregate code coverage report'\n+        condition: and(eq(variables['OsName'], 'Windows'), eq(variables['JavaTestVersion'], '1.11'))", "originalCommit": "d916d8a73ca67592b13053c4348a4f2eb7594598", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjk0NDQ2Nw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18086#discussion_r542944467", "bodyText": "Well, only one job can publish the report. If multiple jobs publish, the last one wins and invariably the \"Build from source\" job that runs on Linux and JDK 11 will be the last and publishes empty results. Given that this is only collecting report from already created jacoco reports from individual modules, speed is not a huge concern and Windows or Linux doesn't make a huge difference.", "author": "srnagar", "createdAt": "2020-12-15T00:09:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjkzODM0NQ=="}], "type": "inlineReview"}, {"oid": "f6276e462a8ca9d0a51540a22234b99309db1391", "url": "https://github.com/Azure/azure-sdk-for-java/commit/f6276e462a8ca9d0a51540a22234b99309db1391", "message": "Run for core only", "committedDate": "2020-12-16T18:47:50Z", "type": "commit"}, {"oid": "2cee1a0519d7ca59c93c78efb60ba9510382801c", "url": "https://github.com/Azure/azure-sdk-for-java/commit/2cee1a0519d7ca59c93c78efb60ba9510382801c", "message": "Run for core only", "committedDate": "2020-12-16T19:02:19Z", "type": "commit"}, {"oid": "73d9d8dc61ef2be04b615043f3a5144e8ecf5169", "url": "https://github.com/Azure/azure-sdk-for-java/commit/73d9d8dc61ef2be04b615043f3a5144e8ecf5169", "message": "Enable coverage for template", "committedDate": "2020-12-16T19:59:21Z", "type": "commit"}, {"oid": "d4abc6f43b28b11711dd57ab8ecce583dcd7a0e3", "url": "https://github.com/Azure/azure-sdk-for-java/commit/d4abc6f43b28b11711dd57ab8ecce583dcd7a0e3", "message": "Fix param name", "committedDate": "2020-12-16T20:17:14Z", "type": "commit"}, {"oid": "a1c709349d49c348ffbe01e93fc4c41572da50a5", "url": "https://github.com/Azure/azure-sdk-for-java/commit/a1c709349d49c348ffbe01e93fc4c41572da50a5", "message": "Fix var name format", "committedDate": "2020-12-16T20:28:18Z", "type": "commit"}, {"oid": "84b1a6fd9df063bfca47a295554ef5ea3a75354c", "url": "https://github.com/Azure/azure-sdk-for-java/commit/84b1a6fd9df063bfca47a295554ef5ea3a75354c", "message": "Enable coverage report for template only", "committedDate": "2020-12-16T20:54:33Z", "type": "commit"}]}