{"pr_number": 11195, "pr_title": "share artifact staging. add release stage", "pr_createdAt": "2020-05-14T22:02:30Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/11195", "timeline": [{"oid": "a27e04a5f9610fcc512b9afcf22d4c02edd9dbb4", "url": "https://github.com/Azure/azure-sdk-for-java/commit/a27e04a5f9610fcc512b9afcf22d4c02edd9dbb4", "message": "share artifact staging. add release stage", "committedDate": "2020-05-14T22:01:54Z", "type": "commit"}, {"oid": "fbbad4a8ec28a24a097eb85d5deda314025de7dc", "url": "https://github.com/Azure/azure-sdk-for-java/commit/fbbad4a8ec28a24a097eb85d5deda314025de7dc", "message": "update default argument", "committedDate": "2020-05-14T22:58:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTQ5MDQyNQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11195#discussion_r425490425", "bodyText": "orthogonal to your change but we probably should see about moving these to the latest windows image, windows-2019", "author": "weshaggard", "createdAt": "2020-05-14T23:48:27Z", "path": "eng/pipelines/templates/stages/archetype-java-release.yml", "diffHunk": "@@ -85,21 +87,58 @@ stages:\n                 deploy:\n                   steps:\n                     - checkout: self\n-                    - pwsh: |\n-                        Get-ChildItem $(Pipeline.Workspace)/${{parameters.ArtifactName}}-signed\n-                        New-Item -Type Directory -Name ${{artifact.safeName}} -Path $(Pipeline.Workspace)\n-                        Copy-Item $(Pipeline.Workspace)/${{parameters.ArtifactName}}-signed/${{artifact.name}}-[0-9]*.[0-9]*.[0-9]* $(Pipeline.Workspace)/${{artifact.safeName}}\n-                        Get-ChildItem $(Pipeline.Workspace)/${{artifact.safeName}}\n-                      workingDirectory: $(Pipeline.Workspace)\n+                    - template: /eng/pipelines/templates/steps/stage-filtered-artifacts.yml\n+                      parameters:\n+                        SourceFolder: ${{parameters.ArtifactName}} \n+                        TargetFolder: ${{artifact.safeName}}\n+                        PackageName: ${{artifact.name}}\n                       displayName: Stage artifacts\n-                      timeoutInMinutes: 5\n                     - template: /eng/common/pipelines/templates/steps/create-tags-and-git-release.yml\n                       parameters:\n                         ArtifactLocation: $(Pipeline.Workspace)/${{artifact.safeName}}\n                         PackageRepository: Maven\n                         ReleaseSha: $(Build.SourceVersion)\n                         RepoId: Azure/azure-sdk-for-java\n \n+\n+          - ${{if ne(artifact.options.skipPublishDocs, 'true')}}:\n+            - deployment: PublicDocsMs\n+              displayName: \"Publish Updates for Docs.MS\"\n+              condition: and(succeeded(), ne(variables['Skip.PublishDocs'], 'true'))\n+              environment: github\n+              timeoutInMinutes: 5\n+              dependsOn: VerifyReleaseVersion\n+\n+              pool:\n+                vmImage: vs2017-win2016", "originalCommit": "fbbad4a8ec28a24a097eb85d5deda314025de7dc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "af6fe4ed4018fd9f07c3ddb921cbf015153647ad", "url": "https://github.com/Azure/azure-sdk-for-java/commit/af6fe4ed4018fd9f07c3ddb921cbf015153647ad", "message": "update target doc repository", "committedDate": "2020-05-15T00:11:36Z", "type": "commit"}, {"oid": "dada083a5314265353be2295989d8dd4a758346a", "url": "https://github.com/Azure/azure-sdk-for-java/commit/dada083a5314265353be2295989d8dd4a758346a", "message": "swap everything to use the signed artifacts", "committedDate": "2020-05-15T18:10:06Z", "type": "commit"}, {"oid": "bc012f34572b606153587a5c77db97e6fdefdebf", "url": "https://github.com/Azure/azure-sdk-for-java/commit/bc012f34572b606153587a5c77db97e6fdefdebf", "message": "get rid of erroneous objects", "committedDate": "2020-05-18T21:39:38Z", "type": "commit"}, {"oid": "401934523452814d673514a702914d29f571db6e", "url": "https://github.com/Azure/azure-sdk-for-java/commit/401934523452814d673514a702914d29f571db6e", "message": "resolve bad yml", "committedDate": "2020-05-18T22:24:19Z", "type": "commit"}, {"oid": "f08dd665a6e31336e24102cf30d677a2d942730c", "url": "https://github.com/Azure/azure-sdk-for-java/commit/f08dd665a6e31336e24102cf30d677a2d942730c", "message": "commenting publish for easy execution. bumping template version for easy test of the release functionality", "committedDate": "2020-05-18T22:36:37Z", "type": "commit"}, {"oid": "cede1333dc1ae1671ed156e95f046a4acfa11fec", "url": "https://github.com/Azure/azure-sdk-for-java/commit/cede1333dc1ae1671ed156e95f046a4acfa11fec", "message": "updating versions so this can actually launch", "committedDate": "2020-05-19T00:09:02Z", "type": "commit"}, {"oid": "bb6e832ac2782c9d663b65cdf38cf994c9f84365", "url": "https://github.com/Azure/azure-sdk-for-java/commit/bb6e832ac2782c9d663b65cdf38cf994c9f84365", "message": "set dependsOn value for update docs.ms to publishpackage", "committedDate": "2020-05-19T01:07:29Z", "type": "commit"}, {"oid": "a5574ffc7ec6fa0e92a7600502ceb76a191b7baa", "url": "https://github.com/Azure/azure-sdk-for-java/commit/a5574ffc7ec6fa0e92a7600502ceb76a191b7baa", "message": "re-enable publishing to maven. artifact staging seems to be working appropriately", "committedDate": "2020-05-19T01:07:58Z", "type": "commit"}, {"oid": "a72537c20aeae8b028b26ec7b46c6033d4bdc6b4", "url": "https://github.com/Azure/azure-sdk-for-java/commit/a72537c20aeae8b028b26ec7b46c6033d4bdc6b4", "message": "Update CHANGELOG.md\n\n1.0.4-beta.15 is \"Unreleased\", it wasn't released yesterday.", "committedDate": "2020-05-19T13:42:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzQ2OTA5NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11195#discussion_r427469094", "bodyText": "We should consider adding the \"-signed\" as part of the template.", "author": "weshaggard", "createdAt": "2020-05-19T17:19:36Z", "path": "eng/pipelines/templates/stages/archetype-java-release.yml", "diffHunk": "@@ -85,14 +87,11 @@ stages:\n                 deploy:\n                   steps:\n                     - checkout: self\n-                    - pwsh: |\n-                        Get-ChildItem $(Pipeline.Workspace)/${{parameters.ArtifactName}}-signed\n-                        New-Item -Type Directory -Name ${{artifact.safeName}} -Path $(Pipeline.Workspace)\n-                        Copy-Item $(Pipeline.Workspace)/${{parameters.ArtifactName}}-signed/${{artifact.name}}-[0-9]*.[0-9]*.[0-9]* $(Pipeline.Workspace)/${{artifact.safeName}}\n-                        Get-ChildItem $(Pipeline.Workspace)/${{artifact.safeName}}\n-                      workingDirectory: $(Pipeline.Workspace)\n-                      displayName: Stage artifacts\n-                      timeoutInMinutes: 5\n+                    - template: /eng/pipelines/templates/steps/stage-artifacts.yml\n+                      parameters:\n+                        SourceFolder: ${{parameters.ArtifactName}}-signed", "originalCommit": "a72537c20aeae8b028b26ec7b46c6033d4bdc6b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzYxNTM4Nw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11195#discussion_r427615387", "bodyText": "That's fair. I'm not making any further changes on this PR.", "author": "scbedd", "createdAt": "2020-05-19T21:37:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzQ2OTA5NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzY0NTQ1NQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11195#discussion_r427645455", "bodyText": "That's fair. I am not going to make further changes to this PR at this time.", "author": "scbedd", "createdAt": "2020-05-19T22:54:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzQ2OTA5NA=="}], "type": "inlineReview"}]}