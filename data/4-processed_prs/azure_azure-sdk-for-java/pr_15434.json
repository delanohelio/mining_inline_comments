{"pr_number": 15434, "pr_title": "Upgrade to spring cosmos track 2 library", "pr_createdAt": "2020-09-22T01:33:51Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/15434", "timeline": [{"oid": "cc48c2f5fda18f5d0e0694bd7100add1815a47eb", "url": "https://github.com/Azure/azure-sdk-for-java/commit/cc48c2f5fda18f5d0e0694bd7100add1815a47eb", "message": "upgrade to spring cosmos track 2", "committedDate": "2020-09-21T06:15:20Z", "type": "commit"}, {"oid": "c754092f1beafa2751c7b80647228b4f8f84c55f", "url": "https://github.com/Azure/azure-sdk-for-java/commit/c754092f1beafa2751c7b80647228b4f8f84c55f", "message": "rename cosmos track 2 library", "committedDate": "2020-09-21T10:46:08Z", "type": "commit"}, {"oid": "4187ce3c38b3a11412c895232e2d637f929e1b44", "url": "https://github.com/Azure/azure-sdk-for-java/commit/4187ce3c38b3a11412c895232e2d637f929e1b44", "message": "fix broken link", "committedDate": "2020-09-22T02:04:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjQzODIwOQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15434#discussion_r492438209", "bodyText": "do we need to add the venv here? I'm not sure whether we have the standard for python virtual env or not", "author": "zhoufenqin", "createdAt": "2020-09-22T01:59:44Z", "path": ".gitignore", "diffHunk": "@@ -80,3 +80,6 @@ jacoco.exec\n \n # Generated client pom file\n ClientAggregatePom.xml\n+\n+# Anaconda virtual env\n+venv", "originalCommit": "c754092f1beafa2751c7b80647228b4f8f84c55f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjQ0MDg2Mw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15434#discussion_r492440863", "bodyText": "there are some python files in our repo, I have setuped the anaconda env to execute version schema scripts.", "author": "moarychan", "createdAt": "2020-09-22T02:12:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjQzODIwOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjQzOTEwOA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15434#discussion_r492439108", "bodyText": "we need to add <!-- embedme ../azure-spring-boot/src/samples/java/com/azure/spring/cosmosdb/User.java#L10-L65 --> around code block, it helps us to check the code change", "author": "zhoufenqin", "createdAt": "2020-09-22T02:04:09Z", "path": "sdk/spring/azure-spring-boot-starter-cosmos/README.md", "diffHunk": "@@ -76,13 +70,12 @@ Include actuator dependencies.\n </dependency>\n ```\n \n-Call `http://{hostname}:{port}/actuator/health/cosmos` to get the CosmosDB health info. **Please note**: it will calculate [RUs](https://docs.microsoft.com/azure/cosmos-db/request-units).\n+Call `http://{hostname}:{port}/actuator/health/cosmos` to get the Cosmos DB health info. **Please note**: it will calculate [RUs](https://docs.microsoft.com/azure/cosmos-db/request-units).\n \n ### Define an entity\n Define a simple entity as Document in Cosmos DB.\n-<!-- embedme ../azure-spring-boot/src/samples/java/com/azure/spring/cosmosdb/User.java#L10-L65 -->\n ```java", "originalCommit": "c754092f1beafa2751c7b80647228b4f8f84c55f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjQ0MTM0MA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15434#discussion_r492441340", "bodyText": "oh, I got it wrong and thought it was the old path, OK, I will add back here", "author": "moarychan", "createdAt": "2020-09-22T02:15:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjQzOTEwOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjQ0MzA3NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15434#discussion_r492443074", "bodyText": "@zhoufenqin  I also removed the description of properties supportting , azure.cosmosdb.consistency-level & azure.cosmosdb.cosmosKeyCredential, please help review.", "author": "moarychan", "createdAt": "2020-09-22T02:24:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjQzOTEwOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjQ0MDQwOQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15434#discussion_r492440409", "bodyText": "you update your-cosmosdb-uri to your-cosmos-uri in application.properties, I think it should be updated here too. key/database is same", "author": "zhoufenqin", "createdAt": "2020-09-22T02:10:33Z", "path": "sdk/spring/azure-spring-boot-samples/azure-spring-cloud-appconfiguration-conversion-sample-initial/README.md", "diffHunk": "@@ -86,9 +86,9 @@ In this section, you clone a containerized Spring Boot application and test it l\n 1. Replace below properties in `application.properties` with information from your database.\n \n    ```properties\n-   azure.cosmosdb.uri=your-cosmosdb-uri\n-   azure.cosmosdb.key=your-cosmosdb-key\n-   azure.cosmosdb.database=your-cosmosdb-databasename\n+   azure.cosmos.uri=your-cosmosdb-uri\n+   azure.cosmos.key=your-cosmosdb-key\n+   azure.cosmos.database=your-cosmosdb-databasename\n ", "originalCommit": "4187ce3c38b3a11412c895232e2d637f929e1b44", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjQ0MTY0OA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15434#discussion_r492441648", "bodyText": "Got it.", "author": "moarychan", "createdAt": "2020-09-22T02:16:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjQ0MDQwOQ=="}], "type": "inlineReview"}, {"oid": "50444f927b120adc2284f5d33e679c723f4d31a4", "url": "https://github.com/Azure/azure-sdk-for-java/commit/50444f927b120adc2284f5d33e679c723f4d31a4", "message": "update according reviewer comments", "committedDate": "2020-09-22T02:40:05Z", "type": "commit"}, {"oid": "499f2968c262a1a1c72b4a35fb5962b84eed31c0", "url": "https://github.com/Azure/azure-sdk-for-java/commit/499f2968c262a1a1c72b4a35fb5962b84eed31c0", "message": "add back cosmos properties configuration", "committedDate": "2020-09-22T06:44:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjYyNDI5Ng==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15434#discussion_r492624296", "bodyText": "we should keep the Azure Cosmos DB here", "author": "saragluna", "createdAt": "2020-09-22T10:17:43Z", "path": "sdk/spring/azure-spring-boot-samples/azure-cloud-foundry-service-sample/src/main/resources/static/index.html", "diffHunk": "@@ -2,7 +2,7 @@\n <body>\n <div>Demos:</div>\n <ol>\n-    <li><a href='/cosmosdb'>CosmosDB Demo stores a new User record in Azure Cosmos DB.</a></li>\n+    <li><a href='/cosmos'>Cosmos Demo stores a new User record in Azure Cosmos.</a></li>", "originalCommit": "499f2968c262a1a1c72b4a35fb5962b84eed31c0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjYyNTc0Ng==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15434#discussion_r492625746", "bodyText": "Didn't we change this artifact ID to azure-spring-boot-starter-cosmos?", "author": "saragluna", "createdAt": "2020-09-22T10:20:29Z", "path": "sdk/spring/azure-spring-boot-samples/azure-spring-boot-sample-cosmos/README.md", "diffHunk": "@@ -1,7 +1,7 @@\n # Sample for Azure Cosmos DB Spring Boot client library for Java\n \n ## Key concepts\n-This sample project demonstrates how to use Azure CosmosDB via Spring Boot Starter `azure-cosmosdb-spring-boot-starter` to store data in and retrieve data from your Azure Cosmos DB.\n+This sample project demonstrates how to use Azure Cosmos DB via Spring Boot Starter `azure-cosmos-spring-boot-starter` to store data in and retrieve data from your Azure Cosmos DB.", "originalCommit": "499f2968c262a1a1c72b4a35fb5962b84eed31c0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjYyNzc5NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15434#discussion_r492627794", "bodyText": "Call it Cosmos DB here.", "author": "saragluna", "createdAt": "2020-09-22T10:24:30Z", "path": "sdk/spring/azure-spring-boot-samples/azure-spring-boot-sample-cosmos/src/main/java/com/azure/cosmos/CosmosSampleApplication.java", "diffHunk": "@@ -30,7 +30,7 @@ public static void main(String[] args) {\n     public void run(String... var1) throws Exception {\n         final User testUser = new User(\"testId\", \"testFirstName\", \"testLastName\", \"test address line one\");\n \n-        // Save the User class to Azure CosmosDB database.\n+        // Save the User class to Azure Cosmos database.", "originalCommit": "499f2968c262a1a1c72b4a35fb5962b84eed31c0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjYyODQyMw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15434#discussion_r492628423", "bodyText": "Same here.", "author": "saragluna", "createdAt": "2020-09-22T10:25:39Z", "path": "sdk/spring/azure-spring-boot-samples/azure-spring-cloud-appconfiguration-conversion-sample-complete/src/main/java/sample/convert/ConvertSampleApplication.java", "diffHunk": "@@ -35,7 +35,7 @@ public void run(String... var1) throws Exception {\n         final User testUser = new User(\"testId\", \"testFirstName\", \"testLastName\",\n                 \"test address line one\");\n \n-        // Save the User class to Azure CosmosDB database.\n+        // Save the User class to Azure Cosmos database.\n         final Mono<User> saveUserMono = repository.save(testUser);", "originalCommit": "499f2968c262a1a1c72b4a35fb5962b84eed31c0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjYyOTA3Ng==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15434#discussion_r492629076", "bodyText": "So this will bring breaking changes.", "author": "saragluna", "createdAt": "2020-09-22T10:27:00Z", "path": "sdk/spring/azure-spring-boot-samples/azure-spring-cloud-appconfiguration-conversion-sample-initial/README.md", "diffHunk": "@@ -86,9 +86,9 @@ In this section, you clone a containerized Spring Boot application and test it l\n 1. Replace below properties in `application.properties` with information from your database.\n \n    ```properties\n-   azure.cosmosdb.uri=your-cosmosdb-uri\n-   azure.cosmosdb.key=your-cosmosdb-key\n-   azure.cosmosdb.database=your-cosmosdb-databasename\n+   azure.cosmos.uri=your-cosmos-uri", "originalCommit": "499f2968c262a1a1c72b4a35fb5962b84eed31c0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzEzODk5MQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15434#discussion_r493138991", "bodyText": "should change back to azure.cosmosdb.xxx?", "author": "moarychan", "createdAt": "2020-09-23T01:50:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjYyOTA3Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjYyOTMxNA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15434#discussion_r492629314", "bodyText": "Same here.", "author": "saragluna", "createdAt": "2020-09-22T10:27:33Z", "path": "sdk/spring/azure-spring-boot-samples/azure-spring-cloud-appconfiguration-conversion-sample-initial/src/main/java/sample/convert/ConvertSampleApplication.java", "diffHunk": "@@ -33,7 +33,7 @@ public void run(String... var1) throws Exception {\n         final User testUser = new User(\"testId\", \"testFirstName\", \"testLastName\",\n             \"test address line one\");\n \n-        // Save the User class to Azure CosmosDB database.\n+        // Save the User class to Azure Cosmos database.", "originalCommit": "499f2968c262a1a1c72b4a35fb5962b84eed31c0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjYyOTc5Mw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15434#discussion_r492629793", "bodyText": "I prefer databasename here.", "author": "saragluna", "createdAt": "2020-09-22T10:28:31Z", "path": "sdk/spring/azure-spring-boot-samples/azure-spring-cloud-appconfiguration-conversion-sample-initial/src/main/resources/application.properties", "diffHunk": "@@ -1,3 +1,3 @@\n-azure.cosmosdb.uri=your-cosmosdb-uri\n-azure.cosmosdb.key=your-cosmosdb-key\n-azure.cosmosdb.database=your-cosmosdb-databasename\n+azure.cosmos.uri=your-cosmos-uri\n+azure.cosmos.key=your-cosmos-key\n+azure.cosmos.database=your-cosmos-database-name", "originalCommit": "499f2968c262a1a1c72b4a35fb5962b84eed31c0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjYzMDA0MQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15434#discussion_r492630041", "bodyText": "Same here.", "author": "saragluna", "createdAt": "2020-09-22T10:29:01Z", "path": "sdk/spring/azure-spring-boot-starter-cosmos/README.md", "diffHunk": "@@ -47,19 +47,18 @@\n Open `application.properties` file and add below properties with your Cosmos DB credentials.\n \n ```properties\n-azure.cosmosdb.uri=your-cosmosdb-uri\n-azure.cosmosdb.key=your-cosmosdb-key\n-azure.cosmosdb.database=your-cosmosdb-databasename\n+azure.cosmos.uri=your-cosmos-uri\n+azure.cosmos.key=your-cosmos-key\n+azure.cosmos.database=your-cosmos-database-name\n ```", "originalCommit": "499f2968c262a1a1c72b4a35fb5962b84eed31c0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjYzMTIxNg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15434#discussion_r492631216", "bodyText": "Use DB instead of Db here please.", "author": "saragluna", "createdAt": "2020-09-22T10:31:11Z", "path": "sdk/spring/azure-spring-boot-starter-cosmos/README.md", "diffHunk": "@@ -231,11 +230,11 @@ For more information about setting loging in pring, please refer to the [officia\n \n ## Next steps\n \n-Besides using this Azure CosmosDb Spring Boot Starter, you can directly use Spring Data for Azure CosmosDb package for more complex scenarios. Please refer to [Spring Data for Azure CosmosDB](https://github.com/Azure/azure-sdk-for-java/tree/master/sdk/cosmos/azure-spring-data-cosmos) for more details.\n+Besides using this Azure Cosmos DB Spring Boot Starter, you can directly use Spring Data for Azure Cosmos Db package for more complex scenarios. Please refer to [Spring Data for Azure Cosmos DB](https://github.com/Azure/azure-sdk-for-java/tree/master/sdk/cosmos/azure-spring-data-cosmos) for more details.", "originalCommit": "499f2968c262a1a1c72b4a35fb5962b84eed31c0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjYzMjA1MQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15434#discussion_r492632051", "bodyText": "Didn't we change this artifact ID?", "author": "saragluna", "createdAt": "2020-09-22T10:32:57Z", "path": "sdk/spring/azure-spring-boot-starter/README.md", "diffHunk": "@@ -36,7 +36,8 @@ Starter Name | Version for Spring Boot 2.3.x | Version for Spring Boot 2.2.x | V\n [spring-starter-azure-storage](https://github.com/Azure/azure-sdk-for-java/blob/master/sdk/spring/azure-spring-starter-storage/README.md) | [![Maven Central](https://img.shields.io/maven-central/v/com.microsoft.azure/spring-starter-azure-storage.svg)](https://search.maven.org/search?q=g:com.microsoft.azure%20AND%20%20a:spring-starter-azure-storage) | N/A | N/A | N/A\n [azure-keyvault-secrets-spring-boot-starter](https://github.com/Azure/azure-sdk-for-java/blob/master/sdk/spring/azure-spring-boot-starter-keyvault-secrets/README.md) | [![Maven Central](https://img.shields.io/maven-central/v/com.microsoft.azure/azure-keyvault-secrets-spring-boot-starter.svg)](http://search.maven.org/#search%7Cga%7C1%7Cg%3A%22com.microsoft.azure%22%20AND%20a%3A%22azure-keyvault-secrets-spring-boot-starter%22) | [![Maven Central](https://img.shields.io/maven-central/v/com.microsoft.azure/azure-keyvault-secrets-spring-boot-starter/2.2.svg)](https://search.maven.org/search?q=g:com.microsoft.azure%20AND%20a:azure-keyvault-secrets-spring-boot-starter%20AND%20v:2.2.*) | [![](https://img.shields.io/maven-central/v/com.microsoft.azure/azure-keyvault-secrets-spring-boot-starter/2.1.svg)](https://search.maven.org/search?q=g:com.microsoft.azure%20AND%20a:azure-keyvault-secrets-spring-boot-starter%20AND%20v:2.1.*) | [![](https://img.shields.io/maven-central/v/com.microsoft.azure/azure-keyvault-secrets-spring-boot-starter/2.0.svg)](https://search.maven.org/search?q=g:com.microsoft.azure%20AND%20a:azure-keyvault-secrets-spring-boot-starter%20AND%20v:2.0.*)\n [azure-active-directory-b2c-spring-boot-starter](https://github.com/Azure/azure-sdk-for-java/blob/master/sdk/spring/azure-spring-boot-starter-active-directory-b2c/README.md) | [![Maven Central](https://img.shields.io/maven-central/v/com.microsoft.azure/azure-active-directory-b2c-spring-boot-starter.svg)](http://search.maven.org/#search%7Cga%7C1%7Cg%3A%22com.microsoft.azure%22%20AND%20a%3A%22azure-active-directory-b2c-spring-boot-starter%22) | [![Maven Central](https://img.shields.io/maven-central/v/com.microsoft.azure/azure-active-directory-b2c-spring-boot-starter/2.2.svg)](https://search.maven.org/search?q=g:com.microsoft.azure%20AND%20a:azure-active-directory-b2c-spring-boot-starter%20AND%20v:2.2.*) | [![Maven Central](https://img.shields.io/maven-central/v/com.microsoft.azure/azure-active-directory-b2c-spring-boot-starter/2.1.svg)](https://search.maven.org/search?q=g:com.microsoft.azure%20AND%20a:azure-active-directory-b2c-spring-boot-starter%20AND%20v:2.1.*) | N/A\n-[azure-cosmosdb-spring-boot-starter](https://github.com/Azure/azure-sdk-for-java/blob/master/sdk/spring/azure-spring-boot-starter-cosmosdb/README.md) | [![Maven Central](https://img.shields.io/maven-central/v/com.microsoft.azure/azure-cosmosdb-spring-boot-starter.svg)](http://search.maven.org/#search%7Cga%7C1%7Cg%3A%22com.microsoft.azure%22%20AND%20a%3A%22azure-cosmosdb-spring-boot-starter%22) | [![Maven Central](https://img.shields.io/maven-central/v/com.microsoft.azure/azure-cosmosdb-spring-boot-starter/2.2.svg)](https://search.maven.org/search?q=g:com.microsoft.azure%20AND%20a:azure-cosmosdb-spring-boot-starter%20AND%20v:2.2.*) | [![](https://img.shields.io/maven-central/v/com.microsoft.azure/azure-cosmosdb-spring-boot-starter/2.1.svg)](https://search.maven.org/search?q=g:com.microsoft.azure%20AND%20a:azure-cosmosdb-spring-boot-starter%20AND%20v:2.1.*) | [![](https://img.shields.io/maven-central/v/com.microsoft.azure/azure-cosmosdb-spring-boot-starter/2.0.svg)](https://search.maven.org/search?q=g:com.microsoft.azure%20AND%20a:azure-cosmosdb-spring-boot-starter%20AND%20v:2.0.*)\n+azure-cosmosdb-spring-boot-starter | [![Maven Central](https://img.shields.io/maven-central/v/com.microsoft.azure/azure-cosmosdb-spring-boot-starter.svg)](http://search.maven.org/#search%7Cga%7C1%7Cg%3A%22com.microsoft.azure%22%20AND%20a%3A%22azure-cosmosdb-spring-boot-starter%22) | [![Maven Central](https://img.shields.io/maven-central/v/com.microsoft.azure/azure-cosmosdb-spring-boot-starter/2.2.svg)](https://search.maven.org/search?q=g:com.microsoft.azure%20AND%20a:azure-cosmosdb-spring-boot-starter%20AND%20v:2.2.*) | [![](https://img.shields.io/maven-central/v/com.microsoft.azure/azure-cosmosdb-spring-boot-starter/2.1.svg)](https://search.maven.org/search?q=g:com.microsoft.azure%20AND%20a:azure-cosmosdb-spring-boot-starter%20AND%20v:2.1.*) | [![](https://img.shields.io/maven-central/v/com.microsoft.azure/azure-cosmosdb-spring-boot-starter/2.0.svg)](https://search.maven.org/search?q=g:com.microsoft.azure%20AND%20a:azure-cosmosdb-spring-boot-starter%20AND%20v:2.0.*)\n+[azure-cosmos-spring-boot-starter](https://github.com/Azure/azure-sdk-for-java/blob/master/sdk/spring/azure-spring-boot-starter-cosmos/README.md) | N/A | N/A | N/A | N/A", "originalCommit": "499f2968c262a1a1c72b4a35fb5962b84eed31c0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjYzMzgyNg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15434#discussion_r492633826", "bodyText": "We didn't change this package name in this PR?", "author": "saragluna", "createdAt": "2020-09-22T10:36:14Z", "path": "sdk/spring/azure-spring-boot/src/main/java/com/microsoft/azure/spring/autoconfigure/cosmos/CosmosAutoConfiguration.java", "diffHunk": "@@ -0,0 +1,53 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.microsoft.azure.spring.autoconfigure.cosmos;", "originalCommit": "499f2968c262a1a1c72b4a35fb5962b84eed31c0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzEyNTEyNA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15434#discussion_r493125124", "bodyText": "Jack Wu will change it later.", "author": "moarychan", "createdAt": "2020-09-23T01:28:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjYzMzgyNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjYzNDk4Ng==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15434#discussion_r492634986", "bodyText": "Just to double check, is this ID the ID of the database?", "author": "saragluna", "createdAt": "2020-09-22T10:38:28Z", "path": "sdk/spring/azure-spring-boot/src/main/java/com/microsoft/azure/spring/autoconfigure/cosmos/CosmosHealthIndicator.java", "diffHunk": "@@ -21,32 +21,32 @@\n public class CosmosHealthIndicator extends AbstractHealthIndicator {\n \n     private static final Logger LOGGER = LoggerFactory.getLogger(CosmosHealthIndicator.class);\n-    @Value(\"${azure.cosmosdb.database}\")\n+    @Value(\"${azure.cosmos.database}\")\n     private String dbName;\n-    @Value(\"${azure.cosmosdb.uri}\")\n+    @Value(\"${azure.cosmos.uri}\")\n     private String uri;\n \n     @Autowired\n     private CosmosClient cosmosClient;\n \n     public CosmosHealthIndicator(CosmosClient cosmosClient) {\n-        super(\"CosmosDB health check failed\");\n+        super(\"Cosmos health check failed\");\n         Assert.notNull(cosmosClient, \"CosmosClient must not be null\");\n         this.cosmosClient = cosmosClient;\n     }\n \n     @Override\n     protected void doHealthCheck(Builder builder) throws Exception {\n-        CosmosDatabaseResponse response = this.cosmosClient.getDatabase(dbName).read().block();\n+        CosmosDatabaseResponse response = this.cosmosClient.getDatabase(dbName).read();\n \n         if (response != null) {\n             LOGGER.info(\"The health indicator cost {} RUs, cosmos uri: {}, dbName: {}\",\n-                response.requestCharge(), uri, dbName);\n+                response.getRequestCharge(), uri, dbName);\n         }\n         if (response == null) {\n             builder.down();\n         } else {\n-            builder.up().withDetail(\"database\", response.database().id());\n+            builder.up().withDetail(\"database\", response.getProperties().getId());\n         }", "originalCommit": "499f2968c262a1a1c72b4a35fb5962b84eed31c0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzEyNjc5MA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15434#discussion_r493126790", "bodyText": "yes,\n    /**\n     * Gets the cosmos database properties\n     *\n     * @return the cosmos database properties\n     */\n    public CosmosDatabaseProperties getProperties() {\n        return super.getProperties();\n    }\n\n    /**\n     * Gets the name of the resource.\n     *\n     * @return the name of the resource.\n     */\n    public String getId() {\n        return this.database.getId();\n    }", "author": "moarychan", "createdAt": "2020-09-23T01:31:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjYzNDk4Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjYzNjkwMA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15434#discussion_r492636900", "bodyText": "Same here.", "author": "saragluna", "createdAt": "2020-09-22T10:42:38Z", "path": "sdk/spring/azure-spring-boot/src/samples/java/com/azure/spring/cosmos/CosmosSampleApplication.java", "diffHunk": "@@ -30,7 +30,7 @@ public static void main(String[] args) {\n     public void run(String... var1) {\n         final User testUser = new User(\"testId\", \"testFirstName\", \"testLastName\", \"test address line one\");\n \n-        // Save the User class to Azure CosmosDB database.\n+        // Save the User class to Azure Cosmos database.", "originalCommit": "499f2968c262a1a1c72b4a35fb5962b84eed31c0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjYzNzk0Ng==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15434#discussion_r492637946", "bodyText": "How do we configure the connection policy now?", "author": "saragluna", "createdAt": "2020-09-22T10:44:53Z", "path": "sdk/spring/azure-spring-boot/src/main/java/com/microsoft/azure/spring/autoconfigure/cosmos/CosmosProperties.java", "diffHunk": "@@ -107,14 +110,6 @@ public void setAllowTelemetry(boolean allowTelemetry) {\n         this.allowTelemetry = allowTelemetry;\n     }\n \n-    public ConnectionPolicy getConnectionPolicy() {", "originalCommit": "499f2968c262a1a1c72b4a35fb5962b84eed31c0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzEyODM3Mw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15434#discussion_r493128373", "bodyText": "the default connectionPolicy instance will be created in CosmosClientBuilder.\n    /**\n     * Instantiates a new Cosmos client builder.\n     */\n    public CosmosClientBuilder() {\n        //  Build default connection policy with direct default connection config\n        this.connectionPolicy = new ConnectionPolicy(DirectConnectionConfig.getDefaultConfig());\n        //  Some default values\n        this.userAgentSuffix = \"\";\n        this.throttlingRetryOptions = new ThrottlingRetryOptions();\n    }", "author": "moarychan", "createdAt": "2020-09-23T01:34:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjYzNzk0Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjYzODc1Mg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15434#discussion_r492638752", "bodyText": "What's this test for?", "author": "saragluna", "createdAt": "2020-09-22T10:46:32Z", "path": "sdk/spring/azure-spring-boot/src/test/java/com/microsoft/azure/spring/autoconfigure/cosmos/CosmosAutoConfigurationTest.java", "diffHunk": "@@ -0,0 +1,50 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+package com.microsoft.azure.spring.autoconfigure.cosmos;\n+\n+\n+import com.azure.cosmos.ThrottlingRetryOptions;\n+import com.azure.cosmos.implementation.ConnectionPolicy;\n+import org.junit.AfterClass;\n+import org.junit.BeforeClass;\n+import org.junit.Ignore;\n+import org.springframework.context.annotation.Bean;\n+import org.springframework.context.annotation.Configuration;\n+\n+@Ignore\n+public class CosmosAutoConfigurationTest {", "originalCommit": "499f2968c262a1a1c72b4a35fb5962b84eed31c0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzEzMDEzNA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15434#discussion_r493130134", "bodyText": "it's used for testing properties setting of ConnectionPolicy", "author": "moarychan", "createdAt": "2020-09-23T01:36:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjYzODc1Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjY0MTA1MQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15434#discussion_r492641051", "bodyText": "How is this credential used now and does it support key rotation?", "author": "saragluna", "createdAt": "2020-09-22T10:51:15Z", "path": "sdk/spring/azure-spring-boot/src/main/java/com/microsoft/azure/spring/autoconfigure/cosmos/CosmosProperties.java", "diffHunk": "@@ -130,4 +125,12 @@ public ResponseDiagnosticsProcessor getResponseDiagnosticsProcessor() {\n     public void setResponseDiagnosticsProcessor(ResponseDiagnosticsProcessor responseDiagnosticsProcessor) {\n         this.responseDiagnosticsProcessor = responseDiagnosticsProcessor;\n     }\n+\n+    public AzureKeyCredential getCredential() {", "originalCommit": "499f2968c262a1a1c72b4a35fb5962b84eed31c0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjY0MTQ3Mg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15434#discussion_r492641472", "bodyText": "We should make sure the key rotation is really supported now.", "author": "saragluna", "createdAt": "2020-09-22T10:52:06Z", "path": "sdk/spring/azure-spring-boot-starter-cosmos/README.md", "diffHunk": "@@ -47,19 +47,18 @@\n Open `application.properties` file and add below properties with your Cosmos DB credentials.\n \n ```properties\n-azure.cosmosdb.uri=your-cosmosdb-uri\n-azure.cosmosdb.key=your-cosmosdb-key\n-azure.cosmosdb.database=your-cosmosdb-databasename\n+azure.cosmos.uri=your-cosmos-uri\n+azure.cosmos.key=your-cosmos-key\n+azure.cosmos.database=your-cosmos-database-name\n ```\n \n-Property `azure.cosmosdb.consistency-level` is also supported.\n+Property `azure.cosmos.consistency-level` is also supported.\n \n-Property `azure.cosmosdb.cosmosKeyCredential` is also supported. CosmosKeyCredential feature provides capability to \n-rotate keys on the fly. You can switch keys using switchToSecondaryKey(). For more information on this, see the Sample \n-Application code.\n+Property `azure.cosmos.credential` is also supported. AzureKeyCredential feature provides capability to ", "originalCommit": "499f2968c262a1a1c72b4a35fb5962b84eed31c0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzEzNzcyNQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15434#discussion_r493137725", "bodyText": "I tested the 2 cases, it's ok to configure only azure.cosmos.key or azure.cosmos.credential, the rotation feature should be supported now, the sample will be found in spring cosmos module.", "author": "moarychan", "createdAt": "2020-09-23T01:48:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjY0MTQ3Mg=="}], "type": "inlineReview"}, {"oid": "237f86fd5cf0df161ccf3046493bce7f22ceba48", "url": "https://github.com/Azure/azure-sdk-for-java/commit/237f86fd5cf0df161ccf3046493bce7f22ceba48", "message": "updated according reviewer's comments", "committedDate": "2020-09-23T06:46:47Z", "type": "commit"}, {"oid": "c97b971dcf16ca06de5147ab89f8b69fc291841a", "url": "https://github.com/Azure/azure-sdk-for-java/commit/c97b971dcf16ca06de5147ab89f8b69fc291841a", "message": "updated new properties processing", "committedDate": "2020-09-23T10:26:01Z", "type": "commit"}, {"oid": "0225a77b5d5a802fa5b9be997cd5aa358d142200", "url": "https://github.com/Azure/azure-sdk-for-java/commit/0225a77b5d5a802fa5b9be997cd5aa358d142200", "message": "update AzureKeyCredential class usage", "committedDate": "2020-09-24T08:21:34Z", "type": "commit"}, {"oid": "dff7dc2cba40d7de912e1547b4d5945f127db21a", "url": "https://github.com/Azure/azure-sdk-for-java/commit/dff7dc2cba40d7de912e1547b4d5945f127db21a", "message": "Merge branch 'master' of github", "committedDate": "2020-09-24T09:10:19Z", "type": "commit"}, {"oid": "ade38997a591b8c94b995de6f905c9e8c56a96d4", "url": "https://github.com/Azure/azure-sdk-for-java/commit/ade38997a591b8c94b995de6f905c9e8c56a96d4", "message": "remove unused import", "committedDate": "2020-09-25T02:25:28Z", "type": "commit"}, {"oid": "67a2d9dac089238710d5d3c26ccfb9f5a37e2f9a", "url": "https://github.com/Azure/azure-sdk-for-java/commit/67a2d9dac089238710d5d3c26ccfb9f5a37e2f9a", "message": "update health contributor configuration", "committedDate": "2020-09-25T08:05:43Z", "type": "commit"}, {"oid": "01c20982613f70570e3f8e76b1deda75c63ad449", "url": "https://github.com/Azure/azure-sdk-for-java/commit/01c20982613f70570e3f8e76b1deda75c63ad449", "message": "merge from master", "committedDate": "2020-09-25T08:10:45Z", "type": "commit"}, {"oid": "082802880086d5befdffa0d3592badcabc5697e7", "url": "https://github.com/Azure/azure-sdk-for-java/commit/082802880086d5befdffa0d3592badcabc5697e7", "message": "update bean name", "committedDate": "2020-09-25T08:12:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDgyMjMzMg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15434#discussion_r494822332", "bodyText": "Are we leaking the master key to a cosmos db here? Did we delete this db yet?", "author": "saragluna", "createdAt": "2020-09-25T08:12:41Z", "path": "sdk/spring/azure-spring-boot-samples/azure-spring-boot-sample-cosmos/src/main/resources/application.properties", "diffHunk": "@@ -1,9 +1,4 @@\n-azure.cosmos.uri=https://moary-cosmos.documents.azure.com:443/\n-azure.cosmos.key=vH8l57SbpwOC3inYs060kdTBS8G0PrrlpgaVhL6nGe3HBi31ZdKxMoAD7rd4wPYtSaO3viIxGerzuenraQOtmQ==", "originalCommit": "67a2d9dac089238710d5d3c26ccfb9f5a37e2f9a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDgyNDM3Nw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15434#discussion_r494824377", "bodyText": "sorry, deleted.", "author": "moarychan", "createdAt": "2020-09-25T08:16:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDgyMjMzMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDgyMjYwMg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15434#discussion_r494822602", "bodyText": "Why do we change to use async client instead?", "author": "saragluna", "createdAt": "2020-09-25T08:13:14Z", "path": "sdk/spring/azure-spring-boot/src/main/java/com/microsoft/azure/spring/autoconfigure/cosmos/CosmosHealthConfiguration.java", "diffHunk": "@@ -16,15 +16,15 @@\n  * CosmosHealthConfiguration\n  */\n @Configuration\n-@ConditionalOnClass({ CosmosClient.class, HealthIndicator.class})\n+@ConditionalOnClass({ CosmosAsyncClient.class, HealthIndicator.class})", "originalCommit": "67a2d9dac089238710d5d3c26ccfb9f5a37e2f9a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDgyNzI5NQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15434#discussion_r494827295", "bodyText": "there's a new bean cosmosAsyncClient instead of cosmosClient in AbstractCosmosConfiguration class, just follow the spring-cosmos.\n    /**\n     * Declare CosmosAsyncClient bean.\n     *\n     * @param cosmosClientBuilder cosmosClientBuilder\n     * @return CosmosAsyncClient bean\n     */\n    @Bean\n    public CosmosAsyncClient cosmosAsyncClient(CosmosClientBuilder cosmosClientBuilder) {\n        return CosmosFactory.createCosmosAsyncClient(cosmosClientBuilder);\n    }", "author": "moarychan", "createdAt": "2020-09-25T08:21:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDgyMjYwMg=="}], "type": "inlineReview"}, {"oid": "5ebc4bad1cf70d456193d9cec94aa13bc52566f0", "url": "https://github.com/Azure/azure-sdk-for-java/commit/5ebc4bad1cf70d456193d9cec94aa13bc52566f0", "message": "fix errors", "committedDate": "2020-09-25T10:45:23Z", "type": "commit"}]}