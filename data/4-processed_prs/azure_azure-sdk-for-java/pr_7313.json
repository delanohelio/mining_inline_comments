{"pr_number": 7313, "pr_title": "Storage ARM Template for live tests", "pr_createdAt": "2020-01-09T18:29:37Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/7313", "timeline": [{"oid": "2d83da874785a38f25aba5df4e98600cbe4a3eab", "url": "https://github.com/Azure/azure-sdk-for-java/commit/2d83da874785a38f25aba5df4e98600cbe4a3eab", "message": "Added ARM template  for storage", "committedDate": "2020-01-09T18:27:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDg5ODkxMA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7313#discussion_r364898910", "bodyText": "Remove this as it will scope the Storage tests to a smaller matrix", "author": "alzimmermsft", "createdAt": "2020-01-09T18:40:22Z", "path": "sdk/storage/tests.yml", "diffHunk": "@@ -3,30 +3,36 @@ trigger: none\n jobs:\n   - template: ../../eng/pipelines/templates/jobs/archetype-sdk-tests.yml\n     parameters:\n+      Matrix:\n+        Windows - Java 8:\n+            OSName: 'Windows'\n+            OSVmImage: 'windows-2019'\n+            JavaVersion: '1.8'\n+            DisplayName: 'Windows - Java 8'", "originalCommit": "2d83da874785a38f25aba5df4e98600cbe4a3eab", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDg5OTEzNw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7313#discussion_r364899137", "bodyText": "Remove this line, its adding an environment variable of TimeoutInMinutes which isn't needed", "author": "alzimmermsft", "createdAt": "2020-01-09T18:40:50Z", "path": "sdk/storage/tests.yml", "diffHunk": "@@ -3,30 +3,36 @@ trigger: none\n jobs:\n   - template: ../../eng/pipelines/templates/jobs/archetype-sdk-tests.yml\n     parameters:\n+      Matrix:\n+        Windows - Java 8:\n+            OSName: 'Windows'\n+            OSVmImage: 'windows-2019'\n+            JavaVersion: '1.8'\n+            DisplayName: 'Windows - Java 8'\n       ServiceDirectory: storage\n+      TimeoutInMinutes: 240\n       EnvVars:\n         AZURE_TEST_MODE: LIVE\n         AZURE_TENANT_ID: $(aad-azure-sdk-test-tenant-id)\n         AZURE_CLIENT_ID: $(aad-azure-sdk-test-client-id)\n         AZURE_CLIENT_SECRET: $(aad-azure-sdk-test-client-secret)\n-        PRIMARY_STORAGE_ACCOUNT_NAME: $(java-storage-test-primary-account-name)\n-        PRIMARY_STORAGE_ACCOUNT_KEY: $(java-storage-test-primary-account-key)\n-        SECONDARY_STORAGE_ACCOUNT_NAME: $(java-storage-test-secondary-account-name)\n-        SECONDARY_STORAGE_ACCOUNT_KEY: $(java-storage-test-secondary-account-key)\n-        BLOB_STORAGE_ACCOUNT_NAME: $(java-storage-test-blob-account-name)\n-        BLOB_STORAGE_ACCOUNT_KEY: $(java-storage-test-blob-account-key)\n-        PREMIUM_STORAGE_ACCOUNT_NAME: $(java-storage-test-premium-account-name)\n-        PREMIUM_STORAGE_ACCOUNT_KEY: $(java-storage-test-premium-account-key)\n-        AZURE_STORAGE_ACCESS_KEY: $(java-storage-test-access-key)\n-        AZURE_STORAGE_FILE_ENDPOINT: $(java-storage-test-file-endpoint)\n-        AZURE_STORAGE_FILE_CONNECTION_STRING: $(java-storage-test-file-connection-string)\n-        AZURE_STORAGE_QUEUE_ENDPOINT: $(java-storage-test-queue-endpoint)\n-        AZURE_STORAGE_QUEUE_CONNECTION_STRING: $(java-storage-test-queue-connection-string)\n-        AZURE_STORAGE_BLOB_CONNECTION_STRING: $(java-storage-test-blob-connection-string)\n-        STORAGE_DATA_LAKE_ACCOUNT_NAME: $(java-storage-data-lake-account-name)\n-        STORAGE_DATA_LAKE_ACCOUNT_KEY: $(java-storage-data-lake-account-key)\n-        AZURE_STORAGE_FILE_ACCOUNT_NAME: $(java-storage-account-name)\n-        AZURE_STORAGE_FILE_ACCOUNT_KEY: $(java-storage-account-key)\n-        AZURE_STORAGE_QUEUE_ACCOUNT_NAME: $(java-storage-account-name)\n-        AZURE_STORAGE_QUEUE_ACCOUNT_KEY: $(java-storage-account-key)\n-      TimeoutInMinutes: 120\n+        PRIMARY_STORAGE_ACCOUNT_NAME: $(PRIMARY_STORAGE_ACCOUNT_NAME)\n+        PRIMARY_STORAGE_ACCOUNT_KEY: $(PRIMARY_STORAGE_ACCOUNT_KEY)\n+        SECONDARY_STORAGE_ACCOUNT_NAME: $(SECONDARY_STORAGE_ACCOUNT_NAME)\n+        SECONDARY_STORAGE_ACCOUNT_KEY: $(SECONDARY_STORAGE_ACCOUNT_KEY)\n+        BLOB_STORAGE_ACCOUNT_NAME: $(BLOB_STORAGE_ACCOUNT_NAME)\n+        BLOB_STORAGE_ACCOUNT_KEY: $(BLOB_STORAGE_ACCOUNT_KEY)\n+        PREMIUM_STORAGE_ACCOUNT_NAME: $(PREMIUM_STORAGE_ACCOUNT_NAME)\n+        PREMIUM_STORAGE_ACCOUNT_KEY: $(PREMIUM_STORAGE_ACCOUNT_KEY)\n+        AZURE_STORAGE_FILE_ENDPOINT: $(AZURE_STORAGE_FILE_ENDPOINT)\n+        AZURE_STORAGE_FILE_CONNECTION_STRING: $(AZURE_STORAGE_FILE_CONNECTION_STRING)\n+        AZURE_STORAGE_QUEUE_ENDPOINT: $(AZURE_STORAGE_QUEUE_ENDPOINT)\n+        AZURE_STORAGE_QUEUE_CONNECTION_STRING: $(AZURE_STORAGE_QUEUE_CONNECTION_STRING)\n+        AZURE_STORAGE_BLOB_CONNECTION_STRING: $(AZURE_STORAGE_BLOB_CONNECTION_STRING)\n+        STORAGE_DATA_LAKE_ACCOUNT_NAME: $(STORAGE_DATA_LAKE_ACCOUNT_NAME)\n+        STORAGE_DATA_LAKE_ACCOUNT_KEY: $(STORAGE_DATA_LAKE_ACCOUNT_KEY)\n+        AZURE_STORAGE_FILE_ACCOUNT_NAME: $(AZURE_STORAGE_FILE_ACCOUNT_NAME)\n+        AZURE_STORAGE_FILE_ACCOUNT_KEY: $(AZURE_STORAGE_FILE_ACCOUNT_KEY)\n+        AZURE_STORAGE_QUEUE_ACCOUNT_NAME: $(AZURE_STORAGE_FILE_ACCOUNT_NAME)\n+        AZURE_STORAGE_QUEUE_ACCOUNT_KEY: $(AZURE_STORAGE_QUEUE_ACCOUNT_KEY)\n+        TimeoutInMinutes: 120", "originalCommit": "2d83da874785a38f25aba5df4e98600cbe4a3eab", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDg5OTM2NQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7313#discussion_r364899365", "bodyText": "Let's use a 2 hour timeout since the complete test suite only takes about 60-75 minutes, anything longer and there is likely an issue in our tests.", "author": "alzimmermsft", "createdAt": "2020-01-09T18:41:25Z", "path": "sdk/storage/tests.yml", "diffHunk": "@@ -3,30 +3,36 @@ trigger: none\n jobs:\n   - template: ../../eng/pipelines/templates/jobs/archetype-sdk-tests.yml\n     parameters:\n+      Matrix:\n+        Windows - Java 8:\n+            OSName: 'Windows'\n+            OSVmImage: 'windows-2019'\n+            JavaVersion: '1.8'\n+            DisplayName: 'Windows - Java 8'\n       ServiceDirectory: storage\n+      TimeoutInMinutes: 240", "originalCommit": "2d83da874785a38f25aba5df4e98600cbe4a3eab", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "ae14f0589a71185153f6d057214f453afeef5199", "url": "https://github.com/Azure/azure-sdk-for-java/commit/ae14f0589a71185153f6d057214f453afeef5199", "message": "Review  comments", "committedDate": "2020-01-09T18:48:50Z", "type": "commit"}, {"oid": "2a2880c407be2ae4551c4eed76a17c58738dae23", "url": "https://github.com/Azure/azure-sdk-for-java/commit/2a2880c407be2ae4551c4eed76a17c58738dae23", "message": "adding back remore  resources step.", "committedDate": "2020-01-09T21:02:35Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDk5NDk2MA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7313#discussion_r364994960", "bodyText": "@danieljurek: Should this be condition: always() instead?  Or are these equivalent?  I assume the intent is to ensure cleanup is always run regardless of earlier failures.", "author": "mikeharder", "createdAt": "2020-01-09T22:39:16Z", "path": "eng/pipelines/templates/jobs/archetype-sdk-tests.yml", "diffHunk": "@@ -69,6 +102,25 @@ jobs:\n           ${{ insert }}: ${{ parameters.TestStepMavenInputs }}\n         env: ${{ parameters.EnvVars }}\n \n+      - ${{ parameters.PostRunSteps }}\n+\n+      - pwsh: >-\n+          eng/Remove-TestResources.ps1\n+          -BaseName $(BaseName)\n+          -ServiceDirectory ${{ parameters.ServiceDirectory }}\n+          -TenantId $env:TENANT_ID\n+          -ProvisionerApplicationId $env:PROVISIONER_APPLICATION_ID\n+          -ProvisionerApplicationSecret $env:PROVISIONER_APPLICATION_SECRET\n+          -Force\n+          -Verbose\n+        env:\n+          TENANT_ID: $(aad-azure-sdk-test-tenant-id)\n+          PROVISIONER_APPLICATION_ID: $(provisioner-aad-id)\n+          PROVISIONER_APPLICATION_SECRET: $(provisioner-aad-secret)\n+        displayName: Remove Test Resources\n+        condition: true", "originalCommit": "2a2880c407be2ae4551c4eed76a17c58738dae23", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}