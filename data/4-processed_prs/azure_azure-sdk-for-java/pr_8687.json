{"pr_number": 8687, "pr_title": "Add Additional UTF8 BOM Check", "pr_createdAt": "2020-03-03T23:44:08Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/8687", "timeline": [{"oid": "2167018a593fdbaf9696ebb004e5edb189974285", "url": "https://github.com/Azure/azure-sdk-for-java/commit/2167018a593fdbaf9696ebb004e5edb189974285", "message": "Add an additional check for UTF8 BOM as a string representation", "committedDate": "2020-03-03T23:34:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzM2NzY0NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8687#discussion_r387367644", "bodyText": "As discussed, please file an issue for further investigation on this. This is good for now to release this as this issue was already noticed in smoke tests and would be better to get this fix out before customers are impacted.", "author": "srnagar", "createdAt": "2020-03-04T00:02:32Z", "path": "sdk/core/azure-core/src/main/java/com/azure/core/util/serializer/JacksonAdapter.java", "diffHunk": "@@ -158,12 +161,17 @@ public String serializeList(List<?> list, CollectionFormat format) {\n     @Override\n     @SuppressWarnings(\"unchecked\")\n     public <T> T deserialize(String value, final Type type, SerializerEncoding encoding) throws IOException {\n-        if (value == null || value.isEmpty() || value.equals(BOM)) {\n+        if (CoreUtils.isNullOrEmpty(value) || value.equals(BOM) || value.equals(BOM_STRING)) {\n             return null;\n         }\n-        // Remove BOM\n-        if (value.startsWith(BOM)) {\n-            value = value.replaceFirst(BOM, \"\");\n+\n+        // Remove any leading BOM from the XML.\n+        if (encoding == SerializerEncoding.XML) {\n+            if (value.startsWith(BOM)) {\n+                value = value.replaceFirst(BOM, \"\");\n+            } else if (value.startsWith(BOM_STRING)) {\n+                value = value.replaceFirst(BOM_STRING, \"\");\n+            }", "originalCommit": "2167018a593fdbaf9696ebb004e5edb189974285", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODAwMDA5OA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8687#discussion_r388000098", "bodyText": "#8710", "author": "alzimmermsft", "createdAt": "2020-03-04T23:41:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzM2NzY0NA=="}], "type": "inlineReview"}, {"oid": "6a1c2efaffa9066a6305a2a31951ef5ddcfa1230", "url": "https://github.com/Azure/azure-sdk-for-java/commit/6a1c2efaffa9066a6305a2a31951ef5ddcfa1230", "message": "Merge branch 'master' into AzCore_ThoroughXmlBomCheck", "committedDate": "2020-03-04T22:08:27Z", "type": "commit"}, {"oid": "902d59619a15f35ecc2676968276797cb6d810db", "url": "https://github.com/Azure/azure-sdk-for-java/commit/902d59619a15f35ecc2676968276797cb6d810db", "message": "Remove XML guard when removing BOM", "committedDate": "2020-03-04T22:09:48Z", "type": "commit"}, {"oid": "fe73108668c6d93cc7b1a0b22d57e6ca1ea0e297", "url": "https://github.com/Azure/azure-sdk-for-java/commit/fe73108668c6d93cc7b1a0b22d57e6ca1ea0e297", "message": "Use default charset to match what new String would do to fix SpotBug issue", "committedDate": "2020-03-04T23:17:02Z", "type": "commit"}, {"oid": "836a5ba76dd185dbdbd8d896e4a825d0316a1e6b", "url": "https://github.com/Azure/azure-sdk-for-java/commit/836a5ba76dd185dbdbd8d896e4a825d0316a1e6b", "message": "Merge branch 'master' into AzCore_ThoroughXmlBomCheck", "committedDate": "2020-03-04T23:17:37Z", "type": "commit"}]}