{"pr_number": 14974, "pr_title": "add azure spring storage integration test", "pr_createdAt": "2020-09-09T09:29:28Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/14974", "timeline": [{"oid": "3019dbbea485dbe2776f0f8e11a3278e01ce8251", "url": "https://github.com/Azure/azure-sdk-for-java/commit/3019dbbea485dbe2776f0f8e11a3278e01ce8251", "message": "add azure spring storage integration test", "committedDate": "2020-09-09T09:25:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTYxMTA0Ng==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14974#discussion_r485611046", "bodyText": "There's an accumulating pom file in sdk/spring path, and this test module should be added there.", "author": "saragluna", "createdAt": "2020-09-09T13:28:47Z", "path": "pom.xml", "diffHunk": "@@ -36,5 +36,6 @@\n     <module>sdk/template</module>\n     <module>sdk/textanalytics</module>\n     <module>sdk/spring</module>\n+    <module>sdk/spring/azure-spring-cloud-test-storage</module>", "originalCommit": "3019dbbea485dbe2776f0f8e11a3278e01ce8251", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjAyMTk0Mg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14974#discussion_r486021942", "bodyText": "done", "author": "zhoufenqin", "createdAt": "2020-09-10T02:15:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTYxMTA0Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTYxMTc2Mg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14974#discussion_r485611762", "bodyText": "nit: extra line", "author": "saragluna", "createdAt": "2020-09-09T13:29:45Z", "path": "sdk/spring/azure-spring-cloud-storage/src/main/java/com/microsoft/azure/spring/cloud/autoconfigure/storage/actuator/BlobStorageHealthIndicator.java", "diffHunk": "@@ -18,27 +18,26 @@\n \n public class BlobStorageHealthIndicator implements HealthIndicator {\n \n-    private ApplicationContext applicationContext;\n+    private BlobServiceAsyncClient internalClient;\n \n     public BlobStorageHealthIndicator(ApplicationContext applicationContext) {\n-        this.applicationContext = applicationContext;\n+        BlobServiceClientBuilder blobStorageClientBuilder = applicationContext.getBean(BlobServiceClientBuilder.class);\n+        internalClient = blobStorageClientBuilder.buildAsyncClient();\n+", "originalCommit": "3019dbbea485dbe2776f0f8e11a3278e01ce8251", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjAyMTk2Mg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14974#discussion_r486021962", "bodyText": "done", "author": "zhoufenqin", "createdAt": "2020-09-10T02:15:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTYxMTc2Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTYxNDIwOQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14974#discussion_r485614209", "bodyText": "Do we use this dependency?", "author": "saragluna", "createdAt": "2020-09-09T13:33:03Z", "path": "sdk/spring/azure-spring-cloud-test-storage/pom.xml", "diffHunk": "@@ -0,0 +1,92 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+  <parent>\n+    <groupId>com.azure</groupId>\n+    <artifactId>azure-client-sdk-parent</artifactId>\n+    <version>1.7.0</version> <!-- {x-version-update;com.azure:azure-client-sdk-parent;current} -->\n+    <relativePath>../../parents/azure-client-sdk-parent</relativePath>\n+  </parent>\n+  <modelVersion>4.0.0</modelVersion>\n+\n+  <groupId>com.azure</groupId>\n+  <artifactId>azure-spring-cloud-test-storage</artifactId>\n+  <version>1.0.0</version>\n+\n+  <properties>\n+    <skipSpringITs>true</skipSpringITs>\n+  </properties>\n+\n+  <dependencies>\n+    <dependency>\n+      <groupId>com.microsoft.azure</groupId>\n+      <artifactId>spring-cloud-azure-storage</artifactId>\n+      <version>1.2.8-beta.1</version><!-- {x-version-update;com.microsoft.azure:spring-cloud-azure-storage;current} -->\n+    </dependency>\n+    <dependency>\n+      <groupId>org.springframework.boot</groupId>\n+      <artifactId>spring-boot-starter-test</artifactId>\n+      <version>2.3.3.RELEASE</version> <!-- {x-version-update;org.springframework.boot:spring-boot-starter-test;external_dependency} -->\n+      <scope>test</scope>\n+      <exclusions>\n+        <exclusion>\n+          <groupId>org.junit.vintage</groupId>\n+          <artifactId>junit-vintage-engine</artifactId>\n+        </exclusion>\n+      </exclusions>\n+    </dependency>\n+    <dependency>\n+      <groupId>com.azure</groupId>\n+      <artifactId>azure-spring-boot-test-core</artifactId>\n+      <version>1.0.0</version> <!-- {x-version-update;com.azure:azure-spring-boot-test-core;current} -->\n+    </dependency>\n+    <dependency>\n+      <groupId>org.springframework.boot</groupId>\n+      <artifactId>spring-boot-starter-actuator</artifactId>\n+      <version>2.3.3.RELEASE</version> <!-- {x-version-update;org.springframework.boot:spring-boot-starter-actuator;external_dependency} -->\n+    </dependency>\n+    <dependency>\n+      <groupId>org.springframework.boot</groupId>\n+      <artifactId>spring-boot-starter-web</artifactId>\n+      <version>2.3.3.RELEASE</version> <!-- {x-version-update;org.springframework.boot:spring-boot-starter-web;external_dependency} -->\n+    </dependency>\n+\n+    <dependency>\n+      <groupId>com.google.code.gson</groupId>", "originalCommit": "3019dbbea485dbe2776f0f8e11a3278e01ce8251", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjAyMzI0NQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14974#discussion_r486023245", "bodyText": "I exclude this com.google.code.gson:gson now. I add com.google.code.gson:gson:2.8.6 before because com.microsoft.azure:spring-cloud-azure-storage will include gson:2.2.4 package, and spring-boot-autoconfigure 2.3.3.RELASE will use some methods in high version of gson, so I add the high version of gson package. But I see that the gson package is useless in our test, so I exclude it now", "author": "zhoufenqin", "createdAt": "2020-09-10T02:20:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTYxNDIwOQ=="}], "type": "inlineReview"}, {"oid": "ce2471f9307d7146a4fdb07ceb046ec8362ee2cf", "url": "https://github.com/Azure/azure-sdk-for-java/commit/ce2471f9307d7146a4fdb07ceb046ec8362ee2cf", "message": "update spring cloud storage test", "committedDate": "2020-09-09T14:26:21Z", "type": "commit"}, {"oid": "ce2471f9307d7146a4fdb07ceb046ec8362ee2cf", "url": "https://github.com/Azure/azure-sdk-for-java/commit/ce2471f9307d7146a4fdb07ceb046ec8362ee2cf", "message": "update spring cloud storage test", "committedDate": "2020-09-09T14:26:21Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTgwNzkzOQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14974#discussion_r485807939", "bodyText": "Are we planning to move this also in track 2 com.microsoft.azure -> com.azure  ?", "author": "hemanttanwar", "createdAt": "2020-09-09T17:52:46Z", "path": "sdk/spring/azure-spring-cloud-test-storage/pom.xml", "diffHunk": "@@ -0,0 +1,92 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+  <parent>\n+    <groupId>com.azure</groupId>\n+    <artifactId>azure-client-sdk-parent</artifactId>\n+    <version>1.7.0</version> <!-- {x-version-update;com.azure:azure-client-sdk-parent;current} -->\n+    <relativePath>../../parents/azure-client-sdk-parent</relativePath>\n+  </parent>\n+  <modelVersion>4.0.0</modelVersion>\n+\n+  <groupId>com.azure</groupId>\n+  <artifactId>azure-spring-cloud-test-storage</artifactId>\n+  <version>1.0.0</version> <!-- {x-version-update;com.azure:azure-spring-cloud-test-storage;current} -->\n+\n+  <properties>\n+    <skipSpringITs>true</skipSpringITs>\n+  </properties>\n+\n+  <dependencies>\n+    <dependency>\n+      <groupId>com.microsoft.azure</groupId>", "originalCommit": "ce2471f9307d7146a4fdb07ceb046ec8362ee2cf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjAxNzU2OQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14974#discussion_r486017569", "bodyText": "yes, but we won't get rid of track1 in this spring-cloud release version, we'll do it in the next release version", "author": "zhoufenqin", "createdAt": "2020-09-10T01:59:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTgwNzkzOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTkzODQ3OA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14974#discussion_r485938478", "bodyText": "We should get rid of track 1 dependency.", "author": "hemanttanwar", "createdAt": "2020-09-09T21:42:34Z", "path": "sdk/spring/azure-spring-cloud-test-storage/pom.xml", "diffHunk": "@@ -0,0 +1,92 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+  <parent>\n+    <groupId>com.azure</groupId>\n+    <artifactId>azure-client-sdk-parent</artifactId>\n+    <version>1.7.0</version> <!-- {x-version-update;com.azure:azure-client-sdk-parent;current} -->\n+    <relativePath>../../parents/azure-client-sdk-parent</relativePath>\n+  </parent>\n+  <modelVersion>4.0.0</modelVersion>\n+\n+  <groupId>com.azure</groupId>\n+  <artifactId>azure-spring-cloud-test-storage</artifactId>\n+  <version>1.0.0</version> <!-- {x-version-update;com.azure:azure-spring-cloud-test-storage;current} -->\n+\n+  <properties>\n+    <skipSpringITs>true</skipSpringITs>\n+  </properties>\n+\n+  <dependencies>\n+    <dependency>\n+      <groupId>com.microsoft.azure</groupId>\n+      <artifactId>spring-cloud-azure-storage</artifactId>\n+      <version>1.2.8-beta.1</version> <!-- {x-version-update;com.microsoft.azure:spring-cloud-azure-storage;current} -->\n+    </dependency>\n+    <dependency>\n+      <groupId>org.springframework.boot</groupId>\n+      <artifactId>spring-boot-starter-test</artifactId>\n+      <version>2.3.3.RELEASE</version> <!-- {x-version-update;org.springframework.boot:spring-boot-starter-test;external_dependency} -->\n+      <scope>test</scope>\n+      <exclusions>\n+        <exclusion>\n+          <groupId>org.junit.vintage</groupId>\n+          <artifactId>junit-vintage-engine</artifactId>\n+        </exclusion>\n+      </exclusions>\n+    </dependency>\n+    <dependency>\n+      <groupId>com.azure</groupId>\n+      <artifactId>azure-spring-boot-test-core</artifactId>\n+      <version>1.0.0</version> <!-- {x-version-update;com.azure:azure-spring-boot-test-core;current} -->\n+    </dependency>\n+    <dependency>\n+      <groupId>org.springframework.boot</groupId>\n+      <artifactId>spring-boot-starter-actuator</artifactId>\n+      <version>2.3.3.RELEASE</version> <!-- {x-version-update;org.springframework.boot:spring-boot-starter-actuator;external_dependency} -->\n+    </dependency>\n+    <dependency>\n+      <groupId>org.springframework.boot</groupId>\n+      <artifactId>spring-boot-starter-web</artifactId>\n+      <version>2.3.3.RELEASE</version> <!-- {x-version-update;org.springframework.boot:spring-boot-starter-web;external_dependency} -->\n+    </dependency>\n+\n+    <dependency>\n+      <groupId>com.google.code.gson</groupId>\n+      <artifactId>gson</artifactId>\n+      <version>2.8.6</version> <!-- {x-version-update;com.google.code.gson:gson;external_dependency} -->\n+    </dependency>\n+\n+  </dependencies>\n+\n+  <build>\n+    <plugins>\n+      <plugin>\n+        <groupId>org.apache.maven.plugins</groupId>\n+        <artifactId>maven-enforcer-plugin</artifactId>\n+        <version>3.0.0-M3</version> <!-- {x-version-update;org.apache.maven.plugins:maven-enforcer-plugin;external_dependency} -->\n+        <configuration>\n+          <rules>\n+            <bannedDependencies>\n+              <includes>\n+                <include>com.microsoft.azure:spring-cloud-azure-storage:[1.2.8-beta.1]</include> <!-- {x-include-update;com.microsoft.azure:spring-cloud-azure-storage;current} -->", "originalCommit": "ce2471f9307d7146a4fdb07ceb046ec8362ee2cf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjAxNzIwMg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14974#discussion_r486017202", "bodyText": "Hi @hemanttanwar, in this spring-boot release version, we will get rid of track1, but this spring-cloud release version won't. In the next spring-cloud release version, we'll get rid of track1", "author": "zhoufenqin", "createdAt": "2020-09-10T01:58:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTkzODQ3OA=="}], "type": "inlineReview"}, {"oid": "f7635d6ebacb88a77a25a1e756b2ee11124ab524", "url": "https://github.com/Azure/azure-sdk-for-java/commit/f7635d6ebacb88a77a25a1e756b2ee11124ab524", "message": "update azure-spring-cloud-test-storage pom.xml", "committedDate": "2020-09-10T02:37:25Z", "type": "commit"}, {"oid": "f7635d6ebacb88a77a25a1e756b2ee11124ab524", "url": "https://github.com/Azure/azure-sdk-for-java/commit/f7635d6ebacb88a77a25a1e756b2ee11124ab524", "message": "update azure-spring-cloud-test-storage pom.xml", "committedDate": "2020-09-10T02:37:25Z", "type": "forcePushed"}, {"oid": "c1abf9432a1489333c46a5816626d8bbf53efa84", "url": "https://github.com/Azure/azure-sdk-for-java/commit/c1abf9432a1489333c46a5816626d8bbf53efa84", "message": "update storage resource template and test", "committedDate": "2020-09-10T06:35:43Z", "type": "commit"}]}