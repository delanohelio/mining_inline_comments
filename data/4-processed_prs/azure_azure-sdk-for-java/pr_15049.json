{"pr_number": 15049, "pr_title": "Create ADT event routes sample, add missing sync client APIs", "pr_createdAt": "2020-09-10T19:15:07Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/15049", "timeline": [{"oid": "cfdcac8852f4b7b269cb6d5d2e989e7e34092230", "url": "https://github.com/Azure/azure-sdk-for-java/commit/cfdcac8852f4b7b269cb6d5d2e989e7e34092230", "message": "Create ADT event routes sample, add missing sync client APIs\n\nAsync client had deleteEventRoute APIs, but sync client didn't", "committedDate": "2020-09-10T19:14:48Z", "type": "commit"}, {"oid": "69e0f469a89eb88cbd0b7bca129690f971dd2038", "url": "https://github.com/Azure/azure-sdk-for-java/commit/69e0f469a89eb88cbd0b7bca129690f971dd2038", "message": "fixup", "committedDate": "2020-09-10T19:17:02Z", "type": "commit"}, {"oid": "ca396bf026e3e9083ef03389578b045c16f19b2f", "url": "https://github.com/Azure/azure-sdk-for-java/commit/ca396bf026e3e9083ef03389578b045c16f19b2f", "message": "fix up", "committedDate": "2020-09-10T19:17:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjU3OTg4MA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15049#discussion_r486579880", "bodyText": "I had to add this extra command line parameter because, in order to create an event route, you must have one pre-existing event route endpoint. Creating a new event route endpoint for the user would require the control plane SDK.", "author": "timtay-microsoft", "createdAt": "2020-09-10T19:20:07Z", "path": "sdk/digitaltwins/azure-digitaltwins-core/src/samples/java/com/azure/digitaltwins/core/helpers/SamplesArguments.java", "diffHunk": "@@ -24,19 +26,22 @@ public SamplesArguments(String[] args) {\n         Option clientId = new Option(\"c\", CLIENT_ID, true, \"AAD Client Id\");\n         Option clientSecret = new Option(\"s\", CLIENT_SECRET, true, \"AAD Client Secret\");\n         Option logLevel = new Option(\"l\", LOG_DETAIL_LEVEL, true, \"Http logging detail level \\n 0 -> NONE \\n 1 -> BASIC \\n 2 -> HEADERS \\n 3 -> BODY \\n 4 -> BODY_AND_HEADERS\");\n+        Option eventRouteEndpointName = new Option(\"e\", EVENT_ROUTE_ENDPOINT_NAME, true, \"(Event route sample only) The name of an existing event route endpoint\");", "originalCommit": "ca396bf026e3e9083ef03389578b045c16f19b2f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjU4MDI0NQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15049#discussion_r486580245", "bodyText": "It is marked as optional both because other samples don't need this value, but also because the event route sample can still do some operations without this value", "author": "timtay-microsoft", "createdAt": "2020-09-10T19:20:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjU3OTg4MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjU4NTQzNQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15049#discussion_r486585435", "bodyText": "This should take Context as a parameter no?", "author": "azabbasi", "createdAt": "2020-09-10T19:31:03Z", "path": "sdk/digitaltwins/azure-digitaltwins-core/src/main/java/com/azure/digitaltwins/core/DigitalTwinsClient.java", "diffHunk": "@@ -744,6 +744,27 @@ public EventRoute getEventRoute(String eventRouteId) {\n         return this.digitalTwinsAsyncClient.getEventRouteWithResponse(eventRouteId, context).block();\n     }\n \n+    /**\n+     * Delete an event route.\n+     * @param eventRouteId The Id of the event route to delete.\n+     */\n+    @ServiceMethod(returns = ReturnType.SINGLE)\n+    public void deleteEventRoute(String eventRouteId)\n+    {\n+        deleteEventRouteWithResponse(eventRouteId);\n+    }\n+\n+    /**\n+     * Delete an event route.\n+     * @param eventRouteId The Id of the event route to delete.\n+     * @return A {@link Response} containing no parsed value.\n+     */\n+    @ServiceMethod(returns = ReturnType.SINGLE)\n+    public Response<Void> deleteEventRouteWithResponse(String eventRouteId)", "originalCommit": "ca396bf026e3e9083ef03389578b045c16f19b2f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjU4NzMzMg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15049#discussion_r486587332", "bodyText": "Yes it should, good catch", "author": "timtay-microsoft", "createdAt": "2020-09-10T19:34:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjU4NTQzNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjU4NTk2NQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15049#discussion_r486585965", "bodyText": "why the empty spaces? if you intend to tab in , use \\t ?", "author": "azabbasi", "createdAt": "2020-09-10T19:31:53Z", "path": "sdk/digitaltwins/azure-digitaltwins-core/src/samples/java/com/azure/digitaltwins/core/EventRoutesSyncSamples.java", "diffHunk": "@@ -0,0 +1,119 @@\n+package com.azure.digitaltwins.core;\n+\n+import com.azure.core.http.policy.HttpLogOptions;\n+import com.azure.core.http.rest.PagedIterable;\n+import com.azure.digitaltwins.core.helpers.ConsoleLogger;\n+import com.azure.digitaltwins.core.helpers.SamplesArguments;\n+import com.azure.digitaltwins.core.implementation.models.ErrorResponseException;\n+import com.azure.digitaltwins.core.models.EventRoute;\n+import com.azure.identity.ClientSecretCredentialBuilder;\n+\n+import java.util.UUID;\n+\n+/**\n+ * This sample will list all the current event routes in your Azure Digital Twins instance,\n+ * then it will retrieve a particular event route. If the parameter for an existing event\n+ * route endpoint name is provided then it will also create a new event route, and it will\n+ * delete that newly created event route.\n+ */\n+public class EventRoutesSyncSamples {\n+    private static DigitalTwinsClient client;\n+\n+    public static void main(String[] args) {\n+        SamplesArguments parsedArguments = new SamplesArguments(args);\n+\n+        client = new DigitalTwinsClientBuilder()\n+            .credential(\n+                new ClientSecretCredentialBuilder()\n+                    .tenantId(parsedArguments.getTenantId())\n+                    .clientId(parsedArguments.getClientId())\n+                    .clientSecret(parsedArguments.getClientSecret())\n+                    .build()\n+            )\n+            .endpoint(parsedArguments.getDigitalTwinEndpoint())\n+            .httpLogOptions(\n+                new HttpLogOptions()\n+                    .setLogLevel(parsedArguments.getHttpLogDetailLevel()))\n+            .buildClient();\n+\n+        ConsoleLogger.printHeader(\"List event routes\");\n+        ConsoleLogger.print(\"Listing all current event routes in your Azure Digital Twins instance\");\n+        PagedIterable<EventRoute> eventRoutes = null;\n+        try {\n+            eventRoutes = client.listEventRoutes();\n+        } catch (ErrorResponseException ex) {\n+            ConsoleLogger.printFatal(\"Failed to list event routes\");\n+            ex.printStackTrace();\n+            System.exit(0);\n+        }\n+\n+        String existingEventRouteId = null;\n+        for (EventRoute eventRoute : eventRoutes) {\n+            existingEventRouteId = eventRoute.getId();\n+            ConsoleLogger.print(String.format(\"     EventRouteId: %s\", eventRoute.getId()));\n+            ConsoleLogger.print(String.format(\"     EventRouteEndpointName: %s\", eventRoute.getEndpointName()));\n+            if (eventRoute.getFilter() != null)\n+            {\n+                ConsoleLogger.print(String.format(\"     Filter: %s\", eventRoute.getFilter()));\n+            }\n+            ConsoleLogger.print(\"\");\n+        }\n+\n+        if (existingEventRouteId != null) {\n+            ConsoleLogger.printHeader(\"Get event route\");\n+            ConsoleLogger.print(String.format(\"Getting a single event route with Id %s\", existingEventRouteId));\n+            try {\n+                EventRoute existingEventRoute = client.getEventRoute(existingEventRouteId);\n+                ConsoleLogger.print(String.format(\"Successfully retrieved event route with Id %s\", existingEventRouteId));\n+                ConsoleLogger.print(String.format(\"     EventRouteId: %s\", existingEventRoute.getId()));", "originalCommit": "ca396bf026e3e9083ef03389578b045c16f19b2f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjU4NzIxOA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15049#discussion_r486587218", "bodyText": "Ah, good thinking. I'll just \\t instead", "author": "timtay-microsoft", "createdAt": "2020-09-10T19:34:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjU4NTk2NQ=="}], "type": "inlineReview"}, {"oid": "698076f33bfec3e7ec05f864236c522b1eeaee96", "url": "https://github.com/Azure/azure-sdk-for-java/commit/698076f33bfec3e7ec05f864236c522b1eeaee96", "message": "cr comments", "committedDate": "2020-09-10T19:35:54Z", "type": "commit"}]}