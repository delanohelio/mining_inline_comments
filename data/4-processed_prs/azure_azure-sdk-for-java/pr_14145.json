{"pr_number": 14145, "pr_title": "Performance: Optimizing the Rntbdtoken codec look-up O(n) -> O(1)", "pr_createdAt": "2020-08-14T20:58:15Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/14145", "timeline": [{"oid": "274aeb0265c189e7db9168fd215995500ad3b035", "url": "https://github.com/Azure/azure-sdk-for-java/commit/274aeb0265c189e7db9168fd215995500ad3b035", "message": "Performance: Optimizing the Rntbdtoken codec look-up O(n) -> O(1)\n\nCurrent implementation doing a for-loop, i,e, for any fromId() invocation results in 16times CPU loop.\nNew implementation pre-caches them and used index lookup.", "committedDate": "2020-08-14T20:56:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDg3OTUxMw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14145#discussion_r470879513", "bodyText": "we don't use \"test\" as prefix nor suffix as a test code style.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public void testAllTokenTypes() {\n          \n          \n            \n                public void allTokenTypes() {", "author": "moderakh", "createdAt": "2020-08-14T21:48:29Z", "path": "sdk/cosmos/azure-cosmos/src/test/java/com/azure/cosmos/implementation/directconnectivity/rntbd/RntbdTokenTypeTests.java", "diffHunk": "@@ -0,0 +1,34 @@\n+package com.azure.cosmos.implementation.directconnectivity.rntbd;\n+\n+import org.testng.annotations.Test;\n+\n+import static org.assertj.core.api.AssertionsForClassTypes.assertThat;\n+\n+public class RntbdTokenTypeTests {\n+\n+    @Test(groups = { \"unit\" })\n+    public void testAllTokenTypes() {", "originalCommit": "274aeb0265c189e7db9168fd215995500ad3b035", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDg3OTU1Ng==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14145#discussion_r470879556", "bodyText": "header filing is missing. please add.", "author": "moderakh", "createdAt": "2020-08-14T21:48:40Z", "path": "sdk/cosmos/azure-cosmos/src/test/java/com/azure/cosmos/implementation/directconnectivity/rntbd/RntbdTokenTypeTests.java", "diffHunk": "@@ -0,0 +1,34 @@\n+package com.azure.cosmos.implementation.directconnectivity.rntbd;", "originalCommit": "274aeb0265c189e7db9168fd215995500ad3b035", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "92bdef38910144fa68371d1d450ecf3ca18fdb0f", "url": "https://github.com/Azure/azure-sdk-for-java/commit/92bdef38910144fa68371d1d450ecf3ca18fdb0f", "message": "Update sdk/cosmos/azure-cosmos/src/test/java/com/azure/cosmos/implementation/directconnectivity/rntbd/RntbdTokenTypeTests.java\n\nCo-authored-by: Mohammad Derakhshani <moderakh@users.noreply.github.com>", "committedDate": "2020-08-14T22:02:27Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDkwMTQxNQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14145#discussion_r470901415", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    for(int i=0; i< maxByteValue; i++) {\n          \n          \n            \n                    for(int i = 0; i < maxByteValue; i++) {", "author": "moderakh", "createdAt": "2020-08-14T23:16:10Z", "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/implementation/directconnectivity/rntbd/RntbdTokenType.java", "diffHunk": "@@ -42,6 +42,24 @@\n     Invalid((byte)0xFF, RntbdNone.codec);             // no data\n \n     // region Implementation\n+    private static final RntbdTokenType[] allTokens = getAllTokens();\n+\n+    private static  RntbdTokenType[] getAllTokens() {\n+        final int maxByteValue = 0xFF + 1;\n+        final RntbdTokenType[] allPossibleTokens = new RntbdTokenType[maxByteValue]; // one byte RNTBD limit\n+        for(int i=0; i< maxByteValue; i++) {", "originalCommit": "92bdef38910144fa68371d1d450ecf3ca18fdb0f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e6b8c57964ddff0e24781c949bdf70ed2aafdaf1", "url": "https://github.com/Azure/azure-sdk-for-java/commit/e6b8c57964ddff0e24781c949bdf70ed2aafdaf1", "message": "Update sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/implementation/directconnectivity/rntbd/RntbdTokenType.java\n\nCo-authored-by: Mohammad Derakhshani <moderakh@users.noreply.github.com>", "committedDate": "2020-08-15T01:47:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDkyNzA4Nw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14145#discussion_r470927087", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            package com.azure.cosmos.implementation.directconnectivity.rntbd;\n          \n          \n            \n            // Copyright (c) Microsoft Corporation. All rights reserved.\n          \n          \n            \n            // Licensed under the MIT License.\n          \n          \n            \n            \n          \n          \n            \n            package com.azure.cosmos.implementation.directconnectivity.rntbd;", "author": "kirankumarkolli", "createdAt": "2020-08-15T02:33:16Z", "path": "sdk/cosmos/azure-cosmos/src/test/java/com/azure/cosmos/implementation/directconnectivity/rntbd/RntbdTokenTypeTests.java", "diffHunk": "@@ -0,0 +1,34 @@\n+package com.azure.cosmos.implementation.directconnectivity.rntbd;", "originalCommit": "e6b8c57964ddff0e24781c949bdf70ed2aafdaf1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "93028d72d4eedbe178ca31d75ba16af160b1e57a", "url": "https://github.com/Azure/azure-sdk-for-java/commit/93028d72d4eedbe178ca31d75ba16af160b1e57a", "message": "Update sdk/cosmos/azure-cosmos/src/test/java/com/azure/cosmos/implementation/directconnectivity/rntbd/RntbdTokenTypeTests.java", "committedDate": "2020-08-15T02:33:24Z", "type": "commit"}]}