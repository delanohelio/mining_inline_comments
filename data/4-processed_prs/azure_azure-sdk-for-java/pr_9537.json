{"pr_number": 9537, "pr_title": "Added AzureKeyCredentialPolicy to Azure Core", "pr_createdAt": "2020-03-25T22:14:09Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/9537", "timeline": [{"oid": "37e383a4668fbf24b456621e92fab6b64498505e", "url": "https://github.com/Azure/azure-sdk-for-java/commit/37e383a4668fbf24b456621e92fab6b64498505e", "message": "Added AzureKeyCredentialPolicy and removed service specific policies which it replaces", "committedDate": "2020-03-25T22:11:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODc0OTk4Ng==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9537#discussion_r398749986", "bodyText": "Alan, on Python land, Johan is suggesting to change the parameter name from header to name so whenever we have a service that uses query keys instead of header keys, this name will work.\nI am considering changing it in .NET too so we are consistent\nMore info here: Azure/azure-sdk-for-python#10509 (comment)\nWhat do you think?", "author": "maririos", "createdAt": "2020-03-26T17:19:08Z", "path": "sdk/core/azure-core/src/main/java/com/azure/core/http/policy/AzureKeyCredentialPolicy.java", "diffHunk": "@@ -0,0 +1,56 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.core.http.policy;\n+\n+import com.azure.core.credential.AzureKeyCredential;\n+import com.azure.core.http.HttpPipelineCallContext;\n+import com.azure.core.http.HttpPipelineNextPolicy;\n+import com.azure.core.http.HttpResponse;\n+import com.azure.core.util.logging.ClientLogger;\n+import reactor.core.publisher.Mono;\n+\n+import java.util.Objects;\n+\n+/**\n+ * Pipeline policy that uses an {@link AzureKeyCredential} to set the specified header which authorizes requests.\n+ *\n+ * <p>\n+ * Requests sent with this pipeline policy are required to use {@code HTTPS}. If the request isn't using {@code HTTPS}\n+ * an exception will be thrown to prevent leaking the key.\n+ */\n+public final class AzureKeyCredentialPolicy implements HttpPipelinePolicy {\n+    private final ClientLogger logger = new ClientLogger(AzureKeyCredentialPolicy.class);\n+\n+    private final String header;\n+    private final AzureKeyCredential credential;\n+\n+    /**\n+     * Creates a policy that uses the passed {@link AzureKeyCredential} to set the specified header.\n+     *\n+     * @param header The header that will be set to the {@link AzureKeyCredential} key value.\n+     * @param credential The {@link AzureKeyCredential} containing the authorization key to use.\n+     * @throws NullPointerException If {@code header} or {@code credential} is {@code null}.\n+     * @throws IllegalArgumentException If {@code header} is empty.\n+     */\n+    public AzureKeyCredentialPolicy(String header, AzureKeyCredential credential) {", "originalCommit": "37e383a4668fbf24b456621e92fab6b64498505e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODc2NjM1MA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9537#discussion_r398766350", "bodyText": "Works with me, this is a non-breaking change for Java since we don't have named arguments.", "author": "alzimmermsft", "createdAt": "2020-03-26T17:41:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODc0OTk4Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODc2ODUyMg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9537#discussion_r398768522", "bodyText": "Though if we have plans to support both headers and query parameters for the passed key Java may want to change this interface a bit to have a flag such as isHeaderKey and context switch on that to either add it as a header or a query parameter. This could also be added later as a non-breaking change.", "author": "alzimmermsft", "createdAt": "2020-03-26T17:44:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODc0OTk4Ng=="}], "type": "inlineReview"}, {"oid": "2504723be2a88cdf7a49fe0859d98b2553cfb126", "url": "https://github.com/Azure/azure-sdk-for-java/commit/2504723be2a88cdf7a49fe0859d98b2553cfb126", "message": "Merge branch 'master' into AzCore_AddAzureKeyCredentialPolicy", "committedDate": "2020-03-26T18:46:08Z", "type": "commit"}, {"oid": "6482d3cacae3afd94ebb929ba1eada421532a4ba", "url": "https://github.com/Azure/azure-sdk-for-java/commit/6482d3cacae3afd94ebb929ba1eada421532a4ba", "message": "Rename header to name", "committedDate": "2020-03-26T18:49:52Z", "type": "commit"}]}