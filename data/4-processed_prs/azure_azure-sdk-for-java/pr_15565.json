{"pr_number": 15565, "pr_title": "JSON-Merge-Patch and Option type to represent value (null value or non-null value) or no-value.", "pr_createdAt": "2020-09-23T19:13:15Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/15565", "timeline": [{"oid": "797a34ce82b60d99615a1d429431ce5947ab24a6", "url": "https://github.com/Azure/azure-sdk-for-java/commit/797a34ce82b60d99615a1d429431ce5947ab24a6", "message": "Adding Option type that can represent value (null value or non-null value) or no value.", "committedDate": "2020-09-23T18:43:54Z", "type": "commit"}, {"oid": "893fe861abbf5a56c6d8a2ab0eae06cea12ed6f0", "url": "https://github.com/Azure/azure-sdk-for-java/commit/893fe861abbf5a56c6d8a2ab0eae06cea12ed6f0", "message": "split some(null|non-null) into empty() and of(non-null), adding ofNullable(non|non-null), rename none() to unset().", "committedDate": "2020-09-24T01:14:27Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzY4MzY5Mw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15565#discussion_r497683693", "bodyText": "Can make this into a singleton as we have with UNSET.", "author": "alzimmermsft", "createdAt": "2020-09-30T17:30:40Z", "path": "sdk/core/azure-core/src/main/java/com/azure/core/util/Option.java", "diffHunk": "@@ -0,0 +1,97 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.core.util;\n+\n+import java.util.NoSuchElementException;\n+import java.util.Objects;\n+\n+/**\n+ * The Option type, every Option is either has a value present including null,\n+ * or has no value present.\n+ *\n+ * @param <T> The value type.\n+ */\n+public final class Option<T> {\n+    private static final Option<?> UNSET = new Option<>();\n+    private final boolean isSet;\n+    private final T value;\n+\n+    /**\n+     * Returns an {@link Option} instance with no value.\n+     *\n+     * @param <T> The value type.\n+     * @return An Option type with no value present.\n+     */\n+    public static <T> Option<T> unset() {\n+        @SuppressWarnings(\"unchecked\")\n+        Option<T> none = (Option<T>) UNSET;\n+        return none;\n+    }\n+\n+    /**\n+     * Returns an {@link Option} with an empty value.\n+     *\n+     * @param <T> The value type.\n+     * @return an {@link Option} with the empty value present.\n+     */\n+    public static <T> Option<T> empty() {\n+        return new Option<>(null);", "originalCommit": "893fe861abbf5a56c6d8a2ab0eae06cea12ed6f0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzYzMTYwMg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15565#discussion_r503631602", "bodyText": "added singleton for EMPTY.", "author": "anuchandy", "createdAt": "2020-10-13T02:30:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzY4MzY5Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzY4NDI2OQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15565#discussion_r497684269", "bodyText": "We'll need to expand on these Javadocs because isSet will be true when the value is null and for many null indicates that a value isn't present.", "author": "alzimmermsft", "createdAt": "2020-09-30T17:31:43Z", "path": "sdk/core/azure-core/src/main/java/com/azure/core/util/Option.java", "diffHunk": "@@ -0,0 +1,97 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.core.util;\n+\n+import java.util.NoSuchElementException;\n+import java.util.Objects;\n+\n+/**\n+ * The Option type, every Option is either has a value present including null,\n+ * or has no value present.\n+ *\n+ * @param <T> The value type.\n+ */\n+public final class Option<T> {\n+    private static final Option<?> UNSET = new Option<>();\n+    private final boolean isSet;\n+    private final T value;\n+\n+    /**\n+     * Returns an {@link Option} instance with no value.\n+     *\n+     * @param <T> The value type.\n+     * @return An Option type with no value present.\n+     */\n+    public static <T> Option<T> unset() {\n+        @SuppressWarnings(\"unchecked\")\n+        Option<T> none = (Option<T>) UNSET;\n+        return none;\n+    }\n+\n+    /**\n+     * Returns an {@link Option} with an empty value.\n+     *\n+     * @param <T> The value type.\n+     * @return an {@link Option} with the empty value present.\n+     */\n+    public static <T> Option<T> empty() {\n+        return new Option<>(null);\n+    }\n+\n+    /**\n+     * Returns an {@link Option} with the specified non-null value.\n+     *\n+     * @param <T> The value type.\n+     * @param value the value, which must be non-null.\n+     * @return an {@link Option} with the non-null value present.\n+     * @throws NullPointerException if value is null.\n+     */\n+    public static <T> Option<T> of(T value) {\n+        Objects.requireNonNull(value);\n+        return new Option<>(value);\n+    }\n+\n+    /**\n+     * Returns an {@link Option} with the specified nullable value.\n+     *\n+     * @param <T> The value type.\n+     * @param value the null or non-null value.\n+     * @return an {@link Option} with the value present.\n+     */\n+    public static <T> Option<T> ofNullable(T value) {\n+        return new Option<>(value);\n+    }\n+\n+    /**\n+     * Return {@code true} if there is a value present, otherwise {@code false}.", "originalCommit": "893fe861abbf5a56c6d8a2ab0eae06cea12ed6f0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODU4MjU5MA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15565#discussion_r498582590", "bodyText": "I think we should change this into empty and make the current empty clear. This pattern will follow more closely with what Optional types in Java do, where it is expected that isPresent on empty will return false. With the current design empty will return true for isSet, which makes it a better candidate to be called clear.", "author": "alzimmermsft", "createdAt": "2020-10-02T01:19:57Z", "path": "sdk/core/azure-core/src/main/java/com/azure/core/util/Option.java", "diffHunk": "@@ -0,0 +1,97 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.core.util;\n+\n+import java.util.NoSuchElementException;\n+import java.util.Objects;\n+\n+/**\n+ * The Option type, every Option is either has a value present including null,\n+ * or has no value present.\n+ *\n+ * @param <T> The value type.\n+ */\n+public final class Option<T> {\n+    private static final Option<?> UNSET = new Option<>();\n+    private final boolean isSet;\n+    private final T value;\n+\n+    /**\n+     * Returns an {@link Option} instance with no value.\n+     *\n+     * @param <T> The value type.\n+     * @return An Option type with no value present.\n+     */\n+    public static <T> Option<T> unset() {", "originalCommit": "893fe861abbf5a56c6d8a2ab0eae06cea12ed6f0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQ0NTExMw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15565#discussion_r503445113", "bodyText": "The Option type is for \"tri-state\", to support explicit-null. When the user uses Option::ofNullable(null), it means value-present as explicit-null.\nThe JDK Optional is for \"two-sate\". The Optional::ofNullable(non-null) means value-present and Optional::ofNullable(null) means value-not-present.  Optional::ofNullable(null)  == Optional::empty() (isPresent() == false).\nDue to above \"tri-state\" vs \"two-state\", the meaning of Option::ofNullable(null) [value-present i.e. explicit-null] and Optional::ofNullable(null) [value-not-present] is different. This indirectly affect meaning of empty as well.\nNow I wonder should we remove Option::empty() from the\"Option\" to reduce confusion? then we'll have:\nOption.of(non-null) | Option.ofNullable(value|null) == value-present\nOption.unset() == value-not-present\nBtw I'm still not happy with the name Option.unset(), while Option a normal type but when used in the REST API context, Option.unset() means don't change the server value.\nThoughts?\n\\cc @alzimmermsft  @JonathanGiles @srnagar", "author": "anuchandy", "createdAt": "2020-10-12T17:47:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODU4MjU5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQ4Njg2MQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15565#discussion_r503486861", "bodyText": "We can borrow the JavaScript terminology for tri-state - uninitialized to represent not set, empty for initialized but with a null value and T for non-null value.", "author": "srnagar", "createdAt": "2020-10-12T19:19:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODU4MjU5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQ5MjQyMg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15565#discussion_r503492422", "bodyText": "I think that's what we have today, js_uninitialized == java_unset, Option.empty() == explicit-null. One proposed name for \"unset\" is \"uninitialized\" i.e. Option.uninitialized().\nRegarding using \"empty\" for \"null\", do want empty? or given Option is for \"tri-state\" and \"null\" is a valid value, should we just expose \"Option.ofNullable(null)\" or  \"Option.of(null)\"  for explicit-null?", "author": "anuchandy", "createdAt": "2020-10-12T19:32:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODU4MjU5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQ5NDYzNg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15565#discussion_r503494636", "bodyText": "Yeah, I was proposing we use the term uninitialized instead of unset. unset can have dual meaning which can either mean that the value is not set or that the value that is already set is reverted.", "author": "srnagar", "createdAt": "2020-10-12T19:38:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODU4MjU5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzYzMTEyOQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15565#discussion_r503631129", "bodyText": "renamed unset to uninitialized.\nI kept empty() with the same meaning i.e. empty == initialized with a null", "author": "anuchandy", "createdAt": "2020-10-13T02:28:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODU4MjU5MA=="}], "type": "inlineReview"}, {"oid": "20acbe56b0086c338612468be9ccb6d882f5172d", "url": "https://github.com/Azure/azure-sdk-for-java/commit/20acbe56b0086c338612468be9ccb6d882f5172d", "message": "sync with upstream", "committedDate": "2020-10-12T15:00:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQ4ODYyMg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15565#discussion_r503488622", "bodyText": "I think these two can be combined. We can just have Option.of(T value) if the value is null we know it represents empty. Do we have any added benefit of having two separate methods? With these two methods - the user will either always use ofNullable just to be safe or will have to write something like\nOption<T> patchValue;\nif( value != null) { \n      patchValue = Option.of(value); \n} else { \n     patchValue = Option.empty();\n}", "author": "srnagar", "createdAt": "2020-10-12T19:23:35Z", "path": "sdk/core/azure-core/src/main/java/com/azure/core/util/Option.java", "diffHunk": "@@ -0,0 +1,97 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.core.util;\n+\n+import java.util.NoSuchElementException;\n+import java.util.Objects;\n+\n+/**\n+ * The Option type, every Option is either has a value present including null,\n+ * or has no value present.\n+ *\n+ * @param <T> The value type.\n+ */\n+public final class Option<T> {\n+    private static final Option<?> UNSET = new Option<>();\n+    private final boolean isSet;\n+    private final T value;\n+\n+    /**\n+     * Returns an {@link Option} instance with no value.\n+     *\n+     * @param <T> The value type.\n+     * @return An Option type with no value present.\n+     */\n+    public static <T> Option<T> unset() {\n+        @SuppressWarnings(\"unchecked\")\n+        Option<T> none = (Option<T>) UNSET;\n+        return none;\n+    }\n+\n+    /**\n+     * Returns an {@link Option} with an empty value.\n+     *\n+     * @param <T> The value type.\n+     * @return an {@link Option} with the empty value present.\n+     */\n+    public static <T> Option<T> empty() {\n+        return new Option<>(null);\n+    }\n+\n+    /**\n+     * Returns an {@link Option} with the specified non-null value.\n+     *\n+     * @param <T> The value type.\n+     * @param value the value, which must be non-null.\n+     * @return an {@link Option} with the non-null value present.\n+     * @throws NullPointerException if value is null.\n+     */\n+    public static <T> Option<T> of(T value) {\n+        Objects.requireNonNull(value);\n+        return new Option<>(value);\n+    }\n+\n+    /**\n+     * Returns an {@link Option} with the specified nullable value.\n+     *\n+     * @param <T> The value type.\n+     * @param value the null or non-null value.\n+     * @return an {@link Option} with the value present.\n+     */\n+    public static <T> Option<T> ofNullable(T value) {\n+        return new Option<>(value);\n+    }", "originalCommit": "20acbe56b0086c338612468be9ccb6d882f5172d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQ5NTIwOA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15565#discussion_r503495208", "bodyText": "I agree with that, T is anyway nullable, so we can just have of(non-null|null)", "author": "anuchandy", "createdAt": "2020-10-12T19:39:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQ4ODYyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzYzMDkzNg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15565#discussion_r503630936", "bodyText": "removed ofNullable and enable of to take null as well.", "author": "anuchandy", "createdAt": "2020-10-13T02:28:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQ4ODYyMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQ4OTczMg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15565#discussion_r503489732", "bodyText": "If we use the JS terminology, we can change this method name to isInitialized(). We should also consider adding isPresent() to return true if isInitialized() && value != null.", "author": "srnagar", "createdAt": "2020-10-12T19:26:03Z", "path": "sdk/core/azure-core/src/main/java/com/azure/core/util/Option.java", "diffHunk": "@@ -0,0 +1,97 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.core.util;\n+\n+import java.util.NoSuchElementException;\n+import java.util.Objects;\n+\n+/**\n+ * The Option type, every Option is either has a value present including null,\n+ * or has no value present.\n+ *\n+ * @param <T> The value type.\n+ */\n+public final class Option<T> {\n+    private static final Option<?> UNSET = new Option<>();\n+    private final boolean isSet;\n+    private final T value;\n+\n+    /**\n+     * Returns an {@link Option} instance with no value.\n+     *\n+     * @param <T> The value type.\n+     * @return An Option type with no value present.\n+     */\n+    public static <T> Option<T> unset() {\n+        @SuppressWarnings(\"unchecked\")\n+        Option<T> none = (Option<T>) UNSET;\n+        return none;\n+    }\n+\n+    /**\n+     * Returns an {@link Option} with an empty value.\n+     *\n+     * @param <T> The value type.\n+     * @return an {@link Option} with the empty value present.\n+     */\n+    public static <T> Option<T> empty() {\n+        return new Option<>(null);\n+    }\n+\n+    /**\n+     * Returns an {@link Option} with the specified non-null value.\n+     *\n+     * @param <T> The value type.\n+     * @param value the value, which must be non-null.\n+     * @return an {@link Option} with the non-null value present.\n+     * @throws NullPointerException if value is null.\n+     */\n+    public static <T> Option<T> of(T value) {\n+        Objects.requireNonNull(value);\n+        return new Option<>(value);\n+    }\n+\n+    /**\n+     * Returns an {@link Option} with the specified nullable value.\n+     *\n+     * @param <T> The value type.\n+     * @param value the null or non-null value.\n+     * @return an {@link Option} with the value present.\n+     */\n+    public static <T> Option<T> ofNullable(T value) {\n+        return new Option<>(value);\n+    }\n+\n+    /**\n+     * Return {@code true} if there is a value present, otherwise {@code false}.\n+     *\n+     * @return {@code true} if there is a value present, otherwise {@code false}\n+     */\n+    public boolean isSet() {\n+        return this.isSet;\n+    }", "originalCommit": "20acbe56b0086c338612468be9ccb6d882f5172d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQ5NjA4OQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15565#discussion_r503496089", "bodyText": "sounds good, so Option.unset() will be Option.uninitialized(). Option.isSet() become Option.isInitialized()", "author": "anuchandy", "createdAt": "2020-10-12T19:41:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQ4OTczMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQ5NzU5Mg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15565#discussion_r503497592", "bodyText": "I've question-related to isPresent(), given \"of(null)\" represent \"presence\" of explicit-null, would it be confusing having this method returning false when Option is in the explicit-null state?", "author": "anuchandy", "createdAt": "2020-10-12T19:45:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQ4OTczMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQ5ODY4NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15565#discussion_r503498684", "bodyText": "I think that's what isPresent() in Java's Optional does. It returns true only if the value is non-null. For everything else, it returns false. So, in our case, isPresent will return the following:\nuninitialized - false\nnull value - false\nnon-null value - true", "author": "srnagar", "createdAt": "2020-10-12T19:48:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQ4OTczMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQ5OTkzMg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15565#discussion_r503499932", "bodyText": "Also, if you think there's room for confusion with this API and is something that we don't need to add right away, we can add this later too. It just means that the user will have to do this check themselves: if(patchValue.isInitialized() && patchValue.getValue() != null). So, isPresent() is just syntactic sugar that can be introduced later, if required.", "author": "srnagar", "createdAt": "2020-10-12T19:51:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQ4OTczMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzUwNzI4Nw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15565#discussion_r503507287", "bodyText": "thanks! yes, it's clear the purpose of \"isPresent()\" w.r.t Optional, given it's a two-state type. It's a bit confusing for me the behaviour of  \"isPresent()\" in a tri-state type.\nLike you said, maybe we want to hold on to it and introduce it later once we see a need for it. At least now, I see the \"Option\" type is mainly used in the input model than output model, its mostly inspected in the azure-core side while serializing.", "author": "anuchandy", "createdAt": "2020-10-12T20:05:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQ4OTczMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzYzMTM4Mw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15565#discussion_r503631383", "bodyText": "Renamed, Option.unset() -> Option.uninitialized(). Option.isSet() -> Option.isInitialized().", "author": "anuchandy", "createdAt": "2020-10-13T02:29:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQ4OTczMg=="}], "type": "inlineReview"}, {"oid": "3726ae207d133ba40047d59d93298c744a5037d9", "url": "https://github.com/Azure/azure-sdk-for-java/commit/3726ae207d133ba40047d59d93298c744a5037d9", "message": "rename unset to uninitialized", "committedDate": "2020-10-13T02:25:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDEwMTI3OA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15565#discussion_r504101278", "bodyText": "Do we want to state No value initialized?", "author": "alzimmermsft", "createdAt": "2020-10-13T16:38:55Z", "path": "sdk/core/azure-core/src/main/java/com/azure/core/util/Option.java", "diffHunk": "@@ -0,0 +1,89 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.core.util;\n+\n+import java.util.NoSuchElementException;\n+\n+/**\n+ * The Option type to describe tri-state. Every Option instance is in one of\n+ * the three states: a state representing a non-null-value, null-value, or no-value.\n+ *\n+ * @param <T> The value type.\n+ */\n+public final class Option<T> {\n+    private static final Option<?> UNINITIALIZED = new Option<>();\n+    private static final Option<?> EMPTY = new Option<>(null);\n+    private final boolean isInitialized;\n+    private final T value;\n+\n+    /**\n+     * Returns an {@link Option} with the specified null-value or non-null-value.\n+     *\n+     * @param <T> The value type.\n+     * @param value the value.\n+     * @return an {@link Option} with the value present.\n+     */\n+    public static <T> Option<T> of(T value) {\n+        return value == null ? empty() : new Option<>(value);\n+    }\n+\n+    /**\n+     * Returns an {@link Option} with null-value.\n+     * <p>\n+     * {@code Option.empty()} is a syntactic sugar for {@code Option.of(null)}.\n+     * </p>\n+     * @param <T> The value type.\n+     * @return an {@link Option} with a null-value.\n+     */\n+    public static <T> Option<T> empty() {\n+        @SuppressWarnings(\"unchecked\")\n+        Option<T> empty = (Option<T>) EMPTY;\n+        return empty;\n+    }\n+\n+    /**\n+     * Returns an {@link Option} instance with no-value.\n+     *\n+     * @param <T> Type of the non-existent value.\n+     * @return An Option type with no-value.\n+     */\n+    public static <T> Option<T> uninitialized() {\n+        @SuppressWarnings(\"unchecked\")\n+        Option<T> uninitialized = (Option<T>) UNINITIALIZED;\n+        return uninitialized;\n+    }\n+\n+    /**\n+     * Return {@code true} if this instance is initialized with a null-value or non-null-value,\n+     * otherwise {@code false}.\n+     *\n+     * @return {@code true} if there is a value present, otherwise {@code false}\n+     */\n+    public boolean isInitialized() {\n+        return this.isInitialized;\n+    }\n+\n+    /**\n+     * Gets the value in the {@link Option}.\n+     *\n+     * @return The value.\n+     * @throws NoSuchElementException thrown if the {@link Option} has no value.\n+     */\n+    public T getValue() {\n+        if (!this.isInitialized) {\n+            throw new NoSuchElementException(\"No value present\");", "originalCommit": "3726ae207d133ba40047d59d93298c744a5037d9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjc0NzY4OA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15565#discussion_r506747688", "bodyText": "agree, the proposed text better aligns the purpose of type, will update.", "author": "anuchandy", "createdAt": "2020-10-16T22:28:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDEwMTI3OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDEwMTYzNQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15565#discussion_r504101635", "bodyText": "May want to discuss that the value could be null.", "author": "alzimmermsft", "createdAt": "2020-10-13T16:39:14Z", "path": "sdk/core/azure-core/src/main/java/com/azure/core/util/Option.java", "diffHunk": "@@ -0,0 +1,89 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.core.util;\n+\n+import java.util.NoSuchElementException;\n+\n+/**\n+ * The Option type to describe tri-state. Every Option instance is in one of\n+ * the three states: a state representing a non-null-value, null-value, or no-value.\n+ *\n+ * @param <T> The value type.\n+ */\n+public final class Option<T> {\n+    private static final Option<?> UNINITIALIZED = new Option<>();\n+    private static final Option<?> EMPTY = new Option<>(null);\n+    private final boolean isInitialized;\n+    private final T value;\n+\n+    /**\n+     * Returns an {@link Option} with the specified null-value or non-null-value.\n+     *\n+     * @param <T> The value type.\n+     * @param value the value.\n+     * @return an {@link Option} with the value present.\n+     */\n+    public static <T> Option<T> of(T value) {\n+        return value == null ? empty() : new Option<>(value);\n+    }\n+\n+    /**\n+     * Returns an {@link Option} with null-value.\n+     * <p>\n+     * {@code Option.empty()} is a syntactic sugar for {@code Option.of(null)}.\n+     * </p>\n+     * @param <T> The value type.\n+     * @return an {@link Option} with a null-value.\n+     */\n+    public static <T> Option<T> empty() {\n+        @SuppressWarnings(\"unchecked\")\n+        Option<T> empty = (Option<T>) EMPTY;\n+        return empty;\n+    }\n+\n+    /**\n+     * Returns an {@link Option} instance with no-value.\n+     *\n+     * @param <T> Type of the non-existent value.\n+     * @return An Option type with no-value.\n+     */\n+    public static <T> Option<T> uninitialized() {\n+        @SuppressWarnings(\"unchecked\")\n+        Option<T> uninitialized = (Option<T>) UNINITIALIZED;\n+        return uninitialized;\n+    }\n+\n+    /**\n+     * Return {@code true} if this instance is initialized with a null-value or non-null-value,\n+     * otherwise {@code false}.\n+     *\n+     * @return {@code true} if there is a value present, otherwise {@code false}\n+     */\n+    public boolean isInitialized() {\n+        return this.isInitialized;\n+    }\n+\n+    /**\n+     * Gets the value in the {@link Option}.", "originalCommit": "3726ae207d133ba40047d59d93298c744a5037d9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjc3MDI1NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15565#discussion_r506770254", "bodyText": "updated the JavaDoc.", "author": "anuchandy", "createdAt": "2020-10-17T00:20:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDEwMTYzNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDEwMjk5Ng==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15565#discussion_r504102996", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * @return {@code true} if there is a value present, otherwise {@code false}\n          \n          \n            \n                 * @return {@code true} if a value has been initialized, otherwise {@code false}\n          \n      \n    \n    \n  \n\nThink it would be good to use the terminology initialized everywhere instead of present as present usually has a different connotation.", "author": "alzimmermsft", "createdAt": "2020-10-13T16:40:32Z", "path": "sdk/core/azure-core/src/main/java/com/azure/core/util/Option.java", "diffHunk": "@@ -0,0 +1,89 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.core.util;\n+\n+import java.util.NoSuchElementException;\n+\n+/**\n+ * The Option type to describe tri-state. Every Option instance is in one of\n+ * the three states: a state representing a non-null-value, null-value, or no-value.\n+ *\n+ * @param <T> The value type.\n+ */\n+public final class Option<T> {\n+    private static final Option<?> UNINITIALIZED = new Option<>();\n+    private static final Option<?> EMPTY = new Option<>(null);\n+    private final boolean isInitialized;\n+    private final T value;\n+\n+    /**\n+     * Returns an {@link Option} with the specified null-value or non-null-value.\n+     *\n+     * @param <T> The value type.\n+     * @param value the value.\n+     * @return an {@link Option} with the value present.\n+     */\n+    public static <T> Option<T> of(T value) {\n+        return value == null ? empty() : new Option<>(value);\n+    }\n+\n+    /**\n+     * Returns an {@link Option} with null-value.\n+     * <p>\n+     * {@code Option.empty()} is a syntactic sugar for {@code Option.of(null)}.\n+     * </p>\n+     * @param <T> The value type.\n+     * @return an {@link Option} with a null-value.\n+     */\n+    public static <T> Option<T> empty() {\n+        @SuppressWarnings(\"unchecked\")\n+        Option<T> empty = (Option<T>) EMPTY;\n+        return empty;\n+    }\n+\n+    /**\n+     * Returns an {@link Option} instance with no-value.\n+     *\n+     * @param <T> Type of the non-existent value.\n+     * @return An Option type with no-value.\n+     */\n+    public static <T> Option<T> uninitialized() {\n+        @SuppressWarnings(\"unchecked\")\n+        Option<T> uninitialized = (Option<T>) UNINITIALIZED;\n+        return uninitialized;\n+    }\n+\n+    /**\n+     * Return {@code true} if this instance is initialized with a null-value or non-null-value,\n+     * otherwise {@code false}.\n+     *\n+     * @return {@code true} if there is a value present, otherwise {@code false}", "originalCommit": "3726ae207d133ba40047d59d93298c744a5037d9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjc3MDUyMw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15565#discussion_r506770523", "bodyText": "done! Thanks for the suggestion, this is better doc.", "author": "anuchandy", "createdAt": "2020-10-17T00:22:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDEwMjk5Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDEwNzAzMA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15565#discussion_r504107030", "bodyText": "We should add code snippets which outline the three scenarios with calls to isInitialized and getValue and have comments on what their expected result would be, for the non-null and uninitialized scenarios:\nOption<String> endpointOption = Option.of(\"https://example.com\");\n\nif (endpointOption.isInitialized()) { // Returns true\n  System.out.println(endpointOption.getValue());\n}\n\nOption<String> unitializedOption = Option.unitialized();\n\nif (unitializedOption.isInitialized()) { // Returns false\n\n}\n\nunitializedOption.getValue(); // Throws NoSuchElementException", "author": "alzimmermsft", "createdAt": "2020-10-13T16:45:00Z", "path": "sdk/core/azure-core/src/main/java/com/azure/core/util/Option.java", "diffHunk": "@@ -0,0 +1,89 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.core.util;\n+\n+import java.util.NoSuchElementException;\n+\n+/**\n+ * The Option type to describe tri-state. Every Option instance is in one of\n+ * the three states: a state representing a non-null-value, null-value, or no-value.\n+ *", "originalCommit": "3726ae207d133ba40047d59d93298c744a5037d9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjc3NjM1MQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15565#discussion_r506776351", "bodyText": "code-snippet added.", "author": "anuchandy", "createdAt": "2020-10-17T01:09:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDEwNzAzMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDg5NTU4Mw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15565#discussion_r504895583", "bodyText": "Are we going to add a JsonSerializer<Option> implementation to JacksonAdapter?", "author": "alzimmermsft", "createdAt": "2020-10-14T18:44:35Z", "path": "sdk/core/azure-core/src/main/java/com/azure/core/util/Option.java", "diffHunk": "@@ -0,0 +1,89 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.core.util;\n+\n+import java.util.NoSuchElementException;\n+\n+/**\n+ * The Option type to describe tri-state. Every Option instance is in one of\n+ * the three states: a state representing a non-null-value, null-value, or no-value.\n+ *\n+ * @param <T> The value type.\n+ */\n+public final class Option<T> {", "originalCommit": "3726ae207d133ba40047d59d93298c744a5037d9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjc0ODEwOA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15565#discussion_r506748108", "bodyText": "yes, we will, it will look very close to the serializer for Optional in Java8Module.", "author": "anuchandy", "createdAt": "2020-10-16T22:30:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDg5NTU4Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjc2OTkwNg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15565#discussion_r506769906", "bodyText": "Serializer for Option type is added.", "author": "anuchandy", "createdAt": "2020-10-17T00:17:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDg5NTU4Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjc1MDcwNw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15565#discussion_r506750707", "bodyText": "Should we allow uninitialized Option to be initialized later after creation by calling setValue(T value)?", "author": "srnagar", "createdAt": "2020-10-16T22:40:56Z", "path": "sdk/core/azure-core/src/main/java/com/azure/core/util/Option.java", "diffHunk": "@@ -0,0 +1,89 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.core.util;\n+\n+import java.util.NoSuchElementException;\n+\n+/**\n+ * The Option type to describe tri-state. Every Option instance is in one of\n+ * the three states: a state representing a non-null-value, null-value, or no-value.\n+ *\n+ * @param <T> The value type.\n+ */\n+public final class Option<T> {\n+    private static final Option<?> UNINITIALIZED = new Option<>();\n+    private static final Option<?> EMPTY = new Option<>(null);\n+    private final boolean isInitialized;\n+    private final T value;\n+\n+    /**\n+     * Returns an {@link Option} with the specified null-value or non-null-value.\n+     *\n+     * @param <T> The value type.\n+     * @param value the value.\n+     * @return an {@link Option} with the value present.\n+     */\n+    public static <T> Option<T> of(T value) {\n+        return value == null ? empty() : new Option<>(value);\n+    }\n+\n+    /**\n+     * Returns an {@link Option} with null-value.\n+     * <p>\n+     * {@code Option.empty()} is a syntactic sugar for {@code Option.of(null)}.\n+     * </p>\n+     * @param <T> The value type.\n+     * @return an {@link Option} with a null-value.\n+     */\n+    public static <T> Option<T> empty() {\n+        @SuppressWarnings(\"unchecked\")\n+        Option<T> empty = (Option<T>) EMPTY;\n+        return empty;\n+    }\n+\n+    /**\n+     * Returns an {@link Option} instance with no-value.\n+     *\n+     * @param <T> Type of the non-existent value.\n+     * @return An Option type with no-value.\n+     */\n+    public static <T> Option<T> uninitialized() {", "originalCommit": "3726ae207d133ba40047d59d93298c744a5037d9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjc2MDA1Ng==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15565#discussion_r506760056", "bodyText": "pls refer comment", "author": "anuchandy", "createdAt": "2020-10-16T23:21:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjc1MDcwNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjc1MTUwNA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15565#discussion_r506751504", "bodyText": "This should log and throw.", "author": "srnagar", "createdAt": "2020-10-16T22:44:33Z", "path": "sdk/core/azure-core/src/main/java/com/azure/core/util/Option.java", "diffHunk": "@@ -0,0 +1,89 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.core.util;\n+\n+import java.util.NoSuchElementException;\n+\n+/**\n+ * The Option type to describe tri-state. Every Option instance is in one of\n+ * the three states: a state representing a non-null-value, null-value, or no-value.\n+ *\n+ * @param <T> The value type.\n+ */\n+public final class Option<T> {\n+    private static final Option<?> UNINITIALIZED = new Option<>();\n+    private static final Option<?> EMPTY = new Option<>(null);\n+    private final boolean isInitialized;\n+    private final T value;\n+\n+    /**\n+     * Returns an {@link Option} with the specified null-value or non-null-value.\n+     *\n+     * @param <T> The value type.\n+     * @param value the value.\n+     * @return an {@link Option} with the value present.\n+     */\n+    public static <T> Option<T> of(T value) {\n+        return value == null ? empty() : new Option<>(value);\n+    }\n+\n+    /**\n+     * Returns an {@link Option} with null-value.\n+     * <p>\n+     * {@code Option.empty()} is a syntactic sugar for {@code Option.of(null)}.\n+     * </p>\n+     * @param <T> The value type.\n+     * @return an {@link Option} with a null-value.\n+     */\n+    public static <T> Option<T> empty() {\n+        @SuppressWarnings(\"unchecked\")\n+        Option<T> empty = (Option<T>) EMPTY;\n+        return empty;\n+    }\n+\n+    /**\n+     * Returns an {@link Option} instance with no-value.\n+     *\n+     * @param <T> Type of the non-existent value.\n+     * @return An Option type with no-value.\n+     */\n+    public static <T> Option<T> uninitialized() {\n+        @SuppressWarnings(\"unchecked\")\n+        Option<T> uninitialized = (Option<T>) UNINITIALIZED;\n+        return uninitialized;\n+    }\n+\n+    /**\n+     * Return {@code true} if this instance is initialized with a null-value or non-null-value,\n+     * otherwise {@code false}.\n+     *\n+     * @return {@code true} if there is a value present, otherwise {@code false}\n+     */\n+    public boolean isInitialized() {\n+        return this.isInitialized;\n+    }\n+\n+    /**\n+     * Gets the value in the {@link Option}.\n+     *\n+     * @return The value.\n+     * @throws NoSuchElementException thrown if the {@link Option} has no value.\n+     */\n+    public T getValue() {\n+        if (!this.isInitialized) {\n+            throw new NoSuchElementException(\"No value present\");", "originalCommit": "3726ae207d133ba40047d59d93298c744a5037d9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjc3MTc3Nw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15565#discussion_r506771777", "bodyText": "@srnagar  I have a question - Is it a hard rule that any exception has to be wrapped in logger?\nThe reason for asking is - this method we will be called from serializer and will have a isInitialized check before accessing it. We will not have an output model with Option property where the user have to call getValue().\nMy question is, for a type used in input only model with internal guarded access, do we need a logger?. Think of it as the Optional ::value() method in an input only model.\nIf we still require a logger - do we need ONE logger instance per Option instance given there can be many patch Option properties OR should we prefer a static logger?", "author": "anuchandy", "createdAt": "2020-10-17T00:31:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjc1MTUwNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzk4OTU0Mw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15565#discussion_r507989543", "bodyText": "@anuchandy - logging the exception before throwing is just a general guideline to help us investigate issues when customers contact us. In this case, it's debatable whether it adds too much value, so, I am fine with not logging if this doesn't help much in troubleshooting any issues. If we do want to log, then instead of creating a lot of logger instances, we can simply use a static logger.", "author": "srnagar", "createdAt": "2020-10-19T18:55:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjc1MTUwNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzk5NDM2Ng==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15565#discussion_r507994366", "bodyText": "thanks for the response, yep it's a bit hard to pick here - general guideline vs value addition for the specific case. Let's go without logger and add it if we ever use it in the output model.", "author": "anuchandy", "createdAt": "2020-10-19T19:02:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjc1MTUwNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjc1MTk1Mw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15565#discussion_r506751953", "bodyText": "We need a setValue() method as well. Otherwise, this will be immutable resulting in many Option objects being created to mutate the value.", "author": "srnagar", "createdAt": "2020-10-16T22:46:23Z", "path": "sdk/core/azure-core/src/main/java/com/azure/core/util/Option.java", "diffHunk": "@@ -0,0 +1,89 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.core.util;\n+\n+import java.util.NoSuchElementException;\n+\n+/**\n+ * The Option type to describe tri-state. Every Option instance is in one of\n+ * the three states: a state representing a non-null-value, null-value, or no-value.\n+ *\n+ * @param <T> The value type.\n+ */\n+public final class Option<T> {\n+    private static final Option<?> UNINITIALIZED = new Option<>();\n+    private static final Option<?> EMPTY = new Option<>(null);\n+    private final boolean isInitialized;\n+    private final T value;\n+\n+    /**\n+     * Returns an {@link Option} with the specified null-value or non-null-value.\n+     *\n+     * @param <T> The value type.\n+     * @param value the value.\n+     * @return an {@link Option} with the value present.\n+     */\n+    public static <T> Option<T> of(T value) {\n+        return value == null ? empty() : new Option<>(value);\n+    }\n+\n+    /**\n+     * Returns an {@link Option} with null-value.\n+     * <p>\n+     * {@code Option.empty()} is a syntactic sugar for {@code Option.of(null)}.\n+     * </p>\n+     * @param <T> The value type.\n+     * @return an {@link Option} with a null-value.\n+     */\n+    public static <T> Option<T> empty() {\n+        @SuppressWarnings(\"unchecked\")\n+        Option<T> empty = (Option<T>) EMPTY;\n+        return empty;\n+    }\n+\n+    /**\n+     * Returns an {@link Option} instance with no-value.\n+     *\n+     * @param <T> Type of the non-existent value.\n+     * @return An Option type with no-value.\n+     */\n+    public static <T> Option<T> uninitialized() {\n+        @SuppressWarnings(\"unchecked\")\n+        Option<T> uninitialized = (Option<T>) UNINITIALIZED;\n+        return uninitialized;\n+    }\n+\n+    /**\n+     * Return {@code true} if this instance is initialized with a null-value or non-null-value,\n+     * otherwise {@code false}.\n+     *\n+     * @return {@code true} if there is a value present, otherwise {@code false}\n+     */\n+    public boolean isInitialized() {\n+        return this.isInitialized;\n+    }\n+\n+    /**\n+     * Gets the value in the {@link Option}.\n+     *\n+     * @return The value.\n+     * @throws NoSuchElementException thrown if the {@link Option} has no value.\n+     */\n+    public T getValue() {", "originalCommit": "3726ae207d133ba40047d59d93298c744a5037d9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjc1OTg3NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15565#discussion_r506759874", "bodyText": "was thinking about it, the current \"known\" use case is - This type will be used for JSON-merge-patch input only model.\nThe JSON-merge-patch model type will not have any required property constraints. If the user wants to clear a property in the server they set it to \"Option.of(null)\" and to set a value \"Option.of(non-null)\". The instantiation of such a model and setting of its properties highly likely to happen in one place along with an update API call.\nIn this known use case, I couldn't find a need to make this type mutable, unless we foresee the immediate application of this type in any other use case. So I was preferring to keep it simple & immutable, like JDK's Optional type.\nPlease let me know your thoughts.", "author": "anuchandy", "createdAt": "2020-10-16T23:20:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjc1MTk1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjc2MjIyMQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15565#discussion_r506762221", "bodyText": "Yeah, I am fine with just keeping this immutable for now and we can extend it later if there's a usecase for it.", "author": "srnagar", "createdAt": "2020-10-16T23:31:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjc1MTk1Mw=="}], "type": "inlineReview"}, {"oid": "b74aab1d1fd0b2c35edfb634be258596ac3ec68a", "url": "https://github.com/Azure/azure-sdk-for-java/commit/b74aab1d1fd0b2c35edfb634be258596ac3ec68a", "message": "Adding jackson serializer for Option type", "committedDate": "2020-10-17T00:16:38Z", "type": "commit"}, {"oid": "1f1fde0d09b076ecf57a8ab5bf86b624e95bebb9", "url": "https://github.com/Azure/azure-sdk-for-java/commit/1f1fde0d09b076ecf57a8ab5bf86b624e95bebb9", "message": "Option code-snippet and test cleanup", "committedDate": "2020-10-17T01:08:08Z", "type": "commit"}, {"oid": "700d802638f70b03b2717b76dec187fc81240fc8", "url": "https://github.com/Azure/azure-sdk-for-java/commit/700d802638f70b03b2717b76dec187fc81240fc8", "message": "Option: update OptionTypeModifier JavaDoc and adding a test when T in Option is raw type", "committedDate": "2020-10-19T17:12:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzk4NDIzNg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15565#discussion_r507984236", "bodyText": "It might be easier to use stream().filter().foreach() here. Also, is it better to create a new list with new property writers instead of mutating the input list?", "author": "srnagar", "createdAt": "2020-10-19T18:46:13Z", "path": "sdk/core/azure-core/src/main/java/com/azure/core/util/serializer/OptionPropertiesModifier.java", "diffHunk": "@@ -0,0 +1,48 @@\n+/*\n+ * Copyright 2013 FasterXML.com\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License. You may obtain\n+ * a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the license for the specific language governing permissions and\n+ * limitations under the license.\n+ */\n+\n+/*\n+ * Portions Copyright (c) Microsoft Corporation\n+ */\n+\n+package com.azure.core.util.serializer;\n+\n+import com.azure.core.util.Option;\n+import com.fasterxml.jackson.databind.BeanDescription;\n+import com.fasterxml.jackson.databind.SerializationConfig;\n+import com.fasterxml.jackson.databind.ser.BeanPropertyWriter;\n+import com.fasterxml.jackson.databind.ser.BeanSerializerModifier;\n+\n+import java.util.List;\n+\n+/**\n+ * The Serializer modifier for {@link Option} properties to not serialize them when\n+ * those properties are in uninitialized state.\n+ */\n+final class OptionPropertiesModifier extends BeanSerializerModifier {\n+    @Override\n+    public List<BeanPropertyWriter> changeProperties(SerializationConfig config,\n+                                                     BeanDescription beanDesc,\n+                                                     List<BeanPropertyWriter> beanPropertyWriters) {\n+        for (int i = 0; i < beanPropertyWriters.size(); i++) {\n+            final BeanPropertyWriter writer = beanPropertyWriters.get(i);\n+            if (writer.getType().isTypeOrSubTypeOf(Option.class)) {\n+                beanPropertyWriters.set(i, new OptionBeanPropertyWriter(writer));\n+            }\n+        }\n+        return beanPropertyWriters;", "originalCommit": "700d802638f70b03b2717b76dec187fc81240fc8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzk5MTU1NQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15565#discussion_r507991555", "bodyText": "I'm with you on creating a new list; however, this is a hot-path for serialization, so I was debating myself with new list vs mutation, then thought of following what official Jackson doing in its property writers, i.e., mutation :(.", "author": "anuchandy", "createdAt": "2020-10-19T18:58:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzk4NDIzNg=="}], "type": "inlineReview"}]}