{"pr_number": 11474, "pr_title": "Replacing OffsetDateTime and ZonedDateTime with Instant", "pr_createdAt": "2020-05-27T17:19:12Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/11474", "timeline": [{"oid": "f56f17aafb7a03e5d1cc7f4b3d735c134f26ad49", "url": "https://github.com/Azure/azure-sdk-for-java/commit/f56f17aafb7a03e5d1cc7f4b3d735c134f26ad49", "message": "replacing OffsetDateTime and ZonedDateTime with Instant", "committedDate": "2020-05-27T17:16:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTMxNDQ2OQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11474#discussion_r431314469", "bodyText": "does ZonedDateTimeSerializer now how to serialize Instant?", "author": "moderakh", "createdAt": "2020-05-27T17:23:46Z", "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/ClientSideRequestStatistics.java", "diffHunk": "@@ -329,9 +327,9 @@ public void serialize(\n \n     private static class AddressResolutionStatistics {\n         @JsonSerialize(using = ZonedDateTimeSerializer.class)\n-        ZonedDateTime startTime;\n+        Instant startTime;", "originalCommit": "f56f17aafb7a03e5d1cc7f4b3d735c134f26ad49", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjUyODYxOQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11474#discussion_r432528619", "bodyText": "Yes , however renamed the serializer to include instant in name and now it is extending InstantSerializer", "author": "simplynaveen20", "createdAt": "2020-05-29T14:33:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTMxNDQ2OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTMxODg1OA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11474#discussion_r431318858", "bodyText": "why aren't we using existing library serializers?\nhttps://fasterxml.github.io/jackson-datatype-jsr310/javadoc/2.4/com/fasterxml/jackson/datatype/jsr310/ser/InstantSerializer.html", "author": "moderakh", "createdAt": "2020-05-27T17:30:50Z", "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/implementation/ZonedDateTimeSerializer.java", "diffHunk": "@@ -7,31 +7,32 @@\n import com.fasterxml.jackson.databind.ser.std.StdSerializer;\n \n import java.io.IOException;\n-import java.time.ZonedDateTime;\n+import java.time.Instant;\n+import java.time.ZoneOffset;\n import java.time.format.DateTimeFormatter;\n import java.util.Locale;\n \n-public class ZonedDateTimeSerializer extends StdSerializer<ZonedDateTime> {\n+public class ZonedDateTimeSerializer extends StdSerializer<Instant> {", "originalCommit": "f56f17aafb7a03e5d1cc7f4b3d735c134f26ad49", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjUzOTEzNQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11474#discussion_r432539135", "bodyText": "done", "author": "simplynaveen20", "createdAt": "2020-05-29T14:50:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTMxODg1OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTMyMTU3Ng==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11474#discussion_r431321576", "bodyText": "why are we doing translation from ZoneDateTime to Instant? can't we rely on Instant everywhere?\n@simplynaveen20 @milismsft", "author": "moderakh", "createdAt": "2020-05-27T17:35:28Z", "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/implementation/changefeed/ServiceItemLease.java", "diffHunk": "@@ -203,7 +200,7 @@ public static ServiceItemLease fromDocument(CosmosItemProperties document) {\n \n         String leaseTimestamp = ModelBridgeInternal.getStringFromJsonSerializable(document,PROPERTY_NAME_TIMESTAMP);\n         if (leaseTimestamp != null) {\n-            return lease.withTimestamp(ZonedDateTime.parse(leaseTimestamp));\n+            return lease.withTimestamp(ZonedDateTime.parse(leaseTimestamp).toInstant());", "originalCommit": "f56f17aafb7a03e5d1cc7f4b3d735c134f26ad49", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjUzNzEwOQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11474#discussion_r432537109", "bodyText": "Discussed with Milis, we are serializing and deserializing the same way it was happening before , also text coming from service is  in DateTime format which cant be parse with Instant, it will throw exception", "author": "simplynaveen20", "createdAt": "2020-05-29T14:47:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTMyMTU3Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTMyMTAzNg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11474#discussion_r431321036", "bodyText": "Instead of converting instant to OffsetDateTime, its better to add this helper method in Utils.java which directly takes Instant and formats it.\npublic static String instantAsUTCRFC1123(Instant instant){\n       return Utils.RFC_1123_DATE_TIME.format(instant);\n}", "author": "kushagraThapar", "createdAt": "2020-05-27T17:34:31Z", "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/implementation/ChangeFeedQueryImpl.java", "diffHunk": "@@ -95,7 +96,7 @@ private RxDocumentServiceRequest createDocumentServiceRequest(String continuatio\n         }\n \n         if(options.getStartDateTime() != null){\n-            String dateTimeInHttpFormat = Utils.zonedDateTimeAsUTCRFC1123(options.getStartDateTime());\n+            String dateTimeInHttpFormat = Utils.zonedDateTimeAsUTCRFC1123(options.getStartDateTime().atOffset(ZoneOffset.UTC));", "originalCommit": "f56f17aafb7a03e5d1cc7f4b3d735c134f26ad49", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjUzODkyMQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11474#discussion_r432538921", "bodyText": "DateTime format cannot parse with Instant , we need zone time info , it will give runtime exception. Also we it cant be compatible with existing lease if we change the format.\nhttps://stackoverflow.com/questions/25229124/format-instant-to-string", "author": "simplynaveen20", "createdAt": "2020-05-29T14:49:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTMyMTAzNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTMyMTYxMg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11474#discussion_r431321612", "bodyText": "We should rename this class to InstantSerializer", "author": "kushagraThapar", "createdAt": "2020-05-27T17:35:32Z", "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/implementation/ZonedDateTimeSerializer.java", "diffHunk": "@@ -7,31 +7,32 @@\n import com.fasterxml.jackson.databind.ser.std.StdSerializer;\n \n import java.io.IOException;\n-import java.time.ZonedDateTime;\n+import java.time.Instant;\n+import java.time.ZoneOffset;\n import java.time.format.DateTimeFormatter;\n import java.util.Locale;\n \n-public class ZonedDateTimeSerializer extends StdSerializer<ZonedDateTime> {\n+public class ZonedDateTimeSerializer extends StdSerializer<Instant> {", "originalCommit": "f56f17aafb7a03e5d1cc7f4b3d735c134f26ad49", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjUzNzE5MQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11474#discussion_r432537191", "bodyText": "Done", "author": "simplynaveen20", "createdAt": "2020-05-29T14:47:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTMyMTYxMg=="}], "type": "inlineReview"}, {"oid": "d49de2c97ddc3fc45824ff2da702bb0daeca37c3", "url": "https://github.com/Azure/azure-sdk-for-java/commit/d49de2c97ddc3fc45824ff2da702bb0daeca37c3", "message": "merging with master and resolving comments", "committedDate": "2020-05-29T14:31:22Z", "type": "commit"}, {"oid": "5ecc1f53df21c40a811275d8fa911a52af106ba3", "url": "https://github.com/Azure/azure-sdk-for-java/commit/5ecc1f53df21c40a811275d8fa911a52af106ba3", "message": "removing extra files checked in  due to merge", "committedDate": "2020-05-29T16:08:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjYwNDE2Mw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11474#discussion_r432604163", "bodyText": "Seems like we have few unused imports here.", "author": "kushagraThapar", "createdAt": "2020-05-29T16:38:02Z", "path": "sdk/cosmos/azure-cosmos/src/test/java/com/azure/cosmos/rx/ChangeFeedProcessorTest.java", "diffHunk": "@@ -38,7 +38,12 @@\n import reactor.core.scheduler.Schedulers;\n \n import java.time.Duration;\n-import java.time.OffsetDateTime;\n+import java.time.Instant;\n+import java.time.ZoneOffset;\n+import java.time.ZonedDateTime;\n+import java.time.temporal.ChronoUnit;\n+import java.time.temporal.Temporal;\n+import java.time.temporal.TemporalUnit;", "originalCommit": "5ecc1f53df21c40a811275d8fa911a52af106ba3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "afba9a388d203a86c26ea4ba97d5d8d9eb428be7", "url": "https://github.com/Azure/azure-sdk-for-java/commit/afba9a388d203a86c26ea4ba97d5d8d9eb428be7", "message": "removing extra imports", "committedDate": "2020-05-29T16:46:22Z", "type": "commit"}]}