{"pr_number": 7228, "pr_title": "Enable build failure when code coverage is below threshold", "pr_createdAt": "2020-01-07T10:59:24Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/7228", "timeline": [{"oid": "30a3526b01fd0c1d4f85cb71ce4ad0979aaa19ae", "url": "https://github.com/Azure/azure-sdk-for-java/commit/30a3526b01fd0c1d4f85cb71ce4ad0979aaa19ae", "message": "Enable build failure when code coverage is below threshold", "committedDate": "2020-01-07T10:53:00Z", "type": "commit"}, {"oid": "2713bf95589a5f486dfa22cecb704be31693283b", "url": "https://github.com/Azure/azure-sdk-for-java/commit/2713bf95589a5f486dfa22cecb704be31693283b", "message": "Remove comment", "committedDate": "2020-01-07T10:57:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzgwODk2MQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7228#discussion_r363808961", "bodyText": "@JonathanGiles is this particular change going to require us to up the version and re-release the parent pom?", "author": "JimSuplizio", "createdAt": "2020-01-07T15:40:11Z", "path": "pom.client.xml", "diffHunk": "@@ -333,6 +333,31 @@\n               <outputDirectory>${project.reporting.outputDirectory}/test-coverage</outputDirectory>\n             </configuration>\n           </execution>\n+          <execution>", "originalCommit": "2713bf95589a5f486dfa22cecb704be31693283b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzkwNjI3Nw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7228#discussion_r363906277", "bodyText": "@JimSuplizio since this change only introduces a check to fail the build when test coverage is low, it's not end user-facing. So, version update and re-release is not necessary.", "author": "srnagar", "createdAt": "2020-01-07T19:15:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzgwODk2MQ=="}], "type": "inlineReview"}, {"oid": "df95a45d7ca40cd745f0fc5a7397ebbc787bb31f", "url": "https://github.com/Azure/azure-sdk-for-java/commit/df95a45d7ca40cd745f0fc5a7397ebbc787bb31f", "message": "Install reporting tools for verify goal", "committedDate": "2020-01-07T19:21:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzkzMTQzMA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7228#discussion_r363931430", "bodyText": "Is it worth extracting these two minimum values out to properties so that child poms may overwrite this (in the future when we start setting a valid minimum and libraries need to opt-out for a valid reason)?", "author": "JonathanGiles", "createdAt": "2020-01-07T20:15:34Z", "path": "pom.client.xml", "diffHunk": "@@ -333,6 +333,31 @@\n               <outputDirectory>${project.reporting.outputDirectory}/test-coverage</outputDirectory>\n             </configuration>\n           </execution>\n+          <execution>\n+            <id>check</id>\n+            <goals>\n+              <goal>check</goal>\n+            </goals>\n+            <configuration>\n+              <rules>\n+                <rule>\n+                  <element>BUNDLE</element>\n+                  <limits>\n+                    <limit>\n+                      <counter>LINE</counter>\n+                      <value>COVEREDRATIO</value>\n+                      <minimum>0.18</minimum>\n+                    </limit>\n+                    <limit>\n+                      <counter>BRANCH</counter>\n+                      <value>COVEREDRATIO</value>\n+                      <minimum>0.09</minimum>", "originalCommit": "df95a45d7ca40cd745f0fc5a7397ebbc787bb31f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDA0MTg4Mg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7228#discussion_r364041882", "bodyText": "Yes, updated this to use properties and also customized the threshold for a couple of storage modules that had really low coverage to:\n\ndemonstrate how to customize the threshold per module\nincrease the base threshold to a much higher number than 9%", "author": "srnagar", "createdAt": "2020-01-08T02:34:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzkzMTQzMA=="}], "type": "inlineReview"}, {"oid": "444c9166a08f2748b415be9c6a0c7bfe6e3f9b84", "url": "https://github.com/Azure/azure-sdk-for-java/commit/444c9166a08f2748b415be9c6a0c7bfe6e3f9b84", "message": "Configurable coverage threshold", "committedDate": "2020-01-08T02:31:35Z", "type": "commit"}]}