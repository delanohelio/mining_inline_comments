{"pr_number": 10895, "pr_title": "Move JsonSerializable/Resource to implementation", "pr_createdAt": "2020-05-07T07:19:19Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/10895", "timeline": [{"oid": "68dfcbe41252c0e998e5e1e8841feb36da31a4ec", "url": "https://github.com/Azure/azure-sdk-for-java/commit/68dfcbe41252c0e998e5e1e8841feb36da31a4ec", "message": "Move JsonSerializable, Resource to implementation", "committedDate": "2020-05-07T07:18:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTI5MzI4NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10895#discussion_r421293284", "bodyText": "classes in com.azure.cosmos.models are part of our public api.\nDoes ResourceWrapper have to be in com.azure.cosmos.models ?", "author": "moderakh", "createdAt": "2020-05-07T07:25:17Z", "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/models/ResourceWrapper.java", "diffHunk": "@@ -0,0 +1,21 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.cosmos.models;", "originalCommit": "68dfcbe41252c0e998e5e1e8841feb36da31a4ec", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTYzOTU3MQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10895#discussion_r421639571", "bodyText": "Put in the models with the following thinking:\nSince we moved Resource into implementation, so some method has changed from private package to public.  If I remove ResourceWrapper to implementation, then the getResource() will change to public which may expose methods we did not/should not?\nBut it can be solved by two ways: (if move to implementation)\n\nremove getResource() method\nchange to protected, have some implmentionBridge class to use this method from other places\n\nthoughts?", "author": "xinlian12", "createdAt": "2020-05-07T16:34:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTI5MzI4NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjY4NjA5NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10895#discussion_r422686094", "bodyText": "Having ResourceWrapper in public should be fine in my opinion if it is not leaking any Jackson libraries.\nNo need to do extra work through *BridgeInternals if not required.\n@moderakh  thoughts ?", "author": "kushagraThapar", "createdAt": "2020-05-10T19:07:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTI5MzI4NA=="}], "type": "inlineReview"}, {"oid": "c4e706a7efc2fe5b72dedcf0b927a581d0d28f7f", "url": "https://github.com/Azure/azure-sdk-for-java/commit/c4e706a7efc2fe5b72dedcf0b927a581d0d28f7f", "message": "Merged master and resolved conflicts", "committedDate": "2020-05-07T15:37:59Z", "type": "commit"}, {"oid": "32b7988756ff2fe31318eda0d641df9bf9d67f0c", "url": "https://github.com/Azure/azure-sdk-for-java/commit/32b7988756ff2fe31318eda0d641df9bf9d67f0c", "message": "i# This is a combination of 2 commits.\n\na typo in previous PR\n\nfix", "committedDate": "2020-05-07T17:14:58Z", "type": "commit"}, {"oid": "5f1a654759c39d01dc6d4618a378c4059f438985", "url": "https://github.com/Azure/azure-sdk-for-java/commit/5f1a654759c39d01dc6d4618a378c4059f438985", "message": "fix tests", "committedDate": "2020-05-07T18:12:44Z", "type": "commit"}, {"oid": "1e8e569d3b5762fd84c793911028a98261263780", "url": "https://github.com/Azure/azure-sdk-for-java/commit/1e8e569d3b5762fd84c793911028a98261263780", "message": "fix", "committedDate": "2020-05-07T20:56:34Z", "type": "commit"}, {"oid": "26de27cb7620f8dafa6cb503641a83ac3ede5760", "url": "https://github.com/Azure/azure-sdk-for-java/commit/26de27cb7620f8dafa6cb503641a83ac3ede5760", "message": "fix for the populatePropertyBag", "committedDate": "2020-05-08T21:54:58Z", "type": "commit"}, {"oid": "cc443050b1aacc4a8d4c42124e79bb77a03c6051", "url": "https://github.com/Azure/azure-sdk-for-java/commit/cc443050b1aacc4a8d4c42124e79bb77a03c6051", "message": "merge and resolve conflicts", "committedDate": "2020-05-09T05:35:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjY4NDk4Mw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10895#discussion_r422684983", "bodyText": "Since these API names got changed in CosmosContainerProperties, we should update them here too.\nsetAnalyticalStoreTimeToLiveInSeconds\nNot in this PR - since this is implementation change, we should do this in a follow up PR.", "author": "kushagraThapar", "createdAt": "2020-05-10T18:57:48Z", "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/implementation/DocumentCollection.java", "diffHunk": "@@ -165,6 +163,45 @@ public void setDefaultTimeToLive(Integer timeToLive) {\n         }\n     }\n \n+    /**\n+     * Sets the analytical storage time to live in seconds for items in a container from the Azure Cosmos DB service.\n+     *\n+     * It is an optional property. A valid value must be either a nonzero positive integer, '-1', or 0.\n+     * By default, AnalyticalStorageTimeToLive is set to 0 meaning the analytical store is turned off for the container;\n+     * -1 means documents in analytical store never expire.\n+     * The unit of measurement is seconds. The maximum allowed value is 2147483647.\n+     *\n+     * @param timeToLive the analytical storage time to live in seconds.\n+     * @return the CosmosContainerProperties.\n+     */\n+    public void setAnalyticalStorageTimeToLiveInSeconds(Integer timeToLive) {", "originalCommit": "cc443050b1aacc4a8d4c42124e79bb77a03c6051", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjY4NTM3MA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10895#discussion_r422685370", "bodyText": "CosmosError is in models (public surface) - and is still extending internal types Resource and JsonSerializable. This is exposed using CosmosClientException which can lead to potential exposure of Jackson libraries.", "author": "kushagraThapar", "createdAt": "2020-05-10T19:01:05Z", "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/models/CosmosError.java", "diffHunk": "@@ -4,6 +4,7 @@\n package com.azure.cosmos.models;\n \n import com.azure.cosmos.implementation.Constants;\n+import com.azure.cosmos.implementation.Resource;", "originalCommit": "cc443050b1aacc4a8d4c42124e79bb77a03c6051", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjY4NjYxNw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10895#discussion_r422686617", "bodyText": "This is a cosmosdb management related library change, not ours :)", "author": "kushagraThapar", "createdAt": "2020-05-10T19:11:48Z", "path": "sdk/cosmos/mgmt/src/main/java/com/azure/management/cosmosdb/DatabaseAccountListKeysResult.java", "diffHunk": "@@ -1,5 +1,6 @@\n // Copyright (c) Microsoft Corporation. All rights reserved.\n // Licensed under the MIT License.\n+", "originalCommit": "cc443050b1aacc4a8d4c42124e79bb77a03c6051", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzE5NDc4NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10895#discussion_r423194784", "bodyText": "I am not sure yet if we should have JsonSerializableWrapper, but if we decide to go with JsonSerializable, then you could move this code to JsonSerializable and and here just have super(jsonStirng).", "author": "moderakh", "createdAt": "2020-05-11T17:17:17Z", "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/models/CompositePath.java", "diffHunk": "@@ -26,7 +28,7 @@ public CompositePath() {\n      * @param jsonString the json string that represents the included path.\n      */\n     CompositePath(String jsonString) {\n-        super(jsonString);\n+        this.jsonSerializable = new JsonSerializable(jsonString);", "originalCommit": "cc443050b1aacc4a8d4c42124e79bb77a03c6051", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzE5OTI5OA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10895#discussion_r423199298", "bodyText": "yup, good idea to move the common code into the parent class", "author": "xinlian12", "createdAt": "2020-05-11T17:24:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzE5NDc4NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzIzNzI2Nw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10895#discussion_r423237267", "bodyText": "based on the discussion, will remove JsonSerializableWrapper and ResourceWrapper in  following up PR.", "author": "xinlian12", "createdAt": "2020-05-11T18:31:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzE5NDc4NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzIwODczMg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10895#discussion_r423208732", "bodyText": "We are validating these resources in RxDocumentClientImpl anyway, so we could skip these altogether? same for database too. Minor change, need not worry about this in this PR.", "author": "mbhaskar", "createdAt": "2020-05-11T17:40:48Z", "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/CosmosAsyncContainer.java", "diffHunk": "@@ -154,7 +154,7 @@ public String getId() {\n     public Mono<CosmosAsyncContainerResponse> replace(\n         CosmosContainerProperties containerProperties,\n         CosmosContainerRequestOptions options) {\n-        ModelBridgeInternal.validateResource(containerProperties);\n+        ModelBridgeInternal.validateResource(ModelBridgeInternal.getResourceFromResourceWrapper(containerProperties));", "originalCommit": "cc443050b1aacc4a8d4c42124e79bb77a03c6051", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}