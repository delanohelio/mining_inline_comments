{"pr_number": 11656, "pr_title": "ProxyOptions change", "pr_createdAt": "2020-06-02T01:10:23Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/11656", "timeline": [{"oid": "b373edb0a508bd4a436f4e51bdcb5f8a49f34fed", "url": "https://github.com/Azure/azure-sdk-for-java/commit/b373edb0a508bd4a436f4e51bdcb5f8a49f34fed", "message": "ProxyOptions change", "committedDate": "2020-06-02T00:37:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzU2ODk0OQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11656#discussion_r433568949", "bodyText": "should I throw exception here?", "author": "xinlian12", "createdAt": "2020-06-02T01:14:39Z", "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/GatewayConnectionConfig.java", "diffHunk": "@@ -119,8 +120,12 @@ public InetSocketAddress getProxy() {\n      * @return the {@link GatewayConnectionConfig}.\n      */\n \n-    public GatewayConnectionConfig setProxy(InetSocketAddress proxy) {\n-        this.inetSocketProxyAddress = proxy;\n+    public GatewayConnectionConfig setProxy(ProxyOptions proxy) {\n+        if (proxy.getType() != ProxyOptions.Type.HTTP) {", "originalCommit": "b373edb0a508bd4a436f4e51bdcb5f8a49f34fed", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzU3MzAyNQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11656#discussion_r433573025", "bodyText": "Yes, throw IllegalArgumentException - with message - only Http Proxy type is supported.", "author": "kushagraThapar", "createdAt": "2020-06-02T01:30:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzU2ODk0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzU3NTYxMw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11656#discussion_r433575613", "bodyText": "Thanks, changed the message to be \"Only http proxy type is supported.\"", "author": "xinlian12", "createdAt": "2020-06-02T01:40:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzU2ODk0OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzU2OTAxOQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11656#discussion_r433569019", "bodyText": "should I also add the proxy type?", "author": "xinlian12", "createdAt": "2020-06-02T01:14:57Z", "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/GatewayConnectionConfig.java", "diffHunk": "@@ -130,7 +135,8 @@ public String toString() {\n             \"requestTimeout=\" + requestTimeout +\n             \", maxConnectionPoolSize=\" + maxConnectionPoolSize +\n             \", idleConnectionTimeout=\" + idleConnectionTimeout +\n-            \", inetSocketProxyAddress=\" + inetSocketProxyAddress +\n+            \", proxyType=\" + proxy.getType() +", "originalCommit": "b373edb0a508bd4a436f4e51bdcb5f8a49f34fed", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzU3MzI1OA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11656#discussion_r433573258", "bodyText": "to the toString() - yes.", "author": "kushagraThapar", "createdAt": "2020-06-02T01:31:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzU2OTAxOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzU3NTkzNA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11656#discussion_r433575934", "bodyText": "just found out that the spotbug checks all the properties should be referenced in the toString(), so need to exclude the proxy check for pattern UWF_FIELD_NOT_INITIALIZED_IN_CONSTRUCTOR", "author": "xinlian12", "createdAt": "2020-06-02T01:41:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzU2OTAxOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzYwNDU3NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11656#discussion_r433604574", "bodyText": "I am wondering why this wasn't a problem with InetSocketAddress ?\nIt was also present in toString() and was not initialized in Constructor.", "author": "kushagraThapar", "createdAt": "2020-06-02T03:48:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzU2OTAxOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzYwODUxNQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11656#discussion_r433608515", "bodyText": "oo, I see, I think the UWF_FIELD_NOT_INITIALIZED_IN_CONSTRUCTOR was really checking is that I used proxy.getType, proxy.getAddress, but it might never be inistialized, so may get null pointer exception.\nUpdated to check proxy is null or not.", "author": "xinlian12", "createdAt": "2020-06-02T04:06:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzU2OTAxOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzU2OTMyNg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11656#discussion_r433569326", "bodyText": "changed the method name here since it could be non http?", "author": "xinlian12", "createdAt": "2020-06-02T01:16:14Z", "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/implementation/http/HttpClientConfig.java", "diffHunk": "@@ -30,7 +30,7 @@ public HttpClientConfig withPoolSize(int maxPoolSize) {\n         return this;\n     }\n \n-    public HttpClientConfig withHttpProxy(InetSocketAddress proxy) {\n+    public HttpClientConfig withProxy(ProxyOptions proxy) {", "originalCommit": "b373edb0a508bd4a436f4e51bdcb5f8a49f34fed", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzU3MzUwNw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11656#discussion_r433573507", "bodyText": "Although this is internal so doesn't matter - with withProxy looks good.", "author": "kushagraThapar", "createdAt": "2020-06-02T01:32:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzU2OTMyNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzU3NjQ1MQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11656#discussion_r433576451", "bodyText": "thanks", "author": "xinlian12", "createdAt": "2020-06-02T01:43:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzU2OTMyNg=="}], "type": "inlineReview"}, {"oid": "99e39d9f118dc3c6ff0844ea283cac3807b7607a", "url": "https://github.com/Azure/azure-sdk-for-java/commit/99e39d9f118dc3c6ff0844ea283cac3807b7607a", "message": "resolve comments", "committedDate": "2020-06-02T01:39:29Z", "type": "commit"}, {"oid": "3b9a0657e0c6e0d12e194c17c40e4046a0d60577", "url": "https://github.com/Azure/azure-sdk-for-java/commit/3b9a0657e0c6e0d12e194c17c40e4046a0d60577", "message": "fix", "committedDate": "2020-06-02T04:05:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzYxMjIzOQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11656#discussion_r433612239", "bodyText": "as we don't support password with proxy, shouldn't we throw if password is set?", "author": "moderakh", "createdAt": "2020-06-02T04:23:28Z", "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/GatewayConnectionConfig.java", "diffHunk": "@@ -119,18 +120,26 @@ public InetSocketAddress getProxy() {\n      * @return the {@link GatewayConnectionConfig}.\n      */\n \n-    public GatewayConnectionConfig setProxy(InetSocketAddress proxy) {\n-        this.inetSocketProxyAddress = proxy;\n+    public GatewayConnectionConfig setProxy(ProxyOptions proxy) {\n+        if (proxy.getType() != ProxyOptions.Type.HTTP) {\n+            throw new IllegalArgumentException(\"Only http proxy type is supported.\");", "originalCommit": "3b9a0657e0c6e0d12e194c17c40e4046a0d60577", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzYzNDcyOA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11656#discussion_r433634728", "bodyText": "I am not sure. may be we should, may be we should not, it will just get ignored.\nBut we definitely should add more documentation to setProxy() API that we only support HTTP proxy as of now - without any username and password.\nI see, setProxy() docs are incorrect and should be updated.\n@xinlian12 - please create another PR for this - with updated docs - \"that we only support  HTTP proxy type with just the routing address. Username and password are not supported\"", "author": "kushagraThapar", "createdAt": "2020-06-02T05:51:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzYxMjIzOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzk0MzAxMQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11656#discussion_r433943011", "bodyText": "Thanks~ have created another PR for the docs update:\nchttps://github.com//pull/11672", "author": "xinlian12", "createdAt": "2020-06-02T14:58:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzYxMjIzOQ=="}], "type": "inlineReview"}]}