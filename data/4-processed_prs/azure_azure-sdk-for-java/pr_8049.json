{"pr_number": 8049, "pr_title": "Sync Paged Iterable equivalent for ContinuablePagedFlux", "pr_createdAt": "2020-02-08T01:50:43Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/8049", "timeline": [{"oid": "ec19cd6eda7c8b1f7645e3d83512fa82570883d0", "url": "https://github.com/Azure/azure-sdk-for-java/commit/ec19cd6eda7c8b1f7645e3d83512fa82570883d0", "message": "sync Paged Iterable equivalent for ContinuablePagedFlux", "committedDate": "2020-02-08T01:49:27Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjY5MzEzNQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8049#discussion_r376693135", "bodyText": "We should provide a way to customize DEFAULT_BATCH_SIZE", "author": "kushagraThapar", "createdAt": "2020-02-08T07:05:25Z", "path": "sdk/core/azure-core/src/main/java/com/azure/core/util/paging/ContinuablePagedIterable.java", "diffHunk": "@@ -0,0 +1,135 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.core.util.paging;\n+\n+import com.azure.core.util.IterableStream;\n+import java.util.stream.Stream;\n+\n+/**\n+ * This class provides utility to iterate over {@link ContinuablePage} using {@link Stream}\n+ * {@link Iterable} interfaces.\n+ *\n+ * @param <C> the type of the continuation token\n+ * @param <T> The type of elements in a {@link ContinuablePage}\n+ * @param <P> The {@link ContinuablePage} holding items of type {@code T}.\n+ *\n+ * @see IterableStream\n+ * @see ContinuablePagedFlux\n+ */\n+public abstract class ContinuablePagedIterable<C, T, P extends ContinuablePage<C, T>> extends IterableStream<T> {\n+    private static final int DEFAULT_BATCH_SIZE = 1;", "originalCommit": "ec19cd6eda7c8b1f7645e3d83512fa82570883d0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzIzMjkzMg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8049#discussion_r377232932", "bodyText": "right, I'm planning to update the Ctr to take a custom batch size.", "author": "anuchandy", "createdAt": "2020-02-10T18:17:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjY5MzEzNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDI3NTkxMw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8049#discussion_r384275913", "bodyText": "this is done.", "author": "anuchandy", "createdAt": "2020-02-26T05:02:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjY5MzEzNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzIwMzM1NQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8049#discussion_r377203355", "bodyText": "Adding Javadoc about default batch size would be good for user and improve quality of Javadoc.", "author": "hemanttanwar", "createdAt": "2020-02-10T17:20:47Z", "path": "sdk/core/azure-core/src/main/java/com/azure/core/util/paging/ContinuablePagedIterable.java", "diffHunk": "@@ -0,0 +1,135 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.core.util.paging;\n+\n+import com.azure.core.util.IterableStream;\n+import java.util.stream.Stream;\n+\n+/**\n+ * This class provides utility to iterate over {@link ContinuablePage} using {@link Stream}\n+ * {@link Iterable} interfaces.\n+ *\n+ * @param <C> the type of the continuation token\n+ * @param <T> The type of elements in a {@link ContinuablePage}\n+ * @param <P> The {@link ContinuablePage} holding items of type {@code T}.\n+ *\n+ * @see IterableStream\n+ * @see ContinuablePagedFlux\n+ */\n+public abstract class ContinuablePagedIterable<C, T, P extends ContinuablePage<C, T>> extends IterableStream<T> {\n+    private static final int DEFAULT_BATCH_SIZE = 1;\n+    private final ContinuablePagedFlux<C, T, P> pagedFlux;\n+\n+    /**\n+     * Creates instance given {@link ContinuablePagedFlux}.\n+     *\n+     * @param pagedFlux the paged flux use as iterable\n+     */\n+    public ContinuablePagedIterable(ContinuablePagedFlux<C, T, P> pagedFlux) {\n+        super(pagedFlux);\n+        this.pagedFlux = pagedFlux;\n+    }\n+\n+    /**\n+     * Retrieve the {@link Stream}, one page at a time.\n+     * It will provide same {@link Stream} of T values from starting if called multiple times.\n+     *\n+     * @return {@link Stream} of a pages\n+     */\n+    public Stream<P> streamByPage() {", "originalCommit": "ec19cd6eda7c8b1f7645e3d83512fa82570883d0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzIzMzE0MQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8049#discussion_r377233141", "bodyText": "yes, we will document it as part of adding a ctr argument for the batch size.", "author": "anuchandy", "createdAt": "2020-02-10T18:18:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzIwMzM1NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDI3NTM3Nw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8049#discussion_r384275377", "bodyText": "I've added batchsize based ctr with Javadoc.", "author": "anuchandy", "createdAt": "2020-02-26T05:00:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzIwMzM1NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzIwMzk4Ng==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8049#discussion_r377203986", "bodyText": "Can we add this change in changelog .", "author": "hemanttanwar", "createdAt": "2020-02-10T17:21:56Z", "path": "sdk/core/azure-core/src/main/java/com/azure/core/util/paging/ContinuablePagedIterable.java", "diffHunk": "@@ -0,0 +1,135 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.core.util.paging;\n+\n+import com.azure.core.util.IterableStream;\n+import java.util.stream.Stream;\n+\n+/**\n+ * This class provides utility to iterate over {@link ContinuablePage} using {@link Stream}\n+ * {@link Iterable} interfaces.\n+ *\n+ * @param <C> the type of the continuation token\n+ * @param <T> The type of elements in a {@link ContinuablePage}\n+ * @param <P> The {@link ContinuablePage} holding items of type {@code T}.\n+ *\n+ * @see IterableStream\n+ * @see ContinuablePagedFlux\n+ */\n+public abstract class ContinuablePagedIterable<C, T, P extends ContinuablePage<C, T>> extends IterableStream<T> {\n+    private static final int DEFAULT_BATCH_SIZE = 1;", "originalCommit": "ec19cd6eda7c8b1f7645e3d83512fa82570883d0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDI3NTgxMQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8049#discussion_r384275811", "bodyText": "actually this is a new type, but we document batch size.", "author": "anuchandy", "createdAt": "2020-02-26T05:01:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzIwMzk4Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDE5Mzg1Mw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8049#discussion_r384193853", "bodyText": "Is this actually needed anymore? I believe this was added to fix a case where PagedIterable would over-eagerly consume a Flux.", "author": "alzimmermsft", "createdAt": "2020-02-25T23:39:44Z", "path": "sdk/core/azure-core/src/main/java/com/azure/core/util/paging/ContinuablePagedIterable.java", "diffHunk": "@@ -0,0 +1,135 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.core.util.paging;\n+\n+import com.azure.core.util.IterableStream;\n+import java.util.stream.Stream;\n+\n+/**\n+ * This class provides utility to iterate over {@link ContinuablePage} using {@link Stream}\n+ * {@link Iterable} interfaces.\n+ *\n+ * @param <C> the type of the continuation token\n+ * @param <T> The type of elements in a {@link ContinuablePage}\n+ * @param <P> The {@link ContinuablePage} holding items of type {@code T}.\n+ *\n+ * @see IterableStream\n+ * @see ContinuablePagedFlux\n+ */\n+public abstract class ContinuablePagedIterable<C, T, P extends ContinuablePage<C, T>> extends IterableStream<T> {\n+    private static final int DEFAULT_BATCH_SIZE = 1;", "originalCommit": "ec19cd6eda7c8b1f7645e3d83512fa82570883d0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDI3NTA5Ng==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8049#discussion_r384275096", "bodyText": "yes, our default ContinuablePagedFluxCore will fetch only one page at time and when using that as the backing flux batch size doesn't make sense. But ContinuablePagedIterable is not bound to  ContinuablePagedFluxCore, it can take  any type adhere to ContinuablePagedFlux, batch size comes handy to control such page fluxes.", "author": "anuchandy", "createdAt": "2020-02-26T04:58:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDE5Mzg1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDcwODIxNg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8049#discussion_r384708216", "bodyText": "Sounds good to me", "author": "alzimmermsft", "createdAt": "2020-02-26T19:19:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDE5Mzg1Mw=="}], "type": "inlineReview"}, {"oid": "f692d006d36b1984b4186134efdc67e531c1ccd4", "url": "https://github.com/Azure/azure-sdk-for-java/commit/f692d006d36b1984b4186134efdc67e531c1ccd4", "message": "Merge branch 'master' of github.com:azure/azure-sdk-for-java into sync-paged", "committedDate": "2020-02-26T04:39:27Z", "type": "commit"}, {"oid": "44d305468667d9129314c89c59e4d77a0e794afb", "url": "https://github.com/Azure/azure-sdk-for-java/commit/44d305468667d9129314c89c59e4d77a0e794afb", "message": "taking batch-size as ContinuablePagedIterable::Ctr", "committedDate": "2020-02-26T04:52:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDcwOTk0Ng==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8049#discussion_r384709946", "bodyText": "nit: remove extra @return", "author": "srnagar", "createdAt": "2020-02-26T19:22:41Z", "path": "sdk/core/azure-core/src/main/java/com/azure/core/util/paging/ContinuablePagedIterable.java", "diffHunk": "@@ -0,0 +1,147 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.core.util.paging;\n+\n+import com.azure.core.util.IterableStream;\n+\n+import java.util.stream.Stream;\n+\n+/**\n+ * This class provides utility to iterate over {@link ContinuablePage} using {@link Stream}\n+ * {@link Iterable} interfaces.\n+ *\n+ * @param <C> the type of the continuation token\n+ * @param <T> The type of elements in a {@link ContinuablePage}\n+ * @param <P> The {@link ContinuablePage} holding items of type {@code T}.\n+ *\n+ * @see IterableStream\n+ * @see ContinuablePagedFlux\n+ */\n+public abstract class ContinuablePagedIterable<C, T, P extends ContinuablePage<C, T>> extends IterableStream<T> {\n+    private final ContinuablePagedFlux<C, T, P> pagedFlux;\n+    private final int batchSize;\n+\n+    /**\n+     * Creates instance with the given {@link ContinuablePagedFlux}.\n+     *\n+     * @param pagedFlux the paged flux use as iterable\n+     */\n+    public ContinuablePagedIterable(ContinuablePagedFlux<C, T, P> pagedFlux) {\n+        this(pagedFlux, 1);\n+    }\n+\n+    /**\n+     * Creates instance with the given {@link ContinuablePagedFlux}.\n+     *\n+     * @param pagedFlux the paged flux use as iterable\n+     * @param batchSize the bounded capacity to prefetch from the {@link ContinuablePagedFlux}\n+     */\n+    public ContinuablePagedIterable(ContinuablePagedFlux<C, T, P> pagedFlux, int batchSize) {\n+        super(pagedFlux);\n+        this.pagedFlux = pagedFlux;\n+        this.batchSize = batchSize;\n+    }\n+\n+    /**\n+     * Retrieve the {@link Stream}, one page at a time.\n+     * It will provide same {@link Stream} of T values from starting if called multiple times.\n+     *\n+     * @return {@link Stream} of a pages\n+     */\n+    public Stream<P> streamByPage() {\n+        return pagedFlux.byPage().toStream(this.batchSize);\n+    }\n+\n+    /**\n+     * Retrieve the {@link Stream}, one page at a time, starting from the next page associated with the given\n+     * continuation token. To start from first page, use {@link #streamByPage()} instead.\n+     *\n+     * @param continuationToken The continuation token used to fetch the next page\n+     * @return @return {@link Stream} of a pages\n+     */\n+    public Stream<P> streamByPage(C continuationToken) {\n+        return this.pagedFlux.byPage(continuationToken).toStream(this.batchSize);\n+    }\n+\n+    /**\n+     * Retrieve the {@link Stream}, one page at a time, with each page containing {@code preferredPageSize}\n+     * items.\n+     *\n+     * It will provide same {@link Stream} of T values from starting if called multiple times.\n+     *\n+     * @param preferredPageSize the preferred page size, service may or may not honor the page\n+     *                          size preference hence client MUST be prepared to handle pages\n+     *                          with different page size.\n+     * @return @return {@link Stream} of a pages\n+     */\n+    public Stream<P> streamByPage(int preferredPageSize) {\n+        return this.pagedFlux.byPage(null, preferredPageSize).toStream(this.batchSize);\n+    }\n+\n+    /**\n+     * Retrieve the {@link Stream}, one page at a time, with each page containing {@code preferredPageSize}\n+     * items, starting from the next page associated with the given continuation token.\n+     * To start from first page, use {@link #streamByPage()} or {@link #streamByPage(int)} instead.\n+     *\n+     * @param preferredPageSize the preferred page size, service may or may not honor the page\n+     *                          size preference hence client MUST be prepared to handle pages\n+     *                          with different page size.\n+     * @param continuationToken The continuation token used to fetch the next page\n+     * @return @return {@link Stream} of a pages", "originalCommit": "44d305468667d9129314c89c59e4d77a0e794afb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjcxMDA4Mg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8049#discussion_r386710082", "bodyText": "Removed", "author": "alzimmermsft", "createdAt": "2020-03-02T23:18:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDcwOTk0Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDcxMTEzNA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8049#discussion_r384711134", "bodyText": "Instead of referring to a service, we can just say \"source may or may not honor the page size\" as this paged iterable is a generic concept that can be applicable to non-service sources too.", "author": "srnagar", "createdAt": "2020-02-26T19:24:39Z", "path": "sdk/core/azure-core/src/main/java/com/azure/core/util/paging/ContinuablePagedIterable.java", "diffHunk": "@@ -0,0 +1,147 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.core.util.paging;\n+\n+import com.azure.core.util.IterableStream;\n+\n+import java.util.stream.Stream;\n+\n+/**\n+ * This class provides utility to iterate over {@link ContinuablePage} using {@link Stream}\n+ * {@link Iterable} interfaces.\n+ *\n+ * @param <C> the type of the continuation token\n+ * @param <T> The type of elements in a {@link ContinuablePage}\n+ * @param <P> The {@link ContinuablePage} holding items of type {@code T}.\n+ *\n+ * @see IterableStream\n+ * @see ContinuablePagedFlux\n+ */\n+public abstract class ContinuablePagedIterable<C, T, P extends ContinuablePage<C, T>> extends IterableStream<T> {\n+    private final ContinuablePagedFlux<C, T, P> pagedFlux;\n+    private final int batchSize;\n+\n+    /**\n+     * Creates instance with the given {@link ContinuablePagedFlux}.\n+     *\n+     * @param pagedFlux the paged flux use as iterable\n+     */\n+    public ContinuablePagedIterable(ContinuablePagedFlux<C, T, P> pagedFlux) {\n+        this(pagedFlux, 1);\n+    }\n+\n+    /**\n+     * Creates instance with the given {@link ContinuablePagedFlux}.\n+     *\n+     * @param pagedFlux the paged flux use as iterable\n+     * @param batchSize the bounded capacity to prefetch from the {@link ContinuablePagedFlux}\n+     */\n+    public ContinuablePagedIterable(ContinuablePagedFlux<C, T, P> pagedFlux, int batchSize) {\n+        super(pagedFlux);\n+        this.pagedFlux = pagedFlux;\n+        this.batchSize = batchSize;\n+    }\n+\n+    /**\n+     * Retrieve the {@link Stream}, one page at a time.\n+     * It will provide same {@link Stream} of T values from starting if called multiple times.\n+     *\n+     * @return {@link Stream} of a pages\n+     */\n+    public Stream<P> streamByPage() {\n+        return pagedFlux.byPage().toStream(this.batchSize);\n+    }\n+\n+    /**\n+     * Retrieve the {@link Stream}, one page at a time, starting from the next page associated with the given\n+     * continuation token. To start from first page, use {@link #streamByPage()} instead.\n+     *\n+     * @param continuationToken The continuation token used to fetch the next page\n+     * @return @return {@link Stream} of a pages\n+     */\n+    public Stream<P> streamByPage(C continuationToken) {\n+        return this.pagedFlux.byPage(continuationToken).toStream(this.batchSize);\n+    }\n+\n+    /**\n+     * Retrieve the {@link Stream}, one page at a time, with each page containing {@code preferredPageSize}\n+     * items.\n+     *\n+     * It will provide same {@link Stream} of T values from starting if called multiple times.\n+     *\n+     * @param preferredPageSize the preferred page size, service may or may not honor the page\n+     *                          size preference hence client MUST be prepared to handle pages\n+     *                          with different page size.\n+     * @return @return {@link Stream} of a pages\n+     */\n+    public Stream<P> streamByPage(int preferredPageSize) {\n+        return this.pagedFlux.byPage(null, preferredPageSize).toStream(this.batchSize);\n+    }\n+\n+    /**\n+     * Retrieve the {@link Stream}, one page at a time, with each page containing {@code preferredPageSize}\n+     * items, starting from the next page associated with the given continuation token.\n+     * To start from first page, use {@link #streamByPage()} or {@link #streamByPage(int)} instead.\n+     *\n+     * @param preferredPageSize the preferred page size, service may or may not honor the page", "originalCommit": "44d305468667d9129314c89c59e4d77a0e794afb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f2e5e123e3d03c932f49b6aa1a481cbcaa0e6ca2", "url": "https://github.com/Azure/azure-sdk-for-java/commit/f2e5e123e3d03c932f49b6aa1a481cbcaa0e6ca2", "message": "Fixed Javadoc issues", "committedDate": "2020-02-28T18:57:39Z", "type": "commit"}, {"oid": "3db07191b6ebe8980ad441a9f79fa6b40c977739", "url": "https://github.com/Azure/azure-sdk-for-java/commit/3db07191b6ebe8980ad441a9f79fa6b40c977739", "message": "revapi exceptions for new changes", "committedDate": "2020-03-02T23:18:06Z", "type": "commit"}, {"oid": "a26e5f26d5a0c71345ea4a322e0df443b7e5e0b6", "url": "https://github.com/Azure/azure-sdk-for-java/commit/a26e5f26d5a0c71345ea4a322e0df443b7e5e0b6", "message": "Additional revapi suppressions", "committedDate": "2020-03-03T01:04:24Z", "type": "commit"}]}