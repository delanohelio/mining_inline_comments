{"pr_number": 15852, "pr_title": "[Event Hubs] Check connection status of each partition periodically", "pr_createdAt": "2020-10-01T01:28:00Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/15852", "timeline": [{"oid": "72a3acd3b865e223b8fa7fefeebc5c97b0337888", "url": "https://github.com/Azure/azure-sdk-for-java/commit/72a3acd3b865e223b8fa7fefeebc5c97b0337888", "message": "Add link credits when remote credits are empty", "committedDate": "2020-09-24T18:45:45Z", "type": "commit"}, {"oid": "14fd830dc3bba843e31bf8d0a2c9571b158619a6", "url": "https://github.com/Azure/azure-sdk-for-java/commit/14fd830dc3bba843e31bf8d0a2c9571b158619a6", "message": "Accumulate credits before sending", "committedDate": "2020-09-28T07:20:07Z", "type": "commit"}, {"oid": "1d1533dc45e1ee40fde63467806193d308dbc731", "url": "https://github.com/Azure/azure-sdk-for-java/commit/1d1533dc45e1ee40fde63467806193d308dbc731", "message": "Conditional logging", "committedDate": "2020-09-28T17:59:18Z", "type": "commit"}, {"oid": "b685ea99a763abd5b5181660b29ce87898b68587", "url": "https://github.com/Azure/azure-sdk-for-java/commit/b685ea99a763abd5b5181660b29ce87898b68587", "message": "More updates to receiver", "committedDate": "2020-09-30T11:35:14Z", "type": "commit"}, {"oid": "6deb79a84c4719982b7d484201e386f6d513fa7d", "url": "https://github.com/Azure/azure-sdk-for-java/commit/6deb79a84c4719982b7d484201e386f6d513fa7d", "message": "Check link status before adding credits", "committedDate": "2020-10-02T05:51:16Z", "type": "commit"}, {"oid": "c502ddb66d7b03be1da3b3c561b3739de00d61e8", "url": "https://github.com/Azure/azure-sdk-for-java/commit/c502ddb66d7b03be1da3b3c561b3739de00d61e8", "message": "Check connection state periodically", "committedDate": "2020-10-08T16:53:17Z", "type": "commit"}, {"oid": "340b47cb60e144afadf0a1f09772f23bf8f869f6", "url": "https://github.com/Azure/azure-sdk-for-java/commit/340b47cb60e144afadf0a1f09772f23bf8f869f6", "message": "Remove prefetch for publish on operator", "committedDate": "2020-10-08T16:55:51Z", "type": "commit"}, {"oid": "83c180dfdd22f3721133e9d993c84849f5facee5", "url": "https://github.com/Azure/azure-sdk-for-java/commit/83c180dfdd22f3721133e9d993c84849f5facee5", "message": "Fix checkstyle errors", "committedDate": "2020-10-08T18:13:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjAzNzgxMA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15852#discussion_r502037810", "bodyText": "Should we also dispose of the client if it is closed?", "author": "conniey", "createdAt": "2020-10-08T22:03:00Z", "path": "sdk/eventhubs/azure-messaging-eventhubs/src/main/java/com/azure/messaging/eventhubs/PartitionPumpManager.java", "diffHunk": "@@ -119,6 +120,23 @@ void stopAllPartitionPumps() {\n         });\n     }\n \n+    /**\n+     * Checks the state of the connection for the given partition. If the connection is closed, then this method will\n+     * remove the partition from the list of partition pumps.\n+     *\n+     * @param ownership The partition ownership information for which the connection state will be verified.\n+     */\n+    void verifyPartitionConnection(PartitionOwnership ownership) {\n+        if (partitionPumps.containsKey(ownership.getPartitionId())) {\n+            EventHubConsumerAsyncClient consumerClient = partitionPumps.get(ownership.getPartitionId());", "originalCommit": "83c180dfdd22f3721133e9d993c84849f5facee5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjAzODE3OA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15852#discussion_r502038178", "bodyText": "The if condition isn't necessary, iirc, we already call that logic internally.", "author": "conniey", "createdAt": "2020-10-08T22:04:01Z", "path": "sdk/eventhubs/azure-messaging-eventhubs/src/main/java/com/azure/messaging/eventhubs/PartitionPumpManager.java", "diffHunk": "@@ -166,17 +184,25 @@ void startPartitionPump(PartitionOwnership claimedOwnership, Checkpoint checkpoi\n             partitionPumps.put(claimedOwnership.getPartitionId(), eventHubConsumer);\n             //@formatter:off\n             Flux<Flux<PartitionEvent>> partitionEventFlux;\n+            Flux<PartitionEvent> receiver = eventHubConsumer\n+                .receiveFromPartition(claimedOwnership.getPartitionId(), startFromEventPosition, receiveOptions)\n+                .doOnNext(partitionEvent -> {\n+                    if (logger.canLogAtLevel(LogLevel.VERBOSE)) {", "originalCommit": "83c180dfdd22f3721133e9d993c84849f5facee5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjAzODI0Mw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15852#discussion_r502038243", "bodyText": "Same with all other instances.", "author": "conniey", "createdAt": "2020-10-08T22:04:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjAzODE3OA=="}], "type": "inlineReview"}]}