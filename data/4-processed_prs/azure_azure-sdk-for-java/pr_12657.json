{"pr_number": 12657, "pr_title": "Update to BOM publishing", "pr_createdAt": "2020-06-30T18:06:07Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/12657", "timeline": [{"oid": "2f2ca695d8bcf6c5ec47c0f2c6c7302852b74ce0", "url": "https://github.com/Azure/azure-sdk-for-java/commit/2f2ca695d8bcf6c5ec47c0f2c6c7302852b74ce0", "message": "Update to BOM publishing", "committedDate": "2020-06-30T18:03:58Z", "type": "commit"}, {"oid": "fe39fc4fe690b376b118c99276cfa110becc1363", "url": "https://github.com/Azure/azure-sdk-for-java/commit/fe39fc4fe690b376b118c99276cfa110becc1363", "message": "Missing beginning plugins tag", "committedDate": "2020-06-30T18:14:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzk1MzM0Ng==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12657#discussion_r447953346", "bodyText": "Should this write the password?", "author": "alzimmermsft", "createdAt": "2020-06-30T20:17:08Z", "path": "eng/scripts/Publish-MavenPackages.ps1", "diffHunk": "@@ -266,18 +280,21 @@ foreach ($packageDetail in $packageDetails) {\n \n   if ($RepositoryUrl -match \"https://pkgs.dev.azure.com/azure-sdk/\\b(internal|public)\\b/*\") {\n     Write-Information \"GPG Signing and deploying package in one step to devops feed: $RepositoryUrl\"\n+    Write-Information \"mvn gpg:sign-and-deploy-file `\"--batch-mode`\" `\"$pomOption`\" `\"$fileOption`\" `\"$javadocOption`\" `\"$sourcesOption`\" `\"$filesOption`\" $classifiersOption `\"$typesOption`\" `\"-Durl=$RepositoryUrl`\" `\"$gpgexeOption`\" `\"-DrepositoryId=target-repo`\" `\"-Drepo.password=$RepositoryPassword`\" `\"--settings=$PSScriptRoot\\..\\maven.publish.settings.xml`\"\"", "originalCommit": "fe39fc4fe690b376b118c99276cfa110becc1363", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzk1NjU2MA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12657#discussion_r447956560", "bodyText": "Anything that's a secret gets *'d out. This is the actual output in the step\n-RepositoryPassword ***", "author": "JimSuplizio", "createdAt": "2020-06-30T20:23:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzk1MzM0Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzk1MzY2Ng==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12657#discussion_r447953666", "bodyText": "Should this write $gpgexeOption? This would include the password.", "author": "alzimmermsft", "createdAt": "2020-06-30T20:17:49Z", "path": "eng/scripts/Publish-MavenPackages.ps1", "diffHunk": "@@ -266,18 +280,21 @@ foreach ($packageDetail in $packageDetails) {\n \n   if ($RepositoryUrl -match \"https://pkgs.dev.azure.com/azure-sdk/\\b(internal|public)\\b/*\") {\n     Write-Information \"GPG Signing and deploying package in one step to devops feed: $RepositoryUrl\"\n+    Write-Information \"mvn gpg:sign-and-deploy-file `\"--batch-mode`\" `\"$pomOption`\" `\"$fileOption`\" `\"$javadocOption`\" `\"$sourcesOption`\" `\"$filesOption`\" $classifiersOption `\"$typesOption`\" `\"-Durl=$RepositoryUrl`\" `\"$gpgexeOption`\" `\"-DrepositoryId=target-repo`\" `\"-Drepo.password=$RepositoryPassword`\" `\"--settings=$PSScriptRoot\\..\\maven.publish.settings.xml`\"\"\n     mvn gpg:sign-and-deploy-file \"--batch-mode\" \"$pomOption\" \"$fileOption\" \"$javadocOption\" \"$sourcesOption\" \"$filesOption\" $classifiersOption \"$typesOption\" \"-Durl=$RepositoryUrl\" \"$gpgexeOption\" \"-DrepositoryId=target-repo\" \"-Drepo.password=$RepositoryPassword\" \"--settings=$PSScriptRoot\\..\\maven.publish.settings.xml\"\n   }\n   elseif ($RepositoryUrl -like \"https://oss.sonatype.org/service/local/staging/deploy/maven2/\") {\n     Write-Information \"Signing and deploying package to $localRepositoryDirectoryUri\"\n+    Write-Information \"mvn gpg:sign-and-deploy-file `\"--batch-mode`\" `\"$pomOption`\" `\"$fileOption`\" `\"$javadocOption`\" `\"$sourcesOption`\" `\"$filesOption`\" $classifiersOption `\"$typesOption`\" `\"$urlOption`\" `\"$gpgexeOption`\" `\"-DrepositoryId=target-repo`\" `\"--settings=$PSScriptRoot\\..\\maven.publish.settings.xml`\"\"", "originalCommit": "fe39fc4fe690b376b118c99276cfa110becc1363", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzk1OTU2Ng==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12657#discussion_r447959566", "bodyText": "Actually $gpgexeOption is only the executable location which maps to the GPGExecutablePath that's passed in.", "author": "JimSuplizio", "createdAt": "2020-06-30T20:29:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzk1MzY2Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzk1Mzc4OA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12657#discussion_r447953788", "bodyText": "Same question about printing password.", "author": "alzimmermsft", "createdAt": "2020-06-30T20:18:01Z", "path": "eng/scripts/Publish-MavenPackages.ps1", "diffHunk": "@@ -266,18 +280,21 @@ foreach ($packageDetail in $packageDetails) {\n \n   if ($RepositoryUrl -match \"https://pkgs.dev.azure.com/azure-sdk/\\b(internal|public)\\b/*\") {\n     Write-Information \"GPG Signing and deploying package in one step to devops feed: $RepositoryUrl\"\n+    Write-Information \"mvn gpg:sign-and-deploy-file `\"--batch-mode`\" `\"$pomOption`\" `\"$fileOption`\" `\"$javadocOption`\" `\"$sourcesOption`\" `\"$filesOption`\" $classifiersOption `\"$typesOption`\" `\"-Durl=$RepositoryUrl`\" `\"$gpgexeOption`\" `\"-DrepositoryId=target-repo`\" `\"-Drepo.password=$RepositoryPassword`\" `\"--settings=$PSScriptRoot\\..\\maven.publish.settings.xml`\"\"\n     mvn gpg:sign-and-deploy-file \"--batch-mode\" \"$pomOption\" \"$fileOption\" \"$javadocOption\" \"$sourcesOption\" \"$filesOption\" $classifiersOption \"$typesOption\" \"-Durl=$RepositoryUrl\" \"$gpgexeOption\" \"-DrepositoryId=target-repo\" \"-Drepo.password=$RepositoryPassword\" \"--settings=$PSScriptRoot\\..\\maven.publish.settings.xml\"\n   }\n   elseif ($RepositoryUrl -like \"https://oss.sonatype.org/service/local/staging/deploy/maven2/\") {\n     Write-Information \"Signing and deploying package to $localRepositoryDirectoryUri\"\n+    Write-Information \"mvn gpg:sign-and-deploy-file `\"--batch-mode`\" `\"$pomOption`\" `\"$fileOption`\" `\"$javadocOption`\" `\"$sourcesOption`\" `\"$filesOption`\" $classifiersOption `\"$typesOption`\" `\"$urlOption`\" `\"$gpgexeOption`\" `\"-DrepositoryId=target-repo`\" `\"--settings=$PSScriptRoot\\..\\maven.publish.settings.xml`\"\"\n     mvn gpg:sign-and-deploy-file \"--batch-mode\" \"$pomOption\" \"$fileOption\" \"$javadocOption\" \"$sourcesOption\" \"$filesOption\" $classifiersOption \"$typesOption\" \"$urlOption\" \"$gpgexeOption\" \"-DrepositoryId=target-repo\" \"--settings=$PSScriptRoot\\..\\maven.publish.settings.xml\"\n-  \n+\n     Write-Information \"Staging package to Maven Central\"\n+    Write-Information \"mvn org.sonatype.plugins:nexus-staging-maven-plugin:deploy-staged-repository `\"--batch-mode`\" `\"-DnexusUrl=https://oss.sonatype.org`\" `\"$repositoryDirectoryOption`\" `\"$stagingProfileIdOption`\" `\"$stagingDescriptionOption`\" `\"-DrepositoryId=target-repo`\" `\"-DserverId=target-repo`\" `\"-Drepo.username=$RepositoryUsername`\" `\"-Drepo.password=`\"`\"$RepositoryPassword`\"`\"`\" `\"--settings=$PSScriptRoot\\..\\maven.publish.settings.xml`\"\"", "originalCommit": "fe39fc4fe690b376b118c99276cfa110becc1363", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzk2MDQ3NQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12657#discussion_r447960475", "bodyText": "Again, this is handled by the DevOps infrastructure, anything that's a secret is replaced with *s. This is what the output looks like in the logs.\n\"-Drepo.password=\"\"***\"\"\"", "author": "JimSuplizio", "createdAt": "2020-06-30T20:30:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzk1Mzc4OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzk1MzkxMw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12657#discussion_r447953913", "bodyText": "One last time about password.", "author": "alzimmermsft", "createdAt": "2020-06-30T20:18:14Z", "path": "eng/scripts/Publish-MavenPackages.ps1", "diffHunk": "@@ -289,11 +306,12 @@ foreach ($packageDetail in $packageDetails) {\n     }\n     else {\n       Write-Information \"Releasing staging repostiory $stagedRepositoryId\"\n-      mvn org.sonatype.plugins:nexus-staging-maven-plugin:rc-release \"-DstagingRepositoryId=$stagedRepositoryId\" \"-DnexusUrl=https://oss.sonatype.org\" \"-DrepositoryId=target-repo\" \"-DserverId=target-repo\" \"-Drepo.username=$RepositoryUsername\" \"-Drepo.password=\"\"$RepositoryPassword\"\"\" \"--settings=$PSScriptRoot\\..\\maven.publish.settings.xml\"  \n+      Write-Information \"mvn org.sonatype.plugins:nexus-staging-maven-plugin:rc-release `\"-DstagingRepositoryId=$stagedRepositoryId`\" `\"-DnexusUrl=https://oss.sonatype.org`\" `\"-DrepositoryId=target-repo`\" `\"-DserverId=target-repo`\" `\"-Drepo.username=$RepositoryUsername`\" `\"-Drepo.password=`\"`\"$RepositoryPassword`\"`\"`\" `\"--settings=$PSScriptRoot\\..\\maven.publish.settings.xml`\"\"\n+      mvn org.sonatype.plugins:nexus-staging-maven-plugin:rc-release \"-DstagingRepositoryId=$stagedRepositoryId\" \"-DnexusUrl=https://oss.sonatype.org\" \"-DrepositoryId=target-repo\" \"-DserverId=target-repo\" \"-Drepo.username=$RepositoryUsername\" \"-Drepo.password=\"\"$RepositoryPassword\"\"\" \"--settings=$PSScriptRoot\\..\\maven.publish.settings.xml\"", "originalCommit": "fe39fc4fe690b376b118c99276cfa110becc1363", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzk2MDcwNQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12657#discussion_r447960705", "bodyText": "Same as the other answers, it won't print the actual password.", "author": "JimSuplizio", "createdAt": "2020-06-30T20:31:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzk1MzkxMw=="}], "type": "inlineReview"}, {"oid": "c43da6981f982bccad21e5c9c515e3467d2223f2", "url": "https://github.com/Azure/azure-sdk-for-java/commit/c43da6981f982bccad21e5c9c515e3467d2223f2", "message": "Update test bom version to the next unreleased version", "committedDate": "2020-06-30T22:17:43Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzE4MzYxNw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12657#discussion_r457183617", "bodyText": "Hi, @JimSuplizio ,\nSplit line is not supported. i.e:\n<version>1.8\n</version> <!-- {x-version-update;org.apache.maven.plugins:maven-antrun-plugin;external_dependency} -->\n\nshould be\n<version>1.8 </version> <!-- {x-version-update;org.apache.maven.plugins:maven-antrun-plugin;external_dependency} -->\n\nRefs: https://github.com/Azure/azure-sdk-for-java/blob/master/eng/versioning/update_versions.py#L60", "author": "chenrujun", "createdAt": "2020-07-20T08:42:39Z", "path": "sdk/boms/azure-sdk-template-bom/pom.xml", "diffHunk": "@@ -0,0 +1,80 @@\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+\n+  <modelVersion>4.0.0</modelVersion>\n+  <groupId>com.azure</groupId>\n+  <artifactId>azure-sdk-template-bom</artifactId>\n+  <version>1.0.0-beta.5</version>\n+  <packaging>pom</packaging>\n+  <name>Azure Java SDK Template BOM (Bill of Materials)</name>\n+  <description>BOM used for testing the release pipeline and nothing else.</description>\n+  <url>https://github.com/azure/azure-sdk-for-java</url>\n+\n+  <licenses>\n+    <license>\n+      <name>The MIT License (MIT)</name>\n+      <url>http://opensource.org/licenses/MIT</url>\n+      <distribution>repo</distribution>\n+    </license>\n+  </licenses>\n+\n+  <developers>\n+    <developer>\n+      <id>microsoft</id>\n+      <name>Microsoft Corporation</name>\n+    </developer>\n+  </developers>\n+\n+  <scm>\n+    <connection>scm:git:git://github.com/azure/azure-sdk-for-java</connection>\n+    <developerConnection>scm:git:git://github.com/azure/azure-sdk-for-java</developerConnection>\n+    <url>https://github.com/azure/azure-sdk-for-java</url>\n+  </scm>\n+\n+  <properties>\n+    <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>\n+    <packageOutputDirectory>${project.build.directory}</packageOutputDirectory>\n+  </properties>\n+\n+  <issueManagement>\n+    <system>GitHub</system>\n+    <url>https://github.com/azure/azure-sdk-for-java/issues</url>\n+  </issueManagement>\n+\n+  <dependencyManagement>\n+    <dependencies>\n+      <dependency>\n+        <groupId>com.azure</groupId>\n+        <artifactId>azure-sdk-template</artifactId>\n+        <version>1.0.4-beta.19</version>\n+      </dependency>\n+    </dependencies>\n+  </dependencyManagement>\n+\n+  <build>\n+    <plugins>\n+      <!-- Copy the pom file to output -->\n+      <plugin>\n+        <groupId>org.apache.maven.plugins</groupId>\n+        <artifactId>maven-antrun-plugin</artifactId>\n+        <version>1.8\n+        </version> <!-- {x-version-update;org.apache.maven.plugins:maven-antrun-plugin;external_dependency} -->", "originalCommit": "c43da6981f982bccad21e5c9c515e3467d2223f2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}