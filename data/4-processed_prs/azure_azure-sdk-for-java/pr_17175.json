{"pr_number": 17175, "pr_title": "Fixed the test-path and yaml files", "pr_createdAt": "2020-11-04T19:34:51Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/17175", "timeline": [{"oid": "492ce8223afbd308bba5ddf7ff51c5185934e8ae", "url": "https://github.com/Azure/azure-sdk-for-java/commit/492ce8223afbd308bba5ddf7ff51c5185934e8ae", "message": "Fixed the test-path and yaml files", "committedDate": "2020-11-04T18:29:48Z", "type": "commit"}, {"oid": "6dd7626ae78d6ff8965e08d5d0d7e8a15e944faf", "url": "https://github.com/Azure/azure-sdk-for-java/commit/6dd7626ae78d6ff8965e08d5d0d7e8a15e944faf", "message": "Merge conflicts", "committedDate": "2020-11-04T19:33:03Z", "type": "commit"}, {"oid": "fd200d0cf10f9e53b212e7768482c0f76781d73a", "url": "https://github.com/Azure/azure-sdk-for-java/commit/fd200d0cf10f9e53b212e7768482c0f76781d73a", "message": "Add publish steps", "committedDate": "2020-11-04T23:07:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzcwMDE2MA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17175#discussion_r517700160", "bodyText": "We should consider copying all of eng directory incase we get extra dependencies or other tools we use from our normal repos.", "author": "weshaggard", "createdAt": "2020-11-04T23:53:57Z", "path": "eng/pipelines/docindex.yml", "diffHunk": "@@ -34,16 +35,39 @@ jobs:\n           versionSpec: '3.6'\n       - template: /eng/common/pipelines/templates/steps/mashup-doc-index.yml\n         parameters:\n-          SourceDirectory: $(Build.SourcesDirectory)        \n-      - task: CopyFiles@2\n-        displayName: Copy HTML to Artifacts Directory\n-        inputs:\n-          sourceFolder: $(Build.SourcesDirectory)/docfx_project/\n-          content: '**\\*'\n-          targetFolder: $(Build.ArtifactStagingDirectory)/docfx_project\n-          overWrite: true\n+          SourceDirectory: $(Build.ArtifactStagingDirectory)\n+      - pwsh: |\n+          Copy-Item -Path $(Build.SourcesDirectory)/eng/common/scripts/git-branch-push.ps1 -Destination ./ -Recurse -Force", "originalCommit": "fd200d0cf10f9e53b212e7768482c0f76781d73a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzcwMDc4OQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17175#discussion_r517700789", "bodyText": "Do you mean we add a eng/common folder to gh-pages branch?", "author": "sima-zhu", "createdAt": "2020-11-04T23:55:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzcwMDE2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzcwNDc0Ng==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17175#discussion_r517704746", "bodyText": "I originally thought eng/common but things like the Language-Settings.ps1 script lives under eng/scripts and so I want to be sure if we start including that in our ps scripts we don't break this. That is why I suggest copying all of the eng directory.", "author": "weshaggard", "createdAt": "2020-11-05T00:08:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzcwMDE2MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzcwMDUzNg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17175#discussion_r517700536", "bodyText": "We shouldn't need this explicit add.", "author": "weshaggard", "createdAt": "2020-11-04T23:54:59Z", "path": "eng/pipelines/docindex.yml", "diffHunk": "@@ -34,16 +35,39 @@ jobs:\n           versionSpec: '3.6'\n       - template: /eng/common/pipelines/templates/steps/mashup-doc-index.yml\n         parameters:\n-          SourceDirectory: $(Build.SourcesDirectory)        \n-      - task: CopyFiles@2\n-        displayName: Copy HTML to Artifacts Directory\n-        inputs:\n-          sourceFolder: $(Build.SourcesDirectory)/docfx_project/\n-          content: '**\\*'\n-          targetFolder: $(Build.ArtifactStagingDirectory)/docfx_project\n-          overWrite: true\n+          SourceDirectory: $(Build.ArtifactStagingDirectory)\n+      - pwsh: |\n+          Copy-Item -Path $(Build.SourcesDirectory)/eng/common/scripts/git-branch-push.ps1 -Destination ./ -Recurse -Force\n+          echo \"##vso[task.setvariable variable=gitPushScriptPath]$(Build.BinariesDirectory)/git-branch-push.ps1\"\n+        workingDirectory: $(Build.BinariesDirectory)\n+        displayName: Move Git Push scripts to Tool Directory  \n+\n       - task: PublishPipelineArtifact@0\n         condition: succeeded()\n         inputs:\n           artifactName: \"Doc.Index\"\n-          targetPath: $(Build.ArtifactStagingDirectory)/docfx_project/_site\n\\ No newline at end of file\n+          targetPath: $(Build.ArtifactStagingDirectory)/docfx_project/_site\n+          \n+      - pwsh: |\n+          git checkout -b gh-pages-local --track origin/gh-pages-root\n+        workingDirectory: $(Build.SourcesDirectory)\n+        displayName: Git pull GH pages branch\n+\n+      - pwsh: |\n+          Copy-Item -Path $(Build.ArtifactStagingDirectory)/docfx_project/_site/* -Destination ./ -Recurse -Force\n+          git add -A", "originalCommit": "fd200d0cf10f9e53b212e7768482c0f76781d73a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzcwMTA3NQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17175#discussion_r517701075", "bodyText": "All files copied to the gh-pages-local branch are untracked from git. git-branch-push will create a new branch which inherit gh-pages-local which did not include the new changes.", "author": "sima-zhu", "createdAt": "2020-11-04T23:56:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzcwMDUzNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzcwNTYzMw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17175#discussion_r517705633", "bodyText": "Yes but when we do the commit we pass in the \"-am\" option with the \"-a\" part means include all changes.  Is that not picking up new files? If it is not the doing the \"git add -A\"", "author": "weshaggard", "createdAt": "2020-11-05T00:11:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzcwMDUzNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODM4ODg0NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17175#discussion_r518388844", "bodyText": "They are not the same branch. git-branch-push is on gh-pages which inherited from gh-page-local I am creating. However, the changes are untracked in gh-pages-local if no git add -A", "author": "sima-zhu", "createdAt": "2020-11-05T21:46:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzcwMDUzNg=="}], "type": "inlineReview"}, {"oid": "3a70e963ba80f9331832cf725349403cd982b61c", "url": "https://github.com/Azure/azure-sdk-for-java/commit/3a70e963ba80f9331832cf725349403cd982b61c", "message": "Copy the entire eng/common folder", "committedDate": "2020-11-05T00:53:47Z", "type": "commit"}, {"oid": "b08618b84205304959a15c59d044c94f81498118", "url": "https://github.com/Azure/azure-sdk-for-java/commit/b08618b84205304959a15c59d044c94f81498118", "message": "copy all under eng", "committedDate": "2020-11-05T01:14:05Z", "type": "commit"}]}