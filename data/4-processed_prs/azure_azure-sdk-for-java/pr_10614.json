{"pr_number": 10614, "pr_title": "Spring Boot migration - AAD related samples", "pr_createdAt": "2020-04-30T01:40:01Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/10614", "timeline": [{"oid": "f01ef383124247cd69683febcce8d749da266009", "url": "https://github.com/Azure/azure-sdk-for-java/commit/f01ef383124247cd69683febcce8d749da266009", "message": "add samples for aad", "committedDate": "2020-04-30T00:48:58Z", "type": "commit"}, {"oid": "f504d58e14401d510e78ade5c2ff7c8e9de009f0", "url": "https://github.com/Azure/azure-sdk-for-java/commit/f504d58e14401d510e78ade5c2ff7c8e9de009f0", "message": "remove all en-us part of URL, fix codestyle, rename readmes", "committedDate": "2020-04-30T01:35:27Z", "type": "commit"}, {"oid": "a05d0e422080647273c445c2fb8c7a0db68e5624", "url": "https://github.com/Azure/azure-sdk-for-java/commit/a05d0e422080647273c445c2fb8c7a0db68e5624", "message": "fix README.md files", "committedDate": "2020-04-30T07:02:43Z", "type": "commit"}, {"oid": "f6907c50c8a12598fe36b5b732b427a86a2faec6", "url": "https://github.com/Azure/azure-sdk-for-java/commit/f6907c50c8a12598fe36b5b732b427a86a2faec6", "message": "fix README.md", "committedDate": "2020-04-30T07:26:31Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODI0OTg5Nw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10614#discussion_r418249897", "bodyText": "Why this is commented out, if this is not needed, should we remove it ?", "author": "hemanttanwar", "createdAt": "2020-04-30T19:49:18Z", "path": "sdk/spring/azure-spring-boot-bom/pom.xml", "diffHunk": "@@ -0,0 +1,118 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<project xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+  <modelVersion>4.0.0</modelVersion>\n+\n+  <groupId>com.microsoft.azure</groupId>\n+  <artifactId>azure-spring-boot-bom</artifactId>\n+  <version>2.2.5-beta.1</version>\n+  <packaging>pom</packaging>\n+\n+  <name>Azure Spring Boot BOM</name>\n+  <description>BOM for Microsoft Azure Spring Boot Support</description>\n+  <url>https://github.com/Azure/azure-sdk-for-java</url>\n+\n+  <licenses>\n+    <license>\n+      <name>The MIT License (MIT)</name>\n+      <url>http://opensource.org/licenses/MIT</url>\n+      <distribution>repo</distribution>\n+    </license>\n+  </licenses>\n+\n+  <developers>\n+    <developer>\n+      <id>microsoft</id>\n+      <name>Microsoft Corporation</name>\n+    </developer>\n+  </developers>\n+\n+  <scm>\n+    <connection>scm:git:git://github.com/azure/azure-sdk-for-java</connection>\n+    <developerConnection>scm:git:git://github.com/azure/azure-sdk-for-java</developerConnection>\n+    <url>https://github.com/azure/azure-sdk-for-java</url>\n+  </scm>\n+\n+  <issueManagement>\n+    <system>GitHub</system>\n+    <url>https://github.com/azure/azure-sdk-for-java/issues</url>\n+  </issueManagement>\n+\n+  <dependencyManagement>\n+    <dependencies>\n+      <dependency>\n+        <groupId>com.microsoft.azure</groupId>\n+        <artifactId>spring-data-cosmosdb</artifactId>\n+        <version>2.2.3.FIX1</version> <!-- {x-version-update;com.microsoft.azure:spring-data-cosmosdb;external_dependency} -->\n+      </dependency>\n+      <dependency>\n+        <groupId>com.microsoft.spring.data.gremlin</groupId>\n+        <artifactId>spring-data-gremlin</artifactId>\n+        <version>2.2.3</version> <!-- {x-version-update;com.microsoft.spring.data.gremlin:spring-data-gremlin;external_dependency} -->\n+      </dependency>\n+\n+      <!-- Azure Dependencies Bom -->\n+      <dependency>\n+        <groupId>com.microsoft.azure</groupId>\n+        <artifactId>azure-spring-boot</artifactId>\n+        <version>2.2.5-beta.1</version> <!-- {x-version-update;com.microsoft.azure:azure-spring-boot;current} -->\n+      </dependency>\n+      <dependency>\n+        <groupId>com.microsoft.azure</groupId>\n+        <artifactId>azure-spring-boot-starter</artifactId>\n+        <version>2.2.5-beta.1</version> <!-- {x-version-update;com.microsoft.azure:azure-spring-boot-starter;current} -->\n+      </dependency>\n+      <dependency>\n+        <groupId>com.microsoft.azure</groupId>\n+        <artifactId>azure-active-directory-spring-boot-starter</artifactId>\n+        <version>2.2.5-beta.1</version> <!-- {x-version-update;com.microsoft.azure:azure-active-directory-spring-boot-starter;current} -->\n+      </dependency>\n+      <!--\n+      <dependency>", "originalCommit": "f6907c50c8a12598fe36b5b732b427a86a2faec6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDU3NTM1NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10614#discussion_r420575354", "bodyText": "The commented out parts are in following PRs.", "author": "saragluna", "createdAt": "2020-05-06T06:44:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODI0OTg5Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODI1MDI2MQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10614#discussion_r418250261", "bodyText": "We should put standard text for contributing.", "author": "hemanttanwar", "createdAt": "2020-04-30T19:49:58Z", "path": "sdk/spring/azure-spring-boot-samples/azure-spring-boot-sample-active-directory-backend-v2/README.md", "diffHunk": "@@ -0,0 +1,96 @@\n+# OAuth 2.0 Sample for Azure AD Spring Boot Starter client library for Java\n+\n+## Key concepts\n+This sample illustrates how to use `azure-active-directory-spring-boot-starter` package to work with OAuth 2.0 and OpenID Connect protocols on Auzre. This sample will use Microsoft Graph API to retrieve user info. This is the key difference from [azure-spring-boot-sample-active-directory-backend](../azure-spring-boot-sample-active-directory-backend/README.md). It's reflected by these configurations in `appication.properties`:\n+```properties\n+azure.activedirectory.environment=global-v2-graph\n+azure.activedirectory.user-group.key=@odata.type\n+azure.activedirectory.user-group.value=#microsoft.graph.group\n+azure.activedirectory.user-group.object-id-key=id\n+```\n+\n+## Getting started\n+\n+### Register your application with your Azure Active Directory Tenant\n+\n+Follow the guide [here](https://docs.microsoft.com/azure/active-directory/develop/quickstart-register-app).\n+\n+### Configure groups for sign in user\n+\n+In order to try the authorization action with this sample with minimum effort, [configure the user and groups in Azure Active Directory](https://docs.microsoft.com/azure/active-directory/active-directory-groups-create-azure-portal), configure the user with `group1`. \n+\n+\n+## Examples\n+\n+### Configure application.properties\n+\n+```properties\n+spring.security.oauth2.client.registration.azure.client-id=xxxxxx-your-client-id-xxxxxx\n+spring.security.oauth2.client.registration.azure.client-secret=xxxxxx-your-client-secret-xxxxxx\n+\n+azure.activedirectory.tenant-id=xxxxxx-your-tenant-id-xxxxxx\n+# It's suggested the logged in user should at least belong to one of the below groups\n+# If not, the logged in user will not be able to access any authorization controller rest APIs\n+azure.activedirectory.active-directory-groups=group1, group2\n+```\n+\n+### Run with Maven\n+\n+```shell\n+# Under azure-spring-boot project root directory\n+mvn clean install -DskipTests\n+cd azure-spring-boot-samples\n+cd azure-spring-boot-sample-active-directory-backend-v2\n+mvn spring-boot:run\n+```\n+\n+### Check the authentication and authorization\n+\t\n+1. Access http://localhost:8080\n+2. Login\n+3. Access `group1 Message` link, should success\n+4. Access `group2 Message` link, should fail with forbidden error message\n+\n+\n+### <strong>*</strong> Take full control over every configuration property\n+\n+If you want to adjust the configuration properties according to certain requirements, try below application.properties and change accordingly.\n+\n+```properties\n+spring.security.oauth2.client.registration.azure.client-id=xxxxxx-your-client-id-xxxxxx\n+spring.security.oauth2.client.registration.azure.client-secret=xxxxxx-your-client-secret-xxxxxx\n+spring.security.oauth2.client.registration.azure.client-name=Azure\n+spring.security.oauth2.client.registration.azure.provider=azure-oauth-provider\n+spring.security.oauth2.client.registration.azure.scope=openid, https://graph.microsoft.com/user.read\n+spring.security.oauth2.client.registration.azure.redirect-uri-template={baseUrl}/login/oauth2/code/{registrationId}\n+spring.security.oauth2.client.registration.azure.client-authentication-method=basic\n+spring.security.oauth2.client.registration.azure.authorization-grant-type=authorization_code\n+\n+spring.security.oauth2.client.provider.azure-oauth-provider.authorization-uri=https://login.microsoftonline.com/common/oauth2/authorize\n+spring.security.oauth2.client.provider.azure-oauth-provider.token-uri=https://login.microsoftonline.com/common/oauth2/token\n+spring.security.oauth2.client.provider.azure-oauth-provider.user-info-uri=https://login.microsoftonline.com/common/openid/userinfo\n+spring.security.oauth2.client.provider.azure-oauth-provider.jwk-set-uri=https://login.microsoftonline.com/common/discovery/keys\n+spring.security.oauth2.client.provider.azure-oauth-provider.user-name-attribute=name\n+\n+azure.activedirectory.tenant-id=xxxxxx-your-tenant-id-xxxxxx\n+azure.activedirectory.active-directory-groups=group1, group2\n+```\n+\n+## Troubleshooting\n+\n+### If registered application is not multi-tenanted, how to run this sample?\n+In this auto-configuration, by [default](https://github.com/Microsoft/azure-spring-boot/blob/master/azure-spring-boot/src/main/resources/aad-oauth2-common.properties#L1-L4) `/common` is used for the tenant value. According to [Active Directory Sign In Request format](https://docs.microsoft.com/azure/active-directory/develop/v2-protocols-oidc#send-the-sign-in-request), if your application is not multi-tenanted, you have to configure a tenant specific authorization endpoints.\n+\n+Configure endpoints with specific tenant-id by replacing `common` in your application.properties file:\n+```properties\n+spring.security.oauth2.client.provider.azure-oauth-provider.authorization-uri=https://login.microsoftonline.com/{your-tenant-id}/oauth2/authorize\n+spring.security.oauth2.client.provider.azure-oauth-provider.token-uri=https://login.microsoftonline.com/{your-tenant-id}/oauth2/token\n+spring.security.oauth2.client.provider.azure-oauth-provider.user-info-uri=https://login.microsoftonline.com/{your-tenant-id}/openid/userinfo\n+spring.security.oauth2.client.provider.azure-oauth-provider.jwk-set-uri=https://login.microsoftonline.com/{your-tenant-id}/discovery/keys\n+```\n+---\n+### Meet with `AADSTS240002: Input id_token cannot be used as 'urn:ietf:params:oauth:grant-type:jwt-bearer' grant` error.\n+In Azure portal, app registration manifest page, configure `oauth2AllowImplicitFlow` in your application manifest to `true`. See [this issue](https://github.com/MicrosoftDocs/azure-docs/issues/8121#issuecomment-387090099) for details on this workaround.\n+\n+## Next steps\n+## Contributing", "originalCommit": "f6907c50c8a12598fe36b5b732b427a86a2faec6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDU3NTgyNQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10614#discussion_r420575825", "bodyText": "Should we link to this CONTRIBUTING.md?", "author": "saragluna", "createdAt": "2020-05-06T06:45:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODI1MDI2MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTU2OTYzNg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10614#discussion_r421569636", "bodyText": "This contributing guide is very specific to azure-sdk-for-java and its related tools. You probably want a guide which talks about how user can contribute to something which is specific to azure-spring-*", "author": "hemanttanwar", "createdAt": "2020-05-07T14:54:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODI1MDI2MQ=="}], "type": "inlineReview"}, {"oid": "99a999b42eeaa11b52ad2dab5ec252f8ff8b88ca", "url": "https://github.com/Azure/azure-sdk-for-java/commit/99a999b42eeaa11b52ad2dab5ec252f8ff8b88ca", "message": "add azure-spring-boot in jacoco-test-coverage pom file to make build-from-source successful", "committedDate": "2020-05-08T09:46:27Z", "type": "commit"}, {"oid": "8c4f279088d322aa2a3ebe4600ffacd07f7daf5d", "url": "https://github.com/Azure/azure-sdk-for-java/commit/8c4f279088d322aa2a3ebe4600ffacd07f7daf5d", "message": "Merge branch 'master' into feature/spring-boot-aad-samples", "committedDate": "2020-05-08T09:48:38Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjE4MTY2NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10614#discussion_r422181664", "bodyText": "If this is a track 1, or data, library it does not belong in here. Jacoco is for track 2, or client libraries only.", "author": "JimSuplizio", "createdAt": "2020-05-08T14:39:37Z", "path": "eng/jacoco-test-coverage/pom.xml", "diffHunk": "@@ -187,6 +187,11 @@\n       <artifactId>azure-sdk-template</artifactId>\n       <version>1.0.4-beta.13</version> <!-- {x-version-update;com.azure:azure-sdk-template;current} -->\n     </dependency>\n+    <dependency>", "originalCommit": "8c4f279088d322aa2a3ebe4600ffacd07f7daf5d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjQzNzg3OA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10614#discussion_r422437878", "bodyText": "@JimSuplizio Thanks for the clarification. I'll define the versions of Spring modules in version_client.txt then. We'd like to use track 2 pipelines for Spring modules, but only with the group id azure.microsoft.com for as long as one more release for them.", "author": "saragluna", "createdAt": "2020-05-09T01:32:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjE4MTY2NA=="}], "type": "inlineReview"}, {"oid": "8a3cf58d472f64d840a293ccde7f59c25bb6cec1", "url": "https://github.com/Azure/azure-sdk-for-java/commit/8a3cf58d472f64d840a293ccde7f59c25bb6cec1", "message": "move Spring versions to version_client.txt to keep consistency", "committedDate": "2020-05-09T01:53:05Z", "type": "commit"}, {"oid": "94c0ed9ee6e1b59c57a3d55e1f98eb5d856f3a66", "url": "https://github.com/Azure/azure-sdk-for-java/commit/94c0ed9ee6e1b59c57a3d55e1f98eb5d856f3a66", "message": "add additional modules to build in ci.yml", "committedDate": "2020-05-13T09:15:13Z", "type": "commit"}, {"oid": "050e05f1a91871b7021b22aac24e23b779d5f700", "url": "https://github.com/Azure/azure-sdk-for-java/commit/050e05f1a91871b7021b22aac24e23b779d5f700", "message": "add configurations for JavaDoc plugins and entries in jacoco-test-coverage", "committedDate": "2020-05-21T09:20:02Z", "type": "commit"}, {"oid": "266ae5e287511070626d147a528f1c32b9485e78", "url": "https://github.com/Azure/azure-sdk-for-java/commit/266ae5e287511070626d147a528f1c32b9485e78", "message": "remove dependencyManagement and move bom file to sdk/boms", "committedDate": "2020-05-27T09:58:36Z", "type": "commit"}, {"oid": "b17e090db405ee55e6555304df594929f23ef9a7", "url": "https://github.com/Azure/azure-sdk-for-java/commit/b17e090db405ee55e6555304df594929f23ef9a7", "message": "Merge pull request #1 from yiliuTo/feature/update-aad-dependency\n\nremove dependencyManagement and move bom file to sdk/boms", "committedDate": "2020-05-27T10:05:55Z", "type": "commit"}, {"oid": "ae56407b3ca347d2b71e3cacafcd3e208b5e069b", "url": "https://github.com/Azure/azure-sdk-for-java/commit/ae56407b3ca347d2b71e3cacafcd3e208b5e069b", "message": "Merge branch 'master' into feature/spring-boot-aad-samples", "committedDate": "2020-05-27T10:07:54Z", "type": "commit"}, {"oid": "fbcc5aa85b4dad2108c297c543cf568ecaba0718", "url": "https://github.com/Azure/azure-sdk-for-java/commit/fbcc5aa85b4dad2108c297c543cf568ecaba0718", "message": "remove azure-spring-boot-bom in spring ci", "committedDate": "2020-05-27T14:08:39Z", "type": "commit"}, {"oid": "3f5b0f6def2a895d210fcd1558e4d4f60a4e22f4", "url": "https://github.com/Azure/azure-sdk-for-java/commit/3f5b0f6def2a895d210fcd1558e4d4f60a4e22f4", "message": "Merge branch 'master' into feature/spring-boot-aad-samples", "committedDate": "2020-05-28T04:30:42Z", "type": "commit"}, {"oid": "d96098ba4f66a9eaf3e6afd73bd8ac81bead892e", "url": "https://github.com/Azure/azure-sdk-for-java/commit/d96098ba4f66a9eaf3e6afd73bd8ac81bead892e", "message": "Merge remote-tracking branch 'upstream/master' into feature/spring-boot-aad-samples", "committedDate": "2020-06-09T10:08:51Z", "type": "commit"}, {"oid": "da2970d4d8a119297de76d1bd5b43c375a9f42f8", "url": "https://github.com/Azure/azure-sdk-for-java/commit/da2970d4d8a119297de76d1bd5b43c375a9f42f8", "message": "remove current tags from azure-spring-boot-bom", "committedDate": "2020-06-10T03:45:53Z", "type": "commit"}]}