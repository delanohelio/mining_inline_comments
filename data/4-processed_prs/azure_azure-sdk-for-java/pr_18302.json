{"pr_number": 18302, "pr_title": "remove updating rotating dependencies and handle network error", "pr_createdAt": "2020-12-22T03:13:04Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/18302", "timeline": [{"oid": "ce146261734775a18c6a20018129e3992f58d2e6", "url": "https://github.com/Azure/azure-sdk-for-java/commit/ce146261734775a18c6a20018129e3992f58d2e6", "message": "remove updating rotating dependencies and handle network error", "committedDate": "2020-12-22T03:09:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzU5MjU1Mg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18302#discussion_r547592552", "bodyText": "# To avoid dependency conflicts between SDK and Spring, when modify or add dependencies,\n# make sure the version is same to sdk/spring/scripts/spring_managed_external_dependencies.txt.\n# If your version is different from sdk/spring/scripts/spring_managed_external_dependencies.txt, \n# please discuss with Spring Integration team members:\n# @chenrujun (rujche), @saragluna (xiada), @yiliuTo (yiliu6), @backwind1233 (zhihaoguo).  \n# Thanks.", "author": "chenrujun", "createdAt": "2020-12-23T01:36:40Z", "path": "eng/versioning/external_dependencies.txt", "diffHunk": "@@ -1,3 +1,8 @@\n+# To avoid dependency conflicts between SDK and Spring, if you want to modify or add dependencies\n+# that are managed in sdk/spring/scripts/spring_managed_external_dependencies.txt, please discuss\n+# with Spring Integration team. Thanks\n+# alias: rujche, xiada, yiliu6, zhihaoguo", "originalCommit": "ce146261734775a18c6a20018129e3992f58d2e6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzU5MzgxMA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18302#discussion_r547593810", "bodyText": "Rename to visited_poms", "author": "chenrujun", "createdAt": "2020-12-23T01:42:30Z", "path": "sdk/spring/scripts/update_external_dependencies_by_spring.py", "diffHunk": "@@ -60,13 +60,19 @@ def update_dependency_dict(dependency_dict, root_pom_id):\n     )\n     q = queue.Queue()\n     q.put(root_pom)\n+    pom_backup_set = set()", "originalCommit": "ce146261734775a18c6a20018129e3992f58d2e6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzU5NTA1Ng==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18302#discussion_r547595056", "bodyText": "Update __str__(self) in pom.py:\n    def __str__(self):\n        return '{}:{};{}'.format(self.group_id, self.artifact_id, self.version)\n\ni.e. Change {}:{}:{} to {}:{};{}, second : change to ;.\nThen we can use str(new_pom) instead of define new_pom_string", "author": "chenrujun", "createdAt": "2020-12-23T01:47:57Z", "path": "sdk/spring/scripts/update_external_dependencies_by_spring.py", "diffHunk": "@@ -102,9 +108,12 @@ def update_dependency_dict(dependency_dict, root_pom_id):\n             artifact_type = dependency_element.find('./maven:type', MAVEN_NAME_SPACE)\n             if artifact_type is not None and artifact_type.text.strip() == 'pom':\n                 new_pom = Pom(group_id, artifact_id, version, pom.depth + 1)\n-                q.put(new_pom)\n-                pom_count = pom_count + 1\n-                log.debug('Added new pom. depth = {}, url = {}.'.format(new_pom.to_url(), new_pom.depth))\n+                new_pom_string = '{}:{};{}'.format(group_id, artifact_id, version)", "originalCommit": "ce146261734775a18c6a20018129e3992f58d2e6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzU5NTM0OQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18302#discussion_r547595349", "bodyText": "And update output_version_dict_to_file(...), use '{};{}\\n' to replace '{}:{}\\n'.", "author": "chenrujun", "createdAt": "2020-12-23T01:49:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzU5NTA1Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzU5NTcwNQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18302#discussion_r547595705", "bodyText": "Rename ROOT_POM_IDS to ROOT_POMS.\nDelete SKIP_IDS", "author": "chenrujun", "createdAt": "2020-12-23T01:50:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzU5NTA1Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzU5NTkyNw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18302#discussion_r547595927", "bodyText": "new_pom.depth should be the first parameter.", "author": "chenrujun", "createdAt": "2020-12-23T01:51:43Z", "path": "sdk/spring/scripts/update_external_dependencies_by_spring.py", "diffHunk": "@@ -102,9 +108,12 @@ def update_dependency_dict(dependency_dict, root_pom_id):\n             artifact_type = dependency_element.find('./maven:type', MAVEN_NAME_SPACE)\n             if artifact_type is not None and artifact_type.text.strip() == 'pom':\n                 new_pom = Pom(group_id, artifact_id, version, pom.depth + 1)\n-                q.put(new_pom)\n-                pom_count = pom_count + 1\n-                log.debug('Added new pom. depth = {}, url = {}.'.format(new_pom.to_url(), new_pom.depth))\n+                new_pom_string = '{}:{};{}'.format(group_id, artifact_id, version)\n+                if new_pom_string not in pom_backup_set:\n+                    q.put(new_pom)\n+                    pom_backup_set.add(new_pom_string)\n+                    pom_count = pom_count + 1\n+                    log.debug('Added new pom. depth = {}, url = {}.'.format(new_pom.to_url(), new_pom.depth))", "originalCommit": "ce146261734775a18c6a20018129e3992f58d2e6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzU5NjU1Ng==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18302#discussion_r547596556", "bodyText": "Add warn log if new_pom in visited_poms.\nif ...\n   ...\nelse\n  log.warn('Pom exist in visited_pom. depth = {}, url = {}.'.format(new_pom.depth, new_pom.to_url()))", "author": "chenrujun", "createdAt": "2020-12-23T01:54:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzU5NTkyNw=="}], "type": "inlineReview"}, {"oid": "f48bcd03b71cbe99ccfbd20ec25f6f8c9007b6be", "url": "https://github.com/Azure/azure-sdk-for-java/commit/f48bcd03b71cbe99ccfbd20ec25f6f8c9007b6be", "message": "remove unused variables and update output formats", "committedDate": "2020-12-24T02:44:31Z", "type": "commit"}, {"oid": "558d08e2cb88d316d8cc3a20378eca3793617551", "url": "https://github.com/Azure/azure-sdk-for-java/commit/558d08e2cb88d316d8cc3a20378eca3793617551", "message": "update spring dependency format", "committedDate": "2020-12-24T06:53:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODQyMTA2MQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18302#discussion_r548421061", "bodyText": "Em... Seems we can not delete SKIP_IDS. You can check the Refs for more information.", "author": "chenrujun", "createdAt": "2020-12-24T06:58:39Z", "path": "sdk/spring/scripts/update_external_dependencies_by_spring.py", "diffHunk": "@@ -10,20 +10,18 @@\n import urllib.request as request\n import xml.etree.ElementTree as elementTree\n from itertools import takewhile\n-\n+from urllib.error import HTTPError\n import in_place\n \n from log import log, Log\n from pom import Pom\n \n EXTERNAL_DEPENDENCIES_FILE = 'eng/versioning/external_dependencies.txt'\n-ROOT_POM_IDS = [\n+ROOT_POM = [\n     'org.springframework.boot:spring-boot-dependencies;2.3.5.RELEASE',\n     'org.springframework.cloud:spring-cloud-dependencies;Hoxton.SR8'\n ]\n-SKIP_IDS = [\n-    'org.eclipse.jgit:org.eclipse.jgit'  # Refs: https://github.com/Azure/azure-sdk-for-java/pull/13956/files#r468368271", "originalCommit": "558d08e2cb88d316d8cc3a20378eca3793617551", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODQyMTEzMg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18302#discussion_r548421132", "bodyText": "We can not change this.", "author": "chenrujun", "createdAt": "2020-12-24T06:58:58Z", "path": "eng/versioning/external_dependencies.txt", "diffHunk": "@@ -174,7 +181,7 @@ org.eclipse.aether:aether-connector-basic;1.1.0\n org.eclipse.aether:aether-transport-wagon;1.1.0\n org.eclipse.jetty:jetty-http;9.4.33.v20201020\n org.eclipse.jetty:jetty-server;9.4.33.v20201020\n-org.eclipse.jgit:org.eclipse.jgit;4.5.7.201904151645-r\n+org.eclipse.jgit:org.eclipse.jgit;5.1.3.201810200350-r", "originalCommit": "558d08e2cb88d316d8cc3a20378eca3793617551", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODQyMTQ5MQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18302#discussion_r548421491", "bodyText": "visited_pom_strings or visited_pom_string_set", "author": "chenrujun", "createdAt": "2020-12-24T07:00:32Z", "path": "sdk/spring/scripts/update_external_dependencies_by_spring.py", "diffHunk": "@@ -60,13 +57,19 @@ def update_dependency_dict(dependency_dict, root_pom_id):\n     )\n     q = queue.Queue()\n     q.put(root_pom)\n+    visited_poms_string = set()", "originalCommit": "558d08e2cb88d316d8cc3a20378eca3793617551", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODQyMTcwOA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18302#discussion_r548421708", "bodyText": "Pom exist in visited_pom_strings", "author": "chenrujun", "createdAt": "2020-12-24T07:01:33Z", "path": "sdk/spring/scripts/update_external_dependencies_by_spring.py", "diffHunk": "@@ -102,9 +105,14 @@ def update_dependency_dict(dependency_dict, root_pom_id):\n             artifact_type = dependency_element.find('./maven:type', MAVEN_NAME_SPACE)\n             if artifact_type is not None and artifact_type.text.strip() == 'pom':\n                 new_pom = Pom(group_id, artifact_id, version, pom.depth + 1)\n-                q.put(new_pom)\n-                pom_count = pom_count + 1\n-                log.debug('Added new pom. depth = {}, url = {}.'.format(new_pom.to_url(), new_pom.depth))\n+                new_pom_string = '{}:{};{}'.format(group_id, artifact_id, version)\n+                if new_pom_string not in visited_poms_string:\n+                    q.put(new_pom)\n+                    visited_poms_string.add(new_pom_string)\n+                    pom_count = pom_count + 1\n+                    log.debug('Added new pom. depth = {}, url = {}.'.format(new_pom.depth, new_pom.to_url()))\n+                else:\n+                    log.warn('Pom exist in visited_pom. depth = {}, url = {}.'.format(new_pom.depth, new_pom.to_url()))", "originalCommit": "558d08e2cb88d316d8cc3a20378eca3793617551", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODQyMTkwMg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18302#discussion_r548421902", "bodyText": "ROOT_POMS", "author": "chenrujun", "createdAt": "2020-12-24T07:02:22Z", "path": "sdk/spring/scripts/update_external_dependencies_by_spring.py", "diffHunk": "@@ -10,20 +10,18 @@\n import urllib.request as request\n import xml.etree.ElementTree as elementTree\n from itertools import takewhile\n-\n+from urllib.error import HTTPError\n import in_place\n \n from log import log, Log\n from pom import Pom\n \n EXTERNAL_DEPENDENCIES_FILE = 'eng/versioning/external_dependencies.txt'\n-ROOT_POM_IDS = [\n+ROOT_POM = [", "originalCommit": "558d08e2cb88d316d8cc3a20378eca3793617551", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "a136eaceefe8dc33456acc74339fa024e45a365e", "url": "https://github.com/Azure/azure-sdk-for-java/commit/a136eaceefe8dc33456acc74339fa024e45a365e", "message": "add skip-pom variable for org.exlipse.jgit", "committedDate": "2020-12-24T07:17:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODQyOTUzMg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18302#discussion_r548429532", "bodyText": "The white space can be deleted.", "author": "chenrujun", "createdAt": "2020-12-24T07:31:18Z", "path": "sdk/spring/scripts/update_external_dependencies_by_spring.py", "diffHunk": "@@ -10,20 +10,20 @@\n import urllib.request as request\n import xml.etree.ElementTree as elementTree\n from itertools import takewhile\n-\n+from urllib.error import HTTPError\n import in_place\n \n from log import log, Log\n from pom import Pom\n \n EXTERNAL_DEPENDENCIES_FILE = 'eng/versioning/external_dependencies.txt'\n-ROOT_POM_IDS = [\n+ROOT_POMS = [\n     'org.springframework.boot:spring-boot-dependencies;2.3.5.RELEASE',\n     'org.springframework.cloud:spring-cloud-dependencies;Hoxton.SR8'\n ]\n SKIP_IDS = [\n     'org.eclipse.jgit:org.eclipse.jgit'  # Refs: https://github.com/Azure/azure-sdk-for-java/pull/13956/files#r468368271\n-]\n+    ]", "originalCommit": "a136eaceefe8dc33456acc74339fa024e45a365e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODQzMDA4Ng==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18302#discussion_r548430086", "bodyText": "visited_pom_strings, Delete s after pom.", "author": "chenrujun", "createdAt": "2020-12-24T07:33:18Z", "path": "sdk/spring/scripts/update_external_dependencies_by_spring.py", "diffHunk": "@@ -60,13 +59,19 @@ def update_dependency_dict(dependency_dict, root_pom_id):\n     )\n     q = queue.Queue()\n     q.put(root_pom)\n+    visited_poms_strings = set()", "originalCommit": "a136eaceefe8dc33456acc74339fa024e45a365e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "2d2f1963a325f52bce9622dfb431db4ada01ed3f", "url": "https://github.com/Azure/azure-sdk-for-java/commit/2d2f1963a325f52bce9622dfb431db4ada01ed3f", "message": "modify naming and formatting errors", "committedDate": "2020-12-24T07:42:43Z", "type": "commit"}]}