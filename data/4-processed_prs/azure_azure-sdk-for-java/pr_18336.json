{"pr_number": 18336, "pr_title": "Add Test Coverage tab for Communication", "pr_createdAt": "2020-12-23T19:44:18Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/18336", "timeline": [{"oid": "3946e415a3b18955acf278a17dd7f6105a96cf8b", "url": "https://github.com/Azure/azure-sdk-for-java/commit/3946e415a3b18955acf278a17dd7f6105a96cf8b", "message": "Add Test Coverage tab for Communication", "committedDate": "2020-12-23T19:43:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODIyMjU3Mg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18336#discussion_r548222572", "bodyText": "nit: Move this task to run immediately after the 'Run tests: $(DisplayName)' task is complete.", "author": "srnagar", "createdAt": "2020-12-23T20:45:33Z", "path": "eng/pipelines/templates/jobs/archetype-sdk-tests.yml", "diffHunk": "@@ -159,10 +159,34 @@ jobs:\n \n       - template: ../steps/upload-repository-on-failure.yml\n \n+      - task: Maven@3", "originalCommit": "3946e415a3b18955acf278a17dd7f6105a96cf8b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODI0MzAwNg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18336#discussion_r548243006", "bodyText": "Done, thanks Srikanta", "author": "minnieliu", "createdAt": "2020-12-23T21:13:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODIyMjU3Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODIyNTI4NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18336#discussion_r548225284", "bodyText": "Add this condition here as well - , eq('${{ parameters.ServiceDirectory }}', 'communication')", "author": "srnagar", "createdAt": "2020-12-23T20:48:57Z", "path": "eng/pipelines/templates/jobs/archetype-sdk-tests.yml", "diffHunk": "@@ -159,10 +159,34 @@ jobs:\n \n       - template: ../steps/upload-repository-on-failure.yml\n \n+      - task: Maven@3\n+        displayName: 'Generate aggregate code coverage report'\n+        condition: and(eq(variables['OsName'], 'Windows'), eq(variables['JavaTestVersion'], '1.11'), eq('${{ parameters.ServiceDirectory }}', 'communication'))\n+        inputs:\n+          mavenPomFile: sdk/${{ parameters.ServiceDirectory }}/pom.xml\n+          options: -Pcoverage\n+          mavenOptions: '$(MemoryOptions) $(LoggingOptions)'\n+          javaHomeOption: 'JDKVersion'\n+          jdkVersionOption: $(JavaTestVersion)\n+          jdkArchitectureOption: 'x64'\n+          goals: jacoco:report-aggregate\n+          # we want to run this when TestFromSource isn't true\n+          condition: and(succeeded(), ne(variables['TestFromSource'],'true'))\n+\n       - task: PublishTestResults@2\n         condition: always()\n         inputs:\n           mergeTestResults: true\n           testRunTitle: 'Live tests for ${{ parameters.ServiceDirectory }} $(DisplayName)'\n           ${{ if ne(parameters.TestResultsFiles, '') }}:\n             testResultsFiles: ${{ parameters.TestResultsFiles }}\n+\n+      # Azure DevOps only seems to respect the last code coverage result published, so only do this for Windows + Java LTS.\n+      # Code coverage reporting is setup only for Track 2 modules.\n+      - task: PublishCodeCoverageResults@1\n+        condition: and(eq(variables['OsName'], 'Windows'), eq(variables['JavaTestVersion'], '1.11'))", "originalCommit": "3946e415a3b18955acf278a17dd7f6105a96cf8b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODI0MzE0Mw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18336#discussion_r548243143", "bodyText": "Done, thanks Srikanta", "author": "minnieliu", "createdAt": "2020-12-23T21:13:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODIyNTI4NA=="}], "type": "inlineReview"}, {"oid": "a505201bd2b45f26eff3c8b726ef4d4c52cff9ba", "url": "https://github.com/Azure/azure-sdk-for-java/commit/a505201bd2b45f26eff3c8b726ef4d4c52cff9ba", "message": "Address code review comments", "committedDate": "2020-12-23T20:58:10Z", "type": "commit"}, {"oid": "c18d35b6baf9f087cd38fb2743d390dcc2c0f5d0", "url": "https://github.com/Azure/azure-sdk-for-java/commit/c18d35b6baf9f087cd38fb2743d390dcc2c0f5d0", "message": "Merge branch 'master' of https://github.com/Azure/azure-sdk-for-java into enableCoverageLivePipeline", "committedDate": "2021-01-04T17:32:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTU5OTIyMQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18336#discussion_r551599221", "bodyText": "We should avoid hardcoding checks specific to one service in our common templates. Instead we should have an opt-in or opt-out that can be set in the ci.yml for a given service.", "author": "weshaggard", "createdAt": "2021-01-04T22:10:10Z", "path": "eng/pipelines/templates/jobs/archetype-sdk-tests.yml", "diffHunk": "@@ -149,6 +149,20 @@ jobs:\n           ${{ insert }}: ${{ parameters.TestStepMavenInputs }}\n         env: ${{ parameters.EnvVars }}\n \n+      - task: Maven@3\n+        displayName: 'Generate aggregate code coverage report'\n+        condition: and(eq(variables['OsName'], 'Windows'), eq(variables['JavaTestVersion'], '1.11'), eq('${{ parameters.ServiceDirectory }}', 'communication'))", "originalCommit": "c18d35b6baf9f087cd38fb2743d390dcc2c0f5d0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}