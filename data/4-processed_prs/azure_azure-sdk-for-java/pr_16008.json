{"pr_number": 16008, "pr_title": "Only check the touched markdown files in PR for the Verify link step", "pr_createdAt": "2020-10-06T21:13:17Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/16008", "timeline": [{"oid": "5ff2903cbdf303a11c63559341e4eb393449d87b", "url": "https://github.com/Azure/azure-sdk-for-java/commit/5ff2903cbdf303a11c63559341e4eb393449d87b", "message": "this is diff check", "committedDate": "2020-10-06T21:51:42Z", "type": "forcePushed"}, {"oid": "141f10b452fbc6a1aa3e77076eb02f752747edb8", "url": "https://github.com/Azure/azure-sdk-for-java/commit/141f10b452fbc6a1aa3e77076eb02f752747edb8", "message": "diff on check", "committedDate": "2020-10-06T22:06:59Z", "type": "forcePushed"}, {"oid": "d35b6bb39cbdaf4456dc925957b887aebd193bc7", "url": "https://github.com/Azure/azure-sdk-for-java/commit/d35b6bb39cbdaf4456dc925957b887aebd193bc7", "message": "Check links on diff", "committedDate": "2020-10-06T23:27:40Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjA0NzA1MQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16008#discussion_r502047051", "bodyText": "Why not just put this inline like:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                      Urls: $(diffMarkdown)\n          \n          \n            \n                      Urls: (git diff origin/master HEAD --name-only -- *.md)", "author": "weshaggard", "createdAt": "2020-10-08T22:27:53Z", "path": "eng/pipelines/templates/jobs/archetype-sdk-client.yml", "diffHunk": "@@ -162,9 +162,15 @@ jobs:\n           ward scan -d $(Build.SourcesDirectory) -c $(Build.SourcesDirectory)/eng/.docsettings.yml\n         displayName: 'Verify Readmes'\n \n+      - pwsh: |\n+            $diffs = git diff origin/master HEAD --name-only -- *.md\n+            echo \"##vso[task.setvariable variable=diffMarkdown]$diffs\"\n+        displayName: 'Find diff files'\n+\n       - template: ../../../common/pipelines/templates/steps/verify-links.yml\n         parameters:\n           Directory: sdk/${{ parameters.ServiceDirectory }}\n+          Urls: $(diffMarkdown)", "originalCommit": "d35b6bb39cbdaf4456dc925957b887aebd193bc7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjA0ODM0OQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16008#discussion_r502048349", "bodyText": "Your diff command will find all files in the PR not just files under the service directory so we may need to figure out what Directory we want to pass here.", "author": "weshaggard", "createdAt": "2020-10-08T22:31:24Z", "path": "eng/pipelines/templates/jobs/archetype-sdk-client.yml", "diffHunk": "@@ -162,9 +162,15 @@ jobs:\n           ward scan -d $(Build.SourcesDirectory) -c $(Build.SourcesDirectory)/eng/.docsettings.yml\n         displayName: 'Verify Readmes'\n \n+      - pwsh: |\n+            $diffs = git diff origin/master HEAD --name-only -- *.md\n+            echo \"##vso[task.setvariable variable=diffMarkdown]$diffs\"\n+        displayName: 'Find diff files'\n+\n       - template: ../../../common/pipelines/templates/steps/verify-links.yml\n         parameters:\n           Directory: sdk/${{ parameters.ServiceDirectory }}", "originalCommit": "d35b6bb39cbdaf4456dc925957b887aebd193bc7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "a980dead12bf61bd62096b0400f30c0ba38d6fcb", "url": "https://github.com/Azure/azure-sdk-for-java/commit/a980dead12bf61bd62096b0400f30c0ba38d6fcb", "message": "check links on diff", "committedDate": "2020-10-13T17:45:29Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDI4NDQyMQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16008#discussion_r504284421", "bodyText": "Is this the correct diff? What if this pipeline runs against a feature branch? This will produce a potentially large diff with a lot of files. I think we are going to need to figure out the correct set files to diff for pull requests as well as the correct set of changes if running outside of a pull request (i.e. manual, CI, scheduled)", "author": "weshaggard", "createdAt": "2020-10-13T22:02:55Z", "path": "eng/pipelines/templates/jobs/archetype-sdk-client.yml", "diffHunk": "@@ -164,7 +164,8 @@ jobs:\n \n       - template: ../../../common/pipelines/templates/steps/verify-links.yml\n         parameters:\n-          Directory: sdk/${{ parameters.ServiceDirectory }}\n+          Directory: ''\n+          Urls: (git diff origin/master HEAD --name-only -- *.md)", "originalCommit": "d14a83978a7c85795c46c0009c356b0925a9bde8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDc5ODMwOA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16008#discussion_r504798308", "bodyText": "Will make change to git diff on base branch. Will test over on manual cases.", "author": "sima-zhu", "createdAt": "2020-10-14T16:05:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDI4NDQyMQ=="}], "type": "inlineReview"}, {"oid": "a5a7bb42082931865bd71f2f8d18f18fa8c065e6", "url": "https://github.com/Azure/azure-sdk-for-java/commit/a5a7bb42082931865bd71f2f8d18f18fa8c065e6", "message": "add origin", "committedDate": "2020-10-14T16:25:56Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTE0MDM2MA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16008#discussion_r505140360", "bodyText": "We should figure out how to condition this step to only run for pull requests.", "author": "weshaggard", "createdAt": "2020-10-15T03:18:37Z", "path": "eng/pipelines/templates/jobs/archetype-sdk-client.yml", "diffHunk": "@@ -164,7 +164,8 @@ jobs:\n \n       - template: ../../../common/pipelines/templates/steps/verify-links.yml", "originalCommit": "5a0e36afc461c6fc4c3d9a060686f3129e0e635b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTY4OTk4MQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16008#discussion_r505689981", "bodyText": "Made the change", "author": "sima-zhu", "createdAt": "2020-10-15T16:45:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTE0MDM2MA=="}], "type": "inlineReview"}, {"oid": "65e434cdb3972411c26db2a2fa894168eaa10a9a", "url": "https://github.com/Azure/azure-sdk-for-java/commit/65e434cdb3972411c26db2a2fa894168eaa10a9a", "message": "Check only diff fiels", "committedDate": "2020-10-16T00:57:16Z", "type": "commit"}, {"oid": "65e434cdb3972411c26db2a2fa894168eaa10a9a", "url": "https://github.com/Azure/azure-sdk-for-java/commit/65e434cdb3972411c26db2a2fa894168eaa10a9a", "message": "Check only diff fiels", "committedDate": "2020-10-16T00:57:16Z", "type": "forcePushed"}, {"oid": "de034cc2fa3cbab57e746c35c7b45eb78a5ba386", "url": "https://github.com/Azure/azure-sdk-for-java/commit/de034cc2fa3cbab57e746c35c7b45eb78a5ba386", "message": "Merge branch 'master' of https://github.com/Azure/azure-sdk-for-java into checkLinkOnDiff", "committedDate": "2020-10-16T00:58:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjU5NjA5NQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16008#discussion_r506596095", "bodyText": "I assume this is just for testing?", "author": "weshaggard", "createdAt": "2020-10-16T16:44:37Z", "path": "eng/common/scripts/Verify-Links.ps1", "diffHunk": "@@ -262,7 +262,13 @@ function GetLinks([System.Uri]$pageUri)\n \n   return $links;\n }\n+Write-Host \"There are $($urls.length) files.\"", "originalCommit": "c37dbf75c4b6ff4329765b4cdfcbc5baf80c0287", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjU5NzgxOQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16008#discussion_r506597819", "bodyText": "Yes, it is for testing. Will remove.\nI found the script did not pick up HEAD correctly. I have 2 readme changes, but only one got picked up.\ngit diff origin/master HEAD --name-only -- *.md\n\nI am trying to use commit and test\ngit diff origin/master \"${env:SYSTEM_PULLREQUEST_SOURCECOMMITID}\" --name-only -- *.md", "author": "sima-zhu", "createdAt": "2020-10-16T16:47:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjU5NjA5NQ=="}], "type": "inlineReview"}, {"oid": "ebd1b859471cf6f976cd660d9861e8a8cfc6d544", "url": "https://github.com/Azure/azure-sdk-for-java/commit/ebd1b859471cf6f976cd660d9861e8a8cfc6d544", "message": "Test on readme, and works fine", "committedDate": "2020-10-16T17:31:52Z", "type": "commit"}, {"oid": "ebd1b859471cf6f976cd660d9861e8a8cfc6d544", "url": "https://github.com/Azure/azure-sdk-for-java/commit/ebd1b859471cf6f976cd660d9861e8a8cfc6d544", "message": "Test on readme, and works fine", "committedDate": "2020-10-16T17:31:52Z", "type": "forcePushed"}, {"oid": "6c48b8683edb040d55ddcb6a12c5213f4f257b93", "url": "https://github.com/Azure/azure-sdk-for-java/commit/6c48b8683edb040d55ddcb6a12c5213f4f257b93", "message": "remove testing changes", "committedDate": "2020-10-16T17:33:53Z", "type": "commit"}, {"oid": "8984701e4d60f9de41274646ad8912f531743679", "url": "https://github.com/Azure/azure-sdk-for-java/commit/8984701e4d60f9de41274646ad8912f531743679", "message": "Merge branch 'master' of https://github.com/Azure/azure-sdk-for-java into checkLinkOnDiff", "committedDate": "2020-10-16T17:34:52Z", "type": "commit"}]}