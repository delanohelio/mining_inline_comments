{"pr_number": 12301, "pr_title": "Cosmos CI improvements", "pr_createdAt": "2020-06-17T23:25:10Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/12301", "timeline": [{"oid": "9df6b5e2f76b3fd2b10b8df219c17b68541d8229", "url": "https://github.com/Azure/azure-sdk-for-java/commit/9df6b5e2f76b3fd2b10b8df219c17b68541d8229", "message": "Initial commit for test-resources.json file", "committedDate": "2020-06-17T19:19:32Z", "type": "commit"}, {"oid": "b593988eeef76274ac00c5cb50e7719ad083e381", "url": "https://github.com/Azure/azure-sdk-for-java/commit/b593988eeef76274ac00c5cb50e7719ad083e381", "message": "Add ArmTemplateParameters to archetype-sdk-tests.yml", "committedDate": "2020-06-17T23:13:41Z", "type": "commit"}, {"oid": "51236ccf894955cd61d19a0499507a3b92fe540f", "url": "https://github.com/Azure/azure-sdk-for-java/commit/51236ccf894955cd61d19a0499507a3b92fe540f", "message": "Updated test-resources.json and tests.yml to work with ARM templates", "committedDate": "2020-06-17T23:24:46Z", "type": "commit"}, {"oid": "2a1686ba007389aed54e477683b19bf90e87f23a", "url": "https://github.com/Azure/azure-sdk-for-java/commit/2a1686ba007389aed54e477683b19bf90e87f23a", "message": "Updated ARM template parameters using variables", "committedDate": "2020-06-17T23:55:06Z", "type": "commit"}, {"oid": "e969ef189a70e3257bc754654992931ccfa70e16", "url": "https://github.com/Azure/azure-sdk-for-java/commit/e969ef189a70e3257bc754654992931ccfa70e16", "message": "Trying default values", "committedDate": "2020-06-17T23:59:53Z", "type": "commit"}, {"oid": "0957b4c36dc4851e1687083b507c19f6d4dfab1d", "url": "https://github.com/Azure/azure-sdk-for-java/commit/0957b4c36dc4851e1687083b507c19f6d4dfab1d", "message": "Trying keys in quotes", "committedDate": "2020-06-18T00:29:21Z", "type": "commit"}, {"oid": "f7203a07173eb7132b7e03ab0538dae29fe5d46b", "url": "https://github.com/Azure/azure-sdk-for-java/commit/f7203a07173eb7132b7e03ab0538dae29fe5d46b", "message": "Removed enableMultipleWriteLocations parameter", "committedDate": "2020-06-18T00:35:05Z", "type": "commit"}, {"oid": "e45e03f23cd94fe5d8126476271d5b5fec3b77be", "url": "https://github.com/Azure/azure-sdk-for-java/commit/e45e03f23cd94fe5d8126476271d5b5fec3b77be", "message": "Completely removed enableMultipleWriteLocations", "committedDate": "2020-06-18T00:42:33Z", "type": "commit"}, {"oid": "86a2e0b301f224044ca4281aa37b1f09de017d08", "url": "https://github.com/Azure/azure-sdk-for-java/commit/86a2e0b301f224044ca4281aa37b1f09de017d08", "message": "Removed ArmTemplateParameters", "committedDate": "2020-06-18T00:46:40Z", "type": "commit"}, {"oid": "c4aa6f170e4501ad17717d56544429fbe2eee2e0", "url": "https://github.com/Azure/azure-sdk-for-java/commit/c4aa6f170e4501ad17717d56544429fbe2eee2e0", "message": "Added desired consistencies check", "committedDate": "2020-06-18T05:37:43Z", "type": "commit"}, {"oid": "121171dd30d32728936671f88259a8c7215fd07c", "url": "https://github.com/Azure/azure-sdk-for-java/commit/121171dd30d32728936671f88259a8c7215fd07c", "message": "Added enableMultipleWriteLocations for testing", "committedDate": "2020-06-18T15:47:42Z", "type": "commit"}, {"oid": "6f05872d988e33a446c34eb3ef8c0997881ea0e5", "url": "https://github.com/Azure/azure-sdk-for-java/commit/6f05872d988e33a446c34eb3ef8c0997881ea0e5", "message": "testing template rendering", "committedDate": "2020-06-18T17:21:55Z", "type": "commit"}, {"oid": "ca0a2e63016e4142d19c4d49188fb101b01d936c", "url": "https://github.com/Azure/azure-sdk-for-java/commit/ca0a2e63016e4142d19c4d49188fb101b01d936c", "message": "uncomment ArmTemplateParameters", "committedDate": "2020-06-18T17:22:38Z", "type": "commit"}, {"oid": "838c99bc50e9dfed12bd0e8583a8058d3685be80", "url": "https://github.com/Azure/azure-sdk-for-java/commit/838c99bc50e9dfed12bd0e8583a8058d3685be80", "message": "More variable source signifiers", "committedDate": "2020-06-18T17:25:34Z", "type": "commit"}, {"oid": "2f3e25a34a5b2ba103746a2a7796f19211ec4505", "url": "https://github.com/Azure/azure-sdk-for-java/commit/2f3e25a34a5b2ba103746a2a7796f19211ec4505", "message": "Use ArmTemplateParameters in deploy-test-resources.yml", "committedDate": "2020-06-18T20:48:34Z", "type": "commit"}, {"oid": "9d18a48f2fa799818dd59bf5552ddc7aae0f9ada", "url": "https://github.com/Azure/azure-sdk-for-java/commit/9d18a48f2fa799818dd59bf5552ddc7aae0f9ada", "message": "Revert \"More variable source signifiers\"\n\nThis reverts commit 838c99bc50e9dfed12bd0e8583a8058d3685be80.", "committedDate": "2020-06-18T20:48:54Z", "type": "commit"}, {"oid": "8b8afd5905a7389d6ed419cf7ffbf0d3df59ae16", "url": "https://github.com/Azure/azure-sdk-for-java/commit/8b8afd5905a7389d6ed419cf7ffbf0d3df59ae16", "message": "Revert \"testing template rendering\"\n\nThis reverts commit 6f05872d988e33a446c34eb3ef8c0997881ea0e5.", "committedDate": "2020-06-18T20:49:10Z", "type": "commit"}, {"oid": "4a24137e88c509424bb29574196d7cf525412733", "url": "https://github.com/Azure/azure-sdk-for-java/commit/4a24137e88c509424bb29574196d7cf525412733", "message": "Updated with ARM template parameters", "committedDate": "2020-06-18T21:16:12Z", "type": "commit"}, {"oid": "2235ed2279e4498ca3d407365d8c90002a59ff42", "url": "https://github.com/Azure/azure-sdk-for-java/commit/2235ed2279e4498ca3d407365d8c90002a59ff42", "message": "Declared arm template parameters", "committedDate": "2020-06-18T22:20:24Z", "type": "commit"}, {"oid": "6850148fcf0358d6c3e70d5c9bacade61026ef51", "url": "https://github.com/Azure/azure-sdk-for-java/commit/6850148fcf0358d6c3e70d5c9bacade61026ef51", "message": "Updated type for boolean values", "committedDate": "2020-06-18T22:44:22Z", "type": "commit"}, {"oid": "efbc8026f82b7dc3a88839d937c45468e4039e21", "url": "https://github.com/Azure/azure-sdk-for-java/commit/efbc8026f82b7dc3a88839d937c45468e4039e21", "message": "Enabling all CI through ARM templates", "committedDate": "2020-06-19T00:15:07Z", "type": "commit"}, {"oid": "563348566c59974b6beabf472cfd627a30a61b86", "url": "https://github.com/Azure/azure-sdk-for-java/commit/563348566c59974b6beabf472cfd627a30a61b86", "message": "Increasing timeout because of extra time in creating and deleting resources", "committedDate": "2020-06-19T15:57:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTcxNDE2MQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12301#discussion_r445714161", "bodyText": "we should think about the multi-region accounts CI, how can we achieve that. can we have multiple arm templates: one for single region account and one for multi region account or can we parametrized the locations array cardinality?", "author": "moderakh", "createdAt": "2020-06-25T17:15:46Z", "path": "sdk/cosmos/test-resources.json", "diffHunk": "@@ -0,0 +1,75 @@\n+{\n+  \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\n+  \"contentVersion\": \"1.0.0.0\",\n+  \"parameters\": {\n+    \"baseName\": {\n+      \"type\": \"string\"\n+    },\n+    \"enableMultipleWriteLocations\" : {\n+      \"type\": \"bool\",\n+      \"metadata\": {\n+        \"description\": \"Flag to enable or disable multiple write locations on CosmosDB Account\"\n+      }\n+    },\n+    \"defaultConsistencyLevel\": {\n+      \"type\": \"string\",\n+      \"metadata\": {\n+        \"description\": \"Default Cosmosdb Account level consistency\"\n+      }\n+    }\n+  },\n+  \"variables\": {\n+    \"apiVersion\": \"2020-04-01\",\n+    \"accountName\": \"[toLower(parameters('baseName'))]\",\n+    \"resourceId\": \"[resourceId('Microsoft.DocumentDB/databaseAccounts', variables('accountName'))]\"\n+  },\n+  \"resources\": [\n+    {\n+      \"type\": \"Microsoft.DocumentDB/databaseAccounts\",\n+      \"apiVersion\": \"[variables('apiVersion')]\",\n+      \"name\": \"[variables('accountName')]\",\n+      \"location\": \"[resourceGroup().location]\",\n+      \"kind\": \"GlobalDocumentDB\",\n+      \"properties\": {\n+        \"publicNetworkAccess\": \"Enabled\",\n+        \"enableAutomaticFailover\": false,\n+        \"enableMultipleWriteLocations\": \"[parameters('enableMultipleWriteLocations')]\",\n+        \"isVirtualNetworkFilterEnabled\": false,\n+        \"virtualNetworkRules\": [],\n+        \"disableKeyBasedMetadataWriteAccess\": false,\n+        \"enableFreeTier\": false,\n+        \"enableAnalyticalStorage\": false,\n+        \"databaseAccountOfferType\": \"Standard\",\n+        \"consistencyPolicy\": {\n+          \"defaultConsistencyLevel\": \"[parameters('defaultConsistencyLevel')]\",\n+          \"maxIntervalInSeconds\": 5,\n+          \"maxStalenessPrefix\": 100\n+        },\n+        \"locations\": [\n+          {\n+            \"locationName\": \"East US 2\",\n+            \"provisioningState\": \"Succeeded\",\n+            \"failoverPriority\": 0,\n+            \"isZoneRedundant\": false", "originalCommit": "563348566c59974b6beabf472cfd627a30a61b86", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTczMzEzMQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12301#discussion_r445733131", "bodyText": "Good point Mo, @danieljurek - is there a way we can support multiple test-resources.json files - one for all single-region accounts, and other one for all multi-region accounts ?", "author": "kushagraThapar", "createdAt": "2020-06-25T17:48:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTcxNDE2MQ=="}], "type": "inlineReview"}, {"oid": "0ccdf743695e5fda484dd5fd401118b3b7db7376", "url": "https://github.com/Azure/azure-sdk-for-java/commit/0ccdf743695e5fda484dd5fd401118b3b7db7376", "message": "Enable multiple region configuration with ARM templates", "committedDate": "2020-06-26T16:59:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMwMzM4NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12301#discussion_r446303384", "bodyText": "typo\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    \"description\": \"Enable multiple regions,d efault is false\"\n          \n          \n            \n                    \"description\": \"Enable multiple regions, default is false\"", "author": "moderakh", "createdAt": "2020-06-26T17:01:15Z", "path": "sdk/cosmos/test-resources.json", "diffHunk": "@@ -16,12 +16,42 @@\n       \"metadata\": {\n         \"description\": \"Default Cosmosdb Account level consistency\"\n       }\n+    },\n+    \"enableMultipleRegions\": {\n+      \"type\": \"bool\",\n+      \"metadata\": {\n+        \"description\": \"Enable multiple regions,d efault is false\"", "originalCommit": "0ccdf743695e5fda484dd5fd401118b3b7db7376", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMwNTIzNA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12301#discussion_r446305234", "bodyText": "@moderakh  - we are still experimenting with this feature.\nThis was just a quick commit I asked @danieljurek  to do so I can pick up the changes we talked about :)\nThis will all be fixed with better comments.", "author": "kushagraThapar", "createdAt": "2020-06-26T17:05:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMwMzM4NA=="}], "type": "inlineReview"}, {"oid": "808b1cc26de1c9cea1b0f32b5195e122b867ecbd", "url": "https://github.com/Azure/azure-sdk-for-java/commit/808b1cc26de1c9cea1b0f32b5195e122b867ecbd", "message": "Added multiple regions for multi-region account", "committedDate": "2020-06-26T17:40:09Z", "type": "commit"}]}