{"pr_number": 7146, "pr_title": "RJAVA-564: Use monorepo", "pr_createdAt": "2020-10-05T13:04:18Z", "pr_url": "https://github.com/realm/realm-java/pull/7146", "timeline": [{"oid": "66f1dbd62c365ee381a357f1ea2c6a67f2b32542", "url": "https://github.com/realm/realm-java/commit/66f1dbd62c365ee381a357f1ea2c6a67f2b32542", "message": "Use monorepo", "committedDate": "2020-10-05T13:02:40Z", "type": "commit"}, {"oid": "df6d9aa67453c0457e59d99bcee7207a9fda9ad9", "url": "https://github.com/realm/realm-java/commit/df6d9aa67453c0457e59d99bcee7207a9fda9ad9", "message": "Use newer CMake", "committedDate": "2020-10-05T13:17:01Z", "type": "commit"}, {"oid": "526ca4d878646aa94255d236a5cceea423f2629a", "url": "https://github.com/realm/realm-java/commit/526ca4d878646aa94255d236a5cceea423f2629a", "message": "use latest monorepo", "committedDate": "2020-10-08T10:15:39Z", "type": "commit"}, {"oid": "1cbf1222328fd3ebbdee71dfe85289fa4ee57829", "url": "https://github.com/realm/realm-java/commit/1cbf1222328fd3ebbdee71dfe85289fa4ee57829", "message": "Point to right cmake version\nJenkins to use right cmake version\nFix imports and executables linking", "committedDate": "2020-10-08T12:37:35Z", "type": "commit"}, {"oid": "4051a96d541a259657b1711fea4787881713cfa7", "url": "https://github.com/realm/realm-java/commit/4051a96d541a259657b1711fea4787881713cfa7", "message": "Fix cmake url", "committedDate": "2020-10-08T12:40:25Z", "type": "commit"}, {"oid": "500a052e926ee17119d12adca1a6a9dd43bf7570", "url": "https://github.com/realm/realm-java/commit/500a052e926ee17119d12adca1a6a9dd43bf7570", "message": "Add ninja-build package to docker image", "committedDate": "2020-10-08T12:51:01Z", "type": "commit"}, {"oid": "ea9d79a2f51885723507e1ded6ddbf8660ae1555", "url": "https://github.com/realm/realm-java/commit/ea9d79a2f51885723507e1ded6ddbf8660ae1555", "message": "Add new cmake instructions to readme", "committedDate": "2020-10-08T15:02:32Z", "type": "commit"}, {"oid": "c82847e3c4f51e01da745442892f897db25edfb6", "url": "https://github.com/realm/realm-java/commit/c82847e3c4f51e01da745442892f897db25edfb6", "message": "don\u2019t worry about realm-core\u2019s command-line targets", "committedDate": "2020-10-12T19:47:27Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzU5MzA1Mw==", "url": "https://github.com/realm/realm-java/pull/7146#discussion_r507593053", "bodyText": "@fealebenpae Any idea about a timeline when these are available?", "author": "cmelchior", "createdAt": "2020-10-19T09:12:44Z", "path": "realm/realm-library/src/main/cpp/CMakeLists.txt", "diffHunk": "@@ -131,32 +130,19 @@ create_javah(TARGET jni_headers\n     DEPENDS ${classes_PATH}\n )\n \n-include(RealmCore)\n-use_realm_core(${build_SYNC} \"${REALM_CORE_DIST_DIR}\" \"${CORE_SOURCE_PATH}\")\n-\n-# Download OpenSSL lib\n-# FIXME Read the openssl version from core when the core/sync release has that information.\n-set(openssl_VERSION \"1.1.1b\")\n-set(openssl_FILENAME \"openssl.tgz\")\n-set(openssl_URL \"https://static.realm.io/downloads/openssl/${openssl_VERSION}/Android/${ANDROID_ABI}/${openssl_FILENAME}\")\n-\n-message(STATUS \"Downloading OpenSSL...\")\n-file(DOWNLOAD \"${openssl_URL}\" \"${PROJECT_BINARY_DIR}/${openssl_FILENAME}\")\n-\n-message(STATUS \"Uncompressing OpenSSL: ${PROJECT_BINARY_DIR}/${openssl_FILENAME}\")\n-execute_process(COMMAND ${CMAKE_COMMAND} -E tar xfz \"${openssl_FILENAME}\" WORKING_DIRECTORY \"${PROJECT_BINARY_DIR}\")\n-message(STATUS \"Importing OpenSSL...\")\n-include(${PROJECT_BINARY_DIR}/lib/cmake/OpenSSL/OpenSSLConfig.cmake)\n-get_target_property(openssl_include_DIR OpenSSL::Crypto INTERFACE_INCLUDE_DIRECTORIES)\n-get_target_property(crypto_LIB OpenSSL::Crypto IMPORTED_LOCATION)\n-get_target_property(ssl_LIB OpenSSL::SSL IMPORTED_LOCATION)\n+option(REALM_JAVA_BUILD_CORE_FROM_SOURCE \"Build Realm Core from source, as opposed to downloading prebuilt binaries\" ON)\n+if(REALM_JAVA_BUILD_CORE_FROM_SOURCE)\n+    set(REALM_BUILD_LIB_ONLY ON)\n+    add_subdirectory(realm-core)\n+else()\n+    message(FATAL_ERROR \"TODO: Implement downloading monorepo release artifacts\")", "originalCommit": "c82847e3c4f51e01da745442892f897db25edfb6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzcxMTI1NQ==", "url": "https://github.com/realm/realm-java/pull/7146#discussion_r507711255", "bodyText": "I want to iron out all the kinks in the integration before I cut binary releases, so as soon as I've fixed the other issues (like the Mixed serialization above).", "author": "fealebenpae", "createdAt": "2020-10-19T12:37:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzU5MzA1Mw=="}], "type": "inlineReview"}, {"oid": "3521d39fc3a25a0adc11e33a35a7789fe7ab4b35", "url": "https://github.com/realm/realm-java/commit/3521d39fc3a25a0adc11e33a35a7789fe7ab4b35", "message": "use latest monorepo", "committedDate": "2020-10-19T13:03:23Z", "type": "commit"}, {"oid": "894f9d7e7b7a007d37d6aa36e29fcd300d7f6941", "url": "https://github.com/realm/realm-java/commit/894f9d7e7b7a007d37d6aa36e29fcd300d7f6941", "message": "Merge remote-tracking branch 'origin/master' into yg/monorepo-submodule\n\n# Conflicts:\n#\trealm/realm-library/src/main/cpp/object-store", "committedDate": "2020-10-19T14:04:39Z", "type": "commit"}, {"oid": "d2b36c0665b27b7a546e20877f88b92a9394ce6c", "url": "https://github.com/realm/realm-java/commit/d2b36c0665b27b7a546e20877f88b92a9394ce6c", "message": "Add support for LTO. It is enabled by default for release builds, but can be opted out of.", "committedDate": "2020-10-19T14:50:15Z", "type": "commit"}, {"oid": "2cc6fe7983735cbb9a92425fd9fae982f5dd0f6a", "url": "https://github.com/realm/realm-java/commit/2cc6fe7983735cbb9a92425fd9fae982f5dd0f6a", "message": "Merge branch 'yg/monorepo-submodule' of https://github.com/realm/realm-java into yg/monorepo-submodule", "committedDate": "2020-10-19T14:50:22Z", "type": "commit"}, {"oid": "8bb4771e159d1b4c21ded020a37c123e55b471de", "url": "https://github.com/realm/realm-java/commit/8bb4771e159d1b4c21ded020a37c123e55b471de", "message": "Rename abiFilter to indicate it support multiple flags", "committedDate": "2020-10-19T14:53:10Z", "type": "commit"}, {"oid": "f0af4cea4efd0b2d3ac2122ae3f3559c225f481f", "url": "https://github.com/realm/realm-java/commit/f0af4cea4efd0b2d3ac2122ae3f3559c225f481f", "message": "Set an optimization level, it is required when enabling LTO.", "committedDate": "2020-10-21T13:52:09Z", "type": "commit"}, {"oid": "bd14172c23ff3f7780f336d69bdc44d85347740e", "url": "https://github.com/realm/realm-java/commit/bd14172c23ff3f7780f336d69bdc44d85347740e", "message": "Bump core commit", "committedDate": "2020-10-21T13:54:03Z", "type": "commit"}, {"oid": "059fa64a0fd9118180ffc85e9249c20126ec58ae", "url": "https://github.com/realm/realm-java/commit/059fa64a0fd9118180ffc85e9249c20126ec58ae", "message": "Bump monorepo core version", "committedDate": "2020-11-02T11:28:26Z", "type": "commit"}, {"oid": "8399695b7f3d336daa62a4024fde2706e6f5d7f5", "url": "https://github.com/realm/realm-java/commit/8399695b7f3d336daa62a4024fde2706e6f5d7f5", "message": "Merge branch 'support-new-datatypes' into yg/monorepo-submodule\n\n# Conflicts:\n#\trealm/realm-library/src/main/cpp/io_realm_internal_objectstore_OsMongoClient.cpp\n#\trealm/realm-library/src/main/cpp/io_realm_internal_objectstore_OsMongoCollection.cpp\n#\trealm/realm-library/src/main/cpp/io_realm_internal_objectstore_OsMongoDatabase.cpp\n#\trealm/realm-library/src/main/cpp/io_realm_internal_objectstore_OsWatchStream.cpp\n#\trealm/realm-library/src/main/cpp/io_realm_mongodb_mongo_iterable_AggregateIterable.cpp\n#\trealm/realm-library/src/main/cpp/io_realm_mongodb_mongo_iterable_FindIterable.cpp\n#\trealm/realm-library/src/main/cpp/object-store", "committedDate": "2020-11-06T13:54:41Z", "type": "commit"}, {"oid": "f22b545199b82c61234a5d9b39c288f4fe0f66a7", "url": "https://github.com/realm/realm-java/commit/f22b545199b82c61234a5d9b39c288f4fe0f66a7", "message": "rollback mongodb realm server version", "committedDate": "2020-11-06T20:24:26Z", "type": "commit"}, {"oid": "b735438dd06a9efb5afdae57d974f15aaa633289", "url": "https://github.com/realm/realm-java/commit/b735438dd06a9efb5afdae57d974f15aaa633289", "message": "Fix checkstyle step in Jenkins file", "committedDate": "2020-11-09T09:08:48Z", "type": "commit"}, {"oid": "45735d502f2985428a5e1c0c0cafdf903faa1736", "url": "https://github.com/realm/realm-java/commit/45735d502f2985428a5e1c0c0cafdf903faa1736", "message": "remove the gradle logic to download core\n\nthis should be moved to CMake", "committedDate": "2020-11-09T10:43:34Z", "type": "commit"}]}