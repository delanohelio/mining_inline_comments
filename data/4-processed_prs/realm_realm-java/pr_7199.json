{"pr_number": 7199, "pr_title": "Realm CLI tool", "pr_createdAt": "2020-11-12T12:19:18Z", "pr_url": "https://github.com/realm/realm-java/pull/7199", "timeline": [{"oid": "e1b2369bee70bc2965355ce2fbdf82302dc4931b", "url": "https://github.com/realm/realm-java/commit/e1b2369bee70bc2965355ce2fbdf82302dc4931b", "message": "realm cli!", "committedDate": "2020-11-12T12:14:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjcwNDUzNw==", "url": "https://github.com/realm/realm-java/pull/7199#discussion_r522704537", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            esac\n          \n          \n            \n            esac", "author": "cmelchior", "createdAt": "2020-11-13T07:02:47Z", "path": "tools/realm-cli.sh", "diffHunk": "@@ -0,0 +1,185 @@\n+#!/bin/bash\n+\n+# This script provides a single entry point to the different tools used during the\n+# realm-java development. \n+#\n+# It needs REALM_JAVA_PATH to be set to the realm-java repository path.\n+# \n+# Create an alias for convenient access, for example in .zshrc:\n+# alias realm=\"~/realm-java/tools/realm-cli.sh\"\n+\n+\n+is_server_active(){\n+    return `docker container ls | grep -Fq mongodb-realm`\n+}\n+\n+start_server(){\n+    if is_server_active\n+    then\n+        echo \"Warning: Sync server already runnning\"\n+    else\n+        echo -n \"Starting sync server...\"\n+        $REALM_JAVA_PATH/tools/sync_test_server/start_server.sh > /dev/null 2>&1\n+        echo \" done\"\n+    fi\n+}\n+\n+stop_server(){\n+    if is_server_active\n+    then\n+        echo -n \"Stopping sync server...\"\n+        $REALM_JAVA_PATH/tools/sync_test_server/stop_server.sh > /dev/null 2>&1\n+        echo \" done\"\n+    else\n+        echo \"Warning: Sync server not running\"\n+    fi\n+}\n+\n+restart_server(){\n+    if is_server_active\n+    then\n+        stop_server\n+        start_server\n+    else\n+        echo \"Warning: Sync server wasn't running\"\n+        start_server\n+    fi\n+}\n+\n+server_status(){\n+    if is_server_active\n+    then\n+        echo \"Sync server: ON\"\n+    else\n+        echo \"Sync server: OFF\"\n+    fi\n+}\n+\n+bind_server(){\n+    echo -n \"Forwarding ports... \"\n+    adb reverse tcp:9443 tcp:9443 && \\\n+    adb reverse tcp:9080 tcp:9080 && \\\n+    adb reverse tcp:9090 tcp:9090 && \\\n+    adb reverse tcp:8888 tcp:8888 && \\\n+    echo \"done\" || { echo \"failed\" ; exit 1 ; }\n+}\n+\n+server_help(){\n+    echo \"Try with:\n+\n+start   - starts the sync server\n+stop    - stops the sync server\n+restart - restarts the sync server\n+status  - shows the sync server status\n+bind    - bind the emulator ports to the sync server\"\n+}\n+\n+server(){\n+    action=$2\n+    case $action in\n+        start)\n+            start_server\n+            ;;\n+        stop)\n+            stop_server\n+            ;;\n+        restart)\n+            restart_server\n+            ;;\n+        status)\n+            server_status\n+            ;;\n+        bind)\n+            bind_server\n+            ;;\n+        *)\n+            server_help\n+    esac\n+}\n+\n+java_install(){\n+    pushd $REALM_JAVA_PATH\n+    ./gradlew installRealmJava\n+    popd\n+}\n+\n+java_build(){\n+    pushd $REALM_JAVA_PATH\n+    ./gradlew assemble --stacktrace\n+    popd\n+}\n+\n+java_test(){\n+    pushd $REALM_JAVA_PATH/realm\n+    ./gradlew connectedObjectServerDebugAndroidTest --stacktrace\n+    popd\n+}\n+\n+java_check(){\n+    pushd $REALM_JAVA_PATH/realm\n+    ./gradlew spotbugsMain pmd checkstyle\n+    popd\n+}\n+\n+java_clean(){\n+    pushd $REALM_JAVA_PATH\n+    ./gradlew clean\n+    popd\n+}\n+\n+java_help(){\n+    echo \"Try with:\n+\n+install - install realm-java locally\n+build   - builds realm-java\n+test    - runs the realm-java test suite\n+check   - runs realm-java spotbugs, checkstyle, pmd\n+clean   - cleans realm-java\"\n+}\n+\n+java(){\n+    action=$2\n+    case $action in\n+        install)\n+            java_install\n+            ;;\n+        build)\n+            java_build\n+            ;;\n+        test)\n+            java_test\n+            ;;\n+        check)\n+            java_check\n+            ;;\n+        clean)\n+            java_clean\n+            ;;\n+        *)\n+            java_help\n+    esac\n+}\n+\n+show_help(){\n+    echo \"Try with:\n+\n+server - controls the sync server\n+java    - executes realm-java actions\"\n+}\n+\n+if ! [[ -n \"${REALM_JAVA_PATH}\" ]]; then\n+    echo \"Error: \\$REALM_JAVA_PATH not defined.\"\n+    exit 1\n+fi\n+\n+command=$1\n+case $command in\n+    server)\n+    server $*\n+    ;;\n+    java)\n+    java $*\n+    ;;\n+    *)\n+    show_help\n+esac", "originalCommit": "e1b2369bee70bc2965355ce2fbdf82302dc4931b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "86328871c1dbd5df589cced0e5d77ad9740466b1", "url": "https://github.com/realm/realm-java/commit/86328871c1dbd5df589cced0e5d77ad9740466b1", "message": "Update tools/realm-cli.sh\n\nCo-authored-by: Christian Melchior <christian@ilios.dk>", "committedDate": "2020-11-13T07:50:58Z", "type": "commit"}]}