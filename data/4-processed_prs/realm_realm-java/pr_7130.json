{"pr_number": 7130, "pr_title": "Fixed race condition in toFlow_multipleSubscribers test", "pr_createdAt": "2020-09-29T11:51:08Z", "pr_url": "https://github.com/realm/realm-java/pull/7130", "timeline": [{"oid": "d74444222bb238dbf4267da6e9c9d382f0c7ff09", "url": "https://github.com/realm/realm-java/commit/d74444222bb238dbf4267da6e9c9d382f0c7ff09", "message": "Fixed race condition while closing realm", "committedDate": "2020-09-29T11:49:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjY4OTU1Mg==", "url": "https://github.com/realm/realm-java/pull/7130#discussion_r496689552", "bodyText": "Calling countDown() as the first thing could lead to finishing the test before properly closing the Realm.", "author": "edualonso", "createdAt": "2020-09-29T12:50:25Z", "path": "realm/kotlin-extensions/src/androidTest/kotlin/io/realm/CoroutineTests.kt", "diffHunk": "@@ -207,10 +207,11 @@ class CoroutineTests {\n                         assertTrue(flowResults.isFrozen)\n                         assertEquals(0, flowResults.size)\n                     }.onCompletion {\n-                        countDownLatch.countDown()\n-\n-                        if (countDownLatch.count == 0L && !realmInstance.isClosed) {\n+                        if (countDownLatch.count > 1) {", "originalCommit": "d74444222bb238dbf4267da6e9c9d382f0c7ff09", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzI1NTU5Mw==", "url": "https://github.com/realm/realm-java/pull/7130#discussion_r497255593", "bodyText": "Having the !realmInstance.isClosed() check doesn't seem needed?", "author": "cmelchior", "createdAt": "2020-09-30T05:45:08Z", "path": "realm/kotlin-extensions/src/androidTest/kotlin/io/realm/CoroutineTests.kt", "diffHunk": "@@ -207,10 +207,11 @@ class CoroutineTests {\n                         assertTrue(flowResults.isFrozen)\n                         assertEquals(0, flowResults.size)\n                     }.onCompletion {\n-                        countDownLatch.countDown()\n-\n-                        if (countDownLatch.count == 0L && !realmInstance.isClosed) {\n+                        if (countDownLatch.count > 1) {\n+                            countDownLatch.countDown()\n+                        } else if (!realmInstance.isClosed) {", "originalCommit": "d74444222bb238dbf4267da6e9c9d382f0c7ff09", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "574512bdb139c9b6615584d416dffcd0e06b23e7", "url": "https://github.com/realm/realm-java/commit/574512bdb139c9b6615584d416dffcd0e06b23e7", "message": "Remove leftover check", "committedDate": "2020-09-30T07:42:22Z", "type": "commit"}]}