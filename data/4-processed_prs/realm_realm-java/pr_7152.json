{"pr_number": 7152, "pr_title": "Add support for UUID type", "pr_createdAt": "2020-10-09T08:23:10Z", "pr_url": "https://github.com/realm/realm-java/pull/7152", "timeline": [{"oid": "a1e64879cc141305626f828990b781bb17d5a6b7", "url": "https://github.com/realm/realm-java/commit/a1e64879cc141305626f828990b781bb17d5a6b7", "message": "Initial work: UUID java support and test cases", "committedDate": "2020-09-28T10:37:15Z", "type": "commit"}, {"oid": "66f1dbd62c365ee381a357f1ea2c6a67f2b32542", "url": "https://github.com/realm/realm-java/commit/66f1dbd62c365ee381a357f1ea2c6a67f2b32542", "message": "Use monorepo", "committedDate": "2020-10-05T13:02:40Z", "type": "commit"}, {"oid": "df6d9aa67453c0457e59d99bcee7207a9fda9ad9", "url": "https://github.com/realm/realm-java/commit/df6d9aa67453c0457e59d99bcee7207a9fda9ad9", "message": "Use newer CMake", "committedDate": "2020-10-05T13:17:01Z", "type": "commit"}, {"oid": "526ca4d878646aa94255d236a5cceea423f2629a", "url": "https://github.com/realm/realm-java/commit/526ca4d878646aa94255d236a5cceea423f2629a", "message": "use latest monorepo", "committedDate": "2020-10-08T10:15:39Z", "type": "commit"}, {"oid": "1cbf1222328fd3ebbdee71dfe85289fa4ee57829", "url": "https://github.com/realm/realm-java/commit/1cbf1222328fd3ebbdee71dfe85289fa4ee57829", "message": "Point to right cmake version\nJenkins to use right cmake version\nFix imports and executables linking", "committedDate": "2020-10-08T12:37:35Z", "type": "commit"}, {"oid": "4051a96d541a259657b1711fea4787881713cfa7", "url": "https://github.com/realm/realm-java/commit/4051a96d541a259657b1711fea4787881713cfa7", "message": "Fix cmake url", "committedDate": "2020-10-08T12:40:25Z", "type": "commit"}, {"oid": "500a052e926ee17119d12adca1a6a9dd43bf7570", "url": "https://github.com/realm/realm-java/commit/500a052e926ee17119d12adca1a6a9dd43bf7570", "message": "Add ninja-build package to docker image", "committedDate": "2020-10-08T12:51:01Z", "type": "commit"}, {"oid": "ea9d79a2f51885723507e1ded6ddbf8660ae1555", "url": "https://github.com/realm/realm-java/commit/ea9d79a2f51885723507e1ded6ddbf8660ae1555", "message": "Add new cmake instructions to readme", "committedDate": "2020-10-08T15:02:32Z", "type": "commit"}, {"oid": "43c948c9744d3473fa680b55db86a159ef0eb6a8", "url": "https://github.com/realm/realm-java/commit/43c948c9744d3473fa680b55db86a159ef0eb6a8", "message": "Add bindings for realm-core UUID and missing test cases.", "committedDate": "2020-10-09T08:00:59Z", "type": "commit"}, {"oid": "4155188f32342af59a9d38962f49a11a175444e4", "url": "https://github.com/realm/realm-java/commit/4155188f32342af59a9d38962f49a11a175444e4", "message": "Add UUID realm results tests", "committedDate": "2020-10-09T09:28:20Z", "type": "commit"}, {"oid": "c82847e3c4f51e01da745442892f897db25edfb6", "url": "https://github.com/realm/realm-java/commit/c82847e3c4f51e01da745442892f897db25edfb6", "message": "don\u2019t worry about realm-core\u2019s command-line targets", "committedDate": "2020-10-12T19:47:27Z", "type": "commit"}, {"oid": "3521d39fc3a25a0adc11e33a35a7789fe7ab4b35", "url": "https://github.com/realm/realm-java/commit/3521d39fc3a25a0adc11e33a35a7789fe7ab4b35", "message": "use latest monorepo", "committedDate": "2020-10-19T13:03:23Z", "type": "commit"}, {"oid": "894f9d7e7b7a007d37d6aa36e29fcd300d7f6941", "url": "https://github.com/realm/realm-java/commit/894f9d7e7b7a007d37d6aa36e29fcd300d7f6941", "message": "Merge remote-tracking branch 'origin/master' into yg/monorepo-submodule\n\n# Conflicts:\n#\trealm/realm-library/src/main/cpp/object-store", "committedDate": "2020-10-19T14:04:39Z", "type": "commit"}, {"oid": "d2b36c0665b27b7a546e20877f88b92a9394ce6c", "url": "https://github.com/realm/realm-java/commit/d2b36c0665b27b7a546e20877f88b92a9394ce6c", "message": "Add support for LTO. It is enabled by default for release builds, but can be opted out of.", "committedDate": "2020-10-19T14:50:15Z", "type": "commit"}, {"oid": "2cc6fe7983735cbb9a92425fd9fae982f5dd0f6a", "url": "https://github.com/realm/realm-java/commit/2cc6fe7983735cbb9a92425fd9fae982f5dd0f6a", "message": "Merge branch 'yg/monorepo-submodule' of https://github.com/realm/realm-java into yg/monorepo-submodule", "committedDate": "2020-10-19T14:50:22Z", "type": "commit"}, {"oid": "8bb4771e159d1b4c21ded020a37c123e55b471de", "url": "https://github.com/realm/realm-java/commit/8bb4771e159d1b4c21ded020a37c123e55b471de", "message": "Rename abiFilter to indicate it support multiple flags", "committedDate": "2020-10-19T14:53:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODI2ODc5MA==", "url": "https://github.com/realm/realm-java/pull/7152#discussion_r508268790", "bodyText": "Generally we try to mimic the control flow of the emitted code. So since this is inside an if statement, it should be indented one more level. While at first it looks a bit odd, it actually makes it a lot easier to understand the structure of the code being emitted.", "author": "cmelchior", "createdAt": "2020-10-20T07:27:20Z", "path": "realm/realm-annotations-processor/src/main/java/io/realm/processor/RealmProxyClassGenerator.kt", "diffHunk": "@@ -853,6 +858,14 @@ class RealmProxyClassGenerator(private val processingEnvironment: ProcessingEnvi\n                                 nextControlFlow(\"else\")\n                                 emitStatement(\"objKey = table.findFirstObjectId(pkColumnKey, value)\")\n                                 endControlFlow()\n+                            } else if (Utils.isUUID(primaryKeyElement)) {\n+                                emitStatement(\"java.util.UUID value = ((%s) object).%s()\", interfaceName, primaryKeyGetter)\n+                                emitStatement(\"long objKey = Table.NO_MATCH\")\n+                                beginControlFlow(\"if (value == null)\")\n+                                emitStatement(\"objKey = table.findFirstNull(pkColumnKey)\")", "originalCommit": "4155188f32342af59a9d38962f49a11a175444e4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODQwODYyNw==", "url": "https://github.com/realm/realm-java/pull/7152#discussion_r508408627", "bodyText": "Makes sense \ud83d\udc4d", "author": "clementetb", "createdAt": "2020-10-20T11:02:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODI2ODc5MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODI2ODk5OQ==", "url": "https://github.com/realm/realm-java/pull/7152#discussion_r508268999", "bodyText": "Same as above. Also a few cases below", "author": "cmelchior", "createdAt": "2020-10-20T07:27:40Z", "path": "realm/realm-annotations-processor/src/main/java/io/realm/processor/RealmProxyClassGenerator.kt", "diffHunk": "@@ -1017,6 +1030,16 @@ class RealmProxyClassGenerator(private val processingEnvironment: ProcessingEnvi\n                     }\n                     endControlFlow()\n                 }\n+                \"java.util.UUID\" -> {\n+                    emitStatement(\"java.util.UUID %s = ((%s) object).%s()\", getter, interfaceName, getter)\n+                    beginControlFlow(\"if (%s != null)\", getter)\n+                    emitStatement(\"Table.nativeSetUUID(tableNativePtr, columnInfo.%sColKey, objKey, %s.toString(), false)\", fieldName, getter)", "originalCommit": "4155188f32342af59a9d38962f49a11a175444e4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODI3MTM2NQ==", "url": "https://github.com/realm/realm-java/pull/7152#discussion_r508271365", "bodyText": "Primitive lists have been implemented. We should probably track fixing these unit tests through a separate issue.", "author": "cmelchior", "createdAt": "2020-10-20T07:31:35Z", "path": "realm/realm-library/src/androidTest/java/io/realm/LinkingObjectsDynamicTests.java", "diffHunk": "@@ -253,6 +256,11 @@ public void linkingObjects_invalidFieldType() {\n                         //object.linkingObjects(AllJavaTypes.CLASS_NAME, AllJavaTypes.FIELD_DOUBLE_LIST);\n                         //break;\n                         throw new IllegalArgumentException(\"Unexpected field type\");\n+                    case UUID_LIST:\n+                        // FIXME enable this once Primitive List is implemented", "originalCommit": "4155188f32342af59a9d38962f49a11a175444e4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODQwOTIwNg==", "url": "https://github.com/realm/realm-java/pull/7152#discussion_r508409206", "bodyText": "Have created this PR: #7160 with the tests.", "author": "clementetb", "createdAt": "2020-10-20T11:03:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODI3MTM2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODI3MjgyNw==", "url": "https://github.com/realm/realm-java/pull/7152#discussion_r508272827", "bodyText": "Any reason you are not using UUID directly here. There are a a lot of UUID.fromString(...) calls below that could be removed by doing that instead?", "author": "cmelchior", "createdAt": "2020-10-20T07:34:06Z", "path": "realm/realm-library/src/androidTest/java/io/realm/RealmResultsTests.java", "diffHunk": "@@ -84,6 +85,9 @@\n     private Realm realm;\n     private RealmResults<AllTypes> collection;\n \n+    private static final String uuid1 = \"017ba5ca-aa12-4afa-9219-e20cc3018599\";", "originalCommit": "4155188f32342af59a9d38962f49a11a175444e4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODQyNjYwOA==", "url": "https://github.com/realm/realm-java/pull/7152#discussion_r508426608", "bodyText": "I thought to force use different object instances during the validation to simulate what would be a real scenario, where you store one instance and then you compare with another.", "author": "clementetb", "createdAt": "2020-10-20T11:34:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODI3MjgyNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODI5MDQ5OQ==", "url": "https://github.com/realm/realm-java/pull/7152#discussion_r508290499", "bodyText": "I don't think you need the @field: prefix anymore?", "author": "cmelchior", "createdAt": "2020-10-20T08:02:11Z", "path": "realm/realm-library/src/androidTest/kotlin/io/realm/UUIDTests.kt", "diffHunk": "@@ -0,0 +1,435 @@\n+/*\n+ * Copyright 2020 Realm Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.realm\n+\n+import androidx.test.ext.junit.runners.AndroidJUnit4\n+import androidx.test.platform.app.InstrumentationRegistry\n+import io.realm.annotations.PrimaryKey\n+import io.realm.annotations.Required\n+import io.realm.exceptions.RealmException\n+import io.realm.exceptions.RealmPrimaryKeyConstraintException\n+import io.realm.kotlin.createObject\n+import io.realm.kotlin.where\n+import org.junit.After\n+import org.junit.Assert.*\n+import org.junit.Before\n+import org.junit.Rule\n+import org.junit.Test\n+import org.junit.rules.TemporaryFolder\n+import org.junit.runner.RunWith\n+import java.util.*\n+\n+open class UUIDPrimaryKeyRequired\n+    : RealmObject() {\n+    @field:PrimaryKey", "originalCommit": "4155188f32342af59a9d38962f49a11a175444e4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODI5MTU3Mg==", "url": "https://github.com/realm/realm-java/pull/7152#discussion_r508291572", "bodyText": "Instead of this we have the TestRealmConfigurationFactory rule which makes it easier to create custom configurations that are cleaned up afterwards.", "author": "cmelchior", "createdAt": "2020-10-20T08:03:54Z", "path": "realm/realm-library/src/androidTest/kotlin/io/realm/UUIDTests.kt", "diffHunk": "@@ -0,0 +1,435 @@\n+/*\n+ * Copyright 2020 Realm Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.realm\n+\n+import androidx.test.ext.junit.runners.AndroidJUnit4\n+import androidx.test.platform.app.InstrumentationRegistry\n+import io.realm.annotations.PrimaryKey\n+import io.realm.annotations.Required\n+import io.realm.exceptions.RealmException\n+import io.realm.exceptions.RealmPrimaryKeyConstraintException\n+import io.realm.kotlin.createObject\n+import io.realm.kotlin.where\n+import org.junit.After\n+import org.junit.Assert.*\n+import org.junit.Before\n+import org.junit.Rule\n+import org.junit.Test\n+import org.junit.rules.TemporaryFolder\n+import org.junit.runner.RunWith\n+import java.util.*\n+\n+open class UUIDPrimaryKeyRequired\n+    : RealmObject() {\n+    @field:PrimaryKey\n+    @field:Required\n+    var id: UUID? = null\n+    var name: String = \"\"\n+    var anotherId: UUID? = null\n+}\n+\n+open class UUIDPrimaryKeyNotRequired\n+    : RealmObject() {\n+    @field:PrimaryKey\n+    var id: UUID? = null\n+    var name: String = \"\"\n+\n+}\n+\n+open class UUIDAndString\n+    : RealmObject() {\n+    var id: UUID? = null\n+    var name: String = \"\"\n+}\n+\n+open class UUIDRequiredRealmList\n+    : RealmObject() {\n+    var id: Long = 0\n+\n+    @field:Required\n+    var ids: RealmList<UUID> = RealmList()\n+    var name: String = \"\"\n+}\n+\n+open class UUIDOptionalRealmList\n+    : RealmObject() {\n+    var id: Long = 0\n+\n+    var ids: RealmList<UUID> = RealmList()\n+    var name: String = \"\"\n+}\n+\n+@RunWith(AndroidJUnit4::class)\n+class UUIDTests {\n+    private lateinit var realmConfiguration: RealmConfiguration\n+    private lateinit var realm: Realm\n+\n+    @Rule\n+    @JvmField\n+    val folder = TemporaryFolder()", "originalCommit": "4155188f32342af59a9d38962f49a11a175444e4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODI5MzIzMQ==", "url": "https://github.com/realm/realm-java/pull/7152#discussion_r508293231", "bodyText": "We have assertFailsWith<RealmException> { ... } making it a lot easier to use this pattern.", "author": "cmelchior", "createdAt": "2020-10-20T08:06:35Z", "path": "realm/realm-library/src/androidTest/kotlin/io/realm/UUIDTests.kt", "diffHunk": "@@ -0,0 +1,435 @@\n+/*\n+ * Copyright 2020 Realm Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.realm\n+\n+import androidx.test.ext.junit.runners.AndroidJUnit4\n+import androidx.test.platform.app.InstrumentationRegistry\n+import io.realm.annotations.PrimaryKey\n+import io.realm.annotations.Required\n+import io.realm.exceptions.RealmException\n+import io.realm.exceptions.RealmPrimaryKeyConstraintException\n+import io.realm.kotlin.createObject\n+import io.realm.kotlin.where\n+import org.junit.After\n+import org.junit.Assert.*\n+import org.junit.Before\n+import org.junit.Rule\n+import org.junit.Test\n+import org.junit.rules.TemporaryFolder\n+import org.junit.runner.RunWith\n+import java.util.*\n+\n+open class UUIDPrimaryKeyRequired\n+    : RealmObject() {\n+    @field:PrimaryKey\n+    @field:Required\n+    var id: UUID? = null\n+    var name: String = \"\"\n+    var anotherId: UUID? = null\n+}\n+\n+open class UUIDPrimaryKeyNotRequired\n+    : RealmObject() {\n+    @field:PrimaryKey\n+    var id: UUID? = null\n+    var name: String = \"\"\n+\n+}\n+\n+open class UUIDAndString\n+    : RealmObject() {\n+    var id: UUID? = null\n+    var name: String = \"\"\n+}\n+\n+open class UUIDRequiredRealmList\n+    : RealmObject() {\n+    var id: Long = 0\n+\n+    @field:Required\n+    var ids: RealmList<UUID> = RealmList()\n+    var name: String = \"\"\n+}\n+\n+open class UUIDOptionalRealmList\n+    : RealmObject() {\n+    var id: Long = 0\n+\n+    var ids: RealmList<UUID> = RealmList()\n+    var name: String = \"\"\n+}\n+\n+@RunWith(AndroidJUnit4::class)\n+class UUIDTests {\n+    private lateinit var realmConfiguration: RealmConfiguration\n+    private lateinit var realm: Realm\n+\n+    @Rule\n+    @JvmField\n+    val folder = TemporaryFolder()\n+\n+    init {\n+        Realm.init(InstrumentationRegistry.getInstrumentation().targetContext)\n+    }\n+\n+    @Before\n+    fun setUp() {\n+        realmConfiguration = RealmConfiguration\n+                .Builder(InstrumentationRegistry.getInstrumentation().targetContext)\n+                .directory(folder.newFolder())\n+                .schema(UUIDPrimaryKeyRequired::class.java,\n+                        UUIDPrimaryKeyNotRequired::class.java,\n+                        UUIDAndString::class.java,\n+                        UUIDRequiredRealmList::class.java,\n+                        UUIDOptionalRealmList::class.java)\n+                .build()\n+        realm = Realm.getInstance(realmConfiguration)\n+    }\n+\n+    @After\n+    fun tearDown() {\n+        realm.close()\n+    }\n+\n+    @Test\n+    fun copyToAndFromRealm() {\n+        val uuid1 = UUID.randomUUID()\n+        val uuid2 = UUID.randomUUID()\n+        val uuid3 = UUID.randomUUID()\n+\n+        val value = UUIDPrimaryKeyRequired()\n+        value.id = uuid1\n+        value.anotherId = uuid2\n+        value.name = \"Foo\"\n+\n+        // copyToRealm\n+        realm.beginTransaction()\n+        val obj = realm.copyToRealm(value)\n+        realm.commitTransaction()\n+        assertEquals(uuid1, obj.id)\n+        assertEquals(uuid2, obj.anotherId)\n+        assertEquals(\"Foo\", obj.name)\n+\n+        // copyToRealmOrUpdate\n+        value.name = \"Bar\"\n+        value.anotherId = uuid3\n+        realm.beginTransaction()\n+        realm.copyToRealmOrUpdate(value)\n+        realm.commitTransaction()\n+\n+        // copyFromRealm\n+        val copy = realm.copyFromRealm(obj)\n+        assertEquals(uuid1, copy.id)\n+        assertEquals(uuid3, copy.anotherId)\n+        assertEquals(\"Bar\", copy.name)\n+    }\n+\n+    @Test\n+    fun insert() {\n+        val uuid1 = UUID.randomUUID()\n+        val uuid2 = UUID.randomUUID()\n+        val uuid3 = UUID.randomUUID()\n+\n+        val value = UUIDPrimaryKeyRequired()\n+        value.id = uuid1\n+        value.name = \"Foo\"\n+        value.anotherId = uuid2\n+\n+        // insert\n+        realm.beginTransaction()\n+        realm.insert(value)\n+        realm.commitTransaction()\n+\n+        val obj = realm.where<UUIDPrimaryKeyRequired>().findFirst()\n+        assertNotNull(obj)\n+        assertEquals(uuid1, obj!!.id)\n+        assertEquals(uuid2, obj.anotherId)\n+        assertEquals(\"Foo\", obj.name)\n+\n+        // insertOrUpdate\n+        realm.beginTransaction()\n+        obj.anotherId = uuid3\n+        obj.name = \"Bar\"\n+        realm.insertOrUpdate(obj)\n+        realm.commitTransaction()\n+\n+        val all = realm.where<UUIDPrimaryKeyRequired>().findAll()\n+        assertEquals(1, all.size)\n+        assertEquals(uuid1, all[0]!!.id)\n+        assertEquals(uuid3, all[0]!!.anotherId)\n+        assertEquals(\"Bar\", all[0]!!.name)\n+    }\n+\n+    @Test\n+    fun frozen() {\n+        val uuid1 = UUID.randomUUID()\n+\n+        realm.beginTransaction()\n+        val obj = realm.createObject<UUIDPrimaryKeyRequired>(uuid1)\n+        obj.name = \"foo\"\n+        realm.commitTransaction()\n+\n+        val frozen = obj.freeze<UUIDPrimaryKeyRequired>()\n+        assertEquals(uuid1, frozen.id)\n+        assertEquals(\"foo\", frozen.name)\n+    }\n+\n+    @Test\n+    fun requiredPK() {\n+        val uuid1 = UUID.randomUUID()\n+\n+        realm.beginTransaction()\n+        try {", "originalCommit": "4155188f32342af59a9d38962f49a11a175444e4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODI5NjAxOQ==", "url": "https://github.com/realm/realm-java/pull/7152#discussion_r508296019", "bodyText": "I would probably break the sections here into separate tests.", "author": "cmelchior", "createdAt": "2020-10-20T08:10:54Z", "path": "realm/realm-library/src/androidTest/kotlin/io/realm/UUIDTests.kt", "diffHunk": "@@ -0,0 +1,435 @@\n+/*\n+ * Copyright 2020 Realm Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.realm\n+\n+import androidx.test.ext.junit.runners.AndroidJUnit4\n+import androidx.test.platform.app.InstrumentationRegistry\n+import io.realm.annotations.PrimaryKey\n+import io.realm.annotations.Required\n+import io.realm.exceptions.RealmException\n+import io.realm.exceptions.RealmPrimaryKeyConstraintException\n+import io.realm.kotlin.createObject\n+import io.realm.kotlin.where\n+import org.junit.After\n+import org.junit.Assert.*\n+import org.junit.Before\n+import org.junit.Rule\n+import org.junit.Test\n+import org.junit.rules.TemporaryFolder\n+import org.junit.runner.RunWith\n+import java.util.*\n+\n+open class UUIDPrimaryKeyRequired\n+    : RealmObject() {\n+    @field:PrimaryKey\n+    @field:Required\n+    var id: UUID? = null\n+    var name: String = \"\"\n+    var anotherId: UUID? = null\n+}\n+\n+open class UUIDPrimaryKeyNotRequired\n+    : RealmObject() {\n+    @field:PrimaryKey\n+    var id: UUID? = null\n+    var name: String = \"\"\n+\n+}\n+\n+open class UUIDAndString\n+    : RealmObject() {\n+    var id: UUID? = null\n+    var name: String = \"\"\n+}\n+\n+open class UUIDRequiredRealmList\n+    : RealmObject() {\n+    var id: Long = 0\n+\n+    @field:Required\n+    var ids: RealmList<UUID> = RealmList()\n+    var name: String = \"\"\n+}\n+\n+open class UUIDOptionalRealmList\n+    : RealmObject() {\n+    var id: Long = 0\n+\n+    var ids: RealmList<UUID> = RealmList()\n+    var name: String = \"\"\n+}\n+\n+@RunWith(AndroidJUnit4::class)\n+class UUIDTests {\n+    private lateinit var realmConfiguration: RealmConfiguration\n+    private lateinit var realm: Realm\n+\n+    @Rule\n+    @JvmField\n+    val folder = TemporaryFolder()\n+\n+    init {\n+        Realm.init(InstrumentationRegistry.getInstrumentation().targetContext)\n+    }\n+\n+    @Before\n+    fun setUp() {\n+        realmConfiguration = RealmConfiguration\n+                .Builder(InstrumentationRegistry.getInstrumentation().targetContext)\n+                .directory(folder.newFolder())\n+                .schema(UUIDPrimaryKeyRequired::class.java,\n+                        UUIDPrimaryKeyNotRequired::class.java,\n+                        UUIDAndString::class.java,\n+                        UUIDRequiredRealmList::class.java,\n+                        UUIDOptionalRealmList::class.java)\n+                .build()\n+        realm = Realm.getInstance(realmConfiguration)\n+    }\n+\n+    @After\n+    fun tearDown() {\n+        realm.close()\n+    }\n+\n+    @Test\n+    fun copyToAndFromRealm() {", "originalCommit": "4155188f32342af59a9d38962f49a11a175444e4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODI5NjEwOA==", "url": "https://github.com/realm/realm-java/pull/7152#discussion_r508296108", "bodyText": "Same", "author": "cmelchior", "createdAt": "2020-10-20T08:11:01Z", "path": "realm/realm-library/src/androidTest/kotlin/io/realm/UUIDTests.kt", "diffHunk": "@@ -0,0 +1,435 @@\n+/*\n+ * Copyright 2020 Realm Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.realm\n+\n+import androidx.test.ext.junit.runners.AndroidJUnit4\n+import androidx.test.platform.app.InstrumentationRegistry\n+import io.realm.annotations.PrimaryKey\n+import io.realm.annotations.Required\n+import io.realm.exceptions.RealmException\n+import io.realm.exceptions.RealmPrimaryKeyConstraintException\n+import io.realm.kotlin.createObject\n+import io.realm.kotlin.where\n+import org.junit.After\n+import org.junit.Assert.*\n+import org.junit.Before\n+import org.junit.Rule\n+import org.junit.Test\n+import org.junit.rules.TemporaryFolder\n+import org.junit.runner.RunWith\n+import java.util.*\n+\n+open class UUIDPrimaryKeyRequired\n+    : RealmObject() {\n+    @field:PrimaryKey\n+    @field:Required\n+    var id: UUID? = null\n+    var name: String = \"\"\n+    var anotherId: UUID? = null\n+}\n+\n+open class UUIDPrimaryKeyNotRequired\n+    : RealmObject() {\n+    @field:PrimaryKey\n+    var id: UUID? = null\n+    var name: String = \"\"\n+\n+}\n+\n+open class UUIDAndString\n+    : RealmObject() {\n+    var id: UUID? = null\n+    var name: String = \"\"\n+}\n+\n+open class UUIDRequiredRealmList\n+    : RealmObject() {\n+    var id: Long = 0\n+\n+    @field:Required\n+    var ids: RealmList<UUID> = RealmList()\n+    var name: String = \"\"\n+}\n+\n+open class UUIDOptionalRealmList\n+    : RealmObject() {\n+    var id: Long = 0\n+\n+    var ids: RealmList<UUID> = RealmList()\n+    var name: String = \"\"\n+}\n+\n+@RunWith(AndroidJUnit4::class)\n+class UUIDTests {\n+    private lateinit var realmConfiguration: RealmConfiguration\n+    private lateinit var realm: Realm\n+\n+    @Rule\n+    @JvmField\n+    val folder = TemporaryFolder()\n+\n+    init {\n+        Realm.init(InstrumentationRegistry.getInstrumentation().targetContext)\n+    }\n+\n+    @Before\n+    fun setUp() {\n+        realmConfiguration = RealmConfiguration\n+                .Builder(InstrumentationRegistry.getInstrumentation().targetContext)\n+                .directory(folder.newFolder())\n+                .schema(UUIDPrimaryKeyRequired::class.java,\n+                        UUIDPrimaryKeyNotRequired::class.java,\n+                        UUIDAndString::class.java,\n+                        UUIDRequiredRealmList::class.java,\n+                        UUIDOptionalRealmList::class.java)\n+                .build()\n+        realm = Realm.getInstance(realmConfiguration)\n+    }\n+\n+    @After\n+    fun tearDown() {\n+        realm.close()\n+    }\n+\n+    @Test\n+    fun copyToAndFromRealm() {\n+        val uuid1 = UUID.randomUUID()\n+        val uuid2 = UUID.randomUUID()\n+        val uuid3 = UUID.randomUUID()\n+\n+        val value = UUIDPrimaryKeyRequired()\n+        value.id = uuid1\n+        value.anotherId = uuid2\n+        value.name = \"Foo\"\n+\n+        // copyToRealm\n+        realm.beginTransaction()\n+        val obj = realm.copyToRealm(value)\n+        realm.commitTransaction()\n+        assertEquals(uuid1, obj.id)\n+        assertEquals(uuid2, obj.anotherId)\n+        assertEquals(\"Foo\", obj.name)\n+\n+        // copyToRealmOrUpdate\n+        value.name = \"Bar\"\n+        value.anotherId = uuid3\n+        realm.beginTransaction()\n+        realm.copyToRealmOrUpdate(value)\n+        realm.commitTransaction()\n+\n+        // copyFromRealm\n+        val copy = realm.copyFromRealm(obj)\n+        assertEquals(uuid1, copy.id)\n+        assertEquals(uuid3, copy.anotherId)\n+        assertEquals(\"Bar\", copy.name)\n+    }\n+\n+    @Test\n+    fun insert() {", "originalCommit": "4155188f32342af59a9d38962f49a11a175444e4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODI5NjYwNQ==", "url": "https://github.com/realm/realm-java/pull/7152#discussion_r508296605", "bodyText": "Same. Each test should generally only test one aspect.", "author": "cmelchior", "createdAt": "2020-10-20T08:11:44Z", "path": "realm/realm-library/src/androidTest/kotlin/io/realm/UUIDTests.kt", "diffHunk": "@@ -0,0 +1,435 @@\n+/*\n+ * Copyright 2020 Realm Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.realm\n+\n+import androidx.test.ext.junit.runners.AndroidJUnit4\n+import androidx.test.platform.app.InstrumentationRegistry\n+import io.realm.annotations.PrimaryKey\n+import io.realm.annotations.Required\n+import io.realm.exceptions.RealmException\n+import io.realm.exceptions.RealmPrimaryKeyConstraintException\n+import io.realm.kotlin.createObject\n+import io.realm.kotlin.where\n+import org.junit.After\n+import org.junit.Assert.*\n+import org.junit.Before\n+import org.junit.Rule\n+import org.junit.Test\n+import org.junit.rules.TemporaryFolder\n+import org.junit.runner.RunWith\n+import java.util.*\n+\n+open class UUIDPrimaryKeyRequired\n+    : RealmObject() {\n+    @field:PrimaryKey\n+    @field:Required\n+    var id: UUID? = null\n+    var name: String = \"\"\n+    var anotherId: UUID? = null\n+}\n+\n+open class UUIDPrimaryKeyNotRequired\n+    : RealmObject() {\n+    @field:PrimaryKey\n+    var id: UUID? = null\n+    var name: String = \"\"\n+\n+}\n+\n+open class UUIDAndString\n+    : RealmObject() {\n+    var id: UUID? = null\n+    var name: String = \"\"\n+}\n+\n+open class UUIDRequiredRealmList\n+    : RealmObject() {\n+    var id: Long = 0\n+\n+    @field:Required\n+    var ids: RealmList<UUID> = RealmList()\n+    var name: String = \"\"\n+}\n+\n+open class UUIDOptionalRealmList\n+    : RealmObject() {\n+    var id: Long = 0\n+\n+    var ids: RealmList<UUID> = RealmList()\n+    var name: String = \"\"\n+}\n+\n+@RunWith(AndroidJUnit4::class)\n+class UUIDTests {\n+    private lateinit var realmConfiguration: RealmConfiguration\n+    private lateinit var realm: Realm\n+\n+    @Rule\n+    @JvmField\n+    val folder = TemporaryFolder()\n+\n+    init {\n+        Realm.init(InstrumentationRegistry.getInstrumentation().targetContext)\n+    }\n+\n+    @Before\n+    fun setUp() {\n+        realmConfiguration = RealmConfiguration\n+                .Builder(InstrumentationRegistry.getInstrumentation().targetContext)\n+                .directory(folder.newFolder())\n+                .schema(UUIDPrimaryKeyRequired::class.java,\n+                        UUIDPrimaryKeyNotRequired::class.java,\n+                        UUIDAndString::class.java,\n+                        UUIDRequiredRealmList::class.java,\n+                        UUIDOptionalRealmList::class.java)\n+                .build()\n+        realm = Realm.getInstance(realmConfiguration)\n+    }\n+\n+    @After\n+    fun tearDown() {\n+        realm.close()\n+    }\n+\n+    @Test\n+    fun copyToAndFromRealm() {\n+        val uuid1 = UUID.randomUUID()\n+        val uuid2 = UUID.randomUUID()\n+        val uuid3 = UUID.randomUUID()\n+\n+        val value = UUIDPrimaryKeyRequired()\n+        value.id = uuid1\n+        value.anotherId = uuid2\n+        value.name = \"Foo\"\n+\n+        // copyToRealm\n+        realm.beginTransaction()\n+        val obj = realm.copyToRealm(value)\n+        realm.commitTransaction()\n+        assertEquals(uuid1, obj.id)\n+        assertEquals(uuid2, obj.anotherId)\n+        assertEquals(\"Foo\", obj.name)\n+\n+        // copyToRealmOrUpdate\n+        value.name = \"Bar\"\n+        value.anotherId = uuid3\n+        realm.beginTransaction()\n+        realm.copyToRealmOrUpdate(value)\n+        realm.commitTransaction()\n+\n+        // copyFromRealm\n+        val copy = realm.copyFromRealm(obj)\n+        assertEquals(uuid1, copy.id)\n+        assertEquals(uuid3, copy.anotherId)\n+        assertEquals(\"Bar\", copy.name)\n+    }\n+\n+    @Test\n+    fun insert() {\n+        val uuid1 = UUID.randomUUID()\n+        val uuid2 = UUID.randomUUID()\n+        val uuid3 = UUID.randomUUID()\n+\n+        val value = UUIDPrimaryKeyRequired()\n+        value.id = uuid1\n+        value.name = \"Foo\"\n+        value.anotherId = uuid2\n+\n+        // insert\n+        realm.beginTransaction()\n+        realm.insert(value)\n+        realm.commitTransaction()\n+\n+        val obj = realm.where<UUIDPrimaryKeyRequired>().findFirst()\n+        assertNotNull(obj)\n+        assertEquals(uuid1, obj!!.id)\n+        assertEquals(uuid2, obj.anotherId)\n+        assertEquals(\"Foo\", obj.name)\n+\n+        // insertOrUpdate\n+        realm.beginTransaction()\n+        obj.anotherId = uuid3\n+        obj.name = \"Bar\"\n+        realm.insertOrUpdate(obj)\n+        realm.commitTransaction()\n+\n+        val all = realm.where<UUIDPrimaryKeyRequired>().findAll()\n+        assertEquals(1, all.size)\n+        assertEquals(uuid1, all[0]!!.id)\n+        assertEquals(uuid3, all[0]!!.anotherId)\n+        assertEquals(\"Bar\", all[0]!!.name)\n+    }\n+\n+    @Test\n+    fun frozen() {\n+        val uuid1 = UUID.randomUUID()\n+\n+        realm.beginTransaction()\n+        val obj = realm.createObject<UUIDPrimaryKeyRequired>(uuid1)\n+        obj.name = \"foo\"\n+        realm.commitTransaction()\n+\n+        val frozen = obj.freeze<UUIDPrimaryKeyRequired>()\n+        assertEquals(uuid1, frozen.id)\n+        assertEquals(\"foo\", frozen.name)\n+    }\n+\n+    @Test\n+    fun requiredPK() {\n+        val uuid1 = UUID.randomUUID()\n+\n+        realm.beginTransaction()\n+        try {\n+            realm.createObject<UUIDPrimaryKeyRequired>()\n+            fail()\n+        } catch (ignore: RealmException) {\n+        }\n+\n+        val obj = realm.createObject<UUIDPrimaryKeyRequired>(uuid1)\n+        obj.name = \"foo\"\n+\n+        realm.commitTransaction()\n+\n+        val result = realm.where<UUIDPrimaryKeyRequired>().equalTo(\"id\", uuid1).findFirst()\n+        assertNotNull(result)\n+        assertEquals(\"foo\", result?.name)\n+    }\n+\n+    @Test\n+    fun nullablePK() {\n+        try {\n+            realm.createObject<UUIDPrimaryKeyNotRequired>()\n+            fail()\n+        } catch (ignore: RealmException) {\n+        }\n+\n+        realm.beginTransaction()\n+        val obj = realm.createObject<UUIDPrimaryKeyNotRequired>(null)\n+        obj.name = \"foo\"\n+        realm.commitTransaction()\n+\n+        val result = realm.where<UUIDPrimaryKeyNotRequired>().equalTo(\"id\", null as UUID?).findFirst()\n+        assertNotNull(result)\n+        assertEquals(\"foo\", result!!.name)\n+    }\n+\n+\n+    @Test\n+    fun requiredRealmList() {\n+        realm.beginTransaction()\n+        val obj = realm.createObject<UUIDRequiredRealmList>()\n+        try {\n+            obj.ids.add(null)\n+            fail(\"It should not be possible to add nullable elements to a required RealmList<UUID>\")\n+        } catch (expected: Exception) {\n+        }\n+    }\n+\n+    @Test\n+    fun optionalRealmList() {\n+        val uuid1 = UUID.randomUUID()\n+\n+        realm.beginTransaction()\n+        val obj = realm.createObject<UUIDOptionalRealmList>()\n+        obj.ids.add(null)\n+        obj.ids.add(uuid1)\n+        realm.commitTransaction()\n+\n+        assertEquals(2, realm.where<UUIDOptionalRealmList>().findFirst()?.ids?.size)\n+    }\n+\n+    @Test\n+    fun linkQueryNotSupported() {\n+        val uuid1 = UUID.randomUUID()\n+\n+        try {\n+            realm.where<UUIDRequiredRealmList>().greaterThan(\"ids\", uuid1).findAll()\n+            fail(\"It should not be possible to perform link query on UUID\")\n+        } catch (expected: IllegalArgumentException) {\n+        }\n+\n+        realm.beginTransaction()\n+        val obj = realm.createObject<UUIDRequiredRealmList>()\n+        realm.cancelTransaction()\n+\n+        try {\n+            obj.ids.where().equalTo(\"ids\", uuid1).findAll()\n+        } catch (expected: UnsupportedOperationException) {\n+        }\n+    }\n+\n+    @Test\n+    fun duplicatePK() {\n+        val uuid1 = UUID.randomUUID()\n+\n+        realm.beginTransaction()\n+        realm.createObject<UUIDPrimaryKeyRequired>(uuid1)\n+        try {\n+            realm.createObject<UUIDPrimaryKeyRequired>(uuid1)\n+            fail(\"It should throw for duplicate PK usage\")\n+        } catch (expected: RealmPrimaryKeyConstraintException) {\n+        }\n+\n+        realm.cancelTransaction()\n+    }\n+\n+    @Test\n+    fun sort() {\n+        val uuid1 = UUID.fromString(\"017ba5ca-aa12-4afa-9219-e20cc3018599\")\n+        val uuid2 = UUID.fromString(\"027ba5ca-aa12-4afa-9219-e20cc3018599\")\n+        val uuid3 = UUID.fromString(\"037ba5ca-aa12-4afa-9219-e20cc3018599\")\n+\n+        realm.beginTransaction()\n+        realm.createObject<UUIDAndString>().id = uuid3\n+        realm.createObject<UUIDAndString>().id = uuid1\n+        realm.createObject<UUIDAndString>().id = uuid2\n+        realm.commitTransaction()\n+\n+        var all = realm.where<UUIDAndString>().sort(\"id\", Sort.ASCENDING).findAll()\n+        assertEquals(3, all.size)\n+        assertEquals(uuid1, all[0]!!.id)\n+        assertEquals(uuid2, all[1]!!.id)\n+        assertEquals(uuid3, all[2]!!.id)\n+\n+        all = realm.where<UUIDAndString>().sort(\"id\", Sort.DESCENDING).findAll()\n+        assertEquals(3, all.size)\n+        assertEquals(uuid3, all[0]!!.id)\n+        assertEquals(uuid2, all[1]!!.id)\n+        assertEquals(uuid1, all[2]!!.id)\n+    }\n+\n+    @Test\n+    fun distinct() {\n+        val uuid1 = UUID.fromString(\"017ba5ca-aa12-4afa-9219-e20cc3018599\")\n+        val uuid2 = UUID.fromString(\"027ba5ca-aa12-4afa-9219-e20cc3018599\")\n+        val uuid3 = UUID.fromString(\"037ba5ca-aa12-4afa-9219-e20cc3018599\")\n+\n+        realm.beginTransaction()\n+        realm.createObject<UUIDAndString>().id = uuid2\n+        realm.createObject<UUIDAndString>().id = uuid2\n+        realm.createObject<UUIDAndString>().id = null\n+        realm.createObject<UUIDAndString>().id = uuid1\n+        realm.createObject<UUIDAndString>().id = uuid1\n+        realm.createObject<UUIDAndString>().id = null\n+        realm.createObject<UUIDAndString>().id = uuid3\n+        realm.createObject<UUIDAndString>().id = uuid3\n+        realm.createObject<UUIDAndString>().id = null\n+        realm.commitTransaction()\n+\n+        val all = realm.where<UUIDAndString>().distinct(\"id\").sort(\"id\", Sort.ASCENDING).findAll()\n+        assertEquals(4, all.size)\n+        assertNull(all[0]!!.id)\n+        assertEquals(uuid1, all[1]!!.id)\n+        assertEquals(uuid2, all[2]!!.id)\n+        assertEquals(uuid3, all[3]!!.id)\n+\n+    }\n+\n+    @Test\n+    fun queries() {", "originalCommit": "4155188f32342af59a9d38962f49a11a175444e4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f0af4cea4efd0b2d3ac2122ae3f3559c225f481f", "url": "https://github.com/realm/realm-java/commit/f0af4cea4efd0b2d3ac2122ae3f3559c225f481f", "message": "Set an optimization level, it is required when enabling LTO.", "committedDate": "2020-10-21T13:52:09Z", "type": "commit"}, {"oid": "bd14172c23ff3f7780f336d69bdc44d85347740e", "url": "https://github.com/realm/realm-java/commit/bd14172c23ff3f7780f336d69bdc44d85347740e", "message": "Bump core commit", "committedDate": "2020-10-21T13:54:03Z", "type": "commit"}, {"oid": "099f3ff0d4c2cb8b65173419ae35721878071f1c", "url": "https://github.com/realm/realm-java/commit/099f3ff0d4c2cb8b65173419ae35721878071f1c", "message": "Merge branch 'yg/monorepo-submodule' into ct/support-uuid-type", "committedDate": "2020-10-21T13:56:24Z", "type": "commit"}, {"oid": "011c10ccdeffe7cfefd65867ab75d335a7a0b528", "url": "https://github.com/realm/realm-java/commit/011c10ccdeffe7cfefd65867ab75d335a7a0b528", "message": "PR ammends", "committedDate": "2020-10-21T14:09:20Z", "type": "commit"}, {"oid": "059fa64a0fd9118180ffc85e9249c20126ec58ae", "url": "https://github.com/realm/realm-java/commit/059fa64a0fd9118180ffc85e9249c20126ec58ae", "message": "Bump monorepo core version", "committedDate": "2020-11-02T11:28:26Z", "type": "commit"}, {"oid": "28e84ef57b7781694554099258cc1eabd519ed06", "url": "https://github.com/realm/realm-java/commit/28e84ef57b7781694554099258cc1eabd519ed06", "message": "Merge branch 'yg/monorepo-submodule' into ct/support-uuid-type", "committedDate": "2020-11-02T11:30:08Z", "type": "commit"}, {"oid": "73336ba9ab777450e2a207cc6fc280e47c81232b", "url": "https://github.com/realm/realm-java/commit/73336ba9ab777450e2a207cc6fc280e47c81232b", "message": "Fix test case", "committedDate": "2020-11-02T11:39:39Z", "type": "commit"}, {"oid": "8399695b7f3d336daa62a4024fde2706e6f5d7f5", "url": "https://github.com/realm/realm-java/commit/8399695b7f3d336daa62a4024fde2706e6f5d7f5", "message": "Merge branch 'support-new-datatypes' into yg/monorepo-submodule\n\n# Conflicts:\n#\trealm/realm-library/src/main/cpp/io_realm_internal_objectstore_OsMongoClient.cpp\n#\trealm/realm-library/src/main/cpp/io_realm_internal_objectstore_OsMongoCollection.cpp\n#\trealm/realm-library/src/main/cpp/io_realm_internal_objectstore_OsMongoDatabase.cpp\n#\trealm/realm-library/src/main/cpp/io_realm_internal_objectstore_OsWatchStream.cpp\n#\trealm/realm-library/src/main/cpp/io_realm_mongodb_mongo_iterable_AggregateIterable.cpp\n#\trealm/realm-library/src/main/cpp/io_realm_mongodb_mongo_iterable_FindIterable.cpp\n#\trealm/realm-library/src/main/cpp/object-store", "committedDate": "2020-11-06T13:54:41Z", "type": "commit"}, {"oid": "f22b545199b82c61234a5d9b39c288f4fe0f66a7", "url": "https://github.com/realm/realm-java/commit/f22b545199b82c61234a5d9b39c288f4fe0f66a7", "message": "rollback mongodb realm server version", "committedDate": "2020-11-06T20:24:26Z", "type": "commit"}, {"oid": "b735438dd06a9efb5afdae57d974f15aaa633289", "url": "https://github.com/realm/realm-java/commit/b735438dd06a9efb5afdae57d974f15aaa633289", "message": "Fix checkstyle step in Jenkins file", "committedDate": "2020-11-09T09:08:48Z", "type": "commit"}, {"oid": "c9dd682a3e64c25b74a94d29701b1dccf373e7b7", "url": "https://github.com/realm/realm-java/commit/c9dd682a3e64c25b74a94d29701b1dccf373e7b7", "message": "Merge branch 'yg/monorepo-submodule' into ct/support-uuid-type\n\n# Conflicts:\n#\trealm/realm-library/src/androidTest/java/io/realm/LinkingObjectsDynamicTests.java\n#\trealm/realm-library/src/androidTest/java/io/realm/QueryTests.java\n#\trealm/realm-library/src/androidTest/java/io/realm/RealmQueryTests.java\n#\trealm/realm-library/src/androidTest/java/io/realm/internal/QueryDescriptorTests.java", "committedDate": "2020-11-09T10:27:31Z", "type": "commit"}, {"oid": "cddbf3e4e69f807351cfe8891eaf865a766a6337", "url": "https://github.com/realm/realm-java/commit/cddbf3e4e69f807351cfe8891eaf865a766a6337", "message": "Update dynamic realm UUID tests", "committedDate": "2020-11-09T12:17:38Z", "type": "commit"}, {"oid": "39f1206c4f9128bc49e323bb5f75f494c3d0599f", "url": "https://github.com/realm/realm-java/commit/39f1206c4f9128bc49e323bb5f75f494c3d0599f", "message": "Merge branch 'support-new-datatypes' into ct/support-uuid-type", "committedDate": "2020-11-09T12:22:46Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTE3MTUxNw==", "url": "https://github.com/realm/realm-java/pull/7152#discussion_r521171517", "bodyText": "Are there test for imports through UUID?", "author": "rorbech", "createdAt": "2020-11-11T07:41:33Z", "path": "realm/realm-annotations-processor/src/test/resources/io/realm/some_test_AllTypesRealmProxy.java", "diffHunk": "@@ -1165,6 +1241,9 @@ public static String getSimpleClassName() {\n             if (json.has(\"columnObjectIdList\")) {\n                 excludeFields.add(\"columnObjectIdList\");\n             }\n+            if (json.has(\"columnUUIDList\")) {", "originalCommit": "39f1206c4f9128bc49e323bb5f75f494c3d0599f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTQ3MjU3Nw==", "url": "https://github.com/realm/realm-java/pull/7152#discussion_r521472577", "bodyText": "Good catch, I have added them now.", "author": "clementetb", "createdAt": "2020-11-11T16:18:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTE3MTUxNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTE3MTc2MQ==", "url": "https://github.com/realm/realm-java/pull/7152#discussion_r521171761", "bodyText": "This doesn't look righ. Empty block!?", "author": "rorbech", "createdAt": "2020-11-11T07:42:07Z", "path": "realm/realm-annotations-processor/src/test/resources/io/realm/some_test_AllTypesRealmProxy.java", "diffHunk": "@@ -1367,6 +1447,7 @@ public static String getSimpleClassName() {\n                 } else {\n                     objProxy.realmSet$columnObjectId(new org.bson.types.ObjectId(reader.nextString()));\n                 }\n+            } else if (name.equals(\"columnUUID\")) {", "originalCommit": "39f1206c4f9128bc49e323bb5f75f494c3d0599f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTQ3Mjk5Mg==", "url": "https://github.com/realm/realm-java/pull/7152#discussion_r521472992", "bodyText": "I didn't include a json conversor in the annotation processor. Now should be ok.", "author": "clementetb", "createdAt": "2020-11-11T16:19:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTE3MTc2MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTE3NTE2MQ==", "url": "https://github.com/realm/realm-java/pull/7152#discussion_r521175161", "bodyText": "Doesn't test that it is not equal. In populateTestRealm you could insert uuid if i%2==0 and otherwise insert a random one.", "author": "rorbech", "createdAt": "2020-11-11T07:50:03Z", "path": "realm/realm-library/src/androidTest/java/io/realm/RealmQueryTests.java", "diffHunk": "@@ -684,6 +688,15 @@ public void equalTo_objectId() {\n         }\n     }\n \n+    @Test", "originalCommit": "39f1206c4f9128bc49e323bb5f75f494c3d0599f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTQ3NDU3NQ==", "url": "https://github.com/realm/realm-java/pull/7152#discussion_r521474575", "bodyText": "Have included thenotequal test and the modified the equalto for UUID as well for the ObjectId and Decimal128.", "author": "clementetb", "createdAt": "2020-11-11T16:21:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTE3NTE2MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjA0NTg5Nw==", "url": "https://github.com/realm/realm-java/pull/7152#discussion_r522045897", "bodyText": "But without filtering some out you have not shown that equalTo actually discards non-equal entries (unless notEqual is implemented by the complement of equalTo)", "author": "rorbech", "createdAt": "2020-11-12T11:46:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTE3NTE2MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDg0OTY3MA==", "url": "https://github.com/realm/realm-java/pull/7152#discussion_r534849670", "bodyText": "Still does not show that equalsTo actually filter things out.", "author": "rorbech", "createdAt": "2020-12-03T07:54:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTE3NTE2MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzc4OTI0NA==", "url": "https://github.com/realm/realm-java/pull/7152#discussion_r537789244", "bodyText": "We do check the number of results for the given query. Do you have any suggestions?", "author": "clementetb", "createdAt": "2020-12-07T19:55:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTE3NTE2MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTE2NzY5OQ==", "url": "https://github.com/realm/realm-java/pull/7152#discussion_r521167699", "bodyText": "Is there a reason we don't use field: VariableElement and !! at the callsites? At least that would feel more idiomatic to me?", "author": "cmelchior", "createdAt": "2020-11-11T07:33:01Z", "path": "realm/realm-annotations-processor/src/main/java/io/realm/processor/Utils.kt", "diffHunk": "@@ -115,6 +106,17 @@ object Utils {\n         return getFieldTypeQualifiedName(field).toString() == \"org.bson.types.ObjectId\"\n     }\n \n+    /**\n+     * @return `true` if a field is of type \"java.util.UUID\", `false` otherwise.\n+     * @throws IllegalArgumentException if the field is `null`.\n+     */\n+    fun isUUID(field: VariableElement?): Boolean {", "originalCommit": "39f1206c4f9128bc49e323bb5f75f494c3d0599f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTk3MDM4Ng==", "url": "https://github.com/realm/realm-java/pull/7152#discussion_r521970386", "bodyText": "I followed what the other functions did to have common behavior.", "author": "clementetb", "createdAt": "2020-11-12T09:44:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTE2NzY5OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTE3Mjg1NA==", "url": "https://github.com/realm/realm-java/pull/7152#discussion_r521172854", "bodyText": "With all the tests in UUID tests, maybe remove this one? Also it doesn't really test equalTo, but sort.", "author": "cmelchior", "createdAt": "2020-11-11T07:44:42Z", "path": "realm/realm-library/src/androidTest/java/io/realm/RealmQueryTests.java", "diffHunk": "@@ -684,6 +688,15 @@ public void equalTo_objectId() {\n         }\n     }\n \n+    @Test\n+    public void equalTo_UUID() {", "originalCommit": "39f1206c4f9128bc49e323bb5f75f494c3d0599f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTQ3ODAzMg==", "url": "https://github.com/realm/realm-java/pull/7152#discussion_r521478032", "bodyText": "The test was based on the objectid's equalto. I have fixed them.\nHave added tests for notequal on UUID, objectid and decimal128 as well.", "author": "clementetb", "createdAt": "2020-11-11T16:26:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTE3Mjg1NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTIxODY2MA==", "url": "https://github.com/realm/realm-java/pull/7152#discussion_r521218660", "bodyText": "I think we can remove this FIXME.  Aggregate methods like average doesn't really make sense for UUID's.", "author": "cmelchior", "createdAt": "2020-11-11T09:14:58Z", "path": "realm/realm-library/src/androidTest/kotlin/io/realm/UUIDTests.kt", "diffHunk": "@@ -0,0 +1,590 @@\n+/*\n+ * Copyright 2020 Realm Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.realm\n+\n+import androidx.test.ext.junit.runners.AndroidJUnit4\n+import androidx.test.platform.app.InstrumentationRegistry\n+import io.realm.annotations.PrimaryKey\n+import io.realm.annotations.Required\n+import io.realm.exceptions.RealmException\n+import io.realm.exceptions.RealmPrimaryKeyConstraintException\n+import io.realm.kotlin.createObject\n+import io.realm.kotlin.where\n+import io.realm.rule.TestRealmConfigurationFactory\n+import org.junit.After\n+import org.junit.Assert.*\n+import org.junit.Before\n+import org.junit.Rule\n+import org.junit.Test\n+import org.junit.runner.RunWith\n+import java.util.*\n+import kotlin.test.assertFailsWith\n+\n+open class UUIDPrimaryKeyRequired\n+    : RealmObject() {\n+    @PrimaryKey\n+    @Required\n+    var id: UUID? = null\n+    var name: String = \"\"\n+    var anotherId: UUID? = null\n+}\n+\n+open class UUIDPrimaryKeyNotRequired\n+    : RealmObject() {\n+    @PrimaryKey\n+    var id: UUID? = null\n+    var name: String = \"\"\n+}\n+\n+open class UUIDAndString\n+    : RealmObject() {\n+    var id: UUID? = null\n+    var name: String = \"\"\n+}\n+\n+open class UUIDRequiredRealmList\n+    : RealmObject() {\n+    var id: Long = 0\n+\n+    @Required\n+    var ids: RealmList<UUID> = RealmList()\n+    var name: String = \"\"\n+}\n+\n+open class UUIDOptionalRealmList\n+    : RealmObject() {\n+    var id: Long = 0\n+\n+    var ids: RealmList<UUID> = RealmList()\n+    var name: String = \"\"\n+}\n+\n+@RunWith(AndroidJUnit4::class)\n+class UUIDTests {\n+    private lateinit var realmConfiguration: RealmConfiguration\n+    private lateinit var realm: Realm\n+\n+    @Rule\n+    @JvmField\n+    val configFactory = TestRealmConfigurationFactory()\n+\n+    init {\n+        Realm.init(InstrumentationRegistry.getInstrumentation().targetContext)\n+    }\n+\n+    @Before\n+    fun setUp() {\n+        realmConfiguration = configFactory\n+                .createConfigurationBuilder()\n+                .schema(UUIDPrimaryKeyRequired::class.java,\n+                        UUIDPrimaryKeyNotRequired::class.java,\n+                        UUIDAndString::class.java,\n+                        UUIDRequiredRealmList::class.java,\n+                        UUIDOptionalRealmList::class.java)\n+                .build()\n+\n+        realm = Realm.getInstance(realmConfiguration)\n+    }\n+\n+    @After\n+    fun tearDown() {\n+        realm.close()\n+    }\n+\n+    @Test\n+    fun copyToRealm() {\n+        val uuid1 = UUID.randomUUID()\n+        val uuid2 = UUID.randomUUID()\n+\n+        val value = UUIDPrimaryKeyRequired()\n+        value.id = uuid1\n+        value.anotherId = uuid2\n+        value.name = \"Foo\"\n+\n+        realm.beginTransaction()\n+        val obj = realm.copyToRealm(value)\n+        realm.commitTransaction()\n+\n+        assertEquals(uuid1, obj.id)\n+        assertEquals(uuid2, obj.anotherId)\n+        assertEquals(\"Foo\", obj.name)\n+    }\n+\n+    @Test\n+    fun copyFromRealm() {\n+        val uuid1 = UUID.randomUUID()\n+        val uuid2 = UUID.randomUUID()\n+\n+        realm.beginTransaction()\n+        val obj = realm.createObject<UUIDPrimaryKeyRequired>(uuid1)\n+        obj.anotherId = uuid2\n+        obj.name = \"Foo\"\n+        realm.commitTransaction()\n+\n+        val copy = realm.copyFromRealm(obj)\n+\n+        assertEquals(uuid1, copy.id)\n+        assertEquals(uuid2, copy.anotherId)\n+        assertEquals(\"Foo\", copy.name)\n+    }\n+\n+    @Test\n+    fun copyToRealmOrUpdate() {\n+        val uuid1 = UUID.randomUUID()\n+        val uuid2 = UUID.randomUUID()\n+        val uuid3 = UUID.randomUUID()\n+\n+        realm.executeTransaction { realm ->\n+            val obj = realm.createObject<UUIDPrimaryKeyRequired>(uuid1)\n+            obj.anotherId = uuid2\n+            obj.name = \"Foo\"\n+        }\n+\n+        val value = UUIDPrimaryKeyRequired()\n+        value.id = uuid1\n+        value.name = \"Bar\"\n+        value.anotherId = uuid3\n+\n+        realm.beginTransaction()\n+        val obj = realm.copyToRealmOrUpdate(value)\n+        realm.commitTransaction()\n+\n+        assertEquals(uuid1, obj.id)\n+        assertEquals(uuid3, obj.anotherId)\n+        assertEquals(\"Bar\", obj.name)\n+    }\n+\n+    @Test\n+    fun insert() {\n+        val uuid1 = UUID.randomUUID()\n+        val uuid2 = UUID.randomUUID()\n+\n+        realm.executeTransaction { realm ->\n+            val value = UUIDPrimaryKeyRequired()\n+            value.id = uuid1\n+            value.name = \"Foo\"\n+            value.anotherId = uuid2\n+\n+            realm.insert(value)\n+        }\n+\n+        val obj = realm.where<UUIDPrimaryKeyRequired>().findFirst()\n+\n+        assertNotNull(obj)\n+        assertEquals(uuid1, obj!!.id)\n+        assertEquals(uuid2, obj.anotherId)\n+        assertEquals(\"Foo\", obj.name)\n+    }\n+\n+    @Test\n+    fun insertOrUpdate() {\n+        val uuid1 = UUID.randomUUID()\n+        val uuid2 = UUID.randomUUID()\n+        val uuid3 = UUID.randomUUID()\n+\n+        realm.executeTransaction { realm ->\n+            val value = realm.createObject<UUIDPrimaryKeyRequired>(uuid1)\n+            value.name = \"Foo\"\n+            value.anotherId = uuid2\n+        }\n+\n+        realm.executeTransaction { realm ->\n+            val obj = UUIDPrimaryKeyRequired()\n+            obj.id = uuid1\n+            obj.anotherId = uuid3\n+            obj.name = \"Bar\"\n+            realm.insertOrUpdate(obj)\n+        }\n+\n+        val all = realm.where<UUIDPrimaryKeyRequired>().findAll()\n+\n+        assertEquals(1, all.size)\n+        assertEquals(uuid1, all[0]!!.id)\n+        assertEquals(uuid3, all[0]!!.anotherId)\n+        assertEquals(\"Bar\", all[0]!!.name)\n+    }\n+\n+    @Test\n+    fun frozen() {\n+        val uuid1 = UUID.randomUUID()\n+\n+        realm.beginTransaction()\n+        val obj = realm.createObject<UUIDPrimaryKeyRequired>(uuid1)\n+        obj.name = \"foo\"\n+        realm.commitTransaction()\n+\n+        val frozen = obj.freeze<UUIDPrimaryKeyRequired>()\n+        assertEquals(uuid1, frozen.id)\n+        assertEquals(\"foo\", frozen.name)\n+    }\n+\n+    @Test\n+    fun requiredPK() {\n+        val uuid1 = UUID.randomUUID()\n+\n+        realm.beginTransaction()\n+\n+        assertFailsWith<RealmException> {\n+            realm.createObject<UUIDPrimaryKeyRequired>()\n+        }\n+\n+        val obj = realm.createObject<UUIDPrimaryKeyRequired>(uuid1)\n+        obj.name = \"foo\"\n+\n+        realm.commitTransaction()\n+\n+        val result = realm.where<UUIDPrimaryKeyRequired>().equalTo(\"id\", uuid1).findFirst()\n+        assertNotNull(result)\n+        assertEquals(\"foo\", result?.name)\n+    }\n+\n+    @Test\n+    fun nullablePK() {\n+        assertFailsWith<RealmException> {\n+            realm.createObject<UUIDPrimaryKeyNotRequired>()\n+        }\n+\n+        realm.beginTransaction()\n+        val obj = realm.createObject<UUIDPrimaryKeyNotRequired>(null)\n+        obj.name = \"foo\"\n+        realm.commitTransaction()\n+\n+        val result = realm.where<UUIDPrimaryKeyNotRequired>().equalTo(\"id\", null as UUID?).findFirst()\n+        assertNotNull(result)\n+        assertEquals(\"foo\", result!!.name)\n+    }\n+\n+\n+    @Test\n+    fun requiredRealmList() {\n+        realm.beginTransaction()\n+        val obj = realm.createObject<UUIDRequiredRealmList>()\n+\n+        assertFailsWith<IllegalArgumentException>(\"It should not be possible to add nullable elements to a required RealmList<UUID>\") {\n+            obj.ids.add(null)\n+        }\n+    }\n+\n+    @Test\n+    fun optionalRealmList() {\n+        val uuid1 = UUID.randomUUID()\n+\n+        realm.beginTransaction()\n+        val obj = realm.createObject<UUIDOptionalRealmList>()\n+        obj.ids.add(null)\n+        obj.ids.add(uuid1)\n+        realm.commitTransaction()\n+\n+        assertEquals(2, realm.where<UUIDOptionalRealmList>().findFirst()?.ids?.size)\n+    }\n+\n+    @Test\n+    fun linkQueryNotSupported() {\n+        val uuid1 = UUID.randomUUID()\n+\n+        assertFailsWith<IllegalArgumentException>(\"It should not be possible to perform link query on UUID\") {\n+            realm.where<UUIDRequiredRealmList>().greaterThan(\"ids\", uuid1).findAll()\n+        }\n+\n+        realm.beginTransaction()\n+        val obj = realm.createObject<UUIDRequiredRealmList>()\n+        realm.cancelTransaction()\n+\n+        assertFailsWith<UnsupportedOperationException> {\n+            obj.ids.where().equalTo(\"ids\", uuid1).findAll()\n+        }\n+    }\n+\n+    @Test\n+    fun duplicatePK() {\n+        val uuid1 = UUID.randomUUID()\n+\n+        realm.beginTransaction()\n+        realm.createObject<UUIDPrimaryKeyRequired>(uuid1)\n+\n+        assertFailsWith<RealmPrimaryKeyConstraintException>(\"It should throw for duplicate PK usage\") {\n+            realm.createObject<UUIDPrimaryKeyRequired>(uuid1)\n+        }\n+\n+        realm.cancelTransaction()\n+    }\n+\n+    @Test\n+    fun sort() {\n+        val uuid1 = UUID.fromString(\"017ba5ca-aa12-4afa-9219-e20cc3018599\")\n+        val uuid2 = UUID.fromString(\"027ba5ca-aa12-4afa-9219-e20cc3018599\")\n+        val uuid3 = UUID.fromString(\"037ba5ca-aa12-4afa-9219-e20cc3018599\")\n+\n+        realm.beginTransaction()\n+        realm.createObject<UUIDAndString>().id = uuid3\n+        realm.createObject<UUIDAndString>().id = uuid1\n+        realm.createObject<UUIDAndString>().id = uuid2\n+        realm.commitTransaction()\n+\n+        var all = realm.where<UUIDAndString>().sort(\"id\", Sort.ASCENDING).findAll()\n+\n+        assertEquals(3, all.size)\n+        assertEquals(uuid1, all[0]!!.id)\n+        assertEquals(uuid2, all[1]!!.id)\n+        assertEquals(uuid3, all[2]!!.id)\n+\n+        all = realm.where<UUIDAndString>().sort(\"id\", Sort.DESCENDING).findAll()\n+\n+        assertEquals(3, all.size)\n+        assertEquals(uuid3, all[0]!!.id)\n+        assertEquals(uuid2, all[1]!!.id)\n+        assertEquals(uuid1, all[2]!!.id)\n+    }\n+\n+    @Test\n+    fun distinct() {\n+        val uuid1 = UUID.fromString(\"017ba5ca-aa12-4afa-9219-e20cc3018599\")\n+        val uuid2 = UUID.fromString(\"027ba5ca-aa12-4afa-9219-e20cc3018599\")\n+        val uuid3 = UUID.fromString(\"037ba5ca-aa12-4afa-9219-e20cc3018599\")\n+\n+        realm.beginTransaction()\n+        realm.createObject<UUIDAndString>().id = uuid2\n+        realm.createObject<UUIDAndString>().id = uuid2\n+        realm.createObject<UUIDAndString>().id = null\n+        realm.createObject<UUIDAndString>().id = uuid1\n+        realm.createObject<UUIDAndString>().id = uuid1\n+        realm.createObject<UUIDAndString>().id = null\n+        realm.createObject<UUIDAndString>().id = uuid3\n+        realm.createObject<UUIDAndString>().id = uuid3\n+        realm.createObject<UUIDAndString>().id = null\n+        realm.commitTransaction()\n+\n+        val all = realm.where<UUIDAndString>().distinct(\"id\").sort(\"id\", Sort.ASCENDING).findAll()\n+\n+        assertEquals(4, all.size)\n+        assertNull(all[0]!!.id)\n+        assertEquals(uuid1, all[1]!!.id)\n+        assertEquals(uuid2, all[2]!!.id)\n+        assertEquals(uuid3, all[3]!!.id)\n+\n+    }\n+\n+    @Test\n+    fun queries() {\n+        val uuid1 = UUID.randomUUID()\n+        val uuid2 = UUID.randomUUID()\n+        val uuid3 = UUID.randomUUID()\n+\n+        realm.executeTransaction { realm ->\n+            realm.createObject<UUIDAndString>().id = uuid2\n+            realm.createObject<UUIDAndString>().id = null\n+            realm.createObject<UUIDAndString>().id = uuid3\n+            realm.createObject<UUIDAndString>().id = uuid1\n+        }\n+\n+        assertEquals(4, realm.where<UUIDAndString>().count())\n+    }\n+\n+    @Test\n+    fun queriesNotEqualTo() {\n+        val uuid1 = UUID.fromString(\"017ba5ca-aa12-4afa-9219-e20cc3018599\")\n+        val uuid2 = UUID.fromString(\"027ba5ca-aa12-4afa-9219-e20cc3018599\")\n+        val uuid3 = UUID.fromString(\"037ba5ca-aa12-4afa-9219-e20cc3018599\")\n+\n+        realm.executeTransaction { realm ->\n+            realm.createObject<UUIDAndString>().id = uuid2\n+            realm.createObject<UUIDAndString>().id = null\n+            realm.createObject<UUIDAndString>().id = uuid3\n+            realm.createObject<UUIDAndString>().id = uuid1\n+        }\n+\n+        val all = realm.where<UUIDAndString>()\n+                .notEqualTo(\"id\", uuid2)\n+                .sort(\"id\", Sort.ASCENDING)\n+                .findAll()\n+\n+        assertEquals(3, all.size)\n+        assertNull(all[0]!!.id)\n+        assertEquals(uuid1, all[1]!!.id)\n+        assertEquals(uuid3, all[2]!!.id)\n+    }\n+\n+    @Test\n+    fun queriesGreaterThanOrEqualTo() {\n+        val uuid1 = UUID.fromString(\"017ba5ca-aa12-4afa-9219-e20cc3018599\")\n+        val uuid2 = UUID.fromString(\"027ba5ca-aa12-4afa-9219-e20cc3018599\")\n+        val uuid3 = UUID.fromString(\"037ba5ca-aa12-4afa-9219-e20cc3018599\")\n+\n+        realm.executeTransaction { realm ->\n+            realm.createObject<UUIDAndString>().id = uuid2\n+            realm.createObject<UUIDAndString>().id = null\n+            realm.createObject<UUIDAndString>().id = uuid3\n+            realm.createObject<UUIDAndString>().id = uuid1\n+        }\n+\n+        val all = realm.where<UUIDAndString>()\n+                .greaterThanOrEqualTo(\"id\", uuid2)\n+                .sort(\"id\", Sort.ASCENDING)\n+                .findAll()\n+\n+        assertEquals(2, all.size)\n+        assertEquals(uuid2, all[0]!!.id)\n+        assertEquals(uuid3, all[1]!!.id)\n+    }\n+\n+    @Test\n+    fun queriesGreaterThan() {\n+        val uuid1 = UUID.fromString(\"017ba5ca-aa12-4afa-9219-e20cc3018599\")\n+        val uuid2 = UUID.fromString(\"027ba5ca-aa12-4afa-9219-e20cc3018599\")\n+        val uuid3 = UUID.fromString(\"037ba5ca-aa12-4afa-9219-e20cc3018599\")\n+\n+        realm.executeTransaction { realm ->\n+            realm.createObject<UUIDAndString>().id = uuid2\n+            realm.createObject<UUIDAndString>().id = null\n+            realm.createObject<UUIDAndString>().id = uuid3\n+            realm.createObject<UUIDAndString>().id = uuid1\n+        }\n+\n+        val all = realm.where<UUIDAndString>()\n+                .greaterThan(\"id\", uuid2)\n+                .sort(\"id\", Sort.ASCENDING)\n+                .findAll()\n+\n+        assertEquals(1, all.size)\n+        assertEquals(uuid3, all[0]!!.id)\n+    }\n+\n+    @Test\n+    fun queriesLessThanOrEqualTo() {\n+        val uuid1 = UUID.fromString(\"017ba5ca-aa12-4afa-9219-e20cc3018599\")\n+        val uuid2 = UUID.fromString(\"027ba5ca-aa12-4afa-9219-e20cc3018599\")\n+        val uuid3 = UUID.fromString(\"037ba5ca-aa12-4afa-9219-e20cc3018599\")\n+\n+        realm.executeTransaction { realm ->\n+            realm.createObject<UUIDAndString>().id = uuid2\n+            realm.createObject<UUIDAndString>().id = null\n+            realm.createObject<UUIDAndString>().id = uuid3\n+            realm.createObject<UUIDAndString>().id = uuid1\n+        }\n+\n+        val all = realm.where<UUIDAndString>()\n+                .lessThanOrEqualTo(\"id\", uuid2)\n+                .sort(\"id\", Sort.ASCENDING)\n+                .findAll()\n+\n+        assertEquals(2, all.size)\n+        assertEquals(uuid1, all[0]!!.id)\n+        assertEquals(uuid2, all[1]!!.id)\n+    }\n+\n+    @Test\n+    fun queriesLessThan() {\n+        val uuid1 = UUID.fromString(\"017ba5ca-aa12-4afa-9219-e20cc3018599\")\n+        val uuid2 = UUID.fromString(\"027ba5ca-aa12-4afa-9219-e20cc3018599\")\n+        val uuid3 = UUID.fromString(\"037ba5ca-aa12-4afa-9219-e20cc3018599\")\n+\n+        realm.executeTransaction { realm ->\n+            realm.createObject<UUIDAndString>().id = uuid2\n+            realm.createObject<UUIDAndString>().id = null\n+            realm.createObject<UUIDAndString>().id = uuid3\n+            realm.createObject<UUIDAndString>().id = uuid1\n+        }\n+\n+        val all = realm.where<UUIDAndString>()\n+                .lessThan(\"id\", uuid2)\n+                .sort(\"id\", Sort.ASCENDING)\n+                .findAll()\n+\n+        assertEquals(1, all.size)\n+        assertEquals(uuid1, all[0]!!.id)\n+    }\n+\n+    @Test\n+    fun queriesIsNull() {\n+        val uuid1 = UUID.randomUUID()\n+        val uuid2 = UUID.randomUUID()\n+        val uuid3 = UUID.randomUUID()\n+\n+        realm.executeTransaction { realm ->\n+            realm.createObject<UUIDAndString>().id = uuid2\n+            realm.createObject<UUIDAndString>().id = null\n+            realm.createObject<UUIDAndString>().id = uuid3\n+            realm.createObject<UUIDAndString>().id = uuid1\n+        }\n+\n+        val all = realm.where<UUIDAndString>()\n+                .isNull(\"id\")\n+                .findAll()\n+\n+        assertEquals(1, all.size)\n+        assertNull(all[0]!!.id)\n+    }\n+\n+    @Test\n+    fun queriesIsNotNull() {\n+        val uuid1 = UUID.fromString(\"017ba5ca-aa12-4afa-9219-e20cc3018599\")\n+        val uuid2 = UUID.fromString(\"027ba5ca-aa12-4afa-9219-e20cc3018599\")\n+        val uuid3 = UUID.fromString(\"037ba5ca-aa12-4afa-9219-e20cc3018599\")\n+\n+        realm.executeTransaction { realm ->\n+            realm.createObject<UUIDAndString>().id = uuid2\n+            realm.createObject<UUIDAndString>().id = null\n+            realm.createObject<UUIDAndString>().id = uuid3\n+            realm.createObject<UUIDAndString>().id = uuid1\n+        }\n+\n+        val all = realm.where<UUIDAndString>()\n+                .isNotNull(\"id\")\n+                .sort(\"id\", Sort.ASCENDING)\n+                .findAll()\n+\n+        assertEquals(3, all.size)\n+        assertEquals(uuid1, all[0]!!.id)\n+        assertEquals(uuid2, all[1]!!.id)\n+        assertEquals(uuid3, all[2]!!.id)\n+    }\n+\n+    @Test\n+    fun queriesAverage() {\n+        val uuid1 = UUID.randomUUID()\n+        val uuid2 = UUID.randomUUID()\n+        val uuid3 = UUID.randomUUID()\n+\n+        realm.executeTransaction { realm ->\n+            realm.createObject<UUIDAndString>().id = uuid2\n+            realm.createObject<UUIDAndString>().id = null\n+            realm.createObject<UUIDAndString>().id = uuid3\n+            realm.createObject<UUIDAndString>().id = uuid1\n+        }\n+\n+        assertFailsWith<IllegalArgumentException>(\"Average is not supported for UUID\") {\n+            realm.where<UUIDAndString>().average(\"id\") // FIXME should we support average queries in Core?", "originalCommit": "39f1206c4f9128bc49e323bb5f75f494c3d0599f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTIxODg4NQ==", "url": "https://github.com/realm/realm-java/pull/7152#discussion_r521218885", "bodyText": "Nice test coverage \ud83d\udc4d\nTwo things I see missing is:\n\nTest for linked queries, i.e. equalTo(\"parentObj.uuidField\", uuid)\nRealmObjectSchema tests, i.e. RealmObjectSchema.getFieldType() == RealmFieldType.UUID", "author": "cmelchior", "createdAt": "2020-11-11T09:15:17Z", "path": "realm/realm-library/src/androidTest/kotlin/io/realm/UUIDTests.kt", "diffHunk": "@@ -0,0 +1,590 @@\n+/*\n+ * Copyright 2020 Realm Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.realm\n+\n+import androidx.test.ext.junit.runners.AndroidJUnit4\n+import androidx.test.platform.app.InstrumentationRegistry\n+import io.realm.annotations.PrimaryKey\n+import io.realm.annotations.Required\n+import io.realm.exceptions.RealmException\n+import io.realm.exceptions.RealmPrimaryKeyConstraintException\n+import io.realm.kotlin.createObject\n+import io.realm.kotlin.where\n+import io.realm.rule.TestRealmConfigurationFactory\n+import org.junit.After\n+import org.junit.Assert.*\n+import org.junit.Before\n+import org.junit.Rule\n+import org.junit.Test\n+import org.junit.runner.RunWith\n+import java.util.*\n+import kotlin.test.assertFailsWith\n+\n+open class UUIDPrimaryKeyRequired\n+    : RealmObject() {\n+    @PrimaryKey\n+    @Required\n+    var id: UUID? = null\n+    var name: String = \"\"\n+    var anotherId: UUID? = null\n+}\n+\n+open class UUIDPrimaryKeyNotRequired\n+    : RealmObject() {\n+    @PrimaryKey\n+    var id: UUID? = null\n+    var name: String = \"\"\n+}\n+\n+open class UUIDAndString\n+    : RealmObject() {\n+    var id: UUID? = null\n+    var name: String = \"\"\n+}\n+\n+open class UUIDRequiredRealmList\n+    : RealmObject() {\n+    var id: Long = 0\n+\n+    @Required\n+    var ids: RealmList<UUID> = RealmList()\n+    var name: String = \"\"\n+}\n+\n+open class UUIDOptionalRealmList\n+    : RealmObject() {\n+    var id: Long = 0\n+\n+    var ids: RealmList<UUID> = RealmList()\n+    var name: String = \"\"\n+}\n+\n+@RunWith(AndroidJUnit4::class)\n+class UUIDTests {", "originalCommit": "39f1206c4f9128bc49e323bb5f75f494c3d0599f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTIyMDU5OA==", "url": "https://github.com/realm/realm-java/pull/7152#discussion_r521220598", "bodyText": "We should probably mark this line as //throws as well. I assume COL_NULLABLE throws here?", "author": "cmelchior", "createdAt": "2020-11-11T09:18:24Z", "path": "realm/realm-library/src/main/cpp/io_realm_internal_OsObject.cpp", "diffHunk": "@@ -243,6 +243,35 @@ static inline Obj do_create_row_with_object_id_primary_key(JNIEnv* env, jlong sh\n     }\n }\n \n+static inline Obj do_create_row_with_uuid_primary_key(JNIEnv* env, jlong shared_realm_ptr, jlong table_ref_ptr,\n+                                                           jlong pk_column_key, jstring pk_value)\n+{\n+    auto& shared_realm = *(reinterpret_cast<SharedRealm*>(shared_realm_ptr));\n+    TableRef table = TBL_REF(table_ref_ptr);\n+    ColKey col_key(pk_column_key);\n+    shared_realm->verify_in_write(); // throws\n+    JStringAccessor str_accessor(env, pk_value); // throws\n+    if (!pk_value && !COL_NULLABLE(env, table, pk_column_key)) {", "originalCommit": "39f1206c4f9128bc49e323bb5f75f494c3d0599f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTIyMTM1NA==", "url": "https://github.com/realm/realm-java/pull/7152#discussion_r521221354", "bodyText": "Isn't this a potential bug? It seems that we might return an unmanaged Obj from do_create_row_with_uuid_primary_key?", "author": "cmelchior", "createdAt": "2020-11-11T09:19:38Z", "path": "realm/realm-library/src/main/cpp/io_realm_internal_OsObject.cpp", "diffHunk": "@@ -388,6 +417,32 @@ JNIEXPORT jlong JNICALL Java_io_realm_internal_OsObject_nativeCreateNewObjectWit\n     return 0;\n }\n \n+JNIEXPORT jlong JNICALL Java_io_realm_internal_OsObject_nativeCreateRowWithUUIDPrimaryKey(\n+        JNIEnv* env, jclass, jlong shared_realm_ptr, jlong table_ref_ptr, jlong pk_column_ndx, jstring pk_value)\n+{\n+    try {\n+        Obj obj = do_create_row_with_uuid_primary_key(env, shared_realm_ptr, table_ref_ptr, pk_column_ndx, pk_value);\n+        return (jlong)(obj.get_key().value);\n+    }\n+    CATCH_STD()\n+    return realm::npos;\n+}\n+\n+JNIEXPORT jlong JNICALL Java_io_realm_internal_OsObject_nativeCreateNewObjectWithUUIDPrimaryKey(\n+        JNIEnv* env, jclass, jlong shared_realm_ptr, jlong table_ref_ptr, jlong pk_column_ndx, jstring pk_value)\n+{\n+    try {\n+        Obj obj = do_create_row_with_uuid_primary_key(env, shared_realm_ptr, table_ref_ptr, pk_column_ndx, pk_value);\n+        if (bool(obj)) {", "originalCommit": "39f1206c4f9128bc49e323bb5f75f494c3d0599f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTIyMTYxMQ==", "url": "https://github.com/realm/realm-java/pull/7152#discussion_r521221611", "bodyText": "Given the checks belows, should we return a nullptr here?", "author": "cmelchior", "createdAt": "2020-11-11T09:20:03Z", "path": "realm/realm-library/src/main/cpp/io_realm_internal_OsObject.cpp", "diffHunk": "@@ -243,6 +243,35 @@ static inline Obj do_create_row_with_object_id_primary_key(JNIEnv* env, jlong sh\n     }\n }\n \n+static inline Obj do_create_row_with_uuid_primary_key(JNIEnv* env, jlong shared_realm_ptr, jlong table_ref_ptr,\n+                                                           jlong pk_column_key, jstring pk_value)\n+{\n+    auto& shared_realm = *(reinterpret_cast<SharedRealm*>(shared_realm_ptr));\n+    TableRef table = TBL_REF(table_ref_ptr);\n+    ColKey col_key(pk_column_key);\n+    shared_realm->verify_in_write(); // throws\n+    JStringAccessor str_accessor(env, pk_value); // throws\n+    if (!pk_value && !COL_NULLABLE(env, table, pk_column_key)) {\n+        return Obj();", "originalCommit": "39f1206c4f9128bc49e323bb5f75f494c3d0599f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAzMTA4Mg==", "url": "https://github.com/realm/realm-java/pull/7152#discussion_r522031082", "bodyText": "We cannot return a null pointer because the function return is by value. We should be throwing a C++ exception, then would be caught and converted to a Java one by the calling function.\nWe cannot do that because COL_NULLABLE directly throws a Java exception, forcing us to return a dummy object.\nWe should target this on a different PR. This piece of code follows the same pattern as the other data types.", "author": "clementetb", "createdAt": "2020-11-12T11:19:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTIyMTYxMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTIyOTU1OQ==", "url": "https://github.com/realm/realm-java/pull/7152#discussion_r521229559", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            // ObjectID\n          \n          \n            \n            // UUID\n          \n      \n    \n    \n  \n\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            // ObjectID\n          \n          \n            \n            // ObjectID", "author": "cmelchior", "createdAt": "2020-11-11T09:33:21Z", "path": "realm/realm-library/src/main/cpp/io_realm_internal_TableQuery.cpp", "diffHunk": "@@ -1226,6 +1226,134 @@ static void TableQuery_StringPredicate(JNIEnv* env, jlong nativeQueryPtr, jlongA\n     CATCH_STD()\n }\n \n+// ObjectID", "originalCommit": "39f1206c4f9128bc49e323bb5f75f494c3d0599f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTI0NDU2MA==", "url": "https://github.com/realm/realm-java/pull/7152#discussion_r521244560", "bodyText": "Is it sane to silently ignore operations on invalid type?", "author": "rorbech", "createdAt": "2020-11-11T09:59:04Z", "path": "realm/realm-library/src/main/cpp/io_realm_internal_Table.cpp", "diffHunk": "@@ -609,6 +609,21 @@ JNIEXPORT void JNICALL Java_io_realm_internal_Table_nativeSetObjectId(JNIEnv* en\n     CATCH_STD()\n }\n \n+JNIEXPORT void JNICALL Java_io_realm_internal_Table_nativeSetUUID(JNIEnv* env, jclass, jlong nativeTableRefPtr,\n+                                                                      jlong columnKey, jlong rowKey, jstring j_value,\n+                                                                      jboolean isDefault)\n+{\n+    TableRef table = TBL_REF(nativeTableRefPtr);\n+    if (!TYPE_VALID(env, table, columnKey, type_UUID)) {", "originalCommit": "39f1206c4f9128bc49e323bb5f75f494c3d0599f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAzMjE5OQ==", "url": "https://github.com/realm/realm-java/pull/7152#discussion_r522032199", "bodyText": "I don't think that is a good practice neither. I am following the same pattern as the other data types to get the same behavior.\nWe should address this on a different PR.", "author": "clementetb", "createdAt": "2020-11-12T11:21:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTI0NDU2MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTY1MTQ0Mw==", "url": "https://github.com/realm/realm-java/pull/7152#discussion_r521651443", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    LinkChain linkChain = getTableForLinkQuery(nativeQueryPtr, table_arr, col_key_arr);", "author": "bmunkholm", "createdAt": "2020-11-11T21:33:49Z", "path": "realm/realm-library/src/main/cpp/io_realm_internal_TableQuery.cpp", "diffHunk": "@@ -1226,6 +1226,134 @@ static void TableQuery_StringPredicate(JNIEnv* env, jlong nativeQueryPtr, jlongA\n     CATCH_STD()\n }\n \n+// ObjectID\n+enum UUIDPredicate { UUIDEqual, UUIDNotEqual, UUIDLess, UUIDLessEqual, UUIDGreater, UUIDGreaterEqual };\n+static void TableQuery_UUIDPredicate(JNIEnv* env, jlong nativeQueryPtr, jlongArray columnKeys,\n+                                         jlongArray tablePointers, jstring j_data, UUIDPredicate predicate)\n+{\n+    try {\n+        JStringAccessor data(env, j_data);\n+        JLongArrayAccessor table_arr(env, tablePointers);\n+        JLongArrayAccessor col_key_arr(env, columnKeys);\n+        jsize arr_len = col_key_arr.size();\n+        LinkChain linkChain = getTableForLinkQuery(nativeQueryPtr, table_arr, col_key_arr);", "originalCommit": "39f1206c4f9128bc49e323bb5f75f494c3d0599f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTY1MjM0MA==", "url": "https://github.com/realm/realm-java/pull/7152#discussion_r521652340", "bodyText": "Is there a reason to have all these below functions? Why not call TableQuery_UUIDPredicate with the additional enum?", "author": "bmunkholm", "createdAt": "2020-11-11T21:35:45Z", "path": "realm/realm-library/src/main/cpp/io_realm_internal_TableQuery.cpp", "diffHunk": "@@ -1226,6 +1226,134 @@ static void TableQuery_StringPredicate(JNIEnv* env, jlong nativeQueryPtr, jlongA\n     CATCH_STD()\n }\n \n+// ObjectID\n+enum UUIDPredicate { UUIDEqual, UUIDNotEqual, UUIDLess, UUIDLessEqual, UUIDGreater, UUIDGreaterEqual };\n+static void TableQuery_UUIDPredicate(JNIEnv* env, jlong nativeQueryPtr, jlongArray columnKeys,\n+                                         jlongArray tablePointers, jstring j_data, UUIDPredicate predicate)\n+{\n+    try {\n+        JStringAccessor data(env, j_data);\n+        JLongArrayAccessor table_arr(env, tablePointers);\n+        JLongArrayAccessor col_key_arr(env, columnKeys);\n+        jsize arr_len = col_key_arr.size();\n+        LinkChain linkChain = getTableForLinkQuery(nativeQueryPtr, table_arr, col_key_arr);\n+\n+        UUID uuid = UUID(StringData(data).data());\n+        if (arr_len == 1) {\n+            if (!TYPE_VALID(env, Q(nativeQueryPtr)->get_table(), col_key_arr[0], type_UUID)) {\n+                return;\n+            }\n+\n+            switch (predicate) {\n+                case UUIDEqual:\n+                    Q(nativeQueryPtr)->equal(ColKey(col_key_arr[0]), uuid);\n+                    break;\n+                case UUIDNotEqual:\n+                    Q(nativeQueryPtr)->not_equal(ColKey(col_key_arr[0]), uuid);\n+                    break;\n+                case UUIDLess:\n+                    Q(nativeQueryPtr)->less(ColKey(col_key_arr[0]), uuid);\n+                    break;\n+                case UUIDLessEqual:\n+                    Q(nativeQueryPtr)->less_equal(ColKey(col_key_arr[0]), uuid);\n+                    break;\n+                case UUIDGreater:\n+                    Q(nativeQueryPtr)->greater(ColKey(col_key_arr[0]), uuid);\n+                    break;\n+                case UUIDGreaterEqual:\n+                    Q(nativeQueryPtr)->greater_equal(ColKey(col_key_arr[0]), uuid);\n+                    break;\n+            }\n+        }\n+        else {\n+            LinkChain linkChain = getTableForLinkQuery(nativeQueryPtr, table_arr, col_key_arr);\n+            switch (predicate) {\n+                case UUIDEqual:\n+                    Q(nativeQueryPtr)\n+                            ->and_query(linkChain.column<UUID>(ColKey(col_key_arr[arr_len - 1])) ==\n+                                        uuid);\n+                    break;\n+                case UUIDNotEqual:\n+                    Q(nativeQueryPtr)\n+                            ->and_query(linkChain.column<UUID>(ColKey(col_key_arr[arr_len - 1])) !=\n+                                        uuid);\n+                    break;\n+                case UUIDLess:\n+                    Q(nativeQueryPtr)\n+                            ->and_query(numeric_link_less<UUID, UUID, UUID>(linkChain, col_key_arr[arr_len - 1], uuid));\n+                    break;\n+                case UUIDLessEqual:\n+                    Q(nativeQueryPtr)\n+                            ->and_query(numeric_link_lessequal<UUID, UUID, UUID>(linkChain, col_key_arr[arr_len - 1], uuid));\n+                    break;\n+                case UUIDGreater:\n+                    Q(nativeQueryPtr)\n+                            ->and_query(numeric_link_greater<UUID, UUID, UUID>(linkChain, col_key_arr[arr_len - 1], uuid));\n+                    break;\n+                case UUIDGreaterEqual:\n+                    Q(nativeQueryPtr)\n+                            ->and_query(numeric_link_greaterequal<UUID, UUID, UUID>(linkChain, col_key_arr[arr_len - 1], uuid));\n+                    break;\n+            }\n+        }\n+    }\n+    CATCH_STD()\n+}\n+\n+JNIEXPORT void JNICALL Java_io_realm_internal_TableQuery_nativeEqualUUID(JNIEnv* env, jobject,", "originalCommit": "39f1206c4f9128bc49e323bb5f75f494c3d0599f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTk4MDE5Nw==", "url": "https://github.com/realm/realm-java/pull/7152#discussion_r521980197", "bodyText": "On this PR I was following along with the other data types, but yes we could have an additional enum and reduce the number of functions.", "author": "clementetb", "createdAt": "2020-11-12T09:58:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTY1MjM0MA=="}], "type": "inlineReview"}, {"oid": "d6fc18bb80d7ebf40c09d708524d32b53af9f80a", "url": "https://github.com/realm/realm-java/commit/d6fc18bb80d7ebf40c09d708524d32b53af9f80a", "message": "Update realm/realm-library/src/main/cpp/io_realm_internal_TableQuery.cpp\n\nCo-authored-by: Brian Munkholm <bmunkholm@users.noreply.github.com>", "committedDate": "2020-11-12T09:58:36Z", "type": "commit"}, {"oid": "774e7b3138114aa073016ce002bd42a37a4bd7a2", "url": "https://github.com/realm/realm-java/commit/774e7b3138114aa073016ce002bd42a37a4bd7a2", "message": "Update realm/realm-library/src/main/cpp/io_realm_internal_TableQuery.cpp\n\nCo-authored-by: Christian Melchior <christian@ilios.dk>", "committedDate": "2020-11-12T09:58:51Z", "type": "commit"}, {"oid": "69c5543dc11fd18519d88c529bcdff9b92a3564a", "url": "https://github.com/realm/realm-java/commit/69c5543dc11fd18519d88c529bcdff9b92a3564a", "message": "PR change requests", "committedDate": "2020-11-12T12:08:54Z", "type": "commit"}, {"oid": "775e2de24731f9aa5095bfa95700601e313079fc", "url": "https://github.com/realm/realm-java/commit/775e2de24731f9aa5095bfa95700601e313079fc", "message": "Add changes into the changelog", "committedDate": "2020-11-12T15:18:48Z", "type": "commit"}, {"oid": "6d09178a4626e2dc14eb9c015cf2a543a6255488", "url": "https://github.com/realm/realm-java/commit/6d09178a4626e2dc14eb9c015cf2a543a6255488", "message": "Allow UUID to be a primary type", "committedDate": "2020-11-24T16:19:49Z", "type": "commit"}, {"oid": "53280d755f866bf580fb3ab969df00d41e8b932e", "url": "https://github.com/realm/realm-java/commit/53280d755f866bf580fb3ab969df00d41e8b932e", "message": "Merge in latest support new data types", "committedDate": "2020-11-27T16:42:21Z", "type": "commit"}, {"oid": "03caa5571b1483d593b835141d22577ae52596a6", "url": "https://github.com/realm/realm-java/commit/03caa5571b1483d593b835141d22577ae52596a6", "message": "Remove ignore", "committedDate": "2020-11-27T16:43:25Z", "type": "commit"}, {"oid": "eea44950461ac783f88db7a17b2e5d2ca835a4cd", "url": "https://github.com/realm/realm-java/commit/eea44950461ac783f88db7a17b2e5d2ca835a4cd", "message": "Bump master", "committedDate": "2020-11-27T16:46:54Z", "type": "commit"}, {"oid": "93cf711f3bed6e16b7e93fa779b66474b08a48a1", "url": "https://github.com/realm/realm-java/commit/93cf711f3bed6e16b7e93fa779b66474b08a48a1", "message": "Disable tests affected by realm lists bug in core", "committedDate": "2020-12-03T08:56:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDgzNDU5Nw==", "url": "https://github.com/realm/realm-java/pull/7152#discussion_r534834597", "bodyText": "Easier to read if indentation follow flow of emitted code.", "author": "rorbech", "createdAt": "2020-12-03T07:45:49Z", "path": "realm/realm-annotations-processor/src/main/java/io/realm/processor/RealmJsonTypeHelper.kt", "diffHunk": "@@ -421,6 +422,55 @@ object RealmJsonTypeHelper {\n         }\n     }\n \n+    private class UUIDTypeConverter() : JsonToRealmFieldTypeConverter {\n+        @Throws(IOException::class)\n+        override fun emitTypeConversion(varName: String, accessor: String, fieldName: String, fieldType: QualifiedClassName, writer: JavaWriter) {\n+            writer.apply {\n+                beginControlFlow(\"if (json.has(\\\"%s\\\"))\", fieldName)", "originalCommit": "eea44950461ac783f88db7a17b2e5d2ca835a4cd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTAxNzkyMw==", "url": "https://github.com/realm/realm-java/pull/7152#discussion_r535017923", "bodyText": "Probably not for this PR, but bookkeeping/correctness of all these test would be improved significantly if we introduced RealmFieldType.indexable(), etc. and had the test iterate the RealmFieldType.values(). If not needed in the public API we could maybe add some utilities for test with the same concept. But seems like there are plenty of places where it could be convenient internally too ex. https://github.com/realm/realm-java/pull/7152/files#diff-6d4cb257e0e9ac7445f8cce3a43be3a9c690525ec6268d5ddb96fb80d157ce4bR58", "author": "rorbech", "createdAt": "2020-12-03T09:43:17Z", "path": "realm/realm-annotations-processor/src/test/java/io/realm/processor/RealmProcessorTest.java", "diffHunk": "@@ -278,7 +278,7 @@ public void compileCustomAccessor() {\n     @Test\n     public void compileIndexTypes() throws IOException {\n         final String[] validIndexFieldTypes = {\"byte\", \"short\", \"int\", \"long\", \"boolean\", \"String\", \"java.util.Date\",\n-                \"Byte\", \"Short\", \"Integer\", \"Long\", \"Boolean\"};\n+                \"Byte\", \"Short\", \"Integer\", \"Long\", \"Boolean\", \"org.bson.types.ObjectId\", \"java.util.UUID\"};", "originalCommit": "93cf711f3bed6e16b7e93fa779b66474b08a48a1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "051bce84b446a3b85758ac7406443bf8d04306ca", "url": "https://github.com/realm/realm-java/commit/051bce84b446a3b85758ac7406443bf8d04306ca", "message": "Realm results tests are failing due a realm list issue in core", "committedDate": "2020-12-03T10:43:16Z", "type": "commit"}, {"oid": "75dd06ffd825d93ba2256bb103dba75d64bfb88c", "url": "https://github.com/realm/realm-java/commit/75dd06ffd825d93ba2256bb103dba75d64bfb88c", "message": "Fix indentation", "committedDate": "2020-12-07T19:57:05Z", "type": "commit"}, {"oid": "bfbce0c07155a4a75ed6b7b61ff22c59c94ccf68", "url": "https://github.com/realm/realm-java/commit/bfbce0c07155a4a75ed6b7b61ff22c59c94ccf68", "message": "Ignore failing tests", "committedDate": "2020-12-07T21:43:09Z", "type": "commit"}]}