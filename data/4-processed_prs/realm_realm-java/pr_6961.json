{"pr_number": 6961, "pr_title": "Obfuscate sensitive login information in debug logs", "pr_createdAt": "2020-06-19T14:58:53Z", "pr_url": "https://github.com/realm/realm-java/pull/6961", "timeline": [{"oid": "0423969216cde1b9bc28a6dac2dcedfa0cb875ef", "url": "https://github.com/realm/realm-java/commit/0423969216cde1b9bc28a6dac2dcedfa0cb875ef", "message": "Added support for server api keys and custom functions as valid credentials", "committedDate": "2020-06-17T13:25:36Z", "type": "commit"}, {"oid": "979ede201c7c3f280b07bb2fd8737f509fc0cba7", "url": "https://github.com/realm/realm-java/commit/979ede201c7c3f280b07bb2fd8737f509fc0cba7", "message": "Updated OS pointer", "committedDate": "2020-06-17T13:39:21Z", "type": "commit"}, {"oid": "1ebebd897c1147102201981ffb112c6ddfcc4979", "url": "https://github.com/realm/realm-java/commit/1ebebd897c1147102201981ffb112c6ddfcc4979", "message": "Fixed breaking changes after updating with v10", "committedDate": "2020-06-17T13:53:26Z", "type": "commit"}, {"oid": "1e289c7ed328275b75cce0beea81424bf494e09c", "url": "https://github.com/realm/realm-java/commit/1e289c7ed328275b75cce0beea81424bf494e09c", "message": "Updated OS pointer", "committedDate": "2020-06-17T16:07:58Z", "type": "commit"}, {"oid": "3ac946045c9a5e01c752b453dbb97d198433af18", "url": "https://github.com/realm/realm-java/commit/3ac946045c9a5e01c752b453dbb97d198433af18", "message": "Added identity provider to OsAppCredential to distinguish between user and server API keys, as the value is the same for both in the OS but are treated as separate providers. Cleaned up some comments. Removed unnecessary log in tests plus added comparison at enum level", "committedDate": "2020-06-18T08:46:04Z", "type": "commit"}, {"oid": "d314637f4c55db690b2f43926ba29db3ec4a65f4", "url": "https://github.com/realm/realm-java/commit/d314637f4c55db690b2f43926ba29db3ec4a65f4", "message": "Fixed typo in jwt creds test and changed comparison of users to their ids instead of the whole object", "committedDate": "2020-06-18T09:00:31Z", "type": "commit"}, {"oid": "f48170a3501be8cfc5bc7fb1940acdcc366836d4", "url": "https://github.com/realm/realm-java/commit/f48170a3501be8cfc5bc7fb1940acdcc366836d4", "message": "Updated OS pointer to latest v10", "committedDate": "2020-06-18T09:15:41Z", "type": "commit"}, {"oid": "d2ba5cc80ebf2d24d69b6c8735313c4d8ee58a8b", "url": "https://github.com/realm/realm-java/commit/d2ba5cc80ebf2d24d69b6c8735313c4d8ee58a8b", "message": "Move identity provider from OS to API level", "committedDate": "2020-06-19T10:15:45Z", "type": "commit"}, {"oid": "269dd00e01d892ccbf53360fa9b78fbac4dfb31e", "url": "https://github.com/realm/realm-java/commit/269dd00e01d892ccbf53360fa9b78fbac4dfb31e", "message": "Merge branch 'v10' into el/credentials-api-key", "committedDate": "2020-06-19T10:47:01Z", "type": "commit"}, {"oid": "bc593e9a07cb4e83fad5fc1933b955e31ec683fe", "url": "https://github.com/realm/realm-java/commit/bc593e9a07cb4e83fad5fc1933b955e31ec683fe", "message": "Added logcat obfuscators. Added a default map to the AppConfiguration to allow logs to not be obfuscated in tests.", "committedDate": "2020-06-19T14:40:45Z", "type": "commit"}, {"oid": "29b082339b38a516868dd7e62e4081a4d28d4b01", "url": "https://github.com/realm/realm-java/commit/29b082339b38a516868dd7e62e4081a4d28d4b01", "message": "Merge branch 'v10' into el/logcat-obfuscation\n\n# Conflicts:\n#\trealm/realm-library/src/androidTestObjectServer/kotlin/io/realm/CredentialsTests.kt", "committedDate": "2020-06-19T14:54:23Z", "type": "commit"}, {"oid": "d0d3643b8e699b7b60923426d11e95af8904eddf", "url": "https://github.com/realm/realm-java/commit/d0d3643b8e699b7b60923426d11e95af8904eddf", "message": "Deleted wrong test", "committedDate": "2020-06-19T15:02:08Z", "type": "commit"}, {"oid": "5ccf2ebf1809d33816b72c22d3c7f5673a2423ea", "url": "https://github.com/realm/realm-java/commit/5ccf2ebf1809d33816b72c22d3c7f5673a2423ea", "message": "Wrapped the patterns and providers inside a LoginInfoObfuscator class for clarity", "committedDate": "2020-06-21T11:36:35Z", "type": "commit"}, {"oid": "0ad94182c50011274731abb0de93619eff6c6fa9", "url": "https://github.com/realm/realm-java/commit/0ad94182c50011274731abb0de93619eff6c6fa9", "message": "Merge branch 'v10' into el/logcat-obfuscation", "committedDate": "2020-06-21T11:38:12Z", "type": "commit"}, {"oid": "dbb241c1d7dbbf5fc1bf5b0e2ecd4ac557c56ee8", "url": "https://github.com/realm/realm-java/commit/dbb241c1d7dbbf5fc1bf5b0e2ecd4ac557c56ee8", "message": "Removed logging", "committedDate": "2020-06-21T11:39:19Z", "type": "commit"}, {"oid": "90704a9455795798eaa0c6e7f9ab3d80b7082aa2", "url": "https://github.com/realm/realm-java/commit/90704a9455795798eaa0c6e7f9ab3d80b7082aa2", "message": "Added missing javadoc and fixed static code analysis issue", "committedDate": "2020-06-22T06:49:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzM1OTI4Nw==", "url": "https://github.com/realm/realm-java/pull/6961#discussion_r443359287", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                     * </p>", "author": "rorbech", "createdAt": "2020-06-22T07:15:44Z", "path": "realm/realm-library/src/objectServer/java/io/realm/mongodb/AppConfiguration.java", "diffHunk": "@@ -424,6 +441,7 @@ public Builder defaultSyncErrorHandler(SyncSession.ErrorHandler errorHandler) {\n          * <p>\n          * The default root dir is {@code Context.getFilesDir()/mongodb-realm}.\n          * </p>", "originalCommit": "90704a9455795798eaa0c6e7f9ab3d80b7082aa2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzM2MzM3Mg==", "url": "https://github.com/realm/realm-java/pull/6961#discussion_r443363372", "bodyText": "Maybe we should unwrap this into an actual LoggingInterceptor that could be passed into the OkHttpNetworkTransport.", "author": "rorbech", "createdAt": "2020-06-22T07:24:40Z", "path": "realm/realm-library/src/objectServer/java/io/realm/internal/network/OkHttpNetworkTransport.java", "diffHunk": "@@ -90,7 +99,10 @@ private synchronized OkHttpClient getClient(long timeoutMs) {\n                                     // We only expect request context to be JSON.\n                                     Buffer buffer = new Buffer();\n                                     request.body().writeTo(buffer);\n-                                    sb.append(buffer.readString(UTF8));\n+", "originalCommit": "90704a9455795798eaa0c6e7f9ab3d80b7082aa2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzM3NTk0NA==", "url": "https://github.com/realm/realm-java/pull/6961#discussion_r443375944", "bodyText": "Makes sense \ud83d\udc4d", "author": "cmelchior", "createdAt": "2020-06-22T07:50:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzM2MzM3Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzM5NDM2MQ==", "url": "https://github.com/realm/realm-java/pull/6961#discussion_r443394361", "bodyText": "Sounds like a good idea.", "author": "edualonso", "createdAt": "2020-06-22T08:25:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzM2MzM3Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzM3MTQzNw==", "url": "https://github.com/realm/realm-java/pull/6961#discussion_r443371437", "bodyText": "Is this needed?", "author": "cmelchior", "createdAt": "2020-06-22T07:41:18Z", "path": "realm/realm-library/src/main/java/io/realm/log/obfuscator/EmailPasswordObfuscator.java", "diffHunk": "@@ -0,0 +1,60 @@\n+/*\n+ * Copyright 2020 Realm Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.realm.log.obfuscator;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.regex.Pattern;\n+\n+/**\n+ * Obfuscator for email- and password-related login requests.\n+ * <p>\n+ * It will replace the\n+ * <ul>\n+ * <li>{@code \"username\":\"<USERNAME>\"} and</li>\n+ * <li>{@code \"password\":\"<PASSWORD>\"}</li>\n+ * </ul>\n+ * patterns with\n+ * <ul>\n+ * <li>{@code \"username\":\"***\"} and</li>\n+ * <li>{@code \"password\":\"***\"}</li>\n+ * </ul>\n+ * respectively.\n+ */\n+public class EmailPasswordObfuscator extends PatternObfuscator {\n+\n+    private EmailPasswordObfuscator(Map<Pattern, String> patternReplacementMap) {\n+        super(patternReplacementMap);\n+    }\n+\n+    /**\n+     * Creates a {@link PatternObfuscator} for emails and passwords.\n+     *\n+     * @return an obfuscator that keeps emails and passwords from being displayed in the logcat.\n+     */\n+    public static EmailPasswordObfuscator obfuscator() {\n+        return new EmailPasswordObfuscator(getPatterns());\n+    }\n+\n+    private static Map<Pattern, String> getPatterns() {\n+        Map<Pattern, String> map = new HashMap<>();\n+        map.put(Pattern.compile(\"((\\\"email\\\"):(\\\".+?\\\"))\"), \"\\\"email\\\":\\\"***\\\"\");", "originalCommit": "90704a9455795798eaa0c6e7f9ab3d80b7082aa2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzM5NjAwNQ==", "url": "https://github.com/realm/realm-java/pull/6961#discussion_r443396005", "bodyText": "It is for account creation too.", "author": "edualonso", "createdAt": "2020-06-22T08:27:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzM3MTQzNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzM3MjE5Mw==", "url": "https://github.com/realm/realm-java/pull/6961#discussion_r443372193", "bodyText": "Right now this class is part of the public API? Do we really think that people are going to use this to implement obfuscators themselves? Otherwise, we should probably move them to the internal package so as not to clutter the public API too much?\nI don't have a strong opinion either way though, so up to you.", "author": "cmelchior", "createdAt": "2020-06-22T07:42:46Z", "path": "realm/realm-library/src/main/java/io/realm/log/obfuscator/LoginInfoObfuscator.java", "diffHunk": "@@ -0,0 +1,74 @@\n+/*\n+ * Copyright 2020 Realm Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.realm.log.obfuscator;\n+\n+import java.util.List;\n+import java.util.Map;\n+\n+/**\n+ * The LoginInfoObfuscator keeps sensitive login information from being displayed in the logcat.\n+ */\n+public class LoginInfoObfuscator {", "originalCommit": "90704a9455795798eaa0c6e7f9ab3d80b7082aa2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzM5NzA0NA==", "url": "https://github.com/realm/realm-java/pull/6961#discussion_r443397044", "bodyText": "I thought it had to do with the \"log feature\", but it's true this has no utility whatsoever for users. I think I'll move it.", "author": "edualonso", "createdAt": "2020-06-22T08:29:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzM3MjE5Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzM3MzEzMg==", "url": "https://github.com/realm/realm-java/pull/6961#discussion_r443373132", "bodyText": "It would be faster to call indexOf directly and check for -1. Right now you are iterating the list twice.", "author": "cmelchior", "createdAt": "2020-06-22T07:44:41Z", "path": "realm/realm-library/src/main/java/io/realm/log/obfuscator/LoginInfoObfuscator.java", "diffHunk": "@@ -0,0 +1,74 @@\n+/*\n+ * Copyright 2020 Realm Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.realm.log.obfuscator;\n+\n+import java.util.List;\n+import java.util.Map;\n+\n+/**\n+ * The LoginInfoObfuscator keeps sensitive login information from being displayed in the logcat.\n+ */\n+public class LoginInfoObfuscator {\n+\n+    private Map<String, PatternObfuscator> patternObfuscatorMap;\n+\n+    /**\n+     * {@link Map} of identity providers and {@link PatternObfuscator}s used to determine which\n+     * obfuscator has to be used.\n+     *\n+     * @param patternObfuscatorMap the map of credential identity providers and obfuscators.\n+     */\n+    public LoginInfoObfuscator(Map<String, PatternObfuscator> patternObfuscatorMap) {\n+        this.patternObfuscatorMap = patternObfuscatorMap;\n+    }\n+\n+    /**\n+     * Obfuscates a logcat entry or not depending on whether the request that is being sent is a\n+     * login request. If it is, its full path must contain a {@code providers} segment. If it is not\n+     * the logcat entry will not be obfuscated\n+     * <p>\n+     * Once extracted the identity provider its corresponding {@link PatternObfuscator} will carry\n+     * out the obfuscation.\n+     *\n+     * @param urlSegments the URL segments of the request to be sent.\n+     * @param input       the original logcat entry.\n+     * @return the obfuscated logcat entry.\n+     */\n+    public String obfuscate(List<String> urlSegments, String input) {\n+        if (urlSegments.contains(\"providers\")) {", "originalCommit": "90704a9455795798eaa0c6e7f9ab3d80b7082aa2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzM3NDc3MQ==", "url": "https://github.com/realm/realm-java/pull/6961#discussion_r443374771", "bodyText": "Shouldn't we keep the key for all of these? So this turns into \"authCode\": \"***\"", "author": "cmelchior", "createdAt": "2020-06-22T07:47:52Z", "path": "realm/realm-library/src/main/java/io/realm/log/obfuscator/TokenObfuscator.java", "diffHunk": "@@ -0,0 +1,58 @@\n+/*\n+ * Copyright 2020 Realm Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.realm.log.obfuscator;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.regex.Pattern;\n+\n+/**\n+ * Obfuscator for token-related login requests.\n+ * <p>\n+ * It will replace the\n+ * <ul>\n+ * <li>{@code \"authCode\":\"<TOKEN>\"},</li>\n+ * <li>{@code \"id_token\":\"<TOKEN>\"},</li>\n+ * <li>{@code \"token\":\"<TOKEN>\"}, and</li>\n+ * <li>{@code \"access_token\":\"<TOKEN>\"}</li>\n+ * </ul>\n+ * patterns with {@code \"token\":\"***\"}.\n+ */\n+public class TokenObfuscator extends PatternObfuscator {\n+\n+    private TokenObfuscator(Map<Pattern, String> patternReplacementMap) {\n+        super(patternReplacementMap);\n+    }\n+\n+    /**\n+     * Creates a {@link PatternObfuscator} for tokens.\n+     *\n+     * @return an obfuscator that keeps token information from being displayed in the logcat.\n+     */\n+    public static TokenObfuscator obfuscator() {\n+        return new TokenObfuscator(getPatterns());\n+    }\n+\n+    private static Map<Pattern, String> getPatterns() {\n+        Map<Pattern, String> map = new HashMap<>();\n+        map.put(Pattern.compile(\"((\\\"authCode\\\"):(\\\".+?\\\"))\"), \"\\\"token\\\":\\\"***\\\"\");", "originalCommit": "90704a9455795798eaa0c6e7f9ab3d80b7082aa2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzM3OTAyMA==", "url": "https://github.com/realm/realm-java/pull/6961#discussion_r443379020", "bodyText": "Maybe rename to httpLogObfuscator ? ... The PatternObfuscator class isn't restricted to only login, so if anyone actually implements their own class they could obfuscate other things as well.", "author": "cmelchior", "createdAt": "2020-06-22T07:55:56Z", "path": "realm/realm-library/src/objectServer/java/io/realm/mongodb/AppConfiguration.java", "diffHunk": "@@ -470,6 +487,19 @@ public Builder codecRegistry(CodecRegistry codecRegistry) {\n             return this;\n         }\n \n+        /**\n+         * Sets the {@link LoginInfoObfuscator} used to keep sensitive data from being displayed in\n+         * the logcat. These obfuscators default to\n+         * {@link PatternObfuscatorFactory#getObfuscators()} in a production environment.\n+         *\n+         * @param loginInfoObfuscator The default login obfuscator for the app.\n+         */\n+        public Builder loginInfoObfuscator(LoginInfoObfuscator loginInfoObfuscator) {", "originalCommit": "90704a9455795798eaa0c6e7f9ab3d80b7082aa2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzQwMzQ5Mw==", "url": "https://github.com/realm/realm-java/pull/6961#discussion_r443403493", "bodyText": "Unless the providers URL segment is used for other stuff than login, then it is only for login. I could abstract the specific segment we want to look for in the URL though, then it won't be login specific. Does it make sense?", "author": "edualonso", "createdAt": "2020-06-22T08:40:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzM3OTAyMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzM3OTY2OQ==", "url": "https://github.com/realm/realm-java/pull/6961#discussion_r443379669", "bodyText": "Nitpick: I think I feel that RegexObfuscatorFactory is a bit more clear than PatternObfuscatorFactory?", "author": "cmelchior", "createdAt": "2020-06-22T07:57:14Z", "path": "realm/realm-library/src/objectServer/java/io/realm/mongodb/PatternObfuscatorFactory.java", "diffHunk": "@@ -0,0 +1,51 @@\n+/*\n+ * Copyright 2020 Realm Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.realm.mongodb;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import io.realm.log.obfuscator.ApiKeyObfuscator;\n+import io.realm.log.obfuscator.CustomFunctionObfuscator;\n+import io.realm.log.obfuscator.EmailPasswordObfuscator;\n+import io.realm.log.obfuscator.PatternObfuscator;\n+import io.realm.log.obfuscator.TokenObfuscator;\n+\n+public class PatternObfuscatorFactory {", "originalCommit": "90704a9455795798eaa0c6e7f9ab3d80b7082aa2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzM4MTU3Mg==", "url": "https://github.com/realm/realm-java/pull/6961#discussion_r443381572", "bodyText": "Given that Kotlin support multiline strings when using \"\"\" it would be nice if this as nicely formatted with linebreaks. Makes it a lot easier to read.", "author": "cmelchior", "createdAt": "2020-06-22T08:00:47Z", "path": "realm/realm-library/src/testObjectServer/kotlin/io/realm/log/obfuscator/CustomFunctionObfuscatorTest.kt", "diffHunk": "@@ -0,0 +1,47 @@\n+/*\n+ * Copyright 2020 Realm Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.realm.log.obfuscator\n+\n+import org.junit.Test\n+import kotlin.test.assertEquals\n+import kotlin.test.assertFailsWith\n+\n+const val CUSTOM_FUNCTION_ORIGINAL_INPUT = \"\"\"{\"mail\":\"myfakemail@mongodb.com\",\"id\":{\"{$}numberInt\":\"666\"},\"options\":{\"device\":{\"appVersion\":\"1.0.\",\"appId\":\"realm-sdk-integration-tests-grbrc\",\"platform\":\"android\",\"platformVersion\":\"10\",\"sdkVersion\":\"10.0.0-BETA.5-SNAPSHOT\"}}}\"\"\"", "originalCommit": "90704a9455795798eaa0c6e7f9ab3d80b7082aa2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzM4MjE2Mg==", "url": "https://github.com/realm/realm-java/pull/6961#discussion_r443382162", "bodyText": "Is the ID from the Credentails not available in a JVM test?", "author": "cmelchior", "createdAt": "2020-06-22T08:01:56Z", "path": "realm/realm-library/src/testObjectServer/kotlin/io/realm/log/obfuscator/LoginInfoObfuscatorTest.kt", "diffHunk": "@@ -0,0 +1,81 @@\n+/*\n+ * Copyright 2020 Realm Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.realm.log.obfuscator\n+\n+import io.realm.mongodb.PatternObfuscatorFactory\n+import org.junit.Test\n+import kotlin.test.assertEquals\n+\n+const val IRRELEVANT_INPUT = \"\"\"{\"blahblahblah\":\"blehblehbleh\"}\"\"\"\n+\n+class LoginInfoObfuscatorTest {\n+\n+    private val apiKeyUrlSegments = listOf(\"providers\", \"api-key\")", "originalCommit": "90704a9455795798eaa0c6e7f9ab3d80b7082aa2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzQwMTk1Mg==", "url": "https://github.com/realm/realm-java/pull/6961#discussion_r443401952", "bodyText": "The credentials are located in the objectServer package, so they aren't visible from the main package - that's why I put the pattern factory inside objectServer so as to be able to get the ID providers, instead of using strings directly. Maybe I need to rethink where to locate these classes...", "author": "edualonso", "createdAt": "2020-06-22T08:37:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzM4MjE2Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzM4NzgwNg==", "url": "https://github.com/realm/realm-java/pull/6961#discussion_r443387806", "bodyText": "You seem to test all the relevant things, but I'm a bit concerned there are no proper integration tests. The reason being that if ObjectStore at some point changes which payload is sent to the server, we will not detect this and these obfuscators will fail to do the right thing.\nWe don't need to test all the error cases, but IMO we should test the happy path towards a real server.", "author": "cmelchior", "createdAt": "2020-06-22T08:13:02Z", "path": "realm/realm-library/src/testObjectServer/kotlin/io/realm/log/obfuscator/LoginInfoObfuscatorTest.kt", "diffHunk": "@@ -0,0 +1,81 @@\n+/*\n+ * Copyright 2020 Realm Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.realm.log.obfuscator\n+\n+import io.realm.mongodb.PatternObfuscatorFactory\n+import org.junit.Test\n+import kotlin.test.assertEquals\n+\n+const val IRRELEVANT_INPUT = \"\"\"{\"blahblahblah\":\"blehblehbleh\"}\"\"\"\n+\n+class LoginInfoObfuscatorTest {", "originalCommit": "90704a9455795798eaa0c6e7f9ab3d80b7082aa2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "7318a41a2267fb3d6365b59e94c71d116c6de512", "url": "https://github.com/realm/realm-java/commit/7318a41a2267fb3d6365b59e94c71d116c6de512", "message": "Added an interceptor to print network requests and added the obfuscator solution to it. Added more tests for robustness. Cleanup. Still missing integration-level tests", "committedDate": "2020-06-22T11:49:04Z", "type": "commit"}, {"oid": "1062ae64b6bf02d89a0ca8e12d6b293d24709b69", "url": "https://github.com/realm/realm-java/commit/1062ae64b6bf02d89a0ca8e12d6b293d24709b69", "message": "Added integration tests and more cleanup", "committedDate": "2020-06-22T20:34:25Z", "type": "commit"}, {"oid": "c83da32363c81b4126922eac80b337bd1860c41e", "url": "https://github.com/realm/realm-java/commit/c83da32363c81b4126922eac80b337bd1860c41e", "message": "Merge branch 'v10' into el/logcat-obfuscation", "committedDate": "2020-06-22T20:36:15Z", "type": "commit"}, {"oid": "c75fc2d3d13723ad0cd1661e5e7711a2336f453d", "url": "https://github.com/realm/realm-java/commit/c75fc2d3d13723ad0cd1661e5e7711a2336f453d", "message": "Removed set loglevel from credentials test", "committedDate": "2020-06-22T20:41:24Z", "type": "commit"}, {"oid": "b2ed3cbad48ee5ac399ec6ea065f9954a26cafee", "url": "https://github.com/realm/realm-java/commit/b2ed3cbad48ee5ac399ec6ea065f9954a26cafee", "message": "Removed log imports", "committedDate": "2020-06-22T20:42:19Z", "type": "commit"}, {"oid": "eb3ca4f69c12c6de2d5d2ea7e972279d1e6170d4", "url": "https://github.com/realm/realm-java/commit/eb3ca4f69c12c6de2d5d2ea7e972279d1e6170d4", "message": "Uncommented test", "committedDate": "2020-06-22T21:00:33Z", "type": "commit"}, {"oid": "c2cc202aa68e6214be7cbd5ba6c5fa7a14a0c90a", "url": "https://github.com/realm/realm-java/commit/c2cc202aa68e6214be7cbd5ba6c5fa7a14a0c90a", "message": "Cleanup", "committedDate": "2020-06-22T21:04:30Z", "type": "commit"}, {"oid": "2e850a9f31d2c8d5d8f34f8f35f4ed1daff00110", "url": "https://github.com/realm/realm-java/commit/2e850a9f31d2c8d5d8f34f8f35f4ed1daff00110", "message": "Fixed wrong references in unit test", "committedDate": "2020-06-23T07:09:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDA3NjY4OQ==", "url": "https://github.com/realm/realm-java/pull/6961#discussion_r444076689", "bodyText": "A bit weird to have this mixed handling of app.close. Explicit here but also in tearDown. I guess app could be a local variable just for this test.", "author": "rorbech", "createdAt": "2020-06-23T09:07:38Z", "path": "realm/realm-library/src/androidTestObjectServer/kotlin/io/realm/CredentialsTests.kt", "diffHunk": "@@ -239,6 +239,7 @@ class CredentialsTests {\n                 }\n             }\n         }\n+        app.close()", "originalCommit": "2e850a9f31d2c8d5d8f34f8f35f4ed1daff00110", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDA4MTE3Ng==", "url": "https://github.com/realm/realm-java/pull/6961#discussion_r444081176", "bodyText": "Yeah, this is a leftover from some things I was trying when adding the obfuscation. Forgot to clean up.", "author": "edualonso", "createdAt": "2020-06-23T09:15:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDA3NjY4OQ=="}], "type": "inlineReview"}, {"oid": "b8b9292d36c85668dec13bc110f129f8f665c4ee", "url": "https://github.com/realm/realm-java/commit/b8b9292d36c85668dec13bc110f129f8f665c4ee", "message": "Cleanup", "committedDate": "2020-06-23T09:15:17Z", "type": "commit"}, {"oid": "f2bf9ce67fa36fae4fdc66d5be2201d50db19a5c", "url": "https://github.com/realm/realm-java/commit/f2bf9ce67fa36fae4fdc66d5be2201d50db19a5c", "message": "Merge branch 'v10' into el/logcat-obfuscation", "committedDate": "2020-06-23T09:15:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDMwNTYxNA==", "url": "https://github.com/realm/realm-java/pull/6961#discussion_r444305614", "bodyText": "This will not be removed if there is a test failure. It should probably either be in tearDown or in a finally block. Same in the other tests.", "author": "cmelchior", "createdAt": "2020-06-23T15:18:07Z", "path": "realm/realm-library/src/androidTestObjectServer/kotlin/io/realm/internal/network/interceptor/LoggingInterceptorTest.kt", "diffHunk": "@@ -0,0 +1,212 @@\n+/*\n+ * Copyright 2020 Realm Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.realm.internal.network.interceptor\n+\n+import androidx.test.platform.app.InstrumentationRegistry\n+import io.realm.Realm\n+import io.realm.TestApp\n+import io.realm.TestHelper\n+import io.realm.admin.ServerAdmin\n+import io.realm.log.LogLevel\n+import io.realm.log.RealmLog\n+import io.realm.mongodb.App\n+import io.realm.mongodb.Credentials\n+import io.realm.mongodb.RegexObfuscatorPatternFactory\n+import io.realm.mongodb.close\n+import org.bson.Document\n+import org.junit.After\n+import org.junit.Before\n+import org.junit.Test\n+import kotlin.test.assertTrue\n+\n+class LoggingInterceptorTest {\n+\n+    private lateinit var app: App\n+\n+    @Before\n+    fun setUp() {\n+        Realm.init(InstrumentationRegistry.getInstrumentation().targetContext)\n+    }\n+\n+    @After\n+    fun tearDown() {\n+        if (this::app.isInitialized) {\n+            app.close()\n+        }\n+    }\n+\n+    @Test\n+    fun emailPasswordRegistrationAndLogin_noObfuscation() {\n+        app = TestApp()\n+        val testLogger = getLogger()\n+\n+        val email = TestHelper.getRandomEmail()\n+        val password = \"123456\"\n+        app.emailPasswordAuth.registerUser(email, password)\n+        assertTrue(testLogger.message.contains(\"\"\"\n+            \"email\":\"$email\"\n+        \"\"\".trimIndent()))\n+        assertTrue(testLogger.message.contains(\"\"\"\n+            \"password\":\"$password\"\n+        \"\"\".trimIndent()))\n+\n+        app.login(Credentials.emailPassword(email, password))\n+        val usernameLatestMessage = testLogger.message.contains(\"\"\"\n+            \"email\":\"$email\"\n+        \"\"\".trimIndent())\n+        val usernamePreviousMessage = testLogger.previousMessage.contains(\"\"\"\n+            \"username\":\"$email\"\n+        \"\"\".trimIndent())\n+        assertTrue(usernameLatestMessage || usernamePreviousMessage)\n+        val passwordLatestMessage = testLogger.message.contains(\"\"\"\n+            \"password\":\"$password\"\n+        \"\"\".trimIndent())\n+        val passwordPreviousMessage = testLogger.previousMessage.contains(\"\"\"\n+            \"password\":\"$password\"\n+        \"\"\".trimIndent())\n+        assertTrue(passwordLatestMessage || passwordPreviousMessage)\n+\n+        RealmLog.remove(testLogger)", "originalCommit": "f2bf9ce67fa36fae4fdc66d5be2201d50db19a5c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDMwOTI2NQ==", "url": "https://github.com/realm/realm-java/pull/6961#discussion_r444309265", "bodyText": "What about this one? Seems to be missing tests for all the oAuth2 types? We should still be able to test it even if not enabled on the server as long as we catch the exception the server sends and ignore it.", "author": "cmelchior", "createdAt": "2020-06-23T15:22:59Z", "path": "realm/realm-library/src/androidTestObjectServer/kotlin/io/realm/internal/network/interceptor/LoggingInterceptorTest.kt", "diffHunk": "@@ -0,0 +1,212 @@\n+/*\n+ * Copyright 2020 Realm Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.realm.internal.network.interceptor\n+\n+import androidx.test.platform.app.InstrumentationRegistry\n+import io.realm.Realm\n+import io.realm.TestApp\n+import io.realm.TestHelper\n+import io.realm.admin.ServerAdmin\n+import io.realm.log.LogLevel\n+import io.realm.log.RealmLog\n+import io.realm.mongodb.App\n+import io.realm.mongodb.Credentials\n+import io.realm.mongodb.RegexObfuscatorPatternFactory\n+import io.realm.mongodb.close\n+import org.bson.Document\n+import org.junit.After\n+import org.junit.Before\n+import org.junit.Test\n+import kotlin.test.assertTrue\n+\n+class LoggingInterceptorTest {\n+\n+    private lateinit var app: App\n+\n+    @Before\n+    fun setUp() {\n+        Realm.init(InstrumentationRegistry.getInstrumentation().targetContext)\n+    }\n+\n+    @After\n+    fun tearDown() {\n+        if (this::app.isInitialized) {\n+            app.close()\n+        }\n+    }\n+\n+    @Test\n+    fun emailPasswordRegistrationAndLogin_noObfuscation() {\n+        app = TestApp()\n+        val testLogger = getLogger()\n+\n+        val email = TestHelper.getRandomEmail()\n+        val password = \"123456\"\n+        app.emailPasswordAuth.registerUser(email, password)\n+        assertTrue(testLogger.message.contains(\"\"\"\n+            \"email\":\"$email\"\n+        \"\"\".trimIndent()))\n+        assertTrue(testLogger.message.contains(\"\"\"\n+            \"password\":\"$password\"\n+        \"\"\".trimIndent()))\n+\n+        app.login(Credentials.emailPassword(email, password))\n+        val usernameLatestMessage = testLogger.message.contains(\"\"\"\n+            \"email\":\"$email\"\n+        \"\"\".trimIndent())\n+        val usernamePreviousMessage = testLogger.previousMessage.contains(\"\"\"\n+            \"username\":\"$email\"\n+        \"\"\".trimIndent())\n+        assertTrue(usernameLatestMessage || usernamePreviousMessage)\n+        val passwordLatestMessage = testLogger.message.contains(\"\"\"\n+            \"password\":\"$password\"\n+        \"\"\".trimIndent())\n+        val passwordPreviousMessage = testLogger.previousMessage.contains(\"\"\"\n+            \"password\":\"$password\"\n+        \"\"\".trimIndent())\n+        assertTrue(passwordLatestMessage || passwordPreviousMessage)\n+\n+        RealmLog.remove(testLogger)\n+    }\n+\n+    @Test\n+    fun emailPasswordRegistrationAndLogin_obfuscation() {\n+        app = TestApp(loggingInterceptor = LoggingInterceptor.interceptor(RegexObfuscatorPatternFactory.LOGIN_FEATURE))\n+        val testLogger = getLogger()\n+\n+        val email = TestHelper.getRandomEmail()\n+        val password = \"123456\"\n+        app.emailPasswordAuth.registerUser(email, password)\n+        assertTrue(testLogger.message.contains(\"\"\"\n+            \"email\":\"***\"\n+        \"\"\".trimIndent()))\n+        assertTrue(testLogger.message.contains(\"\"\"\n+            \"password\":\"***\"\n+        \"\"\".trimIndent()))\n+\n+        app.login(Credentials.emailPassword(email, password))\n+        val usernameLatestMessage = testLogger.message.contains(\"\"\"\n+            \"username\":\"***\"\n+        \"\"\".trimIndent())\n+        val usernamePreviousMessage = testLogger.previousMessage.contains(\"\"\"\n+            \"username\":\"***\"\n+        \"\"\".trimIndent())\n+        assertTrue(usernameLatestMessage || usernamePreviousMessage)\n+        val passwordLatestMessage = testLogger.message.contains(\"\"\"\n+            \"password\":\"***\"\n+        \"\"\".trimIndent())\n+        val passwordPreviousMessage = testLogger.previousMessage.contains(\"\"\"\n+            \"password\":\"***\"\n+        \"\"\".trimIndent())\n+        assertTrue(passwordLatestMessage || passwordPreviousMessage)\n+\n+        RealmLog.remove(testLogger)\n+    }\n+\n+    @Test\n+    fun apiKeyLogin_noObfuscation() {\n+        app = TestApp()\n+        val testLogger = getLogger()\n+        val admin = ServerAdmin()\n+        val serverKey = admin.createServerApiKey()\n+\n+        app.login(Credentials.serverApiKey(serverKey))\n+        val apiKeyLatestMessage = testLogger.message.contains(\"\"\"\n+            \"key\":\"$serverKey\"\n+        \"\"\".trimIndent())\n+        val apiKeyPreviousMessage = testLogger.previousMessage.contains(\"\"\"\n+            \"key\":\"$serverKey\"\n+        \"\"\".trimIndent())\n+        assertTrue(apiKeyLatestMessage || apiKeyPreviousMessage)\n+    }\n+\n+    @Test\n+    fun apiKeyLogin_obfuscation() {\n+        app = TestApp(loggingInterceptor = LoggingInterceptor.interceptor(RegexObfuscatorPatternFactory.LOGIN_FEATURE))\n+        val testLogger = getLogger()\n+        val admin = ServerAdmin()\n+        val serverKey = admin.createServerApiKey()\n+\n+        app.login(Credentials.serverApiKey(serverKey))\n+        val apiKeyLatestMessage = testLogger.message.contains(\"\"\"\n+            \"key\":\"***\"\n+        \"\"\".trimIndent())\n+        val apiKeyPreviousMessage = testLogger.previousMessage.contains(\"\"\"\n+            \"key\":\"***\"\n+        \"\"\".trimIndent())\n+        assertTrue(apiKeyLatestMessage || apiKeyPreviousMessage)\n+    }\n+\n+    @Test\n+    fun customFunctionLogin_noObfuscation() {\n+        app = TestApp()\n+        val testLogger = getLogger()\n+\n+        val key1 = \"mail\"\n+        val key2 = \"id\"\n+        val value1 = \"myfakemail@mongodb.com\"\n+        val value2 = 666\n+        val customFunction = mapOf(\n+                key1 to value1,\n+                key2 to value2\n+        ).let {\n+            Credentials.customFunction(Document(it))\n+        }\n+\n+        app.login(customFunction)\n+        val customFunctionLatestMessage = testLogger.message.contains(\"\"\"\n+            \"$key1\":\"$value1\"\n+        \"\"\".trimIndent())\n+        val customFunctionPreviousMessage = testLogger.previousMessage.contains(\"\"\"\n+            \"$key1\":\"$value1\"\n+        \"\"\".trimIndent())\n+        assertTrue(customFunctionLatestMessage || customFunctionPreviousMessage)\n+    }\n+\n+    @Test\n+    fun customFunctionLogin_obfuscation() {\n+        app = TestApp(loggingInterceptor = LoggingInterceptor.interceptor(RegexObfuscatorPatternFactory.LOGIN_FEATURE))\n+        val testLogger = getLogger()\n+\n+        val key1 = \"mail\"\n+        val key2 = \"id\"\n+        val value1 = \"myfakemail@mongodb.com\"\n+        val value2 = 666\n+        val customFunction = mapOf(\n+                key1 to value1,\n+                key2 to value2\n+        ).let {\n+            Credentials.customFunction(Document(it))\n+        }\n+\n+        app.login(customFunction)\n+        val customFunctionLatestMessage = testLogger.message.contains(\"\"\"\n+            \"functionArgs\":\"***\"\n+        \"\"\".trimIndent())\n+        val customFunctionPreviousMessage = testLogger.previousMessage.contains(\"\"\"\n+            \"functionArgs\":\"***\"\n+        \"\"\".trimIndent())\n+        assertTrue(customFunctionLatestMessage || customFunctionPreviousMessage)\n+    }\n+\n+    // FIXME: add tests for tokens", "originalCommit": "f2bf9ce67fa36fae4fdc66d5be2201d50db19a5c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDMxMDA5NQ==", "url": "https://github.com/realm/realm-java/pull/6961#discussion_r444310095", "bodyText": "This is not being reset back to LogLevel.WARN when the test ends.", "author": "cmelchior", "createdAt": "2020-06-23T15:24:11Z", "path": "realm/realm-library/src/androidTestObjectServer/kotlin/io/realm/internal/network/interceptor/LoggingInterceptorTest.kt", "diffHunk": "@@ -0,0 +1,212 @@\n+/*\n+ * Copyright 2020 Realm Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.realm.internal.network.interceptor\n+\n+import androidx.test.platform.app.InstrumentationRegistry\n+import io.realm.Realm\n+import io.realm.TestApp\n+import io.realm.TestHelper\n+import io.realm.admin.ServerAdmin\n+import io.realm.log.LogLevel\n+import io.realm.log.RealmLog\n+import io.realm.mongodb.App\n+import io.realm.mongodb.Credentials\n+import io.realm.mongodb.RegexObfuscatorPatternFactory\n+import io.realm.mongodb.close\n+import org.bson.Document\n+import org.junit.After\n+import org.junit.Before\n+import org.junit.Test\n+import kotlin.test.assertTrue\n+\n+class LoggingInterceptorTest {\n+\n+    private lateinit var app: App\n+\n+    @Before\n+    fun setUp() {\n+        Realm.init(InstrumentationRegistry.getInstrumentation().targetContext)\n+    }\n+\n+    @After\n+    fun tearDown() {\n+        if (this::app.isInitialized) {\n+            app.close()\n+        }\n+    }\n+\n+    @Test\n+    fun emailPasswordRegistrationAndLogin_noObfuscation() {\n+        app = TestApp()\n+        val testLogger = getLogger()\n+\n+        val email = TestHelper.getRandomEmail()\n+        val password = \"123456\"\n+        app.emailPasswordAuth.registerUser(email, password)\n+        assertTrue(testLogger.message.contains(\"\"\"\n+            \"email\":\"$email\"\n+        \"\"\".trimIndent()))\n+        assertTrue(testLogger.message.contains(\"\"\"\n+            \"password\":\"$password\"\n+        \"\"\".trimIndent()))\n+\n+        app.login(Credentials.emailPassword(email, password))\n+        val usernameLatestMessage = testLogger.message.contains(\"\"\"\n+            \"email\":\"$email\"\n+        \"\"\".trimIndent())\n+        val usernamePreviousMessage = testLogger.previousMessage.contains(\"\"\"\n+            \"username\":\"$email\"\n+        \"\"\".trimIndent())\n+        assertTrue(usernameLatestMessage || usernamePreviousMessage)\n+        val passwordLatestMessage = testLogger.message.contains(\"\"\"\n+            \"password\":\"$password\"\n+        \"\"\".trimIndent())\n+        val passwordPreviousMessage = testLogger.previousMessage.contains(\"\"\"\n+            \"password\":\"$password\"\n+        \"\"\".trimIndent())\n+        assertTrue(passwordLatestMessage || passwordPreviousMessage)\n+\n+        RealmLog.remove(testLogger)\n+    }\n+\n+    @Test\n+    fun emailPasswordRegistrationAndLogin_obfuscation() {\n+        app = TestApp(loggingInterceptor = LoggingInterceptor.interceptor(RegexObfuscatorPatternFactory.LOGIN_FEATURE))\n+        val testLogger = getLogger()\n+\n+        val email = TestHelper.getRandomEmail()\n+        val password = \"123456\"\n+        app.emailPasswordAuth.registerUser(email, password)\n+        assertTrue(testLogger.message.contains(\"\"\"\n+            \"email\":\"***\"\n+        \"\"\".trimIndent()))\n+        assertTrue(testLogger.message.contains(\"\"\"\n+            \"password\":\"***\"\n+        \"\"\".trimIndent()))\n+\n+        app.login(Credentials.emailPassword(email, password))\n+        val usernameLatestMessage = testLogger.message.contains(\"\"\"\n+            \"username\":\"***\"\n+        \"\"\".trimIndent())\n+        val usernamePreviousMessage = testLogger.previousMessage.contains(\"\"\"\n+            \"username\":\"***\"\n+        \"\"\".trimIndent())\n+        assertTrue(usernameLatestMessage || usernamePreviousMessage)\n+        val passwordLatestMessage = testLogger.message.contains(\"\"\"\n+            \"password\":\"***\"\n+        \"\"\".trimIndent())\n+        val passwordPreviousMessage = testLogger.previousMessage.contains(\"\"\"\n+            \"password\":\"***\"\n+        \"\"\".trimIndent())\n+        assertTrue(passwordLatestMessage || passwordPreviousMessage)\n+\n+        RealmLog.remove(testLogger)\n+    }\n+\n+    @Test\n+    fun apiKeyLogin_noObfuscation() {\n+        app = TestApp()\n+        val testLogger = getLogger()\n+        val admin = ServerAdmin()\n+        val serverKey = admin.createServerApiKey()\n+\n+        app.login(Credentials.serverApiKey(serverKey))\n+        val apiKeyLatestMessage = testLogger.message.contains(\"\"\"\n+            \"key\":\"$serverKey\"\n+        \"\"\".trimIndent())\n+        val apiKeyPreviousMessage = testLogger.previousMessage.contains(\"\"\"\n+            \"key\":\"$serverKey\"\n+        \"\"\".trimIndent())\n+        assertTrue(apiKeyLatestMessage || apiKeyPreviousMessage)\n+    }\n+\n+    @Test\n+    fun apiKeyLogin_obfuscation() {\n+        app = TestApp(loggingInterceptor = LoggingInterceptor.interceptor(RegexObfuscatorPatternFactory.LOGIN_FEATURE))\n+        val testLogger = getLogger()\n+        val admin = ServerAdmin()\n+        val serverKey = admin.createServerApiKey()\n+\n+        app.login(Credentials.serverApiKey(serverKey))\n+        val apiKeyLatestMessage = testLogger.message.contains(\"\"\"\n+            \"key\":\"***\"\n+        \"\"\".trimIndent())\n+        val apiKeyPreviousMessage = testLogger.previousMessage.contains(\"\"\"\n+            \"key\":\"***\"\n+        \"\"\".trimIndent())\n+        assertTrue(apiKeyLatestMessage || apiKeyPreviousMessage)\n+    }\n+\n+    @Test\n+    fun customFunctionLogin_noObfuscation() {\n+        app = TestApp()\n+        val testLogger = getLogger()\n+\n+        val key1 = \"mail\"\n+        val key2 = \"id\"\n+        val value1 = \"myfakemail@mongodb.com\"\n+        val value2 = 666\n+        val customFunction = mapOf(\n+                key1 to value1,\n+                key2 to value2\n+        ).let {\n+            Credentials.customFunction(Document(it))\n+        }\n+\n+        app.login(customFunction)\n+        val customFunctionLatestMessage = testLogger.message.contains(\"\"\"\n+            \"$key1\":\"$value1\"\n+        \"\"\".trimIndent())\n+        val customFunctionPreviousMessage = testLogger.previousMessage.contains(\"\"\"\n+            \"$key1\":\"$value1\"\n+        \"\"\".trimIndent())\n+        assertTrue(customFunctionLatestMessage || customFunctionPreviousMessage)\n+    }\n+\n+    @Test\n+    fun customFunctionLogin_obfuscation() {\n+        app = TestApp(loggingInterceptor = LoggingInterceptor.interceptor(RegexObfuscatorPatternFactory.LOGIN_FEATURE))\n+        val testLogger = getLogger()\n+\n+        val key1 = \"mail\"\n+        val key2 = \"id\"\n+        val value1 = \"myfakemail@mongodb.com\"\n+        val value2 = 666\n+        val customFunction = mapOf(\n+                key1 to value1,\n+                key2 to value2\n+        ).let {\n+            Credentials.customFunction(Document(it))\n+        }\n+\n+        app.login(customFunction)\n+        val customFunctionLatestMessage = testLogger.message.contains(\"\"\"\n+            \"functionArgs\":\"***\"\n+        \"\"\".trimIndent())\n+        val customFunctionPreviousMessage = testLogger.previousMessage.contains(\"\"\"\n+            \"functionArgs\":\"***\"\n+        \"\"\".trimIndent())\n+        assertTrue(customFunctionLatestMessage || customFunctionPreviousMessage)\n+    }\n+\n+    // FIXME: add tests for tokens\n+\n+    private fun getLogger(): TestHelper.TestLogger =\n+            TestHelper.TestLogger().also {\n+                RealmLog.add(it)\n+                RealmLog.setLevel(LogLevel.ALL)", "originalCommit": "f2bf9ce67fa36fae4fdc66d5be2201d50db19a5c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDMxMTY3Ng==", "url": "https://github.com/realm/realm-java/pull/6961#discussion_r444311676", "bodyText": "The more correct term would probably be oAuth2 token related", "author": "cmelchior", "createdAt": "2020-06-23T15:26:17Z", "path": "realm/realm-library/src/main/java/io/realm/internal/obfuscator/TokenObfuscator.java", "diffHunk": "@@ -0,0 +1,70 @@\n+/*\n+ * Copyright 2020 Realm Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.realm.internal.obfuscator;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.regex.Pattern;\n+\n+/**\n+ * Obfuscator for token-related login requests.", "originalCommit": "f2bf9ce67fa36fae4fdc66d5be2201d50db19a5c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDMxNTM1NQ==", "url": "https://github.com/realm/realm-java/pull/6961#discussion_r444315355", "bodyText": "Should we only allow one? If people add their own, it will replace ours, which might be a problem. I'm fine with us starting by just allowing one, but we should probably make clear in the JavaDoc that this is just for Http requests (not logging in general) and that if you replace it you are responsible for obfuscating the details.", "author": "cmelchior", "createdAt": "2020-06-23T15:31:15Z", "path": "realm/realm-library/src/objectServer/java/io/realm/mongodb/AppConfiguration.java", "diffHunk": "@@ -470,6 +485,18 @@ public Builder codecRegistry(CodecRegistry codecRegistry) {\n             return this;\n         }\n \n+        /**\n+         * Sets the {@link LoggingInterceptor} used to keep sensitive data from being displayed in\n+         * the logcat.\n+         *\n+         * @param loggingInterceptor The default login interceptor for the app.\n+         */\n+        public Builder loggingInterceptor(LoggingInterceptor loggingInterceptor) {\n+            Util.checkNull(loggingInterceptor, \"loggingInterceptor\");\n+            this.loggingInterceptor = loggingInterceptor;", "originalCommit": "f2bf9ce67fa36fae4fdc66d5be2201d50db19a5c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDMxNTYwNQ==", "url": "https://github.com/realm/realm-java/pull/6961#discussion_r444315605", "bodyText": "This class is part of the public API, so should have a JavaDoc description", "author": "cmelchior", "createdAt": "2020-06-23T15:31:38Z", "path": "realm/realm-library/src/objectServer/java/io/realm/mongodb/RegexObfuscatorPatternFactory.java", "diffHunk": "@@ -0,0 +1,57 @@\n+/*\n+ * Copyright 2020 Realm Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.realm.mongodb;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import io.realm.internal.obfuscator.ApiKeyObfuscator;\n+import io.realm.internal.obfuscator.CustomFunctionObfuscator;\n+import io.realm.internal.obfuscator.EmailPasswordObfuscator;\n+import io.realm.internal.obfuscator.RegexPatternObfuscator;\n+import io.realm.internal.obfuscator.TokenObfuscator;\n+\n+public class RegexObfuscatorPatternFactory {", "originalCommit": "f2bf9ce67fa36fae4fdc66d5be2201d50db19a5c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDMxNjkzOA==", "url": "https://github.com/realm/realm-java/pull/6961#discussion_r444316938", "bodyText": "I suspect we are not using this anymore? But it feels a bit weird to both send in the network transport and the logging interceptor as arguments, since the logging interceptor is used when configuring the network transport.", "author": "cmelchior", "createdAt": "2020-06-23T15:33:39Z", "path": "realm/realm-library/src/syncTestUtils/kotlin/io/realm/TestApp.kt", "diffHunk": "@@ -29,7 +31,11 @@ import io.realm.mongodb.AppConfiguration\n const val SERVICE_NAME = \"BackingDB\"    // it comes from the test server's BackingDB/config.json\n const val DATABASE_NAME = \"test_data\"   // same as above\n \n-class TestApp(networkTransport: OsJavaNetworkTransport? = null, customizeConfig: (AppConfiguration.Builder) -> Unit = {}) : App(createConfiguration()) {\n+class TestApp(\n+        networkTransport: OsJavaNetworkTransport? = null,", "originalCommit": "f2bf9ce67fa36fae4fdc66d5be2201d50db19a5c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDY4NjM4Mw==", "url": "https://github.com/realm/realm-java/pull/6961#discussion_r444686383", "bodyText": "I made a more general builder approach as part of https://github.com/realm/realm-java/pull/6939/files#diff-f2dd3e47385160ce79724e23a321625eR29 but it has not been merged yet. Concept is that you pass a closure that gets the pre-initialized builder that you can continue to setup and the test app is created from the resulting builder.", "author": "rorbech", "createdAt": "2020-06-24T07:03:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDMxNjkzOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDc5MzA3MQ==", "url": "https://github.com/realm/realm-java/pull/6961#discussion_r444793071", "bodyText": "I like the idea of passing an app config builder better. I didn't know you had written that.", "author": "edualonso", "createdAt": "2020-06-24T10:18:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDMxNjkzOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDc5NjY1Nw==", "url": "https://github.com/realm/realm-java/pull/6961#discussion_r444796657", "bodyText": "I do not expect the PR to be ready for merge soon, so I guess you will just have to clone the concept here, but should be easy as it is only a couple of lines.", "author": "rorbech", "createdAt": "2020-06-24T10:24:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDMxNjkzOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDMxNzQyMw==", "url": "https://github.com/realm/realm-java/pull/6961#discussion_r444317423", "bodyText": "Much nicer to read when indented this way \ud83d\udc4d", "author": "cmelchior", "createdAt": "2020-06-23T15:34:25Z", "path": "realm/realm-library/src/testObjectServer/kotlin/io/realm/internal/obfuscator/ApiKeyObfuscatorTest.kt", "diffHunk": "@@ -0,0 +1,59 @@\n+/*\n+ * Copyright 2020 Realm Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.realm.internal.obfuscator\n+\n+import org.junit.Test\n+import kotlin.test.assertEquals\n+import kotlin.test.assertFailsWith\n+\n+val API_KEY_ORIGINAL_INPUT = \"\"\"\n+{\n+  \"blahblahblah\":\"blehblehbleh\",", "originalCommit": "f2bf9ce67fa36fae4fdc66d5be2201d50db19a5c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDMxNzc5OA==", "url": "https://github.com/realm/realm-java/pull/6961#discussion_r444317798", "bodyText": "Couldn't you just escape the $  with \\$ ?", "author": "cmelchior", "createdAt": "2020-06-23T15:35:00Z", "path": "realm/realm-library/src/testObjectServer/kotlin/io/realm/internal/obfuscator/CustomFunctionObfuscatorTest.kt", "diffHunk": "@@ -0,0 +1,81 @@\n+/*\n+ * Copyright 2020 Realm Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.realm.internal.obfuscator\n+\n+import org.junit.Test\n+import kotlin.test.assertEquals\n+import kotlin.test.assertFailsWith\n+\n+val CUSTOM_FUNCTION_ORIGINAL_INPUT = \"\"\"\n+{\n+  \"mail\":\"myfakemail@mongodb.com\",\n+  \"id\":{\n+    \"{${'$'}}numberInt\": \"666\"", "originalCommit": "f2bf9ce67fa36fae4fdc66d5be2201d50db19a5c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDc5MjgzMw==", "url": "https://github.com/realm/realm-java/pull/6961#discussion_r444792833", "bodyText": "Nope, raw strings require dollar signs to be escaped like this.", "author": "edualonso", "createdAt": "2020-06-24T10:17:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDMxNzc5OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDgwOTI0MQ==", "url": "https://github.com/realm/realm-java/pull/6961#discussion_r444809241", "bodyText": "\ud83e\udd26 Okay \ud83d\ude04", "author": "cmelchior", "createdAt": "2020-06-24T10:51:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDMxNzc5OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDMyNjY1Nw==", "url": "https://github.com/realm/realm-java/pull/6961#discussion_r444326657", "bodyText": "I'm a bit uneasy about this API:\n\nCalling it loggingInterceptor is a bit too generic. It only works for http requests, not all logs. Maybe rename to httpLoggingInterceptor?\nIt taking a LoggingInterceptor as argument is a bit weird as LoggingInterceptor is not an interface but an actual class that people cannot really customize. Should this just have been Interceptor ? But Interceptor is an interface from OkHttp. I would a be a bit uneasy about letting that be part of our public API as we are then bound by that contract.", "author": "cmelchior", "createdAt": "2020-06-23T15:48:06Z", "path": "realm/realm-library/src/objectServer/java/io/realm/mongodb/AppConfiguration.java", "diffHunk": "@@ -470,6 +485,18 @@ public Builder codecRegistry(CodecRegistry codecRegistry) {\n             return this;\n         }\n \n+        /**\n+         * Sets the {@link LoggingInterceptor} used to keep sensitive data from being displayed in\n+         * the logcat.\n+         *\n+         * @param loggingInterceptor The default login interceptor for the app.\n+         */\n+        public Builder loggingInterceptor(LoggingInterceptor loggingInterceptor) {", "originalCommit": "f2bf9ce67fa36fae4fdc66d5be2201d50db19a5c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDc5MjYzMw==", "url": "https://github.com/realm/realm-java/pull/6961#discussion_r444792633", "bodyText": "That is a very valid concern. I guess I should tattoo the Liskov substitution principle in my forehead \ud83d\ude13 .", "author": "edualonso", "createdAt": "2020-06-24T10:17:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDMyNjY1Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDMyOTg5Ng==", "url": "https://github.com/realm/realm-java/pull/6961#discussion_r444329896", "bodyText": "This factory method feels a bit weird to have public? Since it doesn't really work for any other \"feature\"?", "author": "cmelchior", "createdAt": "2020-06-23T15:52:43Z", "path": "realm/realm-library/src/objectServer/java/io/realm/internal/network/interceptor/LoggingInterceptor.java", "diffHunk": "@@ -0,0 +1,110 @@\n+/*\n+ * Copyright 2020 Realm Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.realm.internal.network.interceptor;\n+\n+import java.io.IOException;\n+import java.nio.charset.Charset;\n+import java.util.Map;\n+\n+import javax.annotation.Nullable;\n+\n+import io.realm.log.LogLevel;\n+import io.realm.log.RealmLog;\n+import io.realm.internal.obfuscator.HttpLogObfuscator;\n+import io.realm.internal.obfuscator.RegexPatternObfuscator;\n+import io.realm.mongodb.RegexObfuscatorPatternFactory;\n+import okhttp3.Interceptor;\n+import okhttp3.Request;\n+import okhttp3.Response;\n+import okio.Buffer;\n+\n+/**\n+ * The LoggingInterceptor prints information\n+ */\n+public class LoggingInterceptor implements Interceptor {\n+\n+    private static final Charset UTF8 = Charset.forName(\"UTF-8\");\n+\n+    @Nullable\n+    private HttpLogObfuscator httpLogObfuscator;\n+\n+    private LoggingInterceptor(@Nullable HttpLogObfuscator httpLogObfuscator) {\n+        this.httpLogObfuscator = httpLogObfuscator;\n+    }\n+\n+    @Override\n+    public Response intercept(Chain chain) throws IOException {\n+        Request request = chain.request();\n+        if (RealmLog.getLevel() <= LogLevel.DEBUG) {\n+            StringBuilder sb = new StringBuilder(request.method());\n+            sb.append(' ');\n+            sb.append(request.url());\n+            sb.append('\\n');\n+            sb.append(request.headers());\n+            if (request.body() != null) {\n+                // Stripped down version of https://github.com/square/okhttp/blob/master/okhttp-logging-interceptor/src/main/java/okhttp3/logging/HttpLoggingInterceptor.java\n+                // We only expect request context to be JSON.\n+                Buffer buffer = new Buffer();\n+                request.body().writeTo(buffer);\n+\n+                // Obfuscate sensitive information if applicable\n+                String input = buffer.readString(UTF8);\n+                if (httpLogObfuscator != null) {\n+                    input = httpLogObfuscator.obfuscate(request.url().pathSegments(), input);\n+                }\n+                sb.append(input);\n+            }\n+            RealmLog.debug(\"HTTP Request = \\n%s\", sb);\n+        }\n+        return chain.proceed(request);\n+    }\n+\n+    @Override\n+    public boolean equals(Object o) {\n+        if (this == o) return true;\n+        if (!(o instanceof LoggingInterceptor)) return false;\n+        LoggingInterceptor that = (LoggingInterceptor) o;\n+        if (httpLogObfuscator == null) {\n+            return that.httpLogObfuscator == null;\n+        }\n+        return httpLogObfuscator.equals(that.httpLogObfuscator);\n+    }\n+\n+    @Override\n+    public int hashCode() {\n+        if (httpLogObfuscator == null) {\n+            return super.hashCode();\n+        }\n+        return httpLogObfuscator.hashCode() + 27;\n+    }\n+\n+    /**\n+     * Returns an initialized {@link Interceptor} for a specific feature, e.g. login would be\n+     * {@code providers}.\n+     *\n+     * @param feature the feature to be intercepted or null if no obfuscation is to take place.\n+     * @return the interceptor to be used for logging purposes.\n+     */\n+    public static LoggingInterceptor interceptor(@Nullable String feature) {", "originalCommit": "f2bf9ce67fa36fae4fdc66d5be2201d50db19a5c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "8f9f0c1939f89b4a0acbff611a50513c7a0256ed", "url": "https://github.com/realm/realm-java/commit/8f9f0c1939f89b4a0acbff611a50513c7a0256ed", "message": "Added missing oauth2 token logging tests and removed exposure of OkHttp stuff into the public API - the RegexObfuscatorPatternFactory is still part of the public API though", "committedDate": "2020-06-24T12:24:21Z", "type": "commit"}, {"oid": "1dcc95b23875259eaa004da4473b1ddd1b762b85", "url": "https://github.com/realm/realm-java/commit/1dcc95b23875259eaa004da4473b1ddd1b762b85", "message": "Merge branch 'v10' into el/logcat-obfuscation", "committedDate": "2020-06-24T12:25:34Z", "type": "commit"}, {"oid": "b351e353c50cbc24dbb431ff17518733cd8d9ca5", "url": "https://github.com/realm/realm-java/commit/b351e353c50cbc24dbb431ff17518733cd8d9ca5", "message": "Cleanup", "committedDate": "2020-06-24T12:36:47Z", "type": "commit"}, {"oid": "77b32ff7496261a60d423c171b129a19f3e2bc23", "url": "https://github.com/realm/realm-java/commit/77b32ff7496261a60d423c171b129a19f3e2bc23", "message": "Moved classes to their rightful packages plus a bit of cleanup", "committedDate": "2020-06-25T08:32:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODE0MDU2NQ==", "url": "https://github.com/realm/realm-java/pull/6961#discussion_r448140565", "bodyText": "You should probably check for the error code as this might hide a number of other errors.", "author": "cmelchior", "createdAt": "2020-07-01T06:24:19Z", "path": "realm/realm-library/src/androidTestObjectServer/kotlin/io/realm/internal/network/LoggingInterceptorTest.kt", "diffHunk": "@@ -0,0 +1,268 @@\n+/*\n+ * Copyright 2020 Realm Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.realm.internal.network\n+\n+import androidx.test.platform.app.InstrumentationRegistry\n+import io.realm.Realm\n+import io.realm.TestApp\n+import io.realm.TestHelper\n+import io.realm.admin.ServerAdmin\n+import io.realm.log.LogLevel\n+import io.realm.log.RealmLog\n+import io.realm.mongodb.App\n+import io.realm.mongodb.AppException\n+import io.realm.mongodb.Credentials\n+import io.realm.mongodb.close\n+import io.realm.mongodb.log.obfuscator.HttpLogObfuscator\n+import io.realm.mongodb.log.obfuscator.RegexPatternObfuscatorFactory\n+import io.realm.mongodb.log.obfuscator.RegexPatternObfuscatorFactory.LOGIN_FEATURE\n+import org.bson.Document\n+import org.junit.After\n+import org.junit.Before\n+import org.junit.Test\n+import kotlin.test.assertTrue\n+\n+class LoggingInterceptorTest {\n+\n+    private lateinit var app: App\n+    private lateinit var testLogger: TestHelper.TestLogger\n+\n+    @Before\n+    fun setUp() {\n+        Realm.init(InstrumentationRegistry.getInstrumentation().targetContext)\n+    }\n+\n+    @After\n+    fun tearDown() {\n+        if (this::app.isInitialized) {\n+            app.close()\n+        }\n+        if (this::testLogger.isInitialized) {\n+            RealmLog.setLevel(LogLevel.WARN)\n+            RealmLog.remove(testLogger)\n+        }\n+    }\n+\n+    @Test\n+    fun emailPasswordRegistrationAndLogin_noObfuscation() {\n+        app = TestApp()\n+        testLogger = getLogger()\n+\n+        val email = TestHelper.getRandomEmail()\n+        val password = \"123456\"\n+        app.emailPasswordAuth.registerUser(email, password)\n+        assertMessageExists(\"\"\"\"email\":\"$email\"\"\"\", \"\"\"\"password\":\"$password\"\"\"\")\n+\n+        app.login(Credentials.emailPassword(email, password))\n+        assertMessageExists(\"\"\"\"username\":\"$email\"\"\"\", \"\"\"\"password\":\"$password\"\"\"\")\n+    }\n+\n+    @Test\n+    fun emailPasswordRegistrationAndLogin_obfuscation() {\n+        app = TestApp { builder ->\n+            builder.httpLogObfuscator(HttpLogObfuscator(LOGIN_FEATURE, RegexPatternObfuscatorFactory.getObfuscators(LOGIN_FEATURE)))\n+        }\n+        testLogger = getLogger()\n+\n+        val email = TestHelper.getRandomEmail()\n+        val password = \"123456\"\n+        app.emailPasswordAuth.registerUser(email, password)\n+        assertMessageExists(\"\"\"\"email\":\"***\"\"\"\", \"\"\"\"password\":\"***\"\"\"\")\n+\n+        app.login(Credentials.emailPassword(email, password))\n+        assertMessageExists(\"\"\"\"username\":\"***\"\"\"\", \"\"\"\"password\":\"***\"\"\"\")\n+    }\n+\n+    @Test\n+    fun apiKeyLogin_noObfuscation() {\n+        app = TestApp()\n+        testLogger = getLogger()\n+        val admin = ServerAdmin()\n+        val serverKey = admin.createServerApiKey()\n+\n+        app.login(Credentials.serverApiKey(serverKey))\n+        assertMessageExists(\"\"\"\"key\":\"$serverKey\"\"\"\")\n+    }\n+\n+    @Test\n+    fun apiKeyLogin_obfuscation() {\n+        app = TestApp { builder ->\n+            builder.httpLogObfuscator(HttpLogObfuscator(LOGIN_FEATURE, RegexPatternObfuscatorFactory.getObfuscators(LOGIN_FEATURE)))\n+        }\n+        testLogger = getLogger()\n+        val admin = ServerAdmin()\n+        val serverKey = admin.createServerApiKey()\n+\n+        app.login(Credentials.serverApiKey(serverKey))\n+        assertMessageExists(\"\"\"\"key\":\"***\"\"\"\")\n+    }\n+\n+    @Test\n+    fun customFunctionLogin_noObfuscation() {\n+        app = TestApp()\n+        testLogger = getLogger()\n+\n+        val key1 = \"mail\"\n+        val key2 = \"id\"\n+        val value1 = \"myfakemail@mongodb.com\"\n+        val value2 = 666\n+        val customFunction = mapOf(\n+                key1 to value1,\n+                key2 to value2\n+        ).let {\n+            Credentials.customFunction(Document(it))\n+        }\n+\n+        app.login(customFunction)\n+        assertMessageExists(\"\"\"\"$key1\":\"$value1\"\"\"\")\n+    }\n+\n+    @Test\n+    fun customFunctionLogin_obfuscation() {\n+        app = TestApp { builder ->\n+            builder.httpLogObfuscator(HttpLogObfuscator(LOGIN_FEATURE, RegexPatternObfuscatorFactory.getObfuscators(LOGIN_FEATURE)))\n+        }\n+        testLogger = getLogger()\n+\n+        val key1 = \"mail\"\n+        val key2 = \"id\"\n+        val value1 = \"myfakemail@mongodb.com\"\n+        val value2 = 666\n+        val customFunction = mapOf(\n+                key1 to value1,\n+                key2 to value2\n+        ).let { credsMap ->\n+            Credentials.customFunction(Document(credsMap))\n+        }\n+\n+        app.login(customFunction)\n+        assertMessageExists(\"\"\"\"functionArgs\":\"***\"\"\"\")\n+    }\n+\n+    @Test\n+    fun facebookTokenLogin_noObfuscation() {\n+        app = TestApp()\n+        testLogger = getLogger()\n+        val token = \"facebook-token\"\n+\n+        try {\n+            app.login(Credentials.facebook(token))\n+        } catch (error: AppException) {\n+            // It will fail as long as oauth2 tokens aren't supported\n+        } finally {\n+            assertMessageExists(\"\"\"\"access_token\":\"$token\"\"\"\")\n+        }\n+    }\n+\n+    @Test\n+    fun facebookTokenLogin_obfuscation() {\n+        app = TestApp { builder ->\n+            builder.httpLogObfuscator(HttpLogObfuscator(LOGIN_FEATURE, RegexPatternObfuscatorFactory.getObfuscators(LOGIN_FEATURE)))\n+        }\n+        testLogger = getLogger()\n+        val token = \"facebook-token\"\n+\n+        try {\n+            app.login(Credentials.facebook(token))\n+        } catch (error: AppException) {\n+            // It will fail as long as oauth2 tokens aren't supported", "originalCommit": "77b32ff7496261a60d423c171b129a19f3e2bc23", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODE0MDY3NQ==", "url": "https://github.com/realm/realm-java/pull/6961#discussion_r448140675", "bodyText": "Same also in other tests below", "author": "cmelchior", "createdAt": "2020-07-01T06:24:37Z", "path": "realm/realm-library/src/androidTestObjectServer/kotlin/io/realm/internal/network/LoggingInterceptorTest.kt", "diffHunk": "@@ -0,0 +1,268 @@\n+/*\n+ * Copyright 2020 Realm Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.realm.internal.network\n+\n+import androidx.test.platform.app.InstrumentationRegistry\n+import io.realm.Realm\n+import io.realm.TestApp\n+import io.realm.TestHelper\n+import io.realm.admin.ServerAdmin\n+import io.realm.log.LogLevel\n+import io.realm.log.RealmLog\n+import io.realm.mongodb.App\n+import io.realm.mongodb.AppException\n+import io.realm.mongodb.Credentials\n+import io.realm.mongodb.close\n+import io.realm.mongodb.log.obfuscator.HttpLogObfuscator\n+import io.realm.mongodb.log.obfuscator.RegexPatternObfuscatorFactory\n+import io.realm.mongodb.log.obfuscator.RegexPatternObfuscatorFactory.LOGIN_FEATURE\n+import org.bson.Document\n+import org.junit.After\n+import org.junit.Before\n+import org.junit.Test\n+import kotlin.test.assertTrue\n+\n+class LoggingInterceptorTest {\n+\n+    private lateinit var app: App\n+    private lateinit var testLogger: TestHelper.TestLogger\n+\n+    @Before\n+    fun setUp() {\n+        Realm.init(InstrumentationRegistry.getInstrumentation().targetContext)\n+    }\n+\n+    @After\n+    fun tearDown() {\n+        if (this::app.isInitialized) {\n+            app.close()\n+        }\n+        if (this::testLogger.isInitialized) {\n+            RealmLog.setLevel(LogLevel.WARN)\n+            RealmLog.remove(testLogger)\n+        }\n+    }\n+\n+    @Test\n+    fun emailPasswordRegistrationAndLogin_noObfuscation() {\n+        app = TestApp()\n+        testLogger = getLogger()\n+\n+        val email = TestHelper.getRandomEmail()\n+        val password = \"123456\"\n+        app.emailPasswordAuth.registerUser(email, password)\n+        assertMessageExists(\"\"\"\"email\":\"$email\"\"\"\", \"\"\"\"password\":\"$password\"\"\"\")\n+\n+        app.login(Credentials.emailPassword(email, password))\n+        assertMessageExists(\"\"\"\"username\":\"$email\"\"\"\", \"\"\"\"password\":\"$password\"\"\"\")\n+    }\n+\n+    @Test\n+    fun emailPasswordRegistrationAndLogin_obfuscation() {\n+        app = TestApp { builder ->\n+            builder.httpLogObfuscator(HttpLogObfuscator(LOGIN_FEATURE, RegexPatternObfuscatorFactory.getObfuscators(LOGIN_FEATURE)))\n+        }\n+        testLogger = getLogger()\n+\n+        val email = TestHelper.getRandomEmail()\n+        val password = \"123456\"\n+        app.emailPasswordAuth.registerUser(email, password)\n+        assertMessageExists(\"\"\"\"email\":\"***\"\"\"\", \"\"\"\"password\":\"***\"\"\"\")\n+\n+        app.login(Credentials.emailPassword(email, password))\n+        assertMessageExists(\"\"\"\"username\":\"***\"\"\"\", \"\"\"\"password\":\"***\"\"\"\")\n+    }\n+\n+    @Test\n+    fun apiKeyLogin_noObfuscation() {\n+        app = TestApp()\n+        testLogger = getLogger()\n+        val admin = ServerAdmin()\n+        val serverKey = admin.createServerApiKey()\n+\n+        app.login(Credentials.serverApiKey(serverKey))\n+        assertMessageExists(\"\"\"\"key\":\"$serverKey\"\"\"\")\n+    }\n+\n+    @Test\n+    fun apiKeyLogin_obfuscation() {\n+        app = TestApp { builder ->\n+            builder.httpLogObfuscator(HttpLogObfuscator(LOGIN_FEATURE, RegexPatternObfuscatorFactory.getObfuscators(LOGIN_FEATURE)))\n+        }\n+        testLogger = getLogger()\n+        val admin = ServerAdmin()\n+        val serverKey = admin.createServerApiKey()\n+\n+        app.login(Credentials.serverApiKey(serverKey))\n+        assertMessageExists(\"\"\"\"key\":\"***\"\"\"\")\n+    }\n+\n+    @Test\n+    fun customFunctionLogin_noObfuscation() {\n+        app = TestApp()\n+        testLogger = getLogger()\n+\n+        val key1 = \"mail\"\n+        val key2 = \"id\"\n+        val value1 = \"myfakemail@mongodb.com\"\n+        val value2 = 666\n+        val customFunction = mapOf(\n+                key1 to value1,\n+                key2 to value2\n+        ).let {\n+            Credentials.customFunction(Document(it))\n+        }\n+\n+        app.login(customFunction)\n+        assertMessageExists(\"\"\"\"$key1\":\"$value1\"\"\"\")\n+    }\n+\n+    @Test\n+    fun customFunctionLogin_obfuscation() {\n+        app = TestApp { builder ->\n+            builder.httpLogObfuscator(HttpLogObfuscator(LOGIN_FEATURE, RegexPatternObfuscatorFactory.getObfuscators(LOGIN_FEATURE)))\n+        }\n+        testLogger = getLogger()\n+\n+        val key1 = \"mail\"\n+        val key2 = \"id\"\n+        val value1 = \"myfakemail@mongodb.com\"\n+        val value2 = 666\n+        val customFunction = mapOf(\n+                key1 to value1,\n+                key2 to value2\n+        ).let { credsMap ->\n+            Credentials.customFunction(Document(credsMap))\n+        }\n+\n+        app.login(customFunction)\n+        assertMessageExists(\"\"\"\"functionArgs\":\"***\"\"\"\")\n+    }\n+\n+    @Test\n+    fun facebookTokenLogin_noObfuscation() {\n+        app = TestApp()\n+        testLogger = getLogger()\n+        val token = \"facebook-token\"\n+\n+        try {\n+            app.login(Credentials.facebook(token))\n+        } catch (error: AppException) {\n+            // It will fail as long as oauth2 tokens aren't supported\n+        } finally {\n+            assertMessageExists(\"\"\"\"access_token\":\"$token\"\"\"\")\n+        }\n+    }\n+\n+    @Test\n+    fun facebookTokenLogin_obfuscation() {\n+        app = TestApp { builder ->\n+            builder.httpLogObfuscator(HttpLogObfuscator(LOGIN_FEATURE, RegexPatternObfuscatorFactory.getObfuscators(LOGIN_FEATURE)))\n+        }\n+        testLogger = getLogger()\n+        val token = \"facebook-token\"\n+\n+        try {\n+            app.login(Credentials.facebook(token))\n+        } catch (error: AppException) {\n+            // It will fail as long as oauth2 tokens aren't supported\n+        } finally {\n+            assertMessageExists(\"\"\"\"access_token\":\"***\"\"\"\")\n+        }\n+    }\n+\n+    @Test\n+    fun appleTokenLogin_noObfuscation() {\n+        app = TestApp()\n+        testLogger = getLogger()\n+        val token = \"apple-token\"\n+\n+        try {\n+            app.login(Credentials.apple(token))\n+        } catch (error: AppException) {\n+            // It will fail as long as oauth2 tokens aren't supported", "originalCommit": "77b32ff7496261a60d423c171b129a19f3e2bc23", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODE0MTAzNA==", "url": "https://github.com/realm/realm-java/pull/6961#discussion_r448141034", "bodyText": "This should be marked @nullable", "author": "cmelchior", "createdAt": "2020-07-01T06:25:27Z", "path": "realm/realm-library/src/objectServer/java/io/realm/mongodb/AppConfiguration.java", "diffHunk": "@@ -223,11 +231,22 @@ public File getSyncRootDirectory() {\n      * {@link io.realm.mongodb.mongo.MongoDatabase}.\n      *\n      * @return The default codec registry for the App.\n-     *\n      * @see #DEFAULT_BSON_CODEC_REGISTRY\n      * @see Builder#getDefaultCodecRegistry()\n      */\n-    public CodecRegistry getDefaultCodecRegistry() { return codecRegistry; }\n+    public CodecRegistry getDefaultCodecRegistry() {\n+        return codecRegistry;\n+    }\n+\n+    /**\n+     * Returns the {@link HttpLogObfuscator} used in the app, which keeps sensitive information in\n+     * HTTP requests from being displayed in the logcat.\n+     *\n+     * @return the HTTP log obfuscator.\n+     */\n+    public HttpLogObfuscator getHttpLogObfuscator() {", "originalCommit": "77b32ff7496261a60d423c171b129a19f3e2bc23", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODE0MTE2Ng==", "url": "https://github.com/realm/realm-java/pull/6961#discussion_r448141166", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                     * @param headerName  the name of the header.\n          \n          \n            \n                     * @param headerName the name of the header.", "author": "cmelchior", "createdAt": "2020-07-01T06:25:46Z", "path": "realm/realm-library/src/objectServer/java/io/realm/mongodb/AppConfiguration.java", "diffHunk": "@@ -378,7 +400,7 @@ public Builder authorizationHeaderName(String headerName) {\n         /**\n          * Adds an extra HTTP header to append to every request to a Realm Object Server.\n          *\n-         * @param headerName the name of the header.\n+         * @param headerName  the name of the header.", "originalCommit": "77b32ff7496261a60d423c171b129a19f3e2bc23", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODIyNDIyNA==", "url": "https://github.com/realm/realm-java/pull/6961#discussion_r448224224", "bodyText": "This was the autoformatter, it indented both lines for the parameters to make them look cool.", "author": "edualonso", "createdAt": "2020-07-01T09:05:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODE0MTE2Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODE3NTY2Nw==", "url": "https://github.com/realm/realm-java/pull/6961#discussion_r448175667", "bodyText": "I thought you decided to keep all these implementations outside the public API?", "author": "cmelchior", "createdAt": "2020-07-01T07:40:14Z", "path": "realm/realm-library/src/objectServer/java/io/realm/mongodb/log/obfuscator/ApiKeyObfuscator.java", "diffHunk": "@@ -0,0 +1,50 @@\n+/*\n+ * Copyright 2020 Realm Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.realm.mongodb.log.obfuscator;", "originalCommit": "77b32ff7496261a60d423c171b129a19f3e2bc23", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODI3MzM3Nw==", "url": "https://github.com/realm/realm-java/pull/6961#discussion_r448273377", "bodyText": "It seems I forgot to push my last commit. I moved this one to internal.log.obfuscator.", "author": "edualonso", "createdAt": "2020-07-01T10:35:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODE3NTY2Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODE3NjI0OA==", "url": "https://github.com/realm/realm-java/pull/6961#discussion_r448176248", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             * The HttpLogObfuscator keeps sensitive information from being displayed in the logcat.\n          \n          \n            \n             * The HttpLogObfuscator keeps sensitive information from being displayed in Logcat.", "author": "cmelchior", "createdAt": "2020-07-01T07:41:18Z", "path": "realm/realm-library/src/objectServer/java/io/realm/mongodb/log/obfuscator/HttpLogObfuscator.java", "diffHunk": "@@ -0,0 +1,79 @@\n+/*\n+ * Copyright 2020 Realm Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.realm.mongodb.log.obfuscator;\n+\n+import java.util.List;\n+import java.util.Map;\n+\n+import io.realm.internal.Util;\n+\n+/**\n+ * The HttpLogObfuscator keeps sensitive information from being displayed in the logcat.", "originalCommit": "77b32ff7496261a60d423c171b129a19f3e2bc23", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODE3NjUyNg==", "url": "https://github.com/realm/realm-java/pull/6961#discussion_r448176526", "bodyText": "This isn't a well-defined term, so probably a little more description.", "author": "cmelchior", "createdAt": "2020-07-01T07:41:56Z", "path": "realm/realm-library/src/objectServer/java/io/realm/mongodb/log/obfuscator/HttpLogObfuscator.java", "diffHunk": "@@ -0,0 +1,79 @@\n+/*\n+ * Copyright 2020 Realm Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.realm.mongodb.log.obfuscator;\n+\n+import java.util.List;\n+import java.util.Map;\n+\n+import io.realm.internal.Util;\n+\n+/**\n+ * The HttpLogObfuscator keeps sensitive information from being displayed in the logcat.\n+ */\n+public class HttpLogObfuscator {\n+\n+    private String feature;\n+    private Map<String, RegexPatternObfuscator> patternObfuscatorMap;\n+\n+    /**\n+     * Constructor for creating an HTTP log obfuscator.\n+     *\n+     * @param feature              the feature to obfuscate.", "originalCommit": "77b32ff7496261a60d423c171b129a19f3e2bc23", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODE3Njg1Ng==", "url": "https://github.com/realm/realm-java/pull/6961#discussion_r448176856", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             * The obfuscator removes sensitive information from logcat entries.\n          \n          \n            \n             * The obfuscator removes sensitive information from Logcat entries.", "author": "cmelchior", "createdAt": "2020-07-01T07:42:30Z", "path": "realm/realm-library/src/objectServer/java/io/realm/mongodb/log/obfuscator/RegexPatternObfuscator.java", "diffHunk": "@@ -0,0 +1,75 @@\n+/*\n+ * Copyright 2020 Realm Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.realm.mongodb.log.obfuscator;\n+\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+\n+import io.realm.internal.Util;\n+\n+/**\n+ * The obfuscator removes sensitive information from logcat entries.", "originalCommit": "77b32ff7496261a60d423c171b129a19f3e2bc23", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODE3OTE3Ng==", "url": "https://github.com/realm/realm-java/pull/6961#discussion_r448179176", "bodyText": "Not 100% sure why this class is public? Despite it's name it cannot really construct anything since only the LOGIN feature is allowed, so what would end users use this for? Couldn't this just be implemented as static information in AppConfiguration?", "author": "cmelchior", "createdAt": "2020-07-01T07:46:52Z", "path": "realm/realm-library/src/objectServer/java/io/realm/mongodb/log/obfuscator/RegexPatternObfuscatorFactory.java", "diffHunk": "@@ -0,0 +1,63 @@\n+/*\n+ * Copyright 2020 Realm Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.realm.mongodb.log.obfuscator;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import io.realm.mongodb.Credentials;\n+\n+/**\n+ * The RegexPatternObfuscatorFactory provides the {@link RegexPatternObfuscator}s needed to\n+ * obfuscate HTTP requests being logged for a particular feature.\n+ */\n+public class RegexPatternObfuscatorFactory {", "originalCommit": "77b32ff7496261a60d423c171b129a19f3e2bc23", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "069e8025d48ee7c8f94d3dec832e0b61944a89ce", "url": "https://github.com/realm/realm-java/commit/069e8025d48ee7c8f94d3dec832e0b61944a89ce", "message": "Merge branch 'v10' into el/logcat-obfuscation\n\n# Conflicts:\n#\trealm/realm-library/src/syncTestUtils/kotlin/io/realm/TestApp.kt", "committedDate": "2020-07-01T10:35:23Z", "type": "commit"}, {"oid": "a728ad4bd0f1a915badcdfdbf55c69430bb3483e", "url": "https://github.com/realm/realm-java/commit/a728ad4bd0f1a915badcdfdbf55c69430bb3483e", "message": "Made obfuscators final", "committedDate": "2020-07-01T18:57:09Z", "type": "commit"}, {"oid": "326d121f59b44074d3ed530c56f56f27def89dc6", "url": "https://github.com/realm/realm-java/commit/326d121f59b44074d3ed530c56f56f27def89dc6", "message": "Findbugs fix", "committedDate": "2020-07-01T19:40:27Z", "type": "commit"}, {"oid": "6701defeb59c25fd50363b44ed54bb418fce92d8", "url": "https://github.com/realm/realm-java/commit/6701defeb59c25fd50363b44ed54bb418fce92d8", "message": "Merge branch 'v10' into el/logcat-obfuscation", "committedDate": "2020-07-03T13:24:25Z", "type": "commit"}, {"oid": "e925718da261ec9792cce2b8174ba1c91c7f136a", "url": "https://github.com/realm/realm-java/commit/e925718da261ec9792cce2b8174ba1c91c7f136a", "message": "Updated changelog", "committedDate": "2020-07-03T13:33:40Z", "type": "commit"}, {"oid": "6b53a1526a676b0f049d0f60ed2b7e06224f2d4a", "url": "https://github.com/realm/realm-java/commit/6b53a1526a676b0f049d0f60ed2b7e06224f2d4a", "message": "Merge branch 'v10' into el/logcat-obfuscation", "committedDate": "2020-07-03T13:55:01Z", "type": "commit"}]}