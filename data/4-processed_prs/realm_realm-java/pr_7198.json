{"pr_number": 7198, "pr_title": "Fix wrong logic in annotation processor for generating ObjectId PKs", "pr_createdAt": "2020-11-12T09:41:06Z", "pr_url": "https://github.com/realm/realm-java/pull/7198", "timeline": [{"oid": "32076c821291a1ff88bbfd47b036fc683d1c4408", "url": "https://github.com/realm/realm-java/commit/32076c821291a1ff88bbfd47b036fc683d1c4408", "message": "Fixed wrong logic in annotation processor that typecast a string directly into an ObjectId, plus corrected tests that failed and added test for object creation from json with an ObjectId PK", "committedDate": "2020-11-12T09:33:21Z", "type": "commit"}, {"oid": "8994719f8518a2956f73041e58e708323b51c3e6", "url": "https://github.com/realm/realm-java/commit/8994719f8518a2956f73041e58e708323b51c3e6", "message": "Results aren't sorted and can't sort them as the default constructor for ObjectId assigns an id at random so it is better to remove the second element, which is not really used in the test.", "committedDate": "2020-11-12T12:18:25Z", "type": "commit"}, {"oid": "6dabc9c33cc2f0e80b465752eebaa3f67c75e423", "url": "https://github.com/realm/realm-java/commit/6dabc9c33cc2f0e80b465752eebaa3f67c75e423", "message": "Updated changelog", "committedDate": "2020-11-12T12:45:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjE4NDk4NA==", "url": "https://github.com/realm/realm-java/pull/7198#discussion_r522184984", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            * Fixed crash when creating proxy classes containing an `ObjectId` as primary key (Issue [#7197](https://github.com/realm/realm-java/issues/7197), since v10.0.0).\n          \n          \n            \n            * Fixed crash when creating proxy classes containing an `ObjectId` as primary key. (Issue [#7197](https://github.com/realm/realm-java/issues/7197), since v10.0.0).", "author": "cmelchior", "createdAt": "2020-11-12T15:18:03Z", "path": "CHANGELOG.md", "diffHunk": "@@ -8,6 +8,7 @@\n \n ### Fixes\n * Fixed crash when adding classes containing an `ObjectId` as primary key to the schema (Issue [#7189](https://github.com/realm/realm-java/issues/7189), since v10.0.0).\n+* Fixed crash when creating proxy classes containing an `ObjectId` as primary key (Issue [#7197](https://github.com/realm/realm-java/issues/7197), since v10.0.0).", "originalCommit": "6dabc9c33cc2f0e80b465752eebaa3f67c75e423", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjE4NTA5MA==", "url": "https://github.com/realm/realm-java/pull/7198#discussion_r522185090", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            * Fixed crash when adding classes containing an `ObjectId` as primary key to the schema (Issue [#7189](https://github.com/realm/realm-java/issues/7189), since v10.0.0).\n          \n          \n            \n            * Fixed crash when adding classes containing an `ObjectId` as primary key to the schema. (Issue [#7189](https://github.com/realm/realm-java/issues/7189), since v10.0.0).", "author": "cmelchior", "createdAt": "2020-11-12T15:18:12Z", "path": "CHANGELOG.md", "diffHunk": "@@ -8,6 +8,7 @@\n \n ### Fixes\n * Fixed crash when adding classes containing an `ObjectId` as primary key to the schema (Issue [#7189](https://github.com/realm/realm-java/issues/7189), since v10.0.0).", "originalCommit": "6dabc9c33cc2f0e80b465752eebaa3f67c75e423", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjE4NTY4MQ==", "url": "https://github.com/realm/realm-java/pull/7198#discussion_r522185681", "bodyText": "This is only used in one place, so maybe just inline the variable there?", "author": "cmelchior", "createdAt": "2020-11-12T15:19:00Z", "path": "realm/realm-annotations-processor/src/main/java/io/realm/processor/RealmProxyClassGenerator.kt", "diffHunk": "@@ -2097,14 +2098,23 @@ class RealmProxyClassGenerator(private val processingEnvironment: ProcessingEnvi\n                     var pkType = \"Long\"\n                     var jsonAccessorMethodSuffix = \"Long\"\n                     var findFirstCast = \"\"\n+                    var constructor = \"\"\n                     if (Utils.isString(metadata.primaryKey)) {\n                         pkType = \"String\"\n                         jsonAccessorMethodSuffix=  \"String\"\n                     } else if (Utils.isObjectId(metadata.primaryKey)) {\n                         pkType = \"ObjectId\"\n                         findFirstCast = \"(org.bson.types.ObjectId)\"\n                         jsonAccessorMethodSuffix = \"\"\n+                        constructor = \"org.bson.types.ObjectId\"", "originalCommit": "6dabc9c33cc2f0e80b465752eebaa3f67c75e423", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "75788c30f3f221d064507c360e168031b6ed9238", "url": "https://github.com/realm/realm-java/commit/75788c30f3f221d064507c360e168031b6ed9238", "message": "Cleanup", "committedDate": "2020-11-12T17:08:30Z", "type": "commit"}]}