{"pr_number": 7241, "pr_title": "Consume monorepo core binaries", "pr_createdAt": "2020-12-09T17:37:40Z", "pr_url": "https://github.com/realm/realm-java/pull/7241", "timeline": [{"oid": "65130524043b17acdf0aabaa3c36d0361c2c96fb", "url": "https://github.com/realm/realm-java/commit/65130524043b17acdf0aabaa3c36d0361c2c96fb", "message": "RJAVA-564: Use monorepo (#7146)\n\n* Use monorepo\r\n\r\n* Use newer CMake\r\n\r\n* use latest monorepo\r\n\r\n* Point to right cmake version\r\nJenkins to use right cmake version\r\nFix imports and executables linking\r\n\r\n* Fix cmake url\r\n\r\n* Add ninja-build package to docker image\r\n\r\n* Add new cmake instructions to readme\r\n\r\n* don\u2019t worry about realm-core\u2019s command-line targets\r\n\r\n* use latest monorepo\r\n\r\n* Add support for LTO. It is enabled by default for release builds, but can be opted out of.\r\n\r\n* Rename abiFilter to indicate it support multiple flags\r\n\r\n* Set an optimization level, it is required when enabling LTO.\r\n\r\n* Bump core commit\r\n\r\n* Bump monorepo core version\r\n\r\n* rollback mongodb realm server version\r\n\r\n* Fix checkstyle step in Jenkins file\r\n\r\n* remove the gradle logic to download core\r\n\r\nthis should be moved to CMake\r\n\r\nCo-authored-by: Clemente Tort <clementetb@gmail.com>\r\nCo-authored-by: Christian Melchior <christian@ilios.dk>", "committedDate": "2020-11-09T12:08:07Z", "type": "commit"}, {"oid": "d80a23e709e5feded782358d771039f41208908b", "url": "https://github.com/realm/realm-java/commit/d80a23e709e5feded782358d771039f41208908b", "message": "Update license. Remove Realm Component license. (#7194)", "committedDate": "2020-11-12T05:53:42Z", "type": "commit"}, {"oid": "fad5fdc4cefd13175ac4cc05c94aad3e10ce19b7", "url": "https://github.com/realm/realm-java/commit/fad5fdc4cefd13175ac4cc05c94aad3e10ce19b7", "message": "Merge branch 'master' into support-new-datatypes\n\n# Conflicts:\n#\trealm/realm-library/src/main/cpp/object-store", "committedDate": "2020-11-24T16:25:09Z", "type": "commit"}, {"oid": "64fd2b1f026d30f523950ed78dc8521801de4275", "url": "https://github.com/realm/realm-java/commit/64fd2b1f026d30f523950ed78dc8521801de4275", "message": "Added temporarily missing dictionary and mixed type functions to java_object_accessor", "committedDate": "2020-11-26T10:04:40Z", "type": "commit"}, {"oid": "87f243958acd6dd1a2479754a03b6c8d229e6c85", "url": "https://github.com/realm/realm-java/commit/87f243958acd6dd1a2479754a03b6c8d229e6c85", "message": "Merge master in", "committedDate": "2020-12-09T13:50:57Z", "type": "commit"}, {"oid": "40c4051a04f0c1255f16c2830e65f22ad8b06972", "url": "https://github.com/realm/realm-java/commit/40c4051a04f0c1255f16c2830e65f22ad8b06972", "message": "Add support for consuming realm-core binaries", "committedDate": "2020-12-09T17:31:16Z", "type": "commit"}, {"oid": "d10ecc7262a8692fb61b140494211c156dae9d7f", "url": "https://github.com/realm/realm-java/commit/d10ecc7262a8692fb61b140494211c156dae9d7f", "message": "Force building from sources on base", "committedDate": "2020-12-09T18:10:11Z", "type": "commit"}, {"oid": "554d677bde67ce00967a13fb486c886a32fc5d2c", "url": "https://github.com/realm/realm-java/commit/554d677bde67ce00967a13fb486c886a32fc5d2c", "message": "Rename LTO switch property", "committedDate": "2020-12-09T18:12:26Z", "type": "commit"}, {"oid": "2f79643b04c155dc50b9c551d330ef6fdf792698", "url": "https://github.com/realm/realm-java/commit/2f79643b04c155dc50b9c551d330ef6fdf792698", "message": "Update Jenkins file to consume binaries when testing, and build core with LTO enabled on release.", "committedDate": "2020-12-09T18:13:24Z", "type": "commit"}, {"oid": "cd63a1709ec3a7e8e1d17eb0432a7db372ecc2cc", "url": "https://github.com/realm/realm-java/commit/cd63a1709ec3a7e8e1d17eb0432a7db372ecc2cc", "message": "Allow to cache binary resources\nEnable LTO optimizations by default", "committedDate": "2020-12-10T13:01:41Z", "type": "commit"}, {"oid": "8e0e3ca3cb33b039de9ffbbf5118de81a8295cf0", "url": "https://github.com/realm/realm-java/commit/8e0e3ca3cb33b039de9ffbbf5118de81a8295cf0", "message": "Use system env variable for defining the core download dir\nFix gradle not picking up boolean values", "committedDate": "2020-12-10T14:55:46Z", "type": "commit"}, {"oid": "87664eb1b9fff36950c7885bd5d0acaed971200b", "url": "https://github.com/realm/realm-java/commit/87664eb1b9fff36950c7885bd5d0acaed971200b", "message": "Update readme", "committedDate": "2020-12-10T15:03:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDI0NDkyNA==", "url": "https://github.com/realm/realm-java/pull/7241#discussion_r540244924", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                add_subdirectory(realm-core)\n          \n          \n            \n                add_subdirectory(realm-core EXCLUDE_FROM_ALL)\n          \n      \n    \n    \n  \n\nThis is something I should have suggested sooner - this option causes any targets defined in realm-core to not be included in the default ALL target generated by CMake. Only targets explicitly referenced (like Realm::Storage, Realm::Sync, and Realm::ObjectStore) will be built.", "author": "fealebenpae", "createdAt": "2020-12-10T15:08:53Z", "path": "realm/realm-library/src/main/cpp/CMakeLists.txt", "diffHunk": "@@ -130,12 +131,43 @@ create_javah(TARGET jni_headers\n     DEPENDS ${classes_PATH}\n )\n \n-option(REALM_JAVA_BUILD_CORE_FROM_SOURCE \"Build Realm Core from source, as opposed to downloading prebuilt binaries\" ON)\n-if(REALM_JAVA_BUILD_CORE_FROM_SOURCE)\n+# Check if user defined download location\n+if(NOT DEFINED ENV{REALM_CORE_DOWNLOAD_DIR})\n+    set(REALM_CORE_DOWNLOAD_DIR ${CMAKE_BINARY_DIR})\n+else()\n+    set(REALM_CORE_DOWNLOAD_DIR $ENV{REALM_CORE_DOWNLOAD_DIR})\n+endif()\n+\n+if(REALM_JAVA_BUILD_CORE_FROM_SOURCE OR NOT REALM_ENABLE_SYNC)\n+    message(STATUS \"Building Realm Core from source...\")\n+\n     set(REALM_BUILD_LIB_ONLY ON)\n     add_subdirectory(realm-core)", "originalCommit": "87664eb1b9fff36950c7885bd5d0acaed971200b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDI0NTEzNA==", "url": "https://github.com/realm/realm-java/pull/7241#discussion_r540245134", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                message(STATUS \"Using prebuild Realm Core.\")\n          \n          \n            \n                message(STATUS \"Using prebuilt Realm Core.\")\n          \n      \n    \n    \n  \n\ntypo", "author": "fealebenpae", "createdAt": "2020-12-10T15:09:08Z", "path": "realm/realm-library/src/main/cpp/CMakeLists.txt", "diffHunk": "@@ -130,12 +131,43 @@ create_javah(TARGET jni_headers\n     DEPENDS ${classes_PATH}\n )\n \n-option(REALM_JAVA_BUILD_CORE_FROM_SOURCE \"Build Realm Core from source, as opposed to downloading prebuilt binaries\" ON)\n-if(REALM_JAVA_BUILD_CORE_FROM_SOURCE)\n+# Check if user defined download location\n+if(NOT DEFINED ENV{REALM_CORE_DOWNLOAD_DIR})\n+    set(REALM_CORE_DOWNLOAD_DIR ${CMAKE_BINARY_DIR})\n+else()\n+    set(REALM_CORE_DOWNLOAD_DIR $ENV{REALM_CORE_DOWNLOAD_DIR})\n+endif()\n+\n+if(REALM_JAVA_BUILD_CORE_FROM_SOURCE OR NOT REALM_ENABLE_SYNC)\n+    message(STATUS \"Building Realm Core from source...\")\n+\n     set(REALM_BUILD_LIB_ONLY ON)\n     add_subdirectory(realm-core)\n else()\n-    message(FATAL_ERROR \"TODO: Implement downloading monorepo release artifacts\")\n+    message(STATUS \"Using prebuild Realm Core.\")", "originalCommit": "87664eb1b9fff36950c7885bd5d0acaed971200b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDI0NTcxMg==", "url": "https://github.com/realm/realm-java/pull/7241#discussion_r540245712", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    file(DOWNLOAD \"http://static.realm.io/downloads/core/${core_filename}.tar.gz\" \"${REALM_CORE_DOWNLOAD_DIR}/${core_filename}.tar.gz\")\n          \n          \n            \n                    file(DOWNLOAD \"https://static.realm.io/downloads/core/${core_filename}.tar.gz\" \"${REALM_CORE_DOWNLOAD_DIR}/${core_filename}.tar.gz\")\n          \n      \n    \n    \n  \n\nLet's try HTTPS.", "author": "fealebenpae", "createdAt": "2020-12-10T15:09:50Z", "path": "realm/realm-library/src/main/cpp/CMakeLists.txt", "diffHunk": "@@ -130,12 +131,43 @@ create_javah(TARGET jni_headers\n     DEPENDS ${classes_PATH}\n )\n \n-option(REALM_JAVA_BUILD_CORE_FROM_SOURCE \"Build Realm Core from source, as opposed to downloading prebuilt binaries\" ON)\n-if(REALM_JAVA_BUILD_CORE_FROM_SOURCE)\n+# Check if user defined download location\n+if(NOT DEFINED ENV{REALM_CORE_DOWNLOAD_DIR})\n+    set(REALM_CORE_DOWNLOAD_DIR ${CMAKE_BINARY_DIR})\n+else()\n+    set(REALM_CORE_DOWNLOAD_DIR $ENV{REALM_CORE_DOWNLOAD_DIR})\n+endif()\n+\n+if(REALM_JAVA_BUILD_CORE_FROM_SOURCE OR NOT REALM_ENABLE_SYNC)\n+    message(STATUS \"Building Realm Core from source...\")\n+\n     set(REALM_BUILD_LIB_ONLY ON)\n     add_subdirectory(realm-core)\n else()\n-    message(FATAL_ERROR \"TODO: Implement downloading monorepo release artifacts\")\n+    message(STATUS \"Using prebuild Realm Core.\")\n+\n+    # CMAKE_INTERPROCEDURAL_OPTIMIZATION is not compatible with binary artifacts.\n+    set(CMAKE_INTERPROCEDURAL_OPTIMIZATION OFF)\n+\n+    execute_process(COMMAND \"${CMAKE_COMMAND}\" \"-E\" \"environment\")\n+    set(core_filename \"realm-${CMAKE_BUILD_TYPE}-v${DEP_REALM_CORE}-Android-${CMAKE_ANDROID_ARCH_ABI}-devel\")\n+\n+    # Use cached resources if possible\n+    if(NOT EXISTS \"${REALM_CORE_DOWNLOAD_DIR}/${core_filename}.tar.gz\")\n+        message(STATUS \"Downloading ${core_filename}...\")\n+        file(DOWNLOAD \"http://static.realm.io/downloads/core/${core_filename}.tar.gz\" \"${REALM_CORE_DOWNLOAD_DIR}/${core_filename}.tar.gz\")", "originalCommit": "87664eb1b9fff36950c7885bd5d0acaed971200b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "3e9147f61e79816005c3fcb8009d77bfb5f2bb09", "url": "https://github.com/realm/realm-java/commit/3e9147f61e79816005c3fcb8009d77bfb5f2bb09", "message": "Update realm/realm-library/src/main/cpp/CMakeLists.txt\n\nCo-authored-by: Yavor Georgiev <fealebenpae@users.noreply.github.com>", "committedDate": "2020-12-10T16:17:39Z", "type": "commit"}, {"oid": "34005b5c49383f3153e204a2db832d783f574cc6", "url": "https://github.com/realm/realm-java/commit/34005b5c49383f3153e204a2db832d783f574cc6", "message": "Update realm/realm-library/src/main/cpp/CMakeLists.txt\n\nCo-authored-by: Yavor Georgiev <fealebenpae@users.noreply.github.com>", "committedDate": "2020-12-10T16:18:04Z", "type": "commit"}, {"oid": "6f350593b4563cef436a665638ff12eb91f0d1b6", "url": "https://github.com/realm/realm-java/commit/6f350593b4563cef436a665638ff12eb91f0d1b6", "message": "Update realm/realm-library/src/main/cpp/CMakeLists.txt\n\nCo-authored-by: Yavor Georgiev <fealebenpae@users.noreply.github.com>", "committedDate": "2020-12-10T16:18:10Z", "type": "commit"}, {"oid": "10ff4c0922e4a917d08aff6e3a9b29e1da447c10", "url": "https://github.com/realm/realm-java/commit/10ff4c0922e4a917d08aff6e3a9b29e1da447c10", "message": "Add SHA validation for core artifacts", "committedDate": "2020-12-10T17:38:14Z", "type": "commit"}, {"oid": "489917464ebcbc6a0b34e141aa536ddf56ad3a5d", "url": "https://github.com/realm/realm-java/commit/489917464ebcbc6a0b34e141aa536ddf56ad3a5d", "message": "Bump realm core commit", "committedDate": "2020-12-14T08:04:52Z", "type": "commit"}, {"oid": "a11cf8233217e6ef6aa6a994e586fd9036432025", "url": "https://github.com/realm/realm-java/commit/a11cf8233217e6ef6aa6a994e586fd9036432025", "message": "Update changelog", "committedDate": "2020-12-14T08:54:51Z", "type": "commit"}, {"oid": "ef91bb62a99573e2f5a478125d981e0625493447", "url": "https://github.com/realm/realm-java/commit/ef91bb62a99573e2f5a478125d981e0625493447", "message": "Fix rename of REALM_SYNC", "committedDate": "2020-12-14T09:41:48Z", "type": "commit"}, {"oid": "39fa223ab20776233b177a75b433c6b9aaf4daa4", "url": "https://github.com/realm/realm-java/commit/39fa223ab20776233b177a75b433c6b9aaf4daa4", "message": "Remove fingerprint check", "committedDate": "2020-12-14T11:19:43Z", "type": "commit"}, {"oid": "271592cbe899c7254c65694b5ac6758d47fcc0fd", "url": "https://github.com/realm/realm-java/commit/271592cbe899c7254c65694b5ac6758d47fcc0fd", "message": "Bump realm-core commit to master 10.3.2", "committedDate": "2020-12-14T13:01:47Z", "type": "commit"}, {"oid": "1a7f797ca53d33e03decf9e6ac76526a0dd8a5b2", "url": "https://github.com/realm/realm-java/commit/1a7f797ca53d33e03decf9e6ac76526a0dd8a5b2", "message": "Ignore failing tests", "committedDate": "2020-12-14T13:01:57Z", "type": "commit"}, {"oid": "1dd23deaddf567b7d67ee8f9173cd200a009bf33", "url": "https://github.com/realm/realm-java/commit/1dd23deaddf567b7d67ee8f9173cd200a009bf33", "message": "Ignore further failing tests", "committedDate": "2020-12-14T13:52:17Z", "type": "commit"}, {"oid": "e9c7ea21b41796fc9349fac8f85e9c23fe69b49d", "url": "https://github.com/realm/realm-java/commit/e9c7ea21b41796fc9349fac8f85e9c23fe69b49d", "message": "Profile JNI library sizes.", "committedDate": "2020-12-15T10:15:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDE0NDYxMQ==", "url": "https://github.com/realm/realm-java/pull/7241#discussion_r544144611", "bodyText": "Is this still a problem? At least the comments in the issue seems to indicate it has been fixed?\nIf it hasn't been fixed, how critical is it?", "author": "cmelchior", "createdAt": "2020-12-16T09:31:23Z", "path": "realm/realm-library/src/androidTest/java/io/realm/ManagedOrderedRealmCollectionTests.java", "diffHunk": "@@ -113,6 +114,7 @@\n  */\n \n @RunWith(Parameterized.class)\n+@Ignore(\"Tests crash due to bug in core, see https://jira.mongodb.org/browse/RCORE-435\")", "originalCommit": "e9c7ea21b41796fc9349fac8f85e9c23fe69b49d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDMzNzk3Mg==", "url": "https://github.com/realm/realm-java/pull/7241#discussion_r544337972", "bodyText": "It has been fixed but hasn't been released yet. It is on the core develop branch.\nThe issue crashes the test process, and it would crash any app. We shouldn't release without fixing the issue.", "author": "clementetb", "createdAt": "2020-12-16T14:23:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDE0NDYxMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDkxOTU4Mg==", "url": "https://github.com/realm/realm-java/pull/7241#discussion_r544919582", "bodyText": "Okay, in that case, I would put this PR on hold until we can get a fix from Core. But otherwise I would say this PR is ready to be merge.", "author": "cmelchior", "createdAt": "2020-12-17T09:00:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDE0NDYxMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDE0NTA4Mg==", "url": "https://github.com/realm/realm-java/pull/7241#discussion_r544145082", "bodyText": "Is this still relevant?", "author": "cmelchior", "createdAt": "2020-12-16T09:31:59Z", "path": "realm/realm-library/src/androidTest/java/io/realm/RealmJsonTests.java", "diffHunk": "@@ -75,6 +75,7 @@\n import static org.junit.Assume.assumeThat;\n \n @RunWith(AndroidJUnit4.class)\n+@Ignore(\"Tests crash due to bug in core, see https://jira.mongodb.org/browse/RCORE-435\")", "originalCommit": "e9c7ea21b41796fc9349fac8f85e9c23fe69b49d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDE0NTMyMw==", "url": "https://github.com/realm/realm-java/pull/7241#discussion_r544145323", "bodyText": "Same?", "author": "cmelchior", "createdAt": "2020-12-16T09:32:17Z", "path": "realm/realm-library/src/androidTest/java/io/realm/RealmResultsTests.java", "diffHunk": "@@ -68,6 +68,7 @@\n import static org.junit.Assert.fail;\n \n @RunWith(AndroidJUnit4.class)\n+@Ignore(\"Tests crash due to bug in core, see https://jira.mongodb.org/browse/RCORE-435\")", "originalCommit": "e9c7ea21b41796fc9349fac8f85e9c23fe69b49d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDE0NTQwMQ==", "url": "https://github.com/realm/realm-java/pull/7241#discussion_r544145401", "bodyText": "Same?", "author": "cmelchior", "createdAt": "2020-12-16T09:32:22Z", "path": "realm/realm-library/src/androidTest/java/io/realm/RealmTests.java", "diffHunk": "@@ -135,6 +135,7 @@\n \n \n @RunWith(AndroidJUnit4.class)\n+@Ignore(\"Tests crash due to bug in core, see https://jira.mongodb.org/browse/RCORE-435\")", "originalCommit": "e9c7ea21b41796fc9349fac8f85e9c23fe69b49d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDE0OTk5Mw==", "url": "https://github.com/realm/realm-java/pull/7241#discussion_r544149993", "bodyText": "We normally leave this out if nothing here.", "author": "cmelchior", "createdAt": "2020-12-16T09:38:42Z", "path": "CHANGELOG.md", "diffHunk": "@@ -1,3 +1,25 @@\n+## 10.3.0 (YYYY-MM-DD)\n+\n+### Deprecated", "originalCommit": "e9c7ea21b41796fc9349fac8f85e9c23fe69b49d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDE1MDEyMA==", "url": "https://github.com/realm/realm-java/pull/7241#discussion_r544150120", "bodyText": "We normally leave this section out if nothing here.", "author": "cmelchior", "createdAt": "2020-12-16T09:38:53Z", "path": "CHANGELOG.md", "diffHunk": "@@ -1,3 +1,25 @@\n+## 10.3.0 (YYYY-MM-DD)\n+\n+### Deprecated\n+* None.\n+\n+### Breaking Changes", "originalCommit": "e9c7ea21b41796fc9349fac8f85e9c23fe69b49d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDE1MDIxMw==", "url": "https://github.com/realm/realm-java/pull/7241#discussion_r544150213", "bodyText": "Copy the section from previous releases here.", "author": "cmelchior", "createdAt": "2020-12-16T09:38:59Z", "path": "CHANGELOG.md", "diffHunk": "@@ -1,3 +1,25 @@\n+## 10.3.0 (YYYY-MM-DD)\n+\n+### Deprecated\n+* None.\n+\n+### Breaking Changes\n+* None.\n+\n+### Enhancements\n+* None.\n+\n+### Fixes\n+* None.\n+\n+### Compatibility\n+* None.", "originalCommit": "e9c7ea21b41796fc9349fac8f85e9c23fe69b49d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "9e034aa039277cff95f7d375934aa0567b581bea", "url": "https://github.com/realm/realm-java/commit/9e034aa039277cff95f7d375934aa0567b581bea", "message": "Update changelog", "committedDate": "2020-12-16T14:45:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjU1MTk2NQ==", "url": "https://github.com/realm/realm-java/pull/7241#discussion_r546551965", "bodyText": "For traceability/reproducability etc. I would assume that it safest to do release from the prebuilts. Is it safe to to the release from locally build cores? Or don't we get the benefits of optimizations unless we build it?", "author": "rorbech", "createdAt": "2020-12-21T07:39:07Z", "path": "Jenkinsfile", "diffHunk": "@@ -91,6 +91,7 @@ try {\n           //  But still build all ABI's and run all types of tests. \n           useEmulator = true\n           emulatorImage = \"system-images;android-29;default;x86\"\n+          buildFlags = \"-PenableLTO=true -PbuildCore=true\"", "originalCommit": "9e034aa039277cff95f7d375934aa0567b581bea", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjU1Mjk1MA==", "url": "https://github.com/realm/realm-java/pull/7241#discussion_r546552950", "bodyText": "Isn't this download automatically when we specify the ndkVersion through the Android Gradle Plugin.", "author": "rorbech", "createdAt": "2020-12-21T07:42:08Z", "path": "README.md", "diffHunk": "@@ -66,34 +66,24 @@ In case you don't want to use the precompiled version, you can build Realm yours\n ### Prerequisites\n \n  * Download the [**JDK 8**](http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html) from Oracle and install it.\n- * The latest stable version of Android Studio. Currently [3.6.2](https://developer.android.com/studio/).\n- * Download & install the Android SDK **Build-Tools 28.0.3**, **Android Pie (API 28)** (for example through Android Studio\u2019s **Android SDK Manager**).\n+ * The latest stable version of Android Studio. Currently [4.1.1](https://developer.android.com/studio/).\n+ * Download & install the Android SDK **Build-Tools 29.0.3**, **Android Pie (API 29)** (for example through Android Studio\u2019s **Android SDK Manager**).\n  * Install CMake version 3.18.2 and build Ninja.\n- * Install the NDK (currently r21) from the SDK Manager in Android Studio or using the [website](https://developer.android.com/ndk/downloads). If downloaded \n-You may unzip the file wherever you choose.  For macOS, a suggested location is `~/Library`.  The download will unzip as the directory `android-ndk-r21`.\n+ * Install the NDK (Side-by-side) **21.0.6113669** from the SDK Manager in Android Studio. Remember to check `\u2611  Show package details` in the manager to display all available versions.", "originalCommit": "9e034aa039277cff95f7d375934aa0567b581bea", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjU1MzYzNg==", "url": "https://github.com/realm/realm-java/pull/7241#discussion_r546553636", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             * If you'd like to specify the location in which to store the archives of Realm Core, define the `REALM_CORE_DOWNLOAD_DIR` environment variable. It enables caching core release artifacts.\n          \n          \n            \n             * If you'd like to specify the location in which to store the archives of Realm Core, define the `REALM_CORE_DOWNLOAD_DIR` environment variable. It enables caching of downloaded core release artifacts.", "author": "rorbech", "createdAt": "2020-12-21T07:44:12Z", "path": "README.md", "diffHunk": "@@ -66,34 +66,24 @@ In case you don't want to use the precompiled version, you can build Realm yours\n ### Prerequisites\n \n  * Download the [**JDK 8**](http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html) from Oracle and install it.\n- * The latest stable version of Android Studio. Currently [3.6.2](https://developer.android.com/studio/).\n- * Download & install the Android SDK **Build-Tools 28.0.3**, **Android Pie (API 28)** (for example through Android Studio\u2019s **Android SDK Manager**).\n+ * The latest stable version of Android Studio. Currently [4.1.1](https://developer.android.com/studio/).\n+ * Download & install the Android SDK **Build-Tools 29.0.3**, **Android Pie (API 29)** (for example through Android Studio\u2019s **Android SDK Manager**).\n  * Install CMake version 3.18.2 and build Ninja.\n- * Install the NDK (currently r21) from the SDK Manager in Android Studio or using the [website](https://developer.android.com/ndk/downloads). If downloaded \n-You may unzip the file wherever you choose.  For macOS, a suggested location is `~/Library`.  The download will unzip as the directory `android-ndk-r21`.\n+ * Install the NDK (Side-by-side) **21.0.6113669** from the SDK Manager in Android Studio. Remember to check `\u2611  Show package details` in the manager to display all available versions.\n \n- * If you will be building with Android Studio, you will need to tell it to use the correct NDK.  If you installed it using the SDK Manager, it will automatically be detected. Otherwise, you need to define the variable `ndk.dir` in `realm/local.properties` and assign it the full pathname of the directory that you unzipped above.  Note that there is a `local.properites` in the root directory that is *not* the one that needs to be edited.\n+ * Add the Android home environment variable to your profile:\n \n     ```\n-    ndk.dir=/Users/<username>/Library/android-sdk/ndk/21.0.6113669\n-\n-    ```\n-\n- * Add two environment variables to your profile (presuming you installed the NDK using the SDK Manager):\n-\n-    ```\n-    export ANDROID_HOME=~/Library/android-sdk\n-    export ANDROID_NDK_HOME=~/Library/android-sdk/ndk/21.0.6113669\n+    export ANDROID_HOME=~/Library/Android/sdk\n     ```\n \n- * If you are launching Android Studio from the macOS Finder, you should also run the following two commands:\n+ * If you are launching Android Studio from the macOS Finder, you should also run the following command:\n \n     ```\n     launchctl setenv ANDROID_HOME \"$ANDROID_HOME\"\n-    launchctl setenv ANDROID_NDK_HOME \"$ANDROID_NDK_HOME\"\n     ```\n \n- * If you'd like to specify the location in which to store the archives of Realm Core, define the `REALM_CORE_DOWNLOAD_DIR` environment variable. It enables you to keep Core's archive when executing `git clean -xfd`.\n+ * If you'd like to specify the location in which to store the archives of Realm Core, define the `REALM_CORE_DOWNLOAD_DIR` environment variable. It enables caching core release artifacts.", "originalCommit": "9e034aa039277cff95f7d375934aa0567b581bea", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "905ca1982415cb3237ff927c99ee46f68958f0ed", "url": "https://github.com/realm/realm-java/commit/905ca1982415cb3237ff927c99ee46f68958f0ed", "message": "Bump master and enable tests affected by RCORE-435", "committedDate": "2021-01-08T11:18:57Z", "type": "commit"}, {"oid": "894c820c5264287d0aacaad401febb3cb785d445", "url": "https://github.com/realm/realm-java/commit/894c820c5264287d0aacaad401febb3cb785d445", "message": "Fix object store not copying data", "committedDate": "2021-01-08T12:29:49Z", "type": "commit"}, {"oid": "0f41646819c928a6da8702146b6f31cee84a50bd", "url": "https://github.com/realm/realm-java/commit/0f41646819c928a6da8702146b6f31cee84a50bd", "message": "Remove ignore comments", "committedDate": "2021-01-08T13:18:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1Mzk1MjAzMg==", "url": "https://github.com/realm/realm-java/pull/7241#discussion_r553952032", "bodyText": "We should probably add a comment about https://jira.mongodb.org/browse/HELP-21241. Maybe something like * [RealmApp] Sometimes getting Index out of range error when integrating a remote Sync changeset into the local Realm\nIt is a bit vague, but not sure I can come up with something more specific that doesn't involve writing 10s of lines of text.", "author": "cmelchior", "createdAt": "2021-01-08T13:46:43Z", "path": "CHANGELOG.md", "diffHunk": "@@ -1,3 +1,21 @@\n+## 10.3.0 (YYYY-MM-DD)\n+\n+### Enhancements\n+* None.\n+\n+### Fixes\n+* None.", "originalCommit": "0f41646819c928a6da8702146b6f31cee84a50bd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "427d88faf6fcc9a5a419e3a24bdbcc4a2bcd92a2", "url": "https://github.com/realm/realm-java/commit/427d88faf6fcc9a5a419e3a24bdbcc4a2bcd92a2", "message": "PR changes and bump core to v10.3.3", "committedDate": "2021-01-08T14:36:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1Mzk4MDU1Mw==", "url": "https://github.com/realm/realm-java/pull/7241#discussion_r553980553", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            * [RealmApp] Integrating a remote Sync changeset into the local Realm could result on an `Index out of range error`.\n          \n          \n            \n            * [RealmApp] Integrating a remote Sync changeset into the local Realm could result in an `Index out of range error`.", "author": "cmelchior", "createdAt": "2021-01-08T14:39:08Z", "path": "CHANGELOG.md", "diffHunk": "@@ -1,3 +1,22 @@\n+## 10.3.0 (YYYY-MM-DD)\n+\n+### Enhancements\n+* None.\n+\n+### Fixes\n+* [RealmApp] Integrating a remote Sync changeset into the local Realm could result on an `Index out of range error`.", "originalCommit": "427d88faf6fcc9a5a419e3a24bdbcc4a2bcd92a2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1Mzk4MDc1OA==", "url": "https://github.com/realm/realm-java/pull/7241#discussion_r553980758", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            * Change notifications not fired when removing and adding an object with the same PK within a transaction (Issue [#7098](https://github.com/realm/realm-java/issues/7098)).\n          \n          \n            \n            * Change notifications not firing when removing and adding an object with the same primary key within a transaction (Issue [#7098](https://github.com/realm/realm-java/issues/7098)).", "author": "cmelchior", "createdAt": "2021-01-08T14:39:28Z", "path": "CHANGELOG.md", "diffHunk": "@@ -1,3 +1,22 @@\n+## 10.3.0 (YYYY-MM-DD)\n+\n+### Enhancements\n+* None.\n+\n+### Fixes\n+* [RealmApp] Integrating a remote Sync changeset into the local Realm could result on an `Index out of range error`.\n+* Change notifications not fired when removing and adding an object with the same PK within a transaction (Issue [#7098](https://github.com/realm/realm-java/issues/7098)).", "originalCommit": "427d88faf6fcc9a5a419e3a24bdbcc4a2bcd92a2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "c3b99c7a5b87c372c0893781308c565841d8cf59", "url": "https://github.com/realm/realm-java/commit/c3b99c7a5b87c372c0893781308c565841d8cf59", "message": "Update CHANGELOG.md\n\nCo-authored-by: Christian Melchior <christian@ilios.dk>", "committedDate": "2021-01-08T14:40:34Z", "type": "commit"}, {"oid": "0800bd0381136c3844dd124f128e43391e5deaa0", "url": "https://github.com/realm/realm-java/commit/0800bd0381136c3844dd124f128e43391e5deaa0", "message": "Update CHANGELOG.md\n\nCo-authored-by: Christian Melchior <christian@ilios.dk>", "committedDate": "2021-01-08T14:40:44Z", "type": "commit"}, {"oid": "cb4a3c2495e4f74a6cfa252873e026bfaa6c912b", "url": "https://github.com/realm/realm-java/commit/cb4a3c2495e4f74a6cfa252873e026bfaa6c912b", "message": "Point to realm core in dependencies comments", "committedDate": "2021-01-08T14:58:00Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1Mzk5ODQzOA==", "url": "https://github.com/realm/realm-java/pull/7241#discussion_r553998438", "bodyText": "It looks like the Core release has a few other fixes we should also mention. Sorry for not catching this earlier. https://github.com/realm/realm-core/blob/master/CHANGELOG.md#1033-release-notes\nI would propose changing it to this:\n* [RealmApp] Integrating a remote Sync changeset into the local Realm could result in an `Index out of range error`.\n* Change notifications not firing when removing and adding an object with the same primary key within a transaction (Issue [#7098](https://github.com/realm/realm-java/issues/7098)).\n* Race condition which would lead to \"uncaught exception in notifier thread: N5realm15InvalidTableRefE: transaction_ended\" and a crash when the source Realm was closed or invalidated at a very specific time during the first run of a collection notifier (Core issue [#3761](https://github.com/realm/realm-core/issues/3761), since v7.0.0).\n* Deleting and recreating objects with embedded objects could fail (Core issue [#4240](https://github.com/realm/realm-core/pull/4240), since v10.0.0)\n\nBut feel free to do that after CI has run, no reason to retrigger it for a doc update.", "author": "cmelchior", "createdAt": "2021-01-08T15:08:32Z", "path": "CHANGELOG.md", "diffHunk": "@@ -1,3 +1,22 @@\n+## 10.3.0 (YYYY-MM-DD)\n+\n+### Enhancements\n+* None.\n+\n+### Fixes\n+* [RealmApp] Integrating a remote Sync changeset into the local Realm could result in an `Index out of range error`.", "originalCommit": "cb4a3c2495e4f74a6cfa252873e026bfaa6c912b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "6d6e05e781e2b771d5ff6c0ffb61830367ad52b1", "url": "https://github.com/realm/realm-java/commit/6d6e05e781e2b771d5ff6c0ffb61830367ad52b1", "message": "Update changelog with some more fixes", "committedDate": "2021-01-08T16:14:44Z", "type": "commit"}, {"oid": "31c45fb6473c45ec2a7d61711e1ecb1cac4dcca0", "url": "https://github.com/realm/realm-java/commit/31c45fb6473c45ec2a7d61711e1ecb1cac4dcca0", "message": "Merge branch 'master' into ct/consume-monorepo-binaries\n\n# Conflicts:\n#\tCHANGELOG.md\n#\trealm/realm-library/src/main/cpp/object-store", "committedDate": "2021-01-08T16:29:18Z", "type": "commit"}]}