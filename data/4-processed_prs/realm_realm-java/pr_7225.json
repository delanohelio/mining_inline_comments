{"pr_number": 7225, "pr_title": "Support OpenId credential for google identification", "pr_createdAt": "2020-12-02T08:57:55Z", "pr_url": "https://github.com/realm/realm-java/pull/7225", "timeline": [{"oid": "fad3c94f42855836d35ab70a94f0ce69855a5ff4", "url": "https://github.com/realm/realm-java/commit/fad3c94f42855836d35ab70a94f0ce69855a5ff4", "message": "Add coding changes for supporting google's open id", "committedDate": "2020-12-02T08:51:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzk5OTY2MQ==", "url": "https://github.com/realm/realm-java/pull/7225#discussion_r533999661", "bodyText": "We need public API docs for this, including each enum type + missing license headers", "author": "cmelchior", "createdAt": "2020-12-02T09:03:14Z", "path": "realm/realm-library/src/objectServer/java/io/realm/mongodb/auth/GoogleAuthType.java", "diffHunk": "@@ -0,0 +1,6 @@\n+package io.realm.mongodb.auth;\n+\n+public enum GoogleAuthType {", "originalCommit": "fad3c94f42855836d35ab70a94f0ce69855a5ff4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDAwMDc1MA==", "url": "https://github.com/realm/realm-java/pull/7225#discussion_r534000750", "bodyText": "We should probably just rename this to token as the type is determined by the enum?", "author": "cmelchior", "createdAt": "2020-12-02T09:04:51Z", "path": "realm/realm-library/src/objectServer/java/io/realm/mongodb/Credentials.java", "diffHunk": "@@ -150,17 +152,33 @@ public static Credentials facebook(String accessToken) {\n     }\n \n     /**\n-     * Creates credentials representing a login using a Google Authorization Code.\n+     * Creates credentials representing a login using a Google access token of a given {@link GoogleAuthType}.\n+     * <p>\n+     * This provider must be enabled on MongoDB Realm to work.\n+     *\n+     * @param accessToken the access token returned when logging in to Google.", "originalCommit": "fad3c94f42855836d35ab70a94f0ce69855a5ff4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "84d42dcf5f42f41a32275262dc42de147eef41f4", "url": "https://github.com/realm/realm-java/commit/84d42dcf5f42f41a32275262dc42de147eef41f4", "message": "Change accessToken param to token\nAdd license and docs to GoogleAuthType", "committedDate": "2020-12-02T09:20:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzM2MDY1Ng==", "url": "https://github.com/realm/realm-java/pull/7225#discussion_r537360656", "bodyText": "There is an assertFailsWithErrorCode for this pattern. There is still no functionality to match the error though, so you will still have to inspect the error message with .also { e -> e.message.contains} or similar.", "author": "rorbech", "createdAt": "2020-12-07T09:38:54Z", "path": "realm/realm-library/src/androidTestObjectServer/kotlin/io/realm/internal/network/LoggingInterceptorTest.kt", "diffHunk": "@@ -204,22 +205,55 @@ class LoggingInterceptorTest {\n     }\n \n     @Test\n-    fun googleTokenLogin_obfuscation() {\n+    fun googleTokenLogin_authCode_obfuscation() {\n         app = TestApp { builder ->\n             builder.httpLogObfuscator(HttpLogObfuscator(LOGIN_FEATURE, AppConfiguration.loginObfuscators))\n         }\n         testLogger = getLogger()\n         val token = \"google-token\"\n \n         try {\n-            app.login(Credentials.google(token))\n+            app.login(Credentials.google(token, GoogleAuthType.AUTH_CODE))\n         } catch (error: AppException) {\n             Assert.assertEquals(ErrorCode.INVALID_SESSION, error.errorCode)\n         } finally {\n             assertMessageExists(\"\"\"\"authCode\":\"***\"\"\"\")\n         }\n     }\n \n+\n+    @Test\n+    fun googleTokenLogin_idToken_noObfuscation() {\n+        app = TestApp()\n+        testLogger = getLogger()\n+        val token = \"google-token\"\n+\n+        try {", "originalCommit": "84d42dcf5f42f41a32275262dc42de147eef41f4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "2c9d860dd69767d5a56094e0924cda421eefeb6b", "url": "https://github.com/realm/realm-java/commit/2c9d860dd69767d5a56094e0924cda421eefeb6b", "message": "Update to latest Core/Sync/OS", "committedDate": "2020-12-08T11:09:47Z", "type": "commit"}, {"oid": "8b88192da475225bb26f31f5b2b20dc390027648", "url": "https://github.com/realm/realm-java/commit/8b88192da475225bb26f31f5b2b20dc390027648", "message": "Bump test server", "committedDate": "2020-12-08T12:00:42Z", "type": "commit"}, {"oid": "7f63c31f5bf7d4dd2cd52bdd46d60f57ae0ef60b", "url": "https://github.com/realm/realm-java/commit/7f63c31f5bf7d4dd2cd52bdd46d60f57ae0ef60b", "message": "Ignore broken tests", "committedDate": "2020-12-08T15:33:50Z", "type": "commit"}, {"oid": "00c30f40fdb5a86542efbb22895c3398cfaa3e2b", "url": "https://github.com/realm/realm-java/commit/00c30f40fdb5a86542efbb22895c3398cfaa3e2b", "message": "Ignore more tests", "committedDate": "2020-12-08T17:53:31Z", "type": "commit"}, {"oid": "2da2f910f39997f8cfbbfe1fe9357a16837dd989", "url": "https://github.com/realm/realm-java/commit/2da2f910f39997f8cfbbfe1fe9357a16837dd989", "message": "Missed test", "committedDate": "2020-12-08T18:43:50Z", "type": "commit"}, {"oid": "65ff78d72e064107a9fb0b397011b107191d4dbb", "url": "https://github.com/realm/realm-java/commit/65ff78d72e064107a9fb0b397011b107191d4dbb", "message": "Merge branch 'releases' into ct/google-open-id\n\n# Conflicts:\n#\tCHANGELOG.md", "committedDate": "2020-12-08T22:09:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTA3ODY0NA==", "url": "https://github.com/realm/realm-java/pull/7225#discussion_r539078644", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            ## 10.1.0 (2020-10-23)\n          \n          \n            \n            ## 10.1.0 (2020-11-23)", "author": "rorbech", "createdAt": "2020-12-09T07:47:55Z", "path": "CHANGELOG.md", "diffHunk": "@@ -46,6 +56,11 @@\n * APIs are backwards compatible with all previous release of realm-java in the 10.x.y series.\n * Realm Studio 10.0.0 or above is required to open Realms created by this version.\n \n+### Internal\n+* Updated to Realm Sync: 10.1.3.\n+* Updated to Realm Core: 10.1.3.\n+* Updated to Object Store commit: fc6daca61133aa9601e4cb34fbeb9ec7569e162e.\n+\n \n ## 10.1.0 (2020-10-23)", "originalCommit": "65ff78d72e064107a9fb0b397011b107191d4dbb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTA4NTQ1Ng==", "url": "https://github.com/realm/realm-java/pull/7225#discussion_r539085456", "bodyText": "Seems like master hasn't been merged. Shouldn't we do that on a minor release? Don't know how many changes there are though.", "author": "rorbech", "createdAt": "2020-12-09T08:00:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTA3ODY0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTA5MzIzOA==", "url": "https://github.com/realm/realm-java/pull/7225#discussion_r539093238", "bodyText": "I guess this wasn't the release PR, sorry.", "author": "rorbech", "createdAt": "2020-12-09T08:11:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTA3ODY0NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTA3OTIzMw==", "url": "https://github.com/realm/realm-java/pull/7225#discussion_r539079233", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            * [RealmApp] Added `Credentials.google(token: String, authType: GoogleAuthType)`, as MongoDB Realm support multiple ways of logging in Google Accounts.\n          \n          \n            \n            * [RealmApp] Added `Credentials.google(token: String, authType: GoogleAuthType)`, as MongoDB Realm now supports multiple ways of logging into Google Accounts.", "author": "rorbech", "createdAt": "2020-12-09T07:49:08Z", "path": "CHANGELOG.md", "diffHunk": "@@ -1,19 +1,29 @@\n-## 10.1.3 (YYYY-MM-DD)\n+## 10.2.0 (2020-12-02)\n+\n+### Deprecated\n+* [RealmApp] `Credentials.google(authenticationCode: String)`. Use `Credentials.google(token: String, authType: GoogleAuthType)` instead.\n \n ### Breaking Changes\n * None.\n \n ### Enhancements\n-* None.\n+* [RealmApp] Added `Credentials.google(token: String, authType: GoogleAuthType)`, as MongoDB Realm support multiple ways of logging in Google Accounts.", "originalCommit": "65ff78d72e064107a9fb0b397011b107191d4dbb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTA4NjQ3MQ==", "url": "https://github.com/realm/realm-java/pull/7225#discussion_r539086471", "bodyText": "A bit convoluted. Tried to rephrase but failed as I was a bit worried that I changed the meaning. Maybe just re-read to verify.", "author": "rorbech", "createdAt": "2020-12-09T08:02:30Z", "path": "CHANGELOG.md", "diffHunk": "@@ -1,19 +1,29 @@\n-## 10.1.3 (YYYY-MM-DD)\n+## 10.2.0 (2020-12-02)\n+\n+### Deprecated\n+* [RealmApp] `Credentials.google(authenticationCode: String)`. Use `Credentials.google(token: String, authType: GoogleAuthType)` instead.\n \n ### Breaking Changes\n * None.\n \n ### Enhancements\n-* None.\n+* [RealmApp] Added `Credentials.google(token: String, authType: GoogleAuthType)`, as MongoDB Realm support multiple ways of logging in Google Accounts.\n \n ### Fixes\n+* [RealmApp] Bug that would prevent eventual consistency during conflict resolution. Affected clients would experience data divergence and potentially consistency errors as a result if they experienced conflict resolution between cycles of Create-Erase-Create for objects with primary keys.", "originalCommit": "65ff78d72e064107a9fb0b397011b107191d4dbb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTEyMzQyOA==", "url": "https://github.com/realm/realm-java/pull/7225#discussion_r539123428", "bodyText": "This is a copy from the Sync changelog. I agree it is a bit convoluted, but so was the error, so not sure there is much we can do to rephrase it \ud83e\udd14", "author": "cmelchior", "createdAt": "2020-12-09T08:58:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTA4NjQ3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTEzNDQ5OA==", "url": "https://github.com/realm/realm-java/pull/7225#discussion_r539134498", "bodyText": "Heh. I didn't even get that this was actually the protocol 2 snippet.", "author": "rorbech", "createdAt": "2020-12-09T09:14:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTA4NjQ3MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTA4NzQ4MQ==", "url": "https://github.com/realm/realm-java/pull/7225#discussion_r539087481", "bodyText": "I guess we should also included the Sync protocol 2 snippet", "author": "rorbech", "createdAt": "2020-12-09T08:04:21Z", "path": "CHANGELOG.md", "diffHunk": "@@ -1,19 +1,29 @@\n-## 10.1.3 (YYYY-MM-DD)\n+## 10.2.0 (2020-12-02)\n+\n+### Deprecated\n+* [RealmApp] `Credentials.google(authenticationCode: String)`. Use `Credentials.google(token: String, authType: GoogleAuthType)` instead.\n \n ### Breaking Changes\n * None.\n \n ### Enhancements\n-* None.\n+* [RealmApp] Added `Credentials.google(token: String, authType: GoogleAuthType)`, as MongoDB Realm support multiple ways of logging in Google Accounts.\n \n ### Fixes\n+* [RealmApp] Bug that would prevent eventual consistency during conflict resolution. Affected clients would experience data divergence and potentially consistency errors as a result if they experienced conflict resolution between cycles of Create-Erase-Create for objects with primary keys.\n+* Complementary fix for missed edge case in https://github.com/realm/realm-java/pull/7220 where KAPT crash if we process a RealmObject referencing a type in RealmList defined in another module. (Issue [#7213](https://github.com/realm/realm-java/issues/7213), since v10.0.0).\n * Clean up JNI references to prevent crash from JNI reference table overflow (Issue [#7217](https://github.com/realm/realm-java/issues/7217))\n \n ### Compatibility\n * File format: Generates Realms with format v20. Unsynced Realms will be upgraded from Realm Java 2.0 and later. Synced Realms can only be read and upgraded if created with Realm Java v10.0.0-BETA.1.\n * APIs are backwards compatible with all previous release of realm-java in the 10.x.y series.\n * Realm Studio 10.0.0 or above is required to open Realms created by this version.\n \n+### Internal\n+* Updated to Realm Sync: 10.1.4.", "originalCommit": "65ff78d72e064107a9fb0b397011b107191d4dbb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "84127f0ac9f1471ba5ba59db52688db9822187dc", "url": "https://github.com/realm/realm-java/commit/84127f0ac9f1471ba5ba59db52688db9822187dc", "message": "Cleanup", "committedDate": "2020-12-09T08:40:10Z", "type": "commit"}]}