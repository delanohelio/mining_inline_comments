{"pr_number": 7060, "pr_title": "Align MongoDB Realm API's with other SDK's", "pr_createdAt": "2020-08-25T17:00:05Z", "pr_url": "https://github.com/realm/realm-java/pull/7060", "timeline": [{"oid": "1230dd065c2d28a510230ba19bad7431f874beab", "url": "https://github.com/realm/realm-java/commit/1230dd065c2d28a510230ba19bad7431f874beab", "message": "Move removeUser into App", "committedDate": "2020-08-25T15:12:53Z", "type": "commit"}, {"oid": "27942dc58587888de95442913c78a584d58f6b80", "url": "https://github.com/realm/realm-java/commit/27942dc58587888de95442913c78a584d58f6b80", "message": "Refactor ApiKey", "committedDate": "2020-08-25T15:46:52Z", "type": "commit"}, {"oid": "f4aab8d4435a256f83fb4e67f8341b71873b8414", "url": "https://github.com/realm/realm-java/commit/f4aab8d4435a256f83fb4e67f8341b71873b8414", "message": "Remove serverApiKey from credentials", "committedDate": "2020-08-25T15:48:25Z", "type": "commit"}, {"oid": "c21cc440be7a3db8f556bb40ea4828694142fbf3", "url": "https://github.com/realm/realm-java/commit/c21cc440be7a3db8f556bb40ea4828694142fbf3", "message": "Rename emailpasswordauth to emailpassword", "committedDate": "2020-08-25T15:54:42Z", "type": "commit"}, {"oid": "a2403096b3eafa02fd101834755ebcfb45b9138e", "url": "https://github.com/realm/realm-java/commit/a2403096b3eafa02fd101834755ebcfb45b9138e", "message": "Extract profile methods from user", "committedDate": "2020-08-25T15:59:03Z", "type": "commit"}, {"oid": "fcc5482320f9d4a9717f9f8cfc274415055a9cfb", "url": "https://github.com/realm/realm-java/commit/fcc5482320f9d4a9717f9f8cfc274415055a9cfb", "message": "Fix user profile unit tests", "committedDate": "2020-08-25T16:01:36Z", "type": "commit"}, {"oid": "f121badc4fb6e964c82e685fefee3e4472709250", "url": "https://github.com/realm/realm-java/commit/f121badc4fb6e964c82e685fefee3e4472709250", "message": "Add getAllSessions into Sync", "committedDate": "2020-08-25T16:18:20Z", "type": "commit"}, {"oid": "6464bad1c0b0c72d42da42ed6c4989885783646f", "url": "https://github.com/realm/realm-java/commit/6464bad1c0b0c72d42da42ed6c4989885783646f", "message": "Rename refreshconnections", "committedDate": "2020-08-25T16:21:25Z", "type": "commit"}, {"oid": "5a92304a05da3772949c509d257a06e5849fb0e7", "url": "https://github.com/realm/realm-java/commit/5a92304a05da3772949c509d257a06e5849fb0e7", "message": "Rename IdentityProvider", "committedDate": "2020-08-25T16:21:35Z", "type": "commit"}, {"oid": "ae9531a6453f11085cf05bfe4ba590db1a71b158", "url": "https://github.com/realm/realm-java/commit/ae9531a6453f11085cf05bfe4ba590db1a71b158", "message": "Remove reference to SERVER_API_KEY", "committedDate": "2020-08-25T16:27:42Z", "type": "commit"}, {"oid": "d7424b81c1467b419bc4f223ed5953f97edce8d4", "url": "https://github.com/realm/realm-java/commit/d7424b81c1467b419bc4f223ed5953f97edce8d4", "message": "Add getServiceName to MongoClient", "committedDate": "2020-08-25T16:40:22Z", "type": "commit"}, {"oid": "2c2cfc5efbcd8abac67bd770713e3e1f28858b63", "url": "https://github.com/realm/realm-java/commit/2c2cfc5efbcd8abac67bd770713e3e1f28858b63", "message": "Add getName to collection", "committedDate": "2020-08-25T16:40:47Z", "type": "commit"}, {"oid": "9ccd101108fd7f29f3d47fefdb039b3dc3c4088d", "url": "https://github.com/realm/realm-java/commit/9ccd101108fd7f29f3d47fefdb039b3dc3c4088d", "message": "Merge branch 'v10' into ct/align-with-other-sdks", "committedDate": "2020-08-25T16:45:16Z", "type": "commit"}, {"oid": "603f750f64367bc0f0913982dc3474ac0e275da2", "url": "https://github.com/realm/realm-java/commit/603f750f64367bc0f0913982dc3474ac0e275da2", "message": "Merge branch 'v10' into ct/align-with-other-sdks", "committedDate": "2020-08-26T13:49:01Z", "type": "commit"}, {"oid": "b09fc010d2c6cd8657fd21a7ca9ffa534659f95d", "url": "https://github.com/realm/realm-java/commit/b09fc010d2c6cd8657fd21a7ca9ffa534659f95d", "message": "Remove getLocalId method from User", "committedDate": "2020-08-26T14:43:05Z", "type": "commit"}, {"oid": "d12ef5bef20f15f5ea61eeb6cd2bb92a8e40eebe", "url": "https://github.com/realm/realm-java/commit/d12ef5bef20f15f5ea61eeb6cd2bb92a8e40eebe", "message": "Fix mongodbrealmexample", "committedDate": "2020-08-26T15:17:18Z", "type": "commit"}, {"oid": "8bfdf6e0a7363ae0d91666bd336321620abcb610", "url": "https://github.com/realm/realm-java/commit/8bfdf6e0a7363ae0d91666bd336321620abcb610", "message": "Fix missing references to localid on tests", "committedDate": "2020-08-26T16:46:04Z", "type": "commit"}, {"oid": "7d9ebcf7697fded36152d1dc7370602ed3270a97", "url": "https://github.com/realm/realm-java/commit/7d9ebcf7697fded36152d1dc7370602ed3270a97", "message": "Fix getAllSessions test case", "committedDate": "2020-08-27T10:04:39Z", "type": "commit"}, {"oid": "42bee4467341aada80d5faf7e4475faf7e873ec5", "url": "https://github.com/realm/realm-java/commit/42bee4467341aada80d5faf7e4475faf7e873ec5", "message": "Revert \"Fix missing references to localid on tests\"\n\nThis reverts commit 8bfdf6e0a7363ae0d91666bd336321620abcb610.", "committedDate": "2020-08-28T10:33:14Z", "type": "commit"}, {"oid": "3da2e67be2c661bac3f2972fd71d3093f7dfc361", "url": "https://github.com/realm/realm-java/commit/3da2e67be2c661bac3f2972fd71d3093f7dfc361", "message": "Amend localId tests", "committedDate": "2020-08-28T15:26:51Z", "type": "commit"}, {"oid": "b8df58bde39ebc27df2eef5e3b9e8fba6c95fbe7", "url": "https://github.com/realm/realm-java/commit/b8df58bde39ebc27df2eef5e3b9e8fba6c95fbe7", "message": "Fix ApiKey string serialization", "committedDate": "2020-08-28T15:33:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTg4NDgwNg==", "url": "https://github.com/realm/realm-java/pull/7060#discussion_r479884806", "bodyText": "No need to manually stop the session. That should happen when closing the Realm", "author": "cmelchior", "createdAt": "2020-08-31T04:43:51Z", "path": "realm/realm-library/src/androidTestObjectServer/kotlin/io/realm/mongodb/sync/SessionTests.kt", "diffHunk": "@@ -502,5 +502,18 @@ class SessionTests {\n     fun getOrCreateSession() {\n         assertNotNull(app.sync.getOrCreateSession(configuration))\n     }\n+\n+    @Test\n+    fun getAllSessions(){\n+        val realm = Realm.getInstance(configuration)\n+        val session = realm.syncSession\n+        val sessions = app.sync.allSessions\n+\n+        assertNotNull(sessions)\n+        assertEquals(1, sessions.size)\n+\n+        realm.close()\n+        session.stop()", "originalCommit": "b8df58bde39ebc27df2eef5e3b9e8fba6c95fbe7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTk3NTY0NQ==", "url": "https://github.com/realm/realm-java/pull/7060#discussion_r479975645", "bodyText": "Ok!", "author": "clementetb", "createdAt": "2020-08-31T08:26:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTg4NDgwNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTg4NTI0OQ==", "url": "https://github.com/realm/realm-java/pull/7060#discussion_r479885249", "bodyText": "We also need to move the removeUserAsync() method.", "author": "cmelchior", "createdAt": "2020-08-31T04:46:02Z", "path": "realm/realm-library/src/objectServer/java/io/realm/mongodb/App.java", "diffHunk": "@@ -330,6 +330,20 @@ public User switchUser(User user) {\n         return user;\n     }\n \n+    /**\n+     * Removes a users credentials from this device. If the user was currently logged in, they\n+     * will be logged out as part of the process. This is only a local change and does not\n+     * affect the user state on the server.\n+     *\n+     * @param user to remove\n+     * @return user that was removed.\n+     * @throws AppException if called from the UI thread or if the user was logged in, but\n+     *                      could not be logged out.\n+     */\n+    public User removeUser(User user) throws AppException {", "originalCommit": "b8df58bde39ebc27df2eef5e3b9e8fba6c95fbe7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTk3NjE2MQ==", "url": "https://github.com/realm/realm-java/pull/7060#discussion_r479976161", "bodyText": "Didn't see the method \ud83e\udd26\ud83c\udffb\u200d\u2642\ufe0f", "author": "clementetb", "createdAt": "2020-08-31T08:27:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTg4NTI0OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTg4NTY5Mg==", "url": "https://github.com/realm/realm-java/pull/7060#discussion_r479885692", "bodyText": "This constructor shouldn't be public if possible. Also, we should probably send in the User class as a parameter as we can then expose it through a getUser() (for completeness, so we can always find the user/app from any class in the class hierachy)", "author": "cmelchior", "createdAt": "2020-08-31T04:47:57Z", "path": "realm/realm-library/src/objectServer/java/io/realm/mongodb/Profile.java", "diffHunk": "@@ -0,0 +1,122 @@\n+/*\n+ * Copyright 2020 Realm Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.realm.mongodb;\n+\n+import javax.annotation.Nullable;\n+\n+import io.realm.internal.objectstore.OsSyncUser;\n+\n+public class Profile {\n+    private final OsSyncUser osUser;\n+\n+    public Profile(OsSyncUser osUser) {", "originalCommit": "b8df58bde39ebc27df2eef5e3b9e8fba6c95fbe7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTg4NTc4OA==", "url": "https://github.com/realm/realm-java/pull/7060#discussion_r479885788", "bodyText": "We should probably implement equals/hashcode/toString", "author": "cmelchior", "createdAt": "2020-08-31T04:48:29Z", "path": "realm/realm-library/src/objectServer/java/io/realm/mongodb/Profile.java", "diffHunk": "@@ -0,0 +1,122 @@\n+/*\n+ * Copyright 2020 Realm Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.realm.mongodb;\n+\n+import javax.annotation.Nullable;\n+\n+import io.realm.internal.objectstore.OsSyncUser;\n+\n+public class Profile {", "originalCommit": "b8df58bde39ebc27df2eef5e3b9e8fba6c95fbe7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTg4NjIzMg==", "url": "https://github.com/realm/realm-java/pull/7060#discussion_r479886232", "bodyText": "We seem to be lacking tests for this?", "author": "cmelchior", "createdAt": "2020-08-31T04:50:20Z", "path": "realm/realm-library/src/objectServer/java/io/realm/mongodb/mongo/MongoClient.java", "diffHunk": "@@ -48,4 +48,13 @@ public MongoDatabase getDatabase(final String databaseName) {\n         return new MongoDatabase(osMongoClient.getDatabase(databaseName, codecRegistry),\n                 databaseName);\n     }\n+\n+    /**\n+     * Returns the service name for this client.\n+     *\n+     * @return the service name.\n+     */\n+    public String getServiceName() {", "originalCommit": "b8df58bde39ebc27df2eef5e3b9e8fba6c95fbe7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTg4NjI3Ng==", "url": "https://github.com/realm/realm-java/pull/7060#discussion_r479886276", "bodyText": "We seem to be lacking tests for this?", "author": "cmelchior", "createdAt": "2020-08-31T04:50:29Z", "path": "realm/realm-library/src/objectServer/java/io/realm/mongodb/mongo/MongoCollection.java", "diffHunk": "@@ -85,6 +85,15 @@ public MongoNamespace getNamespace() {\n         return nameSpace;\n     }\n \n+    /**\n+     * Gets the name of this collection\n+     *\n+     * @return the name\n+     */\n+    public String getName() {", "originalCommit": "b8df58bde39ebc27df2eef5e3b9e8fba6c95fbe7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "4f761ab002b284c3801aed01e24a1a5c7394a9dd", "url": "https://github.com/realm/realm-java/commit/4f761ab002b284c3801aed01e24a1a5c7394a9dd", "message": "PR change requests", "committedDate": "2020-08-31T09:29:05Z", "type": "commit"}, {"oid": "4449dba8bf2d90971626e1a129037bf3fa76528d", "url": "https://github.com/realm/realm-java/commit/4449dba8bf2d90971626e1a129037bf3fa76528d", "message": "Rename Profile class to ProfileInfo", "committedDate": "2020-09-03T10:40:28Z", "type": "commit"}, {"oid": "99213148453b91ea1eb63b01626e35c93706a0ab", "url": "https://github.com/realm/realm-java/commit/99213148453b91ea1eb63b01626e35c93706a0ab", "message": "Update Changelog and bump object-store", "committedDate": "2020-09-03T10:41:20Z", "type": "commit"}, {"oid": "a8bb35f2e8a565784a44dbe7979a797d1f34ffe5", "url": "https://github.com/realm/realm-java/commit/a8bb35f2e8a565784a44dbe7979a797d1f34ffe5", "message": "Fix typo", "committedDate": "2020-09-03T10:42:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDIyODI2MQ==", "url": "https://github.com/realm/realm-java/pull/7060#discussion_r484228261", "bodyText": "I have not picked up anything about changing Profile to ProfileInfo. Is this aligned with the other SDKs?", "author": "rorbech", "createdAt": "2020-09-07T07:18:28Z", "path": "realm/realm-library/src/androidTestObjectServer/kotlin/io/realm/UserProfileInfoTests.kt", "diffHunk": "@@ -29,7 +29,7 @@ import org.junit.runner.RunWith\n import kotlin.test.assertNull\n \n @RunWith(AndroidJUnit4::class)\n-class UserProfileTests {\n+class UserProfileInfoTests {", "originalCommit": "a8bb35f2e8a565784a44dbe7979a797d1f34ffe5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDI4ODQzNQ==", "url": "https://github.com/realm/realm-java/pull/7060#discussion_r484288435", "bodyText": "Sorry, I remembered wrong. JS is calling this UserProfile so we should rename to that as well: https://mongodb.slack.com/archives/CKW2HG3M0/p1599466293136100", "author": "cmelchior", "createdAt": "2020-09-07T08:53:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDIyODI2MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDI4NzkwMw==", "url": "https://github.com/realm/realm-java/pull/7060#discussion_r484287903", "bodyText": "My bad, but I remembered wrong. JS is calling this class UserProfile so we should rename ours to the same. Sorry.", "author": "cmelchior", "createdAt": "2020-09-07T08:52:10Z", "path": "CHANGELOG.md", "diffHunk": "@@ -5,12 +5,30 @@ We no longer support Realm Cloud (legacy), but instead the new MongoDB Realm Clo\n The old Realm Cloud legacy APIs have undergone significant refactoring. The new APIs are all located in the `io.realm.mongodb` package with `io.realm.mongodb.App` as the entry point.\n \n ### Breaking Changes\n-*  None.\n+* [RealmApp] Moved `User.remove()` to `App.removeUser()`.\n+* [RealmApp] Renamed `ApiKeyAuth.createApiKey()` to `ApiKeyAuth.create()` and `ApiKeyAuth.createApiKeyAsync()` to `ApiKeyAuth.createAsync()`.\n+* [RealmApp] Renamed `ApiKeyAuth.fetchApiKey()` to `ApiKeyAuth.fetch()` and `ApiKeyAuth.fetchApiKeyAsync()` to `ApiKeyAuth.fetchAsync()`.\n+* [RealmApp] Renamed `ApiKeyAuth.fetchAllApiKeys()` to `ApiKeyAuth.fetchAll()` and `ApiKeyAuth.fetchAllApiKeysAsync()` to `ApiKeyAuth.fetchAllAsync()`.\n+* [RealmApp] Renamed `ApiKeyAuth.deleteApiKey()` to `ApiKeyAuth.delete()` and `ApiKeyAuth.deleteApiKeyAsync()` to `ApiKeyAuth.deleteAsync()`.\n+* [RealmApp] Renamed `ApiKeyAuth.enableApiKey()` to `ApiKeyAuth.enable()` and `ApiKeyAuth.enableApiKeyAsync()` to `ApiKeyAuth.enableAsync()`.\n+* [RealmApp] Renamed `ApiKeyAuth.disableApiKey()` to `ApiKeyAuth.disable()` and `ApiKeyAuth.disableApiKeyAsync()` to `ApiKeyAuth.disableAsync()`.\n+* [RealmApp] Renamed `User.getApiKeysAuth()` to `User.getApiKeys()`.\n+* [RealmApp] Renamed `UserApiKey` class to `ApiKey`.\n+* [RealmApp] Removed support for `Credentials.serverApiKey()`.\n+* [RealmApp] Renamed `App.getEmailPasswordAuth()` to `App.getEmailPassword()`.\n+* [RealmApp] User profile methods `getName()`, `getEmail()`, `getPictureUrl()`, `getFirstName()`, `getLastName()`, `getGender()`, `getBirthday()`, `getMinAge()` and `getMaxAge()` are now available under a new class ProfileInfo. It can be accessed using `User.getProfile()`.", "originalCommit": "a8bb35f2e8a565784a44dbe7979a797d1f34ffe5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "27066be99840431057f6c632232e49a960a16754", "url": "https://github.com/realm/realm-java/commit/27066be99840431057f6c632232e49a960a16754", "message": "Rename ProfileInfo to UserProfile", "committedDate": "2020-09-07T09:01:57Z", "type": "commit"}, {"oid": "bd69ef6078134c4c2e9078a067d39bc797698a2c", "url": "https://github.com/realm/realm-java/commit/bd69ef6078134c4c2e9078a067d39bc797698a2c", "message": "Bump to latest object-store version", "committedDate": "2020-09-08T13:01:51Z", "type": "commit"}]}