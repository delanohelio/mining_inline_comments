{"pr_number": 6822, "pr_title": "Use emulator for PR's", "pr_createdAt": "2020-05-01T12:44:00Z", "pr_url": "https://github.com/realm/realm-java/pull/6822", "timeline": [{"oid": "88ffd86beea4b29ca2fd557ca0c05dc095550a5b", "url": "https://github.com/realm/realm-java/commit/88ffd86beea4b29ca2fd557ca0c05dc095550a5b", "message": "Attempt to use emulator", "committedDate": "2020-05-01T12:42:46Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODUzMDQ5NA==", "url": "https://github.com/realm/realm-java/pull/6822#discussion_r418530494", "bodyText": "I guess this is not set if we are not running the emulator!?", "author": "rorbech", "createdAt": "2020-05-01T12:59:11Z", "path": "Jenkinsfile", "diffHunk": "@@ -155,6 +164,7 @@ try {\n           archiveServerLogs(mongoDbRealmContainer.id, mongoDbRealmCommandServerContainer.id)\n           mongoDbRealmContainer.stop()\n           mongoDbRealmCommandServerContainer.stop()\n+          emulatorContainer.stop()", "originalCommit": "88ffd86beea4b29ca2fd557ca0c05dc095550a5b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODUzOTAxNA==", "url": "https://github.com/realm/realm-java/pull/6822#discussion_r418539014", "bodyText": "Good point \ud83d\udc4d", "author": "cmelchior", "createdAt": "2020-05-01T13:24:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODUzMDQ5NA=="}], "type": "inlineReview"}, {"oid": "30cfc0dc158f038878e54c930f232ec14d9ac10a", "url": "https://github.com/realm/realm-java/commit/30cfc0dc158f038878e54c930f232ec14d9ac10a", "message": "Only stop emulator if present", "committedDate": "2020-05-01T13:26:19Z", "type": "commit"}, {"oid": "de904ef6c4029e711e65cc3a742555f76c4dcbb8", "url": "https://github.com/realm/realm-java/commit/de904ef6c4029e711e65cc3a742555f76c4dcbb8", "message": "Disable global Gradle cache (I think)", "committedDate": "2020-05-01T14:07:19Z", "type": "commit"}, {"oid": "dd27c451c63394207be2387ffa980e4d1646c1b6", "url": "https://github.com/realm/realm-java/commit/dd27c451c63394207be2387ffa980e4d1646c1b6", "message": "Disable more host caches", "committedDate": "2020-05-01T14:53:03Z", "type": "commit"}, {"oid": "33dfd8c6d7096bb5738f66b3ce63bb26ec4b4ba8", "url": "https://github.com/realm/realm-java/commit/33dfd8c6d7096bb5738f66b3ce63bb26ec4b4ba8", "message": "Use physical build machines", "committedDate": "2020-05-01T15:13:32Z", "type": "commit"}, {"oid": "4a8e3e589a29c96aeb90803ec76cf779a957f4ad", "url": "https://github.com/realm/realm-java/commit/4a8e3e589a29c96aeb90803ec76cf779a957f4ad", "message": "Cleanup", "committedDate": "2020-05-01T15:47:15Z", "type": "commit"}, {"oid": "e03e4fdd9f9c6ade4609f12ee7d875a545e4937a", "url": "https://github.com/realm/realm-java/commit/e03e4fdd9f9c6ade4609f12ee7d875a545e4937a", "message": "Only use lock when needed", "committedDate": "2020-05-01T15:59:59Z", "type": "commit"}, {"oid": "b195fc1911fec0f309fefdb7254b43822cac54b0", "url": "https://github.com/realm/realm-java/commit/b195fc1911fec0f309fefdb7254b43822cac54b0", "message": "Add missing arguments", "committedDate": "2020-05-01T16:01:28Z", "type": "commit"}, {"oid": "fd0f7d7bcf94cfecf9846e1a3ff579b46280ffe3", "url": "https://github.com/realm/realm-java/commit/fd0f7d7bcf94cfecf9846e1a3ff579b46280ffe3", "message": "Better build steps. Print attached devices as debug info", "committedDate": "2020-05-01T17:22:42Z", "type": "commit"}, {"oid": "cf4c1014def8631e8f4834a5a3e826eaac80ce2a", "url": "https://github.com/realm/realm-java/commit/cf4c1014def8631e8f4834a5a3e826eaac80ce2a", "message": "Also use abiFilter for instrumentation targets", "committedDate": "2020-05-01T17:45:48Z", "type": "commit"}, {"oid": "f83d2dfeb438bb0cd6895f49dfe91bf70495c311", "url": "https://github.com/realm/realm-java/commit/f83d2dfeb438bb0cd6895f49dfe91bf70495c311", "message": "Better docs and formatting. Escape quickly if device could not be found.", "committedDate": "2020-05-01T18:08:40Z", "type": "commit"}, {"oid": "8458b65ca84427b48b88584ee291665448a32462", "url": "https://github.com/realm/realm-java/commit/8458b65ca84427b48b88584ee291665448a32462", "message": "Emulator must share network with other images", "committedDate": "2020-05-01T18:19:16Z", "type": "commit"}, {"oid": "987582ea8298f791d5cc68ebb0966cce7bb15e5e", "url": "https://github.com/realm/realm-java/commit/987582ea8298f791d5cc68ebb0966cce7bb15e5e", "message": "Don't attempt to kill logcat if it never started", "committedDate": "2020-05-01T18:28:49Z", "type": "commit"}, {"oid": "5ce45d5a64edb006a622ab091a19e0512f006094", "url": "https://github.com/realm/realm-java/commit/5ce45d5a64edb006a622ab091a19e0512f006094", "message": "Start emulator ourselves", "committedDate": "2020-05-01T19:37:43Z", "type": "commit"}, {"oid": "3eaf14175772125c121558b43527a41e187ead69", "url": "https://github.com/realm/realm-java/commit/3eaf14175772125c121558b43527a41e187ead69", "message": "Start emulator in the background", "committedDate": "2020-05-01T19:38:25Z", "type": "commit"}, {"oid": "8ce3ad7c579eaa069be3470f670c564997a7b040", "url": "https://github.com/realm/realm-java/commit/8ce3ad7c579eaa069be3470f670c564997a7b040", "message": "Add emulator to docker image", "committedDate": "2020-05-01T19:41:42Z", "type": "commit"}, {"oid": "7b05a8e310d3c7cb99385d1a208bec3e47bc80bf", "url": "https://github.com/realm/realm-java/commit/7b05a8e310d3c7cb99385d1a208bec3e47bc80bf", "message": "Wrong architecture", "committedDate": "2020-05-01T19:56:47Z", "type": "commit"}, {"oid": "961da1a4a3e3e048cffb6db80d829371757c3d59", "url": "https://github.com/realm/realm-java/commit/961da1a4a3e3e048cffb6db80d829371757c3d59", "message": "Jenkins sh is hard", "committedDate": "2020-05-01T20:05:45Z", "type": "commit"}, {"oid": "d54ee376bdace22fe1124899767d587c2cedb8cf", "url": "https://github.com/realm/realm-java/commit/d54ee376bdace22fe1124899767d587c2cedb8cf", "message": "Google has deprecated 32-bit emulators", "committedDate": "2020-05-01T20:07:48Z", "type": "commit"}, {"oid": "e9e0ad7c7f12c0661dadc3e1f7254ecc35fd5657", "url": "https://github.com/realm/realm-java/commit/e9e0ad7c7f12c0661dadc3e1f7254ecc35fd5657", "message": "sh again", "committedDate": "2020-05-01T20:33:09Z", "type": "commit"}, {"oid": "1e0bccc0039d0ee6baffd044a75833d01a3d73e5", "url": "https://github.com/realm/realm-java/commit/1e0bccc0039d0ee6baffd044a75833d01a3d73e5", "message": "3rd time a charm", "committedDate": "2020-05-01T20:50:39Z", "type": "commit"}, {"oid": "98944fad4224d7bf06f4904a3c5022805aec92df", "url": "https://github.com/realm/realm-java/commit/98944fad4224d7bf06f4904a3c5022805aec92df", "message": "More sh fun", "committedDate": "2020-05-01T21:01:00Z", "type": "commit"}, {"oid": "d096a68dd1153e7bde5f12e1a184644ff342b2ed", "url": "https://github.com/realm/realm-java/commit/d096a68dd1153e7bde5f12e1a184644ff342b2ed", "message": "Debug output", "committedDate": "2020-05-01T21:16:17Z", "type": "commit"}, {"oid": "c02aa500d1699a3c57cc4b0873661ed7f801be7e", "url": "https://github.com/realm/realm-java/commit/c02aa500d1699a3c57cc4b0873661ed7f801be7e", "message": "Attempt to fix 32-bit emulator error", "committedDate": "2020-05-01T21:38:49Z", "type": "commit"}, {"oid": "f5e73932ad8cfc573877493743f0108bbdaaf058", "url": "https://github.com/realm/realm-java/commit/f5e73932ad8cfc573877493743f0108bbdaaf058", "message": "Attempt to fix tz issue", "committedDate": "2020-05-01T21:46:14Z", "type": "commit"}, {"oid": "f99e153c3d91bb986597b40e690c13ddc947b0ba", "url": "https://github.com/realm/realm-java/commit/f99e153c3d91bb986597b40e690c13ddc947b0ba", "message": "Docker syntax", "committedDate": "2020-05-01T21:47:32Z", "type": "commit"}, {"oid": "8375c1b690ffdd2eacc695135852ed3d9694ece7", "url": "https://github.com/realm/realm-java/commit/8375c1b690ffdd2eacc695135852ed3d9694ece7", "message": "Don't install 32 bit binaries", "committedDate": "2020-05-01T21:55:05Z", "type": "commit"}, {"oid": "ebb7588ab554a590e514831b2ddfd28be739e6fd", "url": "https://github.com/realm/realm-java/commit/ebb7588ab554a590e514831b2ddfd28be739e6fd", "message": "Docker yet again", "committedDate": "2020-05-01T21:56:49Z", "type": "commit"}, {"oid": "57d12c09ddf7dddcc1d2b82213c8fd71dee3f5cf", "url": "https://github.com/realm/realm-java/commit/57d12c09ddf7dddcc1d2b82213c8fd71dee3f5cf", "message": "More tz fixes", "committedDate": "2020-05-01T22:24:24Z", "type": "commit"}, {"oid": "b0ebc2b86717dc4b8c13b553df4ffee411de7943", "url": "https://github.com/realm/realm-java/commit/b0ebc2b86717dc4b8c13b553df4ffee411de7943", "message": "I'm just guessing now", "committedDate": "2020-05-01T22:35:50Z", "type": "commit"}, {"oid": "73ed4c6e608336430a434ecb262fc5008e2ba888", "url": "https://github.com/realm/realm-java/commit/73ed4c6e608336430a434ecb262fc5008e2ba888", "message": "Attempt to work-around tz", "committedDate": "2020-05-01T23:22:13Z", "type": "commit"}, {"oid": "e421b9801c97a90a38a6ece19e93a8f0030d3778", "url": "https://github.com/realm/realm-java/commit/e421b9801c97a90a38a6ece19e93a8f0030d3778", "message": "Back to 32 bit", "committedDate": "2020-05-01T23:52:47Z", "type": "commit"}, {"oid": "12e9dab29fe5e00ec202733ebeca91c253eb055c", "url": "https://github.com/realm/realm-java/commit/12e9dab29fe5e00ec202733ebeca91c253eb055c", "message": "Throwing stuff at wall", "committedDate": "2020-05-01T23:59:27Z", "type": "commit"}, {"oid": "439f4f08fd913e5cb65d6fc6602d1c8081a0707e", "url": "https://github.com/realm/realm-java/commit/439f4f08fd913e5cb65d6fc6602d1c8081a0707e", "message": "More optimized image", "committedDate": "2020-05-02T00:11:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODgyMzkxOA==", "url": "https://github.com/realm/realm-java/pull/6822#discussion_r418823918", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            // Branches that are \"important\", so if the do not compile they will generate a Slack notification\n          \n          \n            \n            // Branches that are \"important\", so if they do not compile they will generate a Slack notification", "author": "nhachicha", "createdAt": "2020-05-02T01:50:15Z", "path": "Jenkinsfile", "diffHunk": "@@ -5,11 +5,19 @@ import groovy.json.JsonOutput\n def buildSuccess = false\n def mongoDbRealmContainer = null\n def mongoDbRealmCommandServerContainer = null\n+def emulatorContainer = null\n def dockerNetworkId = UUID.randomUUID().toString()\n-def releaseBranches = ['master', 'next-major', 'v10'] // Branches from which we release SNAPSHOT's\n+// Branches from which we release SNAPSHOT's.\n+// Only release branches need to run on actual hardware.\n+def releaseBranches = ['master', 'next-major', 'v10']\n+// Branches that are \"important\", so if the do not compile they will generate a Slack notification", "originalCommit": "439f4f08fd913e5cb65d6fc6602d1c8081a0707e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODgyNDI0Mg==", "url": "https://github.com/realm/realm-java/pull/6822#discussion_r418824242", "bodyText": "is the slack bot fixed? or is it pointing to the old Realm.io Slack?", "author": "nhachicha", "createdAt": "2020-05-02T01:50:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODgyMzkxOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODkzNTgwMg==", "url": "https://github.com/realm/realm-java/pull/6822#discussion_r418935802", "bodyText": "No, it isn't fixed. I need to look at that as well.", "author": "cmelchior", "createdAt": "2020-05-02T09:24:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODgyMzkxOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODgyNzU4Nw==", "url": "https://github.com/realm/realm-java/pull/6822#discussion_r418827587", "bodyText": "You're running a 32-bit emulator, are you sure the i386 arch is no longer needed?", "author": "nhachicha", "createdAt": "2020-05-02T01:59:40Z", "path": "Dockerfile", "diffHunk": "@@ -16,23 +18,24 @@ ENV PATH ${PATH}:${ANDROID_HOME}/tools:${ANDROID_HOME}/tools/bin:${ANDROID_HOME}\n ENV PATH ${PATH}:${NDK_HOME}\n ENV NDK_CCACHE /usr/bin/ccache\n \n-# The 32 bit binaries because aapt requires it\n-# `file` is need by the script that creates NDK toolchains\n # Keep the packages in alphabetical order to make it easy to avoid duplication\n-RUN DEBIAN_FRONTEND=noninteractive dpkg --add-architecture i386 \\", "originalCommit": "439f4f08fd913e5cb65d6fc6602d1c8081a0707e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODkzNTg4OA==", "url": "https://github.com/realm/realm-java/pull/6822#discussion_r418935888", "bodyText": "I'm not sure of much right now. It looked like the old 32-bit behavior was required by the old version of AAPT. So it should be safe to switch to 64-bit on the OS.", "author": "cmelchior", "createdAt": "2020-05-02T09:25:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODgyNzU4Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODgyODAwMA==", "url": "https://github.com/realm/realm-java/pull/6822#discussion_r418828000", "bodyText": "why no 64-bit image for the emulator?", "author": "nhachicha", "createdAt": "2020-05-02T02:00:53Z", "path": "Jenkinsfile", "diffHunk": "@@ -72,89 +89,30 @@ try {\n \n             // Lock required around all usages of Gradle as it isn't\n             // able to share its cache between builds.\n-            lock(\"${env.NODE_NAME}-android\") {\n-\n-              stage('JVM tests') {\n-                try {\n-                  withCredentials([[$class: 'FileBinding', credentialsId: 'c0cc8f9e-c3f1-4e22-b22f-6568392e26ae', variable: 'S3CFG']]) {\n-                    sh \"chmod +x gradlew && ./gradlew assemble check javadoc -Ps3cfg=${env.S3CFG} ${abiFilter} --stacktrace\"\n-                  }\n-                } finally {\n-                  storeJunitResults 'realm/realm-annotations-processor/build/test-results/test/TEST-*.xml'\n-                  storeJunitResults 'examples/unitTestExample/build/test-results/**/TEST-*.xml'\n-                  step([$class: 'LintPublisher'])\n-                }\n+            if (useEmulator) {\n+              // TODO: We should wait until the emulator is online. For now assume it starts fast enough\n+              // before the tests will run.\n+              sh '''yes \"\\n\" | avdmanager create avd -n CIEmulator -k \"system-images;android-29;default;x86\" --force'''", "originalCommit": "439f4f08fd913e5cb65d6fc6602d1c8081a0707e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODkzNjIwMQ==", "url": "https://github.com/realm/realm-java/pull/6822#discussion_r418936201", "bodyText": "I'm running into all sorts of problems with the 64-bit emulator. I'm running into this error described here: mingchen/docker-android-build-box#18\nSo far, it seems the only solution is running arm emulators instead on Docker. I really hope we don't need to do that because I suspect that would be unbearable slow.\nFrom what I can tell, the only other solution is havin dedicated machines that run emulators, because then they can run as part of the host.", "author": "cmelchior", "createdAt": "2020-05-02T09:28:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODgyODAwMA=="}], "type": "inlineReview"}, {"oid": "4010f11427cc000ce10bad8a85a9a94898061128", "url": "https://github.com/realm/realm-java/commit/4010f11427cc000ce10bad8a85a9a94898061128", "message": "Name", "committedDate": "2020-05-02T09:16:51Z", "type": "commit"}, {"oid": "0efc33bef1d7a56cfd2dec3a141078739a6ba0ee", "url": "https://github.com/realm/realm-java/commit/0efc33bef1d7a56cfd2dec3a141078739a6ba0ee", "message": "Add emulator debug info", "committedDate": "2020-05-02T11:25:51Z", "type": "commit"}, {"oid": "e7c4f552675596b879df7cc7171aeed22f005a69", "url": "https://github.com/realm/realm-java/commit/e7c4f552675596b879df7cc7171aeed22f005a69", "message": "Add emulator to path", "committedDate": "2020-05-02T11:29:10Z", "type": "commit"}, {"oid": "5a32a3bca8cb439047abb4ba6011f5d20a25d33c", "url": "https://github.com/realm/realm-java/commit/5a32a3bca8cb439047abb4ba6011f5d20a25d33c", "message": "Disable debug info", "committedDate": "2020-05-02T11:37:14Z", "type": "commit"}, {"oid": "73996329c80e54e1ea94231432e1e65158333f2c", "url": "https://github.com/realm/realm-java/commit/73996329c80e54e1ea94231432e1e65158333f2c", "message": "Force 32 bit emulator option", "committedDate": "2020-05-02T11:56:58Z", "type": "commit"}, {"oid": "acb38f24591c9d0ab628439fb95cac6f95ecf0bd", "url": "https://github.com/realm/realm-java/commit/acb38f24591c9d0ab628439fb95cac6f95ecf0bd", "message": "Revert to using armeabi-v7a emulator", "committedDate": "2020-05-02T12:25:19Z", "type": "commit"}, {"oid": "911a328df185ecc994fa952a450c79aa2919a90e", "url": "https://github.com/realm/realm-java/commit/911a328df185ecc994fa952a450c79aa2919a90e", "message": "Fix paths", "committedDate": "2020-05-02T14:23:24Z", "type": "commit"}, {"oid": "a9d119c6f5465bf5ee7e6b761f5288d79ef36c3c", "url": "https://github.com/realm/realm-java/commit/a9d119c6f5465bf5ee7e6b761f5288d79ef36c3c", "message": "Run emulator from its home dir", "committedDate": "2020-05-02T14:54:23Z", "type": "commit"}, {"oid": "f14e5ff8b8aa18363325022c02e9b6e23fbd288e", "url": "https://github.com/realm/realm-java/commit/f14e5ff8b8aa18363325022c02e9b6e23fbd288e", "message": "Install emulator", "committedDate": "2020-05-02T16:21:07Z", "type": "commit"}, {"oid": "24ce88f9bd90311b0abbcc81430ee5442575904f", "url": "https://github.com/realm/realm-java/commit/24ce88f9bd90311b0abbcc81430ee5442575904f", "message": "Why bother...", "committedDate": "2020-05-02T18:24:54Z", "type": "commit"}, {"oid": "1aa9117f97bcec5f41e6b75ea1108431041ae5bb", "url": "https://github.com/realm/realm-java/commit/1aa9117f97bcec5f41e6b75ea1108431041ae5bb", "message": "Add support for multiple devices", "committedDate": "2020-05-02T19:12:49Z", "type": "commit"}, {"oid": "1b67d9ea33b28ea52e1da99c276bbf0a875f6354", "url": "https://github.com/realm/realm-java/commit/1b67d9ea33b28ea52e1da99c276bbf0a875f6354", "message": "Restrict device using ENV (to support tests)", "committedDate": "2020-05-02T19:49:42Z", "type": "commit"}, {"oid": "ab2ea8cc223f5882ae45b9cbdb067c510c0ed92a", "url": "https://github.com/realm/realm-java/commit/ab2ea8cc223f5882ae45b9cbdb067c510c0ed92a", "message": "Testing how long it takes", "committedDate": "2020-05-02T21:13:36Z", "type": "commit"}, {"oid": "56e61cb4fe6ba221aa18022661c0224b08a227e1", "url": "https://github.com/realm/realm-java/commit/56e61cb4fe6ba221aa18022661c0224b08a227e1", "message": "Attempt to use x86 emulator", "committedDate": "2020-05-03T19:33:03Z", "type": "commit"}, {"oid": "edc48f267104c1f5e768cf904dc04b2f27449891", "url": "https://github.com/realm/realm-java/commit/edc48f267104c1f5e768cf904dc04b2f27449891", "message": "Use approach from SO", "committedDate": "2020-05-03T19:39:26Z", "type": "commit"}, {"oid": "5558f4eaafd2b5973275e752aa06502cd0cb93cd", "url": "https://github.com/realm/realm-java/commit/5558f4eaafd2b5973275e752aa06502cd0cb93cd", "message": "Specific x86_64", "committedDate": "2020-05-03T19:44:13Z", "type": "commit"}, {"oid": "8e49a6cc3db65d6d20391bc0bbbe140c73450242", "url": "https://github.com/realm/realm-java/commit/8e49a6cc3db65d6d20391bc0bbbe140c73450242", "message": "Stupid", "committedDate": "2020-05-03T19:48:44Z", "type": "commit"}, {"oid": "41d5528af97f56503643e9f047951dc1cec49044", "url": "https://github.com/realm/realm-java/commit/41d5528af97f56503643e9f047951dc1cec49044", "message": "Once again", "committedDate": "2020-05-03T19:51:39Z", "type": "commit"}, {"oid": "afc4164f03128ebac1fbf50b5b15ca2ebeb36448", "url": "https://github.com/realm/realm-java/commit/afc4164f03128ebac1fbf50b5b15ca2ebeb36448", "message": "Just install KVM and see if that is enough", "committedDate": "2020-05-03T20:10:12Z", "type": "commit"}, {"oid": "a2ddd98d50d83bfafaa55f56611485735f1bb920", "url": "https://github.com/realm/realm-java/commit/a2ddd98d50d83bfafaa55f56611485735f1bb920", "message": "More guesswork", "committedDate": "2020-05-03T20:22:27Z", "type": "commit"}, {"oid": "d91ed551b7b3d90579886afd37aa8985e0bd9cef", "url": "https://github.com/realm/realm-java/commit/d91ed551b7b3d90579886afd37aa8985e0bd9cef", "message": "Remove dead package", "committedDate": "2020-05-03T20:25:57Z", "type": "commit"}, {"oid": "1f3d60f33a319cb4ec43ee2e48e97cdc98554e6c", "url": "https://github.com/realm/realm-java/commit/1f3d60f33a319cb4ec43ee2e48e97cdc98554e6c", "message": "Dont use sudo", "committedDate": "2020-05-03T20:34:13Z", "type": "commit"}, {"oid": "5403258e413992e5516bd6193792bcf2d101a7d1", "url": "https://github.com/realm/realm-java/commit/5403258e413992e5516bd6193792bcf2d101a7d1", "message": "Would be nice with an accurate tutorial for once", "committedDate": "2020-05-03T20:37:59Z", "type": "commit"}, {"oid": "1a6ed53bf0fc9797e685f752b9db26967743eb4c", "url": "https://github.com/realm/realm-java/commit/1a6ed53bf0fc9797e685f752b9db26967743eb4c", "message": "Who am I kiddin...", "committedDate": "2020-05-03T20:39:18Z", "type": "commit"}, {"oid": "825c1529b5c1fe4f898d6c0e17ffd9b065b4d75b", "url": "https://github.com/realm/realm-java/commit/825c1529b5c1fe4f898d6c0e17ffd9b065b4d75b", "message": "Run on x86", "committedDate": "2020-05-03T20:55:44Z", "type": "commit"}, {"oid": "32ded6eb9de9e55e1e04d1bec3d7960620d5fb3b", "url": "https://github.com/realm/realm-java/commit/32ded6eb9de9e55e1e04d1bec3d7960620d5fb3b", "message": "Quotes", "committedDate": "2020-05-03T21:12:43Z", "type": "commit"}, {"oid": "0af7c2628f9ef3d527563d30159fc0ffd48e8abc", "url": "https://github.com/realm/realm-java/commit/0af7c2628f9ef3d527563d30159fc0ffd48e8abc", "message": "More fixes", "committedDate": "2020-05-03T21:18:43Z", "type": "commit"}, {"oid": "eedfcd127b8105bc0941603b66408ae70fae716d", "url": "https://github.com/realm/realm-java/commit/eedfcd127b8105bc0941603b66408ae70fae716d", "message": "Couldn't this be easy for once...", "committedDate": "2020-05-03T21:29:20Z", "type": "commit"}, {"oid": "4a4c1c8ead0fad85e044afbc0ec063359440a1c5", "url": "https://github.com/realm/realm-java/commit/4a4c1c8ead0fad85e044afbc0ec063359440a1c5", "message": "attempt to relogin user", "committedDate": "2020-05-03T22:05:40Z", "type": "commit"}, {"oid": "1c8db4bed1b42ce32afcba332ed2236b7c076e19", "url": "https://github.com/realm/realm-java/commit/1c8db4bed1b42ce32afcba332ed2236b7c076e19", "message": "Add debug info for user", "committedDate": "2020-05-03T22:14:20Z", "type": "commit"}, {"oid": "4a6fd442b7d9e1541b4454bb60cd0e20e181d314", "url": "https://github.com/realm/realm-java/commit/4a6fd442b7d9e1541b4454bb60cd0e20e181d314", "message": "Merge branch 'v10' into cm/use-emulator\n\n# Conflicts:\n#\tJenkinsfile", "committedDate": "2020-05-05T07:34:38Z", "type": "commit"}, {"oid": "26de4be779cbf9bb8f5aef6019e1c9acebd87a54", "url": "https://github.com/realm/realm-java/commit/26de4be779cbf9bb8f5aef6019e1c9acebd87a54", "message": "Attempt to run as root", "committedDate": "2020-05-05T10:36:51Z", "type": "commit"}, {"oid": "bff863cd3d8f41ee56c4900f05a17a11c0642d10", "url": "https://github.com/realm/realm-java/commit/bff863cd3d8f41ee56c4900f05a17a11c0642d10", "message": "Merge branch 'v10' into cm/use-emulator\n\n# Conflicts:\n#\tJenkinsfile", "committedDate": "2020-05-05T14:22:09Z", "type": "commit"}, {"oid": "baed0d765031546ad829c2c883c076be7144d402", "url": "https://github.com/realm/realm-java/commit/baed0d765031546ad829c2c883c076be7144d402", "message": "Wait for host support for KVM. Don't run as root.", "committedDate": "2020-05-06T10:12:28Z", "type": "commit"}, {"oid": "b7adb0d2323dfc9cde765b6bd24e9ae5ea428ebf", "url": "https://github.com/realm/realm-java/commit/b7adb0d2323dfc9cde765b6bd24e9ae5ea428ebf", "message": "Update OS", "committedDate": "2020-05-29T08:27:51Z", "type": "commit"}, {"oid": "70b8ecb0e5bd55b37da5465b72c21ebddd036d70", "url": "https://github.com/realm/realm-java/commit/70b8ecb0e5bd55b37da5465b72c21ebddd036d70", "message": "Use all android devices", "committedDate": "2020-05-29T08:30:27Z", "type": "commit"}, {"oid": "146eff51424d33ad546f04ba16c525a08fac7fbd", "url": "https://github.com/realm/realm-java/commit/146eff51424d33ad546f04ba16c525a08fac7fbd", "message": "Fix syntax error", "committedDate": "2020-05-29T08:45:01Z", "type": "commit"}, {"oid": "791dabfdc35ad9f489c69971b133494d0cb72afb", "url": "https://github.com/realm/realm-java/commit/791dabfdc35ad9f489c69971b133494d0cb72afb", "message": "Merge branch 'v10' into cm/use-emulator\n\n# Conflicts:\n#\tJenkinsfile", "committedDate": "2020-06-11T08:12:54Z", "type": "commit"}, {"oid": "ba01920156f828b513492e72caf4167b348e9478", "url": "https://github.com/realm/realm-java/commit/ba01920156f828b513492e72caf4167b348e9478", "message": "Use correct version of OS. Start ADB before running emulator", "committedDate": "2020-06-11T08:36:51Z", "type": "commit"}, {"oid": "44e0a76406fc8d2b2fd577852294436fb9bfb6d5", "url": "https://github.com/realm/realm-java/commit/44e0a76406fc8d2b2fd577852294436fb9bfb6d5", "message": "Attempt to boot emulator UI", "committedDate": "2020-06-11T10:03:11Z", "type": "commit"}, {"oid": "2900b568bf5fd4b41ce7b8d17815d9ff5fedafaf", "url": "https://github.com/realm/realm-java/commit/2900b568bf5fd4b41ce7b8d17815d9ff5fedafaf", "message": "Install Qt on Docker", "committedDate": "2020-06-11T11:10:04Z", "type": "commit"}, {"oid": "476bfb3240552bc798b2e7d9fa7267e0510c625c", "url": "https://github.com/realm/realm-java/commit/476bfb3240552bc798b2e7d9fa7267e0510c625c", "message": "Add Qt to env", "committedDate": "2020-06-16T08:17:16Z", "type": "commit"}, {"oid": "275db3efc2dc50e3691b57b21ffa54056d9c1ab1", "url": "https://github.com/realm/realm-java/commit/275db3efc2dc50e3691b57b21ffa54056d9c1ab1", "message": "Add Qt plugin path", "committedDate": "2020-06-16T08:45:32Z", "type": "commit"}, {"oid": "62ed8a19965d6aa97b680c986abb31ef7f478d8e", "url": "https://github.com/realm/realm-java/commit/62ed8a19965d6aa97b680c986abb31ef7f478d8e", "message": "Add Qt debug env var", "committedDate": "2020-06-16T09:43:19Z", "type": "commit"}, {"oid": "f48c2147e7f50d0f3161c08497b048ce80c67561", "url": "https://github.com/realm/realm-java/commit/f48c2147e7f50d0f3161c08497b048ce80c67561", "message": "Start emulator and ignore test", "committedDate": "2020-06-16T11:54:47Z", "type": "commit"}, {"oid": "2727c5de369ed733eacb4711cb80b321164a205a", "url": "https://github.com/realm/realm-java/commit/2727c5de369ed733eacb4711cb80b321164a205a", "message": "Ignore more tests", "committedDate": "2020-06-16T12:40:35Z", "type": "commit"}, {"oid": "5d30361187b655c1e4c416f20f4e54bb6fec5c8a", "url": "https://github.com/realm/realm-java/commit/5d30361187b655c1e4c416f20f4e54bb6fec5c8a", "message": "Ignore more tests", "committedDate": "2020-06-16T12:58:03Z", "type": "commit"}, {"oid": "a2c6c6ca87c0d1480a4e191f4ab65434e6af5bb3", "url": "https://github.com/realm/realm-java/commit/a2c6c6ca87c0d1480a4e191f4ab65434e6af5bb3", "message": "Merge branch 'v10' into cm/use-emulator", "committedDate": "2020-06-16T13:55:15Z", "type": "commit"}, {"oid": "1f426f764cf63584063419da4256066960d278b8", "url": "https://github.com/realm/realm-java/commit/1f426f764cf63584063419da4256066960d278b8", "message": "Cleanup and use lock for all targets", "committedDate": "2020-06-16T14:22:25Z", "type": "commit"}, {"oid": "74b730feb99597e8d910b5ff68933a3d0b40db5d", "url": "https://github.com/realm/realm-java/commit/74b730feb99597e8d910b5ff68933a3d0b40db5d", "message": "Forward current branch", "committedDate": "2020-06-16T16:12:55Z", "type": "commit"}, {"oid": "d04a56381c414e93a3342e94402ac8a8c0df2612", "url": "https://github.com/realm/realm-java/commit/d04a56381c414e93a3342e94402ac8a8c0df2612", "message": "Remove def", "committedDate": "2020-06-16T16:35:36Z", "type": "commit"}, {"oid": "8f0214f1302f501005c9a60b7e7d8c3a3daae484", "url": "https://github.com/realm/realm-java/commit/8f0214f1302f501005c9a60b7e7d8c3a3daae484", "message": "Remove Qt", "committedDate": "2020-06-17T09:30:36Z", "type": "commit"}, {"oid": "dcb5a66212af1fb05085abcb637f2ff156a345cf", "url": "https://github.com/realm/realm-java/commit/dcb5a66212af1fb05085abcb637f2ff156a345cf", "message": "Cleanup", "committedDate": "2020-06-17T13:14:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjAyNzQwOQ==", "url": "https://github.com/realm/realm-java/pull/6822#discussion_r442027409", "bodyText": "All tests in SyncSessionTests should be fixed by #6954", "author": "rorbech", "createdAt": "2020-06-18T07:37:37Z", "path": "realm/realm-library/src/syncIntegrationTest/kotlin/io/realm/SyncSessionTests.kt", "diffHunk": "@@ -111,6 +111,7 @@ class SyncSessionTests {\n     }\n \n     @Test\n+    @Ignore(\"FIXME\")", "originalCommit": "dcb5a66212af1fb05085abcb637f2ff156a345cf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjAzMTAyNA==", "url": "https://github.com/realm/realm-java/pull/6822#discussion_r442031024", "bodyText": "Some of these tests should be fixed by #6954. Still looking at the rest of them.", "author": "rorbech", "createdAt": "2020-06-18T07:44:05Z", "path": "realm/realm-library/src/androidTestObjectServer/kotlin/io/realm/mongodb/sync/SyncedRealmTests.kt", "diffHunk": "@@ -67,6 +67,7 @@ class SyncedRealmTests {\n \n     // Smoke test for Sync. Waiting for working Sync support.\n     @Test\n+    @Ignore(\"FIXME\")", "originalCommit": "dcb5a66212af1fb05085abcb637f2ff156a345cf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjAzMzE0MA==", "url": "https://github.com/realm/realm-java/pull/6822#discussion_r442033140", "bodyText": "Nitpick, but I guess nodeSelector would be more meaningful.", "author": "rorbech", "createdAt": "2020-06-18T07:47:57Z", "path": "Jenkinsfile", "diffHunk": "@@ -4,14 +4,20 @@\n \n import groovy.json.JsonOutput\n \n-def buildSuccess = false\n-def mongoDbRealmContainer = null\n-def mongoDbRealmCommandServerContainer = null\n-def dockerNetworkId = UUID.randomUUID().toString()\n-def releaseBranches = ['master', 'next-major', 'v10'] // Branches from which we release SNAPSHOT's\n-def currentBranch = env.CHANGE_BRANCH\n+buildSuccess = false\n+mongoDbRealmContainer = null\n+mongoDbRealmCommandServerContainer = null\n+emulatorContainer = null\n+dockerNetworkId = UUID.randomUUID().toString()\n+// Branches from which we release SNAPSHOT's. Only release branches need to run on actual hardware.\n+releaseBranches = ['master', 'next-major', 'v10']\n+// Branches that are \"important\", so if they do not compile they will generate a Slack notification\n+slackNotificationBranches = [ 'master', 'releases', 'next-major', 'v10' ]\n+currentBranch = env.CHANGE_BRANCH\n+// 'android' nodes have android devices attached and 'brix' are physical machines in Copenhagen.\n+nodeName = (releaseBranches.contains(currentBranch)) ? 'android' : 'docker-cph-03' // Switch to `brix` when all CPH nodes work: https://jira.mongodb.org/browse/RCI-14", "originalCommit": "dcb5a66212af1fb05085abcb637f2ff156a345cf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjAzNTEwMA==", "url": "https://github.com/realm/realm-java/pull/6822#discussion_r442035100", "bodyText": "Where does this come from? Assumes it is built into the emulator image.", "author": "rorbech", "createdAt": "2020-06-18T07:51:23Z", "path": "Jenkinsfile", "diffHunk": "@@ -29,16 +35,21 @@ try {\n         }\n \n         // Toggles for PR vs. Master builds.\n-        // For PR's, we just build for arm-v7a and run unit tests for the ObjectServer variant\n-        // A full build is done on `master`.\n-        // TODO Once Android emulators are available on all nodes, we can switch to x86 builds\n-        // on PR's for even more throughput.\n+        // - For PR's, we favor speed > absolute correctness. So we just build for x86, use an\n+        //   emulator and run unit tests for the ObjectServer variant.\n+        // - For branches from which we make releases, we build all architectures and run tests\n+        //   on an actual device.\n+        def useEmulator = false\n+        def emulatorImage = \"\"\n         def abiFilter = \"\"\n         def instrumentationTestTarget = \"connectedAndroidTest\"\n+        def deviceSerial = \"\"\n         if (!releaseBranches.contains(currentBranch)) {\n-          abiFilter = \"-PbuildTargetABIs=armeabi-v7a\"\n+          useEmulator = true\n+          emulatorImage = \"system-images;android-29;default;x86\"\n+          abiFilter = \"-PbuildTargetABIs=x86\"\n           instrumentationTestTarget = \"connectedObjectServerDebugAndroidTest\"\n-          // Run in debug more for better error reporting\n+          deviceSerial = \"emulator-5554\"", "originalCommit": "dcb5a66212af1fb05085abcb637f2ff156a345cf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjAzODc5Mg==", "url": "https://github.com/realm/realm-java/pull/6822#discussion_r442038792", "bodyText": "Yes, it is the default serial id.", "author": "cmelchior", "createdAt": "2020-06-18T07:57:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjAzNTEwMA=="}], "type": "inlineReview"}, {"oid": "edc8f81a575aeed74ae4b9a49307157f1918d9c8", "url": "https://github.com/realm/realm-java/commit/edc8f81a575aeed74ae4b9a49307157f1918d9c8", "message": "Merge branch 'v10' into cm/use-emulator\n\n# Conflicts:\n#\trealm/realm-library/src/syncIntegrationTest/kotlin/io/realm/SyncSessionTests.kt", "committedDate": "2020-06-18T13:54:10Z", "type": "commit"}, {"oid": "4d774afa03af62dddd82fc94e2d9cccc51635adc", "url": "https://github.com/realm/realm-java/commit/4d774afa03af62dddd82fc94e2d9cccc51635adc", "message": "Re-enable test", "committedDate": "2020-06-18T13:56:16Z", "type": "commit"}]}