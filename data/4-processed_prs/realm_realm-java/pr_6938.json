{"pr_number": 6938, "pr_title": "Avoid crash if looking up NetworkTransport response class from C++ thread", "pr_createdAt": "2020-06-10T11:46:48Z", "pr_url": "https://github.com/realm/realm-java/pull/6938", "timeline": [{"oid": "8b916a8be6a9019338f25dd64de7798ed687f681", "url": "https://github.com/realm/realm-java/commit/8b916a8be6a9019338f25dd64de7798ed687f681", "message": "Don't crash if looking up NetworkTransport response class from C++ thread", "committedDate": "2020-06-10T11:40:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODA2ODk5Mg==", "url": "https://github.com/realm/realm-java/pull/6938#discussion_r438068992", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            * [RealmApp] When opening asynced Realm with a cached user, and the user access token had expired. It would crash the app with `Assertion failed: cls with (class_name) = [\"io/realm/internal/objectstore/OsJavaNetworkTransport$Response\"]`. (Issue [#6937](https://github.com/realm/realm-java/issues/6937), since 10.0.0-BETA.1)\n          \n          \n            \n            * [RealmApp] Opening a synced Realm for a cached user with expired access token would crash the app with `Assertion failed: cls with (class_name) = [\"io/realm/internal/objectstore/OsJavaNetworkTransport$Response\"]`. (Issue [#6937](https://github.com/realm/realm-java/issues/6937), since 10.0.0-BETA.1)", "author": "rorbech", "createdAt": "2020-06-10T12:03:26Z", "path": "CHANGELOG.md", "diffHunk": "@@ -1,3 +1,27 @@\n+## 10.0.0-BETA.4 (YYYY-MM-DD)\n+\n+We no longer support Realm Cloud (legacy), but instead the new MongoDB Realm Cloud. MongoDB Realm is a serverless platform that enables developers to quickly build applications without having to set up server infrastructure. MongoDB Realm is built on top of MongoDB Atlas, automatically integrating the connection to your database.\n+\n+The old Realm Cloud legacy API's have undergone significant refactoring. The new API's are all located in the `io.realm.mongodb` package with `io.realm.mongodb.App` as the entry point.\n+\n+### Breaking Changes \n+* None\n+\n+### Enhancements\n+* None\n+\n+### Fixed\n+* [RealmApp] When opening asynced Realm with a cached user, and the user access token had expired. It would crash the app with `Assertion failed: cls with (class_name) = [\"io/realm/internal/objectstore/OsJavaNetworkTransport$Response\"]`. (Issue [#6937](https://github.com/realm/realm-java/issues/6937), since 10.0.0-BETA.1)", "originalCommit": "8b916a8be6a9019338f25dd64de7798ed687f681", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODA3MTg4NA==", "url": "https://github.com/realm/realm-java/pull/6938#discussion_r438071884", "bodyText": "Not strong on the C++ details, but maybe fetch the class once. Maybe it is optimized away, but wouldn't that require it to be declared const.", "author": "rorbech", "createdAt": "2020-06-10T12:09:14Z", "path": "realm/realm-library/src/main/cpp/java_network_transport.hpp", "diffHunk": "@@ -84,11 +84,10 @@ struct JavaNetworkTransport : public app::GenericNetworkTransport {\n             return;\n         } else {\n             // Read response\n-            static JavaClass responseClass(env, \"io/realm/internal/objectstore/OsJavaNetworkTransport$Response\");\n-            static JavaMethod get_http_code_method(env, responseClass, \"getHttpResponseCode\", \"()I\");\n-            static JavaMethod get_custom_code_method(env, responseClass, \"getCustomResponseCode\", \"()I\");\n-            static JavaMethod get_headers_method(env, responseClass, \"getJNIFriendlyHeaders\", \"()[Ljava/lang/String;\");\n-            static JavaMethod get_body_method(env, responseClass, \"getBody\", \"()Ljava/lang/String;\");\n+            static JavaMethod get_http_code_method(env, JavaClassGlobalDef::network_transport_response_class(), \"getHttpResponseCode\", \"()I\");", "originalCommit": "8b916a8be6a9019338f25dd64de7798ed687f681", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "1f7dc28788f0ff355a755e4664750f9f2ce36c28", "url": "https://github.com/realm/realm-java/commit/1f7dc28788f0ff355a755e4664750f9f2ce36c28", "message": "PR feedback", "committedDate": "2020-06-10T15:30:31Z", "type": "commit"}]}