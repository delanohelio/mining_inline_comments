{"pr_number": 4344, "pr_title": "Add human_readable timestamp function", "pr_createdAt": "2020-07-04T07:16:32Z", "pr_url": "https://github.com/trinodb/trino/pull/4344", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjkyODY2Mw==", "url": "https://github.com/trinodb/trino/pull/4344#discussion_r456928663", "bodyText": "Did you forget to delete this class?", "author": "martint", "createdAt": "2020-07-19T16:34:07Z", "path": "presto-main/src/main/java/io/prestosql/operator/scalar/timestamp/HumanReadable.java", "diffHunk": "@@ -0,0 +1,136 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.prestosql.operator.scalar.timestamp;\n+\n+import io.airlift.slice.Slice;\n+import io.prestosql.spi.function.ScalarFunction;\n+import io.prestosql.spi.function.SqlType;\n+import io.prestosql.spi.type.StandardTypes;\n+\n+import java.util.StringJoiner;\n+import java.util.concurrent.TimeUnit;\n+\n+import static io.airlift.slice.Slices.utf8Slice;\n+\n+@ScalarFunction(\"human_readable\")\n+public final class HumanReadable", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTEzNzMzMQ==", "url": "https://github.com/trinodb/trino/pull/4344#discussion_r475137331", "bodyText": "My Bad. This is deleted now.", "author": "haldes", "createdAt": "2020-08-22T20:52:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjkyODY2Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjkyODY3OQ==", "url": "https://github.com/trinodb/trino/pull/4344#discussion_r456928679", "bodyText": "This constant is not used", "author": "martint", "createdAt": "2020-07-19T16:34:18Z", "path": "presto-main/src/main/java/io/prestosql/operator/scalar/timestamp/HumanReadableSeconds.java", "diffHunk": "@@ -0,0 +1,136 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.prestosql.operator.scalar.timestamp;\n+\n+import io.airlift.slice.Slice;\n+import io.prestosql.spi.function.ScalarFunction;\n+import io.prestosql.spi.function.SqlType;\n+import io.prestosql.spi.type.StandardTypes;\n+\n+import java.util.StringJoiner;\n+import java.util.concurrent.TimeUnit;\n+\n+import static io.airlift.slice.Slices.utf8Slice;\n+\n+@ScalarFunction(\"human_readable_seconds\")\n+public final class HumanReadableSeconds\n+{\n+    private static final String HUMAN_REDABLE_FORMAT = \"%s, %s, %s, %s, %s\";", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTEzNzM0Mg==", "url": "https://github.com/trinodb/trino/pull/4344#discussion_r475137342", "bodyText": "this is removed", "author": "haldes", "createdAt": "2020-08-22T20:52:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjkyODY3OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjkyODczMA==", "url": "https://github.com/trinodb/trino/pull/4344#discussion_r456928730", "bodyText": "Why DOUBLE?\nWhat happens when the value is NaN or Infinity?\nAlso, if we want to stick with DOUBLE, it would make sense to round to the nearest second instead of truncating.", "author": "martint", "createdAt": "2020-07-19T16:34:46Z", "path": "presto-main/src/main/java/io/prestosql/operator/scalar/timestamp/HumanReadableSeconds.java", "diffHunk": "@@ -0,0 +1,136 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.prestosql.operator.scalar.timestamp;\n+\n+import io.airlift.slice.Slice;\n+import io.prestosql.spi.function.ScalarFunction;\n+import io.prestosql.spi.function.SqlType;\n+import io.prestosql.spi.type.StandardTypes;\n+\n+import java.util.StringJoiner;\n+import java.util.concurrent.TimeUnit;\n+\n+import static io.airlift.slice.Slices.utf8Slice;\n+\n+@ScalarFunction(\"human_readable_seconds\")\n+public final class HumanReadableSeconds\n+{\n+    private static final String HUMAN_REDABLE_FORMAT = \"%s, %s, %s, %s, %s\";\n+    private static final int DAYS_IN_WEEK = 7;\n+    private static final String WEEK = \"week\";\n+    private static final String DAY = \"day\";\n+    private static final String HOUR = \"hour\";\n+    private static final String MINUTE = \"minute\";\n+    private static final String SECOND = \"second\";\n+\n+    private HumanReadableSeconds() {}\n+\n+    @SqlType(StandardTypes.VARCHAR)\n+    public static Slice humanReadable(@SqlType(StandardTypes.DOUBLE) double inputSeconds)", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTEzNzQyOA==", "url": "https://github.com/trinodb/trino/pull/4344#discussion_r475137428", "bodyText": "Have added checks for Nan and Infinity to return null. Is that ok?", "author": "haldes", "createdAt": "2020-08-22T20:53:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjkyODczMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTEzOTY5Nw==", "url": "https://github.com/trinodb/trino/pull/4344#discussion_r475139697", "bodyText": "It'd be better to fail with an error in those cases.", "author": "martint", "createdAt": "2020-08-22T21:24:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjkyODczMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTI0MjQ1Nw==", "url": "https://github.com/trinodb/trino/pull/4344#discussion_r475242457", "bodyText": "I have made the change to throw error for NaN and Infinity", "author": "haldes", "createdAt": "2020-08-23T17:07:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjkyODczMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjkyODgyOA==", "url": "https://github.com/trinodb/trino/pull/4344#discussion_r456928828", "bodyText": "(long) inputSeconds", "author": "martint", "createdAt": "2020-07-19T16:35:49Z", "path": "presto-main/src/main/java/io/prestosql/operator/scalar/timestamp/HumanReadableSeconds.java", "diffHunk": "@@ -0,0 +1,136 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.prestosql.operator.scalar.timestamp;\n+\n+import io.airlift.slice.Slice;\n+import io.prestosql.spi.function.ScalarFunction;\n+import io.prestosql.spi.function.SqlType;\n+import io.prestosql.spi.type.StandardTypes;\n+\n+import java.util.StringJoiner;\n+import java.util.concurrent.TimeUnit;\n+\n+import static io.airlift.slice.Slices.utf8Slice;\n+\n+@ScalarFunction(\"human_readable_seconds\")\n+public final class HumanReadableSeconds\n+{\n+    private static final String HUMAN_REDABLE_FORMAT = \"%s, %s, %s, %s, %s\";\n+    private static final int DAYS_IN_WEEK = 7;\n+    private static final String WEEK = \"week\";\n+    private static final String DAY = \"day\";\n+    private static final String HOUR = \"hour\";\n+    private static final String MINUTE = \"minute\";\n+    private static final String SECOND = \"second\";\n+\n+    private HumanReadableSeconds() {}\n+\n+    @SqlType(StandardTypes.VARCHAR)\n+    public static Slice humanReadable(@SqlType(StandardTypes.DOUBLE) double inputSeconds)\n+    {\n+        long seconds = Double.valueOf(inputSeconds).longValue();", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTEzNzQ3OA==", "url": "https://github.com/trinodb/trino/pull/4344#discussion_r475137478", "bodyText": "Rounding up double to long", "author": "haldes", "createdAt": "2020-08-22T20:54:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjkyODgyOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjkyOTA4Mw==", "url": "https://github.com/trinodb/trino/pull/4344#discussion_r456929083", "bodyText": "@SqlType(StandardTypes.BIGINT) is not needed for these methods. The annotation is used by Presto to discover metadata about functions, but these are implementation details internal to the function", "author": "martint", "createdAt": "2020-07-19T16:38:23Z", "path": "presto-main/src/main/java/io/prestosql/operator/scalar/timestamp/HumanReadableSeconds.java", "diffHunk": "@@ -0,0 +1,136 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.prestosql.operator.scalar.timestamp;\n+\n+import io.airlift.slice.Slice;\n+import io.prestosql.spi.function.ScalarFunction;\n+import io.prestosql.spi.function.SqlType;\n+import io.prestosql.spi.type.StandardTypes;\n+\n+import java.util.StringJoiner;\n+import java.util.concurrent.TimeUnit;\n+\n+import static io.airlift.slice.Slices.utf8Slice;\n+\n+@ScalarFunction(\"human_readable_seconds\")\n+public final class HumanReadableSeconds\n+{\n+    private static final String HUMAN_REDABLE_FORMAT = \"%s, %s, %s, %s, %s\";\n+    private static final int DAYS_IN_WEEK = 7;\n+    private static final String WEEK = \"week\";\n+    private static final String DAY = \"day\";\n+    private static final String HOUR = \"hour\";\n+    private static final String MINUTE = \"minute\";\n+    private static final String SECOND = \"second\";\n+\n+    private HumanReadableSeconds() {}\n+\n+    @SqlType(StandardTypes.VARCHAR)\n+    public static Slice humanReadable(@SqlType(StandardTypes.DOUBLE) double inputSeconds)\n+    {\n+        long seconds = Double.valueOf(inputSeconds).longValue();\n+\n+        long weeks = processWeeks(seconds);\n+        if (weeks > 0) {\n+            seconds -= TimeUnit.DAYS.toSeconds(weeks * DAYS_IN_WEEK);\n+        }\n+\n+        long days = processDays(seconds);\n+        seconds -= TimeUnit.DAYS.toSeconds(days);\n+\n+        long hours = processHours(seconds);\n+        seconds -= TimeUnit.HOURS.toSeconds(hours);\n+\n+        long minutes = processMinutes(seconds);\n+        seconds -= TimeUnit.MINUTES.toSeconds(minutes);\n+\n+        long lseconds = processSeconds(seconds);\n+\n+        return getTimePeriods(weeks, days, hours, minutes, lseconds);\n+    }\n+\n+    private static long processWeeks(@SqlType(StandardTypes.BIGINT) long seconds)", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjkyOTgyOQ==", "url": "https://github.com/trinodb/trino/pull/4344#discussion_r456929829", "bodyText": "I don't think the processXXX methods are necessary. This could be done more concisely, and IMO, easier to read and follow like this:\nlong seconds = (long) inputSeconds;\n\nlong weeks = TimeUnit.SECONDS.toDays(seconds) / DAYS_IN_WEEK;\nseconds -= TimeUnit.DAYS.toSeconds(weeks * DAYS_IN_WEEK);\n\nlong days = TimeUnit.SECONDS.toDays(seconds);\nseconds -= TimeUnit.DAYS.toSeconds(days);\n\nlong hours = TimeUnit.SECONDS.toHours(seconds);\nseconds -= TimeUnit.HOURS.toSeconds(hours);\n\nlong minutes = TimeUnit.SECONDS.toMinutes(seconds);\nseconds -= TimeUnit.MINUTES.toSeconds(minutes);\n\nreturn getTimePeriods(weeks, days, hours, minutes, seconds);", "author": "martint", "createdAt": "2020-07-19T16:46:29Z", "path": "presto-main/src/main/java/io/prestosql/operator/scalar/timestamp/HumanReadableSeconds.java", "diffHunk": "@@ -0,0 +1,136 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.prestosql.operator.scalar.timestamp;\n+\n+import io.airlift.slice.Slice;\n+import io.prestosql.spi.function.ScalarFunction;\n+import io.prestosql.spi.function.SqlType;\n+import io.prestosql.spi.type.StandardTypes;\n+\n+import java.util.StringJoiner;\n+import java.util.concurrent.TimeUnit;\n+\n+import static io.airlift.slice.Slices.utf8Slice;\n+\n+@ScalarFunction(\"human_readable_seconds\")\n+public final class HumanReadableSeconds\n+{\n+    private static final String HUMAN_REDABLE_FORMAT = \"%s, %s, %s, %s, %s\";\n+    private static final int DAYS_IN_WEEK = 7;\n+    private static final String WEEK = \"week\";\n+    private static final String DAY = \"day\";\n+    private static final String HOUR = \"hour\";\n+    private static final String MINUTE = \"minute\";\n+    private static final String SECOND = \"second\";\n+\n+    private HumanReadableSeconds() {}\n+\n+    @SqlType(StandardTypes.VARCHAR)\n+    public static Slice humanReadable(@SqlType(StandardTypes.DOUBLE) double inputSeconds)\n+    {\n+        long seconds = Double.valueOf(inputSeconds).longValue();\n+\n+        long weeks = processWeeks(seconds);", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjkzMDUxOA==", "url": "https://github.com/trinodb/trino/pull/4344#discussion_r456930518", "bodyText": "It could be further simplified to this if you introduce constants from \"number of seconds in a week\", \"number of seconds in a day\", etc:\nlong seconds = (long) inputSeconds;\n\nlong weeks = TimeUnit.SECONDS.toDays(seconds) / DAYS_IN_WEEK;\nseconds = seconds % SECONDS_PER_WEEK;\n\nlong days = TimeUnit.SECONDS.toDays(seconds);\nseconds = seconds % SECONDS_PER_DAY;\n\nlong hours = TimeUnit.SECONDS.toHours(seconds);\nseconds = seconds % SECONDS_PER_HOUR;\n\nlong minutes = TimeUnit.SECONDS.toMinutes(seconds);\nseconds = seconds % SECONDS_PER_MINUTE;\n\nreturn getTimePeriods(weeks, days, hours, minutes, seconds);", "author": "martint", "createdAt": "2020-07-19T16:53:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjkyOTgyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTEzNzQ5OA==", "url": "https://github.com/trinodb/trino/pull/4344#discussion_r475137498", "bodyText": "Have refactored.", "author": "haldes", "createdAt": "2020-08-22T20:54:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjkyOTgyOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjkzMDczMA==", "url": "https://github.com/trinodb/trino/pull/4344#discussion_r456930730", "bodyText": "Don't abbreviate variable names. Rename val -> value", "author": "martint", "createdAt": "2020-07-19T16:55:39Z", "path": "presto-main/src/main/java/io/prestosql/operator/scalar/timestamp/HumanReadableSeconds.java", "diffHunk": "@@ -0,0 +1,136 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.prestosql.operator.scalar.timestamp;\n+\n+import io.airlift.slice.Slice;\n+import io.prestosql.spi.function.ScalarFunction;\n+import io.prestosql.spi.function.SqlType;\n+import io.prestosql.spi.type.StandardTypes;\n+\n+import java.util.StringJoiner;\n+import java.util.concurrent.TimeUnit;\n+\n+import static io.airlift.slice.Slices.utf8Slice;\n+\n+@ScalarFunction(\"human_readable_seconds\")\n+public final class HumanReadableSeconds\n+{\n+    private static final String HUMAN_REDABLE_FORMAT = \"%s, %s, %s, %s, %s\";\n+    private static final int DAYS_IN_WEEK = 7;\n+    private static final String WEEK = \"week\";\n+    private static final String DAY = \"day\";\n+    private static final String HOUR = \"hour\";\n+    private static final String MINUTE = \"minute\";\n+    private static final String SECOND = \"second\";\n+\n+    private HumanReadableSeconds() {}\n+\n+    @SqlType(StandardTypes.VARCHAR)\n+    public static Slice humanReadable(@SqlType(StandardTypes.DOUBLE) double inputSeconds)\n+    {\n+        long seconds = Double.valueOf(inputSeconds).longValue();\n+\n+        long weeks = processWeeks(seconds);\n+        if (weeks > 0) {\n+            seconds -= TimeUnit.DAYS.toSeconds(weeks * DAYS_IN_WEEK);\n+        }\n+\n+        long days = processDays(seconds);\n+        seconds -= TimeUnit.DAYS.toSeconds(days);\n+\n+        long hours = processHours(seconds);\n+        seconds -= TimeUnit.HOURS.toSeconds(hours);\n+\n+        long minutes = processMinutes(seconds);\n+        seconds -= TimeUnit.MINUTES.toSeconds(minutes);\n+\n+        long lseconds = processSeconds(seconds);\n+\n+        return getTimePeriods(weeks, days, hours, minutes, lseconds);\n+    }\n+\n+    private static long processWeeks(@SqlType(StandardTypes.BIGINT) long seconds)\n+    {\n+        long weeks = 0;\n+        if (seconds > 0) {\n+            weeks = TimeUnit.SECONDS.toDays(seconds) / DAYS_IN_WEEK;\n+        }\n+        return weeks;\n+    }\n+\n+    private static long processDays(@SqlType(StandardTypes.BIGINT) long seconds)\n+    {\n+        long days = 0;\n+        if (seconds > 0) {\n+            days = TimeUnit.SECONDS.toDays(seconds);\n+        }\n+        return days;\n+    }\n+\n+    private static long processHours(@SqlType(StandardTypes.BIGINT) long remainingSeconds)\n+    {\n+        long hours = 0;\n+        if (remainingSeconds > 0) {\n+            hours = TimeUnit.SECONDS.toHours(remainingSeconds);\n+        }\n+        return hours;\n+    }\n+\n+    private static long processMinutes(@SqlType(StandardTypes.BIGINT) long remainingSeconds)\n+    {\n+        long minutes = 0;\n+        if (remainingSeconds > 0) {\n+            minutes = TimeUnit.SECONDS.toMinutes(remainingSeconds);\n+        }\n+        return minutes;\n+    }\n+\n+    private static long processSeconds(@SqlType(StandardTypes.BIGINT) long remainingSeconds)\n+    {\n+        long inputSeconds = 0;\n+        if (remainingSeconds > 0) {\n+            inputSeconds = remainingSeconds;\n+        }\n+        return inputSeconds;\n+    }\n+\n+    private static Slice getTimePeriods(long weeks, long days, long hours, long minutes, long seconds)\n+    {\n+        StringJoiner stringJoiner = new StringJoiner(\", \");\n+        if (weeks > 0) {\n+            stringJoiner.add(getPeriodType(weeks, WEEK));\n+        }\n+        if (days > 0) {\n+            stringJoiner.add(getPeriodType(days, DAY));\n+        }\n+        if (hours > 0) {\n+            stringJoiner.add(getPeriodType(hours, HOUR));\n+        }\n+        if (minutes > 0) {\n+            stringJoiner.add(getPeriodType(minutes, MINUTE));\n+        }\n+        if (seconds > 0) {\n+            stringJoiner.add(getPeriodType(seconds, SECOND));\n+        }\n+        return utf8Slice(stringJoiner.toString());\n+    }\n+\n+    private static String getPeriodType(long val, String type)", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTEzNzU2NQ==", "url": "https://github.com/trinodb/trino/pull/4344#discussion_r475137565", "bodyText": "Have refactored.", "author": "haldes", "createdAt": "2020-08-22T20:55:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjkzMDczMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjkzMDg5MA==", "url": "https://github.com/trinodb/trino/pull/4344#discussion_r456930890", "bodyText": "The name of this method doesn't describe what it does very accurately. I'd rename it to \"render\" or something similar", "author": "martint", "createdAt": "2020-07-19T16:57:26Z", "path": "presto-main/src/main/java/io/prestosql/operator/scalar/timestamp/HumanReadableSeconds.java", "diffHunk": "@@ -0,0 +1,136 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.prestosql.operator.scalar.timestamp;\n+\n+import io.airlift.slice.Slice;\n+import io.prestosql.spi.function.ScalarFunction;\n+import io.prestosql.spi.function.SqlType;\n+import io.prestosql.spi.type.StandardTypes;\n+\n+import java.util.StringJoiner;\n+import java.util.concurrent.TimeUnit;\n+\n+import static io.airlift.slice.Slices.utf8Slice;\n+\n+@ScalarFunction(\"human_readable_seconds\")\n+public final class HumanReadableSeconds\n+{\n+    private static final String HUMAN_REDABLE_FORMAT = \"%s, %s, %s, %s, %s\";\n+    private static final int DAYS_IN_WEEK = 7;\n+    private static final String WEEK = \"week\";\n+    private static final String DAY = \"day\";\n+    private static final String HOUR = \"hour\";\n+    private static final String MINUTE = \"minute\";\n+    private static final String SECOND = \"second\";\n+\n+    private HumanReadableSeconds() {}\n+\n+    @SqlType(StandardTypes.VARCHAR)\n+    public static Slice humanReadable(@SqlType(StandardTypes.DOUBLE) double inputSeconds)\n+    {\n+        long seconds = Double.valueOf(inputSeconds).longValue();\n+\n+        long weeks = processWeeks(seconds);\n+        if (weeks > 0) {\n+            seconds -= TimeUnit.DAYS.toSeconds(weeks * DAYS_IN_WEEK);\n+        }\n+\n+        long days = processDays(seconds);\n+        seconds -= TimeUnit.DAYS.toSeconds(days);\n+\n+        long hours = processHours(seconds);\n+        seconds -= TimeUnit.HOURS.toSeconds(hours);\n+\n+        long minutes = processMinutes(seconds);\n+        seconds -= TimeUnit.MINUTES.toSeconds(minutes);\n+\n+        long lseconds = processSeconds(seconds);\n+\n+        return getTimePeriods(weeks, days, hours, minutes, lseconds);\n+    }\n+\n+    private static long processWeeks(@SqlType(StandardTypes.BIGINT) long seconds)\n+    {\n+        long weeks = 0;\n+        if (seconds > 0) {\n+            weeks = TimeUnit.SECONDS.toDays(seconds) / DAYS_IN_WEEK;\n+        }\n+        return weeks;\n+    }\n+\n+    private static long processDays(@SqlType(StandardTypes.BIGINT) long seconds)\n+    {\n+        long days = 0;\n+        if (seconds > 0) {\n+            days = TimeUnit.SECONDS.toDays(seconds);\n+        }\n+        return days;\n+    }\n+\n+    private static long processHours(@SqlType(StandardTypes.BIGINT) long remainingSeconds)\n+    {\n+        long hours = 0;\n+        if (remainingSeconds > 0) {\n+            hours = TimeUnit.SECONDS.toHours(remainingSeconds);\n+        }\n+        return hours;\n+    }\n+\n+    private static long processMinutes(@SqlType(StandardTypes.BIGINT) long remainingSeconds)\n+    {\n+        long minutes = 0;\n+        if (remainingSeconds > 0) {\n+            minutes = TimeUnit.SECONDS.toMinutes(remainingSeconds);\n+        }\n+        return minutes;\n+    }\n+\n+    private static long processSeconds(@SqlType(StandardTypes.BIGINT) long remainingSeconds)\n+    {\n+        long inputSeconds = 0;\n+        if (remainingSeconds > 0) {\n+            inputSeconds = remainingSeconds;\n+        }\n+        return inputSeconds;\n+    }\n+\n+    private static Slice getTimePeriods(long weeks, long days, long hours, long minutes, long seconds)\n+    {\n+        StringJoiner stringJoiner = new StringJoiner(\", \");\n+        if (weeks > 0) {\n+            stringJoiner.add(getPeriodType(weeks, WEEK));\n+        }\n+        if (days > 0) {\n+            stringJoiner.add(getPeriodType(days, DAY));\n+        }\n+        if (hours > 0) {\n+            stringJoiner.add(getPeriodType(hours, HOUR));\n+        }\n+        if (minutes > 0) {\n+            stringJoiner.add(getPeriodType(minutes, MINUTE));\n+        }\n+        if (seconds > 0) {\n+            stringJoiner.add(getPeriodType(seconds, SECOND));\n+        }\n+        return utf8Slice(stringJoiner.toString());\n+    }\n+\n+    private static String getPeriodType(long val, String type)", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTEzNzU3Ng==", "url": "https://github.com/trinodb/trino/pull/4344#discussion_r475137576", "bodyText": "Have refactored.", "author": "haldes", "createdAt": "2020-08-22T20:55:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjkzMDg5MA=="}], "type": "inlineReview"}, {"oid": "642ec7ebc98d37000dec8ad7650883bf62757154", "url": "https://github.com/trinodb/trino/commit/642ec7ebc98d37000dec8ad7650883bf62757154", "message": "Add human_readable timestamp function", "committedDate": "2020-08-25T10:39:39Z", "type": "commit"}]}