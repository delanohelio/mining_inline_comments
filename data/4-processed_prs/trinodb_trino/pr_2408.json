{"pr_number": 2408, "pr_title": "Use testcontainers for session property managers", "pr_createdAt": "2020-01-05T08:42:03Z", "pr_url": "https://github.com/trinodb/trino/pull/2408", "timeline": [{"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzY2MDQ4OA==", "url": "https://github.com/trinodb/trino/pull/2408#discussion_r363660488", "bodyText": "Having TestingMySqlServer helps to:\n\nwrap using external dependency (in case we would like to switch from testcontainers to something else)\nmanages which version of mysql is used\nit helps to gather common code in single place (like execute(sql) method)", "author": "kokosing", "createdAt": "2020-01-07T09:31:40Z", "path": "presto-session-property-managers/src/test/java/io/prestosql/plugin/session/db/TestDbSessionPropertyManager.java", "diffHunk": "@@ -42,21 +42,20 @@\n     private DbSessionPropertyManager manager;\n     private RefreshingDbSpecsProvider specsProvider;\n \n-    private TestingMySqlServer testingMySqlServer;\n-    private static final String MYSQL_TEST_USER = \"testuser\";\n-    private static final String MYSQL_TEST_PASSWORD = \"testpassword\";\n-    private static final String MYSQL_TEST_DATABASE = \"test_database\";\n+    private MySQLContainer<?> mysqlContainer;\n \n     private static final ResourceGroupId TEST_RG = new ResourceGroupId(\"rg1\");\n \n     @BeforeClass\n     public void setup()\n-            throws Exception\n     {\n-        testingMySqlServer = new TestingMySqlServer(MYSQL_TEST_USER, MYSQL_TEST_PASSWORD, MYSQL_TEST_DATABASE);\n+        mysqlContainer = new MySQLContainer<>(\"mysql:8.0.12\");", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDQxOTg0Mg==", "url": "https://github.com/trinodb/trino/pull/2408#discussion_r364419842", "bodyText": "You convinced me with the \"managed version\" argument", "author": "electrum", "createdAt": "2020-01-08T20:06:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzY2MDQ4OA=="}], "type": "inlineReview"}, {"oid": "c54714e00b78a0fd3bf5108e33c26b37666a3f65", "url": "https://github.com/trinodb/trino/commit/c54714e00b78a0fd3bf5108e33c26b37666a3f65", "message": "Use Dockerized MySQL for session property managers", "committedDate": "2020-01-08T20:05:55Z", "type": "commit"}, {"oid": "c54714e00b78a0fd3bf5108e33c26b37666a3f65", "url": "https://github.com/trinodb/trino/commit/c54714e00b78a0fd3bf5108e33c26b37666a3f65", "message": "Use Dockerized MySQL for session property managers", "committedDate": "2020-01-08T20:05:55Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDQ2NTUzNA==", "url": "https://github.com/trinodb/trino/pull/2408#discussion_r364465534", "bodyText": "could you use constructUrlForConnection?", "author": "findepi", "createdAt": "2020-01-08T22:03:10Z", "path": "presto-session-property-managers/src/test/java/io/prestosql/plugin/session/db/TestingMySqlContainer.java", "diffHunk": "@@ -0,0 +1,31 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.prestosql.plugin.session.db;\n+\n+import org.testcontainers.containers.MySQLContainer;\n+\n+public class TestingMySqlContainer\n+        extends MySQLContainer<TestingMySqlContainer>\n+{\n+    public TestingMySqlContainer()\n+    {\n+        super(\"mysql:8.0.12\");\n+    }\n+\n+    @Override\n+    public String getJdbcUrl()\n+    {\n+        return super.getJdbcUrl() + \"?useSSL=false&allowPublicKeyRetrieval=true\";", "originalCommit": "c54714e00b78a0fd3bf5108e33c26b37666a3f65", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDU0NzkzNQ==", "url": "https://github.com/trinodb/trino/pull/2408#discussion_r364547935", "bodyText": "Good point, this is possible now since it\u2019s a subclass.", "author": "electrum", "createdAt": "2020-01-09T03:43:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDQ2NTUzNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDQ2NTYzNQ==", "url": "https://github.com/trinodb/trino/pull/2408#discussion_r364465635", "bodyText": "was this meant to be extemded?", "author": "findepi", "createdAt": "2020-01-08T22:03:18Z", "path": "presto-session-property-managers/src/test/java/io/prestosql/plugin/session/db/TestingMySqlContainer.java", "diffHunk": "@@ -0,0 +1,31 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.prestosql.plugin.session.db;\n+\n+import org.testcontainers.containers.MySQLContainer;\n+\n+public class TestingMySqlContainer\n+        extends MySQLContainer<TestingMySqlContainer>", "originalCommit": "c54714e00b78a0fd3bf5108e33c26b37666a3f65", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDU0NzQ2MA==", "url": "https://github.com/trinodb/trino/pull/2408#discussion_r364547460", "bodyText": "Yes, it seems simpler this way.", "author": "electrum", "createdAt": "2020-01-09T03:41:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDQ2NTYzNQ=="}], "type": "inlineReview"}]}