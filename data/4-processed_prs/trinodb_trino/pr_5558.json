{"pr_number": 5558, "pr_title": "Catch all runtime errors from UI password authenticator", "pr_createdAt": "2020-10-14T22:48:42Z", "pr_url": "https://github.com/trinodb/trino/pull/5558", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTA0MjMwMg==", "url": "https://github.com/trinodb/trino/pull/5558#discussion_r505042302", "bodyText": "would it help to add username in the error message for ease of debugging?", "author": "phd3", "createdAt": "2020-10-14T22:54:02Z", "path": "presto-main/src/main/java/io/prestosql/server/ui/PasswordManagerFormAuthenticator.java", "diffHunk": "@@ -70,5 +72,9 @@ public boolean isValidCredential(String username, String password, boolean secur\n         catch (AccessDeniedException e) {\n             return false;\n         }\n+        catch (RuntimeException e) {\n+            log.warn(e, \"Error authenticating user for Web UI\");", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTI2MjUzMg==", "url": "https://github.com/trinodb/trino/pull/5558#discussion_r505262532", "bodyText": "If it is the way certain password authenticator works, then logging this on warn could easily pollute all server logs.\nI would prefer to log on debug by default, then we could easily add more info there like @phd3 suggested.\nBTW: do we need debug logging for above AccessDeniedException", "author": "kokosing", "createdAt": "2020-10-15T07:27:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTA0MjMwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjk3NDI1MA==", "url": "https://github.com/trinodb/trino/pull/5558#discussion_r506974250", "bodyText": "The assumption we have always used for Presto is you either log or throw.  So if we are catching an exception, we can assume it has not already been logged.", "author": "dain", "createdAt": "2020-10-17T19:09:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTA0MjMwMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzYyNzE2MA==", "url": "https://github.com/trinodb/trino/pull/5558#discussion_r507627160", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        log.warn(e, \"Error authenticating user for Web UI\");\n          \n          \n            \n                        log.debug(e, \"Error authenticating user for Web UI\");", "author": "kokosing", "createdAt": "2020-10-19T10:06:57Z", "path": "presto-main/src/main/java/io/prestosql/server/ui/PasswordManagerFormAuthenticator.java", "diffHunk": "@@ -70,5 +72,9 @@ public boolean isValidCredential(String username, String password, boolean secur\n         catch (AccessDeniedException e) {\n             return false;\n         }\n+        catch (RuntimeException e) {\n+            log.warn(e, \"Error authenticating user for Web UI\");", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "dc353c9616bc91c59d391c31d11db05baf181fb7", "url": "https://github.com/trinodb/trino/commit/dc353c9616bc91c59d391c31d11db05baf181fb7", "message": "Catch all runtime errors from UI password authenticator\n\nSome password authenticators throw runtime exceptions to signal login did not\nwork. Instead of showing 500 to the end user, the failure is logged and the\nlogin is denied.", "committedDate": "2020-10-21T16:05:12Z", "type": "commit"}, {"oid": "dc353c9616bc91c59d391c31d11db05baf181fb7", "url": "https://github.com/trinodb/trino/commit/dc353c9616bc91c59d391c31d11db05baf181fb7", "message": "Catch all runtime errors from UI password authenticator\n\nSome password authenticators throw runtime exceptions to signal login did not\nwork. Instead of showing 500 to the end user, the failure is logged and the\nlogin is denied.", "committedDate": "2020-10-21T16:05:12Z", "type": "forcePushed"}]}