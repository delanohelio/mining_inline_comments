{"pr_number": 3470, "pr_title": "Fire PushPredicateIntoTableScan rule with change in TableHandle", "pr_createdAt": "2020-04-18T00:00:21Z", "pr_url": "https://github.com/trinodb/trino/pull/3470", "timeline": [{"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTgyOTUyNQ==", "url": "https://github.com/trinodb/trino/pull/3470#discussion_r411829525", "bodyText": "This should compare the table handles directly. This layer of the code (i.e., the optimizer) shouldn't be concerned about ConnectorTableHandle.", "author": "martint", "createdAt": "2020-04-21T02:50:46Z", "path": "presto-main/src/main/java/io/prestosql/sql/planner/iterative/rule/PushPredicateIntoTableScan.java", "diffHunk": "@@ -131,7 +131,8 @@ private boolean arePlansSame(FilterNode filter, TableScanNode tableScan, PlanNod\n \n         TableScanNode rewrittenTableScan = (TableScanNode) rewrittenFilter.getSource();\n \n-        return Objects.equals(tableScan.getEnforcedConstraint(), rewrittenTableScan.getEnforcedConstraint());\n+        return Objects.equals(tableScan.getEnforcedConstraint(), rewrittenTableScan.getEnforcedConstraint()) &&\n+                Objects.equals(tableScan.getTable().getConnectorHandle(), rewrittenTableScan.getTable().getConnectorHandle());", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": "1f3755ae8a136b165cb2b7b900489802b09b985f", "url": "https://github.com/trinodb/trino/commit/1f3755ae8a136b165cb2b7b900489802b09b985f", "message": "Fix table handle comparison\n\nCompare table handles representing the same logical dataset as equal", "committedDate": "2020-04-22T22:04:32Z", "type": "commit"}, {"oid": "23f8fbe482bc982ce7aa8619a4be4c208fadbb6d", "url": "https://github.com/trinodb/trino/commit/23f8fbe482bc982ce7aa8619a4be4c208fadbb6d", "message": "Remove unused RaptorTableLayoutHandle", "committedDate": "2020-04-22T22:04:32Z", "type": "commit"}, {"oid": "35de34e811af45e663b3b03f26f1fca94beaf8fd", "url": "https://github.com/trinodb/trino/commit/35de34e811af45e663b3b03f26f1fca94beaf8fd", "message": "Compare table handles while matching plans in PushPredicateIntoTableScan", "committedDate": "2020-04-22T22:04:32Z", "type": "commit"}, {"oid": "cd8a4744216d2009c126058ccae8ca3731d538bc", "url": "https://github.com/trinodb/trino/commit/cd8a4744216d2009c126058ccae8ca3731d538bc", "message": "Add a test for predicate pushdown in hive connector", "committedDate": "2020-04-22T22:04:32Z", "type": "commit"}, {"oid": "df816743e0eb399c4ce1962174aae7633868fb59", "url": "https://github.com/trinodb/trino/commit/df816743e0eb399c4ce1962174aae7633868fb59", "message": "Fix bug in PhoenixTableLayoutHandle::equals", "committedDate": "2020-04-22T22:04:32Z", "type": "commit"}, {"oid": "df816743e0eb399c4ce1962174aae7633868fb59", "url": "https://github.com/trinodb/trino/commit/df816743e0eb399c4ce1962174aae7633868fb59", "message": "Fix bug in PhoenixTableLayoutHandle::equals", "committedDate": "2020-04-22T22:04:32Z", "type": "forcePushed"}]}