{"pr_number": 3587, "pr_title": "Fix failure when unnest inputs are repeated", "pr_createdAt": "2020-04-29T19:22:35Z", "pr_url": "https://github.com/trinodb/trino/pull/3587", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODI4NTg1Mw==", "url": "https://github.com/trinodb/trino/pull/3587#discussion_r418285853", "bodyText": "require non null", "author": "kasiafi", "createdAt": "2020-04-30T20:59:53Z", "path": "presto-main/src/main/java/io/prestosql/sql/planner/plan/UnnestNode.java", "diffHunk": "@@ -129,6 +129,33 @@ public Type getJoinType()\n     @Override\n     public PlanNode replaceChildren(List<PlanNode> newChildren)\n     {\n-        return new UnnestNode(getId(), Iterables.getOnlyElement(newChildren), replicateSymbols, unnestSymbols, ordinalitySymbol, joinType, filter);\n+        return new UnnestNode(getId(), Iterables.getOnlyElement(newChildren), replicateSymbols, mappings, ordinalitySymbol, joinType, filter);\n+    }\n+\n+    public static class Mapping\n+    {\n+        private final Symbol input;\n+        private final List<Symbol> outputs;\n+\n+        @JsonCreator\n+        public Mapping(\n+                @JsonProperty(\"input\") Symbol input,\n+                @JsonProperty(\"outputs\") List<Symbol> outputs)\n+        {\n+            this.input = requireNonNull(input, \"input is null\");\n+            this.outputs = ImmutableList.copyOf(outputs);", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "56dc6bb42950b4528d9157573afee869c81cc810", "url": "https://github.com/trinodb/trino/commit/56dc6bb42950b4528d9157573afee869c81cc810", "message": "Fix failure when unnest inputs are repeated\n\nThe mappings to unnest are keyed based on input symbol.\nWhen input expression are repeated, the deduplication logic\nreplaces them with references to the same symbol. This\ncauses a conflict that results in a planning failure.", "committedDate": "2020-05-06T18:09:24Z", "type": "commit"}, {"oid": "56dc6bb42950b4528d9157573afee869c81cc810", "url": "https://github.com/trinodb/trino/commit/56dc6bb42950b4528d9157573afee869c81cc810", "message": "Fix failure when unnest inputs are repeated\n\nThe mappings to unnest are keyed based on input symbol.\nWhen input expression are repeated, the deduplication logic\nreplaces them with references to the same symbol. This\ncauses a conflict that results in a planning failure.", "committedDate": "2020-05-06T18:09:24Z", "type": "forcePushed"}]}