{"pr_number": 2412, "pr_title": "Do not allocate resources within test constructor", "pr_createdAt": "2020-01-05T20:41:39Z", "pr_url": "https://github.com/trinodb/trino/pull/2412", "timeline": [{"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTU4MjQyMA==", "url": "https://github.com/trinodb/trino/pull/2412#discussion_r365582420", "bodyText": "I guess you considered putting this method to createQueryRunner like TestGoogleSheets. Do you think splitting like this is better than defining with the method? I'm asking this question for the consistency.", "author": "ebyhr", "createdAt": "2020-01-12T13:14:37Z", "path": "presto-tests/src/test/java/io/prestosql/tests/TestDictionaryAggregation.java", "diffHunk": "@@ -26,18 +28,19 @@\n public class TestDictionaryAggregation\n         extends AbstractTestQueryFramework\n {\n-    public TestDictionaryAggregation()\n+    @Override\n+    protected QueryRunner createQueryRunner()\n     {\n-        super(() -> {\n-            LocalQueryRunner queryRunner = LocalQueryRunner.create(testSessionBuilder()\n-                    .setSystemProperty(DICTIONARY_AGGREGATION, \"true\")\n-                    .setSystemProperty(REORDER_JOINS, \"false\") // no JOIN reordering\n-                    .build());\n-\n-            queryRunner.createCatalog(\"tpch\", new TpchConnectorFactory(1), ImmutableMap.of());\n+        return LocalQueryRunner.create(testSessionBuilder()\n+                .setSystemProperty(DICTIONARY_AGGREGATION, \"true\")\n+                .setSystemProperty(REORDER_JOINS, \"false\") // no JOIN reordering\n+                .build());\n+    }\n \n-            return queryRunner;\n-        });\n+    @BeforeClass\n+    public void setUp()\n+    {\n+        ((LocalQueryRunner) getQueryRunner()).createCatalog(\"tpch\", new TpchConnectorFactory(1), ImmutableMap.of());", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE2MTkxOQ==", "url": "https://github.com/trinodb/trino/pull/2412#discussion_r368161919", "bodyText": "Done", "author": "findepi", "createdAt": "2020-01-17T22:26:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTU4MjQyMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTU4MjczMA==", "url": "https://github.com/trinodb/trino/pull/2412#discussion_r365582730", "bodyText": "nit: This static import should be separated commit or written in commit description. How about creating a commit to import createXXXQueryRunner method as static including other classes?", "author": "ebyhr", "createdAt": "2020-01-12T13:19:15Z", "path": "presto-accumulo/src/test/java/io/prestosql/plugin/accumulo/TestAccumuloIntegrationSmokeTest.java", "diffHunk": "@@ -16,15 +16,19 @@\n import com.google.common.collect.ImmutableMap;\n import io.prestosql.testing.AbstractTestIntegrationSmokeTest;\n import io.prestosql.testing.MaterializedResult;\n+import io.prestosql.testing.QueryRunner;\n \n+import static io.prestosql.plugin.accumulo.AccumuloQueryRunner.createAccumuloQueryRunner;", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE2MTk5MA==", "url": "https://github.com/trinodb/trino/pull/2412#discussion_r368161990", "bodyText": "i was changing this piece of code anyway, hence imported.", "author": "findepi", "createdAt": "2020-01-17T22:26:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTU4MjczMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTU4Mjc0NA==", "url": "https://github.com/trinodb/trino/pull/2412#discussion_r365582744", "bodyText": "nit: same as the above", "author": "ebyhr", "createdAt": "2020-01-12T13:19:41Z", "path": "presto-kudu/src/test/java/io/prestosql/plugin/kudu/TestKuduIntegrationSmoke.java", "diffHunk": "@@ -17,22 +17,26 @@\n import io.prestosql.testing.AbstractTestIntegrationSmokeTest;\n import io.prestosql.testing.MaterializedResult;\n import io.prestosql.testing.MaterializedRow;\n+import io.prestosql.testing.QueryRunner;\n import org.testng.annotations.AfterClass;\n import org.testng.annotations.Test;\n \n import java.util.regex.Pattern;\n \n import static io.airlift.tpch.TpchTable.ORDERS;\n+import static io.prestosql.plugin.kudu.KuduQueryRunnerFactory.createKuduQueryRunnerTpch;", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "c7e68c9540f97f42292f674d3b47a45eb30e801c", "url": "https://github.com/trinodb/trino/commit/c7e68c9540f97f42292f674d3b47a45eb30e801c", "message": "Do not allocate resources within test constructor", "committedDate": "2020-01-17T22:26:59Z", "type": "commit"}, {"oid": "be2ae7af4fce735a44db5d991d5624fd8fbc58f8", "url": "https://github.com/trinodb/trino/commit/be2ae7af4fce735a44db5d991d5624fd8fbc58f8", "message": "Do not allocate resources in AbstractTestQueries' constructors", "committedDate": "2020-01-17T22:26:59Z", "type": "commit"}, {"oid": "242d633b2915532e6e8fa6356dbf83ce3e141d9c", "url": "https://github.com/trinodb/trino/commit/242d633b2915532e6e8fa6356dbf83ce3e141d9c", "message": "Do not allocate resources in AbstractTestIntegrationSmokeTest's constructors", "committedDate": "2020-01-17T22:26:59Z", "type": "commit"}, {"oid": "c3b2a0ac8eb8873636d90b9c0e5c1bc389489abf", "url": "https://github.com/trinodb/trino/commit/c3b2a0ac8eb8873636d90b9c0e5c1bc389489abf", "message": "Inline variable", "committedDate": "2020-01-17T22:26:59Z", "type": "commit"}, {"oid": "2f68007d9e8eb2b87d773d9a9e485bd46a55ad9b", "url": "https://github.com/trinodb/trino/commit/2f68007d9e8eb2b87d773d9a9e485bd46a55ad9b", "message": "Remove obsolete queryRunnerSupplier field", "committedDate": "2020-01-17T22:26:59Z", "type": "commit"}, {"oid": "2f68007d9e8eb2b87d773d9a9e485bd46a55ad9b", "url": "https://github.com/trinodb/trino/commit/2f68007d9e8eb2b87d773d9a9e485bd46a55ad9b", "message": "Remove obsolete queryRunnerSupplier field", "committedDate": "2020-01-17T22:26:59Z", "type": "forcePushed"}]}