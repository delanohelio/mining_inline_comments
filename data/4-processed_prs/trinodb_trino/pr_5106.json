{"pr_number": 5106, "pr_title": "Fix Iceberg temporal transforms", "pr_createdAt": "2020-09-08T21:08:42Z", "pr_url": "https://github.com/trinodb/trino/pull/5106", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTIxMTM5NQ==", "url": "https://github.com/trinodb/trino/pull/5106#discussion_r485211395", "bodyText": "epochYear?", "author": "martint", "createdAt": "2020-09-08T21:40:15Z", "path": "presto-iceberg/src/main/java/io/prestosql/plugin/iceberg/PartitionTransforms.java", "diffHunk": "@@ -492,6 +492,30 @@ private static Block truncateVarbinary(Block block, int max)\n         return builder.build();\n     }\n \n+    @VisibleForTesting\n+    static long yearsEpoch(long millis)", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTIxMjYzNQ==", "url": "https://github.com/trinodb/trino/pull/5106#discussion_r485212635", "bodyText": "Also, I'd rename the argument to epochMilli for clarity.", "author": "martint", "createdAt": "2020-09-08T21:43:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTIxMTM5NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTIxMTUwMA==", "url": "https://github.com/trinodb/trino/pull/5106#discussion_r485211500", "bodyText": "epochMonth?", "author": "martint", "createdAt": "2020-09-08T21:40:28Z", "path": "presto-iceberg/src/main/java/io/prestosql/plugin/iceberg/PartitionTransforms.java", "diffHunk": "@@ -492,6 +492,30 @@ private static Block truncateVarbinary(Block block, int max)\n         return builder.build();\n     }\n \n+    @VisibleForTesting\n+    static long yearsEpoch(long millis)\n+    {\n+        return YEAR_FIELD.get(millis) - 1970;\n+    }\n+\n+    @VisibleForTesting\n+    static long monthsEpoch(long millis)", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTIxMjM0NQ==", "url": "https://github.com/trinodb/trino/pull/5106#discussion_r485212345", "bodyText": "epochDay?", "author": "martint", "createdAt": "2020-09-08T21:42:24Z", "path": "presto-iceberg/src/main/java/io/prestosql/plugin/iceberg/PartitionTransforms.java", "diffHunk": "@@ -492,6 +492,30 @@ private static Block truncateVarbinary(Block block, int max)\n         return builder.build();\n     }\n \n+    @VisibleForTesting\n+    static long yearsEpoch(long millis)\n+    {\n+        return YEAR_FIELD.get(millis) - 1970;\n+    }\n+\n+    @VisibleForTesting\n+    static long monthsEpoch(long millis)\n+    {\n+        long year = yearsEpoch(millis);\n+        int month = MONTH_FIELD.get(millis) - 1;\n+        return (year * 12) + month;\n+    }\n+\n+    private static long daysEpoch(long millis)", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTIxMjQwMA==", "url": "https://github.com/trinodb/trino/pull/5106#discussion_r485212400", "bodyText": "epochHour?", "author": "martint", "createdAt": "2020-09-08T21:42:31Z", "path": "presto-iceberg/src/main/java/io/prestosql/plugin/iceberg/PartitionTransforms.java", "diffHunk": "@@ -492,6 +492,30 @@ private static Block truncateVarbinary(Block block, int max)\n         return builder.build();\n     }\n \n+    @VisibleForTesting\n+    static long yearsEpoch(long millis)\n+    {\n+        return YEAR_FIELD.get(millis) - 1970;\n+    }\n+\n+    @VisibleForTesting\n+    static long monthsEpoch(long millis)\n+    {\n+        long year = yearsEpoch(millis);\n+        int month = MONTH_FIELD.get(millis) - 1;\n+        return (year * 12) + month;\n+    }\n+\n+    private static long daysEpoch(long millis)\n+    {\n+        return floorDiv(millis, MILLISECONDS_PER_DAY);\n+    }\n+\n+    private static long hoursEpoch(long millis)", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "cf9ea5d5d6d94dd37c10a88c63574393189131ba", "url": "https://github.com/trinodb/trino/commit/cf9ea5d5d6d94dd37c10a88c63574393189131ba", "message": "Add additional millseconds constants", "committedDate": "2020-09-08T23:44:27Z", "type": "commit"}, {"oid": "1ec1e656c1af646ac57ac9027383285ea35cc005", "url": "https://github.com/trinodb/trino/commit/1ec1e656c1af646ac57ac9027383285ea35cc005", "message": "Remove leftover debug logging", "committedDate": "2020-09-08T23:44:27Z", "type": "commit"}, {"oid": "c07f0b34ed727c90bb46da28f9a9786629455082", "url": "https://github.com/trinodb/trino/commit/c07f0b34ed727c90bb46da28f9a9786629455082", "message": "Fix Iceberg temporal transforms", "committedDate": "2020-09-08T23:44:28Z", "type": "commit"}, {"oid": "c07f0b34ed727c90bb46da28f9a9786629455082", "url": "https://github.com/trinodb/trino/commit/c07f0b34ed727c90bb46da28f9a9786629455082", "message": "Fix Iceberg temporal transforms", "committedDate": "2020-09-08T23:44:28Z", "type": "forcePushed"}]}