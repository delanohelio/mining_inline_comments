{"pr_number": 6169, "pr_title": "Close terminal on JVM shutdown", "pr_createdAt": "2020-12-01T17:21:05Z", "pr_url": "https://github.com/trinodb/trino/pull/6169", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzc1MDIwOA==", "url": "https://github.com/trinodb/trino/pull/6169#discussion_r533750208", "bodyText": "This can use checkState()", "author": "electrum", "createdAt": "2020-12-01T22:01:41Z", "path": "presto-cli/src/main/java/io/prestosql/cli/TerminalUtils.java", "diffHunk": "@@ -19,15 +19,21 @@\n import java.io.IOException;\n import java.io.UncheckedIOException;\n import java.nio.charset.Charset;\n+import java.util.concurrent.atomic.AtomicBoolean;\n \n public class TerminalUtils\n {\n     private static final Terminal TERMINAL_INSTANCE = createTerminal();\n+    private static final AtomicBoolean isClosed = new AtomicBoolean(false);\n \n     private TerminalUtils() {}\n \n     public static Terminal getTerminal()\n     {\n+        if (isClosed.get()) {", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzc1MTEwMQ==", "url": "https://github.com/trinodb/trino/pull/6169#discussion_r533751101", "bodyText": "Nice, I forgot we already had a shutdown hook.\nNit: static import", "author": "electrum", "createdAt": "2020-12-01T22:03:26Z", "path": "presto-cli/src/main/java/io/prestosql/cli/Console.java", "diffHunk": "@@ -153,6 +153,7 @@ public boolean run()\n             exiting.set(true);\n             interruptor.interrupt();\n             awaitUninterruptibly(exited, EXIT_DELAY.toMillis(), MILLISECONDS);\n+            TerminalUtils.closeTerminal();", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDUwODYwMQ==", "url": "https://github.com/trinodb/trino/pull/6169#discussion_r534508601", "bodyText": "Please add code comment why this is needed.", "author": "findepi", "createdAt": "2020-12-02T21:57:17Z", "path": "presto-cli/src/main/java/io/prestosql/cli/Console.java", "diffHunk": "@@ -153,6 +154,7 @@ public boolean run()\n             exiting.set(true);\n             interruptor.interrupt();\n             awaitUninterruptibly(exited, EXIT_DELAY.toMillis(), MILLISECONDS);\n+            closeTerminal();", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTEzNTM0Nw==", "url": "https://github.com/trinodb/trino/pull/6169#discussion_r535135347", "bodyText": "AC @findepi", "author": "wendigo", "createdAt": "2020-12-03T11:30:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDUwODYwMQ=="}], "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzg1Mjg0Nw==", "url": "https://github.com/trinodb/trino/pull/6169#discussion_r537852847", "bodyText": "The is prefix is normally only used for boolean getter methods, like the get prefix for regular getters.\nIt seems better to call this closed, since that's the typical name for this type of field.", "author": "electrum", "createdAt": "2020-12-07T21:40:19Z", "path": "presto-cli/src/main/java/io/prestosql/cli/TerminalUtils.java", "diffHunk": "@@ -19,15 +19,20 @@\n import java.io.IOException;\n import java.io.UncheckedIOException;\n import java.nio.charset.Charset;\n+import java.util.concurrent.atomic.AtomicBoolean;\n+\n+import static com.google.common.base.Preconditions.checkState;\n \n public class TerminalUtils\n {\n     private static final Terminal TERMINAL_INSTANCE = createTerminal();\n+    private static final AtomicBoolean isOpened = new AtomicBoolean(true);", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "c94f8da93b38c0487f473011a6832418bae01d1e", "url": "https://github.com/trinodb/trino/commit/c94f8da93b38c0487f473011a6832418bae01d1e", "message": "Close terminal on JVM shutdown", "committedDate": "2020-12-08T09:23:30Z", "type": "commit"}, {"oid": "c94f8da93b38c0487f473011a6832418bae01d1e", "url": "https://github.com/trinodb/trino/commit/c94f8da93b38c0487f473011a6832418bae01d1e", "message": "Close terminal on JVM shutdown", "committedDate": "2020-12-08T09:23:30Z", "type": "forcePushed"}]}