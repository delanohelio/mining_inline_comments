{"pr_number": 5184, "pr_title": "Remove flaky assertions in DF test", "pr_createdAt": "2020-09-16T09:20:53Z", "pr_url": "https://github.com/trinodb/trino/pull/5184", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTMyMTI3NA==", "url": "https://github.com/trinodb/trino/pull/5184#discussion_r489321274", "bodyText": "Instead of commenting can we remove those lines ? We can add a TODO to point to the commit which has these changes ?", "author": "Praveen2112", "createdAt": "2020-09-16T10:07:33Z", "path": "presto-hive/src/test/java/io/prestosql/plugin/hive/TestHiveDynamicPartitionPruning.java", "diffHunk": "@@ -152,11 +153,12 @@ public void testJoinWithNonSelectiveBuildSide()\n                 \"SELECT * FROM partitioned_lineitem JOIN supplier ON partitioned_lineitem.suppkey = supplier.suppkey\");\n         assertEquals(result.getResult().getRowCount(), LINEITEM_COUNT);\n \n+        /* Commented due to https://github.com/prestosql/presto/issues/5120", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTM0NzY1OA==", "url": "https://github.com/trinodb/trino/pull/5184#discussion_r489347658", "bodyText": "done", "author": "raunaqmorarka", "createdAt": "2020-09-16T10:55:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTMyMTI3NA=="}], "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTMzODU3NA==", "url": "https://github.com/trinodb/trino/pull/5184#discussion_r489338574", "bodyText": "You can remove assertEventually(new Duration(5, SECONDS), operatorStatsSupplier::get); altogether", "author": "sopel39", "createdAt": "2020-09-16T10:38:33Z", "path": "presto-testing/src/main/java/io/prestosql/testing/AbstractTestQueryFramework.java", "diffHunk": "@@ -461,7 +461,7 @@ protected OperatorStats searchScanFilterAndProjectOperatorStats(QueryId queryId,\n                 .stream()\n                 .filter(summary -> nodeId.equals(summary.getPlanNodeId()) && summary.getOperatorType().equals(\"ScanFilterAndProjectOperator\"))\n                 .collect(MoreCollectors.onlyElement());\n-        assertEventually(new Duration(5, SECONDS), operatorStatsSupplier::get);\n+        assertEventually(new Duration(5, SECONDS), () -> assertThat(operatorStatsSupplier.get()).isNotNull());", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTM0NzU3MQ==", "url": "https://github.com/trinodb/trino/pull/5184#discussion_r489347571", "bodyText": "done", "author": "raunaqmorarka", "createdAt": "2020-09-16T10:55:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTMzODU3NA=="}], "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQxODcwOA==", "url": "https://github.com/trinodb/trino/pull/5184#discussion_r489418708", "bodyText": "please remove this commit", "author": "sopel39", "createdAt": "2020-09-16T13:02:27Z", "path": "presto-hive/src/test/java/io/prestosql/plugin/hive/TestHiveDynamicPartitionPruning.java", "diffHunk": "@@ -34,7 +34,6 @@\n import static com.google.common.collect.Iterables.getOnlyElement;", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "5a9fe02cf019006805c60cf76cf9b5de2c313a45", "url": "https://github.com/trinodb/trino/commit/5a9fe02cf019006805c60cf76cf9b5de2c313a45", "message": "Remove OperatorStats related flaky assertions", "committedDate": "2020-09-16T13:16:19Z", "type": "commit"}, {"oid": "5a9fe02cf019006805c60cf76cf9b5de2c313a45", "url": "https://github.com/trinodb/trino/commit/5a9fe02cf019006805c60cf76cf9b5de2c313a45", "message": "Remove OperatorStats related flaky assertions", "committedDate": "2020-09-16T13:16:19Z", "type": "forcePushed"}, {"id": "PRRC_kwDOCezRTs4rqcxx", "url": "https://github.com/trinodb/trino/pull/5184#discussion_r732548209", "bodyText": "@raunaqmorarka would you like to re-enable this?\n(or at least re-link to #5172?)\n#5120 is closed. #5172 isn't solved, but we have developed ways to deal with that in tests", "author": "findepi", "createdAt": "2021-10-20T08:45:49Z", "path": "presto-hive/src/test/java/io/prestosql/plugin/hive/TestHiveDynamicPartitionPruning.java", "diffHunk": "@@ -99,9 +97,8 @@ public void testJoinWithEmptyBuildSide()\n                 \"SELECT * FROM partitioned_lineitem JOIN supplier ON partitioned_lineitem.suppkey = supplier.suppkey AND supplier.name = 'abc'\");\n         assertEquals(result.getResult().getRowCount(), 0);\n \n-        OperatorStats probeStats = searchScanFilterAndProjectOperatorStats(result.getQueryId(), \"tpch:\" + PARTITIONED_LINEITEM);\n-        assertEquals(probeStats.getInputPositions(), 0L);\n-        assertEquals(probeStats.getDynamicFilterSplitsProcessed(), 0L);\n+        // TODO bring back OperatorStats assertions from https://github.com/prestosql/presto/commit/1feaa0f928a02f577c8ac9ef6cc0c8ec2008a46d\n+        // after https://github.com/prestosql/presto/issues/5120 is fixed", "originalCommit": "5a9fe02cf019006805c60cf76cf9b5de2c313a45", "replyToReviewId": null, "replies": [{"id": "PRRC_kwDOCezRTs4rqhdw", "url": "https://github.com/trinodb/trino/pull/5184#discussion_r732567408", "bodyText": "I am indeed planning on bringing this back using the assertQueryStats thing we added recently. But I wanted to wait for the in-progress iceberg DF PR to merge which has changes in these files.", "author": "raunaqmorarka", "createdAt": "2021-10-20T09:08:40Z", "replyToReviewId": "PRRC_kwDOCezRTs4rqcxx"}], "type": "inlineReview"}]}