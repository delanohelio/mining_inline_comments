{"pr_number": 5460, "pr_title": "Add column security, column mask, and row filter to file-based access controls", "pr_createdAt": "2020-10-07T23:54:40Z", "pr_url": "https://github.com/trinodb/trino/pull/5460", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUxOTgyNw==", "url": "https://github.com/trinodb/trino/pull/5460#discussion_r501519827", "bodyText": "it would be nice to sort some parameters like: catalog, schema, table, columns.", "author": "kokosing", "createdAt": "2020-10-08T07:57:07Z", "path": "presto-plugin-toolkit/src/main/java/io/prestosql/plugin/base/security/CatalogTableAccessControlRule.java", "diffHunk": "@@ -34,13 +35,14 @@\n     @JsonCreator\n     public CatalogTableAccessControlRule(\n             @JsonProperty(\"privileges\") Set<TablePrivilege> privileges,\n+            @JsonProperty(\"columns\") Optional<List<ColumnConstraint>> columns,", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTg2MjA1OQ==", "url": "https://github.com/trinodb/trino/pull/5460#discussion_r501862059", "bodyText": "They are sorted.  The first few parameters are the \"data\" and the last parameters are the \"rules\".  This is the existing pattern in the code.  I personally would have put rules then data, but \ud83e\udd37", "author": "dain", "createdAt": "2020-10-08T16:41:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUxOTgyNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUyMjk3OQ==", "url": "https://github.com/trinodb/trino/pull/5460#discussion_r501522979", "bodyText": "Maybe you could use some predefined rule instead of using null. The if below would be easier. ?", "author": "kokosing", "createdAt": "2020-10-08T08:02:23Z", "path": "presto-plugin-toolkit/src/main/java/io/prestosql/plugin/base/security/FileBasedAccessControl.java", "diffHunk": "@@ -211,10 +212,28 @@ public void checkCanShowColumns(ConnectorSecurityContext context, SchemaTableNam\n     @Override\n     public List<ColumnMetadata> filterColumns(ConnectorSecurityContext context, SchemaTableName tableName, List<ColumnMetadata> columns)\n     {\n-        if (!checkAnyTablePermission(context, tableName)) {\n+        if (INFORMATION_SCHEMA_NAME.equals(tableName.getSchemaName())) {\n+            return columns;\n+        }\n+\n+        ConnectorIdentity identity = context.getIdentity();\n+        TableAccessControlRule rule = tableRules.stream()\n+                .filter(tableRule -> tableRule.matches(identity.getUser(), identity.getGroups(), tableName))\n+                .findFirst()\n+                .orElse(null);", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDMzMjczMA==", "url": "https://github.com/trinodb/trino/pull/5460#discussion_r504332730", "bodyText": "I looked at adding a DENY_ALL rule we could use here, but I didn't like how the rule worked out, so I'm going to leave this.", "author": "dain", "createdAt": "2020-10-14T00:30:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUyMjk3OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUyMzk5NQ==", "url": "https://github.com/trinodb/trino/pull/5460#discussion_r501523995", "bodyText": "Can this be used for UPDATE or INSERT? What would be the semantic of that?", "author": "kokosing", "createdAt": "2020-10-08T08:04:14Z", "path": "presto-docs/src/main/sphinx/connector/hive-security.rst", "diffHunk": "@@ -560,7 +570,13 @@ See below for an example.\n         {\n           \"schema\": \"default\",\n           \"table\": \".*\",\n-          \"privileges\": [\"SELECT\"]\n+          \"privileges\": [\"SELECT\"],\n+          \"columns\" : [", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTg3NDAxNg==", "url": "https://github.com/trinodb/trino/pull/5460#discussion_r501874016", "bodyText": "If we add that, then we would alter the allow field to a set of permissions or add a new field.", "author": "dain", "createdAt": "2020-10-08T17:01:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUyMzk5NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUyNDY3Mw==", "url": "https://github.com/trinodb/trino/pull/5460#discussion_r501524673", "bodyText": "Why?", "author": "kokosing", "createdAt": "2020-10-08T08:05:15Z", "path": "presto-plugin-toolkit/src/main/java/io/prestosql/plugin/base/security/FileBasedAccessControl.java", "diffHunk": "@@ -211,10 +212,28 @@ public void checkCanShowColumns(ConnectorSecurityContext context, SchemaTableNam\n     @Override\n     public List<ColumnMetadata> filterColumns(ConnectorSecurityContext context, SchemaTableName tableName, List<ColumnMetadata> columns)\n     {\n-        if (!checkAnyTablePermission(context, tableName)) {\n+        if (INFORMATION_SCHEMA_NAME.equals(tableName.getSchemaName())) {\n+            return columns;\n+        }\n+\n+        ConnectorIdentity identity = context.getIdentity();\n+        TableAccessControlRule rule = tableRules.stream()\n+                .filter(tableRule -> tableRule.matches(identity.getUser(), identity.getGroups(), tableName))\n+                .findFirst()\n+                .orElse(null);\n+        if (rule == null || rule.getPrivileges().isEmpty()) {\n             return ImmutableList.of();\n         }\n-        return columns;\n+\n+        // if user has privileges other than select, show all columns", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTg3MjkzMw==", "url": "https://github.com/trinodb/trino/pull/5460#discussion_r501872933", "bodyText": "Currently column permissions only apply to SELECT.  If you have insert permissions you can insert into any column, so it makes sense that you can see these columns in a show statement (or information schema).", "author": "dain", "createdAt": "2020-10-08T16:59:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUyNDY3Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUyNTY2NQ==", "url": "https://github.com/trinodb/trino/pull/5460#discussion_r501525665", "bodyText": "It would be nice to have some test for this special case.", "author": "kokosing", "createdAt": "2020-10-08T08:06:51Z", "path": "presto-plugin-toolkit/src/main/java/io/prestosql/plugin/base/security/FileBasedAccessControl.java", "diffHunk": "@@ -211,10 +212,28 @@ public void checkCanShowColumns(ConnectorSecurityContext context, SchemaTableNam\n     @Override\n     public List<ColumnMetadata> filterColumns(ConnectorSecurityContext context, SchemaTableName tableName, List<ColumnMetadata> columns)\n     {\n-        if (!checkAnyTablePermission(context, tableName)) {\n+        if (INFORMATION_SCHEMA_NAME.equals(tableName.getSchemaName())) {", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTg3NTI4Mg==", "url": "https://github.com/trinodb/trino/pull/5460#discussion_r501875282", "bodyText": "This special case is automatically attached to every rule in file-based access controls:  https://github.com/prestosql/presto/blob/master/presto-plugin-toolkit/src/main/java/io/prestosql/plugin/base/security/FileBasedSystemAccessControl.java#L784-L786", "author": "dain", "createdAt": "2020-10-08T17:03:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUyNTY2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUyNTk0Mw==", "url": "https://github.com/trinodb/trino/pull/5460#discussion_r501525943", "bodyText": "It would nice to have a test for that each user has SELECT to INFORMATION_SCHEMA with grant option.", "author": "kokosing", "createdAt": "2020-10-08T08:07:24Z", "path": "presto-plugin-toolkit/src/main/java/io/prestosql/plugin/base/security/FileBasedAccessControl.java", "diffHunk": "@@ -320,11 +348,19 @@ public void checkCanDropView(ConnectorSecurityContext context, SchemaTableName v\n     @Override\n     public void checkCanCreateViewWithSelectFromColumns(ConnectorSecurityContext context, SchemaTableName tableName, Set<String> columnNames)\n     {\n-        // TODO: implement column level permissions\n-        if (!checkTablePermission(context, tableName, SELECT)) {\n+        if (INFORMATION_SCHEMA_NAME.equals(tableName.getSchemaName())) {", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUyNjExNQ==", "url": "https://github.com/trinodb/trino/pull/5460#discussion_r501526115", "bodyText": "same about null", "author": "kokosing", "createdAt": "2020-10-08T08:07:44Z", "path": "presto-plugin-toolkit/src/main/java/io/prestosql/plugin/base/security/FileBasedAccessControl.java", "diffHunk": "@@ -320,11 +348,19 @@ public void checkCanDropView(ConnectorSecurityContext context, SchemaTableName v\n     @Override\n     public void checkCanCreateViewWithSelectFromColumns(ConnectorSecurityContext context, SchemaTableName tableName, Set<String> columnNames)\n     {\n-        // TODO: implement column level permissions\n-        if (!checkTablePermission(context, tableName, SELECT)) {\n+        if (INFORMATION_SCHEMA_NAME.equals(tableName.getSchemaName())) {\n+            return;\n+        }\n+\n+        ConnectorIdentity identity = context.getIdentity();\n+        TableAccessControlRule rule = tableRules.stream()\n+                .filter(tableRule -> tableRule.matches(identity.getUser(), identity.getGroups(), tableName))\n+                .findFirst()\n+                .orElse(null);", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUyNzEzMw==", "url": "https://github.com/trinodb/trino/pull/5460#discussion_r501527133", "bodyText": "same, it is a pity that it was implemented this way for a such long time", "author": "kokosing", "createdAt": "2020-10-08T08:09:23Z", "path": "presto-plugin-toolkit/src/main/java/io/prestosql/plugin/base/security/FileBasedSystemAccessControl.java", "diffHunk": "@@ -560,7 +561,28 @@ public void checkCanShowColumns(SystemSecurityContext context, CatalogSchemaTabl\n             return ImmutableList.of();\n         }\n \n-        return columns;\n+        if (INFORMATION_SCHEMA_NAME.equals(tableName.getSchemaTableName().getSchemaName())) {", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUyNzIyMA==", "url": "https://github.com/trinodb/trino/pull/5460#discussion_r501527220", "bodyText": "same", "author": "kokosing", "createdAt": "2020-10-08T08:09:31Z", "path": "presto-plugin-toolkit/src/main/java/io/prestosql/plugin/base/security/FileBasedSystemAccessControl.java", "diffHunk": "@@ -560,7 +561,28 @@ public void checkCanShowColumns(SystemSecurityContext context, CatalogSchemaTabl\n             return ImmutableList.of();\n         }\n \n-        return columns;\n+        if (INFORMATION_SCHEMA_NAME.equals(tableName.getSchemaTableName().getSchemaName())) {\n+            return columns;\n+        }\n+\n+        Identity identity = context.getIdentity();\n+        CatalogTableAccessControlRule rule = tableRules.stream()\n+                .filter(tableRule -> tableRule.matches(identity.getUser(), identity.getGroups(), tableName))\n+                .findFirst()\n+                .orElse(null);", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUyNzM3MA==", "url": "https://github.com/trinodb/trino/pull/5460#discussion_r501527370", "bodyText": "same", "author": "kokosing", "createdAt": "2020-10-08T08:09:47Z", "path": "presto-plugin-toolkit/src/main/java/io/prestosql/plugin/base/security/FileBasedSystemAccessControl.java", "diffHunk": "@@ -560,7 +561,28 @@ public void checkCanShowColumns(SystemSecurityContext context, CatalogSchemaTabl\n             return ImmutableList.of();\n         }\n \n-        return columns;\n+        if (INFORMATION_SCHEMA_NAME.equals(tableName.getSchemaTableName().getSchemaName())) {\n+            return columns;\n+        }\n+\n+        Identity identity = context.getIdentity();\n+        CatalogTableAccessControlRule rule = tableRules.stream()\n+                .filter(tableRule -> tableRule.matches(identity.getUser(), identity.getGroups(), tableName))\n+                .findFirst()\n+                .orElse(null);\n+        if (rule == null || rule.getPrivileges().isEmpty()) {\n+            return ImmutableList.of();\n+        }\n+\n+        // if user has privileges other than select, show all columns", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUyNzg0NA==", "url": "https://github.com/trinodb/trino/pull/5460#discussion_r501527844", "bodyText": "same", "author": "kokosing", "createdAt": "2020-10-08T08:10:30Z", "path": "presto-plugin-toolkit/src/main/java/io/prestosql/plugin/base/security/FileBasedSystemAccessControl.java", "diffHunk": "@@ -640,11 +676,23 @@ public void checkCanDropView(SystemSecurityContext context, CatalogSchemaTableNa\n     @Override\n     public void checkCanCreateViewWithSelectFromColumns(SystemSecurityContext context, CatalogSchemaTableName table, Set<String> columns)\n     {\n-        // TODO: implement column level permissions\n-        if (!checkTablePermission(context, table, SELECT)) {\n+        if (!canAccessCatalog(context, table.getCatalogName(), ALL)) {\n+            denySelectTable(table.toString());\n+        }\n+\n+        if (INFORMATION_SCHEMA_NAME.equals(table.getSchemaTableName().getSchemaName())) {", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUyNzkxNQ==", "url": "https://github.com/trinodb/trino/pull/5460#discussion_r501527915", "bodyText": "same", "author": "kokosing", "createdAt": "2020-10-08T08:10:37Z", "path": "presto-plugin-toolkit/src/main/java/io/prestosql/plugin/base/security/FileBasedSystemAccessControl.java", "diffHunk": "@@ -640,11 +676,23 @@ public void checkCanDropView(SystemSecurityContext context, CatalogSchemaTableNa\n     @Override\n     public void checkCanCreateViewWithSelectFromColumns(SystemSecurityContext context, CatalogSchemaTableName table, Set<String> columns)\n     {\n-        // TODO: implement column level permissions\n-        if (!checkTablePermission(context, table, SELECT)) {\n+        if (!canAccessCatalog(context, table.getCatalogName(), ALL)) {\n+            denySelectTable(table.toString());\n+        }\n+\n+        if (INFORMATION_SCHEMA_NAME.equals(table.getSchemaTableName().getSchemaName())) {\n+            return;\n+        }\n+\n+        Identity identity = context.getIdentity();\n+        CatalogTableAccessControlRule rule = tableRules.stream()\n+                .filter(tableRule -> tableRule.matches(identity.getUser(), identity.getGroups(), table))\n+                .findFirst()\n+                .orElse(null);", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUyODIxNw==", "url": "https://github.com/trinodb/trino/pull/5460#discussion_r501528217", "bodyText": "put columns under tableRegex", "author": "kokosing", "createdAt": "2020-10-08T08:11:04Z", "path": "presto-plugin-toolkit/src/main/java/io/prestosql/plugin/base/security/TableAccessControlRule.java", "diffHunk": "@@ -31,9 +36,11 @@\n             Optional.empty(),\n             Optional.empty(),\n             Optional.empty(),\n+            Optional.empty(),\n             Optional.empty());\n \n     private final Set<TablePrivilege> privileges;\n+    private final Set<String> restrictedColumns;", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTg3NTg0NQ==", "url": "https://github.com/trinodb/trino/pull/5460#discussion_r501875845", "bodyText": "The sorting is \"permission\" and then \"matching\"", "author": "dain", "createdAt": "2020-10-08T17:04:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUyODIxNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUyODQzNQ==", "url": "https://github.com/trinodb/trino/pull/5460#discussion_r501528435", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            tableRegex.map(regex -> regex.matcher(table.getTableName()).matches()).orElse(true);\n          \n          \n            \n                            tableRegex.map(regex -> regex.matcher(table.getTableName()).matches())\n          \n          \n            \n                            .orElse(true);", "author": "kokosing", "createdAt": "2020-10-08T08:11:28Z", "path": "presto-plugin-toolkit/src/main/java/io/prestosql/plugin/base/security/TableAccessControlRule.java", "diffHunk": "@@ -42,27 +49,39 @@\n     @JsonCreator\n     public TableAccessControlRule(\n             @JsonProperty(\"privileges\") Set<TablePrivilege> privileges,\n+            @JsonProperty(\"columns\") Optional<List<ColumnConstraint>> columns,\n             @JsonProperty(\"user\") Optional<Pattern> userRegex,\n             @JsonProperty(\"group\") Optional<Pattern> groupRegex,\n             @JsonProperty(\"schema\") Optional<Pattern> schemaRegex,\n             @JsonProperty(\"table\") Optional<Pattern> tableRegex)\n     {\n         this.privileges = ImmutableSet.copyOf(requireNonNull(privileges, \"privileges is null\"));\n+        this.restrictedColumns = requireNonNull(columns, \"columns is null\").orElse(ImmutableList.of()).stream()\n+                .filter(constraint -> !constraint.isAllowed())\n+                .map(ColumnConstraint::getName)\n+                .collect(toImmutableSet());\n         this.userRegex = requireNonNull(userRegex, \"user is null\");\n         this.groupRegex = requireNonNull(groupRegex, \"group is null\");\n         this.schemaRegex = requireNonNull(schemaRegex, \"sourceRegex is null\");\n         this.tableRegex = requireNonNull(tableRegex, \"tableRegex is null\");\n     }\n \n-    public Optional<Set<TablePrivilege>> match(String user, Set<String> groups, SchemaTableName table)\n+    public boolean matches(String user, Set<String> groups, SchemaTableName table)\n     {\n-        if (userRegex.map(regex -> regex.matcher(user).matches()).orElse(true) &&\n+        return userRegex.map(regex -> regex.matcher(user).matches()).orElse(true) &&\n                 groupRegex.map(regex -> groups.stream().anyMatch(group -> regex.matcher(group).matches())).orElse(true) &&\n                 schemaRegex.map(regex -> regex.matcher(table.getSchemaName()).matches()).orElse(true) &&\n-                tableRegex.map(regex -> regex.matcher(table.getTableName()).matches()).orElse(true)) {\n-            return Optional.of(privileges);\n-        }\n-        return Optional.empty();\n+                tableRegex.map(regex -> regex.matcher(table.getTableName()).matches()).orElse(true);", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDMzMzM1Mw==", "url": "https://github.com/trinodb/trino/pull/5460#discussion_r504333353", "bodyText": "This matches the style of the existing code, and I think it is more readable as each line checks a single regex using the same same style", "author": "dain", "createdAt": "2020-10-14T00:32:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUyODQzNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUyODk5Mg==", "url": "https://github.com/trinodb/trino/pull/5460#discussion_r501528992", "bodyText": "Does this belong to the next commit?", "author": "kokosing", "createdAt": "2020-10-08T08:12:24Z", "path": "presto-plugin-toolkit/src/main/java/io/prestosql/plugin/base/security/ExpressionEnvironment.java", "diffHunk": "@@ -0,0 +1,38 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.prestosql.plugin.base.security;\n+\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+\n+import java.util.Optional;\n+\n+import static java.util.Objects.requireNonNull;\n+\n+public class ExpressionEnvironment", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUyOTA4OA==", "url": "https://github.com/trinodb/trino/pull/5460#discussion_r501529088", "bodyText": "Does these two above belong to the next commit?", "author": "kokosing", "createdAt": "2020-10-08T08:12:33Z", "path": "presto-plugin-toolkit/src/main/java/io/prestosql/plugin/base/security/ColumnConstraint.java", "diffHunk": "@@ -0,0 +1,60 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.prestosql.plugin.base.security;\n+\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+\n+import java.util.Optional;\n+\n+public class ColumnConstraint\n+{\n+    private final String name;\n+    private final boolean allowed;\n+    private final Optional<String> mask;\n+    private final Optional<String> maskUser;\n+\n+    @JsonCreator\n+    public ColumnConstraint(\n+            @JsonProperty(\"name\") String name,\n+            @JsonProperty(\"allow\") Optional<Boolean> allow,\n+            @JsonProperty(\"mask\") Optional<String> mask,\n+            @JsonProperty(\"mask_user\") Optional<String> maskUser)", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUyOTk0Nw==", "url": "https://github.com/trinodb/trino/pull/5460#discussion_r501529947", "bodyText": "That requires documentation that you cannot set masks for information_schema. Maybe we should be fail on initialization then if user specifies any rule against information_schema?", "author": "kokosing", "createdAt": "2020-10-08T08:13:59Z", "path": "presto-plugin-toolkit/src/main/java/io/prestosql/plugin/base/security/FileBasedAccessControl.java", "diffHunk": "@@ -455,7 +457,16 @@ public void checkCanExecuteProcedure(ConnectorSecurityContext context, SchemaRou\n     @Override\n     public Optional<ViewExpression> getColumnMask(ConnectorSecurityContext context, SchemaTableName tableName, String columnName, Type type)\n     {\n-        return Optional.empty();\n+        if (INFORMATION_SCHEMA_NAME.equals(tableName.getSchemaName())) {", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTUzMTE3MA==", "url": "https://github.com/trinodb/trino/pull/5460#discussion_r501531170", "bodyText": "same about documenting this", "author": "kokosing", "createdAt": "2020-10-08T08:16:02Z", "path": "presto-plugin-toolkit/src/main/java/io/prestosql/plugin/base/security/FileBasedAccessControl.java", "diffHunk": "@@ -451,7 +451,16 @@ public void checkCanExecuteProcedure(ConnectorSecurityContext context, SchemaRou\n     @Override\n     public Optional<ViewExpression> getRowFilter(ConnectorSecurityContext context, SchemaTableName tableName)\n     {\n-        return Optional.empty();\n+        if (INFORMATION_SCHEMA_NAME.equals(tableName.getSchemaName())) {", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": "4d24afe930921a77afb299b627d2c04e8fa0fecd", "url": "https://github.com/trinodb/trino/commit/4d24afe930921a77afb299b627d2c04e8fa0fecd", "message": "Document file access rules not applying to information_schema", "committedDate": "2020-10-17T19:25:51Z", "type": "commit"}, {"oid": "e5e5ebeb3e7bec7116d298efa609124cb1f42df7", "url": "https://github.com/trinodb/trino/commit/e5e5ebeb3e7bec7116d298efa609124cb1f42df7", "message": "Add column level security to file-based access controls", "committedDate": "2020-10-17T19:25:51Z", "type": "commit"}, {"oid": "249a8851bbca3b080039392dcdd52b22e95cf117", "url": "https://github.com/trinodb/trino/commit/249a8851bbca3b080039392dcdd52b22e95cf117", "message": "Add column mask to file access control", "committedDate": "2020-10-17T19:29:19Z", "type": "commit"}, {"oid": "007db32119fb3fc2689423206d1de7af3ad6dc9b", "url": "https://github.com/trinodb/trino/commit/007db32119fb3fc2689423206d1de7af3ad6dc9b", "message": "Add row filter to file access control", "committedDate": "2020-10-17T19:29:20Z", "type": "commit"}, {"oid": "007db32119fb3fc2689423206d1de7af3ad6dc9b", "url": "https://github.com/trinodb/trino/commit/007db32119fb3fc2689423206d1de7af3ad6dc9b", "message": "Add row filter to file access control", "committedDate": "2020-10-17T19:29:20Z", "type": "forcePushed"}]}