{"pr_number": 4887, "pr_title": "Fix unauthorized error by the benchmark driver", "pr_createdAt": "2020-08-19T12:18:13Z", "pr_url": "https://github.com/trinodb/trino/pull/4887", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDA1MDE5NQ==", "url": "https://github.com/trinodb/trino/pull/4887#discussion_r474050195", "bodyText": "use requireNonNull(user, \"user is null\")", "author": "sopel39", "createdAt": "2020-08-20T15:00:21Z", "path": "presto-benchmark-driver/src/main/java/io/prestosql/benchmark/driver/BenchmarkQueryRunner.java", "diffHunk": "@@ -95,7 +96,7 @@ public BenchmarkQueryRunner(int warm, int runs, boolean debug, int maxFailures,\n         setupSocksProxy(builder, socksProxy);\n         this.okHttpClient = builder.build();\n \n-        nodes = getAllNodes(requireNonNull(serverUri, \"serverUri is null\"));\n+        nodes = getAllNodes(requireNonNull(serverUri, \"serverUri is null\"), user);", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDA1MDM3MA==", "url": "https://github.com/trinodb/trino/pull/4887#discussion_r474050370", "bodyText": "can we use dummy user instead of actual user name? I think any username will do in benchmarks", "author": "sopel39", "createdAt": "2020-08-20T15:00:36Z", "path": "presto-benchmark-driver/src/main/java/io/prestosql/benchmark/driver/BenchmarkQueryRunner.java", "diffHunk": "@@ -271,9 +272,9 @@ private long getTotalCpuTime()\n         return TimeUnit.NANOSECONDS.toNanos(totalCpuTime);\n     }\n \n-    private List<URI> getAllNodes(URI server)\n+    private List<URI> getAllNodes(URI server, String user)\n     {\n-        Request request = prepareGet().setUri(uriBuilderFrom(server).replacePath(\"/v1/service/presto\").build()).build();\n+        Request request = prepareGet().setHeader(PrestoHeaders.PRESTO_USER, user).setUri(uriBuilderFrom(server).replacePath(\"/v1/service/presto\").build()).build();", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDI5MjMzMA==", "url": "https://github.com/trinodb/trino/pull/4887#discussion_r474292330", "bodyText": "@sopel39 Can we ignore the user name specified by the option --user?", "author": "Lewuathe", "createdAt": "2020-08-20T21:50:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDA1MDM3MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDUwNjc3Mw==", "url": "https://github.com/trinodb/trino/pull/4887#discussion_r474506773", "bodyText": "@Lewuathe I think in benchto for a while some dummy name was used and benchmarks still work. However, I think we can keep it as is", "author": "sopel39", "createdAt": "2020-08-21T08:13:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDA1MDM3MA=="}], "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTQyNzE1NA==", "url": "https://github.com/trinodb/trino/pull/4887#discussion_r475427154", "bodyText": "make it requireNonNull(user, \"user is null\")", "author": "sopel39", "createdAt": "2020-08-24T08:32:04Z", "path": "presto-benchmark-driver/src/main/java/io/prestosql/benchmark/driver/BenchmarkQueryRunner.java", "diffHunk": "@@ -95,7 +96,7 @@ public BenchmarkQueryRunner(int warm, int runs, boolean debug, int maxFailures,\n         setupSocksProxy(builder, socksProxy);\n         this.okHttpClient = builder.build();\n \n-        nodes = getAllNodes(requireNonNull(serverUri, \"serverUri is null\"));\n+        nodes = getAllNodes(requireNonNull(serverUri, \"serverUri is null\"), requireNonNull(user));", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "860c070a59fe05fe2a90f574afafb0cb7e1cd267", "url": "https://github.com/trinodb/trino/commit/860c070a59fe05fe2a90f574afafb0cb7e1cd267", "message": "Fix unauthorized error by the benchmark driver\n\nAlthough Presto coordinator requires X-Presto-User header for the\ndefault authentication, BenchmarkDriver fails to send the header to get\nthe list of URIs.", "committedDate": "2020-08-26T11:06:16Z", "type": "commit"}, {"oid": "860c070a59fe05fe2a90f574afafb0cb7e1cd267", "url": "https://github.com/trinodb/trino/commit/860c070a59fe05fe2a90f574afafb0cb7e1cd267", "message": "Fix unauthorized error by the benchmark driver\n\nAlthough Presto coordinator requires X-Presto-User header for the\ndefault authentication, BenchmarkDriver fails to send the header to get\nthe list of URIs.", "committedDate": "2020-08-26T11:06:16Z", "type": "forcePushed"}]}