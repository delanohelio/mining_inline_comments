{"pr_number": 6444, "pr_title": "Merge TestingKafka classes", "pr_createdAt": "2020-12-27T20:38:06Z", "pr_url": "https://github.com/trinodb/trino/pull/6444", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTMxNjIyOA==", "url": "https://github.com/trinodb/trino/pull/6444#discussion_r549316228", "bodyText": "nit: remove one of the only words in the second sentence of commit message", "author": "skrzypo987", "createdAt": "2020-12-28T11:36:03Z", "path": "presto-kafka/src/test/java/io/prestosql/plugin/kafka/TestKafkaIntegrationPushDown.java", "diffHunk": "@@ -13,7 +13,6 @@\n  */\n package io.prestosql.plugin.kafka;\n \n-import com.google.common.collect.ImmutableList;", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTMxODc2Ng==", "url": "https://github.com/trinodb/trino/pull/6444#discussion_r549318766", "bodyText": "\"Optional\" arguments should be at the end of arg list.", "author": "skrzypo987", "createdAt": "2020-12-28T11:45:12Z", "path": "presto-testing-kafka/src/main/java/io/prestosql/testing/kafka/TestingKafka.java", "diffHunk": "@@ -30,6 +33,13 @@\n \n     void createTopicWithConfig(int partitions, int replication, String topic, boolean enableLogAppendTime);\n \n+    default <K, V> RecordMetadata sendMessages(Stream<ProducerRecord<K, V>> recordStream)\n+    {\n+        return sendMessages(ImmutableMap.of(), recordStream);\n+    }\n+\n+    <K, V> RecordMetadata sendMessages(Map<String, String> extraProducerProperties, Stream<ProducerRecord<K, V>> recordStream);", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTIxNDMxNg==", "url": "https://github.com/trinodb/trino/pull/6444#discussion_r551214316", "bodyText": "The URL is common across all the test methods.. Can we move it to TestingKafkaWithSchemaRegistry#createProducer", "author": "Praveen2112", "createdAt": "2021-01-04T09:54:12Z", "path": "presto-kafka/src/test/java/io/prestosql/plugin/kafka/schema/confluent/TestKafkaWithConfluentSchemaRegistryMinimalFunctionality.java", "diffHunk": "@@ -93,7 +97,11 @@ public void testBasicTopic()\n                 format(\"SELECT col_1, col_2 FROM %s\", toDoubleQuoted(topic)),\n                 format(\"SELECT col_1, col_2, col_3 FROM %s\", toDoubleQuoted(topic)),\n                 false,\n-                () -> testingKafkaWithSchemaRegistry.createProducer());\n+                ImmutableMap.<String, String>builder()\n+                        .put(SCHEMA_REGISTRY_URL_CONFIG, testingKafkaWithSchemaRegistry.getSchemaRegistryConnectString())", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTI3NjQyOQ==", "url": "https://github.com/trinodb/trino/pull/6444#discussion_r551276429", "bodyText": "Can we extract the common properties ?", "author": "Praveen2112", "createdAt": "2021-01-04T12:01:39Z", "path": "plugin/trino-kafka/src/test/java/io/trino/plugin/kafka/schema/confluent/TestKafkaWithConfluentSchemaRegistryMinimalFunctionality.java", "diffHunk": "@@ -88,60 +89,84 @@ protected QueryRunner createQueryRunner()\n     public void testBasicTopic()\n     {\n         String topic = \"topic-basic-MixedCase\";\n-        assertTopic(topic,\n+        assertTopic(\n+                topic,\n                 format(\"SELECT col_1, col_2 FROM %s\", toDoubleQuoted(topic)),\n                 format(\"SELECT col_1, col_2, col_3 FROM %s\", toDoubleQuoted(topic)),\n                 false,\n-                () -> testingKafkaWithSchemaRegistry.createProducer());\n+                ImmutableMap.<String, String>builder()\n+                        .put(SCHEMA_REGISTRY_URL_CONFIG, testingKafka.getSchemaRegistryConnectString())\n+                        .put(KEY_SERIALIZER_CLASS_CONFIG, LongSerializer.class.getName())\n+                        .put(VALUE_SERIALIZER_CLASS_CONFIG, KafkaAvroSerializer.class.getName())\n+                        .build());\n     }\n \n     @Test\n     public void testTopicWithKeySubject()\n     {\n         String topic = \"topic-Key-Subject\";\n-        assertTopic(topic,\n+        assertTopic(\n+                topic,\n                 format(\"SELECT \\\"%s-key\\\", col_1, col_2 FROM %s\", topic, toDoubleQuoted(topic)),\n                 format(\"SELECT \\\"%s-key\\\", col_1, col_2, col_3 FROM %s\", topic, toDoubleQuoted(topic)),\n                 true,\n-                () -> testingKafkaWithSchemaRegistry.createConfluentProducer());\n+                ImmutableMap.<String, String>builder()\n+                        .put(SCHEMA_REGISTRY_URL_CONFIG, testingKafka.getSchemaRegistryConnectString())", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": "f68a00bbc5edbb5db13dabaff277298e119ba511", "url": "https://github.com/trinodb/trino/commit/f68a00bbc5edbb5db13dabaff277298e119ba511", "message": "Fix formatting", "committedDate": "2021-01-04T20:02:27Z", "type": "commit"}, {"oid": "7de6287901d7cbf1cc8cd05fd2171a702e0e9c91", "url": "https://github.com/trinodb/trino/commit/7de6287901d7cbf1cc8cd05fd2171a702e0e9c91", "message": "Update latest Kafka for testing to 6.0.1", "committedDate": "2021-01-04T20:02:27Z", "type": "commit"}, {"oid": "8f59be9548497f77278ef645f79b07f3fd041868", "url": "https://github.com/trinodb/trino/commit/8f59be9548497f77278ef645f79b07f3fd041868", "message": "Close testing kafka instance after tests", "committedDate": "2021-01-04T20:02:27Z", "type": "commit"}, {"oid": "361b15f6359f6c897d8f94dae3518ee6a974af2a", "url": "https://github.com/trinodb/trino/commit/361b15f6359f6c897d8f94dae3518ee6a974af2a", "message": "Close testing kafka after query runner", "committedDate": "2021-01-04T20:03:38Z", "type": "commit"}, {"oid": "53333ae513d6b57052364a6737a70d8bad2eaecf", "url": "https://github.com/trinodb/trino/commit/53333ae513d6b57052364a6737a70d8bad2eaecf", "message": "Remove debug timestamp test dump\n\nIt is only useful for local development when debugging issues.\nLikely during debugging simple additional logging would be much easier\nand less complex for that.\n\nThis code makes tests code to be less maintainable. As it make tests\ncases non trivial.", "committedDate": "2021-01-04T20:03:40Z", "type": "commit"}, {"oid": "bd0a0f9b922f21064dd08ac8afbc774b436ccab9", "url": "https://github.com/trinodb/trino/commit/bd0a0f9b922f21064dd08ac8afbc774b436ccab9", "message": "Inline createConfluentProducer methods", "committedDate": "2021-01-04T20:03:40Z", "type": "commit"}, {"oid": "c4cfd72562318d14b538ce661769c365a33a4d62", "url": "https://github.com/trinodb/trino/commit/c4cfd72562318d14b538ce661769c365a33a4d62", "message": "Extract TestingKafka::sendMessages", "committedDate": "2021-01-04T20:04:25Z", "type": "commit"}, {"oid": "5ab9e3bf19f8b451c366854e6dae3b9e75c0f6cf", "url": "https://github.com/trinodb/trino/commit/5ab9e3bf19f8b451c366854e6dae3b9e75c0f6cf", "message": "Retry sending kafka message in tests", "committedDate": "2021-01-04T20:04:27Z", "type": "commit"}, {"oid": "60a207c4b66dfae3658b57faccc15d047b37a10e", "url": "https://github.com/trinodb/trino/commit/60a207c4b66dfae3658b57faccc15d047b37a10e", "message": "Merge TestingKafka classes", "committedDate": "2021-01-04T20:05:30Z", "type": "commit"}, {"oid": "6797caad488c706a3aad0e3d4ed2939f339168d0", "url": "https://github.com/trinodb/trino/commit/6797caad488c706a3aad0e3d4ed2939f339168d0", "message": "Add logging for testing Kafka dockers", "committedDate": "2021-01-04T20:05:32Z", "type": "commit"}, {"oid": "6797caad488c706a3aad0e3d4ed2939f339168d0", "url": "https://github.com/trinodb/trino/commit/6797caad488c706a3aad0e3d4ed2939f339168d0", "message": "Add logging for testing Kafka dockers", "committedDate": "2021-01-04T20:05:32Z", "type": "forcePushed"}]}