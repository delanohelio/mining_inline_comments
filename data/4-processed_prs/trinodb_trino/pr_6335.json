{"pr_number": 6335, "pr_title": "Use node reference comparison to dermine if table is delete target", "pr_createdAt": "2020-12-14T13:32:32Z", "pr_url": "https://github.com/trinodb/trino/pull/6335", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjQ2MDQ2MQ==", "url": "https://github.com/trinodb/trino/pull/6335#discussion_r542460461", "bodyText": "the target should be set at this point and should contain a table, so\nreturn \"DELETE\".equals(updateType) &&\n  target.orElseThrow(...)\n     .getTable().orElseThrow(...) == table; // intentional comparison by reference", "author": "findepi", "createdAt": "2020-12-14T15:12:08Z", "path": "presto-main/src/main/java/io/prestosql/sql/analyzer/Analysis.java", "diffHunk": "@@ -222,8 +224,8 @@ public void resetUpdateType()\n \n     public boolean isDeleteTarget(Table table)\n     {\n-        QualifiedObjectName name = tables.get(NodeRef.of(table)).getName();\n-        return \"DELETE\".equals(updateType) && Optional.of(name).equals(target);\n+        NodeRef<Table> tableRef = NodeRef.of(table);\n+        return \"DELETE\".equals(updateType) && Optional.of(tableRef).equals(target.flatMap(UpdateTarget::getTable));", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjQ3MDI2MA==", "url": "https://github.com/trinodb/trino/pull/6335#discussion_r542470260", "bodyText": "i'm aware this would broaden the scope of the change, but i think it would be a good change", "author": "findepi", "createdAt": "2020-12-14T15:24:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjQ2MDQ2MQ=="}], "type": "inlineReview"}, {"oid": "c4ffd880aa38d4235d1622b4d4686ce3230415f6", "url": "https://github.com/trinodb/trino/commit/c4ffd880aa38d4235d1622b4d4686ce3230415f6", "message": "Use node reference comparison to dermine if table is delete target", "committedDate": "2020-12-14T17:29:09Z", "type": "commit"}, {"oid": "c4ffd880aa38d4235d1622b4d4686ce3230415f6", "url": "https://github.com/trinodb/trino/commit/c4ffd880aa38d4235d1622b4d4686ce3230415f6", "message": "Use node reference comparison to dermine if table is delete target", "committedDate": "2020-12-14T17:29:09Z", "type": "forcePushed"}]}