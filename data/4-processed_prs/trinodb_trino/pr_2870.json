{"pr_number": 2870, "pr_title": "Format maps and lists with varbinary", "pr_createdAt": "2020-02-18T12:09:45Z", "pr_url": "https://github.com/trinodb/trino/pull/2870", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTk1ODAzMA==", "url": "https://github.com/trinodb/trino/pull/2870#discussion_r385958030", "bodyText": "move under createHexPairs so that the 3 hex-related functions stay together", "author": "findepi", "createdAt": "2020-02-28T22:50:14Z", "path": "presto-cli/src/main/java/io/prestosql/cli/AlignedTablePrinter.java", "diffHunk": "@@ -186,6 +196,24 @@ static String formatHexDump(byte[] bytes)\n         return HEX_BYTE_JOINER.join(createHexPairs(bytes));\n     }\n \n+    static String formatList(List<? extends Object> list)", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTk1ODc5Mg==", "url": "https://github.com/trinodb/trino/pull/2870#discussion_r385958792", "bodyText": "I think it would be better to explicitly format the list:\nreturn list.stream()\n .map(AlignedTablePrinter::formatValue)\n .collect(joining(\", \", \"[\", \"]));", "author": "findepi", "createdAt": "2020-02-28T22:52:58Z", "path": "presto-cli/src/main/java/io/prestosql/cli/AlignedTablePrinter.java", "diffHunk": "@@ -186,6 +196,24 @@ static String formatHexDump(byte[] bytes)\n         return HEX_BYTE_JOINER.join(createHexPairs(bytes));\n     }\n \n+    static String formatList(List<? extends Object> list)\n+    {\n+        ImmutableList.Builder<Object> formattedList = ImmutableList.builder();\n+\n+        list.forEach(value -> formattedList.add(formatValue(value)));\n+\n+        return formattedList.build().toString();", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTk1ODkzNg==", "url": "https://github.com/trinodb/trino/pull/2870#discussion_r385958936", "bodyText": "should key be formatted as well?", "author": "findepi", "createdAt": "2020-02-28T22:53:26Z", "path": "presto-cli/src/main/java/io/prestosql/cli/AlignedTablePrinter.java", "diffHunk": "@@ -186,6 +196,24 @@ static String formatHexDump(byte[] bytes)\n         return HEX_BYTE_JOINER.join(createHexPairs(bytes));\n     }\n \n+    static String formatList(List<? extends Object> list)\n+    {\n+        ImmutableList.Builder<Object> formattedList = ImmutableList.builder();\n+\n+        list.forEach(value -> formattedList.add(formatValue(value)));\n+\n+        return formattedList.build().toString();\n+    }\n+\n+    static String formatMap(Map<? extends Object, ? extends Object> map)\n+    {\n+        ImmutableMap.Builder<Object, Object> formattedMap = ImmutableMap.builder();\n+\n+        map.keySet().forEach(key -> formattedMap.put(key, formatValue(map.get(key))));", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzI5NDEyOA==", "url": "https://github.com/trinodb/trino/pull/2870#discussion_r387294128", "bodyText": "I guess so", "author": "wendigo", "createdAt": "2020-03-03T21:07:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTk1ODkzNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzI5OTE1Mw==", "url": "https://github.com/trinodb/trino/pull/2870#discussion_r387299153", "bodyText": "...  then you can't use Map to construct the final String (technically, the format function could return same String for two distinct keys)", "author": "findepi", "createdAt": "2020-03-03T21:18:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTk1ODkzNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzMwOTE4OQ==", "url": "https://github.com/trinodb/trino/pull/2870#discussion_r387309189", "bodyText": "Yep, does it make sense right now?", "author": "wendigo", "createdAt": "2020-03-03T21:39:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTk1ODkzNg=="}], "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzMwMTE5MQ==", "url": "https://github.com/trinodb/trino/pull/2870#discussion_r387301191", "bodyText": "unused?", "author": "findepi", "createdAt": "2020-03-03T21:22:45Z", "path": "presto-cli/src/main/java/io/prestosql/cli/AlignedTablePrinter.java", "diffHunk": "@@ -195,6 +206,26 @@ static String formatHexDump(byte[] bytes)\n         return HEX_SPLITTER.split(hexDump);\n     }\n \n+    static String formatList(List<? extends Object> list)\n+    {\n+        ImmutableList.Builder<Object> formattedList = ImmutableList.builder();", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzMwOTA3OA==", "url": "https://github.com/trinodb/trino/pull/2870#discussion_r387309078", "bodyText": "Removed", "author": "wendigo", "createdAt": "2020-03-03T21:38:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzMwMTE5MQ=="}], "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzM0NTQ0Mw==", "url": "https://github.com/trinodb/trino/pull/2870#discussion_r387345443", "bodyText": "Static import", "author": "electrum", "createdAt": "2020-03-03T22:57:04Z", "path": "presto-cli/src/main/java/io/prestosql/cli/AlignedTablePrinter.java", "diffHunk": "@@ -195,6 +206,20 @@ static String formatHexDump(byte[] bytes)\n         return HEX_SPLITTER.split(hexDump);\n     }\n \n+    static String formatList(List<? extends Object> list)\n+    {\n+        return list.stream()\n+                .map(AlignedTablePrinter::formatValue)\n+                .collect(joining(\", \", \"[\", \"]\"));\n+    }\n+\n+    static String formatMap(Map<? extends Object, ? extends Object> map)\n+    {\n+        return map.entrySet().stream()\n+                .map(entry -> format(\"%s=%s\", formatValue(entry.getKey()), formatValue(entry.getValue())))\n+                .collect(Collectors.joining(\", \", \"{\", \"}\"));", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": "8d1289b193067c5744f8d46c564991fcac23738c", "url": "https://github.com/trinodb/trino/commit/8d1289b193067c5744f8d46c564991fcac23738c", "message": "Format maps and lists with varbinary", "committedDate": "2020-03-04T18:39:44Z", "type": "commit"}, {"oid": "8d1289b193067c5744f8d46c564991fcac23738c", "url": "https://github.com/trinodb/trino/commit/8d1289b193067c5744f8d46c564991fcac23738c", "message": "Format maps and lists with varbinary", "committedDate": "2020-03-04T18:39:44Z", "type": "forcePushed"}]}