{"pr_number": 4165, "pr_title": "Add support for user/password auth", "pr_createdAt": "2020-06-23T05:24:31Z", "pr_url": "https://github.com/trinodb/trino/pull/4165", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzk5NDg2MQ==", "url": "https://github.com/trinodb/trino/pull/4165#discussion_r443994861", "bodyText": "verify the two configs are mutually exclusive", "author": "findepi", "createdAt": "2020-06-23T06:41:56Z", "path": "presto-elasticsearch/src/main/java/io/prestosql/elasticsearch/client/ElasticsearchClient.java", "diffHunk": "@@ -228,6 +239,12 @@ private static RestHighLevelClient createClient(ElasticsearchConfig config, Opti\n                 }\n             }\n \n+            passwordConfig.ifPresent(securityConfig -> {", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzk5NTY0Mg==", "url": "https://github.com/trinodb/trino/pull/4165#discussion_r443995642", "bodyText": "From this code's point of view, it doesn't matter, I think. Both could be supplied and it should just work.", "author": "martint", "createdAt": "2020-06-23T06:43:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzk5NDg2MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDAwNDkyNQ==", "url": "https://github.com/trinodb/trino/pull/4165#discussion_r444004925", "bodyText": "add comma at the end", "author": "kokosing", "createdAt": "2020-06-23T07:04:06Z", "path": "presto-elasticsearch/src/main/java/io/prestosql/elasticsearch/ElasticsearchConfig.java", "diffHunk": "@@ -49,7 +49,8 @@\n {\n     public enum Security\n     {\n-        AWS\n+        AWS,\n+        PASSWORD", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDY4NjY0NQ==", "url": "https://github.com/trinodb/trino/pull/4165#discussion_r444686645", "bodyText": "will this be deleted on exit recursively?", "author": "findepi", "createdAt": "2020-06-24T07:04:14Z", "path": "presto-elasticsearch/src/test/java/io/prestosql/elasticsearch/ElasticsearchServer.java", "diffHunk": "@@ -13,16 +13,42 @@\n  */\n package io.prestosql.elasticsearch;\n \n+import com.google.common.io.Files;\n import com.google.common.net.HostAndPort;\n import org.testcontainers.elasticsearch.ElasticsearchContainer;\n \n+import java.io.File;\n+import java.io.IOException;\n+import java.nio.file.Path;\n+import java.util.Map;\n+\n+import static com.google.common.io.Files.createTempDir;\n+import static java.nio.charset.StandardCharsets.UTF_8;\n+import static org.testcontainers.utility.MountableFile.forHostPath;\n+\n public class ElasticsearchServer\n {\n     private final ElasticsearchContainer container;\n \n-    public ElasticsearchServer(String version)\n+    public ElasticsearchServer(String image, Map<String, String> configuration)\n+            throws IOException\n     {\n-        container = new ElasticsearchContainer(\"docker.elastic.co/elasticsearch/elasticsearch-oss:\" + version);\n+        container = new ElasticsearchContainer(image);\n+\n+        if (!configuration.isEmpty()) {\n+            File tempDir = createTempDir();\n+            tempDir.deleteOnExit();", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDkxNjcxNA==", "url": "https://github.com/trinodb/trino/pull/4165#discussion_r444916714", "bodyText": "It will not. I'll change the strategy (btw, we have the same problem in CassandraServer)", "author": "martint", "createdAt": "2020-06-24T14:02:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDY4NjY0NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDY4Njg5OA==", "url": "https://github.com/trinodb/trino/pull/4165#discussion_r444686898", "bodyText": "java.nio.Files.write(path, contensts, UTF_8)", "author": "findepi", "createdAt": "2020-06-24T07:04:48Z", "path": "presto-elasticsearch/src/test/java/io/prestosql/elasticsearch/ElasticsearchServer.java", "diffHunk": "@@ -13,16 +13,42 @@\n  */\n package io.prestosql.elasticsearch;\n \n+import com.google.common.io.Files;\n import com.google.common.net.HostAndPort;\n import org.testcontainers.elasticsearch.ElasticsearchContainer;\n \n+import java.io.File;\n+import java.io.IOException;\n+import java.nio.file.Path;\n+import java.util.Map;\n+\n+import static com.google.common.io.Files.createTempDir;\n+import static java.nio.charset.StandardCharsets.UTF_8;\n+import static org.testcontainers.utility.MountableFile.forHostPath;\n+\n public class ElasticsearchServer\n {\n     private final ElasticsearchContainer container;\n \n-    public ElasticsearchServer(String version)\n+    public ElasticsearchServer(String image, Map<String, String> configuration)\n+            throws IOException\n     {\n-        container = new ElasticsearchContainer(\"docker.elastic.co/elasticsearch/elasticsearch-oss:\" + version);\n+        container = new ElasticsearchContainer(image);\n+\n+        if (!configuration.isEmpty()) {\n+            File tempDir = createTempDir();\n+            tempDir.deleteOnExit();\n+\n+            for (Map.Entry<String, String> entry : configuration.entrySet()) {\n+                String name = entry.getKey();\n+                String contents = entry.getValue();\n+\n+                Path path = tempDir.toPath().resolve(name);\n+                Files.asCharSink(path.toFile(), UTF_8).write(contents);", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDkxNzI4NQ==", "url": "https://github.com/trinodb/trino/pull/4165#discussion_r444917285", "bodyText": "Close:\njava.nio.file.Files.write(path, contents.getBytes(UTF_8));", "author": "martint", "createdAt": "2020-06-24T14:03:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDY4Njg5OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDY4NzU5Ng==", "url": "https://github.com/trinodb/trino/pull/4165#discussion_r444687596", "bodyText": "document why you use 7.0.0 here and 7.8 in pwd test case", "author": "findepi", "createdAt": "2020-06-24T07:06:27Z", "path": "presto-elasticsearch/src/test/java/io/prestosql/elasticsearch/TestElasticsearch7IntegrationSmokeTest.java", "diffHunk": "@@ -20,7 +20,7 @@\n {\n     public TestElasticsearch7IntegrationSmokeTest()\n     {\n-        super(\"7.0.0\");\n+        super(\"elasticsearch:7.0.0\");", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDY4ODM1Mw==", "url": "https://github.com/trinodb/trino/pull/4165#discussion_r444688353", "bodyText": "configuration -> configurationFiles or configurationFileContents", "author": "findepi", "createdAt": "2020-06-24T07:08:21Z", "path": "presto-elasticsearch/src/test/java/io/prestosql/elasticsearch/ElasticsearchServer.java", "diffHunk": "@@ -13,16 +13,42 @@\n  */\n package io.prestosql.elasticsearch;\n \n+import com.google.common.io.Files;\n import com.google.common.net.HostAndPort;\n import org.testcontainers.elasticsearch.ElasticsearchContainer;\n \n+import java.io.File;\n+import java.io.IOException;\n+import java.nio.file.Path;\n+import java.util.Map;\n+\n+import static com.google.common.io.Files.createTempDir;\n+import static java.nio.charset.StandardCharsets.UTF_8;\n+import static org.testcontainers.utility.MountableFile.forHostPath;\n+\n public class ElasticsearchServer\n {\n     private final ElasticsearchContainer container;\n \n-    public ElasticsearchServer(String version)\n+    public ElasticsearchServer(String image, Map<String, String> configuration)", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDY4ODY4Nw==", "url": "https://github.com/trinodb/trino/pull/4165#discussion_r444688687", "bodyText": "can this be more easily searchable, like some_user or some_es_user?", "author": "findepi", "createdAt": "2020-06-24T07:09:06Z", "path": "presto-elasticsearch/src/test/resources/users", "diffHunk": "@@ -0,0 +1 @@\n+user:$2a$10$tbO62EbOfqMezJDBDWlxbuvIleeYeNlw30F5OgWMXzi1R8aXqnVni", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "82659bcbef63d9a438f5f1ffd04e6df8084ae291", "url": "https://github.com/trinodb/trino/commit/82659bcbef63d9a438f5f1ffd04e6df8084ae291", "message": "Add support for user/password auth", "committedDate": "2020-06-24T21:58:38Z", "type": "commit"}, {"oid": "82659bcbef63d9a438f5f1ffd04e6df8084ae291", "url": "https://github.com/trinodb/trino/commit/82659bcbef63d9a438f5f1ffd04e6df8084ae291", "message": "Add support for user/password auth", "committedDate": "2020-06-24T21:58:38Z", "type": "forcePushed"}]}