{"pr_number": 4722, "pr_title": "Pinot Testing cluster", "pr_createdAt": "2020-08-07T05:09:39Z", "pr_url": "https://github.com/trinodb/trino/pull/4722", "timeline": [{"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njg3MTYzNA==", "url": "https://github.com/trinodb/trino/pull/4722#discussion_r466871634", "bodyText": "Maybe you want presto-testing-kafka?", "author": "kokosing", "createdAt": "2020-08-07T07:31:43Z", "path": "presto-testing/pom.xml", "diffHunk": "@@ -92,6 +92,16 @@\n             <artifactId>jackson-annotations</artifactId>\n         </dependency>\n \n+        <dependency>", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njk1MzYzNA==", "url": "https://github.com/trinodb/trino/pull/4722#discussion_r466953634", "bodyText": "Do you mean I should create a separate module?", "author": "elonazoulay", "createdAt": "2020-08-07T10:20:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njg3MTYzNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzAxODM5NQ==", "url": "https://github.com/trinodb/trino/pull/4722#discussion_r467018395", "bodyText": "Yes", "author": "kokosing", "createdAt": "2020-08-07T12:48:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njg3MTYzNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njg3MTkyMw==", "url": "https://github.com/trinodb/trino/pull/4722#discussion_r466871923", "bodyText": "TestingKafka is used by multiple modules for testing.\n\nWhat modules?\nIf you are copying it can you please remove testing kafka from other place and reuse your testing kafka?", "author": "kokosing", "createdAt": "2020-08-07T07:32:25Z", "path": "pom.xml", "diffHunk": "@@ -1114,6 +1114,12 @@\n                 <version>3.6.1</version>", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njk2NDc5Nw==", "url": "https://github.com/trinodb/trino/pull/4722#discussion_r466964797", "bodyText": "That's done in the commit \"Use TestingKafka from presto-testing\". Should I squash this one with the previous 2 commits?", "author": "elonazoulay", "createdAt": "2020-08-07T10:46:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njg3MTkyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzAxODM1OQ==", "url": "https://github.com/trinodb/trino/pull/4722#discussion_r467018359", "bodyText": "Yes, let squash them.", "author": "kokosing", "createdAt": "2020-08-07T12:48:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njg3MTkyMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njg3MjExOQ==", "url": "https://github.com/trinodb/trino/pull/4722#discussion_r466872119", "bodyText": "Please squash this commit with the first one.", "author": "kokosing", "createdAt": "2020-08-07T07:32:51Z", "path": "presto-kafka/src/test/java/io/prestosql/plugin/kafka/util/TestingKafka.java", "diffHunk": "@@ -1,92 +0,0 @@\n-/*", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njg3MjgzMw==", "url": "https://github.com/trinodb/trino/pull/4722#discussion_r466872833", "bodyText": "Is this extension needed for host mapper? If not please use separate commit.", "author": "kokosing", "createdAt": "2020-08-07T07:34:32Z", "path": "presto-pinot/src/main/java/io/prestosql/pinot/PinotConnectorFactory.java", "diffHunk": "@@ -23,12 +25,20 @@\n import org.weakref.jmx.guice.MBeanModule;\n \n import java.util.Map;\n+import java.util.Optional;\n \n import static java.util.Objects.requireNonNull;\n \n public class PinotConnectorFactory\n         implements ConnectorFactory\n {\n+    private final Optional<Module> extension;\n+\n+    public PinotConnectorFactory(Optional<Module> extension)", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njk1NzQ1Mw==", "url": "https://github.com/trinodb/trino/pull/4722#discussion_r466957453", "bodyText": "Yes, it's needed for the hostmapper.", "author": "elonazoulay", "createdAt": "2020-08-07T10:29:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njg3MjgzMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njg3MzMyNA==", "url": "https://github.com/trinodb/trino/pull/4722#discussion_r466873324", "bodyText": "Please squash that commit with Add TestingPinotCluster", "author": "kokosing", "createdAt": "2020-08-07T07:35:37Z", "path": "presto-pinot/src/test/java/io/prestosql/pinot/TestMinimalFunctionality.java", "diffHunk": "@@ -16,31 +16,39 @@\n import com.fasterxml.jackson.annotation.JsonCreator;\n import com.fasterxml.jackson.annotation.JsonProperty;\n import com.google.common.collect.ImmutableList;\n+import com.google.common.collect.ImmutableMap;\n+import io.prestosql.pinot.client.PinotHostMapper;\n import io.prestosql.pinot.util.TestingPinotCluster;\n+import io.prestosql.pinot.util.TestingPinotHostMapper;\n+import io.prestosql.testing.AbstractTestQueryFramework;\n+import io.prestosql.testing.QueryRunner;\n import io.prestosql.testing.kafka.TestingKafka;\n import org.apache.kafka.clients.producer.KafkaProducer;\n import org.apache.kafka.clients.producer.ProducerRecord;\n import org.testng.annotations.AfterClass;\n-import org.testng.annotations.BeforeClass;\n import org.testng.annotations.Test;\n \n import java.time.Instant;\n import java.util.Arrays;\n import java.util.List;\n+import java.util.Map;\n+import java.util.Optional;\n \n+import static com.google.inject.multibindings.OptionalBinder.newOptionalBinder;\n import static io.airlift.testing.Closeables.closeAllRuntimeException;\n import static java.util.Objects.requireNonNull;\n \n @Test(singleThreaded = true)\n public class TestMinimalFunctionality\n+        extends AbstractTestQueryFramework", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": "646abe3bc32476f6697525e7dbd9db1b0e516a50", "url": "https://github.com/trinodb/trino/commit/646abe3bc32476f6697525e7dbd9db1b0e516a50", "message": "Add pinot host mapper interface\n\nPinot returns host names for brokers and servers.\nAllow a mapping between what pinot returns and actual hostnames,\nfor example if pinot is running in docker.", "committedDate": "2020-08-07T10:47:59Z", "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODgyNjE1OQ==", "url": "https://github.com/trinodb/trino/pull/4722#discussion_r468826159", "bodyText": "Unrelated change?", "author": "martint", "createdAt": "2020-08-11T19:51:02Z", "path": "presto-testing-kafka/src/main/java/io/prestosql/testing/kafka/TestingKafka.java", "diffHunk": "@@ -34,7 +34,7 @@\n \n     public TestingKafka()\n     {\n-        container = new KafkaContainer(\"5.4.1\");\n+        container = new KafkaContainer(\"5.4.1\").withNetworkAliases(\"kafka\");", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTI0NjgxMw==", "url": "https://github.com/trinodb/trino/pull/4722#discussion_r469246813", "bodyText": "I had it in a separate commit but squashed it after previous review.\nShould I put it back in a separate commit?", "author": "elonazoulay", "createdAt": "2020-08-12T13:10:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODgyNjE1OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTMyNTA3NQ==", "url": "https://github.com/trinodb/trino/pull/4722#discussion_r469325075", "bodyText": "Yes, since it's a logically independent change, it's better to track it separately.", "author": "martint", "createdAt": "2020-08-12T14:59:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODgyNjE1OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODgyNjU0Mw==", "url": "https://github.com/trinodb/trino/pull/4722#discussion_r468826543", "bodyText": "Why did this move?", "author": "martint", "createdAt": "2020-08-11T19:51:46Z", "path": "presto-kafka/src/test/java/io/prestosql/plugin/kafka/util/TestUtils.java", "diffHunk": "@@ -19,29 +19,20 @@\n import io.prestosql.plugin.kafka.KafkaTopicDescription;\n import io.prestosql.spi.connector.SchemaTableName;\n import io.prestosql.testing.TestingPrestoClient;\n+import io.prestosql.testing.kafka.TestingKafka;\n import org.apache.kafka.clients.producer.KafkaProducer;\n \n import java.io.IOException;\n import java.util.AbstractMap;\n import java.util.Map;\n import java.util.Optional;\n-import java.util.Properties;\n \n import static java.lang.String.format;\n \n public final class TestUtils\n {\n     private TestUtils() {}\n \n-    static Properties toProperties(Map<String, String> map)", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTI0Nzc3Mw==", "url": "https://github.com/trinodb/trino/pull/4722#discussion_r469247773", "bodyText": "This was only used by TestingKafka.", "author": "elonazoulay", "createdAt": "2020-08-12T13:11:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODgyNjU0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTMyNDgyMQ==", "url": "https://github.com/trinodb/trino/pull/4722#discussion_r469324821", "bodyText": "Maybe move it to a separate commit", "author": "martint", "createdAt": "2020-08-12T14:59:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODgyNjU0Mw=="}], "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": "7b826c262feb84429d7dff75bafd0cad3e4ae18a", "url": "https://github.com/trinodb/trino/commit/7b826c262feb84429d7dff75bafd0cad3e4ae18a", "message": "Move TestUtils.toProperties to TestingKafka\n\nThis method is only used in TestingKafka", "committedDate": "2020-08-12T17:56:00Z", "type": "commit"}, {"oid": "eb2b0088222a2320d3734e08919dc83af6443507", "url": "https://github.com/trinodb/trino/commit/eb2b0088222a2320d3734e08919dc83af6443507", "message": "Move TestingKafka to presto-testing-kafka module\n\nTestingKafka can be used by multiple modules.", "committedDate": "2020-08-12T17:56:01Z", "type": "commit"}, {"oid": "944ef5210b1efe1ebb79daae7b94dd202a468f08", "url": "https://github.com/trinodb/trino/commit/944ef5210b1efe1ebb79daae7b94dd202a468f08", "message": "Add network alias for TestingKafka\n\nThis is needed by test containers that access TestingKafka.", "committedDate": "2020-08-12T17:56:02Z", "type": "commit"}, {"oid": "b5bd701e2bd52b589485e58572b70be8d8400125", "url": "https://github.com/trinodb/trino/commit/b5bd701e2bd52b589485e58572b70be8d8400125", "message": "Remove unused ObjectMapper from PinotPageSourceProvider", "committedDate": "2020-08-12T17:56:03Z", "type": "commit"}, {"oid": "be7f75e614683ff588afc5239f0b8017e038640c", "url": "https://github.com/trinodb/trino/commit/be7f75e614683ff588afc5239f0b8017e038640c", "message": "Add pinot host mapper interface\n\nPinot returns host names for brokers and servers.\nAllow a mapping between what pinot returns and actual hostnames,\nfor example if pinot is running in docker.", "committedDate": "2020-08-12T17:56:04Z", "type": "commit"}, {"oid": "21d5121ad158ba0f5fcd77789a7d8ecf77564d10", "url": "https://github.com/trinodb/trino/commit/21d5121ad158ba0f5fcd77789a7d8ecf77564d10", "message": "Add TestingPinotCluster", "committedDate": "2020-08-12T17:56:05Z", "type": "commit"}, {"oid": "21d5121ad158ba0f5fcd77789a7d8ecf77564d10", "url": "https://github.com/trinodb/trino/commit/21d5121ad158ba0f5fcd77789a7d8ecf77564d10", "message": "Add TestingPinotCluster", "committedDate": "2020-08-12T17:56:05Z", "type": "forcePushed"}]}