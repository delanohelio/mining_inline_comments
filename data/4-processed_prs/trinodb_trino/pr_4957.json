{"pr_number": 4957, "pr_title": "Implement JDBC ResultSet.getStatement", "pr_createdAt": "2020-08-24T13:42:42Z", "pr_url": "https://github.com/trinodb/trino/pull/4957", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTY5MTA1Mg==", "url": "https://github.com/trinodb/trino/pull/4957#discussion_r475691052", "bodyText": "let's make it optional", "author": "findepi", "createdAt": "2020-08-24T15:15:08Z", "path": "presto-jdbc/src/main/java/io/prestosql/jdbc/InMemoryPrestoResultSet.java", "diffHunk": "@@ -26,11 +27,18 @@\n {\n     public InMemoryPrestoResultSet(ZoneId sessionTimeZone, List<Column> columns, List<List<Object>> results)\n     {\n-        super(sessionTimeZone, columns, requireNonNull(results, \"results is null\").iterator());\n+        super(sessionTimeZone, columns, requireNonNull(results, \"results is null\").iterator(), null);", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTY5MTgyMg==", "url": "https://github.com/trinodb/trino/pull/4957#discussion_r475691822", "bodyText": "also, i'd suggest to make this the first arg/field", "author": "findepi", "createdAt": "2020-08-24T15:16:16Z", "path": "presto-jdbc/src/main/java/io/prestosql/jdbc/AbstractPrestoResultSet.java", "diffHunk": "@@ -127,8 +127,9 @@\n     private final AtomicReference<List<Object>> row = new AtomicReference<>();\n     private final AtomicBoolean wasNull = new AtomicBoolean();\n     protected final AtomicBoolean closed = new AtomicBoolean();\n+    private final Statement statement;\n \n-    AbstractPrestoResultSet(ZoneId resultTimeZone, List<Column> columns, Iterator<List<Object>> results)\n+    AbstractPrestoResultSet(ZoneId resultTimeZone, List<Column> columns, Iterator<List<Object>> results, Statement statement)", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjMyOTUwMQ==", "url": "https://github.com/trinodb/trino/pull/4957#discussion_r476329501", "bodyText": "The method is implemented, but the context doesn't allow us to provide a Statement object\n(eg some DatabaseMetaData method returning a ResultSet).\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        throw new NotImplementedException(\"ResultSet\", \"getStatement\");\n          \n          \n            \n                        throw new SQLException(\"Statement not available\");", "author": "findepi", "createdAt": "2020-08-25T09:59:01Z", "path": "presto-jdbc/src/main/java/io/prestosql/jdbc/AbstractPrestoResultSet.java", "diffHunk": "@@ -1101,7 +1104,12 @@ public void moveToCurrentRow()\n     public Statement getStatement()\n             throws SQLException\n     {\n-        throw new NotImplementedException(\"ResultSet\", \"getStatement\");\n+        if (statement.isPresent()) {\n+            return statement.get();\n+        }\n+        else {\n+            throw new NotImplementedException(\"ResultSet\", \"getStatement\");", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjMyOTc0MQ==", "url": "https://github.com/trinodb/trino/pull/4957#discussion_r476329741", "bodyText": "else is redundant, since the \"then\" block always returns", "author": "findepi", "createdAt": "2020-08-25T09:59:25Z", "path": "presto-jdbc/src/main/java/io/prestosql/jdbc/AbstractPrestoResultSet.java", "diffHunk": "@@ -1101,7 +1104,12 @@ public void moveToCurrentRow()\n     public Statement getStatement()\n             throws SQLException\n     {\n-        throw new NotImplementedException(\"ResultSet\", \"getStatement\");\n+        if (statement.isPresent()) {\n+            return statement.get();\n+        }\n+        else {", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "8213d0368949b5f1326972070f877d56d804ea45", "url": "https://github.com/trinodb/trino/commit/8213d0368949b5f1326972070f877d56d804ea45", "message": "Implement JDBC ResultSet.getStatement", "committedDate": "2020-08-25T12:59:29Z", "type": "commit"}, {"oid": "8213d0368949b5f1326972070f877d56d804ea45", "url": "https://github.com/trinodb/trino/commit/8213d0368949b5f1326972070f877d56d804ea45", "message": "Implement JDBC ResultSet.getStatement", "committedDate": "2020-08-25T12:59:29Z", "type": "forcePushed"}]}