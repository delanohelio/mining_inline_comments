{"pr_number": 2821, "pr_title": "Minor base JDBC connector improvements", "pr_createdAt": "2020-02-13T09:24:43Z", "pr_url": "https://github.com/trinodb/trino/pull/2821", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODg2OTYyMA==", "url": "https://github.com/trinodb/trino/pull/2821#discussion_r378869620", "bodyText": "In theory the necessity of setting TCCL may depend on the actual module passed here.", "author": "findepi", "createdAt": "2020-02-13T13:49:01Z", "path": "presto-base-jdbc/src/main/java/io/prestosql/plugin/jdbc/JdbcConnectorFactory.java", "diffHunk": "@@ -62,20 +59,18 @@ public Connector create(String catalogName, Map<String, String> requiredConfig,\n     {\n         requireNonNull(requiredConfig, \"requiredConfig is null\");\n \n-        try (ThreadContextClassLoader ignored = new ThreadContextClassLoader(classLoader)) {\n-            Bootstrap app = new Bootstrap(\n-                    binder -> binder.bind(TypeManager.class).toInstance(context.getTypeManager()),\n-                    new JdbcModule(catalogName),\n-                    new CredentialProviderModule(),\n-                    module);\n+        Bootstrap app = new Bootstrap(\n+                binder -> binder.bind(TypeManager.class).toInstance(context.getTypeManager()),\n+                new JdbcModule(catalogName),\n+                new CredentialProviderModule(),\n+                module);", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTEyNTA2MQ==", "url": "https://github.com/trinodb/trino/pull/2821#discussion_r379125061", "bodyText": "Nope, the engine sets this when calling create.", "author": "electrum", "createdAt": "2020-02-13T21:21:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODg2OTYyMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODg3MDU4Nw==", "url": "https://github.com/trinodb/trino/pull/2821#discussion_r378870587", "bodyText": "eagerly validate module is not null", "author": "findepi", "createdAt": "2020-02-13T13:50:41Z", "path": "presto-base-jdbc/src/main/java/io/prestosql/plugin/jdbc/JdbcConnectorFactory.java", "diffHunk": "@@ -33,13 +33,18 @@\n         implements ConnectorFactory\n {\n     private final String name;\n-    private final Module module;\n+    private final JdbcModuleProvider moduleProvider;\n \n     public JdbcConnectorFactory(String name, Module module)\n+    {\n+        this(name, catalogName -> module);", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODg3MDY5Mg==", "url": "https://github.com/trinodb/trino/pull/2821#discussion_r378870692", "bodyText": "Alternatively, we could bind @CatalogName String in guice and let it be injected in other places.", "author": "findepi", "createdAt": "2020-02-13T13:50:51Z", "path": "presto-base-jdbc/src/main/java/io/prestosql/plugin/jdbc/JdbcConnectorFactory.java", "diffHunk": "@@ -73,4 +78,9 @@ public Connector create(String catalogName, Map<String, String> requiredConfig,\n \n         return injector.getInstance(JdbcConnector.class);\n     }\n+\n+    public interface JdbcModuleProvider\n+    {\n+        Module getModule(String catalogName);", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTEyNTY2Mg==", "url": "https://github.com/trinodb/trino/pull/2821#discussion_r379125662", "bodyText": "I considered this but we need it at binding time for JMX exports. Otherwise this would be a nicer approach.", "author": "electrum", "createdAt": "2020-02-13T21:22:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODg3MDY5Mg=="}], "type": "inlineReview"}, {"oid": "6f6aad84e4f1c72cf3f49afad5cd275c2a524ad8", "url": "https://github.com/trinodb/trino/commit/6f6aad84e4f1c72cf3f49afad5cd275c2a524ad8", "message": "Add principal name to JdbcIdentity", "committedDate": "2020-02-14T01:08:04Z", "type": "commit"}, {"oid": "5b1188f7f7f15aa1db21e9edab54c2093f802b1c", "url": "https://github.com/trinodb/trino/commit/5b1188f7f7f15aa1db21e9edab54c2093f802b1c", "message": "Remove unnecessary setting of context class loader", "committedDate": "2020-02-14T01:08:04Z", "type": "commit"}, {"oid": "c0a171dda27934c4b96f0a3cbb7b17ca201dece0", "url": "https://github.com/trinodb/trino/commit/c0a171dda27934c4b96f0a3cbb7b17ca201dece0", "message": "Allow JDBC connector modules to access catalog name", "committedDate": "2020-02-14T01:08:04Z", "type": "commit"}, {"oid": "c0a171dda27934c4b96f0a3cbb7b17ca201dece0", "url": "https://github.com/trinodb/trino/commit/c0a171dda27934c4b96f0a3cbb7b17ca201dece0", "message": "Allow JDBC connector modules to access catalog name", "committedDate": "2020-02-14T01:08:04Z", "type": "forcePushed"}]}