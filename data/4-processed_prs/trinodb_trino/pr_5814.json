{"pr_number": 5814, "pr_title": "Propagate stat calculation failures in tests", "pr_createdAt": "2020-11-04T11:11:12Z", "pr_url": "https://github.com/trinodb/trino/pull/5814", "timeline": [{"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": "7fc535929ff05c2d31b47925053561a0d87f2fc3", "url": "https://github.com/trinodb/trino/commit/7fc535929ff05c2d31b47925053561a0d87f2fc3", "message": "Fix partition key min/max derivation when NaN\n\nPreviously the code was implicitly ignoring NaN values, unless partition\nwith NaN was first on the list.", "committedDate": "2020-11-05T08:11:46Z", "type": "commit"}, {"oid": "843576428bbfb92878ea30ad3e5830e41ed54a58", "url": "https://github.com/trinodb/trino/commit/843576428bbfb92878ea30ad3e5830e41ed54a58", "message": "Install SystemAccessControl in tests\n\nThis allows a session to have a system session property. Without\n`AllowAllSystemAccessControl`, this would fail with:\n\n```\nio.prestosql.spi.PrestoException: Presto server is still initializing\n\tat io.prestosql.security.AccessControlManager$InitializingSystemAccessControl.delegate(AccessControlManager.java:1063)\n\tat io.prestosql.plugin.base.security.ForwardingSystemAccessControl.checkCanSetSystemSessionProperty(ForwardingSystemAccessControl.java:106)\n\tat io.prestosql.security.AccessControlManager.lambda$checkCanSetSystemSessionProperty$63(AccessControlManager.java:735)\n\tat io.prestosql.security.AccessControlManager.systemAuthorizationCheck(AccessControlManager.java:984)\n\tat io.prestosql.security.AccessControlManager.checkCanSetSystemSessionProperty(AccessControlManager.java:735)\n```", "committedDate": "2020-11-05T08:11:46Z", "type": "commit"}, {"oid": "39b04c7e500baffe8de1c03174a0cf82a2933adb", "url": "https://github.com/trinodb/trino/commit/39b04c7e500baffe8de1c03174a0cf82a2933adb", "message": "Propagate stat calculation failures in tests", "committedDate": "2020-11-05T08:11:46Z", "type": "commit"}, {"oid": "39b04c7e500baffe8de1c03174a0cf82a2933adb", "url": "https://github.com/trinodb/trino/commit/39b04c7e500baffe8de1c03174a0cf82a2933adb", "message": "Propagate stat calculation failures in tests", "committedDate": "2020-11-05T08:11:46Z", "type": "forcePushed"}, {"oid": "28014dd2934823419450f6f2adaf4bb5ee83abd2", "url": "https://github.com/trinodb/trino/commit/28014dd2934823419450f6f2adaf4bb5ee83abd2", "message": "empty", "committedDate": "2020-11-05T10:17:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzk0NDU1NQ==", "url": "https://github.com/trinodb/trino/pull/5814#discussion_r517944555", "bodyText": "let's have a new dedicated test, instead of making this one more complicate", "author": "kokosing", "createdAt": "2020-11-05T10:27:13Z", "path": "presto-hive/src/test/java/io/prestosql/plugin/hive/TestHiveIntegrationSmokeTest.java", "diffHunk": "@@ -349,22 +349,44 @@ public void testJoinPartitionedWithMissingPartitionFilter()\n     @Test\n     public void testNaNPartition()\n     {\n+        // Only NaN partition\n         assertUpdate(\"DROP TABLE IF EXISTS test_nan_partition\");\n         assertUpdate(\"CREATE TABLE test_nan_partition(a varchar, d double) WITH (partitioned_by = ARRAY['d'])\");\n+        assertUpdate(\"INSERT INTO test_nan_partition VALUES ('b', nan())\", 1);", "originalCommit": "7fc535929ff05c2d31b47925053561a0d87f2fc3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzk3MDYwMw==", "url": "https://github.com/trinodb/trino/pull/5814#discussion_r517970603", "bodyText": "i thought about this, but i couldn't invent the name for the test method.\nAlso, this is the test which was supposed to test the problem (d068a3f) and indeed it did, but not deterministically (order of partitions on the list mattered). So I am improving the existing test to make it more deterministic.", "author": "findepi", "createdAt": "2020-11-05T11:10:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzk0NDU1NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzk3OTQ2NQ==", "url": "https://github.com/trinodb/trino/pull/5814#discussion_r517979465", "bodyText": "Discussed offline.", "author": "findepi", "createdAt": "2020-11-05T11:26:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzk0NDU1NQ=="}], "type": "inlineReview"}]}