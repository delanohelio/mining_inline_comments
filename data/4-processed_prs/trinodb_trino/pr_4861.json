{"pr_number": 4861, "pr_title": "Document CTAS functionality for transactional Hive tables", "pr_createdAt": "2020-08-17T16:25:39Z", "pr_url": "https://github.com/trinodb/trino/pull/4861", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTYxMzUzMw==", "url": "https://github.com/trinodb/trino/pull/4861#discussion_r471613533", "bodyText": "Continued lines under the list item need to be intended two spaces. Code blocks need to be intended four spaces. So, this code block needs to be intended six spaces in total (four spaces after the two spaces for the list item).", "author": "electrum", "createdAt": "2020-08-17T16:58:29Z", "path": "presto-docs/src/main/sphinx/connector/hive.rst", "diffHunk": "@@ -749,3 +749,14 @@ Hive 3 Related Limitations\n   not correctly read ``timestamp`` values from Parquet, RCBinary, or Avro\n   file formats created by Hive 3.1 or later. When reading from these file formats,\n   Presto returns different results than Hive.\n+* :doc:`/sql/create-table-as` can be used to create transactional tables in ORC format like this::\n+\n+    CREATE TABLE blah", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTYxNDM3OA==", "url": "https://github.com/trinodb/trino/pull/4861#discussion_r471614378", "bodyText": "Remove the SELECT since there are other valid starts to a query such as WITH. Make this\nAS <query>", "author": "electrum", "createdAt": "2020-08-17T16:59:57Z", "path": "presto-docs/src/main/sphinx/connector/hive.rst", "diffHunk": "@@ -749,3 +749,14 @@ Hive 3 Related Limitations\n   not correctly read ``timestamp`` values from Parquet, RCBinary, or Avro\n   file formats created by Hive 3.1 or later. When reading from these file formats,\n   Presto returns different results than Hive.\n+* :doc:`/sql/create-table-as` can be used to create transactional tables in ORC format like this::\n+\n+    CREATE TABLE blah\n+    WITH (\n+        format='ORC',\n+        transactional=true,\n+    )\n+    AS SELECT <some sql query>", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTYxNDUzNQ==", "url": "https://github.com/trinodb/trino/pull/4861#discussion_r471614535", "bodyText": "These need to be indented two spaces to match the list item", "author": "electrum", "createdAt": "2020-08-17T17:00:15Z", "path": "presto-docs/src/main/sphinx/connector/hive.rst", "diffHunk": "@@ -749,3 +749,14 @@ Hive 3 Related Limitations\n   not correctly read ``timestamp`` values from Parquet, RCBinary, or Avro\n   file formats created by Hive 3.1 or later. When reading from these file formats,\n   Presto returns different results than Hive.\n+* :doc:`/sql/create-table-as` can be used to create transactional tables in ORC format like this::\n+\n+    CREATE TABLE blah\n+    WITH (\n+        format='ORC',\n+        transactional=true,\n+    )\n+    AS SELECT <some sql query>\n+\n+Table statistics are currently not gathered during CTAS.", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTYxNTAwOQ==", "url": "https://github.com/trinodb/trino/pull/4861#discussion_r471615009", "bodyText": "Make this\nTo collect statistics, run ``ANALYZE TABLE COMPUTE STATISTICS`` *using Hive* after the table is created.", "author": "electrum", "createdAt": "2020-08-17T17:01:03Z", "path": "presto-docs/src/main/sphinx/connector/hive.rst", "diffHunk": "@@ -749,3 +749,14 @@ Hive 3 Related Limitations\n   not correctly read ``timestamp`` values from Parquet, RCBinary, or Avro\n   file formats created by Hive 3.1 or later. When reading from these file formats,\n   Presto returns different results than Hive.\n+* :doc:`/sql/create-table-as` can be used to create transactional tables in ORC format like this::\n+\n+    CREATE TABLE blah\n+    WITH (\n+        format='ORC',\n+        transactional=true,\n+    )\n+    AS SELECT <some sql query>\n+\n+Table statistics are currently not gathered during CTAS.\n+To collect those ``ANALYZE TABLE COMPUTE STATISTICS`` needs to be issued *on Hive* after table is created.", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTYxNzU3Mg==", "url": "https://github.com/trinodb/trino/pull/4861#discussion_r471617572", "bodyText": "Add newlines between all of the list items for readability (now that we have a list item with blank lines)", "author": "electrum", "createdAt": "2020-08-17T17:04:18Z", "path": "presto-docs/src/main/sphinx/connector/hive.rst", "diffHunk": "@@ -749,3 +749,14 @@ Hive 3 Related Limitations\n   not correctly read ``timestamp`` values from Parquet, RCBinary, or Avro\n   file formats created by Hive 3.1 or later. When reading from these file formats,\n   Presto returns different results than Hive.\n+* :doc:`/sql/create-table-as` can be used to create transactional tables in ORC format like this::", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjI1NjM3Mw==", "url": "https://github.com/trinodb/trino/pull/4861#discussion_r472256373", "bodyText": "nit: blah is not a nice table name.", "author": "losipiuk", "createdAt": "2020-08-18T14:49:48Z", "path": "presto-docs/src/main/sphinx/connector/hive.rst", "diffHunk": "@@ -741,11 +741,25 @@ Hive 3 Related Limitations\n ^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n * For security reasons, the ``sys`` system catalog is not accessible.\n+\n * Hive's ``timestamp with local zone`` data type is not supported.\n   It is possible to read from a table with a column of this type, but the column\n   data is not accessible. Writing to such a table is not supported.\n+\n * Due to Hive issues `HIVE-21002 <https://issues.apache.org/jira/browse/HIVE-21002>`_\n   and `HIVE-22167 <https://issues.apache.org/jira/browse/HIVE-22167>`_, Presto does\n   not correctly read ``timestamp`` values from Parquet, RCBinary, or Avro\n   file formats created by Hive 3.1 or later. When reading from these file formats,\n   Presto returns different results than Hive.\n+\n+* :doc:`/sql/create-table-as` can be used to create transactional tables in ORC format like this::\n+\n+      CREATE TABLE blah", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjI1Nzk5Mg==", "url": "https://github.com/trinodb/trino/pull/4861#discussion_r472257992", "bodyText": "Maybe Note: Presto currently does not support gathering table statistics for Hive transactional tables. To collect statistics, run ``ANALYZE TABLE COMPUTE STATISTICS`` *using Hive* after the table is created.?", "author": "losipiuk", "createdAt": "2020-08-18T14:51:53Z", "path": "presto-docs/src/main/sphinx/connector/hive.rst", "diffHunk": "@@ -741,11 +741,25 @@ Hive 3 Related Limitations\n ^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n * For security reasons, the ``sys`` system catalog is not accessible.\n+\n * Hive's ``timestamp with local zone`` data type is not supported.\n   It is possible to read from a table with a column of this type, but the column\n   data is not accessible. Writing to such a table is not supported.\n+\n * Due to Hive issues `HIVE-21002 <https://issues.apache.org/jira/browse/HIVE-21002>`_\n   and `HIVE-22167 <https://issues.apache.org/jira/browse/HIVE-22167>`_, Presto does\n   not correctly read ``timestamp`` values from Parquet, RCBinary, or Avro\n   file formats created by Hive 3.1 or later. When reading from these file formats,\n   Presto returns different results than Hive.\n+\n+* :doc:`/sql/create-table-as` can be used to create transactional tables in ORC format like this::\n+\n+      CREATE TABLE blah\n+      WITH (\n+          format='ORC',\n+          transactional=true,\n+      )\n+      AS <query>\n+\n+  Table statistics are currently not gathered during CTAS.", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzU5MzU4Ng==", "url": "https://github.com/trinodb/trino/pull/4861#discussion_r473593586", "bodyText": "User actual note syntax or a make it an actual sentence.\nAlso remove \"currently\"", "author": "mosabua", "createdAt": "2020-08-20T05:07:15Z", "path": "presto-docs/src/main/sphinx/connector/hive.rst", "diffHunk": "@@ -741,11 +741,25 @@ Hive 3 Related Limitations\n ^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n * For security reasons, the ``sys`` system catalog is not accessible.\n+\n * Hive's ``timestamp with local zone`` data type is not supported.\n   It is possible to read from a table with a column of this type, but the column\n   data is not accessible. Writing to such a table is not supported.\n+\n * Due to Hive issues `HIVE-21002 <https://issues.apache.org/jira/browse/HIVE-21002>`_\n   and `HIVE-22167 <https://issues.apache.org/jira/browse/HIVE-22167>`_, Presto does\n   not correctly read ``timestamp`` values from Parquet, RCBinary, or Avro\n   file formats created by Hive 3.1 or later. When reading from these file formats,\n   Presto returns different results than Hive.\n+\n+* :doc:`/sql/create-table-as` can be used to create transactional tables in ORC format like this::\n+\n+      CREATE TABLE <name>\n+      WITH (\n+          format='ORC',\n+          transactional=true,\n+      )\n+      AS <query>\n+\n+  Note: Presto currently does not support gathering table statistics for Hive transactional tables.", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzU5NDMwMA==", "url": "https://github.com/trinodb/trino/pull/4861#discussion_r473594300", "bodyText": "You need to use Hive to gather table statistics with ``ANALYZE TABLE COMPUTE STATISTICS`` after table creation.", "author": "mosabua", "createdAt": "2020-08-20T05:08:32Z", "path": "presto-docs/src/main/sphinx/connector/hive.rst", "diffHunk": "@@ -741,11 +741,25 @@ Hive 3 Related Limitations\n ^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n * For security reasons, the ``sys`` system catalog is not accessible.\n+\n * Hive's ``timestamp with local zone`` data type is not supported.\n   It is possible to read from a table with a column of this type, but the column\n   data is not accessible. Writing to such a table is not supported.\n+\n * Due to Hive issues `HIVE-21002 <https://issues.apache.org/jira/browse/HIVE-21002>`_\n   and `HIVE-22167 <https://issues.apache.org/jira/browse/HIVE-22167>`_, Presto does\n   not correctly read ``timestamp`` values from Parquet, RCBinary, or Avro\n   file formats created by Hive 3.1 or later. When reading from these file formats,\n   Presto returns different results than Hive.\n+\n+* :doc:`/sql/create-table-as` can be used to create transactional tables in ORC format like this::\n+\n+      CREATE TABLE <name>\n+      WITH (\n+          format='ORC',\n+          transactional=true,\n+      )\n+      AS <query>\n+\n+  Note: Presto currently does not support gathering table statistics for Hive transactional tables.\n+  To collect statistics, run ``ANALYZE TABLE COMPUTE STATISTICS`` *using Hive* after the table is created.", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "1f9ea20ba96dcb29013c270226d4d57fab183a0b", "url": "https://github.com/trinodb/trino/commit/1f9ea20ba96dcb29013c270226d4d57fab183a0b", "message": "Document CTAS functionality for transactional Hive tables", "committedDate": "2020-08-20T12:46:56Z", "type": "commit"}, {"oid": "1f9ea20ba96dcb29013c270226d4d57fab183a0b", "url": "https://github.com/trinodb/trino/commit/1f9ea20ba96dcb29013c270226d4d57fab183a0b", "message": "Document CTAS functionality for transactional Hive tables", "committedDate": "2020-08-20T12:46:56Z", "type": "forcePushed"}]}