{"pr_number": 3516, "pr_title": "Cleanups in Planner", "pr_createdAt": "2020-04-22T22:24:20Z", "pr_url": "https://github.com/trinodb/trino/pull/3516", "timeline": [{"oid": "48e9c6564bebf44956096907869d041bc7a998f9", "url": "https://github.com/trinodb/trino/commit/48e9c6564bebf44956096907869d041bc7a998f9", "message": "Simplify initialization of TranslationMap", "committedDate": "2020-04-22T20:46:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzM5NzMzNQ==", "url": "https://github.com/trinodb/trino/pull/3516#discussion_r413397335", "bodyText": "Move this to a test under io.prestosql.sql.query", "author": "martint", "createdAt": "2020-04-22T23:19:25Z", "path": "presto-tests/src/test/java/io/prestosql/tests/AbstractTestEngineOnlyQueries.java", "diffHunk": "@@ -2767,6 +2767,14 @@ public void testMultipleOccurrencesOfCorrelatedSymbol()\n                 expected);\n     }\n \n+    @Test\n+    public void testJoinInCorrelatedJoinInput()", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "2ac38987274841a4d16dabe27034496e201ac62f", "url": "https://github.com/trinodb/trino/commit/2ac38987274841a4d16dabe27034496e201ac62f", "message": "Fix CorrelatedJoin planning\n\nBefore this change, planning of the following query failed:\nSELECT * FROM (VALUES 1) t1(a) JOIN (VALUES 2) t2(b) ON a<b, LATERAL (VALUES 3)\n\nThe first Join was planned to output 4 symbols. Two of them referred to\nValues columns: a and b. Other two were a result of preprojecting symbols\nfor join condition.\nThe scope associated with that Join had only two fields.\n\nDuring the planning of the second Join, which is a cross-join with lateral relation,\nall four output symbols of the first Join were used to define field mappings\nof the resulting relation instead of just the two symbols referring to the scope.\nThis caused planning to fail, because Correlated Join's scope had less fields\nthan field mappings.\n\nIt was fixed by changing the method planCorrelatedJoin() to create\nresulting RelationPlan based on sources' output descriptors, not their\noutput symbols.", "committedDate": "2020-04-23T09:59:23Z", "type": "commit"}, {"oid": "2ac38987274841a4d16dabe27034496e201ac62f", "url": "https://github.com/trinodb/trino/commit/2ac38987274841a4d16dabe27034496e201ac62f", "message": "Fix CorrelatedJoin planning\n\nBefore this change, planning of the following query failed:\nSELECT * FROM (VALUES 1) t1(a) JOIN (VALUES 2) t2(b) ON a<b, LATERAL (VALUES 3)\n\nThe first Join was planned to output 4 symbols. Two of them referred to\nValues columns: a and b. Other two were a result of preprojecting symbols\nfor join condition.\nThe scope associated with that Join had only two fields.\n\nDuring the planning of the second Join, which is a cross-join with lateral relation,\nall four output symbols of the first Join were used to define field mappings\nof the resulting relation instead of just the two symbols referring to the scope.\nThis caused planning to fail, because Correlated Join's scope had less fields\nthan field mappings.\n\nIt was fixed by changing the method planCorrelatedJoin() to create\nresulting RelationPlan based on sources' output descriptors, not their\noutput symbols.", "committedDate": "2020-04-23T09:59:23Z", "type": "forcePushed"}]}