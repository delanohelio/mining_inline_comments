{"pr_number": 5392, "pr_title": "Add support for stats collection in Hive for timestamp(p>3)", "pr_createdAt": "2020-10-02T12:10:05Z", "pr_url": "https://github.com/trinodb/trino/pull/5392", "timeline": [{"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODc4NzE0OQ==", "url": "https://github.com/trinodb/trino/pull/5392#discussion_r498787149", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    Session microsecondsTimestamp = Session.builder(getSession())\n          \n          \n            \n                            .setCatalogSessionProperty(catalog, \"timestamp_precision\", \"MICROSECONDS\")\n          \n          \n            \n                            .build();\n          \n          \n            \n                    Session microsecondsTimestamp = withTimestampPrecision(getSession(), HiveTimestampPrecision.MICROSECONDS);", "author": "aalbu", "createdAt": "2020-10-02T12:22:18Z", "path": "presto-hive/src/test/java/io/prestosql/plugin/hive/TestHiveIntegrationSmokeTest.java", "diffHunk": "@@ -6262,6 +6262,65 @@ public void testAnalyzeUnpartitionedTable()\n         assertUpdate(\"DROP TABLE \" + tableName);\n     }\n \n+    @Test\n+    public void testAnalyzeTableTimestampWithPrecision()\n+    {\n+        String catalog = getSession().getCatalog().get();\n+        Session nanosecondsTimestamp = Session.builder(getSession())\n+                // Disable column statistics collection when creating the table\n+                .setCatalogSessionProperty(catalog, \"collect_column_statistics_on_write\", \"false\")\n+                .setCatalogSessionProperty(catalog, \"timestamp_precision\", \"NANOSECONDS\")\n+                .build();\n+\n+        Session microsecondsTimestamp = Session.builder(getSession())\n+                .setCatalogSessionProperty(catalog, \"timestamp_precision\", \"MICROSECONDS\")\n+                .build();", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODgyMzM0NA==", "url": "https://github.com/trinodb/trino/pull/5392#discussion_r498823344", "bodyText": "thanks. I did not notice this helper.", "author": "losipiuk", "createdAt": "2020-10-02T13:32:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODc4NzE0OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODc4ODI0OA==", "url": "https://github.com/trinodb/trino/pull/5392#discussion_r498788248", "bodyText": "Can we have the last argument (12) on a different line?", "author": "aalbu", "createdAt": "2020-10-02T12:24:45Z", "path": "presto-hive/src/test/java/io/prestosql/plugin/hive/TestHiveIntegrationSmokeTest.java", "diffHunk": "@@ -6262,6 +6262,65 @@ public void testAnalyzeUnpartitionedTable()\n         assertUpdate(\"DROP TABLE \" + tableName);\n     }\n \n+    @Test\n+    public void testAnalyzeTableTimestampWithPrecision()\n+    {\n+        String catalog = getSession().getCatalog().get();\n+        Session nanosecondsTimestamp = Session.builder(getSession())\n+                // Disable column statistics collection when creating the table\n+                .setCatalogSessionProperty(catalog, \"collect_column_statistics_on_write\", \"false\")\n+                .setCatalogSessionProperty(catalog, \"timestamp_precision\", \"NANOSECONDS\")\n+                .build();\n+\n+        Session microsecondsTimestamp = Session.builder(getSession())\n+                .setCatalogSessionProperty(catalog, \"timestamp_precision\", \"MICROSECONDS\")\n+                .build();\n+\n+        Session millisecondsTimestamp = getSession();\n+\n+        String tableName = \"test_analyze_timestamp_with_precision\";\n+\n+        assertUpdate(nanosecondsTimestamp,\n+                \"CREATE TABLE \" + tableName + \"(c_timestamp) AS VALUES \" +\n+                        \"TIMESTAMP '1988-04-08 02:03:04.111', \" +\n+                        \"TIMESTAMP '1988-04-08 02:03:04.112', \" +\n+                        \"TIMESTAMP '1988-04-08 02:03:04.112', \" +\n+                        \"TIMESTAMP '1988-04-08 02:03:04.113', \" +\n+                        \"TIMESTAMP '1988-04-08 02:03:04.111111', \" +\n+                        \"TIMESTAMP '1988-04-08 02:03:04.111112', \" +\n+                        \"TIMESTAMP '1988-04-08 02:03:04.111112', \" +\n+                        \"TIMESTAMP '1988-04-08 02:03:04.111113', \" +\n+                        \"TIMESTAMP '1988-04-08 02:03:04.111111111', \" +\n+                        \"TIMESTAMP '1988-04-08 02:03:04.111111112', \" +\n+                        \"TIMESTAMP '1988-04-08 02:03:04.111111112', \" +\n+                        \"TIMESTAMP '1988-04-08 02:03:04.111111113' \", 12);", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODc5NDQ1OQ==", "url": "https://github.com/trinodb/trino/pull/5392#discussion_r498794459", "bodyText": "Should we have a value that rounds up?", "author": "aalbu", "createdAt": "2020-10-02T12:38:02Z", "path": "presto-hive/src/test/java/io/prestosql/plugin/hive/TestHiveIntegrationSmokeTest.java", "diffHunk": "@@ -6262,6 +6262,65 @@ public void testAnalyzeUnpartitionedTable()\n         assertUpdate(\"DROP TABLE \" + tableName);\n     }\n \n+    @Test\n+    public void testAnalyzeTableTimestampWithPrecision()\n+    {\n+        String catalog = getSession().getCatalog().get();\n+        Session nanosecondsTimestamp = Session.builder(getSession())\n+                // Disable column statistics collection when creating the table\n+                .setCatalogSessionProperty(catalog, \"collect_column_statistics_on_write\", \"false\")\n+                .setCatalogSessionProperty(catalog, \"timestamp_precision\", \"NANOSECONDS\")\n+                .build();\n+\n+        Session microsecondsTimestamp = Session.builder(getSession())\n+                .setCatalogSessionProperty(catalog, \"timestamp_precision\", \"MICROSECONDS\")\n+                .build();\n+\n+        Session millisecondsTimestamp = getSession();\n+\n+        String tableName = \"test_analyze_timestamp_with_precision\";\n+\n+        assertUpdate(nanosecondsTimestamp,\n+                \"CREATE TABLE \" + tableName + \"(c_timestamp) AS VALUES \" +\n+                        \"TIMESTAMP '1988-04-08 02:03:04.111', \" +\n+                        \"TIMESTAMP '1988-04-08 02:03:04.112', \" +\n+                        \"TIMESTAMP '1988-04-08 02:03:04.112', \" +\n+                        \"TIMESTAMP '1988-04-08 02:03:04.113', \" +\n+                        \"TIMESTAMP '1988-04-08 02:03:04.111111', \" +\n+                        \"TIMESTAMP '1988-04-08 02:03:04.111112', \" +\n+                        \"TIMESTAMP '1988-04-08 02:03:04.111112', \" +\n+                        \"TIMESTAMP '1988-04-08 02:03:04.111113', \" +\n+                        \"TIMESTAMP '1988-04-08 02:03:04.111111111', \" +\n+                        \"TIMESTAMP '1988-04-08 02:03:04.111111112', \" +\n+                        \"TIMESTAMP '1988-04-08 02:03:04.111111112', \" +\n+                        \"TIMESTAMP '1988-04-08 02:03:04.111111113' \", 12);\n+\n+        assertQuery(\"SHOW STATS FOR \" + tableName,\n+                \"SELECT * FROM VALUES \" +\n+                        \"('c_timestamp', null, null, null, null, null, null), \" +\n+                        \"(null, null, null, null, 12.0, null, null)\");\n+\n+        assertUpdate(nanosecondsTimestamp, \"ANALYZE \" + tableName, 12);\n+        assertQuery(\"SHOW STATS FOR \" + tableName,\n+                \"SELECT * FROM VALUES \" +\n+                        \"('c_timestamp', null, 9.0, 0.0, null, null, null), \" +\n+                        \"(null, null, null, null, 12.0, null, null)\");\n+\n+        assertUpdate(microsecondsTimestamp, \"ANALYZE \" + tableName, 12);\n+        assertQuery(\"SHOW STATS FOR \" + tableName,\n+                \"SELECT * FROM VALUES \" +\n+                        \"('c_timestamp', null, 6.0, 0.0, null, null, null), \" +\n+                        \"(null, null, null, null, 12.0, null, null)\");\n+\n+        assertUpdate(millisecondsTimestamp, \"ANALYZE \" + tableName, 12);\n+        assertQuery(\"SHOW STATS FOR \" + tableName,\n+                \"SELECT * FROM VALUES \" +\n+                        \"('c_timestamp', null, 3.0, 0.0, null, null, null), \" +", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODgyMzM4MQ==", "url": "https://github.com/trinodb/trino/pull/5392#discussion_r498823381", "bodyText": "Added", "author": "losipiuk", "createdAt": "2020-10-02T13:32:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODc5NDQ1OQ=="}], "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTg0OTEwNQ==", "url": "https://github.com/trinodb/trino/pull/5392#discussion_r519849105", "bodyText": "Can you add a test within this commit?", "author": "findepi", "createdAt": "2020-11-09T14:21:49Z", "path": "presto-main/src/main/java/io/prestosql/operator/aggregation/DefaultApproximateCountDistinctAggregation.java", "diffHunk": "@@ -75,7 +76,7 @@ public static void input(\n     public static void input(\n             @OperatorDependency(operator = XX_HASH_64, argumentTypes = \"T\") MethodHandle methodHandle,\n             @AggregationState HyperLogLogState state,\n-            @SqlType(\"T\") Slice value)\n+            @SqlType(\"T\") Object value)", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTg1MDYxMw==", "url": "https://github.com/trinodb/trino/pull/5392#discussion_r519850613", "bodyText": "Do not use . getObjectValue, it's supposed to be used for sending output to the client.\nPlease use .getLong or .getObject, depending on type.isShort", "author": "findepi", "createdAt": "2020-11-09T14:23:58Z", "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/util/Statistics.java", "diffHunk": "@@ -453,9 +454,13 @@ private static OptionalDouble getDoubleValue(ConnectorSession session, Type type\n         return block.isNull(0) ? Optional.empty() : Optional.of(LocalDate.ofEpochDay(((SqlDate) type.getObjectValue(session, block, 0)).getDays()));\n     }\n \n-    private static OptionalLong getTimestampValue(Block block)\n+    private static OptionalLong getTimestampValue(ConnectorSession session, Type type, Block block)\n     {\n-        return block.isNull(0) ? OptionalLong.empty() : OptionalLong.of(floorDiv(block.getLong(0, 0), MICROSECONDS_PER_SECOND));\n+        if (block.isNull(0)) {\n+            return OptionalLong.empty();\n+        }\n+        long epochMicros = ((SqlTimestamp) type.getObjectValue(session, block, 0)).getEpochMicros();", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTkxMTQ0Mw==", "url": "https://github.com/trinodb/trino/pull/5392#discussion_r519911443", "bodyText": "I followed the pattern from method below.\n    private static Optional<BigDecimal> getDecimalValue(ConnectorSession session, Type type, Block block)\n    {\n        return block.isNull(0) ? Optional.empty() : Optional.of(((SqlDecimal) type.getObjectValue(session, block, 0)).toBigDecimal());\n    }\nWhat is the motivation to not use it. It makes the code simpler and the method has well defined semantics, right?", "author": "losipiuk", "createdAt": "2020-11-09T15:44:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTg1MDYxMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTkxNzU5NA==", "url": "https://github.com/trinodb/trino/pull/5392#discussion_r519917594", "bodyText": "Ok, so let me phrase this differently.\nI think we generally avoid \"the object representation\" as I think it's supposed to be for the client procol.\nAlthough i am aware javadoc doesn't say exactly this and we have some usages of the getObjectValue method outside of the communication impl.\nSo even, if it is the way I think it is, it is not documented.", "author": "findepi", "createdAt": "2020-11-09T15:52:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTg1MDYxMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTk4NTkyMw==", "url": "https://github.com/trinodb/trino/pull/5392#discussion_r521985923", "bodyText": "#5934", "author": "findepi", "createdAt": "2020-11-12T10:07:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTg1MDYxMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTg1MTgyMw==", "url": "https://github.com/trinodb/trino/pull/5392#discussion_r519851823", "bodyText": "Here we truncate picos-of-micro, and then truncate micros-of-second.\nThis is correct for \"min\" value, but not for the \"max\"\nAnyway, since the method is unused, please just remove it, not fix.", "author": "findepi", "createdAt": "2020-11-09T14:25:32Z", "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/util/Statistics.java", "diffHunk": "@@ -453,9 +454,13 @@ private static OptionalDouble getDoubleValue(ConnectorSession session, Type type\n         return block.isNull(0) ? Optional.empty() : Optional.of(LocalDate.ofEpochDay(((SqlDate) type.getObjectValue(session, block, 0)).getDays()));\n     }\n \n-    private static OptionalLong getTimestampValue(Block block)\n+    private static OptionalLong getTimestampValue(ConnectorSession session, Type type, Block block)\n     {\n-        return block.isNull(0) ? OptionalLong.empty() : OptionalLong.of(floorDiv(block.getLong(0, 0), MICROSECONDS_PER_SECOND));\n+        if (block.isNull(0)) {\n+            return OptionalLong.empty();\n+        }\n+        long epochMicros = ((SqlTimestamp) type.getObjectValue(session, block, 0)).getEpochMicros();\n+        return OptionalLong.of(floorDiv(epochMicros, MICROSECONDS_PER_SECOND));", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTg1MjU3Ng==", "url": "https://github.com/trinodb/trino/pull/5392#discussion_r519852576", "bodyText": "How do you  know millis is the default?\nMaybe call withTimestampPrecision here too?\nor verify", "author": "findepi", "createdAt": "2020-11-09T14:26:34Z", "path": "presto-hive/src/test/java/io/prestosql/plugin/hive/TestHiveIntegrationSmokeTest.java", "diffHunk": "@@ -6336,6 +6336,64 @@ public void testAnalyzeUnpartitionedTable()\n         assertUpdate(\"DROP TABLE \" + tableName);\n     }\n \n+    @Test\n+    public void testAnalyzeTableTimestampWithPrecision()\n+    {\n+        String catalog = getSession().getCatalog().get();\n+        Session nanosecondsTimestamp = Session.builder(withTimestampPrecision(getSession(), HiveTimestampPrecision.NANOSECONDS))\n+                // Disable column statistics collection when creating the table\n+                .setCatalogSessionProperty(catalog, \"collect_column_statistics_on_write\", \"false\")\n+                .build();\n+        Session microsecondsTimestamp = withTimestampPrecision(getSession(), HiveTimestampPrecision.MICROSECONDS);\n+        Session millisecondsTimestamp = getSession();", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTg1MzM4OA==", "url": "https://github.com/trinodb/trino/pull/5392#discussion_r519853388", "bodyText": "It would be cleaner to drop the stats before running ANALYZE the second time, or create a new table", "author": "findepi", "createdAt": "2020-11-09T14:27:34Z", "path": "presto-hive/src/test/java/io/prestosql/plugin/hive/TestHiveIntegrationSmokeTest.java", "diffHunk": "@@ -6336,6 +6336,64 @@ public void testAnalyzeUnpartitionedTable()\n         assertUpdate(\"DROP TABLE \" + tableName);\n     }\n \n+    @Test\n+    public void testAnalyzeTableTimestampWithPrecision()\n+    {\n+        String catalog = getSession().getCatalog().get();\n+        Session nanosecondsTimestamp = Session.builder(withTimestampPrecision(getSession(), HiveTimestampPrecision.NANOSECONDS))\n+                // Disable column statistics collection when creating the table\n+                .setCatalogSessionProperty(catalog, \"collect_column_statistics_on_write\", \"false\")\n+                .build();\n+        Session microsecondsTimestamp = withTimestampPrecision(getSession(), HiveTimestampPrecision.MICROSECONDS);\n+        Session millisecondsTimestamp = getSession();\n+\n+        String tableName = \"test_analyze_timestamp_with_precision\";\n+\n+        try {\n+            assertUpdate(nanosecondsTimestamp,\n+                    \"CREATE TABLE \" + tableName + \"(c_timestamp) AS VALUES \" +\n+                            \"TIMESTAMP '1988-04-08 02:03:04.111', \" +\n+                            \"TIMESTAMP '1988-04-08 02:03:04.115', \" +\n+                            \"TIMESTAMP '1988-04-08 02:03:04.115', \" +\n+                            \"TIMESTAMP '1988-04-08 02:03:04.119', \" +\n+                            \"TIMESTAMP '1988-04-08 02:03:04.111111', \" +\n+                            \"TIMESTAMP '1988-04-08 02:03:04.111115', \" +\n+                            \"TIMESTAMP '1988-04-08 02:03:04.111115', \" +\n+                            \"TIMESTAMP '1988-04-08 02:03:04.111999', \" +\n+                            \"TIMESTAMP '1988-04-08 02:03:04.111111111', \" +\n+                            \"TIMESTAMP '1988-04-08 02:03:04.111111115', \" +\n+                            \"TIMESTAMP '1988-04-08 02:03:04.111111115', \" +\n+                            \"TIMESTAMP '1988-04-08 02:03:04.111111999' \",\n+                    12);\n+\n+            assertQuery(\"SHOW STATS FOR \" + tableName,\n+                    \"SELECT * FROM VALUES \" +\n+                            \"('c_timestamp', null, null, null, null, null, null), \" +\n+                            \"(null, null, null, null, 12.0, null, null)\");\n+\n+            assertUpdate(nanosecondsTimestamp, \"ANALYZE \" + tableName, 12);\n+            assertQuery(\"SHOW STATS FOR \" + tableName,\n+                    \"SELECT * FROM VALUES \" +\n+                            \"('c_timestamp', null, 9.0, 0.0, null, null, null), \" +\n+                            \"(null, null, null, null, 12.0, null, null)\");\n+\n+            assertUpdate(microsecondsTimestamp, \"ANALYZE \" + tableName, 12);", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTkxNzc2NQ==", "url": "https://github.com/trinodb/trino/pull/5392#discussion_r519917765", "bodyText": "I added dropping", "author": "losipiuk", "createdAt": "2020-11-09T15:53:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTg1MzM4OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTg1MzYwNw==", "url": "https://github.com/trinodb/trino/pull/5392#discussion_r519853607", "bodyText": "move first arg to its own line too", "author": "findepi", "createdAt": "2020-11-09T14:27:51Z", "path": "presto-hive/src/test/java/io/prestosql/plugin/hive/TestHiveIntegrationSmokeTest.java", "diffHunk": "@@ -6336,6 +6336,64 @@ public void testAnalyzeUnpartitionedTable()\n         assertUpdate(\"DROP TABLE \" + tableName);\n     }\n \n+    @Test\n+    public void testAnalyzeTableTimestampWithPrecision()\n+    {\n+        String catalog = getSession().getCatalog().get();\n+        Session nanosecondsTimestamp = Session.builder(withTimestampPrecision(getSession(), HiveTimestampPrecision.NANOSECONDS))\n+                // Disable column statistics collection when creating the table\n+                .setCatalogSessionProperty(catalog, \"collect_column_statistics_on_write\", \"false\")\n+                .build();\n+        Session microsecondsTimestamp = withTimestampPrecision(getSession(), HiveTimestampPrecision.MICROSECONDS);\n+        Session millisecondsTimestamp = getSession();\n+\n+        String tableName = \"test_analyze_timestamp_with_precision\";\n+\n+        try {\n+            assertUpdate(nanosecondsTimestamp,", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTg1NDA4Nw==", "url": "https://github.com/trinodb/trino/pull/5392#discussion_r519854087", "bodyText": "squash into prev commit?", "author": "findepi", "createdAt": "2020-11-09T14:28:32Z", "path": "presto-hive/src/test/java/io/prestosql/plugin/hive/TestHiveIntegrationSmokeTest.java", "diffHunk": "@@ -5750,6 +5750,40 @@ public void testCollectColumnStatisticsOnCreateTable()\n         assertUpdate(\"DROP TABLE \" + tableName);\n     }\n \n+    @Test\n+    public void testCollectStatisticsOnCreateTableTimestampWithPrecision()", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTkyMjIzMw==", "url": "https://github.com/trinodb/trino/pull/5392#discussion_r519922233", "bodyText": "Technically it would be cleaner to remove this in a separate commit", "author": "findepi", "createdAt": "2020-11-09T15:58:17Z", "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/util/Statistics.java", "diffHunk": "@@ -453,11 +454,6 @@ private static OptionalDouble getDoubleValue(ConnectorSession session, Type type\n         return block.isNull(0) ? Optional.empty() : Optional.of(LocalDate.ofEpochDay(((SqlDate) type.getObjectValue(session, block, 0)).getDays()));\n     }\n \n-    private static OptionalLong getTimestampValue(Block block)", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAyMjQwMw==", "url": "https://github.com/trinodb/trino/pull/5392#discussion_r520022403", "bodyText": "You are right. This should be done together with \"drop min/max...\"", "author": "losipiuk", "createdAt": "2020-11-09T18:21:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTkyMjIzMw=="}], "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": "3571e9538341d58e2523937e66bd11a5020a290f", "url": "https://github.com/trinodb/trino/commit/3571e9538341d58e2523937e66bd11a5020a290f", "message": "Remove unused method", "committedDate": "2020-11-10T09:37:57Z", "type": "commit"}, {"oid": "eed43d206f7a8c9104ab72db0aac39fdc2a8d4d7", "url": "https://github.com/trinodb/trino/commit/eed43d206f7a8c9104ab72db0aac39fdc2a8d4d7", "message": "Make DefaultApproximateCountDistinctAggregation universal\n\nWithout the fix default approx_distinct did not work with high precision\nTIME/TIMESTAMP types which use object representation of values.", "committedDate": "2020-11-10T09:37:58Z", "type": "commit"}, {"oid": "97328e8d9e7a8008e24b15d2bdf60a29dcaa0b33", "url": "https://github.com/trinodb/trino/commit/97328e8d9e7a8008e24b15d2bdf60a29dcaa0b33", "message": "Collect statistics in Hive for columns using timestamp(p>3) type", "committedDate": "2020-11-10T09:37:58Z", "type": "commit"}, {"oid": "97328e8d9e7a8008e24b15d2bdf60a29dcaa0b33", "url": "https://github.com/trinodb/trino/commit/97328e8d9e7a8008e24b15d2bdf60a29dcaa0b33", "message": "Collect statistics in Hive for columns using timestamp(p>3) type", "committedDate": "2020-11-10T09:37:58Z", "type": "forcePushed"}]}