{"pr_number": 2648, "pr_title": "Wait for running queries issued during grace period to finish", "pr_createdAt": "2020-01-28T13:03:48Z", "pr_url": "https://github.com/trinodb/trino/pull/2648", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjYyMjQyOA==", "url": "https://github.com/trinodb/trino/pull/2648#discussion_r372622428", "bodyText": "We need to wait at least once.... actually, I maybe we should wait first, and then shutdown once all tasks exit.", "author": "dain", "createdAt": "2020-01-29T20:50:12Z", "path": "presto-main/src/main/java/io/prestosql/server/GracefulShutdownHandler.java", "diffHunk": "@@ -109,10 +109,10 @@ public synchronized void requestShutdown()\n                 }\n \n                 activeTasks = getActiveTasks();\n-            }\n \n-            // wait for another grace period for all task states to be observed by the coordinator\n-            sleepUninterruptibly(gracePeriod.toMillis(), MILLISECONDS);\n+                // wait for another grace period for all task states and shutting down state to be observed by the coordinator\n+                sleepUninterruptibly(gracePeriod.toMillis(), MILLISECONDS);", "originalCommit": "c17718831d08edf891ba0c45e82258bb32a54111", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDY4NzUxNw==", "url": "https://github.com/trinodb/trino/pull/2648#discussion_r374687517", "bodyText": "done", "author": "sopel39", "createdAt": "2020-02-04T14:04:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjYyMjQyOA=="}], "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": "d19bc9a655e85ec483ef245ac8d74a6128dc6792", "url": "https://github.com/trinodb/trino/commit/d19bc9a655e85ec483ef245ac8d74a6128dc6792", "message": "Wait for running queries issued during grace period to finish", "committedDate": "2020-02-20T11:28:40Z", "type": "commit"}, {"oid": "d19bc9a655e85ec483ef245ac8d74a6128dc6792", "url": "https://github.com/trinodb/trino/commit/d19bc9a655e85ec483ef245ac8d74a6128dc6792", "message": "Wait for running queries issued during grace period to finish", "committedDate": "2020-02-20T11:28:40Z", "type": "forcePushed"}]}