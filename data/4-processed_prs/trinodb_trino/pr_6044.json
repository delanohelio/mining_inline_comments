{"pr_number": 6044, "pr_title": "Add documentation for subnet based topology", "pr_createdAt": "2020-11-22T05:05:51Z", "pr_url": "https://github.com/trinodb/trino/pull/6044", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODk5MzY3Nw==", "url": "https://github.com/trinodb/trino/pull/6044#discussion_r528993677", "bodyText": "Maybe make this a list", "author": "electrum", "createdAt": "2020-11-23T21:02:35Z", "path": "presto-docs/src/main/sphinx/admin/properties-node-scheduler.rst", "diffHunk": "@@ -76,12 +76,22 @@ For example, setting ``region,rack,machine`` means a network location contains t\n ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n * **Type:** ``string``\n-* **Allowed values:** ``flat``, ``file``\n+* **Allowed values:** ``flat``, ``file``, ``subnet``\n * **Default value:** ``flat``\n \n-Sets the network topology type. To use this option, ``node-scheduler.policy`` must be set to\n-``topology``. ``flat`` has only one segment, with one value for each machine.\n-``file`` loads the topology from a file as described below.\n+Sets the network topology type. To use this option, ``node-scheduler.policy``\n+must be set to ``topology``.\n+\n+``flat`` : the topology has only one segment, with one value for each machine.", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODk5NTk0Ng==", "url": "https://github.com/trinodb/trino/pull/6044#discussion_r528995946", "bodyText": "This is fine, but we could simplify it a bit if we add new sections. Then we don't need to mention properties here, or mention the type in the properties descriptions below.\nNetwork topology\n----------------\n\n...\n\n``file`` network topology\n-------------------------\n\n...\n\n``subnet`` network topology\n---------------------------\n\n...", "author": "electrum", "createdAt": "2020-11-23T21:07:24Z", "path": "presto-docs/src/main/sphinx/admin/properties-node-scheduler.rst", "diffHunk": "@@ -76,12 +76,22 @@ For example, setting ``region,rack,machine`` means a network location contains t\n ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n * **Type:** ``string``\n-* **Allowed values:** ``flat``, ``file``\n+* **Allowed values:** ``flat``, ``file``, ``subnet``\n * **Default value:** ``flat``\n \n-Sets the network topology type. To use this option, ``node-scheduler.policy`` must be set to\n-``topology``. ``flat`` has only one segment, with one value for each machine.\n-``file`` loads the topology from a file as described below.\n+Sets the network topology type. To use this option, ``node-scheduler.policy``\n+must be set to ``topology``.\n+\n+``flat`` : the topology has only one segment, with one value for each machine.\n+\n+``file``: the topology is loaded from a file using", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTAzMTYyOQ==", "url": "https://github.com/trinodb/trino/pull/6044#discussion_r529031629", "bodyText": "If we do that we have to make sure to use the correct level underline for the titles.. probably \"\"\"\"\"\"\"", "author": "mosabua", "createdAt": "2020-11-23T22:17:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODk5NTk0Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTEyNjc3MQ==", "url": "https://github.com/trinodb/trino/pull/6044#discussion_r529126771", "bodyText": "Thanks @electrum, I changed it so that titles use ^^^^^ and properties under them use \"\"\"\". It looks good to me, @mosabua wdyt?", "author": "phd3", "createdAt": "2020-11-24T01:59:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODk5NTk0Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODk5NjIyOQ==", "url": "https://github.com/trinodb/trino/pull/6044#discussion_r528996229", "bodyText": "Remove \"expected\" word", "author": "electrum", "createdAt": "2020-11-23T21:08:02Z", "path": "presto-docs/src/main/sphinx/admin/properties-node-scheduler.rst", "diffHunk": "@@ -108,3 +118,28 @@ network location, separated by whitespace. Network location must begin with a le\n \n Controls how often the network topology file is reloaded.  To use this option,\n ``node-scheduler.network-topology.type`` must be set to ``file``.\n+\n+``node-scheduler.network-topology.subnet.ip-address-protocol``\n+^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+* **Type:** ``string``\n+* **Allowed values:** ``IPv4``, ``IPv6``\n+* **Default value:** ``IPv4``\n+\n+Sets the expected IP address protocol to be used for computing subnet based", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODk5NjQ1MQ==", "url": "https://github.com/trinodb/trino/pull/6044#discussion_r528996451", "bodyText": "Remove \"expects\"\n\nA comma-separated list of ...", "author": "electrum", "createdAt": "2020-11-23T21:08:33Z", "path": "presto-docs/src/main/sphinx/admin/properties-node-scheduler.rst", "diffHunk": "@@ -108,3 +118,28 @@ network location, separated by whitespace. Network location must begin with a le\n \n Controls how often the network topology file is reloaded.  To use this option,\n ``node-scheduler.network-topology.type`` must be set to ``file``.\n+\n+``node-scheduler.network-topology.subnet.ip-address-protocol``\n+^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+* **Type:** ``string``\n+* **Allowed values:** ``IPv4``, ``IPv6``\n+* **Default value:** ``IPv4``\n+\n+Sets the expected IP address protocol to be used for computing subnet based\n+topology.  To use this option, ``node-scheduler.network-topology.type`` must\n+be set to ``subnet``.\n+\n+``node-scheduler.network-topology.subnet.cidr-prefix-lengths``\n+^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+Expects a comma-separated list of integers defining CIDR prefix lengths for", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODk5NjYyOA==", "url": "https://github.com/trinodb/trino/pull/6044#discussion_r528996628", "bodyText": "Capitalize IP", "author": "electrum", "createdAt": "2020-11-23T21:08:56Z", "path": "presto-docs/src/main/sphinx/admin/properties-node-scheduler.rst", "diffHunk": "@@ -108,3 +118,28 @@ network location, separated by whitespace. Network location must begin with a le\n \n Controls how often the network topology file is reloaded.  To use this option,\n ``node-scheduler.network-topology.type`` must be set to ``file``.\n+\n+``node-scheduler.network-topology.subnet.ip-address-protocol``\n+^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+* **Type:** ``string``\n+* **Allowed values:** ``IPv4``, ``IPv6``\n+* **Default value:** ``IPv4``\n+\n+Sets the expected IP address protocol to be used for computing subnet based\n+topology.  To use this option, ``node-scheduler.network-topology.type`` must\n+be set to ``subnet``.\n+\n+``node-scheduler.network-topology.subnet.cidr-prefix-lengths``\n+^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+Expects a comma-separated list of integers defining CIDR prefix lengths for\n+subnet masks. The prefix lengths must be in increasing order. The maximum prefix\n+length values for IPv4 and IPv6 protocols are 32 and 128 respectively. To use\n+this option, ``node-scheduler.network-topology.type`` must be set to ``subnet``.\n+\n+For example, the value ``24,25,27`` for this property with IPv4 protocol means\n+that masks applied on the ip address to compute location segments would be", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTAzMjI5Mw==", "url": "https://github.com/trinodb/trino/pull/6044#discussion_r529032293", "bodyText": "\"are\" instead of \"would be\"", "author": "mosabua", "createdAt": "2020-11-23T22:18:34Z", "path": "presto-docs/src/main/sphinx/admin/properties-node-scheduler.rst", "diffHunk": "@@ -108,3 +118,28 @@ network location, separated by whitespace. Network location must begin with a le\n \n Controls how often the network topology file is reloaded.  To use this option,\n ``node-scheduler.network-topology.type`` must be set to ``file``.\n+\n+``node-scheduler.network-topology.subnet.ip-address-protocol``\n+^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+* **Type:** ``string``\n+* **Allowed values:** ``IPv4``, ``IPv6``\n+* **Default value:** ``IPv4``\n+\n+Sets the expected IP address protocol to be used for computing subnet based\n+topology.  To use this option, ``node-scheduler.network-topology.type`` must\n+be set to ``subnet``.\n+\n+``node-scheduler.network-topology.subnet.cidr-prefix-lengths``\n+^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+Expects a comma-separated list of integers defining CIDR prefix lengths for\n+subnet masks. The prefix lengths must be in increasing order. The maximum prefix\n+length values for IPv4 and IPv6 protocols are 32 and 128 respectively. To use\n+this option, ``node-scheduler.network-topology.type`` must be set to ``subnet``.\n+\n+For example, the value ``24,25,27`` for this property with IPv4 protocol means\n+that masks applied on the ip address to compute location segments would be\n+``255.255.255.0``, ``255.255.255.192`` and ``255.255.255.224``. So the segments\n+created for an address ``192.168.0.172`` would be ``[192.168.0.0, 192.168.0.128,", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTAzMjQ0Ng==", "url": "https://github.com/trinodb/trino/pull/6044#discussion_r529032446", "bodyText": "described in the following sections.", "author": "mosabua", "createdAt": "2020-11-23T22:18:55Z", "path": "presto-docs/src/main/sphinx/admin/properties-node-scheduler.rst", "diffHunk": "@@ -76,12 +76,22 @@ For example, setting ``region,rack,machine`` means a network location contains t\n ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n * **Type:** ``string``\n-* **Allowed values:** ``flat``, ``file``\n+* **Allowed values:** ``flat``, ``file``, ``subnet``\n * **Default value:** ``flat``\n \n-Sets the network topology type. To use this option, ``node-scheduler.policy`` must be set to\n-``topology``. ``flat`` has only one segment, with one value for each machine.\n-``file`` loads the topology from a file as described below.\n+Sets the network topology type. To use this option, ``node-scheduler.policy``\n+must be set to ``topology``.\n+\n+``flat`` : the topology has only one segment, with one value for each machine.\n+\n+``file``: the topology is loaded from a file using\n+``node-scheduler.network-topology.file`` and\n+``node-scheduler.network-topology.refresh-period`` properties described below.\n+\n+``subnet``: the topology is derived based on subnet configuration provided\n+through properties ``node-scheduler.network-topology.subnet.cidr-prefix-lengths``\n+and ``node-scheduler.network-topology.subnet.ip-address-protocol`` described\n+below.", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTAzMzIzNQ==", "url": "https://github.com/trinodb/trino/pull/6044#discussion_r529033235", "bodyText": "also .. from a file using the ...", "author": "mosabua", "createdAt": "2020-11-23T22:20:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTAzMjQ0Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTExMTU4OQ==", "url": "https://github.com/trinodb/trino/pull/6044#discussion_r529111589", "bodyText": "\"from a file\" doesn't seem appropriate here as we expect these configurations to be in config.properties. did you mean adding a \"the\" for the sentence in  file section?", "author": "phd3", "createdAt": "2020-11-24T01:36:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTAzMjQ0Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTk0MzA5Mg==", "url": "https://github.com/trinodb/trino/pull/6044#discussion_r529943092", "bodyText": "yeah .. sorry .. it was above this section", "author": "mosabua", "createdAt": "2020-11-24T22:29:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTAzMjQ0Ng=="}], "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTc5MDc4OA==", "url": "https://github.com/trinodb/trino/pull/6044#discussion_r529790788", "bodyText": "This makes the section header have the same \"level\" as the properties above. Instead, add a new header at the top\nSplits\n------\n\nLeave the properties with the ^^^ header, and use --- for the other headers:\nNetwork topology\n----------------\n\nThis will keep everything consistent", "author": "electrum", "createdAt": "2020-11-24T18:28:00Z", "path": "presto-docs/src/main/sphinx/admin/properties-node-scheduler.rst", "diffHunk": "@@ -63,8 +63,11 @@ distribution across all hosts. ``topology`` tries to schedule splits according t\n the topology distance between nodes and splits. It is recommended to use ``uniform``\n for clusters where distributed storage runs on the same nodes as Presto workers.\n \n+Network topology\n+^^^^^^^^^^^^^^^^", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": "9a6ff8eafc83cf388478fd96c1cc2989b6b7f7b6", "url": "https://github.com/trinodb/trino/commit/9a6ff8eafc83cf388478fd96c1cc2989b6b7f7b6", "message": "Add documentation for subnet based topology", "committedDate": "2020-11-24T22:13:40Z", "type": "commit"}, {"oid": "9a6ff8eafc83cf388478fd96c1cc2989b6b7f7b6", "url": "https://github.com/trinodb/trino/commit/9a6ff8eafc83cf388478fd96c1cc2989b6b7f7b6", "message": "Add documentation for subnet based topology", "committedDate": "2020-11-24T22:13:40Z", "type": "forcePushed"}]}