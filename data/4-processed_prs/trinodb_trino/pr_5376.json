{"pr_number": 5376, "pr_title": "Rename ParquetWriterConfig properties from hive.parquet to parquet", "pr_createdAt": "2020-10-01T14:13:35Z", "pr_url": "https://github.com/trinodb/trino/pull/5376", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODI3ODU4NA==", "url": "https://github.com/trinodb/trino/pull/5376#discussion_r498278584", "bodyText": "For convenience, here's where the comment thread on the commit is.", "author": "jirassimok", "createdAt": "2020-10-01T14:15:45Z", "path": "presto-hive/src/test/java/io/prestosql/plugin/hive/parquet/TestParquetWriterConfig.java", "diffHunk": "@@ -36,14 +36,28 @@ public void testDefaults()\n                 .setPageSize(DataSize.ofBytes(ParquetWriter.DEFAULT_PAGE_SIZE)));\n     }\n \n+    @Test\n+    public void testLegacyProperties()\n+    {\n+        assertDeprecatedEquivalence(\n+                ParquetWriterConfig.class,\n+                Map.of(\n+                        \"parquet.optimized-writer.enabled\", \"true\",\n+                        \"parquet.writer.block-size\", \"2PB\",\n+                        \"parquet.writer.page-size\", \"3PB\"),\n+                Map.of(\n+                        \"hive.parquet.optimized-writer.enabled\", \"true\",\n+                        \"hive.parquet.writer.block-size\", \"2PB\",\n+                        \"hive.parquet.writer.page-size\", \"3PB\"));\n+    }\n+\n     @Test\n     public void testExplicitPropertyMappings()\n     {\n-        Map<String, String> properties = new ImmutableMap.Builder<String, String>()\n-                .put(\"hive.parquet.optimized-writer.enabled\", \"true\")\n-                .put(\"hive.parquet.writer.block-size\", \"234MB\")\n-                .put(\"hive.parquet.writer.page-size\", \"11MB\")\n-                .build();\n+        Map<String, String> properties = Map.of(\n+                \"parquet.optimized-writer.enabled\", \"true\",\n+                \"parquet.writer.block-size\", \"234MB\",\n+                \"parquet.writer.page-size\", \"11MB\");", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTA1NDg2MA==", "url": "https://github.com/trinodb/trino/pull/5376#discussion_r501054860", "bodyText": "instead of adding @LegacyConfig you can bind the config as configBinder(binder).bindConfig(ParquetWriterConfig.class, \"hive\") in Hive", "author": "findepi", "createdAt": "2020-10-07T14:23:43Z", "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/parquet/ParquetWriterConfig.java", "diffHunk": "@@ -31,7 +32,8 @@ public DataSize getBlockSize()\n         return blockSize;\n     }\n \n-    @Config(\"hive.parquet.writer.block-size\")\n+    @Config(\"parquet.writer.block-size\")\n+    @LegacyConfig(\"hive.parquet.writer.block-size\")", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTA1NzA5NA==", "url": "https://github.com/trinodb/trino/pull/5376#discussion_r501057094", "bodyText": "Oh, I see. But won't that break any configurations using the current property name for Iceberg?", "author": "jirassimok", "createdAt": "2020-10-07T14:26:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTA1NDg2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTYxOTQ0Mg==", "url": "https://github.com/trinodb/trino/pull/5376#discussion_r501619442", "bodyText": "I think it will and i don't think we can avoid it. I understand this is what @electrum was after in #5376 (review)\nStill, the connector was officially added a month ago, so I hope this is not a big problem.", "author": "findepi", "createdAt": "2020-10-08T10:37:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTA1NDg2MA=="}], "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTcyNjg2NQ==", "url": "https://github.com/trinodb/trino/pull/5376#discussion_r501726865", "bodyText": "Should I make the same change (drop @LegacyConfig and use bindConfig with \"hive\" in HiveModule instead of) to ParquetReaderConfig? Right now, the usage of the reader and writer properteis is inconsistent, as seen here.\nBut ParquetReaderConfig has been using @LegacyConfig for nearly a year, since 5ab85b7.", "author": "jirassimok", "createdAt": "2020-10-08T13:37:31Z", "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/HiveModule.java", "diffHunk": "@@ -119,7 +119,7 @@ public void configure(Binder binder)\n         fileWriterFactoryBinder.addBinding().to(RcFileFileWriterFactory.class).in(Scopes.SINGLETON);\n \n         configBinder(binder).bindConfig(ParquetReaderConfig.class);\n-        configBinder(binder).bindConfig(ParquetWriterConfig.class);\n+        configBinder(binder).bindConfig(ParquetWriterConfig.class, \"hive\");", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTc3NDI2Ng==", "url": "https://github.com/trinodb/trino/pull/5376#discussion_r501774266", "bodyText": "i guess this is a question is to @electrum (per #5376 (review))\nor to @martint (per 5ab85b7)", "author": "findepi", "createdAt": "2020-10-08T14:38:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTcyNjg2NQ=="}], "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": "3d0c1d93eab2dc55f859440d06c9bb7e93b446bf", "url": "https://github.com/trinodb/trino/commit/3d0c1d93eab2dc55f859440d06c9bb7e93b446bf", "message": "Rename ParquetWriterConfig properties from hive.parquet to parquet", "committedDate": "2020-10-15T17:04:10Z", "type": "commit"}, {"oid": "3d0c1d93eab2dc55f859440d06c9bb7e93b446bf", "url": "https://github.com/trinodb/trino/commit/3d0c1d93eab2dc55f859440d06c9bb7e93b446bf", "message": "Rename ParquetWriterConfig properties from hive.parquet to parquet", "committedDate": "2020-10-15T17:04:10Z", "type": "forcePushed"}]}