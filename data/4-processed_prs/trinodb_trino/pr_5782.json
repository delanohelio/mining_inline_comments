{"pr_number": 5782, "pr_title": "Remove leftover directories during rpm uninstall", "pr_createdAt": "2020-11-02T16:48:54Z", "pr_url": "https://github.com/trinodb/trino/pull/5782", "timeline": [{"oid": "aafd74867bc299f2a146737d937af0679793f262", "url": "https://github.com/trinodb/trino/commit/aafd74867bc299f2a146737d937af0679793f262", "message": "Remove leftover directories during rpm uninstall\n\nNow that the Presto lib directories\nare modified outside of rpm install (we create symlinks in\n/usr/lib/presto/lib and plugin location), a rpm uninstall\nleaves these empty directories behind if not explicitly\ncleaned up in \"postremove\" step.", "committedDate": "2020-11-02T16:47:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjUyNDc4Mg==", "url": "https://github.com/trinodb/trino/pull/5782#discussion_r516524782", "bodyText": "RPM default behaviour is not to remove directories if user tampered with them. We could verify if we have only symlinks here, but I am not sure if it is not an overkill.", "author": "kokosing", "createdAt": "2020-11-03T09:26:19Z", "path": "presto-server-rpm/src/main/rpm/postremove", "diffHunk": "@@ -10,6 +10,10 @@ then\n     # rpm -e wont remove it, because this directory may later contain files not\n     # deployed by the rpm\n     rm -rf /var/lib/presto\n+    # The RPM instead of linking to /usr/lib/presto/ as a directory attribute\n+    # now links to all the individual jar files in /usr/lib/presto/lib/ and\n+    # /usr/lib/presto/plugin/. So remove the parent dir manually during uninstall\n+    rm -rf /usr/lib/presto", "originalCommit": "aafd74867bc299f2a146737d937af0679793f262", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}