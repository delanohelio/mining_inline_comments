{"pr_number": 3404, "pr_title": "Add check to ensure server tar.gz and RPM do not go above 1GB", "pr_createdAt": "2020-04-10T09:18:27Z", "pr_url": "https://github.com/trinodb/trino/pull/3404", "timeline": [{"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjgwODA2OA==", "url": "https://github.com/trinodb/trino/pull/3404#discussion_r406808068", "bodyText": "<!-- see https://github.com/prestosql/presto/issues/3401 for explanation -->\n\n(same below)", "author": "findepi", "createdAt": "2020-04-10T15:26:31Z", "path": "presto-server-rpm/pom.xml", "diffHunk": "@@ -230,6 +230,30 @@\n                     </packages>\n                 </configuration>\n             </plugin>\n+            <plugin>\n+                <groupId>org.apache.maven.plugins</groupId>\n+                <artifactId>maven-enforcer-plugin</artifactId>\n+                <executions>\n+                    <execution>\n+                        <id>enforce-file-size</id>\n+                        <phase>verify</phase>\n+                        <goals>\n+                            <goal>enforce</goal>\n+                        </goals>\n+                        <configuration>\n+                            <rules>\n+                                <requireFilesSize>\n+                                    <maxsize>1073741824</maxsize>", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODIxNzYyNQ==", "url": "https://github.com/trinodb/trino/pull/3404#discussion_r408217625", "bodyText": "eg if you lower this number to 800M, does the build fail?\n\nYes it does fail", "author": "Praveen2112", "createdAt": "2020-04-14T15:14:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjgwODA2OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQ5NTA0Nw==", "url": "https://github.com/trinodb/trino/pull/3404#discussion_r409495047", "bodyText": "per above, please add the issue link in the comment\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                                <maxsize>1073741824</maxsize>\n          \n          \n            \n                                                <!-- see https://github.com/prestosql/presto/issues/3401 for explanation -->\n          \n          \n            \n                                                <maxsize>1073741824</maxsize>", "author": "findepi", "createdAt": "2020-04-16T11:51:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjgwODA2OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTAwMDM1Mg==", "url": "https://github.com/trinodb/trino/pull/3404#discussion_r411000352", "bodyText": "I'd rather have the explanation inline. It's a simple explanation and doesn't require linking to an issue. Having things self contained when possible is best.", "author": "electrum", "createdAt": "2020-04-19T21:55:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjgwODA2OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTAwMDUzNQ==", "url": "https://github.com/trinodb/trino/pull/3404#discussion_r411000535", "bodyText": "We should probably use 1073741823 since it's not clear if 1GB is at or above the limit.", "author": "electrum", "createdAt": "2020-04-19T21:56:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjgwODA2OA=="}], "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQ5NDQ5Mw==", "url": "https://github.com/trinodb/trino/pull/3404#discussion_r409494493", "bodyText": "nit: whitespace after <exclude>", "author": "findepi", "createdAt": "2020-04-16T11:50:21Z", "path": "presto-server/pom.xml", "diffHunk": "@@ -24,4 +23,48 @@\n         <main-class>io.prestosql.server.PrestoServer</main-class>\n         <process-name>${project.artifactId}</process-name>\n     </properties>\n+\n+    <build>\n+        <plugins>\n+            <plugin>\n+                <groupId>org.apache.maven.plugins</groupId>\n+                <artifactId>maven-enforcer-plugin</artifactId>\n+                <executions>\n+                    <execution>\n+                        <id>default</id>\n+                        <phase>verify</phase>\n+                        <goals>\n+                            <goal>enforce</goal>\n+                        </goals>\n+                        <configuration>\n+                            <rules>\n+                                <requireFilesSize>\n+                                    <maxsize>1073741824</maxsize>\n+                                    <files>\n+                                        <file>${project.build.directory}/${project.artifactId}-${project.version}.tar.gz</file>\n+                                    </files>\n+                                </requireFilesSize>\n+                                <requireUpperBoundDeps>\n+                                    <excludes combine.children=\"append\">\n+                                        <exclude>org.apache.lucene:lucene-core</exclude>\n+                                        <exclude> org.codehaus.mojo:animal-sniffer-annotations</exclude>\n+                                        <exclude> net.sf.jopt-simple:jopt-simple</exclude>", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQ5NDcyNw==", "url": "https://github.com/trinodb/trino/pull/3404#discussion_r409494727", "bodyText": "will the check fail if this file does not exist?", "author": "findepi", "createdAt": "2020-04-16T11:50:47Z", "path": "presto-server/pom.xml", "diffHunk": "@@ -24,4 +23,48 @@\n         <main-class>io.prestosql.server.PrestoServer</main-class>\n         <process-name>${project.artifactId}</process-name>\n     </properties>\n+\n+    <build>\n+        <plugins>\n+            <plugin>\n+                <groupId>org.apache.maven.plugins</groupId>\n+                <artifactId>maven-enforcer-plugin</artifactId>\n+                <executions>\n+                    <execution>\n+                        <id>default</id>\n+                        <phase>verify</phase>\n+                        <goals>\n+                            <goal>enforce</goal>\n+                        </goals>\n+                        <configuration>\n+                            <rules>\n+                                <requireFilesSize>\n+                                    <maxsize>1073741824</maxsize>\n+                                    <files>\n+                                        <file>${project.build.directory}/${project.artifactId}-${project.version}.tar.gz</file>", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTUyNjA1MA==", "url": "https://github.com/trinodb/trino/pull/3404#discussion_r409526050", "bodyText": "yes.", "author": "Praveen2112", "createdAt": "2020-04-16T12:45:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQ5NDcyNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQ5NTIyOA==", "url": "https://github.com/trinodb/trino/pull/3404#discussion_r409495228", "bodyText": "This section requires @electrum eyes.", "author": "findepi", "createdAt": "2020-04-16T11:51:49Z", "path": "presto-server/pom.xml", "diffHunk": "@@ -24,4 +23,48 @@\n         <main-class>io.prestosql.server.PrestoServer</main-class>\n         <process-name>${project.artifactId}</process-name>\n     </properties>\n+\n+    <build>\n+        <plugins>\n+            <plugin>\n+                <groupId>org.apache.maven.plugins</groupId>\n+                <artifactId>maven-enforcer-plugin</artifactId>\n+                <executions>\n+                    <execution>\n+                        <id>default</id>\n+                        <phase>verify</phase>\n+                        <goals>\n+                            <goal>enforce</goal>\n+                        </goals>\n+                        <configuration>\n+                            <rules>\n+                                <requireFilesSize>\n+                                    <maxsize>1073741824</maxsize>\n+                                    <files>\n+                                        <file>${project.build.directory}/${project.artifactId}-${project.version}.tar.gz</file>\n+                                    </files>\n+                                </requireFilesSize>\n+                                <requireUpperBoundDeps>", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDk5OTYzNg==", "url": "https://github.com/trinodb/trino/pull/3404#discussion_r410999636", "bodyText": "Let's change this to\n<!-- Maven Central has a 1GB limit -->", "author": "electrum", "createdAt": "2020-04-19T21:52:16Z", "path": "presto-server/pom.xml", "diffHunk": "@@ -24,4 +24,41 @@\n         <main-class>io.prestosql.server.PrestoServer</main-class>\n         <process-name>${project.artifactId}</process-name>\n     </properties>\n+\n+    <profiles>\n+        <profile>\n+            <id>ci</id>\n+            <build>\n+                <pluginManagement>\n+                    <plugins>\n+                        <plugin>\n+                            <groupId>org.apache.maven.plugins</groupId>\n+                            <artifactId>maven-enforcer-plugin</artifactId>\n+                            <executions>\n+                                <execution>\n+                                    <id>enforce-file-size</id>\n+                                    <phase>verify</phase>\n+                                    <goals>\n+                                        <goal>enforce</goal>\n+                                    </goals>\n+                                    <configuration>\n+                                        <skip>false</skip>\n+                                        <rules>\n+                                            <requireFilesSize>\n+                                                <!-- see https://github.com/prestosql/presto/issues/3401 for explanation -->", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDk5OTY0MA==", "url": "https://github.com/trinodb/trino/pull/3404#discussion_r410999640", "bodyText": "We should always enabled this, not just for CI builds.", "author": "electrum", "createdAt": "2020-04-19T21:52:17Z", "path": "presto-server/pom.xml", "diffHunk": "@@ -24,4 +24,41 @@\n         <main-class>io.prestosql.server.PrestoServer</main-class>\n         <process-name>${project.artifactId}</process-name>\n     </properties>\n+\n+    <profiles>\n+        <profile>\n+            <id>ci</id>", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTAwMDA1Mw==", "url": "https://github.com/trinodb/trino/pull/3404#discussion_r411000053", "bodyText": "Is this needed in case air.check.fail-enforcer is set? In that case, perhaps we should respect it?", "author": "electrum", "createdAt": "2020-04-19T21:54:23Z", "path": "presto-server/pom.xml", "diffHunk": "@@ -24,4 +24,41 @@\n         <main-class>io.prestosql.server.PrestoServer</main-class>\n         <process-name>${project.artifactId}</process-name>\n     </properties>\n+\n+    <profiles>\n+        <profile>\n+            <id>ci</id>\n+            <build>\n+                <pluginManagement>\n+                    <plugins>\n+                        <plugin>\n+                            <groupId>org.apache.maven.plugins</groupId>\n+                            <artifactId>maven-enforcer-plugin</artifactId>\n+                            <executions>\n+                                <execution>\n+                                    <id>enforce-file-size</id>\n+                                    <phase>verify</phase>\n+                                    <goals>\n+                                        <goal>enforce</goal>\n+                                    </goals>\n+                                    <configuration>\n+                                        <skip>false</skip>", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTAwMDA4NQ==", "url": "https://github.com/trinodb/trino/pull/3404#discussion_r411000085", "bodyText": "<!-- Maven Central has a 1GB limit -->", "author": "electrum", "createdAt": "2020-04-19T21:54:40Z", "path": "presto-server-rpm/pom.xml", "diffHunk": "@@ -230,6 +230,31 @@\n                     </packages>\n                 </configuration>\n             </plugin>\n+            <plugin>\n+                <groupId>org.apache.maven.plugins</groupId>\n+                <artifactId>maven-enforcer-plugin</artifactId>\n+                <executions>\n+                    <execution>\n+                        <id>enforce-file-size</id>\n+                        <phase>verify</phase>\n+                        <goals>\n+                            <goal>enforce</goal>\n+                        </goals>\n+                        <configuration>\n+                            <rules>\n+                                <requireFilesSize>\n+                                    <!-- see https://github.com/prestosql/presto/issues/3401 for explanation -->", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": "6e765dc44fb2730aad6b974e9122c912320672be", "url": "https://github.com/trinodb/trino/commit/6e765dc44fb2730aad6b974e9122c912320672be", "message": "Add check to ensure server tar.gz and RPM do not go above 1GB", "committedDate": "2020-04-23T04:09:04Z", "type": "commit"}, {"oid": "6e765dc44fb2730aad6b974e9122c912320672be", "url": "https://github.com/trinodb/trino/commit/6e765dc44fb2730aad6b974e9122c912320672be", "message": "Add check to ensure server tar.gz and RPM do not go above 1GB", "committedDate": "2020-04-23T04:09:04Z", "type": "forcePushed"}]}