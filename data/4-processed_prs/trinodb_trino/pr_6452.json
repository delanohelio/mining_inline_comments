{"pr_number": 6452, "pr_title": "Support LZO-compressed Sequencefile table", "pr_createdAt": "2020-12-28T12:26:23Z", "pr_url": "https://github.com/trinodb/trino/pull/6452", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTQ4MzAyMw==", "url": "https://github.com/trinodb/trino/pull/6452#discussion_r549483023", "bodyText": "Should we just provide those classes in trino-hive-apache as shims that delegate to Airlift implementations instead?", "author": "losipiuk", "createdAt": "2020-12-28T20:50:33Z", "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/util/ConfigurationUtils.java", "diffHunk": "@@ -64,7 +64,24 @@ public static JobConf toJobConf(Configuration conf)\n         if (conf instanceof JobConf) {\n             return (JobConf) conf;\n         }\n-        return new JobConf(conf);\n+        return new JobConf(conf)\n+        {\n+            @Override\n+            public Class<?> getClassByNameOrNull(String name)\n+            {\n+                Class<?> clazz = super.getClassByNameOrNull(name);\n+                if (name != null && clazz == null) {\n+                    // fallback\n+                    switch (name) {\n+                        case \"com.hadoop.compression.lzo.LzoCodec\":", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTUxOTY1MQ==", "url": "https://github.com/trinodb/trino/pull/6452#discussion_r549519651", "bodyText": "That would cause classpath conflicts for anyone adding the compression codecs to the plugin classpath.\n@electrum do you have an opinion?", "author": "findepi", "createdAt": "2020-12-28T23:42:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTQ4MzAyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTkyODM0NQ==", "url": "https://github.com/trinodb/trino/pull/6452#discussion_r551928345", "bodyText": "conflicts for anyone adding the compression codecs to the plugin classpath.\n\nWe usually do not support hacking, don't we?\n\nwe would need to have some transition period,\n\nDoes it mean we encourage users to place jars manually somewhere?", "author": "kokosing", "createdAt": "2021-01-05T13:23:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTQ4MzAyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjAxNjc2NA==", "url": "https://github.com/trinodb/trino/pull/6452#discussion_r552016764", "bodyText": "Does it mean we encourage users to place jars manually somewhere?\n\ni do not. but was trying to be empathetic if they do", "author": "findepi", "createdAt": "2021-01-05T15:47:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTQ4MzAyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjAzMTk4NQ==", "url": "https://github.com/trinodb/trino/pull/6452#discussion_r552031985", "bodyText": "I agree, while this is clever, shims would be cleaner. I\u2019m not concerned with breaking anyone who added additional JARs. This will be better for them anyway as they won\u2019t need to do it anymore.", "author": "electrum", "createdAt": "2021-01-05T16:10:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTQ4MzAyMw=="}], "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTk5NDc5Ng==", "url": "https://github.com/trinodb/trino/pull/6452#discussion_r555994796", "bodyText": "trinodb/trino-hive-apache#23", "author": "findepi", "createdAt": "2021-01-12T18:43:51Z", "path": "plugin/trino-hive/src/main/java/com/hadoop/compression/lzo/LzoCodec.java", "diffHunk": "@@ -0,0 +1,20 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.hadoop.compression.lzo;\n+\n+//  Certain file formats store codec class name within file header section\n+//  (e.g. sequence file) and provide no clean way for providing custom codec\n+//  factory.\n+public class LzoCodec", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": "aba18ceecc05f7a069eecfdb57a5b428b70ed4cf", "url": "https://github.com/trinodb/trino/commit/aba18ceecc05f7a069eecfdb57a5b428b70ed4cf", "message": "Remove unused enum option", "committedDate": "2021-01-14T07:27:49Z", "type": "commit"}, {"oid": "e676702eb2a9672fabce42f2e36c8093819c75cf", "url": "https://github.com/trinodb/trino/commit/e676702eb2a9672fabce42f2e36c8093819c75cf", "message": "Remove unused test dependencies", "committedDate": "2021-01-14T07:27:49Z", "type": "commit"}, {"oid": "b4880ad93970d7084b0f49765955c33e63a01e3f", "url": "https://github.com/trinodb/trino/commit/b4880ad93970d7084b0f49765955c33e63a01e3f", "message": "Support LZO-compressed Sequencefile table", "committedDate": "2021-01-14T07:27:49Z", "type": "commit"}, {"oid": "b4880ad93970d7084b0f49765955c33e63a01e3f", "url": "https://github.com/trinodb/trino/commit/b4880ad93970d7084b0f49765955c33e63a01e3f", "message": "Support LZO-compressed Sequencefile table", "committedDate": "2021-01-14T07:27:49Z", "type": "forcePushed"}]}