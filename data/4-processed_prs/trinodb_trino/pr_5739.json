{"pr_number": 5739, "pr_title": "Simplify HivePageSource bucket filtering", "pr_createdAt": "2020-10-29T16:24:59Z", "pr_url": "https://github.com/trinodb/trino/pull/5739", "timeline": [{"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDU4MzgyNA==", "url": "https://github.com/trinodb/trino/pull/5739#discussion_r514583824", "bodyText": "That's a bug fix. Please make it into a separate commit.\nIs it possible to test? Are we having similar problem somewhere else?", "author": "findepi", "createdAt": "2020-10-29T21:39:44Z", "path": "presto-main/src/main/java/io/prestosql/testing/MaterializedResult.java", "diffHunk": "@@ -397,7 +397,7 @@ public static MaterializedResult materializeSourceDataStream(ConnectorSession se\n         while (!pageSource.isFinished()) {\n             Page outputPage = pageSource.getNextPage();\n             if (outputPage == null) {\n-                break;\n+                continue;", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA3NzQ0Nw==", "url": "https://github.com/trinodb/trino/pull/5739#discussion_r515077447", "bodyText": "Moved to separate commit. Unsure if the issue was a problem anywhere else before but I suspect not since tests passed before this change and still pass afterwards.", "author": "pettyjamesm", "createdAt": "2020-10-30T12:57:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDU4MzgyNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDU4NTY3OA==", "url": "https://github.com/trinodb/trino/pull/5739#discussion_r514585678", "bodyText": "kept -> retained", "author": "findepi", "createdAt": "2020-10-29T21:43:57Z", "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/HivePageSource.java", "diffHunk": "@@ -631,7 +626,14 @@ public IntArrayList computeEligibleRowIds(Page page)\n                     ids.add(position);\n                 }\n             }\n-            return ids;\n+            int keptRowCount = ids.size();", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDU4NTkwOA==", "url": "https://github.com/trinodb/trino/pull/5739#discussion_r514585908", "bodyText": "i think the comments are redundant, but up to you", "author": "findepi", "createdAt": "2020-10-29T21:44:24Z", "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/HivePageSource.java", "diffHunk": "@@ -631,7 +626,14 @@ public IntArrayList computeEligibleRowIds(Page page)\n                     ids.add(position);\n                 }\n             }\n-            return ids;\n+            int keptRowCount = ids.size();\n+            if (keptRowCount == 0) {\n+                return null; // Empty page after filtering\n+            }\n+            if (keptRowCount == page.getPositionCount()) {\n+                return page; // Unchanged after filtering", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA3NzU2Nw==", "url": "https://github.com/trinodb/trino/pull/5739#discussion_r515077567", "bodyText": "Removed.", "author": "pettyjamesm", "createdAt": "2020-10-30T12:57:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDU4NTkwOA=="}], "type": "inlineReview"}, {"oid": "7f9ce5e58d572d59ea29179945c65999374fa7fa", "url": "https://github.com/trinodb/trino/commit/7f9ce5e58d572d59ea29179945c65999374fa7fa", "message": "Fix MaterializedResult PageSource handling bug", "committedDate": "2020-10-30T12:54:26Z", "type": "commit"}, {"oid": "2b8a1aa9928eadca25f493930354ecb1b3de232c", "url": "https://github.com/trinodb/trino/commit/2b8a1aa9928eadca25f493930354ecb1b3de232c", "message": "Simplify HivePageSource bucket filtering\n\nAdds an early return path for when all rows or no rows are filtered\nas inelligible as part of bucket adaptation in HivePageSource", "committedDate": "2020-10-30T12:55:40Z", "type": "commit"}, {"oid": "2b8a1aa9928eadca25f493930354ecb1b3de232c", "url": "https://github.com/trinodb/trino/commit/2b8a1aa9928eadca25f493930354ecb1b3de232c", "message": "Simplify HivePageSource bucket filtering\n\nAdds an early return path for when all rows or no rows are filtered\nas inelligible as part of bucket adaptation in HivePageSource", "committedDate": "2020-10-30T12:55:40Z", "type": "forcePushed"}]}