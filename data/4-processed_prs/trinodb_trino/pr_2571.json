{"pr_number": 2571, "pr_title": "Allow coordinator hostname to contain underscores", "pr_createdAt": "2020-01-22T01:13:53Z", "pr_url": "https://github.com/trinodb/trino/pull/2571", "timeline": [{"oid": "4bc967bc3270a357206f1abc6d1d537ad05ae6b2", "url": "https://github.com/trinodb/trino/commit/4bc967bc3270a357206f1abc6d1d537ad05ae6b2", "message": "Allow coordinator hostname to contain underscores\n\nHttpUriBuilder uses the host from the URI, which is not set for URIs with\nunderscores. See https://bugs.openjdk.java.net/browse/JDK-8019345", "committedDate": "2020-01-22T01:09:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQzNzEzMA==", "url": "https://github.com/trinodb/trino/pull/2571#discussion_r369437130", "bodyText": "Should we blacklist this method (eg using modernizer)?", "author": "findepi", "createdAt": "2020-01-22T09:02:39Z", "path": "presto-main/src/main/java/io/prestosql/dispatcher/QueuedStatementResource.java", "diffHunk": "@@ -67,7 +68,6 @@\n import static com.google.common.util.concurrent.MoreExecutors.directExecutor;\n import static io.airlift.concurrent.MoreFutures.addTimeout;\n import static io.airlift.concurrent.Threads.threadsNamed;\n-import static io.airlift.http.client.HttpUriBuilder.uriBuilderFrom;", "originalCommit": "4bc967bc3270a357206f1abc6d1d537ad05ae6b2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQzODAzMw==", "url": "https://github.com/trinodb/trino/pull/2571#discussion_r369438033", "bodyText": "Note that apparently there are more places like this.\nAlso, we could have a test for this -- you can ask docker for a specific hostname", "author": "findepi", "createdAt": "2020-01-22T09:04:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQzNzEzMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTY5OTE2MA==", "url": "https://github.com/trinodb/trino/pull/2571#discussion_r369699160", "bodyText": "I think we should update it to fail if passed a URL without a host.\nIs there an existing test we could update to use a different host name? We could have one with underscore and dashes.", "author": "electrum", "createdAt": "2020-01-22T17:28:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQzNzEzMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTc1NDUzOA==", "url": "https://github.com/trinodb/trino/pull/2571#discussion_r369754538", "bodyText": "You can take TestServer and override Host header.\nif you want the real hostname to have an underscrore, you need docker.\nIn docker (compose) (or PT Launcher), hostname = container name, so existing envs don't have an underscore and cannot be changed to have one. You'd need a new one.", "author": "findepi", "createdAt": "2020-01-22T19:21:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQzNzEzMA=="}], "type": "inlineReview"}]}