{"pr_number": 2966, "pr_title": "Elasticsearch name clash: omit conflicting keys.", "pr_createdAt": "2020-02-28T13:06:33Z", "pr_url": "https://github.com/trinodb/trino/pull/2966", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTg4ODgzNA==", "url": "https://github.com/trinodb/trino/pull/2966#discussion_r385888834", "bodyText": "This will make the chosen local sensitive to what the JVM is configured to use. Let's use Locale.ENGLISH like we do everywhere else.\nAlso, storing it in a field is unnecessary, so just inline it where it's used.", "author": "martint", "createdAt": "2020-02-28T19:47:20Z", "path": "presto-elasticsearch/src/main/java/io/prestosql/elasticsearch/ElasticsearchMetadata.java", "diffHunk": "@@ -69,6 +71,8 @@\n     private final ElasticsearchClient client;\n     private final String schemaName;\n \n+    private final Locale locale = Locale.getDefault();", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTkwNjkwOA==", "url": "https://github.com/trinodb/trino/pull/2966#discussion_r385906908", "bodyText": "Makes sense, I missed it, ENGLISH is used even in the same file :)", "author": "msosnicki", "createdAt": "2020-02-28T20:27:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTg4ODgzNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTg4ODg2NQ==", "url": "https://github.com/trinodb/trino/pull/2966#discussion_r385888865", "bodyText": "Let's format it as follows:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    Map<String, Long> counts = metadata.getSchema().getFields().stream()\n          \n          \n            \n                            .collect(Collectors.groupingBy(f -> f.getName().toLowerCase(locale), Collectors.counting()));\n          \n          \n            \n                    Map<String, Long> counts = metadata.getSchema()\n          \n          \n            \n                            .getFields().stream()\n          \n          \n            \n                            .collect(Collectors.groupingBy(field -> field.getName().toLowerCase(locale), Collectors.counting()));", "author": "martint", "createdAt": "2020-02-28T19:47:24Z", "path": "presto-elasticsearch/src/main/java/io/prestosql/elasticsearch/ElasticsearchMetadata.java", "diffHunk": "@@ -129,9 +133,12 @@ private ConnectorTableMetadata getTableMetadata(String schemaName, String tableN\n         result.add(BuiltinColumns.SOURCE.getMetadata());\n         result.add(BuiltinColumns.SCORE.getMetadata());\n \n+        Map<String, Long> counts = metadata.getSchema().getFields().stream()\n+                .collect(Collectors.groupingBy(f -> f.getName().toLowerCase(locale), Collectors.counting()));", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "68e7117f77b8845058fcafde2ecc8d33b927e415", "url": "https://github.com/trinodb/trino/commit/68e7117f77b8845058fcafde2ecc8d33b927e415", "message": "#2965 Omit case-insensitive duplicate fields in Elasticsearch", "committedDate": "2020-02-28T20:23:09Z", "type": "commit"}, {"oid": "68e7117f77b8845058fcafde2ecc8d33b927e415", "url": "https://github.com/trinodb/trino/commit/68e7117f77b8845058fcafde2ecc8d33b927e415", "message": "#2965 Omit case-insensitive duplicate fields in Elasticsearch", "committedDate": "2020-02-28T20:23:09Z", "type": "forcePushed"}]}