{"pr_number": 3814, "pr_title": "Use varchar for Elasticsearch passthrough query result", "pr_createdAt": "2020-05-22T04:43:18Z", "pr_url": "https://github.com/trinodb/trino/pull/3814", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTEwNTU5Mw==", "url": "https://github.com/trinodb/trino/pull/3814#discussion_r429105593", "bodyText": "\"result\" is appearing multiple times. Please either extract contant.\nOr move definition of PASSTHROUGH_QUERY_RESULT_COLUMN_METADATA above PASSTHROUGH_QUERY_COLUMNS.\nAnd the use PASSTHROUGH_QUERY_RESULT_COLUMN_METADATA.getName() in definition of PASSTHROUGH_QUERY_COLUMNS.", "author": "losipiuk", "createdAt": "2020-05-22T08:11:45Z", "path": "presto-elasticsearch/src/main/java/io/prestosql/elasticsearch/ElasticsearchMetadata.java", "diffHunk": "@@ -80,8 +80,17 @@\n     private static final ObjectMapper JSON_PARSER = new ObjectMapperProvider().get();\n \n     private static final String PASSTHROUGH_QUERY_SUFFIX = \"$query\";\n-    private final Map<String, ColumnHandle> queryTableColumns;\n-    private final ColumnMetadata queryResultColumnMetadata;\n+\n+    private static final Map<String, ColumnHandle> PASSTHROUGH_QUERY_COLUMNS = ImmutableMap.of(\n+            \"result\",", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "342b133262d215b8dbca045c289a1e8d0787fdcd", "url": "https://github.com/trinodb/trino/commit/342b133262d215b8dbca045c289a1e8d0787fdcd", "message": "Use varchar for Elasticsearch passthrough query result\n\nPresto's JSON type imposes additional constraints that are not\ndesirable for this use case: JSON values must be equatable and\norderable. This requires parsing and re-organizing the document\nto canonicalize field ordering.\n\nUsing VARCHAR will also play better with the SQL 2016 JSON features,\nwhich operate on binary or string data directly.", "committedDate": "2020-05-22T14:16:21Z", "type": "commit"}, {"oid": "342b133262d215b8dbca045c289a1e8d0787fdcd", "url": "https://github.com/trinodb/trino/commit/342b133262d215b8dbca045c289a1e8d0787fdcd", "message": "Use varchar for Elasticsearch passthrough query result\n\nPresto's JSON type imposes additional constraints that are not\ndesirable for this use case: JSON values must be equatable and\norderable. This requires parsing and re-organizing the document\nto canonicalize field ordering.\n\nUsing VARCHAR will also play better with the SQL 2016 JSON features,\nwhich operate on binary or string data directly.", "committedDate": "2020-05-22T14:16:21Z", "type": "forcePushed"}]}