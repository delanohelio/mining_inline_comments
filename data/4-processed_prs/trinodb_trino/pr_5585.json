{"pr_number": 5585, "pr_title": "Add tests for filter by partitions in thrift hive metastore", "pr_createdAt": "2020-10-18T09:58:22Z", "pr_url": "https://github.com/trinodb/trino/pull/5585", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzU5OTY0OA==", "url": "https://github.com/trinodb/trino/pull/5585#discussion_r507599648", "bodyText": "would it be possible to add test for it to prevent future regressions? Take a look at io.prestosql.plugin.hive.metastore.cache.TestCachingHiveMetastore", "author": "sopel39", "createdAt": "2020-10-19T09:23:19Z", "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/metastore/MetastoreUtil.java", "diffHunk": "@@ -437,7 +437,7 @@ else if (type instanceof TinyintType\n         for (HiveColumnHandle partitionKey : partitionKeys) {\n             String name = partitionKey.getName();\n             Domain domain = effectivePredicate.getDomains().get().get(partitionKey);\n-            if (domain != null && domain.isNullableSingleValue()) {", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODY1NTAzNQ==", "url": "https://github.com/trinodb/trino/pull/5585#discussion_r508655035", "bodyText": "All tests in io.prestosql.plugin.hive.metastore.cache.TestCachingHiveMetastore call getPartitionNamesByFilter with   partitionKeysFilter=TupleDomain.all()\nI didn't find a way to create an expected TupleDomain of a desired partition filter.", "author": "guyco33", "createdAt": "2020-10-20T16:07:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzU5OTY0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTExODY2MQ==", "url": "https://github.com/trinodb/trino/pull/5585#discussion_r509118661", "bodyText": "How would a desired partition filter look like?\n(would example here https://github.com/prestosql/presto/blob/8b7ce40f84fb0c38818709800fec537cb398ce52/presto-jmx/src/test/java/io/prestosql/plugin/jmx/TestJmxTableHandle.java#L41 be helpful?)", "author": "findepi", "createdAt": "2020-10-21T09:12:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzU5OTY0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDAzNzI3MQ==", "url": "https://github.com/trinodb/trino/pull/5585#discussion_r510037271", "bodyText": "To test MetastoreUtil#computePartitionKeyFilter I need to construct also effectivePredicate", "author": "guyco33", "createdAt": "2020-10-22T10:01:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzU5OTY0OA=="}], "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": "01019057f2c69990d63cf5c827b06e7bdd3d3eb9", "url": "https://github.com/trinodb/trino/commit/01019057f2c69990d63cf5c827b06e7bdd3d3eb9", "message": "Add tests for filter by partitions in thrift hive metastore", "committedDate": "2020-10-28T14:48:39Z", "type": "commit"}, {"oid": "01019057f2c69990d63cf5c827b06e7bdd3d3eb9", "url": "https://github.com/trinodb/trino/commit/01019057f2c69990d63cf5c827b06e7bdd3d3eb9", "message": "Add tests for filter by partitions in thrift hive metastore", "committedDate": "2020-10-28T14:48:39Z", "type": "forcePushed"}]}