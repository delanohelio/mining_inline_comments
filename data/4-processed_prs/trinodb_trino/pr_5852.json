{"pr_number": 5852, "pr_title": "Use static imports for String.format", "pr_createdAt": "2020-11-06T09:03:36Z", "pr_url": "https://github.com/trinodb/trino/pull/5852", "timeline": [{"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODYxNDQ3Mw==", "url": "https://github.com/trinodb/trino/pull/5852#discussion_r518614473", "bodyText": "Here comes the cost of this. There is a format method defined in StandardRepresentation", "author": "kokosing", "createdAt": "2020-11-06T09:08:46Z", "path": "presto-main/src/test/java/io/prestosql/sql/query/QueryAssertions.java", "diffHunk": "@@ -368,7 +368,7 @@ public String toStringOf(Object object)\n             {\n                 if (object instanceof SqlTimestamp) {\n                     SqlTimestamp timestamp = (SqlTimestamp) object;\n-                    return String.format(\n+                    return String./*suppress code style*/format(", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODc0NDU3MA==", "url": "https://github.com/trinodb/trino/pull/5852#discussion_r518744570", "bodyText": "\ud83d\ude14", "author": "findepi", "createdAt": "2020-11-06T13:17:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODYxNDQ3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODc1MjQ5MA==", "url": "https://github.com/trinodb/trino/pull/5852#discussion_r518752490", "bodyText": "maybe it's worth/possible to configure some hints (airlift or just IDE) instead of hard restriction in airlift/airbase#247 ?", "author": "ssheikin", "createdAt": "2020-11-06T13:32:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODYxNDQ3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODc5NzEyOQ==", "url": "https://github.com/trinodb/trino/pull/5852#discussion_r518797129", "bodyText": "That\u2019s why I don\u2019t like the blanket ban on String.format. There are places where you just want to use that name and delegate to String.format for convenience, and this prevents it.\nI don\u2019t see anything wrong with having qualified calls to String.format.", "author": "martint", "createdAt": "2020-11-06T14:46:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODYxNDQ3Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODYxNDg4NA==", "url": "https://github.com/trinodb/trino/pull/5852#discussion_r518614884", "bodyText": "This belongs to a new commit", "author": "skrzypo987", "createdAt": "2020-11-06T09:09:29Z", "path": "presto-main/src/main/java/io/prestosql/operator/scalar/timestamptz/ToIso8601.java", "diffHunk": "@@ -60,25 +60,25 @@ public static Slice toIso8601(@LiteralParameter(\"p\") long precision, @SqlType(\"t\n         long epochMillis = unpackMillisUtc(packedEpochMillis);\n         ZoneId zoneId = unpackZoneKey(packedEpochMillis).getZoneId();\n \n-        return utf8Slice(format((int) precision, epochMillis, 0, zoneId));\n+        return utf8Slice(toIso8621((int) precision, epochMillis, 0, zoneId));", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODYxNTI5MA==", "url": "https://github.com/trinodb/trino/pull/5852#discussion_r518615290", "bodyText": "as well as this.\nPlease make a commit with only String.format -> format and then other(s) with the rest", "author": "skrzypo987", "createdAt": "2020-11-06T09:10:11Z", "path": "presto-main/src/main/java/io/prestosql/operator/scalar/timetz/TimeWithTimeZoneToVarcharCast.java", "diffHunk": "@@ -48,18 +48,17 @@ public static Slice cast(@LiteralParameter(\"p\") long precision, @SqlType(\"time(p\n         long nanos = unpackTimeNanos(packedTime);\n         int offsetMinutes = unpackOffsetMinutes(packedTime);\n \n-        return formatAsString((int) precision, nanos * PICOSECONDS_PER_NANOSECOND, offsetMinutes);\n+        return toVarchar((int) precision, nanos * PICOSECONDS_PER_NANOSECOND, offsetMinutes);", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODYxNTgwNQ==", "url": "https://github.com/trinodb/trino/pull/5852#discussion_r518615805", "bodyText": "same here", "author": "skrzypo987", "createdAt": "2020-11-06T09:11:11Z", "path": "presto-product-tests-launcher/src/main/java/io/prestosql/tests/product/launcher/cli/OptionsPrinter.java", "diffHunk": "@@ -34,7 +35,7 @@\n \n     private OptionsPrinter() {}\n \n-    public static String format(Object... objects)\n+    public static String formatOptions(Object... objects)", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODkwODg2Nw==", "url": "https://github.com/trinodb/trino/pull/5852#discussion_r518908867", "bodyText": "I intentionally didn't name it toVarchar when I wrote this because I wanted to convey the notion that this is about formatting the value in a string-like format. The fact that it's a varchar is a concern for the caller. See my comment below -- I think the fact that we have to work around naming (and this is not the only case) just to satisfy some convention around imports shows why this \"rule\" shouldn't be applied globally.", "author": "martint", "createdAt": "2020-11-06T17:48:59Z", "path": "presto-main/src/main/java/io/prestosql/operator/scalar/timetz/TimeWithTimeZoneToVarcharCast.java", "diffHunk": "@@ -48,18 +48,17 @@ public static Slice cast(@LiteralParameter(\"p\") long precision, @SqlType(\"time(p\n         long nanos = unpackTimeNanos(packedTime);\n         int offsetMinutes = unpackOffsetMinutes(packedTime);\n \n-        return formatAsString((int) precision, nanos * PICOSECONDS_PER_NANOSECOND, offsetMinutes);\n+        return toVarchar((int) precision, nanos * PICOSECONDS_PER_NANOSECOND, offsetMinutes);\n     }\n \n     @LiteralParameters({\"x\", \"p\"})\n     @SqlType(\"varchar(x)\")\n     public static Slice cast(@LiteralParameter(\"p\") long precision, @SqlType(\"time(p) with time zone\") LongTimeWithTimeZone time)\n     {\n-        return formatAsString((int) precision, time.getPicoSeconds(), time.getOffsetMinutes());\n+        return toVarchar((int) precision, time.getPicoSeconds(), time.getOffsetMinutes());\n     }\n \n-    // Can't name this format() because we can't have a qualified reference to String.format() below\n-    private static Slice formatAsString(int precision, long picos, int offsetMinutes)\n+    private static Slice toVarchar(int precision, long picos, int offsetMinutes)", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ2OTY1MA==", "url": "https://github.com/trinodb/trino/pull/5852#discussion_r519469650", "bodyText": "code -> codec", "author": "ssheikin", "createdAt": "2020-11-08T19:55:58Z", "path": "presto-parquet/src/main/java/io/prestosql/parquet/writer/ParquetCompressor.java", "diffHunk": "@@ -47,7 +47,7 @@ static ParquetCompressor getCompressor(CompressionCodecName codec)\n             case UNCOMPRESSED:\n                 return null;\n         }\n-        throw new RuntimeException(String.format(\"%s codec is not supported\", codec));\n+        throw new RuntimeException(\"Not supported code: \" + codec);", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzkzOTQxOQ==", "url": "https://github.com/trinodb/trino/pull/5852#discussion_r523939419", "bodyText": "Is it possible to enforce this kind of formatting somewhere? (airlift?)\nNo change request.", "author": "skrzypo987", "createdAt": "2020-11-16T07:27:57Z", "path": "presto-kafka/src/test/java/io/prestosql/plugin/kafka/TestKafkaIntegrationPushDown.java", "diffHunk": "@@ -108,8 +108,7 @@ public void stopKafka()\n     public void testPartitionPushDown() throws ExecutionException, InterruptedException\n     {\n         createMessages(topicNamePartition);\n-        String sql = format(\"SELECT count(*) FROM default.%s WHERE _partition_id=1\",", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzk0ODc2Nw==", "url": "https://github.com/trinodb/trino/pull/5852#discussion_r523948767", "bodyText": "I am not aware of how it could be done.", "author": "kokosing", "createdAt": "2020-11-16T07:50:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzkzOTQxOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDE5MTAzNQ==", "url": "https://github.com/trinodb/trino/pull/5852#discussion_r524191035", "bodyText": "nit: it would be better to inline the expression rather than to reuse the sql variable", "author": "findepi", "createdAt": "2020-11-16T12:02:13Z", "path": "presto-kafka/src/test/java/io/prestosql/plugin/kafka/TestKafkaIntegrationPushDown.java", "diffHunk": "@@ -120,20 +119,17 @@ public void testOffsetPushDown() throws ExecutionException, InterruptedException\n     {\n         createMessages(topicNameOffset);\n         DistributedQueryRunner queryRunner = getDistributedQueryRunner();\n-        String sql = format(\"SELECT count(*) FROM default.%s WHERE _partition_offset between 2 and 10\",\n-                topicNameOffset);\n+        String sql = format(\"SELECT count(*) FROM default.%s WHERE _partition_offset between 2 and 10\", topicNameOffset);\n \n         ResultWithQueryId<MaterializedResult> queryResult = queryRunner.executeWithQueryId(getSession(), sql);\n         assertEquals(getQueryInfo(queryRunner, queryResult).getQueryStats().getProcessedInputPositions(), 18);\n \n-        sql = format(\"SELECT count(*) FROM default.%s WHERE _partition_offset > 2 and _partition_offset < 10\",\n-                topicNameOffset);\n+        sql = format(\"SELECT count(*) FROM default.%s WHERE _partition_offset > 2 and _partition_offset < 10\", topicNameOffset);", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQxNTk3NA==", "url": "https://github.com/trinodb/trino/pull/5852#discussion_r526415974", "bodyText": "Then I would need to also inline queryResult and then test becomes unreadable", "author": "kokosing", "createdAt": "2020-11-18T20:58:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDE5MTAzNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDE5MTgyNQ==", "url": "https://github.com/trinodb/trino/pull/5852#discussion_r524191825", "bodyText": "Not supported -> Unsupported", "author": "findepi", "createdAt": "2020-11-16T12:02:59Z", "path": "presto-parquet/src/main/java/io/prestosql/parquet/writer/ParquetCompressor.java", "diffHunk": "@@ -47,7 +47,7 @@ static ParquetCompressor getCompressor(CompressionCodecName codec)\n             case UNCOMPRESSED:\n                 return null;\n         }\n-        throw new RuntimeException(String.format(\"%s codec is not supported\", codec));\n+        throw new RuntimeException(\"Not supported codec: \" + codec);", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "0d6da44b3f49dd685ec4d274302c485e1334e0e8", "url": "https://github.com/trinodb/trino/commit/0d6da44b3f49dd685ec4d274302c485e1334e0e8", "message": "Improve formatting", "committedDate": "2020-11-18T20:58:53Z", "type": "commit"}, {"oid": "b6987f02365a2cca1bec1f16c97b12d889c09def", "url": "https://github.com/trinodb/trino/commit/b6987f02365a2cca1bec1f16c97b12d889c09def", "message": "Remove redundant String.format invocation", "committedDate": "2020-11-18T20:58:53Z", "type": "commit"}, {"oid": "850b086ce710a1bc441da922c1906eccf4451c54", "url": "https://github.com/trinodb/trino/commit/850b086ce710a1bc441da922c1906eccf4451c54", "message": "Use static imports for String.format", "committedDate": "2020-11-18T20:58:53Z", "type": "commit"}, {"oid": "850b086ce710a1bc441da922c1906eccf4451c54", "url": "https://github.com/trinodb/trino/commit/850b086ce710a1bc441da922c1906eccf4451c54", "message": "Use static imports for String.format", "committedDate": "2020-11-18T20:58:53Z", "type": "forcePushed"}]}