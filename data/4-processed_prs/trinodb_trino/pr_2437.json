{"pr_number": 2437, "pr_title": "Consolidate NULL read/write paths in JDBC connectors", "pr_createdAt": "2020-01-08T14:05:33Z", "pr_url": "https://github.com/trinodb/trino/pull/2437", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDM5ODAwOQ==", "url": "https://github.com/trinodb/trino/pull/2437#discussion_r364398009", "bodyText": "I am not sure about it. Now you could reuse existing write functions when you had to implement custom write functions. Now you need to extend all write functions. That was the point of having them separated.\nSame comment goes to read function. However that does hit me.", "author": "kokosing", "createdAt": "2020-01-08T19:15:33Z", "path": "presto-base-jdbc/src/main/java/io/prestosql/plugin/jdbc/WriteFunction.java", "diffHunk": "@@ -13,7 +13,16 @@\n  */\n package io.prestosql.plugin.jdbc;\n \n+import java.sql.PreparedStatement;\n+import java.sql.SQLException;\n+\n public interface WriteFunction\n {\n     Class<?> getJavaType();\n+\n+    default void setNull(PreparedStatement statement, int index)", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDQ2Njk1Mw==", "url": "https://github.com/trinodb/trino/pull/2437#discussion_r364466953", "bodyText": "I hear what you're saying. This makes the interface coherent & simplifies the code. I think this is a good improvement even considered this downside that you mention", "author": "findepi", "createdAt": "2020-01-08T22:06:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDM5ODAwOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDU3NTAzMw==", "url": "https://github.com/trinodb/trino/pull/2437#discussion_r364575033", "bodyText": "This simplifies the code on side and complicates on the other side. I would expect gains here to be  much lower than loses. ; /", "author": "kokosing", "createdAt": "2020-01-09T06:23:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDM5ODAwOQ=="}], "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": "f26026b6efa4b240e4860c189ed4f87d4e203eee", "url": "https://github.com/trinodb/trino/commit/f26026b6efa4b240e4860c189ed4f87d4e203eee", "message": "Move checking nulls to ReadFunction interface\n\nThis makes the `ReadFunction` interface more coherent & complete, while\nproviding clean API indication how the NULL values are handled.", "committedDate": "2020-01-10T09:28:19Z", "type": "commit"}, {"oid": "e6a561c85216fedb977b5b822677f7112944b24c", "url": "https://github.com/trinodb/trino/commit/e6a561c85216fedb977b5b822677f7112944b24c", "message": "Merge WriteNullFunction into WriteFunction interface", "committedDate": "2020-01-10T09:28:20Z", "type": "commit"}, {"oid": "e6a561c85216fedb977b5b822677f7112944b24c", "url": "https://github.com/trinodb/trino/commit/e6a561c85216fedb977b5b822677f7112944b24c", "message": "Merge WriteNullFunction into WriteFunction interface", "committedDate": "2020-01-10T09:28:20Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTcyMjQzMw==", "url": "https://github.com/trinodb/trino/pull/2437#discussion_r365722433", "bodyText": "Is there any other way to read null value from JDBC, that you heard of?", "author": "kokosing", "createdAt": "2020-01-13T10:07:07Z", "path": "presto-base-jdbc/src/main/java/io/prestosql/plugin/jdbc/ReadFunction.java", "diffHunk": "@@ -13,10 +13,23 @@\n  */\n package io.prestosql.plugin.jdbc;\n \n+import java.sql.ResultSet;\n+import java.sql.SQLException;\n+\n public interface ReadFunction\n {\n     Class<?> getJavaType();\n \n+    default boolean isNull(ResultSet resultSet, int columnIndex)\n+            throws SQLException\n+    {\n+        // JDBC is kind of dumb: we need to read the field and then ask\n+        // if it was null, which means we are wasting effort here.\n+        // We could save the result of the field access if it matters.\n+        resultSet.getObject(columnIndex);\n+        return resultSet.wasNull();", "originalCommit": "f26026b6efa4b240e4860c189ed4f87d4e203eee", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTczMTg4Nw==", "url": "https://github.com/trinodb/trino/pull/2437#discussion_r365731887", "bodyText": "Nope :/", "author": "findepi", "createdAt": "2020-01-13T10:28:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTcyMjQzMw=="}], "type": "inlineReview"}]}