{"pr_number": 3389, "pr_title": "Fix SHOW CREATE TABLE if row type column contains special character", "pr_createdAt": "2020-04-08T17:20:26Z", "pr_url": "https://github.com/trinodb/trino/pull/3389", "timeline": [{"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjUxNzYyNg==", "url": "https://github.com/trinodb/trino/pull/3389#discussion_r416517626", "bodyText": "unnecessary \\n, unless you reuse createTableSql in the assertion below\nadd more keywords like table or `select", "author": "findepi", "createdAt": "2020-04-28T10:51:05Z", "path": "presto-hive/src/test/java/io/prestosql/plugin/hive/TestHiveIntegrationSmokeTest.java", "diffHunk": "@@ -3233,6 +3233,24 @@ public void testShowCreateTable()\n         assertUpdate(createTableSql);\n         actualResult = computeActual(\"SHOW CREATE TABLE \\\"test_show_create_table'2\\\"\");\n         assertEquals(getOnlyElement(actualResult.getOnlyColumnAsSet()), createTableSql);\n+\n+        createTableSql = format(\"\" +\n+                        \"CREATE TABLE %s.%s.%s (\\n\" +\n+                        \"   c1 ROW(\\\"$a\\\" bigint, \\\"catalog\\\" varchar)\\n)\\n\",", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjUxODYzMw==", "url": "https://github.com/trinodb/trino/pull/3389#discussion_r416518633", "bodyText": "you should be able to use createTableSql here\nyou cannot because catalog is no longer delimited\nbut, that also means  user cannot take SHOW CREATE TABLE output and use it to create the table.\nSince this is the purpose of the SHOW CREATE TABLE query, it's  a no-go to me.", "author": "findepi", "createdAt": "2020-04-28T10:52:46Z", "path": "presto-hive/src/test/java/io/prestosql/plugin/hive/TestHiveIntegrationSmokeTest.java", "diffHunk": "@@ -3233,6 +3233,24 @@ public void testShowCreateTable()\n         assertUpdate(createTableSql);\n         actualResult = computeActual(\"SHOW CREATE TABLE \\\"test_show_create_table'2\\\"\");\n         assertEquals(getOnlyElement(actualResult.getOnlyColumnAsSet()), createTableSql);\n+\n+        createTableSql = format(\"\" +\n+                        \"CREATE TABLE %s.%s.%s (\\n\" +\n+                        \"   c1 ROW(\\\"$a\\\" bigint, \\\"catalog\\\" varchar)\\n)\\n\",\n+                getSession().getCatalog().get(),\n+                getSession().getSchema().get(),\n+                \"test_show_create_table_with_special_characters\");\n+        assertUpdate(createTableSql);\n+        assertThat(computeActual(\"SHOW CREATE TABLE test_show_create_table_with_special_characters\").getOnlyValue())\n+                .isEqualTo(format(\"\" +\n+                                \"CREATE TABLE %s.%s.%s (\\n\" +\n+                                \"   c1 ROW(\\\"$a\\\" bigint, catalog varchar)\\n)\\n\",\n+                        getSession().getCatalog().get(),\n+                        getSession().getSchema().get(),\n+                        \"test_show_create_table_with_special_characters\") +\n+                        \"WITH (\\n\" +\n+                        \"   format = 'ORC'\\n\" +\n+                        \")\");", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzM4NzQzMQ==", "url": "https://github.com/trinodb/trino/pull/3389#discussion_r417387431", "bodyText": "logged #3584", "author": "findepi", "createdAt": "2020-04-29T15:03:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjUxODYzMw=="}], "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": "23e68e4f2ccd3cf84332a00a8a1d6ec2cb5ea680", "url": "https://github.com/trinodb/trino/commit/23e68e4f2ccd3cf84332a00a8a1d6ec2cb5ea680", "message": "Quote special row field names containing special characters", "committedDate": "2020-05-02T11:04:33Z", "type": "commit"}, {"oid": "23e68e4f2ccd3cf84332a00a8a1d6ec2cb5ea680", "url": "https://github.com/trinodb/trino/commit/23e68e4f2ccd3cf84332a00a8a1d6ec2cb5ea680", "message": "Quote special row field names containing special characters", "committedDate": "2020-05-02T11:04:33Z", "type": "forcePushed"}]}