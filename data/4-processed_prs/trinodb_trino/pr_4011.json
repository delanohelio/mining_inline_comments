{"pr_number": 4011, "pr_title": "Add LuhnCheck function", "pr_createdAt": "2020-06-12T15:28:01Z", "pr_url": "https://github.com/trinodb/trino/pull/4011", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTU0NjEzNw==", "url": "https://github.com/trinodb/trino/pull/4011#discussion_r439546137", "bodyText": "add test cases with:\n\nNULL\n''\ndifferent length\nnon-digits\nnon-ascii, like \u0105\nnon-BMP, like \ud83d\ude80 (utf-16 surrogate pairs)", "author": "findepi", "createdAt": "2020-06-12T17:17:08Z", "path": "presto-main/src/test/java/io/prestosql/operator/scalar/TestLuhnCheckFunction.java", "diffHunk": "@@ -0,0 +1,29 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.prestosql.operator.scalar;\n+\n+import org.testng.annotations.Test;\n+\n+import static io.prestosql.spi.type.BooleanType.BOOLEAN;\n+\n+public class TestLuhnCheckFunction\n+    extends AbstractTestFunctions\n+{\n+    @Test\n+    public void testLuhnCheck()\n+    {\n+        assertFunction(\"luhn_check('4242424242424242')\", BOOLEAN, true);\n+        assertFunction(\"luhn_check('1234567891234567')\", BOOLEAN, false);", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTU1NTgwOQ==", "url": "https://github.com/trinodb/trino/pull/4011#discussion_r441555809", "bodyText": "Added additional tests.", "author": "urbanfletch", "createdAt": "2020-06-17T13:44:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTU0NjEzNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTU0NjIxMg==", "url": "https://github.com/trinodb/trino/pull/4011#discussion_r439546212", "bodyText": "indent", "author": "findepi", "createdAt": "2020-06-12T17:17:15Z", "path": "presto-main/src/main/java/io/prestosql/metadata/FunctionRegistry.java", "diffHunk": "@@ -524,6 +525,7 @@ public FunctionRegistry(Metadata metadata, FeaturesConfig featuresConfig)\n                 .scalars(JoniRegexpCasts.class)\n                 .scalars(CharacterStringCasts.class)\n                 .scalars(CharOperators.class)\n+       \t        .scalars(LuhnCheckFunction.class)", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTU0NjkzNw==", "url": "https://github.com/trinodb/trino/pull/4011#discussion_r439546937", "bodyText": "String#substring is expensive.\nBut you do not need String at all.\nSee below for exaple how to proces Slice varchar character-by-character:\nhttps://github.com/prestosql/presto/blob/6d9d47e0909b3fe9367584ba8450827dbbb8e1d7/presto-main/src/main/java/io/prestosql/type/LikeFunctions.java#L134", "author": "findepi", "createdAt": "2020-06-12T17:18:48Z", "path": "presto-main/src/main/java/io/prestosql/operator/scalar/LuhnCheckFunction.java", "diffHunk": "@@ -0,0 +1,61 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.prestosql.operator.scalar;\n+\n+import io.airlift.slice.Slice;\n+\n+import io.prestosql.spi.function.Description;\n+import io.prestosql.spi.function.ScalarFunction;\n+import io.prestosql.spi.function.SqlType;\n+import io.prestosql.spi.type.StandardTypes;\n+\n+import static java.lang.Integer.parseInt;\n+\n+public final class LuhnCheckFunction\n+{\n+    private LuhnCheckFunction() {}\n+\n+    @Description(\"Returns true if the string is a valid credit card number and false if it is not\")\n+    @ScalarFunction(\"luhn_check\")\n+    @SqlType(StandardTypes.BOOLEAN)\n+    public static boolean LuhnCheck(@SqlType(StandardTypes.VARCHAR) Slice slice)\n+    {\n+        int nDigits = slice.length();\n+        int sum = 0;\n+        boolean secondNumber = false;\n+        String cardNo = slice.toStringUtf8();\n+\n+        for (int i = nDigits - 1; i >= 0; i--) {\n+            int n = parseInt(cardNo.substring(i, i + 1));", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMxMzg3Ng==", "url": "https://github.com/trinodb/trino/pull/4011#discussion_r440313876", "bodyText": "We can process the bytes of the slice. If they aren't in the range of ASCII digits, then the function throws. This handles any non-ASCII or non-BMP automatically.", "author": "electrum", "createdAt": "2020-06-15T16:53:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTU0NjkzNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTU1Mzg2OQ==", "url": "https://github.com/trinodb/trino/pull/4011#discussion_r441553869", "bodyText": "Changed this to \"int n = getCodePointAt(slice, i) - 48;\"\nAnd added a catch for InvalidUtf8Exception.", "author": "urbanfletch", "createdAt": "2020-06-17T13:41:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTU0NjkzNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMxNDUxMw==", "url": "https://github.com/trinodb/trino/pull/4011#discussion_r440314513", "bodyText": "Nit:\nn *= 2;", "author": "electrum", "createdAt": "2020-06-15T16:54:27Z", "path": "presto-main/src/main/java/io/prestosql/operator/scalar/LuhnCheckFunction.java", "diffHunk": "@@ -0,0 +1,61 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.prestosql.operator.scalar;\n+\n+import io.airlift.slice.Slice;\n+\n+import io.prestosql.spi.function.Description;\n+import io.prestosql.spi.function.ScalarFunction;\n+import io.prestosql.spi.function.SqlType;\n+import io.prestosql.spi.type.StandardTypes;\n+\n+import static java.lang.Integer.parseInt;\n+\n+public final class LuhnCheckFunction\n+{\n+    private LuhnCheckFunction() {}\n+\n+    @Description(\"Returns true if the string is a valid credit card number and false if it is not\")\n+    @ScalarFunction(\"luhn_check\")\n+    @SqlType(StandardTypes.BOOLEAN)\n+    public static boolean LuhnCheck(@SqlType(StandardTypes.VARCHAR) Slice slice)\n+    {\n+        int nDigits = slice.length();\n+        int sum = 0;\n+        boolean secondNumber = false;\n+        String cardNo = slice.toStringUtf8();\n+\n+        for (int i = nDigits - 1; i >= 0; i--) {\n+            int n = parseInt(cardNo.substring(i, i + 1));\n+\n+            // starting from the right double the value of every other number\n+            if (secondNumber) {\n+                n = n * 2;", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTU1NTk0NQ==", "url": "https://github.com/trinodb/trino/pull/4011#discussion_r441555945", "bodyText": "changed to \"n <<= 1;\"", "author": "urbanfletch", "createdAt": "2020-06-17T13:44:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMxNDUxMw=="}], "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTY5NjI1NA==", "url": "https://github.com/trinodb/trino/pull/4011#discussion_r445696254", "bodyText": "I think n *= 2 would be better from a readability perspective, since we're not explicitly doing bit manipulation here. The JIT will optimize this to a shift.", "author": "electrum", "createdAt": "2020-06-25T16:45:27Z", "path": "presto-main/src/main/java/io/prestosql/operator/scalar/LuhnCheckFunction.java", "diffHunk": "@@ -0,0 +1,73 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.prestosql.operator.scalar;\n+\n+import io.airlift.slice.InvalidUtf8Exception;\n+import io.airlift.slice.Slice;\n+import io.prestosql.spi.PrestoException;\n+import io.prestosql.spi.function.Description;\n+import io.prestosql.spi.function.ScalarFunction;\n+import io.prestosql.spi.function.SqlType;\n+import io.prestosql.spi.type.StandardTypes;\n+\n+import static io.airlift.slice.SliceUtf8.getCodePointAt;\n+import static io.prestosql.spi.StandardErrorCode.INVALID_FUNCTION_ARGUMENT;\n+\n+public final class LuhnCheckFunction\n+{\n+    private LuhnCheckFunction() {}\n+\n+    @Description(\"Returns true if the string is a valid credit card number and false if it is not\")\n+    @ScalarFunction(\"luhn_check\")\n+    @SqlType(StandardTypes.BOOLEAN)\n+    public static boolean LuhnCheck(@SqlType(StandardTypes.VARCHAR) Slice slice)\n+    {\n+        if (!slice.toStringUtf8().isEmpty()) {\n+            try {\n+                int nDigits = slice.length();\n+                int sum = 0;\n+                boolean secondNumber = false;\n+\n+                for (int i = nDigits - 1; i >= 0; i--) {\n+                    int n = getCodePointAt(slice, i) - 48;\n+\n+                    // starting from the right double the value of every other number\n+                    if (secondNumber) {\n+                        n <<= 1;", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTY5NzI3Ng==", "url": "https://github.com/trinodb/trino/pull/4011#discussion_r445697276", "bodyText": "We can invert this and return early (removes a level of indentation). Also, no need to convert to a string just to check if it is empty.\nif (slice.length() == 0) {\n    return false;\n}\ntry {\n    ...", "author": "electrum", "createdAt": "2020-06-25T16:47:00Z", "path": "presto-main/src/main/java/io/prestosql/operator/scalar/LuhnCheckFunction.java", "diffHunk": "@@ -0,0 +1,73 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.prestosql.operator.scalar;\n+\n+import io.airlift.slice.InvalidUtf8Exception;\n+import io.airlift.slice.Slice;\n+import io.prestosql.spi.PrestoException;\n+import io.prestosql.spi.function.Description;\n+import io.prestosql.spi.function.ScalarFunction;\n+import io.prestosql.spi.function.SqlType;\n+import io.prestosql.spi.type.StandardTypes;\n+\n+import static io.airlift.slice.SliceUtf8.getCodePointAt;\n+import static io.prestosql.spi.StandardErrorCode.INVALID_FUNCTION_ARGUMENT;\n+\n+public final class LuhnCheckFunction\n+{\n+    private LuhnCheckFunction() {}\n+\n+    @Description(\"Returns true if the string is a valid credit card number and false if it is not\")\n+    @ScalarFunction(\"luhn_check\")\n+    @SqlType(StandardTypes.BOOLEAN)\n+    public static boolean LuhnCheck(@SqlType(StandardTypes.VARCHAR) Slice slice)\n+    {\n+        if (!slice.toStringUtf8().isEmpty()) {", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTcwMDMyNA==", "url": "https://github.com/trinodb/trino/pull/4011#discussion_r445700324", "bodyText": "According to https://en.wikipedia.org/wiki/Luhn_algorithm the algorithm is used for more than just credit cards. I think we should also fail (rather than return false) on any non-digit input.\nHow about this for the description\n\nChecks that a string of digits is valid according to the Luhn algorithm", "author": "electrum", "createdAt": "2020-06-25T16:51:47Z", "path": "presto-main/src/main/java/io/prestosql/operator/scalar/LuhnCheckFunction.java", "diffHunk": "@@ -0,0 +1,73 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.prestosql.operator.scalar;\n+\n+import io.airlift.slice.InvalidUtf8Exception;\n+import io.airlift.slice.Slice;\n+import io.prestosql.spi.PrestoException;\n+import io.prestosql.spi.function.Description;\n+import io.prestosql.spi.function.ScalarFunction;\n+import io.prestosql.spi.function.SqlType;\n+import io.prestosql.spi.type.StandardTypes;\n+\n+import static io.airlift.slice.SliceUtf8.getCodePointAt;\n+import static io.prestosql.spi.StandardErrorCode.INVALID_FUNCTION_ARGUMENT;\n+\n+public final class LuhnCheckFunction\n+{\n+    private LuhnCheckFunction() {}\n+\n+    @Description(\"Returns true if the string is a valid credit card number and false if it is not\")", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTcwMzQ2MQ==", "url": "https://github.com/trinodb/trino/pull/4011#discussion_r445703461", "bodyText": "If we only allow digits, we can write this as\nbyte b = slice.getByte(i);\ncheckCondition(b >= '0' && b <= '9', INVALID_FUNCTION_ARGUMENT, \"Input contains non-digit character\");\nint n = b - '0';", "author": "electrum", "createdAt": "2020-06-25T16:56:52Z", "path": "presto-main/src/main/java/io/prestosql/operator/scalar/LuhnCheckFunction.java", "diffHunk": "@@ -0,0 +1,73 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.prestosql.operator.scalar;\n+\n+import io.airlift.slice.InvalidUtf8Exception;\n+import io.airlift.slice.Slice;\n+import io.prestosql.spi.PrestoException;\n+import io.prestosql.spi.function.Description;\n+import io.prestosql.spi.function.ScalarFunction;\n+import io.prestosql.spi.function.SqlType;\n+import io.prestosql.spi.type.StandardTypes;\n+\n+import static io.airlift.slice.SliceUtf8.getCodePointAt;\n+import static io.prestosql.spi.StandardErrorCode.INVALID_FUNCTION_ARGUMENT;\n+\n+public final class LuhnCheckFunction\n+{\n+    private LuhnCheckFunction() {}\n+\n+    @Description(\"Returns true if the string is a valid credit card number and false if it is not\")\n+    @ScalarFunction(\"luhn_check\")\n+    @SqlType(StandardTypes.BOOLEAN)\n+    public static boolean LuhnCheck(@SqlType(StandardTypes.VARCHAR) Slice slice)\n+    {\n+        if (!slice.toStringUtf8().isEmpty()) {\n+            try {\n+                int nDigits = slice.length();\n+                int sum = 0;\n+                boolean secondNumber = false;\n+\n+                for (int i = nDigits - 1; i >= 0; i--) {\n+                    int n = getCodePointAt(slice, i) - 48;", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ5OTk2Mw==", "url": "https://github.com/trinodb/trino/pull/4011#discussion_r452499963", "bodyText": "This shouldn't be needed since we aren't decoding UTF-8", "author": "electrum", "createdAt": "2020-07-09T21:27:05Z", "path": "presto-main/src/main/java/io/prestosql/operator/scalar/LuhnCheckFunction.java", "diffHunk": "@@ -0,0 +1,73 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.prestosql.operator.scalar;\n+\n+import io.airlift.slice.InvalidUtf8Exception;\n+import io.airlift.slice.Slice;\n+import io.prestosql.spi.PrestoException;\n+import io.prestosql.spi.function.Description;\n+import io.prestosql.spi.function.ScalarFunction;\n+import io.prestosql.spi.function.SqlType;\n+import io.prestosql.spi.type.StandardTypes;\n+\n+import static io.prestosql.spi.StandardErrorCode.INVALID_FUNCTION_ARGUMENT;\n+import static io.prestosql.util.Failures.checkCondition;\n+\n+public final class LuhnCheckFunction\n+{\n+    private LuhnCheckFunction() {}\n+\n+    @Description(\"Checks that a string of digits is valid according to the Luhn algorithm\")\n+    @ScalarFunction(\"luhn_check\")\n+    @SqlType(StandardTypes.BOOLEAN)\n+    public static boolean LuhnCheck(@SqlType(StandardTypes.VARCHAR) Slice slice)\n+    {\n+        if (slice.length() == 0) {\n+            return false;\n+        }\n+        try {\n+            int nDigits = slice.length();\n+            int sum = 0;\n+            boolean secondNumber = false;\n+\n+            for (int i = nDigits - 1; i >= 0; i--) {\n+                byte b = slice.getByte(i);\n+                checkCondition(b >= '0' && b <= '9', INVALID_FUNCTION_ARGUMENT, \"Input contains non-digit character\");\n+                int n = b - '0';\n+\n+                // starting from the right double the value of every other number\n+                if (secondNumber) {\n+                    n *= 2;\n+                }\n+\n+                // if the value is greater than 9 add the individual digits together\n+                if (n > 9) {\n+                    n = (n % 10) + 1;\n+                }\n+\n+                // add to sum\n+                sum += n;\n+\n+                // update second number check\n+                secondNumber = !secondNumber;\n+            }\n+            //check returns true if mod 10 is zero\n+            return (sum % 10 == 0);\n+        }\n+\n+        catch (InvalidUtf8Exception e) {", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUwMDM1MA==", "url": "https://github.com/trinodb/trino/pull/4011#discussion_r452500350", "bodyText": "Should this be an error?", "author": "electrum", "createdAt": "2020-07-09T21:27:59Z", "path": "presto-main/src/test/java/io/prestosql/operator/scalar/TestLuhnCheckFunction.java", "diffHunk": "@@ -0,0 +1,36 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.prestosql.operator.scalar;\n+\n+import org.testng.annotations.Test;\n+\n+import static io.prestosql.spi.StandardErrorCode.INVALID_FUNCTION_ARGUMENT;\n+import static io.prestosql.spi.type.BooleanType.BOOLEAN;\n+\n+public class TestLuhnCheckFunction\n+        extends AbstractTestFunctions\n+{\n+    @Test\n+    public void testLuhnCheck()\n+    {\n+        assertFunction(\"luhn_check('4242424242424242')\", BOOLEAN, true);\n+        assertFunction(\"luhn_check('1234567891234567')\", BOOLEAN, false);\n+        assertFunction(\"luhn_check('')\", BOOLEAN, false);", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzI0ODA5MA==", "url": "https://github.com/trinodb/trino/pull/4011#discussion_r453248090", "bodyText": "I don't believe so - i think expected behavior would be to return false for the empty string.", "author": "urbanfletch", "createdAt": "2020-07-12T00:05:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUwMDM1MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUwMDYyMg==", "url": "https://github.com/trinodb/trino/pull/4011#discussion_r452500622", "bodyText": "Capitalize Luhn since it's a name", "author": "electrum", "createdAt": "2020-07-09T21:28:36Z", "path": "presto-docs/src/main/sphinx/functions/string.rst", "diffHunk": "@@ -76,6 +76,10 @@ String Functions\n \n     Removes leading whitespace from ``string``.\n \n+.. function:: luhn_check(string) -> boolean\n+\n+    Tests whether a ``string`` of digits is valid according to the luhn algorithm.", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTE2MDc4NA==", "url": "https://github.com/trinodb/trino/pull/4011#discussion_r455160784", "bodyText": "added caps", "author": "urbanfletch", "createdAt": "2020-07-15T15:59:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUwMDYyMg=="}], "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjA2ODE4Mw==", "url": "https://github.com/trinodb/trino/pull/4011#discussion_r456068183", "bodyText": "How about adding a link\nTests whether a ``string`` of digits is valid according to the\n`Luhn algorithm <https://en.wikipedia.org/wiki/Luhn_algorithm>`_.", "author": "electrum", "createdAt": "2020-07-16T20:47:06Z", "path": "presto-docs/src/main/sphinx/functions/string.rst", "diffHunk": "@@ -81,6 +81,10 @@ String Functions\n \n     Removes leading whitespace from ``string``.\n \n+.. function:: luhn_check(string) -> boolean\n+\n+    Tests whether a ``string`` of digits is valid according to the Luhn algorithm.", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTA1OTQ0MA==", "url": "https://github.com/trinodb/trino/pull/4011#discussion_r461059440", "bodyText": "done.", "author": "urbanfletch", "createdAt": "2020-07-27T17:41:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjA2ODE4Mw=="}], "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": "7b82a3848062690e3900b9311a01b1167c2c019e", "url": "https://github.com/trinodb/trino/commit/7b82a3848062690e3900b9311a01b1167c2c019e", "message": "Add luhn_check function", "committedDate": "2020-07-27T20:48:26Z", "type": "commit"}, {"oid": "7b82a3848062690e3900b9311a01b1167c2c019e", "url": "https://github.com/trinodb/trino/commit/7b82a3848062690e3900b9311a01b1167c2c019e", "message": "Add luhn_check function", "committedDate": "2020-07-27T20:48:26Z", "type": "forcePushed"}]}