{"pr_number": 4804, "pr_title": "Only request client certificate when using certificate authentication", "pr_createdAt": "2020-08-13T06:17:03Z", "pr_url": "https://github.com/trinodb/trino/pull/4804", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTczMDE3OQ==", "url": "https://github.com/trinodb/trino/pull/4804#discussion_r469730179", "bodyText": "Update before merging", "author": "electrum", "createdAt": "2020-08-13T06:42:21Z", "path": "pom.xml", "diffHunk": "@@ -46,7 +46,7 @@\n         <dep.accumulo.version>1.7.4</dep.accumulo.version>\n         <dep.accumulo-hadoop.version>2.7.7-1</dep.accumulo-hadoop.version>\n         <dep.antlr.version>4.7.1</dep.antlr.version>\n-        <dep.airlift.version>0.198</dep.airlift.version>\n+        <dep.airlift.version>0.200-SNAPSHOT</dep.airlift.version>", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTczMDUyMA==", "url": "https://github.com/trinodb/trino/pull/4804#discussion_r469730520", "bodyText": "Wrong binder", "author": "electrum", "createdAt": "2020-08-13T06:43:12Z", "path": "presto-main/src/main/java/io/prestosql/server/security/ServerSecurityModule.java", "diffHunk": "@@ -61,7 +63,10 @@ protected void setup(Binder binder)\n \n         authenticatorBinder(binder); // create empty map binder\n \n-        installAuthenticator(\"certificate\", CertificateAuthenticator.class, CertificateConfig.class);\n+        install(authenticatorModule(\"certificate\", CertificateAuthenticator.class, certificateBinder -> {\n+            newOptionalBinder(binder, ClientCertificate.class).setBinding().toInstance(ClientCertificate.REQUESTED);", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTczMTA1Ng==", "url": "https://github.com/trinodb/trino/pull/4804#discussion_r469731056", "bodyText": "Why do we need this cast?", "author": "electrum", "createdAt": "2020-08-13T06:44:36Z", "path": "presto-main/src/main/java/io/prestosql/server/security/ServerSecurityModule.java", "diffHunk": "@@ -61,7 +63,10 @@ protected void setup(Binder binder)\n \n         authenticatorBinder(binder); // create empty map binder\n \n-        installAuthenticator(\"certificate\", CertificateAuthenticator.class, CertificateConfig.class);\n+        install(authenticatorModule(\"certificate\", CertificateAuthenticator.class, certificateBinder -> {\n+            newOptionalBinder(binder, ClientCertificate.class).setBinding().toInstance(ClientCertificate.REQUESTED);\n+            configBinder(certificateBinder).bindConfig((Class<?>) CertificateConfig.class);", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": "8ec334b10eab94435af80be53134eb836ea2b6a2", "url": "https://github.com/trinodb/trino/commit/8ec334b10eab94435af80be53134eb836ea2b6a2", "message": "Only request client certificate when using certificate authentication", "committedDate": "2020-08-14T00:06:47Z", "type": "commit"}, {"oid": "8ec334b10eab94435af80be53134eb836ea2b6a2", "url": "https://github.com/trinodb/trino/commit/8ec334b10eab94435af80be53134eb836ea2b6a2", "message": "Only request client certificate when using certificate authentication", "committedDate": "2020-08-14T00:06:47Z", "type": "forcePushed"}]}