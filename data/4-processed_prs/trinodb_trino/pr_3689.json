{"pr_number": 3689, "pr_title": "Document missing AWS Glue configs in Hive connector", "pr_createdAt": "2020-05-10T14:36:23Z", "pr_url": "https://github.com/trinodb/trino/pull/3689", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjgwMjgzNg==", "url": "https://github.com/trinodb/trino/pull/3689#discussion_r422802836", "bodyText": "Not sure how to word this, but this is default warehouse directory used for new schemas, when using Glue, unless explicit location is specified.\n@mosabua can you please suggest wording?", "author": "findepi", "createdAt": "2020-05-11T06:11:44Z", "path": "presto-docs/src/main/sphinx/connector/hive.rst", "diffHunk": "@@ -305,13 +305,22 @@ Property Name                                        Description\n                                                      running in EC2, or when the catalog is in a different region.\n                                                      Example: ``us-east-1``\n \n+``hive.metastore.glue.endpoint-url``                 AWS Glue API endpoint URL.\n+                                                     Example: ``https://glue.us-east-1.amazonaws.com``\n+\n ``hive.metastore.glue.pin-client-to-current-region`` Pin Glue requests to the same region as the EC2 instance\n                                                      where Presto is running, defaults to ``false``.\n \n ``hive.metastore.glue.max-connections``              Max number of concurrent connections to Glue,\n                                                      defaults to ``5``.\n \n-``hive.metastore.glue.default-warehouse-dir``        Hive Glue metastore default warehouse directory\n+``hive.metastore.glue.default-warehouse-dir``        AWS Glue metastore default warehouse directory", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI2NzI3MQ==", "url": "https://github.com/trinodb/trino/pull/3689#discussion_r423267271", "bodyText": "default warehouse directory for newly created schemas with metadata storage in AWS Glue, can be overridden with the location property in the schema creation statement\nMaybe something like thatt", "author": "mosabua", "createdAt": "2020-05-11T19:26:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjgwMjgzNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzUzNTY5MA==", "url": "https://github.com/trinodb/trino/pull/3689#discussion_r423535690", "bodyText": "\"Default warehouse directory for tables created without an explicit LOCATION property\". I don't reiterating the AWS Glue part is necessary since it's all listed under the Glue heading.", "author": "hashhar", "createdAt": "2020-05-12T07:57:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjgwMjgzNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDAyMzE4MQ==", "url": "https://github.com/trinodb/trino/pull/3689#discussion_r424023181", "bodyText": "fair enough", "author": "mosabua", "createdAt": "2020-05-12T20:46:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjgwMjgzNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjgwMzIxNA==", "url": "https://github.com/trinodb/trino/pull/3689#discussion_r422803214", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            ``hive.metastore.glue.catalogid``                    AWS Glue metastore catalog id\n          \n          \n            \n            ``hive.metastore.glue.catalogid``                    AWS Glue catalog id", "author": "findepi", "createdAt": "2020-05-11T06:12:40Z", "path": "presto-docs/src/main/sphinx/connector/hive.rst", "diffHunk": "@@ -305,13 +305,22 @@ Property Name                                        Description\n                                                      running in EC2, or when the catalog is in a different region.\n                                                      Example: ``us-east-1``\n \n+``hive.metastore.glue.endpoint-url``                 AWS Glue API endpoint URL.\n+                                                     Example: ``https://glue.us-east-1.amazonaws.com``\n+\n ``hive.metastore.glue.pin-client-to-current-region`` Pin Glue requests to the same region as the EC2 instance\n                                                      where Presto is running, defaults to ``false``.\n \n ``hive.metastore.glue.max-connections``              Max number of concurrent connections to Glue,\n                                                      defaults to ``5``.\n \n-``hive.metastore.glue.default-warehouse-dir``        Hive Glue metastore default warehouse directory\n+``hive.metastore.glue.default-warehouse-dir``        AWS Glue metastore default warehouse directory\n+\n+``hive.metastore.glue.catalogid``                    AWS Glue metastore catalog id", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjgwMzUzMw==", "url": "https://github.com/trinodb/trino/pull/3689#discussion_r422803533", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            ``hive.metastore.glue.get-partition-threads``        Number of threads for parallel partition fetches from Glue,\n          \n          \n            \n            ``hive.metastore.glue.get-partition-threads``        Number of threads for parallel partition fetches from AWS Glue,", "author": "findepi", "createdAt": "2020-05-11T06:13:27Z", "path": "presto-docs/src/main/sphinx/connector/hive.rst", "diffHunk": "@@ -328,6 +337,12 @@ Property Name                                        Description\n \n ``hive.metastore.glue.external-id``                  External ID for the IAM role trust policy when connecting\n                                                      to the Glue Catalog.\n+\n+``hive.metastore.glue.partitions-segments``          Number of segments for partitioned Glue tables, defaults\n+                                                     to ``5``.\n+\n+``hive.metastore.glue.get-partition-threads``        Number of threads for parallel partition fetches from Glue,", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI2NTE0NQ==", "url": "https://github.com/trinodb/trino/pull/3689#discussion_r423265145", "bodyText": "we used Glue without the AWS prefix all over the place. I kinda think we don't need to add it here or in most other places.", "author": "mosabua", "createdAt": "2020-05-11T19:22:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjgwMzUzMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI2NDY2MA==", "url": "https://github.com/trinodb/trino/pull/3689#discussion_r423264660", "bodyText": "of the Java class", "author": "mosabua", "createdAt": "2020-05-11T19:21:32Z", "path": "presto-docs/src/main/sphinx/connector/hive.rst", "diffHunk": "@@ -305,13 +305,22 @@ Property Name                                        Description\n                                                      running in EC2, or when the catalog is in a different region.\n                                                      Example: ``us-east-1``\n \n+``hive.metastore.glue.endpoint-url``                 AWS Glue API endpoint URL.\n+                                                     Example: ``https://glue.us-east-1.amazonaws.com``\n+\n ``hive.metastore.glue.pin-client-to-current-region`` Pin Glue requests to the same region as the EC2 instance\n                                                      where Presto is running, defaults to ``false``.\n \n ``hive.metastore.glue.max-connections``              Max number of concurrent connections to Glue,\n                                                      defaults to ``5``.\n \n-``hive.metastore.glue.default-warehouse-dir``        Hive Glue metastore default warehouse directory\n+``hive.metastore.glue.default-warehouse-dir``        AWS Glue metastore default warehouse directory\n+\n+``hive.metastore.glue.catalogid``                    AWS Glue metastore catalog id\n+\n+``hive.metastore.glue.aws-credentials-provider``     Fully qualified name of class to use for obtaining AWS", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI2NzQ0OQ==", "url": "https://github.com/trinodb/trino/pull/3689#discussion_r423267449", "bodyText": "This is optional I think..", "author": "mosabua", "createdAt": "2020-05-11T19:27:00Z", "path": "presto-docs/src/main/sphinx/connector/hive.rst", "diffHunk": "@@ -305,13 +305,22 @@ Property Name                                        Description\n                                                      running in EC2, or when the catalog is in a different region.\n                                                      Example: ``us-east-1``\n \n+``hive.metastore.glue.endpoint-url``                 AWS Glue API endpoint URL.", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzUzNzgzNw==", "url": "https://github.com/trinodb/trino/pull/3689#discussion_r423537837", "bodyText": "True. This is completely optional. I'll edit accordingly.", "author": "hashhar", "createdAt": "2020-05-12T08:00:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI2NzQ0OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzU0MDEwMQ==", "url": "https://github.com/trinodb/trino/pull/3689#discussion_r427540101", "bodyText": "Remove \"Might be\" and simplify .. so .. \"Useful when all requests to Glue should be proxied.", "author": "mosabua", "createdAt": "2020-05-19T19:15:20Z", "path": "presto-docs/src/main/sphinx/connector/hive.rst", "diffHunk": "@@ -305,13 +305,24 @@ Property Name                                        Description\n                                                      running in EC2, or when the catalog is in a different region.\n                                                      Example: ``us-east-1``\n \n+``hive.metastore.glue.endpoint-url``                 Glue API endpoint URL (optional). Might be useful in", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzU0MTMwOQ==", "url": "https://github.com/trinodb/trino/pull/3689#discussion_r427541309", "bodyText": "either ID or identifier.", "author": "mosabua", "createdAt": "2020-05-19T19:17:31Z", "path": "presto-docs/src/main/sphinx/connector/hive.rst", "diffHunk": "@@ -305,13 +305,24 @@ Property Name                                        Description\n                                                      running in EC2, or when the catalog is in a different region.\n                                                      Example: ``us-east-1``\n \n+``hive.metastore.glue.endpoint-url``                 Glue API endpoint URL (optional). Might be useful in\n+                                                     scenarios where all requests to Glue should be proxied.\n+                                                     Example: ``https://glue.us-east-1.amazonaws.com``\n+\n ``hive.metastore.glue.pin-client-to-current-region`` Pin Glue requests to the same region as the EC2 instance\n                                                      where Presto is running, defaults to ``false``.\n \n ``hive.metastore.glue.max-connections``              Max number of concurrent connections to Glue,\n                                                      defaults to ``5``.\n \n-``hive.metastore.glue.default-warehouse-dir``        Hive Glue metastore default warehouse directory\n+``hive.metastore.glue.default-warehouse-dir``        Default warehouse directory for tables created without an\n+                                                     explicit ``LOCATION`` property.\n+\n+``hive.metastore.glue.catalogid``                    Glue Catalog id (optional).", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTQ0NjIyNA==", "url": "https://github.com/trinodb/trino/pull/3689#discussion_r429446224", "bodyText": "I am not sure \"be proxied\" is the right term, as this implies they would end up hitting AWS APIs somehow, whereas this could be used to provide your own standalone glue implementation.\nI think \"Glue API endpoint URL\" should be enough for now.", "author": "findepi", "createdAt": "2020-05-22T20:50:11Z", "path": "presto-docs/src/main/sphinx/connector/hive.rst", "diffHunk": "@@ -306,13 +306,24 @@ Property Name                                        Description\n                                                      running in EC2, or when the catalog is in a different region.\n                                                      Example: ``us-east-1``\n \n+``hive.metastore.glue.endpoint-url``                 Glue API endpoint URL (optional). Useful when all requests\n+                                                     to Glue should be proxied.\n+                                                     Example: ``https://glue.us-east-1.amazonaws.com``", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTQ3MjE1Nw==", "url": "https://github.com/trinodb/trino/pull/3689#discussion_r429472157", "bodyText": "Changed. That makes sense.", "author": "hashhar", "createdAt": "2020-05-22T22:00:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTQ0NjIyNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUyMzE0Mg==", "url": "https://github.com/trinodb/trino/pull/3689#discussion_r429523142", "bodyText": "This is about schemas, not tables:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            ``hive.metastore.glue.default-warehouse-dir``        Default warehouse directory for tables created without an\n          \n          \n            \n                                                                 explicit ``LOCATION`` property.\n          \n          \n            \n            ``hive.metastore.glue.default-warehouse-dir``        Default warehouse directory for schemas created without an\n          \n          \n            \n                                                                 explicit ``location`` property.\n          \n      \n    \n    \n  \n\nBTW can you please test what happens if this is not set?\n(I think we are going to fail, but we not in a nice way.)", "author": "findepi", "createdAt": "2020-05-23T07:30:58Z", "path": "presto-docs/src/main/sphinx/connector/hive.rst", "diffHunk": "@@ -306,13 +306,23 @@ Property Name                                        Description\n                                                      running in EC2, or when the catalog is in a different region.\n                                                      Example: ``us-east-1``\n \n+``hive.metastore.glue.endpoint-url``                 Glue API endpoint URL (optional).\n+                                                     Example: ``https://glue.us-east-1.amazonaws.com``\n+\n ``hive.metastore.glue.pin-client-to-current-region`` Pin Glue requests to the same region as the EC2 instance\n                                                      where Presto is running, defaults to ``false``.\n \n ``hive.metastore.glue.max-connections``              Max number of concurrent connections to Glue,\n                                                      defaults to ``5``.\n \n-``hive.metastore.glue.default-warehouse-dir``        Hive Glue metastore default warehouse directory\n+``hive.metastore.glue.default-warehouse-dir``        Default warehouse directory for tables created without an\n+                                                     explicit ``LOCATION`` property.", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDA1OTgyNQ==", "url": "https://github.com/trinodb/trino/pull/3689#discussion_r430059825", "bodyText": "Hmmm, not sure if I tested this correctly. In my current cluster too I don't have hive.metastore.glue.default-warehouse-dir set to any value which means it's Optional.empty() (acc to code).\n$ presto-cli --catalog awsdatacatalog --schema dwh\npresto:dwh> create schema test_no_location;\nCREATE SCHEMA\npresto:express_dwh> use test_no_location;\nUSE\npresto:test_no_location> create table test (id varchar);\nQuery 20200525_195059_00276_p628j failed: Database 'test_no_location' location is not set", "author": "hashhar", "createdAt": "2020-05-25T19:53:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUyMzE0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDA2MDk5OA==", "url": "https://github.com/trinodb/trino/pull/3689#discussion_r430060998", "bodyText": "Thanks for checking. OTOH, now if you set hive.metastore.glue.default-warehouse-dir to some value and restart your cluster, will you now be able to create a table in test_no_location without providing external_location? I think no -- since the value is \"captured\" at schema creation time (if i am not mistaken).", "author": "findepi", "createdAt": "2020-05-25T19:58:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUyMzE0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDA3NDAzNw==", "url": "https://github.com/trinodb/trino/pull/3689#discussion_r430074037", "bodyText": "What you are saying sounds logical. I'll test this too sometime later in the day and get back to you.", "author": "hashhar", "createdAt": "2020-05-25T21:03:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUyMzE0Mg=="}], "type": "inlineReview"}, {"oid": "a1c63f8d1d66914581d64aea59b2096f8516f86e", "url": "https://github.com/trinodb/trino/commit/a1c63f8d1d66914581d64aea59b2096f8516f86e", "message": "Document new AWS Glue configs in Hive connector\n\nDocument the new configurations introduced as part of\nhttps://github.com/prestosql/presto/pull/1465 and a few other configs\nintroduced over time.\n\nCo-authored-by: Piotr Findeisen <piotr.findeisen@gmail.com>", "committedDate": "2020-06-21T17:26:32Z", "type": "commit"}]}