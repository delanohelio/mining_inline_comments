{"pr_number": 4617, "pr_title": "Add data_block_encoding parameter to Phoenix connector.", "pr_createdAt": "2020-07-29T05:04:10Z", "pr_url": "https://github.com/trinodb/trino/pull/4617", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjA2Njg4Mw==", "url": "https://github.com/trinodb/trino/pull/4617#discussion_r462066883", "bodyText": "Can we use Optional.ofNullable", "author": "Praveen2112", "createdAt": "2020-07-29T06:27:45Z", "path": "presto-phoenix/src/main/java/io/prestosql/plugin/phoenix/PhoenixTableProperties.java", "diffHunk": "@@ -232,6 +238,17 @@ public PhoenixTableProperties()\n         return Optional.of(value);\n     }\n \n+    public static Optional<String> getDataBlockEncoding(Map<String, Object> tableProperties)\n+    {\n+        requireNonNull(tableProperties);\n+\n+        String value = (String) tableProperties.get(DATA_BLOCK_ENCODING);\n+        if (value == null) {\n+            return Optional.empty();\n+        }\n+        return Optional.of(value);", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzI0NzcxMA==", "url": "https://github.com/trinodb/trino/pull/4617#discussion_r463247710", "bodyText": "I fixed all the occurrences here, as that just seemed right and no functional change at all.", "author": "lhofhansl", "createdAt": "2020-07-30T20:19:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjA2Njg4Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjA2OTkzNA==", "url": "https://github.com/trinodb/trino/pull/4617#discussion_r462069934", "bodyText": "Can we have a enum property for this like we define STORAGE_FORMAT_PROPERTY for HiveTableProperties", "author": "Praveen2112", "createdAt": "2020-07-29T06:35:31Z", "path": "presto-phoenix/src/main/java/io/prestosql/plugin/phoenix/PhoenixTableProperties.java", "diffHunk": "@@ -109,6 +110,11 @@ public PhoenixTableProperties()\n                         TTL,\n                         \"Number of seconds for cell TTL.  HBase will automatically delete rows once the expiration time is reached.\",\n                         null,\n+                        false),\n+                stringProperty(", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjM5MTM2NQ==", "url": "https://github.com/trinodb/trino/pull/4617#discussion_r462391365", "bodyText": "In both cases I just followed the existing code. I think if we change that, it is for all other parts too, and then we're mixing concerns of PRs.", "author": "lhofhansl", "createdAt": "2020-07-29T15:32:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjA2OTkzNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjY1Njg0OA==", "url": "https://github.com/trinodb/trino/pull/4617#discussion_r462656848", "bodyText": "Let me know if you want me to fix all the other instances as well in this PR or file a separate one.", "author": "lhofhansl", "createdAt": "2020-07-30T00:01:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjA2OTkzNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzE4Mzg1OA==", "url": "https://github.com/trinodb/trino/pull/4617#discussion_r463183858", "bodyText": "It would be better if we could fix all the other instances also. Maybe we can have s separate PR for them ?", "author": "Praveen2112", "createdAt": "2020-07-30T18:16:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjA2OTkzNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzI0ODAzNA==", "url": "https://github.com/trinodb/trino/pull/4617#discussion_r463248034", "bodyText": "I fixed the Optional use below. The property list change should be a separate PR IMHO.", "author": "lhofhansl", "createdAt": "2020-07-30T20:19:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjA2OTkzNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzI4NDc3Ng==", "url": "https://github.com/trinodb/trino/pull/4617#discussion_r463284776", "bodyText": "Can we capture them in a separate commit ?", "author": "Praveen2112", "createdAt": "2020-07-30T21:35:16Z", "path": "presto-phoenix/src/main/java/io/prestosql/plugin/phoenix/PhoenixTableProperties.java", "diffHunk": "@@ -160,86 +158,70 @@ public PhoenixTableProperties()\n         requireNonNull(tableProperties);\n \n         Boolean value = (Boolean) tableProperties.get(DISABLE_WAL);\n-        if (value == null) {\n-            return Optional.empty();\n-        }\n-        return Optional.of(value);\n+        return Optional.ofNullable(value);\n     }\n \n     public static Optional<Boolean> getImmutableRows(Map<String, Object> tableProperties)\n     {\n         requireNonNull(tableProperties);\n \n         Boolean value = (Boolean) tableProperties.get(IMMUTABLE_ROWS);\n-        if (value == null) {\n-            return Optional.empty();\n-        }\n-        return Optional.of(value);\n+        return Optional.ofNullable(value);\n     }\n \n     public static Optional<String> getDefaultColumnFamily(Map<String, Object> tableProperties)\n     {\n         requireNonNull(tableProperties);\n \n         String value = (String) tableProperties.get(DEFAULT_COLUMN_FAMILY);\n-        if (value == null) {\n-            return Optional.empty();\n-        }\n-        return Optional.of(value);\n+        return Optional.ofNullable(value);\n     }\n \n     public static Optional<String> getBloomfilter(Map<String, Object> tableProperties)\n     {\n         requireNonNull(tableProperties);\n \n         String value = (String) tableProperties.get(BLOOMFILTER);\n-        if (value == null) {\n-            return Optional.empty();\n-        }\n-        return Optional.of(value);\n+        return Optional.ofNullable(value);\n     }\n \n     public static Optional<Integer> getVersions(Map<String, Object> tableProperties)\n     {\n         requireNonNull(tableProperties);\n \n         Integer value = (Integer) tableProperties.get(VERSIONS);\n-        if (value == null) {\n-            return Optional.empty();\n-        }\n-        return Optional.of(value);\n+        return Optional.ofNullable(value);\n     }\n \n     public static Optional<Integer> getMinVersions(Map<String, Object> tableProperties)\n     {\n         requireNonNull(tableProperties);\n \n         Integer value = (Integer) tableProperties.get(MIN_VERSIONS);\n-        if (value == null) {\n-            return Optional.empty();\n-        }\n-        return Optional.of(value);\n+        return Optional.ofNullable(value);\n     }\n \n     public static Optional<String> getCompression(Map<String, Object> tableProperties)\n     {\n         requireNonNull(tableProperties);\n \n         String value = (String) tableProperties.get(COMPRESSION);\n-        if (value == null) {\n-            return Optional.empty();\n-        }\n-        return Optional.of(value);\n+        return Optional.ofNullable(value);\n+    }\n+\n+    public static Optional<String> getDataBlockEncoding(Map<String, Object> tableProperties)\n+    {\n+        requireNonNull(tableProperties);\n+\n+        String value = (String) tableProperties.get(DATA_BLOCK_ENCODING);\n+        return Optional.ofNullable(value);\n     }\n \n     public static Optional<Integer> getTimeToLive(Map<String, Object> tableProperties)\n     {\n         requireNonNull(tableProperties);\n \n         Integer value = (Integer) tableProperties.get(TTL);\n-        if (value == null) {", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzgwNDAxNg==", "url": "https://github.com/trinodb/trino/pull/4617#discussion_r463804016", "bodyText": "Then let's do separate PRs. I'll undo this change, and just make sure the new code uses ofNullable.\nWhat about the documentation fixes. Maybe it's best to separate the fix for the Bloomfilter doc as well.", "author": "lhofhansl", "createdAt": "2020-07-31T19:56:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzI4NDc3Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDMzMTc3OQ==", "url": "https://github.com/trinodb/trino/pull/4617#discussion_r464331779", "bodyText": "Did we miss None and PREFIX_TREE encoding technique ?", "author": "Praveen2112", "createdAt": "2020-08-03T10:34:50Z", "path": "presto-phoenix/src/main/java/io/prestosql/plugin/phoenix/PhoenixTableProperties.java", "diffHunk": "@@ -109,6 +110,11 @@ public PhoenixTableProperties()\n                         TTL,\n                         \"Number of seconds for cell TTL.  HBase will automatically delete rows once the expiration time is reached.\",\n                         null,\n+                        false),\n+                stringProperty(\n+                        DATA_BLOCK_ENCODING,\n+                        \"The block encoding algorithm to use for Cells in HBase blocks. Options are: PREFIX, DIFF, FAST_DIFF, ROW_INDEX_V1, and others.\",", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDMzMjU0OA==", "url": "https://github.com/trinodb/trino/pull/4617#discussion_r464332548", "bodyText": "Can we add the same in the doc too", "author": "Praveen2112", "createdAt": "2020-08-03T10:36:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDMzMTc3OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDYzNjgzNg==", "url": "https://github.com/trinodb/trino/pull/4617#discussion_r464636836", "bodyText": "PREFIX_TREE is not finished in HBase, nobody should use it.\nAnd there really is no reason to use PREFIX or DIFF (since FAST_DIFF is better and faster than both).\nYep. None is missing. And also, yes, it should consistent with the documentation.", "author": "lhofhansl", "createdAt": "2020-08-03T20:11:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDMzMTc3OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDY0MDY2Nw==", "url": "https://github.com/trinodb/trino/pull/4617#discussion_r464640667", "bodyText": "Updated.", "author": "lhofhansl", "createdAt": "2020-08-03T20:20:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDMzMTc3OQ=="}], "type": "inlineReview"}, {"oid": "155b02f9997cbae12704a377cde2d2a585431cfc", "url": "https://github.com/trinodb/trino/commit/155b02f9997cbae12704a377cde2d2a585431cfc", "message": "Add data_block_encoding parameter to Phoenix connector.", "committedDate": "2020-08-03T22:25:58Z", "type": "commit"}]}