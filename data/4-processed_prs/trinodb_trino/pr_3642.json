{"pr_number": 3642, "pr_title": "Minor cleanup of BigQuery connector", "pr_createdAt": "2020-05-06T10:46:32Z", "pr_url": "https://github.com/trinodb/trino/pull/3642", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTM1NzczOQ==", "url": "https://github.com/trinodb/trino/pull/3642#discussion_r421357739", "bodyText": "ImmutableList -> List", "author": "findepi", "createdAt": "2020-05-07T09:13:02Z", "path": "presto-bigquery/src/main/java/io/prestosql/plugin/bigquery/BigQueryClient.java", "diffHunk": "@@ -150,31 +148,27 @@ TableResult query(String sql)\n         }\n     }\n \n-    String createSql(TableId table, ImmutableList<String> requiredColumns, String[] filters)\n+    String selectSql(TableId table, ImmutableList<String> requiredColumns)", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTM1ODc1NA==", "url": "https://github.com/trinodb/trino/pull/3642#discussion_r421358754", "bodyText": "good that you removed unused fields\nwe should still validate the values are non null, as they are not validated otherwise (even implicitly) before the ctor returns", "author": "findepi", "createdAt": "2020-05-07T09:14:36Z", "path": "presto-bigquery/src/main/java/io/prestosql/plugin/bigquery/BigQueryCredentialsSupplier.java", "diffHunk": "@@ -29,14 +29,10 @@\n \n class BigQueryCredentialsSupplier\n {\n-    private final Optional<String> credentialsKey;\n-    private final Optional<String> credentialsFile;\n     private final Supplier<Optional<Credentials>> credentialsCreator;\n \n     public BigQueryCredentialsSupplier(Optional<String> credentialsKey, Optional<String> credentialsFile)\n     {\n-        this.credentialsKey = credentialsKey;\n-        this.credentialsFile = credentialsFile;", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTM1OTIyMQ==", "url": "https://github.com/trinodb/trino/pull/3642#discussion_r421359221", "bodyText": "please also move below logger, and add a blank line after static field", "author": "findepi", "createdAt": "2020-05-07T09:15:21Z", "path": "presto-bigquery/src/main/java/io/prestosql/plugin/bigquery/BigQueryResultPageSource.java", "diffHunk": "@@ -72,31 +70,23 @@\n public class BigQueryResultPageSource\n         implements ConnectorPageSource\n {\n-    static final AvroDecimalConverter DECIMAL_CONVERTER = new AvroDecimalConverter();\n+    private static final AvroDecimalConverter DECIMAL_CONVERTER = new AvroDecimalConverter();", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTM2MDQwMw==", "url": "https://github.com/trinodb/trino/pull/3642#discussion_r421360403", "bodyText": "perhaps you can make the fields private too", "author": "findepi", "createdAt": "2020-05-07T09:17:19Z", "path": "presto-bigquery/src/main/java/io/prestosql/plugin/bigquery/ReadSessionCreator.java", "diffHunk": "@@ -144,19 +143,19 @@ TableInfo getActualTable(\n         }\n     }\n \n-    static class DestinationTableBuilder\n+    private static class DestinationTableBuilder\n             implements Callable<TableInfo>\n     {\n         final BigQueryClient bigQueryClient;\n         final ReadSessionCreatorConfig config;\n-        final String querySql;\n+        final String query;", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTM5OTY4Nw==", "url": "https://github.com/trinodb/trino/pull/3642#discussion_r421399687", "bodyText": "nit: separate fields from constants with new line", "author": "losipiuk", "createdAt": "2020-05-07T10:23:12Z", "path": "presto-bigquery/src/main/java/io/prestosql/plugin/bigquery/BigQueryMetadata.java", "diffHunk": "@@ -62,18 +61,19 @@\n public class BigQueryMetadata\n         implements ConnectorMetadata\n {\n+    private static final Logger log = Logger.get(BigQueryMetadata.class);\n+\n     static final int NUMERIC_DATA_TYPE_PRECISION = 38;\n     static final int NUMERIC_DATA_TYPE_SCALE = 9;\n     static final String INFORMATION_SCHEMA = \"information_schema\";\n-    private static final Logger log = Logger.get(BigQueryMetadata.class);\n-    private BigQueryClient bigQueryClient;\n-    private String projectId;\n+    private final BigQueryClient bigQueryClient;", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTQwMTAwMg==", "url": "https://github.com/trinodb/trino/pull/3642#discussion_r421401002", "bodyText": "List", "author": "losipiuk", "createdAt": "2020-05-07T10:25:32Z", "path": "presto-bigquery/src/main/java/io/prestosql/plugin/bigquery/BigQueryResultPageSource.java", "diffHunk": "@@ -72,31 +70,23 @@\n public class BigQueryResultPageSource\n         implements ConnectorPageSource\n {\n-    static final AvroDecimalConverter DECIMAL_CONVERTER = new AvroDecimalConverter();\n+    private static final AvroDecimalConverter DECIMAL_CONVERTER = new AvroDecimalConverter();\n     private static final Logger log = Logger.get(BigQueryResultPageSource.class);\n     private final BigQueryStorageClient bigQueryStorageClient;\n-    private final int maxReadRowsRetries;\n     private final BigQuerySplit split;\n-    private final BigQueryTableHandle table;\n-    private final ImmutableList<BigQueryColumnHandle> columns;\n     private final ImmutableList<Type> columnTypes;\n     private final AtomicLong readBytes;\n     private final PageBuilder pageBuilder;\n-    private Iterator<Storage.ReadRowsResponse> responses;\n-    private boolean closed;\n+    private final Iterator<Storage.ReadRowsResponse> responses;\n \n     public BigQueryResultPageSource(\n             BigQueryStorageClientFactory bigQueryStorageClientFactory,\n             int maxReadRowsRetries,\n             BigQuerySplit split,\n-            BigQueryTableHandle table,\n             ImmutableList<BigQueryColumnHandle> columns)", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTQwMTI0NA==", "url": "https://github.com/trinodb/trino/pull/3642#discussion_r421401244", "bodyText": "Do we want to add requireNotNull check here?", "author": "losipiuk", "createdAt": "2020-05-07T10:26:00Z", "path": "presto-bigquery/src/main/java/io/prestosql/plugin/bigquery/BigQueryResultPageSource.java", "diffHunk": "@@ -72,31 +70,23 @@\n public class BigQueryResultPageSource\n         implements ConnectorPageSource\n {\n-    static final AvroDecimalConverter DECIMAL_CONVERTER = new AvroDecimalConverter();\n+    private static final AvroDecimalConverter DECIMAL_CONVERTER = new AvroDecimalConverter();\n     private static final Logger log = Logger.get(BigQueryResultPageSource.class);\n     private final BigQueryStorageClient bigQueryStorageClient;\n-    private final int maxReadRowsRetries;\n     private final BigQuerySplit split;\n-    private final BigQueryTableHandle table;\n-    private final ImmutableList<BigQueryColumnHandle> columns;\n     private final ImmutableList<Type> columnTypes;\n     private final AtomicLong readBytes;\n     private final PageBuilder pageBuilder;\n-    private Iterator<Storage.ReadRowsResponse> responses;\n-    private boolean closed;\n+    private final Iterator<Storage.ReadRowsResponse> responses;\n \n     public BigQueryResultPageSource(\n             BigQueryStorageClientFactory bigQueryStorageClientFactory,\n             int maxReadRowsRetries,\n             BigQuerySplit split,\n-            BigQueryTableHandle table,\n             ImmutableList<BigQueryColumnHandle> columns)\n     {\n         this.bigQueryStorageClient = bigQueryStorageClientFactory.createBigQueryStorageClient();", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTQwMjM4Ng==", "url": "https://github.com/trinodb/trino/pull/3642#discussion_r421402386", "bodyText": "Maybe add notNullCheck?", "author": "losipiuk", "createdAt": "2020-05-07T10:28:14Z", "path": "presto-bigquery/src/main/java/io/prestosql/plugin/bigquery/ReadSessionCreator.java", "diffHunk": "@@ -144,19 +143,19 @@ TableInfo getActualTable(\n         }\n     }\n \n-    static class DestinationTableBuilder\n+    private static class DestinationTableBuilder\n             implements Callable<TableInfo>\n     {\n         final BigQueryClient bigQueryClient;\n         final ReadSessionCreatorConfig config;\n-        final String querySql;\n+        final String query;\n         final TableId table;\n \n-        DestinationTableBuilder(BigQueryClient bigQueryClient, ReadSessionCreatorConfig config, String querySql, TableId table)\n+        DestinationTableBuilder(BigQueryClient bigQueryClient, ReadSessionCreatorConfig config, String query, TableId table)", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "af3c22fd18875668e65660168003a097ec62ccc5", "url": "https://github.com/trinodb/trino/commit/af3c22fd18875668e65660168003a097ec62ccc5", "message": "Minor cleanup of BigQuery connector\n\n- Remove unused method and field\n- Add missing final and static\n- Add missing requireNonNull\n- Rename method and variable\n- Fix typo\n- Use Slice.toStringUtf8 method", "committedDate": "2020-05-07T13:44:45Z", "type": "commit"}, {"oid": "af3c22fd18875668e65660168003a097ec62ccc5", "url": "https://github.com/trinodb/trino/commit/af3c22fd18875668e65660168003a097ec62ccc5", "message": "Minor cleanup of BigQuery connector\n\n- Remove unused method and field\n- Add missing final and static\n- Add missing requireNonNull\n- Rename method and variable\n- Fix typo\n- Use Slice.toStringUtf8 method", "committedDate": "2020-05-07T13:44:45Z", "type": "forcePushed"}]}