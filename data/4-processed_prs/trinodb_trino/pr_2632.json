{"pr_number": 2632, "pr_title": "Add bogus row to support listing empty catalogs", "pr_createdAt": "2020-01-26T11:33:43Z", "pr_url": "https://github.com/trinodb/trino/pull/2632", "timeline": [{"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTAxOTQ5MQ==", "url": "https://github.com/trinodb/trino/pull/2632#discussion_r371019491", "bodyText": "We could simply filter out the empty row (since catalog names cannot be empty).", "author": "electrum", "createdAt": "2020-01-26T18:19:45Z", "path": "presto-main/src/main/java/io/prestosql/sql/rewrite/ShowQueriesRewrite.java", "diffHunk": "@@ -341,24 +341,29 @@ protected Node visitShowSchemas(ShowSchemas node, Void context)\n         @Override\n         protected Node visitShowCatalogs(ShowCatalogs node, Void context)\n         {\n-            List<Expression> rows = listCatalogs(session, metadata, accessControl).keySet().stream()\n-                    .map(name -> row(new StringLiteral(name)))\n-                    .collect(toList());\n+            ImmutableList.Builder<Expression> rows = ImmutableList.builder();\n \n-            Optional<Expression> predicate = Optional.empty();\n+            listCatalogs(session, metadata, accessControl).keySet().stream()\n+                    .map(name -> row(new StringLiteral(name), TRUE_LITERAL))\n+                    .forEach(rows::add);\n+\n+            // add bogus row so we can support empty catalogs\n+            rows.add(row(new StringLiteral(\"\"), FALSE_LITERAL));", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTA0NTEzMg==", "url": "https://github.com/trinodb/trino/pull/2632#discussion_r371045132", "bodyText": "If nothing is installed, there is a system catalog. However, AccessControl may legitimately filter it out. So it might result in a empty values", "author": "Praveen2112", "createdAt": "2020-01-27T01:38:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTAxOTQ5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTA0ODcyOQ==", "url": "https://github.com/trinodb/trino/pull/2632#discussion_r371048729", "bodyText": "I mean that the bogus row shouldn\u2019t need a boolean column.", "author": "electrum", "createdAt": "2020-01-27T02:18:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTAxOTQ5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTA1MjIyMQ==", "url": "https://github.com/trinodb/trino/pull/2632#discussion_r371052221", "bodyText": "Oh okay !!", "author": "Praveen2112", "createdAt": "2020-01-27T02:53:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTAxOTQ5MQ=="}], "type": "inlineReview"}, {"oid": "2366ba797f335045de1fa6d5df2221ae0fc1a2d1", "url": "https://github.com/trinodb/trino/commit/2366ba797f335045de1fa6d5df2221ae0fc1a2d1", "message": "Add bogus row to support listing empty catalogs", "committedDate": "2020-01-29T16:38:10Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzUyNzcyMQ==", "url": "https://github.com/trinodb/trino/pull/2632#discussion_r373527721", "bodyText": "This can be structure as follows. It's simpler and clearer what's going on:\nList<Expression> rows = listCatalogs(session, metadata, accessControl).keySet().stream();\n\nOptional<Expression> predicate = Optional.empty();\nif (rows.isEmpty()) {\n    rows = ImmutableList.of(\"\");\n    predicate = Optional.of(BooleanLiteral.FALSE_LITERAL);\n}\nelse if (node.getLikePattern().isPresent()) {\n    predicate = Optional.of(new LikePredicate(...));\n}\n\nreturn simpleQuery(...)", "author": "martint", "createdAt": "2020-01-31T15:09:10Z", "path": "presto-main/src/main/java/io/prestosql/sql/rewrite/ShowQueriesRewrite.java", "diffHunk": "@@ -341,24 +342,29 @@ protected Node visitShowSchemas(ShowSchemas node, Void context)\n         @Override\n         protected Node visitShowCatalogs(ShowCatalogs node, Void context)\n         {\n-            List<Expression> rows = listCatalogs(session, metadata, accessControl).keySet().stream()\n+            ImmutableList.Builder<Expression> rows = ImmutableList.builder();", "originalCommit": "2366ba797f335045de1fa6d5df2221ae0fc1a2d1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "16c00972603625843a18959fa511fcc14e6fd9bc", "url": "https://github.com/trinodb/trino/commit/16c00972603625843a18959fa511fcc14e6fd9bc", "message": "Add bogus row to support listing empty catalogs", "committedDate": "2020-02-02T05:20:21Z", "type": "commit"}, {"oid": "16c00972603625843a18959fa511fcc14e6fd9bc", "url": "https://github.com/trinodb/trino/commit/16c00972603625843a18959fa511fcc14e6fd9bc", "message": "Add bogus row to support listing empty catalogs", "committedDate": "2020-02-02T05:20:21Z", "type": "forcePushed"}]}