{"pr_number": 3390, "pr_title": "Ensure OrcDataSink is closed when flush fails", "pr_createdAt": "2020-04-09T02:11:25Z", "pr_url": "https://github.com/trinodb/trino/pull/3390", "timeline": [{"oid": "bfde7778741b503b31426ffcf64795928c4f0a58", "url": "https://github.com/trinodb/trino/commit/bfde7778741b503b31426ffcf64795928c4f0a58", "message": "Ensure OrcDataSink is closed when flush fails", "committedDate": "2020-04-09T02:10:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYxMjkxNQ==", "url": "https://github.com/trinodb/trino/pull/3390#discussion_r406612915", "bodyText": "Can this lead to situation similar to #3326 ?", "author": "findepi", "createdAt": "2020-04-10T05:49:00Z", "path": "presto-orc/src/main/java/io/prestosql/orc/OrcWriter.java", "diffHunk": "@@ -445,9 +445,9 @@ public void close()\n         stats.updateSizeInBytes(-previouslyRecordedSizeInBytes);\n         previouslyRecordedSizeInBytes = 0;\n \n-        flushStripe(CLOSED);\n-\n-        orcDataSink.close();\n+        try (Closeable ignored = orcDataSink) {\n+            flushStripe(CLOSED);\n+        }", "originalCommit": "bfde7778741b503b31426ffcf64795928c4f0a58", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDAwMzU3NQ==", "url": "https://github.com/trinodb/trino/pull/3390#discussion_r414003575", "bodyText": "It's possible. Do you know what data source this occurs for?", "author": "electrum", "createdAt": "2020-04-23T17:53:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYxMjkxNQ=="}], "type": "inlineReview"}]}