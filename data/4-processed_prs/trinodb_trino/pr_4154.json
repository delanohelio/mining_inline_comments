{"pr_number": 4154, "pr_title": "Add tests for all fields reference operator", "pr_createdAt": "2020-06-22T19:31:02Z", "pr_url": "https://github.com/trinodb/trino/pull/4154", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDA4NzAwOQ==", "url": "https://github.com/trinodb/trino/pull/4154#discussion_r444087009", "bodyText": "what does this case test specifically vs previous case? Consider adding a comment", "author": "sopel39", "createdAt": "2020-06-23T09:24:49Z", "path": "presto-main/src/test/java/io/prestosql/sql/planner/TestLogicalPlanner.java", "diffHunk": "@@ -250,6 +250,28 @@ public void testAllFieldsDereferenceFromNonDeterministic()\n                                         project(\n                                                 ImmutableMap.of(\"rand\", expression(\"rand()\")),\n                                                 values())))));\n+\n+        assertPlan(\"SELECT (rand(), rand()).* FROM (VALUES 1) t(x)\",\n+                any(\n+                        project(\n+                                ImmutableMap.of(\n+                                        \"output_1\", expression(\"CAST(r AS ROW(f0 double,f1 double)).f0\"),\n+                                        \"output_2\", expression(\"CAST(r AS ROW(f0 double,f1 double)).f1\")),\n+                                project(\n+                                        ImmutableMap.of(\"r\", expression(\"ROW(rand(), rand())\")),\n+                                        values()))));\n+\n+        assertPlan(\"SELECT (rand(), rand()).* FROM (VALUES 1, 2) t(x) ORDER BY 1\",", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDMxMDU1Nw==", "url": "https://github.com/trinodb/trino/pull/4154#discussion_r444310557", "bodyText": "It's to check that the ORDER BY clause doesn't \"duplicate\" the expression, which would result in incorrect results due to non-determinism.", "author": "martint", "createdAt": "2020-06-23T15:24:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDA4NzAwOQ=="}], "type": "inlineReview"}, {"oid": "a5b2e3bd20415745562e75e13ee7eb371fe0b3cc", "url": "https://github.com/trinodb/trino/commit/a5b2e3bd20415745562e75e13ee7eb371fe0b3cc", "message": "Add tests for all fields reference operator", "committedDate": "2020-06-23T15:26:00Z", "type": "commit"}, {"oid": "a5b2e3bd20415745562e75e13ee7eb371fe0b3cc", "url": "https://github.com/trinodb/trino/commit/a5b2e3bd20415745562e75e13ee7eb371fe0b3cc", "message": "Add tests for all fields reference operator", "committedDate": "2020-06-23T15:26:00Z", "type": "forcePushed"}]}