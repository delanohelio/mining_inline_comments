{"pr_number": 3346, "pr_title": "Use unique table names in distributed tests", "pr_createdAt": "2020-04-05T18:26:02Z", "pr_url": "https://github.com/trinodb/trino/pull/3346", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzc1MDQxNw==", "url": "https://github.com/trinodb/trino/pull/3346#discussion_r403750417", "bodyText": "\"\" + tableName doesn't make sense", "author": "sopel39", "createdAt": "2020-04-05T20:06:56Z", "path": "presto-testing/src/main/java/io/prestosql/testing/AbstractTestDistributedQueries.java", "diffHunk": "@@ -195,63 +195,55 @@ public void testCreateTable()\n     @Test\n     public void testCreateTableAsSelect()\n     {\n-        assertUpdate(\"CREATE TABLE IF NOT EXISTS test_ctas AS SELECT name, regionkey FROM nation\", \"SELECT count(*) FROM nation\");\n-        assertTableColumnNames(\"test_ctas\", \"name\", \"regionkey\");\n-        assertUpdate(\"DROP TABLE test_ctas\");\n+        String tableName = \"test_ctas\" + randomTableSuffix();\n+        assertUpdate(\"CREATE TABLE IF NOT EXISTS \" + tableName + \" AS SELECT name, regionkey FROM nation\", \"SELECT count(*) FROM nation\");\n+        assertTableColumnNames(\"\" + tableName, \"name\", \"regionkey\");", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzc1MDQzMQ==", "url": "https://github.com/trinodb/trino/pull/3346#discussion_r403750431", "bodyText": "consider using String.format instead", "author": "sopel39", "createdAt": "2020-04-05T20:07:09Z", "path": "presto-testing/src/main/java/io/prestosql/testing/AbstractTestDistributedQueries.java", "diffHunk": "@@ -195,63 +195,55 @@ public void testCreateTable()\n     @Test\n     public void testCreateTableAsSelect()\n     {\n-        assertUpdate(\"CREATE TABLE IF NOT EXISTS test_ctas AS SELECT name, regionkey FROM nation\", \"SELECT count(*) FROM nation\");\n-        assertTableColumnNames(\"test_ctas\", \"name\", \"regionkey\");\n-        assertUpdate(\"DROP TABLE test_ctas\");\n+        String tableName = \"test_ctas\" + randomTableSuffix();\n+        assertUpdate(\"CREATE TABLE IF NOT EXISTS \" + tableName + \" AS SELECT name, regionkey FROM nation\", \"SELECT count(*) FROM nation\");", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzc1MDg4Mw==", "url": "https://github.com/trinodb/trino/pull/3346#discussion_r403750883", "bodyText": "when fmt-ing SQLs in tests, using + is often more readable than %s (especially when you substitude very few things in long text)", "author": "findepi", "createdAt": "2020-04-05T20:10:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzc1MDQzMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzg5ODUwMw==", "url": "https://github.com/trinodb/trino/pull/3346#discussion_r403898503", "bodyText": "Also, I refactored this code with some search-and-replace methods. Using format would be much harder to make it automatically.", "author": "kokosing", "createdAt": "2020-04-06T08:01:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzc1MDQzMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzc1MDU1MA==", "url": "https://github.com/trinodb/trino/pull/3346#discussion_r403750550", "bodyText": "I don't think it's needed anymore", "author": "sopel39", "createdAt": "2020-04-05T20:08:09Z", "path": "presto-testing/src/main/java/io/prestosql/testing/AbstractTestDistributedQueries.java", "diffHunk": "@@ -527,171 +519,176 @@ public void testInsertWithCoercion()\n     @Test\n     public void testInsertUnicode()\n     {\n-        assertUpdate(\"DROP TABLE IF EXISTS test_insert_unicode\");\n+        String tableName = \"test_insert_unicode_\" + randomTableSuffix();\n+\n+        assertUpdate(\"DROP TABLE IF EXISTS \" + tableName);", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzc1MDY4OA==", "url": "https://github.com/trinodb/trino/pull/3346#discussion_r403750688", "bodyText": "\"\" + viewName doesn't make sense", "author": "sopel39", "createdAt": "2020-04-05T20:09:07Z", "path": "presto-testing/src/main/java/io/prestosql/testing/AbstractTestDistributedQueries.java", "diffHunk": "@@ -801,7 +814,7 @@ public void testViewMetadata()\n         MaterializedResult expected = resultBuilder(getSession(), actual.getTypes())\n                 .row(\"customer\", \"BASE TABLE\")\n                 .row(\"lineitem\", \"BASE TABLE\")\n-                .row(\"meta_test_view\", \"VIEW\")\n+                .row(\"\" + viewName, \"VIEW\")", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzc1MDcwNQ==", "url": "https://github.com/trinodb/trino/pull/3346#discussion_r403750705", "bodyText": "ditto", "author": "sopel39", "createdAt": "2020-04-05T20:09:22Z", "path": "presto-testing/src/main/java/io/prestosql/testing/AbstractTestDistributedQueries.java", "diffHunk": "@@ -829,13 +842,13 @@ public void testViewMetadata()\n                 getSession().getSchema().get()));\n \n         expected = resultBuilder(getSession(), actual.getTypes())\n-                .row(\"meta_test_view\", formatSqlText(query))\n+                .row(\"\" + viewName, formatSqlText(query))", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "05f5cebcac2905c2761c1ac69e3e65fa10ed060c", "url": "https://github.com/trinodb/trino/commit/05f5cebcac2905c2761c1ac69e3e65fa10ed060c", "message": "Use unique table names in distributed tests", "committedDate": "2020-04-06T08:03:43Z", "type": "commit"}, {"oid": "05f5cebcac2905c2761c1ac69e3e65fa10ed060c", "url": "https://github.com/trinodb/trino/commit/05f5cebcac2905c2761c1ac69e3e65fa10ed060c", "message": "Use unique table names in distributed tests", "committedDate": "2020-04-06T08:03:43Z", "type": "forcePushed"}]}