{"pr_number": 3162, "pr_title": "Use SizeOf for list, map and String sizing", "pr_createdAt": "2020-03-19T17:14:13Z", "pr_url": "https://github.com/trinodb/trino/pull/3162", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTE4OTA1Ng==", "url": "https://github.com/trinodb/trino/pull/3162#discussion_r395189056", "bodyText": "Remember", "author": "findepi", "createdAt": "2020-03-19T17:14:25Z", "path": "pom.xml", "diffHunk": "@@ -45,6 +45,7 @@\n \n         <dep.antlr.version>4.7.1</dep.antlr.version>\n         <dep.airlift.version>0.193</dep.airlift.version>\n+        <dep.slice.version>0.39-SNAPSHOT</dep.slice.version>", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODM5MzA2OQ==", "url": "https://github.com/trinodb/trino/pull/3162#discussion_r428393069", "bodyText": "This wrapping seems excessive. I understand why you'd do it for a longer list of names, but this class is a key/value pair, no need to be extensible.", "author": "electrum", "createdAt": "2020-05-21T01:14:41Z", "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/HivePartitionKey.java", "diffHunk": "@@ -55,9 +56,11 @@ public String getValue()\n         return value;\n     }\n \n-    public int getEstimatedSizeInBytes()\n+    public long getEstimatedSizeInBytes()\n     {\n-        return INSTANCE_SIZE + name.length() * Character.BYTES + value.length() * Character.BYTES;\n+        return INSTANCE_SIZE +", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODM5MzExMQ==", "url": "https://github.com/trinodb/trino/pull/3162#discussion_r428393111", "bodyText": "This class is to hold a single string. No need to wrap here.", "author": "electrum", "createdAt": "2020-05-21T01:14:49Z", "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/HiveTypeName.java", "diffHunk": "@@ -42,9 +43,10 @@ public HiveType toHiveType()\n         return HiveType.valueOf(value);\n     }\n \n-    public int getEstimatedSizeInBytes()\n+    public long getEstimatedSizeInBytes()\n     {\n-        return INSTANCE_SIZE + value.length() * Character.BYTES;\n+        return INSTANCE_SIZE +", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODM5NDI0Nw==", "url": "https://github.com/trinodb/trino/pull/3162#discussion_r428394247", "bodyText": "We could add a helper estimatedSizeOf(HostAddress)\nreturn INSTANCE_SIZE + estimatedSizeOf(addresses, InternalHiveBlock::estimatedSize);", "author": "electrum", "createdAt": "2020-05-21T01:19:26Z", "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/InternalHiveSplit.java", "diffHunk": "@@ -275,14 +267,10 @@ public long getEnd()\n             return addresses;\n         }\n \n-        public int getEstimatedSizeInBytes()\n+        public long getEstimatedSizeInBytes()\n         {\n-            int result = INSTANCE_SIZE;\n-            result += sizeOfObjectArray(addresses.size());\n-            for (HostAddress address : addresses) {\n-                result += HOST_ADDRESS_INSTANCE_SIZE + address.getHostText().length() * Character.BYTES;\n-            }\n-            return result;\n+            return INSTANCE_SIZE", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODU0MTE4MQ==", "url": "https://github.com/trinodb/trino/pull/3162#discussion_r428541181", "bodyText": "Within this class, it doesn't help much. Maybe we could have a new,\u00a0reusable SizeOf for guava classes, but i don't think this is warranted yet.", "author": "findepi", "createdAt": "2020-05-21T09:19:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODM5NDI0Nw=="}], "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": "b5a43579b5e404d3ecf170c9ae35bbf2266ea75f", "url": "https://github.com/trinodb/trino/commit/b5a43579b5e404d3ecf170c9ae35bbf2266ea75f", "message": "Update to Airbase 102", "committedDate": "2020-07-03T08:53:36Z", "type": "commit"}, {"oid": "8401397894f6c019d82486ffe41f7028ca230224", "url": "https://github.com/trinodb/trino/commit/8401397894f6c019d82486ffe41f7028ca230224", "message": "Use SizeOf for list, map and String sizing", "committedDate": "2020-07-03T08:53:36Z", "type": "commit"}, {"oid": "8401397894f6c019d82486ffe41f7028ca230224", "url": "https://github.com/trinodb/trino/commit/8401397894f6c019d82486ffe41f7028ca230224", "message": "Use SizeOf for list, map and String sizing", "committedDate": "2020-07-03T08:53:36Z", "type": "forcePushed"}]}