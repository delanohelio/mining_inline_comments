{"pr_number": 3342, "pr_title": "Plugin class loader", "pr_createdAt": "2020-04-04T23:43:51Z", "pr_url": "https://github.com/trinodb/trino/pull/3342", "timeline": [{"oid": "12e6fa9125c63037b0353a6f3c931875e0fcb940", "url": "https://github.com/trinodb/trino/commit/12e6fa9125c63037b0353a6f3c931875e0fcb940", "message": "Fix warnings in PluginClassLoader", "committedDate": "2020-04-04T23:33:57Z", "type": "commit"}, {"oid": "a88548b8df1fad9a2f5cb8ada4865b4beed1d9a0", "url": "https://github.com/trinodb/trino/commit/a88548b8df1fad9a2f5cb8ada4865b4beed1d9a0", "message": "Use platform classloader in Java 8 and 11 for plugins", "committedDate": "2020-04-04T23:39:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzkxMjU5Ng==", "url": "https://github.com/trinodb/trino/pull/3342#discussion_r403912596", "bodyText": "Are there any changes between java 9 and java 11 in regards to platform class loader? Was getPlatformClassLoader() method removed? Is there different model of classloaders?", "author": "kokosing", "createdAt": "2020-04-06T08:26:00Z", "path": "presto-main/src/main/java/io/prestosql/server/PluginClassLoader.java", "diffHunk": "@@ -16,8 +16,6 @@\n import com.google.common.collect.ImmutableList;", "originalCommit": "a88548b8df1fad9a2f5cb8ada4865b4beed1d9a0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzkxMjc3MQ==", "url": "https://github.com/trinodb/trino/pull/3342#discussion_r403912771", "bodyText": "This is a dedicated method on Java 9 to access class loader that you want to use here in Presto.", "author": "kokosing", "createdAt": "2020-04-06T08:26:18Z", "path": "presto-main/src/main/java/io/prestosql/server/PluginClassLoader.java", "diffHunk": "@@ -143,21 +139,4 @@ private static String classNameToResource(String className)\n     {\n         return className.replace('.', '/');\n     }\n-\n-    @SuppressWarnings(\"JavaReflectionMemberAccess\")\n-    private static ClassLoader findPlatformClassLoader()\n-    {\n-        try {\n-            // use platform class loader on Java 9\n-            Method method = ClassLoader.class.getMethod(\"getPlatformClassLoader\");", "originalCommit": "a88548b8df1fad9a2f5cb8ada4865b4beed1d9a0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzkxMzYzMg==", "url": "https://github.com/trinodb/trino/pull/3342#discussion_r403913632", "bodyText": "Commit message is invalid:\nYou says that: Use platform classloader in Java 8 and 11 for plugins, while we were already using platform classloader for java 9 and so I guess it was working as well for java 11.", "author": "kokosing", "createdAt": "2020-04-06T08:27:43Z", "path": "presto-main/src/main/java/io/prestosql/server/PluginClassLoader.java", "diffHunk": "@@ -16,8 +16,6 @@\n import com.google.common.collect.ImmutableList;\n ", "originalCommit": "a88548b8df1fad9a2f5cb8ada4865b4beed1d9a0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzkxNjE4Mw==", "url": "https://github.com/trinodb/trino/pull/3342#discussion_r403916183", "bodyText": "This is the line that only be fixed. null (bootstrap CL) should be replaced with getSystemClassLoader().getParent()).", "author": "kokosing", "createdAt": "2020-04-06T08:32:05Z", "path": "presto-main/src/main/java/io/prestosql/server/PluginClassLoader.java", "diffHunk": "@@ -141,21 +139,4 @@ private static String classNameToResource(String className)\n     {\n         return className.replace('.', '/');\n     }\n-\n-    @SuppressWarnings(\"JavaReflectionMemberAccess\")\n-    private static ClassLoader findPlatformClassLoader()\n-    {\n-        try {\n-            // use platform class loader on Java 9\n-            Method method = ClassLoader.class.getMethod(\"getPlatformClassLoader\");\n-            return (ClassLoader) method.invoke(null);\n-        }\n-        catch (NoSuchMethodException ignored) {\n-            // use null class loader on Java 8\n-            return null;", "originalCommit": "a88548b8df1fad9a2f5cb8ada4865b4beed1d9a0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDM0MzA2NA==", "url": "https://github.com/trinodb/trino/pull/3342#discussion_r404343064", "bodyText": "As I stated above, our goal is not to get the platform cl, but instead \"The goal with the plugin class loader is to exclude the system classes, because these are the Presto application classes.\"  This means we want to use the same code for all JVM versions.", "author": "dain", "createdAt": "2020-04-06T19:43:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzkxNjE4Mw=="}], "type": "inlineReview"}]}