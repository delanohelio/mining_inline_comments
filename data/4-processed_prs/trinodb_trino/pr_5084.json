{"pr_number": 5084, "pr_title": "Configure product tests", "pr_createdAt": "2020-09-04T19:58:37Z", "pr_url": "https://github.com/trinodb/trino/pull/5084", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzgyNDg1Nw==", "url": "https://github.com/trinodb/trino/pull/5084#discussion_r483824857", "bodyText": "Missing space before {", "author": "electrum", "createdAt": "2020-09-04T20:09:41Z", "path": "presto-product-tests-launcher/src/main/java/io/prestosql/tests/product/launcher/cli/Launcher.java", "diffHunk": "@@ -155,7 +155,10 @@ protected Extensions getExtensions()\n         @Override\n         protected Object[][] getContents()\n         {\n-            return new Object[][]{{\"project.version\", readProjectVersion()}};\n+            return new Object[][]{", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzgyNTM4MA==", "url": "https://github.com/trinodb/trino/pull/5084#discussion_r483825380", "bodyText": "Sure. It's not checked by checkstyle :(", "author": "wendigo", "createdAt": "2020-09-04T20:10:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzgyNDg1Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzgyNjI3NQ==", "url": "https://github.com/trinodb/trino/pull/5084#discussion_r483826275", "bodyText": "Interesting, I assumed it was and this would fail.", "author": "electrum", "createdAt": "2020-09-04T20:13:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzgyNDg1Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzgyNTM0NA==", "url": "https://github.com/trinodb/trino/pull/5084#discussion_r483825344", "bodyText": "Shouldn't the second presto-server be a variable as well?", "author": "electrum", "createdAt": "2020-09-04T20:10:54Z", "path": "presto-product-tests-launcher/src/main/java/io/prestosql/tests/product/launcher/env/EnvironmentOptions.java", "diffHunk": "@@ -24,7 +24,7 @@\n     @Option(names = \"--config\", paramLabel = \"<config>\", description = \"Environment config to use\")\n     public String config = \"config-default\";\n \n-    @Option(names = \"--server-package\", paramLabel = \"<package>\", description = \"Path to Presto server package \" + DEFAULT_VALUE, defaultValue = \"presto-server/target/presto-server-${project.version}.tar.gz\")\n+    @Option(names = \"--server-package\", paramLabel = \"<package>\", description = \"Path to Presto server package \" + DEFAULT_VALUE, defaultValue = \"${server.module}/target/presto-server-${project.version}.tar.gz\")", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzgyNTY5NQ==", "url": "https://github.com/trinodb/trino/pull/5084#discussion_r483825695", "bodyText": "This seems to be missing /target/", "author": "electrum", "createdAt": "2020-09-04T20:11:48Z", "path": "presto-product-tests-launcher/src/main/java/io/prestosql/tests/product/launcher/cli/SuiteDescribe.java", "diffHunk": "@@ -84,12 +84,11 @@ public void run()\n     public static class SuiteDescribeOptions\n     {\n         private static final String DEFAULT_VALUE = \"(default: ${DEFAULT-VALUE})\";\n-        private static final String TARGET = \"presto-product-tests/target\";\n \n         @Option(names = \"--suite\", paramLabel = \"<suite>\", description = \"Name of the suite to describe\", required = true)\n         public String suite;\n \n-        @Option(names = \"--test-jar\", paramLabel = \"<jar>\", description = \"Path to test JAR \" + DEFAULT_VALUE, defaultValue = TARGET + \"/presto-product-tests-${project.version}-executable.jar\")\n+        @Option(names = \"--test-jar\", paramLabel = \"<jar>\", description = \"Path to test JAR \" + DEFAULT_VALUE, defaultValue = \"${product.tests.module}/${product.tests.module}-${project.version}-executable.jar\")", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzgyNjExOA==", "url": "https://github.com/trinodb/trino/pull/5084#discussion_r483826118", "bodyText": "Let's call this product-tests.module since we use dots for hierarchy, but \"product tests\" is a single name and not a hierarchy.", "author": "electrum", "createdAt": "2020-09-04T20:13:04Z", "path": "presto-product-tests-launcher/src/main/java/io/prestosql/tests/product/launcher/cli/Launcher.java", "diffHunk": "@@ -155,7 +155,10 @@ protected Extensions getExtensions()\n         @Override\n         protected Object[][] getContents()\n         {\n-            return new Object[][]{{\"project.version\", readProjectVersion()}};\n+            return new Object[][]{\n+                    {\"project.version\", readProjectVersion()},\n+                    {\"product.tests.module\", \"presto-product-tests\"},", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzgzNDY3Mw==", "url": "https://github.com/trinodb/trino/pull/5084#discussion_r483834673", "bodyText": "Can we format this like\nreturn new Object[][] {\n        {\"server.module\", \"presto-server\"},\n};\nThat will allow easily adding new values. I confirmed that it passes the style checker.", "author": "electrum", "createdAt": "2020-09-04T20:38:28Z", "path": "presto-product-tests-launcher/src/main/java/io/prestosql/tests/product/launcher/cli/Launcher.java", "diffHunk": "@@ -155,7 +155,10 @@ protected Extensions getExtensions()\n         @Override\n         protected Object[][] getContents()\n         {\n-            return new Object[][]{{\"project.version\", readProjectVersion()}};\n+            return new Object[][] {\n+                    {\"project.version\", readProjectVersion()},\n+                    {\"product-tests.module\", \"presto-product-tests\"},\n+                    {\"server.module\", \"presto-server\"}};", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzgzNTEyNw==", "url": "https://github.com/trinodb/trino/pull/5084#discussion_r483835127", "bodyText": "Move defaultValue = to the end to be consistent with the others", "author": "electrum", "createdAt": "2020-09-04T20:39:55Z", "path": "presto-product-tests-launcher/src/main/java/io/prestosql/tests/product/launcher/cli/TestRun.java", "diffHunk": "@@ -110,7 +108,7 @@ public void run()\n         @Option(names = \"--attach\", description = \"attach to an existing environment\")\n         public boolean attach;\n \n-        @Option(names = \"--reports-dir\", paramLabel = \"<dir>\", defaultValue = TARGET + \"/reports\", description = \"Location of the reports directory \" + DEFAULT_VALUE)\n+        @Option(names = \"--reports-dir\", paramLabel = \"<dir>\", defaultValue = \"${product-tests.module}/target/reports\", description = \"Location of the reports directory \" + DEFAULT_VALUE)", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzgzNTc3Mw==", "url": "https://github.com/trinodb/trino/pull/5084#discussion_r483835773", "bodyText": "I think we need a new server.name variable here in case the server module name is different than the produced tarball name.\n${server.module}/target/${server.name}-${project.version}.tar.gz", "author": "electrum", "createdAt": "2020-09-04T20:41:51Z", "path": "presto-product-tests-launcher/src/main/java/io/prestosql/tests/product/launcher/env/EnvironmentOptions.java", "diffHunk": "@@ -24,7 +24,7 @@\n     @Option(names = \"--config\", paramLabel = \"<config>\", description = \"Environment config to use\")\n     public String config = \"config-default\";\n \n-    @Option(names = \"--server-package\", paramLabel = \"<package>\", description = \"Path to Presto server package \" + DEFAULT_VALUE, defaultValue = \"presto-server/target/presto-server-${project.version}.tar.gz\")\n+    @Option(names = \"--server-package\", paramLabel = \"<package>\", description = \"Path to Presto server package \" + DEFAULT_VALUE, defaultValue = \"${server.module}/target/${server.module}-${project.version}.tar.gz\")", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "ef2c75cfe62a10c78e19f085ae33f79817ce37a7", "url": "https://github.com/trinodb/trino/commit/ef2c75cfe62a10c78e19f085ae33f79817ce37a7", "message": "Configure product tests", "committedDate": "2020-09-04T20:50:07Z", "type": "commit"}, {"oid": "ef2c75cfe62a10c78e19f085ae33f79817ce37a7", "url": "https://github.com/trinodb/trino/commit/ef2c75cfe62a10c78e19f085ae33f79817ce37a7", "message": "Configure product tests", "committedDate": "2020-09-04T20:50:07Z", "type": "forcePushed"}]}