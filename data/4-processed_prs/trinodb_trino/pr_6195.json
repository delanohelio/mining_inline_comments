{"pr_number": 6195, "pr_title": "Allow using legacy Hive view translation logic", "pr_createdAt": "2020-12-03T18:16:24Z", "pr_url": "https://github.com/trinodb/trino/pull/6195", "timeline": [{"oid": "9121f97ccf2118ac37dc997fdc911ebb069370b6", "url": "https://github.com/trinodb/trino/commit/9121f97ccf2118ac37dc997fdc911ebb069370b6", "message": "Pass session to view reader factory", "committedDate": "2020-12-03T17:37:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTQ3MjAzOA==", "url": "https://github.com/trinodb/trino/pull/6195#discussion_r535472038", "bodyText": "I am not super convinced that we need this base class.\nMaybe just leave TestHiveViews as is, and use it for testing default configuration (with Coral).\nAnd add TestHiveViewsLegacy based on how TestHiveViews looked before Coral was introduced.", "author": "losipiuk", "createdAt": "2020-12-03T18:18:04Z", "path": "presto-product-tests/src/main/java/io/prestosql/tests/hive/BaseTestHiveViews.java", "diffHunk": "@@ -38,7 +38,7 @@\n         ImmutableNationTable.class,\n         ImmutableOrdersTable.class,\n })\n-public class TestHiveViews\n+public abstract class BaseTestHiveViews", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTQ5NDAxNQ==", "url": "https://github.com/trinodb/trino/pull/6195#discussion_r535494015", "bodyText": "That would work too.", "author": "findepi", "createdAt": "2020-12-03T18:50:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTQ3MjAzOA=="}], "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTQ5Mjk0OQ==", "url": "https://github.com/trinodb/trino/pull/6195#discussion_r535492949", "bodyText": "static import", "author": "findepi", "createdAt": "2020-12-03T18:49:04Z", "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/ViewReaderUtil.java", "diffHunk": "@@ -65,6 +68,10 @@ public static ViewReader createViewReader(SemiTransactionalHiveMetastore metasto\n         if (isPrestoView(table)) {\n             return new PrestoViewReader();\n         }\n+        if (HiveSessionProperties.isLegacyHiveViewTranslation(session)) {", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTQ5Mzc1Mw==", "url": "https://github.com/trinodb/trino/pull/6195#discussion_r535493753", "bodyText": "Did you mean to inherit these tests from the base class?", "author": "findepi", "createdAt": "2020-12-03T18:50:20Z", "path": "presto-product-tests/src/main/java/io/prestosql/tests/hive/TestHiveViewsLegacy.java", "diffHunk": "@@ -0,0 +1,108 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.prestosql.tests.hive;\n+\n+import io.prestosql.tempto.BeforeTestWithContext;\n+import io.prestosql.tests.utils.QueryExecutors;\n+import org.testng.annotations.Test;\n+\n+import java.math.BigDecimal;\n+\n+import static io.prestosql.tempto.assertions.QueryAssert.Row.row;\n+import static io.prestosql.tempto.assertions.QueryAssert.assertThat;\n+import static io.prestosql.tempto.query.QueryExecutor.query;\n+import static io.prestosql.tests.TestGroups.HIVE_VIEWS;\n+import static io.prestosql.tests.utils.QueryExecutors.onHive;\n+import static io.prestosql.tests.utils.QueryExecutors.onPresto;\n+\n+public class TestHiveViewsLegacy\n+        extends BaseTestHiveViews\n+{\n+    @BeforeTestWithContext\n+    public void setup()\n+    {\n+        // We need to setup sessions for both \"presto\" and \"default\" executors in tempto\n+        onPresto().executeQuery(\"SET SESSION hive.legacy_hive_view_translation = true\");\n+        query(\"SET SESSION hive.legacy_hive_view_translation = true\");\n+    }\n+\n+    @Test(groups = HIVE_VIEWS)\n+    public void testShowCreateView()", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTUyMTIzMg==", "url": "https://github.com/trinodb/trino/pull/6195#discussion_r535521232", "bodyText": "Those are slightly differnt actually.\nOn the second though I decided to just have separate test classes and drop common base.", "author": "losipiuk", "createdAt": "2020-12-03T19:28:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTQ5Mzc1Mw=="}], "type": "inlineReview"}, {"oid": "1883af4b6151d66657746fe40e0fee4ab378164a", "url": "https://github.com/trinodb/trino/commit/1883af4b6151d66657746fe40e0fee4ab378164a", "message": "Allow using legacy Hive view translation logic", "committedDate": "2020-12-03T19:37:05Z", "type": "commit"}, {"oid": "1883af4b6151d66657746fe40e0fee4ab378164a", "url": "https://github.com/trinodb/trino/commit/1883af4b6151d66657746fe40e0fee4ab378164a", "message": "Allow using legacy Hive view translation logic", "committedDate": "2020-12-03T19:37:05Z", "type": "forcePushed"}]}