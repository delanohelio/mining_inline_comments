{"pr_number": 5214, "pr_title": "Fix standard mapping for char exceeding allowed length", "pr_createdAt": "2020-09-18T09:30:17Z", "pr_url": "https://github.com/trinodb/trino/pull/5214", "timeline": [{"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDg0NDA5OQ==", "url": "https://github.com/trinodb/trino/pull/5214#discussion_r490844099", "bodyText": "typo in commit messge", "author": "losipiuk", "createdAt": "2020-09-18T10:09:57Z", "path": "presto-postgresql/src/test/java/io/prestosql/plugin/postgresql/TestPostgreSqlTypeMapping.java", "diffHunk": "@@ -211,17 +211,19 @@ private DataTypeTest varbinaryTestCases(DataType<byte[]> varbinaryDataType)\n     }\n \n     @Test\n-    public void testPrestoCreatedParameterizedVarchar()", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDg0NDczMg==", "url": "https://github.com/trinodb/trino/pull/5214#discussion_r490844732", "bodyText": "not reviewing this one. Assume it is just moving code around.", "author": "losipiuk", "createdAt": "2020-09-18T10:11:12Z", "path": "presto-postgresql/src/test/java/io/prestosql/plugin/postgresql/TestPostgreSqlTypeMapping.java", "diffHunk": "@@ -190,78 +190,44 @@ public void testBasicTypes()\n     }\n \n     @Test\n-    public void testVarbinary()", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDg0ODQyMQ==", "url": "https://github.com/trinodb/trino/pull/5214#discussion_r490848421", "bodyText": "why unbounded? Would bounded varchar, which has higher limit, be more appropriate here?", "author": "losipiuk", "createdAt": "2020-09-18T10:18:53Z", "path": "presto-base-jdbc/src/main/java/io/prestosql/plugin/jdbc/StandardColumnMappings.java", "diffHunk": "@@ -468,9 +467,10 @@ public static LocalTime fromPrestoTime(long value)\n \n             case Types.CHAR:\n             case Types.NCHAR:\n-                // TODO this is wrong, we're going to construct malformed Slice representation if source > charLength\n-                int charLength = min(columnSize, CharType.MAX_LENGTH);\n-                return Optional.of(charColumnMapping(createCharType(charLength)));\n+                if (columnSize > CharType.MAX_LENGTH) {\n+                    return Optional.of(varcharColumnMapping(createUnboundedVarcharType()));", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTQ2NDg0Nw==", "url": "https://github.com/trinodb/trino/pull/5214#discussion_r491464847", "bodyText": "Agree. Will add a TODO, as this should be test-covered", "author": "findepi", "createdAt": "2020-09-19T15:20:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDg0ODQyMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTQ2NjMzOA==", "url": "https://github.com/trinodb/trino/pull/5214#discussion_r491466338", "bodyText": "Implemented as requested", "author": "findepi", "createdAt": "2020-09-19T15:36:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDg0ODQyMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDg3NDAxOA==", "url": "https://github.com/trinodb/trino/pull/5214#discussion_r490874018", "bodyText": "I would make these tests parametric instead. IDE supports to run test with particular parameters which is nice. That it is also cleaner, separate tests are in separate test executions.", "author": "kokosing", "createdAt": "2020-09-18T11:09:44Z", "path": "presto-postgresql/src/test/java/io/prestosql/plugin/postgresql/TestPostgreSqlTypeMapping.java", "diffHunk": "@@ -1271,10 +1272,10 @@ private DataTypeTest hstoreTestCases(DataType<Map<String, String>> varcharMapDat\n     public void testUuid()", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDg3NDQ2MQ==", "url": "https://github.com/trinodb/trino/pull/5214#discussion_r490874461", "bodyText": "Actually it is against the good practice to keep separate test cases in separate tests.\n\nWe usually test all aspects of a type within single test method.\n\nWe do it, and I am not very proud of it.", "author": "kokosing", "createdAt": "2020-09-18T11:10:39Z", "path": "presto-postgresql/src/test/java/io/prestosql/plugin/postgresql/TestPostgreSqlTypeMapping.java", "diffHunk": "@@ -234,38 +236,20 @@ private DataTypeTest varcharDataTypeTest()\n                 .addRoundTrip(varcharDataType(), \"unbounded\");\n     }\n \n-    @Test", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTQ2NTkxOA==", "url": "https://github.com/trinodb/trino/pull/5214#discussion_r491465918", "bodyText": "I am guessing this comment is attached to Merge test methods commit.\nI disagree, at least today. The test mapping test to be quite long, and having a way to reduce number of test methods -- without harming readability -- is useful and helps navigate the class.\nThis  is similar to how we group several test cases in here\nhttps://github.com/prestosql/presto/blob/d54e663db8d819ca4791ab61695f3d26cc0fccfb/presto-tests/src/test/java/io/prestosql/tests/AbstractTestEngineOnlyQueries.java#L246-L272\nI am happy we do not try to invent descriptive names for each of the test cases\n(i like descriptive names, but i believe this is not really doable in a e consistent manner)\nAnyway, I am dropping the  Merge test methods commit (and Reorder test methods) commits here.", "author": "findepi", "createdAt": "2020-09-19T15:32:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDg3NDQ2MQ=="}], "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": "8a349b57d5df1a42fb3342cca9153bea8e76f480", "url": "https://github.com/trinodb/trino/commit/8a349b57d5df1a42fb3342cca9153bea8e76f480", "message": "Test read path before testing round trip", "committedDate": "2020-09-24T14:59:15Z", "type": "commit"}, {"oid": "5e8eff13b8c891c84f0f81f50d932ead0c470f33", "url": "https://github.com/trinodb/trino/commit/5e8eff13b8c891c84f0f81f50d932ead0c470f33", "message": "Consolidate char/varchar tests", "committedDate": "2020-09-24T15:00:39Z", "type": "commit"}, {"oid": "7b359c2c5f986204c5ed43c5c151cb871473a7d4", "url": "https://github.com/trinodb/trino/commit/7b359c2c5f986204c5ed43c5c151cb871473a7d4", "message": "Fix standard mapping for char exceeding allowed length", "committedDate": "2020-09-24T15:00:39Z", "type": "commit"}, {"oid": "7b359c2c5f986204c5ed43c5c151cb871473a7d4", "url": "https://github.com/trinodb/trino/commit/7b359c2c5f986204c5ed43c5c151cb871473a7d4", "message": "Fix standard mapping for char exceeding allowed length", "committedDate": "2020-09-24T15:00:39Z", "type": "forcePushed"}]}