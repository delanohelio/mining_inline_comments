{"pr_number": 6261, "pr_title": "Add legacy hive view translation property to config property table", "pr_createdAt": "2020-12-08T19:32:49Z", "pr_url": "https://github.com/trinodb/trino/pull/6261", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODc4NzYyMA==", "url": "https://github.com/trinodb/trino/pull/6261#discussion_r538787620", "bodyText": "This isn't limited to CTEs. I'm not sure we want to document this at all, since this is a deprecated property that can produce incorrect results. This is really a hidden thing for people who were using the old version and understand the consequences.", "author": "electrum", "createdAt": "2020-12-08T20:35:49Z", "path": "presto-docs/src/main/sphinx/connector/hive.rst", "diffHunk": "@@ -310,6 +310,11 @@ Property Name                                      Description\n                                                    can be used to use a different location for each user.\n \n ``hive.translate-hive-views``                      Enable translation for Hive views. (experimental)            ``false``\n+\n+``hive.legacy-hive-view-translation``              Enable translation for Hive views with CTEs. Set this        ``false``", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODgwNzQ4OQ==", "url": "https://github.com/trinodb/trino/pull/6261#discussion_r538807489", "bodyText": "@willmostly confirmed that the documentation is needed.", "author": "m57lyra", "createdAt": "2020-12-08T21:06:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODc4NzYyMA=="}], "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODg5MDg1Mg==", "url": "https://github.com/trinodb/trino/pull/6261#discussion_r538890852", "bodyText": "I think the descriptions of hive.translate-hive-views and hive.legacy-hive-view-translation might be confusing for new users, since we mention that the first property is as experimental itself and mention the second one as \"legacy\". Also, I think we say experimental, because there're chances that things may evolve/break.\n@electrum Can we take an approach where we fallback to the legacy behavior when coral fails? This can be placed at https://github.com/prestosql/presto/blob/master/presto-hive/src/main/java/io/prestosql/plugin/hive/ViewReaderUtil.java#L183 .", "author": "phd3", "createdAt": "2020-12-08T23:35:35Z", "path": "presto-docs/src/main/sphinx/connector/hive.rst", "diffHunk": "@@ -310,6 +310,13 @@ Property Name                                      Description\n                                                    can be used to use a different location for each user.\n \n ``hive.translate-hive-views``                      Enable translation for Hive views. (experimental)            ``false``\n+\n+``hive.legacy-hive-view-translation``              Use the legacy algorithm to translate Hive views.            ``false``", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODg5MTkxMQ==", "url": "https://github.com/trinodb/trino/pull/6261#discussion_r538891911", "bodyText": "cc @sopel39 @losipiuk", "author": "phd3", "createdAt": "2020-12-08T23:38:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODg5MDg1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODg5NDQxMw==", "url": "https://github.com/trinodb/trino/pull/6261#discussion_r538894413", "bodyText": "It might be even better to have one toggle only ..\nhive.translate-hive-views=false // off\nhive.translate-hive-views=full // or some other value for coral\nhive.translate-hive-views=legacy // for old one\nhive.translate-hive-views=true // would have to sort out what that defaults to .. full or legacy (legacy would be backward compatible.. but less ideal going forward", "author": "mosabua", "createdAt": "2020-12-08T23:44:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODg5MDg1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTE5ODM5MA==", "url": "https://github.com/trinodb/trino/pull/6261#discussion_r539198390", "bodyText": "@electrum Can we take an approach where we fallback to the legacy behavior when coral fails?\n\nEven if we have this I would rather have a way to force old logic. There still can be a case when Coral logic seems to work (automatic fallback does not trigger), but generated translation is not correct.", "author": "losipiuk", "createdAt": "2020-12-09T10:43:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODg5MDg1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTIwMTE2MQ==", "url": "https://github.com/trinodb/trino/pull/6261#discussion_r539201161", "bodyText": "Also, unless we want to change implementation before the 348 release is cut, we should document current state. And this PR is about that.", "author": "losipiuk", "createdAt": "2020-12-09T10:47:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODg5MDg1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTQ5ODM2Ng==", "url": "https://github.com/trinodb/trino/pull/6261#discussion_r539498366", "bodyText": "Correct. Let's make sure the documentation is merged before the release.", "author": "mosabua", "createdAt": "2020-12-09T17:23:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODg5MDg1Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTIwMjk2Nw==", "url": "https://github.com/trinodb/trino/pull/6261#discussion_r539202967", "bodyText": "I would drop the Set this property to ``true`` if you encounter unhandled AST token exceptions with the new experimental algorithm. part but do not feel strongly about it.", "author": "losipiuk", "createdAt": "2020-12-09T10:50:04Z", "path": "presto-docs/src/main/sphinx/connector/hive.rst", "diffHunk": "@@ -310,6 +310,13 @@ Property Name                                      Description\n                                                    can be used to use a different location for each user.\n \n ``hive.translate-hive-views``                      Enable translation for Hive views. (experimental)            ``false``\n+\n+``hive.legacy-hive-view-translation``              Use the legacy algorithm to translate Hive views.            ``false``\n+                                                   Set this property to ``true`` if you encounter unhandled ", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTI4NDQ0OA==", "url": "https://github.com/trinodb/trino/pull/6261#discussion_r539284448", "bodyText": "This is not limited to AST token expcetions (eg #6234), so\nit should be at least e.g., but i think we can remove the \"troubleshooting\" advice from here\ncc @losipiuk", "author": "findepi", "createdAt": "2020-12-09T12:57:28Z", "path": "presto-docs/src/main/sphinx/connector/hive.rst", "diffHunk": "@@ -310,6 +310,13 @@ Property Name                                      Description\n                                                    can be used to use a different location for each user.\n \n ``hive.translate-hive-views``                      Enable translation for Hive views. (experimental)            ``false``\n+\n+``hive.legacy-hive-view-translation``              Use the legacy algorithm to translate Hive views.            ``false``\n+                                                   Set this property to ``true`` if you encounter unhandled \n+                                                   AST token exceptions with the new experimental algorithm. ", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTI4NjUwMw==", "url": "https://github.com/trinodb/trino/pull/6261#discussion_r539286503", "bodyText": "i see know \u0141ukasz suggested the same in #6261 (comment)", "author": "findepi", "createdAt": "2020-12-09T13:00:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTI4NDQ0OA=="}], "type": "inlineReview"}, {"oid": "a14421e58748ba69faaa926d694bc811d95f5a1d", "url": "https://github.com/trinodb/trino/commit/a14421e58748ba69faaa926d694bc811d95f5a1d", "message": "Add legacy hive view translation property to config property table", "committedDate": "2020-12-09T16:35:30Z", "type": "commit"}, {"oid": "a14421e58748ba69faaa926d694bc811d95f5a1d", "url": "https://github.com/trinodb/trino/commit/a14421e58748ba69faaa926d694bc811d95f5a1d", "message": "Add legacy hive view translation property to config property table", "committedDate": "2020-12-09T16:35:30Z", "type": "forcePushed"}]}