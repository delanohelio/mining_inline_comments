{"pr_number": 5326, "pr_title": "Unify and improve TABLE and COLUMN COMMENT tests", "pr_createdAt": "2020-09-28T13:32:24Z", "pr_url": "https://github.com/trinodb/trino/pull/5326", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTk0MzAzNg==", "url": "https://github.com/trinodb/trino/pull/5326#discussion_r495943036", "bodyText": "I marked this final on purpose, to help implementors of connectors outside of the repository to update the code.\nPrevious test suppression model was via test override. This is no longer the way, and the new test version also verifies the connector is correctly reporting lack of support for comments.\nWDYT?", "author": "findepi", "createdAt": "2020-09-28T13:34:33Z", "path": "presto-testing/src/main/java/io/prestosql/testing/AbstractTestDistributedQueries.java", "diffHunk": "@@ -334,44 +339,54 @@ public void testRenameTable()\n     }\n \n     @Test\n-    public void testCommentTable()\n+    public final void testCommentTable()", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTk1NTg3OA==", "url": "https://github.com/trinodb/trino/pull/5326#discussion_r495955878", "bodyText": "The testDelete case shows this can be more subtle.", "author": "findepi", "createdAt": "2020-09-28T13:52:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTk0MzAzNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjUwMTgzOA==", "url": "https://github.com/trinodb/trino/pull/5326#discussion_r496501838", "bodyText": "The testDelete case shows this can be more subtle.\n\nWhy?", "author": "losipiuk", "createdAt": "2020-09-29T08:05:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTk0MzAzNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjgyNTQwNA==", "url": "https://github.com/trinodb/trino/pull/5326#discussion_r496825404", "bodyText": "because supporting a feature is non-binary -- hive supports delertes, but only certain form of them", "author": "findepi", "createdAt": "2020-09-29T15:38:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTk0MzAzNg=="}], "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQ4ODg0OQ==", "url": "https://github.com/trinodb/trino/pull/5326#discussion_r496488849", "bodyText": "Just thinking.\nMaybe instead of having N supports* methods. We could have\nEnumSet<Feature> supportedFeatures()", "author": "losipiuk", "createdAt": "2020-09-29T07:50:44Z", "path": "presto-mysql/src/test/java/io/prestosql/plugin/mysql/TestMySqlDistributedQueries.java", "diffHunk": "@@ -56,6 +56,12 @@ public final void destroy()\n         mysqlServer = null;\n     }\n \n+    @Override", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjUxNTkyNg==", "url": "https://github.com/trinodb/trino/pull/5326#discussion_r496515926", "bodyText": "how would implementation in a subclass look then? a switch?", "author": "findepi", "createdAt": "2020-09-29T08:18:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQ4ODg0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjU1MjE2OA==", "url": "https://github.com/trinodb/trino/pull/5326#discussion_r496552168", "bodyText": "I guess superclass would be\nreturn Features.all()\n\nand in subclass\nreturn Features.allBut(COMMENT_ON_TABLE, COMMENT_ON_COLUMN, ....)", "author": "losipiuk", "createdAt": "2020-09-29T08:56:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQ4ODg0OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQ4OTQxNA==", "url": "https://github.com/trinodb/trino/pull/5326#discussion_r496489414", "bodyText": "\"updates or deletes\" interesting. Does it always come together?", "author": "losipiuk", "createdAt": "2020-09-29T07:51:39Z", "path": "presto-testing/src/main/java/io/prestosql/testing/AbstractTestDistributedQueries.java", "diffHunk": "@@ -609,6 +614,13 @@ public void testDelete()\n         // delete half the table, then delete the rest\n         String tableName = \"test_delete_\" + randomTableSuffix();\n \n+        if (!supportsDelete()) {\n+            assertUpdate(\"CREATE TABLE \" + tableName + \" AS SELECT * FROM orders WITH NO DATA\", 0);\n+            assertQueryFails(\"DELETE FROM \" + tableName, \"This connector does not support updates or deletes\");", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjUxNjYzOQ==", "url": "https://github.com/trinodb/trino/pull/5326#discussion_r496516639", "bodyText": "You can implement delete without update,. but the wording comes from https://github.com/prestosql/presto/blob/88116a4a3fda92f0caa725d9b1a83e9b22f7dcf4/presto-spi/src/main/java/io/prestosql/spi/connector/ConnectorMetadata.java#L482", "author": "findepi", "createdAt": "2020-09-29T08:19:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQ4OTQxNA=="}], "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": "ad67fba556bc1cd7620a6755b7c66b2a84773c36", "url": "https://github.com/trinodb/trino/commit/ad67fba556bc1cd7620a6755b7c66b2a84773c36", "message": "Avoid using 'id' as column name\n\nid is reserved in Cassandra.", "committedDate": "2020-09-30T09:13:03Z", "type": "commit"}, {"oid": "d78c998f8fc8a806b2cecf1e82d374429525df3a", "url": "https://github.com/trinodb/trino/commit/d78c998f8fc8a806b2cecf1e82d374429525df3a", "message": "Use assertions with better message on failure", "committedDate": "2020-09-30T09:13:03Z", "type": "commit"}, {"oid": "4620d0606ebb2fcffa98d5905126906136a19c38", "url": "https://github.com/trinodb/trino/commit/4620d0606ebb2fcffa98d5905126906136a19c38", "message": "Unify and improve TABLE and COLUMN COMMENT tests", "committedDate": "2020-09-30T09:13:37Z", "type": "commit"}, {"oid": "b73ac1a3d8e0b2b639249d15ac1f1a16ab2fc79d", "url": "https://github.com/trinodb/trino/commit/b73ac1a3d8e0b2b639249d15ac1f1a16ab2fc79d", "message": "Suppress testDelete with supportsDelete\n\nThis also adds test coverage when the connector does not support\ndeletes.", "committedDate": "2020-09-30T09:13:37Z", "type": "commit"}, {"oid": "38b7722cbe0365c23b3ef23e28512068de26c83a", "url": "https://github.com/trinodb/trino/commit/38b7722cbe0365c23b3ef23e28512068de26c83a", "message": "Improve test coverage of column/table COMMENT test", "committedDate": "2020-09-30T09:14:28Z", "type": "commit"}, {"oid": "38b7722cbe0365c23b3ef23e28512068de26c83a", "url": "https://github.com/trinodb/trino/commit/38b7722cbe0365c23b3ef23e28512068de26c83a", "message": "Improve test coverage of column/table COMMENT test", "committedDate": "2020-09-30T09:14:28Z", "type": "forcePushed"}]}