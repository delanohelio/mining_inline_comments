{"pr_number": 2853, "pr_title": "Remove redundant remote exchanges due to missing unaliasing", "pr_createdAt": "2020-02-17T09:12:52Z", "pr_url": "https://github.com/trinodb/trino/pull/2853", "timeline": [{"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjI3OTA3MA==", "url": "https://github.com/trinodb/trino/pull/2853#discussion_r382279070", "bodyText": "This should be safe to remove (equi should be on same type), so you can extract this to a preparatory cleanup", "author": "findepi", "createdAt": "2020-02-20T21:54:13Z", "path": "presto-main/src/main/java/io/prestosql/sql/planner/optimizations/UnaliasSymbolReferences.java", "diffHunk": "@@ -521,8 +521,9 @@ public PlanNode visitJoin(JoinNode node, RewriteContext<Void> context)\n \n             if (node.getType() == INNER) {\n                 canonicalCriteria.stream()\n-                        .filter(clause -> types.get(clause.getLeft()).equals(types.get(clause.getRight())))", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjI4MDE0Mg==", "url": "https://github.com/trinodb/trino/pull/2853#discussion_r382280142", "bodyText": "I think this is correct except for RIGHT joins. Maybe map equi-condition symbols to left symbol for all joins except RIGHT, and map to right symbols otherwise?", "author": "findepi", "createdAt": "2020-02-20T21:56:39Z", "path": "presto-main/src/main/java/io/prestosql/sql/planner/optimizations/UnaliasSymbolReferences.java", "diffHunk": "@@ -521,8 +521,9 @@ public PlanNode visitJoin(JoinNode node, RewriteContext<Void> context)\n \n             if (node.getType() == INNER) {\n                 canonicalCriteria.stream()\n-                        .filter(clause -> types.get(clause.getLeft()).equals(types.get(clause.getRight())))\n-                        .filter(clause -> node.getOutputSymbols().contains(clause.getLeft()))\n+                        // Map right equi-condition symbols to left symbols. This helps to\n+                        // reuse join node partitioning better as partitioning properties are\n+                        // only derived from probe side symbols", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjQ3MTE3NQ==", "url": "https://github.com/trinodb/trino/pull/2853#discussion_r382471175", "bodyText": "good catch!", "author": "sopel39", "createdAt": "2020-02-21T09:13:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjI4MDE0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjQ5NjQ1Nw==", "url": "https://github.com/trinodb/trino/pull/2853#discussion_r382496457", "bodyText": "Actually, this is invalid unalias, as one might explicitly check outer equi symbol", "author": "sopel39", "createdAt": "2020-02-21T10:05:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjI4MDE0Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjI4MDIxNw==", "url": "https://github.com/trinodb/trino/pull/2853#discussion_r382280217", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                    // Map right equi-condition symbols to left symbols. This helps to\n          \n          \n            \n                                    // Map right equi-condition symbol to left symbol. This helps to", "author": "findepi", "createdAt": "2020-02-20T21:56:48Z", "path": "presto-main/src/main/java/io/prestosql/sql/planner/optimizations/UnaliasSymbolReferences.java", "diffHunk": "@@ -521,8 +521,9 @@ public PlanNode visitJoin(JoinNode node, RewriteContext<Void> context)\n \n             if (node.getType() == INNER) {\n                 canonicalCriteria.stream()\n-                        .filter(clause -> types.get(clause.getLeft()).equals(types.get(clause.getRight())))\n-                        .filter(clause -> node.getOutputSymbols().contains(clause.getLeft()))\n+                        // Map right equi-condition symbols to left symbols. This helps to", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "b52c7afe5b2edf6633ba8af836a62b4c65861bc8", "url": "https://github.com/trinodb/trino/commit/b52c7afe5b2edf6633ba8af836a62b4c65861bc8", "message": "Remove redundant type check\n\nSymbols used in equi conditions have same types always.", "committedDate": "2020-02-21T09:12:00Z", "type": "commit"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": "6f9bf1890086adb7a7b955de4e8e8556bde2c6a4", "url": "https://github.com/trinodb/trino/commit/6f9bf1890086adb7a7b955de4e8e8556bde2c6a4", "message": "Remove redundant remote exchanges due to missing unaliasing", "committedDate": "2020-02-21T10:06:34Z", "type": "commit"}, {"oid": "6f9bf1890086adb7a7b955de4e8e8556bde2c6a4", "url": "https://github.com/trinodb/trino/commit/6f9bf1890086adb7a7b955de4e8e8556bde2c6a4", "message": "Remove redundant remote exchanges due to missing unaliasing", "committedDate": "2020-02-21T10:06:34Z", "type": "forcePushed"}]}