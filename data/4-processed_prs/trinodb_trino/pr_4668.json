{"pr_number": 4668, "pr_title": "Add schema access rules documentation", "pr_createdAt": "2020-08-02T17:44:42Z", "pr_url": "https://github.com/trinodb/trino/pull/4668", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDEwNjI1Mg==", "url": "https://github.com/trinodb/trino/pull/4668#discussion_r464106252", "bodyText": "This is very \"wordy\". Any simpler suggestions?", "author": "hashhar", "createdAt": "2020-08-02T18:07:49Z", "path": "presto-docs/src/main/sphinx/security/built-in-system-access-control.rst", "diffHunk": "@@ -77,13 +77,15 @@ contents:\n \n The config file is specified in JSON format.\n \n-* It contains the rules defining which catalog can be accessed by which user (see Catalog Rules below).\n+* The catalog rules specifying which catalog can be accessed by which user (see Catalog Rules below).\n+* The schema rules specifying which users have ownership of which schemas (see Schema Rules below).\n+* The table rules specifying which privileges are granted to which users over which tables (see Table Rules below).", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDUzNDUzMw==", "url": "https://github.com/trinodb/trino/pull/4668#discussion_r464534533", "bodyText": "Yes .. something like that .. make sure you have all anchors in place and such.\nIt contains rules that define which users have access to which resources:\n\n* :ref:`Catalogs <catalog-rules>` \n* :ref:`Schemas <schema-rules>`", "author": "mosabua", "createdAt": "2020-08-03T16:48:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDEwNjI1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTUzNDA5MA==", "url": "https://github.com/trinodb/trino/pull/4668#discussion_r465534090", "bodyText": "Done.", "author": "hashhar", "createdAt": "2020-08-05T07:40:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDEwNjI1Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDEwNjY3Nw==", "url": "https://github.com/trinodb/trino/pull/4668#discussion_r464106677", "bodyText": "With the way the table rules are actually evaluated in the built-in SAC means that by if no table rules are provided all users are assumed to have all privileges (documented now in this PR).\nIn addition to this all tables in information_schema are always allowed regardless of the rules in the config file. Should this be documented?", "author": "hashhar", "createdAt": "2020-08-02T18:10:28Z", "path": "presto-docs/src/main/sphinx/security/built-in-system-access-control.rst", "diffHunk": "@@ -169,6 +171,55 @@ following rules:\n For group-based rules to match, users need to be assigned to groups by a\n :doc:`/develop/group-provider`.\n \n+.. _schema_rules:\n+\n+Schema Rules\n+------------\n+\n+These rules govern who is considered an owner of a schema. The user is granted\n+the privileges based on the first matching rule read from top to bottom. If no\n+rule matches, the user is not considered an owner of the schema. Each rule is\n+composed of the following fields:\n+\n+* ``user`` (optional): regex to match against user name. Defaults to ``.*``.\n+* ``group`` (optional): regex to match against group names. Defaults to ``.*``.\n+* ``schema`` (optional): regex to match against schema names. Defaults to ``.*``.\n+* ``owner`` (required): boolean indicating whether the user is to be considered\n+  an owner of the schema. Defaults to ``false``.\n+\n+For example, to provide ownership of all schemas to user ``admin``, treat all\n+users as owners of ``default`` schema and prevent user ``guest`` from ownership\n+of any schema, you can use the following rules:\n+\n+.. literalinclude:: schema-access.json\n+    :language: json\n+\n+.. _table_rules:\n+\n+Table Rules", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDYyMjAyNg==", "url": "https://github.com/trinodb/trino/pull/4668#discussion_r464622026", "bodyText": "information schema behavior should be documented", "author": "mosabua", "createdAt": "2020-08-03T19:38:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDEwNjY3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTUzNDMwNw==", "url": "https://github.com/trinodb/trino/pull/4668#discussion_r465534307", "bodyText": "Documented within a note in the section (similar to catalog rules).", "author": "hashhar", "createdAt": "2020-08-05T07:40:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDEwNjY3Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDUzNTU1Mw==", "url": "https://github.com/trinodb/trino/pull/4668#discussion_r464535553", "bodyText": "This whole sentence can be removed after the above list is done and contains all of these.", "author": "mosabua", "createdAt": "2020-08-03T16:50:15Z", "path": "presto-docs/src/main/sphinx/security/built-in-system-access-control.rst", "diffHunk": "@@ -77,13 +77,15 @@ contents:\n \n The config file is specified in JSON format.\n \n-* It contains the rules defining which catalog can be accessed by which user (see Catalog Rules below).\n+* The catalog rules specifying which catalog can be accessed by which user (see Catalog Rules below).\n+* The schema rules specifying which users have ownership of which schemas (see Schema Rules below).\n+* The table rules specifying which privileges are granted to which users over which tables (see Table Rules below).\n * The query rules specifying which queries can be managed by which user (see Query Rules below).\n * The impersonation rules specify which user impersonations are allowed (see Impersonation Rules below).\n * The principal rules specifying what principals can identify as what users (see Principal Rules below).\n * The system information rules specifying what users can access system management information (see System Information Rules below).\n \n-This plugin currently supports catalog access, query, impersonation, principal, and system information\n+This plugin currently supports catalog, schema, table access, query, impersonation, principal, and system information", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTUzNDM1OQ==", "url": "https://github.com/trinodb/trino/pull/4668#discussion_r465534359", "bodyText": "Done.", "author": "hashhar", "createdAt": "2020-08-05T07:40:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDUzNTU1Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDYyMTcyNA==", "url": "https://github.com/trinodb/trino/pull/4668#discussion_r464621724", "bodyText": "Personally I would just inline the code snippet in a code block .. wdyt @electrum ?", "author": "mosabua", "createdAt": "2020-08-03T19:37:48Z", "path": "presto-docs/src/main/sphinx/security/built-in-system-access-control.rst", "diffHunk": "@@ -169,6 +171,55 @@ following rules:\n For group-based rules to match, users need to be assigned to groups by a\n :doc:`/develop/group-provider`.\n \n+.. _schema_rules:\n+\n+Schema Rules\n+------------\n+\n+These rules govern who is considered an owner of a schema. The user is granted\n+the privileges based on the first matching rule read from top to bottom. If no\n+rule matches, the user is not considered an owner of the schema. Each rule is\n+composed of the following fields:\n+\n+* ``user`` (optional): regex to match against user name. Defaults to ``.*``.\n+* ``group`` (optional): regex to match against group names. Defaults to ``.*``.\n+* ``schema`` (optional): regex to match against schema names. Defaults to ``.*``.\n+* ``owner`` (required): boolean indicating whether the user is to be considered\n+  an owner of the schema. Defaults to ``false``.\n+\n+For example, to provide ownership of all schemas to user ``admin``, treat all\n+users as owners of ``default`` schema and prevent user ``guest`` from ownership\n+of any schema, you can use the following rules:\n+\n+.. literalinclude:: schema-access.json", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzE2NTcwMA==", "url": "https://github.com/trinodb/trino/pull/4668#discussion_r467165700", "bodyText": "Agreed, this seems preferable here.", "author": "electrum", "createdAt": "2020-08-07T17:11:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDYyMTcyNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDYyMjc5Mw==", "url": "https://github.com/trinodb/trino/pull/4668#discussion_r464622793", "bodyText": "The matching being done in order applies to all rules and should be explained in an earlier section.", "author": "mosabua", "createdAt": "2020-08-03T19:40:09Z", "path": "presto-docs/src/main/sphinx/security/built-in-system-access-control.rst", "diffHunk": "@@ -169,6 +171,55 @@ following rules:\n For group-based rules to match, users need to be assigned to groups by a\n :doc:`/develop/group-provider`.\n \n+.. _schema_rules:\n+\n+Schema Rules\n+------------\n+\n+These rules govern who is considered an owner of a schema. The user is granted\n+the privileges based on the first matching rule read from top to bottom. If no", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTUzNDc3Nw==", "url": "https://github.com/trinodb/trino/pull/4668#discussion_r465534777", "bodyText": "Explained after the list of rules ends and have removed the mention of the ordering from each individual rule to avoid repetition.", "author": "hashhar", "createdAt": "2020-08-05T07:41:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDYyMjc5Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDYyMzQzNA==", "url": "https://github.com/trinodb/trino/pull/4668#discussion_r464623434", "bodyText": "Schema rules allow you to grant ownership of a schema.", "author": "mosabua", "createdAt": "2020-08-03T19:41:28Z", "path": "presto-docs/src/main/sphinx/security/built-in-system-access-control.rst", "diffHunk": "@@ -169,6 +171,55 @@ following rules:\n For group-based rules to match, users need to be assigned to groups by a\n :doc:`/develop/group-provider`.\n \n+.. _schema_rules:\n+\n+Schema Rules\n+------------\n+\n+These rules govern who is considered an owner of a schema. The user is granted", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDYyMzY5NQ==", "url": "https://github.com/trinodb/trino/pull/4668#discussion_r464623695", "bodyText": "As a next sentence we should document what ownership of a schema means..", "author": "mosabua", "createdAt": "2020-08-03T19:42:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDYyMzQzNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTUzNTQxMw==", "url": "https://github.com/trinodb/trino/pull/4668#discussion_r465535413", "bodyText": "Changed to:\n\nThese rules allow you to grant ownership of a schema. Having ownership of an\nschema allows users to execute DROP SCHEMA, ALTER SCHEMA (both renaming\nand setting authorization), SHOW CREATE SCHEMA.", "author": "hashhar", "createdAt": "2020-08-05T07:42:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDYyMzQzNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDYyMzkyOA==", "url": "https://github.com/trinodb/trino/pull/4668#discussion_r464623928", "bodyText": "Tables rules define privileges for table access.", "author": "mosabua", "createdAt": "2020-08-03T19:42:38Z", "path": "presto-docs/src/main/sphinx/security/built-in-system-access-control.rst", "diffHunk": "@@ -169,6 +171,55 @@ following rules:\n For group-based rules to match, users need to be assigned to groups by a\n :doc:`/develop/group-provider`.\n \n+.. _schema_rules:\n+\n+Schema Rules\n+------------\n+\n+These rules govern who is considered an owner of a schema. The user is granted\n+the privileges based on the first matching rule read from top to bottom. If no\n+rule matches, the user is not considered an owner of the schema. Each rule is\n+composed of the following fields:\n+\n+* ``user`` (optional): regex to match against user name. Defaults to ``.*``.\n+* ``group`` (optional): regex to match against group names. Defaults to ``.*``.\n+* ``schema`` (optional): regex to match against schema names. Defaults to ``.*``.\n+* ``owner`` (required): boolean indicating whether the user is to be considered\n+  an owner of the schema. Defaults to ``false``.\n+\n+For example, to provide ownership of all schemas to user ``admin``, treat all\n+users as owners of ``default`` schema and prevent user ``guest`` from ownership\n+of any schema, you can use the following rules:\n+\n+.. literalinclude:: schema-access.json\n+    :language: json\n+\n+.. _table_rules:\n+\n+Table Rules\n+-----------\n+\n+These rules govern the privileges granted to users on tables. The user is", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTUzNTUzMQ==", "url": "https://github.com/trinodb/trino/pull/4668#discussion_r465535531", "bodyText": "Done.", "author": "hashhar", "createdAt": "2020-08-05T07:43:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDYyMzkyOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDYyNDcwNg==", "url": "https://github.com/trinodb/trino/pull/4668#discussion_r464624706", "bodyText": "Break this sentence up into a list of what happens... something like:\nThe following rules define the following table access:\n\ngrant all privileges to the user admin on all tables in all schemas\n...", "author": "mosabua", "createdAt": "2020-08-03T19:44:30Z", "path": "presto-docs/src/main/sphinx/security/built-in-system-access-control.rst", "diffHunk": "@@ -169,6 +171,55 @@ following rules:\n For group-based rules to match, users need to be assigned to groups by a\n :doc:`/develop/group-provider`.\n \n+.. _schema_rules:\n+\n+Schema Rules\n+------------\n+\n+These rules govern who is considered an owner of a schema. The user is granted\n+the privileges based on the first matching rule read from top to bottom. If no\n+rule matches, the user is not considered an owner of the schema. Each rule is\n+composed of the following fields:\n+\n+* ``user`` (optional): regex to match against user name. Defaults to ``.*``.\n+* ``group`` (optional): regex to match against group names. Defaults to ``.*``.\n+* ``schema`` (optional): regex to match against schema names. Defaults to ``.*``.\n+* ``owner`` (required): boolean indicating whether the user is to be considered\n+  an owner of the schema. Defaults to ``false``.\n+\n+For example, to provide ownership of all schemas to user ``admin``, treat all\n+users as owners of ``default`` schema and prevent user ``guest`` from ownership\n+of any schema, you can use the following rules:\n+\n+.. literalinclude:: schema-access.json\n+    :language: json\n+\n+.. _table_rules:\n+\n+Table Rules\n+-----------\n+\n+These rules govern the privileges granted to users on tables. The user is\n+granted the privileges based on the first matching rule read from top to\n+bottom. If no rule matches, the user is assumed to have no privileges on the\n+table. If no table rules are specified, all users are treated as having all\n+privileges by default. Each rule is composed of the following fields:\n+\n+* ``user`` (optional): regex to match against user name. Defaults to ``.*``.\n+* ``group`` (optional): regex to match against group names. Defaults to ``.*``.\n+* ``schema`` (optional): regex to match against schema names. Defaults to ``.*``.\n+* ``table`` (optional): regex to match against table names. Defaults to ``.*``.\n+* ``privileges`` (required): zero or more of ``SELECT``, ``INSERT``,\n+  ``DELETE``, ``OWNERSHIP``, ``GRANT_SELECT``\n+\n+For example, to allow a user ``admin`` all privileges on all tables in all", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTUxMTk1MQ==", "url": "https://github.com/trinodb/trino/pull/4668#discussion_r465511951", "bodyText": "Should I make this change to other rules too to be consistent?", "author": "hashhar", "createdAt": "2020-08-05T06:54:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDYyNDcwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTk3NTU1Ng==", "url": "https://github.com/trinodb/trino/pull/4668#discussion_r465975556", "bodyText": "Lets just do it here only for now", "author": "mosabua", "createdAt": "2020-08-05T20:10:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDYyNDcwNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDYyNDgwMA==", "url": "https://github.com/trinodb/trino/pull/4668#discussion_r464624800", "bodyText": "Probably also inline", "author": "mosabua", "createdAt": "2020-08-03T19:44:43Z", "path": "presto-docs/src/main/sphinx/security/built-in-system-access-control.rst", "diffHunk": "@@ -169,6 +171,55 @@ following rules:\n For group-based rules to match, users need to be assigned to groups by a\n :doc:`/develop/group-provider`.\n \n+.. _schema_rules:\n+\n+Schema Rules\n+------------\n+\n+These rules govern who is considered an owner of a schema. The user is granted\n+the privileges based on the first matching rule read from top to bottom. If no\n+rule matches, the user is not considered an owner of the schema. Each rule is\n+composed of the following fields:\n+\n+* ``user`` (optional): regex to match against user name. Defaults to ``.*``.\n+* ``group`` (optional): regex to match against group names. Defaults to ``.*``.\n+* ``schema`` (optional): regex to match against schema names. Defaults to ``.*``.\n+* ``owner`` (required): boolean indicating whether the user is to be considered\n+  an owner of the schema. Defaults to ``false``.\n+\n+For example, to provide ownership of all schemas to user ``admin``, treat all\n+users as owners of ``default`` schema and prevent user ``guest`` from ownership\n+of any schema, you can use the following rules:\n+\n+.. literalinclude:: schema-access.json\n+    :language: json\n+\n+.. _table_rules:\n+\n+Table Rules\n+-----------\n+\n+These rules govern the privileges granted to users on tables. The user is\n+granted the privileges based on the first matching rule read from top to\n+bottom. If no rule matches, the user is assumed to have no privileges on the\n+table. If no table rules are specified, all users are treated as having all\n+privileges by default. Each rule is composed of the following fields:\n+\n+* ``user`` (optional): regex to match against user name. Defaults to ``.*``.\n+* ``group`` (optional): regex to match against group names. Defaults to ``.*``.\n+* ``schema`` (optional): regex to match against schema names. Defaults to ``.*``.\n+* ``table`` (optional): regex to match against table names. Defaults to ``.*``.\n+* ``privileges`` (required): zero or more of ``SELECT``, ``INSERT``,\n+  ``DELETE``, ``OWNERSHIP``, ``GRANT_SELECT``\n+\n+For example, to allow a user ``admin`` all privileges on all tables in all\n+schemas, disallow all privileges to user ``banned_user`` and allow ``SELECT``\n+privileges to all users on any table in ``default`` schema, you can use the\n+following rules:\n+\n+.. literalinclude:: table-access.json", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzE2MzQxOA==", "url": "https://github.com/trinodb/trino/pull/4668#discussion_r467163418", "bodyText": "Agreed, these are short, and we're not referencing them in unit tests, so inline seems easier to read and maintain", "author": "electrum", "createdAt": "2020-08-07T17:06:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDYyNDgwMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzE2MzEzMQ==", "url": "https://github.com/trinodb/trino/pull/4668#discussion_r467163131", "bodyText": "We should avoid adding refs for links within the same document. They duplicate the built-in anchors for section titles, and the names are global within Sphinx, so care must be taken when naming. Instead, you can link to the built-in section anchors:\n* `Catalogs <#catalog-rules>`__", "author": "electrum", "createdAt": "2020-08-07T17:06:13Z", "path": "presto-docs/src/main/sphinx/security/built-in-system-access-control.rst", "diffHunk": "@@ -75,18 +75,23 @@ contents:\n    access-control.name=file\n    security.config-file=etc/rules.json\n \n-The config file is specified in JSON format.\n+The config file is specified in JSON format. It contains rules that define\n+which users have access to which resources:\n \n-* It contains the rules defining which catalog can be accessed by which user (see Catalog Rules below).\n-* The query rules specifying which queries can be managed by which user (see Query Rules below).\n-* The impersonation rules specify which user impersonations are allowed (see Impersonation Rules below).\n-* The principal rules specifying what principals can identify as what users (see Principal Rules below).\n-* The system information rules specifying what users can access system management information (see System Information Rules below).\n+* :ref:`Catalogs <catalog_rules>`", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzE2NDAwOA==", "url": "https://github.com/trinodb/trino/pull/4668#discussion_r467164008", "bodyText": "Let's write this as\nyou must implement a custom :doc:`/develop/system-access-control`.", "author": "electrum", "createdAt": "2020-08-07T17:08:03Z", "path": "presto-docs/src/main/sphinx/security/built-in-system-access-control.rst", "diffHunk": "@@ -75,18 +75,23 @@ contents:\n    access-control.name=file\n    security.config-file=etc/rules.json\n \n-The config file is specified in JSON format.\n+The config file is specified in JSON format. It contains rules that define\n+which users have access to which resources:\n \n-* It contains the rules defining which catalog can be accessed by which user (see Catalog Rules below).\n-* The query rules specifying which queries can be managed by which user (see Query Rules below).\n-* The impersonation rules specify which user impersonations are allowed (see Impersonation Rules below).\n-* The principal rules specifying what principals can identify as what users (see Principal Rules below).\n-* The system information rules specifying what users can access system management information (see System Information Rules below).\n+* :ref:`Catalogs <catalog_rules>`\n+* :ref:`Schemas <schema_rules>`\n+* :ref:`Tables <table_rules>`\n+* :ref:`Queries <query_rules>`\n+* :ref:`Impersonation <impersonation_rules>`\n+* :ref:`Principals <principal_rules>`\n+* :ref:`System Information <system_information_rules>`\n \n-This plugin currently supports catalog access, query, impersonation, principal, and system information\n-rules. If you want to limit access on a system level in any other way, you\n-must implement a custom SystemAccessControl plugin\n-(see :doc:`/develop/system-access-control`).\n+The rules are read from top to bottom and the first matching rule\n+is applied. If no rule matches, access is denied.\n+\n+If you want to limit access on a system level in any other way than the ones\n+listed above, you must implement a custom SystemAccessControl plugin (see", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzE2NDg4Mw==", "url": "https://github.com/trinodb/trino/pull/4668#discussion_r467164883", "bodyText": "Add \"and\" before last item in list", "author": "electrum", "createdAt": "2020-08-07T17:09:46Z", "path": "presto-docs/src/main/sphinx/security/built-in-system-access-control.rst", "diffHunk": "@@ -169,14 +173,65 @@ following rules:\n For group-based rules to match, users need to be assigned to groups by a\n :doc:`/develop/group-provider`.\n \n+.. _schema_rules:\n+\n+Schema Rules\n+------------\n+\n+These rules allow you to grant ownership of a schema. Having ownership of an\n+schema allows users to execute ``DROP SCHEMA``, ``ALTER SCHEMA`` (both renaming\n+and setting authorization), ``SHOW CREATE SCHEMA``. Each rule is composed of", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzE2NTMxMw==", "url": "https://github.com/trinodb/trino/pull/4668#discussion_r467165313", "bodyText": "name -> names\nSince there is only one schema to match (in the context of the rule)", "author": "electrum", "createdAt": "2020-08-07T17:10:38Z", "path": "presto-docs/src/main/sphinx/security/built-in-system-access-control.rst", "diffHunk": "@@ -169,14 +173,65 @@ following rules:\n For group-based rules to match, users need to be assigned to groups by a\n :doc:`/develop/group-provider`.\n \n+.. _schema_rules:\n+\n+Schema Rules\n+------------\n+\n+These rules allow you to grant ownership of a schema. Having ownership of an\n+schema allows users to execute ``DROP SCHEMA``, ``ALTER SCHEMA`` (both renaming\n+and setting authorization), ``SHOW CREATE SCHEMA``. Each rule is composed of\n+the following fields:\n+\n+* ``user`` (optional): regex to match against user name. Defaults to ``.*``.\n+* ``group`` (optional): regex to match against group names. Defaults to ``.*``.\n+* ``schema`` (optional): regex to match against schema names. Defaults to ``.*``.", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzE2NTgzOQ==", "url": "https://github.com/trinodb/trino/pull/4668#discussion_r467165839", "bodyText": "names -> name", "author": "electrum", "createdAt": "2020-08-07T17:11:43Z", "path": "presto-docs/src/main/sphinx/security/built-in-system-access-control.rst", "diffHunk": "@@ -169,14 +173,65 @@ following rules:\n For group-based rules to match, users need to be assigned to groups by a\n :doc:`/develop/group-provider`.\n \n+.. _schema_rules:\n+\n+Schema Rules\n+------------\n+\n+These rules allow you to grant ownership of a schema. Having ownership of an\n+schema allows users to execute ``DROP SCHEMA``, ``ALTER SCHEMA`` (both renaming\n+and setting authorization), ``SHOW CREATE SCHEMA``. Each rule is composed of\n+the following fields:\n+\n+* ``user`` (optional): regex to match against user name. Defaults to ``.*``.\n+* ``group`` (optional): regex to match against group names. Defaults to ``.*``.\n+* ``schema`` (optional): regex to match against schema names. Defaults to ``.*``.\n+* ``owner`` (required): boolean indicating whether the user is to be considered\n+  an owner of the schema. Defaults to ``false``.\n+\n+For example, to provide ownership of all schemas to user ``admin``, treat all\n+users as owners of ``default`` schema and prevent user ``guest`` from ownership\n+of any schema, you can use the following rules:\n+\n+.. literalinclude:: schema-access.json\n+    :language: json\n+\n+.. _table_rules:\n+\n+Table Rules\n+-----------\n+\n+These rules define the privileges for table access for users. If no table rules\n+are specified, all users are treated as having all privileges by default. Each\n+rule is composed of the following fields:\n+\n+* ``user`` (optional): regex to match against user name. Defaults to ``.*``.\n+* ``group`` (optional): regex to match against group names. Defaults to ``.*``.\n+* ``schema`` (optional): regex to match against schema names. Defaults to ``.*``.", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzI0MDUzMg==", "url": "https://github.com/trinodb/trino/pull/4668#discussion_r467240532", "bodyText": "This seems misleading, since metadata access like information_schema has its own security restrictions. Perhaps this should say\n.. note:: These rules do not apply to ``information_schema``.", "author": "electrum", "createdAt": "2020-08-07T19:54:50Z", "path": "presto-docs/src/main/sphinx/security/built-in-system-access-control.rst", "diffHunk": "@@ -169,14 +173,65 @@ following rules:\n For group-based rules to match, users need to be assigned to groups by a\n :doc:`/develop/group-provider`.\n \n+.. _schema_rules:\n+\n+Schema Rules\n+------------\n+\n+These rules allow you to grant ownership of a schema. Having ownership of an\n+schema allows users to execute ``DROP SCHEMA``, ``ALTER SCHEMA`` (both renaming\n+and setting authorization), ``SHOW CREATE SCHEMA``. Each rule is composed of\n+the following fields:\n+\n+* ``user`` (optional): regex to match against user name. Defaults to ``.*``.\n+* ``group`` (optional): regex to match against group names. Defaults to ``.*``.\n+* ``schema`` (optional): regex to match against schema names. Defaults to ``.*``.\n+* ``owner`` (required): boolean indicating whether the user is to be considered\n+  an owner of the schema. Defaults to ``false``.\n+\n+For example, to provide ownership of all schemas to user ``admin``, treat all\n+users as owners of ``default`` schema and prevent user ``guest`` from ownership\n+of any schema, you can use the following rules:\n+\n+.. literalinclude:: schema-access.json\n+    :language: json\n+\n+.. _table_rules:\n+\n+Table Rules\n+-----------\n+\n+These rules define the privileges for table access for users. If no table rules\n+are specified, all users are treated as having all privileges by default. Each\n+rule is composed of the following fields:\n+\n+* ``user`` (optional): regex to match against user name. Defaults to ``.*``.\n+* ``group`` (optional): regex to match against group names. Defaults to ``.*``.\n+* ``schema`` (optional): regex to match against schema names. Defaults to ``.*``.\n+* ``table`` (optional): regex to match against table names. Defaults to ``.*``.\n+* ``privileges`` (required): zero or more of ``SELECT``, ``INSERT``,\n+  ``DELETE``, ``OWNERSHIP``, ``GRANT_SELECT``\n+\n+.. note::\n+\n+    Users always have all privileges on all tables in the ``information_schema``.", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzI0MTA0OQ==", "url": "https://github.com/trinodb/trino/pull/4668#discussion_r467241049", "bodyText": "The example below defines the following table access policy:", "author": "electrum", "createdAt": "2020-08-07T19:55:55Z", "path": "presto-docs/src/main/sphinx/security/built-in-system-access-control.rst", "diffHunk": "@@ -169,14 +173,65 @@ following rules:\n For group-based rules to match, users need to be assigned to groups by a\n :doc:`/develop/group-provider`.\n \n+.. _schema_rules:\n+\n+Schema Rules\n+------------\n+\n+These rules allow you to grant ownership of a schema. Having ownership of an\n+schema allows users to execute ``DROP SCHEMA``, ``ALTER SCHEMA`` (both renaming\n+and setting authorization), ``SHOW CREATE SCHEMA``. Each rule is composed of\n+the following fields:\n+\n+* ``user`` (optional): regex to match against user name. Defaults to ``.*``.\n+* ``group`` (optional): regex to match against group names. Defaults to ``.*``.\n+* ``schema`` (optional): regex to match against schema names. Defaults to ``.*``.\n+* ``owner`` (required): boolean indicating whether the user is to be considered\n+  an owner of the schema. Defaults to ``false``.\n+\n+For example, to provide ownership of all schemas to user ``admin``, treat all\n+users as owners of ``default`` schema and prevent user ``guest`` from ownership\n+of any schema, you can use the following rules:\n+\n+.. literalinclude:: schema-access.json\n+    :language: json\n+\n+.. _table_rules:\n+\n+Table Rules\n+-----------\n+\n+These rules define the privileges for table access for users. If no table rules\n+are specified, all users are treated as having all privileges by default. Each\n+rule is composed of the following fields:\n+\n+* ``user`` (optional): regex to match against user name. Defaults to ``.*``.\n+* ``group`` (optional): regex to match against group names. Defaults to ``.*``.\n+* ``schema`` (optional): regex to match against schema names. Defaults to ``.*``.\n+* ``table`` (optional): regex to match against table names. Defaults to ``.*``.\n+* ``privileges`` (required): zero or more of ``SELECT``, ``INSERT``,\n+  ``DELETE``, ``OWNERSHIP``, ``GRANT_SELECT``\n+\n+.. note::\n+\n+    Users always have all privileges on all tables in the ``information_schema``.\n+\n+The following rules define the following table access policy:", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzI0MTg5OA==", "url": "https://github.com/trinodb/trino/pull/4668#discussion_r467241898", "bodyText": "It's fine to repeat the \"top to bottom\" information here. A user might visit this section directly, without having read the introduction at the top. It's one extra sentence, so repeating it doesn't hurt readability, and serves to reinforce the concept.", "author": "electrum", "createdAt": "2020-08-07T19:57:45Z", "path": "presto-docs/src/main/sphinx/security/built-in-system-access-control.rst", "diffHunk": "@@ -99,14 +104,13 @@ Presto restart. The refresh period is specified in the ``etc/access-control.prop\n \n    security.refresh-period=1s\n \n+.. _catalog_rules:\n \n Catalog Rules\n -------------\n \n-These rules govern the catalogs particular users can access. The user is", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzI0MjQ3NQ==", "url": "https://github.com/trinodb/trino/pull/4668#discussion_r467242475", "bodyText": "Let's add the \"top to bottom\" information here to be consistent with other sections.", "author": "electrum", "createdAt": "2020-08-07T19:59:11Z", "path": "presto-docs/src/main/sphinx/security/built-in-system-access-control.rst", "diffHunk": "@@ -169,14 +173,65 @@ following rules:\n For group-based rules to match, users need to be assigned to groups by a\n :doc:`/develop/group-provider`.\n \n+.. _schema_rules:\n+\n+Schema Rules\n+------------\n+\n+These rules allow you to grant ownership of a schema. Having ownership of an", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzI0MjU1NA==", "url": "https://github.com/trinodb/trino/pull/4668#discussion_r467242554", "bodyText": "Add \"top to bottom\"", "author": "electrum", "createdAt": "2020-08-07T19:59:21Z", "path": "presto-docs/src/main/sphinx/security/built-in-system-access-control.rst", "diffHunk": "@@ -169,14 +173,65 @@ following rules:\n For group-based rules to match, users need to be assigned to groups by a\n :doc:`/develop/group-provider`.\n \n+.. _schema_rules:\n+\n+Schema Rules\n+------------\n+\n+These rules allow you to grant ownership of a schema. Having ownership of an\n+schema allows users to execute ``DROP SCHEMA``, ``ALTER SCHEMA`` (both renaming\n+and setting authorization), ``SHOW CREATE SCHEMA``. Each rule is composed of\n+the following fields:\n+\n+* ``user`` (optional): regex to match against user name. Defaults to ``.*``.\n+* ``group`` (optional): regex to match against group names. Defaults to ``.*``.\n+* ``schema`` (optional): regex to match against schema names. Defaults to ``.*``.\n+* ``owner`` (required): boolean indicating whether the user is to be considered\n+  an owner of the schema. Defaults to ``false``.\n+\n+For example, to provide ownership of all schemas to user ``admin``, treat all\n+users as owners of ``default`` schema and prevent user ``guest`` from ownership\n+of any schema, you can use the following rules:\n+\n+.. literalinclude:: schema-access.json\n+    :language: json\n+\n+.. _table_rules:\n+\n+Table Rules\n+-----------\n+\n+These rules define the privileges for table access for users. If no table rules", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzI0MjYwNg==", "url": "https://github.com/trinodb/trino/pull/4668#discussion_r467242606", "bodyText": "Same, keep \"top to bottom\"", "author": "electrum", "createdAt": "2020-08-07T19:59:30Z", "path": "presto-docs/src/main/sphinx/security/built-in-system-access-control.rst", "diffHunk": "@@ -169,14 +173,65 @@ following rules:\n For group-based rules to match, users need to be assigned to groups by a\n :doc:`/develop/group-provider`.\n \n+.. _schema_rules:\n+\n+Schema Rules\n+------------\n+\n+These rules allow you to grant ownership of a schema. Having ownership of an\n+schema allows users to execute ``DROP SCHEMA``, ``ALTER SCHEMA`` (both renaming\n+and setting authorization), ``SHOW CREATE SCHEMA``. Each rule is composed of\n+the following fields:\n+\n+* ``user`` (optional): regex to match against user name. Defaults to ``.*``.\n+* ``group`` (optional): regex to match against group names. Defaults to ``.*``.\n+* ``schema`` (optional): regex to match against schema names. Defaults to ``.*``.\n+* ``owner`` (required): boolean indicating whether the user is to be considered\n+  an owner of the schema. Defaults to ``false``.\n+\n+For example, to provide ownership of all schemas to user ``admin``, treat all\n+users as owners of ``default`` schema and prevent user ``guest`` from ownership\n+of any schema, you can use the following rules:\n+\n+.. literalinclude:: schema-access.json\n+    :language: json\n+\n+.. _table_rules:\n+\n+Table Rules\n+-----------\n+\n+These rules define the privileges for table access for users. If no table rules\n+are specified, all users are treated as having all privileges by default. Each\n+rule is composed of the following fields:\n+\n+* ``user`` (optional): regex to match against user name. Defaults to ``.*``.\n+* ``group`` (optional): regex to match against group names. Defaults to ``.*``.\n+* ``schema`` (optional): regex to match against schema names. Defaults to ``.*``.\n+* ``table`` (optional): regex to match against table names. Defaults to ``.*``.\n+* ``privileges`` (required): zero or more of ``SELECT``, ``INSERT``,\n+  ``DELETE``, ``OWNERSHIP``, ``GRANT_SELECT``\n+\n+.. note::\n+\n+    Users always have all privileges on all tables in the ``information_schema``.\n+\n+The following rules define the following table access policy:\n+\n+* User ``admin`` has all privileges across all tables and schemas\n+* User ``banned_user`` has no privileges\n+* All users have ``SELECT`` privileges on all tables in ``default`` schema\n+\n+.. literalinclude:: table-access.json\n+    :language: json\n+\n .. _query_rules:\n \n Query Rules\n -----------\n \n-These rules control the ability of a user to execute, view, or kill a query. The user is", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzI0MjY3NA==", "url": "https://github.com/trinodb/trino/pull/4668#discussion_r467242674", "bodyText": "Same, keep \"top to bottom\"", "author": "electrum", "createdAt": "2020-08-07T19:59:39Z", "path": "presto-docs/src/main/sphinx/security/built-in-system-access-control.rst", "diffHunk": "@@ -207,8 +262,7 @@ authenticates using their credentials, and then submits a query as a different\n user.  When the user context is changed, Presto will verify the administrator\n is authorized to run queries as the target user.\n \n-When these rules are present, the authorization is based on the first matching rule,", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzI0MjY5Mg==", "url": "https://github.com/trinodb/trino/pull/4668#discussion_r467242692", "bodyText": "Same, keep \"top to bottom\"", "author": "electrum", "createdAt": "2020-08-07T19:59:42Z", "path": "presto-docs/src/main/sphinx/security/built-in-system-access-control.rst", "diffHunk": "@@ -317,8 +371,7 @@ System Information Rules\n ------------------------\n \n These rules specify which users can access the system information management interface.\n-The user is granted or denied access, based on the first matching rule read from top to", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "11c3337c8b1a14fbd3a6d6093b35728b7bf3b8c0", "url": "https://github.com/trinodb/trino/commit/11c3337c8b1a14fbd3a6d6093b35728b7bf3b8c0", "message": "Add schema and table access rules documentation\n\nFixes #4665", "committedDate": "2020-08-07T21:17:59Z", "type": "commit"}]}