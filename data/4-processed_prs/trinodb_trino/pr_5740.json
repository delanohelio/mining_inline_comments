{"pr_number": 5740, "pr_title": "Fix exception type for failures while decoding property values", "pr_createdAt": "2020-10-29T17:06:55Z", "pr_url": "https://github.com/trinodb/trino/pull/5740", "timeline": [{"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTQ0NjI1Ng==", "url": "https://github.com/trinodb/trino/pull/5740#discussion_r515446256", "bodyText": "This could be any runtime exception depending on the decoder implementation, right? I think we'd want to catch all RuntimeExceptions here", "author": "phd3", "createdAt": "2020-10-31T02:45:03Z", "path": "presto-main/src/main/java/io/prestosql/execution/SetSessionTask.java", "diffHunk": "@@ -87,7 +87,12 @@ public String getName()\n         String value = serializeSessionProperty(type, objectValue);\n \n         // verify the SQL value can be decoded by the property\n-        propertyMetadata.decode(objectValue);\n+        try {\n+            propertyMetadata.decode(objectValue);\n+        }\n+        catch (IllegalArgumentException e) {", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTQ0NzYzNA==", "url": "https://github.com/trinodb/trino/pull/5740#discussion_r515447634", "bodyText": "I think the tests will be easier to read if we add a parameter for property name to  testSetSession method. we won't require  testSetSessionWithValidation and testSetSessionWithEnum anymore.\neven now, the difference in testSetSession and testSetSessionWithValidation is only justified considering the behavior of property metadata that's defined completely outside of the method. Thoughts?", "author": "phd3", "createdAt": "2020-10-31T03:02:23Z", "path": "presto-main/src/test/java/io/prestosql/execution/TestSetSessionTask.java", "diffHunk": "@@ -167,6 +197,11 @@ private void testSetSessionWithValidation(Expression expression, String expected\n         testSetSessionWithParameters(\"positive_property\", expression, expectedValue, emptyList());\n     }\n \n+    private void testSetSessionWithEnum(Expression expression, String expectedValue)", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTQ0ODA4Mw==", "url": "https://github.com/trinodb/trino/pull/5740#discussion_r515448083", "bodyText": "nit: we can remove this check since it's implied in the previous check?", "author": "phd3", "createdAt": "2020-10-31T03:08:13Z", "path": "presto-main/src/test/java/io/prestosql/execution/TestSetSessionTask.java", "diffHunk": "@@ -146,6 +162,20 @@ public void testSetSessionWithValidation()\n         }\n     }\n \n+    @Test\n+    public void testSetSessionWithInvalidEnum()\n+    {\n+        try {\n+            testSetSessionWithEnum(new StringLiteral(\"XL\"), \"XL\");\n+            fail();\n+        }\n+        catch (PrestoException e) {\n+            assertEquals(INVALID_SESSION_PROPERTY.toErrorCode(), e.getErrorCode());\n+            assertEquals(ErrorType.USER_ERROR, e.getErrorCode().getType());", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": "913de472ad5c236484ae37507b4d4f39fa115566", "url": "https://github.com/trinodb/trino/commit/913de472ad5c236484ae37507b4d4f39fa115566", "message": "Fix exception type for failures while decoding property values", "committedDate": "2020-11-04T18:45:16Z", "type": "commit"}, {"oid": "c329acb6c4096eafd8cbc1ecc9b8faed08e37905", "url": "https://github.com/trinodb/trino/commit/c329acb6c4096eafd8cbc1ecc9b8faed08e37905", "message": "Refactor and simplify test by adding property argument", "committedDate": "2020-11-04T18:47:44Z", "type": "commit"}, {"oid": "c329acb6c4096eafd8cbc1ecc9b8faed08e37905", "url": "https://github.com/trinodb/trino/commit/c329acb6c4096eafd8cbc1ecc9b8faed08e37905", "message": "Refactor and simplify test by adding property argument", "committedDate": "2020-11-04T18:47:44Z", "type": "forcePushed"}]}