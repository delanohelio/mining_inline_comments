{"pr_number": 6095, "pr_title": "Separate tested behavior from mechanics in the test", "pr_createdAt": "2020-11-25T13:35:43Z", "pr_url": "https://github.com/trinodb/trino/pull/6095", "timeline": [{"oid": "65ad4f5aade1ac57ba00a48788e73635c18e4cbe", "url": "https://github.com/trinodb/trino/commit/65ad4f5aade1ac57ba00a48788e73635c18e4cbe", "message": "Make testUnwrap more flexible", "committedDate": "2020-11-26T14:53:26Z", "type": "commit"}, {"oid": "9ab56b74100b3c2986af30dd9af7c4ac14fb5bb6", "url": "https://github.com/trinodb/trino/commit/9ab56b74100b3c2986af30dd9af7c4ac14fb5bb6", "message": "Verify expected plan consistently\n\nSome assertion were using explicit matching while others were using\n`anyTree` for no apparent reason. Make the assertions consistent across\nthe class.", "committedDate": "2020-11-26T14:53:26Z", "type": "commit"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTA5ODE5Ng==", "url": "https://github.com/trinodb/trino/pull/6095#discussion_r531098196", "bodyText": "is the casing of aND purposeful :)", "author": "losipiuk", "createdAt": "2020-11-26T15:22:19Z", "path": "presto-main/src/test/java/io/prestosql/sql/planner/TestUnwrapCastInComparison.java", "diffHunk": "@@ -32,830 +32,364 @@\n     public void testEquals()\n     {\n         // representable\n-        assertPlan(\n-                \"SELECT * FROM (VALUES SMALLINT '0') t(a) WHERE a = DOUBLE '1'\",\n-                output(\n-                        filter(\"A = SMALLINT '1'\",\n-                                values(\"A\"))));\n+        testUnwrap(\"smallint\", \"a = DOUBLE '1'\", \"a = SMALLINT '1'\");\n \n-        assertPlan(\n-                \"SELECT * FROM (VALUES BIGINT '0') t(a) WHERE a = DOUBLE '1'\",\n-                output(\n-                        filter(\"A = BIGINT '1'\",\n-                                values(\"A\"))));\n+        testUnwrap(\"bigint\", \"a = DOUBLE '1'\", \"a = BIGINT '1'\");\n \n         // non-representable\n-        assertPlan(\n-                \"SELECT * FROM (VALUES SMALLINT '0') t(a) WHERE a = DOUBLE '1.1'\",\n-                output(\n-                        filter(\"A IS NULL AND NULL\",\n-                                values(\"A\"))));\n-        assertPlan(\n-                \"SELECT * FROM (VALUES SMALLINT '0') t(a) WHERE a = DOUBLE '1.9'\",\n-                output(\n-                        filter(\"A IS NULL AND NULL\",\n-                                values(\"A\"))));\n+        testUnwrap(\"smallint\", \"a = DOUBLE '1.1'\", \"A IS NULL aND NULL\");", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTA5ODU2NA==", "url": "https://github.com/trinodb/trino/pull/6095#discussion_r531098564", "bodyText": "I guess you wanted to make other A lowercase", "author": "losipiuk", "createdAt": "2020-11-26T15:23:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTA5ODE5Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTEwMDUwOA==", "url": "https://github.com/trinodb/trino/pull/6095#discussion_r531100508", "bodyText": "how come?! it was supposed to be \\bA\\b", "author": "findepi", "createdAt": "2020-11-26T15:26:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTA5ODE5Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTEwNTI1OA==", "url": "https://github.com/trinodb/trino/pull/6095#discussion_r531105258", "bodyText": "fixed", "author": "findepi", "createdAt": "2020-11-26T15:34:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTA5ODE5Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTExMTk1OA==", "url": "https://github.com/trinodb/trino/pull/6095#discussion_r531111958", "bodyText": "#6109", "author": "findepi", "createdAt": "2020-11-26T15:45:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTA5ODE5Ng=="}], "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": "b00336e40027dc2cfe7ff80cab3b85efc44d0d84", "url": "https://github.com/trinodb/trino/commit/b00336e40027dc2cfe7ff80cab3b85efc44d0d84", "message": "Separate tested behavior from mechanics in TestUnwrapCastInComparison\n\nFactor out the repetitive stanzas so that tested aspects are easier to\nsee. Since upon failure the actual failing query is reported, it does\nnot limit ability to hand-test selected cases.", "committedDate": "2020-11-26T16:29:42Z", "type": "commit"}, {"oid": "b00336e40027dc2cfe7ff80cab3b85efc44d0d84", "url": "https://github.com/trinodb/trino/commit/b00336e40027dc2cfe7ff80cab3b85efc44d0d84", "message": "Separate tested behavior from mechanics in TestUnwrapCastInComparison\n\nFactor out the repetitive stanzas so that tested aspects are easier to\nsee. Since upon failure the actual failing query is reported, it does\nnot limit ability to hand-test selected cases.", "committedDate": "2020-11-26T16:29:42Z", "type": "forcePushed"}]}