{"pr_number": 4869, "pr_title": "Update hive-caching documentation for Rubix 0.3.16", "pr_createdAt": "2020-08-18T10:28:10Z", "pr_url": "https://github.com/trinodb/trino/pull/4869", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjA4MTU0NQ==", "url": "https://github.com/trinodb/trino/pull/4869#discussion_r472081545", "bodyText": "this is only valid for read-though mode, for async mode, we still need to account for jmx.current.\"metrics:name=rubix.bookkeeper.count.async_downloaded_mb\" \nqubole/rubix#438 will introduce total_system_source_mb_read global metrics", "author": "sopel39", "createdAt": "2020-08-18T10:36:37Z", "path": "presto-docs/src/main/sphinx/connector/hive-caching.rst", "diffHunk": "@@ -177,16 +177,17 @@ The implementation of the cache exposes a `number of metrics\n :doc:`inspect these and other metrics directly in Presto with the JMX connector\n or in external tools </admin/jmx>`.\n \n-The following example query returns the total amount of data fetched by the\n-BookKeeper on the coordinator and all the separate nodes on the workers in the\n-default async mode:\n+If you are using JMX connector, basic caching statistics are exposed via\n+``jmx.current.\"rubix:catalog=<catalog_name>,name=stats\"`` table.\n+You can read more detailed statistics by querying ``jmx.current.\"rubix:catalog=<catalog_name>,name=stats``.\n+You need to replace ``<catalog_name>`` with name of you Hive catalog.\n+\n+The following example query returns the total amount of data fetched from source\n+filesystem by all Presto nodes:\n \n .. code-block:: sql\n \n-  SELECT fs.readfromremote + async_downloaded_mb.count\n-  FROM jmx.current.\"rubix:catalog=hive,name=stats\" fs,\n-       jmx.current.\"metrics:name=rubix.bookkeeper.count.async_downloaded_mb\" async_downloaded_mb\n-  WHERE fs.node = async_downloaded_mb.node;\n+  SELECT sum(mb_read_from_source) FROM jmx.current.\"rubix:catalog=hive,name=stats\";", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjA4NzA2Mg==", "url": "https://github.com/trinodb/trino/pull/4869#discussion_r472087062", "bodyText": "Thanks. I chaned the example query to return average cache hit. I would rather not mix-in metrics:name=rubix.bookkeeper.count.async_downloaded_mb into example as it does not play well with presto (no catalog name in key).", "author": "losipiuk", "createdAt": "2020-08-18T10:47:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjA4MTU0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjA5MTQyMw==", "url": "https://github.com/trinodb/trino/pull/4869#discussion_r472091423", "bodyText": "I would rather not mix-in metrics:name=rubix.bookkeeper.count.async_downloaded_mb into example as it does not play well with presto (no catalog name in key).\n\nRight, cache_hit is fine, yet it doesn't tell the whole story. How do you know if Presto is not going directly to data source?", "author": "sopel39", "createdAt": "2020-08-18T10:56:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjA4MTU0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjA5MzQ1NA==", "url": "https://github.com/trinodb/trino/pull/4869#discussion_r472093454", "bodyText": "We do not. But I think the bottom line is that we just cannot reasonably provide this information until qubole/rubix#438.\nWell we can as long as only single connector uses caching, but I do not want to elaborate too much about that in the documentation.\nI would rather push qubole/rubix#438 and update the documentation with example regarding \"data read from source\" as it gets merged and we update rubix.", "author": "losipiuk", "createdAt": "2020-08-18T11:00:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjA4MTU0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjI4Nzg5NA==", "url": "https://github.com/trinodb/trino/pull/4869#discussion_r472287894", "bodyText": "That sounds reasonable to me.", "author": "mosabua", "createdAt": "2020-08-18T15:32:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjA4MTU0NQ=="}], "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjI4MTU0Mg==", "url": "https://github.com/trinodb/trino/pull/4869#discussion_r472281542", "bodyText": "Remove \"If you are using JXM connector\" sins this is already said earlier.\nBasic caching statistics for the catalog are available in the ``jmx.current.\"rubix:catalog=<catalog_name>,name=stats\"`` table. The table ``jmx.current.\"rubix:catalog=<catalog_name>,name=stats`` contains more detailed statistics.\n\nUse the above for the whole paragraph.", "author": "mosabua", "createdAt": "2020-08-18T15:24:07Z", "path": "presto-docs/src/main/sphinx/connector/hive-caching.rst", "diffHunk": "@@ -177,16 +177,16 @@ The implementation of the cache exposes a `number of metrics\n :doc:`inspect these and other metrics directly in Presto with the JMX connector\n or in external tools </admin/jmx>`.\n \n-The following example query returns the total amount of data fetched by the\n-BookKeeper on the coordinator and all the separate nodes on the workers in the\n-default async mode:\n+If you are using JMX connector, basic caching statistics are exposed via", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjMwNDY0Mg==", "url": "https://github.com/trinodb/trino/pull/4869#discussion_r472304642", "bodyText": "Should it be\nThe table ``jmx.current.\"rubix:catalog=<catalog_name>,name=stats`` \n\nOr\nThe ``jmx.current.\"rubix:catalog=<catalog_name>,name=stats`` table\n\nLatter sound more proper to me, but I may be very wrong here :)", "author": "losipiuk", "createdAt": "2020-08-18T15:56:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjI4MTU0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzQ4ODA5Mw==", "url": "https://github.com/trinodb/trino/pull/4869#discussion_r473488093", "bodyText": "either is fine", "author": "mosabua", "createdAt": "2020-08-20T00:53:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjI4MTU0Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjI4NTUxNQ==", "url": "https://github.com/trinodb/trino/pull/4869#discussion_r472285515", "bodyText": "The following example query returns the average cache hit ratio for the ``hive`` catalog:", "author": "mosabua", "createdAt": "2020-08-18T15:29:13Z", "path": "presto-docs/src/main/sphinx/connector/hive-caching.rst", "diffHunk": "@@ -177,16 +177,16 @@ The implementation of the cache exposes a `number of metrics\n :doc:`inspect these and other metrics directly in Presto with the JMX connector\n or in external tools </admin/jmx>`.\n \n-The following example query returns the total amount of data fetched by the\n-BookKeeper on the coordinator and all the separate nodes on the workers in the\n-default async mode:\n+If you are using JMX connector, basic caching statistics are exposed via\n+``jmx.current.\"rubix:catalog=<catalog_name>,name=stats\"`` table.\n+You can read more detailed statistics by querying ``jmx.current.\"rubix:catalog=<catalog_name>,name=stats``.\n+You need to replace ``<catalog_name>`` with name of you Hive catalog.\n+\n+The following example query returns average cache hit ratio for given Hive catalog.", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjMwNzEzOQ==", "url": "https://github.com/trinodb/trino/pull/4869#discussion_r472307139", "bodyText": "A hint @mosabua:\nIf you are suggesting rewording of whole paragraphs you can use suggestion mechanism of Github code review.\nTo do so:\n\nmark the lines for which you want to suggest alternative.\nclick comment\nclick +/- button in the comment editor\nprovide suggestion.\n\nScreenshot:", "author": "losipiuk", "createdAt": "2020-08-18T16:00:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjI4NTUxNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjI4NjQwMQ==", "url": "https://github.com/trinodb/trino/pull/4869#discussion_r472286401", "bodyText": "SELECT avg(cache_hit) \nFROM jmx.current.\"rubix:catalog=hive,name=stats\" \nWHERE NOT is_nan(cache_hit);", "author": "mosabua", "createdAt": "2020-08-18T15:30:26Z", "path": "presto-docs/src/main/sphinx/connector/hive-caching.rst", "diffHunk": "@@ -177,16 +177,16 @@ The implementation of the cache exposes a `number of metrics\n :doc:`inspect these and other metrics directly in Presto with the JMX connector\n or in external tools </admin/jmx>`.\n \n-The following example query returns the total amount of data fetched by the\n-BookKeeper on the coordinator and all the separate nodes on the workers in the\n-default async mode:\n+If you are using JMX connector, basic caching statistics are exposed via\n+``jmx.current.\"rubix:catalog=<catalog_name>,name=stats\"`` table.\n+You can read more detailed statistics by querying ``jmx.current.\"rubix:catalog=<catalog_name>,name=stats``.\n+You need to replace ``<catalog_name>`` with name of you Hive catalog.\n+\n+The following example query returns average cache hit ratio for given Hive catalog.\n \n .. code-block:: sql\n \n-  SELECT fs.readfromremote + async_downloaded_mb.count\n-  FROM jmx.current.\"rubix:catalog=hive,name=stats\" fs,\n-       jmx.current.\"metrics:name=rubix.bookkeeper.count.async_downloaded_mb\" async_downloaded_mb\n-  WHERE fs.node = async_downloaded_mb.node;\n+  SELECT avg(cache_hit) FROM jmx.current.\"rubix:catalog=hive,name=stats\" where not is_nan(cache_hit);", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": "e25dfbdaf6a5b1a45b91083e6b6c74e078dff610", "url": "https://github.com/trinodb/trino/commit/e25dfbdaf6a5b1a45b91083e6b6c74e078dff610", "message": "Update hive-caching documentation for Rubix 0.3.16", "committedDate": "2020-08-18T16:01:41Z", "type": "commit"}, {"oid": "e25dfbdaf6a5b1a45b91083e6b6c74e078dff610", "url": "https://github.com/trinodb/trino/commit/e25dfbdaf6a5b1a45b91083e6b6c74e078dff610", "message": "Update hive-caching documentation for Rubix 0.3.16", "committedDate": "2020-08-18T16:01:41Z", "type": "forcePushed"}]}