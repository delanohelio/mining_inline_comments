{"pr_number": 2513, "pr_title": "Introduce builder for TestingConnectorSession", "pr_createdAt": "2020-01-15T10:53:46Z", "pr_url": "https://github.com/trinodb/trino/pull/2513", "timeline": [{"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzM5MTA5Nw==", "url": "https://github.com/trinodb/trino/pull/2513#discussion_r367391097", "bodyText": "set it at creation time instead?", "author": "sopel39", "createdAt": "2020-01-16T12:28:41Z", "path": "presto-main/src/main/java/io/prestosql/testing/TestingConnectorSession.java", "diffHunk": "@@ -161,4 +151,59 @@ public String toString()\n                 .omitNullValues()\n                 .toString();\n     }\n+\n+    public static Builder builder()\n+    {\n+        return new Builder();\n+    }\n+\n+    public static class Builder\n+    {\n+        private ConnectorIdentity identity = new ConnectorIdentity(\"user\", Optional.empty(), Optional.empty());\n+        private Optional<String> source = Optional.of(\"test\");\n+        private TimeZoneKey timeZoneKey = UTC_KEY;\n+        private Locale locale = ENGLISH;\n+        private Optional<String> traceToken = Optional.empty();\n+        private long startTime = System.currentTimeMillis();", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzM5MTUxMQ==", "url": "https://github.com/trinodb/trino/pull/2513#discussion_r367391511", "bodyText": "why optional? You cannot change it.\nAlso, make fields that you cannot modify finals", "author": "sopel39", "createdAt": "2020-01-16T12:29:51Z", "path": "presto-main/src/main/java/io/prestosql/testing/TestingConnectorSession.java", "diffHunk": "@@ -161,4 +151,59 @@ public String toString()\n                 .omitNullValues()\n                 .toString();\n     }\n+\n+    public static Builder builder()\n+    {\n+        return new Builder();\n+    }\n+\n+    public static class Builder\n+    {\n+        private ConnectorIdentity identity = new ConnectorIdentity(\"user\", Optional.empty(), Optional.empty());\n+        private Optional<String> source = Optional.of(\"test\");", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzg3NDU2Nw==", "url": "https://github.com/trinodb/trino/pull/2513#discussion_r367874567", "bodyText": "why optional?\n\nBecause constructor requires optional", "author": "kokosing", "createdAt": "2020-01-17T10:46:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzM5MTUxMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzM5MjcxMg==", "url": "https://github.com/trinodb/trino/pull/2513#discussion_r367392712", "bodyText": "static import?", "author": "sopel39", "createdAt": "2020-01-16T12:33:09Z", "path": "presto-memory/src/test/java/io/prestosql/plugin/memory/TestMemoryPagesStore.java", "diffHunk": "@@ -129,7 +127,7 @@ private void insertToTable(long tableId, Page page, Long... activeTableIds)\n     {\n         ConnectorPageSink pageSink = pageSinkProvider.createPageSink(\n                 MemoryTransactionHandle.INSTANCE,\n-                SESSION,\n+                TestingConnectorSession.SESSION,", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzM5Mjk0OQ==", "url": "https://github.com/trinodb/trino/pull/2513#discussion_r367392949", "bodyText": "you are not setting userTimeZone when creating new session", "author": "sopel39", "createdAt": "2020-01-16T12:33:46Z", "path": "presto-raptor-legacy/src/test/java/io/prestosql/plugin/raptor/legacy/TestRaptorConnector.java", "diffHunk": "@@ -217,16 +215,9 @@ public void testTemporalShardSplit()\n     private void assertSplitShard(Type temporalType, String min, String max, String userTimeZone, int expectedSplits)\n             throws Exception\n     {\n-        ConnectorSession session = new TestingConnectorSession(\n-                \"user\",\n-                Optional.of(\"test\"),\n-                Optional.empty(),\n-                getTimeZoneKey(userTimeZone),", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzM5MzY3NA==", "url": "https://github.com/trinodb/trino/pull/2513#discussion_r367393674", "bodyText": "locale was also not ENGLISH", "author": "sopel39", "createdAt": "2020-01-16T12:35:28Z", "path": "presto-main/src/test/java/io/prestosql/operator/scalar/TestDateTimeFunctionsBase.java", "diffHunk": "@@ -161,7 +157,12 @@ public void testCurrentDateTimezone()\n     private void assertCurrentDateAtInstant(TimeZoneKey timeZoneKey, long instant)\n     {\n         long expectedDays = epochDaysInZone(timeZoneKey, instant);\n-        long dateTimeCalculation = currentDate(new TestingConnectorSession(\"test\", Optional.empty(), Optional.empty(), timeZoneKey, US, instant, ImmutableList.of(), ImmutableMap.of(), isLegacyTimestamp(session)));\n+        TestingConnectorSession connectorSession = TestingConnectorSession.builder()\n+                .setStartTime(instant)\n+                .setTimeZoneKey(timeZoneKey)", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzg3NDc0Nw==", "url": "https://github.com/trinodb/trino/pull/2513#discussion_r367874747", "bodyText": "And still it is. It is default.", "author": "kokosing", "createdAt": "2020-01-17T10:47:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzM5MzY3NA=="}], "type": "inlineReview"}, {"oid": "d965732d2f5e25dd6efb18cbf94d0bb141e67514", "url": "https://github.com/trinodb/trino/commit/d965732d2f5e25dd6efb18cbf94d0bb141e67514", "message": "Introduce builder for TestingConnectorSession", "committedDate": "2020-01-17T10:59:40Z", "type": "commit"}, {"oid": "d965732d2f5e25dd6efb18cbf94d0bb141e67514", "url": "https://github.com/trinodb/trino/commit/d965732d2f5e25dd6efb18cbf94d0bb141e67514", "message": "Introduce builder for TestingConnectorSession", "committedDate": "2020-01-17T10:59:40Z", "type": "forcePushed"}]}