{"pr_number": 4537, "pr_title": "Iceberg connector documentation", "pr_createdAt": "2020-07-22T14:34:51Z", "pr_url": "https://github.com/trinodb/trino/pull/4537", "timeline": [{"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMxNjQyNg==", "url": "https://github.com/trinodb/trino/pull/4537#discussion_r483316426", "bodyText": "I think we should remove this list, as we don't have it for other connectors. Many of these are basics that are expected, and can be or are documented implicitly with examples.", "author": "electrum", "createdAt": "2020-09-04T00:09:09Z", "path": "presto-docs/src/main/sphinx/connector/iceberg.rst", "diffHunk": "@@ -0,0 +1,197 @@\n+=================\n+Iceberg Connector\n+=================\n+\n+Overview\n+--------\n+\n+Apache Iceberg is an open table format for huge analytic datasets.\n+The Iceberg connector allows querying data stored in\n+files written in Iceberg format, as defined in the\n+`Iceberg Table Spec <https://iceberg.apache.org/spec/>`_.\n+\n+The Iceberg connector supports:", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzY2MTY5Nw==", "url": "https://github.com/trinodb/trino/pull/4537#discussion_r483661697", "bodyText": "Removed.", "author": "djsstarburst", "createdAt": "2020-09-04T14:47:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMxNjQyNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMxNjUzOA==", "url": "https://github.com/trinodb/trino/pull/4537#discussion_r483316538", "bodyText": "This isn't accurate as there are many Presto types not supported by Iceberg (for example, Geospatial data types)", "author": "electrum", "createdAt": "2020-09-04T00:09:32Z", "path": "presto-docs/src/main/sphinx/connector/iceberg.rst", "diffHunk": "@@ -0,0 +1,197 @@\n+=================\n+Iceberg Connector\n+=================\n+\n+Overview\n+--------\n+\n+Apache Iceberg is an open table format for huge analytic datasets.\n+The Iceberg connector allows querying data stored in\n+files written in Iceberg format, as defined in the\n+`Iceberg Table Spec <https://iceberg.apache.org/spec/>`_.\n+\n+The Iceberg connector supports:\n+\n+* All Presto types, including TIME, TIMESTAMP, DECIMAL", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzY2MTc5NQ==", "url": "https://github.com/trinodb/trino/pull/4537#discussion_r483661795", "bodyText": "Removed in the previous edit.", "author": "djsstarburst", "createdAt": "2020-09-04T14:47:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMxNjUzOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMxNjk3Ng==", "url": "https://github.com/trinodb/trino/pull/4537#discussion_r483316976", "bodyText": "Replace first two sentences:\n\nIceberg is designed to improve on the known scalability limitations of Hive, which stores table metadata in a metastore that is backed by a relational database such as MySQL.", "author": "electrum", "createdAt": "2020-09-04T00:11:12Z", "path": "presto-docs/src/main/sphinx/connector/iceberg.rst", "diffHunk": "@@ -0,0 +1,197 @@\n+=================\n+Iceberg Connector\n+=================\n+\n+Overview\n+--------\n+\n+Apache Iceberg is an open table format for huge analytic datasets.\n+The Iceberg connector allows querying data stored in\n+files written in Iceberg format, as defined in the\n+`Iceberg Table Spec <https://iceberg.apache.org/spec/>`_.\n+\n+The Iceberg connector supports:\n+\n+* All Presto types, including TIME, TIMESTAMP, DECIMAL\n+* CREATE TABLE and CREATE TABLE AS\n+* Partitioning tables by any Presto type\n+* Dropping tables\n+* Renaming tables\n+* Deletion by partition\n+* Table and column statistics\n+* Table and column comments\n+* Rolling back a table to a previous state\n+* Schema evolution\n+\n+The Iceberg table state is maintained in metadata files. All changes to table state\n+create a new metadata file and replace the old metadata with an atomic swap.\n+The table metadata file tracks the table schema, partitioning config,\n+custom properties, and snapshots of the table contents.\n+\n+Iceberg data files can be stored in either Parquet or ORC format, as\n+determined by the ``format`` property in the table definition.  The\n+table ``format`` defaults to ``ORC``.\n+\n+Iceberg is designed to improve on the known scalabilty limitations of Hive.  Hive", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzY2MTg0OQ==", "url": "https://github.com/trinodb/trino/pull/4537#discussion_r483661849", "bodyText": "Replaced", "author": "djsstarburst", "createdAt": "2020-09-04T14:47:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMxNjk3Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMxNjk4Ng==", "url": "https://github.com/trinodb/trino/pull/4537#discussion_r483316986", "bodyText": "Change \"Hive connector\" to a link\n:doc:`/connector/hive`", "author": "electrum", "createdAt": "2020-09-04T00:11:14Z", "path": "presto-docs/src/main/sphinx/connector/iceberg.rst", "diffHunk": "@@ -0,0 +1,197 @@\n+=================\n+Iceberg Connector\n+=================\n+\n+Overview\n+--------\n+\n+Apache Iceberg is an open table format for huge analytic datasets.\n+The Iceberg connector allows querying data stored in\n+files written in Iceberg format, as defined in the\n+`Iceberg Table Spec <https://iceberg.apache.org/spec/>`_.\n+\n+The Iceberg connector supports:\n+\n+* All Presto types, including TIME, TIMESTAMP, DECIMAL\n+* CREATE TABLE and CREATE TABLE AS\n+* Partitioning tables by any Presto type\n+* Dropping tables\n+* Renaming tables\n+* Deletion by partition\n+* Table and column statistics\n+* Table and column comments\n+* Rolling back a table to a previous state\n+* Schema evolution\n+\n+The Iceberg table state is maintained in metadata files. All changes to table state\n+create a new metadata file and replace the old metadata with an atomic swap.\n+The table metadata file tracks the table schema, partitioning config,\n+custom properties, and snapshots of the table contents.\n+\n+Iceberg data files can be stored in either Parquet or ORC format, as\n+determined by the ``format`` property in the table definition.  The\n+table ``format`` defaults to ``ORC``.\n+\n+Iceberg is designed to improve on the known scalabilty limitations of Hive.  Hive\n+stores table metadata in an object store backed by a database like MySQL.  It tracks\n+partition locations in the metastore, but not individual data files.  Presto queries\n+using the Hive connector must first call the metastore to get partition locations,", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzY2MTkxMg==", "url": "https://github.com/trinodb/trino/pull/4537#discussion_r483661912", "bodyText": "Changed.", "author": "djsstarburst", "createdAt": "2020-09-04T14:47:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMxNjk4Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMxNzI1Mw==", "url": "https://github.com/trinodb/trino/pull/4537#discussion_r483317253", "bodyText": "Let's remove this now, as it should be usable, as shown by our tests", "author": "electrum", "createdAt": "2020-09-04T00:12:21Z", "path": "presto-docs/src/main/sphinx/connector/iceberg.rst", "diffHunk": "@@ -0,0 +1,197 @@\n+=================\n+Iceberg Connector\n+=================\n+\n+Overview\n+--------\n+\n+Apache Iceberg is an open table format for huge analytic datasets.\n+The Iceberg connector allows querying data stored in\n+files written in Iceberg format, as defined in the\n+`Iceberg Table Spec <https://iceberg.apache.org/spec/>`_.\n+\n+The Iceberg connector supports:\n+\n+* All Presto types, including TIME, TIMESTAMP, DECIMAL\n+* CREATE TABLE and CREATE TABLE AS\n+* Partitioning tables by any Presto type\n+* Dropping tables\n+* Renaming tables\n+* Deletion by partition\n+* Table and column statistics\n+* Table and column comments\n+* Rolling back a table to a previous state\n+* Schema evolution\n+\n+The Iceberg table state is maintained in metadata files. All changes to table state\n+create a new metadata file and replace the old metadata with an atomic swap.\n+The table metadata file tracks the table schema, partitioning config,\n+custom properties, and snapshots of the table contents.\n+\n+Iceberg data files can be stored in either Parquet or ORC format, as\n+determined by the ``format`` property in the table definition.  The\n+table ``format`` defaults to ``ORC``.\n+\n+Iceberg is designed to improve on the known scalabilty limitations of Hive.  Hive\n+stores table metadata in an object store backed by a database like MySQL.  It tracks\n+partition locations in the metastore, but not individual data files.  Presto queries\n+using the Hive connector must first call the metastore to get partition locations,\n+then call the underlying filesystem to list all data files inside each partition,\n+and then read metadata from each data file.\n+\n+Since Iceberg stores the paths to data files in the metadata files, it\n+only consults the underlying file system for files that must be read.\n+\n+Status\n+------\n+\n+The Iceberg connector is not yet supported for production use.", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzY2MjAzNg==", "url": "https://github.com/trinodb/trino/pull/4537#discussion_r483662036", "bodyText": "Removed", "author": "djsstarburst", "createdAt": "2020-09-04T14:47:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMxNzI1Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMxNzQ2Ng==", "url": "https://github.com/trinodb/trino/pull/4537#discussion_r483317466", "bodyText": "Let's remove this section, as this is expected, given it follows the Iceberg specification. We don't need to link end users to specific tests.", "author": "electrum", "createdAt": "2020-09-04T00:13:15Z", "path": "presto-docs/src/main/sphinx/connector/iceberg.rst", "diffHunk": "@@ -0,0 +1,197 @@\n+=================\n+Iceberg Connector\n+=================\n+\n+Overview\n+--------\n+\n+Apache Iceberg is an open table format for huge analytic datasets.\n+The Iceberg connector allows querying data stored in\n+files written in Iceberg format, as defined in the\n+`Iceberg Table Spec <https://iceberg.apache.org/spec/>`_.\n+\n+The Iceberg connector supports:\n+\n+* All Presto types, including TIME, TIMESTAMP, DECIMAL\n+* CREATE TABLE and CREATE TABLE AS\n+* Partitioning tables by any Presto type\n+* Dropping tables\n+* Renaming tables\n+* Deletion by partition\n+* Table and column statistics\n+* Table and column comments\n+* Rolling back a table to a previous state\n+* Schema evolution\n+\n+The Iceberg table state is maintained in metadata files. All changes to table state\n+create a new metadata file and replace the old metadata with an atomic swap.\n+The table metadata file tracks the table schema, partitioning config,\n+custom properties, and snapshots of the table contents.\n+\n+Iceberg data files can be stored in either Parquet or ORC format, as\n+determined by the ``format`` property in the table definition.  The\n+table ``format`` defaults to ``ORC``.\n+\n+Iceberg is designed to improve on the known scalabilty limitations of Hive.  Hive\n+stores table metadata in an object store backed by a database like MySQL.  It tracks\n+partition locations in the metastore, but not individual data files.  Presto queries\n+using the Hive connector must first call the metastore to get partition locations,\n+then call the underlying filesystem to list all data files inside each partition,\n+and then read metadata from each data file.\n+\n+Since Iceberg stores the paths to data files in the metadata files, it\n+only consults the underlying file system for files that must be read.\n+\n+Status\n+------\n+\n+The Iceberg connector is not yet supported for production use.\n+\n+Compatibility With Spark Iceberg", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzY2MjIzOQ==", "url": "https://github.com/trinodb/trino/pull/4537#discussion_r483662239", "bodyText": "Removed.", "author": "djsstarburst", "createdAt": "2020-09-04T14:48:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMxNzQ2Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMyMDM4NA==", "url": "https://github.com/trinodb/trino/pull/4537#discussion_r483320384", "bodyText": "Let's change these to \"January 1, 1970\" to avoid having a period in the middle.\nFor all of these, it would be useful to have a friendly explanation first:\n\nA partition is created for each year.", "author": "electrum", "createdAt": "2020-09-04T00:24:31Z", "path": "presto-docs/src/main/sphinx/connector/iceberg.rst", "diffHunk": "@@ -0,0 +1,197 @@\n+=================\n+Iceberg Connector\n+=================\n+\n+Overview\n+--------\n+\n+Apache Iceberg is an open table format for huge analytic datasets.\n+The Iceberg connector allows querying data stored in\n+files written in Iceberg format, as defined in the\n+`Iceberg Table Spec <https://iceberg.apache.org/spec/>`_.\n+\n+The Iceberg connector supports:\n+\n+* All Presto types, including TIME, TIMESTAMP, DECIMAL\n+* CREATE TABLE and CREATE TABLE AS\n+* Partitioning tables by any Presto type\n+* Dropping tables\n+* Renaming tables\n+* Deletion by partition\n+* Table and column statistics\n+* Table and column comments\n+* Rolling back a table to a previous state\n+* Schema evolution\n+\n+The Iceberg table state is maintained in metadata files. All changes to table state\n+create a new metadata file and replace the old metadata with an atomic swap.\n+The table metadata file tracks the table schema, partitioning config,\n+custom properties, and snapshots of the table contents.\n+\n+Iceberg data files can be stored in either Parquet or ORC format, as\n+determined by the ``format`` property in the table definition.  The\n+table ``format`` defaults to ``ORC``.\n+\n+Iceberg is designed to improve on the known scalabilty limitations of Hive.  Hive\n+stores table metadata in an object store backed by a database like MySQL.  It tracks\n+partition locations in the metastore, but not individual data files.  Presto queries\n+using the Hive connector must first call the metastore to get partition locations,\n+then call the underlying filesystem to list all data files inside each partition,\n+and then read metadata from each data file.\n+\n+Since Iceberg stores the paths to data files in the metadata files, it\n+only consults the underlying file system for files that must be read.\n+\n+Status\n+------\n+\n+The Iceberg connector is not yet supported for production use.\n+\n+Compatibility With Spark Iceberg\n+--------------------------------\n+\n+Tests have been written to demonstrate that data written by Presto can be read\n+using Spark SQL with the Iceberg format, and vice versa.  See\n+`TestSparkCompatibility <https://github.com/prestosql/presto/blob/master/presto-product-tests/src/main/java/io/prestosql/tests/iceberg/TestSparkCompatibility.java>`_.\n+\n+Configuration\n+-------------\n+\n+Iceberg supports the same metastore configuration properties as the Hive connector.\n+At a minimum, ``hive.metastore.uri`` must be configured:\n+\n+.. code-block:: none\n+\n+    connector.name=iceberg\n+    hive.metastore.uri=thrift://localhost:9083\n+\n+Partitioned Tables\n+------------------\n+\n+Iceberg supports partitioning by specifying transforms over the table columns.\n+A partition is created for each unique tuple value produced by the transforms.\n+Identity transforms are simply the column name. Other transforms are:\n+\n+===================================== ================================================================================================\n+Transform                             Description\n+===================================== ================================================================================================\n+``year(ts)``                          The partition value is the integer difference in years between ``ts`` and January 1st. 1970.", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzY2MjY2NQ==", "url": "https://github.com/trinodb/trino/pull/4537#discussion_r483662665", "bodyText": "Added.", "author": "djsstarburst", "createdAt": "2020-09-04T14:48:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMyMDM4NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMyMDc2Nw==", "url": "https://github.com/trinodb/trino/pull/4537#discussion_r483320767", "bodyText": "No need to uppercase timestamp here, since it's used as word, not a SQL keyword.\nMaybe instead of \"rounded down\" we could say\n\nThe partition value is a timestamp with the minutes and seconds set to zero", "author": "electrum", "createdAt": "2020-09-04T00:25:59Z", "path": "presto-docs/src/main/sphinx/connector/iceberg.rst", "diffHunk": "@@ -0,0 +1,197 @@\n+=================\n+Iceberg Connector\n+=================\n+\n+Overview\n+--------\n+\n+Apache Iceberg is an open table format for huge analytic datasets.\n+The Iceberg connector allows querying data stored in\n+files written in Iceberg format, as defined in the\n+`Iceberg Table Spec <https://iceberg.apache.org/spec/>`_.\n+\n+The Iceberg connector supports:\n+\n+* All Presto types, including TIME, TIMESTAMP, DECIMAL\n+* CREATE TABLE and CREATE TABLE AS\n+* Partitioning tables by any Presto type\n+* Dropping tables\n+* Renaming tables\n+* Deletion by partition\n+* Table and column statistics\n+* Table and column comments\n+* Rolling back a table to a previous state\n+* Schema evolution\n+\n+The Iceberg table state is maintained in metadata files. All changes to table state\n+create a new metadata file and replace the old metadata with an atomic swap.\n+The table metadata file tracks the table schema, partitioning config,\n+custom properties, and snapshots of the table contents.\n+\n+Iceberg data files can be stored in either Parquet or ORC format, as\n+determined by the ``format`` property in the table definition.  The\n+table ``format`` defaults to ``ORC``.\n+\n+Iceberg is designed to improve on the known scalabilty limitations of Hive.  Hive\n+stores table metadata in an object store backed by a database like MySQL.  It tracks\n+partition locations in the metastore, but not individual data files.  Presto queries\n+using the Hive connector must first call the metastore to get partition locations,\n+then call the underlying filesystem to list all data files inside each partition,\n+and then read metadata from each data file.\n+\n+Since Iceberg stores the paths to data files in the metadata files, it\n+only consults the underlying file system for files that must be read.\n+\n+Status\n+------\n+\n+The Iceberg connector is not yet supported for production use.\n+\n+Compatibility With Spark Iceberg\n+--------------------------------\n+\n+Tests have been written to demonstrate that data written by Presto can be read\n+using Spark SQL with the Iceberg format, and vice versa.  See\n+`TestSparkCompatibility <https://github.com/prestosql/presto/blob/master/presto-product-tests/src/main/java/io/prestosql/tests/iceberg/TestSparkCompatibility.java>`_.\n+\n+Configuration\n+-------------\n+\n+Iceberg supports the same metastore configuration properties as the Hive connector.\n+At a minimum, ``hive.metastore.uri`` must be configured:\n+\n+.. code-block:: none\n+\n+    connector.name=iceberg\n+    hive.metastore.uri=thrift://localhost:9083\n+\n+Partitioned Tables\n+------------------\n+\n+Iceberg supports partitioning by specifying transforms over the table columns.\n+A partition is created for each unique tuple value produced by the transforms.\n+Identity transforms are simply the column name. Other transforms are:\n+\n+===================================== ================================================================================================\n+Transform                             Description\n+===================================== ================================================================================================\n+``year(ts)``                          The partition value is the integer difference in years between ``ts`` and January 1st. 1970.\n+\n+``month(ts)``                         The partition value is the integer difference in months between ``ts`` and January 1st. 1970.\n+\n+``day(ts)``                           The partition value is the integer difference in days between ``ts`` and January 1st. 1970.\n+\n+``hour(ts)``                          The partition value is a TIMESTAMP rounded down to the nearest hour.", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzY2MzAwMg==", "url": "https://github.com/trinodb/trino/pull/4537#discussion_r483663002", "bodyText": "Changed.", "author": "djsstarburst", "createdAt": "2020-09-04T14:48:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMyMDc2Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMyMDg0MQ==", "url": "https://github.com/trinodb/trino/pull/4537#discussion_r483320841", "bodyText": "Make the separators as long as the longest text", "author": "electrum", "createdAt": "2020-09-04T00:26:18Z", "path": "presto-docs/src/main/sphinx/connector/iceberg.rst", "diffHunk": "@@ -0,0 +1,197 @@\n+=================\n+Iceberg Connector\n+=================\n+\n+Overview\n+--------\n+\n+Apache Iceberg is an open table format for huge analytic datasets.\n+The Iceberg connector allows querying data stored in\n+files written in Iceberg format, as defined in the\n+`Iceberg Table Spec <https://iceberg.apache.org/spec/>`_.\n+\n+The Iceberg connector supports:\n+\n+* All Presto types, including TIME, TIMESTAMP, DECIMAL\n+* CREATE TABLE and CREATE TABLE AS\n+* Partitioning tables by any Presto type\n+* Dropping tables\n+* Renaming tables\n+* Deletion by partition\n+* Table and column statistics\n+* Table and column comments\n+* Rolling back a table to a previous state\n+* Schema evolution\n+\n+The Iceberg table state is maintained in metadata files. All changes to table state\n+create a new metadata file and replace the old metadata with an atomic swap.\n+The table metadata file tracks the table schema, partitioning config,\n+custom properties, and snapshots of the table contents.\n+\n+Iceberg data files can be stored in either Parquet or ORC format, as\n+determined by the ``format`` property in the table definition.  The\n+table ``format`` defaults to ``ORC``.\n+\n+Iceberg is designed to improve on the known scalabilty limitations of Hive.  Hive\n+stores table metadata in an object store backed by a database like MySQL.  It tracks\n+partition locations in the metastore, but not individual data files.  Presto queries\n+using the Hive connector must first call the metastore to get partition locations,\n+then call the underlying filesystem to list all data files inside each partition,\n+and then read metadata from each data file.\n+\n+Since Iceberg stores the paths to data files in the metadata files, it\n+only consults the underlying file system for files that must be read.\n+\n+Status\n+------\n+\n+The Iceberg connector is not yet supported for production use.\n+\n+Compatibility With Spark Iceberg\n+--------------------------------\n+\n+Tests have been written to demonstrate that data written by Presto can be read\n+using Spark SQL with the Iceberg format, and vice versa.  See\n+`TestSparkCompatibility <https://github.com/prestosql/presto/blob/master/presto-product-tests/src/main/java/io/prestosql/tests/iceberg/TestSparkCompatibility.java>`_.\n+\n+Configuration\n+-------------\n+\n+Iceberg supports the same metastore configuration properties as the Hive connector.\n+At a minimum, ``hive.metastore.uri`` must be configured:\n+\n+.. code-block:: none\n+\n+    connector.name=iceberg\n+    hive.metastore.uri=thrift://localhost:9083\n+\n+Partitioned Tables\n+------------------\n+\n+Iceberg supports partitioning by specifying transforms over the table columns.\n+A partition is created for each unique tuple value produced by the transforms.\n+Identity transforms are simply the column name. Other transforms are:\n+\n+===================================== ================================================================================================\n+Transform                             Description\n+===================================== ================================================================================================\n+``year(ts)``                          The partition value is the integer difference in years between ``ts`` and January 1st. 1970.\n+\n+``month(ts)``                         The partition value is the integer difference in months between ``ts`` and January 1st. 1970.\n+\n+``day(ts)``                           The partition value is the integer difference in days between ``ts`` and January 1st. 1970.\n+\n+``hour(ts)``                          The partition value is a TIMESTAMP rounded down to the nearest hour.\n+\n+``bucket(x, nbuckets)``               The partition value is an integer hash of ``x``, with a value between 0 and ``nbuckets - 1`` inclusive.\n+\n+``truncate(s, nchars)``               The partition value is the first ``nchars`` characters of VARCHAR ``s``.\n+===================================== ================================================================================================", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzY3NDY4MA==", "url": "https://github.com/trinodb/trino/pull/4537#discussion_r483674680", "bodyText": "Done.", "author": "djsstarburst", "createdAt": "2020-09-04T15:01:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMyMDg0MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMyMTM2NQ==", "url": "https://github.com/trinodb/trino/pull/4537#discussion_r483321365", "bodyText": "The data is hashed into the specified number of buckets. The partition value ...", "author": "electrum", "createdAt": "2020-09-04T00:28:28Z", "path": "presto-docs/src/main/sphinx/connector/iceberg.rst", "diffHunk": "@@ -0,0 +1,197 @@\n+=================\n+Iceberg Connector\n+=================\n+\n+Overview\n+--------\n+\n+Apache Iceberg is an open table format for huge analytic datasets.\n+The Iceberg connector allows querying data stored in\n+files written in Iceberg format, as defined in the\n+`Iceberg Table Spec <https://iceberg.apache.org/spec/>`_.\n+\n+The Iceberg connector supports:\n+\n+* All Presto types, including TIME, TIMESTAMP, DECIMAL\n+* CREATE TABLE and CREATE TABLE AS\n+* Partitioning tables by any Presto type\n+* Dropping tables\n+* Renaming tables\n+* Deletion by partition\n+* Table and column statistics\n+* Table and column comments\n+* Rolling back a table to a previous state\n+* Schema evolution\n+\n+The Iceberg table state is maintained in metadata files. All changes to table state\n+create a new metadata file and replace the old metadata with an atomic swap.\n+The table metadata file tracks the table schema, partitioning config,\n+custom properties, and snapshots of the table contents.\n+\n+Iceberg data files can be stored in either Parquet or ORC format, as\n+determined by the ``format`` property in the table definition.  The\n+table ``format`` defaults to ``ORC``.\n+\n+Iceberg is designed to improve on the known scalabilty limitations of Hive.  Hive\n+stores table metadata in an object store backed by a database like MySQL.  It tracks\n+partition locations in the metastore, but not individual data files.  Presto queries\n+using the Hive connector must first call the metastore to get partition locations,\n+then call the underlying filesystem to list all data files inside each partition,\n+and then read metadata from each data file.\n+\n+Since Iceberg stores the paths to data files in the metadata files, it\n+only consults the underlying file system for files that must be read.\n+\n+Status\n+------\n+\n+The Iceberg connector is not yet supported for production use.\n+\n+Compatibility With Spark Iceberg\n+--------------------------------\n+\n+Tests have been written to demonstrate that data written by Presto can be read\n+using Spark SQL with the Iceberg format, and vice versa.  See\n+`TestSparkCompatibility <https://github.com/prestosql/presto/blob/master/presto-product-tests/src/main/java/io/prestosql/tests/iceberg/TestSparkCompatibility.java>`_.\n+\n+Configuration\n+-------------\n+\n+Iceberg supports the same metastore configuration properties as the Hive connector.\n+At a minimum, ``hive.metastore.uri`` must be configured:\n+\n+.. code-block:: none\n+\n+    connector.name=iceberg\n+    hive.metastore.uri=thrift://localhost:9083\n+\n+Partitioned Tables\n+------------------\n+\n+Iceberg supports partitioning by specifying transforms over the table columns.\n+A partition is created for each unique tuple value produced by the transforms.\n+Identity transforms are simply the column name. Other transforms are:\n+\n+===================================== ================================================================================================\n+Transform                             Description\n+===================================== ================================================================================================\n+``year(ts)``                          The partition value is the integer difference in years between ``ts`` and January 1st. 1970.\n+\n+``month(ts)``                         The partition value is the integer difference in months between ``ts`` and January 1st. 1970.\n+\n+``day(ts)``                           The partition value is the integer difference in days between ``ts`` and January 1st. 1970.\n+\n+``hour(ts)``                          The partition value is a TIMESTAMP rounded down to the nearest hour.\n+\n+``bucket(x, nbuckets)``               The partition value is an integer hash of ``x``, with a value between 0 and ``nbuckets - 1`` inclusive.", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzY3NDc2OA==", "url": "https://github.com/trinodb/trino/pull/4537#discussion_r483674768", "bodyText": "Added.", "author": "djsstarburst", "createdAt": "2020-09-04T15:01:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMyMTM2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMyMTQ5Nw==", "url": "https://github.com/trinodb/trino/pull/4537#discussion_r483321497", "bodyText": "Remove VARCHAR here (implied by \"characters\")", "author": "electrum", "createdAt": "2020-09-04T00:29:04Z", "path": "presto-docs/src/main/sphinx/connector/iceberg.rst", "diffHunk": "@@ -0,0 +1,197 @@\n+=================\n+Iceberg Connector\n+=================\n+\n+Overview\n+--------\n+\n+Apache Iceberg is an open table format for huge analytic datasets.\n+The Iceberg connector allows querying data stored in\n+files written in Iceberg format, as defined in the\n+`Iceberg Table Spec <https://iceberg.apache.org/spec/>`_.\n+\n+The Iceberg connector supports:\n+\n+* All Presto types, including TIME, TIMESTAMP, DECIMAL\n+* CREATE TABLE and CREATE TABLE AS\n+* Partitioning tables by any Presto type\n+* Dropping tables\n+* Renaming tables\n+* Deletion by partition\n+* Table and column statistics\n+* Table and column comments\n+* Rolling back a table to a previous state\n+* Schema evolution\n+\n+The Iceberg table state is maintained in metadata files. All changes to table state\n+create a new metadata file and replace the old metadata with an atomic swap.\n+The table metadata file tracks the table schema, partitioning config,\n+custom properties, and snapshots of the table contents.\n+\n+Iceberg data files can be stored in either Parquet or ORC format, as\n+determined by the ``format`` property in the table definition.  The\n+table ``format`` defaults to ``ORC``.\n+\n+Iceberg is designed to improve on the known scalabilty limitations of Hive.  Hive\n+stores table metadata in an object store backed by a database like MySQL.  It tracks\n+partition locations in the metastore, but not individual data files.  Presto queries\n+using the Hive connector must first call the metastore to get partition locations,\n+then call the underlying filesystem to list all data files inside each partition,\n+and then read metadata from each data file.\n+\n+Since Iceberg stores the paths to data files in the metadata files, it\n+only consults the underlying file system for files that must be read.\n+\n+Status\n+------\n+\n+The Iceberg connector is not yet supported for production use.\n+\n+Compatibility With Spark Iceberg\n+--------------------------------\n+\n+Tests have been written to demonstrate that data written by Presto can be read\n+using Spark SQL with the Iceberg format, and vice versa.  See\n+`TestSparkCompatibility <https://github.com/prestosql/presto/blob/master/presto-product-tests/src/main/java/io/prestosql/tests/iceberg/TestSparkCompatibility.java>`_.\n+\n+Configuration\n+-------------\n+\n+Iceberg supports the same metastore configuration properties as the Hive connector.\n+At a minimum, ``hive.metastore.uri`` must be configured:\n+\n+.. code-block:: none\n+\n+    connector.name=iceberg\n+    hive.metastore.uri=thrift://localhost:9083\n+\n+Partitioned Tables\n+------------------\n+\n+Iceberg supports partitioning by specifying transforms over the table columns.\n+A partition is created for each unique tuple value produced by the transforms.\n+Identity transforms are simply the column name. Other transforms are:\n+\n+===================================== ================================================================================================\n+Transform                             Description\n+===================================== ================================================================================================\n+``year(ts)``                          The partition value is the integer difference in years between ``ts`` and January 1st. 1970.\n+\n+``month(ts)``                         The partition value is the integer difference in months between ``ts`` and January 1st. 1970.\n+\n+``day(ts)``                           The partition value is the integer difference in days between ``ts`` and January 1st. 1970.\n+\n+``hour(ts)``                          The partition value is a TIMESTAMP rounded down to the nearest hour.\n+\n+``bucket(x, nbuckets)``               The partition value is an integer hash of ``x``, with a value between 0 and ``nbuckets - 1`` inclusive.\n+\n+``truncate(s, nchars)``               The partition value is the first ``nchars`` characters of VARCHAR ``s``.", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzY3NDgzMg==", "url": "https://github.com/trinodb/trino/pull/4537#discussion_r483674832", "bodyText": "Removed.", "author": "djsstarburst", "createdAt": "2020-09-04T15:01:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMyMTQ5Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMyMTYzMw==", "url": "https://github.com/trinodb/trino/pull/4537#discussion_r483321633", "bodyText": "In this example, the table is partitioned by month and further divided into 10 buckets based on a hash of the account number", "author": "electrum", "createdAt": "2020-09-04T00:29:34Z", "path": "presto-docs/src/main/sphinx/connector/iceberg.rst", "diffHunk": "@@ -0,0 +1,197 @@\n+=================\n+Iceberg Connector\n+=================\n+\n+Overview\n+--------\n+\n+Apache Iceberg is an open table format for huge analytic datasets.\n+The Iceberg connector allows querying data stored in\n+files written in Iceberg format, as defined in the\n+`Iceberg Table Spec <https://iceberg.apache.org/spec/>`_.\n+\n+The Iceberg connector supports:\n+\n+* All Presto types, including TIME, TIMESTAMP, DECIMAL\n+* CREATE TABLE and CREATE TABLE AS\n+* Partitioning tables by any Presto type\n+* Dropping tables\n+* Renaming tables\n+* Deletion by partition\n+* Table and column statistics\n+* Table and column comments\n+* Rolling back a table to a previous state\n+* Schema evolution\n+\n+The Iceberg table state is maintained in metadata files. All changes to table state\n+create a new metadata file and replace the old metadata with an atomic swap.\n+The table metadata file tracks the table schema, partitioning config,\n+custom properties, and snapshots of the table contents.\n+\n+Iceberg data files can be stored in either Parquet or ORC format, as\n+determined by the ``format`` property in the table definition.  The\n+table ``format`` defaults to ``ORC``.\n+\n+Iceberg is designed to improve on the known scalabilty limitations of Hive.  Hive\n+stores table metadata in an object store backed by a database like MySQL.  It tracks\n+partition locations in the metastore, but not individual data files.  Presto queries\n+using the Hive connector must first call the metastore to get partition locations,\n+then call the underlying filesystem to list all data files inside each partition,\n+and then read metadata from each data file.\n+\n+Since Iceberg stores the paths to data files in the metadata files, it\n+only consults the underlying file system for files that must be read.\n+\n+Status\n+------\n+\n+The Iceberg connector is not yet supported for production use.\n+\n+Compatibility With Spark Iceberg\n+--------------------------------\n+\n+Tests have been written to demonstrate that data written by Presto can be read\n+using Spark SQL with the Iceberg format, and vice versa.  See\n+`TestSparkCompatibility <https://github.com/prestosql/presto/blob/master/presto-product-tests/src/main/java/io/prestosql/tests/iceberg/TestSparkCompatibility.java>`_.\n+\n+Configuration\n+-------------\n+\n+Iceberg supports the same metastore configuration properties as the Hive connector.\n+At a minimum, ``hive.metastore.uri`` must be configured:\n+\n+.. code-block:: none\n+\n+    connector.name=iceberg\n+    hive.metastore.uri=thrift://localhost:9083\n+\n+Partitioned Tables\n+------------------\n+\n+Iceberg supports partitioning by specifying transforms over the table columns.\n+A partition is created for each unique tuple value produced by the transforms.\n+Identity transforms are simply the column name. Other transforms are:\n+\n+===================================== ================================================================================================\n+Transform                             Description\n+===================================== ================================================================================================\n+``year(ts)``                          The partition value is the integer difference in years between ``ts`` and January 1st. 1970.\n+\n+``month(ts)``                         The partition value is the integer difference in months between ``ts`` and January 1st. 1970.\n+\n+``day(ts)``                           The partition value is the integer difference in days between ``ts`` and January 1st. 1970.\n+\n+``hour(ts)``                          The partition value is a TIMESTAMP rounded down to the nearest hour.\n+\n+``bucket(x, nbuckets)``               The partition value is an integer hash of ``x``, with a value between 0 and ``nbuckets - 1`` inclusive.\n+\n+``truncate(s, nchars)``               The partition value is the first ``nchars`` characters of VARCHAR ``s``.\n+===================================== ================================================================================================\n+\n+In this example, the table is partitioned by month and by a hash of the account number::", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzY3NDkyNQ==", "url": "https://github.com/trinodb/trino/pull/4537#discussion_r483674925", "bodyText": "Added.", "author": "djsstarburst", "createdAt": "2020-09-04T15:01:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMyMTYzMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMyMTg0NA==", "url": "https://github.com/trinodb/trino/pull/4537#discussion_r483321844", "bodyText": "Add code quotes around WHERE", "author": "electrum", "createdAt": "2020-09-04T00:30:31Z", "path": "presto-docs/src/main/sphinx/connector/iceberg.rst", "diffHunk": "@@ -0,0 +1,197 @@\n+=================\n+Iceberg Connector\n+=================\n+\n+Overview\n+--------\n+\n+Apache Iceberg is an open table format for huge analytic datasets.\n+The Iceberg connector allows querying data stored in\n+files written in Iceberg format, as defined in the\n+`Iceberg Table Spec <https://iceberg.apache.org/spec/>`_.\n+\n+The Iceberg connector supports:\n+\n+* All Presto types, including TIME, TIMESTAMP, DECIMAL\n+* CREATE TABLE and CREATE TABLE AS\n+* Partitioning tables by any Presto type\n+* Dropping tables\n+* Renaming tables\n+* Deletion by partition\n+* Table and column statistics\n+* Table and column comments\n+* Rolling back a table to a previous state\n+* Schema evolution\n+\n+The Iceberg table state is maintained in metadata files. All changes to table state\n+create a new metadata file and replace the old metadata with an atomic swap.\n+The table metadata file tracks the table schema, partitioning config,\n+custom properties, and snapshots of the table contents.\n+\n+Iceberg data files can be stored in either Parquet or ORC format, as\n+determined by the ``format`` property in the table definition.  The\n+table ``format`` defaults to ``ORC``.\n+\n+Iceberg is designed to improve on the known scalabilty limitations of Hive.  Hive\n+stores table metadata in an object store backed by a database like MySQL.  It tracks\n+partition locations in the metastore, but not individual data files.  Presto queries\n+using the Hive connector must first call the metastore to get partition locations,\n+then call the underlying filesystem to list all data files inside each partition,\n+and then read metadata from each data file.\n+\n+Since Iceberg stores the paths to data files in the metadata files, it\n+only consults the underlying file system for files that must be read.\n+\n+Status\n+------\n+\n+The Iceberg connector is not yet supported for production use.\n+\n+Compatibility With Spark Iceberg\n+--------------------------------\n+\n+Tests have been written to demonstrate that data written by Presto can be read\n+using Spark SQL with the Iceberg format, and vice versa.  See\n+`TestSparkCompatibility <https://github.com/prestosql/presto/blob/master/presto-product-tests/src/main/java/io/prestosql/tests/iceberg/TestSparkCompatibility.java>`_.\n+\n+Configuration\n+-------------\n+\n+Iceberg supports the same metastore configuration properties as the Hive connector.\n+At a minimum, ``hive.metastore.uri`` must be configured:\n+\n+.. code-block:: none\n+\n+    connector.name=iceberg\n+    hive.metastore.uri=thrift://localhost:9083\n+\n+Partitioned Tables\n+------------------\n+\n+Iceberg supports partitioning by specifying transforms over the table columns.\n+A partition is created for each unique tuple value produced by the transforms.\n+Identity transforms are simply the column name. Other transforms are:\n+\n+===================================== ================================================================================================\n+Transform                             Description\n+===================================== ================================================================================================\n+``year(ts)``                          The partition value is the integer difference in years between ``ts`` and January 1st. 1970.\n+\n+``month(ts)``                         The partition value is the integer difference in months between ``ts`` and January 1st. 1970.\n+\n+``day(ts)``                           The partition value is the integer difference in days between ``ts`` and January 1st. 1970.\n+\n+``hour(ts)``                          The partition value is a TIMESTAMP rounded down to the nearest hour.\n+\n+``bucket(x, nbuckets)``               The partition value is an integer hash of ``x``, with a value between 0 and ``nbuckets - 1`` inclusive.\n+\n+``truncate(s, nchars)``               The partition value is the first ``nchars`` characters of VARCHAR ``s``.\n+===================================== ================================================================================================\n+\n+In this example, the table is partitioned by month and by a hash of the account number::\n+\n+    CREATE TABLE iceberg.testdb.sample_partitioned (\n+        order_date DATE,\n+        account_number BIGINT,\n+        customer VARCHAR)\n+    WITH (partitioning = ARRAY['month(order_date)', 'bucket(account_number, 10)'])\n+\n+Deletion by Partition\n+---------------------\n+\n+For partitioned tables, the Iceberg connector supports the deletion of entire\n+partitions if the WHERE clause specifies an identity transform of a partition", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzY3NTAwNw==", "url": "https://github.com/trinodb/trino/pull/4537#discussion_r483675007", "bodyText": "Added.", "author": "djsstarburst", "createdAt": "2020-09-04T15:02:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMyMTg0NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMyMTkxOQ==", "url": "https://github.com/trinodb/trino/pull/4537#discussion_r483321919", "bodyText": "Code quotes around \"c\" and \"1\"", "author": "electrum", "createdAt": "2020-09-04T00:30:47Z", "path": "presto-docs/src/main/sphinx/connector/iceberg.rst", "diffHunk": "@@ -0,0 +1,197 @@\n+=================\n+Iceberg Connector\n+=================\n+\n+Overview\n+--------\n+\n+Apache Iceberg is an open table format for huge analytic datasets.\n+The Iceberg connector allows querying data stored in\n+files written in Iceberg format, as defined in the\n+`Iceberg Table Spec <https://iceberg.apache.org/spec/>`_.\n+\n+The Iceberg connector supports:\n+\n+* All Presto types, including TIME, TIMESTAMP, DECIMAL\n+* CREATE TABLE and CREATE TABLE AS\n+* Partitioning tables by any Presto type\n+* Dropping tables\n+* Renaming tables\n+* Deletion by partition\n+* Table and column statistics\n+* Table and column comments\n+* Rolling back a table to a previous state\n+* Schema evolution\n+\n+The Iceberg table state is maintained in metadata files. All changes to table state\n+create a new metadata file and replace the old metadata with an atomic swap.\n+The table metadata file tracks the table schema, partitioning config,\n+custom properties, and snapshots of the table contents.\n+\n+Iceberg data files can be stored in either Parquet or ORC format, as\n+determined by the ``format`` property in the table definition.  The\n+table ``format`` defaults to ``ORC``.\n+\n+Iceberg is designed to improve on the known scalabilty limitations of Hive.  Hive\n+stores table metadata in an object store backed by a database like MySQL.  It tracks\n+partition locations in the metastore, but not individual data files.  Presto queries\n+using the Hive connector must first call the metastore to get partition locations,\n+then call the underlying filesystem to list all data files inside each partition,\n+and then read metadata from each data file.\n+\n+Since Iceberg stores the paths to data files in the metadata files, it\n+only consults the underlying file system for files that must be read.\n+\n+Status\n+------\n+\n+The Iceberg connector is not yet supported for production use.\n+\n+Compatibility With Spark Iceberg\n+--------------------------------\n+\n+Tests have been written to demonstrate that data written by Presto can be read\n+using Spark SQL with the Iceberg format, and vice versa.  See\n+`TestSparkCompatibility <https://github.com/prestosql/presto/blob/master/presto-product-tests/src/main/java/io/prestosql/tests/iceberg/TestSparkCompatibility.java>`_.\n+\n+Configuration\n+-------------\n+\n+Iceberg supports the same metastore configuration properties as the Hive connector.\n+At a minimum, ``hive.metastore.uri`` must be configured:\n+\n+.. code-block:: none\n+\n+    connector.name=iceberg\n+    hive.metastore.uri=thrift://localhost:9083\n+\n+Partitioned Tables\n+------------------\n+\n+Iceberg supports partitioning by specifying transforms over the table columns.\n+A partition is created for each unique tuple value produced by the transforms.\n+Identity transforms are simply the column name. Other transforms are:\n+\n+===================================== ================================================================================================\n+Transform                             Description\n+===================================== ================================================================================================\n+``year(ts)``                          The partition value is the integer difference in years between ``ts`` and January 1st. 1970.\n+\n+``month(ts)``                         The partition value is the integer difference in months between ``ts`` and January 1st. 1970.\n+\n+``day(ts)``                           The partition value is the integer difference in days between ``ts`` and January 1st. 1970.\n+\n+``hour(ts)``                          The partition value is a TIMESTAMP rounded down to the nearest hour.\n+\n+``bucket(x, nbuckets)``               The partition value is an integer hash of ``x``, with a value between 0 and ``nbuckets - 1`` inclusive.\n+\n+``truncate(s, nchars)``               The partition value is the first ``nchars`` characters of VARCHAR ``s``.\n+===================================== ================================================================================================\n+\n+In this example, the table is partitioned by month and by a hash of the account number::\n+\n+    CREATE TABLE iceberg.testdb.sample_partitioned (\n+        order_date DATE,\n+        account_number BIGINT,\n+        customer VARCHAR)\n+    WITH (partitioning = ARRAY['month(order_date)', 'bucket(account_number, 10)'])\n+\n+Deletion by Partition\n+---------------------\n+\n+For partitioned tables, the Iceberg connector supports the deletion of entire\n+partitions if the WHERE clause specifies an identity transform of a partition\n+column.  Given this table definition::\n+\n+    CREATE TABLE test_partition_deletion (\n+        c integer,\n+        d double)\n+        WITH (partitioning = ARRAY['c'])\n+\n+This SQL will delete all partitions for which c is 1::", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzY3NTA4OQ==", "url": "https://github.com/trinodb/trino/pull/4537#discussion_r483675089", "bodyText": "Added.", "author": "djsstarburst", "createdAt": "2020-09-04T15:02:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMyMTkxOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMyMjEwNg==", "url": "https://github.com/trinodb/trino/pull/4537#discussion_r483322106", "bodyText": "It's better to use a more realistic example, similar to the one above.", "author": "electrum", "createdAt": "2020-09-04T00:31:30Z", "path": "presto-docs/src/main/sphinx/connector/iceberg.rst", "diffHunk": "@@ -0,0 +1,197 @@\n+=================\n+Iceberg Connector\n+=================\n+\n+Overview\n+--------\n+\n+Apache Iceberg is an open table format for huge analytic datasets.\n+The Iceberg connector allows querying data stored in\n+files written in Iceberg format, as defined in the\n+`Iceberg Table Spec <https://iceberg.apache.org/spec/>`_.\n+\n+The Iceberg connector supports:\n+\n+* All Presto types, including TIME, TIMESTAMP, DECIMAL\n+* CREATE TABLE and CREATE TABLE AS\n+* Partitioning tables by any Presto type\n+* Dropping tables\n+* Renaming tables\n+* Deletion by partition\n+* Table and column statistics\n+* Table and column comments\n+* Rolling back a table to a previous state\n+* Schema evolution\n+\n+The Iceberg table state is maintained in metadata files. All changes to table state\n+create a new metadata file and replace the old metadata with an atomic swap.\n+The table metadata file tracks the table schema, partitioning config,\n+custom properties, and snapshots of the table contents.\n+\n+Iceberg data files can be stored in either Parquet or ORC format, as\n+determined by the ``format`` property in the table definition.  The\n+table ``format`` defaults to ``ORC``.\n+\n+Iceberg is designed to improve on the known scalabilty limitations of Hive.  Hive\n+stores table metadata in an object store backed by a database like MySQL.  It tracks\n+partition locations in the metastore, but not individual data files.  Presto queries\n+using the Hive connector must first call the metastore to get partition locations,\n+then call the underlying filesystem to list all data files inside each partition,\n+and then read metadata from each data file.\n+\n+Since Iceberg stores the paths to data files in the metadata files, it\n+only consults the underlying file system for files that must be read.\n+\n+Status\n+------\n+\n+The Iceberg connector is not yet supported for production use.\n+\n+Compatibility With Spark Iceberg\n+--------------------------------\n+\n+Tests have been written to demonstrate that data written by Presto can be read\n+using Spark SQL with the Iceberg format, and vice versa.  See\n+`TestSparkCompatibility <https://github.com/prestosql/presto/blob/master/presto-product-tests/src/main/java/io/prestosql/tests/iceberg/TestSparkCompatibility.java>`_.\n+\n+Configuration\n+-------------\n+\n+Iceberg supports the same metastore configuration properties as the Hive connector.\n+At a minimum, ``hive.metastore.uri`` must be configured:\n+\n+.. code-block:: none\n+\n+    connector.name=iceberg\n+    hive.metastore.uri=thrift://localhost:9083\n+\n+Partitioned Tables\n+------------------\n+\n+Iceberg supports partitioning by specifying transforms over the table columns.\n+A partition is created for each unique tuple value produced by the transforms.\n+Identity transforms are simply the column name. Other transforms are:\n+\n+===================================== ================================================================================================\n+Transform                             Description\n+===================================== ================================================================================================\n+``year(ts)``                          The partition value is the integer difference in years between ``ts`` and January 1st. 1970.\n+\n+``month(ts)``                         The partition value is the integer difference in months between ``ts`` and January 1st. 1970.\n+\n+``day(ts)``                           The partition value is the integer difference in days between ``ts`` and January 1st. 1970.\n+\n+``hour(ts)``                          The partition value is a TIMESTAMP rounded down to the nearest hour.\n+\n+``bucket(x, nbuckets)``               The partition value is an integer hash of ``x``, with a value between 0 and ``nbuckets - 1`` inclusive.\n+\n+``truncate(s, nchars)``               The partition value is the first ``nchars`` characters of VARCHAR ``s``.\n+===================================== ================================================================================================\n+\n+In this example, the table is partitioned by month and by a hash of the account number::\n+\n+    CREATE TABLE iceberg.testdb.sample_partitioned (\n+        order_date DATE,\n+        account_number BIGINT,\n+        customer VARCHAR)\n+    WITH (partitioning = ARRAY['month(order_date)', 'bucket(account_number, 10)'])\n+\n+Deletion by Partition\n+---------------------\n+\n+For partitioned tables, the Iceberg connector supports the deletion of entire\n+partitions if the WHERE clause specifies an identity transform of a partition\n+column.  Given this table definition::\n+\n+    CREATE TABLE test_partition_deletion (", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzY3NTM2Mg==", "url": "https://github.com/trinodb/trino/pull/4537#discussion_r483675362", "bodyText": "Changed to be an example using the table above.", "author": "djsstarburst", "createdAt": "2020-09-04T15:02:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMyMjEwNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMyMjI1Nw==", "url": "https://github.com/trinodb/trino/pull/4537#discussion_r483322257", "bodyText": "Currently, the Iceberg connector only supports deletion by partition.", "author": "electrum", "createdAt": "2020-09-04T00:32:04Z", "path": "presto-docs/src/main/sphinx/connector/iceberg.rst", "diffHunk": "@@ -0,0 +1,197 @@\n+=================\n+Iceberg Connector\n+=================\n+\n+Overview\n+--------\n+\n+Apache Iceberg is an open table format for huge analytic datasets.\n+The Iceberg connector allows querying data stored in\n+files written in Iceberg format, as defined in the\n+`Iceberg Table Spec <https://iceberg.apache.org/spec/>`_.\n+\n+The Iceberg connector supports:\n+\n+* All Presto types, including TIME, TIMESTAMP, DECIMAL\n+* CREATE TABLE and CREATE TABLE AS\n+* Partitioning tables by any Presto type\n+* Dropping tables\n+* Renaming tables\n+* Deletion by partition\n+* Table and column statistics\n+* Table and column comments\n+* Rolling back a table to a previous state\n+* Schema evolution\n+\n+The Iceberg table state is maintained in metadata files. All changes to table state\n+create a new metadata file and replace the old metadata with an atomic swap.\n+The table metadata file tracks the table schema, partitioning config,\n+custom properties, and snapshots of the table contents.\n+\n+Iceberg data files can be stored in either Parquet or ORC format, as\n+determined by the ``format`` property in the table definition.  The\n+table ``format`` defaults to ``ORC``.\n+\n+Iceberg is designed to improve on the known scalabilty limitations of Hive.  Hive\n+stores table metadata in an object store backed by a database like MySQL.  It tracks\n+partition locations in the metastore, but not individual data files.  Presto queries\n+using the Hive connector must first call the metastore to get partition locations,\n+then call the underlying filesystem to list all data files inside each partition,\n+and then read metadata from each data file.\n+\n+Since Iceberg stores the paths to data files in the metadata files, it\n+only consults the underlying file system for files that must be read.\n+\n+Status\n+------\n+\n+The Iceberg connector is not yet supported for production use.\n+\n+Compatibility With Spark Iceberg\n+--------------------------------\n+\n+Tests have been written to demonstrate that data written by Presto can be read\n+using Spark SQL with the Iceberg format, and vice versa.  See\n+`TestSparkCompatibility <https://github.com/prestosql/presto/blob/master/presto-product-tests/src/main/java/io/prestosql/tests/iceberg/TestSparkCompatibility.java>`_.\n+\n+Configuration\n+-------------\n+\n+Iceberg supports the same metastore configuration properties as the Hive connector.\n+At a minimum, ``hive.metastore.uri`` must be configured:\n+\n+.. code-block:: none\n+\n+    connector.name=iceberg\n+    hive.metastore.uri=thrift://localhost:9083\n+\n+Partitioned Tables\n+------------------\n+\n+Iceberg supports partitioning by specifying transforms over the table columns.\n+A partition is created for each unique tuple value produced by the transforms.\n+Identity transforms are simply the column name. Other transforms are:\n+\n+===================================== ================================================================================================\n+Transform                             Description\n+===================================== ================================================================================================\n+``year(ts)``                          The partition value is the integer difference in years between ``ts`` and January 1st. 1970.\n+\n+``month(ts)``                         The partition value is the integer difference in months between ``ts`` and January 1st. 1970.\n+\n+``day(ts)``                           The partition value is the integer difference in days between ``ts`` and January 1st. 1970.\n+\n+``hour(ts)``                          The partition value is a TIMESTAMP rounded down to the nearest hour.\n+\n+``bucket(x, nbuckets)``               The partition value is an integer hash of ``x``, with a value between 0 and ``nbuckets - 1`` inclusive.\n+\n+``truncate(s, nchars)``               The partition value is the first ``nchars`` characters of VARCHAR ``s``.\n+===================================== ================================================================================================\n+\n+In this example, the table is partitioned by month and by a hash of the account number::\n+\n+    CREATE TABLE iceberg.testdb.sample_partitioned (\n+        order_date DATE,\n+        account_number BIGINT,\n+        customer VARCHAR)\n+    WITH (partitioning = ARRAY['month(order_date)', 'bucket(account_number, 10)'])\n+\n+Deletion by Partition\n+---------------------\n+\n+For partitioned tables, the Iceberg connector supports the deletion of entire\n+partitions if the WHERE clause specifies an identity transform of a partition\n+column.  Given this table definition::\n+\n+    CREATE TABLE test_partition_deletion (\n+        c integer,\n+        d double)\n+        WITH (partitioning = ARRAY['c'])\n+\n+This SQL will delete all partitions for which c is 1::\n+\n+    DELETE FROM test_partition_deletion\n+    WHERE c = 1\n+\n+The current Iceberg connector is based on Iceberg v1.  Iceberg v2 is not yet\n+released.  When v2 is released, it will support row-level deletion and the\n+Iceberg connector will be updated to provide row-level deletion.\n+\n+The Iceberg connector currently supports only deletion by partition.", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzY3NTQzMg==", "url": "https://github.com/trinodb/trino/pull/4537#discussion_r483675432", "bodyText": "Changed.", "author": "djsstarburst", "createdAt": "2020-09-04T15:02:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMyMjI1Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMyMjQ1Mg==", "url": "https://github.com/trinodb/trino/pull/4537#discussion_r483322452", "bodyText": "Let's remove this paragraph, as we avoid making forward-looking statements like this in documentation. It's also a bit confusing, as the user might think the connector will automatically support it when v2 is available.", "author": "electrum", "createdAt": "2020-09-04T00:32:55Z", "path": "presto-docs/src/main/sphinx/connector/iceberg.rst", "diffHunk": "@@ -0,0 +1,197 @@\n+=================\n+Iceberg Connector\n+=================\n+\n+Overview\n+--------\n+\n+Apache Iceberg is an open table format for huge analytic datasets.\n+The Iceberg connector allows querying data stored in\n+files written in Iceberg format, as defined in the\n+`Iceberg Table Spec <https://iceberg.apache.org/spec/>`_.\n+\n+The Iceberg connector supports:\n+\n+* All Presto types, including TIME, TIMESTAMP, DECIMAL\n+* CREATE TABLE and CREATE TABLE AS\n+* Partitioning tables by any Presto type\n+* Dropping tables\n+* Renaming tables\n+* Deletion by partition\n+* Table and column statistics\n+* Table and column comments\n+* Rolling back a table to a previous state\n+* Schema evolution\n+\n+The Iceberg table state is maintained in metadata files. All changes to table state\n+create a new metadata file and replace the old metadata with an atomic swap.\n+The table metadata file tracks the table schema, partitioning config,\n+custom properties, and snapshots of the table contents.\n+\n+Iceberg data files can be stored in either Parquet or ORC format, as\n+determined by the ``format`` property in the table definition.  The\n+table ``format`` defaults to ``ORC``.\n+\n+Iceberg is designed to improve on the known scalabilty limitations of Hive.  Hive\n+stores table metadata in an object store backed by a database like MySQL.  It tracks\n+partition locations in the metastore, but not individual data files.  Presto queries\n+using the Hive connector must first call the metastore to get partition locations,\n+then call the underlying filesystem to list all data files inside each partition,\n+and then read metadata from each data file.\n+\n+Since Iceberg stores the paths to data files in the metadata files, it\n+only consults the underlying file system for files that must be read.\n+\n+Status\n+------\n+\n+The Iceberg connector is not yet supported for production use.\n+\n+Compatibility With Spark Iceberg\n+--------------------------------\n+\n+Tests have been written to demonstrate that data written by Presto can be read\n+using Spark SQL with the Iceberg format, and vice versa.  See\n+`TestSparkCompatibility <https://github.com/prestosql/presto/blob/master/presto-product-tests/src/main/java/io/prestosql/tests/iceberg/TestSparkCompatibility.java>`_.\n+\n+Configuration\n+-------------\n+\n+Iceberg supports the same metastore configuration properties as the Hive connector.\n+At a minimum, ``hive.metastore.uri`` must be configured:\n+\n+.. code-block:: none\n+\n+    connector.name=iceberg\n+    hive.metastore.uri=thrift://localhost:9083\n+\n+Partitioned Tables\n+------------------\n+\n+Iceberg supports partitioning by specifying transforms over the table columns.\n+A partition is created for each unique tuple value produced by the transforms.\n+Identity transforms are simply the column name. Other transforms are:\n+\n+===================================== ================================================================================================\n+Transform                             Description\n+===================================== ================================================================================================\n+``year(ts)``                          The partition value is the integer difference in years between ``ts`` and January 1st. 1970.\n+\n+``month(ts)``                         The partition value is the integer difference in months between ``ts`` and January 1st. 1970.\n+\n+``day(ts)``                           The partition value is the integer difference in days between ``ts`` and January 1st. 1970.\n+\n+``hour(ts)``                          The partition value is a TIMESTAMP rounded down to the nearest hour.\n+\n+``bucket(x, nbuckets)``               The partition value is an integer hash of ``x``, with a value between 0 and ``nbuckets - 1`` inclusive.\n+\n+``truncate(s, nchars)``               The partition value is the first ``nchars`` characters of VARCHAR ``s``.\n+===================================== ================================================================================================\n+\n+In this example, the table is partitioned by month and by a hash of the account number::\n+\n+    CREATE TABLE iceberg.testdb.sample_partitioned (\n+        order_date DATE,\n+        account_number BIGINT,\n+        customer VARCHAR)\n+    WITH (partitioning = ARRAY['month(order_date)', 'bucket(account_number, 10)'])\n+\n+Deletion by Partition\n+---------------------\n+\n+For partitioned tables, the Iceberg connector supports the deletion of entire\n+partitions if the WHERE clause specifies an identity transform of a partition\n+column.  Given this table definition::\n+\n+    CREATE TABLE test_partition_deletion (\n+        c integer,\n+        d double)\n+        WITH (partitioning = ARRAY['c'])\n+\n+This SQL will delete all partitions for which c is 1::\n+\n+    DELETE FROM test_partition_deletion\n+    WHERE c = 1\n+\n+The current Iceberg connector is based on Iceberg v1.  Iceberg v2 is not yet", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzY3NTUxOQ==", "url": "https://github.com/trinodb/trino/pull/4537#discussion_r483675519", "bodyText": "Removed.", "author": "djsstarburst", "createdAt": "2020-09-04T15:02:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMyMjQ1Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMyMjYwMA==", "url": "https://github.com/trinodb/trino/pull/4537#discussion_r483322600", "bodyText": "Missing a word or something here: \"because the doesn't span\"", "author": "electrum", "createdAt": "2020-09-04T00:33:29Z", "path": "presto-docs/src/main/sphinx/connector/iceberg.rst", "diffHunk": "@@ -0,0 +1,197 @@\n+=================\n+Iceberg Connector\n+=================\n+\n+Overview\n+--------\n+\n+Apache Iceberg is an open table format for huge analytic datasets.\n+The Iceberg connector allows querying data stored in\n+files written in Iceberg format, as defined in the\n+`Iceberg Table Spec <https://iceberg.apache.org/spec/>`_.\n+\n+The Iceberg connector supports:\n+\n+* All Presto types, including TIME, TIMESTAMP, DECIMAL\n+* CREATE TABLE and CREATE TABLE AS\n+* Partitioning tables by any Presto type\n+* Dropping tables\n+* Renaming tables\n+* Deletion by partition\n+* Table and column statistics\n+* Table and column comments\n+* Rolling back a table to a previous state\n+* Schema evolution\n+\n+The Iceberg table state is maintained in metadata files. All changes to table state\n+create a new metadata file and replace the old metadata with an atomic swap.\n+The table metadata file tracks the table schema, partitioning config,\n+custom properties, and snapshots of the table contents.\n+\n+Iceberg data files can be stored in either Parquet or ORC format, as\n+determined by the ``format`` property in the table definition.  The\n+table ``format`` defaults to ``ORC``.\n+\n+Iceberg is designed to improve on the known scalabilty limitations of Hive.  Hive\n+stores table metadata in an object store backed by a database like MySQL.  It tracks\n+partition locations in the metastore, but not individual data files.  Presto queries\n+using the Hive connector must first call the metastore to get partition locations,\n+then call the underlying filesystem to list all data files inside each partition,\n+and then read metadata from each data file.\n+\n+Since Iceberg stores the paths to data files in the metadata files, it\n+only consults the underlying file system for files that must be read.\n+\n+Status\n+------\n+\n+The Iceberg connector is not yet supported for production use.\n+\n+Compatibility With Spark Iceberg\n+--------------------------------\n+\n+Tests have been written to demonstrate that data written by Presto can be read\n+using Spark SQL with the Iceberg format, and vice versa.  See\n+`TestSparkCompatibility <https://github.com/prestosql/presto/blob/master/presto-product-tests/src/main/java/io/prestosql/tests/iceberg/TestSparkCompatibility.java>`_.\n+\n+Configuration\n+-------------\n+\n+Iceberg supports the same metastore configuration properties as the Hive connector.\n+At a minimum, ``hive.metastore.uri`` must be configured:\n+\n+.. code-block:: none\n+\n+    connector.name=iceberg\n+    hive.metastore.uri=thrift://localhost:9083\n+\n+Partitioned Tables\n+------------------\n+\n+Iceberg supports partitioning by specifying transforms over the table columns.\n+A partition is created for each unique tuple value produced by the transforms.\n+Identity transforms are simply the column name. Other transforms are:\n+\n+===================================== ================================================================================================\n+Transform                             Description\n+===================================== ================================================================================================\n+``year(ts)``                          The partition value is the integer difference in years between ``ts`` and January 1st. 1970.\n+\n+``month(ts)``                         The partition value is the integer difference in months between ``ts`` and January 1st. 1970.\n+\n+``day(ts)``                           The partition value is the integer difference in days between ``ts`` and January 1st. 1970.\n+\n+``hour(ts)``                          The partition value is a TIMESTAMP rounded down to the nearest hour.\n+\n+``bucket(x, nbuckets)``               The partition value is an integer hash of ``x``, with a value between 0 and ``nbuckets - 1`` inclusive.\n+\n+``truncate(s, nchars)``               The partition value is the first ``nchars`` characters of VARCHAR ``s``.\n+===================================== ================================================================================================\n+\n+In this example, the table is partitioned by month and by a hash of the account number::\n+\n+    CREATE TABLE iceberg.testdb.sample_partitioned (\n+        order_date DATE,\n+        account_number BIGINT,\n+        customer VARCHAR)\n+    WITH (partitioning = ARRAY['month(order_date)', 'bucket(account_number, 10)'])\n+\n+Deletion by Partition\n+---------------------\n+\n+For partitioned tables, the Iceberg connector supports the deletion of entire\n+partitions if the WHERE clause specifies an identity transform of a partition\n+column.  Given this table definition::\n+\n+    CREATE TABLE test_partition_deletion (\n+        c integer,\n+        d double)\n+        WITH (partitioning = ARRAY['c'])\n+\n+This SQL will delete all partitions for which c is 1::\n+\n+    DELETE FROM test_partition_deletion\n+    WHERE c = 1\n+\n+The current Iceberg connector is based on Iceberg v1.  Iceberg v2 is not yet\n+released.  When v2 is released, it will support row-level deletion and the\n+Iceberg connector will be updated to provide row-level deletion.\n+\n+The Iceberg connector currently supports only deletion by partition.\n+This SQL below will fail because the doesn't span entire partitions::", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzY3NTczNA==", "url": "https://github.com/trinodb/trino/pull/4537#discussion_r483675734", "bodyText": "Restructured and made clearer.", "author": "djsstarburst", "createdAt": "2020-09-04T15:03:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMyMjYwMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMyMjczNw==", "url": "https://github.com/trinodb/trino/pull/4537#discussion_r483322737", "bodyText": "Let's change this to text\n\nwhere table snapshots are identified by snapshot IDs\n\nI don't think saying \"long\" or \"numeric\" is needed here", "author": "electrum", "createdAt": "2020-09-04T00:34:07Z", "path": "presto-docs/src/main/sphinx/connector/iceberg.rst", "diffHunk": "@@ -0,0 +1,197 @@\n+=================\n+Iceberg Connector\n+=================\n+\n+Overview\n+--------\n+\n+Apache Iceberg is an open table format for huge analytic datasets.\n+The Iceberg connector allows querying data stored in\n+files written in Iceberg format, as defined in the\n+`Iceberg Table Spec <https://iceberg.apache.org/spec/>`_.\n+\n+The Iceberg connector supports:\n+\n+* All Presto types, including TIME, TIMESTAMP, DECIMAL\n+* CREATE TABLE and CREATE TABLE AS\n+* Partitioning tables by any Presto type\n+* Dropping tables\n+* Renaming tables\n+* Deletion by partition\n+* Table and column statistics\n+* Table and column comments\n+* Rolling back a table to a previous state\n+* Schema evolution\n+\n+The Iceberg table state is maintained in metadata files. All changes to table state\n+create a new metadata file and replace the old metadata with an atomic swap.\n+The table metadata file tracks the table schema, partitioning config,\n+custom properties, and snapshots of the table contents.\n+\n+Iceberg data files can be stored in either Parquet or ORC format, as\n+determined by the ``format`` property in the table definition.  The\n+table ``format`` defaults to ``ORC``.\n+\n+Iceberg is designed to improve on the known scalabilty limitations of Hive.  Hive\n+stores table metadata in an object store backed by a database like MySQL.  It tracks\n+partition locations in the metastore, but not individual data files.  Presto queries\n+using the Hive connector must first call the metastore to get partition locations,\n+then call the underlying filesystem to list all data files inside each partition,\n+and then read metadata from each data file.\n+\n+Since Iceberg stores the paths to data files in the metadata files, it\n+only consults the underlying file system for files that must be read.\n+\n+Status\n+------\n+\n+The Iceberg connector is not yet supported for production use.\n+\n+Compatibility With Spark Iceberg\n+--------------------------------\n+\n+Tests have been written to demonstrate that data written by Presto can be read\n+using Spark SQL with the Iceberg format, and vice versa.  See\n+`TestSparkCompatibility <https://github.com/prestosql/presto/blob/master/presto-product-tests/src/main/java/io/prestosql/tests/iceberg/TestSparkCompatibility.java>`_.\n+\n+Configuration\n+-------------\n+\n+Iceberg supports the same metastore configuration properties as the Hive connector.\n+At a minimum, ``hive.metastore.uri`` must be configured:\n+\n+.. code-block:: none\n+\n+    connector.name=iceberg\n+    hive.metastore.uri=thrift://localhost:9083\n+\n+Partitioned Tables\n+------------------\n+\n+Iceberg supports partitioning by specifying transforms over the table columns.\n+A partition is created for each unique tuple value produced by the transforms.\n+Identity transforms are simply the column name. Other transforms are:\n+\n+===================================== ================================================================================================\n+Transform                             Description\n+===================================== ================================================================================================\n+``year(ts)``                          The partition value is the integer difference in years between ``ts`` and January 1st. 1970.\n+\n+``month(ts)``                         The partition value is the integer difference in months between ``ts`` and January 1st. 1970.\n+\n+``day(ts)``                           The partition value is the integer difference in days between ``ts`` and January 1st. 1970.\n+\n+``hour(ts)``                          The partition value is a TIMESTAMP rounded down to the nearest hour.\n+\n+``bucket(x, nbuckets)``               The partition value is an integer hash of ``x``, with a value between 0 and ``nbuckets - 1`` inclusive.\n+\n+``truncate(s, nchars)``               The partition value is the first ``nchars`` characters of VARCHAR ``s``.\n+===================================== ================================================================================================\n+\n+In this example, the table is partitioned by month and by a hash of the account number::\n+\n+    CREATE TABLE iceberg.testdb.sample_partitioned (\n+        order_date DATE,\n+        account_number BIGINT,\n+        customer VARCHAR)\n+    WITH (partitioning = ARRAY['month(order_date)', 'bucket(account_number, 10)'])\n+\n+Deletion by Partition\n+---------------------\n+\n+For partitioned tables, the Iceberg connector supports the deletion of entire\n+partitions if the WHERE clause specifies an identity transform of a partition\n+column.  Given this table definition::\n+\n+    CREATE TABLE test_partition_deletion (\n+        c integer,\n+        d double)\n+        WITH (partitioning = ARRAY['c'])\n+\n+This SQL will delete all partitions for which c is 1::\n+\n+    DELETE FROM test_partition_deletion\n+    WHERE c = 1\n+\n+The current Iceberg connector is based on Iceberg v1.  Iceberg v2 is not yet\n+released.  When v2 is released, it will support row-level deletion and the\n+Iceberg connector will be updated to provide row-level deletion.\n+\n+The Iceberg connector currently supports only deletion by partition.\n+This SQL below will fail because the doesn't span entire partitions::\n+\n+    DELETE FROM test_partition_deletion\n+    WHERE c = 1 AND d > 10\n+\n+Rolling Back to a Previous Snapshot\n+-----------------------------------\n+\n+Iceberg supports a \"snapshot\" model of data, where table snapshots are\n+identified by an ``long`` snapshot_ids.", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzY3NTkwNg==", "url": "https://github.com/trinodb/trino/pull/4537#discussion_r483675906", "bodyText": "Changed.", "author": "djsstarburst", "createdAt": "2020-09-04T15:03:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMyMjczNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMyMjgzMw==", "url": "https://github.com/trinodb/trino/pull/4537#discussion_r483322833", "bodyText": "Capitalize ID", "author": "electrum", "createdAt": "2020-09-04T00:34:38Z", "path": "presto-docs/src/main/sphinx/connector/iceberg.rst", "diffHunk": "@@ -0,0 +1,197 @@\n+=================\n+Iceberg Connector\n+=================\n+\n+Overview\n+--------\n+\n+Apache Iceberg is an open table format for huge analytic datasets.\n+The Iceberg connector allows querying data stored in\n+files written in Iceberg format, as defined in the\n+`Iceberg Table Spec <https://iceberg.apache.org/spec/>`_.\n+\n+The Iceberg connector supports:\n+\n+* All Presto types, including TIME, TIMESTAMP, DECIMAL\n+* CREATE TABLE and CREATE TABLE AS\n+* Partitioning tables by any Presto type\n+* Dropping tables\n+* Renaming tables\n+* Deletion by partition\n+* Table and column statistics\n+* Table and column comments\n+* Rolling back a table to a previous state\n+* Schema evolution\n+\n+The Iceberg table state is maintained in metadata files. All changes to table state\n+create a new metadata file and replace the old metadata with an atomic swap.\n+The table metadata file tracks the table schema, partitioning config,\n+custom properties, and snapshots of the table contents.\n+\n+Iceberg data files can be stored in either Parquet or ORC format, as\n+determined by the ``format`` property in the table definition.  The\n+table ``format`` defaults to ``ORC``.\n+\n+Iceberg is designed to improve on the known scalabilty limitations of Hive.  Hive\n+stores table metadata in an object store backed by a database like MySQL.  It tracks\n+partition locations in the metastore, but not individual data files.  Presto queries\n+using the Hive connector must first call the metastore to get partition locations,\n+then call the underlying filesystem to list all data files inside each partition,\n+and then read metadata from each data file.\n+\n+Since Iceberg stores the paths to data files in the metadata files, it\n+only consults the underlying file system for files that must be read.\n+\n+Status\n+------\n+\n+The Iceberg connector is not yet supported for production use.\n+\n+Compatibility With Spark Iceberg\n+--------------------------------\n+\n+Tests have been written to demonstrate that data written by Presto can be read\n+using Spark SQL with the Iceberg format, and vice versa.  See\n+`TestSparkCompatibility <https://github.com/prestosql/presto/blob/master/presto-product-tests/src/main/java/io/prestosql/tests/iceberg/TestSparkCompatibility.java>`_.\n+\n+Configuration\n+-------------\n+\n+Iceberg supports the same metastore configuration properties as the Hive connector.\n+At a minimum, ``hive.metastore.uri`` must be configured:\n+\n+.. code-block:: none\n+\n+    connector.name=iceberg\n+    hive.metastore.uri=thrift://localhost:9083\n+\n+Partitioned Tables\n+------------------\n+\n+Iceberg supports partitioning by specifying transforms over the table columns.\n+A partition is created for each unique tuple value produced by the transforms.\n+Identity transforms are simply the column name. Other transforms are:\n+\n+===================================== ================================================================================================\n+Transform                             Description\n+===================================== ================================================================================================\n+``year(ts)``                          The partition value is the integer difference in years between ``ts`` and January 1st. 1970.\n+\n+``month(ts)``                         The partition value is the integer difference in months between ``ts`` and January 1st. 1970.\n+\n+``day(ts)``                           The partition value is the integer difference in days between ``ts`` and January 1st. 1970.\n+\n+``hour(ts)``                          The partition value is a TIMESTAMP rounded down to the nearest hour.\n+\n+``bucket(x, nbuckets)``               The partition value is an integer hash of ``x``, with a value between 0 and ``nbuckets - 1`` inclusive.\n+\n+``truncate(s, nchars)``               The partition value is the first ``nchars`` characters of VARCHAR ``s``.\n+===================================== ================================================================================================\n+\n+In this example, the table is partitioned by month and by a hash of the account number::\n+\n+    CREATE TABLE iceberg.testdb.sample_partitioned (\n+        order_date DATE,\n+        account_number BIGINT,\n+        customer VARCHAR)\n+    WITH (partitioning = ARRAY['month(order_date)', 'bucket(account_number, 10)'])\n+\n+Deletion by Partition\n+---------------------\n+\n+For partitioned tables, the Iceberg connector supports the deletion of entire\n+partitions if the WHERE clause specifies an identity transform of a partition\n+column.  Given this table definition::\n+\n+    CREATE TABLE test_partition_deletion (\n+        c integer,\n+        d double)\n+        WITH (partitioning = ARRAY['c'])\n+\n+This SQL will delete all partitions for which c is 1::\n+\n+    DELETE FROM test_partition_deletion\n+    WHERE c = 1\n+\n+The current Iceberg connector is based on Iceberg v1.  Iceberg v2 is not yet\n+released.  When v2 is released, it will support row-level deletion and the\n+Iceberg connector will be updated to provide row-level deletion.\n+\n+The Iceberg connector currently supports only deletion by partition.\n+This SQL below will fail because the doesn't span entire partitions::\n+\n+    DELETE FROM test_partition_deletion\n+    WHERE c = 1 AND d > 10\n+\n+Rolling Back to a Previous Snapshot\n+-----------------------------------\n+\n+Iceberg supports a \"snapshot\" model of data, where table snapshots are\n+identified by an ``long`` snapshot_ids.\n+\n+The connector provides a system snapshots table for each Iceberg table.  Snapshots are\n+identified by BIGINT snapshot ids.  You can find the latest snapshot id for table", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzY3NTk4NA==", "url": "https://github.com/trinodb/trino/pull/4537#discussion_r483675984", "bodyText": "Capitalized.", "author": "djsstarburst", "createdAt": "2020-09-04T15:03:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMyMjgzMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMyMjk4MA==", "url": "https://github.com/trinodb/trino/pull/4537#discussion_r483322980", "bodyText": "Code quotes around \"foo\". But please use a more realistic name.", "author": "electrum", "createdAt": "2020-09-04T00:35:08Z", "path": "presto-docs/src/main/sphinx/connector/iceberg.rst", "diffHunk": "@@ -0,0 +1,197 @@\n+=================\n+Iceberg Connector\n+=================\n+\n+Overview\n+--------\n+\n+Apache Iceberg is an open table format for huge analytic datasets.\n+The Iceberg connector allows querying data stored in\n+files written in Iceberg format, as defined in the\n+`Iceberg Table Spec <https://iceberg.apache.org/spec/>`_.\n+\n+The Iceberg connector supports:\n+\n+* All Presto types, including TIME, TIMESTAMP, DECIMAL\n+* CREATE TABLE and CREATE TABLE AS\n+* Partitioning tables by any Presto type\n+* Dropping tables\n+* Renaming tables\n+* Deletion by partition\n+* Table and column statistics\n+* Table and column comments\n+* Rolling back a table to a previous state\n+* Schema evolution\n+\n+The Iceberg table state is maintained in metadata files. All changes to table state\n+create a new metadata file and replace the old metadata with an atomic swap.\n+The table metadata file tracks the table schema, partitioning config,\n+custom properties, and snapshots of the table contents.\n+\n+Iceberg data files can be stored in either Parquet or ORC format, as\n+determined by the ``format`` property in the table definition.  The\n+table ``format`` defaults to ``ORC``.\n+\n+Iceberg is designed to improve on the known scalabilty limitations of Hive.  Hive\n+stores table metadata in an object store backed by a database like MySQL.  It tracks\n+partition locations in the metastore, but not individual data files.  Presto queries\n+using the Hive connector must first call the metastore to get partition locations,\n+then call the underlying filesystem to list all data files inside each partition,\n+and then read metadata from each data file.\n+\n+Since Iceberg stores the paths to data files in the metadata files, it\n+only consults the underlying file system for files that must be read.\n+\n+Status\n+------\n+\n+The Iceberg connector is not yet supported for production use.\n+\n+Compatibility With Spark Iceberg\n+--------------------------------\n+\n+Tests have been written to demonstrate that data written by Presto can be read\n+using Spark SQL with the Iceberg format, and vice versa.  See\n+`TestSparkCompatibility <https://github.com/prestosql/presto/blob/master/presto-product-tests/src/main/java/io/prestosql/tests/iceberg/TestSparkCompatibility.java>`_.\n+\n+Configuration\n+-------------\n+\n+Iceberg supports the same metastore configuration properties as the Hive connector.\n+At a minimum, ``hive.metastore.uri`` must be configured:\n+\n+.. code-block:: none\n+\n+    connector.name=iceberg\n+    hive.metastore.uri=thrift://localhost:9083\n+\n+Partitioned Tables\n+------------------\n+\n+Iceberg supports partitioning by specifying transforms over the table columns.\n+A partition is created for each unique tuple value produced by the transforms.\n+Identity transforms are simply the column name. Other transforms are:\n+\n+===================================== ================================================================================================\n+Transform                             Description\n+===================================== ================================================================================================\n+``year(ts)``                          The partition value is the integer difference in years between ``ts`` and January 1st. 1970.\n+\n+``month(ts)``                         The partition value is the integer difference in months between ``ts`` and January 1st. 1970.\n+\n+``day(ts)``                           The partition value is the integer difference in days between ``ts`` and January 1st. 1970.\n+\n+``hour(ts)``                          The partition value is a TIMESTAMP rounded down to the nearest hour.\n+\n+``bucket(x, nbuckets)``               The partition value is an integer hash of ``x``, with a value between 0 and ``nbuckets - 1`` inclusive.\n+\n+``truncate(s, nchars)``               The partition value is the first ``nchars`` characters of VARCHAR ``s``.\n+===================================== ================================================================================================\n+\n+In this example, the table is partitioned by month and by a hash of the account number::\n+\n+    CREATE TABLE iceberg.testdb.sample_partitioned (\n+        order_date DATE,\n+        account_number BIGINT,\n+        customer VARCHAR)\n+    WITH (partitioning = ARRAY['month(order_date)', 'bucket(account_number, 10)'])\n+\n+Deletion by Partition\n+---------------------\n+\n+For partitioned tables, the Iceberg connector supports the deletion of entire\n+partitions if the WHERE clause specifies an identity transform of a partition\n+column.  Given this table definition::\n+\n+    CREATE TABLE test_partition_deletion (\n+        c integer,\n+        d double)\n+        WITH (partitioning = ARRAY['c'])\n+\n+This SQL will delete all partitions for which c is 1::\n+\n+    DELETE FROM test_partition_deletion\n+    WHERE c = 1\n+\n+The current Iceberg connector is based on Iceberg v1.  Iceberg v2 is not yet\n+released.  When v2 is released, it will support row-level deletion and the\n+Iceberg connector will be updated to provide row-level deletion.\n+\n+The Iceberg connector currently supports only deletion by partition.\n+This SQL below will fail because the doesn't span entire partitions::\n+\n+    DELETE FROM test_partition_deletion\n+    WHERE c = 1 AND d > 10\n+\n+Rolling Back to a Previous Snapshot\n+-----------------------------------\n+\n+Iceberg supports a \"snapshot\" model of data, where table snapshots are\n+identified by an ``long`` snapshot_ids.\n+\n+The connector provides a system snapshots table for each Iceberg table.  Snapshots are\n+identified by BIGINT snapshot ids.  You can find the latest snapshot id for table\n+foo by running the following command::", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzY3NjEzMQ==", "url": "https://github.com/trinodb/trino/pull/4537#discussion_r483676131", "bodyText": "Quoted a more realistic name.", "author": "djsstarburst", "createdAt": "2020-09-04T15:03:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMyMjk4MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMyMzA3NA==", "url": "https://github.com/trinodb/trino/pull/4537#discussion_r483323074", "bodyText": "Identifiers use double quotes\nFROM \"foo$snapshots\"", "author": "electrum", "createdAt": "2020-09-04T00:35:26Z", "path": "presto-docs/src/main/sphinx/connector/iceberg.rst", "diffHunk": "@@ -0,0 +1,197 @@\n+=================\n+Iceberg Connector\n+=================\n+\n+Overview\n+--------\n+\n+Apache Iceberg is an open table format for huge analytic datasets.\n+The Iceberg connector allows querying data stored in\n+files written in Iceberg format, as defined in the\n+`Iceberg Table Spec <https://iceberg.apache.org/spec/>`_.\n+\n+The Iceberg connector supports:\n+\n+* All Presto types, including TIME, TIMESTAMP, DECIMAL\n+* CREATE TABLE and CREATE TABLE AS\n+* Partitioning tables by any Presto type\n+* Dropping tables\n+* Renaming tables\n+* Deletion by partition\n+* Table and column statistics\n+* Table and column comments\n+* Rolling back a table to a previous state\n+* Schema evolution\n+\n+The Iceberg table state is maintained in metadata files. All changes to table state\n+create a new metadata file and replace the old metadata with an atomic swap.\n+The table metadata file tracks the table schema, partitioning config,\n+custom properties, and snapshots of the table contents.\n+\n+Iceberg data files can be stored in either Parquet or ORC format, as\n+determined by the ``format`` property in the table definition.  The\n+table ``format`` defaults to ``ORC``.\n+\n+Iceberg is designed to improve on the known scalabilty limitations of Hive.  Hive\n+stores table metadata in an object store backed by a database like MySQL.  It tracks\n+partition locations in the metastore, but not individual data files.  Presto queries\n+using the Hive connector must first call the metastore to get partition locations,\n+then call the underlying filesystem to list all data files inside each partition,\n+and then read metadata from each data file.\n+\n+Since Iceberg stores the paths to data files in the metadata files, it\n+only consults the underlying file system for files that must be read.\n+\n+Status\n+------\n+\n+The Iceberg connector is not yet supported for production use.\n+\n+Compatibility With Spark Iceberg\n+--------------------------------\n+\n+Tests have been written to demonstrate that data written by Presto can be read\n+using Spark SQL with the Iceberg format, and vice versa.  See\n+`TestSparkCompatibility <https://github.com/prestosql/presto/blob/master/presto-product-tests/src/main/java/io/prestosql/tests/iceberg/TestSparkCompatibility.java>`_.\n+\n+Configuration\n+-------------\n+\n+Iceberg supports the same metastore configuration properties as the Hive connector.\n+At a minimum, ``hive.metastore.uri`` must be configured:\n+\n+.. code-block:: none\n+\n+    connector.name=iceberg\n+    hive.metastore.uri=thrift://localhost:9083\n+\n+Partitioned Tables\n+------------------\n+\n+Iceberg supports partitioning by specifying transforms over the table columns.\n+A partition is created for each unique tuple value produced by the transforms.\n+Identity transforms are simply the column name. Other transforms are:\n+\n+===================================== ================================================================================================\n+Transform                             Description\n+===================================== ================================================================================================\n+``year(ts)``                          The partition value is the integer difference in years between ``ts`` and January 1st. 1970.\n+\n+``month(ts)``                         The partition value is the integer difference in months between ``ts`` and January 1st. 1970.\n+\n+``day(ts)``                           The partition value is the integer difference in days between ``ts`` and January 1st. 1970.\n+\n+``hour(ts)``                          The partition value is a TIMESTAMP rounded down to the nearest hour.\n+\n+``bucket(x, nbuckets)``               The partition value is an integer hash of ``x``, with a value between 0 and ``nbuckets - 1`` inclusive.\n+\n+``truncate(s, nchars)``               The partition value is the first ``nchars`` characters of VARCHAR ``s``.\n+===================================== ================================================================================================\n+\n+In this example, the table is partitioned by month and by a hash of the account number::\n+\n+    CREATE TABLE iceberg.testdb.sample_partitioned (\n+        order_date DATE,\n+        account_number BIGINT,\n+        customer VARCHAR)\n+    WITH (partitioning = ARRAY['month(order_date)', 'bucket(account_number, 10)'])\n+\n+Deletion by Partition\n+---------------------\n+\n+For partitioned tables, the Iceberg connector supports the deletion of entire\n+partitions if the WHERE clause specifies an identity transform of a partition\n+column.  Given this table definition::\n+\n+    CREATE TABLE test_partition_deletion (\n+        c integer,\n+        d double)\n+        WITH (partitioning = ARRAY['c'])\n+\n+This SQL will delete all partitions for which c is 1::\n+\n+    DELETE FROM test_partition_deletion\n+    WHERE c = 1\n+\n+The current Iceberg connector is based on Iceberg v1.  Iceberg v2 is not yet\n+released.  When v2 is released, it will support row-level deletion and the\n+Iceberg connector will be updated to provide row-level deletion.\n+\n+The Iceberg connector currently supports only deletion by partition.\n+This SQL below will fail because the doesn't span entire partitions::\n+\n+    DELETE FROM test_partition_deletion\n+    WHERE c = 1 AND d > 10\n+\n+Rolling Back to a Previous Snapshot\n+-----------------------------------\n+\n+Iceberg supports a \"snapshot\" model of data, where table snapshots are\n+identified by an ``long`` snapshot_ids.\n+\n+The connector provides a system snapshots table for each Iceberg table.  Snapshots are\n+identified by BIGINT snapshot ids.  You can find the latest snapshot id for table\n+foo by running the following command::\n+\n+    SELECT snapshot_id FROM 'foo$snapshots' ORDER BY committed_at DESC LIMIT 1", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzY3NjIxNQ==", "url": "https://github.com/trinodb/trino/pull/4537#discussion_r483676215", "bodyText": "Changed.", "author": "djsstarburst", "createdAt": "2020-09-04T15:04:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMyMzA3NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMyNDI3MQ==", "url": "https://github.com/trinodb/trino/pull/4537#discussion_r483324271", "bodyText": "It seems strange to mention Hive syntax here for the Iceberg connector. Instead, we should simply describe this feature on its own terms.", "author": "electrum", "createdAt": "2020-09-04T00:40:12Z", "path": "presto-docs/src/main/sphinx/connector/iceberg.rst", "diffHunk": "@@ -0,0 +1,197 @@\n+=================\n+Iceberg Connector\n+=================\n+\n+Overview\n+--------\n+\n+Apache Iceberg is an open table format for huge analytic datasets.\n+The Iceberg connector allows querying data stored in\n+files written in Iceberg format, as defined in the\n+`Iceberg Table Spec <https://iceberg.apache.org/spec/>`_.\n+\n+The Iceberg connector supports:\n+\n+* All Presto types, including TIME, TIMESTAMP, DECIMAL\n+* CREATE TABLE and CREATE TABLE AS\n+* Partitioning tables by any Presto type\n+* Dropping tables\n+* Renaming tables\n+* Deletion by partition\n+* Table and column statistics\n+* Table and column comments\n+* Rolling back a table to a previous state\n+* Schema evolution\n+\n+The Iceberg table state is maintained in metadata files. All changes to table state\n+create a new metadata file and replace the old metadata with an atomic swap.\n+The table metadata file tracks the table schema, partitioning config,\n+custom properties, and snapshots of the table contents.\n+\n+Iceberg data files can be stored in either Parquet or ORC format, as\n+determined by the ``format`` property in the table definition.  The\n+table ``format`` defaults to ``ORC``.\n+\n+Iceberg is designed to improve on the known scalabilty limitations of Hive.  Hive\n+stores table metadata in an object store backed by a database like MySQL.  It tracks\n+partition locations in the metastore, but not individual data files.  Presto queries\n+using the Hive connector must first call the metastore to get partition locations,\n+then call the underlying filesystem to list all data files inside each partition,\n+and then read metadata from each data file.\n+\n+Since Iceberg stores the paths to data files in the metadata files, it\n+only consults the underlying file system for files that must be read.\n+\n+Status\n+------\n+\n+The Iceberg connector is not yet supported for production use.\n+\n+Compatibility With Spark Iceberg\n+--------------------------------\n+\n+Tests have been written to demonstrate that data written by Presto can be read\n+using Spark SQL with the Iceberg format, and vice versa.  See\n+`TestSparkCompatibility <https://github.com/prestosql/presto/blob/master/presto-product-tests/src/main/java/io/prestosql/tests/iceberg/TestSparkCompatibility.java>`_.\n+\n+Configuration\n+-------------\n+\n+Iceberg supports the same metastore configuration properties as the Hive connector.\n+At a minimum, ``hive.metastore.uri`` must be configured:\n+\n+.. code-block:: none\n+\n+    connector.name=iceberg\n+    hive.metastore.uri=thrift://localhost:9083\n+\n+Partitioned Tables\n+------------------\n+\n+Iceberg supports partitioning by specifying transforms over the table columns.\n+A partition is created for each unique tuple value produced by the transforms.\n+Identity transforms are simply the column name. Other transforms are:\n+\n+===================================== ================================================================================================\n+Transform                             Description\n+===================================== ================================================================================================\n+``year(ts)``                          The partition value is the integer difference in years between ``ts`` and January 1st. 1970.\n+\n+``month(ts)``                         The partition value is the integer difference in months between ``ts`` and January 1st. 1970.\n+\n+``day(ts)``                           The partition value is the integer difference in days between ``ts`` and January 1st. 1970.\n+\n+``hour(ts)``                          The partition value is a TIMESTAMP rounded down to the nearest hour.\n+\n+``bucket(x, nbuckets)``               The partition value is an integer hash of ``x``, with a value between 0 and ``nbuckets - 1`` inclusive.\n+\n+``truncate(s, nchars)``               The partition value is the first ``nchars`` characters of VARCHAR ``s``.\n+===================================== ================================================================================================\n+\n+In this example, the table is partitioned by month and by a hash of the account number::\n+\n+    CREATE TABLE iceberg.testdb.sample_partitioned (\n+        order_date DATE,\n+        account_number BIGINT,\n+        customer VARCHAR)\n+    WITH (partitioning = ARRAY['month(order_date)', 'bucket(account_number, 10)'])\n+\n+Deletion by Partition\n+---------------------\n+\n+For partitioned tables, the Iceberg connector supports the deletion of entire\n+partitions if the WHERE clause specifies an identity transform of a partition\n+column.  Given this table definition::\n+\n+    CREATE TABLE test_partition_deletion (\n+        c integer,\n+        d double)\n+        WITH (partitioning = ARRAY['c'])\n+\n+This SQL will delete all partitions for which c is 1::\n+\n+    DELETE FROM test_partition_deletion\n+    WHERE c = 1\n+\n+The current Iceberg connector is based on Iceberg v1.  Iceberg v2 is not yet\n+released.  When v2 is released, it will support row-level deletion and the\n+Iceberg connector will be updated to provide row-level deletion.\n+\n+The Iceberg connector currently supports only deletion by partition.\n+This SQL below will fail because the doesn't span entire partitions::\n+\n+    DELETE FROM test_partition_deletion\n+    WHERE c = 1 AND d > 10\n+\n+Rolling Back to a Previous Snapshot\n+-----------------------------------\n+\n+Iceberg supports a \"snapshot\" model of data, where table snapshots are\n+identified by an ``long`` snapshot_ids.\n+\n+The connector provides a system snapshots table for each Iceberg table.  Snapshots are\n+identified by BIGINT snapshot ids.  You can find the latest snapshot id for table\n+foo by running the following command::\n+\n+    SELECT snapshot_id FROM 'foo$snapshots' ORDER BY committed_at DESC LIMIT 1\n+\n+A SQL procedure ``system.rollback_to_snapshot`` allows the caller to roll back\n+the state of the table to a previous snapshot id::\n+\n+    CALL system.rollback_to_snapshot(schema_name, table_name, snapshot_id)\n+\n+Schema Evolution\n+----------------\n+\n+Iceberg and the Iceberg connector support schema evolution, with safe\n+column add, drop, reorder and rename operations, including in nested structures.\n+Table partitioning can also be changed and the connector can still\n+query data created before the partitioning change.\n+\n+Migrating Existing Tables\n+-------------------------\n+\n+The connector can read from or write to Hive tables that have been migrated to Iceberg.\n+Currently, there is no Presto support to migrate Hive tables to Presto, so you will\n+need to use either the Iceberg API or Spark.\n+\n+System Tables and Columns\n+-------------------------\n+\n+The connector supports ``table$partitions`` as a substitute for Hive's ``SHOW PARTITIONS``.", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzY3NjMyNA==", "url": "https://github.com/trinodb/trino/pull/4537#discussion_r483676324", "bodyText": "Changed.", "author": "djsstarburst", "createdAt": "2020-09-04T15:04:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMyNDI3MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMyNDMxNA==", "url": "https://github.com/trinodb/trino/pull/4537#discussion_r483324314", "bodyText": "Does this work? We don't have any code or tests for this.", "author": "electrum", "createdAt": "2020-09-04T00:40:21Z", "path": "presto-docs/src/main/sphinx/connector/iceberg.rst", "diffHunk": "@@ -0,0 +1,197 @@\n+=================\n+Iceberg Connector\n+=================\n+\n+Overview\n+--------\n+\n+Apache Iceberg is an open table format for huge analytic datasets.\n+The Iceberg connector allows querying data stored in\n+files written in Iceberg format, as defined in the\n+`Iceberg Table Spec <https://iceberg.apache.org/spec/>`_.\n+\n+The Iceberg connector supports:\n+\n+* All Presto types, including TIME, TIMESTAMP, DECIMAL\n+* CREATE TABLE and CREATE TABLE AS\n+* Partitioning tables by any Presto type\n+* Dropping tables\n+* Renaming tables\n+* Deletion by partition\n+* Table and column statistics\n+* Table and column comments\n+* Rolling back a table to a previous state\n+* Schema evolution\n+\n+The Iceberg table state is maintained in metadata files. All changes to table state\n+create a new metadata file and replace the old metadata with an atomic swap.\n+The table metadata file tracks the table schema, partitioning config,\n+custom properties, and snapshots of the table contents.\n+\n+Iceberg data files can be stored in either Parquet or ORC format, as\n+determined by the ``format`` property in the table definition.  The\n+table ``format`` defaults to ``ORC``.\n+\n+Iceberg is designed to improve on the known scalabilty limitations of Hive.  Hive\n+stores table metadata in an object store backed by a database like MySQL.  It tracks\n+partition locations in the metastore, but not individual data files.  Presto queries\n+using the Hive connector must first call the metastore to get partition locations,\n+then call the underlying filesystem to list all data files inside each partition,\n+and then read metadata from each data file.\n+\n+Since Iceberg stores the paths to data files in the metadata files, it\n+only consults the underlying file system for files that must be read.\n+\n+Status\n+------\n+\n+The Iceberg connector is not yet supported for production use.\n+\n+Compatibility With Spark Iceberg\n+--------------------------------\n+\n+Tests have been written to demonstrate that data written by Presto can be read\n+using Spark SQL with the Iceberg format, and vice versa.  See\n+`TestSparkCompatibility <https://github.com/prestosql/presto/blob/master/presto-product-tests/src/main/java/io/prestosql/tests/iceberg/TestSparkCompatibility.java>`_.\n+\n+Configuration\n+-------------\n+\n+Iceberg supports the same metastore configuration properties as the Hive connector.\n+At a minimum, ``hive.metastore.uri`` must be configured:\n+\n+.. code-block:: none\n+\n+    connector.name=iceberg\n+    hive.metastore.uri=thrift://localhost:9083\n+\n+Partitioned Tables\n+------------------\n+\n+Iceberg supports partitioning by specifying transforms over the table columns.\n+A partition is created for each unique tuple value produced by the transforms.\n+Identity transforms are simply the column name. Other transforms are:\n+\n+===================================== ================================================================================================\n+Transform                             Description\n+===================================== ================================================================================================\n+``year(ts)``                          The partition value is the integer difference in years between ``ts`` and January 1st. 1970.\n+\n+``month(ts)``                         The partition value is the integer difference in months between ``ts`` and January 1st. 1970.\n+\n+``day(ts)``                           The partition value is the integer difference in days between ``ts`` and January 1st. 1970.\n+\n+``hour(ts)``                          The partition value is a TIMESTAMP rounded down to the nearest hour.\n+\n+``bucket(x, nbuckets)``               The partition value is an integer hash of ``x``, with a value between 0 and ``nbuckets - 1`` inclusive.\n+\n+``truncate(s, nchars)``               The partition value is the first ``nchars`` characters of VARCHAR ``s``.\n+===================================== ================================================================================================\n+\n+In this example, the table is partitioned by month and by a hash of the account number::\n+\n+    CREATE TABLE iceberg.testdb.sample_partitioned (\n+        order_date DATE,\n+        account_number BIGINT,\n+        customer VARCHAR)\n+    WITH (partitioning = ARRAY['month(order_date)', 'bucket(account_number, 10)'])\n+\n+Deletion by Partition\n+---------------------\n+\n+For partitioned tables, the Iceberg connector supports the deletion of entire\n+partitions if the WHERE clause specifies an identity transform of a partition\n+column.  Given this table definition::\n+\n+    CREATE TABLE test_partition_deletion (\n+        c integer,\n+        d double)\n+        WITH (partitioning = ARRAY['c'])\n+\n+This SQL will delete all partitions for which c is 1::\n+\n+    DELETE FROM test_partition_deletion\n+    WHERE c = 1\n+\n+The current Iceberg connector is based on Iceberg v1.  Iceberg v2 is not yet\n+released.  When v2 is released, it will support row-level deletion and the\n+Iceberg connector will be updated to provide row-level deletion.\n+\n+The Iceberg connector currently supports only deletion by partition.\n+This SQL below will fail because the doesn't span entire partitions::\n+\n+    DELETE FROM test_partition_deletion\n+    WHERE c = 1 AND d > 10\n+\n+Rolling Back to a Previous Snapshot\n+-----------------------------------\n+\n+Iceberg supports a \"snapshot\" model of data, where table snapshots are\n+identified by an ``long`` snapshot_ids.\n+\n+The connector provides a system snapshots table for each Iceberg table.  Snapshots are\n+identified by BIGINT snapshot ids.  You can find the latest snapshot id for table\n+foo by running the following command::\n+\n+    SELECT snapshot_id FROM 'foo$snapshots' ORDER BY committed_at DESC LIMIT 1\n+\n+A SQL procedure ``system.rollback_to_snapshot`` allows the caller to roll back\n+the state of the table to a previous snapshot id::\n+\n+    CALL system.rollback_to_snapshot(schema_name, table_name, snapshot_id)\n+\n+Schema Evolution\n+----------------\n+\n+Iceberg and the Iceberg connector support schema evolution, with safe\n+column add, drop, reorder and rename operations, including in nested structures.\n+Table partitioning can also be changed and the connector can still\n+query data created before the partitioning change.\n+\n+Migrating Existing Tables\n+-------------------------\n+\n+The connector can read from or write to Hive tables that have been migrated to Iceberg.\n+Currently, there is no Presto support to migrate Hive tables to Presto, so you will\n+need to use either the Iceberg API or Spark.\n+\n+System Tables and Columns\n+-------------------------\n+\n+The connector supports ``table$partitions`` as a substitute for Hive's ``SHOW PARTITIONS``.\n+The differences are that it returns some partition metrics for each partition value\n+and you can also use it on unpartitioned tables.\n+\n+Iceberg supports ``$snapshot_id`` and ``$snapshot_timestamp_ms`` as hidden columns.", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMyNDgwMQ==", "url": "https://github.com/trinodb/trino/pull/4537#discussion_r483324801", "bodyText": "The connector should support table names like abc@123 or abc$partitions@456 but I can't find any tests for this. It might just work -- we should add tests.", "author": "electrum", "createdAt": "2020-09-04T00:42:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMyNDMxNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzY3NzA0Mw==", "url": "https://github.com/trinodb/trino/pull/4537#discussion_r483677043", "bodyText": "I made a note to add the tests.", "author": "djsstarburst", "createdAt": "2020-09-04T15:05:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMyNDMxNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzY4MDY0NQ==", "url": "https://github.com/trinodb/trino/pull/4537#discussion_r483680645", "bodyText": "Does this work? We don't have any code or tests for this.\n\nI added a test for this in AbstractTestIcebergSmoke, now disabled, because AFAICT these columns do not exist.  We should decide if they should exist, and if so add them and add more tests for them.", "author": "djsstarburst", "createdAt": "2020-09-04T15:12:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMyNDMxNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMyNDg1MA==", "url": "https://github.com/trinodb/trino/pull/4537#discussion_r483324850", "bodyText": "Add code quotes around the format names.", "author": "electrum", "createdAt": "2020-09-04T00:42:36Z", "path": "presto-docs/src/main/sphinx/connector/iceberg.rst", "diffHunk": "@@ -0,0 +1,197 @@\n+=================\n+Iceberg Connector\n+=================\n+\n+Overview\n+--------\n+\n+Apache Iceberg is an open table format for huge analytic datasets.\n+The Iceberg connector allows querying data stored in\n+files written in Iceberg format, as defined in the\n+`Iceberg Table Spec <https://iceberg.apache.org/spec/>`_.\n+\n+The Iceberg connector supports:\n+\n+* All Presto types, including TIME, TIMESTAMP, DECIMAL\n+* CREATE TABLE and CREATE TABLE AS\n+* Partitioning tables by any Presto type\n+* Dropping tables\n+* Renaming tables\n+* Deletion by partition\n+* Table and column statistics\n+* Table and column comments\n+* Rolling back a table to a previous state\n+* Schema evolution\n+\n+The Iceberg table state is maintained in metadata files. All changes to table state\n+create a new metadata file and replace the old metadata with an atomic swap.\n+The table metadata file tracks the table schema, partitioning config,\n+custom properties, and snapshots of the table contents.\n+\n+Iceberg data files can be stored in either Parquet or ORC format, as\n+determined by the ``format`` property in the table definition.  The\n+table ``format`` defaults to ``ORC``.\n+\n+Iceberg is designed to improve on the known scalabilty limitations of Hive.  Hive\n+stores table metadata in an object store backed by a database like MySQL.  It tracks\n+partition locations in the metastore, but not individual data files.  Presto queries\n+using the Hive connector must first call the metastore to get partition locations,\n+then call the underlying filesystem to list all data files inside each partition,\n+and then read metadata from each data file.\n+\n+Since Iceberg stores the paths to data files in the metadata files, it\n+only consults the underlying file system for files that must be read.\n+\n+Status\n+------\n+\n+The Iceberg connector is not yet supported for production use.\n+\n+Compatibility With Spark Iceberg\n+--------------------------------\n+\n+Tests have been written to demonstrate that data written by Presto can be read\n+using Spark SQL with the Iceberg format, and vice versa.  See\n+`TestSparkCompatibility <https://github.com/prestosql/presto/blob/master/presto-product-tests/src/main/java/io/prestosql/tests/iceberg/TestSparkCompatibility.java>`_.\n+\n+Configuration\n+-------------\n+\n+Iceberg supports the same metastore configuration properties as the Hive connector.\n+At a minimum, ``hive.metastore.uri`` must be configured:\n+\n+.. code-block:: none\n+\n+    connector.name=iceberg\n+    hive.metastore.uri=thrift://localhost:9083\n+\n+Partitioned Tables\n+------------------\n+\n+Iceberg supports partitioning by specifying transforms over the table columns.\n+A partition is created for each unique tuple value produced by the transforms.\n+Identity transforms are simply the column name. Other transforms are:\n+\n+===================================== ================================================================================================\n+Transform                             Description\n+===================================== ================================================================================================\n+``year(ts)``                          The partition value is the integer difference in years between ``ts`` and January 1st. 1970.\n+\n+``month(ts)``                         The partition value is the integer difference in months between ``ts`` and January 1st. 1970.\n+\n+``day(ts)``                           The partition value is the integer difference in days between ``ts`` and January 1st. 1970.\n+\n+``hour(ts)``                          The partition value is a TIMESTAMP rounded down to the nearest hour.\n+\n+``bucket(x, nbuckets)``               The partition value is an integer hash of ``x``, with a value between 0 and ``nbuckets - 1`` inclusive.\n+\n+``truncate(s, nchars)``               The partition value is the first ``nchars`` characters of VARCHAR ``s``.\n+===================================== ================================================================================================\n+\n+In this example, the table is partitioned by month and by a hash of the account number::\n+\n+    CREATE TABLE iceberg.testdb.sample_partitioned (\n+        order_date DATE,\n+        account_number BIGINT,\n+        customer VARCHAR)\n+    WITH (partitioning = ARRAY['month(order_date)', 'bucket(account_number, 10)'])\n+\n+Deletion by Partition\n+---------------------\n+\n+For partitioned tables, the Iceberg connector supports the deletion of entire\n+partitions if the WHERE clause specifies an identity transform of a partition\n+column.  Given this table definition::\n+\n+    CREATE TABLE test_partition_deletion (\n+        c integer,\n+        d double)\n+        WITH (partitioning = ARRAY['c'])\n+\n+This SQL will delete all partitions for which c is 1::\n+\n+    DELETE FROM test_partition_deletion\n+    WHERE c = 1\n+\n+The current Iceberg connector is based on Iceberg v1.  Iceberg v2 is not yet\n+released.  When v2 is released, it will support row-level deletion and the\n+Iceberg connector will be updated to provide row-level deletion.\n+\n+The Iceberg connector currently supports only deletion by partition.\n+This SQL below will fail because the doesn't span entire partitions::\n+\n+    DELETE FROM test_partition_deletion\n+    WHERE c = 1 AND d > 10\n+\n+Rolling Back to a Previous Snapshot\n+-----------------------------------\n+\n+Iceberg supports a \"snapshot\" model of data, where table snapshots are\n+identified by an ``long`` snapshot_ids.\n+\n+The connector provides a system snapshots table for each Iceberg table.  Snapshots are\n+identified by BIGINT snapshot ids.  You can find the latest snapshot id for table\n+foo by running the following command::\n+\n+    SELECT snapshot_id FROM 'foo$snapshots' ORDER BY committed_at DESC LIMIT 1\n+\n+A SQL procedure ``system.rollback_to_snapshot`` allows the caller to roll back\n+the state of the table to a previous snapshot id::\n+\n+    CALL system.rollback_to_snapshot(schema_name, table_name, snapshot_id)\n+\n+Schema Evolution\n+----------------\n+\n+Iceberg and the Iceberg connector support schema evolution, with safe\n+column add, drop, reorder and rename operations, including in nested structures.\n+Table partitioning can also be changed and the connector can still\n+query data created before the partitioning change.\n+\n+Migrating Existing Tables\n+-------------------------\n+\n+The connector can read from or write to Hive tables that have been migrated to Iceberg.\n+Currently, there is no Presto support to migrate Hive tables to Presto, so you will\n+need to use either the Iceberg API or Spark.\n+\n+System Tables and Columns\n+-------------------------\n+\n+The connector supports ``table$partitions`` as a substitute for Hive's ``SHOW PARTITIONS``.\n+The differences are that it returns some partition metrics for each partition value\n+and you can also use it on unpartitioned tables.\n+\n+Iceberg supports ``$snapshot_id`` and ``$snapshot_timestamp_ms`` as hidden columns.\n+These columns allow users to query an old version of the table. Think of this\n+as a time-travel feature which lets you query your table's snapshot at a given time.\n+\n+Iceberg Table Properties\n+------------------------\n+\n+================================================== ============================================================ ============\n+Property Name                                      Description                                                  Default\n+================================================== ============================================================ ============\n+``format``                                         Optionally specifies the format of table data files;         ORC\n+                                                   either PARQUET or ORC.", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzY2NDA4Mg==", "url": "https://github.com/trinodb/trino/pull/4537#discussion_r483664082", "bodyText": "Done.", "author": "djsstarburst", "createdAt": "2020-09-04T14:49:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMyNDg1MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMyNTAzOA==", "url": "https://github.com/trinodb/trino/pull/4537#discussion_r483325038", "bodyText": "Let's get rid of the default column and make it part of the description as necessary\n\nOptionally specifies the format of table data files. Must be PARQUET or ORC. Defaults to ORC.", "author": "electrum", "createdAt": "2020-09-04T00:43:21Z", "path": "presto-docs/src/main/sphinx/connector/iceberg.rst", "diffHunk": "@@ -0,0 +1,197 @@\n+=================\n+Iceberg Connector\n+=================\n+\n+Overview\n+--------\n+\n+Apache Iceberg is an open table format for huge analytic datasets.\n+The Iceberg connector allows querying data stored in\n+files written in Iceberg format, as defined in the\n+`Iceberg Table Spec <https://iceberg.apache.org/spec/>`_.\n+\n+The Iceberg connector supports:\n+\n+* All Presto types, including TIME, TIMESTAMP, DECIMAL\n+* CREATE TABLE and CREATE TABLE AS\n+* Partitioning tables by any Presto type\n+* Dropping tables\n+* Renaming tables\n+* Deletion by partition\n+* Table and column statistics\n+* Table and column comments\n+* Rolling back a table to a previous state\n+* Schema evolution\n+\n+The Iceberg table state is maintained in metadata files. All changes to table state\n+create a new metadata file and replace the old metadata with an atomic swap.\n+The table metadata file tracks the table schema, partitioning config,\n+custom properties, and snapshots of the table contents.\n+\n+Iceberg data files can be stored in either Parquet or ORC format, as\n+determined by the ``format`` property in the table definition.  The\n+table ``format`` defaults to ``ORC``.\n+\n+Iceberg is designed to improve on the known scalabilty limitations of Hive.  Hive\n+stores table metadata in an object store backed by a database like MySQL.  It tracks\n+partition locations in the metastore, but not individual data files.  Presto queries\n+using the Hive connector must first call the metastore to get partition locations,\n+then call the underlying filesystem to list all data files inside each partition,\n+and then read metadata from each data file.\n+\n+Since Iceberg stores the paths to data files in the metadata files, it\n+only consults the underlying file system for files that must be read.\n+\n+Status\n+------\n+\n+The Iceberg connector is not yet supported for production use.\n+\n+Compatibility With Spark Iceberg\n+--------------------------------\n+\n+Tests have been written to demonstrate that data written by Presto can be read\n+using Spark SQL with the Iceberg format, and vice versa.  See\n+`TestSparkCompatibility <https://github.com/prestosql/presto/blob/master/presto-product-tests/src/main/java/io/prestosql/tests/iceberg/TestSparkCompatibility.java>`_.\n+\n+Configuration\n+-------------\n+\n+Iceberg supports the same metastore configuration properties as the Hive connector.\n+At a minimum, ``hive.metastore.uri`` must be configured:\n+\n+.. code-block:: none\n+\n+    connector.name=iceberg\n+    hive.metastore.uri=thrift://localhost:9083\n+\n+Partitioned Tables\n+------------------\n+\n+Iceberg supports partitioning by specifying transforms over the table columns.\n+A partition is created for each unique tuple value produced by the transforms.\n+Identity transforms are simply the column name. Other transforms are:\n+\n+===================================== ================================================================================================\n+Transform                             Description\n+===================================== ================================================================================================\n+``year(ts)``                          The partition value is the integer difference in years between ``ts`` and January 1st. 1970.\n+\n+``month(ts)``                         The partition value is the integer difference in months between ``ts`` and January 1st. 1970.\n+\n+``day(ts)``                           The partition value is the integer difference in days between ``ts`` and January 1st. 1970.\n+\n+``hour(ts)``                          The partition value is a TIMESTAMP rounded down to the nearest hour.\n+\n+``bucket(x, nbuckets)``               The partition value is an integer hash of ``x``, with a value between 0 and ``nbuckets - 1`` inclusive.\n+\n+``truncate(s, nchars)``               The partition value is the first ``nchars`` characters of VARCHAR ``s``.\n+===================================== ================================================================================================\n+\n+In this example, the table is partitioned by month and by a hash of the account number::\n+\n+    CREATE TABLE iceberg.testdb.sample_partitioned (\n+        order_date DATE,\n+        account_number BIGINT,\n+        customer VARCHAR)\n+    WITH (partitioning = ARRAY['month(order_date)', 'bucket(account_number, 10)'])\n+\n+Deletion by Partition\n+---------------------\n+\n+For partitioned tables, the Iceberg connector supports the deletion of entire\n+partitions if the WHERE clause specifies an identity transform of a partition\n+column.  Given this table definition::\n+\n+    CREATE TABLE test_partition_deletion (\n+        c integer,\n+        d double)\n+        WITH (partitioning = ARRAY['c'])\n+\n+This SQL will delete all partitions for which c is 1::\n+\n+    DELETE FROM test_partition_deletion\n+    WHERE c = 1\n+\n+The current Iceberg connector is based on Iceberg v1.  Iceberg v2 is not yet\n+released.  When v2 is released, it will support row-level deletion and the\n+Iceberg connector will be updated to provide row-level deletion.\n+\n+The Iceberg connector currently supports only deletion by partition.\n+This SQL below will fail because the doesn't span entire partitions::\n+\n+    DELETE FROM test_partition_deletion\n+    WHERE c = 1 AND d > 10\n+\n+Rolling Back to a Previous Snapshot\n+-----------------------------------\n+\n+Iceberg supports a \"snapshot\" model of data, where table snapshots are\n+identified by an ``long`` snapshot_ids.\n+\n+The connector provides a system snapshots table for each Iceberg table.  Snapshots are\n+identified by BIGINT snapshot ids.  You can find the latest snapshot id for table\n+foo by running the following command::\n+\n+    SELECT snapshot_id FROM 'foo$snapshots' ORDER BY committed_at DESC LIMIT 1\n+\n+A SQL procedure ``system.rollback_to_snapshot`` allows the caller to roll back\n+the state of the table to a previous snapshot id::\n+\n+    CALL system.rollback_to_snapshot(schema_name, table_name, snapshot_id)\n+\n+Schema Evolution\n+----------------\n+\n+Iceberg and the Iceberg connector support schema evolution, with safe\n+column add, drop, reorder and rename operations, including in nested structures.\n+Table partitioning can also be changed and the connector can still\n+query data created before the partitioning change.\n+\n+Migrating Existing Tables\n+-------------------------\n+\n+The connector can read from or write to Hive tables that have been migrated to Iceberg.\n+Currently, there is no Presto support to migrate Hive tables to Presto, so you will\n+need to use either the Iceberg API or Spark.\n+\n+System Tables and Columns\n+-------------------------\n+\n+The connector supports ``table$partitions`` as a substitute for Hive's ``SHOW PARTITIONS``.\n+The differences are that it returns some partition metrics for each partition value\n+and you can also use it on unpartitioned tables.\n+\n+Iceberg supports ``$snapshot_id`` and ``$snapshot_timestamp_ms`` as hidden columns.\n+These columns allow users to query an old version of the table. Think of this\n+as a time-travel feature which lets you query your table's snapshot at a given time.\n+\n+Iceberg Table Properties\n+------------------------\n+\n+================================================== ============================================================ ============\n+Property Name                                      Description                                                  Default\n+================================================== ============================================================ ============\n+``format``                                         Optionally specifies the format of table data files;         ORC", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzY2NDQ0NQ==", "url": "https://github.com/trinodb/trino/pull/4537#discussion_r483664445", "bodyText": "Changed.", "author": "djsstarburst", "createdAt": "2020-09-04T14:49:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMyNTAzOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMyNTExNg==", "url": "https://github.com/trinodb/trino/pull/4537#discussion_r483325116", "bodyText": "Code quotes on column names", "author": "electrum", "createdAt": "2020-09-04T00:43:39Z", "path": "presto-docs/src/main/sphinx/connector/iceberg.rst", "diffHunk": "@@ -0,0 +1,197 @@\n+=================\n+Iceberg Connector\n+=================\n+\n+Overview\n+--------\n+\n+Apache Iceberg is an open table format for huge analytic datasets.\n+The Iceberg connector allows querying data stored in\n+files written in Iceberg format, as defined in the\n+`Iceberg Table Spec <https://iceberg.apache.org/spec/>`_.\n+\n+The Iceberg connector supports:\n+\n+* All Presto types, including TIME, TIMESTAMP, DECIMAL\n+* CREATE TABLE and CREATE TABLE AS\n+* Partitioning tables by any Presto type\n+* Dropping tables\n+* Renaming tables\n+* Deletion by partition\n+* Table and column statistics\n+* Table and column comments\n+* Rolling back a table to a previous state\n+* Schema evolution\n+\n+The Iceberg table state is maintained in metadata files. All changes to table state\n+create a new metadata file and replace the old metadata with an atomic swap.\n+The table metadata file tracks the table schema, partitioning config,\n+custom properties, and snapshots of the table contents.\n+\n+Iceberg data files can be stored in either Parquet or ORC format, as\n+determined by the ``format`` property in the table definition.  The\n+table ``format`` defaults to ``ORC``.\n+\n+Iceberg is designed to improve on the known scalabilty limitations of Hive.  Hive\n+stores table metadata in an object store backed by a database like MySQL.  It tracks\n+partition locations in the metastore, but not individual data files.  Presto queries\n+using the Hive connector must first call the metastore to get partition locations,\n+then call the underlying filesystem to list all data files inside each partition,\n+and then read metadata from each data file.\n+\n+Since Iceberg stores the paths to data files in the metadata files, it\n+only consults the underlying file system for files that must be read.\n+\n+Status\n+------\n+\n+The Iceberg connector is not yet supported for production use.\n+\n+Compatibility With Spark Iceberg\n+--------------------------------\n+\n+Tests have been written to demonstrate that data written by Presto can be read\n+using Spark SQL with the Iceberg format, and vice versa.  See\n+`TestSparkCompatibility <https://github.com/prestosql/presto/blob/master/presto-product-tests/src/main/java/io/prestosql/tests/iceberg/TestSparkCompatibility.java>`_.\n+\n+Configuration\n+-------------\n+\n+Iceberg supports the same metastore configuration properties as the Hive connector.\n+At a minimum, ``hive.metastore.uri`` must be configured:\n+\n+.. code-block:: none\n+\n+    connector.name=iceberg\n+    hive.metastore.uri=thrift://localhost:9083\n+\n+Partitioned Tables\n+------------------\n+\n+Iceberg supports partitioning by specifying transforms over the table columns.\n+A partition is created for each unique tuple value produced by the transforms.\n+Identity transforms are simply the column name. Other transforms are:\n+\n+===================================== ================================================================================================\n+Transform                             Description\n+===================================== ================================================================================================\n+``year(ts)``                          The partition value is the integer difference in years between ``ts`` and January 1st. 1970.\n+\n+``month(ts)``                         The partition value is the integer difference in months between ``ts`` and January 1st. 1970.\n+\n+``day(ts)``                           The partition value is the integer difference in days between ``ts`` and January 1st. 1970.\n+\n+``hour(ts)``                          The partition value is a TIMESTAMP rounded down to the nearest hour.\n+\n+``bucket(x, nbuckets)``               The partition value is an integer hash of ``x``, with a value between 0 and ``nbuckets - 1`` inclusive.\n+\n+``truncate(s, nchars)``               The partition value is the first ``nchars`` characters of VARCHAR ``s``.\n+===================================== ================================================================================================\n+\n+In this example, the table is partitioned by month and by a hash of the account number::\n+\n+    CREATE TABLE iceberg.testdb.sample_partitioned (\n+        order_date DATE,\n+        account_number BIGINT,\n+        customer VARCHAR)\n+    WITH (partitioning = ARRAY['month(order_date)', 'bucket(account_number, 10)'])\n+\n+Deletion by Partition\n+---------------------\n+\n+For partitioned tables, the Iceberg connector supports the deletion of entire\n+partitions if the WHERE clause specifies an identity transform of a partition\n+column.  Given this table definition::\n+\n+    CREATE TABLE test_partition_deletion (\n+        c integer,\n+        d double)\n+        WITH (partitioning = ARRAY['c'])\n+\n+This SQL will delete all partitions for which c is 1::\n+\n+    DELETE FROM test_partition_deletion\n+    WHERE c = 1\n+\n+The current Iceberg connector is based on Iceberg v1.  Iceberg v2 is not yet\n+released.  When v2 is released, it will support row-level deletion and the\n+Iceberg connector will be updated to provide row-level deletion.\n+\n+The Iceberg connector currently supports only deletion by partition.\n+This SQL below will fail because the doesn't span entire partitions::\n+\n+    DELETE FROM test_partition_deletion\n+    WHERE c = 1 AND d > 10\n+\n+Rolling Back to a Previous Snapshot\n+-----------------------------------\n+\n+Iceberg supports a \"snapshot\" model of data, where table snapshots are\n+identified by an ``long`` snapshot_ids.\n+\n+The connector provides a system snapshots table for each Iceberg table.  Snapshots are\n+identified by BIGINT snapshot ids.  You can find the latest snapshot id for table\n+foo by running the following command::\n+\n+    SELECT snapshot_id FROM 'foo$snapshots' ORDER BY committed_at DESC LIMIT 1\n+\n+A SQL procedure ``system.rollback_to_snapshot`` allows the caller to roll back\n+the state of the table to a previous snapshot id::\n+\n+    CALL system.rollback_to_snapshot(schema_name, table_name, snapshot_id)\n+\n+Schema Evolution\n+----------------\n+\n+Iceberg and the Iceberg connector support schema evolution, with safe\n+column add, drop, reorder and rename operations, including in nested structures.\n+Table partitioning can also be changed and the connector can still\n+query data created before the partitioning change.\n+\n+Migrating Existing Tables\n+-------------------------\n+\n+The connector can read from or write to Hive tables that have been migrated to Iceberg.\n+Currently, there is no Presto support to migrate Hive tables to Presto, so you will\n+need to use either the Iceberg API or Spark.\n+\n+System Tables and Columns\n+-------------------------\n+\n+The connector supports ``table$partitions`` as a substitute for Hive's ``SHOW PARTITIONS``.\n+The differences are that it returns some partition metrics for each partition value\n+and you can also use it on unpartitioned tables.\n+\n+Iceberg supports ``$snapshot_id`` and ``$snapshot_timestamp_ms`` as hidden columns.\n+These columns allow users to query an old version of the table. Think of this\n+as a time-travel feature which lets you query your table's snapshot at a given time.\n+\n+Iceberg Table Properties\n+------------------------\n+\n+================================================== ============================================================ ============\n+Property Name                                      Description                                                  Default\n+================================================== ============================================================ ============\n+``format``                                         Optionally specifies the format of table data files;         ORC\n+                                                   either PARQUET or ORC.\n+\n+``partitioning``                                   Optionally specifies table partitioning.\n+                                                   If a table is partitioned by columns c1 and c2, the", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzY2NDY0Ng==", "url": "https://github.com/trinodb/trino/pull/4537#discussion_r483664646", "bodyText": "Changed.", "author": "djsstarburst", "createdAt": "2020-09-04T14:50:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMyNTExNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMyNTE1Ng==", "url": "https://github.com/trinodb/trino/pull/4537#discussion_r483325156", "bodyText": "End in period", "author": "electrum", "createdAt": "2020-09-04T00:43:52Z", "path": "presto-docs/src/main/sphinx/connector/iceberg.rst", "diffHunk": "@@ -0,0 +1,197 @@\n+=================\n+Iceberg Connector\n+=================\n+\n+Overview\n+--------\n+\n+Apache Iceberg is an open table format for huge analytic datasets.\n+The Iceberg connector allows querying data stored in\n+files written in Iceberg format, as defined in the\n+`Iceberg Table Spec <https://iceberg.apache.org/spec/>`_.\n+\n+The Iceberg connector supports:\n+\n+* All Presto types, including TIME, TIMESTAMP, DECIMAL\n+* CREATE TABLE and CREATE TABLE AS\n+* Partitioning tables by any Presto type\n+* Dropping tables\n+* Renaming tables\n+* Deletion by partition\n+* Table and column statistics\n+* Table and column comments\n+* Rolling back a table to a previous state\n+* Schema evolution\n+\n+The Iceberg table state is maintained in metadata files. All changes to table state\n+create a new metadata file and replace the old metadata with an atomic swap.\n+The table metadata file tracks the table schema, partitioning config,\n+custom properties, and snapshots of the table contents.\n+\n+Iceberg data files can be stored in either Parquet or ORC format, as\n+determined by the ``format`` property in the table definition.  The\n+table ``format`` defaults to ``ORC``.\n+\n+Iceberg is designed to improve on the known scalabilty limitations of Hive.  Hive\n+stores table metadata in an object store backed by a database like MySQL.  It tracks\n+partition locations in the metastore, but not individual data files.  Presto queries\n+using the Hive connector must first call the metastore to get partition locations,\n+then call the underlying filesystem to list all data files inside each partition,\n+and then read metadata from each data file.\n+\n+Since Iceberg stores the paths to data files in the metadata files, it\n+only consults the underlying file system for files that must be read.\n+\n+Status\n+------\n+\n+The Iceberg connector is not yet supported for production use.\n+\n+Compatibility With Spark Iceberg\n+--------------------------------\n+\n+Tests have been written to demonstrate that data written by Presto can be read\n+using Spark SQL with the Iceberg format, and vice versa.  See\n+`TestSparkCompatibility <https://github.com/prestosql/presto/blob/master/presto-product-tests/src/main/java/io/prestosql/tests/iceberg/TestSparkCompatibility.java>`_.\n+\n+Configuration\n+-------------\n+\n+Iceberg supports the same metastore configuration properties as the Hive connector.\n+At a minimum, ``hive.metastore.uri`` must be configured:\n+\n+.. code-block:: none\n+\n+    connector.name=iceberg\n+    hive.metastore.uri=thrift://localhost:9083\n+\n+Partitioned Tables\n+------------------\n+\n+Iceberg supports partitioning by specifying transforms over the table columns.\n+A partition is created for each unique tuple value produced by the transforms.\n+Identity transforms are simply the column name. Other transforms are:\n+\n+===================================== ================================================================================================\n+Transform                             Description\n+===================================== ================================================================================================\n+``year(ts)``                          The partition value is the integer difference in years between ``ts`` and January 1st. 1970.\n+\n+``month(ts)``                         The partition value is the integer difference in months between ``ts`` and January 1st. 1970.\n+\n+``day(ts)``                           The partition value is the integer difference in days between ``ts`` and January 1st. 1970.\n+\n+``hour(ts)``                          The partition value is a TIMESTAMP rounded down to the nearest hour.\n+\n+``bucket(x, nbuckets)``               The partition value is an integer hash of ``x``, with a value between 0 and ``nbuckets - 1`` inclusive.\n+\n+``truncate(s, nchars)``               The partition value is the first ``nchars`` characters of VARCHAR ``s``.\n+===================================== ================================================================================================\n+\n+In this example, the table is partitioned by month and by a hash of the account number::\n+\n+    CREATE TABLE iceberg.testdb.sample_partitioned (\n+        order_date DATE,\n+        account_number BIGINT,\n+        customer VARCHAR)\n+    WITH (partitioning = ARRAY['month(order_date)', 'bucket(account_number, 10)'])\n+\n+Deletion by Partition\n+---------------------\n+\n+For partitioned tables, the Iceberg connector supports the deletion of entire\n+partitions if the WHERE clause specifies an identity transform of a partition\n+column.  Given this table definition::\n+\n+    CREATE TABLE test_partition_deletion (\n+        c integer,\n+        d double)\n+        WITH (partitioning = ARRAY['c'])\n+\n+This SQL will delete all partitions for which c is 1::\n+\n+    DELETE FROM test_partition_deletion\n+    WHERE c = 1\n+\n+The current Iceberg connector is based on Iceberg v1.  Iceberg v2 is not yet\n+released.  When v2 is released, it will support row-level deletion and the\n+Iceberg connector will be updated to provide row-level deletion.\n+\n+The Iceberg connector currently supports only deletion by partition.\n+This SQL below will fail because the doesn't span entire partitions::\n+\n+    DELETE FROM test_partition_deletion\n+    WHERE c = 1 AND d > 10\n+\n+Rolling Back to a Previous Snapshot\n+-----------------------------------\n+\n+Iceberg supports a \"snapshot\" model of data, where table snapshots are\n+identified by an ``long`` snapshot_ids.\n+\n+The connector provides a system snapshots table for each Iceberg table.  Snapshots are\n+identified by BIGINT snapshot ids.  You can find the latest snapshot id for table\n+foo by running the following command::\n+\n+    SELECT snapshot_id FROM 'foo$snapshots' ORDER BY committed_at DESC LIMIT 1\n+\n+A SQL procedure ``system.rollback_to_snapshot`` allows the caller to roll back\n+the state of the table to a previous snapshot id::\n+\n+    CALL system.rollback_to_snapshot(schema_name, table_name, snapshot_id)\n+\n+Schema Evolution\n+----------------\n+\n+Iceberg and the Iceberg connector support schema evolution, with safe\n+column add, drop, reorder and rename operations, including in nested structures.\n+Table partitioning can also be changed and the connector can still\n+query data created before the partitioning change.\n+\n+Migrating Existing Tables\n+-------------------------\n+\n+The connector can read from or write to Hive tables that have been migrated to Iceberg.\n+Currently, there is no Presto support to migrate Hive tables to Presto, so you will\n+need to use either the Iceberg API or Spark.\n+\n+System Tables and Columns\n+-------------------------\n+\n+The connector supports ``table$partitions`` as a substitute for Hive's ``SHOW PARTITIONS``.\n+The differences are that it returns some partition metrics for each partition value\n+and you can also use it on unpartitioned tables.\n+\n+Iceberg supports ``$snapshot_id`` and ``$snapshot_timestamp_ms`` as hidden columns.\n+These columns allow users to query an old version of the table. Think of this\n+as a time-travel feature which lets you query your table's snapshot at a given time.\n+\n+Iceberg Table Properties\n+------------------------\n+\n+================================================== ============================================================ ============\n+Property Name                                      Description                                                  Default\n+================================================== ============================================================ ============\n+``format``                                         Optionally specifies the format of table data files;         ORC\n+                                                   either PARQUET or ORC.\n+\n+``partitioning``                                   Optionally specifies table partitioning.\n+                                                   If a table is partitioned by columns c1 and c2, the\n+                                                   partitioning property would be\n+                                                   ``partitioning = ARRAY['c1', 'c2']``\n+\n+``location``                                       Optionally specifies the file system location URI for\n+                                                   the table", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzY2NDk2MQ==", "url": "https://github.com/trinodb/trino/pull/4537#discussion_r483664961", "bodyText": "Changed.", "author": "djsstarburst", "createdAt": "2020-09-04T14:50:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMyNTE1Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMyNTMxNw==", "url": "https://github.com/trinodb/trino/pull/4537#discussion_r483325317", "bodyText": "Use code quotes for PARQUET or write it as the name Parquet. Code quotes around column names and location.", "author": "electrum", "createdAt": "2020-09-04T00:44:23Z", "path": "presto-docs/src/main/sphinx/connector/iceberg.rst", "diffHunk": "@@ -0,0 +1,197 @@\n+=================\n+Iceberg Connector\n+=================\n+\n+Overview\n+--------\n+\n+Apache Iceberg is an open table format for huge analytic datasets.\n+The Iceberg connector allows querying data stored in\n+files written in Iceberg format, as defined in the\n+`Iceberg Table Spec <https://iceberg.apache.org/spec/>`_.\n+\n+The Iceberg connector supports:\n+\n+* All Presto types, including TIME, TIMESTAMP, DECIMAL\n+* CREATE TABLE and CREATE TABLE AS\n+* Partitioning tables by any Presto type\n+* Dropping tables\n+* Renaming tables\n+* Deletion by partition\n+* Table and column statistics\n+* Table and column comments\n+* Rolling back a table to a previous state\n+* Schema evolution\n+\n+The Iceberg table state is maintained in metadata files. All changes to table state\n+create a new metadata file and replace the old metadata with an atomic swap.\n+The table metadata file tracks the table schema, partitioning config,\n+custom properties, and snapshots of the table contents.\n+\n+Iceberg data files can be stored in either Parquet or ORC format, as\n+determined by the ``format`` property in the table definition.  The\n+table ``format`` defaults to ``ORC``.\n+\n+Iceberg is designed to improve on the known scalabilty limitations of Hive.  Hive\n+stores table metadata in an object store backed by a database like MySQL.  It tracks\n+partition locations in the metastore, but not individual data files.  Presto queries\n+using the Hive connector must first call the metastore to get partition locations,\n+then call the underlying filesystem to list all data files inside each partition,\n+and then read metadata from each data file.\n+\n+Since Iceberg stores the paths to data files in the metadata files, it\n+only consults the underlying file system for files that must be read.\n+\n+Status\n+------\n+\n+The Iceberg connector is not yet supported for production use.\n+\n+Compatibility With Spark Iceberg\n+--------------------------------\n+\n+Tests have been written to demonstrate that data written by Presto can be read\n+using Spark SQL with the Iceberg format, and vice versa.  See\n+`TestSparkCompatibility <https://github.com/prestosql/presto/blob/master/presto-product-tests/src/main/java/io/prestosql/tests/iceberg/TestSparkCompatibility.java>`_.\n+\n+Configuration\n+-------------\n+\n+Iceberg supports the same metastore configuration properties as the Hive connector.\n+At a minimum, ``hive.metastore.uri`` must be configured:\n+\n+.. code-block:: none\n+\n+    connector.name=iceberg\n+    hive.metastore.uri=thrift://localhost:9083\n+\n+Partitioned Tables\n+------------------\n+\n+Iceberg supports partitioning by specifying transforms over the table columns.\n+A partition is created for each unique tuple value produced by the transforms.\n+Identity transforms are simply the column name. Other transforms are:\n+\n+===================================== ================================================================================================\n+Transform                             Description\n+===================================== ================================================================================================\n+``year(ts)``                          The partition value is the integer difference in years between ``ts`` and January 1st. 1970.\n+\n+``month(ts)``                         The partition value is the integer difference in months between ``ts`` and January 1st. 1970.\n+\n+``day(ts)``                           The partition value is the integer difference in days between ``ts`` and January 1st. 1970.\n+\n+``hour(ts)``                          The partition value is a TIMESTAMP rounded down to the nearest hour.\n+\n+``bucket(x, nbuckets)``               The partition value is an integer hash of ``x``, with a value between 0 and ``nbuckets - 1`` inclusive.\n+\n+``truncate(s, nchars)``               The partition value is the first ``nchars`` characters of VARCHAR ``s``.\n+===================================== ================================================================================================\n+\n+In this example, the table is partitioned by month and by a hash of the account number::\n+\n+    CREATE TABLE iceberg.testdb.sample_partitioned (\n+        order_date DATE,\n+        account_number BIGINT,\n+        customer VARCHAR)\n+    WITH (partitioning = ARRAY['month(order_date)', 'bucket(account_number, 10)'])\n+\n+Deletion by Partition\n+---------------------\n+\n+For partitioned tables, the Iceberg connector supports the deletion of entire\n+partitions if the WHERE clause specifies an identity transform of a partition\n+column.  Given this table definition::\n+\n+    CREATE TABLE test_partition_deletion (\n+        c integer,\n+        d double)\n+        WITH (partitioning = ARRAY['c'])\n+\n+This SQL will delete all partitions for which c is 1::\n+\n+    DELETE FROM test_partition_deletion\n+    WHERE c = 1\n+\n+The current Iceberg connector is based on Iceberg v1.  Iceberg v2 is not yet\n+released.  When v2 is released, it will support row-level deletion and the\n+Iceberg connector will be updated to provide row-level deletion.\n+\n+The Iceberg connector currently supports only deletion by partition.\n+This SQL below will fail because the doesn't span entire partitions::\n+\n+    DELETE FROM test_partition_deletion\n+    WHERE c = 1 AND d > 10\n+\n+Rolling Back to a Previous Snapshot\n+-----------------------------------\n+\n+Iceberg supports a \"snapshot\" model of data, where table snapshots are\n+identified by an ``long`` snapshot_ids.\n+\n+The connector provides a system snapshots table for each Iceberg table.  Snapshots are\n+identified by BIGINT snapshot ids.  You can find the latest snapshot id for table\n+foo by running the following command::\n+\n+    SELECT snapshot_id FROM 'foo$snapshots' ORDER BY committed_at DESC LIMIT 1\n+\n+A SQL procedure ``system.rollback_to_snapshot`` allows the caller to roll back\n+the state of the table to a previous snapshot id::\n+\n+    CALL system.rollback_to_snapshot(schema_name, table_name, snapshot_id)\n+\n+Schema Evolution\n+----------------\n+\n+Iceberg and the Iceberg connector support schema evolution, with safe\n+column add, drop, reorder and rename operations, including in nested structures.\n+Table partitioning can also be changed and the connector can still\n+query data created before the partitioning change.\n+\n+Migrating Existing Tables\n+-------------------------\n+\n+The connector can read from or write to Hive tables that have been migrated to Iceberg.\n+Currently, there is no Presto support to migrate Hive tables to Presto, so you will\n+need to use either the Iceberg API or Spark.\n+\n+System Tables and Columns\n+-------------------------\n+\n+The connector supports ``table$partitions`` as a substitute for Hive's ``SHOW PARTITIONS``.\n+The differences are that it returns some partition metrics for each partition value\n+and you can also use it on unpartitioned tables.\n+\n+Iceberg supports ``$snapshot_id`` and ``$snapshot_timestamp_ms`` as hidden columns.\n+These columns allow users to query an old version of the table. Think of this\n+as a time-travel feature which lets you query your table's snapshot at a given time.\n+\n+Iceberg Table Properties\n+------------------------\n+\n+================================================== ============================================================ ============\n+Property Name                                      Description                                                  Default\n+================================================== ============================================================ ============\n+``format``                                         Optionally specifies the format of table data files;         ORC\n+                                                   either PARQUET or ORC.\n+\n+``partitioning``                                   Optionally specifies table partitioning.\n+                                                   If a table is partitioned by columns c1 and c2, the\n+                                                   partitioning property would be\n+                                                   ``partitioning = ARRAY['c1', 'c2']``\n+\n+``location``                                       Optionally specifies the file system location URI for\n+                                                   the table\n+================================================== ============================================================ ============\n+\n+The table definition below specifies format PARQUET, partitioning by columns c1 and c2,", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzY2Njc1NA==", "url": "https://github.com/trinodb/trino/pull/4537#discussion_r483666754", "bodyText": "Changed to Parquet and quotes added.", "author": "djsstarburst", "createdAt": "2020-09-04T14:51:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMyNTMxNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMyODE2MQ==", "url": "https://github.com/trinodb/trino/pull/4537#discussion_r483328161", "bodyText": "This actually supports more than just characters: https://iceberg.apache.org/spec/#truncate-transform-details", "author": "electrum", "createdAt": "2020-09-04T00:56:16Z", "path": "presto-docs/src/main/sphinx/connector/iceberg.rst", "diffHunk": "@@ -0,0 +1,197 @@\n+=================\n+Iceberg Connector\n+=================\n+\n+Overview\n+--------\n+\n+Apache Iceberg is an open table format for huge analytic datasets.\n+The Iceberg connector allows querying data stored in\n+files written in Iceberg format, as defined in the\n+`Iceberg Table Spec <https://iceberg.apache.org/spec/>`_.\n+\n+The Iceberg connector supports:\n+\n+* All Presto types, including TIME, TIMESTAMP, DECIMAL\n+* CREATE TABLE and CREATE TABLE AS\n+* Partitioning tables by any Presto type\n+* Dropping tables\n+* Renaming tables\n+* Deletion by partition\n+* Table and column statistics\n+* Table and column comments\n+* Rolling back a table to a previous state\n+* Schema evolution\n+\n+The Iceberg table state is maintained in metadata files. All changes to table state\n+create a new metadata file and replace the old metadata with an atomic swap.\n+The table metadata file tracks the table schema, partitioning config,\n+custom properties, and snapshots of the table contents.\n+\n+Iceberg data files can be stored in either Parquet or ORC format, as\n+determined by the ``format`` property in the table definition.  The\n+table ``format`` defaults to ``ORC``.\n+\n+Iceberg is designed to improve on the known scalabilty limitations of Hive.  Hive\n+stores table metadata in an object store backed by a database like MySQL.  It tracks\n+partition locations in the metastore, but not individual data files.  Presto queries\n+using the Hive connector must first call the metastore to get partition locations,\n+then call the underlying filesystem to list all data files inside each partition,\n+and then read metadata from each data file.\n+\n+Since Iceberg stores the paths to data files in the metadata files, it\n+only consults the underlying file system for files that must be read.\n+\n+Status\n+------\n+\n+The Iceberg connector is not yet supported for production use.\n+\n+Compatibility With Spark Iceberg\n+--------------------------------\n+\n+Tests have been written to demonstrate that data written by Presto can be read\n+using Spark SQL with the Iceberg format, and vice versa.  See\n+`TestSparkCompatibility <https://github.com/prestosql/presto/blob/master/presto-product-tests/src/main/java/io/prestosql/tests/iceberg/TestSparkCompatibility.java>`_.\n+\n+Configuration\n+-------------\n+\n+Iceberg supports the same metastore configuration properties as the Hive connector.\n+At a minimum, ``hive.metastore.uri`` must be configured:\n+\n+.. code-block:: none\n+\n+    connector.name=iceberg\n+    hive.metastore.uri=thrift://localhost:9083\n+\n+Partitioned Tables\n+------------------\n+\n+Iceberg supports partitioning by specifying transforms over the table columns.\n+A partition is created for each unique tuple value produced by the transforms.\n+Identity transforms are simply the column name. Other transforms are:\n+\n+===================================== ================================================================================================\n+Transform                             Description\n+===================================== ================================================================================================\n+``year(ts)``                          The partition value is the integer difference in years between ``ts`` and January 1st. 1970.\n+\n+``month(ts)``                         The partition value is the integer difference in months between ``ts`` and January 1st. 1970.\n+\n+``day(ts)``                           The partition value is the integer difference in days between ``ts`` and January 1st. 1970.\n+\n+``hour(ts)``                          The partition value is a TIMESTAMP rounded down to the nearest hour.\n+\n+``bucket(x, nbuckets)``               The partition value is an integer hash of ``x``, with a value between 0 and ``nbuckets - 1`` inclusive.\n+\n+``truncate(s, nchars)``               The partition value is the first ``nchars`` characters of VARCHAR ``s``.", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzY2Njg3Mw==", "url": "https://github.com/trinodb/trino/pull/4537#discussion_r483666873", "bodyText": "I'll have to add a couple more tests.", "author": "djsstarburst", "createdAt": "2020-09-04T14:51:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMyODE2MQ=="}], "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": "831af36a4d865a648b636082bca08d8e28b3aa4d", "url": "https://github.com/trinodb/trino/commit/831af36a4d865a648b636082bca08d8e28b3aa4d", "message": "Iceberg connector documentation\n\nThis documentation has been reviewed by the doc group.", "committedDate": "2020-09-08T20:34:59Z", "type": "commit"}, {"oid": "831af36a4d865a648b636082bca08d8e28b3aa4d", "url": "https://github.com/trinodb/trino/commit/831af36a4d865a648b636082bca08d8e28b3aa4d", "message": "Iceberg connector documentation\n\nThis documentation has been reviewed by the doc group.", "committedDate": "2020-09-08T20:34:59Z", "type": "forcePushed"}]}