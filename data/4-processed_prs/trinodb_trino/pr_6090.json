{"pr_number": 6090, "pr_title": "Ensure no operator info is ignored", "pr_createdAt": "2020-11-25T11:45:26Z", "pr_url": "https://github.com/trinodb/trino/pull/6090", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDMxMzAwNA==", "url": "https://github.com/trinodb/trino/pull/6090#discussion_r530313004", "bodyText": "i think we should actually throw here.", "author": "findepi", "createdAt": "2020-11-25T11:45:41Z", "path": "presto-main/src/main/java/io/prestosql/operator/OperatorStats.java", "diffHunk": "@@ -521,8 +524,14 @@ public OperatorStats add(Iterable<OperatorStats> operators)\n             }\n \n             OperatorInfo info = operator.getInfo();\n-            if (base != null && info != null && base.getClass() == info.getClass()) {\n-                base = mergeInfo(base, info);\n+            if (base != null && info != null) {\n+                if (base.getClass() != info.getClass()) {\n+                    // TODO should we throw here?\n+                    log.warn(\"Cannot merge operator info: %s and %s\", base, info);", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDMxNjI0NQ==", "url": "https://github.com/trinodb/trino/pull/6090#discussion_r530316245", "bodyText": "Probably, that line was from 2014, so maybe original reason for this check is no longer valid", "author": "sopel39", "createdAt": "2020-11-25T11:51:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDMxMzAwNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDMxOTY3NA==", "url": "https://github.com/trinodb/trino/pull/6090#discussion_r530319674", "bodyText": "I think we should throw.", "author": "sopel39", "createdAt": "2020-11-25T11:57:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDMxMzAwNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDMyNjQ4MQ==", "url": "https://github.com/trinodb/trino/pull/6090#discussion_r530326481", "bodyText": "i replaced this with a check", "author": "findepi", "createdAt": "2020-11-25T12:09:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDMxMzAwNA=="}], "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDczODA4Mw==", "url": "https://github.com/trinodb/trino/pull/6090#discussion_r530738083", "bodyText": "verify() throws a more appropriate exception", "author": "electrum", "createdAt": "2020-11-26T02:26:44Z", "path": "presto-main/src/main/java/io/prestosql/operator/OperatorStats.java", "diffHunk": "@@ -521,7 +522,8 @@ public OperatorStats add(Iterable<OperatorStats> operators)\n             }\n \n             OperatorInfo info = operator.getInfo();\n-            if (base != null && info != null && base.getClass() == info.getClass()) {\n+            if (base != null && info != null) {\n+                checkState(base.getClass() == info.getClass(), \"Cannot merge operator infos: %s and %s\", base, info);", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "46236b923e10f6873cdca62bc86a1eed86111563", "url": "https://github.com/trinodb/trino/commit/46236b923e10f6873cdca62bc86a1eed86111563", "message": "Ensure no operator info is ignored\n\nEnsure the operator infos can be merged, rather than ignoring the\ninconsistencies and returning a \"random\" one.", "committedDate": "2020-11-26T12:02:09Z", "type": "commit"}, {"oid": "46236b923e10f6873cdca62bc86a1eed86111563", "url": "https://github.com/trinodb/trino/commit/46236b923e10f6873cdca62bc86a1eed86111563", "message": "Ensure no operator info is ignored\n\nEnsure the operator infos can be merged, rather than ignoring the\ninconsistencies and returning a \"random\" one.", "committedDate": "2020-11-26T12:02:09Z", "type": "forcePushed"}]}