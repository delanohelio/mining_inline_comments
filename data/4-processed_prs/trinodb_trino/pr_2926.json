{"pr_number": 2926, "pr_title": "Add show tables access control", "pr_createdAt": "2020-02-24T13:26:03Z", "pr_url": "https://github.com/trinodb/trino/pull/2926", "timeline": [{"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDg0MjA4Mw==", "url": "https://github.com/trinodb/trino/pull/2926#discussion_r384842083", "bodyText": "Add a comment here and below that this check is wrong, and we should add a new method checkCanShowGrants", "author": "dain", "createdAt": "2020-02-27T00:07:27Z", "path": "presto-main/src/main/java/io/prestosql/sql/rewrite/ShowQueriesRewrite.java", "diffHunk": "@@ -226,6 +230,10 @@ protected Node visitShowGrants(ShowGrants showGrants, Void context)\n \n                 catalogName = qualifiedTableName.getCatalogName();\n \n+                accessControl.checkCanShowTables(", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDg0MzI5Ng==", "url": "https://github.com/trinodb/trino/pull/2926#discussion_r384843296", "bodyText": "Static import", "author": "dain", "createdAt": "2020-02-27T00:11:19Z", "path": "presto-spi/src/main/java/io/prestosql/spi/security/SystemAccessControl.java", "diffHunk": "@@ -246,6 +246,20 @@ default void checkCanSetTableComment(SystemSecurityContext context, CatalogSchem\n         denyCommentTable(table.toString());\n     }\n \n+    /**\n+     * Check if identity is allowed to show metadata of tables by executing SHOW TABLES, SHOW GRANTS etc. in a catalog.\n+     * <p>\n+     * NOTE: This method is only present to give users an error message when listing is not allowed.\n+     * The {@link #filterTables} method must filter all results for unauthorized users,\n+     * since there are multiple ways to list tables.\n+     *\n+     * @throws AccessDeniedException if not allowed\n+     */\n+    default void checkCanShowTables(SystemSecurityContext context, CatalogSchemaName schema)\n+    {\n+        AccessDeniedException.denyShowTables(schema.toString());", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDg0MzQyNA==", "url": "https://github.com/trinodb/trino/pull/2926#discussion_r384843424", "bodyText": "Cannot show tables of schema...", "author": "dain", "createdAt": "2020-02-27T00:11:45Z", "path": "presto-spi/src/main/java/io/prestosql/spi/security/AccessDeniedException.java", "diffHunk": "@@ -181,6 +181,16 @@ public static void denyCommentTable(String tableName, String extraInfo)\n         throw new AccessDeniedException(format(\"Cannot comment table to %s%s\", tableName, formatExtraInfo(extraInfo)));\n     }\n \n+    public static void denyShowTables(String schemaName)\n+    {\n+        denyShowTables(schemaName, null);\n+    }\n+\n+    public static void denyShowTables(String schemaName, String extraInfo)\n+    {\n+        throw new AccessDeniedException(format(\"Cannot show metadata of tables in %s%s\", schemaName, formatExtraInfo(extraInfo)));", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "63ce4757e4d1eff9103c8232e8c110563f3657a5", "url": "https://github.com/trinodb/trino/commit/63ce4757e4d1eff9103c8232e8c110563f3657a5", "message": "Add show tables access control", "committedDate": "2020-03-02T18:41:09Z", "type": "commit"}, {"oid": "63ce4757e4d1eff9103c8232e8c110563f3657a5", "url": "https://github.com/trinodb/trino/commit/63ce4757e4d1eff9103c8232e8c110563f3657a5", "message": "Add show tables access control", "committedDate": "2020-03-02T18:41:09Z", "type": "forcePushed"}]}