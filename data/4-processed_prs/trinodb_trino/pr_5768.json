{"pr_number": 5768, "pr_title": "Fix Hive applyProjection performance issue", "pr_createdAt": "2020-10-31T22:45:04Z", "pr_url": "https://github.com/trinodb/trino/pull/5768", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTU1MjA4Nw==", "url": "https://github.com/trinodb/trino/pull/5768#discussion_r515552087", "bodyText": "Value itself doesn't seem enough for comparison (e.g multiple types can be represented by long). Maybe we should precalculate has value (we do that in other classes where hash computation is expensive)", "author": "sopel39", "createdAt": "2020-10-31T23:22:51Z", "path": "presto-spi/src/main/java/io/prestosql/spi/expression/Constant.java", "diffHunk": "@@ -48,7 +48,7 @@ public Object getValue()\n     @Override\n     public int hashCode()\n     {\n-        return Objects.hash(value, getType());", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTU1ODIxNQ==", "url": "https://github.com/trinodb/trino/pull/5768#discussion_r515558215", "bodyText": "Thanks for the suggestion on caching the value, that makes sense.\nI'm curious if there's a historical reason behind not implementing/precalculating hashcode method in some types (ArrayType, RowType etc).", "author": "phd3", "createdAt": "2020-11-01T00:37:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTU1MjA4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTY2Nzk5Mg==", "url": "https://github.com/trinodb/trino/pull/5768#discussion_r515667992", "bodyText": "@phd3 is this commit the gist of the change?", "author": "findepi", "createdAt": "2020-11-01T20:28:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTU1MjA4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTcyNDMxOQ==", "url": "https://github.com/trinodb/trino/pull/5768#discussion_r515724319", "bodyText": "@findepi I think both the commits are crucial, the hashCode issue is more important in context of FieldDereference class.", "author": "phd3", "createdAt": "2020-11-02T03:31:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTU1MjA4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTg2MjEzNg==", "url": "https://github.com/trinodb/trino/pull/5768#discussion_r515862136", "bodyText": "I'm curious if there's a historical reason behind not implementing/precalculating hashcode method in some types (ArrayType, RowType etc).\n\nWhat do you mean specifically? If you mean particular rows, one would need to keep hashcode in Block itself, which cost memory and might not be that beneficial in general processing", "author": "sopel39", "createdAt": "2020-11-02T10:05:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTU1MjA4Nw=="}], "type": "inlineReview"}, {"oid": "bd6a54354a86f976e78487bd59cbfa60364f5230", "url": "https://github.com/trinodb/trino/commit/bd6a54354a86f976e78487bd59cbfa60364f5230", "message": "Build variable mapping set only once outside of the stream", "committedDate": "2020-11-02T15:03:16Z", "type": "commit"}, {"oid": "bd6a54354a86f976e78487bd59cbfa60364f5230", "url": "https://github.com/trinodb/trino/commit/bd6a54354a86f976e78487bd59cbfa60364f5230", "message": "Build variable mapping set only once outside of the stream", "committedDate": "2020-11-02T15:03:16Z", "type": "forcePushed"}]}