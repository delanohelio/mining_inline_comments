{"pr_number": 4915, "pr_title": "Test connector when running join with empty build side", "pr_createdAt": "2020-08-21T13:07:13Z", "pr_url": "https://github.com/trinodb/trino/pull/4915", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDc5ODI5NA==", "url": "https://github.com/trinodb/trino/pull/4915#discussion_r474798294", "bodyText": "You should also disable join reordering.", "author": "findepi", "createdAt": "2020-08-21T16:20:37Z", "path": "presto-testing/src/main/java/io/prestosql/testing/AbstractTestIntegrationSmokeTest.java", "diffHunk": "@@ -196,6 +198,21 @@ public void testSelectAll()\n         assertQuery(\"SELECT * FROM orders\");\n     }\n \n+    /**\n+     * Test interactions between optimizer (including CBO), scheduling and connector metadata APIs.\n+     */\n+    @Test(timeOut = 300_000)\n+    public void testJoinWithEmptyBuildSide()\n+    {\n+        for (JoinDistributionType joinDistributionType : JoinDistributionType.values()) {\n+            Session session = Session.builder(getSession())\n+                    .setSystemProperty(JOIN_DISTRIBUTION_TYPE, joinDistributionType.toString())", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDc5ODYxMQ==", "url": "https://github.com/trinodb/trino/pull/4915#discussion_r474798611", "bodyText": "can we test with empty proble side as well?\njust in case eg quick termination of the source stage (of the build side) does not leave things lingering?", "author": "findepi", "createdAt": "2020-08-21T16:21:11Z", "path": "presto-testing/src/main/java/io/prestosql/testing/AbstractTestIntegrationSmokeTest.java", "diffHunk": "@@ -196,6 +198,21 @@ public void testSelectAll()\n         assertQuery(\"SELECT * FROM orders\");\n     }\n \n+    /**\n+     * Test interactions between optimizer (including CBO), scheduling and connector metadata APIs.\n+     */\n+    @Test(timeOut = 300_000)\n+    public void testJoinWithEmptyBuildSide()\n+    {\n+        for (JoinDistributionType joinDistributionType : JoinDistributionType.values()) {\n+            Session session = Session.builder(getSession())\n+                    .setSystemProperty(JOIN_DISTRIBUTION_TYPE, joinDistributionType.toString())\n+                    .build();\n+            assertQuery(session, \"SELECT count(*) FROM nation JOIN region ON nation.regionkey = region.regionkey AND region.name = ''\", \"VALUES 0\");\n+            assertQuery(session, \"SELECT count(*) FROM nation JOIN region ON nation.regionkey = region.regionkey AND region.regionkey < 0\", \"VALUES 0\");", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDgxMTE5OQ==", "url": "https://github.com/trinodb/trino/pull/4915#discussion_r474811199", "bodyText": "Note that we have similar tests on AbstractTestJoinQueries, but I don't think these tests are executed in connectors", "author": "sopel39", "createdAt": "2020-08-21T16:46:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDc5ODYxMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDk3NjUwNA==", "url": "https://github.com/trinodb/trino/pull/4915#discussion_r474976504", "bodyText": "they are not", "author": "findepi", "createdAt": "2020-08-21T21:24:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDc5ODYxMQ=="}], "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": "4e597e7713d72f85a988fcc15c912c6fcc0b54a1", "url": "https://github.com/trinodb/trino/commit/4e597e7713d72f85a988fcc15c912c6fcc0b54a1", "message": "Test connector when running join with empty build side", "committedDate": "2020-08-25T12:07:23Z", "type": "commit"}, {"oid": "4e597e7713d72f85a988fcc15c912c6fcc0b54a1", "url": "https://github.com/trinodb/trino/commit/4e597e7713d72f85a988fcc15c912c6fcc0b54a1", "message": "Test connector when running join with empty build side", "committedDate": "2020-08-25T12:07:23Z", "type": "forcePushed"}]}