{"pr_number": 3784, "pr_title": "Filter internal schemas in Oracle connector", "pr_createdAt": "2020-05-19T10:54:37Z", "pr_url": "https://github.com/trinodb/trino/pull/3784", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzY0OTQ2OA==", "url": "https://github.com/trinodb/trino/pull/3784#discussion_r427649468", "bodyText": "I think it'd be cleaner to do this like\nprivate static final INTERNAL_SCHEMAS = ImmutableSet.of(\"information_schema\", ...);\n\nif (!INTERNAL_SCHEMAS.contains(schemaName.toLowerCase(ENGLISH))", "author": "electrum", "createdAt": "2020-05-19T23:06:26Z", "path": "presto-oracle/src/main/java/io/prestosql/plugin/oracle/OracleClient.java", "diffHunk": "@@ -102,6 +104,35 @@ public OracleClient(\n         return new String[] {\"TABLE\", \"VIEW\"};\n     }\n \n+    @Override\n+    protected Collection<String> listSchemas(Connection connection)\n+    {\n+        try (ResultSet resultSet = connection.getMetaData().getSchemas(connection.getCatalog(), null)) {\n+            ImmutableSet.Builder<String> schemaNames = ImmutableSet.builder();\n+            while (resultSet.next()) {\n+                String schemaName = resultSet.getString(\"TABLE_SCHEM\");\n+                // skip internal schemas\n+                if (!schemaName.equalsIgnoreCase(\"information_schema\")", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODA1OTc2NA==", "url": "https://github.com/trinodb/trino/pull/3784#discussion_r428059764", "bodyText": "apex are tables for Oracle Apex (Oracle Application Express)\nI think we should leave this", "author": "eskabetxe", "createdAt": "2020-05-20T14:30:19Z", "path": "presto-oracle/src/main/java/io/prestosql/plugin/oracle/OracleClient.java", "diffHunk": "@@ -71,6 +74,20 @@\n public class OracleClient\n         extends BaseJdbcClient\n {\n+    private static final Set<String> INTERNAL_SCHEMAS = ImmutableSet.<String>builder()\n+            .add(\"information_schema\")\n+            .add(\"apex_040000\")", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUzODczNA==", "url": "https://github.com/trinodb/trino/pull/3784#discussion_r429538734", "bodyText": "Introduce a filterSchema method in BaseJdbcClient, so that you need to override only that, instead of whole listSchemas.\nUse this new method in io.prestosql.plugin.jdbc.BaseJdbcClient#getTableNames too.\n(This could solve #3831 as well)\nsee io.prestosql.plugin.hive.HiveMetadata#filterSchema", "author": "findepi", "createdAt": "2020-05-23T11:43:09Z", "path": "presto-oracle/src/main/java/io/prestosql/plugin/oracle/OracleClient.java", "diffHunk": "@@ -102,6 +119,25 @@ public OracleClient(\n         return new String[] {\"TABLE\", \"VIEW\"};\n     }\n \n+    @Override\n+    protected Collection<String> listSchemas(Connection connection)\n+    {\n+        try (ResultSet resultSet = connection.getMetaData().getSchemas(connection.getCatalog(), null)) {\n+            ImmutableSet.Builder<String> schemaNames = ImmutableSet.builder();\n+            while (resultSet.next()) {\n+                String schemaName = resultSet.getString(\"TABLE_SCHEM\");\n+                // skip internal schemas\n+                if (!INTERNAL_SCHEMAS.contains(schemaName.toLowerCase(ENGLISH))) {", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU0NDMxMg==", "url": "https://github.com/trinodb/trino/pull/3784#discussion_r429544312", "bodyText": "Let me separate PR as #3834", "author": "ebyhr", "createdAt": "2020-05-23T13:01:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUzODczNA=="}], "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": "81913445e5cfc130f0d8a94a3a45464bff2da35a", "url": "https://github.com/trinodb/trino/commit/81913445e5cfc130f0d8a94a3a45464bff2da35a", "message": "Filter internal schemas in Oracle connector\n\nAdditionally, drop apex_040000 to fasten tests.", "committedDate": "2020-07-07T04:26:21Z", "type": "commit"}, {"oid": "81913445e5cfc130f0d8a94a3a45464bff2da35a", "url": "https://github.com/trinodb/trino/commit/81913445e5cfc130f0d8a94a3a45464bff2da35a", "message": "Filter internal schemas in Oracle connector\n\nAdditionally, drop apex_040000 to fasten tests.", "committedDate": "2020-07-07T04:26:21Z", "type": "forcePushed"}]}