{"pr_number": 5150, "pr_title": "Support pushdown for date, tinyint and smallint types in Cassandra", "pr_createdAt": "2020-09-13T05:27:23Z", "pr_url": "https://github.com/trinodb/trino/pull/5150", "timeline": [{"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzcxMzA0MQ==", "url": "https://github.com/trinodb/trino/pull/5150#discussion_r487713041", "bodyText": "prestoNativeValue for date will be number of days since epoch\nin the getColumnValueForCql(Row row, int position) above we use yyyy-mm-dd representation\ncan we unify the two? if not, why would i quoteStringLiteral the number?", "author": "findepi", "createdAt": "2020-09-14T07:43:17Z", "path": "presto-cassandra/src/main/java/io/prestosql/plugin/cassandra/CassandraType.java", "diffHunk": "@@ -334,6 +334,7 @@ public String toCqlLiteral(Object prestoNativeValue)\n             case ASCII:\n             case TEXT:\n             case VARCHAR:\n+            case DATE:", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzcxMzU3NA==", "url": "https://github.com/trinodb/trino/pull/5150#discussion_r487713574", "bodyText": "i tend to put date before timestamp (\"simpler one first\")\nalso, would be nice to put all the inteer types together (TINYINT, SMALLINT, INT, BIGINT)", "author": "findepi", "createdAt": "2020-09-14T07:44:17Z", "path": "presto-cassandra/src/main/java/io/prestosql/plugin/cassandra/CassandraType.java", "diffHunk": "@@ -441,9 +442,12 @@ public boolean isSupportedPartitionKey()\n             case DOUBLE:\n             case INET:\n             case INT:\n+            case SMALLINT:\n+            case TINYINT:\n             case FLOAT:\n             case DECIMAL:\n             case TIMESTAMP:\n+            case DATE:", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzcxNDQ4MQ==", "url": "https://github.com/trinodb/trino/pull/5150#discussion_r487714481", "bodyText": "split this into 3 separate cases and apply validation on the cursor.getLong result using:\n\ncom.google.common.primitives.SignedBytes#checkedCast\ncom.google.common.primitives.Shorts#checkedCast\njava.lang.Math#toIntExact", "author": "findepi", "createdAt": "2020-09-14T07:45:56Z", "path": "presto-cassandra/src/test/java/io/prestosql/plugin/cassandra/TestCassandraConnector.java", "diffHunk": "@@ -213,7 +216,7 @@ private static void assertReadFields(RecordCursor cursor, List<ColumnMetadata> s\n                 if (BOOLEAN.equals(type)) {\n                     cursor.getBoolean(columnIndex);\n                 }\n-                else if (INTEGER.equals(type)) {\n+                else if (TINYINT.equals(type) || SMALLINT.equals(type) || INTEGER.equals(type)) {", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzcxNTYzNg==", "url": "https://github.com/trinodb/trino/pull/5150#discussion_r487715636", "bodyText": "Why would i call cursor.getSlice for a DATE value (backed by long, in 32-bit int range)?", "author": "findepi", "createdAt": "2020-09-14T07:48:02Z", "path": "presto-cassandra/src/test/java/io/prestosql/plugin/cassandra/TestCassandraConnector.java", "diffHunk": "@@ -228,7 +231,7 @@ else if (DOUBLE.equals(type)) {\n                 else if (REAL.equals(type)) {\n                     cursor.getLong(columnIndex);\n                 }\n-                else if (isVarcharType(type) || VARBINARY.equals(type)) {\n+                else if (isVarcharType(type) || VARBINARY.equals(type) || DateType.DATE.equals(type)) {", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": "bd42b069ae1179de4db284661d0a21e6236a0fa1", "url": "https://github.com/trinodb/trino/commit/bd42b069ae1179de4db284661d0a21e6236a0fa1", "message": "Support pushdown for date, tinyint and smallint types in Cassandra", "committedDate": "2021-08-16T13:10:49Z", "type": "commit"}, {"oid": "bd42b069ae1179de4db284661d0a21e6236a0fa1", "url": "https://github.com/trinodb/trino/commit/bd42b069ae1179de4db284661d0a21e6236a0fa1", "message": "Support pushdown for date, tinyint and smallint types in Cassandra", "committedDate": "2021-08-16T13:10:49Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4OTY3NTYyNg==", "url": "https://github.com/trinodb/trino/pull/5150#discussion_r689675626", "bodyText": "Seems like these two types already had the necessary code implemented?", "author": "hashhar", "createdAt": "2021-08-16T16:16:17Z", "path": "plugin/trino-cassandra/src/main/java/io/trino/plugin/cassandra/CassandraType.java", "diffHunk": "@@ -443,8 +448,11 @@ public boolean isSupportedPartitionKey()\n             case DOUBLE:\n             case INET:\n             case INT:\n+            case TINYINT:\n+            case SMALLINT:", "originalCommit": "bd42b069ae1179de4db284661d0a21e6236a0fa1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY5MDM1OTczMg==", "url": "https://github.com/trinodb/trino/pull/5150#discussion_r690359732", "bodyText": "Yes, I simply forgot updating this switch statements when adding those types.", "author": "ebyhr", "createdAt": "2021-08-17T13:16:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4OTY3NTYyNg=="}], "type": "inlineReview"}]}