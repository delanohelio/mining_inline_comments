{"pr_number": 5676, "pr_title": "Produce a better message when test fails", "pr_createdAt": "2020-10-23T11:49:21Z", "pr_url": "https://github.com/trinodb/trino/pull/5676", "timeline": [{"oid": "9b60fbb4ccbc0d981d43746e8bc913a5910f6cb8", "url": "https://github.com/trinodb/trino/commit/9b60fbb4ccbc0d981d43746e8bc913a5910f6cb8", "message": "Split test method", "committedDate": "2020-10-23T11:33:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDg4ODIzMg==", "url": "https://github.com/trinodb/trino/pull/5676#discussion_r510888232", "bodyText": "remove", "author": "sopel39", "createdAt": "2020-10-23T13:35:49Z", "path": "presto-main/src/test/java/io/prestosql/util/TestTimeZoneUtils.java", "diffHunk": "@@ -60,9 +64,22 @@ public void testOffsets()\n \n     public static void assertTimeZone(String zoneId, DateTimeZone dateTimeZone)\n     {\n-        long dateTimeWithTimeZone = packDateTimeWithZone(new DateTime(42, dateTimeZone));\n-        assertEquals(packDateTimeWithZone(42L, dateTimeZone.toTimeZone().getID()), dateTimeWithTimeZone);\n-        DateTimeZone unpackedZone = unpackDateTimeZone(dateTimeWithTimeZone);\n+        long packWithDateTime = packDateTimeWithZone(new DateTime(42, dateTimeZone));\n+        long packWithZoneId = packDateTimeWithZone(42L, dateTimeZone.toTimeZone().getID());\n+        if (packWithDateTime != packWithZoneId) {\n+            fail(format(\n+                    \"packWithDateTime and packWithZoneId differ for zone [%s] / [%s]: %s [%s %s] and %s [%s %s]\",\n+                    zoneId,\n+                    dateTimeZone,\n+                    packWithDateTime,\n+                    unpackMillisUtc(packWithDateTime),\n+                    unpackZoneKey(packWithDateTime),\n+                    packWithZoneId,\n+                    unpackMillisUtc(packWithZoneId),\n+                    unpackZoneKey(packWithZoneId)));\n+        }\n+        assertEquals(packWithZoneId, packWithDateTime);", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "c63f6ff494828f017597f40f118ea369d2b9e2f8", "url": "https://github.com/trinodb/trino/commit/c63f6ff494828f017597f40f118ea369d2b9e2f8", "message": "Produce a better message when test fails\n\nPreviously the test would fail with something like\n\n    java.lang.AssertionError: expected [174262] but found [172032]\n    Expected :174262\n    Actual   :172032", "committedDate": "2020-10-23T14:11:45Z", "type": "commit"}, {"oid": "7108b41b9e39ea0b9b133871cffd045e737d3d7c", "url": "https://github.com/trinodb/trino/commit/7108b41b9e39ea0b9b133871cffd045e737d3d7c", "message": "Avoid DateTimeZone.toTimeZone", "committedDate": "2020-10-23T14:11:46Z", "type": "commit"}, {"oid": "7108b41b9e39ea0b9b133871cffd045e737d3d7c", "url": "https://github.com/trinodb/trino/commit/7108b41b9e39ea0b9b133871cffd045e737d3d7c", "message": "Avoid DateTimeZone.toTimeZone", "committedDate": "2020-10-23T14:11:46Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDk1NzE3MA==", "url": "https://github.com/trinodb/trino/pull/5676#discussion_r510957170", "bodyText": "as it returns GMT for a zone not supported by the JVM\n\nwow!", "author": "martint", "createdAt": "2020-10-23T15:18:19Z", "path": "src/modernizer/violations.xml", "diffHunk": "@@ -67,6 +67,12 @@\n         <comment>Prefer new Configuration(false)</comment>\n     </violation>\n \n+    <violation>\n+        <name>org/joda/time/DateTimeZone.toTimeZone:()Ljava/util/TimeZone;</name>\n+        <version>1.8</version>\n+        <comment>Avoid DateTimeZone.toTimeZone as it returns GMT for a zone not supported by the JVM. Use TimeZone.getTimeZone(ZoneId.of(dtz.getId())) instead.</comment>", "originalCommit": "7108b41b9e39ea0b9b133871cffd045e737d3d7c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTAwMjc4MQ==", "url": "https://github.com/trinodb/trino/pull/5676#discussion_r511002781", "bodyText": "I will likewise block use of TimeZone.forTimeZone(String).", "author": "findepi", "createdAt": "2020-10-23T16:31:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDk1NzE3MA=="}], "type": "inlineReview"}, {"oid": "f5116b7aee02beca5d7d87a438c22d6a4b903a1e", "url": "https://github.com/trinodb/trino/commit/f5116b7aee02beca5d7d87a438c22d6a4b903a1e", "message": "Simplify conversion", "committedDate": "2020-10-23T16:03:11Z", "type": "commit"}, {"oid": "094eaa42b1847a0fd8516972e9a4284b10d860da", "url": "https://github.com/trinodb/trino/commit/094eaa42b1847a0fd8516972e9a4284b10d860da", "message": "Avoid TimeZone.getTimeZone\n\nAvoid TimeZone.getTimeZone as it returns GMT for a zone not supported\nby the JVM.", "committedDate": "2020-10-23T16:31:19Z", "type": "commit"}]}