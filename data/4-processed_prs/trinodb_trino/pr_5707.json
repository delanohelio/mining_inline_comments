{"pr_number": 5707, "pr_title": "Update dynamic filtering documentation", "pr_createdAt": "2020-10-27T12:35:37Z", "pr_url": "https://github.com/trinodb/trino/pull/5707", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjY2MjE1MQ==", "url": "https://github.com/trinodb/trino/pull/5707#discussion_r512662151", "bodyText": "I think it should be\nDynamic bucket pruning is supported for bucketed tables stored in any file format for broadcast joins only.", "author": "sopel39", "createdAt": "2020-10-27T12:47:06Z", "path": "presto-docs/src/main/sphinx/connector/hive.rst", "diffHunk": "@@ -538,6 +538,8 @@ Dynamic Filtering\n The Hive connector supports the :doc:`dynamic filtering </admin/dynamic-filtering>` optimization.\n Dynamic partition pruning is supported for partitioned tables stored in any file format\n for broadcast as well as partitioned joins.\n+Dynamic bucket pruning is supported for bucketed tables stored in any file format\n+only for broadcast joins.", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjY2MjY3MQ==", "url": "https://github.com/trinodb/trino/pull/5707#discussion_r512662671", "bodyText": "That's not true. If join is not source stage, it should work. I would skip this sentence as it might confuse readers.", "author": "sopel39", "createdAt": "2020-10-27T12:47:56Z", "path": "presto-docs/src/main/sphinx/connector/hive.rst", "diffHunk": "@@ -559,6 +561,7 @@ For the Hive connector, a table scan can be delayed for a configured amount of\n time until the collection of dynamic filters by using the configuration property\n ``hive.dynamic-filtering-probe-blocking-timeout`` in the catalog file or the catalog\n session property ``<hive-catalog>.dynamic_filtering_probe_blocking_timeout``.\n+Delaying table scans is not supported for dynamic filters on bucketed columns.", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjY4NjI2MA==", "url": "https://github.com/trinodb/trino/pull/5707#discussion_r512686260", "bodyText": "removed", "author": "raunaqmorarka", "createdAt": "2020-10-27T13:22:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjY2MjY3MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjY2NjEzNA==", "url": "https://github.com/trinodb/trino/pull/5707#discussion_r512666134", "bodyText": "I'm not sure readers would understand narrower, wider. Maybe:\nDynamic filtering could also work if join keys are of different types and there is an implicit coercion\nfrom probe key type to build key type. However, not all implicit coercion are supported. For example...", "author": "sopel39", "createdAt": "2020-10-27T12:53:23Z", "path": "presto-docs/src/main/sphinx/admin/dynamic-filtering.rst", "diffHunk": "@@ -211,3 +211,8 @@ Limitations\n * Dynamic filtering is currently implemented only for :doc:`/connector/hive` and :doc:`/connector/memory` connectors.\n * Push down of dynamic filters into local table scan on worker nodes is limited to broadcast joins.\n * Min-max dynamic filter collection is not supported for DOUBLE, REAL and unorderable data types.\n+* When the join keys are not of the same type, dynamic filtering is supported if the\n+  probe side type is wider than the build side type. When the probe side type is narrower,", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjY4NjM2OQ==", "url": "https://github.com/trinodb/trino/pull/5707#discussion_r512686369", "bodyText": "updated", "author": "raunaqmorarka", "createdAt": "2020-10-27T13:23:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjY2NjEzNA=="}], "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzA1Njc4Nw==", "url": "https://github.com/trinodb/trino/pull/5707#discussion_r513056787", "bodyText": "type, but not to", "author": "mosabua", "createdAt": "2020-10-27T21:56:15Z", "path": "presto-docs/src/main/sphinx/admin/dynamic-filtering.rst", "diffHunk": "@@ -211,3 +211,7 @@ Limitations\n * Dynamic filtering is currently implemented only for :doc:`/connector/hive` and :doc:`/connector/memory` connectors.\n * Push down of dynamic filters into local table scan on worker nodes is limited to broadcast joins.\n * Min-max dynamic filter collection is not supported for DOUBLE, REAL and unorderable data types.\n+* Dynamic filtering is supported in limited scenarios when join keys are of different types.\n+  There should be an implicit coercion from probe key type to build key type to allow dynamic\n+  filtering to cast the values collected from the build side to the probe key type. For example,\n+  ``DOUBLE`` values can be rounded to ``REAL`` or ``INTEGER`` type but not to ``BIGINT``.", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzE1OTI2MQ==", "url": "https://github.com/trinodb/trino/pull/5707#discussion_r513159261", "bodyText": "done", "author": "raunaqmorarka", "createdAt": "2020-10-28T03:32:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzA1Njc4Nw=="}], "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI4Njg2Ng==", "url": "https://github.com/trinodb/trino/pull/5707#discussion_r513286866", "bodyText": "I would skip to allow dynamic .. as a technical detail. Otherwise this sentence is quite complex", "author": "sopel39", "createdAt": "2020-10-28T09:16:12Z", "path": "presto-docs/src/main/sphinx/admin/dynamic-filtering.rst", "diffHunk": "@@ -211,3 +211,7 @@ Limitations\n * Dynamic filtering is currently implemented only for :doc:`/connector/hive` and :doc:`/connector/memory` connectors.\n * Push down of dynamic filters into local table scan on worker nodes is limited to broadcast joins.\n * Min-max dynamic filter collection is not supported for DOUBLE, REAL and unorderable data types.\n+* Dynamic filtering is supported in limited scenarios when join keys are of different types.\n+  There should be an implicit coercion from probe key type to build key type to allow dynamic", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzM2MTkxMA==", "url": "https://github.com/trinodb/trino/pull/5707#discussion_r513361910", "bodyText": "done", "author": "raunaqmorarka", "createdAt": "2020-10-28T11:15:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI4Njg2Ng=="}], "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQxNTc3Ng==", "url": "https://github.com/trinodb/trino/pull/5707#discussion_r513415776", "bodyText": "I don't understand this. Please just add an exception of coercion from probe to build type where DF would work.", "author": "sopel39", "createdAt": "2020-10-28T12:51:09Z", "path": "presto-docs/src/main/sphinx/admin/dynamic-filtering.rst", "diffHunk": "@@ -211,3 +211,6 @@ Limitations\n * Dynamic filtering is currently implemented only for :doc:`/connector/hive` and :doc:`/connector/memory` connectors.\n * Push down of dynamic filters into local table scan on worker nodes is limited to broadcast joins.\n * Min-max dynamic filter collection is not supported for DOUBLE, REAL and unorderable data types.\n+* Dynamic filtering is supported in limited scenarios when join keys are of different types.\n+  There should be an implicit coercion from probe key type to build key type. For example,\n+  ``DOUBLE`` values can be rounded to ``REAL`` or ``INTEGER`` type, but not to ``BIGINT``.", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTY1MzI1Mw==", "url": "https://github.com/trinodb/trino/pull/5707#discussion_r515653253", "bodyText": "updated", "author": "raunaqmorarka", "createdAt": "2020-11-01T18:11:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQxNTc3Ng=="}], "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTg2ODk1OQ==", "url": "https://github.com/trinodb/trino/pull/5707#discussion_r515868959", "bodyText": "Maybe rephase Dynamic filtering is supported when there is join key cast from build key type to probe key type. Dynamic filtering is also supported in limited scenarios when there is implicit cast from probe key type to build key type. For example, dynamic ...", "author": "sopel39", "createdAt": "2020-11-02T10:16:39Z", "path": "presto-docs/src/main/sphinx/admin/dynamic-filtering.rst", "diffHunk": "@@ -211,3 +211,7 @@ Limitations\n * Dynamic filtering is currently implemented only for :doc:`/connector/hive` and :doc:`/connector/memory` connectors.\n * Push down of dynamic filters into local table scan on worker nodes is limited to broadcast joins.\n * Min-max dynamic filter collection is not supported for DOUBLE, REAL and unorderable data types.\n+* Dynamic filtering is supported in limited scenarios when join keys are of different types.", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA5Njg4OA==", "url": "https://github.com/trinodb/trino/pull/5707#discussion_r516096888", "bodyText": "updated", "author": "raunaqmorarka", "createdAt": "2020-11-02T16:31:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTg2ODk1OQ=="}], "type": "inlineReview"}, {"oid": "88c583664ecd3b02ef032b02eea1bf47a674a047", "url": "https://github.com/trinodb/trino/commit/88c583664ecd3b02ef032b02eea1bf47a674a047", "message": "Update documentation for dynamic bucket pruning", "committedDate": "2020-11-02T16:13:10Z", "type": "commit"}, {"oid": "c28c4cc892136215779daa388327de9f06d42372", "url": "https://github.com/trinodb/trino/commit/c28c4cc892136215779daa388327de9f06d42372", "message": "Add documentation for dynamic filters coercion", "committedDate": "2020-11-02T16:31:27Z", "type": "commit"}, {"oid": "c28c4cc892136215779daa388327de9f06d42372", "url": "https://github.com/trinodb/trino/commit/c28c4cc892136215779daa388327de9f06d42372", "message": "Add documentation for dynamic filters coercion", "committedDate": "2020-11-02T16:31:27Z", "type": "forcePushed"}]}