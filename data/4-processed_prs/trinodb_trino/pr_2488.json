{"pr_number": 2488, "pr_title": "Information schema fixups", "pr_createdAt": "2020-01-13T13:03:16Z", "pr_url": "https://github.com/trinodb/trino/pull/2488", "timeline": [{"oid": "331e1fec81700272848bef44c175cb5fd5712103", "url": "https://github.com/trinodb/trino/commit/331e1fec81700272848bef44c175cb5fd5712103", "message": "Remove unused variable", "committedDate": "2020-01-13T11:43:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTg0MTc4NQ==", "url": "https://github.com/trinodb/trino/pull/2488#discussion_r365841785", "bodyText": "can we simply log informationSchemaTableHandle?", "author": "kokosing", "createdAt": "2020-01-13T14:45:27Z", "path": "presto-main/src/main/java/io/prestosql/connector/informationschema/InformationSchemaPageSourceProvider.java", "diffHunk": "@@ -48,6 +51,15 @@ public ConnectorPageSource createPageSource(\n             ConnectorTableHandle tableHandle,\n             List<ColumnHandle> columns)\n     {\n+        InformationSchemaTableHandle informationSchemaTableHandle = (InformationSchemaTableHandle) tableHandle;\n+        log.debug(\n+                \"Building information schema table (queryId=%s; catalog=%s; table=%s; prefixes=%s, limit=%s)\",\n+                session.getQueryId(),\n+                informationSchemaTableHandle.getCatalogName(),", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTg0MjA5Mw==", "url": "https://github.com/trinodb/trino/pull/2488#discussion_r365842093", "bodyText": "cmt msg:\nAdd logging...\n\n?", "author": "kokosing", "createdAt": "2020-01-13T14:46:00Z", "path": "presto-main/src/main/java/io/prestosql/connector/informationschema/InformationSchemaPageSourceProvider.java", "diffHunk": "@@ -13,6 +13,7 @@\n  */", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjMwMTgzMw==", "url": "https://github.com/trinodb/trino/pull/2488#discussion_r366301833", "bodyText": "It was removed previously", "author": "sopel39", "createdAt": "2020-01-14T12:06:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTg0MjA5Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTg0NTY4NQ==", "url": "https://github.com/trinodb/trino/pull/2488#discussion_r365845685", "bodyText": "undo", "author": "kokosing", "createdAt": "2020-01-13T14:52:25Z", "path": "presto-main/src/main/java/io/prestosql/connector/informationschema/InformationSchemaPageSource.java", "diffHunk": "@@ -111,6 +116,7 @@ public InformationSchemaPageSource(\n             else {\n                 checkArgument(prefixes.equals(defaultPrefixes(catalogName)), \"Catalog-wise tables have prefixes other than the default one\");\n             }\n+", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjE1OTkwNw==", "url": "https://github.com/trinodb/trino/pull/2488#discussion_r366159907", "bodyText": "Listing schemas explicitly here also helps return results to client sooner. And with respect to Hive Connector, it doesn't really increase the number of metadata calls to HMS. Having said that, I think it's fine to make the change as it may help in case of other connectors.", "author": "lxynov", "createdAt": "2020-01-14T05:39:47Z", "path": "presto-main/src/main/java/io/prestosql/connector/informationschema/InformationSchemaPageSource.java", "diffHunk": "@@ -101,6 +101,11 @@ public InformationSchemaPageSource(\n         table = tableHandle.getTable();\n         prefixIterator = Suppliers.memoize(() -> {\n             Set<QualifiedTablePrefix> prefixes = tableHandle.getPrefixes();\n+            if (!tableHandle.getLimit().isPresent()) {\n+                // no limit is used, therefore it doesn't make sense to split information schema query into smaller ones", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjI5MTM4OA==", "url": "https://github.com/trinodb/trino/pull/2488#discussion_r366291388", "bodyText": "And with respect to Hive Connector, it doesn't really increase the number of metadata calls to HMS. Having said that, I think it's fine to make the change as it may help in case of other connectors.\n\nJDBC connectors can take advantage of single query. For example, they can query their own information_schema, so instead of X requests you get one", "author": "sopel39", "createdAt": "2020-01-14T11:40:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjE1OTkwNw=="}], "type": "inlineReview"}, {"oid": "31dd7a45f88aa0be0a05d56ebb977b1198c345ee", "url": "https://github.com/trinodb/trino/commit/31dd7a45f88aa0be0a05d56ebb977b1198c345ee", "message": "Improve InformationSchemaTableHandle#toString", "committedDate": "2020-01-14T12:04:51Z", "type": "commit"}, {"oid": "4f1d79be63737bc89ad7153c43a78f38e9b1ee64", "url": "https://github.com/trinodb/trino/commit/4f1d79be63737bc89ad7153c43a78f38e9b1ee64", "message": "Mock connector should not return information schema tables", "committedDate": "2020-01-14T12:04:51Z", "type": "commit"}, {"oid": "52c5bac4a861d497518b4c1532cbd8a0cf92c8f4", "url": "https://github.com/trinodb/trino/commit/52c5bac4a861d497518b4c1532cbd8a0cf92c8f4", "message": "Restore prefix logging", "committedDate": "2020-01-14T12:04:51Z", "type": "commit"}, {"oid": "3958333fdb318552ec0d5a19bd52569e9465043a", "url": "https://github.com/trinodb/trino/commit/3958333fdb318552ec0d5a19bd52569e9465043a", "message": "Do not list schemas explicitly when limit is not set\n\nWhen limit is not used, then listing schemas explicitly\ncauses additional connector metadata queries. However,\nsince all metadata rows need to be read, it doesn't make\nsense to do so.", "committedDate": "2020-01-14T12:06:09Z", "type": "commit"}, {"oid": "3958333fdb318552ec0d5a19bd52569e9465043a", "url": "https://github.com/trinodb/trino/commit/3958333fdb318552ec0d5a19bd52569e9465043a", "message": "Do not list schemas explicitly when limit is not set\n\nWhen limit is not used, then listing schemas explicitly\ncauses additional connector metadata queries. However,\nsince all metadata rows need to be read, it doesn't make\nsense to do so.", "committedDate": "2020-01-14T12:06:09Z", "type": "forcePushed"}]}