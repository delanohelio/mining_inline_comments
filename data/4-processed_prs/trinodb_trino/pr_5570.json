{"pr_number": 5570, "pr_title": "Improve error message when wrong ACID schema", "pr_createdAt": "2020-10-16T10:13:58Z", "pr_url": "https://github.com/trinodb/trino/pull/5570", "timeline": [{"oid": "faeaf786d5b561dcc02ede9893158885adcd7a81", "url": "https://github.com/trinodb/trino/commit/faeaf786d5b561dcc02ede9893158885adcd7a81", "message": "Improve error message when wrong ACID schema", "committedDate": "2020-10-16T10:13:46Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjUyMzg1NA==", "url": "https://github.com/trinodb/trino/pull/5570#discussion_r506523854", "bodyText": "The only concern I have about this one is if we cannot maybe leak some information, we should not, to user by making this message such verbose.", "author": "losipiuk", "createdAt": "2020-10-16T15:05:20Z", "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/orc/OrcPageSourceFactory.java", "diffHunk": "@@ -419,8 +420,17 @@ private static void verifyFileHasColumnNames(List<OrcColumn> columns, Path path)\n     static void verifyAcidSchema(OrcReader orcReader, Path path)\n     {\n         OrcColumn rootColumn = orcReader.getRootColumn();\n-        if (rootColumn.getNestedColumns().size() != 6) {\n-            throw new PrestoException(HIVE_BAD_DATA, \"ORC ACID file should have 6 columns: \" + path);\n+        List<OrcColumn> nestedColumns = rootColumn.getNestedColumns();\n+        if (nestedColumns.size() != 6) {\n+            throw new PrestoException(\n+                    HIVE_BAD_DATA,\n+                    format(\n+                            \"ORC ACID file should have 6 columns, found %s %s in %s\",\n+                            nestedColumns.size(),\n+                            nestedColumns.stream()\n+                                    .map(column -> format(\"%s (%s)\", column.getColumnName(), column.getColumnType()))", "originalCommit": "faeaf786d5b561dcc02ede9893158885adcd7a81", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzYyNTc5Ng==", "url": "https://github.com/trinodb/trino/pull/5570#discussion_r507625796", "bodyText": "Why not to log on debug additional information?", "author": "kokosing", "createdAt": "2020-10-19T10:04:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjUyMzg1NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzY3NTgxNQ==", "url": "https://github.com/trinodb/trino/pull/5570#discussion_r507675815", "bodyText": "Because it will make the additional information hard to access.", "author": "findepi", "createdAt": "2020-10-19T11:35:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjUyMzg1NA=="}], "type": "inlineReview"}]}