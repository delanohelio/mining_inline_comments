{"pr_number": 2427, "pr_title": "Allow to convert to varchar an unsupported type in Phoenix", "pr_createdAt": "2020-01-07T09:31:50Z", "pr_url": "https://github.com/trinodb/trino/pull/2427", "timeline": [{"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDAzNDczOQ==", "url": "https://github.com/trinodb/trino/pull/2427#discussion_r364034739", "bodyText": "We should remove setUnsupportedTypeHandling instead of setJdbcTypesMappedToVarchar", "author": "ebyhr", "createdAt": "2020-01-08T01:55:37Z", "path": "presto-base-jdbc/src/test/java/io/prestosql/plugin/jdbc/TestBaseJdbcConfig.java", "diffHunk": "@@ -36,7 +36,6 @@ public void testDefaults()\n                 .setConnectionUrl(null)\n                 .setCaseInsensitiveNameMatching(false)\n                 .setCaseInsensitiveNameMatchingCacheTtl(new Duration(1, MINUTES))\n-                .setJdbcTypesMappedToVarchar(null)\n                 .setUnsupportedTypeHandling(UnsupportedTypeHandling.IGNORE)", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDAzNTUwMQ==", "url": "https://github.com/trinodb/trino/pull/2427#discussion_r364035501", "bodyText": "Revert (other properties have @ConfigDescription)\nAlso, we can remove unused unsupportedTypeHandling variable.", "author": "ebyhr", "createdAt": "2020-01-08T01:59:44Z", "path": "presto-base-jdbc/src/main/java/io/prestosql/plugin/jdbc/BaseJdbcConfig.java", "diffHunk": "@@ -16,7 +16,6 @@\n import com.google.common.base.Splitter;\n import com.google.common.collect.ImmutableSet;\n import io.airlift.configuration.Config;\n-import io.airlift.configuration.ConfigDescription;", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDAzOTE0OA==", "url": "https://github.com/trinodb/trino/pull/2427#discussion_r364039148", "bodyText": "PostgreSqlClient also has the same logic.", "author": "ebyhr", "createdAt": "2020-01-08T02:19:17Z", "path": "presto-base-jdbc/src/main/java/io/prestosql/plugin/jdbc/BaseJdbcClient.java", "diffHunk": "@@ -272,7 +272,10 @@ public BaseJdbcClient(\n                             .setComment(comment)\n                             .build());\n                 }\n-                verify(columnMapping.isPresent() || getUnsupportedTypeHandling(session) == IGNORE, \"Unsupported type handling is set to %s, but toPrestoType() returned empty\");", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDAzOTU3MQ==", "url": "https://github.com/trinodb/trino/pull/2427#discussion_r364039571", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    executeInPhoenix(\"DROP TABLE tpch.test_timestamp\");\n          \n          \n            \n                    assertUpdate(\"DROP TABLE test_timestamp\");", "author": "ebyhr", "createdAt": "2020-01-08T02:21:31Z", "path": "presto-phoenix/src/test/java/io/prestosql/plugin/phoenix/TestPhoenixIntegrationSmokeTest.java", "diffHunk": "@@ -73,6 +76,36 @@ public void testMultipleSomeColumnsRangesPredicate()\n         assertQuery(\"SELECT orderkey, shippriority, clerk, totalprice, custkey FROM orders WHERE orderkey BETWEEN 10 AND 50 OR orderkey BETWEEN 100 AND 150\");\n     }\n \n+    @Test\n+    public void testUnsupportedType()\n+            throws Exception\n+    {\n+        executeInPhoenix(\"CREATE TABLE tpch.test_timestamp (pk bigint primary key, val1 timestamp)\");\n+        executeInPhoenix(\"UPSERT INTO tpch.test_timestamp (pk, val1) VALUES (1, null)\");\n+        executeInPhoenix(\"UPSERT INTO tpch.test_timestamp (pk, val1) VALUES (2, '2002-05-30T09:30:10.5')\");\n+        assertUpdate(\"INSERT INTO test_timestamp VALUES (3)\", 1);\n+        assertQuery(\"SELECT * FROM test_timestamp\", \"VALUES 1, 2, 3\");\n+        assertQuery(\n+                withUnsupportedType(CONVERT_TO_VARCHAR),\n+                \"SELECT * FROM test_timestamp\",\n+                \"VALUES \" +\n+                        \"(1, null), \" +\n+                        \"(2, '2002-05-30 09:30:10.500'), \" +\n+                        \"(3, null)\");\n+        assertQueryFails(\n+                withUnsupportedType(CONVERT_TO_VARCHAR),\n+                \"INSERT INTO test_timestamp VALUES (4, '2002-05-30 09:30:10.500')\",\n+                \"Underlying type that is mapped to VARCHAR is not supported for INSERT: TIMESTAMP\");\n+        executeInPhoenix(\"DROP TABLE tpch.test_timestamp\");", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": "955bbdffd66f822726ce3e6fd214ab354084db99", "url": "https://github.com/trinodb/trino/commit/955bbdffd66f822726ce3e6fd214ab354084db99", "message": "Remove extra annotations", "committedDate": "2020-01-08T12:14:29Z", "type": "commit"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": "94a535ecc59ee65247e3f669519260715e5a9167", "url": "https://github.com/trinodb/trino/commit/94a535ecc59ee65247e3f669519260715e5a9167", "message": "Extract TypeHandlingJdbcConfig from BaseJdbcConfig", "committedDate": "2020-01-08T13:53:44Z", "type": "commit"}, {"oid": "cc803d1395f0889e351f47402f41ca9293d43ff8", "url": "https://github.com/trinodb/trino/commit/cc803d1395f0889e351f47402f41ca9293d43ff8", "message": "Rename BaseJdbcPropertiesProvider to TypeHandlingJdbcPropertiesProvider", "committedDate": "2020-01-08T13:53:44Z", "type": "commit"}, {"oid": "3213d094461a450ff99e2fc601588864e12698de", "url": "https://github.com/trinodb/trino/commit/3213d094461a450ff99e2fc601588864e12698de", "message": "Fix error message\n\nSessions properties are registered per catalog (an instance of\nconnector).", "committedDate": "2020-01-08T13:53:44Z", "type": "commit"}, {"oid": "614ab80ce63f75d70c6dca89cb310f74aea3d12a", "url": "https://github.com/trinodb/trino/commit/614ab80ce63f75d70c6dca89cb310f74aea3d12a", "message": "Remove unused variable", "committedDate": "2020-01-08T13:53:44Z", "type": "commit"}, {"oid": "a6f310505edf9aa23eec5cf658e6b9dcd9f3cba9", "url": "https://github.com/trinodb/trino/commit/a6f310505edf9aa23eec5cf658e6b9dcd9f3cba9", "message": "Remove unused class", "committedDate": "2020-01-08T13:53:44Z", "type": "commit"}, {"oid": "adc2e4070f92be0a54fc2fb4bd00c62ec213f19d", "url": "https://github.com/trinodb/trino/commit/adc2e4070f92be0a54fc2fb4bd00c62ec213f19d", "message": "Add missing argument to an verify message", "committedDate": "2020-01-08T13:53:45Z", "type": "commit"}, {"oid": "a374cf7044cac87bd04b164c9cc6fc86e620c95b", "url": "https://github.com/trinodb/trino/commit/a374cf7044cac87bd04b164c9cc6fc86e620c95b", "message": "Break switch instead of copying code", "committedDate": "2020-01-08T13:53:45Z", "type": "commit"}, {"oid": "c49faf8a12765a259638f9f16922dd3878da1db7", "url": "https://github.com/trinodb/trino/commit/c49faf8a12765a259638f9f16922dd3878da1db7", "message": "Allow to convert to varchar an unsupported type in Phoenix", "committedDate": "2020-01-08T13:53:45Z", "type": "commit"}, {"oid": "c49faf8a12765a259638f9f16922dd3878da1db7", "url": "https://github.com/trinodb/trino/commit/c49faf8a12765a259638f9f16922dd3878da1db7", "message": "Allow to convert to varchar an unsupported type in Phoenix", "committedDate": "2020-01-08T13:53:45Z", "type": "forcePushed"}]}