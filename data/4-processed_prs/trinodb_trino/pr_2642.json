{"pr_number": 2642, "pr_title": "Refactor of deprecated DataSize methods", "pr_createdAt": "2020-01-27T16:54:27Z", "pr_url": "https://github.com/trinodb/trino/pull/2642", "timeline": [{"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDk5NDYwMg==", "url": "https://github.com/trinodb/trino/pull/2642#discussion_r374994602", "bodyText": "Let's put the rounding in the caller. I'd prefer to keep this returning double.", "author": "electrum", "createdAt": "2020-02-05T00:07:34Z", "path": "presto-benchmark/src/main/java/io/prestosql/benchmark/AverageBenchmarkResults.java", "diffHunk": "@@ -44,9 +44,9 @@ public BenchmarkResultHook addResults(Map<String, Long> results)\n         return this;\n     }\n \n-    public Map<String, Double> getAverageResultsValues()\n+    public Map<String, Long> getAverageResultsValues()\n     {\n-        return Maps.transformValues(resultsSum, input -> 1.0 * input / resultsCount);\n+        return Maps.transformValues(resultsSum, input -> Math.round(((double) input) / resultsCount));", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDk5NTM3OQ==", "url": "https://github.com/trinodb/trino/pull/2642#discussion_r374995379", "bodyText": "This needs to stay as a double so that the NaN / infinity check below works (or restructure the code to account for the cases where divisor and possibly dividend is zero).", "author": "electrum", "createdAt": "2020-02-05T00:10:51Z", "path": "presto-cli/src/main/java/io/prestosql/cli/FormatUtils.java", "diffHunk": "@@ -114,7 +114,7 @@ else if (longForm) {\n \n     public static String formatDataRate(DataSize dataSize, Duration duration, boolean longForm)\n     {\n-        double rate = dataSize.toBytes() / duration.getValue(SECONDS);\n+        long rate = Math.round(dataSize.toBytes() / duration.getValue(SECONDS));", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTAwMjUzMg==", "url": "https://github.com/trinodb/trino/pull/2642#discussion_r375002532", "bodyText": "Add a -- before \"note\" to separate the two sentences", "author": "electrum", "createdAt": "2020-02-05T00:37:48Z", "path": "src/modernizer/violations.xml", "diffHunk": "@@ -59,4 +59,46 @@\n         <version>1.6</version>\n         <comment>Prefer OGCGeometry.Equals(OGCGeometry)</comment>\n     </violation>\n+\n+    <violation>\n+        <name>io/airlift/units/DataSize.\"&lt;init&gt;\":(DLio/airlift/units/DataSize$Unit;)V</name>\n+        <version>1.8</version>\n+        <comment>Use io.airlift.units.DataSize.of(long, DataSize.Unit)</comment>\n+    </violation>\n+\n+    <violation>\n+        <name>io/airlift/units/DataSize.succinctDataSize:(DLio/airlift/units/DataSize$Unit;)Lio/airlift/units/DataSize;</name>\n+        <version>1.8</version>\n+        <comment>Use io.airlift.units.DataSize.of(long, DataSize.Unit).succinct() Note that succinct conversion only affects toString() results</comment>", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": "1d730f6e99048a0e9509f59e5e4b260d1eeac685", "url": "https://github.com/trinodb/trino/commit/1d730f6e99048a0e9509f59e5e4b260d1eeac685", "message": "Edge case refactor of deprecated DataSize methods", "committedDate": "2020-02-05T22:58:35Z", "type": "commit"}, {"oid": "491b9b0f223ca0b13ae67903f258ac31e42661db", "url": "https://github.com/trinodb/trino/commit/491b9b0f223ca0b13ae67903f258ac31e42661db", "message": "Automated refactor of deprecated DataSize methods", "committedDate": "2020-02-05T22:58:36Z", "type": "commit"}, {"oid": "491b9b0f223ca0b13ae67903f258ac31e42661db", "url": "https://github.com/trinodb/trino/commit/491b9b0f223ca0b13ae67903f258ac31e42661db", "message": "Automated refactor of deprecated DataSize methods", "committedDate": "2020-02-05T22:58:36Z", "type": "forcePushed"}]}