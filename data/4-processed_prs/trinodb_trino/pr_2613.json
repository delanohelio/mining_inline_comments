{"pr_number": 2613, "pr_title": "Convert multinode-tls-* to Launcher", "pr_createdAt": "2020-01-24T11:22:34Z", "pr_url": "https://github.com/trinodb/trino/pull/2613", "timeline": [{"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDk0ODc1MA==", "url": "https://github.com/trinodb/trino/pull/2613#discussion_r370948750", "bodyText": "Not specific to this PR, but this pattern is strange. Why do we call an empty super method in the abstract parent class (which is designed for subclasses to implement)?", "author": "electrum", "createdAt": "2020-01-25T18:39:57Z", "path": "presto-product-tests-launcher/src/main/java/io/prestosql/tests/product/launcher/env/environment/MultinodeTlsKerberos.java", "diffHunk": "@@ -0,0 +1,101 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.prestosql.tests.product.launcher.env.environment;\n+\n+import com.google.common.collect.ImmutableList;\n+import io.prestosql.tests.product.launcher.PathResolver;\n+import io.prestosql.tests.product.launcher.docker.DockerFiles;\n+import io.prestosql.tests.product.launcher.env.DockerContainer;\n+import io.prestosql.tests.product.launcher.env.Environment;\n+import io.prestosql.tests.product.launcher.env.EnvironmentOptions;\n+import io.prestosql.tests.product.launcher.env.common.AbstractEnvironmentProvider;\n+import io.prestosql.tests.product.launcher.env.common.Hadoop;\n+import io.prestosql.tests.product.launcher.env.common.Kerberos;\n+import io.prestosql.tests.product.launcher.env.common.Standard;\n+import org.testcontainers.containers.startupcheck.IsRunningStartupCheckStrategy;\n+import org.testcontainers.containers.wait.strategy.Wait;\n+\n+import javax.inject.Inject;\n+\n+import java.io.File;\n+import java.time.Duration;\n+import java.util.Objects;\n+\n+import static com.google.common.base.Verify.verify;\n+import static io.prestosql.tests.product.launcher.env.common.Hadoop.CONTAINER_PRESTO_HIVE_PROPERTIES;\n+import static io.prestosql.tests.product.launcher.env.common.Standard.CONTAINER_PRESTO_CONFIG_PROPERTIES;\n+import static java.util.Objects.requireNonNull;\n+import static org.testcontainers.containers.BindMode.READ_ONLY;\n+\n+public class MultinodeTlsKerberos\n+        extends AbstractEnvironmentProvider\n+{\n+    private final PathResolver pathResolver;\n+    private final DockerFiles dockerFiles;\n+\n+    private final String prestoDockerImageName;\n+    private final File serverPackage;\n+\n+    @Inject\n+    public MultinodeTlsKerberos(\n+            PathResolver pathResolver,\n+            DockerFiles dockerFiles,\n+            Standard standard,\n+            Hadoop hadoop,\n+            Kerberos kerberos,\n+            EnvironmentOptions environmentOptions)\n+    {\n+        super(ImmutableList.of(standard, hadoop, kerberos));\n+        this.pathResolver = requireNonNull(pathResolver, \"pathResolver is null\");\n+        this.dockerFiles = requireNonNull(dockerFiles, \"dockerFiles is null\");\n+        String hadoopBaseImage = requireNonNull(environmentOptions.hadoopBaseImage, \"environmentOptions.hadoopBaseImage is null\");\n+        String imagesVersion = requireNonNull(environmentOptions.imagesVersion, \"environmentOptions.imagesVersion is null\");\n+        prestoDockerImageName = hadoopBaseImage + \"-kerberized:\" + imagesVersion;\n+        serverPackage = requireNonNull(environmentOptions.serverPackage, \"environmentOptions.serverPackage is null\");\n+    }\n+\n+    @Override\n+    @SuppressWarnings(\"resource\")\n+    protected void extendEnvironment(Environment.Builder builder)\n+    {\n+        super.extendEnvironment(builder);", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDk1ODYwNA==", "url": "https://github.com/trinodb/trino/pull/2613#discussion_r370958604", "bodyText": "right. Let's fix them everywhere consistently", "author": "findepi", "createdAt": "2020-01-25T21:56:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDk0ODc1MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDk1OTQwOQ==", "url": "https://github.com/trinodb/trino/pull/2613#discussion_r370959409", "bodyText": "Done", "author": "findepi", "createdAt": "2020-01-25T22:15:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDk0ODc1MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDk0ODgyMA==", "url": "https://github.com/trinodb/trino/pull/2613#discussion_r370948820", "bodyText": "Use prestoDockerImageName.equals(...) since we know this isn't null. (otherwise the reader wonders why it is done this way)", "author": "electrum", "createdAt": "2020-01-25T18:40:53Z", "path": "presto-product-tests-launcher/src/main/java/io/prestosql/tests/product/launcher/env/environment/MultinodeTlsKerberos.java", "diffHunk": "@@ -0,0 +1,101 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.prestosql.tests.product.launcher.env.environment;\n+\n+import com.google.common.collect.ImmutableList;\n+import io.prestosql.tests.product.launcher.PathResolver;\n+import io.prestosql.tests.product.launcher.docker.DockerFiles;\n+import io.prestosql.tests.product.launcher.env.DockerContainer;\n+import io.prestosql.tests.product.launcher.env.Environment;\n+import io.prestosql.tests.product.launcher.env.EnvironmentOptions;\n+import io.prestosql.tests.product.launcher.env.common.AbstractEnvironmentProvider;\n+import io.prestosql.tests.product.launcher.env.common.Hadoop;\n+import io.prestosql.tests.product.launcher.env.common.Kerberos;\n+import io.prestosql.tests.product.launcher.env.common.Standard;\n+import org.testcontainers.containers.startupcheck.IsRunningStartupCheckStrategy;\n+import org.testcontainers.containers.wait.strategy.Wait;\n+\n+import javax.inject.Inject;\n+\n+import java.io.File;\n+import java.time.Duration;\n+import java.util.Objects;\n+\n+import static com.google.common.base.Verify.verify;\n+import static io.prestosql.tests.product.launcher.env.common.Hadoop.CONTAINER_PRESTO_HIVE_PROPERTIES;\n+import static io.prestosql.tests.product.launcher.env.common.Standard.CONTAINER_PRESTO_CONFIG_PROPERTIES;\n+import static java.util.Objects.requireNonNull;\n+import static org.testcontainers.containers.BindMode.READ_ONLY;\n+\n+public class MultinodeTlsKerberos\n+        extends AbstractEnvironmentProvider\n+{\n+    private final PathResolver pathResolver;\n+    private final DockerFiles dockerFiles;\n+\n+    private final String prestoDockerImageName;\n+    private final File serverPackage;\n+\n+    @Inject\n+    public MultinodeTlsKerberos(\n+            PathResolver pathResolver,\n+            DockerFiles dockerFiles,\n+            Standard standard,\n+            Hadoop hadoop,\n+            Kerberos kerberos,\n+            EnvironmentOptions environmentOptions)\n+    {\n+        super(ImmutableList.of(standard, hadoop, kerberos));\n+        this.pathResolver = requireNonNull(pathResolver, \"pathResolver is null\");\n+        this.dockerFiles = requireNonNull(dockerFiles, \"dockerFiles is null\");\n+        String hadoopBaseImage = requireNonNull(environmentOptions.hadoopBaseImage, \"environmentOptions.hadoopBaseImage is null\");\n+        String imagesVersion = requireNonNull(environmentOptions.imagesVersion, \"environmentOptions.imagesVersion is null\");\n+        prestoDockerImageName = hadoopBaseImage + \"-kerberized:\" + imagesVersion;\n+        serverPackage = requireNonNull(environmentOptions.serverPackage, \"environmentOptions.serverPackage is null\");\n+    }\n+\n+    @Override\n+    @SuppressWarnings(\"resource\")\n+    protected void extendEnvironment(Environment.Builder builder)\n+    {\n+        super.extendEnvironment(builder);\n+\n+        builder.configureContainer(\"presto-master\", container -> {\n+            verify(Objects.equals(container.getDockerImageName(), prestoDockerImageName), \"Expected image '%s', but is '%s'\", prestoDockerImageName, container.getDockerImageName());", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDk0ODkyNA==", "url": "https://github.com/trinodb/trino/pull/2613#discussion_r370948924", "bodyText": "Also, why do we need this check? I don't see it in the others", "author": "electrum", "createdAt": "2020-01-25T18:42:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDk0ODgyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDk1ODY0Ng==", "url": "https://github.com/trinodb/trino/pull/2613#discussion_r370958646", "bodyText": "I use Objects.equals for its symmetry, not because prestoDockerImageName may be null", "author": "findepi", "createdAt": "2020-01-25T21:57:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDk0ODgyMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDk0ODk5Ng==", "url": "https://github.com/trinodb/trino/pull/2613#discussion_r370948996", "bodyText": "Should this be final? Most implementations are", "author": "electrum", "createdAt": "2020-01-25T18:43:40Z", "path": "presto-product-tests-launcher/src/main/java/io/prestosql/tests/product/launcher/env/environment/MultinodeTlsKerberos.java", "diffHunk": "@@ -0,0 +1,101 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.prestosql.tests.product.launcher.env.environment;\n+\n+import com.google.common.collect.ImmutableList;\n+import io.prestosql.tests.product.launcher.PathResolver;\n+import io.prestosql.tests.product.launcher.docker.DockerFiles;\n+import io.prestosql.tests.product.launcher.env.DockerContainer;\n+import io.prestosql.tests.product.launcher.env.Environment;\n+import io.prestosql.tests.product.launcher.env.EnvironmentOptions;\n+import io.prestosql.tests.product.launcher.env.common.AbstractEnvironmentProvider;\n+import io.prestosql.tests.product.launcher.env.common.Hadoop;\n+import io.prestosql.tests.product.launcher.env.common.Kerberos;\n+import io.prestosql.tests.product.launcher.env.common.Standard;\n+import org.testcontainers.containers.startupcheck.IsRunningStartupCheckStrategy;\n+import org.testcontainers.containers.wait.strategy.Wait;\n+\n+import javax.inject.Inject;\n+\n+import java.io.File;\n+import java.time.Duration;\n+import java.util.Objects;\n+\n+import static com.google.common.base.Verify.verify;\n+import static io.prestosql.tests.product.launcher.env.common.Hadoop.CONTAINER_PRESTO_HIVE_PROPERTIES;\n+import static io.prestosql.tests.product.launcher.env.common.Standard.CONTAINER_PRESTO_CONFIG_PROPERTIES;\n+import static java.util.Objects.requireNonNull;\n+import static org.testcontainers.containers.BindMode.READ_ONLY;\n+\n+public class MultinodeTlsKerberos", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDk1ODY2NA==", "url": "https://github.com/trinodb/trino/pull/2613#discussion_r370958664", "bodyText": "Will make it final.", "author": "findepi", "createdAt": "2020-01-25T21:58:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDk0ODk5Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDk0OTEwMw==", "url": "https://github.com/trinodb/trino/pull/2613#discussion_r370949103", "bodyText": "It'd be helpful to extract a constant for the config prefix (perhaps clean this up separately in all of the launchers)", "author": "electrum", "createdAt": "2020-01-25T18:45:50Z", "path": "presto-product-tests-launcher/src/main/java/io/prestosql/tests/product/launcher/env/environment/MultinodeTlsKerberos.java", "diffHunk": "@@ -0,0 +1,101 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.prestosql.tests.product.launcher.env.environment;\n+\n+import com.google.common.collect.ImmutableList;\n+import io.prestosql.tests.product.launcher.PathResolver;\n+import io.prestosql.tests.product.launcher.docker.DockerFiles;\n+import io.prestosql.tests.product.launcher.env.DockerContainer;\n+import io.prestosql.tests.product.launcher.env.Environment;\n+import io.prestosql.tests.product.launcher.env.EnvironmentOptions;\n+import io.prestosql.tests.product.launcher.env.common.AbstractEnvironmentProvider;\n+import io.prestosql.tests.product.launcher.env.common.Hadoop;\n+import io.prestosql.tests.product.launcher.env.common.Kerberos;\n+import io.prestosql.tests.product.launcher.env.common.Standard;\n+import org.testcontainers.containers.startupcheck.IsRunningStartupCheckStrategy;\n+import org.testcontainers.containers.wait.strategy.Wait;\n+\n+import javax.inject.Inject;\n+\n+import java.io.File;\n+import java.time.Duration;\n+import java.util.Objects;\n+\n+import static com.google.common.base.Verify.verify;\n+import static io.prestosql.tests.product.launcher.env.common.Hadoop.CONTAINER_PRESTO_HIVE_PROPERTIES;\n+import static io.prestosql.tests.product.launcher.env.common.Standard.CONTAINER_PRESTO_CONFIG_PROPERTIES;\n+import static java.util.Objects.requireNonNull;\n+import static org.testcontainers.containers.BindMode.READ_ONLY;\n+\n+public class MultinodeTlsKerberos\n+        extends AbstractEnvironmentProvider\n+{\n+    private final PathResolver pathResolver;\n+    private final DockerFiles dockerFiles;\n+\n+    private final String prestoDockerImageName;\n+    private final File serverPackage;\n+\n+    @Inject\n+    public MultinodeTlsKerberos(\n+            PathResolver pathResolver,\n+            DockerFiles dockerFiles,\n+            Standard standard,\n+            Hadoop hadoop,\n+            Kerberos kerberos,\n+            EnvironmentOptions environmentOptions)\n+    {\n+        super(ImmutableList.of(standard, hadoop, kerberos));\n+        this.pathResolver = requireNonNull(pathResolver, \"pathResolver is null\");\n+        this.dockerFiles = requireNonNull(dockerFiles, \"dockerFiles is null\");\n+        String hadoopBaseImage = requireNonNull(environmentOptions.hadoopBaseImage, \"environmentOptions.hadoopBaseImage is null\");\n+        String imagesVersion = requireNonNull(environmentOptions.imagesVersion, \"environmentOptions.imagesVersion is null\");\n+        prestoDockerImageName = hadoopBaseImage + \"-kerberized:\" + imagesVersion;\n+        serverPackage = requireNonNull(environmentOptions.serverPackage, \"environmentOptions.serverPackage is null\");\n+    }\n+\n+    @Override\n+    @SuppressWarnings(\"resource\")\n+    protected void extendEnvironment(Environment.Builder builder)\n+    {\n+        super.extendEnvironment(builder);\n+\n+        builder.configureContainer(\"presto-master\", container -> {\n+            verify(Objects.equals(container.getDockerImageName(), prestoDockerImageName), \"Expected image '%s', but is '%s'\", prestoDockerImageName, container.getDockerImageName());\n+            container\n+                    .withFileSystemBind(dockerFiles.getDockerFilesHostPath(\"conf/environment/multinode-tls-kerberos/config-master.properties\"), CONTAINER_PRESTO_CONFIG_PROPERTIES, READ_ONLY)", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDk1ODg3MQ==", "url": "https://github.com/trinodb/trino/pull/2613#discussion_r370958871", "bodyText": "i am not totally sure. a constant would make paths less searchable\nalso, we can easily use constants for loading resources from host into docker\nbut we can't use constants withing dockerized scripts; so this makes the situation assymetric\ni am not confident which direction is the best yet", "author": "findepi", "createdAt": "2020-01-25T22:02:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDk0OTEwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDk2MDI5MQ==", "url": "https://github.com/trinodb/trino/pull/2613#discussion_r370960291", "bodyText": "I was thinking to remove the duplication of conf/environment/multinode-tls-kerberos within this file.", "author": "electrum", "createdAt": "2020-01-25T22:36:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDk0OTEwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDk2MDY1Mw==", "url": "https://github.com/trinodb/trino/pull/2613#discussion_r370960653", "bodyText": "that's how i undestand this. but then, if someone wants to find where is config-master.properties referenced... it's ambiguous (several files of this name). and if they search w/ path suffix, they will find none.\nthat's just a downside. upside is less repetition, i admit\ni choose to keep it for now.", "author": "findepi", "createdAt": "2020-01-25T22:45:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDk0OTEwMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDk0OTE4MQ==", "url": "https://github.com/trinodb/trino/pull/2613#discussion_r370949181", "bodyText": "Maybe add a shared helper for this", "author": "electrum", "createdAt": "2020-01-25T18:47:21Z", "path": "presto-product-tests-launcher/src/main/java/io/prestosql/tests/product/launcher/env/environment/MultinodeTlsKerberos.java", "diffHunk": "@@ -0,0 +1,101 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.prestosql.tests.product.launcher.env.environment;\n+\n+import com.google.common.collect.ImmutableList;\n+import io.prestosql.tests.product.launcher.PathResolver;\n+import io.prestosql.tests.product.launcher.docker.DockerFiles;\n+import io.prestosql.tests.product.launcher.env.DockerContainer;\n+import io.prestosql.tests.product.launcher.env.Environment;\n+import io.prestosql.tests.product.launcher.env.EnvironmentOptions;\n+import io.prestosql.tests.product.launcher.env.common.AbstractEnvironmentProvider;\n+import io.prestosql.tests.product.launcher.env.common.Hadoop;\n+import io.prestosql.tests.product.launcher.env.common.Kerberos;\n+import io.prestosql.tests.product.launcher.env.common.Standard;\n+import org.testcontainers.containers.startupcheck.IsRunningStartupCheckStrategy;\n+import org.testcontainers.containers.wait.strategy.Wait;\n+\n+import javax.inject.Inject;\n+\n+import java.io.File;\n+import java.time.Duration;\n+import java.util.Objects;\n+\n+import static com.google.common.base.Verify.verify;\n+import static io.prestosql.tests.product.launcher.env.common.Hadoop.CONTAINER_PRESTO_HIVE_PROPERTIES;\n+import static io.prestosql.tests.product.launcher.env.common.Standard.CONTAINER_PRESTO_CONFIG_PROPERTIES;\n+import static java.util.Objects.requireNonNull;\n+import static org.testcontainers.containers.BindMode.READ_ONLY;\n+\n+public class MultinodeTlsKerberos\n+        extends AbstractEnvironmentProvider\n+{\n+    private final PathResolver pathResolver;\n+    private final DockerFiles dockerFiles;\n+\n+    private final String prestoDockerImageName;\n+    private final File serverPackage;\n+\n+    @Inject\n+    public MultinodeTlsKerberos(\n+            PathResolver pathResolver,\n+            DockerFiles dockerFiles,\n+            Standard standard,\n+            Hadoop hadoop,\n+            Kerberos kerberos,\n+            EnvironmentOptions environmentOptions)\n+    {\n+        super(ImmutableList.of(standard, hadoop, kerberos));\n+        this.pathResolver = requireNonNull(pathResolver, \"pathResolver is null\");\n+        this.dockerFiles = requireNonNull(dockerFiles, \"dockerFiles is null\");\n+        String hadoopBaseImage = requireNonNull(environmentOptions.hadoopBaseImage, \"environmentOptions.hadoopBaseImage is null\");\n+        String imagesVersion = requireNonNull(environmentOptions.imagesVersion, \"environmentOptions.imagesVersion is null\");\n+        prestoDockerImageName = hadoopBaseImage + \"-kerberized:\" + imagesVersion;\n+        serverPackage = requireNonNull(environmentOptions.serverPackage, \"environmentOptions.serverPackage is null\");\n+    }\n+\n+    @Override\n+    @SuppressWarnings(\"resource\")\n+    protected void extendEnvironment(Environment.Builder builder)\n+    {\n+        super.extendEnvironment(builder);\n+\n+        builder.configureContainer(\"presto-master\", container -> {\n+            verify(Objects.equals(container.getDockerImageName(), prestoDockerImageName), \"Expected image '%s', but is '%s'\", prestoDockerImageName, container.getDockerImageName());\n+            container\n+                    .withFileSystemBind(dockerFiles.getDockerFilesHostPath(\"conf/environment/multinode-tls-kerberos/config-master.properties\"), CONTAINER_PRESTO_CONFIG_PROPERTIES, READ_ONLY)\n+                    .withFileSystemBind(dockerFiles.getDockerFilesHostPath(\"conf/environment/multinode-tls-kerberos/hive.properties\"), CONTAINER_PRESTO_HIVE_PROPERTIES, READ_ONLY);\n+        });\n+\n+        addPrestoWorker(builder, \"presto-worker-1\");\n+        addPrestoWorker(builder, \"presto-worker-2\");\n+    }\n+\n+    private void addPrestoWorker(Environment.Builder builder, String workerName)\n+    {\n+        DockerContainer container = new DockerContainer(prestoDockerImageName)\n+                .withCreateContainerCmdModifier(createContainerCmd -> createContainerCmd.withDomainName(\"docker.cluster\"))\n+                .withNetworkAliases(workerName + \".docker.cluster\")\n+                .withFileSystemBind(dockerFiles.getDockerFilesHostPath(), \"/docker/presto-product-tests\", READ_ONLY)\n+                .withFileSystemBind(pathResolver.resolvePlaceholders(serverPackage).toString(), \"/docker/presto-server.tar.gz\", READ_ONLY)\n+                .withFileSystemBind(dockerFiles.getDockerFilesHostPath(\"conf/environment/multinode-tls-kerberos/config-worker.properties\"), CONTAINER_PRESTO_CONFIG_PROPERTIES, READ_ONLY)\n+                .withFileSystemBind(dockerFiles.getDockerFilesHostPath(\"conf/environment/multinode-tls-kerberos/hive.properties\"), CONTAINER_PRESTO_HIVE_PROPERTIES, READ_ONLY)\n+                .withCommand(\"/docker/presto-product-tests/run-presto.sh\")\n+                .withStartupCheckStrategy(new IsRunningStartupCheckStrategy())\n+                .waitingFor(Wait.forLogMessage(\".*======== SERVER STARTED ========.*\", 1))", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDk1ODgwOA==", "url": "https://github.com/trinodb/trino/pull/2613#discussion_r370958808", "bodyText": "good idea. let's follow up", "author": "findepi", "createdAt": "2020-01-25T22:01:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDk0OTE4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDk2MDE1MA==", "url": "https://github.com/trinodb/trino/pull/2613#discussion_r370960150", "bodyText": "done", "author": "findepi", "createdAt": "2020-01-25T22:32:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDk0OTE4MQ=="}], "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": "b4a3a1e666f3999fa3f94bef6b2fef5e8015505b", "url": "https://github.com/trinodb/trino/commit/b4a3a1e666f3999fa3f94bef6b2fef5e8015505b", "message": "Remove redundant call to super", "committedDate": "2020-01-25T22:09:42Z", "type": "commit"}, {"oid": "eeda9b54e3fb6b7b23484dddc2adeb78d0f4efd5", "url": "https://github.com/trinodb/trino/commit/eeda9b54e3fb6b7b23484dddc2adeb78d0f4efd5", "message": "Make extendEnvironment abstract\n\nDefault empty implementation is practically useless.", "committedDate": "2020-01-25T22:10:02Z", "type": "commit"}, {"oid": "a7b01e8ef7449e8754cd947692ded0aae0f8ac54", "url": "https://github.com/trinodb/trino/commit/a7b01e8ef7449e8754cd947692ded0aae0f8ac54", "message": "Add convenience Launcher's launcher script\n\nThis improves developer's experience when launcher jar has not yet been\ncreated and they attempt to execute a product tests invocation copied\nfrom a product tests suite file.\n\nThe script has been tested with Bash 4.4 and Bash 3.2.57.", "committedDate": "2020-01-25T22:11:14Z", "type": "commit"}, {"oid": "498ec6ac0e39eaa67f3875701951047091622500", "url": "https://github.com/trinodb/trino/commit/498ec6ac0e39eaa67f3875701951047091622500", "message": "Mark environment implementations as final", "committedDate": "2020-01-25T22:11:14Z", "type": "commit"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": "5f727b3cf3e3edad664ee5e6455fdb2fa4c596c1", "url": "https://github.com/trinodb/trino/commit/5f727b3cf3e3edad664ee5e6455fdb2fa4c596c1", "message": "Introduce helper for Presto container", "committedDate": "2020-01-25T22:30:11Z", "type": "commit"}, {"oid": "f74397bd45f7fc1d83fec44f533e0b123293dbcc", "url": "https://github.com/trinodb/trino/commit/f74397bd45f7fc1d83fec44f533e0b123293dbcc", "message": "Convert multinode-tls-kerberos environment to Launcher", "committedDate": "2020-01-25T22:32:42Z", "type": "commit"}, {"oid": "1ff30d47957ce9a721c1257c4cf98b995864162e", "url": "https://github.com/trinodb/trino/commit/1ff30d47957ce9a721c1257c4cf98b995864162e", "message": "Convert multinode-tls environment to Launcher", "committedDate": "2020-01-25T22:32:42Z", "type": "commit"}, {"oid": "1ff30d47957ce9a721c1257c4cf98b995864162e", "url": "https://github.com/trinodb/trino/commit/1ff30d47957ce9a721c1257c4cf98b995864162e", "message": "Convert multinode-tls environment to Launcher", "committedDate": "2020-01-25T22:32:42Z", "type": "forcePushed"}]}