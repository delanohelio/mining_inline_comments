{"pr_number": 5881, "pr_title": "Execute queries from redirected input stream in presto-cli", "pr_createdAt": "2020-11-09T12:25:35Z", "pr_url": "https://github.com/trinodb/trino/pull/5881", "timeline": [{"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAzMTY4MQ==", "url": "https://github.com/trinodb/trino/pull/5881#discussion_r520031681", "bodyText": "@Override\n    public void setErrorPattern(Pattern pattern) {}\n\n    @Override\n    public void setErrorIndex(int i) {}", "author": "losipiuk", "createdAt": "2020-11-09T18:37:21Z", "path": "presto-cli/src/main/java/io/prestosql/cli/InputHighlighter.java", "diffHunk": "@@ -88,6 +89,16 @@ else if (isComment(type)) {\n         return builder.toAttributedString();\n     }\n \n+    @Override\n+    public void setErrorPattern(Pattern pattern)\n+    {\n+    }\n+\n+    @Override\n+    public void setErrorIndex(int i)\n+    {\n+    }\n+", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAzMTkwOQ==", "url": "https://github.com/trinodb/trino/pull/5881#discussion_r520031909", "bodyText": "declare as List<...>", "author": "losipiuk", "createdAt": "2020-11-09T18:37:47Z", "path": "presto-product-tests/src/main/java/io/prestosql/tests/cli/PrestoCliLauncher.java", "diffHunk": "@@ -78,9 +78,18 @@ protected void launchPrestoCli(List<String> arguments)\n \n     protected ProcessBuilder getProcessBuilder(List<String> arguments)\n     {\n-        return new ProcessBuilder(ImmutableList.<String>builder()\n+        ImmutableList<String> command = ImmutableList.<String>builder()", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAzMjYzMQ==", "url": "https://github.com/trinodb/trino/pull/5881#discussion_r520032631", "bodyText": "Why do we need bash for that? Can't we just execut java?", "author": "losipiuk", "createdAt": "2020-11-09T18:39:01Z", "path": "presto-product-tests/src/main/java/io/prestosql/tests/cli/PrestoCliLauncher.java", "diffHunk": "@@ -78,9 +78,18 @@ protected void launchPrestoCli(List<String> arguments)\n \n     protected ProcessBuilder getProcessBuilder(List<String> arguments)\n     {\n-        return new ProcessBuilder(ImmutableList.<String>builder()\n+        ImmutableList<String> command = ImmutableList.<String>builder()\n                 .add(JAVA_BIN, \"-Xmx50m\", \"-cp\", CLASSPATH, Presto.class.getCanonicalName())\n                 .addAll(arguments)\n-                .build());\n+                .build();\n+\n+        String commandText = Joiner.on(' ').join(command);\n+\n+        return new ProcessBuilder(ImmutableList.of(\"bash\", \"-c\", commandText));", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAzMjg3MA==", "url": "https://github.com/trinodb/trino/pull/5881#discussion_r520032870", "bodyText": "Without bash you would not need any escaping.", "author": "losipiuk", "createdAt": "2020-11-09T18:39:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAzMjYzMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDA0MjY1NA==", "url": "https://github.com/trinodb/trino/pull/5881#discussion_r520042654", "bodyText": "To be able to redirect stdin to it", "author": "wendigo", "createdAt": "2020-11-09T18:55:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAzMjYzMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDUwOTg4Nw==", "url": "https://github.com/trinodb/trino/pull/5881#discussion_r520509887", "bodyText": "java.lang.ProcessBuilder#redirectInput() seems to support that?", "author": "findepi", "createdAt": "2020-11-10T12:01:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAzMjYzMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDI3Nzc5Mg==", "url": "https://github.com/trinodb/trino/pull/5881#discussion_r524277792", "bodyText": "Did we arrive at a conclusion here?", "author": "findepi", "createdAt": "2020-11-16T13:46:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAzMjYzMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjc4Nzc4Mw==", "url": "https://github.com/trinodb/trino/pull/5881#discussion_r526787783", "bodyText": "I've removed bash", "author": "wendigo", "createdAt": "2020-11-19T11:21:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAzMjYzMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAzNDk3MQ==", "url": "https://github.com/trinodb/trino/pull/5881#discussion_r520034971", "bodyText": "I guess this is fine. But other option to consider is also allowing passing - as a filename", "author": "losipiuk", "createdAt": "2020-11-09T18:42:58Z", "path": "presto-cli/src/main/java/io/prestosql/cli/Console.java", "diffHunk": "@@ -127,6 +129,22 @@ public boolean run()\n             }\n         }\n \n+        // Read queries from stdin\n+        if (!hasQuery && !detectRealTerminal()) {", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAzNTg4Mw==", "url": "https://github.com/trinodb/trino/pull/5881#discussion_r520035883", "bodyText": "should we assume that locale in terminal is UTF_8?", "author": "losipiuk", "createdAt": "2020-11-09T18:44:32Z", "path": "presto-cli/src/main/java/io/prestosql/cli/Console.java", "diffHunk": "@@ -127,6 +129,22 @@ public boolean run()\n             }\n         }\n \n+        // Read queries from stdin\n+        if (!hasQuery && !detectRealTerminal()) {\n+            try {\n+                if (System.in.available() > 0) {\n+                    query = new String(ByteStreams.toByteArray(System.in), UTF_8) + \";\";", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDA1Mjg1MA==", "url": "https://github.com/trinodb/trino/pull/5881#discussion_r520052850", "bodyText": "Fixed", "author": "wendigo", "createdAt": "2020-11-09T19:08:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAzNTg4Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAzNjE3MA==", "url": "https://github.com/trinodb/trino/pull/5881#discussion_r520036170", "bodyText": "what happens if there is already ; at the end of data in stdin?", "author": "losipiuk", "createdAt": "2020-11-09T18:45:00Z", "path": "presto-cli/src/main/java/io/prestosql/cli/Console.java", "diffHunk": "@@ -127,6 +129,22 @@ public boolean run()\n             }\n         }\n \n+        // Read queries from stdin\n+        if (!hasQuery && !detectRealTerminal()) {\n+            try {\n+                if (System.in.available() > 0) {\n+                    query = new String(ByteStreams.toByteArray(System.in), UTF_8) + \";\";", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDA0MzE5NQ==", "url": "https://github.com/trinodb/trino/pull/5881#discussion_r520043195", "bodyText": "It's the same logic as in --execute. Works fine", "author": "wendigo", "createdAt": "2020-11-09T18:56:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAzNjE3MA=="}], "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDQ2NTY4Ng==", "url": "https://github.com/trinodb/trino/pull/5881#discussion_r520465686", "bodyText": "move to helper class and make public", "author": "losipiuk", "createdAt": "2020-11-10T10:46:50Z", "path": "presto-cli/src/main/java/io/prestosql/cli/ConsolePrinter.java", "diffHunk": "@@ -92,7 +92,7 @@ public boolean isRealTerminal()\n         return REAL_TERMINAL;\n     }\n \n-    private static boolean detectRealTerminal()\n+    protected static boolean detectRealTerminal()", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDUwODgzNQ==", "url": "https://github.com/trinodb/trino/pull/5881#discussion_r520508835", "bodyText": "do you know who calls this and whether it's fully safe to ignore this?", "author": "findepi", "createdAt": "2020-11-10T12:00:09Z", "path": "presto-cli/src/main/java/io/prestosql/cli/InputHighlighter.java", "diffHunk": "@@ -88,6 +89,12 @@ else if (isComment(type)) {\n         return builder.toAttributedString();\n     }\n \n+    @Override\n+    public void setErrorPattern(Pattern pattern) {}", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDU3NTE2OA==", "url": "https://github.com/trinodb/trino/pull/5881#discussion_r520575168", "bodyText": "Nope. I was trying to understand that but no luck. I've seen in the DefaultHighlighter that errorPattern and index are used directly by the highlight method to change style when buffer matches. I decided that it's ok to omit that functionality for now.", "author": "wendigo", "createdAt": "2020-11-10T13:49:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDUwODgzNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDU3NzE3NQ==", "url": "https://github.com/trinodb/trino/pull/5881#discussion_r520577175", "bodyText": "i saw that too. Thanks for checking.", "author": "findepi", "createdAt": "2020-11-10T13:52:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDUwODgzNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDUxMDQ2Ng==", "url": "https://github.com/trinodb/trino/pull/5881#discussion_r520510466", "bodyText": "This is not correct.\nrequireNonNull(value, \"value is null\");\nreturn \"'\" + value.replace(\"'\", \"'\\\\''\") + \"'\";", "author": "findepi", "createdAt": "2020-11-10T12:03:07Z", "path": "presto-product-tests/src/main/java/io/prestosql/tests/cli/PrestoCliLauncher.java", "diffHunk": "@@ -78,9 +78,18 @@ protected void launchPrestoCli(List<String> arguments)\n \n     protected ProcessBuilder getProcessBuilder(List<String> arguments)\n     {\n-        return new ProcessBuilder(ImmutableList.<String>builder()\n+        List<String> command = ImmutableList.<String>builder()\n                 .add(JAVA_BIN, \"-Xmx50m\", \"-cp\", CLASSPATH, Presto.class.getCanonicalName())\n                 .addAll(arguments)\n-                .build());\n+                .build();\n+\n+        String commandText = Joiner.on(' ').join(command);\n+\n+        return new ProcessBuilder(ImmutableList.of(\"bash\", \"-c\", commandText));\n+    }\n+\n+    static String escapeForBash(String value)\n+    {\n+        return '\"' + value + '\"';", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDUxMDc3NA==", "url": "https://github.com/trinodb/trino/pull/5881#discussion_r520510774", "bodyText": "Anyway, i'd rather see the code without need for escape, and bash. Too error prone.", "author": "findepi", "createdAt": "2020-11-10T12:03:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDUxMDQ2Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDUxMDkyMw==", "url": "https://github.com/trinodb/trino/pull/5881#discussion_r520510923", "bodyText": "Any reason why escaping is not a hidden aspect of the launchPrestoCliWithServerArgument method? or even deeper?", "author": "findepi", "createdAt": "2020-11-10T12:04:03Z", "path": "presto-product-tests/src/main/java/io/prestosql/tests/cli/TestPrestoCli.java", "diffHunk": "@@ -122,7 +122,7 @@ public void shouldRunQuery()\n     public void shouldRunBatchQuery()\n             throws Exception\n     {\n-        launchPrestoCliWithServerArgument(\"--execute\", \"select * from hive.default.nation;\");\n+        launchPrestoCliWithServerArgument(\"--execute\", escapeForBash(\"select * from hive.default.nation;\"));", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjA5MDI0Nw==", "url": "https://github.com/trinodb/trino/pull/5881#discussion_r522090247", "bodyText": "I could do that", "author": "wendigo", "createdAt": "2020-11-12T13:04:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDUxMDkyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjA5MDQ5NQ==", "url": "https://github.com/trinodb/trino/pull/5881#discussion_r522090495", "bodyText": "But I would need separate methods that test redirects", "author": "wendigo", "createdAt": "2020-11-12T13:05:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDUxMDkyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDI3OTIxOA==", "url": "https://github.com/trinodb/trino/pull/5881#discussion_r524279218", "bodyText": "If we really have to use bash wrapper around CLI, let's do that in an isolated place, single test method.\nThis way:\n\nwe do not need to call escapeForBash (which we will be forgetting to call; and we do not forget, this reduces code readability)\nwe can remove bash more easily, which is my ultimate goal :)", "author": "findepi", "createdAt": "2020-11-16T13:48:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDUxMDkyMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDUxMTE1NQ==", "url": "https://github.com/trinodb/trino/pull/5881#discussion_r520511155", "bodyText": "any reason to escape user name but not eg ldapTruststorePassword?", "author": "findepi", "createdAt": "2020-11-10T12:04:33Z", "path": "presto-product-tests/src/main/java/io/prestosql/tests/cli/TestPrestoLdapCli.java", "diffHunk": "@@ -274,7 +274,7 @@ private void launchPrestoCliWithServerArgument(String... arguments)\n                 \"--server\", ldapServerAddress,\n                 \"--truststore-path\", ldapTruststorePath,\n                 \"--truststore-password\", ldapTruststorePassword,\n-                \"--user\", ldapUserName,\n+                \"--user\", escapeForBash(ldapUserName),", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjA3MzkxNw==", "url": "https://github.com/trinodb/trino/pull/5881#discussion_r522073917", "bodyText": "ldapUserName is tested to be empty. TrustStore is always provided", "author": "wendigo", "createdAt": "2020-11-12T12:36:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDUxMTE1NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDI3NzEwNg==", "url": "https://github.com/trinodb/trino/pull/5881#discussion_r524277106", "bodyText": "i don't understand this?", "author": "findepi", "createdAt": "2020-11-16T13:45:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDUxMTE1NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDUxMTgyNg==", "url": "https://github.com/trinodb/trino/pull/5881#discussion_r520511826", "bodyText": "--cli-jar -> --cli-bin, or --cli-executable?\n\"Path to executable cli JAR\" -> \"Path to CLI executable\"", "author": "findepi", "createdAt": "2020-11-10T12:05:43Z", "path": "presto-product-tests-launcher/src/main/java/io/prestosql/tests/product/launcher/cli/SuiteRun.java", "diffHunk": "@@ -103,6 +103,9 @@ public Integer call()\n         @Option(names = \"--test-jar\", paramLabel = \"<jar>\", description = \"Path to test JAR \" + DEFAULT_VALUE, defaultValue = \"${product-tests.module}/target/${product-tests.module}-${project.version}-executable.jar\")\n         public File testJar;\n \n+        @Option(names = \"--cli-jar\", paramLabel = \"<jar>\", description = \"Path to executable cli JAR \" + DEFAULT_VALUE, defaultValue = \"${cli.bin}\")", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjA3NDAwNg==", "url": "https://github.com/trinodb/trino/pull/5881#discussion_r522074006", "bodyText": "Sure.", "author": "wendigo", "createdAt": "2020-11-12T12:36:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDUxMTgyNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDUxMjQ1Nw==", "url": "https://github.com/trinodb/trino/pull/5881#discussion_r520512457", "bodyText": "\u2764\ufe0f", "author": "findepi", "createdAt": "2020-11-10T12:06:53Z", "path": "presto-product-tests/pom.xml", "diffHunk": "@@ -18,11 +18,6 @@\n     </properties>\n \n     <dependencies>\n-        <dependency>\n-            <groupId>io.prestosql</groupId>\n-            <artifactId>presto-cli</artifactId>", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDUxMjk0Mw==", "url": "https://github.com/trinodb/trino/pull/5881#discussion_r520512943", "bodyText": "we can hide the fact CLI jar is a jar:\n.withFileSystemBind(cliBin.getPath(), \"/docker/presto-cli\", READ_ONLY)\n\nyou will also want to make the file inside docker executable", "author": "findepi", "createdAt": "2020-11-10T12:07:48Z", "path": "presto-product-tests-launcher/src/main/java/io/prestosql/tests/product/launcher/cli/TestRun.java", "diffHunk": "@@ -253,6 +258,7 @@ private Environment getEnvironment()\n                 container\n                         // the test jar is hundreds MB and file system bind is much more efficient\n                         .withFileSystemBind(testJar.getPath(), \"/docker/test.jar\", READ_ONLY)\n+                        .withFileSystemBind(cliJar.getPath(), \"/docker/presto-cli-executable.jar\", READ_ONLY)", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjA3NTQ4Mw==", "url": "https://github.com/trinodb/trino/pull/5881#discussion_r522075483", "bodyText": "sure. this file is already executable", "author": "wendigo", "createdAt": "2020-11-12T12:39:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDUxMjk0Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDUxMzk0OA==", "url": "https://github.com/trinodb/trino/pull/5881#discussion_r520513948", "bodyText": "This will make it impossible to run the test from IDE, right?\nMaybe we can infer the version from something else, that will be loaded from a jar on classpath?\npresto jdbc driver maybe, something else? anyone?", "author": "findepi", "createdAt": "2020-11-10T12:09:38Z", "path": "presto-product-tests/src/main/java/io/prestosql/tests/cli/TestPrestoCli.java", "diffHunk": "@@ -105,7 +104,7 @@ public void shouldDisplayVersion()\n             throws IOException\n     {\n         launchPrestoCli(\"--version\");\n-        String version = firstNonNull(Presto.class.getPackage().getImplementationVersion(), \"(version unknown)\");\n+        String version = firstNonNull(TestPrestoCli.class.getPackage().getImplementationVersion(), \"(version unknown)\");", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjA5MDA1OQ==", "url": "https://github.com/trinodb/trino/pull/5881#discussion_r522090059", "bodyText": "It's a product test executed by tempto. So it should work", "author": "wendigo", "createdAt": "2020-11-12T13:04:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDUxMzk0OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDUxNDgyMg==", "url": "https://github.com/trinodb/trino/pull/5881#discussion_r520514822", "bodyText": "are we chopping this into indivual queries later?", "author": "findepi", "createdAt": "2020-11-10T12:11:16Z", "path": "presto-cli/src/main/java/io/prestosql/cli/Console.java", "diffHunk": "@@ -127,6 +129,22 @@ public boolean run()\n             }\n         }\n \n+        // Read queries from stdin\n+        if (!hasQuery && !detectRealTerminal()) {\n+            try {\n+                if (System.in.available() > 0) {\n+                    query = new String(ByteStreams.toByteArray(System.in), terminal().encoding()) + \";\";", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDU3NjI2Ng==", "url": "https://github.com/trinodb/trino/pull/5881#discussion_r520576266", "bodyText": "Yeah, it's being done in the non-changed code path which was working before for --execute and -f", "author": "wendigo", "createdAt": "2020-11-10T13:51:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDUxNDgyMg=="}], "type": "inlineReview"}, {"oid": "299f6d90835d508f4b7dabf3c26c7e1c3e911db3", "url": "https://github.com/trinodb/trino/commit/299f6d90835d508f4b7dabf3c26c7e1c3e911db3", "message": "Update JLine to 3.17.1", "committedDate": "2020-11-19T09:55:09Z", "type": "commit"}, {"oid": "2048cee5ec7d1c019bf576c9ad4e06c6bd3b82db", "url": "https://github.com/trinodb/trino/commit/2048cee5ec7d1c019bf576c9ad4e06c6bd3b82db", "message": "Use real executable CLI jar in product tests", "committedDate": "2020-11-19T10:45:36Z", "type": "commit"}, {"oid": "f41855782edf232f01f953fb1ea9b3960c21cb6c", "url": "https://github.com/trinodb/trino/commit/f41855782edf232f01f953fb1ea9b3960c21cb6c", "message": "Execute queries from redirected input stream\n\nThis enables previously non-working cli invocations like:\n\n- echo \"SELECT 1; SELECT 2; SELECT 3\" | ./presto-cli-executable.jar or\n- ./presto-cli-executable.jar < file.sql", "committedDate": "2020-11-19T11:09:48Z", "type": "commit"}, {"oid": "fa78832c655b698260e6fc3067464b4f67a0f619", "url": "https://github.com/trinodb/trino/commit/fa78832c655b698260e6fc3067464b4f67a0f619", "message": "Extract terminal utils", "committedDate": "2020-11-19T11:09:48Z", "type": "commit"}, {"oid": "fa78832c655b698260e6fc3067464b4f67a0f619", "url": "https://github.com/trinodb/trino/commit/fa78832c655b698260e6fc3067464b4f67a0f619", "message": "Extract terminal utils", "committedDate": "2020-11-19T11:09:48Z", "type": "forcePushed"}]}