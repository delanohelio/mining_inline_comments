{"pr_number": 516, "pr_title": "Upgrade ES to 7.8.0", "pr_createdAt": "2020-06-23T06:13:45Z", "pr_url": "https://github.com/opensearch-project/security/pull/516", "timeline": [{"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTE0MTE2OA==", "url": "https://github.com/opensearch-project/security/pull/516#discussion_r445141168", "bodyText": "Should you have here both ? \"create\" and \"auto_create\" ?", "author": "dinusX", "createdAt": "2020-06-24T20:06:11Z", "path": "src/test/resources/roles_bulk.yml", "diffHunk": "@@ -17,6 +17,6 @@ bulk:\n     allowed_actions:\n     - \"indices:data/write/index\"\n     - \"indices:admin/mapping/put\"\n-    - \"indices:admin/create\"\n+    - \"indices:admin/auto_create\"", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTE0MjQyMQ==", "url": "https://github.com/opensearch-project/security/pull/516#discussion_r445142421", "bodyText": "bulk requires only \"auto_create\". I can add \"create\", but it won't be used.", "author": "vrozov", "createdAt": "2020-06-24T20:08:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTE0MTE2OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTE2MTgxNA==", "url": "https://github.com/opensearch-project/security/pull/516#discussion_r445161814", "bodyText": "Looking at the ES PR, I see that they added \"auto_create\" everywhere where \"create\" was present, so ideally we should have both, just in case.\nIn addition to these changes, could you review all the places were we use \"indices:admin/create\" ?\nExample:\nhttps://github.com/opendistro-for-elasticsearch/security/blob/cbcc6245bd923c545fc7e52dabe1bed267ddbf6c/src/main/resources/static_config/static_roles.yml\nhttps://github.com/opendistro-for-elasticsearch/security/blob/a3d7a56e7c21ff011dad66a75389d157732f43fc/src/main/resources/static_config/static_action_groups.yml\nhttps://github.com/opendistro-for-elasticsearch/security/blob/3aef3a3143f30fb95ac499742b80e2de75a355d1/src/main/java/com/amazon/opendistroforelasticsearch/security/support/ConfigConstants.java", "author": "dinusX", "createdAt": "2020-06-24T20:46:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTE0MTE2OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTE2NzMzNw==", "url": "https://github.com/opensearch-project/security/pull/516#discussion_r445167337", "bodyText": "We can follow the same approach and replace \"auto_create\" with \"create\" while checking if user is allowed to perform \"auto_create\" action.\nBased on testing restoring snapshot does not require permission for \"auto_create\".", "author": "vrozov", "createdAt": "2020-06-24T20:57:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTE0MTE2OA=="}], "type": "inlineReview"}, {"oid": null, "url": null, "message": null, "committedDate": null, "type": "forcePushed"}, {"oid": "4bfe1f2c920fab59380150571c0f2d6e3e3a4c54", "url": "https://github.com/opensearch-project/security/commit/4bfe1f2c920fab59380150571c0f2d6e3e3a4c54", "message": "Support ES 7.8.0", "committedDate": "2020-06-24T22:21:24Z", "type": "commit"}, {"oid": "3226dbb10f725f79edadcb53c492f6f2c3eb63ed", "url": "https://github.com/opensearch-project/security/commit/3226dbb10f725f79edadcb53c492f6f2c3eb63ed", "message": "Change version to 1.9.0", "committedDate": "2020-06-24T22:21:24Z", "type": "commit"}, {"oid": "3226dbb10f725f79edadcb53c492f6f2c3eb63ed", "url": "https://github.com/opensearch-project/security/commit/3226dbb10f725f79edadcb53c492f6f2c3eb63ed", "message": "Change version to 1.9.0", "committedDate": "2020-06-24T22:21:24Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTIwOTI5NA==", "url": "https://github.com/opensearch-project/security/pull/516#discussion_r445209294", "bodyText": "nit: is ALIAS a string? .equals comparison may be better here.", "author": "debjanibnrj", "createdAt": "2020-06-24T22:36:08Z", "path": "src/main/java/com/amazon/opendistroforelasticsearch/security/securityconf/ConfigModelV7.java", "diffHunk": "@@ -743,8 +745,10 @@ public String getUnresolvedIndexPattern(User user) {\n             WildcardMatcher matcher = WildcardMatcher.from(unresolved);\n             String[] resolved = null;\n             if (!(matcher instanceof WildcardMatcher.Exact)) {\n-                final String[] aliasesForPermittedPattern = cs.state().getMetaData().getAliasAndIndexLookup().entrySet().stream()\n-                        .filter(e -> e.getValue().isAlias()).filter(e -> matcher.test(e.getKey())).map(e -> e.getKey())\n+                final String[] aliasesForPermittedPattern = cs.state().getMetadata().getIndicesLookup().entrySet().stream()\n+                        .filter(e -> e.getValue().getType() == ALIAS)", "originalCommit": "3226dbb10f725f79edadcb53c492f6f2c3eb63ed", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTIxMzI1Nw==", "url": "https://github.com/opensearch-project/security/pull/516#discussion_r445213257", "bodyText": "ALIAS is enum.", "author": "vrozov", "createdAt": "2020-06-24T22:48:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTIwOTI5NA=="}], "type": "inlineReview"}]}