{"pr_number": 506, "pr_title": "Refactor salt from compliance config into Salt class", "pr_createdAt": "2020-06-15T17:09:59Z", "pr_url": "https://github.com/opensearch-project/security/pull/506", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzk1NTU2Mw==", "url": "https://github.com/opensearch-project/security/pull/506#discussion_r443955563", "bodyText": "nit: pass Salt to MaskedFieldsMap.extractMaskedFields and add private final Salt salt to MaskedFieldsMap.", "author": "vrozov", "createdAt": "2020-06-23T04:33:49Z", "path": "src/main/java/com/amazon/opendistroforelasticsearch/security/configuration/DlsFlsFilterLeafReader.java", "diffHunk": "@@ -106,23 +106,25 @@\n     private final MaskedFieldsMap maskedFieldsMap;\n     private final ShardId shardId;\n     private final boolean maskFields;\n+    private final Salt salt;\n \n     private DlsGetEvaluator dge = null;\n \n \n     DlsFlsFilterLeafReader(final LeafReader delegate, final Set<String> includesExcludes,\n                            final Query dlsQuery, final IndexService indexService, final ThreadContext threadContext,\n                            final ClusterService clusterService,\n-                           final AuditLog auditlog, final Set<String> maskedFields, final ShardId shardId) {\n+                           final AuditLog auditlog, final Set<String> maskedFields, final ShardId shardId, final Salt salt) {\n         super(delegate);\n \n-        maskFields = (auditlog.getComplianceConfig().isEnabled() && maskedFields != null && maskedFields.size() > 0);\n+        maskFields = (maskedFields != null && maskedFields.size() > 0);\n \n         this.indexService = indexService;\n         this.threadContext = threadContext;\n         this.clusterService = clusterService;\n         this.auditlog = auditlog;\n-        this.maskedFieldsMap = MaskedFieldsMap.extractMaskedFields(maskFields, maskedFields, auditlog.getComplianceConfig().getSalt16());\n+        this.salt = salt;\n+        this.maskedFieldsMap = MaskedFieldsMap.extractMaskedFields(maskFields, maskedFields, this.salt.getSalt16());", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzk1OTU5OQ==", "url": "https://github.com/opensearch-project/security/pull/506#discussion_r443959599", "bodyText": "I don't think it is necessary to limit copyright for this file", "author": "vrozov", "createdAt": "2020-06-23T04:50:59Z", "path": "src/main/java/com/amazon/opendistroforelasticsearch/security/configuration/Salt.java", "diffHunk": "@@ -0,0 +1,75 @@\n+/*\n+ * Portions Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzk1OTc0Mw==", "url": "https://github.com/opensearch-project/security/pull/506#discussion_r443959743", "bodyText": "Add copyright", "author": "vrozov", "createdAt": "2020-06-23T04:51:28Z", "path": "src/test/java/com/amazon/opendistroforelasticsearch/security/configuration/SaltTest.java", "diffHunk": "@@ -0,0 +1,76 @@\n+package com.amazon.opendistroforelasticsearch.security.configuration;", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDUxOTg1MA==", "url": "https://github.com/opensearch-project/security/pull/506#discussion_r444519850", "bodyText": "Is the similar check on line 1099 necessary? If it is removed here, should it be also removed in getRuntimeMaskedFieldInfo()?", "author": "vrozov", "createdAt": "2020-06-23T21:30:08Z", "path": "src/main/java/com/amazon/opendistroforelasticsearch/security/configuration/DlsFlsFilterLeafReader.java", "diffHunk": "@@ -106,23 +106,25 @@\n     private final MaskedFieldsMap maskedFieldsMap;\n     private final ShardId shardId;\n     private final boolean maskFields;\n+    private final Salt salt;\n \n     private DlsGetEvaluator dge = null;\n \n \n     DlsFlsFilterLeafReader(final LeafReader delegate, final Set<String> includesExcludes,\n                            final Query dlsQuery, final IndexService indexService, final ThreadContext threadContext,\n                            final ClusterService clusterService,\n-                           final AuditLog auditlog, final Set<String> maskedFields, final ShardId shardId) {\n+                           final AuditLog auditlog, final Set<String> maskedFields, final ShardId shardId, final Salt salt) {\n         super(delegate);\n \n-        maskFields = (auditlog.getComplianceConfig().isEnabled() && maskedFields != null && maskedFields.size() > 0);\n+        maskFields = (maskedFields != null && maskedFields.size() > 0);", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e995508dae323c5fdf8f80ad344ff08a6bcecf7d", "url": "https://github.com/opensearch-project/security/commit/e995508dae323c5fdf8f80ad344ff08a6bcecf7d", "message": "Refactor salt from compliance config into salt class", "committedDate": "2020-06-23T22:06:53Z", "type": "commit"}]}