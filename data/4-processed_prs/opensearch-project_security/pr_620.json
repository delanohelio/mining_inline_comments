{"pr_number": 620, "pr_title": "Backport Opendistro 1.7", "pr_createdAt": "2020-08-04T02:56:23Z", "pr_url": "https://github.com/opensearch-project/security/pull/620", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTMxNzMyMw==", "url": "https://github.com/opensearch-project/security/pull/620#discussion_r465317323", "bodyText": "Are these changes supposed to be backported? The original PR had more changes", "author": "dinusX", "createdAt": "2020-08-04T20:40:43Z", "path": "src/main/java/com/amazon/opendistroforelasticsearch/security/dlic/rest/api/AbstractApiAction.java", "diffHunk": "@@ -370,9 +387,10 @@ protected final RestChannelConsumer prepareRequest(RestRequest request, NodeClie\n \t\t// check if request is authorized\n \t\tString authError = restApiPrivilegesEvaluator.checkAccessPermissions(request, getEndpoint());\n \n+\t\tfinal User user = (User) threadPool.getThreadContext().getTransient(ConfigConstants.OPENDISTRO_SECURITY_USER);\n+\t\tfinal String userName = user == null ? null : user.getName();", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTM0NDYzOQ==", "url": "https://github.com/opensearch-project/security/pull/620#discussion_r465344639", "bodyText": "Hi Dinu, These seem to be related to the following commits - opendistro-for-elasticsearch/security@67fe5d2\nand\nopendistro-for-elasticsearch/security@ff00f4f.\nI was backporting all commits for my changes for rolesmapping and Palash's changes for opendistro-for-elasticsearch/security@e97d30d\nand\nopendistro-for-elasticsearch/security@72ce765.\nThese changes are only related to the rolesmapping and saml related fixes. Let me know if while backporting we should backport other Audit log/whitelisting related changes as well.", "author": "debjanibnrj", "createdAt": "2020-08-04T21:37:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTMxNzMyMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTMxNzg5Mg==", "url": "https://github.com/opensearch-project/security/pull/620#discussion_r465317892", "bodyText": "Similar this one.", "author": "dinusX", "createdAt": "2020-08-04T20:41:51Z", "path": "src/main/java/com/amazon/opendistroforelasticsearch/security/dlic/rest/api/AbstractApiAction.java", "diffHunk": "@@ -499,6 +517,10 @@ protected void unprocessable(RestChannel channel, String message) {\n \t\tresponse(channel, RestStatus.UNPROCESSABLE_ENTITY, message);\n \t}\n \n+\tprotected void conflict(RestChannel channel, String message) {\n+\t\tresponse(channel, RestStatus.CONFLICT, message);\n+\t}\n+", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f9673bd62ce9fb2638a30914413431e631fbf001", "url": "https://github.com/opensearch-project/security/commit/f9673bd62ce9fb2638a30914413431e631fbf001", "message": "Preventing users from mapping to hidden/reserved opendistro_security_\u2026 (#486)\n\n* Preventing users from mapping to hidden/reserved opendistro_security_roles\n\n(cherry picked from commit 979d1a4a71db9f50a19428c3cd31bcc6a26a209c)", "committedDate": "2020-08-04T22:56:40Z", "type": "commit"}, {"oid": "7428f7bed2f059b789220a25ac34073c089c3709", "url": "https://github.com/opensearch-project/security/commit/7428f7bed2f059b789220a25ac34073c089c3709", "message": "Allow superadmin to update/delete hidden resources required for tenantinfo check. This can update the hidden roles which will be used bt tenantinfo check. (#513)\n\nAdded test cases\n\nCo-authored-by: Palash Hedau <phhedau@amazon.com>\n\n(cherry picked from commit e97d30d204c42c1a9518c85039144fcdadc0e590)", "committedDate": "2020-08-04T23:11:17Z", "type": "commit"}, {"oid": "4d73b94806bc220939ab24603c4ba06e43fe3826", "url": "https://github.com/opensearch-project/security/commit/4d73b94806bc220939ab24603c4ba06e43fe3826", "message": "Fix: Make sure Internal users API supports adding reserved opendistrosecurityroles (by superuser). Do not filter out reserved roles in the InternalUsersModelV7\n\n(cherry picked from commit 41fcc0230eab891cbade72853787364a90c130d7)", "committedDate": "2020-08-04T23:13:51Z", "type": "commit"}, {"oid": "bae9e504b4b72a4681d4b55340721552334df6c5", "url": "https://github.com/opensearch-project/security/commit/bae9e504b4b72a4681d4b55340721552334df6c5", "message": "Fix failing NodesDnApiTest#testNodesDnApi\n\n(cherry picked from commit d25812bfcfb6a62d7c42555e223da10068e6b284)", "committedDate": "2020-08-04T23:16:35Z", "type": "commit"}, {"oid": "4318f8b12e73440f65bad2b7ec691f115b7d50c2", "url": "https://github.com/opensearch-project/security/commit/4318f8b12e73440f65bad2b7ec691f115b7d50c2", "message": "Removing hidden/reserved roles added via rolesmapping\n\nEarlier the InternalUsers API was filtering out all hidden/reserved roles. We will just restrict it to hidden/reserved roles associated via rolesmapping. This will ensure behaviour of rolesmapping and internalusers API is the same.\n\n(cherry picked from commit 4a6ed34b8788260403fe09ccd40c0d96136428d2)", "committedDate": "2020-08-04T23:17:22Z", "type": "commit"}, {"oid": "7b0c583ffa6a8a305216a770d748021639173849", "url": "https://github.com/opensearch-project/security/commit/7b0c583ffa6a8a305216a770d748021639173849", "message": "Added kibana attribute to security config which will be used by tenantinfo api. (#514)\n\nAdded test cases\n\nCo-authored-by: Palash Hedau <phhedau@amazon.com>\n\n(cherry picked from commit 72ce765f0a767d609ad392c35bd8e72f3c03dd41)", "committedDate": "2020-08-04T23:27:32Z", "type": "commit"}, {"oid": "1e4fd064856a769074f63a9d075a19997f734afa", "url": "https://github.com/opensearch-project/security/commit/1e4fd064856a769074f63a9d075a19997f734afa", "message": "Prevent hidden roles from being added via rolesmapping and internalusers API\n\n(cherry picked from commit 480ef0b02e736a0b605088e8a8d8510635e04423)", "committedDate": "2020-08-04T23:31:32Z", "type": "commit"}, {"oid": "1e4fd064856a769074f63a9d075a19997f734afa", "url": "https://github.com/opensearch-project/security/commit/1e4fd064856a769074f63a9d075a19997f734afa", "message": "Prevent hidden roles from being added via rolesmapping and internalusers API\n\n(cherry picked from commit 480ef0b02e736a0b605088e8a8d8510635e04423)", "committedDate": "2020-08-04T23:31:32Z", "type": "forcePushed"}]}