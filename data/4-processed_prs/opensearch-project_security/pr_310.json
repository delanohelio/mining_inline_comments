{"pr_number": 310, "pr_title": "Refactor Resolved class, drop unused fields and simplify logic", "pr_createdAt": "2020-03-23T13:26:33Z", "pr_url": "https://github.com/opensearch-project/security/pull/310", "timeline": [{"oid": "e50bd3bae627ed29972cc6267ab1050c78c63fd9", "url": "https://github.com/opensearch-project/security/commit/e50bd3bae627ed29972cc6267ab1050c78c63fd9", "message": "Refactor Resolved class, drop unused fields and simplify logic", "committedDate": "2020-03-23T13:27:03Z", "type": "commit"}, {"oid": "e50bd3bae627ed29972cc6267ab1050c78c63fd9", "url": "https://github.com/opensearch-project/security/commit/e50bd3bae627ed29972cc6267ab1050c78c63fd9", "message": "Refactor Resolved class, drop unused fields and simplify logic", "committedDate": "2020-03-23T13:27:03Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTg1MzA4Mg==", "url": "https://github.com/opensearch-project/security/pull/310#discussion_r399853082", "bodyText": "nit: for consistency with isLocalAll and else cases postpone return till the end.", "author": "vrozov", "createdAt": "2020-03-29T20:59:07Z", "path": "src/main/java/com/amazon/opendistroforelasticsearch/security/resolver/IndexResolverReplacer.java", "diffHunk": "@@ -209,48 +209,41 @@ private Resolved resolveIndexPatterns(final IndicesOptions indicesOptions, final\n         }\n \n         final Set<String> matchingAliases;\n-        final Set<String> matchingIndices;\n         final Set<String> matchingAllIndices;\n \n         if (isLocalAll(requestedPatterns0)) {\n             if (log.isTraceEnabled()) {\n                 log.trace(Arrays.toString(requestedPatterns0) + \" is an LOCAL ALL pattern\");\n             }\n             matchingAliases = Resolved.All_SET;\n-            matchingIndices = Resolved.All_SET;\n             matchingAllIndices = Resolved.All_SET;\n \n         } else if (!remoteIndices.isEmpty() && localRequestedPatterns.isEmpty()) {\n             if (log.isTraceEnabled()) {\n                 log.trace(Arrays.toString(requestedPatterns0) + \" is an LOCAL EMPTY request\");\n             }\n-            return new Resolved.Builder().addOriginalRequested(Arrays.asList(requestedPatterns0)).addRemoteIndices(remoteIndices).build();\n+            return new Resolved(Collections.emptySet(), Collections.emptySet(), Collections.emptySet(), Sets.newHashSet(requestedPatterns0), remoteIndices);", "originalCommit": "e50bd3bae627ed29972cc6267ab1050c78c63fd9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDA4NjM5OQ==", "url": "https://github.com/opensearch-project/security/pull/310#discussion_r400086399", "bodyText": "done", "author": "DmitryOlshansky", "createdAt": "2020-03-30T10:28:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTg1MzA4Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTg1MzE0NA==", "url": "https://github.com/opensearch-project/security/pull/310#discussion_r399853144", "bodyText": "nit: final (only for consistency with codestyle).", "author": "vrozov", "createdAt": "2020-03-29T20:59:43Z", "path": "src/main/java/com/amazon/opendistroforelasticsearch/security/resolver/IndexResolverReplacer.java", "diffHunk": "@@ -209,48 +209,41 @@ private Resolved resolveIndexPatterns(final IndicesOptions indicesOptions, final\n         }\n \n         final Set<String> matchingAliases;\n-        final Set<String> matchingIndices;\n         final Set<String> matchingAllIndices;\n \n         if (isLocalAll(requestedPatterns0)) {\n             if (log.isTraceEnabled()) {\n                 log.trace(Arrays.toString(requestedPatterns0) + \" is an LOCAL ALL pattern\");\n             }\n             matchingAliases = Resolved.All_SET;\n-            matchingIndices = Resolved.All_SET;\n             matchingAllIndices = Resolved.All_SET;\n \n         } else if (!remoteIndices.isEmpty() && localRequestedPatterns.isEmpty()) {\n             if (log.isTraceEnabled()) {\n                 log.trace(Arrays.toString(requestedPatterns0) + \" is an LOCAL EMPTY request\");\n             }\n-            return new Resolved.Builder().addOriginalRequested(Arrays.asList(requestedPatterns0)).addRemoteIndices(remoteIndices).build();\n+            return new Resolved(Collections.emptySet(), Collections.emptySet(), Collections.emptySet(), Sets.newHashSet(requestedPatterns0), remoteIndices);\n         }\n \n         else {\n \n             ClusterState state = clusterService.state();\n-\n+            Set<String> dateResolvedLocalRequestedPatterns = localRequestedPatterns", "originalCommit": "e50bd3bae627ed29972cc6267ab1050c78c63fd9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDA4NzYwNQ==", "url": "https://github.com/opensearch-project/security/pull/310#discussion_r400087605", "bodyText": "done", "author": "DmitryOlshansky", "createdAt": "2020-03-30T10:30:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTg1MzE0NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTg1NDY2OA==", "url": "https://github.com/opensearch-project/security/pull/310#discussion_r399854668", "bodyText": "nit: declaring matchingAllIndices final does not add any value and makes _indices necessary. Drop final from matchingAliases and matchingAllIndices and remove _indices local variable.", "author": "vrozov", "createdAt": "2020-03-29T21:12:32Z", "path": "src/main/java/com/amazon/opendistroforelasticsearch/security/resolver/IndexResolverReplacer.java", "diffHunk": "@@ -209,48 +209,41 @@ private Resolved resolveIndexPatterns(final IndicesOptions indicesOptions, final\n         }\n \n         final Set<String> matchingAliases;\n-        final Set<String> matchingIndices;\n         final Set<String> matchingAllIndices;\n \n         if (isLocalAll(requestedPatterns0)) {\n             if (log.isTraceEnabled()) {\n                 log.trace(Arrays.toString(requestedPatterns0) + \" is an LOCAL ALL pattern\");\n             }\n             matchingAliases = Resolved.All_SET;\n-            matchingIndices = Resolved.All_SET;\n             matchingAllIndices = Resolved.All_SET;\n \n         } else if (!remoteIndices.isEmpty() && localRequestedPatterns.isEmpty()) {\n             if (log.isTraceEnabled()) {\n                 log.trace(Arrays.toString(requestedPatterns0) + \" is an LOCAL EMPTY request\");\n             }\n-            return new Resolved.Builder().addOriginalRequested(Arrays.asList(requestedPatterns0)).addRemoteIndices(remoteIndices).build();\n+            return new Resolved(Collections.emptySet(), Collections.emptySet(), Collections.emptySet(), Sets.newHashSet(requestedPatterns0), remoteIndices);\n         }\n \n         else {\n \n             ClusterState state = clusterService.state();\n-\n+            Set<String> dateResolvedLocalRequestedPatterns = localRequestedPatterns\n+                            .stream()\n+                            .map(resolver::resolveDateMathExpression)\n+                            .collect(Collectors.toSet());\n+            //fill matchingAliases\n             final SortedMap<String, AliasOrIndex> lookup = state.metaData().getAliasAndIndexLookup();\n-            final Set<String> aliases = lookup.entrySet().stream().filter(e -> e.getValue().isAlias()).map(e -> e.getKey())\n+            matchingAliases = lookup.entrySet()\n+                    .stream()\n+                    .filter(e -> e.getValue().isAlias())\n+                    .map(Map.Entry::getKey)\n+                    .filter(alias -> WildcardMatcher.matchAny(dateResolvedLocalRequestedPatterns, alias))\n                     .collect(Collectors.toSet());\n \n-            matchingAliases = new HashSet<>(localRequestedPatterns.size() * 10);\n-            matchingIndices = new HashSet<>(localRequestedPatterns.size() * 10);\n-            matchingAllIndices = new HashSet<>(localRequestedPatterns.size() * 10);\n-\n-            //fill matchingAliases\n-            for (String localRequestedPattern : localRequestedPatterns) {\n-                final String requestedPattern = resolver.resolveDateMathExpression(localRequestedPattern);\n-                final List<String> _aliases = WildcardMatcher.getMatchAny(requestedPattern, aliases);\n-                matchingAliases.addAll(_aliases);\n-            }\n-\n-\n-            List<String> _indices;\n+            Set<String> _indices;", "originalCommit": "e50bd3bae627ed29972cc6267ab1050c78c63fd9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDA4NzY4Ng==", "url": "https://github.com/opensearch-project/security/pull/310#discussion_r400087686", "bodyText": "done", "author": "DmitryOlshansky", "createdAt": "2020-03-30T10:31:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTg1NDY2OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTg1NDg5NQ==", "url": "https://github.com/opensearch-project/security/pull/310#discussion_r399854895", "bodyText": "nit: prefer new HashSet<>(Arrays.asList()). Sets.newHashSet() is likely to be removed or deprecated in Guava.", "author": "vrozov", "createdAt": "2020-03-29T21:14:04Z", "path": "src/main/java/com/amazon/opendistroforelasticsearch/security/resolver/IndexResolverReplacer.java", "diffHunk": "@@ -259,36 +252,13 @@ private Resolved resolveIndexPatterns(final IndicesOptions indicesOptions, final\n                     log.debug(\"No such indices for pattern {}, use raw value\", localRequestedPatterns);\n                 }\n \n-                _indices = new ArrayList<>(localRequestedPatterns.size());\n-\n-                for (String requestedPattern : localRequestedPatterns) {\n-                    _indices.add(resolver.resolveDateMathExpression(requestedPattern));\n-                }\n-\n+                _indices = dateResolvedLocalRequestedPatterns;\n             }\n \n-            final List<String> _aliases = WildcardMatcher.getMatchAny(localRequestedPatterns.toArray(new String[0]), aliases);\n-\n-            matchingAllIndices.addAll(_indices);\n-\n-            if (_aliases.isEmpty()) {\n-                matchingIndices.addAll(_indices); //date math resolved?\n-            } else {\n-\n-                if (!_indices.isEmpty()) {\n-\n-                    for (String al : _aliases) {\n-                        Set<String> doubleIndices = lookup.get(al).getIndices().stream().map(a -> a.getIndex().getName()).collect(Collectors.toSet());\n-                        _indices.removeAll(doubleIndices);\n-                    }\n-\n-                    matchingIndices.addAll(_indices);\n-                }\n-            }\n+            matchingAllIndices = _indices;\n         }\n \n-        return new Resolved.Builder(matchingAliases, matchingIndices, matchingAllIndices, null, requestedPatterns0, remoteIndices)\n-                /*.addTypes(resolveTypes(request))*/.build();\n+        return new Resolved(matchingAliases, matchingAllIndices, Collections.emptySet(), Sets.newHashSet(requestedPatterns0), remoteIndices);", "originalCommit": "e50bd3bae627ed29972cc6267ab1050c78c63fd9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTg1NTExNg==", "url": "https://github.com/opensearch-project/security/pull/310#discussion_r399855116", "bodyText": "nit: order is not important, use Map<>.", "author": "vrozov", "createdAt": "2020-03-29T21:16:35Z", "path": "src/main/java/com/amazon/opendistroforelasticsearch/security/resolver/IndexResolverReplacer.java", "diffHunk": "@@ -209,48 +209,41 @@ private Resolved resolveIndexPatterns(final IndicesOptions indicesOptions, final\n         }\n \n         final Set<String> matchingAliases;\n-        final Set<String> matchingIndices;\n         final Set<String> matchingAllIndices;\n \n         if (isLocalAll(requestedPatterns0)) {\n             if (log.isTraceEnabled()) {\n                 log.trace(Arrays.toString(requestedPatterns0) + \" is an LOCAL ALL pattern\");\n             }\n             matchingAliases = Resolved.All_SET;\n-            matchingIndices = Resolved.All_SET;\n             matchingAllIndices = Resolved.All_SET;\n \n         } else if (!remoteIndices.isEmpty() && localRequestedPatterns.isEmpty()) {\n             if (log.isTraceEnabled()) {\n                 log.trace(Arrays.toString(requestedPatterns0) + \" is an LOCAL EMPTY request\");\n             }\n-            return new Resolved.Builder().addOriginalRequested(Arrays.asList(requestedPatterns0)).addRemoteIndices(remoteIndices).build();\n+            return new Resolved(Collections.emptySet(), Collections.emptySet(), Collections.emptySet(), Sets.newHashSet(requestedPatterns0), remoteIndices);\n         }\n \n         else {\n \n             ClusterState state = clusterService.state();\n-\n+            Set<String> dateResolvedLocalRequestedPatterns = localRequestedPatterns\n+                            .stream()\n+                            .map(resolver::resolveDateMathExpression)\n+                            .collect(Collectors.toSet());\n+            //fill matchingAliases\n             final SortedMap<String, AliasOrIndex> lookup = state.metaData().getAliasAndIndexLookup();", "originalCommit": "e50bd3bae627ed29972cc6267ab1050c78c63fd9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTg1NzcwNA==", "url": "https://github.com/opensearch-project/security/pull/310#discussion_r399857704", "bodyText": "Hardcode type to ImmutableSet.of(\"*\");", "author": "vrozov", "createdAt": "2020-03-29T21:40:08Z", "path": "src/main/java/com/amazon/opendistroforelasticsearch/security/resolver/IndexResolverReplacer.java", "diffHunk": "@@ -359,26 +329,24 @@ public Resolved resolveRequest(final Object request) {\n          */\n         private static final Set<String> All_SET = Collections.singleton(\"*\");\n         private static final long serialVersionUID = 1L;\n-        public final static Resolved _LOCAL_ALL = new Resolved(All_SET, All_SET, All_SET, All_SET, Collections.emptySet(), Collections.emptySet());\n+        public final static Resolved _LOCAL_ALL = new Resolved(All_SET, All_SET, All_SET, Collections.emptySet(), Collections.emptySet());\n         private final Set<String> aliases;\n-        private final Set<String> indices;\n         private final Set<String> allIndices;\n         private final Set<String> types;\n \n         private final Set<String> originalRequested;\n         private final Set<String> remoteIndices;\n \n-        private Resolved(final Set<String> aliases, final Set<String> indices, final Set<String> allIndices,\n+        private Resolved(final Set<String> aliases, final Set<String> allIndices,\n                          final Set<String> types, final Set<String> originalRequested, final Set<String> remoteIndices) {\n             super();\n             this.aliases = aliases;\n-            this.indices = indices;\n             this.allIndices = allIndices;\n             this.types = types;", "originalCommit": "e50bd3bae627ed29972cc6267ab1050c78c63fd9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDEwODI4NA==", "url": "https://github.com/opensearch-project/security/pull/310#discussion_r400108284", "bodyText": "Done, I still read/write from stream to avoid breaking protocol compatibility.", "author": "DmitryOlshansky", "createdAt": "2020-03-30T11:08:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTg1NzcwNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDI2MTM1NA==", "url": "https://github.com/opensearch-project/security/pull/310#discussion_r400261354", "bodyText": "As far as I can see Resolved is transient and is never serialized/de-serialized.", "author": "vrozov", "createdAt": "2020-03-30T15:00:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTg1NzcwNA=="}], "type": "inlineReview"}, {"oid": "aea48689d43a41cbd8cf282be4ddfe218a4fa0fb", "url": "https://github.com/opensearch-project/security/commit/aea48689d43a41cbd8cf282be4ddfe218a4fa0fb", "message": "Address review comments, hardcode types to ImmutableSet.of(\"*\")", "committedDate": "2020-03-30T11:09:36Z", "type": "commit"}, {"oid": "aea48689d43a41cbd8cf282be4ddfe218a4fa0fb", "url": "https://github.com/opensearch-project/security/commit/aea48689d43a41cbd8cf282be4ddfe218a4fa0fb", "message": "Address review comments, hardcode types to ImmutableSet.of(\"*\")", "committedDate": "2020-03-30T11:09:36Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDI3NjAwNg==", "url": "https://github.com/opensearch-project/security/pull/310#discussion_r400276006", "bodyText": "Please move next to com.google.common.collect.Sets import.", "author": "vrozov", "createdAt": "2020-03-30T15:18:33Z", "path": "src/main/java/com/amazon/opendistroforelasticsearch/security/resolver/IndexResolverReplacer.java", "diffHunk": "@@ -32,23 +32,21 @@\n \n import java.io.IOException;\n import java.io.Serializable;\n-import java.lang.reflect.Method;\n import java.util.ArrayList;\n import java.util.Arrays;\n import java.util.Collection;\n import java.util.Collections;\n-import java.util.HashMap;\n import java.util.HashSet;\n import java.util.Iterator;\n import java.util.List;\n import java.util.ListIterator;\n import java.util.Map;\n import java.util.Set;\n-import java.util.SortedMap;\n import java.util.concurrent.atomic.AtomicBoolean;\n import java.util.regex.PatternSyntaxException;\n import java.util.stream.Collectors;\n \n+import com.google.common.collect.ImmutableSet;", "originalCommit": "aea48689d43a41cbd8cf282be4ddfe218a4fa0fb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDI5OTQxMg==", "url": "https://github.com/opensearch-project/security/pull/310#discussion_r400299412", "bodyText": "nit: newHashSet -> new HashSet<>()", "author": "vrozov", "createdAt": "2020-03-30T15:48:58Z", "path": "src/main/java/com/amazon/opendistroforelasticsearch/security/resolver/IndexResolverReplacer.java", "diffHunk": "@@ -209,86 +207,53 @@ private Resolved resolveIndexPatterns(final IndicesOptions indicesOptions, final\n         }\n \n         final Set<String> matchingAliases;\n-        final Set<String> matchingIndices;\n-        final Set<String> matchingAllIndices;\n+        Set<String> matchingAllIndices;\n \n         if (isLocalAll(requestedPatterns0)) {\n             if (log.isTraceEnabled()) {\n                 log.trace(Arrays.toString(requestedPatterns0) + \" is an LOCAL ALL pattern\");\n             }\n             matchingAliases = Resolved.All_SET;\n-            matchingIndices = Resolved.All_SET;\n             matchingAllIndices = Resolved.All_SET;\n \n         } else if (!remoteIndices.isEmpty() && localRequestedPatterns.isEmpty()) {\n             if (log.isTraceEnabled()) {\n                 log.trace(Arrays.toString(requestedPatterns0) + \" is an LOCAL EMPTY request\");\n             }\n-            return new Resolved.Builder().addOriginalRequested(Arrays.asList(requestedPatterns0)).addRemoteIndices(remoteIndices).build();\n+            matchingAllIndices = Collections.emptySet();\n+            matchingAliases = Collections.emptySet();\n         }\n \n         else {\n-\n-            ClusterState state = clusterService.state();\n-\n-            final SortedMap<String, AliasOrIndex> lookup = state.metaData().getAliasAndIndexLookup();\n-            final Set<String> aliases = lookup.entrySet().stream().filter(e -> e.getValue().isAlias()).map(e -> e.getKey())\n-                    .collect(Collectors.toSet());\n-\n-            matchingAliases = new HashSet<>(localRequestedPatterns.size() * 10);\n-            matchingIndices = new HashSet<>(localRequestedPatterns.size() * 10);\n-            matchingAllIndices = new HashSet<>(localRequestedPatterns.size() * 10);\n-\n+            final ClusterState state = clusterService.state();\n+            final Set<String> dateResolvedLocalRequestedPatterns = localRequestedPatterns\n+                            .stream()\n+                            .map(resolver::resolveDateMathExpression)\n+                            .collect(Collectors.toSet());\n             //fill matchingAliases\n-            for (String localRequestedPattern : localRequestedPatterns) {\n-                final String requestedPattern = resolver.resolveDateMathExpression(localRequestedPattern);\n-                final List<String> _aliases = WildcardMatcher.getMatchAny(requestedPattern, aliases);\n-                matchingAliases.addAll(_aliases);\n-            }\n-\n+            final Map<String, AliasOrIndex> lookup = state.metaData().getAliasAndIndexLookup();\n+            matchingAliases = lookup.entrySet()\n+                    .stream()\n+                    .filter(e -> e.getValue().isAlias())\n+                    .map(Map.Entry::getKey)\n+                    .filter(alias -> WildcardMatcher.matchAny(dateResolvedLocalRequestedPatterns, alias))\n+                    .collect(Collectors.toSet());\n \n-            List<String> _indices;\n             try {\n-                _indices = new ArrayList<>(\n-                        Arrays.asList(resolver.concreteIndexNames(state, indicesOptions, localRequestedPatterns.toArray(new String[0]))));\n+                matchingAllIndices = Sets.newHashSet(resolver.concreteIndexNames(state, indicesOptions, localRequestedPatterns.toArray(new String[0])));", "originalCommit": "aea48689d43a41cbd8cf282be4ddfe218a4fa0fb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDMwOTc1Nw==", "url": "https://github.com/opensearch-project/security/pull/310#discussion_r400309757", "bodyText": "nit: make type static and remove from equals() and hashCode()", "author": "vrozov", "createdAt": "2020-03-30T16:02:44Z", "path": "src/main/java/com/amazon/opendistroforelasticsearch/security/resolver/IndexResolverReplacer.java", "diffHunk": "@@ -359,48 +324,35 @@ public Resolved resolveRequest(final Object request) {\n          */\n         private static final Set<String> All_SET = Collections.singleton(\"*\");\n         private static final long serialVersionUID = 1L;\n-        public final static Resolved _LOCAL_ALL = new Resolved(All_SET, All_SET, All_SET, All_SET, Collections.emptySet(), Collections.emptySet());\n+        public final static Resolved _LOCAL_ALL = new Resolved(All_SET, All_SET, All_SET, Collections.emptySet());\n         private final Set<String> aliases;\n-        private final Set<String> indices;\n         private final Set<String> allIndices;\n-        private final Set<String> types;\n+        private final Set<String> types = ImmutableSet.of(\"*\");", "originalCommit": "aea48689d43a41cbd8cf282be4ddfe218a4fa0fb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQwNjkyMA==", "url": "https://github.com/opensearch-project/security/pull/310#discussion_r400406920", "bodyText": "Please remove reference to type from equals() and hashCode().  getType() should return type (no need to wrap).", "author": "vrozov", "createdAt": "2020-03-30T18:32:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDMwOTc1Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDcyNTk0Mg==", "url": "https://github.com/opensearch-project/security/pull/310#discussion_r400725942", "bodyText": "Done", "author": "DmitryOlshansky", "createdAt": "2020-03-31T08:18:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDMwOTc1Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDMxMzk4MA==", "url": "https://github.com/opensearch-project/security/pull/310#discussion_r400313980", "bodyText": "super() is redundant", "author": "vrozov", "createdAt": "2020-03-30T16:08:31Z", "path": "src/main/java/com/amazon/opendistroforelasticsearch/security/resolver/IndexResolverReplacer.java", "diffHunk": "@@ -359,48 +324,35 @@ public Resolved resolveRequest(final Object request) {\n          */\n         private static final Set<String> All_SET = Collections.singleton(\"*\");\n         private static final long serialVersionUID = 1L;\n-        public final static Resolved _LOCAL_ALL = new Resolved(All_SET, All_SET, All_SET, All_SET, Collections.emptySet(), Collections.emptySet());\n+        public final static Resolved _LOCAL_ALL = new Resolved(All_SET, All_SET, All_SET, Collections.emptySet());\n         private final Set<String> aliases;\n-        private final Set<String> indices;\n         private final Set<String> allIndices;\n-        private final Set<String> types;\n+        private final Set<String> types = ImmutableSet.of(\"*\");\n \n         private final Set<String> originalRequested;\n         private final Set<String> remoteIndices;\n \n-        private Resolved(final Set<String> aliases, final Set<String> indices, final Set<String> allIndices,\n-                         final Set<String> types, final Set<String> originalRequested, final Set<String> remoteIndices) {\n+        private Resolved(final Set<String> aliases, final Set<String> allIndices,\n+                         final Set<String> originalRequested, final Set<String> remoteIndices) {\n             super();", "originalCommit": "aea48689d43a41cbd8cf282be4ddfe218a4fa0fb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "834fb37c36e41ba40c5be50342faaaa155de9466", "url": "https://github.com/opensearch-project/security/commit/834fb37c36e41ba40c5be50342faaaa155de9466", "message": "Another refactoring pass for IndexResolverReplacer", "committedDate": "2020-03-30T18:18:03Z", "type": "commit"}, {"oid": "834fb37c36e41ba40c5be50342faaaa155de9466", "url": "https://github.com/opensearch-project/security/commit/834fb37c36e41ba40c5be50342faaaa155de9466", "message": "Another refactoring pass for IndexResolverReplacer", "committedDate": "2020-03-30T18:18:03Z", "type": "forcePushed"}, {"oid": "42297e61159eabe7b35f903935ea9ac5a38de146", "url": "https://github.com/opensearch-project/security/commit/42297e61159eabe7b35f903935ea9ac5a38de146", "message": "Remove types from hashCode/equals/serde for Resolved class", "committedDate": "2020-03-31T08:07:55Z", "type": "commit"}, {"oid": "42297e61159eabe7b35f903935ea9ac5a38de146", "url": "https://github.com/opensearch-project/security/commit/42297e61159eabe7b35f903935ea9ac5a38de146", "message": "Remove types from hashCode/equals/serde for Resolved class", "committedDate": "2020-03-31T08:07:55Z", "type": "forcePushed"}]}