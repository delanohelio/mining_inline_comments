{"pr_number": 517, "pr_title": "Remove the faulty index exists check and have more predictable behavior", "pr_createdAt": "2020-06-23T23:17:36Z", "pr_url": "https://github.com/opensearch-project/security/pull/517", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ0NzkwNw==", "url": "https://github.com/opensearch-project/security/pull/517#discussion_r446447907", "bodyText": "Is this try necessary?", "author": "vrozov", "createdAt": "2020-06-26T23:14:15Z", "path": "src/main/java/com/amazon/opendistroforelasticsearch/security/configuration/ConfigurationRepository.java", "diffHunk": "@@ -126,30 +128,36 @@ public void run() {\n                                 final ThreadContext threadContext = threadPool.getThreadContext();\n                                 try(StoredContext ctx = threadContext.stashContext()) {\n                                     threadContext.putHeader(ConfigConstants.OPENDISTRO_SECURITY_CONF_REQUEST_HEADER, \"true\");\n-                                    LOGGER.info(\"Will create {} index so we can apply default config\", opendistrosecurityIndex);\n-\n-                                    Map<String, Object> indexSettings = new HashMap<>();\n-                                    indexSettings.put(\"index.number_of_shards\", 1);\n-                                    indexSettings.put(\"index.auto_expand_replicas\", \"0-all\");\n-\n-                                    boolean ok = client.admin().indices().create(new CreateIndexRequest(opendistrosecurityIndex)\n-                                            .settings(indexSettings))\n-                                            .actionGet().isAcknowledged();\n-                                    LOGGER.info(\"Index {} created?: {}\", opendistrosecurityIndex, ok);\n-                                    if(ok) {\n-                                        ConfigHelper.uploadFile(client, cd+\"config.yml\", opendistrosecurityIndex, CType.CONFIG, DEFAULT_CONFIG_VERSION);\n-                                        ConfigHelper.uploadFile(client, cd+\"roles.yml\", opendistrosecurityIndex, CType.ROLES, DEFAULT_CONFIG_VERSION);\n-                                        ConfigHelper.uploadFile(client, cd+\"roles_mapping.yml\", opendistrosecurityIndex, CType.ROLESMAPPING, DEFAULT_CONFIG_VERSION);\n-                                        ConfigHelper.uploadFile(client, cd+\"internal_users.yml\", opendistrosecurityIndex, CType.INTERNALUSERS, DEFAULT_CONFIG_VERSION);\n-                                        ConfigHelper.uploadFile(client, cd+\"action_groups.yml\", opendistrosecurityIndex, CType.ACTIONGROUPS, DEFAULT_CONFIG_VERSION);\n-                                        if(DEFAULT_CONFIG_VERSION == 2) {\n-                                            ConfigHelper.uploadFile(client, cd+\"tenants.yml\", opendistrosecurityIndex, CType.TENANTS, DEFAULT_CONFIG_VERSION);\n+\n+                                    try {", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ1NzkzNQ==", "url": "https://github.com/opensearch-project/security/pull/517#discussion_r446457935", "bodyText": "I have put this try because it enables you to perform load other configs (audit.yml) or perform activities within the stored context block.", "author": "sujithvm", "createdAt": "2020-06-27T00:11:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ0NzkwNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ5MjU1NA==", "url": "https://github.com/opensearch-project/security/pull/517#discussion_r446492554", "bodyText": "nit: introduce a new method that creates index and returns true if index was created and false otherwise.", "author": "vrozov", "createdAt": "2020-06-27T06:34:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ0NzkwNw=="}], "type": "inlineReview"}, {"oid": "18187a0b0865d3c174ea30da69a59816f4cdb4cc", "url": "https://github.com/opensearch-project/security/commit/18187a0b0865d3c174ea30da69a59816f4cdb4cc", "message": "Remove the faulty index exists check and have more predictable behavior", "committedDate": "2020-06-29T16:11:22Z", "type": "commit"}]}