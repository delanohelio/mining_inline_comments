{"pr_number": 626, "pr_title": "Fix AccessControlException during HTTPSamlAuthenticator initialization.", "pr_createdAt": "2020-08-04T20:43:16Z", "pr_url": "https://github.com/opensearch-project/security/pull/626", "timeline": [{"oid": "0845857f2c0833ab966902122bc94ec21521949d", "url": "https://github.com/opensearch-project/security/commit/0845857f2c0833ab966902122bc94ec21521949d", "message": "Fix AccessControlException during HTTPSamlAuthenticator initialization.\n\ncall to `com.onelogin.saml2.settings.SettingsBuilder.build()` requires \"org.apache.xml.security.ignoreLineBreaks\" property write permission in OneLogin SAML Java toolkit since version 2.4.0", "committedDate": "2020-08-04T20:30:39Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTM3MzI1Mw==", "url": "https://github.com/opensearch-project/security/pull/626#discussion_r465373253", "bodyText": "This call will wrap all exceptions into PriviledgedActionException. Could you check if this method throws any exception and write code to propagate it correctly.\nExample: https://github.com/opendistro-for-elasticsearch/security/blob/d62ac5334609ea92b913caa5e73917efb8b29043/src/main/java/com/amazon/dlic/auth/ldap2/LDAPAuthenticationBackend2.java#L102", "author": "dinusX", "createdAt": "2020-08-04T22:50:06Z", "path": "src/main/java/com/amazon/dlic/auth/http/saml/Saml2SettingsProvider.java", "diffHunk": "@@ -95,8 +99,8 @@ Saml2Settings get() throws SamlConfigException {\n             // TODO allow overriding of IdP metadata?\n             settingsBuilder.fromValues(configProperties);\n             settingsBuilder.fromValues(new SamlSettingsMap(this.esSettings));\n-\n-            return settingsBuilder.build();\n+            SpecialPermission.check();\n+            return AccessController.doPrivileged((PrivilegedAction<Saml2Settings>) () -> settingsBuilder.build());", "originalCommit": "0845857f2c0833ab966902122bc94ec21521949d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTM3OTUwMg==", "url": "https://github.com/opensearch-project/security/pull/626#discussion_r465379502", "bodyText": "It only applies to checked exceptions, as com.onelogin.saml2.settings.SettingsBuilder.build() does not throw checked exceptions, the unwrapping similar to what is done in LDAPAuthenticationBackend2.java is not necessary.", "author": "vrozov", "createdAt": "2020-08-04T23:09:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTM3MzI1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTM4MDI4Mw==", "url": "https://github.com/opensearch-project/security/pull/626#discussion_r465380283", "bodyText": "Answer to my question: https://docs.oracle.com/javase/8/docs/technotes/guides/security/doprivileged.html#handling_exceptions", "author": "dinusX", "createdAt": "2020-08-04T23:11:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTM3MzI1Mw=="}], "type": "inlineReview"}]}