{"pr_number": 422, "pr_title": "Enable limited OpenSSL support", "pr_createdAt": "2020-04-24T19:05:01Z", "pr_url": "https://github.com/opensearch-project/security/pull/422", "timeline": [{"oid": "8519585ec91d6179cbc9109e239bc3843fbf603b", "url": "https://github.com/opensearch-project/security/commit/8519585ec91d6179cbc9109e239bc3843fbf603b", "message": "Enable limited OpenSSL support", "committedDate": "2020-04-24T19:04:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDg5Nzc2NA==", "url": "https://github.com/opensearch-project/security/pull/422#discussion_r414897764", "bodyText": "What does the es.unsafe.use_netty_default_allocator property do and why is it necessary for supporting node to node communication with OpenSSL?", "author": "debjanibnrj", "createdAt": "2020-04-24T22:28:10Z", "path": "src/main/java/com/amazon/opendistroforelasticsearch/security/ssl/DefaultOpenDistroSecurityKeyStore.java", "diffHunk": "@@ -133,14 +133,11 @@ public DefaultOpenDistroSecurityKeyStore(final Settings settings, final Path con\n                 .getAsBoolean(SSLConfigConstants.OPENDISTRO_SECURITY_SSL_TRANSPORT_ENABLE_OPENSSL_IF_AVAILABLE, true);\n \n         if(!OpenDistroSecuritySSLPlugin.OPENSSL_SUPPORTED && OpenSsl.isAvailable() && (settings.getAsBoolean(SSLConfigConstants.OPENDISTRO_SECURITY_SSL_HTTP_ENABLE_OPENSSL_IF_AVAILABLE, true) || settings.getAsBoolean(SSLConfigConstants.OPENDISTRO_SECURITY_SSL_TRANSPORT_ENABLE_OPENSSL_IF_AVAILABLE, true) )) {\n-            String text = \"Support for OpenSSL has been removed from Open Distro Security since Elasticsearch 7.4.0. Use JDK SSL instead\\n\";\n-            if(Constants.JRE_IS_MINIMUM_JAVA11) {\n-                text += \"Since you are running Java \"+Constants.JAVA_VERSION+\" you should not experience any performance impact but maybe not all your ciphers are supported. If you experience problems upgrade to Java 11+\";\n+            if (PlatformDependent.javaVersion() < 12) {\n+                log.warn(\"Support for OpenSSL with Java 11 or prior versions require using Netty allocator. Set 'es.unsafe.use_netty_default_allocator' system property to true\");", "originalCommit": "8519585ec91d6179cbc9109e239bc3843fbf603b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDkwNDQ4OA==", "url": "https://github.com/opensearch-project/security/pull/422#discussion_r414904488", "bodyText": "The es.unsafe.use_netty_default_allocator System property is used by NettyAllocator to determine which ByteBufAllocator to use. With this property set to true, ES will use native Netty allocator, otherwise, it will use its own NettyAllocator.NoDirectBuffers allocator that does not support direct buffers. As openssl is supported through netty and uses tcnative that needs direct buffers, it is necessary to configure ES to use Netty allocator if openssl is required/preferred.", "author": "vrozov", "createdAt": "2020-04-24T22:48:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDg5Nzc2NA=="}], "type": "inlineReview"}]}