{"pr_number": 513, "pr_title": "Allow superadmin to update/delete hidden resources required for tenan\u2026", "pr_createdAt": "2020-06-19T22:58:37Z", "pr_url": "https://github.com/opensearch-project/security/pull/513", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMwNTcwNw==", "url": "https://github.com/opensearch-project/security/pull/513#discussion_r446305707", "bodyText": "Is it necessary to introduce this method? Should isHidden() be modified to exclude super admin?", "author": "vrozov", "createdAt": "2020-06-26T17:06:10Z", "path": "src/main/java/com/amazon/opendistroforelasticsearch/security/dlic/rest/api/AbstractApiAction.java", "diffHunk": "@@ -555,4 +557,12 @@ protected boolean isReservedAndAccessible(final SecurityDynamicConfiguration<?>\n \t\treturn true;\n \t}\n \n+\tprotected boolean isHiddenAndAccessible(final SecurityDynamicConfiguration<?> existingConfiguration,", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMwODEwNA==", "url": "https://github.com/opensearch-project/security/pull/513#discussion_r446308104", "bodyText": "I was thinking about modifying but there are some occurrences in the code where they require isHidden and hence can not modify.\nAlso it is consistent to the isReserved, but thats a second excuse.", "author": "palashhedau", "createdAt": "2020-06-26T17:11:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMwNTcwNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMyMDgyNg==", "url": "https://github.com/opensearch-project/security/pull/513#discussion_r446320826", "bodyText": "The PR makes \"hidden\" resource to be \"visible\" to super admin, should not the other occurrences of isHidden() be replaced too?", "author": "vrozov", "createdAt": "2020-06-26T17:37:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMwNTcwNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMyNTg4NA==", "url": "https://github.com/opensearch-project/security/pull/513#discussion_r446325884", "bodyText": "Most of them are replaced.\nThe only one which is not replaced is the GET request where we have to specify if it is a hidden resource or not in the response\nhttps://github.com/opendistro-for-elasticsearch/security/blob/master/src/main/java/com/amazon/opendistroforelasticsearch/security/dlic/rest/api/AccountApiAction.java#L140", "author": "palashhedau", "createdAt": "2020-06-26T17:48:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMwNTcwNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM0MzUyNQ==", "url": "https://github.com/opensearch-project/security/pull/513#discussion_r446343525", "bodyText": "IMO, it will be better to change one place instead of changing multiple locations. Introduce isHidden(String resourceName) into SecurityDynamicConfiguration and call it directly from GET.", "author": "vrozov", "createdAt": "2020-06-26T18:26:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMwNTcwNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM2MzYyNQ==", "url": "https://github.com/opensearch-project/security/pull/513#discussion_r446363625", "bodyText": "I can remove the isHidden function alltogether itself from AbstractApiAction as it might look like some code duplication.\nisHidden will point to SecurityDynamicConfiguration and wherever supderAdmin check is required will be added like\nisHidden && superAdmin()\nOr do you want the way you said. IsHidden at both the location, only single GET request points to SecurityDynamicConfiguration", "author": "palashhedau", "createdAt": "2020-06-26T19:12:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMwNTcwNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM4NzgzOQ==", "url": "https://github.com/opensearch-project/security/pull/513#discussion_r446387839", "bodyText": "It will be good to understand the desired behavior here. If super admin is able to see a role, should she be able to assign that role to a user? @debjanibnrj", "author": "vrozov", "createdAt": "2020-06-26T20:10:58Z", "path": "src/main/java/com/amazon/opendistroforelasticsearch/security/dlic/rest/api/InternalUsersApiAction.java", "diffHunk": "@@ -121,7 +121,7 @@ protected void handlePut(RestChannel channel, final RestRequest request, final C\n             final SecurityDynamicConfiguration<?> rolesConfiguration = load(CType.ROLES, false);\n             for (final String role: opendistroSecurityRoles) {\n \n-                if (!rolesConfiguration.exists(role) || isHidden(rolesConfiguration, role)) {\n+                if (!rolesConfiguration.exists(role) || rolesConfiguration.isHidden(role)) {", "originalCommit": null, "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM4OTEyNA==", "url": "https://github.com/opensearch-project/security/pull/513#discussion_r446389124", "bodyText": "Please add a super admin test case that checks that the resource is visible and marked as hidden.", "author": "vrozov", "createdAt": "2020-06-26T20:13:57Z", "path": "src/test/java/com/amazon/opendistroforelasticsearch/security/dlic/rest/api/ActionGroupsApiTest.java", "diffHunk": "@@ -174,17 +174,20 @@ public void testActionGroupsApi() throws Exception {\n         Assert.assertFalse(response.getBody().contains(\"Resource 'GET_UT' is read-only.\"));\n \n         // -- GET_UT hidden resource, must be 404\n-        rh.sendAdminCertificate = true;\n+        rh.sendAdminCertificate = false;", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQyOTE1MA==", "url": "https://github.com/opensearch-project/security/pull/513#discussion_r446429150", "bodyText": "I didnt wanted it it be false as I have separate test cases for it.\nI should have reverted it, but I guess, i missed out. Reverting now", "author": "palashhedau", "createdAt": "2020-06-26T21:59:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM4OTEyNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM5MDA4Ng==", "url": "https://github.com/opensearch-project/security/pull/513#discussion_r446390086", "bodyText": "For \"OK\" response, should it also check the content of the response?", "author": "vrozov", "createdAt": "2020-06-26T20:16:19Z", "path": "src/test/java/com/amazon/opendistroforelasticsearch/security/dlic/rest/api/RolesApiTest.java", "diffHunk": "@@ -144,7 +144,7 @@ public void testRolesApi() throws Exception {\n \n         // hidden role\n         response = rh.executeGetRequest(\"/_opendistro/_security/api/roles/opendistro_security_internal\", new Header[0]);\n-        Assert.assertEquals(HttpStatus.SC_NOT_FOUND, response.getStatusCode());\n+        Assert.assertEquals(HttpStatus.SC_OK, response.getStatusCode());", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQzMTU5Mg==", "url": "https://github.com/opensearch-project/security/pull/513#discussion_r446431592", "bodyText": "We can add. Adding a few now", "author": "palashhedau", "createdAt": "2020-06-26T22:07:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM5MDA4Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQzODc3Mw==", "url": "https://github.com/opensearch-project/security/pull/513#discussion_r446438773", "bodyText": "added", "author": "palashhedau", "createdAt": "2020-06-26T22:34:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM5MDA4Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ0MjE4Mw==", "url": "https://github.com/opensearch-project/security/pull/513#discussion_r446442183", "bodyText": "nit: it is better to check for the status code first. When test does not fail, it does not matter, but may help with debugging if test fails. The same applies to all other places where response returns success code.", "author": "vrozov", "createdAt": "2020-06-26T22:48:55Z", "path": "src/test/java/com/amazon/opendistroforelasticsearch/security/dlic/rest/api/RolesApiTest.java", "diffHunk": "@@ -144,7 +144,8 @@ public void testRolesApi() throws Exception {\n \n         // hidden role\n         response = rh.executeGetRequest(\"/_opendistro/_security/api/roles/opendistro_security_internal\", new Header[0]);\n-        Assert.assertEquals(HttpStatus.SC_NOT_FOUND, response.getStatusCode());\n+        Assert.assertTrue(response.getBody().contains(\"\\\"hidden\\\":true\"));\n+        Assert.assertEquals(HttpStatus.SC_OK, response.getStatusCode());", "originalCommit": null, "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ0ODEyNQ==", "url": "https://github.com/opensearch-project/security/pull/513#discussion_r446448125", "bodyText": "done", "author": "palashhedau", "createdAt": "2020-06-26T23:15:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ0MjE4Mw=="}], "type": "inlineReview"}, {"oid": "511eb1b812d23d5a9e94b6da58743ac4fed23fca", "url": "https://github.com/opensearch-project/security/commit/511eb1b812d23d5a9e94b6da58743ac4fed23fca", "message": "Allow superadmin to update/delete hidden resources required for tenantinfo check. This can update the hidden roles which will be used bt tenantinfo check.\n\nAdded test cases", "committedDate": "2020-06-26T23:11:24Z", "type": "commit"}]}