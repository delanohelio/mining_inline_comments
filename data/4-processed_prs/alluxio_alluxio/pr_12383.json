{"pr_number": 12383, "pr_title": "Fix memory leak in inode tree iterator", "pr_createdAt": "2020-10-23T21:40:02Z", "pr_url": "https://github.com/Alluxio/alluxio/pull/12383", "timeline": [{"oid": "4ffb33a3ed8ba38810ae2bdf3159821a33743486", "url": "https://github.com/Alluxio/alluxio/commit/4ffb33a3ed8ba38810ae2bdf3159821a33743486", "message": "Fix memory leak in inode tree iterator", "committedDate": "2020-10-23T21:25:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTE4MTM0OQ==", "url": "https://github.com/Alluxio/alluxio/pull/12383#discussion_r511181349", "bodyText": "is this the correct order to shut them down?", "author": "gpang", "createdAt": "2020-10-23T22:26:28Z", "path": "core/server/master/src/main/java/alluxio/master/file/meta/InodeTreeBufferedIterator.java", "diffHunk": "@@ -302,4 +319,11 @@ public boolean hasNext() {\n   public void remove() {\n     throw new UnsupportedOperationException(\"remove is not supported in inode tree iterator\");\n   }\n+\n+  @Override\n+  public void close() {\n+    LOG.debug(\"Closing {} inode tree iterators\", mActiveCrawlers.size());\n+    mCoordinatorExecutor.shutdownNow();", "originalCommit": "4ffb33a3ed8ba38810ae2bdf3159821a33743486", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTE4NDQ4MQ==", "url": "https://github.com/Alluxio/alluxio/pull/12383#discussion_r511184481", "bodyText": "I don't think the order matters much. Both shutdown calls are asynchronous so the order of close does not make a big difference.", "author": "bf8086", "createdAt": "2020-10-23T22:38:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTE4MTM0OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTE4MTY1OA==", "url": "https://github.com/Alluxio/alluxio/pull/12383#discussion_r511181658", "bodyText": "Is this the only iterator that implements close() right now?", "author": "gpang", "createdAt": "2020-10-23T22:27:36Z", "path": "core/server/master/src/main/java/alluxio/master/file/meta/InodeTreeBufferedIterator.java", "diffHunk": "@@ -44,12 +46,13 @@\n  * makes applying those entries later more efficient by guaranteeing that a parent of an inode is\n  * iterated before it.\n  */\n-public class InodeTreeBufferedIterator implements Iterator<Journal.JournalEntry> {\n+public class InodeTreeBufferedIterator implements Iterator<Journal.JournalEntry>, Closeable {", "originalCommit": "4ffb33a3ed8ba38810ae2bdf3159821a33743486", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTE4NDUzMw==", "url": "https://github.com/Alluxio/alluxio/pull/12383#discussion_r511184533", "bodyText": "Yes.", "author": "bf8086", "createdAt": "2020-10-23T22:38:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTE4MTY1OA=="}], "type": "inlineReview"}]}