{"pr_number": 10851, "pr_title": "Allow eventual consistency in ufs contract tests", "pr_createdAt": "2020-02-06T01:52:34Z", "pr_url": "https://github.com/Alluxio/alluxio/pull/10851", "timeline": [{"oid": "8bd4f7a659784a2ead345a58c1462c288af4417d", "url": "https://github.com/Alluxio/alluxio/commit/8bd4f7a659784a2ead345a58c1462c288af4417d", "message": "[WIP] Allow eventual consistency in ufs", "committedDate": "2020-02-06T01:51:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTYwODM5Nw==", "url": "https://github.com/Alluxio/alluxio/pull/10851#discussion_r375608397", "bodyText": "why do we need an atomic here?", "author": "madanadit", "createdAt": "2020-02-06T02:08:53Z", "path": "examples/src/main/java/alluxio/examples/UnderFileSystemCommonOperations.java", "diffHunk": "@@ -675,27 +673,24 @@ public void listStatusFileTest() throws IOException {\n    * Test for listing large directory.\n    */\n   @RelatedS3Operations(operations = {\"putObject\", \"listObjectsV2\", \"getObjectMetadata\"})\n-  public void listLargeDirectoryTest() throws IOException {\n+  public void listLargeDirectoryTest() throws Exception {\n     LargeDirectoryConfig config = prepareLargeDirectory();\n     String[] children = config.getChildren();\n \n     // Retry for some time to allow list operations eventual consistency for S3 and GCS.\n     // See http://docs.aws.amazon.com/AmazonS3/latest/dev/Introduction.html and\n     // https://cloud.google.com/storage/docs/consistency for more details.\n-    // Note: not using CommonUtils.waitFor here because we intend to sleep with a longer interval.\n-    UfsStatus[] results = new UfsStatus[] {};\n-    for (int i = 0; i < 50; i++) {\n-      results = mUfs.listStatus(config.getTopLevelDirectory());\n-      if (children.length == results.length) {\n-        break;\n+    AtomicReference<UfsStatus[]> results = new AtomicReference<>();", "originalCommit": "8bd4f7a659784a2ead345a58c1462c288af4417d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTYxMTIzNw==", "url": "https://github.com/Alluxio/alluxio/pull/10851#discussion_r375611237", "bodyText": "this was because we cannot set variables from within a closure, so I couldn't assign to results.", "author": "gpang", "createdAt": "2020-02-06T02:23:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTYwODM5Nw=="}], "type": "inlineReview"}]}