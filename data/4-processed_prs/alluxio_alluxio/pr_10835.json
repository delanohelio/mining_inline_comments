{"pr_number": 10835, "pr_title": "Refactor for local cache", "pr_createdAt": "2020-02-04T00:55:45Z", "pr_url": "https://github.com/Alluxio/alluxio/pull/10835", "timeline": [{"oid": "909fbcd0fa34127fac26f39bb53a23794e9b91cc", "url": "https://github.com/Alluxio/alluxio/commit/909fbcd0fa34127fac26f39bb53a23794e9b91cc", "message": "Refactor for local cache.", "committedDate": "2020-02-04T00:54:10Z", "type": "commit"}, {"oid": "c1a5568c4d3fe9a309f606fed7508c40b27c58b4", "url": "https://github.com/Alluxio/alluxio/commit/c1a5568c4d3fe9a309f606fed7508c40b27c58b4", "message": "Checkstyle.", "committedDate": "2020-02-04T19:42:36Z", "type": "commit"}, {"oid": "dca43512f9788565f4984870c4bfd0247a412129", "url": "https://github.com/Alluxio/alluxio/commit/dca43512f9788565f4984870c4bfd0247a412129", "message": "Suppress findbugs warning.", "committedDate": "2020-02-04T21:10:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDkzOTE3Mw==", "url": "https://github.com/Alluxio/alluxio/pull/10835#discussion_r374939173", "bodyText": "Would it be okay now that the file system client does not have the client user subject?", "author": "bf8086", "createdAt": "2020-02-04T21:42:22Z", "path": "core/client/hdfs/src/main/java/alluxio/hadoop/AbstractFileSystem.java", "diffHunk": "@@ -491,9 +491,13 @@ public synchronized void initialize(URI uri, org.apache.hadoop.conf.Configuratio\n     // Create FileSystem for accessing Alluxio.\n     // Disable URI validation for non-Alluxio schemes.\n     boolean disableUriValidation =\n-        (uri.getScheme() != null) ? uri.getScheme().equals(Constants.SCHEME) : true;\n-    mFileSystem = FileSystem.Factory.create(\n-        ClientContext.create(subject, alluxioConf).setUriValidationEnabled(disableUriValidation));\n+        (uri.getScheme() == null) || uri.getScheme().equals(Constants.SCHEME);\n+    if (alluxioConf.getBoolean(PropertyKey.USER_LOCAL_CACHE_LIBRARY)) {\n+      mFileSystem = FileSystem.Factory.create(null, alluxioConf);", "originalCommit": "dca43512f9788565f4984870c4bfd0247a412129", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDk1NDYxMQ==", "url": "https://github.com/Alluxio/alluxio/pull/10835#discussion_r374954611", "bodyText": "that shouldn't be necessary in library mode", "author": "calvinjia", "createdAt": "2020-02-04T22:17:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDkzOTE3Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDk0MDI3NA==", "url": "https://github.com/Alluxio/alluxio/pull/10835#discussion_r374940274", "bodyText": "Would it be cleaner if we just have a subclass of FileSystemContext that override getClusterConf to return the client side configuration instead?", "author": "bf8086", "createdAt": "2020-02-04T21:44:46Z", "path": "core/client/fs/src/main/java/alluxio/client/file/FileSystem.java", "diffHunk": "@@ -130,9 +130,17 @@ public static FileSystem create(ClientContext ctx) {\n      * @return a new FileSystem instance\n      */\n     public static FileSystem create(FileSystemContext context) {\n+      return create(context, context.getClusterConf());", "originalCommit": "dca43512f9788565f4984870c4bfd0247a412129", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDk1NDIzNQ==", "url": "https://github.com/Alluxio/alluxio/pull/10835#discussion_r374954235", "bodyText": "FileSystemContext wasn't written to be easily extended, and even if we had a subclass we would still need a switch somewhere to make that FileSystemContext version", "author": "calvinjia", "createdAt": "2020-02-04T22:16:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDk0MDI3NA=="}], "type": "inlineReview"}]}