{"pr_number": 11554, "pr_title": "Support emptyDir for volumes and infer dnsPolicy from hostNetwork", "pr_createdAt": "2020-06-12T04:30:28Z", "pr_url": "https://github.com/Alluxio/alluxio/pull/11554", "timeline": [{"oid": "37050b9a15ec56025b3b436e27d61b8f9eac7f5c", "url": "https://github.com/Alluxio/alluxio/commit/37050b9a15ec56025b3b436e27d61b8f9eac7f5c", "message": "dnsPolicy inference and emptyDir support", "committedDate": "2020-06-12T04:28:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTIzNzcwMg==", "url": "https://github.com/Alluxio/alluxio/pull/11554#discussion_r439237702", "bodyText": "I think empty dir for alluxio-domain is not helpful. The reason is that empty dir is only shared in the same pod, not across different pods. So it's not visible to Fuse pod or other client pod.", "author": "cheyang", "createdAt": "2020-06-12T06:47:25Z", "path": "integration/kubernetes/helm-chart/alluxio/templates/_helpers.tpl", "diffHunk": "@@ -257,6 +257,24 @@ resources:\n   {{- end }}\n {{- end -}}\n \n+{{- define \"alluxio.worker.shortCircuit.volume\" -}}\n+  {{- if eq .Values.shortCircuit.volumeType \"hostPath\" }}\n+        - name: alluxio-domain\n+          hostPath:\n+            path: {{ .Values.shortCircuit.hostPath }}\n+            type: DirectoryOrCreate\n+  {{- else if eq .Values.shortCircuit.volumeType \"persistentVolumeClaim\" }}\n+        - name: alluxio-domain\n+          persistentVolumeClaim:\n+            claimName: \"{{ .Values.shortCircuit.pvcName }}\"\n+  {{- else }}", "originalCommit": "37050b9a15ec56025b3b436e27d61b8f9eac7f5c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTI0NTIxMg==", "url": "https://github.com/Alluxio/alluxio/pull/11554#discussion_r439245212", "bodyText": "Makes sense to me. Removed emptyDir for domain socket and keeping only PVC and hostPath", "author": "jiacheliu3", "createdAt": "2020-06-12T07:07:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTIzNzcwMg=="}], "type": "inlineReview"}, {"oid": "763d42169b5a9b525e489bc2560ff06aca279d48", "url": "https://github.com/Alluxio/alluxio/commit/763d42169b5a9b525e489bc2560ff06aca279d48", "message": "remove domain socket emptyDir and set values to default", "committedDate": "2020-06-12T07:00:27Z", "type": "commit"}, {"oid": "b577ec0fb2af66e73b9a69af83ba54e47601c2fe", "url": "https://github.com/Alluxio/alluxio/commit/b577ec0fb2af66e73b9a69af83ba54e47601c2fe", "message": "propagate change to fuse", "committedDate": "2020-06-12T07:06:29Z", "type": "commit"}, {"oid": "6162f10b8fdcdb94670e75728c78d9083744c8ad", "url": "https://github.com/Alluxio/alluxio/commit/6162f10b8fdcdb94670e75728c78d9083744c8ad", "message": "fuse issue", "committedDate": "2020-06-12T07:42:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTM3NzQ2Mg==", "url": "https://github.com/Alluxio/alluxio/pull/11554#discussion_r439377462", "bodyText": "Fixed one typo", "author": "jiacheliu3", "createdAt": "2020-06-12T12:01:51Z", "path": "integration/kubernetes/helm-chart/alluxio/templates/fuse/daemonset.yaml", "diffHunk": "@@ -92,7 +94,7 @@ spec:\n               fieldRef:\n                 fieldPath: status.hostIP\n           - name: ALLUXIO_CLIENT_JAVA_OPTS\n-            value: \" -Dalluxio.user.hostname=$(ALLUXIO_CLIENT_HOSTNAME) \"\n+            value: \" -Dalluxio.user.hostname=${ALLUXIO_CLIENT_HOSTNAME} \"", "originalCommit": "6162f10b8fdcdb94670e75728c78d9083744c8ad", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTM3ODMzOA==", "url": "https://github.com/Alluxio/alluxio/pull/11554#discussion_r439378338", "bodyText": "Per #11526 (comment), inferring dnsPolicy from hostNetwork, but not inferring hostNetwork from whether it's root.", "author": "jiacheliu3", "createdAt": "2020-06-12T12:04:02Z", "path": "integration/kubernetes/helm-chart/alluxio/values.yaml", "diffHunk": "@@ -70,18 +70,14 @@ master:\n     embedded: 19200\n     rpc: 19998\n     web: 19999\n-  # You can specify hostNetwork and dnsPolicy here to override the default\n-  # hostNetwork: false\n+  hostNetwork: false\n+  # dnsPolicy will be ClusterFirstWithHostNet if hostNetwork: true\n+  # and ClusterFirst if hostNetwork: false\n+  # You can specify dnsPolicy here to override this inference", "originalCommit": "6162f10b8fdcdb94670e75728c78d9083744c8ad", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTQyOTEyNw==", "url": "https://github.com/Alluxio/alluxio/pull/11554#discussion_r439429127", "bodyText": "Please note this and any other renames in changelog. A rename will break back compatibility, avoid if not absolutely necessary", "author": "madanadit", "createdAt": "2020-06-12T13:48:33Z", "path": "integration/kubernetes/helm-chart/alluxio/values.yaml", "diffHunk": "@@ -230,14 +247,20 @@ shortCircuit:\n   # local means the cache directory is in the same mount namespace,\n   # uuid means interact with domain socket\n   policy: uuid\n-  # Attributes if the domain socket volume is PVC\n+  # volumeType controls the type of shortCircuit volume.\n+  # It can be \"persistentVolumeClaim\" or \"hostPath\"\n+  volumeType: persistentVolumeClaim\n+  size: 1Mi\n+  # Attributes to use if the domain socket volume is PVC\n   pvcName: alluxio-worker-domain-socket\n-  pvcAccessModes:\n+  accessModes:", "originalCommit": "6162f10b8fdcdb94670e75728c78d9083744c8ad", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTkxMzIxMg==", "url": "https://github.com/Alluxio/alluxio/pull/11554#discussion_r441913212", "bodyText": "Actually i found this accessModes i'm changing to is the one used in the docs. I realized this is changed to pvcAccessModes sometime in 2.3 snapshot. So I think it's okay.", "author": "jiacheliu3", "createdAt": "2020-06-18T01:08:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTQyOTEyNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTkxOTQ4Ng==", "url": "https://github.com/Alluxio/alluxio/pull/11554#discussion_r441919486", "bodyText": "yep", "author": "madanadit", "createdAt": "2020-06-18T01:34:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTQyOTEyNw=="}], "type": "inlineReview"}, {"oid": "5e8c4a2ce01621148370e4198c862c320f522b41", "url": "https://github.com/Alluxio/alluxio/commit/5e8c4a2ce01621148370e4198c862c320f522b41", "message": "try to keep backward compatibility and add to changelog", "committedDate": "2020-06-16T12:19:12Z", "type": "commit"}, {"oid": "fefbd7797420b6554ad67a03308cebec1b14ec60", "url": "https://github.com/Alluxio/alluxio/commit/fefbd7797420b6554ad67a03308cebec1b14ec60", "message": "update domain socket pvc fields to match with doc", "committedDate": "2020-06-16T12:46:35Z", "type": "commit"}, {"oid": "7212532028c2714a6390d0fd4c0ef32401f41b84", "url": "https://github.com/Alluxio/alluxio/commit/7212532028c2714a6390d0fd4c0ef32401f41b84", "message": "remove emptyDir option for domain socket", "committedDate": "2020-06-17T06:34:38Z", "type": "commit"}, {"oid": "0ea9979ad50692a5d9ed27e727b004c98a10e049", "url": "https://github.com/Alluxio/alluxio/commit/0ea9979ad50692a5d9ed27e727b004c98a10e049", "message": "disable metastore for the tarball", "committedDate": "2020-06-17T06:41:48Z", "type": "commit"}, {"oid": "0d45debf71971d7cffb78ec3ea1a449ad98c908f", "url": "https://github.com/Alluxio/alluxio/commit/0d45debf71971d7cffb78ec3ea1a449ad98c908f", "message": "domain socket doc", "committedDate": "2020-06-17T07:08:11Z", "type": "commit"}, {"oid": "f6dc14dec85f3d0c5924a45bbcb134ef18278fca", "url": "https://github.com/Alluxio/alluxio/commit/f6dc14dec85f3d0c5924a45bbcb134ef18278fca", "message": "doc update", "committedDate": "2020-06-17T17:30:25Z", "type": "commit"}]}