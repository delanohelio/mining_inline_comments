{"pr_number": 11315, "pr_title": "Format K8s Configmap helm template", "pr_createdAt": "2020-04-18T10:48:24Z", "pr_url": "https://github.com/Alluxio/alluxio/pull/11315", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTcyMTc3MA==", "url": "https://github.com/Alluxio/alluxio/pull/11315#discussion_r411721770", "bodyText": "this seems like a redundant pattern, can we have a builder for java opts?", "author": "madanadit", "createdAt": "2020-04-20T22:01:35Z", "path": "integration/kubernetes/helm-chart/alluxio/templates/config/alluxio-conf.yaml", "diffHunk": "@@ -32,15 +32,141 @@ metadata:\n     heritage: {{ .Release.Service }}\n data:\n   ALLUXIO_JAVA_OPTS: |-\n-    {{if $isSingleMaster}}-Dalluxio.master.hostname={{ $fullName }}-{{ $defaultMasterName }}{{end}} -Dalluxio.master.journal.type={{ .Values.journal.type }} -Dalluxio.master.journal.folder={{ .Values.journal.folder }} {{if $isHaEmbedded}}-Dalluxio.master.embedded.journal.addresses={{range $i := until $masterCount}}{{ $fullName }}-master-{{$i}}:19200,{{end}}{{end}} {{ .Values.jvmOptions }} {{- range $key, $val := .Values.properties }} -D{{ $key }}={{ $val }} {{ end }}\n+    {{- $alluxioJavaOpts := list }}\n+\n+    {{- /* Specify master hostname if single master */}}\n+    {{- if $isSingleMaster }}\n+      {{- $alluxioJavaOpts = printf \"-Dalluxio.master.hostname=%v-%v\" $fullName $defaultMasterName | append $alluxioJavaOpts }}", "originalCommit": "832c4d5f0e8fa5b56de4313ce83a6e2555a05241", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzc5ODA5Nw==", "url": "https://github.com/Alluxio/alluxio/pull/11315#discussion_r413798097", "bodyText": "Sadly Helm doesn't have good support of customized functions other than what's provided in http://masterminds.github.io/sprig/.\nThis can't be easily done :(", "author": "jiacheliu3", "createdAt": "2020-04-23T13:04:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTcyMTc3MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTcyMjIyNw==", "url": "https://github.com/Alluxio/alluxio/pull/11315#discussion_r411722227", "bodyText": "we might still need the leading / trailing space, until we fix the issue with appending common java opts in libexec. alternatively, you could fix that issue", "author": "madanadit", "createdAt": "2020-04-20T22:02:41Z", "path": "integration/kubernetes/multiMaster-embeddedJournal/alluxio-configmap.yaml.template", "diffHunk": "@@ -28,16 +28,16 @@ metadata:\n     heritage: Tiller\n data:\n   ALLUXIO_JAVA_OPTS: |-\n-     -Dalluxio.master.journal.type=EMBEDDED -Dalluxio.master.journal.folder=/journal -Dalluxio.master.embedded.journal.addresses=alluxio-master-0:19200,alluxio-master-1:19200,alluxio-master-2:19200,  -Dalluxio.security.stale.channel.purge.interval=365d ", "originalCommit": "832c4d5f0e8fa5b56de4313ce83a6e2555a05241", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzgyNzI1Mg==", "url": "https://github.com/Alluxio/alluxio/pull/11315#discussion_r413827252", "bodyText": "There was an extra space and is now removed. The leading/trailing spaces are still aligned. I ran through the tests and they are all good.", "author": "jiacheliu3", "createdAt": "2020-04-23T14:09:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTcyMjIyNw=="}], "type": "inlineReview"}, {"oid": "af869653fe4b963a712ac31389314c8c57d6d2d9", "url": "https://github.com/Alluxio/alluxio/commit/af869653fe4b963a712ac31389314c8c57d6d2d9", "message": "format configmap", "committedDate": "2020-04-26T12:39:23Z", "type": "commit"}, {"oid": "2b3fcd876a1745fee9eedd662da64491a7cc7e06", "url": "https://github.com/Alluxio/alluxio/commit/2b3fcd876a1745fee9eedd662da64491a7cc7e06", "message": "put java opts back to slepp", "committedDate": "2020-04-26T12:40:03Z", "type": "commit"}, {"oid": "7cf80ba7b09170e6fdf680f75bac9bb8a0466c4e", "url": "https://github.com/Alluxio/alluxio/commit/7cf80ba7b09170e6fdf680f75bac9bb8a0466c4e", "message": "remove experimental lines", "committedDate": "2020-04-26T12:40:04Z", "type": "commit"}, {"oid": "710d29a94d272ead14ee6cb8ab223a49150c37ff", "url": "https://github.com/Alluxio/alluxio/commit/710d29a94d272ead14ee6cb8ab223a49150c37ff", "message": "remove 0.0.0.0 default values", "committedDate": "2020-04-26T12:40:33Z", "type": "commit"}, {"oid": "710d29a94d272ead14ee6cb8ab223a49150c37ff", "url": "https://github.com/Alluxio/alluxio/commit/710d29a94d272ead14ee6cb8ab223a49150c37ff", "message": "remove 0.0.0.0 default values", "committedDate": "2020-04-26T12:40:33Z", "type": "forcePushed"}]}