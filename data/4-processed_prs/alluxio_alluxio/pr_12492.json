{"pr_number": 12492, "pr_title": "Support custom ufs module of hadoop by generate-tarball", "pr_createdAt": "2020-11-12T04:57:01Z", "pr_url": "https://github.com/Alluxio/alluxio/pull/12492", "timeline": [{"oid": "5a92db7f62ccafbb504d987adeec39a1bc3c164b", "url": "https://github.com/Alluxio/alluxio/commit/5a92db7f62ccafbb504d987adeec39a1bc3c164b", "message": "Support custom ufs module of hadoop by generate-tarball", "committedDate": "2020-11-12T04:55:28Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTg0NDUzNw==", "url": "https://github.com/Alluxio/alluxio/pull/12492#discussion_r521844537", "bodyText": "note that the key for ufsModules can be approximately derived from the name of the module. what do you think about simplifying the format of customUfsModuleFlag to <name>,<maven args>? for example, it would look like -custom-ufs-module \"hadoop-x.y,-pl underfs/hdfs -Pufs-hadoop-X -Dufs.hadoop.version=X.X.X\"\nafter checking that the string splits into 2 parts, set ufsModules[\"ufs-\"+customUfsModuleFlagArray[0]] = module{customUfsModuleFlagArray[0], true, customUfsModuleFlagArray[1]}", "author": "Xenorith", "createdAt": "2020-11-12T05:15:55Z", "path": "dev/scripts/src/alluxio.org/build-distribution/cmd/generate-tarball.go", "diffHunk": "@@ -48,6 +48,16 @@ func Single(args []string) error {\n \tadditionalFlags(singleCmd)\n \tsingleCmd.Parse(args[2:]) // error handling by flag.ExitOnError\n \n+\tif customUfsModuleFlag != \"\" {\n+\t\tcustomUfsModuleFlagArray := strings.Split(customUfsModuleFlag, \",\")\n+\t\tif len(customUfsModuleFlagArray) == 3 {\n+\t\t\tufsModules[customUfsModuleFlagArray[0]] =", "originalCommit": "5a92db7f62ccafbb504d987adeec39a1bc3c164b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTg2MjcxMw==", "url": "https://github.com/Alluxio/alluxio/pull/12492#discussion_r521862713", "bodyText": "Good suggestion, done", "author": "maobaolong", "createdAt": "2020-11-12T06:16:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTg0NDUzNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTg0NTEyNg==", "url": "https://github.com/Alluxio/alluxio/pull/12492#discussion_r521845126", "bodyText": "please describe the format in addition to providing an example. if we go with my suggestion of providing a name and maven args, then i would set the description string to be:\n\"a comma-separated pair of the module name and its maven arguments. ex. hadoop-x.y,-pl underfs/hdfs -Pufs-hadoop-X -Dufs.hadoop.version=x.y.z\"", "author": "Xenorith", "createdAt": "2020-11-12T05:17:54Z", "path": "dev/scripts/src/alluxio.org/build-distribution/cmd/root.go", "diffHunk": "@@ -44,4 +45,5 @@ func additionalFlags(cmd *flag.FlagSet) {\n \tcmd.BoolVar(&debugFlag, \"debug\", false, \"whether to run this tool in debug mode to generate additional console output\")\n \tcmd.StringVar(&ufsModulesFlag, \"ufs-modules\", strings.Join(defaultModules(ufsModules), \",\"),\n \t\tfmt.Sprintf(\"a comma-separated list of ufs modules to compile into the distribution tarball(s). Specify 'all' to build all ufs modules. Supported ufs modules: [%v]\", strings.Join(validModules(ufsModules), \",\")))\n+\tcmd.StringVar(&customUfsModuleFlag, \"custom-ufs-module\", \"\", \"ufs-hadoop-x.x,hadoop-x.x,-pl underfs/hdfs -Pufs-hadoop-X -Dufs.hadoop.version=X.X.X\")", "originalCommit": "5a92db7f62ccafbb504d987adeec39a1bc3c164b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTg2MTgyMA==", "url": "https://github.com/Alluxio/alluxio/pull/12492#discussion_r521861820", "bodyText": "Thanks", "author": "maobaolong", "createdAt": "2020-11-12T06:14:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTg0NTEyNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTg0NTU4OA==", "url": "https://github.com/Alluxio/alluxio/pull/12492#discussion_r521845588", "bodyText": "reorder alphabetically; put customUfsModuleFlag at the top", "author": "Xenorith", "createdAt": "2020-11-12T05:19:23Z", "path": "dev/scripts/src/alluxio.org/build-distribution/cmd/root.go", "diffHunk": "@@ -18,8 +18,9 @@ import (\n )\n \n var (\n-\tdebugFlag bool\n-\tufsModulesFlag string\n+\tdebugFlag           bool", "originalCommit": "5a92db7f62ccafbb504d987adeec39a1bc3c164b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTg2MTQ2OA==", "url": "https://github.com/Alluxio/alluxio/pull/12492#discussion_r521861468", "bodyText": "OK", "author": "maobaolong", "createdAt": "2020-11-12T06:12:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTg0NTU4OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTg0NTg0OA==", "url": "https://github.com/Alluxio/alluxio/pull/12492#discussion_r521845848", "bodyText": "alphabetical order, move this line before defining the debug flag", "author": "Xenorith", "createdAt": "2020-11-12T05:20:01Z", "path": "dev/scripts/src/alluxio.org/build-distribution/cmd/root.go", "diffHunk": "@@ -44,4 +45,5 @@ func additionalFlags(cmd *flag.FlagSet) {\n \tcmd.BoolVar(&debugFlag, \"debug\", false, \"whether to run this tool in debug mode to generate additional console output\")\n \tcmd.StringVar(&ufsModulesFlag, \"ufs-modules\", strings.Join(defaultModules(ufsModules), \",\"),\n \t\tfmt.Sprintf(\"a comma-separated list of ufs modules to compile into the distribution tarball(s). Specify 'all' to build all ufs modules. Supported ufs modules: [%v]\", strings.Join(validModules(ufsModules), \",\")))\n+\tcmd.StringVar(&customUfsModuleFlag, \"custom-ufs-module\", \"\", \"ufs-hadoop-x.x,hadoop-x.x,-pl underfs/hdfs -Pufs-hadoop-X -Dufs.hadoop.version=X.X.X\")", "originalCommit": "5a92db7f62ccafbb504d987adeec39a1bc3c164b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTg2MTQ5Mw==", "url": "https://github.com/Alluxio/alluxio/pull/12492#discussion_r521861493", "bodyText": "Done", "author": "maobaolong", "createdAt": "2020-11-12T06:12:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTg0NTg0OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTg0NTkzMw==", "url": "https://github.com/Alluxio/alluxio/pull/12492#discussion_r521845933", "bodyText": "was this for debugging?", "author": "Xenorith", "createdAt": "2020-11-12T05:20:19Z", "path": "dev/scripts/src/alluxio.org/build-distribution/cmd/generate-tarball.go", "diffHunk": "@@ -339,7 +349,7 @@ func generateTarball(hadoopClients []string, skipUI bool, skipHelm bool) error {\n \tchdir(cwd)\n \tos.Setenv(\"COPYFILE_DISABLE\", \"1\")\n \trun(\"creating the new distribution tarball\", \"tar\", \"-czvf\", tarball, dstDir)\n-\trun(\"removing the temporary repositories\", \"rm\", \"-rf\", srcPath, dstPath)\n+\trun(\"removing the temporary repositories\", \"ls\", \"-l\", srcPath, dstPath)", "originalCommit": "5a92db7f62ccafbb504d987adeec39a1bc3c164b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTg2MDc1OA==", "url": "https://github.com/Alluxio/alluxio/pull/12492#discussion_r521860758", "bodyText": "Yeah, exactly, will revert it.", "author": "maobaolong", "createdAt": "2020-11-12T06:10:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTg0NTkzMw=="}], "type": "inlineReview"}, {"oid": "380717d1c99cf132e91c7c840f069234eb3a6b5e", "url": "https://github.com/Alluxio/alluxio/commit/380717d1c99cf132e91c7c840f069234eb3a6b5e", "message": "Address comments, make custom ufs option more convenient.", "committedDate": "2020-11-12T06:18:24Z", "type": "commit"}]}