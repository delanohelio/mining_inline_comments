{"pr_number": 11270, "pr_title": "Improve Journal Operation doc", "pr_createdAt": "2020-04-11T01:08:43Z", "pr_url": "https://github.com/Alluxio/alluxio/pull/11270", "timeline": [{"oid": "80ac306393fea92a6966c192936b44b9ca35431d", "url": "https://github.com/Alluxio/alluxio/commit/80ac306393fea92a6966c192936b44b9ca35431d", "message": "Add alluxio.master.journal.type to Journal doc", "committedDate": "2020-04-11T01:23:11Z", "type": "commit"}, {"oid": "80ac306393fea92a6966c192936b44b9ca35431d", "url": "https://github.com/Alluxio/alluxio/commit/80ac306393fea92a6966c192936b44b9ca35431d", "message": "Add alluxio.master.journal.type to Journal doc", "committedDate": "2020-04-11T01:23:11Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjk5OTcyOA==", "url": "https://github.com/Alluxio/alluxio/pull/11270#discussion_r406999728", "bodyText": "only the leading master writes edit logs? since we're talking about fault tolerance, we should make it clear which master type, the leading master vs the backup masters", "author": "Xenorith", "createdAt": "2020-04-11T01:27:08Z", "path": "docs/en/operation/Journal.md", "diffHunk": "@@ -9,29 +9,38 @@ priority: 5\n * Table of Contents\n {:toc}\n \n-Alluxio is fault-tolerant: force-killing the system will not lose metadata. To achieve\n-this, the master writes edit logs of all metadata changes. On startup,\n-a recovering master will read the edit logs to restore itself back to its previous state.\n+Alluxio is fault-tolerant: force-killing the system will not lose metadata.\n+To achieve this, the master writes edit logs of all metadata changes (e.g., creating files,", "originalCommit": "80ac306393fea92a6966c192936b44b9ca35431d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzY2NzkxNQ==", "url": "https://github.com/Alluxio/alluxio/pull/11270#discussion_r407667915", "bodyText": "it is more complicated: journal is written even we have a single master. In addition, I want to avoid introducing too many concepts", "author": "apc999", "createdAt": "2020-04-13T19:24:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjk5OTcyOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzY3NjUzNw==", "url": "https://github.com/Alluxio/alluxio/pull/11270#discussion_r407676537", "bodyText": "in that case, we could simplify it further by removing any mention of fault tolerance. maybe just jump right into the writing of the journal metadata. for example, start off the doc with:\nAlluxio keeps an edit log of all metadata related changes, such as creating files or renaming directories. This edit log is referred to as the journal. Upon startup, the Alluxio master will replay all the steps recorded in the journal to recover its last saved state. The purpose of this documentation is to help Alluxio administrators understand and manage the Alluxio journal.", "author": "Xenorith", "createdAt": "2020-04-13T19:41:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjk5OTcyOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzY4NjY1Nw==", "url": "https://github.com/Alluxio/alluxio/pull/11270#discussion_r407686657", "bodyText": "SG", "author": "apc999", "createdAt": "2020-04-13T20:00:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjk5OTcyOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzAwMDEwMg==", "url": "https://github.com/Alluxio/alluxio/pull/11270#discussion_r407000102", "bodyText": "There are two types of journals that Alluxio is able to use, EMBEDDED or UFS.\nStarting from 2.2, the default journal type is EMBEDDED.\nThis can be changed by setting the property \"alluxio.master.journal.type\" to \"UFS\" instead of \"EMBEDDED\".", "author": "Xenorith", "createdAt": "2020-04-11T01:30:11Z", "path": "docs/en/operation/Journal.md", "diffHunk": "@@ -9,29 +9,38 @@ priority: 5\n * Table of Contents\n {:toc}\n \n-Alluxio is fault-tolerant: force-killing the system will not lose metadata. To achieve\n-this, the master writes edit logs of all metadata changes. On startup,\n-a recovering master will read the edit logs to restore itself back to its previous state.\n+Alluxio is fault-tolerant: force-killing the system will not lose metadata.\n+To achieve this, the master writes edit logs of all metadata changes (e.g., creating files,\n+renaming directories).\n+On startup, a recovering master will read the edit logs to restore itself back to its previous state.\n We use the term \"journal\" to refer to the system of edit logs used to support fault-tolerance.\n The purpose of this documentation is to help Alluxio administrators understand and manage the Alluxio journal.\n \n ## UFS Journal vs Embedded Journal\n \n-The UFS journal simplifies certain aspects of Alluxio operation, but it relies on \n-an external Zookeeper cluster for coordination, and relies on a UFS for persistent storage. \n-To get reasonable performance, the UFS journal requires a UFS that supports fast streaming writes, \n-such as HDFS or NFS.\n-\n-The embedded journal does its own coordination and persistent storage, which comes with a limitation on fault tolerance.\n-`n` masters using the embedded journal can tolerate only `floor(n/2)` master failures, \n-compared to `n-1` for UFS journal. For example, With `3` masters, UFS journal can tolerate `2` failures, \n-while embedded journal can only tolerate `1`. However, UFS journal depends on Zookeeper, \n+By setting property \"`alluxio.master.journal.type`\" to \"`UFS`\" or \"`EMBEDDED`\" (default since 2.2),", "originalCommit": "80ac306393fea92a6966c192936b44b9ca35431d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzAwMDE0Mw==", "url": "https://github.com/Alluxio/alluxio/pull/11270#discussion_r407000143", "bodyText": "switch order of the two types, since embedded is the default", "author": "Xenorith", "createdAt": "2020-04-11T01:30:39Z", "path": "docs/en/operation/Journal.md", "diffHunk": "@@ -9,29 +9,38 @@ priority: 5\n * Table of Contents\n {:toc}\n \n-Alluxio is fault-tolerant: force-killing the system will not lose metadata. To achieve\n-this, the master writes edit logs of all metadata changes. On startup,\n-a recovering master will read the edit logs to restore itself back to its previous state.\n+Alluxio is fault-tolerant: force-killing the system will not lose metadata.\n+To achieve this, the master writes edit logs of all metadata changes (e.g., creating files,\n+renaming directories).\n+On startup, a recovering master will read the edit logs to restore itself back to its previous state.\n We use the term \"journal\" to refer to the system of edit logs used to support fault-tolerance.\n The purpose of this documentation is to help Alluxio administrators understand and manage the Alluxio journal.\n \n ## UFS Journal vs Embedded Journal\n \n-The UFS journal simplifies certain aspects of Alluxio operation, but it relies on \n-an external Zookeeper cluster for coordination, and relies on a UFS for persistent storage. \n-To get reasonable performance, the UFS journal requires a UFS that supports fast streaming writes, \n-such as HDFS or NFS.\n-\n-The embedded journal does its own coordination and persistent storage, which comes with a limitation on fault tolerance.\n-`n` masters using the embedded journal can tolerate only `floor(n/2)` master failures, \n-compared to `n-1` for UFS journal. For example, With `3` masters, UFS journal can tolerate `2` failures, \n-while embedded journal can only tolerate `1`. However, UFS journal depends on Zookeeper, \n+By setting property \"`alluxio.master.journal.type`\" to \"`UFS`\" or \"`EMBEDDED`\" (default since 2.2),\n+Alluxio can switch between using UFS journal and using embedded journal as explained below.\n+\n+- The **UFS journal** stores edit logs in a UFS storage.\n+When using a single Alluxio master, this UFS can be a local storage;\n+when using multiple Alluxio masters for high availablity (HA mode),\n+this UFS storage must be shared among masters for read and write access.\n+UFS journal simplifies certain aspects of Alluxio operation, but it relies on\n+an external Zookeeper cluster for coordination (for HA mode), and relies on a UFS for persistent storage.\n+To get reasonable performance, the UFS journal requires a UFS that supports fast streaming writes,\n+such as HDFS or NFS. In contrast, S3 is not recommended to be used for UFS journal.\n+\n+- The **embedded journal** stores edit logs on each master's local persistent storage with its own", "originalCommit": "80ac306393fea92a6966c192936b44b9ca35431d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "9c637b689b1f1333db1d5ab075eca49dd4c1c1f9", "url": "https://github.com/Alluxio/alluxio/commit/9c637b689b1f1333db1d5ab075eca49dd4c1c1f9", "message": "address comments", "committedDate": "2020-04-13T20:15:17Z", "type": "forcePushed"}, {"oid": "fceeaf02152b97516443c92b3e8fc1992ca14f6e", "url": "https://github.com/Alluxio/alluxio/commit/fceeaf02152b97516443c92b3e8fc1992ca14f6e", "message": "address comments", "committedDate": "2020-04-13T20:23:22Z", "type": "commit"}, {"oid": "fceeaf02152b97516443c92b3e8fc1992ca14f6e", "url": "https://github.com/Alluxio/alluxio/commit/fceeaf02152b97516443c92b3e8fc1992ca14f6e", "message": "address comments", "committedDate": "2020-04-13T20:23:22Z", "type": "forcePushed"}]}