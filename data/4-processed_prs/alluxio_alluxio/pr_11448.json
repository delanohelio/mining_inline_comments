{"pr_number": 11448, "pr_title": "[DOCFIX] Improve S3 documentation", "pr_createdAt": "2020-05-18T08:43:29Z", "pr_url": "https://github.com/Alluxio/alluxio/pull/11448", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQ2NDEzOA==", "url": "https://github.com/Alluxio/alluxio/pull/11448#discussion_r426464138", "bodyText": "totally irrelevant for this doc. I Don't understand why it was put here initally.", "author": "apc999", "createdAt": "2020-05-18T08:45:24Z", "path": "docs/en/ufs/S3.md", "diffHunk": "@@ -162,36 +162,6 @@ alluxio.underfs.s3.proxy.port=<PROXY_PORT>\n \n `<PROXY_HOST>` and `<PROXY_PORT>` should be replaced the host and port for your proxy.\n \n-### Configuring Application Dependency", "originalCommit": "e6f865a81615718f90046b4c8a37659c4e5e02e1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "3bd7180da913deadac92aaff6d087e7851e9bf4d", "url": "https://github.com/Alluxio/alluxio/commit/3bd7180da913deadac92aaff6d087e7851e9bf4d", "message": "Improve S3 documentation", "committedDate": "2020-05-18T08:59:07Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQ5OTMzNw==", "url": "https://github.com/Alluxio/alluxio/pull/11448#discussion_r426499337", "bodyText": "The Alluxio master loads the ACL information of object and bucket upon initially requesting for their metadata.\nunless you have more specific details about the translation, i dont think the second part of the sentence is necessary since you already said that the master loads the info in the first half and stated that alluxio makes a best effort to inherit permissions in the previous sentence", "author": "Xenorith", "createdAt": "2020-05-18T09:42:00Z", "path": "docs/en/ufs/S3.md", "diffHunk": "@@ -279,44 +249,92 @@ alluxio.underfs.s3.upload.threads.max=80\n alluxio.underfs.object.store.service.threads=80\n ```\n \n-## S3 Access Control\n+## Identity and Access Control of S3 Objects\n+\n+[S3 identity and access management](https://docs.aws.amazon.com/AmazonS3/latest/dev/s3-access-control.html)\n+is very different from the security model of a UNIX-like file system\n+(e.g., S3 ACL has no groups and no directory-level setting).\n+Alluxio makes a best effort to inherit file owner and permission bits from S3 ACL information.\n+Alluxio master loads the ACL information of objects and buckets on the first time when their", "originalCommit": "3bd7180da913deadac92aaff6d087e7851e9bf4d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzU1MTIyOA==", "url": "https://github.com/Alluxio/alluxio/pull/11448#discussion_r427551228", "bodyText": "agree , second part is unnecessary details in context here", "author": "apc999", "createdAt": "2020-05-19T19:35:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQ5OTMzNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQ5OTk0Mg==", "url": "https://github.com/Alluxio/alluxio/pull/11448#discussion_r426499942", "bodyText": "You are using the correct AWS credentials, defined in ???", "author": "Xenorith", "createdAt": "2020-05-18T09:43:01Z", "path": "docs/en/ufs/S3.md", "diffHunk": "@@ -279,44 +249,92 @@ alluxio.underfs.s3.upload.threads.max=80\n alluxio.underfs.object.store.service.threads=80\n ```\n \n-## S3 Access Control\n+## Identity and Access Control of S3 Objects\n+\n+[S3 identity and access management](https://docs.aws.amazon.com/AmazonS3/latest/dev/s3-access-control.html)\n+is very different from the security model of a UNIX-like file system\n+(e.g., S3 ACL has no groups and no directory-level setting).\n+Alluxio makes a best effort to inherit file owner and permission bits from S3 ACL information.\n+Alluxio master loads the ACL information of objects and buckets on the first time when their\n+metadata is requested, then translates it to Alluxio permission and store the metadata information\n+as a part of Alluxio filesystem metadata.\n+\n+### Why is 403 Access Denied Error Returned\n+\n+The S3 credentials set in Alluxio configuration corresponds to an AWS user.\n+If this user does not have the required permissions to access an S3 bucket or object,\n+a 403 permission denied error will be returned.\n \n-If Alluxio security is enabled, Alluxio enforces the access control inherited from underlying object\n-storage.\n+If you see 403 error in Alluxio server log when accessing a S3 service, you should double check\n+1. you are using the correct credentials", "originalCommit": "3bd7180da913deadac92aaff6d087e7851e9bf4d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzU1MjkyOA==", "url": "https://github.com/Alluxio/alluxio/pull/11448#discussion_r427552928", "bodyText": "added a link", "author": "apc999", "createdAt": "2020-05-19T19:38:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQ5OTk0Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjUwMjM0Mg==", "url": "https://github.com/Alluxio/alluxio/pull/11448#discussion_r426502342", "bodyText": "Your AWS user has permissions to access the buckets and objects mounted to Alluxio.", "author": "Xenorith", "createdAt": "2020-05-18T09:47:00Z", "path": "docs/en/ufs/S3.md", "diffHunk": "@@ -279,44 +249,92 @@ alluxio.underfs.s3.upload.threads.max=80\n alluxio.underfs.object.store.service.threads=80\n ```\n \n-## S3 Access Control\n+## Identity and Access Control of S3 Objects\n+\n+[S3 identity and access management](https://docs.aws.amazon.com/AmazonS3/latest/dev/s3-access-control.html)\n+is very different from the security model of a UNIX-like file system\n+(e.g., S3 ACL has no groups and no directory-level setting).\n+Alluxio makes a best effort to inherit file owner and permission bits from S3 ACL information.\n+Alluxio master loads the ACL information of objects and buckets on the first time when their\n+metadata is requested, then translates it to Alluxio permission and store the metadata information\n+as a part of Alluxio filesystem metadata.\n+\n+### Why is 403 Access Denied Error Returned\n+\n+The S3 credentials set in Alluxio configuration corresponds to an AWS user.\n+If this user does not have the required permissions to access an S3 bucket or object,\n+a 403 permission denied error will be returned.\n \n-If Alluxio security is enabled, Alluxio enforces the access control inherited from underlying object\n-storage.\n+If you see 403 error in Alluxio server log when accessing a S3 service, you should double check\n+1. you are using the correct credentials\n+1. your AWS user does have the permission to access the buckets and objects mounted to Alluxio", "originalCommit": "3bd7180da913deadac92aaff6d087e7851e9bf4d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjUwMzMzOA==", "url": "https://github.com/Alluxio/alluxio/pull/11448#discussion_r426503338", "bodyText": "trouble-shooting -> troubleshooting", "author": "Xenorith", "createdAt": "2020-05-18T09:48:26Z", "path": "docs/en/ufs/S3.md", "diffHunk": "@@ -279,44 +249,92 @@ alluxio.underfs.s3.upload.threads.max=80\n alluxio.underfs.object.store.service.threads=80\n ```\n \n-## S3 Access Control\n+## Identity and Access Control of S3 Objects\n+\n+[S3 identity and access management](https://docs.aws.amazon.com/AmazonS3/latest/dev/s3-access-control.html)\n+is very different from the security model of a UNIX-like file system\n+(e.g., S3 ACL has no groups and no directory-level setting).\n+Alluxio makes a best effort to inherit file owner and permission bits from S3 ACL information.\n+Alluxio master loads the ACL information of objects and buckets on the first time when their\n+metadata is requested, then translates it to Alluxio permission and store the metadata information\n+as a part of Alluxio filesystem metadata.\n+\n+### Why is 403 Access Denied Error Returned\n+\n+The S3 credentials set in Alluxio configuration corresponds to an AWS user.\n+If this user does not have the required permissions to access an S3 bucket or object,\n+a 403 permission denied error will be returned.\n \n-If Alluxio security is enabled, Alluxio enforces the access control inherited from underlying object\n-storage.\n+If you see 403 error in Alluxio server log when accessing a S3 service, you should double check\n+1. you are using the correct credentials\n+1. your AWS user does have the permission to access the buckets and objects mounted to Alluxio\n \n-The S3 credentials specified in Alluxio config represents a S3 user. S3 service backend checks the\n-user permission to the bucket and the object for access control. If the given S3 user does not have\n-the access permissions to the specified bucket, a permission denied error will be thrown. When\n-Alluxio security is enabled, Alluxio loads the bucket ACL to Alluxio permission on the first time\n-when the metadata is loaded to Alluxio namespace.\n+Read more [trouble-shooting guidance](https://aws.amazon.com/premiumsupport/knowledge-center/s3-troubleshoot-403/)", "originalCommit": "3bd7180da913deadac92aaff6d087e7851e9bf4d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjUwMzczMA==", "url": "https://github.com/Alluxio/alluxio/pull/11448#discussion_r426503730", "bodyText": "Optionally, the property", "author": "Xenorith", "createdAt": "2020-05-18T09:49:07Z", "path": "docs/en/ufs/S3.md", "diffHunk": "@@ -279,44 +249,92 @@ alluxio.underfs.s3.upload.threads.max=80\n alluxio.underfs.object.store.service.threads=80\n ```\n \n-## S3 Access Control\n+## Identity and Access Control of S3 Objects\n+\n+[S3 identity and access management](https://docs.aws.amazon.com/AmazonS3/latest/dev/s3-access-control.html)\n+is very different from the security model of a UNIX-like file system\n+(e.g., S3 ACL has no groups and no directory-level setting).\n+Alluxio makes a best effort to inherit file owner and permission bits from S3 ACL information.\n+Alluxio master loads the ACL information of objects and buckets on the first time when their\n+metadata is requested, then translates it to Alluxio permission and store the metadata information\n+as a part of Alluxio filesystem metadata.\n+\n+### Why is 403 Access Denied Error Returned\n+\n+The S3 credentials set in Alluxio configuration corresponds to an AWS user.\n+If this user does not have the required permissions to access an S3 bucket or object,\n+a 403 permission denied error will be returned.\n \n-If Alluxio security is enabled, Alluxio enforces the access control inherited from underlying object\n-storage.\n+If you see 403 error in Alluxio server log when accessing a S3 service, you should double check\n+1. you are using the correct credentials\n+1. your AWS user does have the permission to access the buckets and objects mounted to Alluxio\n \n-The S3 credentials specified in Alluxio config represents a S3 user. S3 service backend checks the\n-user permission to the bucket and the object for access control. If the given S3 user does not have\n-the access permissions to the specified bucket, a permission denied error will be thrown. When\n-Alluxio security is enabled, Alluxio loads the bucket ACL to Alluxio permission on the first time\n-when the metadata is loaded to Alluxio namespace.\n+Read more [trouble-shooting guidance](https://aws.amazon.com/premiumsupport/knowledge-center/s3-troubleshoot-403/)\n+for 403 error from AWS.\n \n-### Mapping from S3 user to Alluxio file owner\n+### File Owner and Group\n \n-By default, Alluxio tries to extract the S3 user display name from the S3 credentials. Optionally,\n+Alluxio file system infers the file owner from the metadata of S3 buckets and objects.\n+Since there is no group in S3 ACL, the owner is reused as the group.\n+\n+By default, Alluxio extracts the display name of the AWS user.\n+In case this display name is not available,\n+Alluxio sets file owner to this AWS user's [canonical user ID](https://docs.aws.amazon.com/general/latest/gr/acct-identifiers.html).\n+\n+This canonical user id is typically a long string like `79a59df900b949e55d96a1e698fbacedfd6e09d98eacf8f8d5218e7cd47ef2be`,\n+often inconvenient to read and use in practice.\n+Optionally, property", "originalCommit": "3bd7180da913deadac92aaff6d087e7851e9bf4d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjUwNDI1OA==", "url": "https://github.com/Alluxio/alluxio/pull/11448#discussion_r426504258", "bodyText": "owned by the user", "author": "Xenorith", "createdAt": "2020-05-18T09:49:57Z", "path": "docs/en/ufs/S3.md", "diffHunk": "@@ -279,44 +249,92 @@ alluxio.underfs.s3.upload.threads.max=80\n alluxio.underfs.object.store.service.threads=80\n ```\n \n-## S3 Access Control\n+## Identity and Access Control of S3 Objects\n+\n+[S3 identity and access management](https://docs.aws.amazon.com/AmazonS3/latest/dev/s3-access-control.html)\n+is very different from the security model of a UNIX-like file system\n+(e.g., S3 ACL has no groups and no directory-level setting).\n+Alluxio makes a best effort to inherit file owner and permission bits from S3 ACL information.\n+Alluxio master loads the ACL information of objects and buckets on the first time when their\n+metadata is requested, then translates it to Alluxio permission and store the metadata information\n+as a part of Alluxio filesystem metadata.\n+\n+### Why is 403 Access Denied Error Returned\n+\n+The S3 credentials set in Alluxio configuration corresponds to an AWS user.\n+If this user does not have the required permissions to access an S3 bucket or object,\n+a 403 permission denied error will be returned.\n \n-If Alluxio security is enabled, Alluxio enforces the access control inherited from underlying object\n-storage.\n+If you see 403 error in Alluxio server log when accessing a S3 service, you should double check\n+1. you are using the correct credentials\n+1. your AWS user does have the permission to access the buckets and objects mounted to Alluxio\n \n-The S3 credentials specified in Alluxio config represents a S3 user. S3 service backend checks the\n-user permission to the bucket and the object for access control. If the given S3 user does not have\n-the access permissions to the specified bucket, a permission denied error will be thrown. When\n-Alluxio security is enabled, Alluxio loads the bucket ACL to Alluxio permission on the first time\n-when the metadata is loaded to Alluxio namespace.\n+Read more [trouble-shooting guidance](https://aws.amazon.com/premiumsupport/knowledge-center/s3-troubleshoot-403/)\n+for 403 error from AWS.\n \n-### Mapping from S3 user to Alluxio file owner\n+### File Owner and Group\n \n-By default, Alluxio tries to extract the S3 user display name from the S3 credentials. Optionally,\n+Alluxio file system infers the file owner from the metadata of S3 buckets and objects.\n+Since there is no group in S3 ACL, the owner is reused as the group.\n+\n+By default, Alluxio extracts the display name of the AWS user.\n+In case this display name is not available,\n+Alluxio sets file owner to this AWS user's [canonical user ID](https://docs.aws.amazon.com/general/latest/gr/acct-identifiers.html).\n+\n+This canonical user id is typically a long string like `79a59df900b949e55d96a1e698fbacedfd6e09d98eacf8f8d5218e7cd47ef2be`,\n+often inconvenient to read and use in practice.\n+Optionally, property\n `alluxio.underfs.s3.owner.id.to.username.mapping` can be used to specify a preset S3 canonical id to\n-Alluxio username static mapping, in the format \"id1=user1;id2=user2\".  The AWS S3 canonical ID can\n-be found at the console `https://console.aws.amazon.com/iam/home?#/security_credentials`.\n-Please expand the \"Account Identifiers\" tab and refer to \"Canonical User ID\".\n+Alluxio username static mapping, in the format \"id1=user1;id2=user2\".\n+For example, edit `alluxio-site.properties` to include\n+\n+```properties\n+alluxio.underfs.s3.owner.id.to.username.mapping=\\\n+79a59df900b949e55d96a1e698fbacedfd6e09d98eacf8f8d5218e7cd47ef2be=john\n+```\n+\n+This configuration helps Alluxio recognize all objects owned by this AWS account as owned by user `john` in Alluxio namespace.", "originalCommit": "3bd7180da913deadac92aaff6d087e7851e9bf4d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjUwNDQ1Nw==", "url": "https://github.com/Alluxio/alluxio/pull/11448#discussion_r426504457", "bodyText": "To find the AWS S3 canonical ID of your account,", "author": "Xenorith", "createdAt": "2020-05-18T09:50:16Z", "path": "docs/en/ufs/S3.md", "diffHunk": "@@ -279,44 +249,92 @@ alluxio.underfs.s3.upload.threads.max=80\n alluxio.underfs.object.store.service.threads=80\n ```\n \n-## S3 Access Control\n+## Identity and Access Control of S3 Objects\n+\n+[S3 identity and access management](https://docs.aws.amazon.com/AmazonS3/latest/dev/s3-access-control.html)\n+is very different from the security model of a UNIX-like file system\n+(e.g., S3 ACL has no groups and no directory-level setting).\n+Alluxio makes a best effort to inherit file owner and permission bits from S3 ACL information.\n+Alluxio master loads the ACL information of objects and buckets on the first time when their\n+metadata is requested, then translates it to Alluxio permission and store the metadata information\n+as a part of Alluxio filesystem metadata.\n+\n+### Why is 403 Access Denied Error Returned\n+\n+The S3 credentials set in Alluxio configuration corresponds to an AWS user.\n+If this user does not have the required permissions to access an S3 bucket or object,\n+a 403 permission denied error will be returned.\n \n-If Alluxio security is enabled, Alluxio enforces the access control inherited from underlying object\n-storage.\n+If you see 403 error in Alluxio server log when accessing a S3 service, you should double check\n+1. you are using the correct credentials\n+1. your AWS user does have the permission to access the buckets and objects mounted to Alluxio\n \n-The S3 credentials specified in Alluxio config represents a S3 user. S3 service backend checks the\n-user permission to the bucket and the object for access control. If the given S3 user does not have\n-the access permissions to the specified bucket, a permission denied error will be thrown. When\n-Alluxio security is enabled, Alluxio loads the bucket ACL to Alluxio permission on the first time\n-when the metadata is loaded to Alluxio namespace.\n+Read more [trouble-shooting guidance](https://aws.amazon.com/premiumsupport/knowledge-center/s3-troubleshoot-403/)\n+for 403 error from AWS.\n \n-### Mapping from S3 user to Alluxio file owner\n+### File Owner and Group\n \n-By default, Alluxio tries to extract the S3 user display name from the S3 credentials. Optionally,\n+Alluxio file system infers the file owner from the metadata of S3 buckets and objects.\n+Since there is no group in S3 ACL, the owner is reused as the group.\n+\n+By default, Alluxio extracts the display name of the AWS user.\n+In case this display name is not available,\n+Alluxio sets file owner to this AWS user's [canonical user ID](https://docs.aws.amazon.com/general/latest/gr/acct-identifiers.html).\n+\n+This canonical user id is typically a long string like `79a59df900b949e55d96a1e698fbacedfd6e09d98eacf8f8d5218e7cd47ef2be`,\n+often inconvenient to read and use in practice.\n+Optionally, property\n `alluxio.underfs.s3.owner.id.to.username.mapping` can be used to specify a preset S3 canonical id to\n-Alluxio username static mapping, in the format \"id1=user1;id2=user2\".  The AWS S3 canonical ID can\n-be found at the console `https://console.aws.amazon.com/iam/home?#/security_credentials`.\n-Please expand the \"Account Identifiers\" tab and refer to \"Canonical User ID\".\n+Alluxio username static mapping, in the format \"id1=user1;id2=user2\".\n+For example, edit `alluxio-site.properties` to include\n+\n+```properties\n+alluxio.underfs.s3.owner.id.to.username.mapping=\\\n+79a59df900b949e55d96a1e698fbacedfd6e09d98eacf8f8d5218e7cd47ef2be=john\n+```\n+\n+This configuration helps Alluxio recognize all objects owned by this AWS account as owned by user `john` in Alluxio namespace.\n+To find out the AWS S3 canonical ID,", "originalCommit": "3bd7180da913deadac92aaff6d087e7851e9bf4d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjUwNTI2NQ==", "url": "https://github.com/Alluxio/alluxio/pull/11448#discussion_r426505265", "bodyText": "my own question: does alluxio ignore if there are object specific permissions in the bucket? because i can set a up bucket with no permissions and selectively give access to certain object prefixes within the bucket", "author": "Xenorith", "createdAt": "2020-05-18T09:51:30Z", "path": "docs/en/ufs/S3.md", "diffHunk": "@@ -279,44 +249,92 @@ alluxio.underfs.s3.upload.threads.max=80\n alluxio.underfs.object.store.service.threads=80\n ```\n \n-## S3 Access Control\n+## Identity and Access Control of S3 Objects\n+\n+[S3 identity and access management](https://docs.aws.amazon.com/AmazonS3/latest/dev/s3-access-control.html)\n+is very different from the security model of a UNIX-like file system\n+(e.g., S3 ACL has no groups and no directory-level setting).\n+Alluxio makes a best effort to inherit file owner and permission bits from S3 ACL information.\n+Alluxio master loads the ACL information of objects and buckets on the first time when their\n+metadata is requested, then translates it to Alluxio permission and store the metadata information\n+as a part of Alluxio filesystem metadata.\n+\n+### Why is 403 Access Denied Error Returned\n+\n+The S3 credentials set in Alluxio configuration corresponds to an AWS user.\n+If this user does not have the required permissions to access an S3 bucket or object,\n+a 403 permission denied error will be returned.\n \n-If Alluxio security is enabled, Alluxio enforces the access control inherited from underlying object\n-storage.\n+If you see 403 error in Alluxio server log when accessing a S3 service, you should double check\n+1. you are using the correct credentials\n+1. your AWS user does have the permission to access the buckets and objects mounted to Alluxio\n \n-The S3 credentials specified in Alluxio config represents a S3 user. S3 service backend checks the\n-user permission to the bucket and the object for access control. If the given S3 user does not have\n-the access permissions to the specified bucket, a permission denied error will be thrown. When\n-Alluxio security is enabled, Alluxio loads the bucket ACL to Alluxio permission on the first time\n-when the metadata is loaded to Alluxio namespace.\n+Read more [trouble-shooting guidance](https://aws.amazon.com/premiumsupport/knowledge-center/s3-troubleshoot-403/)\n+for 403 error from AWS.\n \n-### Mapping from S3 user to Alluxio file owner\n+### File Owner and Group\n \n-By default, Alluxio tries to extract the S3 user display name from the S3 credentials. Optionally,\n+Alluxio file system infers the file owner from the metadata of S3 buckets and objects.\n+Since there is no group in S3 ACL, the owner is reused as the group.\n+\n+By default, Alluxio extracts the display name of the AWS user.\n+In case this display name is not available,\n+Alluxio sets file owner to this AWS user's [canonical user ID](https://docs.aws.amazon.com/general/latest/gr/acct-identifiers.html).\n+\n+This canonical user id is typically a long string like `79a59df900b949e55d96a1e698fbacedfd6e09d98eacf8f8d5218e7cd47ef2be`,\n+often inconvenient to read and use in practice.\n+Optionally, property\n `alluxio.underfs.s3.owner.id.to.username.mapping` can be used to specify a preset S3 canonical id to\n-Alluxio username static mapping, in the format \"id1=user1;id2=user2\".  The AWS S3 canonical ID can\n-be found at the console `https://console.aws.amazon.com/iam/home?#/security_credentials`.\n-Please expand the \"Account Identifiers\" tab and refer to \"Canonical User ID\".\n+Alluxio username static mapping, in the format \"id1=user1;id2=user2\".\n+For example, edit `alluxio-site.properties` to include\n+\n+```properties\n+alluxio.underfs.s3.owner.id.to.username.mapping=\\\n+79a59df900b949e55d96a1e698fbacedfd6e09d98eacf8f8d5218e7cd47ef2be=john\n+```\n+\n+This configuration helps Alluxio recognize all objects owned by this AWS account as owned by user `john` in Alluxio namespace.\n+To find out the AWS S3 canonical ID,\n+check the console `https://console.aws.amazon.com/iam/home?#/security_credentials`,\n+expand the \"Account Identifiers\" tab and refer to \"Canonical User ID\".\n \n-### Mapping from S3 ACL to Alluxio permission\n+### File Permission\n \n Alluxio checks the S3 bucket read/write ACLs to determine the owner's permissions to a Alluxio\n-file. For example, if the S3 user has read-only access to the underlying bucket, the mounted\n-directory and files will be set with 0500 permissions. If the S3 user has full access to the underlying bucket,\n-the mounted directory and files will be set with 0700 permissions.\n+file.\n+For example, if the AWS user has read-only access to the mounted bucket, the mounted\n+directory and files will be set with `0500` permissions.\n+If the AWS user has full access to the underlying bucket,\n+the mounted directory and files will be set with `0700` permissions.\n+", "originalCommit": "3bd7180da913deadac92aaff6d087e7851e9bf4d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzU1OTU0MQ==", "url": "https://github.com/Alluxio/alluxio/pull/11448#discussion_r427559541", "bodyText": "based on the source code, it looks like so. double checking it with calvin who wrote it", "author": "apc999", "createdAt": "2020-05-19T19:50:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjUwNTI2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzU4MjA4Mg==", "url": "https://github.com/Alluxio/alluxio/pull/11448#discussion_r427582082", "bodyText": "maybe worth mentioning if it is the case. something like Note that Alluxio only checks bucket ACLs when determining filesystem permissions and does not check the ACLS of each individual object.", "author": "Xenorith", "createdAt": "2020-05-19T20:32:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjUwNTI2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzU5MTY1Mw==", "url": "https://github.com/Alluxio/alluxio/pull/11448#discussion_r427591653", "bodyText": "added", "author": "apc999", "createdAt": "2020-05-19T20:50:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjUwNTI2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjUwNTgxOA==", "url": "https://github.com/Alluxio/alluxio/pull/11448#discussion_r426505818", "bodyText": "one can either", "author": "Xenorith", "createdAt": "2020-05-18T09:52:25Z", "path": "docs/en/ufs/S3.md", "diffHunk": "@@ -279,44 +249,92 @@ alluxio.underfs.s3.upload.threads.max=80\n alluxio.underfs.object.store.service.threads=80\n ```\n \n-## S3 Access Control\n+## Identity and Access Control of S3 Objects\n+\n+[S3 identity and access management](https://docs.aws.amazon.com/AmazonS3/latest/dev/s3-access-control.html)\n+is very different from the security model of a UNIX-like file system\n+(e.g., S3 ACL has no groups and no directory-level setting).\n+Alluxio makes a best effort to inherit file owner and permission bits from S3 ACL information.\n+Alluxio master loads the ACL information of objects and buckets on the first time when their\n+metadata is requested, then translates it to Alluxio permission and store the metadata information\n+as a part of Alluxio filesystem metadata.\n+\n+### Why is 403 Access Denied Error Returned\n+\n+The S3 credentials set in Alluxio configuration corresponds to an AWS user.\n+If this user does not have the required permissions to access an S3 bucket or object,\n+a 403 permission denied error will be returned.\n \n-If Alluxio security is enabled, Alluxio enforces the access control inherited from underlying object\n-storage.\n+If you see 403 error in Alluxio server log when accessing a S3 service, you should double check\n+1. you are using the correct credentials\n+1. your AWS user does have the permission to access the buckets and objects mounted to Alluxio\n \n-The S3 credentials specified in Alluxio config represents a S3 user. S3 service backend checks the\n-user permission to the bucket and the object for access control. If the given S3 user does not have\n-the access permissions to the specified bucket, a permission denied error will be thrown. When\n-Alluxio security is enabled, Alluxio loads the bucket ACL to Alluxio permission on the first time\n-when the metadata is loaded to Alluxio namespace.\n+Read more [trouble-shooting guidance](https://aws.amazon.com/premiumsupport/knowledge-center/s3-troubleshoot-403/)\n+for 403 error from AWS.\n \n-### Mapping from S3 user to Alluxio file owner\n+### File Owner and Group\n \n-By default, Alluxio tries to extract the S3 user display name from the S3 credentials. Optionally,\n+Alluxio file system infers the file owner from the metadata of S3 buckets and objects.\n+Since there is no group in S3 ACL, the owner is reused as the group.\n+\n+By default, Alluxio extracts the display name of the AWS user.\n+In case this display name is not available,\n+Alluxio sets file owner to this AWS user's [canonical user ID](https://docs.aws.amazon.com/general/latest/gr/acct-identifiers.html).\n+\n+This canonical user id is typically a long string like `79a59df900b949e55d96a1e698fbacedfd6e09d98eacf8f8d5218e7cd47ef2be`,\n+often inconvenient to read and use in practice.\n+Optionally, property\n `alluxio.underfs.s3.owner.id.to.username.mapping` can be used to specify a preset S3 canonical id to\n-Alluxio username static mapping, in the format \"id1=user1;id2=user2\".  The AWS S3 canonical ID can\n-be found at the console `https://console.aws.amazon.com/iam/home?#/security_credentials`.\n-Please expand the \"Account Identifiers\" tab and refer to \"Canonical User ID\".\n+Alluxio username static mapping, in the format \"id1=user1;id2=user2\".\n+For example, edit `alluxio-site.properties` to include\n+\n+```properties\n+alluxio.underfs.s3.owner.id.to.username.mapping=\\\n+79a59df900b949e55d96a1e698fbacedfd6e09d98eacf8f8d5218e7cd47ef2be=john\n+```\n+\n+This configuration helps Alluxio recognize all objects owned by this AWS account as owned by user `john` in Alluxio namespace.\n+To find out the AWS S3 canonical ID,\n+check the console `https://console.aws.amazon.com/iam/home?#/security_credentials`,\n+expand the \"Account Identifiers\" tab and refer to \"Canonical User ID\".\n \n-### Mapping from S3 ACL to Alluxio permission\n+### File Permission\n \n Alluxio checks the S3 bucket read/write ACLs to determine the owner's permissions to a Alluxio\n-file. For example, if the S3 user has read-only access to the underlying bucket, the mounted\n-directory and files will be set with 0500 permissions. If the S3 user has full access to the underlying bucket,\n-the mounted directory and files will be set with 0700 permissions.\n+file.\n+For example, if the AWS user has read-only access to the mounted bucket, the mounted\n+directory and files will be set with `0500` permissions.\n+If the AWS user has full access to the underlying bucket,\n+the mounted directory and files will be set with `0700` permissions.\n+\n+With `0500` or `0700` as the default file permissions, Alluxio file system users other than the\n+file owner can not access the files under the moun point.\n+This can lead to problems for data shared by different applications running under a different users.\n+For example, a Presto job running under user `presto` may result in an error like\n+`Query failed: Failed to list directory` when accessing the mount point with owner `john`.\n+In  `master.log`, one can find an error like\n+```\n+Error=alluxio.exception.AccessControlException: Permission denied: user=presto, access=--x, path=/mnt/s3/myobject: failed at s3, inode owner=john, inode group=john, inode mode=rwx------\n+```\n \n-### Mount point sharing\n+This is because the mounted directory has permission `0700` and thus application user `presto`\n+is not able to access this file.\n+To share the S3 mount point with other users in Alluxio namespace, one can choose:", "originalCommit": "3bd7180da913deadac92aaff6d087e7851e9bf4d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjUwNjIzMg==", "url": "https://github.com/Alluxio/alluxio/pull/11448#discussion_r426506232", "bodyText": "alluxio.master.mount.table.root.shared=?? is it a boolean to be set to true?", "author": "Xenorith", "createdAt": "2020-05-18T09:53:02Z", "path": "docs/en/ufs/S3.md", "diffHunk": "@@ -279,44 +249,92 @@ alluxio.underfs.s3.upload.threads.max=80\n alluxio.underfs.object.store.service.threads=80\n ```\n \n-## S3 Access Control\n+## Identity and Access Control of S3 Objects\n+\n+[S3 identity and access management](https://docs.aws.amazon.com/AmazonS3/latest/dev/s3-access-control.html)\n+is very different from the security model of a UNIX-like file system\n+(e.g., S3 ACL has no groups and no directory-level setting).\n+Alluxio makes a best effort to inherit file owner and permission bits from S3 ACL information.\n+Alluxio master loads the ACL information of objects and buckets on the first time when their\n+metadata is requested, then translates it to Alluxio permission and store the metadata information\n+as a part of Alluxio filesystem metadata.\n+\n+### Why is 403 Access Denied Error Returned\n+\n+The S3 credentials set in Alluxio configuration corresponds to an AWS user.\n+If this user does not have the required permissions to access an S3 bucket or object,\n+a 403 permission denied error will be returned.\n \n-If Alluxio security is enabled, Alluxio enforces the access control inherited from underlying object\n-storage.\n+If you see 403 error in Alluxio server log when accessing a S3 service, you should double check\n+1. you are using the correct credentials\n+1. your AWS user does have the permission to access the buckets and objects mounted to Alluxio\n \n-The S3 credentials specified in Alluxio config represents a S3 user. S3 service backend checks the\n-user permission to the bucket and the object for access control. If the given S3 user does not have\n-the access permissions to the specified bucket, a permission denied error will be thrown. When\n-Alluxio security is enabled, Alluxio loads the bucket ACL to Alluxio permission on the first time\n-when the metadata is loaded to Alluxio namespace.\n+Read more [trouble-shooting guidance](https://aws.amazon.com/premiumsupport/knowledge-center/s3-troubleshoot-403/)\n+for 403 error from AWS.\n \n-### Mapping from S3 user to Alluxio file owner\n+### File Owner and Group\n \n-By default, Alluxio tries to extract the S3 user display name from the S3 credentials. Optionally,\n+Alluxio file system infers the file owner from the metadata of S3 buckets and objects.\n+Since there is no group in S3 ACL, the owner is reused as the group.\n+\n+By default, Alluxio extracts the display name of the AWS user.\n+In case this display name is not available,\n+Alluxio sets file owner to this AWS user's [canonical user ID](https://docs.aws.amazon.com/general/latest/gr/acct-identifiers.html).\n+\n+This canonical user id is typically a long string like `79a59df900b949e55d96a1e698fbacedfd6e09d98eacf8f8d5218e7cd47ef2be`,\n+often inconvenient to read and use in practice.\n+Optionally, property\n `alluxio.underfs.s3.owner.id.to.username.mapping` can be used to specify a preset S3 canonical id to\n-Alluxio username static mapping, in the format \"id1=user1;id2=user2\".  The AWS S3 canonical ID can\n-be found at the console `https://console.aws.amazon.com/iam/home?#/security_credentials`.\n-Please expand the \"Account Identifiers\" tab and refer to \"Canonical User ID\".\n+Alluxio username static mapping, in the format \"id1=user1;id2=user2\".\n+For example, edit `alluxio-site.properties` to include\n+\n+```properties\n+alluxio.underfs.s3.owner.id.to.username.mapping=\\\n+79a59df900b949e55d96a1e698fbacedfd6e09d98eacf8f8d5218e7cd47ef2be=john\n+```\n+\n+This configuration helps Alluxio recognize all objects owned by this AWS account as owned by user `john` in Alluxio namespace.\n+To find out the AWS S3 canonical ID,\n+check the console `https://console.aws.amazon.com/iam/home?#/security_credentials`,\n+expand the \"Account Identifiers\" tab and refer to \"Canonical User ID\".\n \n-### Mapping from S3 ACL to Alluxio permission\n+### File Permission\n \n Alluxio checks the S3 bucket read/write ACLs to determine the owner's permissions to a Alluxio\n-file. For example, if the S3 user has read-only access to the underlying bucket, the mounted\n-directory and files will be set with 0500 permissions. If the S3 user has full access to the underlying bucket,\n-the mounted directory and files will be set with 0700 permissions.\n+file.\n+For example, if the AWS user has read-only access to the mounted bucket, the mounted\n+directory and files will be set with `0500` permissions.\n+If the AWS user has full access to the underlying bucket,\n+the mounted directory and files will be set with `0700` permissions.\n+\n+With `0500` or `0700` as the default file permissions, Alluxio file system users other than the\n+file owner can not access the files under the moun point.\n+This can lead to problems for data shared by different applications running under a different users.\n+For example, a Presto job running under user `presto` may result in an error like\n+`Query failed: Failed to list directory` when accessing the mount point with owner `john`.\n+In  `master.log`, one can find an error like\n+```\n+Error=alluxio.exception.AccessControlException: Permission denied: user=presto, access=--x, path=/mnt/s3/myobject: failed at s3, inode owner=john, inode group=john, inode mode=rwx------\n+```\n \n-### Mount point sharing\n+This is because the mounted directory has permission `0700` and thus application user `presto`\n+is not able to access this file.\n+To share the S3 mount point with other users in Alluxio namespace, one can choose:\n \n-If you want to share the S3 mount point with other users in Alluxio namespace, you can enable\n-`alluxio.underfs.object.store.mount.shared.publicly`.\n+1. (Option1): Set\n+`alluxio.master.mount.table.root.shared` in `alluxio-site.properties` for root mount or add `--shared` on `fs mount` command;", "originalCommit": "3bd7180da913deadac92aaff6d087e7851e9bf4d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjUwNjU0Ng==", "url": "https://github.com/Alluxio/alluxio/pull/11448#discussion_r426506546", "bodyText": "File Permissions", "author": "Xenorith", "createdAt": "2020-05-18T09:53:33Z", "path": "docs/en/ufs/S3.md", "diffHunk": "@@ -279,44 +249,92 @@ alluxio.underfs.s3.upload.threads.max=80\n alluxio.underfs.object.store.service.threads=80\n ```\n \n-## S3 Access Control\n+## Identity and Access Control of S3 Objects\n+\n+[S3 identity and access management](https://docs.aws.amazon.com/AmazonS3/latest/dev/s3-access-control.html)\n+is very different from the security model of a UNIX-like file system\n+(e.g., S3 ACL has no groups and no directory-level setting).\n+Alluxio makes a best effort to inherit file owner and permission bits from S3 ACL information.\n+Alluxio master loads the ACL information of objects and buckets on the first time when their\n+metadata is requested, then translates it to Alluxio permission and store the metadata information\n+as a part of Alluxio filesystem metadata.\n+\n+### Why is 403 Access Denied Error Returned\n+\n+The S3 credentials set in Alluxio configuration corresponds to an AWS user.\n+If this user does not have the required permissions to access an S3 bucket or object,\n+a 403 permission denied error will be returned.\n \n-If Alluxio security is enabled, Alluxio enforces the access control inherited from underlying object\n-storage.\n+If you see 403 error in Alluxio server log when accessing a S3 service, you should double check\n+1. you are using the correct credentials\n+1. your AWS user does have the permission to access the buckets and objects mounted to Alluxio\n \n-The S3 credentials specified in Alluxio config represents a S3 user. S3 service backend checks the\n-user permission to the bucket and the object for access control. If the given S3 user does not have\n-the access permissions to the specified bucket, a permission denied error will be thrown. When\n-Alluxio security is enabled, Alluxio loads the bucket ACL to Alluxio permission on the first time\n-when the metadata is loaded to Alluxio namespace.\n+Read more [trouble-shooting guidance](https://aws.amazon.com/premiumsupport/knowledge-center/s3-troubleshoot-403/)\n+for 403 error from AWS.\n \n-### Mapping from S3 user to Alluxio file owner\n+### File Owner and Group\n \n-By default, Alluxio tries to extract the S3 user display name from the S3 credentials. Optionally,\n+Alluxio file system infers the file owner from the metadata of S3 buckets and objects.\n+Since there is no group in S3 ACL, the owner is reused as the group.\n+\n+By default, Alluxio extracts the display name of the AWS user.\n+In case this display name is not available,\n+Alluxio sets file owner to this AWS user's [canonical user ID](https://docs.aws.amazon.com/general/latest/gr/acct-identifiers.html).\n+\n+This canonical user id is typically a long string like `79a59df900b949e55d96a1e698fbacedfd6e09d98eacf8f8d5218e7cd47ef2be`,\n+often inconvenient to read and use in practice.\n+Optionally, property\n `alluxio.underfs.s3.owner.id.to.username.mapping` can be used to specify a preset S3 canonical id to\n-Alluxio username static mapping, in the format \"id1=user1;id2=user2\".  The AWS S3 canonical ID can\n-be found at the console `https://console.aws.amazon.com/iam/home?#/security_credentials`.\n-Please expand the \"Account Identifiers\" tab and refer to \"Canonical User ID\".\n+Alluxio username static mapping, in the format \"id1=user1;id2=user2\".\n+For example, edit `alluxio-site.properties` to include\n+\n+```properties\n+alluxio.underfs.s3.owner.id.to.username.mapping=\\\n+79a59df900b949e55d96a1e698fbacedfd6e09d98eacf8f8d5218e7cd47ef2be=john\n+```\n+\n+This configuration helps Alluxio recognize all objects owned by this AWS account as owned by user `john` in Alluxio namespace.\n+To find out the AWS S3 canonical ID,\n+check the console `https://console.aws.amazon.com/iam/home?#/security_credentials`,\n+expand the \"Account Identifiers\" tab and refer to \"Canonical User ID\".\n \n-### Mapping from S3 ACL to Alluxio permission\n+### File Permission", "originalCommit": "3bd7180da913deadac92aaff6d087e7851e9bf4d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjUwNjc1Mw==", "url": "https://github.com/Alluxio/alluxio/pull/11448#discussion_r426506753", "bodyText": "Prevent Creating Zero-byte Files", "author": "Xenorith", "createdAt": "2020-05-18T09:53:53Z", "path": "docs/en/ufs/S3.md", "diffHunk": "@@ -329,7 +347,8 @@ log4j.logger.org.apache.http.wire=DEBUG\n See [Amazon's documentation](https://docs.aws.amazon.com/sdk-for-java/v1/developer-guide/java-dg-logging.html)\n for more details.\n \n-Note: Alluxio creates zero-byte files in S3 as a performance optimization. For a bucket mounted with read-write\n+### Preventing Creating Zero-byte Files", "originalCommit": "3bd7180da913deadac92aaff6d087e7851e9bf4d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjUwNzE4Mw==", "url": "https://github.com/Alluxio/alluxio/pull/11448#discussion_r426507183", "bodyText": "set alluxio.master.mount.table.root.readonly=true for root mount ??", "author": "Xenorith", "createdAt": "2020-05-18T09:54:34Z", "path": "docs/en/ufs/S3.md", "diffHunk": "@@ -329,7 +347,8 @@ log4j.logger.org.apache.http.wire=DEBUG\n See [Amazon's documentation](https://docs.aws.amazon.com/sdk-for-java/v1/developer-guide/java-dg-logging.html)\n for more details.\n \n-Note: Alluxio creates zero-byte files in S3 as a performance optimization. For a bucket mounted with read-write\n+### Preventing Creating Zero-byte Files\n+Alluxio creates zero-byte files in S3 as a performance optimization. For a bucket mounted with read-write\n access, zero-byte file creation (S3 PUT operation) is not restricted to writes using Alluxio but also occurs\n when listing contents of the under storage. To disable the PUT operation, mount the bucket with the `--readonly`\n-flag.\n+flag or set `alluxio.master.mount.table.root.readonly` for root mount.", "originalCommit": "3bd7180da913deadac92aaff6d087e7851e9bf4d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "4978a93141ddd4a775d09b114fd3214cc218cd8a", "url": "https://github.com/Alluxio/alluxio/commit/4978a93141ddd4a775d09b114fd3214cc218cd8a", "message": "Improve S3 documentation", "committedDate": "2020-05-19T19:56:24Z", "type": "forcePushed"}, {"oid": "5d2a3ef194ecc5f03e098b39730cde1801dc1b7c", "url": "https://github.com/Alluxio/alluxio/commit/5d2a3ef194ecc5f03e098b39730cde1801dc1b7c", "message": "Improve S3 documentation", "committedDate": "2020-05-19T20:52:32Z", "type": "forcePushed"}, {"oid": "4e8f997c795a5cf4da45cc64b332c505ddde394a", "url": "https://github.com/Alluxio/alluxio/commit/4e8f997c795a5cf4da45cc64b332c505ddde394a", "message": "Improve S3 documentation", "committedDate": "2020-05-19T21:57:26Z", "type": "commit"}, {"oid": "4e8f997c795a5cf4da45cc64b332c505ddde394a", "url": "https://github.com/Alluxio/alluxio/commit/4e8f997c795a5cf4da45cc64b332c505ddde394a", "message": "Improve S3 documentation", "committedDate": "2020-05-19T21:57:26Z", "type": "forcePushed"}]}