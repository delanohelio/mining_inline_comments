{"pr_number": 12104, "pr_title": "Support dynamic user to run alluxio", "pr_createdAt": "2020-09-12T05:09:23Z", "pr_url": "https://github.com/Alluxio/alluxio/pull/12104", "timeline": [{"oid": "fa8e8d7de8c46e539e40da62286cada3579af4f7", "url": "https://github.com/Alluxio/alluxio/commit/fa8e8d7de8c46e539e40da62286cada3579af4f7", "message": "Support dynamic user to run alluxio", "committedDate": "2020-09-12T05:07:35Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQxOTE3Nw==", "url": "https://github.com/Alluxio/alluxio/pull/12104#discussion_r487419177", "bodyText": "@apc999 I'm concerned about the security implications. If we really have to give a 777 permission, I think at least there should be warnings in the printout and code comments saying that's high security risk.", "author": "jiacheliu3", "createdAt": "2020-09-12T15:14:30Z", "path": "integration/docker/Dockerfile", "diffHunk": "@@ -26,11 +27,16 @@ RUN cd /opt && \\\n     (if ls | grep -q \".tar.gz\"; then tar -xzf *.tar.gz && rm *.tar.gz; fi) && \\\n     ln -s alluxio-* alluxio\n \n+RUN if [ ${ENABLE_DYANMIC_USER} = \"true\" ] ; then \\", "originalCommit": "fa8e8d7de8c46e539e40da62286cada3579af4f7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQ2MTY0Nw==", "url": "https://github.com/Alluxio/alluxio/pull/12104#discussion_r487461647", "bodyText": "By default it's disabled, but if the user want to build it for the user which is not in alluxio docker image. They have flexibility to enable it.", "author": "cheyang", "createdAt": "2020-09-13T00:03:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQxOTE3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQ3NTEwMw==", "url": "https://github.com/Alluxio/alluxio/pull/12104#discussion_r487475103", "bodyText": "Yes, and I think in that case at least warnings should be given to the user in some printout (like echo?) and in the comment in the Dockerfile.", "author": "jiacheliu3", "createdAt": "2020-09-13T03:21:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQxOTE3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQ3ODU4Mw==", "url": "https://github.com/Alluxio/alluxio/pull/12104#discussion_r487478583", "bodyText": "Added", "author": "cheyang", "createdAt": "2020-09-13T04:14:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQxOTE3Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQ2MjUzMA==", "url": "https://github.com/Alluxio/alluxio/pull/12104#discussion_r487462530", "bodyText": "The journal is only accessed by Alluxio servers. Is there a case for running server containers not as root or Alluxio? Or is the requirement only for Alluxio client containers which can be a larger set of users?", "author": "madanadit", "createdAt": "2020-09-13T00:16:14Z", "path": "integration/docker/Dockerfile", "diffHunk": "@@ -61,6 +67,10 @@ COPY --chown=${ALLUXIO_USERNAME}:${ALLUXIO_GROUP} --from=extractor /opt/ /opt/\n COPY --chown=${ALLUXIO_USERNAME}:${ALLUXIO_GROUP} conf /opt/alluxio/conf/\n COPY --chown=${ALLUXIO_USERNAME}:${ALLUXIO_GROUP} entrypoint.sh /\n \n+RUN if [ ${ENABLE_DYANMIC_USER} = \"true\" ] ; then \\", "originalCommit": "fa8e8d7de8c46e539e40da62286cada3579af4f7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQ3NzU3Mg==", "url": "https://github.com/Alluxio/alluxio/pull/12104#discussion_r487477572", "bodyText": "The user case is that:\nevery user in data scientist team has own NFS directory, and this directory is only accessible by his account. root  or alluxio account doesn't work. so alluxio container has to be run as the same user account. I tried to ask them to use the same gid, but they also have many teams.", "author": "cheyang", "createdAt": "2020-09-13T03:59:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQ2MjUzMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQ3Nzk0Mg==", "url": "https://github.com/Alluxio/alluxio/pull/12104#discussion_r487477942", "bodyText": "And I also wonder what's the real risk to make alluxio binary can be run by other users. And is there any simple sample for me to understand better? In Kubernetes, the user can be only set the uid, gid in security context.", "author": "cheyang", "createdAt": "2020-09-13T04:04:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQ2MjUzMA=="}], "type": "inlineReview"}, {"oid": "0ef00121c9cda6031a273c1a4e4fa804ee90cf36", "url": "https://github.com/Alluxio/alluxio/commit/0ef00121c9cda6031a273c1a4e4fa804ee90cf36", "message": "add warning", "committedDate": "2020-09-13T04:14:02Z", "type": "commit"}]}