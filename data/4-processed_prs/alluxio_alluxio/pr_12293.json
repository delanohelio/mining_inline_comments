{"pr_number": 12293, "pr_title": "Suppress more spammy Ratis logs", "pr_createdAt": "2020-10-14T17:43:13Z", "pr_url": "https://github.com/Alluxio/alluxio/pull/12293", "timeline": [{"oid": "9d9f3ddfd1d8be46980569d978d79347d0e4e20b", "url": "https://github.com/Alluxio/alluxio/commit/9d9f3ddfd1d8be46980569d978d79347d0e4e20b", "message": "Suppress more spammy Ratis logs", "committedDate": "2020-10-14T17:41:27Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDg2MTc1Mg==", "url": "https://github.com/Alluxio/alluxio/pull/12293#discussion_r504861752", "bodyText": "Do we also want to ignore the WARN level logs for GrpcLogAppender?", "author": "HelloHorizon", "createdAt": "2020-10-14T17:47:50Z", "path": "conf/log4j.properties", "diffHunk": "@@ -181,6 +181,7 @@ log4j.appender.FUSE_LOGGER.layout.ConversionPattern=%d{ISO8601} %-5p %c{1} - %m%\n log4j.logger.io.grpc.netty.NettyServerHandler=OFF\n \n # Disable noisy INFO logs from ratis\n+log4j.logger.org.apache.ratis.grpc.server.GrpcLogAppender=ERROR", "originalCommit": "9d9f3ddfd1d8be46980569d978d79347d0e4e20b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDg2OTc4OA==", "url": "https://github.com/Alluxio/alluxio/pull/12293#discussion_r504869788", "bodyText": "Yes this line tells log4j to only record ERROR level logs and ignore INFO or WARN level logs.", "author": "bf8086", "createdAt": "2020-10-14T18:00:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDg2MTc1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDg3MTQ2Mw==", "url": "https://github.com/Alluxio/alluxio/pull/12293#discussion_r504871463", "bodyText": "Is there any reason for us to disable the WARN level log for GrpcLogAppender? Will it filter out some useful WARN level logs?", "author": "HelloHorizon", "createdAt": "2020-10-14T18:04:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDg2MTc1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDg3ODUzOQ==", "url": "https://github.com/Alluxio/alluxio/pull/12293#discussion_r504878539", "bodyText": "The main purpose is to suppress the excessive messages from GrpcLogAppender when a follower is offline:\n2020-10-14 17:56:30,594 WARN  GrpcLogAppender - FaultToleranceScaleEmbeddedJournal1-masters-1_19200@group-ABB3109A44C1->FaultToleranceScaleEmbeddedJournal1-masters-4_19200-InstallSnapshotResponseHandler: Failed InstallSnapshot: org.apache.ratis.thirdparty.io.grpc.StatusRuntimeException: UNAVAILABLE: io exception\n2020-10-14 17:56:30,594 INFO  GrpcLogAppender - FaultToleranceScaleEmbeddedJournal1-masters-1_19200@group-ABB3109A44C1->FaultToleranceScaleEmbeddedJournal1-masters-4_19200-GrpcLogAppender: followerNextIndex = 0 but logStartIndex = 24044765, notify follower to install snapshot-(t:188, i:24044765)\n2020-10-14 17:56:30,594 INFO  GrpcLogAppender - FaultToleranceScaleEmbeddedJournal1-masters-1_19200@group-ABB3109A44C1->FaultToleranceScaleEmbeddedJournal1-masters-4_19200-GrpcLogAppender: send FaultToleranceScaleEmbeddedJournal1-masters-1_19200->FaultToleranceScaleEmbeddedJournal1-masters-4_19200#0-t212,notify:(t:188, i:24044765)\n2020-10-14 17:56:30,595 WARN  GrpcLogAppender - FaultToleranceScaleEmbeddedJournal1-masters-1_19200@group-ABB3109A44C1->FaultToleranceScaleEmbeddedJournal1-masters-4_19200-InstallSnapshotResponseHandler: Failed InstallSnapshot: org.apache.ratis.thirdparty.io.grpc.StatusRuntimeException: UNAVAILABLE: io exception\n2020-10-14 17:56:30,595 INFO  GrpcLogAppender - FaultToleranceScaleEmbeddedJournal1-masters-1_19200@group-ABB3109A44C1->FaultToleranceScaleEmbeddedJournal1-masters-4_19200-GrpcLogAppender: followerNextIndex = 0 but logStartIndex = 24044765, notify follower to install snapshot-(t:188, i:24044765)\n2020-10-14 17:56:30,595 INFO  GrpcLogAppender - FaultToleranceScaleEmbeddedJournal1-masters-1_19200@group-ABB3109A44C1->FaultToleranceScaleEmbeddedJournal1-masters-4_19200-GrpcLogAppender: send FaultToleranceScaleEmbeddedJournal1-masters-1_19200->FaultToleranceScaleEmbeddedJournal1-masters-4_19200#0-t212,notify:(t:188, i:24044765)\n2020-10-14 17:56:30,595 WARN  GrpcLogAppender - FaultToleranceScaleEmbeddedJournal1-masters-1_19200@group-ABB3109A44C1->FaultToleranceScaleEmbeddedJournal1-masters-4_19200-InstallSnapshotResponseHandler: Failed InstallSnapshot: org.apache.ratis.thirdparty.io.grpc.StatusRuntimeException: UNAVAILABLE: io exception\n2020-10-14 17:56:30,595 INFO  GrpcLogAppender - FaultToleranceScaleEmbeddedJournal1-masters-1_19200@group-ABB3109A44C1->FaultToleranceScaleEmbeddedJournal1-masters-4_19200-GrpcLogAppender: followerNextIndex = 0 but logStartIndex = 24044765, notify follower to install snapshot-(t:188, i:24044765)\n2020-10-14 17:56:30,595 INFO  GrpcLogAppender - FaultToleranceScaleEmbeddedJournal1-masters-1_19200@group-ABB3109A44C1->FaultToleranceScaleEmbeddedJournal1-masters-4_19200-GrpcLogAppender: send FaultToleranceScaleEmbeddedJournal1-masters-1_19200->FaultToleranceScaleEmbeddedJournal1-masters-4_19200#0-t212,notify:(t:188, i:24044765)\n2020-10-14 17:56:30,596 WARN  GrpcLogAppender - FaultToleranceScaleEmbeddedJournal1-masters-1_19200@group-ABB3109A44C1->FaultToleranceScaleEmbeddedJournal1-masters-4_19200-InstallSnapshotResponseHandler: Failed InstallSnapshot: org.apache.ratis.thirdparty.io.grpc.StatusRuntimeException: UNAVAILABLE: io exception\n2020-10-14 17:56:30,596 INFO  GrpcLogAppender - FaultToleranceScaleEmbeddedJournal1-masters-1_19200@group-ABB3109A44C1->FaultToleranceScaleEmbeddedJournal1-masters-4_19200-GrpcLogAppender: followerNextIndex = 0 but logStartIndex = 24044765, notify follower to install snapshot-(t:188, i:24044765)\n...", "author": "bf8086", "createdAt": "2020-10-14T18:16:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDg2MTc1Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDg2MjQ1NA==", "url": "https://github.com/Alluxio/alluxio/pull/12293#discussion_r504862454", "bodyText": "Are there useful ERROR log in this class beside the annoying one?", "author": "LuQQiu", "createdAt": "2020-10-14T17:48:56Z", "path": "conf/log4j.properties", "diffHunk": "@@ -181,6 +181,7 @@ log4j.appender.FUSE_LOGGER.layout.ConversionPattern=%d{ISO8601} %-5p %c{1} - %m%\n log4j.logger.io.grpc.netty.NettyServerHandler=OFF\n \n # Disable noisy INFO logs from ratis\n+log4j.logger.org.apache.ratis.grpc.server.GrpcLogAppender=ERROR", "originalCommit": "9d9f3ddfd1d8be46980569d978d79347d0e4e20b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDg3MDYyMQ==", "url": "https://github.com/Alluxio/alluxio/pull/12293#discussion_r504870621", "bodyText": "This line will still allow log4j to show ERROR level logs for this class. I am sure there are useful WARN and INFO level logs, we can re-enable them per use case when we need to debug certain issues.", "author": "bf8086", "createdAt": "2020-10-14T18:02:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDg2MjQ1NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDg3NTMxMw==", "url": "https://github.com/Alluxio/alluxio/pull/12293#discussion_r504875313", "bodyText": "that's dangerous.... emmm...", "author": "LuQQiu", "createdAt": "2020-10-14T18:10:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDg2MjQ1NA=="}], "type": "inlineReview"}]}