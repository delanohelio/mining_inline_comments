{"pr_number": 11873, "pr_title": "[DOCFIX] Add Chinese Spark on Kubernetes Doc", "pr_createdAt": "2020-08-02T01:30:18Z", "pr_url": "https://github.com/Alluxio/alluxio/pull/11873", "timeline": [{"oid": "6d90bd27afdef1fa7975bb204d2a8e05f988a2e9", "url": "https://github.com/Alluxio/alluxio/commit/6d90bd27afdef1fa7975bb204d2a8e05f988a2e9", "message": "Test", "committedDate": "2020-08-01T03:42:08Z", "type": "commit"}, {"oid": "3e4897f07103c938747260edb4ba50315c604fd3", "url": "https://github.com/Alluxio/alluxio/commit/3e4897f07103c938747260edb4ba50315c604fd3", "message": "Update Architecture.md", "committedDate": "2020-08-01T03:42:08Z", "type": "commit"}, {"oid": "08b21c393269aa755d8b31c1f5e6a9ccef4e9af3", "url": "https://github.com/Alluxio/alluxio/commit/08b21c393269aa755d8b31c1f5e6a9ccef4e9af3", "message": "Add Chinese Spark K8 Doc", "committedDate": "2020-08-02T01:28:58Z", "type": "commit"}, {"oid": "f5386c7d7c9bb9d00063327a67d1f0f08c25a56f", "url": "https://github.com/Alluxio/alluxio/commit/f5386c7d7c9bb9d00063327a67d1f0f08c25a56f", "message": "Fix", "committedDate": "2020-08-02T01:29:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDAzODQwMQ==", "url": "https://github.com/Alluxio/alluxio/pull/11873#discussion_r464038401", "bodyText": "{% endnavtab %}", "author": "Xenorith", "createdAt": "2020-08-02T06:29:13Z", "path": "docs/cn/compute/Spark-On-Kubernetes.md", "diffHunk": "@@ -0,0 +1,202 @@\n+---\n+layout: global\n+title: Kubernetes\u73af\u5883\u4e0b\u5728Alluxio\u4e0a\u8fd0\u884cSpark\n+nickname: Spark on Kubernetes\n+group: Compute Integrations\n+priority: 7\n+---\n+\n+Alluxio\u53ef\u4ee5\u5728Kubernetes\u4e0a\u8fd0\u884c\u3002\u672c\u6307\u5357\u6f14\u793a\u4e86\u5982\u4f55\u5728Kubernetes\u73af\u5883\u4e0b\u8fd0\u884c\u7684Alluxio\u4e0a\u8dd1\u4e00\u4e2aSpark\u4f5c\u4e1a\u3002\n+\n+* Table of Contents\n+{:toc}\n+\n+##\u6982\u8ff0\n+\n+\u5728Kubernetes\u4e0a\u8fd0\u884c\u7684Spark\u53ef\u4ee5\u5c06Alluxio\u7528\u4f5c\u6570\u636e\u8bbf\u95ee\u5c42\u3002\n+\u672c\u6307\u5357\u4ecb\u7ecd\u4e86Kubernetes\u73af\u5883\u4e0b\u5728Alluxio\u4e0a\u8fd0\u884cSpark\u4f5c\u4e1a\u793a\u4f8b\u3002\n+\u672c\u6559\u7a0b\u4e2d\u4f7f\u7528\u7684\u793a\u4f8b\u662f\u4e00\u4e2a\u8ba1\u7b97\u4e00\u4e2a\u6587\u4ef6\u4e2d\u6709\u591a\u5c11\u884c\u7684\u4f5c\u4e1a\u3002\n+\u5728\u4e0b\u6587\u4e2d\uff0c\u6211\u4eec\u5c06\u6b64\u4f5c\u4e1a\u79f0\u4e3a count\u3002\n+\n+##\u5148\u51b3\u6761\u4ef6\n+\n+-Kubernetes\u96c6\u7fa4(\u7248\u672c> = 1.8)\u3002\n+-Alluxio\u5df2\u90e8\u7f72\u5728Kubernetes\u96c6\u7fa4\u4e0a\u3002\u6709\u5173\u5982\u4f55\u90e8\u7f72Alluxio\u7684\u8bf4\u660e\uff0c\u8bf7\u53c2\u8003\n+[\u672c\u9875]({{ '/en/deploy/Running-Alluxio-On-Kubernetes.html' | relativize_url}})\n+\n+##\u57fa\u672c\u8bbe\u7f6e\n+\n+\u9996\u5148\uff0c\u6211\u4eec\u51c6\u5907\u4e00\u4e2aSpark Docker\u955c\u50cf\uff0c\u5176\u4e2d\u5305\u62ecAlluxio\u5ba2\u6237\u7aef\u548c\u4efb\u4f55\u5176\u4ed6\u5fc5\u9700\u7684jar\u6587\u4ef6\u3002\n+\u5728\u6240\u6709Kubernetes\u8282\u70b9\u4e0a\u90fd\u9700\u63d0\u4f9b\u6b64\u955c\u50cf\u3002\n+\n+###\u4e0b\u8f7d\u4e8c\u8fdb\u5236\u6587\u4ef6\n+\n+[\u4e0b\u8f7d](https://spark.apache.org/downloads.html)\u6240\u9700\u7684Spark\u7248\u672c\u3002\n+\u5bf9\u4e8e`spark-submit`\u547d\u4ee4\u548c\u4f7f\u7528Alluxio\u6240\u542b\u7684Dockerfile\u7f16\u8bd1Docker\u955c\u50cf\n+\u6211\u4eec\u90fd\u4f7f\u7528\u9884\u751f\u6210\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\uff0c\u3002\n+>\u6ce8:\u4e0b\u8f7d\u4e3aHadoop\u9884\u5236\u7684\u8f6f\u4ef6\u5305\n+\n+```console\n+$ tar -xf spark-2.4.4-bin-hadoop2.7.tgz\n+$ cd spark-2.4.4-bin-hadoop2.7\n+```\n+###\u7f16\u8bd1Spark Docker\u955c\u50cf\n+\n+\u4eceAlluxio Docker\u955c\u50cf\u4e2d\u63d0\u53d6Alluxio\u5ba2\u6237\u7aefjar:\n+\n+```console\n+$ id=$(docker create alluxio/alluxio:{{site.ALLUXIO_VERSION_STRING}})\n+$ docker cp $id:/opt/alluxio/client/alluxio-{{site.ALLUXIO_VERSION_STRING}}-client.jar \\\n+  - > alluxio-{{site.ALLUXIO_VERSION_STRING}}-client.jar\n+$ docker rm -v $id 1>/dev/null\n+```\n+\n+\u6dfb\u52a0\u6240\u9700\u7684Alluxio\u5ba2\u6237\u7aefjar\u5e76\u6784\u5efa\u7528\u4e8eSpark\u9a71\u52a8\u7a0b\u5e8f\u548c\u6267\u884c\u7a0b\u5e8fpods\u7684Docker\u955c\u50cf\u3002\n+\u4eceSpark\u53d1\u884c\u7248\u76ee\u5f55\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\u4ee5\u6dfb\u52a0Alluxio\u5ba2\u6237\u7aefjar\u3002\n+\n+```console\n+$ cp <path_to_alluxio_client>/alluxio-{{site.ALLUXIO_VERSION_STRING}}-client.jar jars/\n+```\n+>\u6ce8\u610f:\u4efb\u4f55\u590d\u5236\u5230`jars`\u76ee\u5f55\u7684jar\u6587\u4ef6\u5728\u7f16\u8bd1\u65f6\u90fd\u4f1a\u88ab\u5305\u542b\u5230Spark Docker\u955c\u50cf\u4e2d\u3002\n+\n+\u7f16\u8bd1Spark Docker\u955c\u50cf\n+\n+```console\n+$ docker build -t spark-alluxio -f kubernetes/dockerfiles/spark/Dockerfile .\n+```\n+>\u6ce8\u610f:\u786e\u4fdd\u6240\u6709\u8282\u70b9(spark-driver\u548cspark-executor pods\u5c06\u8fd0\u884c\u7684\u6240\u5728\u8282\u70b9) \n+\u90fd\u6709\u8be5\u955c\u50cf\u3002\n+\n+##\u793a\u4f8b\n+\n+\u672c\u8282\u8bf4\u660e\u5982\u4f55\u4f7f\u7528\u7f16\u8bd1\u7684Docker\u955c\u50cf\u6765\u53d1\u8d77\u4e00\u4e2a\u4ee5Alluxio\u4f5c\u4e3a\u6570\u636e\u6e90\u7684Spark\u4f5c\u4e1a\u3002\n+\n+###\u77ed\u8def\u64cd\u4f5c\n+\n+\u77ed\u8def\u8bbf\u95ee\u4f7fSpark\u6267\u884c\u5668\u4e2d\u7684Alluxio\u5ba2\u6237\u7aef\u53ef\u4ee5\u76f4\u63a5\u8bbf\u95ee\n+\u4e3b\u673a\u4e0a\u7684Alluxio worker\u5b58\u50a8\u3002\n+\u56e0\u4e3a\u4e0d\u901a\u8fc7\u7f51\u7edc\u5806\u6808\u6765\u4e0eAlluxio worker\u901a\u4fe1\uff0c\u8fd9\u6837\u53ef\u4ee5\u63d0\u9ad8\u6027\u80fd\u3002\n+\n+\u5982\u679c\u5728\u90e8\u7f72Alluxio\u65f6\u672a\u6309\u7167\u6307\u4ee4\u8bbe\u7f6e\u57df\u5957\u63a5\u5b57\n+][\u672c\u9875]({{ '/en/deploy/Running-Alluxio-On-Kubernetes.html' | relativize_url}}\uff03short-circuit-access)\uff0c\u5219\n+\u53ef\u4ee5\u8df3\u8fc7\u5c06`hostPath`\u5377\u6302\u8f7d\u5230Spark\u6267\u884c\u5668\u6b65\u9aa4\u3002\n+\n+\u5982\u679c\u5728\u8fd0\u884cAlluxio worker\u8fdb\u7a0b\u7684\u4e3b\u673a\u4e0a\u5c06\u57df\u5957\u63a5\u5b57\u4f4d\u7f6e\u8bbe\u7f6e\u4e3a\n+`/tmp/alluxio-domain`\uff0c\u5e76\u4e14Alluxio\u914d\u7f6e\u4e3a\n+`alluxio.worker.data.server.domain.socket.address=/opt/domain`\uff0c\u4f7f\u7528\u4ee5\u4e0bSpark\n+\u914d\u7f6e\u5c06`/tmp/alluxio-domain`\u6302\u8f7d\u5230Spark\u6267\u884c\u5668pod\u4e2d\u7684`/opt/domain`\u3002\n+\u4e0b\u4e00\u8282\u4e2d\u7684`spark-submit`\u547d\u4ee4\u5305\u542b\u8fd9\u4e9b\u5c5e\u6027\u3002\n+\n+\u53d6\u51b3\u4e8e\u4f60\u7684\u8bbe\u7f6e\uff0cAlluxio worker\u4e0a\u7684\u57df\u5957\u63a5\u5b57\u53ef\u4ee5\u662f`hostPath`\u5377\u6216`PersistententVolumeClaim`\u4e24\u79cd\u4e4b\u4e00\u3002\u53ef\u4ee5\u5728\u6b64\u5904\u627e\u5230\u6709\u5173\u5982\u4f55\u914d\u7f6eAlluxio worker\u4ee5\u4f7f\u7528\u77ed\u8def\u64cd\u4f5c\u7684\u66f4\u591a\u8be6\u7ec6\u4fe1\u606f \n+({{ '/en/deploy/Running-Alluxio-On-Kubernetes.html#short-circuit-access' | relativize_url}})\u3002\n+\u8fd9\u4e24\u4e2a\u9009\u9879\u7684spark-submit\u53c2\u6570\u5c06\u6709\u6240\u4e0d\u540c\u3002\n+\u53ef\u4ee5\u5728\u4ee5\u4e0bSpark\u6587\u6863\u4e2d\u627e\u5230\u6709\u5173\u5982\u4f55\u5c06\u5377\u6302\u8f7d\u5230Spark\u6267\u884c\u5668\u7684\u66f4\u591a[\u4fe1\u606f](https://spark.apache.org/docs/2.4.4/running-on-kubernetes.html#using-kubernetes-volumes)\u3002\n+\n+{% navtabs domainSocket %}\n+  {% navtab hostPath %}\n+  \u5982\u679c\u4f7f\u7528\u7684\u662fhostPath\u57df\u5957\u63a5\u5b57\uff0c\u5219\u5e94\u5c06\u4ee5\u4e0b\u5c5e\u6027\u4f20\u9012\u7ed9Spark:\n+  \n+  ```properties\n+  spark.kubernetes.executor.volumes.hostPath.alluxio-domain.mount.path=/opt/domain\n+  spark.kubernetes.executor.volumes.hostPath.alluxio-domain.mount.readOnly=true\n+  spark.kubernetes.executor.volumes.hostPath.alluxio-domain.options.path=/tmp/alluxio-domain\n+  spark.kubernetes.executor.volumes.hostPath.alluxio-domain.options.type=Directory\n+  ```\n+ \n+{% endnavtab %}\n+  {% navtab PersistententVolumeClaim %}\n+  \u5982\u679c\u4f7f\u7528\u7684\u662fPersistententVolumeClaim\u57df\u5957\u63a5\u5b57\uff0c\u5219\u5e94\u5c06\u4ee5\u4e0b\u5c5e\u6027\u4f20\u9012\u7ed9Spark:\n+  \n+  ```properties\n+  spark.kubernetes.executor.volumes.persistentVolumeClaim.alluxio-domain.mount.path=/opt/domain \\\n+  spark.kubernetes.executor.volumes.persistentVolumeClaim.alluxio-domain.mount.readOnly=true \\\n+  spark.kubernetes.executor.volumes.persistentVolumeClaim.alluxio-domain.options.claimName=<domainSocketPVC name>\n+  ```\n+  \n+  {% endnavtabs %}", "originalCommit": "f5386c7d7c9bb9d00063327a67d1f0f08c25a56f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDEyODEwMw==", "url": "https://github.com/Alluxio/alluxio/pull/11873#discussion_r464128103", "bodyText": "these two lines are still incorrect. they should be:\n  {% endnavtab %}\n{% endnavtabs %}\n\nthe first line does not have a s to match with {% navtab PersistententVolumeClaim%} in line 107\nthe second line should not be indented to match with with {% navtabs domainSocket %} in line 95", "author": "Xenorith", "createdAt": "2020-08-02T21:55:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDAzODQwMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDAzODQ4MQ==", "url": "https://github.com/Alluxio/alluxio/pull/11873#discussion_r464038481", "bodyText": "indent this two spaces to match with corresponding navtab opening bracket", "author": "Xenorith", "createdAt": "2020-08-02T06:29:55Z", "path": "docs/cn/compute/Spark-On-Kubernetes.md", "diffHunk": "@@ -0,0 +1,202 @@\n+---\n+layout: global\n+title: Kubernetes\u73af\u5883\u4e0b\u5728Alluxio\u4e0a\u8fd0\u884cSpark\n+nickname: Spark on Kubernetes\n+group: Compute Integrations\n+priority: 7\n+---\n+\n+Alluxio\u53ef\u4ee5\u5728Kubernetes\u4e0a\u8fd0\u884c\u3002\u672c\u6307\u5357\u6f14\u793a\u4e86\u5982\u4f55\u5728Kubernetes\u73af\u5883\u4e0b\u8fd0\u884c\u7684Alluxio\u4e0a\u8dd1\u4e00\u4e2aSpark\u4f5c\u4e1a\u3002\n+\n+* Table of Contents\n+{:toc}\n+\n+##\u6982\u8ff0\n+\n+\u5728Kubernetes\u4e0a\u8fd0\u884c\u7684Spark\u53ef\u4ee5\u5c06Alluxio\u7528\u4f5c\u6570\u636e\u8bbf\u95ee\u5c42\u3002\n+\u672c\u6307\u5357\u4ecb\u7ecd\u4e86Kubernetes\u73af\u5883\u4e0b\u5728Alluxio\u4e0a\u8fd0\u884cSpark\u4f5c\u4e1a\u793a\u4f8b\u3002\n+\u672c\u6559\u7a0b\u4e2d\u4f7f\u7528\u7684\u793a\u4f8b\u662f\u4e00\u4e2a\u8ba1\u7b97\u4e00\u4e2a\u6587\u4ef6\u4e2d\u6709\u591a\u5c11\u884c\u7684\u4f5c\u4e1a\u3002\n+\u5728\u4e0b\u6587\u4e2d\uff0c\u6211\u4eec\u5c06\u6b64\u4f5c\u4e1a\u79f0\u4e3a count\u3002\n+\n+##\u5148\u51b3\u6761\u4ef6\n+\n+-Kubernetes\u96c6\u7fa4(\u7248\u672c> = 1.8)\u3002\n+-Alluxio\u5df2\u90e8\u7f72\u5728Kubernetes\u96c6\u7fa4\u4e0a\u3002\u6709\u5173\u5982\u4f55\u90e8\u7f72Alluxio\u7684\u8bf4\u660e\uff0c\u8bf7\u53c2\u8003\n+[\u672c\u9875]({{ '/en/deploy/Running-Alluxio-On-Kubernetes.html' | relativize_url}})\n+\n+##\u57fa\u672c\u8bbe\u7f6e\n+\n+\u9996\u5148\uff0c\u6211\u4eec\u51c6\u5907\u4e00\u4e2aSpark Docker\u955c\u50cf\uff0c\u5176\u4e2d\u5305\u62ecAlluxio\u5ba2\u6237\u7aef\u548c\u4efb\u4f55\u5176\u4ed6\u5fc5\u9700\u7684jar\u6587\u4ef6\u3002\n+\u5728\u6240\u6709Kubernetes\u8282\u70b9\u4e0a\u90fd\u9700\u63d0\u4f9b\u6b64\u955c\u50cf\u3002\n+\n+###\u4e0b\u8f7d\u4e8c\u8fdb\u5236\u6587\u4ef6\n+\n+[\u4e0b\u8f7d](https://spark.apache.org/downloads.html)\u6240\u9700\u7684Spark\u7248\u672c\u3002\n+\u5bf9\u4e8e`spark-submit`\u547d\u4ee4\u548c\u4f7f\u7528Alluxio\u6240\u542b\u7684Dockerfile\u7f16\u8bd1Docker\u955c\u50cf\n+\u6211\u4eec\u90fd\u4f7f\u7528\u9884\u751f\u6210\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\uff0c\u3002\n+>\u6ce8:\u4e0b\u8f7d\u4e3aHadoop\u9884\u5236\u7684\u8f6f\u4ef6\u5305\n+\n+```console\n+$ tar -xf spark-2.4.4-bin-hadoop2.7.tgz\n+$ cd spark-2.4.4-bin-hadoop2.7\n+```\n+###\u7f16\u8bd1Spark Docker\u955c\u50cf\n+\n+\u4eceAlluxio Docker\u955c\u50cf\u4e2d\u63d0\u53d6Alluxio\u5ba2\u6237\u7aefjar:\n+\n+```console\n+$ id=$(docker create alluxio/alluxio:{{site.ALLUXIO_VERSION_STRING}})\n+$ docker cp $id:/opt/alluxio/client/alluxio-{{site.ALLUXIO_VERSION_STRING}}-client.jar \\\n+  - > alluxio-{{site.ALLUXIO_VERSION_STRING}}-client.jar\n+$ docker rm -v $id 1>/dev/null\n+```\n+\n+\u6dfb\u52a0\u6240\u9700\u7684Alluxio\u5ba2\u6237\u7aefjar\u5e76\u6784\u5efa\u7528\u4e8eSpark\u9a71\u52a8\u7a0b\u5e8f\u548c\u6267\u884c\u7a0b\u5e8fpods\u7684Docker\u955c\u50cf\u3002\n+\u4eceSpark\u53d1\u884c\u7248\u76ee\u5f55\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\u4ee5\u6dfb\u52a0Alluxio\u5ba2\u6237\u7aefjar\u3002\n+\n+```console\n+$ cp <path_to_alluxio_client>/alluxio-{{site.ALLUXIO_VERSION_STRING}}-client.jar jars/\n+```\n+>\u6ce8\u610f:\u4efb\u4f55\u590d\u5236\u5230`jars`\u76ee\u5f55\u7684jar\u6587\u4ef6\u5728\u7f16\u8bd1\u65f6\u90fd\u4f1a\u88ab\u5305\u542b\u5230Spark Docker\u955c\u50cf\u4e2d\u3002\n+\n+\u7f16\u8bd1Spark Docker\u955c\u50cf\n+\n+```console\n+$ docker build -t spark-alluxio -f kubernetes/dockerfiles/spark/Dockerfile .\n+```\n+>\u6ce8\u610f:\u786e\u4fdd\u6240\u6709\u8282\u70b9(spark-driver\u548cspark-executor pods\u5c06\u8fd0\u884c\u7684\u6240\u5728\u8282\u70b9) \n+\u90fd\u6709\u8be5\u955c\u50cf\u3002\n+\n+##\u793a\u4f8b\n+\n+\u672c\u8282\u8bf4\u660e\u5982\u4f55\u4f7f\u7528\u7f16\u8bd1\u7684Docker\u955c\u50cf\u6765\u53d1\u8d77\u4e00\u4e2a\u4ee5Alluxio\u4f5c\u4e3a\u6570\u636e\u6e90\u7684Spark\u4f5c\u4e1a\u3002\n+\n+###\u77ed\u8def\u64cd\u4f5c\n+\n+\u77ed\u8def\u8bbf\u95ee\u4f7fSpark\u6267\u884c\u5668\u4e2d\u7684Alluxio\u5ba2\u6237\u7aef\u53ef\u4ee5\u76f4\u63a5\u8bbf\u95ee\n+\u4e3b\u673a\u4e0a\u7684Alluxio worker\u5b58\u50a8\u3002\n+\u56e0\u4e3a\u4e0d\u901a\u8fc7\u7f51\u7edc\u5806\u6808\u6765\u4e0eAlluxio worker\u901a\u4fe1\uff0c\u8fd9\u6837\u53ef\u4ee5\u63d0\u9ad8\u6027\u80fd\u3002\n+\n+\u5982\u679c\u5728\u90e8\u7f72Alluxio\u65f6\u672a\u6309\u7167\u6307\u4ee4\u8bbe\u7f6e\u57df\u5957\u63a5\u5b57\n+][\u672c\u9875]({{ '/en/deploy/Running-Alluxio-On-Kubernetes.html' | relativize_url}}\uff03short-circuit-access)\uff0c\u5219\n+\u53ef\u4ee5\u8df3\u8fc7\u5c06`hostPath`\u5377\u6302\u8f7d\u5230Spark\u6267\u884c\u5668\u6b65\u9aa4\u3002\n+\n+\u5982\u679c\u5728\u8fd0\u884cAlluxio worker\u8fdb\u7a0b\u7684\u4e3b\u673a\u4e0a\u5c06\u57df\u5957\u63a5\u5b57\u4f4d\u7f6e\u8bbe\u7f6e\u4e3a\n+`/tmp/alluxio-domain`\uff0c\u5e76\u4e14Alluxio\u914d\u7f6e\u4e3a\n+`alluxio.worker.data.server.domain.socket.address=/opt/domain`\uff0c\u4f7f\u7528\u4ee5\u4e0bSpark\n+\u914d\u7f6e\u5c06`/tmp/alluxio-domain`\u6302\u8f7d\u5230Spark\u6267\u884c\u5668pod\u4e2d\u7684`/opt/domain`\u3002\n+\u4e0b\u4e00\u8282\u4e2d\u7684`spark-submit`\u547d\u4ee4\u5305\u542b\u8fd9\u4e9b\u5c5e\u6027\u3002\n+\n+\u53d6\u51b3\u4e8e\u4f60\u7684\u8bbe\u7f6e\uff0cAlluxio worker\u4e0a\u7684\u57df\u5957\u63a5\u5b57\u53ef\u4ee5\u662f`hostPath`\u5377\u6216`PersistententVolumeClaim`\u4e24\u79cd\u4e4b\u4e00\u3002\u53ef\u4ee5\u5728\u6b64\u5904\u627e\u5230\u6709\u5173\u5982\u4f55\u914d\u7f6eAlluxio worker\u4ee5\u4f7f\u7528\u77ed\u8def\u64cd\u4f5c\u7684\u66f4\u591a\u8be6\u7ec6\u4fe1\u606f \n+({{ '/en/deploy/Running-Alluxio-On-Kubernetes.html#short-circuit-access' | relativize_url}})\u3002\n+\u8fd9\u4e24\u4e2a\u9009\u9879\u7684spark-submit\u53c2\u6570\u5c06\u6709\u6240\u4e0d\u540c\u3002\n+\u53ef\u4ee5\u5728\u4ee5\u4e0bSpark\u6587\u6863\u4e2d\u627e\u5230\u6709\u5173\u5982\u4f55\u5c06\u5377\u6302\u8f7d\u5230Spark\u6267\u884c\u5668\u7684\u66f4\u591a[\u4fe1\u606f](https://spark.apache.org/docs/2.4.4/running-on-kubernetes.html#using-kubernetes-volumes)\u3002\n+\n+{% navtabs domainSocket %}\n+  {% navtab hostPath %}\n+  \u5982\u679c\u4f7f\u7528\u7684\u662fhostPath\u57df\u5957\u63a5\u5b57\uff0c\u5219\u5e94\u5c06\u4ee5\u4e0b\u5c5e\u6027\u4f20\u9012\u7ed9Spark:\n+  \n+  ```properties\n+  spark.kubernetes.executor.volumes.hostPath.alluxio-domain.mount.path=/opt/domain\n+  spark.kubernetes.executor.volumes.hostPath.alluxio-domain.mount.readOnly=true\n+  spark.kubernetes.executor.volumes.hostPath.alluxio-domain.options.path=/tmp/alluxio-domain\n+  spark.kubernetes.executor.volumes.hostPath.alluxio-domain.options.type=Directory\n+  ```\n+ \n+{% endnavtab %}", "originalCommit": "f5386c7d7c9bb9d00063327a67d1f0f08c25a56f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "330f860e26e59e49a632baf613ae1fde714e7a70", "url": "https://github.com/Alluxio/alluxio/commit/330f860e26e59e49a632baf613ae1fde714e7a70", "message": "Update Spark-On-Kubernetes.md", "committedDate": "2020-08-02T21:50:14Z", "type": "commit"}, {"oid": "23bf2f279aeaedd9ff7902b31dc229476e08f23f", "url": "https://github.com/Alluxio/alluxio/commit/23bf2f279aeaedd9ff7902b31dc229476e08f23f", "message": "Update Spark-On-Kubernetes.md", "committedDate": "2020-08-02T21:56:38Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDUyNTI3NQ==", "url": "https://github.com/Alluxio/alluxio/pull/11873#discussion_r464525275", "bodyText": "merge these two lines into one single line?", "author": "LuQQiu", "createdAt": "2020-08-03T16:31:33Z", "path": "docs/cn/compute/Spark-On-Kubernetes.md", "diffHunk": "@@ -0,0 +1,202 @@\n+---\n+layout: global\n+title: Kubernetes\u73af\u5883\u4e0b\u5728Alluxio\u4e0a\u8fd0\u884cSpark\n+nickname: Spark on Kubernetes\n+group: Compute Integrations\n+priority: 7\n+---\n+\n+Alluxio\u53ef\u4ee5\u5728Kubernetes\u4e0a\u8fd0\u884c\u3002\u672c\u6307\u5357\u6f14\u793a\u4e86\u5982\u4f55\u5728Kubernetes\u73af\u5883\u4e0b\u8fd0\u884c\u7684Alluxio\u4e0a\u8dd1\u4e00\u4e2aSpark\u4f5c\u4e1a\u3002\n+\n+* Table of Contents\n+{:toc}\n+\n+##\u6982\u8ff0\n+\n+\u5728Kubernetes\u4e0a\u8fd0\u884c\u7684Spark\u53ef\u4ee5\u5c06Alluxio\u7528\u4f5c\u6570\u636e\u8bbf\u95ee\u5c42\u3002\n+\u672c\u6307\u5357\u4ecb\u7ecd\u4e86Kubernetes\u73af\u5883\u4e0b\u5728Alluxio\u4e0a\u8fd0\u884cSpark\u4f5c\u4e1a\u793a\u4f8b\u3002\n+\u672c\u6559\u7a0b\u4e2d\u4f7f\u7528\u7684\u793a\u4f8b\u662f\u4e00\u4e2a\u8ba1\u7b97\u4e00\u4e2a\u6587\u4ef6\u4e2d\u6709\u591a\u5c11\u884c\u7684\u4f5c\u4e1a\u3002\n+\u5728\u4e0b\u6587\u4e2d\uff0c\u6211\u4eec\u5c06\u6b64\u4f5c\u4e1a\u79f0\u4e3a count\u3002\n+\n+##\u5148\u51b3\u6761\u4ef6\n+\n+-Kubernetes\u96c6\u7fa4(\u7248\u672c> = 1.8)\u3002\n+-Alluxio\u5df2\u90e8\u7f72\u5728Kubernetes\u96c6\u7fa4\u4e0a\u3002\u6709\u5173\u5982\u4f55\u90e8\u7f72Alluxio\u7684\u8bf4\u660e\uff0c\u8bf7\u53c2\u8003\n+[\u672c\u9875]({{ '/en/deploy/Running-Alluxio-On-Kubernetes.html' | relativize_url}})\n+\n+##\u57fa\u672c\u8bbe\u7f6e\n+\n+\u9996\u5148\uff0c\u6211\u4eec\u51c6\u5907\u4e00\u4e2aSpark Docker\u955c\u50cf\uff0c\u5176\u4e2d\u5305\u62ecAlluxio\u5ba2\u6237\u7aef\u548c\u4efb\u4f55\u5176\u4ed6\u5fc5\u9700\u7684jar\u6587\u4ef6\u3002\n+\u5728\u6240\u6709Kubernetes\u8282\u70b9\u4e0a\u90fd\u9700\u63d0\u4f9b\u6b64\u955c\u50cf\u3002\n+\n+###\u4e0b\u8f7d\u4e8c\u8fdb\u5236\u6587\u4ef6\n+\n+[\u4e0b\u8f7d](https://spark.apache.org/downloads.html)\u6240\u9700\u7684Spark\u7248\u672c\u3002\n+\u5bf9\u4e8e`spark-submit`\u547d\u4ee4\u548c\u4f7f\u7528Alluxio\u6240\u542b\u7684Dockerfile\u7f16\u8bd1Docker\u955c\u50cf\n+\u6211\u4eec\u90fd\u4f7f\u7528\u9884\u751f\u6210\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\uff0c\u3002\n+>\u6ce8:\u4e0b\u8f7d\u4e3aHadoop\u9884\u5236\u7684\u8f6f\u4ef6\u5305\n+\n+```console\n+$ tar -xf spark-2.4.4-bin-hadoop2.7.tgz\n+$ cd spark-2.4.4-bin-hadoop2.7\n+```\n+###\u7f16\u8bd1Spark Docker\u955c\u50cf\n+\n+\u4eceAlluxio Docker\u955c\u50cf\u4e2d\u63d0\u53d6Alluxio\u5ba2\u6237\u7aefjar:\n+\n+```console\n+$ id=$(docker create alluxio/alluxio:{{site.ALLUXIO_VERSION_STRING}})\n+$ docker cp $id:/opt/alluxio/client/alluxio-{{site.ALLUXIO_VERSION_STRING}}-client.jar \\\n+  - > alluxio-{{site.ALLUXIO_VERSION_STRING}}-client.jar\n+$ docker rm -v $id 1>/dev/null\n+```\n+\n+\u6dfb\u52a0\u6240\u9700\u7684Alluxio\u5ba2\u6237\u7aefjar\u5e76\u6784\u5efa\u7528\u4e8eSpark\u9a71\u52a8\u7a0b\u5e8f\u548c\u6267\u884c\u7a0b\u5e8fpods\u7684Docker\u955c\u50cf\u3002\n+\u4eceSpark\u53d1\u884c\u7248\u76ee\u5f55\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\u4ee5\u6dfb\u52a0Alluxio\u5ba2\u6237\u7aefjar\u3002\n+\n+```console\n+$ cp <path_to_alluxio_client>/alluxio-{{site.ALLUXIO_VERSION_STRING}}-client.jar jars/\n+```\n+>\u6ce8\u610f:\u4efb\u4f55\u590d\u5236\u5230`jars`\u76ee\u5f55\u7684jar\u6587\u4ef6\u5728\u7f16\u8bd1\u65f6\u90fd\u4f1a\u88ab\u5305\u542b\u5230Spark Docker\u955c\u50cf\u4e2d\u3002\n+\n+\u7f16\u8bd1Spark Docker\u955c\u50cf\n+\n+```console\n+$ docker build -t spark-alluxio -f kubernetes/dockerfiles/spark/Dockerfile .\n+```\n+>\u6ce8\u610f:\u786e\u4fdd\u6240\u6709\u8282\u70b9(spark-driver\u548cspark-executor pods\u5c06\u8fd0\u884c\u7684\u6240\u5728\u8282\u70b9) \n+\u90fd\u6709\u8be5\u955c\u50cf\u3002\n+\n+##\u793a\u4f8b\n+\n+\u672c\u8282\u8bf4\u660e\u5982\u4f55\u4f7f\u7528\u7f16\u8bd1\u7684Docker\u955c\u50cf\u6765\u53d1\u8d77\u4e00\u4e2a\u4ee5Alluxio\u4f5c\u4e3a\u6570\u636e\u6e90\u7684Spark\u4f5c\u4e1a\u3002\n+\n+###\u77ed\u8def\u64cd\u4f5c\n+\n+\u77ed\u8def\u8bbf\u95ee\u4f7fSpark\u6267\u884c\u5668\u4e2d\u7684Alluxio\u5ba2\u6237\u7aef\u53ef\u4ee5\u76f4\u63a5\u8bbf\u95ee\n+\u4e3b\u673a\u4e0a\u7684Alluxio worker\u5b58\u50a8\u3002", "originalCommit": "23bf2f279aeaedd9ff7902b31dc229476e08f23f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDUyNTY0NA==", "url": "https://github.com/Alluxio/alluxio/pull/11873#discussion_r464525644", "bodyText": "will be better to not break a single short line into two lines", "author": "LuQQiu", "createdAt": "2020-08-03T16:32:10Z", "path": "docs/cn/compute/Spark-On-Kubernetes.md", "diffHunk": "@@ -0,0 +1,202 @@\n+---\n+layout: global\n+title: Kubernetes\u73af\u5883\u4e0b\u5728Alluxio\u4e0a\u8fd0\u884cSpark\n+nickname: Spark on Kubernetes\n+group: Compute Integrations\n+priority: 7\n+---\n+\n+Alluxio\u53ef\u4ee5\u5728Kubernetes\u4e0a\u8fd0\u884c\u3002\u672c\u6307\u5357\u6f14\u793a\u4e86\u5982\u4f55\u5728Kubernetes\u73af\u5883\u4e0b\u8fd0\u884c\u7684Alluxio\u4e0a\u8dd1\u4e00\u4e2aSpark\u4f5c\u4e1a\u3002\n+\n+* Table of Contents\n+{:toc}\n+\n+##\u6982\u8ff0\n+\n+\u5728Kubernetes\u4e0a\u8fd0\u884c\u7684Spark\u53ef\u4ee5\u5c06Alluxio\u7528\u4f5c\u6570\u636e\u8bbf\u95ee\u5c42\u3002\n+\u672c\u6307\u5357\u4ecb\u7ecd\u4e86Kubernetes\u73af\u5883\u4e0b\u5728Alluxio\u4e0a\u8fd0\u884cSpark\u4f5c\u4e1a\u793a\u4f8b\u3002\n+\u672c\u6559\u7a0b\u4e2d\u4f7f\u7528\u7684\u793a\u4f8b\u662f\u4e00\u4e2a\u8ba1\u7b97\u4e00\u4e2a\u6587\u4ef6\u4e2d\u6709\u591a\u5c11\u884c\u7684\u4f5c\u4e1a\u3002\n+\u5728\u4e0b\u6587\u4e2d\uff0c\u6211\u4eec\u5c06\u6b64\u4f5c\u4e1a\u79f0\u4e3a count\u3002\n+\n+##\u5148\u51b3\u6761\u4ef6\n+\n+-Kubernetes\u96c6\u7fa4(\u7248\u672c> = 1.8)\u3002\n+-Alluxio\u5df2\u90e8\u7f72\u5728Kubernetes\u96c6\u7fa4\u4e0a\u3002\u6709\u5173\u5982\u4f55\u90e8\u7f72Alluxio\u7684\u8bf4\u660e\uff0c\u8bf7\u53c2\u8003\n+[\u672c\u9875]({{ '/en/deploy/Running-Alluxio-On-Kubernetes.html' | relativize_url}})\n+\n+##\u57fa\u672c\u8bbe\u7f6e\n+\n+\u9996\u5148\uff0c\u6211\u4eec\u51c6\u5907\u4e00\u4e2aSpark Docker\u955c\u50cf\uff0c\u5176\u4e2d\u5305\u62ecAlluxio\u5ba2\u6237\u7aef\u548c\u4efb\u4f55\u5176\u4ed6\u5fc5\u9700\u7684jar\u6587\u4ef6\u3002\n+\u5728\u6240\u6709Kubernetes\u8282\u70b9\u4e0a\u90fd\u9700\u63d0\u4f9b\u6b64\u955c\u50cf\u3002\n+\n+###\u4e0b\u8f7d\u4e8c\u8fdb\u5236\u6587\u4ef6\n+\n+[\u4e0b\u8f7d](https://spark.apache.org/downloads.html)\u6240\u9700\u7684Spark\u7248\u672c\u3002\n+\u5bf9\u4e8e`spark-submit`\u547d\u4ee4\u548c\u4f7f\u7528Alluxio\u6240\u542b\u7684Dockerfile\u7f16\u8bd1Docker\u955c\u50cf\n+\u6211\u4eec\u90fd\u4f7f\u7528\u9884\u751f\u6210\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\uff0c\u3002\n+>\u6ce8:\u4e0b\u8f7d\u4e3aHadoop\u9884\u5236\u7684\u8f6f\u4ef6\u5305\n+\n+```console\n+$ tar -xf spark-2.4.4-bin-hadoop2.7.tgz\n+$ cd spark-2.4.4-bin-hadoop2.7\n+```\n+###\u7f16\u8bd1Spark Docker\u955c\u50cf\n+\n+\u4eceAlluxio Docker\u955c\u50cf\u4e2d\u63d0\u53d6Alluxio\u5ba2\u6237\u7aefjar:\n+\n+```console\n+$ id=$(docker create alluxio/alluxio:{{site.ALLUXIO_VERSION_STRING}})\n+$ docker cp $id:/opt/alluxio/client/alluxio-{{site.ALLUXIO_VERSION_STRING}}-client.jar \\\n+  - > alluxio-{{site.ALLUXIO_VERSION_STRING}}-client.jar\n+$ docker rm -v $id 1>/dev/null\n+```\n+\n+\u6dfb\u52a0\u6240\u9700\u7684Alluxio\u5ba2\u6237\u7aefjar\u5e76\u6784\u5efa\u7528\u4e8eSpark\u9a71\u52a8\u7a0b\u5e8f\u548c\u6267\u884c\u7a0b\u5e8fpods\u7684Docker\u955c\u50cf\u3002\n+\u4eceSpark\u53d1\u884c\u7248\u76ee\u5f55\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\u4ee5\u6dfb\u52a0Alluxio\u5ba2\u6237\u7aefjar\u3002\n+\n+```console\n+$ cp <path_to_alluxio_client>/alluxio-{{site.ALLUXIO_VERSION_STRING}}-client.jar jars/\n+```\n+>\u6ce8\u610f:\u4efb\u4f55\u590d\u5236\u5230`jars`\u76ee\u5f55\u7684jar\u6587\u4ef6\u5728\u7f16\u8bd1\u65f6\u90fd\u4f1a\u88ab\u5305\u542b\u5230Spark Docker\u955c\u50cf\u4e2d\u3002\n+\n+\u7f16\u8bd1Spark Docker\u955c\u50cf\n+\n+```console\n+$ docker build -t spark-alluxio -f kubernetes/dockerfiles/spark/Dockerfile .\n+```\n+>\u6ce8\u610f:\u786e\u4fdd\u6240\u6709\u8282\u70b9(spark-driver\u548cspark-executor pods\u5c06\u8fd0\u884c\u7684\u6240\u5728\u8282\u70b9) \n+\u90fd\u6709\u8be5\u955c\u50cf\u3002\n+\n+##\u793a\u4f8b\n+\n+\u672c\u8282\u8bf4\u660e\u5982\u4f55\u4f7f\u7528\u7f16\u8bd1\u7684Docker\u955c\u50cf\u6765\u53d1\u8d77\u4e00\u4e2a\u4ee5Alluxio\u4f5c\u4e3a\u6570\u636e\u6e90\u7684Spark\u4f5c\u4e1a\u3002\n+\n+###\u77ed\u8def\u64cd\u4f5c\n+\n+\u77ed\u8def\u8bbf\u95ee\u4f7fSpark\u6267\u884c\u5668\u4e2d\u7684Alluxio\u5ba2\u6237\u7aef\u53ef\u4ee5\u76f4\u63a5\u8bbf\u95ee\n+\u4e3b\u673a\u4e0a\u7684Alluxio worker\u5b58\u50a8\u3002\n+\u56e0\u4e3a\u4e0d\u901a\u8fc7\u7f51\u7edc\u5806\u6808\u6765\u4e0eAlluxio worker\u901a\u4fe1\uff0c\u8fd9\u6837\u53ef\u4ee5\u63d0\u9ad8\u6027\u80fd\u3002\n+\n+\u5982\u679c\u5728\u90e8\u7f72Alluxio\u65f6\u672a\u6309\u7167\u6307\u4ee4\u8bbe\u7f6e\u57df\u5957\u63a5\u5b57\n+][\u672c\u9875]({{ '/en/deploy/Running-Alluxio-On-Kubernetes.html' | relativize_url}}\uff03short-circuit-access)\uff0c\u5219\n+\u53ef\u4ee5\u8df3\u8fc7\u5c06`hostPath`\u5377\u6302\u8f7d\u5230Spark\u6267\u884c\u5668\u6b65\u9aa4\u3002\n+\n+\u5982\u679c\u5728\u8fd0\u884cAlluxio worker\u8fdb\u7a0b\u7684\u4e3b\u673a\u4e0a\u5c06\u57df\u5957\u63a5\u5b57\u4f4d\u7f6e\u8bbe\u7f6e\u4e3a\n+`/tmp/alluxio-domain`\uff0c\u5e76\u4e14Alluxio\u914d\u7f6e\u4e3a", "originalCommit": "23bf2f279aeaedd9ff7902b31dc229476e08f23f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDUyNjcwOA==", "url": "https://github.com/Alluxio/alluxio/pull/11873#discussion_r464526708", "bodyText": "\u53ef\u4ee5\u518d[\u6b64\u5904]({{ '/en/deploy/Running-Alluxio-On-Kubernetes.html#short-circuit-access' | relativize_url}})\u627e\u5230\u6709\u5173\u5982\u4f55\u914d\u7f6eAlluxio worker\u4ee5\u4f7f\u7528\u77ed\u8def\u64cd\u4f5c\u7684\u66f4\u591a\u8be6\u7ec6\u4fe1\u606f\u3002\nevery link in ({{}}) format needs to be with some text.", "author": "LuQQiu", "createdAt": "2020-08-03T16:34:06Z", "path": "docs/cn/compute/Spark-On-Kubernetes.md", "diffHunk": "@@ -0,0 +1,202 @@\n+---\n+layout: global\n+title: Kubernetes\u73af\u5883\u4e0b\u5728Alluxio\u4e0a\u8fd0\u884cSpark\n+nickname: Spark on Kubernetes\n+group: Compute Integrations\n+priority: 7\n+---\n+\n+Alluxio\u53ef\u4ee5\u5728Kubernetes\u4e0a\u8fd0\u884c\u3002\u672c\u6307\u5357\u6f14\u793a\u4e86\u5982\u4f55\u5728Kubernetes\u73af\u5883\u4e0b\u8fd0\u884c\u7684Alluxio\u4e0a\u8dd1\u4e00\u4e2aSpark\u4f5c\u4e1a\u3002\n+\n+* Table of Contents\n+{:toc}\n+\n+##\u6982\u8ff0\n+\n+\u5728Kubernetes\u4e0a\u8fd0\u884c\u7684Spark\u53ef\u4ee5\u5c06Alluxio\u7528\u4f5c\u6570\u636e\u8bbf\u95ee\u5c42\u3002\n+\u672c\u6307\u5357\u4ecb\u7ecd\u4e86Kubernetes\u73af\u5883\u4e0b\u5728Alluxio\u4e0a\u8fd0\u884cSpark\u4f5c\u4e1a\u793a\u4f8b\u3002\n+\u672c\u6559\u7a0b\u4e2d\u4f7f\u7528\u7684\u793a\u4f8b\u662f\u4e00\u4e2a\u8ba1\u7b97\u4e00\u4e2a\u6587\u4ef6\u4e2d\u6709\u591a\u5c11\u884c\u7684\u4f5c\u4e1a\u3002\n+\u5728\u4e0b\u6587\u4e2d\uff0c\u6211\u4eec\u5c06\u6b64\u4f5c\u4e1a\u79f0\u4e3a count\u3002\n+\n+##\u5148\u51b3\u6761\u4ef6\n+\n+-Kubernetes\u96c6\u7fa4(\u7248\u672c> = 1.8)\u3002\n+-Alluxio\u5df2\u90e8\u7f72\u5728Kubernetes\u96c6\u7fa4\u4e0a\u3002\u6709\u5173\u5982\u4f55\u90e8\u7f72Alluxio\u7684\u8bf4\u660e\uff0c\u8bf7\u53c2\u8003\n+[\u672c\u9875]({{ '/en/deploy/Running-Alluxio-On-Kubernetes.html' | relativize_url}})\n+\n+##\u57fa\u672c\u8bbe\u7f6e\n+\n+\u9996\u5148\uff0c\u6211\u4eec\u51c6\u5907\u4e00\u4e2aSpark Docker\u955c\u50cf\uff0c\u5176\u4e2d\u5305\u62ecAlluxio\u5ba2\u6237\u7aef\u548c\u4efb\u4f55\u5176\u4ed6\u5fc5\u9700\u7684jar\u6587\u4ef6\u3002\n+\u5728\u6240\u6709Kubernetes\u8282\u70b9\u4e0a\u90fd\u9700\u63d0\u4f9b\u6b64\u955c\u50cf\u3002\n+\n+###\u4e0b\u8f7d\u4e8c\u8fdb\u5236\u6587\u4ef6\n+\n+[\u4e0b\u8f7d](https://spark.apache.org/downloads.html)\u6240\u9700\u7684Spark\u7248\u672c\u3002\n+\u5bf9\u4e8e`spark-submit`\u547d\u4ee4\u548c\u4f7f\u7528Alluxio\u6240\u542b\u7684Dockerfile\u7f16\u8bd1Docker\u955c\u50cf\n+\u6211\u4eec\u90fd\u4f7f\u7528\u9884\u751f\u6210\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\uff0c\u3002\n+>\u6ce8:\u4e0b\u8f7d\u4e3aHadoop\u9884\u5236\u7684\u8f6f\u4ef6\u5305\n+\n+```console\n+$ tar -xf spark-2.4.4-bin-hadoop2.7.tgz\n+$ cd spark-2.4.4-bin-hadoop2.7\n+```\n+###\u7f16\u8bd1Spark Docker\u955c\u50cf\n+\n+\u4eceAlluxio Docker\u955c\u50cf\u4e2d\u63d0\u53d6Alluxio\u5ba2\u6237\u7aefjar:\n+\n+```console\n+$ id=$(docker create alluxio/alluxio:{{site.ALLUXIO_VERSION_STRING}})\n+$ docker cp $id:/opt/alluxio/client/alluxio-{{site.ALLUXIO_VERSION_STRING}}-client.jar \\\n+  - > alluxio-{{site.ALLUXIO_VERSION_STRING}}-client.jar\n+$ docker rm -v $id 1>/dev/null\n+```\n+\n+\u6dfb\u52a0\u6240\u9700\u7684Alluxio\u5ba2\u6237\u7aefjar\u5e76\u6784\u5efa\u7528\u4e8eSpark\u9a71\u52a8\u7a0b\u5e8f\u548c\u6267\u884c\u7a0b\u5e8fpods\u7684Docker\u955c\u50cf\u3002\n+\u4eceSpark\u53d1\u884c\u7248\u76ee\u5f55\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\u4ee5\u6dfb\u52a0Alluxio\u5ba2\u6237\u7aefjar\u3002\n+\n+```console\n+$ cp <path_to_alluxio_client>/alluxio-{{site.ALLUXIO_VERSION_STRING}}-client.jar jars/\n+```\n+>\u6ce8\u610f:\u4efb\u4f55\u590d\u5236\u5230`jars`\u76ee\u5f55\u7684jar\u6587\u4ef6\u5728\u7f16\u8bd1\u65f6\u90fd\u4f1a\u88ab\u5305\u542b\u5230Spark Docker\u955c\u50cf\u4e2d\u3002\n+\n+\u7f16\u8bd1Spark Docker\u955c\u50cf\n+\n+```console\n+$ docker build -t spark-alluxio -f kubernetes/dockerfiles/spark/Dockerfile .\n+```\n+>\u6ce8\u610f:\u786e\u4fdd\u6240\u6709\u8282\u70b9(spark-driver\u548cspark-executor pods\u5c06\u8fd0\u884c\u7684\u6240\u5728\u8282\u70b9) \n+\u90fd\u6709\u8be5\u955c\u50cf\u3002\n+\n+##\u793a\u4f8b\n+\n+\u672c\u8282\u8bf4\u660e\u5982\u4f55\u4f7f\u7528\u7f16\u8bd1\u7684Docker\u955c\u50cf\u6765\u53d1\u8d77\u4e00\u4e2a\u4ee5Alluxio\u4f5c\u4e3a\u6570\u636e\u6e90\u7684Spark\u4f5c\u4e1a\u3002\n+\n+###\u77ed\u8def\u64cd\u4f5c\n+\n+\u77ed\u8def\u8bbf\u95ee\u4f7fSpark\u6267\u884c\u5668\u4e2d\u7684Alluxio\u5ba2\u6237\u7aef\u53ef\u4ee5\u76f4\u63a5\u8bbf\u95ee\n+\u4e3b\u673a\u4e0a\u7684Alluxio worker\u5b58\u50a8\u3002\n+\u56e0\u4e3a\u4e0d\u901a\u8fc7\u7f51\u7edc\u5806\u6808\u6765\u4e0eAlluxio worker\u901a\u4fe1\uff0c\u8fd9\u6837\u53ef\u4ee5\u63d0\u9ad8\u6027\u80fd\u3002\n+\n+\u5982\u679c\u5728\u90e8\u7f72Alluxio\u65f6\u672a\u6309\u7167\u6307\u4ee4\u8bbe\u7f6e\u57df\u5957\u63a5\u5b57\n+][\u672c\u9875]({{ '/en/deploy/Running-Alluxio-On-Kubernetes.html' | relativize_url}}\uff03short-circuit-access)\uff0c\u5219\n+\u53ef\u4ee5\u8df3\u8fc7\u5c06`hostPath`\u5377\u6302\u8f7d\u5230Spark\u6267\u884c\u5668\u6b65\u9aa4\u3002\n+\n+\u5982\u679c\u5728\u8fd0\u884cAlluxio worker\u8fdb\u7a0b\u7684\u4e3b\u673a\u4e0a\u5c06\u57df\u5957\u63a5\u5b57\u4f4d\u7f6e\u8bbe\u7f6e\u4e3a\n+`/tmp/alluxio-domain`\uff0c\u5e76\u4e14Alluxio\u914d\u7f6e\u4e3a\n+`alluxio.worker.data.server.domain.socket.address=/opt/domain`\uff0c\u4f7f\u7528\u4ee5\u4e0bSpark\n+\u914d\u7f6e\u5c06`/tmp/alluxio-domain`\u6302\u8f7d\u5230Spark\u6267\u884c\u5668pod\u4e2d\u7684`/opt/domain`\u3002\n+\u4e0b\u4e00\u8282\u4e2d\u7684`spark-submit`\u547d\u4ee4\u5305\u542b\u8fd9\u4e9b\u5c5e\u6027\u3002\n+\n+\u53d6\u51b3\u4e8e\u4f60\u7684\u8bbe\u7f6e\uff0cAlluxio worker\u4e0a\u7684\u57df\u5957\u63a5\u5b57\u53ef\u4ee5\u662f`hostPath`\u5377\u6216`PersistententVolumeClaim`\u4e24\u79cd\u4e4b\u4e00\u3002\u53ef\u4ee5\u5728\u6b64\u5904\u627e\u5230\u6709\u5173\u5982\u4f55\u914d\u7f6eAlluxio worker\u4ee5\u4f7f\u7528\u77ed\u8def\u64cd\u4f5c\u7684\u66f4\u591a\u8be6\u7ec6\u4fe1\u606f \n+({{ '/en/deploy/Running-Alluxio-On-Kubernetes.html#short-circuit-access' | relativize_url}})\u3002", "originalCommit": "23bf2f279aeaedd9ff7902b31dc229476e08f23f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDUyNzEwNg==", "url": "https://github.com/Alluxio/alluxio/pull/11873#discussion_r464527106", "bodyText": "single line", "author": "LuQQiu", "createdAt": "2020-08-03T16:34:49Z", "path": "docs/cn/compute/Spark-On-Kubernetes.md", "diffHunk": "@@ -0,0 +1,202 @@\n+---\n+layout: global\n+title: Kubernetes\u73af\u5883\u4e0b\u5728Alluxio\u4e0a\u8fd0\u884cSpark\n+nickname: Spark on Kubernetes\n+group: Compute Integrations\n+priority: 7\n+---\n+\n+Alluxio\u53ef\u4ee5\u5728Kubernetes\u4e0a\u8fd0\u884c\u3002\u672c\u6307\u5357\u6f14\u793a\u4e86\u5982\u4f55\u5728Kubernetes\u73af\u5883\u4e0b\u8fd0\u884c\u7684Alluxio\u4e0a\u8dd1\u4e00\u4e2aSpark\u4f5c\u4e1a\u3002\n+\n+* Table of Contents\n+{:toc}\n+\n+##\u6982\u8ff0\n+\n+\u5728Kubernetes\u4e0a\u8fd0\u884c\u7684Spark\u53ef\u4ee5\u5c06Alluxio\u7528\u4f5c\u6570\u636e\u8bbf\u95ee\u5c42\u3002\n+\u672c\u6307\u5357\u4ecb\u7ecd\u4e86Kubernetes\u73af\u5883\u4e0b\u5728Alluxio\u4e0a\u8fd0\u884cSpark\u4f5c\u4e1a\u793a\u4f8b\u3002\n+\u672c\u6559\u7a0b\u4e2d\u4f7f\u7528\u7684\u793a\u4f8b\u662f\u4e00\u4e2a\u8ba1\u7b97\u4e00\u4e2a\u6587\u4ef6\u4e2d\u6709\u591a\u5c11\u884c\u7684\u4f5c\u4e1a\u3002\n+\u5728\u4e0b\u6587\u4e2d\uff0c\u6211\u4eec\u5c06\u6b64\u4f5c\u4e1a\u79f0\u4e3a count\u3002\n+\n+##\u5148\u51b3\u6761\u4ef6\n+\n+-Kubernetes\u96c6\u7fa4(\u7248\u672c> = 1.8)\u3002\n+-Alluxio\u5df2\u90e8\u7f72\u5728Kubernetes\u96c6\u7fa4\u4e0a\u3002\u6709\u5173\u5982\u4f55\u90e8\u7f72Alluxio\u7684\u8bf4\u660e\uff0c\u8bf7\u53c2\u8003\n+[\u672c\u9875]({{ '/en/deploy/Running-Alluxio-On-Kubernetes.html' | relativize_url}})\n+\n+##\u57fa\u672c\u8bbe\u7f6e\n+\n+\u9996\u5148\uff0c\u6211\u4eec\u51c6\u5907\u4e00\u4e2aSpark Docker\u955c\u50cf\uff0c\u5176\u4e2d\u5305\u62ecAlluxio\u5ba2\u6237\u7aef\u548c\u4efb\u4f55\u5176\u4ed6\u5fc5\u9700\u7684jar\u6587\u4ef6\u3002\n+\u5728\u6240\u6709Kubernetes\u8282\u70b9\u4e0a\u90fd\u9700\u63d0\u4f9b\u6b64\u955c\u50cf\u3002\n+\n+###\u4e0b\u8f7d\u4e8c\u8fdb\u5236\u6587\u4ef6\n+\n+[\u4e0b\u8f7d](https://spark.apache.org/downloads.html)\u6240\u9700\u7684Spark\u7248\u672c\u3002\n+\u5bf9\u4e8e`spark-submit`\u547d\u4ee4\u548c\u4f7f\u7528Alluxio\u6240\u542b\u7684Dockerfile\u7f16\u8bd1Docker\u955c\u50cf\n+\u6211\u4eec\u90fd\u4f7f\u7528\u9884\u751f\u6210\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\uff0c\u3002\n+>\u6ce8:\u4e0b\u8f7d\u4e3aHadoop\u9884\u5236\u7684\u8f6f\u4ef6\u5305\n+\n+```console\n+$ tar -xf spark-2.4.4-bin-hadoop2.7.tgz\n+$ cd spark-2.4.4-bin-hadoop2.7\n+```\n+###\u7f16\u8bd1Spark Docker\u955c\u50cf\n+\n+\u4eceAlluxio Docker\u955c\u50cf\u4e2d\u63d0\u53d6Alluxio\u5ba2\u6237\u7aefjar:\n+\n+```console\n+$ id=$(docker create alluxio/alluxio:{{site.ALLUXIO_VERSION_STRING}})\n+$ docker cp $id:/opt/alluxio/client/alluxio-{{site.ALLUXIO_VERSION_STRING}}-client.jar \\\n+  - > alluxio-{{site.ALLUXIO_VERSION_STRING}}-client.jar\n+$ docker rm -v $id 1>/dev/null\n+```\n+\n+\u6dfb\u52a0\u6240\u9700\u7684Alluxio\u5ba2\u6237\u7aefjar\u5e76\u6784\u5efa\u7528\u4e8eSpark\u9a71\u52a8\u7a0b\u5e8f\u548c\u6267\u884c\u7a0b\u5e8fpods\u7684Docker\u955c\u50cf\u3002\n+\u4eceSpark\u53d1\u884c\u7248\u76ee\u5f55\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\u4ee5\u6dfb\u52a0Alluxio\u5ba2\u6237\u7aefjar\u3002\n+\n+```console\n+$ cp <path_to_alluxio_client>/alluxio-{{site.ALLUXIO_VERSION_STRING}}-client.jar jars/\n+```\n+>\u6ce8\u610f:\u4efb\u4f55\u590d\u5236\u5230`jars`\u76ee\u5f55\u7684jar\u6587\u4ef6\u5728\u7f16\u8bd1\u65f6\u90fd\u4f1a\u88ab\u5305\u542b\u5230Spark Docker\u955c\u50cf\u4e2d\u3002\n+\n+\u7f16\u8bd1Spark Docker\u955c\u50cf\n+\n+```console\n+$ docker build -t spark-alluxio -f kubernetes/dockerfiles/spark/Dockerfile .\n+```\n+>\u6ce8\u610f:\u786e\u4fdd\u6240\u6709\u8282\u70b9(spark-driver\u548cspark-executor pods\u5c06\u8fd0\u884c\u7684\u6240\u5728\u8282\u70b9) \n+\u90fd\u6709\u8be5\u955c\u50cf\u3002\n+\n+##\u793a\u4f8b\n+\n+\u672c\u8282\u8bf4\u660e\u5982\u4f55\u4f7f\u7528\u7f16\u8bd1\u7684Docker\u955c\u50cf\u6765\u53d1\u8d77\u4e00\u4e2a\u4ee5Alluxio\u4f5c\u4e3a\u6570\u636e\u6e90\u7684Spark\u4f5c\u4e1a\u3002\n+\n+###\u77ed\u8def\u64cd\u4f5c\n+\n+\u77ed\u8def\u8bbf\u95ee\u4f7fSpark\u6267\u884c\u5668\u4e2d\u7684Alluxio\u5ba2\u6237\u7aef\u53ef\u4ee5\u76f4\u63a5\u8bbf\u95ee\n+\u4e3b\u673a\u4e0a\u7684Alluxio worker\u5b58\u50a8\u3002\n+\u56e0\u4e3a\u4e0d\u901a\u8fc7\u7f51\u7edc\u5806\u6808\u6765\u4e0eAlluxio worker\u901a\u4fe1\uff0c\u8fd9\u6837\u53ef\u4ee5\u63d0\u9ad8\u6027\u80fd\u3002\n+\n+\u5982\u679c\u5728\u90e8\u7f72Alluxio\u65f6\u672a\u6309\u7167\u6307\u4ee4\u8bbe\u7f6e\u57df\u5957\u63a5\u5b57\n+][\u672c\u9875]({{ '/en/deploy/Running-Alluxio-On-Kubernetes.html' | relativize_url}}\uff03short-circuit-access)\uff0c\u5219\n+\u53ef\u4ee5\u8df3\u8fc7\u5c06`hostPath`\u5377\u6302\u8f7d\u5230Spark\u6267\u884c\u5668\u6b65\u9aa4\u3002\n+\n+\u5982\u679c\u5728\u8fd0\u884cAlluxio worker\u8fdb\u7a0b\u7684\u4e3b\u673a\u4e0a\u5c06\u57df\u5957\u63a5\u5b57\u4f4d\u7f6e\u8bbe\u7f6e\u4e3a\n+`/tmp/alluxio-domain`\uff0c\u5e76\u4e14Alluxio\u914d\u7f6e\u4e3a\n+`alluxio.worker.data.server.domain.socket.address=/opt/domain`\uff0c\u4f7f\u7528\u4ee5\u4e0bSpark\n+\u914d\u7f6e\u5c06`/tmp/alluxio-domain`\u6302\u8f7d\u5230Spark\u6267\u884c\u5668pod\u4e2d\u7684`/opt/domain`\u3002\n+\u4e0b\u4e00\u8282\u4e2d\u7684`spark-submit`\u547d\u4ee4\u5305\u542b\u8fd9\u4e9b\u5c5e\u6027\u3002\n+\n+\u53d6\u51b3\u4e8e\u4f60\u7684\u8bbe\u7f6e\uff0cAlluxio worker\u4e0a\u7684\u57df\u5957\u63a5\u5b57\u53ef\u4ee5\u662f`hostPath`\u5377\u6216`PersistententVolumeClaim`\u4e24\u79cd\u4e4b\u4e00\u3002\u53ef\u4ee5\u5728\u6b64\u5904\u627e\u5230\u6709\u5173\u5982\u4f55\u914d\u7f6eAlluxio worker\u4ee5\u4f7f\u7528\u77ed\u8def\u64cd\u4f5c\u7684\u66f4\u591a\u8be6\u7ec6\u4fe1\u606f \n+({{ '/en/deploy/Running-Alluxio-On-Kubernetes.html#short-circuit-access' | relativize_url}})\u3002\n+\u8fd9\u4e24\u4e2a\u9009\u9879\u7684spark-submit\u53c2\u6570\u5c06\u6709\u6240\u4e0d\u540c\u3002\n+\u53ef\u4ee5\u5728\u4ee5\u4e0bSpark\u6587\u6863\u4e2d\u627e\u5230\u6709\u5173\u5982\u4f55\u5c06\u5377\u6302\u8f7d\u5230Spark\u6267\u884c\u5668\u7684\u66f4\u591a[\u4fe1\u606f](https://spark.apache.org/docs/2.4.4/running-on-kubernetes.html#using-kubernetes-volumes)\u3002\n+\n+{% navtabs domainSocket %}\n+  {% navtab hostPath %}\n+  \u5982\u679c\u4f7f\u7528\u7684\u662fhostPath\u57df\u5957\u63a5\u5b57\uff0c\u5219\u5e94\u5c06\u4ee5\u4e0b\u5c5e\u6027\u4f20\u9012\u7ed9Spark:\n+  \n+  ```properties\n+  spark.kubernetes.executor.volumes.hostPath.alluxio-domain.mount.path=/opt/domain\n+  spark.kubernetes.executor.volumes.hostPath.alluxio-domain.mount.readOnly=true\n+  spark.kubernetes.executor.volumes.hostPath.alluxio-domain.options.path=/tmp/alluxio-domain\n+  spark.kubernetes.executor.volumes.hostPath.alluxio-domain.options.type=Directory\n+  ```\n+ \n+  {% endnavtab %}\n+  {% navtab PersistententVolumeClaim %}\n+  \u5982\u679c\u4f7f\u7528\u7684\u662fPersistententVolumeClaim\u57df\u5957\u63a5\u5b57\uff0c\u5219\u5e94\u5c06\u4ee5\u4e0b\u5c5e\u6027\u4f20\u9012\u7ed9Spark:\n+  \n+  ```properties\n+  spark.kubernetes.executor.volumes.persistentVolumeClaim.alluxio-domain.mount.path=/opt/domain \\\n+  spark.kubernetes.executor.volumes.persistentVolumeClaim.alluxio-domain.mount.readOnly=true \\\n+  spark.kubernetes.executor.volumes.persistentVolumeClaim.alluxio-domain.options.claimName=<domainSocketPVC name>\n+  ```\n+  \n+  {% endnavtab %}\n+{% endnavtabs %}\n+\n+\u6ce8\u610f: \n+-Spark\u4e2d\u7684\u5377\u652f\u6301\u662f\u57282.4.0\u7248\u4e2d\u6dfb\u52a0\u7684\u3002\n+-\u5f53\u4e0d\u901a\u8fc7\u57df\u5957\u63a5\u5b57\u4f7f\u7528\u77ed\u8def\u8bbf\u95ee\u65f6\uff0c\u53ef\u80fd\u4f1a\u89c2\u5bdf\u5230\u6027\u80fd\u4e0b\u964d\u3002\n+\n+###\u8fd0\u884cSpark\u4f5c\u4e1a\n+\n+\u4ee5\u4e0b\u547d\u4ee4\u5728Alluxio\u4f4d\u7f6e`/LICENSE`\u8fd0\u884c\u4e00\u4e2a\u8ba1\u5b57\u6570\u4f5c\u4e1a\u6837\u4f8b\u3002\n+\u53ef\u4ee5\u5728Spark\u9a71\u52a8\u7a0b\u5e8fpod\u7684\u65e5\u5fd7\u4e2d\u770b\u5230\u8fd0\u884c\u7684\u8f93\u51fa\u548c\u6240\u82b1\u8d39\u7684\u65f6\u95f4\u3002\u66f4\u8fdb\u4e00\u6b65[\u8bf4\u660e\u53c2\u8003Spark](https://spark.apache.org/docs/latest/running-on-kubernetes.html)\u3002\n+\n+####\u521b\u5efa\u670d\u52a1\u5e10\u6237(\u53ef\u9009)\n+\n+\u5982\u679c\u6ca1\u6709\u53ef\u4f7f\u7528\u7684\u670d\u52a1\u5e10\u6237\uff0c\u53ef\u4ee5\u6309\u5982\u4e0b\u6307\u4ee4\u521b\u5efa\u4e00\u4e2a\u5177\u6709\u6240\u9700\u8bbf\u95ee\u6743\u9650\u7684\u670d\u52a1\u8d26\u6237\u6765\u8fd0\u884cspark\u4f5c\u4e1a\u3002\n+\n+```console\n+$ kubectl create serviceaccount spark\n+$ kubectl create clusterrolebinding spark-role --clusterrole=edit \\\n+  --serviceaccount=default:spark --namespace=default\n+```\n+\n+####\u63d0\u4ea4Spark\u4f5c\u4e1a\n+\n+\u4eceSpark\u53d1\u884c\u7248\u76ee\u5f55\u8fd0\u884cSpark\u4f5c\u4e1a\n+\n+```console\n+$ ./bin/spark-submit --master k8s://https://<kubernetes-api-server>:8443 \\\n+--deploy-mode cluster --name spark-alluxio --conf spark.executor.instances=1 \\\n+--class org.apache.spark.examples.JavaWordCount \\\n+--driver-memory 500m --executor-memory 1g \\\n+--conf spark.kubernetes.authenticate.driver.serviceAccountName=spark \\\n+--conf spark.kubernetes.container.image=spark-alluxio \\\n+--conf spark.kubernetes.executor.volumes.hostPath.alluxio-domain.mount.path=/opt/domain \\\n+--conf spark.kubernetes.executor.volumes.hostPath.alluxio-domain.mount.readOnly=true \\\n+--conf spark.kubernetes.executor.volumes.hostPath.alluxio-domain.options.path=/tmp/alluxio-domain \\\n+--conf spark.kubernetes.executor.volumes.hostPath.alluxio-domain.options.type=Directory \\\n+local:///opt/spark/examples/jars/spark-examples_2.11-2.4.4.jar \\\n+alluxio://<alluxio-master>:19998/LICENSE\n+```\n+> \u6ce8\u610f:\u53ef\u4ee5\u901a\u8fc7\u8fd0\u884c`kubectl cluster-info`\u627e\u5230Kubernetes API\u670d\u52a1\u5668\u5730\u5740\u3002\n+\u60a8\u53ef\u4ee5\u5728Spark\u6587\u6863\u4e2d\u627e\u5230\u66f4\u591a\u8be6\u7ec6\u4fe1\u606f\u3002 [documentation](https://spark.apache.org/docs/latest/running-on-kubernetes.html?q=cluster-info#cluster-mode)\n+\u4f60\u5e94\u8be5\u4f7f\u7528\u4e0e\u4f60\u7684\u57df\u5957\u63a5\u5b57\u5377\u7c7b\u578b\u76f8\u5e94\u7684\u5c5e\u6027 \n+[\u57df\u5957\u63a5\u5b57\u5377\u7c7b\u578b]({{ '/en/compute/Spark-On-Kubernetes.html#short-circuit-operations' | relativize_url}}\u3002\n+\n+##\u6545\u969c\u6392\u9664\n+\n+###\u8bbf\u95eeAlluxio\u5ba2\u6237\u7aef\u65e5\u5fd7\n+\n+\u53ef\u5728Spark\u9a71\u52a8\u548c\u6267\u884c\u5668\u65e5\u5fd7\u4e2d\u627e\u5230Alluxio\u5ba2\u6237\u7aef\u65e5\u5fd7\u3002\n+\u6709\u5173\u66f4\u591a\u8bf4\u660e\u53c2\u8003\n+[Spark\u6587\u6863](https://spark.apache.org/docs/latest/running-on-kubernetes.html#debugging)", "originalCommit": "23bf2f279aeaedd9ff7902b31dc229476e08f23f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDUyNzQ1Mw==", "url": "https://github.com/Alluxio/alluxio/pull/11873#discussion_r464527453", "bodyText": "before \"spark\" it needs to be   \"`\"   instead of '", "author": "LuQQiu", "createdAt": "2020-08-03T16:35:29Z", "path": "docs/cn/compute/Spark-On-Kubernetes.md", "diffHunk": "@@ -0,0 +1,202 @@\n+---\n+layout: global\n+title: Kubernetes\u73af\u5883\u4e0b\u5728Alluxio\u4e0a\u8fd0\u884cSpark\n+nickname: Spark on Kubernetes\n+group: Compute Integrations\n+priority: 7\n+---\n+\n+Alluxio\u53ef\u4ee5\u5728Kubernetes\u4e0a\u8fd0\u884c\u3002\u672c\u6307\u5357\u6f14\u793a\u4e86\u5982\u4f55\u5728Kubernetes\u73af\u5883\u4e0b\u8fd0\u884c\u7684Alluxio\u4e0a\u8dd1\u4e00\u4e2aSpark\u4f5c\u4e1a\u3002\n+\n+* Table of Contents\n+{:toc}\n+\n+##\u6982\u8ff0\n+\n+\u5728Kubernetes\u4e0a\u8fd0\u884c\u7684Spark\u53ef\u4ee5\u5c06Alluxio\u7528\u4f5c\u6570\u636e\u8bbf\u95ee\u5c42\u3002\n+\u672c\u6307\u5357\u4ecb\u7ecd\u4e86Kubernetes\u73af\u5883\u4e0b\u5728Alluxio\u4e0a\u8fd0\u884cSpark\u4f5c\u4e1a\u793a\u4f8b\u3002\n+\u672c\u6559\u7a0b\u4e2d\u4f7f\u7528\u7684\u793a\u4f8b\u662f\u4e00\u4e2a\u8ba1\u7b97\u4e00\u4e2a\u6587\u4ef6\u4e2d\u6709\u591a\u5c11\u884c\u7684\u4f5c\u4e1a\u3002\n+\u5728\u4e0b\u6587\u4e2d\uff0c\u6211\u4eec\u5c06\u6b64\u4f5c\u4e1a\u79f0\u4e3a count\u3002\n+\n+##\u5148\u51b3\u6761\u4ef6\n+\n+-Kubernetes\u96c6\u7fa4(\u7248\u672c> = 1.8)\u3002\n+-Alluxio\u5df2\u90e8\u7f72\u5728Kubernetes\u96c6\u7fa4\u4e0a\u3002\u6709\u5173\u5982\u4f55\u90e8\u7f72Alluxio\u7684\u8bf4\u660e\uff0c\u8bf7\u53c2\u8003\n+[\u672c\u9875]({{ '/en/deploy/Running-Alluxio-On-Kubernetes.html' | relativize_url}})\n+\n+##\u57fa\u672c\u8bbe\u7f6e\n+\n+\u9996\u5148\uff0c\u6211\u4eec\u51c6\u5907\u4e00\u4e2aSpark Docker\u955c\u50cf\uff0c\u5176\u4e2d\u5305\u62ecAlluxio\u5ba2\u6237\u7aef\u548c\u4efb\u4f55\u5176\u4ed6\u5fc5\u9700\u7684jar\u6587\u4ef6\u3002\n+\u5728\u6240\u6709Kubernetes\u8282\u70b9\u4e0a\u90fd\u9700\u63d0\u4f9b\u6b64\u955c\u50cf\u3002\n+\n+###\u4e0b\u8f7d\u4e8c\u8fdb\u5236\u6587\u4ef6\n+\n+[\u4e0b\u8f7d](https://spark.apache.org/downloads.html)\u6240\u9700\u7684Spark\u7248\u672c\u3002\n+\u5bf9\u4e8e`spark-submit`\u547d\u4ee4\u548c\u4f7f\u7528Alluxio\u6240\u542b\u7684Dockerfile\u7f16\u8bd1Docker\u955c\u50cf\n+\u6211\u4eec\u90fd\u4f7f\u7528\u9884\u751f\u6210\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\uff0c\u3002\n+>\u6ce8:\u4e0b\u8f7d\u4e3aHadoop\u9884\u5236\u7684\u8f6f\u4ef6\u5305\n+\n+```console\n+$ tar -xf spark-2.4.4-bin-hadoop2.7.tgz\n+$ cd spark-2.4.4-bin-hadoop2.7\n+```\n+###\u7f16\u8bd1Spark Docker\u955c\u50cf\n+\n+\u4eceAlluxio Docker\u955c\u50cf\u4e2d\u63d0\u53d6Alluxio\u5ba2\u6237\u7aefjar:\n+\n+```console\n+$ id=$(docker create alluxio/alluxio:{{site.ALLUXIO_VERSION_STRING}})\n+$ docker cp $id:/opt/alluxio/client/alluxio-{{site.ALLUXIO_VERSION_STRING}}-client.jar \\\n+  - > alluxio-{{site.ALLUXIO_VERSION_STRING}}-client.jar\n+$ docker rm -v $id 1>/dev/null\n+```\n+\n+\u6dfb\u52a0\u6240\u9700\u7684Alluxio\u5ba2\u6237\u7aefjar\u5e76\u6784\u5efa\u7528\u4e8eSpark\u9a71\u52a8\u7a0b\u5e8f\u548c\u6267\u884c\u7a0b\u5e8fpods\u7684Docker\u955c\u50cf\u3002\n+\u4eceSpark\u53d1\u884c\u7248\u76ee\u5f55\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\u4ee5\u6dfb\u52a0Alluxio\u5ba2\u6237\u7aefjar\u3002\n+\n+```console\n+$ cp <path_to_alluxio_client>/alluxio-{{site.ALLUXIO_VERSION_STRING}}-client.jar jars/\n+```\n+>\u6ce8\u610f:\u4efb\u4f55\u590d\u5236\u5230`jars`\u76ee\u5f55\u7684jar\u6587\u4ef6\u5728\u7f16\u8bd1\u65f6\u90fd\u4f1a\u88ab\u5305\u542b\u5230Spark Docker\u955c\u50cf\u4e2d\u3002\n+\n+\u7f16\u8bd1Spark Docker\u955c\u50cf\n+\n+```console\n+$ docker build -t spark-alluxio -f kubernetes/dockerfiles/spark/Dockerfile .\n+```\n+>\u6ce8\u610f:\u786e\u4fdd\u6240\u6709\u8282\u70b9(spark-driver\u548cspark-executor pods\u5c06\u8fd0\u884c\u7684\u6240\u5728\u8282\u70b9) \n+\u90fd\u6709\u8be5\u955c\u50cf\u3002\n+\n+##\u793a\u4f8b\n+\n+\u672c\u8282\u8bf4\u660e\u5982\u4f55\u4f7f\u7528\u7f16\u8bd1\u7684Docker\u955c\u50cf\u6765\u53d1\u8d77\u4e00\u4e2a\u4ee5Alluxio\u4f5c\u4e3a\u6570\u636e\u6e90\u7684Spark\u4f5c\u4e1a\u3002\n+\n+###\u77ed\u8def\u64cd\u4f5c\n+\n+\u77ed\u8def\u8bbf\u95ee\u4f7fSpark\u6267\u884c\u5668\u4e2d\u7684Alluxio\u5ba2\u6237\u7aef\u53ef\u4ee5\u76f4\u63a5\u8bbf\u95ee\n+\u4e3b\u673a\u4e0a\u7684Alluxio worker\u5b58\u50a8\u3002\n+\u56e0\u4e3a\u4e0d\u901a\u8fc7\u7f51\u7edc\u5806\u6808\u6765\u4e0eAlluxio worker\u901a\u4fe1\uff0c\u8fd9\u6837\u53ef\u4ee5\u63d0\u9ad8\u6027\u80fd\u3002\n+\n+\u5982\u679c\u5728\u90e8\u7f72Alluxio\u65f6\u672a\u6309\u7167\u6307\u4ee4\u8bbe\u7f6e\u57df\u5957\u63a5\u5b57\n+][\u672c\u9875]({{ '/en/deploy/Running-Alluxio-On-Kubernetes.html' | relativize_url}}\uff03short-circuit-access)\uff0c\u5219\n+\u53ef\u4ee5\u8df3\u8fc7\u5c06`hostPath`\u5377\u6302\u8f7d\u5230Spark\u6267\u884c\u5668\u6b65\u9aa4\u3002\n+\n+\u5982\u679c\u5728\u8fd0\u884cAlluxio worker\u8fdb\u7a0b\u7684\u4e3b\u673a\u4e0a\u5c06\u57df\u5957\u63a5\u5b57\u4f4d\u7f6e\u8bbe\u7f6e\u4e3a\n+`/tmp/alluxio-domain`\uff0c\u5e76\u4e14Alluxio\u914d\u7f6e\u4e3a\n+`alluxio.worker.data.server.domain.socket.address=/opt/domain`\uff0c\u4f7f\u7528\u4ee5\u4e0bSpark\n+\u914d\u7f6e\u5c06`/tmp/alluxio-domain`\u6302\u8f7d\u5230Spark\u6267\u884c\u5668pod\u4e2d\u7684`/opt/domain`\u3002\n+\u4e0b\u4e00\u8282\u4e2d\u7684`spark-submit`\u547d\u4ee4\u5305\u542b\u8fd9\u4e9b\u5c5e\u6027\u3002\n+\n+\u53d6\u51b3\u4e8e\u4f60\u7684\u8bbe\u7f6e\uff0cAlluxio worker\u4e0a\u7684\u57df\u5957\u63a5\u5b57\u53ef\u4ee5\u662f`hostPath`\u5377\u6216`PersistententVolumeClaim`\u4e24\u79cd\u4e4b\u4e00\u3002\u53ef\u4ee5\u5728\u6b64\u5904\u627e\u5230\u6709\u5173\u5982\u4f55\u914d\u7f6eAlluxio worker\u4ee5\u4f7f\u7528\u77ed\u8def\u64cd\u4f5c\u7684\u66f4\u591a\u8be6\u7ec6\u4fe1\u606f \n+({{ '/en/deploy/Running-Alluxio-On-Kubernetes.html#short-circuit-access' | relativize_url}})\u3002\n+\u8fd9\u4e24\u4e2a\u9009\u9879\u7684spark-submit\u53c2\u6570\u5c06\u6709\u6240\u4e0d\u540c\u3002\n+\u53ef\u4ee5\u5728\u4ee5\u4e0bSpark\u6587\u6863\u4e2d\u627e\u5230\u6709\u5173\u5982\u4f55\u5c06\u5377\u6302\u8f7d\u5230Spark\u6267\u884c\u5668\u7684\u66f4\u591a[\u4fe1\u606f](https://spark.apache.org/docs/2.4.4/running-on-kubernetes.html#using-kubernetes-volumes)\u3002\n+\n+{% navtabs domainSocket %}\n+  {% navtab hostPath %}\n+  \u5982\u679c\u4f7f\u7528\u7684\u662fhostPath\u57df\u5957\u63a5\u5b57\uff0c\u5219\u5e94\u5c06\u4ee5\u4e0b\u5c5e\u6027\u4f20\u9012\u7ed9Spark:\n+  \n+  ```properties\n+  spark.kubernetes.executor.volumes.hostPath.alluxio-domain.mount.path=/opt/domain\n+  spark.kubernetes.executor.volumes.hostPath.alluxio-domain.mount.readOnly=true\n+  spark.kubernetes.executor.volumes.hostPath.alluxio-domain.options.path=/tmp/alluxio-domain\n+  spark.kubernetes.executor.volumes.hostPath.alluxio-domain.options.type=Directory\n+  ```\n+ \n+  {% endnavtab %}\n+  {% navtab PersistententVolumeClaim %}\n+  \u5982\u679c\u4f7f\u7528\u7684\u662fPersistententVolumeClaim\u57df\u5957\u63a5\u5b57\uff0c\u5219\u5e94\u5c06\u4ee5\u4e0b\u5c5e\u6027\u4f20\u9012\u7ed9Spark:\n+  \n+  ```properties\n+  spark.kubernetes.executor.volumes.persistentVolumeClaim.alluxio-domain.mount.path=/opt/domain \\\n+  spark.kubernetes.executor.volumes.persistentVolumeClaim.alluxio-domain.mount.readOnly=true \\\n+  spark.kubernetes.executor.volumes.persistentVolumeClaim.alluxio-domain.options.claimName=<domainSocketPVC name>\n+  ```\n+  \n+  {% endnavtab %}\n+{% endnavtabs %}\n+\n+\u6ce8\u610f: \n+-Spark\u4e2d\u7684\u5377\u652f\u6301\u662f\u57282.4.0\u7248\u4e2d\u6dfb\u52a0\u7684\u3002\n+-\u5f53\u4e0d\u901a\u8fc7\u57df\u5957\u63a5\u5b57\u4f7f\u7528\u77ed\u8def\u8bbf\u95ee\u65f6\uff0c\u53ef\u80fd\u4f1a\u89c2\u5bdf\u5230\u6027\u80fd\u4e0b\u964d\u3002\n+\n+###\u8fd0\u884cSpark\u4f5c\u4e1a\n+\n+\u4ee5\u4e0b\u547d\u4ee4\u5728Alluxio\u4f4d\u7f6e`/LICENSE`\u8fd0\u884c\u4e00\u4e2a\u8ba1\u5b57\u6570\u4f5c\u4e1a\u6837\u4f8b\u3002\n+\u53ef\u4ee5\u5728Spark\u9a71\u52a8\u7a0b\u5e8fpod\u7684\u65e5\u5fd7\u4e2d\u770b\u5230\u8fd0\u884c\u7684\u8f93\u51fa\u548c\u6240\u82b1\u8d39\u7684\u65f6\u95f4\u3002\u66f4\u8fdb\u4e00\u6b65[\u8bf4\u660e\u53c2\u8003Spark](https://spark.apache.org/docs/latest/running-on-kubernetes.html)\u3002\n+\n+####\u521b\u5efa\u670d\u52a1\u5e10\u6237(\u53ef\u9009)\n+\n+\u5982\u679c\u6ca1\u6709\u53ef\u4f7f\u7528\u7684\u670d\u52a1\u5e10\u6237\uff0c\u53ef\u4ee5\u6309\u5982\u4e0b\u6307\u4ee4\u521b\u5efa\u4e00\u4e2a\u5177\u6709\u6240\u9700\u8bbf\u95ee\u6743\u9650\u7684\u670d\u52a1\u8d26\u6237\u6765\u8fd0\u884cspark\u4f5c\u4e1a\u3002\n+\n+```console\n+$ kubectl create serviceaccount spark\n+$ kubectl create clusterrolebinding spark-role --clusterrole=edit \\\n+  --serviceaccount=default:spark --namespace=default\n+```\n+\n+####\u63d0\u4ea4Spark\u4f5c\u4e1a\n+\n+\u4eceSpark\u53d1\u884c\u7248\u76ee\u5f55\u8fd0\u884cSpark\u4f5c\u4e1a\n+\n+```console\n+$ ./bin/spark-submit --master k8s://https://<kubernetes-api-server>:8443 \\\n+--deploy-mode cluster --name spark-alluxio --conf spark.executor.instances=1 \\\n+--class org.apache.spark.examples.JavaWordCount \\\n+--driver-memory 500m --executor-memory 1g \\\n+--conf spark.kubernetes.authenticate.driver.serviceAccountName=spark \\\n+--conf spark.kubernetes.container.image=spark-alluxio \\\n+--conf spark.kubernetes.executor.volumes.hostPath.alluxio-domain.mount.path=/opt/domain \\\n+--conf spark.kubernetes.executor.volumes.hostPath.alluxio-domain.mount.readOnly=true \\\n+--conf spark.kubernetes.executor.volumes.hostPath.alluxio-domain.options.path=/tmp/alluxio-domain \\\n+--conf spark.kubernetes.executor.volumes.hostPath.alluxio-domain.options.type=Directory \\\n+local:///opt/spark/examples/jars/spark-examples_2.11-2.4.4.jar \\\n+alluxio://<alluxio-master>:19998/LICENSE\n+```\n+> \u6ce8\u610f:\u53ef\u4ee5\u901a\u8fc7\u8fd0\u884c`kubectl cluster-info`\u627e\u5230Kubernetes API\u670d\u52a1\u5668\u5730\u5740\u3002\n+\u60a8\u53ef\u4ee5\u5728Spark\u6587\u6863\u4e2d\u627e\u5230\u66f4\u591a\u8be6\u7ec6\u4fe1\u606f\u3002 [documentation](https://spark.apache.org/docs/latest/running-on-kubernetes.html?q=cluster-info#cluster-mode)\n+\u4f60\u5e94\u8be5\u4f7f\u7528\u4e0e\u4f60\u7684\u57df\u5957\u63a5\u5b57\u5377\u7c7b\u578b\u76f8\u5e94\u7684\u5c5e\u6027 \n+[\u57df\u5957\u63a5\u5b57\u5377\u7c7b\u578b]({{ '/en/compute/Spark-On-Kubernetes.html#short-circuit-operations' | relativize_url}}\u3002\n+\n+##\u6545\u969c\u6392\u9664\n+\n+###\u8bbf\u95eeAlluxio\u5ba2\u6237\u7aef\u65e5\u5fd7\n+\n+\u53ef\u5728Spark\u9a71\u52a8\u548c\u6267\u884c\u5668\u65e5\u5fd7\u4e2d\u627e\u5230Alluxio\u5ba2\u6237\u7aef\u65e5\u5fd7\u3002\n+\u6709\u5173\u66f4\u591a\u8bf4\u660e\u53c2\u8003\n+[Spark\u6587\u6863](https://spark.apache.org/docs/latest/running-on-kubernetes.html#debugging)\n+\n+### Kubernetes\u5ba2\u6237\u7aef\u4e0a\u7684HTTP 403\n+\n+\u5982\u679c\u4f60\u7684Spark\u4f5c\u4e1a\u56e0Kubernetes\u5ba2\u6237\u7aef\u4e2d\u5982\u4e0b\u9519\u8bef\u800c\u5931\u8d25:\n+```\n+WARN ExecutorPodsWatchSnapshotSource: Kubernetes client has been closed\n+...\n+ERROR SparkContext: Error initializing SparkContext.\n+io.fabric8.kubernetes.client.KubernetesClientException\n+```\n+\n+\u8fd9\u53ef\u80fd\u662f\u7531\u4e8e\u4e00\u4e2a[\u5df2\u77e5\u95ee\u9898](https://issues.apache.org/jira/browse/SPARK-28921)\u5bfc\u81f4\u7684\uff0c\u53ef\u4ee5\u901a\u8fc7\u5c06`kubernetes- client.jar`\u5347\u7ea7\u81f34.4.x\u6765\u89e3\u51b3\u3002\n+\u60a8\u53ef\u4ee5\u5728\u7f16\u8bd1`spark-alluxio`\u955c\u50cf\u4e4b\u524d\u901a\u8fc7\u66f4\u65b0`kubernetes-client-xxjar`\u6765\u4fee\u8865docker\u955c\u50cf\u3002\n+\n+```console\n+rm spark-2.4.4-bin-hadoop2.7/jars/kubernetes-client-*.jar\n+wget https://repo1.maven.org/maven2/io/fabric8/kubernetes-client/4.4.2/kubernetes-client-4.4.2.jar \n+cp kubernetes-client-4.4.2.jar spark-2.4.4-bin-hadoop2.7/jars\n+```\n+\u7136\u540e\u7f16\u8bd1'spark-alluxio`\u955c\u50cf\uff0c\u5e76\u5206\u53d1\u5230\u6240\u6709\u8282\u70b9\u3002", "originalCommit": "23bf2f279aeaedd9ff7902b31dc229476e08f23f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "6038ec3fc7739ff71ffb7b67873c7ddc3fe0a6e9", "url": "https://github.com/Alluxio/alluxio/commit/6038ec3fc7739ff71ffb7b67873c7ddc3fe0a6e9", "message": "Update Spark-On-Kubernetes.md", "committedDate": "2020-08-03T21:44:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTMwODk1MQ==", "url": "https://github.com/Alluxio/alluxio/pull/11873#discussion_r465308951", "bodyText": "Update all the header code style in the whole doc.\nAdd spaces after the ## ### ####", "author": "LuQQiu", "createdAt": "2020-08-04T20:24:02Z", "path": "docs/cn/compute/Spark-On-Kubernetes.md", "diffHunk": "@@ -0,0 +1,198 @@\n+---\n+layout: global\n+title: Kubernetes\u73af\u5883\u4e0b\u5728Alluxio\u4e0a\u8fd0\u884cSpark\n+nickname: Spark on Kubernetes\n+group: Compute Integrations\n+priority: 7\n+---\n+\n+Alluxio\u53ef\u4ee5\u5728Kubernetes\u4e0a\u8fd0\u884c\u3002\u672c\u6307\u5357\u6f14\u793a\u4e86\u5982\u4f55\u5728Kubernetes\u73af\u5883\u4e0b\u8fd0\u884c\u7684Alluxio\u4e0a\u8dd1\u4e00\u4e2aSpark\u4f5c\u4e1a\u3002\n+\n+* Table of Contents\n+{:toc}\n+\n+##\u6982\u8ff0", "originalCommit": "6038ec3fc7739ff71ffb7b67873c7ddc3fe0a6e9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "5f7edc8d12331873b51155313624bbde806b4425", "url": "https://github.com/Alluxio/alluxio/commit/5f7edc8d12331873b51155313624bbde806b4425", "message": "Update Spark-On-Kubernetes.md", "committedDate": "2020-08-04T21:34:03Z", "type": "commit"}, {"oid": "696008b8b2d1826ee47e2d48e639370e5679ca6c", "url": "https://github.com/Alluxio/alluxio/commit/696008b8b2d1826ee47e2d48e639370e5679ca6c", "message": "Update Spark-On-Kubernetes.md", "committedDate": "2020-08-10T21:20:21Z", "type": "commit"}]}