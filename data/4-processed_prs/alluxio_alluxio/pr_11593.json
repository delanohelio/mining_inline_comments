{"pr_number": 11593, "pr_title": "Fix Fuse crash in kubernetes in helmchart", "pr_createdAt": "2020-06-18T08:40:00Z", "pr_url": "https://github.com/Alluxio/alluxio/pull/11593", "timeline": [{"oid": "aba3ffa4264709ba95b53c722263945e7ffbabce", "url": "https://github.com/Alluxio/alluxio/commit/aba3ffa4264709ba95b53c722263945e7ffbabce", "message": "Fix fuse crash, to #28879036", "committedDate": "2020-06-18T08:24:11Z", "type": "commit"}, {"oid": "2b7bab2e7ce827ec6ebffd9929dc11f3fbd6e49e", "url": "https://github.com/Alluxio/alluxio/commit/2b7bab2e7ce827ec6ebffd9929dc11f3fbd6e49e", "message": "Make pod access itself throw service, to #28879036", "committedDate": "2020-06-18T08:29:26Z", "type": "commit"}, {"oid": "cbf16e23d9a34430ee8580f3cfc83d8fd447962f", "url": "https://github.com/Alluxio/alluxio/commit/cbf16e23d9a34430ee8580f3cfc83d8fd447962f", "message": "Update change log, to #28879036", "committedDate": "2020-06-18T08:31:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjMwMTg5MQ==", "url": "https://github.com/Alluxio/alluxio/pull/11593#discussion_r442301891", "bodyText": "I suggest changing this line to \"Change master service to headless from NodePort\"", "author": "jiacheliu3", "createdAt": "2020-06-18T15:12:05Z", "path": "integration/kubernetes/helm-chart/alluxio/CHANGELOG.md", "diffHunk": "@@ -99,4 +99,6 @@\n - Moved metastore configuration properties to the root level, to be the same as journal\n - Removed inferring hostNetwork, dnsPolicy and domain socket from whether user is root\n - Added inferring dnsPolicy from hostNetwork\n-- Fixed one typo in ALLUXIO_CLIENT_JAVA_OPTS for FUSE   \n+- Fixed one typo in ALLUXIO_CLIENT_JAVA_OPTS for FUSE\n+- Fixed Fuse crash issue\n+- Fixed the pod can't access itself through service", "originalCommit": "cbf16e23d9a34430ee8580f3cfc83d8fd447962f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjU0MzY2OA==", "url": "https://github.com/Alluxio/alluxio/pull/11593#discussion_r442543668", "bodyText": "Done", "author": "cheyang", "createdAt": "2020-06-18T22:54:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjMwMTg5MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjMwNjQxMA==", "url": "https://github.com/Alluxio/alluxio/pull/11593#discussion_r442306410", "bodyText": "@madanadit I'm not too sure about what java opts Fuse wants. But it can be related to this ALLUXIO_CLIENT_JAVA_OPTS not being used \n  \n    \n      alluxio/integration/kubernetes/helm-chart/alluxio/templates/fuse/daemonset.yaml\n    \n    \n         Line 96\n      in\n      db1418e\n    \n    \n    \n    \n\n        \n          \n           - name: ALLUXIO_CLIENT_JAVA_OPTS \n        \n    \n  \n\n\nLooking at \n  \n    \n      alluxio/integration/docker/entrypoint.sh\n    \n    \n         Line 30\n      in\n      db1418e\n    \n    \n    \n    \n\n        \n          \n           ALLUXIO_USER_JAVA_OPTS \n        \n    \n  \n\n, I think it should be ALLUXIO_USER_JAVA_OPTS instead of ALLUXIO_CLIENT_JAVA_OPTS? So by changing \n  \n    \n      alluxio/integration/kubernetes/helm-chart/alluxio/templates/fuse/daemonset.yaml\n    \n    \n         Line 96\n      in\n      db1418e\n    \n    \n    \n    \n\n        \n          \n           - name: ALLUXIO_CLIENT_JAVA_OPTS \n        \n    \n  \n\n from ALLUXIO_CLIENT_JAVA_OPTS to ALLUXIO_USER_JAVA_OPTS, we can fix this issue without adding \"-Dalluxio.worker.hostname=${ALLUXIO_CLIENT_HOSTNAME}\"", "author": "jiacheliu3", "createdAt": "2020-06-18T15:18:40Z", "path": "integration/kubernetes/helm-chart/alluxio/templates/config/alluxio-conf.yaml", "diffHunk": "@@ -26,6 +26,10 @@\n {{- if $isSingleMaster }}\n   {{- $alluxioJavaOpts = printf \"-Dalluxio.master.hostname=%v-%v\" $fullName $defaultMasterName | append $alluxioJavaOpts }}\n {{- end }}\n+{{ if .Values.fuse.enabled -}}\n+{{- $alluxioJavaOpts = print \"-Dalluxio.user.hostname=${ALLUXIO_CLIENT_HOSTNAME}\" | append $alluxioJavaOpts }}\n+{{- $alluxioJavaOpts = printf \"-Dalluxio.worker.hostname=${ALLUXIO_CLIENT_HOSTNAME}\" | append $alluxioJavaOpts }}", "originalCommit": "cbf16e23d9a34430ee8580f3cfc83d8fd447962f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjU0NjI0MQ==", "url": "https://github.com/Alluxio/alluxio/pull/11593#discussion_r442546241", "bodyText": "We put it in alluxioJavaOpts for a long time, and it was always working fine. I suggest you should test it when making code reconstruction.", "author": "cheyang", "createdAt": "2020-06-18T23:03:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjMwNjQxMA=="}], "type": "inlineReview"}, {"oid": "78a04d819a567bc5a81401c808870fffa3b443f2", "url": "https://github.com/Alluxio/alluxio/commit/78a04d819a567bc5a81401c808870fffa3b443f2", "message": "Update changelog, to #28465442", "committedDate": "2020-06-18T22:54:06Z", "type": "commit"}, {"oid": "ec6390e49997c9aa24281e4a983c60107ae9915d", "url": "https://github.com/Alluxio/alluxio/commit/ec6390e49997c9aa24281e4a983c60107ae9915d", "message": "Make the master access itself, to #28465442", "committedDate": "2020-06-19T11:27:06Z", "type": "commit"}, {"oid": "14fc0adf0250a1fee46c8bef6b061e7bf65391eb", "url": "https://github.com/Alluxio/alluxio/commit/14fc0adf0250a1fee46c8bef6b061e7bf65391eb", "message": "Update version to 0.6.4, to #28465442", "committedDate": "2020-06-19T14:00:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjkyMjQwNg==", "url": "https://github.com/Alluxio/alluxio/pull/11593#discussion_r442922406", "bodyText": "Please add this to the change log.", "author": "jiacheliu3", "createdAt": "2020-06-19T16:00:29Z", "path": "integration/kubernetes/helm-chart/alluxio/templates/master/statefulset.yaml", "diffHunk": "@@ -92,6 +92,12 @@ spec:\n             valueFrom:\n               fieldRef:\n                 fieldPath: metadata.name\n+          {{- else if $isSingleMaster }}\n+          env:\n+          - name: ALLUXIO_MASTER_HOSTNAME\n+            valueFrom:\n+              fieldRef:\n+                fieldPath: status.podIP", "originalCommit": "14fc0adf0250a1fee46c8bef6b061e7bf65391eb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}