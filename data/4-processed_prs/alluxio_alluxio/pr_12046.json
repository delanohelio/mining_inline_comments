{"pr_number": 12046, "pr_title": "Remove synchronized in ConfigHashSync", "pr_createdAt": "2020-08-28T18:11:36Z", "pr_url": "https://github.com/Alluxio/alluxio/pull/12046", "timeline": [{"oid": "5834bfd30b9b2fa9a9d2f8d2cf36b2e15f6127d7", "url": "https://github.com/Alluxio/alluxio/commit/5834bfd30b9b2fa9a9d2f8d2cf36b2e15f6127d7", "message": "Remove synchronized in ConfigHashSync", "committedDate": "2020-08-28T18:04:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTUzMjE3OQ==", "url": "https://github.com/Alluxio/alluxio/pull/12046#discussion_r479532179", "bodyText": "I'm not entirely sure we are allowed to remove this synchronized. However, I know we can remove the one with close(), since it just calls another method which is already synchronized. If we just remove the synchronized on the ConfigHashSync#close(), that should remove the deadlock cycle, right?\nI'm just concerned that synchronized might be required for heartbeat().", "author": "gpang", "createdAt": "2020-08-28T21:00:13Z", "path": "core/client/fs/src/main/java/alluxio/client/file/ConfigHashSync.java", "diffHunk": "@@ -72,7 +72,7 @@ public void resetMetaMasterConfigClient(MasterClientContext context) {\n   }\n \n   @Override\n-  public synchronized void heartbeat() {\n+  public void heartbeat() {", "originalCommit": "5834bfd30b9b2fa9a9d2f8d2cf36b2e15f6127d7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTU0MjY2NQ==", "url": "https://github.com/Alluxio/alluxio/pull/12046#discussion_r479542665", "bodyText": "We have one thread that should be running heartbeat so there or not, it shouldn't really make a difference. I'll put it back.", "author": "bradyoo", "createdAt": "2020-08-28T21:29:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTUzMjE3OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTUzMjcwNA==", "url": "https://github.com/Alluxio/alluxio/pull/12046#discussion_r479532704", "bodyText": "mClient is used in this method.. so what if another thread closes it before an operation on mClient?", "author": "yuzhu", "createdAt": "2020-08-28T21:01:38Z", "path": "core/client/fs/src/main/java/alluxio/client/file/ConfigHashSync.java", "diffHunk": "@@ -72,7 +72,7 @@ public void resetMetaMasterConfigClient(MasterClientContext context) {\n   }\n \n   @Override\n-  public synchronized void heartbeat() {\n+  public void heartbeat() {", "originalCommit": "5834bfd30b9b2fa9a9d2f8d2cf36b2e15f6127d7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTU0Mjg2NA==", "url": "https://github.com/Alluxio/alluxio/pull/12046#discussion_r479542864", "bodyText": "mClient is also threadsafe by having its own synchronized methods.", "author": "bradyoo", "createdAt": "2020-08-28T21:29:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTUzMjcwNA=="}], "type": "inlineReview"}, {"oid": "a8b4ac3c248a8fa9e0c7572460298a73f2336d18", "url": "https://github.com/Alluxio/alluxio/commit/a8b4ac3c248a8fa9e0c7572460298a73f2336d18", "message": "bring back synchronized in heartbeat", "committedDate": "2020-08-28T21:30:51Z", "type": "commit"}]}