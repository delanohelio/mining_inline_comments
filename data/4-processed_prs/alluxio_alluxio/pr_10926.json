{"pr_number": 10926, "pr_title": "[DOCFIX] Add collectInfo command to doc", "pr_createdAt": "2020-02-17T09:30:20Z", "pr_url": "https://github.com/Alluxio/alluxio/pull/10926", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTQ3MDQyMQ==", "url": "https://github.com/Alluxio/alluxio/pull/10926#discussion_r381470421", "bodyText": "Mention a rough estimate of size here.", "author": "ns1123", "createdAt": "2020-02-19T18:43:06Z", "path": "docs/en/operation/Troubleshooting.md", "diffHunk": "@@ -56,6 +56,69 @@ set the debug server's host and port, and start the debug session. If you set a\n will enter debug mode and you can inspect the current context's variables, call stack, thread list, and expression\n evaluation.\n \n+## Alluxio collectInfo command\n+\n+Alluxio has a `collectInfo` command that collect information to troubleshoot an Alluxio cluster. \n+`collectInfo` will run a set of sub-commands that each collects one aspect of system information, as explained below.\n+In the end the collected information will be bundled into one tarball which contains all information regarding your Alluxio cluster.", "originalCommit": "bdf2403a067f30080090b3d9d19c80117ff5be4d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTQ3MTM3Ng==", "url": "https://github.com/Alluxio/alluxio/pull/10926#discussion_r381471376", "bodyText": "Specifically mention which of these commands has credential leaking risks. That way users can know what is and isn't safe.", "author": "ns1123", "createdAt": "2020-02-19T18:44:49Z", "path": "docs/en/operation/Troubleshooting.md", "diffHunk": "@@ -56,6 +56,69 @@ set the debug server's host and port, and start the debug session. If you set a\n will enter debug mode and you can inspect the current context's variables, call stack, thread list, and expression\n evaluation.\n \n+## Alluxio collectInfo command\n+\n+Alluxio has a `collectInfo` command that collect information to troubleshoot an Alluxio cluster. \n+`collectInfo` will run a set of sub-commands that each collects one aspect of system information, as explained below.\n+In the end the collected information will be bundled into one tarball which contains all information regarding your Alluxio cluster.\n+The tarball can then be shared with someone you trust to help troubleshoot your Alluxio cluster.\n+\n+The `collectInfo` will SSH to each node and execute the set of sub-commands.\n+In the end of execution the collected information will be written to files and tarballed.\n+Each individual tarball will be collected to the issuing node.\n+Then all the tarballs will be bundled into the final tarball, which contains all information about the Alluxio cluster. \n+\n+>NOTE: Be careful if your configuration contains credentials like AWS keys!\n+You should ALWAYS CHECK what is in the tarball and REMOVE the sensitive information from the tarball before sharing it with someone!\n+\n+### Collect Alluxio cluster information", "originalCommit": "bdf2403a067f30080090b3d9d19c80117ff5be4d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTIyMDI1Nw==", "url": "https://github.com/Alluxio/alluxio/pull/10926#discussion_r385220257", "bodyText": "PTAL at the more detailed WARNINGs. Thanks!", "author": "jiacheliu3", "createdAt": "2020-02-27T16:26:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTQ3MTM3Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTQ3MTk1Mg==", "url": "https://github.com/Alluxio/alluxio/pull/10926#discussion_r381471952", "bodyText": "Explicitly mention which nonAlluxio JVM processes we will collect information on.", "author": "ns1123", "createdAt": "2020-02-19T18:45:51Z", "path": "docs/en/operation/Troubleshooting.md", "diffHunk": "@@ -56,6 +56,69 @@ set the debug server's host and port, and start the debug session. If you set a\n will enter debug mode and you can inspect the current context's variables, call stack, thread list, and expression\n evaluation.\n \n+## Alluxio collectInfo command\n+\n+Alluxio has a `collectInfo` command that collect information to troubleshoot an Alluxio cluster. \n+`collectInfo` will run a set of sub-commands that each collects one aspect of system information, as explained below.\n+In the end the collected information will be bundled into one tarball which contains all information regarding your Alluxio cluster.\n+The tarball can then be shared with someone you trust to help troubleshoot your Alluxio cluster.\n+\n+The `collectInfo` will SSH to each node and execute the set of sub-commands.\n+In the end of execution the collected information will be written to files and tarballed.\n+Each individual tarball will be collected to the issuing node.\n+Then all the tarballs will be bundled into the final tarball, which contains all information about the Alluxio cluster. \n+\n+>NOTE: Be careful if your configuration contains credentials like AWS keys!\n+You should ALWAYS CHECK what is in the tarball and REMOVE the sensitive information from the tarball before sharing it with someone!\n+\n+### Collect Alluxio cluster information\n+`collectAlluxioInfo` will run a set of Alluxio commands that collect information about the Alluxio cluster, like `bin/alluxio fsadmin report` etc.\n+When the Alluxio cluster is not running, this command will fail to collect some information.\n+\n+### Collect Alluxio configuration files\n+`collectConfig` will collect all the configuration files under `${alluxio.work.dir}/conf`.\n+\n+### Collect Alluxio logs\n+`collectLog` will collect all the logs under `${alluxio.work.dir}/logs`.\n+\n+### Collect Alluxio metrics\n+`collectMetrics` will collect Alluxio metrics served at `http://${alluxio.master.hostname}:${alluxio.master.web.port}/metrics/json/` by default.\n+The metrics will be collected multiple times to see the progress.\n+\n+### Collect JVM information\n+`collectJvmInfo` will collect information about the existing JVMs on each node.\n+This is done by running a `jps` command then `jstack` on each found JVM process.\n+This will be done multiple times to see if the JVMs are making progress. ", "originalCommit": "bdf2403a067f30080090b3d9d19c80117ff5be4d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTIwNTcwOA==", "url": "https://github.com/Alluxio/alluxio/pull/10926#discussion_r385205708", "bodyText": "Currently it's ALL JVMs returned by jps (sudo jps if this works).\nAre there good heuristics on deciding which JVMs we want and not want?", "author": "jiacheliu3", "createdAt": "2020-02-27T16:04:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTQ3MTk1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzM2MDQ5OA==", "url": "https://github.com/Alluxio/alluxio/pull/10926#discussion_r387360498", "bodyText": "Hmm I thought we filtered for Presto/Spark. Ignore.", "author": "ns1123", "createdAt": "2020-03-03T23:40:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTQ3MTk1Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTQ3Mjc5NA==", "url": "https://github.com/Alluxio/alluxio/pull/10926#discussion_r381472794", "bodyText": "Usage should also reiterate credential risks. People don't read docs, but they generally take a look at the usage functionality.", "author": "ns1123", "createdAt": "2020-02-19T18:47:28Z", "path": "shell/src/main/java/alluxio/cli/bundler/CollectInfo.java", "diffHunk": "@@ -60,6 +61,17 @@\n  */\n public class CollectInfo extends AbstractShell {\n   private static final Logger LOG = LoggerFactory.getLogger(CollectInfo.class);\n+  private static final String USAGE =\n+          \"USAGE: collectInfo [--max-threads <threadNum>] [--local]\\n\\n\"\n+                  + \"collectInfo runs a set of sub-commands which collect information\"\n+                  + \"about your Alluxio cluster. In the end of the run, \"\n+                  + \"the collected information will be written to files \"", "originalCommit": "bdf2403a067f30080090b3d9d19c80117ff5be4d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTIwNjQ5MA==", "url": "https://github.com/Alluxio/alluxio/pull/10926#discussion_r385206490", "bodyText": "Marked as resolved as we move the code change part to #11037", "author": "jiacheliu3", "createdAt": "2020-02-27T16:05:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTQ3Mjc5NA=="}], "type": "inlineReview"}, {"oid": "e8e4ad92948b9b2983cec59c7a02db43fbf862b7", "url": "https://github.com/Alluxio/alluxio/commit/e8e4ad92948b9b2983cec59c7a02db43fbf862b7", "message": "improve description and log", "committedDate": "2020-02-27T16:30:29Z", "type": "commit"}, {"oid": "6a5ff36a77a311822f697d2c315e28e2d13fd58e", "url": "https://github.com/Alluxio/alluxio/commit/6a5ff36a77a311822f697d2c315e28e2d13fd58e", "message": "resolve comments", "committedDate": "2020-02-27T16:31:13Z", "type": "commit"}, {"oid": "6a5ff36a77a311822f697d2c315e28e2d13fd58e", "url": "https://github.com/Alluxio/alluxio/commit/6a5ff36a77a311822f697d2c315e28e2d13fd58e", "message": "resolve comments", "committedDate": "2020-02-27T16:31:13Z", "type": "forcePushed"}, {"oid": "f6193107d5c8720b34bdaf04411d1a451d82f5c0", "url": "https://github.com/Alluxio/alluxio/commit/f6193107d5c8720b34bdaf04411d1a451d82f5c0", "message": "revert accidental change in rebase", "committedDate": "2020-02-27T16:34:07Z", "type": "commit"}]}