{"pr_number": 12059, "pr_title": "Remove assert in JVM Pause Monitor stop", "pr_createdAt": "2020-09-01T07:04:18Z", "pr_url": "https://github.com/Alluxio/alluxio/pull/12059", "timeline": [{"oid": "f598e561c599b8eb33223148e22d5eacdbe7effd", "url": "https://github.com/Alluxio/alluxio/commit/f598e561c599b8eb33223148e22d5eacdbe7effd", "message": "Remove assert in JVM Pause Monitor stop", "committedDate": "2020-09-01T07:03:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTM5ODE4NA==", "url": "https://github.com/Alluxio/alluxio/pull/12059#discussion_r481398184", "bodyText": "I think this should be fine, but maybe we should also add synchronized on both start and stop to keep the starting/stopping thread-safe.\nHow do tests call start and stop in different threads?", "author": "gpang", "createdAt": "2020-09-01T20:02:01Z", "path": "core/common/src/main/java/alluxio/util/JvmPauseMonitor.java", "diffHunk": "@@ -88,8 +88,9 @@ public void start() {\n    * Stops jvm monitor.\n    */\n   public void stop() {\n-    Preconditions.checkState(mJvmMonitorThread != null,\n-        \"JVM monitor thread does not start\");\n+    if (mJvmMonitorThread == null) {", "originalCommit": "f598e561c599b8eb33223148e22d5eacdbe7effd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTQ1NzAxMQ==", "url": "https://github.com/Alluxio/alluxio/pull/12059#discussion_r481457011", "bodyText": "I honestly am not sure if its really the result of calling it in different threads or if it's a result of some bad code. But my main thought around this was that we really don't need assert statements that block you from doing better cleanup when we are tearing things down.", "author": "bradyoo", "createdAt": "2020-09-01T22:02:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTM5ODE4NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTA0NjcwNg==", "url": "https://github.com/Alluxio/alluxio/pull/12059#discussion_r485046706", "bodyText": "If start and stop are not synchronized, couldn't there be a situation where the clean up is not performed at all? It would be the same situation when the assert failed.", "author": "gpang", "createdAt": "2020-09-08T16:24:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTM5ODE4NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTEyMjA5OA==", "url": "https://github.com/Alluxio/alluxio/pull/12059#discussion_r485122098", "bodyText": "Well, that's one way this could fail. But if you look at this alternatively, if you crash here, all you are saying is that I'm going to stop this process without doing rest of the cleanup. When the whole point of stopping this is to stop the process.", "author": "bradyoo", "createdAt": "2020-09-08T18:40:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTM5ODE4NA=="}], "type": "inlineReview"}]}