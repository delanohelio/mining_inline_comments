{"pr_number": 12081, "pr_title": "Fix active sync manager error on secondary master", "pr_createdAt": "2020-09-08T18:28:57Z", "pr_url": "https://github.com/Alluxio/alluxio/pull/12081", "timeline": [{"oid": "1b9c43b8ccefae1af0cf7c9da69e86e21e56bd79", "url": "https://github.com/Alluxio/alluxio/commit/1b9c43b8ccefae1af0cf7c9da69e86e21e56bd79", "message": "Fix active sync manager error on secondary master", "committedDate": "2020-09-04T19:17:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTE2OTQxMA==", "url": "https://github.com/Alluxio/alluxio/pull/12081#discussion_r485169410", "bodyText": "Where is this set to false?", "author": "gpang", "createdAt": "2020-09-08T20:11:42Z", "path": "core/server/master/src/main/java/alluxio/master/file/activesync/ActiveSyncManager.java", "diffHunk": "@@ -164,6 +166,7 @@ public boolean isUnderSyncPoint(AlluxioURI path) {\n    * Start the polling threads.\n    */\n   public void start() throws IOException {\n+    mStarted = true;", "originalCommit": "1b9c43b8ccefae1af0cf7c9da69e86e21e56bd79", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTI1NTQxMA==", "url": "https://github.com/Alluxio/alluxio/pull/12081#discussion_r485255410", "bodyText": "Added in stop().", "author": "bf8086", "createdAt": "2020-09-08T23:47:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTE2OTQxMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTE2OTc1Nw==", "url": "https://github.com/Alluxio/alluxio/pull/12081#discussion_r485169757", "bodyText": "What is the difference from before? How does the new code avoid UFS access?", "author": "gpang", "createdAt": "2020-09-08T20:12:25Z", "path": "core/server/master/src/main/java/alluxio/master/file/activesync/ActiveSyncManager.java", "diffHunk": "@@ -428,8 +431,9 @@ public boolean hasNext() {\n         while (mountId == -1) {\n           try {\n             syncPointPath = mEntry.getPath();\n-            MountTable.Resolution resolution = mMountTable.resolve(mEntry);\n-            mountId = resolution.getMountId();\n+            String mountPoint = mMountTable.getMountPoint(mEntry);", "originalCommit": "1b9c43b8ccefae1af0cf7c9da69e86e21e56bd79", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTI1Njg0OA==", "url": "https://github.com/Alluxio/alluxio/pull/12081#discussion_r485256848", "bodyText": "MountTable::resolve() will actually create a UFS client to query the UFS path while the new code only grabs the MountInfo. This function only need the mount id so resolution is not required.", "author": "bf8086", "createdAt": "2020-09-08T23:51:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTE2OTc1Nw=="}], "type": "inlineReview"}, {"oid": "800dee27239c0cd073c7b4443f54184f1e122ac5", "url": "https://github.com/Alluxio/alluxio/commit/800dee27239c0cd073c7b4443f54184f1e122ac5", "message": "Fix state", "committedDate": "2020-09-08T23:46:35Z", "type": "commit"}]}