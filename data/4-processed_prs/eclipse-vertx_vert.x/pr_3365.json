{"pr_number": 3365, "pr_title": "Fixes #3363 SslHandshakeCompletionHandler should use Netty promise", "pr_createdAt": "2020-04-10T12:54:55Z", "pr_url": "https://github.com/eclipse-vertx/vert.x/pull/3365", "timeline": [{"oid": "032b627649abe26c9867580a0ee9b874743df165", "url": "https://github.com/eclipse-vertx/vert.x/commit/032b627649abe26c9867580a0ee9b874743df165", "message": "Fixes #3363\n\nSigned-off-by: Dimitris Zenios <dimitris.zenios@gmail.com>", "committedDate": "2020-04-17T10:30:04Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDE4MjA0Nw==", "url": "https://github.com/eclipse-vertx/vert.x/pull/3365#discussion_r410182047", "bodyText": "here instead use context.dispatch(res, handler)", "author": "vietj", "createdAt": "2020-04-17T12:13:44Z", "path": "src/main/java/io/vertx/core/net/impl/NetSocketImpl.java", "diffHunk": "@@ -317,11 +315,19 @@ public NetSocket upgradeToSsl(Handler<AsyncResult<Void>> handler) {\n   public NetSocket upgradeToSsl(String serverName, Handler<AsyncResult<Void>> handler) {\n     ChannelOutboundHandler sslHandler = (ChannelOutboundHandler) chctx.pipeline().get(\"ssl\");\n     if (sslHandler == null) {\n-      chctx.pipeline().addFirst(\"handshaker\", new SslHandshakeCompletionHandler(ar -> {\n+      ChannelPromise p = chctx.newPromise();\n+      chctx.pipeline().addFirst(\"handshaker\", new SslHandshakeCompletionHandler(p));\n+      p.addListener(future -> {\n         if (handler != null) {\n-          context.dispatch(ar.mapEmpty(), handler);\n+          AsyncResult<Void> res;\n+          if (future.isSuccess()) {\n+            res = Future.succeededFuture();\n+          } else {\n+            res = Future.failedFuture(future.cause());\n+          }\n+          context.dispatch(null, u -> handler.handle(res));", "originalCommit": "032b627649abe26c9867580a0ee9b874743df165", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "71f5ff76a9d911e96d9b5db4f4b07bb55800e340", "url": "https://github.com/eclipse-vertx/vert.x/commit/71f5ff76a9d911e96d9b5db4f4b07bb55800e340", "message": "Fixes #3363\n\nSigned-off-by: Dimitris Zenios <dimitris.zenios@gmail.com>", "committedDate": "2020-04-17T22:47:45Z", "type": "commit"}, {"oid": "71f5ff76a9d911e96d9b5db4f4b07bb55800e340", "url": "https://github.com/eclipse-vertx/vert.x/commit/71f5ff76a9d911e96d9b5db4f4b07bb55800e340", "message": "Fixes #3363\n\nSigned-off-by: Dimitris Zenios <dimitris.zenios@gmail.com>", "committedDate": "2020-04-17T22:47:45Z", "type": "forcePushed"}]}