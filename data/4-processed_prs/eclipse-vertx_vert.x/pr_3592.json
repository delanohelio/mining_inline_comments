{"pr_number": 3592, "pr_title": "New generic KeyStoreOptions", "pr_createdAt": "2020-10-05T08:53:27Z", "pr_url": "https://github.com/eclipse-vertx/vert.x/pull/3592", "timeline": [{"oid": "8e0ff63d214a74d52b9f97858d4e11aa59eeb93b", "url": "https://github.com/eclipse-vertx/vert.x/commit/8e0ff63d214a74d52b9f97858d4e11aa59eeb93b", "message": "Introduce a new generic KeyStoreOptions that can be used when a KeyStore based implementation of JksOptions or TrustOptions. This implementation allows to specify a type that is used when loading\nthe KeyStore. PfxOptions and TrustOptions have been retrofit to extend this new class and set the type to the appropriate type. The TrustOptions#toJson() method has been removed because it does not seem to belong to TrustOptions and was used mainly for testing purposes. - fixes #3591", "committedDate": "2020-10-05T08:50:24Z", "type": "commit"}, {"oid": "72b68e982adbad6d005cdd534730d7e0862ad910", "url": "https://github.com/eclipse-vertx/vert.x/commit/72b68e982adbad6d005cdd534730d7e0862ad910", "message": "Use .bks instead of .jks for doc example", "committedDate": "2020-10-05T09:00:06Z", "type": "commit"}, {"oid": "a1bed47aac88320fe5d8bbcff8c130b178c3d607", "url": "https://github.com/eclipse-vertx/vert.x/commit/a1bed47aac88320fe5d8bbcff8c130b178c3d607", "message": "Fix failing tests due to invalid type", "committedDate": "2020-10-05T20:40:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDA3MjY3Mg==", "url": "https://github.com/eclipse-vertx/vert.x/pull/3592#discussion_r500072672", "bodyText": "was it just for test something? otherwise we can remove the else, i guess.", "author": "pmlopes", "createdAt": "2020-10-06T07:49:12Z", "path": "src/test/java/io/vertx/core/http/Http1xTest.java", "diffHunk": "@@ -530,7 +530,7 @@ private void checkCopyHttpClientOptions(HttpClientOptions options, HttpClientOpt\n     if (copy.getTrustOptions() instanceof PemTrustOptions) {\n       assertEquals(((PemTrustOptions) options.getTrustOptions()).getCertValues(), ((PemTrustOptions) copy.getTrustOptions()).getCertValues());\n     } else {\n-      assertEquals(options.getTrustOptions().toJson(), copy.getTrustOptions().toJson());\n+      // assertEquals(options.getTrustOptions().toJson(), copy.getTrustOptions().toJson());", "originalCommit": "a1bed47aac88320fe5d8bbcff8c130b178c3d607", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDEwOTM3NA==", "url": "https://github.com/eclipse-vertx/vert.x/pull/3592#discussion_r500109374", "bodyText": "I will downcast to specific class and write new asserts", "author": "vietj", "createdAt": "2020-10-06T08:47:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDA3MjY3Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDA3MjczMw==", "url": "https://github.com/eclipse-vertx/vert.x/pull/3592#discussion_r500072733", "bodyText": "was it just for test something? otherwise we can remove the else, i guess.", "author": "pmlopes", "createdAt": "2020-10-06T07:49:19Z", "path": "src/test/java/io/vertx/core/http/Http1xTest.java", "diffHunk": "@@ -828,7 +828,7 @@ private void checkCopyHttpServerOptions(HttpServerOptions options, HttpServerOpt\n     if (copy.getTrustOptions() instanceof PemTrustOptions) {\n       assertEquals(((PemTrustOptions) options.getTrustOptions()).getCertValues(), ((PemTrustOptions) copy.getTrustOptions()).getCertValues());\n     } else {\n-      assertEquals(options.getTrustOptions().toJson(), copy.getTrustOptions().toJson());\n+      // assertEquals(options.getTrustOptions().toJson(), copy.getTrustOptions().toJson());", "originalCommit": "a1bed47aac88320fe5d8bbcff8c130b178c3d607", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDEwOTQyNA==", "url": "https://github.com/eclipse-vertx/vert.x/pull/3592#discussion_r500109424", "bodyText": "I will downcast to specific class and write new asserts", "author": "vietj", "createdAt": "2020-10-06T08:47:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDA3MjczMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDA3NDE3Nw==", "url": "https://github.com/eclipse-vertx/vert.x/pull/3592#discussion_r500074177", "bodyText": "Perhaps we could have a default value for this. For example, on auth I was doing:\n // Defaults\n  private static final String TYPE = KeyStore.getDefaultType();\nAs this picks the runtime JDK default, for example on Java8 is JKS on java9 and up PKCS12 and maybe on other jdk's or runtimes started with custom security config it will be something else, e.g.: BKS", "author": "pmlopes", "createdAt": "2020-10-06T07:51:52Z", "path": "src/main/java/io/vertx/core/net/KeyStoreOptions.java", "diffHunk": "@@ -0,0 +1,150 @@\n+/*\n+ * Copyright (c) 2011-2019 Contributors to the Eclipse Foundation\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0, or the Apache License, Version 2.0\n+ * which is available at https://www.apache.org/licenses/LICENSE-2.0.\n+ *\n+ * SPDX-License-Identifier: EPL-2.0 OR Apache-2.0\n+ */\n+\n+package io.vertx.core.net;\n+\n+import io.vertx.codegen.annotations.GenIgnore;\n+import io.vertx.core.buffer.Buffer;\n+\n+/**\n+ * Key or trust store options configuring private key and/or certificates based on {@code KeyStore}.\n+ *\n+ * <ul>\n+ *   <li>when used as a key store, it should point to a store containing a private key and its certificate.</li>\n+ *   <li>when used as a trust store, it should point to a store containing a list of trusted certificates.</li>\n+ * </ul>\n+ *\n+ * <p> The store can either be loaded by Vert.x from the filesystem:\n+ *\n+ * <pre>\n+ * HttpServerOptions options = HttpServerOptions.httpServerOptions();\n+ * options.setKeyStore(new KeyStoreOptions().setType(\"JKS\").setPath(\"/mykeystore.jks\").setPassword(\"foo\"));\n+ * </pre>\n+ *\n+ * Or directly provided as a buffer:\n+ *\n+ * <pre>\n+ * Buffer store = vertx.fileSystem().readFileBlocking(\"/mykeystore.jks\");\n+ * options.setKeyStore(new JKSOptions().setType(\"JKS\").setValue(store).setPassword(\"foo\"));\n+ * </pre>\n+ *\n+ * <p> You can also use specific subclasses {@link JksOptions} or {@link PfxOptions} that will set\n+ * the {@link #setType} for you:\n+ *\n+ * <pre>\n+ * HttpServerOptions options = HttpServerOptions.httpServerOptions();\n+ * options.setKeyStore(new JksOptions().setPath(\"/mykeystore.jks\").setPassword(\"foo\"));\n+ * </pre>\n+ *\n+ * @author <a href=\"mailto:julien@julienviet.com\">Julien Viet</a>\n+ * @author <a href=\"http://tfox.org\">Tim Fox</a>\n+ */\n+public class KeyStoreOptions implements KeyCertOptions, TrustOptions {\n+\n+  private String type;", "originalCommit": "a1bed47aac88320fe5d8bbcff8c130b178c3d607", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDEwOTU5OA==", "url": "https://github.com/eclipse-vertx/vert.x/pull/3592#discussion_r500109598", "bodyText": "that's dangerous I think", "author": "vietj", "createdAt": "2020-10-06T08:48:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDA3NDE3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDExMDA0OQ==", "url": "https://github.com/eclipse-vertx/vert.x/pull/3592#discussion_r500110049", "bodyText": "I mean it is fine to have type null by default and let user set an explicit value, if user does not want to set the value then using JksOptions or PfxOptions is the way he needs to go", "author": "vietj", "createdAt": "2020-10-06T08:48:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDA3NDE3Nw=="}], "type": "inlineReview"}, {"oid": "3b3da7da81e57a1ec9a2842d4c32c9ffed4e0444", "url": "https://github.com/eclipse-vertx/vert.x/commit/3b3da7da81e57a1ec9a2842d4c32c9ffed4e0444", "message": "Replace commented assertions", "committedDate": "2020-10-06T08:59:43Z", "type": "commit"}]}