{"pr_number": 265, "pr_title": "HH-117779 decrease hikari validationTimeout", "pr_createdAt": "2020-10-13T13:42:46Z", "pr_url": "https://github.com/hhru/nuts-and-bolts/pull/265", "timeline": [{"oid": "1cba231a6fc60e74e8b14e44188a435b4556f2cd", "url": "https://github.com/hhru/nuts-and-bolts/commit/1cba231a6fc60e74e8b14e44188a435b4556f2cd", "message": "HH-117779 decrease hikari validationTimeout", "committedDate": "2020-10-13T13:44:34Z", "type": "commit"}, {"oid": "1cba231a6fc60e74e8b14e44188a435b4556f2cd", "url": "https://github.com/hhru/nuts-and-bolts/commit/1cba231a6fc60e74e8b14e44188a435b4556f2cd", "message": "HH-117779 decrease hikari validationTimeout", "committedDate": "2020-10-13T13:44:34Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzk5MjgzNQ==", "url": "https://github.com/hhru/nuts-and-bolts/pull/265#discussion_r503992835", "bodyText": "\u043a\u043e\u043d\u0441\u0442\u0430\u043d\u0442\u044b \u0432 \u0445\u0438\u043a\u0430\u0440\u0438 \u043d\u0435\u0442?", "author": "dzharikhin", "createdAt": "2020-10-13T14:20:53Z", "path": "nab-data-source/src/main/java/ru/hh/nab/datasource/DataSourceFactory.java", "diffHunk": "@@ -72,7 +74,10 @@ private static HikariConfig createBaseHikariConfig(String dataSourceName, FileSe\n     config.setPassword(dataSourceSettings.getString(PASSWORD));\n     config.setPoolName(dataSourceName);\n     config.setReadOnly(false);\n-    config.setValidationTimeout(config.getConnectionTimeout() + DEFAULT_VALIDATION_TIMEOUT_INCREMENT_MS);\n+\n+    long validationTimeoutMs = Math.round(config.getConnectionTimeout() * DEFAULT_VALIDATION_TIMEOUT_RATIO);\n+    config.setValidationTimeout(Math.max(validationTimeoutMs, HIKARI_MIN_VALIDATION_TIMEOUT_MS));", "originalCommit": "1cba231a6fc60e74e8b14e44188a435b4556f2cd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDAzMzQ2Ng==", "url": "https://github.com/hhru/nuts-and-bolts/pull/265#discussion_r504033466", "bodyText": "\u043a \u0441\u043e\u0436\u0430\u043b\u0435\u043d\u0438\u044e, \u043d\u0435 \u043d\u0430\u0448\u0451\u043b", "author": "Powerrr", "createdAt": "2020-10-13T15:11:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzk5MjgzNQ=="}], "type": "inlineReview"}]}