{"pr_number": 1479, "pr_title": "Performance issue on large project", "pr_createdAt": "2020-06-12T17:57:35Z", "pr_url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1479", "timeline": [{"oid": "2da94de8b20a5404c9aae2e871307958e37667db", "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/2da94de8b20a5404c9aae2e871307958e37667db", "message": "Performance issue on large project\n\nSigned-off-by: Snjezana Peco <snjezana.peco@redhat.com>", "committedDate": "2020-06-14T19:52:22Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDk3NjgxMg==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1479#discussion_r440976812", "bodyText": "delete unused code directly", "author": "fbricon", "createdAt": "2020-06-16T16:17:06Z", "path": "org.eclipse.jdt.ls.core/src/org/eclipse/jdt/ls/core/internal/handlers/BaseDocumentLifeCycleHandler.java", "diffHunk": "@@ -105,7 +109,7 @@ public boolean belongsTo(Object family) {\n \t\t\t\t\treturn PUBLISH_DIAGNOSTICS_JOBS.equals(family);\n \t\t\t\t}\n \t\t\t};\n-\t\t\tthis.validationTimer.setRule(ResourcesPlugin.getWorkspace().getRoot());\n+\t\t\t// this.validationTimer.setRule(ResourcesPlugin.getWorkspace().getRoot());", "originalCommit": "2da94de8b20a5404c9aae2e871307958e37667db", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDk4NDU1MQ==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1479#discussion_r440984551", "bodyText": "Fixed.", "author": "snjeza", "createdAt": "2020-06-16T16:29:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDk3NjgxMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDk3Njg3NA==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1479#discussion_r440976874", "bodyText": "delete unused code directly", "author": "fbricon", "createdAt": "2020-06-16T16:17:12Z", "path": "org.eclipse.jdt.ls.core/src/org/eclipse/jdt/ls/core/internal/handlers/BaseDocumentLifeCycleHandler.java", "diffHunk": "@@ -90,7 +94,7 @@ public boolean belongsTo(Object family) {\n \t\t\t\t\treturn DOCUMENT_LIFE_CYCLE_JOBS.equals(family);\n \t\t\t\t}\n \t\t\t};\n-\t\t\tthis.validationTimer.setRule(ResourcesPlugin.getWorkspace().getRoot());\n+\t\t\t// this.validationTimer.setRule(ResourcesPlugin.getWorkspace().getRoot());", "originalCommit": "2da94de8b20a5404c9aae2e871307958e37667db", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDk4NDcyNQ==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1479#discussion_r440984725", "bodyText": "Fixed.", "author": "snjeza", "createdAt": "2020-06-16T16:29:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDk3Njg3NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDk3Njk0MQ==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1479#discussion_r440976941", "bodyText": "cancelled", "author": "fbricon", "createdAt": "2020-06-16T16:17:17Z", "path": "org.eclipse.jdt.ls.core/src/org/eclipse/jdt/ls/core/internal/HoverInfoProvider.java", "diffHunk": "@@ -140,6 +150,15 @@ public HoverInfoProvider(ITypeRoot aUnit, PreferenceManager preferenceManager) {\n \t\t} catch (Exception e) {\n \t\t\tJavaLanguageServerPlugin.logException(\"Error computing hover\", e);\n \t\t}\n+\t\tif (monitor.isCanceled()) {\n+\t\t\treturn canceled(res);\n+\t\t}\n+\t\treturn res;\n+\t}\n+\n+\tprivate List<Either<String, MarkedString>> canceled(List<Either<String, MarkedString>> res) {", "originalCommit": "2da94de8b20a5404c9aae2e871307958e37667db", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDk4NDg5NA==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1479#discussion_r440984894", "bodyText": "Fixed.", "author": "snjeza", "createdAt": "2020-06-16T16:29:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDk3Njk0MQ=="}], "type": "inlineReview"}, {"oid": "b2cf718558a7948b29db1b8898225b27306681a0", "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/b2cf718558a7948b29db1b8898225b27306681a0", "message": "Performance issue on large project\n\nSigned-off-by: Snjezana Peco <snjezana.peco@redhat.com>", "committedDate": "2020-06-16T16:28:28Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDk5ODcyMQ==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1479#discussion_r440998721", "bodyText": "new ArrayList<>(toReconcile.size())", "author": "fbricon", "createdAt": "2020-06-16T16:50:24Z", "path": "org.eclipse.jdt.ls.core/src/org/eclipse/jdt/ls/core/internal/handlers/BaseDocumentLifeCycleHandler.java", "diffHunk": "@@ -129,30 +131,53 @@ protected void triggerValidation(ICompilationUnit cu, long delay) throws JavaMod\n \t\t}\n \t\tif (validationTimer != null) {\n \t\t\tvalidationTimer.cancel();\n+\t\t\tISchedulingRule rule = getRule(toReconcile);\n \t\t\tif (publishDiagnosticsJob != null) {\n \t\t\t\tpublishDiagnosticsJob.cancel();\n+\t\t\t\tpublishDiagnosticsJob.setRule(rule);\n \t\t\t}\n+\t\t\tvalidationTimer.setRule(rule);\n \t\t\tvalidationTimer.schedule(delay);\n \t\t} else {\n \t\t\tperformValidation(new NullProgressMonitor());\n \t\t}\n \t}\n \n+\tprivate ISchedulingRule getRule(Set<ICompilationUnit> units) {\n+\t\tISchedulingRule result = null;\n+\t\tIResourceRuleFactory ruleFactory = ResourcesPlugin.getWorkspace().getRuleFactory();\n+\t\tfor (ICompilationUnit unit : units) {\n+\t\t\tif (unit.getResource() != null) {\n+\t\t\t\tISchedulingRule rule = ruleFactory.createRule(unit.getResource());\n+\t\t\t\tresult = MultiRule.combine(rule, result);\n+\t\t\t}\n+\t\t}\n+\t\treturn result;\n+\t}\n+\n \tprivate IStatus performValidation(IProgressMonitor monitor) throws JavaModelException {\n \t\tlong start = System.currentTimeMillis();\n \n-\t\tList<ICompilationUnit> cusToReconcile = new ArrayList<>();\n+\t\tList<ICompilationUnit> cusToReconcile;\n \t\tsynchronized (toReconcile) {\n+\t\t\tif (toReconcile.isEmpty()) {\n+\t\t\t\treturn Status.OK_STATUS;\n+\t\t\t}\n+\t\t\tcusToReconcile = new ArrayList<>();", "originalCommit": "b2cf718558a7948b29db1b8898225b27306681a0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTAwNzIzNQ==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1479#discussion_r441007235", "bodyText": "Fixed.", "author": "snjeza", "createdAt": "2020-06-16T17:04:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDk5ODcyMQ=="}], "type": "inlineReview"}, {"oid": "62cf45ac246ad3d55158c68c9213e98ab3785a00", "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/62cf45ac246ad3d55158c68c9213e98ab3785a00", "message": "Performance issue on large project\n\nSigned-off-by: Snjezana Peco <snjezana.peco@redhat.com>", "committedDate": "2020-06-16T17:03:41Z", "type": "commit"}, {"oid": "62cf45ac246ad3d55158c68c9213e98ab3785a00", "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/62cf45ac246ad3d55158c68c9213e98ab3785a00", "message": "Performance issue on large project\n\nSigned-off-by: Snjezana Peco <snjezana.peco@redhat.com>", "committedDate": "2020-06-16T17:03:41Z", "type": "forcePushed"}]}