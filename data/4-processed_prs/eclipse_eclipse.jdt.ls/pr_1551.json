{"pr_number": 1551, "pr_title": "Fetch insertSpaces and tabSize options from the client preferences", "pr_createdAt": "2020-09-21T18:31:35Z", "pr_url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1551", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjcxNzkwNQ==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1551#discussion_r492717905", "bodyText": "can we move preference settings to the preference manager?", "author": "fbricon", "createdAt": "2020-09-22T13:07:30Z", "path": "org.eclipse.jdt.ls.core/src/org/eclipse/jdt/ls/core/internal/handlers/BaseInitHandler.java", "diffHunk": "@@ -114,6 +117,14 @@ public InitializeResult initialize(InitializeParams param) {\n \t\t\tPreferences prefs = Preferences.createFrom((Map<String, Object>) settings);\n \t\t\tprefs.setRootPaths(rootPaths);\n \t\t\tpreferenceManager.update(prefs);\n+\t\t\tHashtable<String, String> eclipseOptions = JavaCore.getOptions();\n+\t\t\tint tabSize = prefs.getTabSize();\n+\t\t\tif (tabSize > 0) {\n+\t\t\t\teclipseOptions.put(DefaultCodeFormatterConstants.FORMATTER_TAB_SIZE, String.valueOf(tabSize));\n+\t\t\t}\n+\t\t\tboolean insertSpaces = prefs.isInsertSpaces();\n+\t\t\teclipseOptions.put(DefaultCodeFormatterConstants.FORMATTER_TAB_CHAR, insertSpaces ? JavaCore.SPACE : JavaCore.TAB);\n+\t\t\tJavaCore.setOptions(eclipseOptions);", "originalCommit": "484963df822fe0aa7b78d9d6c01ddaca27bf1559", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjcyMDAxNQ==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1551#discussion_r492720015", "bodyText": "you'd expect the settings to be updated after the server starts (onDidChangeConfiguration)", "author": "fbricon", "createdAt": "2020-09-22T13:10:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjcxNzkwNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjk4NDYxMg==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1551#discussion_r492984612", "bodyText": "Fixed.", "author": "snjeza", "createdAt": "2020-09-22T19:33:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjcxNzkwNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjcxODc1OA==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1551#discussion_r492718758", "bodyText": "java.format.insertSpaces would be more consistent IMO", "author": "fbricon", "createdAt": "2020-09-22T13:08:44Z", "path": "org.eclipse.jdt.ls.core/src/org/eclipse/jdt/ls/core/internal/preferences/Preferences.java", "diffHunk": "@@ -57,6 +57,14 @@\n \t * Specifies the folder path to the JDK .\n \t */\n \tpublic static final String JAVA_HOME = \"java.home\";\n+\t/**\n+\t * Insert spaces when pressing Tab\n+\t */\n+\tpublic static final String JAVA_CONFIGURATION_INSERTSPACES = \"java.editor.insertSpaces\";", "originalCommit": "484963df822fe0aa7b78d9d6c01ddaca27bf1559", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjcxODkwMg==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1551#discussion_r492718902", "bodyText": "java.format. tabSize would be more consistent IMO", "author": "fbricon", "createdAt": "2020-09-22T13:08:59Z", "path": "org.eclipse.jdt.ls.core/src/org/eclipse/jdt/ls/core/internal/preferences/Preferences.java", "diffHunk": "@@ -57,6 +57,14 @@\n \t * Specifies the folder path to the JDK .\n \t */\n \tpublic static final String JAVA_HOME = \"java.home\";\n+\t/**\n+\t * Insert spaces when pressing Tab\n+\t */\n+\tpublic static final String JAVA_CONFIGURATION_INSERTSPACES = \"java.editor.insertSpaces\";\n+\t/**\n+\t * Tab Size\n+\t */\n+\tpublic static final String JAVA_CONFIGURATION_TABSIZE = \"java.editor.tabSize\";", "originalCommit": "484963df822fe0aa7b78d9d6c01ddaca27bf1559", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjk4NDczOA==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1551#discussion_r492984738", "bodyText": "Fixed.", "author": "snjeza", "createdAt": "2020-09-22T19:34:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjcxODkwMg=="}], "type": "inlineReview"}, {"oid": "4b831cbb5f7a98ecb8bd534c6d0c7fb9dab26ea2", "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/4b831cbb5f7a98ecb8bd534c6d0c7fb9dab26ea2", "message": "Surround with try/catch reformats document\n\nSigned-off-by: Snjezana Peco <snjezana.peco@redhat.com>", "committedDate": "2020-09-22T19:10:35Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDk2NDQ3OQ==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1551#discussion_r494964479", "bodyText": "this is inconsistent with https://github.com/eclipse/eclipse.jdt.ls/pull/1551/files#diff-3feb2f2158f1898f0a00165abf820e3dR643", "author": "fbricon", "createdAt": "2020-09-25T12:49:36Z", "path": "org.eclipse.jdt.ls.core/src/org/eclipse/jdt/ls/core/internal/preferences/PreferenceManager.java", "diffHunk": "@@ -130,6 +129,8 @@ public static void initializeJavaCoreOptions() {\n \t\tjavaCoreOptions.put(JavaCore.COMPILER_PB_UNHANDLED_WARNING_TOKEN, JavaCore.IGNORE);\n \t\tjavaCoreOptions.put(JavaCore.COMPILER_PB_REDUNDANT_SUPERINTERFACE, JavaCore.WARNING);\n \t\tjavaCoreOptions.put(JavaCore.CODEASSIST_SUBWORD_MATCH, JavaCore.DISABLED);\n+\t\tjavaCoreOptions.put(DefaultCodeFormatterConstants.FORMATTER_TAB_CHAR, JavaCore.TAB);", "originalCommit": "4b831cbb5f7a98ecb8bd534c6d0c7fb9dab26ea2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTA5MTA2OA==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1551#discussion_r495091068", "bodyText": "Tests fail without this.", "author": "snjeza", "createdAt": "2020-09-25T16:10:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDk2NDQ3OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTA5NjU0OA==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1551#discussion_r495096548", "bodyText": "why? Might show that tests are brittle, which would not be a good reason to set inconsistent value", "author": "fbricon", "createdAt": "2020-09-25T16:20:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDk2NDQ3OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTEyOTMyNQ==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1551#discussion_r495129325", "bodyText": "Tests expect Eclipse default (TAB).", "author": "snjeza", "createdAt": "2020-09-25T17:23:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDk2NDQ3OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTU1MTE3OQ==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1551#discussion_r495551179", "bodyText": "then the tests should set the default to tab", "author": "fbricon", "createdAt": "2020-09-27T09:23:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDk2NDQ3OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTYwODg0Ng==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1551#discussion_r495608846", "bodyText": "Fixed.", "author": "snjeza", "createdAt": "2020-09-27T19:51:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDk2NDQ3OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDk2NTkwOA==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1551#discussion_r494965908", "bodyText": "use a constant:\ntabSize = DEFAULT_TAB_SIZE;", "author": "fbricon", "createdAt": "2020-09-25T12:52:11Z", "path": "org.eclipse.jdt.ls.core/src/org/eclipse/jdt/ls/core/internal/preferences/Preferences.java", "diffHunk": "@@ -630,6 +640,8 @@ public Preferences() {\n \t\tstaticImportOnDemandThreshold = IMPORTS_STATIC_ONDEMANDTHRESHOLD_DEFAULT;\n \t\treferencedLibraries = JAVA_PROJECT_REFERENCED_LIBRARIES_DEFAULT;\n \t\tresourceFilters = JAVA_RESOURCE_FILTERS_DEFAULT;\n+\t\tinsertSpaces = true;\n+\t\ttabSize = 4;", "originalCommit": "4b831cbb5f7a98ecb8bd534c6d0c7fb9dab26ea2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTEzOTMxNw==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1551#discussion_r495139317", "bodyText": "Fixed.", "author": "snjeza", "createdAt": "2020-09-25T17:43:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDk2NTkwOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDk2NjA1NA==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1551#discussion_r494966054", "bodyText": "s/4/DEFAULT_TAB_SIZE", "author": "fbricon", "createdAt": "2020-09-25T12:52:25Z", "path": "org.eclipse.jdt.ls.core/src/org/eclipse/jdt/ls/core/internal/preferences/Preferences.java", "diffHunk": "@@ -652,6 +664,10 @@ public static Preferences createFrom(Map<String, Object> configuration) {\n \n \t\tboolean importGradleEnabled = getBoolean(configuration, IMPORT_GRADLE_ENABLED, true);\n \t\tprefs.setImportGradleEnabled(importGradleEnabled);\n+\t\tboolean insertSpaces = getBoolean(configuration, JAVA_CONFIGURATION_INSERTSPACES, true);\n+\t\tprefs.setInsertSpaces(insertSpaces);\n+\t\tint tabSize = getInt(configuration, JAVA_CONFIGURATION_TABSIZE, 4);", "originalCommit": "4b831cbb5f7a98ecb8bd534c6d0c7fb9dab26ea2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTEzOTQxNw==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1551#discussion_r495139417", "bodyText": "Fixed.", "author": "snjeza", "createdAt": "2020-09-25T17:43:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDk2NjA1NA=="}], "type": "inlineReview"}, {"oid": "2f3b6db2aeb0ed7339564309a090ea0af8cfa6e4", "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/2f3b6db2aeb0ed7339564309a090ea0af8cfa6e4", "message": "Surround with try/catch reformats document\n\nSigned-off-by: Snjezana Peco <snjezana.peco@redhat.com>", "committedDate": "2020-09-25T17:41:41Z", "type": "forcePushed"}, {"oid": "6ea90565035fbae0583f658bbbb0917494bc04ed", "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/6ea90565035fbae0583f658bbbb0917494bc04ed", "message": "Surround with try/catch reformats document\n\nSigned-off-by: Snjezana Peco <snjezana.peco@redhat.com>", "committedDate": "2020-09-27T19:50:48Z", "type": "forcePushed"}, {"oid": "8b5d65399dbd9a59c40f96e44bd9d2a068f75015", "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/8b5d65399dbd9a59c40f96e44bd9d2a068f75015", "message": "Surround with try/catch reformats document\n\nSigned-off-by: Snjezana Peco <snjezana.peco@redhat.com>", "committedDate": "2021-02-24T04:28:24Z", "type": "commit"}, {"oid": "8b5d65399dbd9a59c40f96e44bd9d2a068f75015", "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/8b5d65399dbd9a59c40f96e44bd9d2a068f75015", "message": "Surround with try/catch reformats document\n\nSigned-off-by: Snjezana Peco <snjezana.peco@redhat.com>", "committedDate": "2021-02-24T04:28:24Z", "type": "forcePushed"}]}