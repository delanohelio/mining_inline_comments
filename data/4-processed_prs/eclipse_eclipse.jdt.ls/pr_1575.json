{"pr_number": 1575, "pr_title": "Hide inline constant commands when no reference found", "pr_createdAt": "2020-10-19T03:02:35Z", "pr_url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1575", "timeline": [{"oid": "971dcc5a1804b97edcc2808f264a56993d1df757", "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/971dcc5a1804b97edcc2808f264a56993d1df757", "message": "Hide inline constant commands when no reference found\n\nSigned-off-by: schenqce <chenshi@microsoft.com>", "committedDate": "2020-10-19T02:14:46Z", "type": "commit"}, {"oid": "1e958eb3eac8eab3bf37af362bdb41b59f923934", "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/1e958eb3eac8eab3bf37af362bdb41b59f923934", "message": "Update condition\n\nSigned-off-by: schenqce <chenshi@microsoft.com>", "committedDate": "2020-10-19T02:53:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzU4NjEzMA==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1575#discussion_r507586130", "bodyText": "@CsCherrYY Below is a corner case. The change group will be 2 (1 for remove imports, 1 for remove the declaration) even though no references are using the constant field. The \"Inline\" menu won't be hidden.\nimport java.util.HashMap;\nimport java.util.Map;\n\npublic class Hello {\n    public static final Map map = new HashMap<>();\n}", "author": "testforstephen", "createdAt": "2020-10-19T09:01:44Z", "path": "org.eclipse.jdt.ls.core/src/org/eclipse/jdt/ls/core/internal/corrections/RefactorProcessor.java", "diffHunk": "@@ -327,6 +330,15 @@ private boolean getInlineProposal(IInvocationContext context, ASTNode node, Coll\n \t\t\t\t\t\t\tCheckConditionsOperation check = new CheckConditionsOperation(refactoring, CheckConditionsOperation.FINAL_CONDITIONS);\n \t\t\t\t\t\t\tfinal CreateChangeOperation create = new CreateChangeOperation(check, RefactoringStatus.FATAL);\n \t\t\t\t\t\t\tcreate.run(new NullProgressMonitor());\n+\t\t\t\t\t\t\tint referenceCount = 0;\n+\t\t\t\t\t\t\tChange change = create.getChange();\n+\t\t\t\t\t\t\tChange[] refactoringChanges = ((DynamicValidationRefactoringChange)change).getChildren();\n+\t\t\t\t\t\t\tfor (Change refactoringChange : refactoringChanges) {\n+\t\t\t\t\t\t\t\treferenceCount += ((CompilationUnitChange)refactoringChange).getChangeGroups().length;\n+\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t\tif (referenceCount <= 1 && refactoring.isDeclarationSelected()) {", "originalCommit": "1e958eb3eac8eab3bf37af362bdb41b59f923934", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzU5MTE5OA==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1575#discussion_r507591198", "bodyText": "@testforstephen Thanks a lot for kind reminding, I would like to implement this clearer and avoid corner case like this by changing some APIs in jdt later.", "author": "CsCherrYY", "createdAt": "2020-10-19T09:09:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzU4NjEzMA=="}], "type": "inlineReview"}]}