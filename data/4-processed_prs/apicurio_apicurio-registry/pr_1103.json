{"pr_number": 1103, "pr_title": "Add tombstone kafka messages when deleting artifacts/versions.", "pr_createdAt": "2020-12-21T18:23:37Z", "pr_url": "https://github.com/Apicurio/apicurio-registry/pull/1103", "timeline": [{"oid": "b8189e0f1b616b295c4ac49a9a418b7f5f8561e4", "url": "https://github.com/Apicurio/apicurio-registry/commit/b8189e0f1b616b295c4ac49a9a418b7f5f8561e4", "message": "Add tombstone kafka messages when deleting artifacts/versions.  Fixes #1077", "committedDate": "2020-12-21T18:23:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzIyNTMyMA==", "url": "https://github.com/Apicurio/apicurio-registry/pull/1103#discussion_r547225320", "bodyText": "what about logging some info from the MessageKey?", "author": "famartinrh", "createdAt": "2020-12-22T11:29:46Z", "path": "storage/kafkasql/src/main/java/io/apicurio/registry/storage/impl/kafkasql/sql/KafkaSqlSink.java", "diffHunk": "@@ -58,6 +58,13 @@\n      * @param record\n      */\n     public void processMessage(ConsumerRecord<MessageKey, MessageValue> record) {\n+        // If the value is null, then this is a tombstone (or unrecognized) message and should not \n+        // be processed.\n+        if (record.value() == null) {\n+            log.info(\"Discarded a tombstone message with key: {}\", record.key());", "originalCommit": "b8189e0f1b616b295c4ac49a9a418b7f5f8561e4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzI2NDg1NA==", "url": "https://github.com/Apicurio/apicurio-registry/pull/1103#discussion_r547264854", "bodyText": "Oh right, I intended to implement toString() on the message key classes.  Will do that.", "author": "EricWittmann", "createdAt": "2020-12-22T13:01:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzIyNTMyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzMwMjk3Mw==", "url": "https://github.com/Apicurio/apicurio-registry/pull/1103#discussion_r547302973", "bodyText": "Updated to give each key a unique toString().", "author": "EricWittmann", "createdAt": "2020-12-22T14:19:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzIyNTMyMA=="}], "type": "inlineReview"}, {"oid": "f647379737c7e0314805eb4eb8d6988b624ac19f", "url": "https://github.com/Apicurio/apicurio-registry/commit/f647379737c7e0314805eb4eb8d6988b624ac19f", "message": "Better logging of tombstone messages.", "committedDate": "2020-12-22T13:35:25Z", "type": "commit"}, {"oid": "30749c2075455ea83f3fd527678c5afc21d4f631", "url": "https://github.com/Apicurio/apicurio-registry/commit/30749c2075455ea83f3fd527678c5afc21d4f631", "message": "Made the consumer more resilient to garbage/unknown Kafka messages", "committedDate": "2020-12-22T13:39:01Z", "type": "commit"}]}