{"pr_number": 977, "pr_title": "Replaced the JPA storage impl with a SQL one", "pr_createdAt": "2020-11-02T20:17:43Z", "pr_url": "https://github.com/Apicurio/apicurio-registry/pull/977", "timeline": [{"oid": "f0e617c48bbcee86be522c7bab9cbaab07568061", "url": "https://github.com/Apicurio/apicurio-registry/commit/f0e617c48bbcee86be522c7bab9cbaab07568061", "message": "started work on a generic SQL storage impl", "committedDate": "2020-09-03T17:24:58Z", "type": "commit"}, {"oid": "5d695fa9a34b59c00345f8d719ef9c5c23f3f47f", "url": "https://github.com/Apicurio/apicurio-registry/commit/5d695fa9a34b59c00345f8d719ef9c5c23f3f47f", "message": "added a \"content\" table.  added a sql storage quarkus test.", "committedDate": "2020-09-08T18:14:04Z", "type": "commit"}, {"oid": "1adf84a359f800249c071a27fc309e8e90f40bdc", "url": "https://github.com/Apicurio/apicurio-registry/commit/1adf84a359f800249c071a27fc309e8e90f40bdc", "message": "implemented and tested additional methods on the sql storage", "committedDate": "2020-09-10T00:31:09Z", "type": "commit"}, {"oid": "9b017bf0f98f6d824145318b5610a9b9771a051d", "url": "https://github.com/Apicurio/apicurio-registry/commit/9b017bf0f98f6d824145318b5610a9b9771a051d", "message": "implemented artifact rules in sql storage", "committedDate": "2020-09-10T16:54:26Z", "type": "commit"}, {"oid": "5a7aa2496df6583aa6e472f07aaade6656775a7e", "url": "https://github.com/Apicurio/apicurio-registry/commit/5a7aa2496df6583aa6e472f07aaade6656775a7e", "message": "Implemented additional methods on the new sql storage", "committedDate": "2020-09-10T20:34:54Z", "type": "commit"}, {"oid": "51f6c0a2af31b10f715b082d251659549f94694d", "url": "https://github.com/Apicurio/apicurio-registry/commit/51f6c0a2af31b10f715b082d251659549f94694d", "message": "implemented search in the sql storage", "committedDate": "2020-09-12T16:48:45Z", "type": "commit"}, {"oid": "5cf28265f05c717ff6543c313306288c2ddee206", "url": "https://github.com/Apicurio/apicurio-registry/commit/5cf28265f05c717ff6543c313306288c2ddee206", "message": "refactor the statements interface, and added an impl of updateArtifactState", "committedDate": "2020-09-14T17:17:13Z", "type": "commit"}, {"oid": "7f8b94d91ec2c462dc2678b930e2f0c4858ef386", "url": "https://github.com/Apicurio/apicurio-registry/commit/7f8b94d91ec2c462dc2678b930e2f0c4858ef386", "message": "finished v1 of the sql storage impl", "committedDate": "2020-09-14T21:37:37Z", "type": "commit"}, {"oid": "aa935534b83843539c575009b1eed53c81739b4a", "url": "https://github.com/Apicurio/apicurio-registry/commit/aa935534b83843539c575009b1eed53c81739b4a", "message": "added postgresql support", "committedDate": "2020-09-15T14:27:17Z", "type": "commit"}, {"oid": "9b31117dd8a227ed3e6b6781c3ca830f37dc21b3", "url": "https://github.com/Apicurio/apicurio-registry/commit/9b31117dd8a227ed3e6b6781c3ca830f37dc21b3", "message": "Merge branch 'features/sql' of github.com:EricWittmann/apicurio-registry into features/sql", "committedDate": "2020-09-15T14:27:21Z", "type": "commit"}, {"oid": "d7f31922988d4b76fc0663bb07e915ca00912f01", "url": "https://github.com/Apicurio/apicurio-registry/commit/d7f31922988d4b76fc0663bb07e915ca00912f01", "message": "...", "committedDate": "2020-09-15T14:29:57Z", "type": "commit"}, {"oid": "2e789bd4df833fecbbd451c0d5135a4a5fa945c9", "url": "https://github.com/Apicurio/apicurio-registry/commit/2e789bd4df833fecbbd451c0d5135a4a5fa945c9", "message": "Merge remote-tracking branch 'upstream/master' into features/sql", "committedDate": "2020-09-16T11:52:33Z", "type": "commit"}, {"oid": "4b0304fdfa3f83655c3b7b8b6c03228da6dc2e93", "url": "https://github.com/Apicurio/apicurio-registry/commit/4b0304fdfa3f83655c3b7b8b6c03228da6dc2e93", "message": "added a storage performance test", "committedDate": "2020-09-16T20:09:20Z", "type": "commit"}, {"oid": "1aa62992c56bad9e62b0656c48e662426fd7a87f", "url": "https://github.com/Apicurio/apicurio-registry/commit/1aa62992c56bad9e62b0656c48e662426fd7a87f", "message": "Add panache storage module", "committedDate": "2020-09-17T07:17:51Z", "type": "commit"}, {"oid": "f4530df62a8cff125f99c107501d70e76f9c3d6c", "url": "https://github.com/Apicurio/apicurio-registry/commit/f4530df62a8cff125f99c107501d70e76f9c3d6c", "message": "Add artifact operations", "committedDate": "2020-09-22T10:28:06Z", "type": "commit"}, {"oid": "9cc01ae943478a2c4e4b14d278614527125617ed", "url": "https://github.com/Apicurio/apicurio-registry/commit/9cc01ae943478a2c4e4b14d278614527125617ed", "message": "Change get metadata operation to use find method", "committedDate": "2020-09-22T11:04:50Z", "type": "commit"}, {"oid": "aaf394d6d4dd4486223f26c9b50bba57f7a34e62", "url": "https://github.com/Apicurio/apicurio-registry/commit/aaf394d6d4dd4486223f26c9b50bba57f7a34e62", "message": "Add search ordering", "committedDate": "2020-09-22T11:28:31Z", "type": "commit"}, {"oid": "3a2a729ccc5824f7c40a47af730f8f1584b40a16", "url": "https://github.com/Apicurio/apicurio-registry/commit/3a2a729ccc5824f7c40a47af730f8f1584b40a16", "message": "Change h2 expected port", "committedDate": "2020-09-22T11:46:16Z", "type": "commit"}, {"oid": "988a93dc63a90c8d1ea1625161f2de60d1cb6e56", "url": "https://github.com/Apicurio/apicurio-registry/commit/988a93dc63a90c8d1ea1625161f2de60d1cb6e56", "message": "changed some info messages to debug and updated the sql perf test", "committedDate": "2020-09-22T13:40:09Z", "type": "commit"}, {"oid": "b7dd4fbd8a70bbe2784fb676aa61cd196be84c47", "url": "https://github.com/Apicurio/apicurio-registry/commit/b7dd4fbd8a70bbe2784fb676aa61cd196be84c47", "message": "merged changes from master", "committedDate": "2020-10-01T11:17:49Z", "type": "commit"}, {"oid": "b71619c2bf5af16a8f43ca9a484209f0568fb3e6", "url": "https://github.com/Apicurio/apicurio-registry/commit/b71619c2bf5af16a8f43ca9a484209f0568fb3e6", "message": "updated the parent version # for panache and sql storages", "committedDate": "2020-10-02T15:34:03Z", "type": "commit"}, {"oid": "5782ea7d64031f70591fa33c5bda16472f6587fc", "url": "https://github.com/Apicurio/apicurio-registry/commit/5782ea7d64031f70591fa33c5bda16472f6587fc", "message": "added the basics of a gatling performance tets", "committedDate": "2020-10-02T18:20:03Z", "type": "commit"}, {"oid": "ab51d07661457307bbfa2780a827cbd642da5e22", "url": "https://github.com/Apicurio/apicurio-registry/commit/ab51d07661457307bbfa2780a827cbd642da5e22", "message": "perf test now actually has a basic simulation", "committedDate": "2020-10-07T18:26:56Z", "type": "commit"}, {"oid": "982e5066f6079f43904ec1abcf1892b4cf4ede86", "url": "https://github.com/Apicurio/apicurio-registry/commit/982e5066f6079f43904ec1abcf1892b4cf4ede86", "message": "added a gatling scenario", "committedDate": "2020-10-22T14:15:06Z", "type": "commit"}, {"oid": "d8f08742d4cdd2301f44eb8488687c5bcb18d679", "url": "https://github.com/Apicurio/apicurio-registry/commit/d8f08742d4cdd2301f44eb8488687c5bcb18d679", "message": "Fix search query group by (#944)", "committedDate": "2020-10-22T15:15:52Z", "type": "commit"}, {"oid": "1256ce082e9ef0c38283440b918c5f7ad9b1b2d3", "url": "https://github.com/Apicurio/apicurio-registry/commit/1256ce082e9ef0c38283440b918c5f7ad9b1b2d3", "message": "fixed some issues in the panache impl to get the gatling test to work", "committedDate": "2020-10-23T13:40:39Z", "type": "commit"}, {"oid": "dd72a4be0f3160da967e3bdf6d88a0a1d2452ea6", "url": "https://github.com/Apicurio/apicurio-registry/commit/dd72a4be0f3160da967e3bdf6d88a0a1d2452ea6", "message": "changed some perf tests, removed an unused class", "committedDate": "2020-10-30T19:06:03Z", "type": "commit"}, {"oid": "358e4687372043c44dcd6edec5e65b620967e7a2", "url": "https://github.com/Apicurio/apicurio-registry/commit/358e4687372043c44dcd6edec5e65b620967e7a2", "message": "switching jpa module to the new sql module", "committedDate": "2020-11-02T10:42:30Z", "type": "commit"}, {"oid": "87a4a49327df234e2672bacf6940f15cabfff399", "url": "https://github.com/Apicurio/apicurio-registry/commit/87a4a49327df234e2672bacf6940f15cabfff399", "message": "merged latest from master", "committedDate": "2020-11-02T11:50:39Z", "type": "commit"}, {"oid": "92ab1ab84804aab648df3ac900ea95079e5d64bd", "url": "https://github.com/Apicurio/apicurio-registry/commit/92ab1ab84804aab648df3ac900ea95079e5d64bd", "message": "fixed some compile errors after merge and some renames", "committedDate": "2020-11-02T13:18:44Z", "type": "commit"}, {"oid": "2dc7becb7f3d8d7f7fa8712e2a2a52dd1427b778", "url": "https://github.com/Apicurio/apicurio-registry/commit/2dc7becb7f3d8d7f7fa8712e2a2a52dd1427b778", "message": "improved some REST APIs, added the concept of \"canonical\" when finding versions by content", "committedDate": "2020-11-02T20:14:12Z", "type": "commit"}, {"oid": "7d4246f140a97ebf2b9f7c3bcc47445e57242f12", "url": "https://github.com/Apicurio/apicurio-registry/commit/7d4246f140a97ebf2b9f7c3bcc47445e57242f12", "message": "Updated openapi def.", "committedDate": "2020-11-02T20:15:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjU4ODI2Nw==", "url": "https://github.com/Apicurio/apicurio-registry/pull/977#discussion_r516588267", "bodyText": "Maybe create a separated PR for the Kafka changes?", "author": "carlesarnal", "createdAt": "2020-11-03T11:09:48Z", "path": ".github/workflows/integration-tests.yaml", "diffHunk": "@@ -39,11 +39,11 @@ jobs:\n           restore-keys: |\n             ${{ runner.os }}-maven-\n       - name: Build All Variants\n-        run: mvn clean install -Pprod -Pjpa -Pinfinispan -Pkafka -Pstreams -Pasyncmem -DskipTests -pl !tests\n-      - name: Run Integration Tests - kafka streams\n+        run: mvn clean install -Pprod -Psql -Pinfinispan -Pstreams -Pasyncmem -DskipTests -pl !tests", "originalCommit": "7d4246f140a97ebf2b9f7c3bcc47445e57242f12", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjczMDk2OQ==", "url": "https://github.com/Apicurio/apicurio-registry/pull/977#discussion_r516730969", "bodyText": "Yeah you're right - I should have removed the kafka storage in a separate PR... I'll do that.", "author": "EricWittmann", "createdAt": "2020-11-03T14:59:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjU4ODI2Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjU4OTQ1Ng==", "url": "https://github.com/Apicurio/apicurio-registry/pull/977#discussion_r516589456", "bodyText": "Unless we're removing definitely the Kafka storage in the 2.0.x release I'm not in favour of removing it from the verify workflow.", "author": "carlesarnal", "createdAt": "2020-11-03T11:11:52Z", "path": ".github/workflows/verify.yaml", "diffHunk": "@@ -38,7 +38,7 @@ jobs:\n           restore-keys: |\n             ${{ runner.os }}-maven-\n       - name: Build All Variants\n-        run: mvn clean install -Pprod -Pjpa -Pinfinispan -Pkafka -Pstreams -Pasyncmem -pl !tests\n+        run: mvn clean install -Pprod -Psql -Pinfinispan -Pstreams -Pasyncmem -pl !tests", "originalCommit": "7d4246f140a97ebf2b9f7c3bcc47445e57242f12", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjYyNTcyNg==", "url": "https://github.com/Apicurio/apicurio-registry/pull/977#discussion_r516625726", "bodyText": "I think it's definitive, because the storage/kafka module is gone", "author": "famartinrh", "createdAt": "2020-11-03T12:20:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjU4OTQ1Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjY1MTAxOQ==", "url": "https://github.com/Apicurio/apicurio-registry/pull/977#discussion_r516651019", "bodyText": "Sorry, haven't reviewed everything yet. If that's the case, then I fall back to my previous comment, to separate the Kafka storage stuff into a separate PR.", "author": "carlesarnal", "createdAt": "2020-11-03T13:05:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjU4OTQ1Ng=="}], "type": "inlineReview"}, {"oid": "a78b8bf1ef0b3b907ce29c25bffa83aa3381a530", "url": "https://github.com/Apicurio/apicurio-registry/commit/a78b8bf1ef0b3b907ce29c25bffa83aa3381a530", "message": "added a missing check in postgres for FK violation", "committedDate": "2020-11-03T14:55:52Z", "type": "commit"}, {"oid": "430d28e6b7dd4ab761220ba84a38f55901be5228", "url": "https://github.com/Apicurio/apicurio-registry/commit/430d28e6b7dd4ab761220ba84a38f55901be5228", "message": "Merge remote-tracking branch 'upstream/master' into features/sql", "committedDate": "2020-11-03T16:11:58Z", "type": "commit"}, {"oid": "c1b32bc21dfbcdd43f0ea56ffda27e666b205c6f", "url": "https://github.com/Apicurio/apicurio-registry/commit/c1b32bc21dfbcdd43f0ea56ffda27e666b205c6f", "message": "removed kafka storage from readme", "committedDate": "2020-11-03T16:17:39Z", "type": "commit"}, {"oid": "e2f47c0e2bec2946cdcbf4bb9de128f9f9e6efc0", "url": "https://github.com/Apicurio/apicurio-registry/commit/e2f47c0e2bec2946cdcbf4bb9de128f9f9e6efc0", "message": "merged from master", "committedDate": "2020-11-03T16:23:05Z", "type": "commit"}, {"oid": "09ac07549af84d38627fc5a94c1f8578ce655f5e", "url": "https://github.com/Apicurio/apicurio-registry/commit/09ac07549af84d38627fc5a94c1f8578ce655f5e", "message": "Merge branch 'master' into features/sql", "committedDate": "2020-11-03T18:29:43Z", "type": "commit"}, {"oid": "6b3fbbc9fb12a6de945dac92e77932a441678e17", "url": "https://github.com/Apicurio/apicurio-registry/commit/6b3fbbc9fb12a6de945dac92e77932a441678e17", "message": "Merge branch 'master' into features/sql", "committedDate": "2020-11-03T18:38:49Z", "type": "commit"}, {"oid": "ba93da157fcb7d4818849094eefadfee1aeff7d5", "url": "https://github.com/Apicurio/apicurio-registry/commit/ba93da157fcb7d4818849094eefadfee1aeff7d5", "message": "updated the laze rest client with new client methods", "committedDate": "2020-11-03T19:17:23Z", "type": "commit"}, {"oid": "c0f5ee004fea532541fd835752902eb76b9462f1", "url": "https://github.com/Apicurio/apicurio-registry/commit/c0f5ee004fea532541fd835752902eb76b9462f1", "message": "fixed some problems in the sql storage and tweaked a few unit tests", "committedDate": "2020-11-04T23:03:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzkwNzQyMw==", "url": "https://github.com/Apicurio/apicurio-registry/pull/977#discussion_r517907423", "bodyText": "this shouldn't need to be changed, instead search query should be case insensitive", "author": "famartinrh", "createdAt": "2020-11-05T09:29:15Z", "path": "app/src/test/java/io/apicurio/registry/RegistryClientTest.java", "diffHunk": "@@ -107,7 +107,7 @@ void testSearchArtifact(RegistryRestClient restClient) throws Exception {\n             Assertions.assertNotNull(artifactMetaData);\r\n         });\r\n \r\n-        ArtifactSearchResults results = restClient.searchArtifacts(name.toUpperCase(), SearchOver.name, SortOrder.asc, 0, 2);\r\n+        ArtifactSearchResults results = restClient.searchArtifacts(name, SearchOver.name, SortOrder.asc, 0, 2);\r", "originalCommit": "c0f5ee004fea532541fd835752902eb76b9462f1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzk5NDA3NA==", "url": "https://github.com/Apicurio/apicurio-registry/pull/977#discussion_r517994074", "bodyText": "Case insensitive searching for a SQL database is dependent on the configuration of the DB.  And it varies from DB to DB.  I think it's safer to not rely on case-insensitive searching in the existing unit tests.\nThat said, I think you're probably right that searching should be case insensitive.  I'll open a GitHub issue for that and introduce a test (later) that is specific to that issue.", "author": "EricWittmann", "createdAt": "2020-11-05T11:52:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzkwNzQyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzk5NzYzMg==", "url": "https://github.com/Apicurio/apicurio-registry/pull/977#discussion_r517997632", "bodyText": "ok thanks, I just was thinking that the new storage implementation needed some tweaks to do case-insensitive queries", "author": "famartinrh", "createdAt": "2020-11-05T11:58:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzkwNzQyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODAxMjY3OQ==", "url": "https://github.com/Apicurio/apicurio-registry/pull/977#discussion_r518012679", "bodyText": "It might.  I'll work on that in a followup. :)  I opened a few followup GitHub issues.", "author": "EricWittmann", "createdAt": "2020-11-05T12:26:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzkwNzQyMw=="}], "type": "inlineReview"}]}