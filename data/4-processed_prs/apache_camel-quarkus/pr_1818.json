{"pr_number": 1818, "pr_title": "Improve mock backend logging", "pr_createdAt": "2020-09-22T11:24:11Z", "pr_url": "https://github.com/apache/camel-quarkus/pull/1818", "timeline": [{"oid": "d56295c5380b597081d849aed74b597ebd1ba462", "url": "https://github.com/apache/camel-quarkus/commit/d56295c5380b597081d849aed74b597ebd1ba462", "message": "Make sure that Telegram tests are not run against mock API by setting CAMEL_QUARKUS_START_MOCK_BACKEND=false #1717", "committedDate": "2020-09-24T09:32:03Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDE3NDY2MQ==", "url": "https://github.com/apache/camel-quarkus/pull/1818#discussion_r494174661", "bodyText": "@ppalaga This is a typo ? CAMEL_QUARKUS_FALLBACK_MOCK ?", "author": "llowinge", "createdAt": "2020-09-24T09:34:27Z", "path": "integration-tests/telegram/src/main/java/org/apache/camel/quarkus/component/telegram/it/TelegramRoutes.java", "diffHunk": "@@ -21,37 +21,80 @@\n import java.io.InputStream;\n import java.util.stream.Stream;\n \n+import javax.enterprise.context.ApplicationScoped;\n+import javax.enterprise.inject.Produces;\n+import javax.inject.Named;\n+\n+import io.quarkus.arc.Unremovable;\n import org.apache.camel.Exchange;\n import org.apache.camel.builder.RouteBuilder;\n+import org.apache.camel.component.telegram.TelegramComponent;\n+import org.apache.camel.quarkus.test.mock.backend.MockBackendUtils;\n import org.apache.camel.support.ResourceHelper;\n import org.apache.camel.util.IOHelper;\n+import org.eclipse.microprofile.config.inject.ConfigProperty;\n \n+@ApplicationScoped\n public class TelegramRoutes extends RouteBuilder {\n \n+    @ConfigProperty(name = \"telegram.authorization-token\", defaultValue = \"default-dummy-token\")\n+    String authToken;\n+\n+    @ConfigProperty(name = \"quarkus.http.test-port\")\n+    int httpTestPort;\n+    @ConfigProperty(name = \"quarkus.http.port\")\n+    int httpPort;\n+\n+    private String getBaseUri() {\n+        final boolean isNativeMode = \"executable\".equals(System.getProperty(\"org.graalvm.nativeimage.kind\"));\n+        return \"default-dummy-token\".equals(authToken)\n+                ? \"http://localhost:\" + (isNativeMode ? httpPort : httpTestPort)\n+                : \"https://api.telegram.org\";\n+    }\n+\n+    /**\n+     * We need to implement some conditional configuration of the {@link TelegramComponent} thus we create it\n+     * programmatically and publish via CDI.\n+     *\n+     * @return a configured {@link TelegramComponent}\n+     */\n+    @Produces\n+    @ApplicationScoped\n+    @Unremovable\n+    @Named\n+    TelegramComponent telegram() {\n+        final TelegramComponent result = new TelegramComponent();\n+        result.setCamelContext(getContext());\n+        result.setBaseUri(getBaseUri());\n+        result.setAuthorizationToken(authToken);\n+        return result;\n+    }\n+\n     @Override\n     public void configure() throws Exception {\n+        if (MockBackendUtils.startMockBackend(true)) {\n+            /* Start the mock Telegram API unless the user did export CAMEL_QUARKUS_FALLBACK_MOCK=false */", "originalCommit": "d56295c5380b597081d849aed74b597ebd1ba462", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDE4MDcxNQ==", "url": "https://github.com/apache/camel-quarkus/pull/1818#discussion_r494180715", "bodyText": "I do not see an issue. What would you expect there?", "author": "ppalaga", "createdAt": "2020-09-24T09:44:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDE3NDY2MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDE4MTc1OA==", "url": "https://github.com/apache/camel-quarkus/pull/1818#discussion_r494181758", "bodyText": "Oh, I see, it should be CAMEL_QUARKUS_START_MOCK_BACKEND=false", "author": "ppalaga", "createdAt": "2020-09-24T09:45:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDE3NDY2MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDE4MTkyOQ==", "url": "https://github.com/apache/camel-quarkus/pull/1818#discussion_r494181929", "bodyText": "Thanks, good catch!", "author": "ppalaga", "createdAt": "2020-09-24T09:46:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDE3NDY2MQ=="}], "type": "inlineReview"}, {"oid": "648244e651a34c9e68ccc7ba4723c9442a71114d", "url": "https://github.com/apache/camel-quarkus/commit/648244e651a34c9e68ccc7ba4723c9442a71114d", "message": "Make sure that Telegram tests are not run against mock API by setting CAMEL_QUARKUS_START_MOCK_BACKEND=false #1717", "committedDate": "2020-09-30T07:48:32Z", "type": "forcePushed"}, {"oid": "7acc20c770e44c12817358c1815f4e4e17a9f2c1", "url": "https://github.com/apache/camel-quarkus/commit/7acc20c770e44c12817358c1815f4e4e17a9f2c1", "message": "Make sure that Telegram tests are not run against mock API by setting CAMEL_QUARKUS_START_MOCK_BACKEND=false #1717", "committedDate": "2020-09-30T07:49:13Z", "type": "forcePushed"}, {"oid": "60f160ad40568634d1cc3b956dbc2ecb9173b71b", "url": "https://github.com/apache/camel-quarkus/commit/60f160ad40568634d1cc3b956dbc2ecb9173b71b", "message": "Make sure that Telegram tests are not run against mock API by setting CAMEL_QUARKUS_START_MOCK_BACKEND=false #1717", "committedDate": "2020-09-30T07:59:07Z", "type": "commit"}, {"oid": "60f160ad40568634d1cc3b956dbc2ecb9173b71b", "url": "https://github.com/apache/camel-quarkus/commit/60f160ad40568634d1cc3b956dbc2ecb9173b71b", "message": "Make sure that Telegram tests are not run against mock API by setting CAMEL_QUARKUS_START_MOCK_BACKEND=false #1717", "committedDate": "2020-09-30T07:59:07Z", "type": "forcePushed"}]}