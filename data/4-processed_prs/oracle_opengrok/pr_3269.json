{"pr_number": 3269, "pr_title": "Update jQuery to 3.5.1", "pr_createdAt": "2020-10-07T15:28:56Z", "pr_url": "https://github.com/oracle/opengrok/pull/3269", "timeline": [{"oid": "ae32f0813139bf1adfa18f6b24fd090fc50858e3", "url": "https://github.com/oracle/opengrok/commit/ae32f0813139bf1adfa18f6b24fd090fc50858e3", "message": "Update jQuery to 3.5.1", "committedDate": "2020-10-07T15:21:33Z", "type": "commit"}, {"oid": "970368ef493d36762dfb95ad282019ffbb6a51a7", "url": "https://github.com/oracle/opengrok/commit/970368ef493d36762dfb95ad282019ffbb6a51a7", "message": "Update webjar locator to 0.46", "committedDate": "2020-10-07T15:33:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTExMjQwMA==", "url": "https://github.com/oracle/opengrok/pull/3269#discussion_r501112400", "bodyText": "I wonder if this is going to work well w.r.t. caching. So far we relied on the version number to change I think.", "author": "vladak", "createdAt": "2020-10-07T15:37:12Z", "path": "opengrok-indexer/src/main/java/org/opengrok/indexer/web/Scripts.java", "diffHunk": "@@ -86,27 +89,27 @@ public FileScript(String script, int priority) {\n \n         @Override\n         public String toHtml() {\n-            StringBuilder builder = new StringBuilder();\n-            builder.append(\"\\t<script type=\\\"text/javascript\\\" src=\\\"\");\n-            builder.append(this.getScriptData());\n-            builder.append(\"\\\" data-priority=\\\"\");\n-            builder.append(this.getPriority());\n-            builder.append(\"\\\"></script>\\n\");\n-            return builder.toString();\n+            return \"\\t<script type=\\\"text/javascript\\\" src=\\\"\" +\n+                    this.getScriptData() +\n+                    \"\\\" data-priority=\\\"\" +\n+                    this.getPriority() +\n+                    \"\\\"></script>\\n\";\n         }\n \n     }\n \n     protected static final Map<String, Script> SCRIPTS = new TreeMap<>();\n \n+    private static final WebJarAssetLocator assetLocator = new WebJarAssetLocator();\n+\n     /**\n      * Aliases for the page scripts. The path in the FileScript is relatively to\n      * the request's context path.\n      *\n      * @see HttpServletRequest#getContextPath()\n      */\n     static {\n-        putjs(\"jquery\", \"js/jquery-3.4.1\", 10);\n+        putFromWebJar(\"jquery\", \"jquery.min.js\", 10);", "originalCommit": "970368ef493d36762dfb95ad282019ffbb6a51a7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTExNDA0MQ==", "url": "https://github.com/oracle/opengrok/pull/3269#discussion_r501114041", "bodyText": "The final code looks like this so version is still there :)\n<script type=\"text/javascript\" src=\"/opengrok_web_war/webjars/jquery/3.5.1/jquery.min.js\" data-priority=\"10\"</script>", "author": "ahornace", "createdAt": "2020-10-07T15:39:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTExMjQwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTExNDY2Nw==", "url": "https://github.com/oracle/opengrok/pull/3269#discussion_r501114667", "bodyText": "Yes, caching.", "author": "tulinkry", "createdAt": "2020-10-07T15:40:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTExMjQwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTExNjMxNQ==", "url": "https://github.com/oracle/opengrok/pull/3269#discussion_r501116315", "bodyText": "I'll probably need to modify ExpiresOneDayFilter to include /webjars.", "author": "ahornace", "createdAt": "2020-10-07T15:42:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTExMjQwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTExNzgwNw==", "url": "https://github.com/oracle/opengrok/pull/3269#discussion_r501117807", "bodyText": "Then it would be ok I guess.", "author": "tulinkry", "createdAt": "2020-10-07T15:44:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTExMjQwMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTExNjI5Mw==", "url": "https://github.com/oracle/opengrok/pull/3269#discussion_r501116293", "bodyText": "I didn't know + was better than a builder", "author": "tulinkry", "createdAt": "2020-10-07T15:42:30Z", "path": "opengrok-indexer/src/main/java/org/opengrok/indexer/web/Scripts.java", "diffHunk": "@@ -86,27 +89,27 @@ public FileScript(String script, int priority) {\n \n         @Override\n         public String toHtml() {\n-            StringBuilder builder = new StringBuilder();\n-            builder.append(\"\\t<script type=\\\"text/javascript\\\" src=\\\"\");\n-            builder.append(this.getScriptData());\n-            builder.append(\"\\\" data-priority=\\\"\");\n-            builder.append(this.getPriority());\n-            builder.append(\"\\\"></script>\\n\");\n-            return builder.toString();\n+            return \"\\t<script type=\\\"text/javascript\\\" src=\\\"\" +\n+                    this.getScriptData() +\n+                    \"\\\" data-priority=\\\"\" +\n+                    this.getPriority() +\n+                    \"\\\"></script>\\n\";", "originalCommit": "970368ef493d36762dfb95ad282019ffbb6a51a7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTExODUzNg==", "url": "https://github.com/oracle/opengrok/pull/3269#discussion_r501118536", "bodyText": "better = faster ?", "author": "vladak", "createdAt": "2020-10-07T15:45:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTExNjI5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTExODU5Mg==", "url": "https://github.com/oracle/opengrok/pull/3269#discussion_r501118592", "bodyText": "String concatenation uses StringBuilder in the backend so there is no performance gain but it's shorter this way.", "author": "ahornace", "createdAt": "2020-10-07T15:45:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTExNjI5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTEyMDQ2OQ==", "url": "https://github.com/oracle/opengrok/pull/3269#discussion_r501120469", "bodyText": "In this case the builder approach was slightly more readable for me however that's probably just a matter of taste.", "author": "vladak", "createdAt": "2020-10-07T15:48:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTExNjI5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTEyMjA5MQ==", "url": "https://github.com/oracle/opengrok/pull/3269#discussion_r501122091", "bodyText": "This was suggested by IDEA and I thought removing the clutter is better but I can revert it back :)", "author": "ahornace", "createdAt": "2020-10-07T15:50:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTExNjI5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTEyNjg0NA==", "url": "https://github.com/oracle/opengrok/pull/3269#discussion_r501126844", "bodyText": "Ok", "author": "tulinkry", "createdAt": "2020-10-07T15:56:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTExNjI5Mw=="}], "type": "inlineReview"}, {"oid": "57228255cc8c75454d804cc116ae2409d84c39a9", "url": "https://github.com/oracle/opengrok/commit/57228255cc8c75454d804cc116ae2409d84c39a9", "message": "Add webjars path to ExpiresOneDayFilter", "committedDate": "2020-10-07T15:44:35Z", "type": "commit"}, {"oid": "07bd0b3fc065b2048470df46b2942516609bae06", "url": "https://github.com/oracle/opengrok/commit/07bd0b3fc065b2048470df46b2942516609bae06", "message": "Move Scripts and dependent classes to web module", "committedDate": "2020-10-08T15:08:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTkzNDQzMQ==", "url": "https://github.com/oracle/opengrok/pull/3269#discussion_r501934431", "bodyText": "there you go :-)", "author": "vladak", "createdAt": "2020-10-08T18:38:57Z", "path": "opengrok-indexer/src/main/java/org/opengrok/indexer/web/messages/Message.java", "diffHunk": "@@ -80,6 +80,7 @@ public String toString() {\n             return messageLevelString;\n         }\n \n+        @SuppressWarnings(\"rawtypes\")", "originalCommit": "07bd0b3fc065b2048470df46b2942516609bae06", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}