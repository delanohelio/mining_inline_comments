{"pr_number": 3011, "pr_title": "Messages class rework", "pr_createdAt": "2020-01-03T13:46:52Z", "pr_url": "https://github.com/oracle/opengrok/pull/3011", "timeline": [{"oid": "4da305a4853317e2b810a4fd9615ede4b82f3f72", "url": "https://github.com/oracle/opengrok/commit/4da305a4853317e2b810a4fd9615ede4b82f3f72", "message": "convert Message#cssClass to enum and check values", "committedDate": "2020-01-03T10:24:42Z", "type": "commit"}, {"oid": "4b100736a6713c7da285466047a1fe1cbb0e0789", "url": "https://github.com/oracle/opengrok/commit/4b100736a6713c7da285466047a1fe1cbb0e0789", "message": "add test for invalid cssClass", "committedDate": "2020-01-03T10:24:42Z", "type": "commit"}, {"oid": "7365a438fc5e84382ab7b88ecbf660a52c52ad8c", "url": "https://github.com/oracle/opengrok/commit/7365a438fc5e84382ab7b88ecbf660a52c52ad8c", "message": "add getHighestCssClassLevel()\n\nplus test", "committedDate": "2020-01-03T10:24:42Z", "type": "commit"}, {"oid": "ec68aca65e20c791da344ed5ec3445594821a90f", "url": "https://github.com/oracle/opengrok/commit/ec68aca65e20c791da344ed5ec3445594821a90f", "message": "use distinct tags so that messages appear individually", "committedDate": "2020-01-03T13:32:38Z", "type": "commit"}, {"oid": "0890bb960b0b070fd577006588725945b66d650c", "url": "https://github.com/oracle/opengrok/commit/0890bb960b0b070fd577006588725945b66d650c", "message": "basic work on getting CSS classes reflected in the UI (JSP only)\n\n- move getHighestCssClassLevel to MessagesUtils\n- introduce basic CSS styles\n\nfixes #2974", "committedDate": "2020-01-03T13:33:05Z", "type": "commit"}, {"oid": "42447496730d2d2183e57d2d1e9e59eaca88ce22", "url": "https://github.com/oracle/opengrok/commit/42447496730d2d2183e57d2d1e9e59eaca88ce22", "message": "add note style to autocomplete error", "committedDate": "2020-01-03T13:33:05Z", "type": "commit"}, {"oid": "a726308e91ff7befa0c127cf1c16d2efb13653d2", "url": "https://github.com/oracle/opengrok/commit/a726308e91ff7befa0c127cf1c16d2efb13653d2", "message": "add message level for SOL", "committedDate": "2020-01-03T13:33:05Z", "type": "commit"}, {"oid": "fde1380c5134a5f413e341cd7efc3c6af5efbc4d", "url": "https://github.com/oracle/opengrok/commit/fde1380c5134a5f413e341cd7efc3c6af5efbc4d", "message": "bump SOL ver", "committedDate": "2020-01-03T13:33:05Z", "type": "commit"}, {"oid": "38487b850f2ab98afce84d228d5aef4868228447", "url": "https://github.com/oracle/opengrok/commit/38487b850f2ab98afce84d228d5aef4868228447", "message": "bump utils ver", "committedDate": "2020-01-03T13:33:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzQ1OTQyMg==", "url": "https://github.com/oracle/opengrok/pull/3011#discussion_r363459422", "bodyText": "I think I've never seen a java method starting with capital letter", "author": "ktulinger", "createdAt": "2020-01-06T20:02:56Z", "path": "opengrok-indexer/src/main/java/org/opengrok/indexer/web/messages/Message.java", "diffHunk": "@@ -50,7 +50,44 @@\n     @NotEmpty(message = \"tags cannot be empty\")\n     private Set<String> tags = Collections.singleton(MESSAGES_MAIN_PAGE_TAG);\n \n-    private String cssClass = \"info\";\n+    public enum CssClassType {\n+        /**\n+         * Known values: SUCCESS, INFO, WARNING, ERROR.\n+         * The values are sorted according to their level. Higher numeric value of the level (i.e. the enum ordinal)\n+         * means higher priority.\n+         */\n+        SUCCESS(\"success\"), INFO(\"info\"), WARNING(\"warning\"), ERROR(\"error\");\n+\n+        private String cssClassString;\n+\n+        CssClassType(String str) {\n+            cssClassString = str;\n+        }\n+\n+        public static CssClassType StringToCssClassType(String val) throws IllegalArgumentException {", "originalCommit": "38487b850f2ab98afce84d228d5aef4868228447", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzQ1OTcyNw==", "url": "https://github.com/oracle/opengrok/pull/3011#discussion_r363459727", "bodyText": "this should be illegal argument as well no? the caller should check for null and assing default INFO", "author": "ktulinger", "createdAt": "2020-01-06T20:03:43Z", "path": "opengrok-indexer/src/main/java/org/opengrok/indexer/web/messages/Message.java", "diffHunk": "@@ -50,7 +50,44 @@\n     @NotEmpty(message = \"tags cannot be empty\")\n     private Set<String> tags = Collections.singleton(MESSAGES_MAIN_PAGE_TAG);\n \n-    private String cssClass = \"info\";\n+    public enum CssClassType {\n+        /**\n+         * Known values: SUCCESS, INFO, WARNING, ERROR.\n+         * The values are sorted according to their level. Higher numeric value of the level (i.e. the enum ordinal)\n+         * means higher priority.\n+         */\n+        SUCCESS(\"success\"), INFO(\"info\"), WARNING(\"warning\"), ERROR(\"error\");\n+\n+        private String cssClassString;\n+\n+        CssClassType(String str) {\n+            cssClassString = str;\n+        }\n+\n+        public static CssClassType StringToCssClassType(String val) throws IllegalArgumentException {\n+            if (val == null) {\n+                return INFO;", "originalCommit": "38487b850f2ab98afce84d228d5aef4868228447", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzY2MDEzNA==", "url": "https://github.com/oracle/opengrok/pull/3011#discussion_r363660134", "bodyText": "This was probably implementation conveniencelaziness.", "author": "vladak", "createdAt": "2020-01-07T09:30:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzQ1OTcyNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzQ1OTg2NA==", "url": "https://github.com/oracle/opengrok/pull/3011#discussion_r363459864", "bodyText": "there is compareTo of a Comparable interface", "author": "ktulinger", "createdAt": "2020-01-06T20:04:04Z", "path": "opengrok-indexer/src/main/java/org/opengrok/indexer/web/messages/Message.java", "diffHunk": "@@ -50,7 +50,44 @@\n     @NotEmpty(message = \"tags cannot be empty\")\n     private Set<String> tags = Collections.singleton(MESSAGES_MAIN_PAGE_TAG);\n \n-    private String cssClass = \"info\";\n+    public enum CssClassType {\n+        /**\n+         * Known values: SUCCESS, INFO, WARNING, ERROR.\n+         * The values are sorted according to their level. Higher numeric value of the level (i.e. the enum ordinal)\n+         * means higher priority.\n+         */\n+        SUCCESS(\"success\"), INFO(\"info\"), WARNING(\"warning\"), ERROR(\"error\");\n+\n+        private String cssClassString;\n+\n+        CssClassType(String str) {\n+            cssClassString = str;\n+        }\n+\n+        public static CssClassType StringToCssClassType(String val) throws IllegalArgumentException {\n+            if (val == null) {\n+                return INFO;\n+            }\n+            for (CssClassType v : CssClassType.values()) {\n+                if (v.toString().equals(val)) {\n+                    return v;\n+                }\n+            }\n+            throw new IllegalArgumentException(\"class type does not match any known value\");\n+        }\n+\n+        @Override\n+        public String toString() {\n+            return cssClassString;\n+        }\n+\n+        public static int compare(CssClassType c1, CssClassType c2) {", "originalCommit": "38487b850f2ab98afce84d228d5aef4868228447", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzQ1OTkyMA==", "url": "https://github.com/oracle/opengrok/pull/3011#discussion_r363459920", "bodyText": "you should implement it", "author": "ktulinger", "createdAt": "2020-01-06T20:04:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzQ1OTg2NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzY2MzgwOA==", "url": "https://github.com/oracle/opengrok/pull/3011#discussion_r363663808", "bodyText": "This is needed for max() which requires Comparator rather than Comparable. However, the method needs to be static so it can be used via method reference hence the class cannot implement Comparator.", "author": "vladak", "createdAt": "2020-01-07T09:39:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzQ1OTg2NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzY3MTI3MQ==", "url": "https://github.com/oracle/opengrok/pull/3011#discussion_r363671271", "bodyText": "perhaps using Comparator as a static member is the cleanest way.", "author": "vladak", "createdAt": "2020-01-07T09:57:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzQ1OTg2NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzQ2MTAzNw==", "url": "https://github.com/oracle/opengrok/pull/3011#discussion_r363461037", "bodyText": "sounds like a job for flatMap", "author": "ktulinger", "createdAt": "2020-01-06T20:07:13Z", "path": "opengrok-indexer/src/main/java/org/opengrok/indexer/web/messages/MessagesUtils.java", "diffHunk": "@@ -230,4 +231,32 @@ private static String messagesToJson(Group group, String... additionalTags) {\n     public static String messagesToJson(Group group) {\n         return messagesToJson(group, new String[0]);\n     }\n+\n+    /**\n+     * @return name of highest cssClass of messages present in the system or null.\n+     */\n+    static String getHighestCssClassLevel(Set<MessagesContainer.AcceptedMessage> messages) {\n+        return messages.\n+                stream().\n+                map(MessagesContainer.AcceptedMessage::getCssClass).\n+                map(Message.CssClassType::StringToCssClassType).\n+                max(Message.CssClassType::compare).\n+                map(Message.CssClassType::toString).\n+                orElse(null);\n+    }\n+\n+    /**\n+     * @param tags message tags\n+     * @return name of highest cssClass of messages present in the system or null.\n+     */\n+    public static String getCssClass(String... tags) {\n+        Set<MessagesContainer.AcceptedMessage> messages = new TreeSet<>();\n+        RuntimeEnvironment env = RuntimeEnvironment.getInstance();\n+\n+        for (String tag : tags) {\n+            messages.addAll(env.getMessages(tag));", "originalCommit": "38487b850f2ab98afce84d228d5aef4868228447", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzgxNjU4MA==", "url": "https://github.com/oracle/opengrok/pull/3011#discussion_r363816580", "bodyText": "okay, I converted the code for the sake of learning stream API :-)", "author": "vladak", "createdAt": "2020-01-07T15:54:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzQ2MTAzNw=="}], "type": "inlineReview"}, {"oid": "1929a055e8170a971a6fca6a7cdba7fe64c38c8d", "url": "https://github.com/oracle/opengrok/commit/1929a055e8170a971a6fca6a7cdba7fe64c38c8d", "message": "avoid initial capital letter", "committedDate": "2020-01-07T09:09:50Z", "type": "commit"}, {"oid": "a9a9289e56e572bf2740394023aa9ad1bcb70642", "url": "https://github.com/oracle/opengrok/commit/a9a9289e56e572bf2740394023aa9ad1bcb70642", "message": "avoid null handling", "committedDate": "2020-01-07T09:30:04Z", "type": "commit"}, {"oid": "869213561fb8dad0dfe7a3ffa21001e6154d290f", "url": "https://github.com/oracle/opengrok/commit/869213561fb8dad0dfe7a3ffa21001e6154d290f", "message": "use Comparator for max()", "committedDate": "2020-01-07T09:59:34Z", "type": "commit"}, {"oid": "916f4938f9913f3a8ffbdd2816686d61a20209bc", "url": "https://github.com/oracle/opengrok/commit/916f4938f9913f3a8ffbdd2816686d61a20209bc", "message": "use Collection instead of Set", "committedDate": "2020-01-07T10:03:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzc4MDY0OQ==", "url": "https://github.com/oracle/opengrok/pull/3011#discussion_r363780649", "bodyText": "can be final and thus with constant naming scheme - capital letters", "author": "ktulinger", "createdAt": "2020-01-07T14:45:28Z", "path": "opengrok-indexer/src/main/java/org/opengrok/indexer/web/messages/Message.java", "diffHunk": "@@ -78,9 +79,7 @@ public String toString() {\n             return cssClassString;\n         }\n \n-        public static int compare(CssClassType c1, CssClassType c2) {\n-            return Integer.compare(c1.ordinal(), c2.ordinal());\n-        }\n+        public static Comparator<CssClassType> valueComparator = Comparator.comparingInt(Enum::ordinal);", "originalCommit": "869213561fb8dad0dfe7a3ffa21001e6154d290f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "b19e4aece1af09bba5ad5080df0b9ffafe8a52fd", "url": "https://github.com/oracle/opengrok/commit/b19e4aece1af09bba5ad5080df0b9ffafe8a52fd", "message": "use flatMap and add test", "committedDate": "2020-01-07T15:52:09Z", "type": "commit"}, {"oid": "9c1b1195f15356e92d273a6d9ef9ca4bd30233ab", "url": "https://github.com/oracle/opengrok/commit/9c1b1195f15356e92d273a6d9ef9ca4bd30233ab", "message": "make value comparator final", "committedDate": "2020-01-07T15:55:19Z", "type": "commit"}, {"oid": "da12b340419691fe52986c402985e2890821f4ef", "url": "https://github.com/oracle/opengrok/commit/da12b340419691fe52986c402985e2890821f4ef", "message": "get rid of CSS class in names", "committedDate": "2020-01-07T17:46:34Z", "type": "commit"}, {"oid": "da12b340419691fe52986c402985e2890821f4ef", "url": "https://github.com/oracle/opengrok/commit/da12b340419691fe52986c402985e2890821f4ef", "message": "get rid of CSS class in names", "committedDate": "2020-01-07T17:46:34Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzg5MjEyMg==", "url": "https://github.com/oracle/opengrok/pull/3011#discussion_r363892122", "bodyText": "use valid value", "author": "ktulinger", "createdAt": "2020-01-07T18:41:33Z", "path": "apiary.apib", "diffHunk": "@@ -84,7 +84,7 @@ see https://docs.oracle.com/javase/8/docs/api/java/time/Duration.html#parse-java\n \n         {\n           \"tags\": [\"main\"],\n-          \"cssClass\": \"class\",\n+          \"messageLevel\": \"class\",", "originalCommit": "da12b340419691fe52986c402985e2890821f4ef", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzg5MjQ0OQ==", "url": "https://github.com/oracle/opengrok/pull/3011#discussion_r363892449", "bodyText": "why not use the MessageLevel type?", "author": "ktulinger", "createdAt": "2020-01-07T18:42:22Z", "path": "opengrok-indexer/src/main/java/org/opengrok/indexer/web/messages/Message.java", "diffHunk": "@@ -100,7 +100,7 @@ private Message() { // needed for deserialization\n     public Message(\n             final String text,\n             final Set<String> tags,\n-            final String cssClass,\n+            final String messageLevel,", "originalCommit": "da12b340419691fe52986c402985e2890821f4ef", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzg5MjUwMg==", "url": "https://github.com/oracle/opengrok/pull/3011#discussion_r363892502", "bodyText": "why not use the MessageLevel type?", "author": "ktulinger", "createdAt": "2020-01-07T18:42:31Z", "path": "opengrok-indexer/src/main/java/org/opengrok/indexer/web/messages/Message.java", "diffHunk": "@@ -115,16 +115,16 @@ public Message(\n \n         this.text = text;\n         this.tags = tags;\n-        this.cssClass = CssClassType.stringToCssClassType(cssClass);\n+        this.messageLevel = MessageLevel.stringToMessageLevel(messageLevel);\n         this.duration = duration;\n     }\n \n     public Set<String> getTags() {\n         return tags;\n     }\n \n-    public String getCssClass() {\n-        return cssClass.toString();\n+    public String getMessageLevel() {\n+        return messageLevel.toString();", "originalCommit": "da12b340419691fe52986c402985e2890821f4ef", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzg5MjU5Mg==", "url": "https://github.com/oracle/opengrok/pull/3011#discussion_r363892592", "bodyText": "why not use the MessageLevel type?", "author": "ktulinger", "createdAt": "2020-01-07T18:42:49Z", "path": "opengrok-indexer/src/main/java/org/opengrok/indexer/web/messages/MessagesContainer.java", "diffHunk": "@@ -250,9 +250,9 @@ public String getText() {\n             return message.getText();\n         }\n \n-        @JsonProperty(\"cssClass\")\n-        public String getCssClass() {\n-            return message.getCssClass();\n+        @JsonProperty(\"messageLevel\")\n+        public String getMessageLevel() {", "originalCommit": "da12b340419691fe52986c402985e2890821f4ef", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "0a1df588bc0edda87fadba6a4bea20dfcf9ed104", "url": "https://github.com/oracle/opengrok/commit/0a1df588bc0edda87fadba6a4bea20dfcf9ed104", "message": "use info level", "committedDate": "2020-01-08T12:03:32Z", "type": "commit"}, {"oid": "56b4528b31418a754ab4d1859cc69523580a2946", "url": "https://github.com/oracle/opengrok/commit/56b4528b31418a754ab4d1859cc69523580a2946", "message": "make Message.getMessageLevel() return MessageLevel", "committedDate": "2020-01-08T12:08:05Z", "type": "commit"}, {"oid": "93565afd4a0100f0cdededc51bd2f963e00bce87", "url": "https://github.com/oracle/opengrok/commit/93565afd4a0100f0cdededc51bd2f963e00bce87", "message": "fix MessageLevel string handling", "committedDate": "2020-01-09T11:44:26Z", "type": "commit"}, {"oid": "e0d03a7622c3c7bc4aff8c024c2304098a726fc8", "url": "https://github.com/oracle/opengrok/commit/e0d03a7622c3c7bc4aff8c024c2304098a726fc8", "message": "use MessageLevel in Message constructor", "committedDate": "2020-01-09T12:10:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDg2NTA3NQ==", "url": "https://github.com/oracle/opengrok/pull/3011#discussion_r364865075", "bodyText": "can be final", "author": "ktulinger", "createdAt": "2020-01-09T17:21:34Z", "path": "opengrok-indexer/src/main/java/org/opengrok/indexer/web/messages/Message.java", "diffHunk": "@@ -50,7 +52,39 @@\n     @NotEmpty(message = \"tags cannot be empty\")\n     private Set<String> tags = Collections.singleton(MESSAGES_MAIN_PAGE_TAG);\n \n-    private String cssClass = \"info\";\n+    public enum MessageLevel {\n+        /**\n+         * Known values: {@code SUCCESS}, {@code INFO}, {@code WARNING}, {@code ERROR}.\n+         * The values are sorted according to their level. Higher numeric value of the level (i.e. the enum ordinal)\n+         * means higher priority.\n+         */\n+        SUCCESS(\"success\"), INFO(\"info\"), WARNING(\"warning\"), ERROR(\"error\");\n+\n+        private String messageLevelString;", "originalCommit": "e0d03a7622c3c7bc4aff8c024c2304098a726fc8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDg2NTU5Mw==", "url": "https://github.com/oracle/opengrok/pull/3011#discussion_r364865593", "bodyText": "class should start with capital letter", "author": "ktulinger", "createdAt": "2020-01-09T17:22:42Z", "path": "opengrok-indexer/src/main/java/org/opengrok/indexer/web/messages/Message.java", "diffHunk": "@@ -157,6 +191,28 @@ public int compareTo(final Message o) {\n         return tags.size() - o.tags.size();\n     }\n \n+    private static class messageLevelDeserializer extends StdDeserializer<MessageLevel> {", "originalCommit": "e0d03a7622c3c7bc4aff8c024c2304098a726fc8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "6efbc8f44bff189bfcdf8dde51efdeb719dd1fa1", "url": "https://github.com/oracle/opengrok/commit/6efbc8f44bff189bfcdf8dde51efdeb719dd1fa1", "message": "make messageLevelString final", "committedDate": "2020-01-13T10:00:31Z", "type": "commit"}, {"oid": "aa645945ab275d974ff08b85094ad0896f278e9a", "url": "https://github.com/oracle/opengrok/commit/aa645945ab275d974ff08b85094ad0896f278e9a", "message": "classes should start with capital letter", "committedDate": "2020-01-13T10:01:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjI4NTM4Nw==", "url": "https://github.com/oracle/opengrok/pull/3011#discussion_r366285387", "bodyText": "non blocking, I usually found these as fromString", "author": "ktulinger", "createdAt": "2020-01-14T11:25:24Z", "path": "opengrok-indexer/src/main/java/org/opengrok/indexer/web/messages/Message.java", "diffHunk": "@@ -50,7 +52,39 @@\n     @NotEmpty(message = \"tags cannot be empty\")\n     private Set<String> tags = Collections.singleton(MESSAGES_MAIN_PAGE_TAG);\n \n-    private String cssClass = \"info\";\n+    public enum MessageLevel {\n+        /**\n+         * Known values: {@code SUCCESS}, {@code INFO}, {@code WARNING}, {@code ERROR}.\n+         * The values are sorted according to their level. Higher numeric value of the level (i.e. the enum ordinal)\n+         * means higher priority.\n+         */\n+        SUCCESS(\"success\"), INFO(\"info\"), WARNING(\"warning\"), ERROR(\"error\");\n+\n+        private final String messageLevelString;\n+\n+        MessageLevel(String str) {\n+            messageLevelString = str;\n+        }\n+\n+        public static MessageLevel stringToMessageLevel(String val) throws IllegalArgumentException {", "originalCommit": "aa645945ab275d974ff08b85094ad0896f278e9a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjI4NjEwOQ==", "url": "https://github.com/oracle/opengrok/pull/3011#discussion_r366286109", "bodyText": "I just wonder, serializer is not needed?", "author": "ktulinger", "createdAt": "2020-01-14T11:27:08Z", "path": "opengrok-indexer/src/main/java/org/opengrok/indexer/web/messages/Message.java", "diffHunk": "@@ -157,6 +191,28 @@ public int compareTo(final Message o) {\n         return tags.size() - o.tags.size();\n     }\n \n+    private static class MessageLevelDeserializer extends StdDeserializer<MessageLevel> {\n+        private static final long serialVersionUID = 928540953227342817L;\n+\n+        MessageLevelDeserializer() {\n+            this(null);\n+        }\n+\n+        MessageLevelDeserializer(Class<?> vc) {\n+            super(vc);\n+        }\n+\n+        @Override\n+        public MessageLevel deserialize(final JsonParser parser, final DeserializationContext context)\n+                throws IOException {\n+            try {\n+                return MessageLevel.stringToMessageLevel(context.readValue(parser, String.class));\n+            } catch (DateTimeParseException e) {\n+                throw new IOException(e);\n+            }\n+        }\n+    }\n+", "originalCommit": "aa645945ab275d974ff08b85094ad0896f278e9a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjMyOTA1NA==", "url": "https://github.com/oracle/opengrok/pull/3011#discussion_r366329054", "bodyText": "nope, it works out of the box.", "author": "vladak", "createdAt": "2020-01-14T13:12:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjI4NjEwOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjI4NjY0MQ==", "url": "https://github.com/oracle/opengrok/pull/3011#discussion_r366286641", "bodyText": "I'd qualify here with the class name so the name does not seem a little out of context.", "author": "ktulinger", "createdAt": "2020-01-14T11:28:31Z", "path": "opengrok-indexer/src/main/java/org/opengrok/indexer/web/messages/MessagesUtils.java", "diffHunk": "@@ -230,4 +234,32 @@ private static String messagesToJson(Group group, String... additionalTags) {\n     public static String messagesToJson(Group group) {\n         return messagesToJson(group, new String[0]);\n     }\n+\n+    /**\n+     * @return name of highest cssClass of messages present in the system or null.\n+     */\n+    static String getHighestMessageLevel(Collection<MessagesContainer.AcceptedMessage> messages) {\n+        return messages.\n+                stream().\n+                map(MessagesContainer.AcceptedMessage::getMessageLevel).\n+                max(VALUE_COMPARATOR).", "originalCommit": "aa645945ab275d974ff08b85094ad0896f278e9a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjI4NzI2NQ==", "url": "https://github.com/oracle/opengrok/pull/3011#discussion_r366287265", "bodyText": "a question here is if you want to restrict these classes to be used only for important-note or just without any restriction (one can use it later for completely unrelated styling with the given colour).", "author": "ktulinger", "createdAt": "2020-01-14T11:30:10Z", "path": "opengrok-web/src/main/webapp/default/style.css", "diffHunk": "@@ -1249,6 +1236,34 @@ h6.message-group-caption {\n     line-height: 1.3;\n }\n \n+.important-note {\n+    text-align: center;\n+    display: inline-block;\n+    max-height: 100%;\n+}\n+\n+.note-success {\n+    background-color: #3c763d;\n+}\n+\n+.note-info {\n+    background-color: #31708f;\n+}\n+\n+.note-warning {\n+    background-color: #8a6d3b;\n+}\n+\n+.note-error {\n+    background-color: #a94442;\n+}", "originalCommit": "aa645945ab275d974ff08b85094ad0896f278e9a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjMzOTI4Nw==", "url": "https://github.com/oracle/opengrok/pull/3011#discussion_r366339287", "bodyText": "Is there a way how to elegantly limit the note-* styles for both important-note and .important-note.important-note-rounded. The thing is, .important-note is used both with and without important-note-rounded.", "author": "vladak", "createdAt": "2020-01-14T13:34:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjI4NzI2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjMzOTk2Mw==", "url": "https://github.com/oracle/opengrok/pull/3011#discussion_r366339963", "bodyText": "Initially, I wanted to unite the note-* styles with .message-group-item.* styles so the color definitions are defined just once however the latter use color instead of backgound-color.", "author": "vladak", "createdAt": "2020-01-14T13:35:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjI4NzI2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjM5Mzk0Mg==", "url": "https://github.com/oracle/opengrok/pull/3011#discussion_r366393942", "bodyText": "By elegant I mean something like this:\n.important-note {\n    text-align: center;\n    display: inline-block;\n    max-height: 100%;\n}\n\n.important-note.note-success {\n    background-color: #3c763d;\n}\n\n... // more .note styles\nand then it would be nice if I can say something like this:\n.important-note.note-*.important-note-rounded {\n    border-radius: 50%;\n    max-width: 100%;\n    min-width: 20px;\n}\nhowever I am not sure this is possible in CSS.", "author": "vladak", "createdAt": "2020-01-14T15:11:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjI4NzI2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Njg4NDUwOA==", "url": "https://github.com/oracle/opengrok/pull/3011#discussion_r366884508", "bodyText": "Follow-up on our Slack discussion: it turns out that I misread the CSS selectors guide - the .class1.class2 selector is not strictly hierarchical so there can be style that can only be used with important-note while being also usable with both important-note.note and important-note-rounded.", "author": "vladak", "createdAt": "2020-01-15T13:50:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjI4NzI2NQ=="}], "type": "inlineReview"}, {"oid": "70d38c7ec68300c4e04d3c9aa5ac72dc477f92e5", "url": "https://github.com/oracle/opengrok/commit/70d38c7ec68300c4e04d3c9aa5ac72dc477f92e5", "message": "rename stringToMessageLevel() to fromString()", "committedDate": "2020-01-14T13:13:32Z", "type": "commit"}, {"oid": "d5b51f9f839e3bafc21cd8a14f017b841e5312af", "url": "https://github.com/oracle/opengrok/commit/d5b51f9f839e3bafc21cd8a14f017b841e5312af", "message": "qualify value comparator using full(er) name", "committedDate": "2020-01-14T13:15:55Z", "type": "commit"}, {"oid": "46b9358f179a6f55c4ad6471c10e6c4e75821f62", "url": "https://github.com/oracle/opengrok/commit/46b9358f179a6f55c4ad6471c10e6c4e75821f62", "message": "fix method name", "committedDate": "2020-01-15T12:19:50Z", "type": "commit"}, {"oid": "09d8df66e8f56a5e49eab0e765d58ce22b9d75b9", "url": "https://github.com/oracle/opengrok/commit/09d8df66e8f56a5e49eab0e765d58ce22b9d75b9", "message": "fix script versions", "committedDate": "2020-01-15T12:30:25Z", "type": "commit"}, {"oid": "028775af04b130a9bbe5f858afa6b3c710fe54bf", "url": "https://github.com/oracle/opengrok/commit/028775af04b130a9bbe5f858afa6b3c710fe54bf", "message": "fix colors in message window", "committedDate": "2020-01-15T13:27:35Z", "type": "commit"}, {"oid": "256e291c3afa49b8367f13b6b31d5bb726838d34", "url": "https://github.com/oracle/opengrok/commit/256e291c3afa49b8367f13b6b31d5bb726838d34", "message": "allow note style to be used only together with important-note style", "committedDate": "2020-01-15T13:27:46Z", "type": "commit"}, {"oid": "bac5302f725cb07733b4d67b929a29a955a697fe", "url": "https://github.com/oracle/opengrok/commit/bac5302f725cb07733b4d67b929a29a955a697fe", "message": "fix test", "committedDate": "2020-01-15T14:30:26Z", "type": "commit"}]}