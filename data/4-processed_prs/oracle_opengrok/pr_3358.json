{"pr_number": 3358, "pr_title": "raise exception from do_api_call()", "pr_createdAt": "2020-11-04T14:19:47Z", "pr_url": "https://github.com/oracle/opengrok/pull/3358", "timeline": [{"oid": "9e13c0f9a52f504e4fdf59be1816630198804136", "url": "https://github.com/oracle/opengrok/commit/9e13c0f9a52f504e4fdf59be1816630198804136", "message": "raise exception from do_api_call()\n\nfixes #3356", "committedDate": "2020-11-04T14:17:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzY0NzYzNA==", "url": "https://github.com/oracle/opengrok/pull/3358#discussion_r517647634", "bodyText": "this is usually done at the top of the file (like global variable)", "author": "tulinkry", "createdAt": "2020-11-04T21:41:52Z", "path": "opengrok-tools/src/main/python/opengrok_tools/utils/restful.py", "diffHunk": "@@ -38,14 +38,24 @@ def do_api_call(verb, uri, params=None, headers=None, data=None):\n     if handler is None or not callable(handler):\n         raise Exception('Unknown HTTP verb: {}'.format(verb))\n \n-    return handler(\n+    logger = logging.getLogger(__name__)", "originalCommit": "9e13c0f9a52f504e4fdf59be1816630198804136", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzk1NzE5MQ==", "url": "https://github.com/oracle/opengrok/pull/3358#discussion_r517957191", "bodyText": "will fix", "author": "vladak", "createdAt": "2020-11-05T10:47:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzY0NzYzNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzY4MDM3MA==", "url": "https://github.com/oracle/opengrok/pull/3358#discussion_r517680370", "bodyText": "you don't know the call failed at this point", "author": "tulinkry", "createdAt": "2020-11-04T22:57:08Z", "path": "opengrok-tools/src/main/python/opengrok_tools/utils/restful.py", "diffHunk": "@@ -38,14 +38,24 @@ def do_api_call(verb, uri, params=None, headers=None, data=None):\n     if handler is None or not callable(handler):\n         raise Exception('Unknown HTTP verb: {}'.format(verb))\n \n-    return handler(\n+    logger = logging.getLogger(__name__)\n+\n+    logger.debug(\"{} API call: {} with data '{}' and headers: {}\".\n+                 format(verb, uri, data, headers))\n+    r = handler(\n         uri,\n         data=data,\n         params=params,\n         headers=headers,\n         proxies=get_proxies(uri)\n     )\n \n+    if r is not None:\n+        logger.error(\"API call failed: {}\".format(r))", "originalCommit": "9e13c0f9a52f504e4fdf59be1816630198804136", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzY4MDgyMQ==", "url": "https://github.com/oracle/opengrok/pull/3358#discussion_r517680821", "bodyText": "is the logging necessary here? if you throw the exception you kinda expect someone else to handle it (and log it perhaps)", "author": "tulinkry", "createdAt": "2020-11-04T22:58:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzY4MDM3MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzk1NzQ3MA==", "url": "https://github.com/oracle/opengrok/pull/3358#discussion_r517957470", "bodyText": "true, removed", "author": "vladak", "createdAt": "2020-11-05T10:47:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzY4MDM3MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzY4MDU5MA==", "url": "https://github.com/oracle/opengrok/pull/3358#discussion_r517680590", "bodyText": "I'd interpret this behavior to the doc string (exception on failed requests)", "author": "tulinkry", "createdAt": "2020-11-04T22:57:39Z", "path": "opengrok-tools/src/main/python/opengrok_tools/utils/restful.py", "diffHunk": "@@ -38,14 +38,24 @@ def do_api_call(verb, uri, params=None, headers=None, data=None):\n     if handler is None or not callable(handler):\n         raise Exception('Unknown HTTP verb: {}'.format(verb))\n \n-    return handler(\n+    logger = logging.getLogger(__name__)\n+\n+    logger.debug(\"{} API call: {} with data '{}' and headers: {}\".\n+                 format(verb, uri, data, headers))\n+    r = handler(\n         uri,\n         data=data,\n         params=params,\n         headers=headers,\n         proxies=get_proxies(uri)\n     )\n \n+    if r is not None:\n+        logger.error(\"API call failed: {}\".format(r))\n+        r.raise_for_status()", "originalCommit": "9e13c0f9a52f504e4fdf59be1816630198804136", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzk2NDEyNA==", "url": "https://github.com/oracle/opengrok/pull/3358#discussion_r517964124", "bodyText": "added a doc string", "author": "vladak", "createdAt": "2020-11-05T10:59:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzY4MDU5MA=="}], "type": "inlineReview"}, {"oid": "ef721794d22deb9c688f232aebb65f4451878152", "url": "https://github.com/oracle/opengrok/commit/ef721794d22deb9c688f232aebb65f4451878152", "message": "move logger init", "committedDate": "2020-11-05T10:47:15Z", "type": "commit"}, {"oid": "3f65b7542c52d76128e58d96fcf15e76fd55e3a5", "url": "https://github.com/oracle/opengrok/commit/3f65b7542c52d76128e58d96fcf15e76fd55e3a5", "message": "do not log", "committedDate": "2020-11-05T10:47:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzk2MTA5NA==", "url": "https://github.com/oracle/opengrok/pull/3358#discussion_r517961094", "bodyText": "thinking about it, i don't remember if this can occur with requests, but even if it could occur (r is None) then you should probably raise an exception here instead of passing the None to the caller (like when handler is none)", "author": "tulinkry", "createdAt": "2020-11-05T10:53:52Z", "path": "opengrok-tools/src/main/python/opengrok_tools/utils/restful.py", "diffHunk": "@@ -34,18 +34,27 @@\n \n \n def do_api_call(verb, uri, params=None, headers=None, data=None):\n+    logger = logging.getLogger(__name__)\n+\n     handler = getattr(requests, verb.lower())\n     if handler is None or not callable(handler):\n         raise Exception('Unknown HTTP verb: {}'.format(verb))\n \n-    return handler(\n+    logger.debug(\"{} API call: {} with data '{}' and headers: {}\".\n+                 format(verb, uri, data, headers))\n+    r = handler(\n         uri,\n         data=data,\n         params=params,\n         headers=headers,\n         proxies=get_proxies(uri)\n     )\n \n+    if r is not None:", "originalCommit": "3f65b7542c52d76128e58d96fcf15e76fd55e3a5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzk2NTQ0MA==", "url": "https://github.com/oracle/opengrok/pull/3358#discussion_r517965440", "bodyText": "makes sense", "author": "vladak", "createdAt": "2020-11-05T11:01:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzk2MTA5NA=="}], "type": "inlineReview"}, {"oid": "e83429d616d53198f1a9b0285e191d14e74578ec", "url": "https://github.com/oracle/opengrok/commit/e83429d616d53198f1a9b0285e191d14e74578ec", "message": "add doc string", "committedDate": "2020-11-05T10:58:27Z", "type": "commit"}, {"oid": "126a298638c021b506c64aab155807fa7e08caa1", "url": "https://github.com/oracle/opengrok/commit/126a298638c021b506c64aab155807fa7e08caa1", "message": "raise when result is None", "committedDate": "2020-11-05T11:01:01Z", "type": "commit"}]}