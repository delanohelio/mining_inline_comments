{"pr_number": 774, "pr_title": "Revamp gradle files and build script for cleaner build and publish", "pr_createdAt": "2020-06-06T14:51:08Z", "pr_url": "https://github.com/senx/warp10-platform/pull/774", "timeline": [{"oid": "5a3bd56fb316e77177c5650fd4677a7eaa16e2fb", "url": "https://github.com/senx/warp10-platform/commit/5a3bd56fb316e77177c5650fd4677a7eaa16e2fb", "message": "Revamp gradle files and build script for smoother build and publish", "committedDate": "2020-06-06T14:47:52Z", "type": "commit"}, {"oid": "ae613ea11fdd36d2c2db8da4092f1ec7e86b5e5a", "url": "https://github.com/senx/warp10-platform/commit/ae613ea11fdd36d2c2db8da4092f1ec7e86b5e5a", "message": "Add missing newlines at end of files", "committedDate": "2020-06-06T14:50:58Z", "type": "commit"}, {"oid": "6bbf6fa0ada71812dcf5069759739a59f89fe9aa", "url": "https://github.com/senx/warp10-platform/commit/6bbf6fa0ada71812dcf5069759739a59f89fe9aa", "message": "Address deprecated warnings", "committedDate": "2020-06-06T16:06:13Z", "type": "commit"}, {"oid": "4e6eb20e0d708ea4f32cbdd99d07fbb74cff71d2", "url": "https://github.com/senx/warp10-platform/commit/4e6eb20e0d708ea4f32cbdd99d07fbb74cff71d2", "message": "Get right Gradle configuration for WarpScript POM", "committedDate": "2020-06-12T09:01:15Z", "type": "commit"}, {"oid": "79502f28b62a39c0338cea5602713e93e47dfef9", "url": "https://github.com/senx/warp10-platform/commit/79502f28b62a39c0338cea5602713e93e47dfef9", "message": "Add sourcesJar tasks to create sources jars", "committedDate": "2020-07-07T11:55:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzE5NDAwNg==", "url": "https://github.com/senx/warp10-platform/pull/774#discussion_r457194006", "bodyText": "META-INF/*.RSA signatures may appear/disappear depending on dependencies. It is important that those files be removed otherwise the JVM may fail to validate repackaged classes if they initially had a signature.", "author": "hbs", "createdAt": "2020-07-20T08:56:28Z", "path": "warp10/build.gradle", "diffHunk": "@@ -43,171 +42,147 @@ dependencies {\n     //\n     // io.warp10 dependencies\n     //\n-    compile project(':crypto')\n-    compile project(':token')\n-    compile 'io.warp10:sensision:1.0.21'\n+    api project(':crypto')\n+    api project(':token')\n+    api 'io.warp10:sensision:1.0.21'\n \n-    compile 'joda-time:joda-time:2.2'\n-    compile 'org.apache.commons:commons-lang3:3.6'\n-    compile 'org.apache.commons:commons-math3:3.6'\n-    compile 'org.bouncycastle:bcprov-jdk16:1.46'\n+    api 'joda-time:joda-time:2.2'\n+    api 'org.apache.commons:commons-lang3:3.6'\n+    api 'org.apache.commons:commons-math3:3.6'\n+    api 'org.bouncycastle:bcprov-jdk16:1.46'\n \n     //\n     // Processing\n     //\n-    compile 'org.processing:core:3.0'\n+    api 'org.processing:core:3.0'\n \n     //\n     // Commons CLI\n     //\n-    compile 'commons-cli:commons-cli:1.3.1'\n+    api 'commons-cli:commons-cli:1.3.1'\n \n     //\n     // HBase 1.0.0\n     //\n-    compile 'org.apache.hbase:hbase-client:1.0.0'\n-    compile 'org.apache.hbase:hbase-examples:1.0.0'\n-    compile 'org.apache.hbase:hbase-common:1.0.0'\n-    compile 'org.apache.hbase:hbase-protocol:1.0.0'\n-\n-    compile 'org.eclipse.jetty:jetty-server:9.4.2.v20170220'\n-    compile 'org.eclipse.jetty.websocket:websocket-server:9.4.2.v20170220'\n-    compile 'org.eclipse.jetty.websocket:websocket-client:9.4.2.v20170220'\n-    compile 'com.netflix.curator:curator-x-discovery:1.3.3'\n-    compile 'com.fasterxml.jackson.core:jackson-databind:2.10.2'\n-    compile 'org.slf4j:slf4j-api:1.7.5'\n+    api 'org.apache.hbase:hbase-client:1.0.0'\n+    api 'org.apache.hbase:hbase-examples:1.0.0'\n+    api 'org.apache.hbase:hbase-common:1.0.0'\n+    api 'org.apache.hbase:hbase-protocol:1.0.0'\n+\n+    api 'org.eclipse.jetty:jetty-server:9.4.2.v20170220'\n+    api 'org.eclipse.jetty.websocket:websocket-server:9.4.2.v20170220'\n+    api 'org.eclipse.jetty.websocket:websocket-client:9.4.2.v20170220'\n+    api 'com.netflix.curator:curator-x-discovery:1.3.3'\n+    api 'com.fasterxml.jackson.core:jackson-databind:2.10.2'\n+    api 'org.slf4j:slf4j-api:1.7.5'\n \n     //\n     // FFT\n     //\n-    compile 'com.github.rwl:jtransforms:2.4.0'\n+    api 'com.github.rwl:jtransforms:2.4.0'\n \n     //\n     // Pyrolite\n     //\n-    compile 'net.razorvine:pyrolite:4.10'\n+    api 'net.razorvine:pyrolite:4.10'\n \n     //\n     // LevelDB\n     //\n-    compile 'org.fusesource.leveldbjni:leveldbjni-all:1.8'\n+    api 'org.fusesource.leveldbjni:leveldbjni-all:1.8'\n     // https://mvnrepository.com/artifact/org.openlabtesting.leveldbjni/leveldbjni-linux64-aarch64\n-    compile group: 'org.openlabtesting.leveldbjni', name: 'leveldbjni-linux64-aarch64', version: '1.8'\n+    api group: 'org.openlabtesting.leveldbjni', name: 'leveldbjni-linux64-aarch64', version: '1.8'\n \n-    compile 'org.iq80.leveldb:leveldb:0.12:uber'\n+    api 'org.iq80.leveldb:leveldb:0.12:uber'\n \n     //\n     // Worf\n     //\n-    compile 'jline:jline:2.13'\n+    api 'jline:jline:2.13'\n \n     //\n     // Mustache\n     //\n-    compile 'com.github.spullara.mustache.java:compiler:0.9.1'\n+    api 'com.github.spullara.mustache.java:compiler:0.9.1'\n \n     //\n     // Geo\n     //\n-    compile 'com.geoxp:geoxplib:1.0.0'\n-    compile(\"org.wololo:jts2geojson:0.10.0\")\n+    api 'com.geoxp:geoxplib:1.0.0'\n+    api 'org.wololo:jts2geojson:0.10.0'\n \n     //\n     // Java Merge Sort\n     //\n-    compile 'com.fasterxml.util:java-merge-sort:1.0.0'\n+    api 'com.fasterxml.util:java-merge-sort:1.0.0'\n \n     // @see http://www.mail-archive.com/dev@kafka.apache.org/msg03829.html\n-    compile(\"org.apache.kafka:kafka_2.11:0.8.2.2\") {\n+    api('org.apache.kafka:kafka_2.11:0.8.2.2') {\n         exclude module: 'jms'\n         exclude module: 'jmxtools'\n         exclude module: 'jmxri'\n     }\n-    testCompile 'junit:junit:4.6'\n-}\n-\n-jar {\n-    zip64 = true\n-\n-    manifest {\n-        attributes(\n-                \"Implementation-Title\": \"Warp 10\",\n-                \"Implementation-Vendor\": \"SenX\",\n-                \"Implementation-Version\": version)\n-    }\n+    testCompileOnly 'junit:junit:4.6'\n }\n \n task pack(type: Jar) {\n     zip64 = true\n-    ext.warpSuffixName = null != System.getProperty('warp') ? System.getProperty('warp') : \"\"\n-    appendix = \"${warpSuffixName}\"\n+    archiveAppendix = (null != System.getProperty('warp')) ? System.getProperty('warp') : \"\"\n \n     manifest {\n-        attributes(\"Main-Class\": \"io.warp10.standalone.Warp\")\n-        attributes(\"Implementation-Title\": \"Warp 10\")\n-        attributes(\"Implementation-Version\": version)\n+        attributes(\n+            \"Main-Class\": \"io.warp10.standalone.Warp\",\n+            \"Implementation-Title\": \"Warp 10\",\n+            \"Implementation-Vendor\": \"Warp 10\",\n+            \"Implementation-Version\": project.version\n+        )\n     }\n \n     from files(sourceSets.main.output.classesDirs)\n     from files(sourceSets.main.resources.srcDirs)\n     from {\n-        configurations.compile.collect {\n+        configurations.compileClasspath.collect {\n             it.isDirectory() ? it : zipTree(it).matching {\n                 exclude { it.toString().contains('/servlet-api') }\n-                exclude { it.toString().contains('jmh') }\n                 exclude { it.toString().contains('junit') }\n-                exclude { it.toString().contains('parquet') }\n             }\n         }\n     } {\n         exclude 'META-INF/*.DSA'", "originalCommit": "79502f28b62a39c0338cea5602713e93e47dfef9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "8eda04660549c6ca0170cca9fd920835b87ad24d", "url": "https://github.com/senx/warp10-platform/commit/8eda04660549c6ca0170cca9fd920835b87ad24d", "message": "Make sure RSA signatures from dependencies are removed in warp10:pack", "committedDate": "2020-07-23T11:43:12Z", "type": "commit"}, {"oid": "1312dd800b7f15c1807924e9dda7368b4e5223be", "url": "https://github.com/senx/warp10-platform/commit/1312dd800b7f15c1807924e9dda7368b4e5223be", "message": "Merge branch 'master' into gradle_revamp", "committedDate": "2020-07-29T08:04:31Z", "type": "commit"}, {"oid": "5785c9e90a31ab13b6ea797842db9c607d5a73d4", "url": "https://github.com/senx/warp10-platform/commit/5785c9e90a31ab13b6ea797842db9c607d5a73d4", "message": "Merge branch 'master' into gradle_revamp", "committedDate": "2020-09-03T10:19:23Z", "type": "commit"}, {"oid": "3abe8d956f5a6a509268549f6ab10fc615408852", "url": "https://github.com/senx/warp10-platform/commit/3abe8d956f5a6a509268549f6ab10fc615408852", "message": "Merge branch 'master' into gradle_revamp", "committedDate": "2020-11-10T16:43:32Z", "type": "commit"}, {"oid": "521dce07cbab77cb148687a435ac7f03084654d1", "url": "https://github.com/senx/warp10-platform/commit/521dce07cbab77cb148687a435ac7f03084654d1", "message": "Merge branch 'master' into gradle_revamp", "committedDate": "2020-11-13T10:56:24Z", "type": "commit"}, {"oid": "84a006ce6a6ba3f93883717729d94231f19ff65f", "url": "https://github.com/senx/warp10-platform/commit/84a006ce6a6ba3f93883717729d94231f19ff65f", "message": "Address Gradle 7.0 deprecation warnings and fix compile->api", "committedDate": "2020-11-13T11:30:39Z", "type": "commit"}, {"oid": "82a19b8a8c733703b1dbf870c43313c9c34434ed", "url": "https://github.com/senx/warp10-platform/commit/82a19b8a8c733703b1dbf870c43313c9c34434ed", "message": "Avoid duplicate classes in the jar built by warp10:pack", "committedDate": "2020-11-17T08:53:16Z", "type": "commit"}, {"oid": "5d6b7e5fdb2f814fbe558d952bb6c828004c3419", "url": "https://github.com/senx/warp10-platform/commit/5d6b7e5fdb2f814fbe558d952bb6c828004c3419", "message": "Merge branch 'master' into gradle_revamp", "committedDate": "2021-01-11T11:46:54Z", "type": "commit"}, {"oid": "641eb9f4e68b25f4ef3716511cbbf890d6c24872", "url": "https://github.com/senx/warp10-platform/commit/641eb9f4e68b25f4ef3716511cbbf890d6c24872", "message": "Fix classpath", "committedDate": "2021-01-11T13:07:55Z", "type": "commit"}, {"oid": "3e30e0ccba8ac2f1a739473cda6f793a66a44cc1", "url": "https://github.com/senx/warp10-platform/commit/3e30e0ccba8ac2f1a739473cda6f793a66a44cc1", "message": "Remove transitive deps for hbase-examples and add comments", "committedDate": "2021-01-12T15:32:44Z", "type": "commit"}, {"oid": "9557f0277b3569eda8ea08fbb97b20a628ef9ba2", "url": "https://github.com/senx/warp10-platform/commit/9557f0277b3569eda8ea08fbb97b20a628ef9ba2", "message": "Use runtime classpath instead of compile", "committedDate": "2021-01-13T13:58:43Z", "type": "commit"}, {"oid": "f845590f1b7a35f7b720e39eb976010491aae4a7", "url": "https://github.com/senx/warp10-platform/commit/f845590f1b7a35f7b720e39eb976010491aae4a7", "message": "Update copyright notices", "committedDate": "2021-01-13T14:18:44Z", "type": "commit"}, {"oid": "882792e9db950fa03808aeae004ed56209935123", "url": "https://github.com/senx/warp10-platform/commit/882792e9db950fa03808aeae004ed56209935123", "message": "Fix test dependencies", "committedDate": "2021-02-08T09:54:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MjA2MjQzNQ==", "url": "https://github.com/senx/warp10-platform/pull/774#discussion_r572062435", "bodyText": "Upgrade sensision to 1.0.23", "author": "steven-gueguen", "createdAt": "2021-02-08T13:52:37Z", "path": "token/build.gradle", "diffHunk": "@@ -29,38 +23,36 @@ sourceSets {\n }\n \n dependencies {\n-    testCompile 'junit:junit:4.6'\n-    testCompile 'org.slf4j:slf4j-log4j12:1.7.21'\n+    testImplementation 'junit:junit:4.6'\n+    testImplementation 'org.slf4j:slf4j-log4j12:1.7.21'\n \n     // WARP10 DEPENDENCIES\n-    compile project(':crypto')\n-    compile 'io.warp10:sensision:1.0.22'\n+    api project(':crypto')\n+    api 'io.warp10:sensision:1.0.22'", "originalCommit": "882792e9db950fa03808aeae004ed56209935123", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MjA2MjYwMA==", "url": "https://github.com/senx/warp10-platform/pull/774#discussion_r572062600", "bodyText": "Upgrade sensision to 1.0.23", "author": "steven-gueguen", "createdAt": "2021-02-08T13:52:52Z", "path": "warp10/build.gradle", "diffHunk": "@@ -43,171 +42,195 @@ dependencies {\n     //\n     // io.warp10 dependencies\n     //\n-    compile project(':crypto')\n-    compile project(':token')\n-    compile 'io.warp10:sensision:1.0.22'\n+    api project(':crypto')\n+    api project(':token')\n+    api 'io.warp10:sensision:1.0.22'", "originalCommit": "882792e9db950fa03808aeae004ed56209935123", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "47b278447d94cd56364939f22309e15af239b48f", "url": "https://github.com/senx/warp10-platform/commit/47b278447d94cd56364939f22309e15af239b48f", "message": "Bump sensision dep to 1.0.23", "committedDate": "2021-02-08T15:42:37Z", "type": "commit"}]}