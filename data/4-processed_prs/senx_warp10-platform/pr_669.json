{"pr_number": 669, "pr_title": "Fixes #667 - Add support for missing labels in Directory searches", "pr_createdAt": "2020-02-19T17:08:57Z", "pr_url": "https://github.com/senx/warp10-platform/pull/669", "timeline": [{"oid": "f78b2613c702193bacbbdc01219e5e1c4d95d807", "url": "https://github.com/senx/warp10-platform/commit/f78b2613c702193bacbbdc01219e5e1c4d95d807", "message": "Fixes #667 - Add support for missing labels in Directory searches", "committedDate": "2020-02-19T17:08:15Z", "type": "commit"}, {"oid": "379dfe71a35b7c43249cfaa5b0874da6a9fb0838", "url": "https://github.com/senx/warp10-platform/commit/379dfe71a35b7c43249cfaa5b0874da6a9fb0838", "message": "Added parameter forSearch to buildSelector to differentiate the output depending on target use", "committedDate": "2020-02-20T12:51:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzczNTUxMg==", "url": "https://github.com/senx/warp10-platform/pull/669#discussion_r383735512", "bodyText": "It there a reason it's warp10. instead of directory. like the other keys in this file?", "author": "ftence", "createdAt": "2020-02-25T08:54:41Z", "path": "etc/conf.templates/distributed/10-directory.conf.template", "diffHunk": "@@ -286,3 +286,8 @@ directory.hbase.filter = false\n // Should we ignore the proxy settings when doing a streaming request?\n //\n #directory.streaming.noproxy =\n+\n+//\n+// Set to true to allow Directory queries with missing label selectors (using empty exact match)\n+//\n+warp10.absent.label.support = true", "originalCommit": "379dfe71a35b7c43249cfaa5b0874da6a9fb0838", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDMxNTY3NA==", "url": "https://github.com/senx/warp10-platform/pull/669#discussion_r384315674", "bodyText": "The reason was that the support for missing labels may go beyond Directory. As a matter of fact filterByMetadata should be modified to also support absent label selection if the config is enabled.\nI will move the config out of the directory config file and into the top warp one.", "author": "hbs", "createdAt": "2020-02-26T07:37:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzczNTUxMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzczNTY1MA==", "url": "https://github.com/senx/warp10-platform/pull/669#discussion_r383735650", "bodyText": "Ditto.", "author": "ftence", "createdAt": "2020-02-25T08:54:59Z", "path": "etc/conf.templates/standalone/10-directory.conf.template", "diffHunk": "@@ -29,3 +29,8 @@ directory.stats.class.maxcardinality = 100\n // Maximum number of labels for which to report detailed stats in 'FINDSTATS'\n //\n directory.stats.labels.maxcardinality = 100\n+\n+//\n+// Set to true to allow Directory queries with missing label selectors (using empty exact match)\n+//\n+warp10.absent.label.support = true", "originalCommit": "379dfe71a35b7c43249cfaa5b0874da6a9fb0838", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "4ad88f67de2816d3a3dfdf16ce5c245347522a32", "url": "https://github.com/senx/warp10-platform/commit/4ad88f67de2816d3a3dfdf16ce5c245347522a32", "message": "Moved configuration into 00-warp.conf", "committedDate": "2020-02-26T07:39:06Z", "type": "commit"}, {"oid": "67ae8d49e06c19fd9658c75aaf8378366541a9bc", "url": "https://github.com/senx/warp10-platform/commit/67ae8d49e06c19fd9658c75aaf8378366541a9bc", "message": "Added support for missing labels", "committedDate": "2020-02-26T07:59:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTEyMzM0OA==", "url": "https://github.com/senx/warp10-platform/pull/669#discussion_r385123348", "bodyText": "Shouldn't  it be null != inputAttributes && null != inputAttributes.get(label) ?\nAlso you could merge the if and the else if blocks because they do the same.", "author": "ftence", "createdAt": "2020-02-27T13:25:50Z", "path": "warp10/src/main/java/io/warp10/continuum/gts/MetadataSelectorMatcher.java", "diffHunk": "@@ -177,8 +212,19 @@ public boolean matches(Metadata metadata) {\n     } else {\n       // standard selector\n       if (null != this.labelsPatterns) {\n+        for (String label: this.missingLabels) {\n+          if (null != inputLabels && null != inputLabels.get(label)) {\n+            labelAndAttributeMatch = false;\n+            break;\n+          } else if (null != inputAttributes && null != inputLabels.get(label)) {", "originalCommit": "67ae8d49e06c19fd9658c75aaf8378366541a9bc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "ed6dbc774e5e26829b14832fec7eb40407d26674", "url": "https://github.com/senx/warp10-platform/commit/ed6dbc774e5e26829b14832fec7eb40407d26674", "message": "Addressed PR comment.", "committedDate": "2020-02-27T14:33:15Z", "type": "commit"}, {"oid": "7ae45241210ae631dc9d7a2aada764d1b081e862", "url": "https://github.com/senx/warp10-platform/commit/7ae45241210ae631dc9d7a2aada764d1b081e862", "message": "Addressed PR comment, merged conditionals.", "committedDate": "2020-02-27T14:36:46Z", "type": "commit"}]}